const WEBXR_B64 = 'KGZ1bmN0aW9uICgpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICBmdW5jdGlvbiBsb2cobXNnLCBtb2R1bGUsIG9iail7DQogICAgICAgIGNvbnNvbGUubG9nKGBbVlIgVmlkZW8gSW5qZWN0b3Ike21vZHVsZSA/ICcgLyAnIDogJyd9JHttb2R1bGUgPyBtb2R1bGUgOiAnJ31dICR7bXNnfWAsIG9iaiA/IG9iaiA6ICcgJyk7DQogICAgfQoKICAgIHZhciBzdHlsZXMgPSAiI3ZyLW92ZXJsYXktbW9kYWwge1xyXG4gICAgcG9zaXRpb246IGZpeGVkO1xyXG4gICAgei1pbmRleDogOTk4O1xyXG4gICAgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgYm90dG9tOiAwO1xyXG4gICAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjk1KTtcclxuICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xyXG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XHJcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xyXG59XHJcbiN2ci1jYW52YXMtY29udGFpbmVyIHtcclxuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcclxuICAgIHdpZHRoOiAxMDAlO1xyXG4gICAgaGVpZ2h0OiAxMDAlO1xyXG59XHJcbiN2ci1zdGFydC1idXR0b24ge1xyXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgei1pbmRleDogOTk5O1xyXG4gICAgdG9wOiAyMHB4O1xyXG4gICAgbGVmdDogNTAlO1xyXG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpO1xyXG4gICAgcGFkZGluZzogMTJweCAyNHB4O1xyXG4gICAgZm9udC1zaXplOiAxNnB4O1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzAwY2M4ODtcclxuICAgIGNvbG9yOiB3aGl0ZTtcclxuICAgIGJvcmRlcjogbm9uZTtcclxuICAgIGJvcmRlci1yYWRpdXM6IDZweDtcclxuICAgIGN1cnNvcjogcG9pbnRlcjtcclxufVxyXG4jdnItY2xvc2UtYnV0dG9uIHtcclxuICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgIHRvcDogMjBweDtcclxuICAgIHJpZ2h0OiAyMHB4O1xyXG4gICAgei1pbmRleDogOTk5O1xyXG4gICAgcGFkZGluZzogMTBweCAyMHB4O1xyXG4gICAgZm9udC1zaXplOiAxNHB4O1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogI2NjMzMzMztcclxuICAgIGNvbG9yOiB3aGl0ZTtcclxuICAgIGJvcmRlcjogbm9uZTtcclxuICAgIGJvcmRlci1yYWRpdXM6IDZweDtcclxuICAgIGN1cnNvcjogcG9pbnRlcjtcclxufVxyXG5jYW52YXMud2ViZ2wge1xyXG4gICAgd2lkdGg6IDEwMCU7XHJcbiAgICBoZWlnaHQ6IDEwMCU7XHJcbiAgICBkaXNwbGF5OiBibG9jaztcclxufSI7CgogICAgLyoqCiAgICAgKiBAbGljZW5zZQogICAgICogQ29weXJpZ2h0IDIwMTAtMjAyNSBUaHJlZS5qcyBBdXRob3JzCiAgICAgKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCiAgICAgKi8KICAgIGNvbnN0IFJFVklTSU9OID0gJzE3OCc7CgogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBmYWNlIGN1bGxpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBDdWxsRmFjZU5vbmUgPSAwOwoKICAgIC8qKgogICAgICogQ3VsbHMgYmFjayBmYWNlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1bGxGYWNlQmFjayA9IDE7CgogICAgLyoqCiAgICAgKiBDdWxscyBmcm9udCBmYWNlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1bGxGYWNlRnJvbnQgPSAyOwoKICAgIC8qKgogICAgICogRmlsdGVycyBzaGFkb3cgbWFwcyB1c2luZyB0aGUgUGVyY2VudGFnZS1DbG9zZXIgRmlsdGVyaW5nIChQQ0YpIGFsZ29yaXRobS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFBDRlNoYWRvd01hcCA9IDE7CgogICAgLyoqCiAgICAgKiBGaWx0ZXJzIHNoYWRvdyBtYXBzIHVzaW5nIHRoZSBQZXJjZW50YWdlLUNsb3NlciBGaWx0ZXJpbmcgKFBDRikgYWxnb3JpdGhtIHdpdGgKICAgICAqIGJldHRlciBzb2Z0IHNoYWRvd3MgZXNwZWNpYWxseSB3aGVuIHVzaW5nIGxvdy1yZXNvbHV0aW9uIHNoYWRvdyBtYXBzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUENGU29mdFNoYWRvd01hcCA9IDI7CgogICAgLyoqCiAgICAgKiBGaWx0ZXJzIHNoYWRvdyBtYXBzIHVzaW5nIHRoZSBWYXJpYW5jZSBTaGFkb3cgTWFwIChWU00pIGFsZ29yaXRobS4KICAgICAqIFdoZW4gdXNpbmcgVlNNU2hhZG93TWFwIGFsbCBzaGFkb3cgcmVjZWl2ZXJzIHdpbGwgYWxzbyBjYXN0IHNoYWRvd3MuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBWU01TaGFkb3dNYXAgPSAzOwoKICAgIC8qKgogICAgICogT25seSBmcm9udCBmYWNlcyBhcmUgcmVuZGVyZWQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBGcm9udFNpZGUgPSAwOwoKICAgIC8qKgogICAgICogT25seSBiYWNrIGZhY2VzIGFyZSByZW5kZXJlZC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEJhY2tTaWRlID0gMTsKCiAgICAvKioKICAgICAqIEJvdGggZnJvbnQgYW5kIGJhY2sgZmFjZXMgYXJlIHJlbmRlcmVkLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgRG91YmxlU2lkZSA9IDI7CgogICAgLyoqCiAgICAgKiBObyBibGVuZGluZyBpcyBwZXJmb3JtZWQgd2hpY2ggZWZmZWN0aXZlbHkgZGlzYWJsZXMKICAgICAqIGFscGhhIHRyYW5zcGFyZW5jeS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5vQmxlbmRpbmcgPSAwOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgYmxlbmRpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOb3JtYWxCbGVuZGluZyA9IDE7CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGFkZGl0aXZlIGJsZW5kaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQWRkaXRpdmVCbGVuZGluZyA9IDI7CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIHN1YnRyYWN0aXZlIGJsZW5kaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU3VidHJhY3RpdmVCbGVuZGluZyA9IDM7CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIG11bHRpcGx5IGJsZW5kaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTXVsdGlwbHlCbGVuZGluZyA9IDQ7CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGN1c3RvbSBibGVuZGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1c3RvbUJsZW5kaW5nID0gNTsKCiAgICAvKioKICAgICAqIEEgYHNvdXJjZSArIGRlc3RpbmF0aW9uYCBibGVuZGluZyBlcXVhdGlvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEFkZEVxdWF0aW9uID0gMTAwOwoKICAgIC8qKgogICAgICogQSBgc291cmNlIC0gZGVzdGluYXRpb25gIGJsZW5kaW5nIGVxdWF0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU3VidHJhY3RFcXVhdGlvbiA9IDEwMTsKCiAgICAvKioKICAgICAqIEEgYGRlc3RpbmF0aW9uIC0gc291cmNlYCBibGVuZGluZyBlcXVhdGlvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJldmVyc2VTdWJ0cmFjdEVxdWF0aW9uID0gMTAyOwoKICAgIC8qKgogICAgICogQSBibGVuZCBlcXVhdGlvbiB0aGF0IHVzZXMgdGhlIG1pbmltdW0gb2Ygc291cmNlIGFuZCBkZXN0aW5hdGlvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE1pbkVxdWF0aW9uID0gMTAzOwoKICAgIC8qKgogICAgICogQSBibGVuZCBlcXVhdGlvbiB0aGF0IHVzZXMgdGhlIG1heGltdW0gb2Ygc291cmNlIGFuZCBkZXN0aW5hdGlvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE1heEVxdWF0aW9uID0gMTA0OwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAwYC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFplcm9GYWN0b3IgPSAyMDA7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYDFgLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT25lRmFjdG9yID0gMjAxOwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBzb3VyY2UgY29sb3JzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU3JjQ29sb3JGYWN0b3IgPSAyMDI7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYDFgIG1pbnVzIGVhY2ggc291cmNlIGNvbG9yLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT25lTWludXNTcmNDb2xvckZhY3RvciA9IDIwMzsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSB0aGUgc291cmNlIGFscGhhIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU3JjQWxwaGFGYWN0b3IgPSAyMDQ7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgMSBtaW51cyB0aGUgc291cmNlIGFscGhhIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT25lTWludXNTcmNBbHBoYUZhY3RvciA9IDIwNTsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSB0aGUgZGVzdGluYXRpb24gYWxwaGEgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBEc3RBbHBoYUZhY3RvciA9IDIwNjsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgdGhlIGRlc3RpbmF0aW9uIGFscGhhIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT25lTWludXNEc3RBbHBoYUZhY3RvciA9IDIwNzsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSB0aGUgZGVzdGluYXRpb24gY29sb3IuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBEc3RDb2xvckZhY3RvciA9IDIwODsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgZWFjaCBkZXN0aW5hdGlvbiBjb2xvci4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgPSAyMDk7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIHRoZSBSR0IgY29sb3JzIGJ5IHRoZSBzbWFsbGVyIG9mIGVpdGhlciB0aGUgc291cmNlIGFscGhhCiAgICAgKiB2YWx1ZSBvciB0aGUgdmFsdWUgb2YgYDFgIG1pbnVzIHRoZSBkZXN0aW5hdGlvbiBhbHBoYSB2YWx1ZS4gVGhlIGFscGhhCiAgICAgKiB2YWx1ZSBpcyBtdWx0aXBsaWVkIGJ5IGAxYC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFNyY0FscGhhU2F0dXJhdGVGYWN0b3IgPSAyMTA7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYSBjb25zdGFudCBjb2xvci4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IENvbnN0YW50Q29sb3JGYWN0b3IgPSAyMTE7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYDFgIG1pbnVzIGEgY29uc3RhbnQgY29sb3IuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3IgPSAyMTI7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYSBjb25zdGFudCBhbHBoYSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IENvbnN0YW50QWxwaGFGYWN0b3IgPSAyMTM7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgMSBtaW51cyBhIGNvbnN0YW50IGFscGhhIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT25lTWludXNDb25zdGFudEFscGhhRmFjdG9yID0gMjE0OwoKICAgIC8qKgogICAgICogTmV2ZXIgcGFzcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5ldmVyRGVwdGggPSAwOwoKICAgIC8qKgogICAgICogQWx3YXlzIHBhc3MuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBBbHdheXNEZXB0aCA9IDE7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIGRlcHRoIGJ1ZmZlciB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExlc3NEZXB0aCA9IDI7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGRlcHRoIGJ1ZmZlciB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExlc3NFcXVhbERlcHRoID0gMzsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGVxdWFscyB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgRXF1YWxEZXB0aCA9IDQ7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGRlcHRoIGJ1ZmZlciB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEdyZWF0ZXJFcXVhbERlcHRoID0gNTsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgR3JlYXRlckRlcHRoID0gNjsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIG5vdCBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTm90RXF1YWxEZXB0aCA9IDc7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIHRoZSBlbnZpcm9ubWVudCBtYXAgY29sb3Igd2l0aCB0aGUgc3VyZmFjZSBjb2xvci4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE11bHRpcGx5T3BlcmF0aW9uID0gMDsKCiAgICAvKioKICAgICAqIFVzZXMgcmVmbGVjdGl2aXR5IHRvIGJsZW5kIGJldHdlZW4gdGhlIHR3byBjb2xvcnMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBNaXhPcGVyYXRpb24gPSAxOwoKICAgIC8qKgogICAgICogQWRkcyB0aGUgdHdvIGNvbG9ycy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEFkZE9wZXJhdGlvbiA9IDI7CgogICAgLyoqCiAgICAgKiBObyB0b25lIG1hcHBpbmcgaXMgYXBwbGllZC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5vVG9uZU1hcHBpbmcgPSAwOwoKICAgIC8qKgogICAgICogTGluZWFyIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExpbmVhclRvbmVNYXBwaW5nID0gMTsKCiAgICAvKioKICAgICAqIFJlaW5oYXJkIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJlaW5oYXJkVG9uZU1hcHBpbmcgPSAyOwoKICAgIC8qKgogICAgICogQ2luZW9uIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IENpbmVvblRvbmVNYXBwaW5nID0gMzsKCiAgICAvKioKICAgICAqIEFDRVMgRmlsbWljIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEFDRVNGaWxtaWNUb25lTWFwcGluZyA9IDQ7CgogICAgLyoqCiAgICAgKiBDdXN0b20gdG9uZSBtYXBwaW5nLgogICAgICoKICAgICAqIEV4cGVjdHMgYSBjdXN0b20gaW1wbGVtZW50YXRpb24gYnkgbW9kaWZ5aW5nIHNoYWRlciBjb2RlIG9mIHRoZSBtYXRlcmlhbCdzIGZyYWdtZW50IHNoYWRlci4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1c3RvbVRvbmVNYXBwaW5nID0gNTsKCiAgICAvKioKICAgICAqIEFnWCB0b25lIG1hcHBpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBBZ1hUb25lTWFwcGluZyA9IDY7CgogICAgLyoqCiAgICAgKiBOZXV0cmFsIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBJbXBsZW1lbnRhdGlvbiBiYXNlZCBvbiB0aGUgS2hyb25vcyAzRCBDb21tZXJjZSBHcm91cCBzdGFuZGFyZCB0b25lIG1hcHBpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOZXV0cmFsVG9uZU1hcHBpbmcgPSA3OwoKICAgIC8qKgogICAgICogTWFwcyB0ZXh0dXJlcyB1c2luZyB0aGUgZ2VvbWV0cnkncyBVViBjb29yZGluYXRlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVWTWFwcGluZyA9IDMwMDsKCiAgICAvKioKICAgICAqIFJlZmxlY3Rpb24gbWFwcGluZyBmb3IgY3ViZSB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1YmVSZWZsZWN0aW9uTWFwcGluZyA9IDMwMTsKCiAgICAvKioKICAgICAqIFJlZnJhY3Rpb24gbWFwcGluZyBmb3IgY3ViZSB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1YmVSZWZyYWN0aW9uTWFwcGluZyA9IDMwMjsKCiAgICAvKioKICAgICAqIFJlZmxlY3Rpb24gbWFwcGluZyBmb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDM7CgogICAgLyoqCiAgICAgKiBSZWZyYWN0aW9uIG1hcHBpbmcgZm9yIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nID0gMzA0OwoKICAgIC8qKgogICAgICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBQTVJFTSB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nID0gMzA2OwoKICAgIC8qKgogICAgICogVGhlIHRleHR1cmUgd2lsbCBzaW1wbHkgcmVwZWF0IHRvIGluZmluaXR5LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUmVwZWF0V3JhcHBpbmcgPSAxMDAwOwoKICAgIC8qKgogICAgICogVGhlIGxhc3QgcGl4ZWwgb2YgdGhlIHRleHR1cmUgc3RyZXRjaGVzIHRvIHRoZSBlZGdlIG9mIHRoZSBtZXNoLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ2xhbXBUb0VkZ2VXcmFwcGluZyA9IDEwMDE7CgogICAgLyoqCiAgICAgKiBUaGUgdGV4dHVyZSB3aWxsIHJlcGVhdHMgdG8gaW5maW5pdHksIG1pcnJvcmluZyBvbiBlYWNoIHJlcGVhdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcgPSAxMDAyOwoKICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHRleHR1cmUgZWxlbWVudCB0aGF0IGlzIG5lYXJlc3QgKGluIE1hbmhhdHRhbiBkaXN0YW5jZSkKICAgICAqIHRvIHRoZSBzcGVjaWZpZWQgdGV4dHVyZSBjb29yZGluYXRlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5lYXJlc3RGaWx0ZXIgPSAxMDAzOwoKICAgIC8qKgogICAgICogQ2hvb3NlcyB0aGUgbWlwbWFwIHRoYXQgbW9zdCBjbG9zZWx5IG1hdGNoZXMgdGhlIHNpemUgb2YgdGhlIHBpeGVsIGJlaW5nIHRleHR1cmVkCiAgICAgKiBhbmQgdXNlcyB0aGUgYE5lYXJlc3RGaWx0ZXJgIGNyaXRlcmlvbiAodGhlIHRleGVsIG5lYXJlc3QgdG8gdGhlIGNlbnRlciBvZiB0aGUgcGl4ZWwpCiAgICAgKiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyID0gMTAwNDsKCiAgICAvKioKICAgICAqIENob29zZXMgdGhlIHR3byBtaXBtYXBzIHRoYXQgbW9zdCBjbG9zZWx5IG1hdGNoIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQKICAgICAqIHVzZXMgdGhlIGBOZWFyZXN0RmlsdGVyYCBjcml0ZXJpb24gdG8gcHJvZHVjZSBhIHRleHR1cmUgdmFsdWUgZnJvbSBlYWNoIG1pcG1hcC4KICAgICAqIFRoZSBmaW5hbCB0ZXh0dXJlIHZhbHVlIGlzIGEgd2VpZ2h0ZWQgYXZlcmFnZSBvZiB0aG9zZSB0d28gdmFsdWVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciA9IDEwMDU7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRoZSBmb3VyIHRleHR1cmUgZWxlbWVudHMgdGhhdCBhcmUgY2xvc2VzdCB0byB0aGUgc3BlY2lmaWVkCiAgICAgKiB0ZXh0dXJlIGNvb3JkaW5hdGVzLCBhbmQgY2FuIGluY2x1ZGUgaXRlbXMgd3JhcHBlZCBvciByZXBlYXRlZCBmcm9tIG90aGVyIHBhcnRzIG9mIGEgdGV4dHVyZSwKICAgICAqIGRlcGVuZGluZyBvbiB0aGUgdmFsdWVzIG9mIGB3cmFwU2AgYW5kIGB3cmFwVGAsIGFuZCBvbiB0aGUgZXhhY3QgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExpbmVhckZpbHRlciA9IDEwMDY7CgogICAgLyoqCiAgICAgKiBDaG9vc2VzIHRoZSBtaXBtYXAgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2hlcyB0aGUgc2l6ZSBvZiB0aGUgcGl4ZWwgYmVpbmcgdGV4dHVyZWQgYW5kIHVzZXMKICAgICAqIHRoZSBgTGluZWFyRmlsdGVyYCBjcml0ZXJpb24gKGEgd2VpZ2h0ZWQgYXZlcmFnZSBvZiB0aGUgZm91ciB0ZXhlbHMgdGhhdCBhcmUgY2xvc2VzdCB0byB0aGUKICAgICAqIGNlbnRlciBvZiB0aGUgcGl4ZWwpIHRvIHByb2R1Y2UgYSB0ZXh0dXJlIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciA9IDEwMDc7CgogICAgLyoqCiAgICAgKiBDaG9vc2VzIHRoZSB0d28gbWlwbWFwcyB0aGF0IG1vc3QgY2xvc2VseSBtYXRjaCB0aGUgc2l6ZSBvZiB0aGUgcGl4ZWwgYmVpbmcgdGV4dHVyZWQgYW5kIHVzZXMKICAgICAqIHRoZSBgTGluZWFyRmlsdGVyYCBjcml0ZXJpb24gdG8gcHJvZHVjZSBhIHRleHR1cmUgdmFsdWUgZnJvbSBlYWNoIG1pcG1hcC4gVGhlIGZpbmFsIHRleHR1cmUgdmFsdWUKICAgICAqIGlzIGEgd2VpZ2h0ZWQgYXZlcmFnZSBvZiB0aG9zZSB0d28gdmFsdWVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyID0gMTAwODsKCiAgICAvKioKICAgICAqIEFuIHVuc2lnbmVkIGJ5dGUgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVuc2lnbmVkQnl0ZVR5cGUgPSAxMDA5OwoKICAgIC8qKgogICAgICogQSBieXRlIGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBCeXRlVHlwZSA9IDEwMTA7CgogICAgLyoqCiAgICAgKiBBIHNob3J0IGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTaG9ydFR5cGUgPSAxMDExOwoKICAgIC8qKgogICAgICogQW4gdW5zaWduZWQgc2hvcnQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVuc2lnbmVkU2hvcnRUeXBlID0gMTAxMjsKCiAgICAvKioKICAgICAqIEFuIGludCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgSW50VHlwZSA9IDEwMTM7CgogICAgLyoqCiAgICAgKiBBbiB1bnNpZ25lZCBpbnQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVuc2lnbmVkSW50VHlwZSA9IDEwMTQ7CgogICAgLyoqCiAgICAgKiBBIGZsb2F0IGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBGbG9hdFR5cGUgPSAxMDE1OwoKICAgIC8qKgogICAgICogQSBoYWxmIGZsb2F0IGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBIYWxmRmxvYXRUeXBlID0gMTAxNjsKCiAgICAvKioKICAgICAqIEFuIHVuc2lnbmVkIHNob3J0IDRfNF80XzQgKHBhY2tlZCkgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVuc2lnbmVkU2hvcnQ0NDQ0VHlwZSA9IDEwMTc7CgogICAgLyoqCiAgICAgKiBBbiB1bnNpZ25lZCBzaG9ydCA1XzVfNV8xIChwYWNrZWQpIGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBVbnNpZ25lZFNob3J0NTU1MVR5cGUgPSAxMDE4OwoKICAgIC8qKgogICAgICogQW4gdW5zaWduZWQgaW50IDI0XzggZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVuc2lnbmVkSW50MjQ4VHlwZSA9IDEwMjA7CgogICAgLyoqCiAgICAgKiBBbiB1bnNpZ25lZCBpbnQgNV85XzlfOSAocGFja2VkKSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVW5zaWduZWRJbnQ1OTk5VHlwZSA9IDM1OTAyOwoKICAgIC8qKgogICAgICogRGlzY2FyZHMgdGhlIHJlZCwgZ3JlZW4gYW5kIGJsdWUgY29tcG9uZW50cyBhbmQgcmVhZHMganVzdCB0aGUgYWxwaGEgY29tcG9uZW50LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQWxwaGFGb3JtYXQgPSAxMDIxOwoKICAgIC8qKgogICAgICogRGlzY2FyZHMgdGhlIGFscGhhIGNvbXBvbmVudCBhbmQgcmVhZHMgdGhlIHJlZCwgZ3JlZW4gYW5kIGJsdWUgY29tcG9uZW50LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCRm9ybWF0ID0gMTAyMjsKCiAgICAvKioKICAgICAqIFJlYWRzIHRoZSByZWQsIGdyZWVuLCBibHVlIGFuZCBhbHBoYSBjb21wb25lbnRzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQUZvcm1hdCA9IDEwMjM7CgogICAgLyoqCiAgICAgKiBSZWFkcyBlYWNoIGVsZW1lbnQgYXMgYSBzaW5nbGUgZGVwdGggdmFsdWUsIGNvbnZlcnRzIGl0IHRvIGZsb2F0aW5nIHBvaW50LCBhbmQgY2xhbXBzIHRvIHRoZSByYW5nZSBgWzAsMV1gLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgRGVwdGhGb3JtYXQgPSAxMDI2OwoKICAgIC8qKgogICAgICogUmVhZHMgZWFjaCBlbGVtZW50IGlzIGEgcGFpciBvZiBkZXB0aCBhbmQgc3RlbmNpbCB2YWx1ZXMuIFRoZSBkZXB0aCBjb21wb25lbnQgb2YgdGhlIHBhaXIgaXMgaW50ZXJwcmV0ZWQgYXMKICAgICAqIGluIGBEZXB0aEZvcm1hdGAuIFRoZSBzdGVuY2lsIGNvbXBvbmVudCBpcyBpbnRlcnByZXRlZCBiYXNlZCBvbiB0aGUgZGVwdGggKyBzdGVuY2lsIGludGVybmFsIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IERlcHRoU3RlbmNpbEZvcm1hdCA9IDEwMjc7CgogICAgLyoqCiAgICAgKiBEaXNjYXJkcyB0aGUgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMgYW5kIHJlYWRzIGp1c3QgdGhlIHJlZCBjb21wb25lbnQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSZWRGb3JtYXQgPSAxMDI4OwoKICAgIC8qKgogICAgICogRGlzY2FyZHMgdGhlIGdyZWVuLCBibHVlIGFuZCBhbHBoYSBjb21wb25lbnRzIGFuZCByZWFkcyBqdXN0IHRoZSByZWQgY29tcG9uZW50LiBUaGUgdGV4ZWxzIGFyZSByZWFkIGFzIGludGVnZXJzIGluc3RlYWQgb2YgZmxvYXRpbmcgcG9pbnQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSZWRJbnRlZ2VyRm9ybWF0ID0gMTAyOTsKCiAgICAvKioKICAgICAqIERpc2NhcmRzIHRoZSBhbHBoYSwgYW5kIGJsdWUgY29tcG9uZW50cyBhbmQgcmVhZHMgdGhlIHJlZCwgYW5kIGdyZWVuIGNvbXBvbmVudHMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0Zvcm1hdCA9IDEwMzA7CgogICAgLyoqCiAgICAgKiBEaXNjYXJkcyB0aGUgYWxwaGEsIGFuZCBibHVlIGNvbXBvbmVudHMgYW5kIHJlYWRzIHRoZSByZWQsIGFuZCBncmVlbiBjb21wb25lbnRzLiBUaGUgdGV4ZWxzIGFyZSByZWFkIGFzIGludGVnZXJzIGluc3RlYWQgb2YgZmxvYXRpbmcgcG9pbnQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0ludGVnZXJGb3JtYXQgPSAxMDMxOwoKICAgIC8qKgogICAgICogUmVhZHMgdGhlIHJlZCwgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFJbnRlZ2VyRm9ybWF0ID0gMTAzMzsKCiAgICAvKioKICAgICAqIEEgRFhUMS1jb21wcmVzc2VkIGltYWdlIGluIGFuIFJHQiBpbWFnZSBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JfUzNUQ19EWFQxX0Zvcm1hdCA9IDMzNzc2OwoKICAgIC8qKgogICAgICogQSBEWFQxLWNvbXByZXNzZWQgaW1hZ2UgaW4gYW4gUkdCIGltYWdlIGZvcm1hdCB3aXRoIGEgc2ltcGxlIG9uL29mZiBhbHBoYSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCA9IDMzNzc3OwoKICAgIC8qKgogICAgICogQSBEWFQzLWNvbXByZXNzZWQgaW1hZ2UgaW4gYW4gUkdCQSBpbWFnZSBmb3JtYXQuIENvbXBhcmVkIHRvIGEgMzItYml0IFJHQkEgdGV4dHVyZSwgaXQgb2ZmZXJzIDQ6MSBjb21wcmVzc2lvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCA9IDMzNzc4OwoKICAgIC8qKgogICAgICogQSBEWFQ1LWNvbXByZXNzZWQgaW1hZ2UgaW4gYW4gUkdCQSBpbWFnZSBmb3JtYXQuIEl0IGFsc28gcHJvdmlkZXMgYSA0OjEgY29tcHJlc3Npb24sIGJ1dCBkaWZmZXJzIHRvIHRoZSBEWFQzCiAgICAgKiBjb21wcmVzc2lvbiBpbiBob3cgdGhlIGFscGhhIGNvbXByZXNzaW9uIGlzIGRvbmUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgPSAzMzc3OTsKCiAgICAvKioKICAgICAqIFBWUlRDIFJHQiBjb21wcmVzc2lvbiBpbiA0LWJpdCBtb2RlLiBPbmUgYmxvY2sgZm9yIGVhY2ggNMOXNCBwaXhlbHMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCA9IDM1ODQwOwoKICAgIC8qKgogICAgICogUFZSVEMgUkdCIGNvbXByZXNzaW9uIGluIDItYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA4w5c0IHBpeGVscy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ID0gMzU4NDE7CgogICAgLyoqCiAgICAgKiBQVlJUQyBSR0JBIGNvbXByZXNzaW9uIGluIDQtYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA0w5c0IHBpeGVscy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdCA9IDM1ODQyOwoKICAgIC8qKgogICAgICogUFZSVEMgUkdCQSBjb21wcmVzc2lvbiBpbiAyLWJpdCBtb2RlLiBPbmUgYmxvY2sgZm9yIGVhY2ggOMOXNCBwaXhlbHMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MzsKCiAgICAvKioKICAgICAqIEVUQzEgUkdCIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQl9FVEMxX0Zvcm1hdCA9IDM2MTk2OwoKICAgIC8qKgogICAgICogRVRDMiBSR0IgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCX0VUQzJfRm9ybWF0ID0gMzc0OTI7CgogICAgLyoqCiAgICAgKiBFVEMyIFJHQkEgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9FVEMyX0VBQ19Gb3JtYXQgPSAzNzQ5NjsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA0eDQgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzR4NF9Gb3JtYXQgPSAzNzgwODsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA1eDQgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzV4NF9Gb3JtYXQgPSAzNzgwOTsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA1eDUgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzV4NV9Gb3JtYXQgPSAzNzgxMDsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA2eDUgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzZ4NV9Gb3JtYXQgPSAzNzgxMTsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA2eDYgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgPSAzNzgxMjsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA4eDUgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzh4NV9Gb3JtYXQgPSAzNzgxMzsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA4eDYgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgPSAzNzgxNDsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSA4eDggZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzh4OF9Gb3JtYXQgPSAzNzgxNTsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSAxMHg1IGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCA9IDM3ODE2OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDEweDYgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzEweDZfRm9ybWF0ID0gMzc4MTc7CgogICAgLyoqCiAgICAgKiBBU1RDIFJHQkEgMTB4OCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfMTB4OF9Gb3JtYXQgPSAzNzgxODsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSAxMHgxMCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfMTB4MTBfRm9ybWF0ID0gMzc4MTk7CgogICAgLyoqCiAgICAgKiBBU1RDIFJHQkEgMTJ4MTAgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdCA9IDM3ODIwOwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDEyeDEyIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQgPSAzNzgyMTsKCiAgICAvKioKICAgICAqIEJQVEMgUkdCQSBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0JQVENfRm9ybWF0ID0gMzY0OTI7CgogICAgLyoqCiAgICAgKiBCUFRDIFNpZ25lZCBSR0IgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCX0JQVENfU0lHTkVEX0Zvcm1hdCA9IDM2NDk0OwoKICAgIC8qKgogICAgICogQlBUQyBVbnNpZ25lZCBSR0IgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ID0gMzY0OTU7CgogICAgLyoqCiAgICAgKiBSR1RDMSBSZWQgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkVEX1JHVEMxX0Zvcm1hdCA9IDM2MjgzOwoKICAgIC8qKgogICAgICogUkdUQzEgU2lnbmVkIFJlZCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCA9IDM2Mjg0OwoKICAgIC8qKgogICAgICogUkdUQzIgUmVkIEdyZWVuIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgPSAzNjI4NTsKCiAgICAvKioKICAgICAqIFJHVEMyIFNpZ25lZCBSZWQgR3JlZW4gZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU0lHTkVEX1JFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgPSAzNjI4NjsKCiAgICAvKioKICAgICAqIEJhc2ljIGRlcHRoIHBhY2tpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBCYXNpY0RlcHRoUGFja2luZyA9IDMyMDA7CgogICAgLyoqCiAgICAgKiBBIGRlcHRoIHZhbHVlIGlzIHBhY2tlZCBpbnRvIDMyIGJpdCBSR0JBLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQURlcHRoUGFja2luZyA9IDMyMDE7CgogICAgLyoqCiAgICAgKiBOb3JtYWwgaW5mb3JtYXRpb24gaXMgcmVsYXRpdmUgdG8gdGhlIHVuZGVybHlpbmcgc3VyZmFjZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCA9IDA7CgogICAgLyoqCiAgICAgKiBOb3JtYWwgaW5mb3JtYXRpb24gaXMgcmVsYXRpdmUgdG8gdGhlIG9iamVjdCBvcmllbnRhdGlvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE9iamVjdFNwYWNlTm9ybWFsTWFwID0gMTsKCiAgICAvLyBDb2xvciBzcGFjZSBzdHJpbmcgaWRlbnRpZmllcnMsIG1hdGNoaW5nIENTUyBDb2xvciBNb2R1bGUgTGV2ZWwgNCBhbmQgV2ViR1BVIG5hbWVzIHdoZXJlIGF2YWlsYWJsZS4KCiAgICAvKioKICAgICAqIE5vIGNvbG9yIHNwYWNlLgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTm9Db2xvclNwYWNlID0gJyc7CgogICAgLyoqCiAgICAgKiBzUkdCIGNvbG9yIHNwYWNlLgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU1JHQkNvbG9yU3BhY2UgPSAnc3JnYic7CgogICAgLyoqCiAgICAgKiBzUkdCLWxpbmVhciBjb2xvciBzcGFjZS4KICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExpbmVhclNSR0JDb2xvclNwYWNlID0gJ3NyZ2ItbGluZWFyJzsKCiAgICAvKioKICAgICAqIExpbmVhciB0cmFuc2ZlciBmdW5jdGlvbi4KICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExpbmVhclRyYW5zZmVyID0gJ2xpbmVhcic7CgogICAgLyoqCiAgICAgKiBzUkdCIHRyYW5zZmVyIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU1JHQlRyYW5zZmVyID0gJ3NyZ2InOwoKICAgIC8qKgogICAgICogS2VlcHMgdGhlIGN1cnJlbnQgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBLZWVwU3RlbmNpbE9wID0gNzY4MDsKCiAgICAvKioKICAgICAqIFdpbGwgYWx3YXlzIHJldHVybiB0cnVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQWx3YXlzU3RlbmNpbEZ1bmMgPSA1MTk7CgogICAgLyoqCiAgICAgKiBOZXZlciBwYXNzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTmV2ZXJDb21wYXJlID0gNTEyOwoKICAgIC8qKgogICAgICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSB0ZXh0dXJlIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGVzc0NvbXBhcmUgPSA1MTM7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBlcXVhbHMgdGhlIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBFcXVhbENvbXBhcmUgPSA1MTQ7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBMZXNzRXF1YWxDb21wYXJlID0gNTE1OwoKICAgIC8qKgogICAgICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSB0ZXh0dXJlIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgR3JlYXRlckNvbXBhcmUgPSA1MTY7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBub3QgZXF1YWwgdG8gdGhlIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOb3RFcXVhbENvbXBhcmUgPSA1MTc7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBHcmVhdGVyRXF1YWxDb21wYXJlID0gNTE4OwoKICAgIC8qKgogICAgICogQWx3YXlzIHBhc3MuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBBbHdheXNDb21wYXJlID0gNTE5OwoKICAgIC8qKgogICAgICogVGhlIGNvbnRlbnRzIGFyZSBpbnRlbmRlZCB0byBiZSBzcGVjaWZpZWQgb25jZSBieSB0aGUgYXBwbGljYXRpb24sIGFuZCB1c2VkIG1hbnkKICAgICAqIHRpbWVzIGFzIHRoZSBzb3VyY2UgZm9yIGRyYXdpbmcgYW5kIGltYWdlIHNwZWNpZmljYXRpb24gY29tbWFuZHMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTdGF0aWNEcmF3VXNhZ2UgPSAzNTA0NDsKCiAgICAvKioKICAgICAqIEdMU0wgMyBzaGFkZXIgY29kZS4KICAgICAqCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEdMU0wzID0gJzMwMCBlcyc7CgogICAgLyoqCiAgICAgKiBXZWJHTCBjb29yZGluYXRlIHN5c3RlbS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSA9IDIwMDA7CgogICAgLyoqCiAgICAgKiBXZWJHUFUgY29vcmRpbmF0ZSBzeXN0ZW0uCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBXZWJHUFVDb29yZGluYXRlU3lzdGVtID0gMjAwMTsKCiAgICAvKioKICAgICAqIFRoaXMgdHlwZSByZXByZXNlbnRzIG1vdXNlIGJ1dHRvbnMgYW5kIGludGVyYWN0aW9uIHR5cGVzIGluIGNvbnRleHQgb2YgY29udHJvbHMuCiAgICAgKgogICAgICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzTW91c2UKICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBNSURETEUgLSBUaGUgbGVmdCBtb3VzZSBidXR0b24uCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gTEVGVCAtIFRoZSBtaWRkbGUgbW91c2UgYnV0dG9uLgogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFJJR0hUIC0gVGhlIHJpZ2h0IG1vdXNlIGJ1dHRvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBST1RBVEUgLSBBIHJvdGF0ZSBpbnRlcmFjdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBET0xMWSAtIEEgZG9sbHkgaW50ZXJhY3Rpb24uCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gUEFOIC0gQSBwYW4gaW50ZXJhY3Rpb24uCiAgICAgKiovCgogICAgLyoqCiAgICAgKiBUaGlzIHR5cGUgcmVwcmVzZW50cyB0b3VjaCBpbnRlcmFjdGlvbiB0eXBlcyBpbiBjb250ZXh0IG9mIGNvbnRyb2xzLgogICAgICoKICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnN0YW50c1RvdWNoCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gUk9UQVRFIC0gQSByb3RhdGUgaW50ZXJhY3Rpb24uCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gUEFOIC0gQSBwYW4gaW50ZXJhY3Rpb24uCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gRE9MTFlfUEFOIC0gVGhlIGRvbGx5LXBhbiBpbnRlcmFjdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBET0xMWV9ST1RBVEUgLSBBIGRvbGx5LXJvdGF0ZSBpbnRlcmFjdGlvbi4KICAgICAqKi8KCiAgICAvKioKICAgICAqIFRoaXMgdHlwZSByZXByZXNlbnRzIHRoZSBkaWZmZXJlbnQgdGltZXN0YW1wIHF1ZXJ5IHR5cGVzLgogICAgICoKICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnN0YW50c1RpbWVzdGFtcFF1ZXJ5CiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gQ09NUFVURSAtIEEgYGNvbXB1dGVgIHRpbWVzdGFtcCBxdWVyeS4KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBSRU5ERVIgLSBBIGByZW5kZXJgIHRpbWVzdGFtcCBxdWVyeS4KICAgICAqKi8KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCBpbnRlcnBvbGF0aW9uIHNhbXBsaW5nIHR5cGVzLgogICAgICoKICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnN0YW50c0ludGVycG9sYXRpb25TYW1wbGluZ1R5cGUKICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBQRVJTUEVDVElWRSAtIFBlcnNwZWN0aXZlLWNvcnJlY3QgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBMSU5FQVIgLSBMaW5lYXIgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBGTEFUIC0gRmxhdCBpbnRlcnBvbGF0aW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIHRoZSBkaWZmZXJlbnQgaW50ZXJwb2xhdGlvbiBzYW1wbGluZyBtb2Rlcy4KICAgICAqCiAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb25zdGFudHNJbnRlcnBvbGF0aW9uU2FtcGxpbmdNb2RlCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gTk9STUFMIC0gTm9ybWFsIHNhbXBsaW5nIG1vZGUuCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gQ0VOVFJPSUQgLSBDZW50cm9pZCBzYW1wbGluZyBtb2RlLgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFNBTVBMRSAtIFNhbXBsZS1zcGVjaWZpYyBzYW1wbGluZyBtb2RlLgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVRfRklSU1QgLSBGbGF0IGludGVycG9sYXRpb24gdXNpbmcgdGhlIGZpcnN0IHZlcnRleC4KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBGTEFUX0VJVEhFUiAtIEZsYXQgaW50ZXJwb2xhdGlvbiB1c2luZyBlaXRoZXIgdmVydGV4LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIG1vZHVsZXMgYWxsb3dzIHRvIGRpc3BhdGNoIGV2ZW50IG9iamVjdHMgb24gY3VzdG9tIEphdmFTY3JpcHQgb2JqZWN0cy4KICAgICAqCiAgICAgKiBNYWluIHJlcG9zaXRvcnk6IFtldmVudGRpc3BhdGNoZXIuanNde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvZXZlbnRkaXNwYXRjaGVyLmpzL30KICAgICAqCiAgICAgKiBDb2RlIEV4YW1wbGU6CiAgICAgKiBgYGBqcwogICAgICogY2xhc3MgQ2FyIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKICAgICAqIAlzdGFydCgpIHsKICAgICAqCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ3N0YXJ0JywgbWVzc2FnZTogJ3Zyb29tIHZyb29tIScgfSApOwogICAgICoJfQogICAgICp9OwogICAgICoKICAgICAqIC8vIFVzaW5nIGV2ZW50cyB3aXRoIHRoZSBjdXN0b20gb2JqZWN0CiAgICAgKiBjb25zdCBjYXIgPSBuZXcgQ2FyKCk7CiAgICAgKiBjYXIuYWRkRXZlbnRMaXN0ZW5lciggJ3N0YXJ0JywgZnVuY3Rpb24gKCBldmVudCApIHsKICAgICAqIAlhbGVydCggZXZlbnQubWVzc2FnZSApOwogICAgICogfSApOwogICAgICoKICAgICAqIGNhci5zdGFydCgpOwogICAgICogYGBgCiAgICAgKi8KICAgIGNsYXNzIEV2ZW50RGlzcGF0Y2hlciB7CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIGV2ZW50IGxpc3RlbmVyIHRvIHRoZSBnaXZlbiBldmVudCB0eXBlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudCB0byBsaXN0ZW4gdG8uCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgLSBUaGUgZnVuY3Rpb24gdGhhdCBnZXRzIGNhbGxlZCB3aGVuIHRoZSBldmVudCBpcyBmaXJlZC4KICAgIAkgKi8KICAgIAlhZGRFdmVudExpc3RlbmVyKCB0eXBlLCBsaXN0ZW5lciApIHsKCiAgICAJCWlmICggdGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKCiAgICAJCWNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAJCWlmICggbGlzdGVuZXJzWyB0eXBlIF0gPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlsaXN0ZW5lcnNbIHR5cGUgXSA9IFtdOwoKICAgIAkJfQoKICAgIAkJaWYgKCBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApID09PSAtMSApIHsKCiAgICAJCQlsaXN0ZW5lcnNbIHR5cGUgXS5wdXNoKCBsaXN0ZW5lciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBoYXMgYmVlbiBhZGRlZCB0byB0aGUgZ2l2ZW4gZXZlbnQgdHlwZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHR5cGUgb2YgZXZlbnQuCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgLSBUaGUgbGlzdGVuZXIgdG8gY2hlY2suCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gZXZlbnQgbGlzdGVuZXIgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIGdpdmVuIGV2ZW50IHR5cGUuCiAgICAJICovCiAgICAJaGFzRXZlbnRMaXN0ZW5lciggdHlwZSwgbGlzdGVuZXIgKSB7CgogICAgCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIGZhbHNlOwoKICAgIAkJcmV0dXJuIGxpc3RlbmVyc1sgdHlwZSBdICE9PSB1bmRlZmluZWQgJiYgbGlzdGVuZXJzWyB0eXBlIF0uaW5kZXhPZiggbGlzdGVuZXIgKSAhPT0gLTE7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVtb3ZlcyB0aGUgZ2l2ZW4gZXZlbnQgbGlzdGVuZXIgZnJvbSB0aGUgZ2l2ZW4gZXZlbnQgdHlwZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIHR5cGUgb2YgZXZlbnQuCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gbGlzdGVuZXIgLSBUaGUgbGlzdGVuZXIgdG8gcmVtb3ZlLgogICAgCSAqLwogICAgCXJlbW92ZUV2ZW50TGlzdGVuZXIoIHR5cGUsIGxpc3RlbmVyICkgewoKICAgIAkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgIAkJaWYgKCBsaXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCiAgICAJCWNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbIHR5cGUgXTsKCiAgICAJCWlmICggbGlzdGVuZXJBcnJheSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWNvbnN0IGluZGV4ID0gbGlzdGVuZXJBcnJheS5pbmRleE9mKCBsaXN0ZW5lciApOwoKICAgIAkJCWlmICggaW5kZXggIT09IC0xICkgewoKICAgIAkJCQlsaXN0ZW5lckFycmF5LnNwbGljZSggaW5kZXgsIDEgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGlzcGF0Y2hlcyBhbiBldmVudCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgLSBUaGUgZXZlbnQgdGhhdCBnZXRzIGZpcmVkLgogICAgCSAqLwogICAgCWRpc3BhdGNoRXZlbnQoIGV2ZW50ICkgewoKICAgIAkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgIAkJaWYgKCBsaXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCiAgICAJCWNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbIGV2ZW50LnR5cGUgXTsKCiAgICAJCWlmICggbGlzdGVuZXJBcnJheSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWV2ZW50LnRhcmdldCA9IHRoaXM7CgogICAgCQkJLy8gTWFrZSBhIGNvcHksIGluIGNhc2UgbGlzdGVuZXJzIGFyZSByZW1vdmVkIHdoaWxlIGl0ZXJhdGluZy4KICAgIAkJCWNvbnN0IGFycmF5ID0gbGlzdGVuZXJBcnJheS5zbGljZSggMCApOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCWFycmF5WyBpIF0uY2FsbCggdGhpcywgZXZlbnQgKTsKCiAgICAJCQl9CgogICAgCQkJZXZlbnQudGFyZ2V0ID0gbnVsbDsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfbHV0ID0gWyAnMDAnLCAnMDEnLCAnMDInLCAnMDMnLCAnMDQnLCAnMDUnLCAnMDYnLCAnMDcnLCAnMDgnLCAnMDknLCAnMGEnLCAnMGInLCAnMGMnLCAnMGQnLCAnMGUnLCAnMGYnLCAnMTAnLCAnMTEnLCAnMTInLCAnMTMnLCAnMTQnLCAnMTUnLCAnMTYnLCAnMTcnLCAnMTgnLCAnMTknLCAnMWEnLCAnMWInLCAnMWMnLCAnMWQnLCAnMWUnLCAnMWYnLCAnMjAnLCAnMjEnLCAnMjInLCAnMjMnLCAnMjQnLCAnMjUnLCAnMjYnLCAnMjcnLCAnMjgnLCAnMjknLCAnMmEnLCAnMmInLCAnMmMnLCAnMmQnLCAnMmUnLCAnMmYnLCAnMzAnLCAnMzEnLCAnMzInLCAnMzMnLCAnMzQnLCAnMzUnLCAnMzYnLCAnMzcnLCAnMzgnLCAnMzknLCAnM2EnLCAnM2InLCAnM2MnLCAnM2QnLCAnM2UnLCAnM2YnLCAnNDAnLCAnNDEnLCAnNDInLCAnNDMnLCAnNDQnLCAnNDUnLCAnNDYnLCAnNDcnLCAnNDgnLCAnNDknLCAnNGEnLCAnNGInLCAnNGMnLCAnNGQnLCAnNGUnLCAnNGYnLCAnNTAnLCAnNTEnLCAnNTInLCAnNTMnLCAnNTQnLCAnNTUnLCAnNTYnLCAnNTcnLCAnNTgnLCAnNTknLCAnNWEnLCAnNWInLCAnNWMnLCAnNWQnLCAnNWUnLCAnNWYnLCAnNjAnLCAnNjEnLCAnNjInLCAnNjMnLCAnNjQnLCAnNjUnLCAnNjYnLCAnNjcnLCAnNjgnLCAnNjknLCAnNmEnLCAnNmInLCAnNmMnLCAnNmQnLCAnNmUnLCAnNmYnLCAnNzAnLCAnNzEnLCAnNzInLCAnNzMnLCAnNzQnLCAnNzUnLCAnNzYnLCAnNzcnLCAnNzgnLCAnNzknLCAnN2EnLCAnN2InLCAnN2MnLCAnN2QnLCAnN2UnLCAnN2YnLCAnODAnLCAnODEnLCAnODInLCAnODMnLCAnODQnLCAnODUnLCAnODYnLCAnODcnLCAnODgnLCAnODknLCAnOGEnLCAnOGInLCAnOGMnLCAnOGQnLCAnOGUnLCAnOGYnLCAnOTAnLCAnOTEnLCAnOTInLCAnOTMnLCAnOTQnLCAnOTUnLCAnOTYnLCAnOTcnLCAnOTgnLCAnOTknLCAnOWEnLCAnOWInLCAnOWMnLCAnOWQnLCAnOWUnLCAnOWYnLCAnYTAnLCAnYTEnLCAnYTInLCAnYTMnLCAnYTQnLCAnYTUnLCAnYTYnLCAnYTcnLCAnYTgnLCAnYTknLCAnYWEnLCAnYWInLCAnYWMnLCAnYWQnLCAnYWUnLCAnYWYnLCAnYjAnLCAnYjEnLCAnYjInLCAnYjMnLCAnYjQnLCAnYjUnLCAnYjYnLCAnYjcnLCAnYjgnLCAnYjknLCAnYmEnLCAnYmInLCAnYmMnLCAnYmQnLCAnYmUnLCAnYmYnLCAnYzAnLCAnYzEnLCAnYzInLCAnYzMnLCAnYzQnLCAnYzUnLCAnYzYnLCAnYzcnLCAnYzgnLCAnYzknLCAnY2EnLCAnY2InLCAnY2MnLCAnY2QnLCAnY2UnLCAnY2YnLCAnZDAnLCAnZDEnLCAnZDInLCAnZDMnLCAnZDQnLCAnZDUnLCAnZDYnLCAnZDcnLCAnZDgnLCAnZDknLCAnZGEnLCAnZGInLCAnZGMnLCAnZGQnLCAnZGUnLCAnZGYnLCAnZTAnLCAnZTEnLCAnZTInLCAnZTMnLCAnZTQnLCAnZTUnLCAnZTYnLCAnZTcnLCAnZTgnLCAnZTknLCAnZWEnLCAnZWInLCAnZWMnLCAnZWQnLCAnZWUnLCAnZWYnLCAnZjAnLCAnZjEnLCAnZjInLCAnZjMnLCAnZjQnLCAnZjUnLCAnZjYnLCAnZjcnLCAnZjgnLCAnZjknLCAnZmEnLCAnZmInLCAnZmMnLCAnZmQnLCAnZmUnLCAnZmYnIF07CgoKICAgIGNvbnN0IERFRzJSQUQgPSBNYXRoLlBJIC8gMTgwOwogICAgY29uc3QgUkFEMkRFRyA9IDE4MCAvIE1hdGguUEk7CgogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhIFtVVUlEXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Vbml2ZXJzYWxseV91bmlxdWVfaWRlbnRpZmllcn0KICAgICAqICh1bml2ZXJzYWxseSB1bmlxdWUgaWRlbnRpZmllcikuCiAgICAgKgogICAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgVVVJRC4KICAgICAqLwogICAgZnVuY3Rpb24gZ2VuZXJhdGVVVUlEKCkgewoKICAgIAkvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTAzNC9ob3ctdG8tY3JlYXRlLWEtZ3VpZC11dWlkLWluLWphdmFzY3JpcHQvMjE5NjMxMzYjMjE5NjMxMzYKCiAgICAJY29uc3QgZDAgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7CiAgICAJY29uc3QgZDEgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7CiAgICAJY29uc3QgZDIgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7CiAgICAJY29uc3QgZDMgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7CiAgICAJY29uc3QgdXVpZCA9IF9sdXRbIGQwICYgMHhmZiBdICsgX2x1dFsgZDAgPj4gOCAmIDB4ZmYgXSArIF9sdXRbIGQwID4+IDE2ICYgMHhmZiBdICsgX2x1dFsgZDAgPj4gMjQgJiAweGZmIF0gKyAnLScgKwogICAgCQkJX2x1dFsgZDEgJiAweGZmIF0gKyBfbHV0WyBkMSA+PiA4ICYgMHhmZiBdICsgJy0nICsgX2x1dFsgZDEgPj4gMTYgJiAweDBmIHwgMHg0MCBdICsgX2x1dFsgZDEgPj4gMjQgJiAweGZmIF0gKyAnLScgKwogICAgCQkJX2x1dFsgZDIgJiAweDNmIHwgMHg4MCBdICsgX2x1dFsgZDIgPj4gOCAmIDB4ZmYgXSArICctJyArIF9sdXRbIGQyID4+IDE2ICYgMHhmZiBdICsgX2x1dFsgZDIgPj4gMjQgJiAweGZmIF0gKwogICAgCQkJX2x1dFsgZDMgJiAweGZmIF0gKyBfbHV0WyBkMyA+PiA4ICYgMHhmZiBdICsgX2x1dFsgZDMgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMyA+PiAyNCAmIDB4ZmYgXTsKCiAgICAJLy8gLnRvTG93ZXJDYXNlKCkgaGVyZSBmbGF0dGVucyBjb25jYXRlbmF0ZWQgc3RyaW5ncyB0byBzYXZlIGhlYXAgbWVtb3J5IHNwYWNlLgogICAgCXJldHVybiB1dWlkLnRvTG93ZXJDYXNlKCk7CgogICAgfQoKICAgIC8qKgogICAgICogQ2xhbXBzIHRoZSBnaXZlbiB2YWx1ZSBiZXR3ZWVuIG1pbiBhbmQgbWF4LgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBjbGFtcC4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtaW4gLSBUaGUgbWluIHZhbHVlLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG1heCAtIFRoZSBtYXggdmFsdWUuCiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBjbGFtcGVkIHZhbHVlLgogICAgICovCiAgICBmdW5jdGlvbiBjbGFtcCggdmFsdWUsIG1pbiwgbWF4ICkgewoKICAgIAlyZXR1cm4gTWF0aC5tYXgoIG1pbiwgTWF0aC5taW4oIG1heCwgdmFsdWUgKSApOwoKICAgIH0KCiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSBFdWNsaWRlYW4gbW9kdWxvIG9mIHRoZSBnaXZlbiBwYXJhbWV0ZXJzIHRoYXQKICAgICAqIGlzIGAoICggbiAlIG0gKSArIG0gKSAlIG1gLgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSBuIC0gVGhlIGZpcnN0IHBhcmFtZXRlci4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtIC0gVGhlIHNlY29uZCBwYXJhbWV0ZXIuCiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBFdWNsaWRlYW4gbW9kdWxvLgogICAgICovCiAgICBmdW5jdGlvbiBldWNsaWRlYW5Nb2R1bG8oIG4sIG0gKSB7CgogICAgCS8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL01vZHVsb19vcGVyYXRpb24KCiAgICAJcmV0dXJuICggKCBuICUgbSApICsgbSApICUgbTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgdmFsdWUgbGluZWFybHkgaW50ZXJwb2xhdGVkIGZyb20gdHdvIGtub3duIHBvaW50cyBiYXNlZCBvbiB0aGUgZ2l2ZW4gaW50ZXJ2YWwgLQogICAgICogYHQgPSAwYCB3aWxsIHJldHVybiBgeGAgYW5kIGB0ID0gMWAgd2lsbCByZXR1cm4gYHlgLgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHN0YXJ0IHBvaW50CiAgICAgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBlbmQgcG9pbnQuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgaW50ZXJwb2xhdGVkIHZhbHVlLgogICAgICovCiAgICBmdW5jdGlvbiBsZXJwKCB4LCB5LCB0ICkgewoKICAgIAlyZXR1cm4gKCAxIC0gdCApICogeCArIHQgKiB5OwoKICAgIH0KCiAgICAvKioKICAgICAqIERlbm9ybWFsaXplcyB0aGUgZ2l2ZW4gdmFsdWUgYWNjb3JkaW5nIHRvIHRoZSBnaXZlbiB0eXBlZCBhcnJheS4KICAgICAqCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gZGVub3JtYWxpemUuCiAgICAgKiBAcGFyYW0ge1R5cGVkQXJyYXl9IGFycmF5IC0gVGhlIHR5cGVkIGFycmF5IHRoYXQgZGVmaW5lcyB0aGUgZGF0YSB0eXBlIG9mIHRoZSB2YWx1ZS4KICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRlbm9ybWFsaXplIChmbG9hdCkgdmFsdWUgaW4gdGhlIHJhbmdlIGBbMCwxXWAuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGRlbm9ybWFsaXplKCB2YWx1ZSwgYXJyYXkgKSB7CgogICAgCXN3aXRjaCAoIGFycmF5LmNvbnN0cnVjdG9yICkgewoKICAgIAkJY2FzZSBGbG9hdDMyQXJyYXk6CgogICAgCQkJcmV0dXJuIHZhbHVlOwoKICAgIAkJY2FzZSBVaW50MzJBcnJheToKCiAgICAJCQlyZXR1cm4gdmFsdWUgLyA0Mjk0OTY3Mjk1LjA7CgogICAgCQljYXNlIFVpbnQxNkFycmF5OgoKICAgIAkJCXJldHVybiB2YWx1ZSAvIDY1NTM1LjA7CgogICAgCQljYXNlIFVpbnQ4QXJyYXk6CgogICAgCQkJcmV0dXJuIHZhbHVlIC8gMjU1LjA7CgogICAgCQljYXNlIEludDMyQXJyYXk6CgogICAgCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDIxNDc0ODM2NDcuMCwgLTEgKTsKCiAgICAJCWNhc2UgSW50MTZBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMzI3NjcuMCwgLTEgKTsKCiAgICAJCWNhc2UgSW50OEFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLm1heCggdmFsdWUgLyAxMjcuMCwgLTEgKTsKCiAgICAJCWRlZmF1bHQ6CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnSW52YWxpZCBjb21wb25lbnQgdHlwZS4nICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBOb3JtYWxpemVzIHRoZSBnaXZlbiB2YWx1ZSBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHR5cGVkIGFycmF5LgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSBmbG9hdCB2YWx1ZSBpbiB0aGUgcmFuZ2UgYFswLDFdYCB0byBub3JtYWxpemUuCiAgICAgKiBAcGFyYW0ge1R5cGVkQXJyYXl9IGFycmF5IC0gVGhlIHR5cGVkIGFycmF5IHRoYXQgZGVmaW5lcyB0aGUgZGF0YSB0eXBlIG9mIHRoZSB2YWx1ZS4KICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIG5vcm1hbGl6ZSB2YWx1ZS4KICAgICAqLwogICAgZnVuY3Rpb24gbm9ybWFsaXplJDMoIHZhbHVlLCBhcnJheSApIHsKCiAgICAJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgogICAgCQljYXNlIEZsb2F0MzJBcnJheToKCiAgICAJCQlyZXR1cm4gdmFsdWU7CgogICAgCQljYXNlIFVpbnQzMkFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDQyOTQ5NjcyOTUuMCApOwoKICAgIAkJY2FzZSBVaW50MTZBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiA2NTUzNS4wICk7CgogICAgCQljYXNlIFVpbnQ4QXJyYXk6CgogICAgCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogMjU1LjAgKTsKCiAgICAJCWNhc2UgSW50MzJBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAyMTQ3NDgzNjQ3LjAgKTsKCiAgICAJCWNhc2UgSW50MTZBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAzMjc2Ny4wICk7CgogICAgCQljYXNlIEludDhBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAxMjcuMCApOwoKICAgIAkJZGVmYXVsdDoKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENsYXNzIHJlcHJlc2VudGluZyBhIDJEIHZlY3Rvci4gQSAyRCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCBwYWlyIG9mIG51bWJlcnMKICAgICAqIChsYWJlbGVkIHggYW5kIHkpLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgogICAgICoKICAgICAqIC0gQSBwb2ludCBpbiAyRCBzcGFjZSAoaS5lLiBhIHBvc2l0aW9uIG9uIGEgcGxhbmUpLgogICAgICogLSBBIGRpcmVjdGlvbiBhbmQgbGVuZ3RoIGFjcm9zcyBhIHBsYW5lLiBJbiB0aHJlZS5qcyB0aGUgbGVuZ3RoIHdpbGwKICAgICAqIGFsd2F5cyBiZSB0aGUgRXVjbGlkZWFuIGRpc3RhbmNlKHN0cmFpZ2h0LWxpbmUgZGlzdGFuY2UpIGZyb20gYCgwLCAwKWAgdG8gYCh4LCB5KWAKICAgICAqIGFuZCB0aGUgZGlyZWN0aW9uIGlzIGFsc28gbWVhc3VyZWQgZnJvbSBgKDAsIDApYCB0b3dhcmRzIGAoeCwgeSlgLgogICAgICogLSBBbnkgYXJiaXRyYXJ5IG9yZGVyZWQgcGFpciBvZiBudW1iZXJzLgogICAgICoKICAgICAqIFRoZXJlIGFyZSBvdGhlciB0aGluZ3MgYSAyRCB2ZWN0b3IgY2FuIGJlIHVzZWQgdG8gcmVwcmVzZW50LCBzdWNoIGFzCiAgICAgKiBtb21lbnR1bSB2ZWN0b3JzLCBjb21wbGV4IG51bWJlcnMgYW5kIHNvIG9uLCBob3dldmVyIHRoZXNlIGFyZSB0aGUgbW9zdAogICAgICogY29tbW9uIHVzZXMgaW4gdGhyZWUuanMuCiAgICAgKgogICAgICogSXRlcmF0aW5nIHRocm91Z2ggYSB2ZWN0b3IgaW5zdGFuY2Ugd2lsbCB5aWVsZCBpdHMgY29tcG9uZW50cyBgKHgsIHkpYCBpbgogICAgICogdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgYSA9IG5ldyBUSFJFRS5WZWN0b3IyKCAwLCAxICk7CiAgICAgKgogICAgICogLy9ubyBhcmd1bWVudHM7IHdpbGwgYmUgaW5pdGlhbGlzZWQgdG8gKDAsIDApCiAgICAgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjIoICk7CiAgICAgKgogICAgICogY29uc3QgZCA9IGEuZGlzdGFuY2VUbyggYiApOwogICAgICogYGBgCiAgICAgKi8KICAgIGNsYXNzIFZlY3RvcjIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IDJEIHZlY3Rvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbeD0wXSAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbeT0wXSAtIFRoZSB5IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJVmVjdG9yMi5wcm90b3R5cGUuaXNWZWN0b3IyID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMueCA9IHg7CgogICAgCQkvKioKICAgIAkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLnkgPSB5OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFsaWFzIGZvciB7QGxpbmsgVmVjdG9yMiN4fS4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICovCiAgICAJZ2V0IHdpZHRoKCkgewoKICAgIAkJcmV0dXJuIHRoaXMueDsKCiAgICAJfQoKICAgIAlzZXQgd2lkdGgoIHZhbHVlICkgewoKICAgIAkJdGhpcy54ID0gdmFsdWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3IyI3l9LgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKi8KICAgIAlnZXQgaGVpZ2h0KCkgewoKICAgIAkJcmV0dXJuIHRoaXMueTsKCiAgICAJfQoKICAgIAlzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCiAgICAJCXRoaXMueSA9IHZhbHVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXQoIHgsIHkgKSB7CgogICAgCQl0aGlzLnggPSB4OwogICAgCQl0aGlzLnkgPSB5OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHNhbWUgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHZhbHVlIHRvIHNldCBmb3IgYWxsIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFNjYWxhciggc2NhbGFyICkgewoKICAgIAkJdGhpcy54ID0gc2NhbGFyOwogICAgCQl0aGlzLnkgPSBzY2FsYXI7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IncyB4IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRYKCB4ICkgewoKICAgIAkJdGhpcy54ID0geDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHkgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFkoIHkgKSB7CgogICAgCQl0aGlzLnkgPSB5OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxsb3dzIHRvIHNldCBhIHZlY3RvciBjb21wb25lbnQgd2l0aCBhbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgogICAgCQlzd2l0Y2ggKCBpbmRleCApIHsKCiAgICAJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKICAgIAkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwogICAgCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSB2ZWN0b3IgY29tcG9uZW50IHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbXBvbmVudCBpbmRleC4gYDBgIGVxdWFscyB0byB4LCBgMWAgZXF1YWxzIHRvIHkuCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBBIHZlY3RvciBjb21wb25lbnQgdmFsdWUuCiAgICAJICovCiAgICAJZ2V0Q29tcG9uZW50KCBpbmRleCApIHsKCiAgICAJCXN3aXRjaCAoIGluZGV4ICkgewoKICAgIAkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKICAgIAkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKICAgIAkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyB2ZWN0b3Igd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY29weSggdiApIHsKCiAgICAJCXRoaXMueCA9IHYueDsKICAgIAkJdGhpcy55ID0gdi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGFkZC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhZGQoIHYgKSB7CgogICAgCQl0aGlzLnggKz0gdi54OwogICAgCQl0aGlzLnkgKz0gdi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFNjYWxhciggcyApIHsKCiAgICAJCXRoaXMueCArPSBzOwogICAgCQl0aGlzLnkgKz0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQl0aGlzLnggPSBhLnggKyBiLng7CiAgICAJCXRoaXMueSA9IGEueSArIGIueTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciBzY2FsZWQgYnkgdGhlIGdpdmVuIGZhY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBmYWN0b3IgdGhhdCBzY2FsZXMgYHZgLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCiAgICAJCXRoaXMueCArPSB2LnggKiBzOwogICAgCQl0aGlzLnkgKz0gdi55ICogczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gc3VidHJhY3QuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc3ViKCB2ICkgewoKICAgIAkJdGhpcy54IC09IHYueDsKICAgIAkJdGhpcy55IC09IHYueTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIGZyb20gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBzdWJ0cmFjdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzdWJTY2FsYXIoIHMgKSB7CgogICAgCQl0aGlzLnggLT0gczsKICAgIAkJdGhpcy55IC09IHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQl0aGlzLnggPSBhLnggLSBiLng7CiAgICAJCXRoaXMueSA9IGEueSAtIGIueTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIG11bHRpcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW11bHRpcGx5KCB2ICkgewoKICAgIAkJdGhpcy54ICo9IHYueDsKICAgIAkJdGhpcy55ICo9IHYueTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKICAgIAkJdGhpcy54ICo9IHNjYWxhcjsKICAgIAkJdGhpcy55ICo9IHNjYWxhcjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZGl2aWRlKCB2ICkgewoKICAgIAkJdGhpcy54IC89IHYueDsKICAgIAkJdGhpcy55IC89IHYueTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGlzIHZlY3RvciAod2l0aCBhbiBpbXBsaWNpdCAxIGFzIHRoZSAzcmQgY29tcG9uZW50KSBieQogICAgCSAqIHRoZSBnaXZlbiAzeDMgbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhcHBseU1hdHJpeDMoIG0gKSB7CgogICAgCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55OwogICAgCQljb25zdCBlID0gbS5lbGVtZW50czsKCiAgICAJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyAzIF0gKiB5ICsgZVsgNiBdOwogICAgCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCBvciB5IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgZ2l2ZW4gdmVjdG9yJ3MgeCBvciB5CiAgICAJICogdmFsdWUsIHJlcGxhY2UgdGhhdCB2YWx1ZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIG1pbiB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbWluKCB2ICkgewoKICAgIAkJdGhpcy54ID0gTWF0aC5taW4oIHRoaXMueCwgdi54ICk7CiAgICAJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4IG9yIHkKICAgIAkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltYXgoIHYgKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2ZWN0b3IncyB4IG9yIHkKICAgIAkgKiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmVjdG9yJ3MgeCBvciB5IHZhbHVlLAogICAgCSAqIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSBtaW4gLSBUaGUgbWluaW11bSB4IGFuZCB5IHZhbHVlcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1heCAtIFRoZSBtYXhpbXVtIHggYW5kIHkgdmFsdWVzIGluIHRoZSBkZXNpcmVkIHJhbmdlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNsYW1wKCBtaW4sIG1heCApIHsKCiAgICAJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgogICAgCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW4ueCwgbWF4LnggKTsKICAgIAkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluLnksIG1heC55ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZXMgYXJlIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCB0aGV5IGFyZQogICAgCSAqIHJlcGxhY2VkIGJ5IHRoZSBtYXggdmFsdWUuCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWVzIGFyZSBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgdGhleSBhcmUKICAgIAkgKiByZXBsYWNlZCBieSB0aGUgbWluIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1pblZhbCAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWF4VmFsIC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNsYW1wU2NhbGFyKCBtaW5WYWwsIG1heFZhbCApIHsKCiAgICAJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pblZhbCwgbWF4VmFsICk7CiAgICAJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pblZhbCwgbWF4VmFsICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkKICAgIAkgKiB0aGUgbWF4IHZhbHVlLgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUKICAgIAkgKiBtaW4gdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWluIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXggLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKICAgIAkJY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCiAgICAJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggY2xhbXAoIGxlbmd0aCwgbWluLCBtYXggKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWZsb29yKCkgewoKICAgIAkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNlaWwoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcm91bmQoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0b3dhcmRzIHplcm8gKHVwIGlmIG5lZ2F0aXZlLAogICAgCSAqIGRvd24gaWYgcG9zaXRpdmUpIHRvIGFuIGludGVnZXIgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyb3VuZFRvWmVybygpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLnRydW5jKCB0aGlzLnkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludmVydHMgdGhpcyB2ZWN0b3IgLSBpLmUuIHNldHMgeCA9IC14IGFuZCB5ID0gLXkuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAluZWdhdGUoKSB7CgogICAgCQl0aGlzLnggPSAtIHRoaXMueDsKICAgIAkJdGhpcy55ID0gLSB0aGlzLnk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgZG90IHByb2R1Y3Qgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgdGhlIGRvdCBwcm9kdWN0LgogICAgCSAqLwogICAgCWRvdCggdiApIHsKCiAgICAJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2Lnk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2FsY3VsYXRlcyB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgY3Jvc3MgcHJvZHVjdCB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgY3Jvc3MgcHJvZHVjdC4KICAgIAkgKi8KICAgIAljcm9zcyggdiApIHsKCiAgICAJCXJldHVybiB0aGlzLnggKiB2LnkgLSB0aGlzLnkgKiB2Lng7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHNxdWFyZSBvZiB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIGZyb20KICAgIAkgKiAoMCwgMCkgdG8gKHgsIHkpLiBJZiB5b3UgYXJlIGNvbXBhcmluZyB0aGUgbGVuZ3RocyBvZiB2ZWN0b3JzLCB5b3Ugc2hvdWxkCiAgICAJICogY29tcGFyZSB0aGUgbGVuZ3RoIHNxdWFyZWQgaW5zdGVhZCBhcyBpdCBpcyBzbGlnaHRseSBtb3JlIGVmZmljaWVudCB0byBjYWxjdWxhdGUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlbmd0aFNxKCkgewoKICAgIAkJcmV0dXJuIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tICgwLCAwKSB0byAoeCwgeSkuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbWFuaGF0dGFuTGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGlzIHZlY3RvciB0byBhIHVuaXQgdmVjdG9yIC0gdGhhdCBpcywgc2V0cyBpdCBlcXVhbCB0byBhIHZlY3RvcgogICAgCSAqIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQgd2l0aCBhIHZlY3RvciBsZW5ndGggb2YgYDFgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbm9ybWFsaXplKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgYW5nbGUgaW4gcmFkaWFucyBvZiB0aGlzIHZlY3RvciB3aXRoIHJlc3BlY3QgdG8gdGhlIHBvc2l0aXZlIHgtYXhpcy4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICovCiAgICAJYW5nbGUoKSB7CgogICAgCQljb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoIC0gdGhpcy55LCAtIHRoaXMueCApICsgTWF0aC5QSTsKCiAgICAJCXJldHVybiBhbmdsZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UgaW4gcmFkaWFucy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgYW5nbGUgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqLwogICAgCWFuZ2xlVG8oIHYgKSB7CgogICAgCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgogICAgCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKICAgIAkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgogICAgCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKICAgIAkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtMSwgMSApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvKCB2ICkgewoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICogSWYgeW91IGFyZSBqdXN0IGNvbXBhcmluZyB0aGUgZGlzdGFuY2Ugd2l0aCBhbm90aGVyIGRpc3RhbmNlLCB5b3Ugc2hvdWxkIGNvbXBhcmUKICAgIAkgKiB0aGUgZGlzdGFuY2Ugc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgc3F1YXJlZCBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKICAgIAkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55OwogICAgCQlyZXR1cm4gZHggKiBkeCArIGR5ICogZHk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIE1hbmhhdHRhbiBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKICAgIAkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdmVjdG9yIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQKICAgIAkgKiB3aXRoIHRoZSBzcGVjaWZpZWQgbGVuZ3RoLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCAtIFRoZSBuZXcgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldExlbmd0aCggbGVuZ3RoICkgewoKICAgIAkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UsIHdoZXJlCiAgICAJICogYWxwaGEgaXMgdGhlIHBlcmNlbnQgZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgLSBhbHBoYSA9IDAgd2lsbCBiZSB0aGlzCiAgICAJICogdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwgYmUgdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gaW50ZXJwb2xhdGUgdG93YXJkcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlcnAoIHYsIGFscGhhICkgewoKICAgIAkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKICAgIAkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3JzLCB3aGVyZSBhbHBoYSBpcyB0aGUgcGVyY2VudAogICAgCSAqIGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgZmlyc3QgdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwKICAgIAkgKiBiZSB0aGUgc2Vjb25kIG9uZS4gVGhlIHJlc3VsdCBpcyBzdG9yZWQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdjEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdjIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKICAgIAkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwogICAgCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggdiApIHsKCiAgICAJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdmVjdG9yJ3MgeCB2YWx1ZSB0byBiZSBgYXJyYXlbIG9mZnNldCBdYCBhbmQgeQogICAgCSAqIHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMSBdYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKICAgIAkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAogICAgCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgogICAgCQlyZXR1cm4gYXJyYXk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKICAgIAkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CiAgICAJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGlzIHZlY3RvciBhcm91bmQgdGhlIGdpdmVuIGNlbnRlciBieSB0aGUgZ2l2ZW4gYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGNlbnRlciAtIFRoZSBwb2ludCBhcm91bmQgd2hpY2ggdG8gcm90YXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSB0byByb3RhdGUsIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcm90YXRlQXJvdW5kKCBjZW50ZXIsIGFuZ2xlICkgewoKICAgIAkJY29uc3QgYyA9IE1hdGguY29zKCBhbmdsZSApLCBzID0gTWF0aC5zaW4oIGFuZ2xlICk7CgogICAgCQljb25zdCB4ID0gdGhpcy54IC0gY2VudGVyLng7CiAgICAJCWNvbnN0IHkgPSB0aGlzLnkgLSBjZW50ZXIueTsKCiAgICAJCXRoaXMueCA9IHggKiBjIC0geSAqIHMgKyBjZW50ZXIueDsKICAgIAkJdGhpcy55ID0geCAqIHMgKyB5ICogYyArIGNlbnRlci55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyBlYWNoIGNvbXBvbmVudCBvZiB0aGlzIHZlY3RvciB0byBhIHBzZXVkby1yYW5kb20gdmFsdWUgYmV0d2VlbiBgMGAgYW5kCiAgICAJICogYDFgLCBleGNsdWRpbmcgYDFgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcmFuZG9tKCkgewoKICAgIAkJdGhpcy54ID0gTWF0aC5yYW5kb20oKTsKICAgIAkJdGhpcy55ID0gTWF0aC5yYW5kb20oKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKICAgIAkJeWllbGQgdGhpcy54OwogICAgCQl5aWVsZCB0aGlzLnk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgUXVhdGVybmlvbi4gUXVhdGVybmlvbnMgYXJlIHVzZWQgaW4gdGhyZWUuanMgdG8gcmVwcmVzZW50IHJvdGF0aW9ucy4KICAgICAqCiAgICAgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeiwgdylgIGluCiAgICAgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KICAgICAqCiAgICAgKiBOb3RlIHRoYXQgdGhyZWUuanMgZXhwZWN0cyBRdWF0ZXJuaW9ucyB0byBiZSBub3JtYWxpemVkLgogICAgICogYGBganMKICAgICAqIGNvbnN0IHF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpOwogICAgICogcXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBuZXcgVEhSRUUuVmVjdG9yMyggMCwgMSwgMCApLCBNYXRoLlBJIC8gMiApOwogICAgICoKICAgICAqIGNvbnN0IHZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAwLCAwICk7CiAgICAgKiB2ZWN0b3IuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ZXJuaW9uICk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgUXVhdGVybmlvbiB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgcXVhdGVybmlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbeD0wXSAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbdz0xXSAtIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCwgdyA9IDEgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1F1YXRlcm5pb24gPSB0cnVlOwoKICAgIAkJdGhpcy5feCA9IHg7CiAgICAJCXRoaXMuX3kgPSB5OwogICAgCQl0aGlzLl96ID0gejsKICAgIAkJdGhpcy5fdyA9IHc7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW50ZXJwb2xhdGVzIGJldHdlZW4gdHdvIHF1YXRlcm5pb25zIHZpYSBTTEVSUC4gVGhpcyBpbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZQogICAgCSAqIHF1YXRlcm5pb24gZGF0YSBhcmUgbWFuYWdlZCAgaW4gZmxhdCBhcnJheXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGRzdCAtIFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZHN0T2Zmc2V0IC0gQW4gb2Zmc2V0IGludG8gdGhlIGRlc3RpbmF0aW9uIGFycmF5LgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMCAtIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIGZpcnN0IHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNyY09mZnNldDAgLSBBbiBvZmZzZXQgaW50byB0aGUgZmlyc3Qgc291cmNlIGFycmF5LgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMSAtICBUaGUgc291cmNlIGFycmF5IG9mIHRoZSBzZWNvbmQgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MSAtIEFuIG9mZnNldCBpbnRvIHRoZSBzZWNvbmQgc291cmNlIGFycmF5LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSByYW5nZSBgWzAsMV1gLgogICAgCSAqIEBzZWUge0BsaW5rIFF1YXRlcm5pb24jc2xlcnB9CiAgICAJICovCiAgICAJc3RhdGljIHNsZXJwRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEsIHQgKSB7CgogICAgCQkvLyBmdXp6LWZyZWUsIGFycmF5LWJhc2VkIFF1YXRlcm5pb24gU0xFUlAgb3BlcmF0aW9uCgogICAgCQlsZXQgeDAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMCBdLAogICAgCQkJeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdLAogICAgCQkJejAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMiBdLAogICAgCQkJdzAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMyBdOwoKICAgIAkJY29uc3QgeDEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMCBdLAogICAgCQkJeTEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMSBdLAogICAgCQkJejEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMiBdLAogICAgCQkJdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKICAgIAkJaWYgKCB0ID09PSAwICkgewoKICAgIAkJCWRzdFsgZHN0T2Zmc2V0ICsgMCBdID0geDA7CiAgICAJCQlkc3RbIGRzdE9mZnNldCArIDEgXSA9IHkwOwogICAgCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MDsKICAgIAkJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQlpZiAoIHQgPT09IDEgKSB7CgogICAgCQkJZHN0WyBkc3RPZmZzZXQgKyAwIF0gPSB4MTsKICAgIAkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTE7CiAgICAJCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHoxOwogICAgCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MTsKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWlmICggdzAgIT09IHcxIHx8IHgwICE9PSB4MSB8fCB5MCAhPT0geTEgfHwgejAgIT09IHoxICkgewoKICAgIAkJCWxldCBzID0gMSAtIHQ7CiAgICAJCQljb25zdCBjb3MgPSB4MCAqIHgxICsgeTAgKiB5MSArIHowICogejEgKyB3MCAqIHcxLAogICAgCQkJCWRpciA9ICggY29zID49IDAgPyAxIDogLTEgKSwKICAgIAkJCQlzcXJTaW4gPSAxIC0gY29zICogY29zOwoKICAgIAkJCS8vIFNraXAgdGhlIFNsZXJwIGZvciB0aW55IHN0ZXBzIHRvIGF2b2lkIG51bWVyaWMgcHJvYmxlbXM6CiAgICAJCQlpZiAoIHNxclNpbiA+IE51bWJlci5FUFNJTE9OICkgewoKICAgIAkJCQljb25zdCBzaW4gPSBNYXRoLnNxcnQoIHNxclNpbiApLAogICAgCQkJCQlsZW4gPSBNYXRoLmF0YW4yKCBzaW4sIGNvcyAqIGRpciApOwoKICAgIAkJCQlzID0gTWF0aC5zaW4oIHMgKiBsZW4gKSAvIHNpbjsKICAgIAkJCQl0ID0gTWF0aC5zaW4oIHQgKiBsZW4gKSAvIHNpbjsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgdERpciA9IHQgKiBkaXI7CgogICAgCQkJeDAgPSB4MCAqIHMgKyB4MSAqIHREaXI7CiAgICAJCQl5MCA9IHkwICogcyArIHkxICogdERpcjsKICAgIAkJCXowID0gejAgKiBzICsgejEgKiB0RGlyOwogICAgCQkJdzAgPSB3MCAqIHMgKyB3MSAqIHREaXI7CgogICAgCQkJLy8gTm9ybWFsaXplIGluIGNhc2Ugd2UganVzdCBkaWQgYSBsZXJwOgogICAgCQkJaWYgKCBzID09PSAxIC0gdCApIHsKCiAgICAJCQkJY29uc3QgZiA9IDEgLyBNYXRoLnNxcnQoIHgwICogeDAgKyB5MCAqIHkwICsgejAgKiB6MCArIHcwICogdzAgKTsKCiAgICAJCQkJeDAgKj0gZjsKICAgIAkJCQl5MCAqPSBmOwogICAgCQkJCXowICo9IGY7CiAgICAJCQkJdzAgKj0gZjsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlkc3RbIGRzdE9mZnNldCBdID0geDA7CiAgICAJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTA7CiAgICAJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejA7CiAgICAJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0d28gcXVhdGVybmlvbnMuIFRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgcXVhdGVybmlvbiBkYXRhIGFyZSBtYW5hZ2VkCiAgICAJICogaW4gZmxhdCBhcnJheXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGRzdCAtIFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZHN0T2Zmc2V0IC0gQW4gb2Zmc2V0IGludG8gdGhlIGRlc3RpbmF0aW9uIGFycmF5LgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMCAtIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIGZpcnN0IHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNyY09mZnNldDAgLSBBbiBvZmZzZXQgaW50byB0aGUgZmlyc3Qgc291cmNlIGFycmF5LgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMSAtICBUaGUgc291cmNlIGFycmF5IG9mIHRoZSBzZWNvbmQgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MSAtIEFuIG9mZnNldCBpbnRvIHRoZSBzZWNvbmQgc291cmNlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KICAgIAkgKiBAc2VlIHtAbGluayBRdWF0ZXJuaW9uI211bHRpcGx5UXVhdGVybmlvbnN9LgogICAgCSAqLwogICAgCXN0YXRpYyBtdWx0aXBseVF1YXRlcm5pb25zRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEgKSB7CgogICAgCQljb25zdCB4MCA9IHNyYzBbIHNyY09mZnNldDAgXTsKICAgIAkJY29uc3QgeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdOwogICAgCQljb25zdCB6MCA9IHNyYzBbIHNyY09mZnNldDAgKyAyIF07CiAgICAJCWNvbnN0IHcwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDMgXTsKCiAgICAJCWNvbnN0IHgxID0gc3JjMVsgc3JjT2Zmc2V0MSBdOwogICAgCQljb25zdCB5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF07CiAgICAJCWNvbnN0IHoxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDIgXTsKICAgIAkJY29uc3QgdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKICAgIAkJZHN0WyBkc3RPZmZzZXQgXSA9IHgwICogdzEgKyB3MCAqIHgxICsgeTAgKiB6MSAtIHowICogeTE7CiAgICAJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTAgKiB3MSArIHcwICogeTEgKyB6MCAqIHgxIC0geDAgKiB6MTsKICAgIAkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MCAqIHcxICsgdzAgKiB6MSArIHgwICogeTEgLSB5MCAqIHgxOwogICAgCQlkc3RbIGRzdE9mZnNldCArIDMgXSA9IHcwICogdzEgLSB4MCAqIHgxIC0geTAgKiB5MSAtIHowICogejE7CgogICAgCQlyZXR1cm4gZHN0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgMAogICAgCSAqLwogICAgCWdldCB4KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3g7CgogICAgCX0KCiAgICAJc2V0IHgoIHZhbHVlICkgewoKICAgIAkJdGhpcy5feCA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIHkgdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCAwCiAgICAJICovCiAgICAJZ2V0IHkoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5feTsKCiAgICAJfQoKICAgIAlzZXQgeSggdmFsdWUgKSB7CgogICAgCQl0aGlzLl95ID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICoKICAgIAkgKiBAdHlwZSB7bnVtYmVyfQogICAgCSAqIEBkZWZhdWx0IDAKICAgIAkgKi8KICAgIAlnZXQgeigpIHsKCiAgICAJCXJldHVybiB0aGlzLl96OwoKICAgIAl9CgogICAgCXNldCB6KCB2YWx1ZSApIHsKCiAgICAJCXRoaXMuX3ogPSB2YWx1ZTsKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgMQogICAgCSAqLwogICAgCWdldCB3KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3c7CgogICAgCX0KCiAgICAJc2V0IHcoIHZhbHVlICkgewoKICAgIAkJdGhpcy5fdyA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdyB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXNldCggeCwgeSwgeiwgdyApIHsKCiAgICAJCXRoaXMuX3ggPSB4OwogICAgCQl0aGlzLl95ID0geTsKICAgIAkJdGhpcy5feiA9IHo7CiAgICAJCXRoaXMuX3cgPSB3OwoKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyBxdWF0ZXJuaW9uIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX3cgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcXVhdGVybmlvbiB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHF1YXRlcm5pb24gdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJY29weSggcXVhdGVybmlvbiApIHsKCiAgICAJCXRoaXMuX3ggPSBxdWF0ZXJuaW9uLng7CiAgICAJCXRoaXMuX3kgPSBxdWF0ZXJuaW9uLnk7CiAgICAJCXRoaXMuX3ogPSBxdWF0ZXJuaW9uLno7CiAgICAJCXRoaXMuX3cgPSBxdWF0ZXJuaW9uLnc7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSByb3RhdGlvbiBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuCiAgICAJICogRXVsZXIgYW5nbGVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgYW5nbGVzLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZT10cnVlXSAtIFdoZXRoZXIgdGhlIGludGVybmFsIGBvbkNoYW5nZWAgY2FsbGJhY2sgc2hvdWxkIGJlIGV4ZWN1dGVkIG9yIG5vdC4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJc2V0RnJvbUV1bGVyKCBldWxlciwgdXBkYXRlID0gdHJ1ZSApIHsKCiAgICAJCWNvbnN0IHggPSBldWxlci5feCwgeSA9IGV1bGVyLl95LCB6ID0gZXVsZXIuX3osIG9yZGVyID0gZXVsZXIuX29yZGVyOwoKICAgIAkJLy8gaHR0cDovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLwogICAgCQkvLyAJMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMvCiAgICAJCS8vCWNvbnRlbnQvU3BpbkNhbGMubQoKICAgIAkJY29uc3QgY29zID0gTWF0aC5jb3M7CiAgICAJCWNvbnN0IHNpbiA9IE1hdGguc2luOwoKICAgIAkJY29uc3QgYzEgPSBjb3MoIHggLyAyICk7CiAgICAJCWNvbnN0IGMyID0gY29zKCB5IC8gMiApOwogICAgCQljb25zdCBjMyA9IGNvcyggeiAvIDIgKTsKCiAgICAJCWNvbnN0IHMxID0gc2luKCB4IC8gMiApOwogICAgCQljb25zdCBzMiA9IHNpbiggeSAvIDIgKTsKICAgIAkJY29uc3QgczMgPSBzaW4oIHogLyAyICk7CgogICAgCQlzd2l0Y2ggKCBvcmRlciApIHsKCiAgICAJCQljYXNlICdYWVonOgogICAgCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgIAkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWVhaJzoKICAgIAkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgIAkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1pYWSc6CiAgICAJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgIAkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlICdaWVgnOgogICAgCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgIAkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWVpYJzoKICAgIAkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgIAkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1haWSc6CiAgICAJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgIAkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgIAkJCQlicmVhazsKCiAgICAJCQlkZWZhdWx0OgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCiAgICAJCX0KCiAgICAJCWlmICggdXBkYXRlID09PSB0cnVlICkgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gZnJvbSB0aGUgZ2l2ZW4gYXhpcyBhbmQgYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgbm9ybWFsaXplZCBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlzZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCiAgICAJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9hbmdsZVRvUXVhdGVybmlvbi9pbmRleC5odG0KCiAgICAJCWNvbnN0IGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwgcyA9IE1hdGguc2luKCBoYWxmQW5nbGUgKTsKCiAgICAJCXRoaXMuX3ggPSBheGlzLnggKiBzOwogICAgCQl0aGlzLl95ID0gYXhpcy55ICogczsKICAgIAkJdGhpcy5feiA9IGF4aXMueiAqIHM7CiAgICAJCXRoaXMuX3cgPSBNYXRoLmNvcyggaGFsZkFuZ2xlICk7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiByb3RhdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBBIDR4NCBtYXRyaXggb2Ygd2hpY2ggdGhlIHVwcGVyIDN4MyBvZiBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLiB1bnNjYWxlZCkuCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApIHsKCiAgICAJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9tYXRyaXhUb1F1YXRlcm5pb24vaW5kZXguaHRtCgogICAgCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKICAgIAkJY29uc3QgdGUgPSBtLmVsZW1lbnRzLAoKICAgIAkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCiAgICAJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAogICAgCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF0sCgogICAgCQkJdHJhY2UgPSBtMTEgKyBtMjIgKyBtMzM7CgogICAgCQlpZiAoIHRyYWNlID4gMCApIHsKCiAgICAJCQljb25zdCBzID0gMC41IC8gTWF0aC5zcXJ0KCB0cmFjZSArIDEuMCApOwoKICAgIAkJCXRoaXMuX3cgPSAwLjI1IC8gczsKICAgIAkJCXRoaXMuX3ggPSAoIG0zMiAtIG0yMyApICogczsKICAgIAkJCXRoaXMuX3kgPSAoIG0xMyAtIG0zMSApICogczsKICAgIAkJCXRoaXMuX3ogPSAoIG0yMSAtIG0xMiApICogczsKCiAgICAJCX0gZWxzZSBpZiAoIG0xMSA+IG0yMiAmJiBtMTEgPiBtMzMgKSB7CgogICAgCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTExIC0gbTIyIC0gbTMzICk7CgogICAgCQkJdGhpcy5fdyA9ICggbTMyIC0gbTIzICkgLyBzOwogICAgCQkJdGhpcy5feCA9IDAuMjUgKiBzOwogICAgCQkJdGhpcy5feSA9ICggbTEyICsgbTIxICkgLyBzOwogICAgCQkJdGhpcy5feiA9ICggbTEzICsgbTMxICkgLyBzOwoKICAgIAkJfSBlbHNlIGlmICggbTIyID4gbTMzICkgewoKICAgIAkJCWNvbnN0IHMgPSAyLjAgKiBNYXRoLnNxcnQoIDEuMCArIG0yMiAtIG0xMSAtIG0zMyApOwoKICAgIAkJCXRoaXMuX3cgPSAoIG0xMyAtIG0zMSApIC8gczsKICAgIAkJCXRoaXMuX3ggPSAoIG0xMiArIG0yMSApIC8gczsKICAgIAkJCXRoaXMuX3kgPSAwLjI1ICogczsKICAgIAkJCXRoaXMuX3ogPSAoIG0yMyArIG0zMiApIC8gczsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTMzIC0gbTExIC0gbTIyICk7CgogICAgCQkJdGhpcy5fdyA9ICggbTIxIC0gbTEyICkgLyBzOwogICAgCQkJdGhpcy5feCA9ICggbTEzICsgbTMxICkgLyBzOwogICAgCQkJdGhpcy5feSA9ICggbTIzICsgbTMyICkgLyBzOwogICAgCQkJdGhpcy5feiA9IDAuMjUgKiBzOwoKICAgIAkJfQoKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gdG8gdGhlIHJvdGF0aW9uIHJlcXVpcmVkIHRvIHJvdGF0ZSB0aGUgZGlyZWN0aW9uIHZlY3RvcgogICAgCSAqIGB2RnJvbWAgdG8gdGhlIGRpcmVjdGlvbiB2ZWN0b3IgYHZUb2AuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZGcm9tIC0gVGhlIGZpcnN0IChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdlRvIC0gVGhlIHNlY29uZCAobm9ybWFsaXplZCkgZGlyZWN0aW9uIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJc2V0RnJvbVVuaXRWZWN0b3JzKCB2RnJvbSwgdlRvICkgewoKICAgIAkJLy8gYXNzdW1lcyBkaXJlY3Rpb24gdmVjdG9ycyB2RnJvbSBhbmQgdlRvIGFyZSBub3JtYWxpemVkCgogICAgCQlsZXQgciA9IHZGcm9tLmRvdCggdlRvICkgKyAxOwoKICAgIAkJaWYgKCByIDwgMWUtOCApIHsgLy8gdGhlIGVwc2lsb24gdmFsdWUgaGFzIGJlZW4gZGlzY3Vzc2VkIGluICMzMTI4NgoKICAgIAkJCS8vIHZGcm9tIGFuZCB2VG8gcG9pbnQgaW4gb3Bwb3NpdGUgZGlyZWN0aW9ucwoKICAgIAkJCXIgPSAwOwoKICAgIAkJCWlmICggTWF0aC5hYnMoIHZGcm9tLnggKSA+IE1hdGguYWJzKCB2RnJvbS56ICkgKSB7CgogICAgCQkJCXRoaXMuX3ggPSAtIHZGcm9tLnk7CiAgICAJCQkJdGhpcy5feSA9IHZGcm9tLng7CiAgICAJCQkJdGhpcy5feiA9IDA7CiAgICAJCQkJdGhpcy5fdyA9IHI7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJdGhpcy5feCA9IDA7CiAgICAJCQkJdGhpcy5feSA9IC0gdkZyb20uejsKICAgIAkJCQl0aGlzLl96ID0gdkZyb20ueTsKICAgIAkJCQl0aGlzLl93ID0gcjsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCS8vIGNyb3NzVmVjdG9ycyggdkZyb20sIHZUbyApOyAvLyBpbmxpbmVkIHRvIGF2b2lkIGN5Y2xpYyBkZXBlbmRlbmN5IG9uIFZlY3RvcjMKCiAgICAJCQl0aGlzLl94ID0gdkZyb20ueSAqIHZUby56IC0gdkZyb20ueiAqIHZUby55OwogICAgCQkJdGhpcy5feSA9IHZGcm9tLnogKiB2VG8ueCAtIHZGcm9tLnggKiB2VG8uejsKICAgIAkJCXRoaXMuX3ogPSB2RnJvbS54ICogdlRvLnkgLSB2RnJvbS55ICogdlRvLng7CiAgICAJCQl0aGlzLl93ID0gcjsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGFuZ2xlIGJldHdlZW4gdGhpcyBxdWF0ZXJuaW9uIGFuZCB0aGUgZ2l2ZW4gb25lIGluIHJhZGlhbnMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgcXVhdGVybmlvbiB0byBjb21wdXRlIHRoZSBhbmdsZSB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICovCiAgICAJYW5nbGVUbyggcSApIHsKCiAgICAJCXJldHVybiAyICogTWF0aC5hY29zKCBNYXRoLmFicyggY2xhbXAoIHRoaXMuZG90KCBxICksIC0xLCAxICkgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhpcyBxdWF0ZXJuaW9uIGJ5IGEgZ2l2ZW4gYW5ndWxhciBzdGVwIHRvIHRoZSBnaXZlbiBxdWF0ZXJuaW9uLgogICAgCSAqIFRoZSBtZXRob2QgZW5zdXJlcyB0aGF0IHRoZSBmaW5hbCBxdWF0ZXJuaW9uIHdpbGwgbm90IG92ZXJzaG9vdCBgcWAuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgdGFyZ2V0IHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN0ZXAgLSBUaGUgYW5ndWxhciBzdGVwIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXJvdGF0ZVRvd2FyZHMoIHEsIHN0ZXAgKSB7CgogICAgCQljb25zdCBhbmdsZSA9IHRoaXMuYW5nbGVUbyggcSApOwoKICAgIAkJaWYgKCBhbmdsZSA9PT0gMCApIHJldHVybiB0aGlzOwoKICAgIAkJY29uc3QgdCA9IE1hdGgubWluKCAxLCBzdGVwIC8gYW5nbGUgKTsKCiAgICAJCXRoaXMuc2xlcnAoIHEsIHQgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIHRoZSBpZGVudGl0eSBxdWF0ZXJuaW9uOyB0aGF0IGlzLCB0byB0aGUKICAgIAkgKiBxdWF0ZXJuaW9uIHRoYXQgcmVwcmVzZW50cyAibm8gcm90YXRpb24iLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCWlkZW50aXR5KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwLCAxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW52ZXJ0cyB0aGlzIHF1YXRlcm5pb24gdmlhIHtAbGluayBRdWF0ZXJuaW9uI2Nvbmp1Z2F0ZX0uIFRoZQogICAgCSAqIHF1YXRlcm5pb24gaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCWludmVydCgpIHsKCiAgICAJCXJldHVybiB0aGlzLmNvbmp1Z2F0ZSgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHJvdGF0aW9uYWwgY29uanVnYXRlIG9mIHRoaXMgcXVhdGVybmlvbi4gVGhlIGNvbmp1Z2F0ZSBvZiBhCiAgICAJICogcXVhdGVybmlvbiByZXByZXNlbnRzIHRoZSBzYW1lIHJvdGF0aW9uIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24gYWJvdXQKICAgIAkgKiB0aGUgcm90YXRpb25hbCBheGlzLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCWNvbmp1Z2F0ZSgpIHsKCiAgICAJCXRoaXMuX3ggKj0gLTE7CiAgICAJCXRoaXMuX3kgKj0gLTE7CiAgICAJCXRoaXMuX3ogKj0gLTE7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGlzIHF1YXRlcm5pb24gYW5kIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHYgLSBUaGUgcXVhdGVybmlvbiB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCiAgICAJICovCiAgICAJZG90KCB2ICkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3ggKiB2Ll94ICsgdGhpcy5feSAqIHYuX3kgKyB0aGlzLl96ICogdi5feiArIHRoaXMuX3cgKiB2Ll93OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBzcXVhcmVkIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBvZiB0aGlzIHF1YXRlcm5pb24sCiAgICAJICogY29uc2lkZXJlZCBhcyBhIDQgZGltZW5zaW9uYWwgdmVjdG9yLiBUaGlzIGNhbiBiZSB1c2VmdWwgaWYgeW91IGFyZSBjb21wYXJpbmcgdGhlCiAgICAJICogbGVuZ3RocyBvZiB0d28gcXVhdGVybmlvbnMsIGFzIHRoaXMgaXMgYSBzbGlnaHRseSBtb3JlIGVmZmljaWVudCBjYWxjdWxhdGlvbiB0aGFuCiAgICAJICoge0BsaW5rIFF1YXRlcm5pb24jbGVuZ3RofS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgRXVjbGlkZWFuIGxlbmd0aC4KICAgIAkgKi8KICAgIAlsZW5ndGhTcSgpIHsKCiAgICAJCXJldHVybiB0aGlzLl94ICogdGhpcy5feCArIHRoaXMuX3kgKiB0aGlzLl95ICsgdGhpcy5feiAqIHRoaXMuX3ogKyB0aGlzLl93ICogdGhpcy5fdzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIG9mIHRoaXMgcXVhdGVybmlvbiwKICAgIAkgKiBjb25zaWRlcmVkIGFzIGEgNCBkaW1lbnNpb25hbCB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBFdWNsaWRlYW4gbGVuZ3RoLgogICAgCSAqLwogICAgCWxlbmd0aCgpIHsKCiAgICAJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTm9ybWFsaXplcyB0aGlzIHF1YXRlcm5pb24gLSB0aGF0IGlzLCBjYWxjdWxhdGVkIHRoZSBxdWF0ZXJuaW9uIHRoYXQgcGVyZm9ybXMKICAgIAkgKiB0aGUgc2FtZSByb3RhdGlvbiBhcyB0aGlzIG9uZSwgYnV0IGhhcyBhIGxlbmd0aCBlcXVhbCB0byBgMWAuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJbm9ybWFsaXplKCkgewoKICAgIAkJbGV0IGwgPSB0aGlzLmxlbmd0aCgpOwoKICAgIAkJaWYgKCBsID09PSAwICkgewoKICAgIAkJCXRoaXMuX3ggPSAwOwogICAgCQkJdGhpcy5feSA9IDA7CiAgICAJCQl0aGlzLl96ID0gMDsKICAgIAkJCXRoaXMuX3cgPSAxOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlsID0gMSAvIGw7CgogICAgCQkJdGhpcy5feCA9IHRoaXMuX3ggKiBsOwogICAgCQkJdGhpcy5feSA9IHRoaXMuX3kgKiBsOwogICAgCQkJdGhpcy5feiA9IHRoaXMuX3ogKiBsOwogICAgCQkJdGhpcy5fdyA9IHRoaXMuX3cgKiBsOwoKICAgIAkJfQoKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGlzIHF1YXRlcm5pb24gYnkgdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAltdWx0aXBseSggcSApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHRoaXMsIHEgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQcmUtbXVsdGlwbGllcyB0aGlzIHF1YXRlcm5pb24gYnkgdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlwcmVtdWx0aXBseSggcSApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHEsIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoZSBnaXZlbiBxdWF0ZXJuaW9ucyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gYSAtIFRoZSBmaXJzdCBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gYiAtIFRoZSBzZWNvbmQgcXVhdGVybmlvbi4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJbXVsdGlwbHlRdWF0ZXJuaW9ucyggYSwgYiApIHsKCiAgICAJCS8vIGZyb20gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9jb2RlL2luZGV4Lmh0bQoKICAgIAkJY29uc3QgcWF4ID0gYS5feCwgcWF5ID0gYS5feSwgcWF6ID0gYS5feiwgcWF3ID0gYS5fdzsKICAgIAkJY29uc3QgcWJ4ID0gYi5feCwgcWJ5ID0gYi5feSwgcWJ6ID0gYi5feiwgcWJ3ID0gYi5fdzsKCiAgICAJCXRoaXMuX3ggPSBxYXggKiBxYncgKyBxYXcgKiBxYnggKyBxYXkgKiBxYnogLSBxYXogKiBxYnk7CiAgICAJCXRoaXMuX3kgPSBxYXkgKiBxYncgKyBxYXcgKiBxYnkgKyBxYXogKiBxYnggLSBxYXggKiBxYno7CiAgICAJCXRoaXMuX3ogPSBxYXogKiBxYncgKyBxYXcgKiBxYnogKyBxYXggKiBxYnkgLSBxYXkgKiBxYng7CiAgICAJCXRoaXMuX3cgPSBxYXcgKiBxYncgLSBxYXggKiBxYnggLSBxYXkgKiBxYnkgLSBxYXogKiBxYno7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHF1YXRlcm5pb25zLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYiAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlzbGVycCggcWIsIHQgKSB7CgogICAgCQlpZiAoIHQgPT09IDAgKSByZXR1cm4gdGhpczsKICAgIAkJaWYgKCB0ID09PSAxICkgcmV0dXJuIHRoaXMuY29weSggcWIgKTsKCiAgICAJCWNvbnN0IHggPSB0aGlzLl94LCB5ID0gdGhpcy5feSwgeiA9IHRoaXMuX3osIHcgPSB0aGlzLl93OwoKICAgIAkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9zbGVycC8KCiAgICAJCWxldCBjb3NIYWxmVGhldGEgPSB3ICogcWIuX3cgKyB4ICogcWIuX3ggKyB5ICogcWIuX3kgKyB6ICogcWIuX3o7CgogICAgCQlpZiAoIGNvc0hhbGZUaGV0YSA8IDAgKSB7CgogICAgCQkJdGhpcy5fdyA9IC0gcWIuX3c7CiAgICAJCQl0aGlzLl94ID0gLSBxYi5feDsKICAgIAkJCXRoaXMuX3kgPSAtIHFiLl95OwogICAgCQkJdGhpcy5feiA9IC0gcWIuX3o7CgogICAgCQkJY29zSGFsZlRoZXRhID0gLSBjb3NIYWxmVGhldGE7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMuY29weSggcWIgKTsKCiAgICAJCX0KCiAgICAJCWlmICggY29zSGFsZlRoZXRhID49IDEuMCApIHsKCiAgICAJCQl0aGlzLl93ID0gdzsKICAgIAkJCXRoaXMuX3ggPSB4OwogICAgCQkJdGhpcy5feSA9IHk7CiAgICAJCQl0aGlzLl96ID0gejsKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHNxclNpbkhhbGZUaGV0YSA9IDEuMCAtIGNvc0hhbGZUaGV0YSAqIGNvc0hhbGZUaGV0YTsKCiAgICAJCWlmICggc3FyU2luSGFsZlRoZXRhIDw9IE51bWJlci5FUFNJTE9OICkgewoKICAgIAkJCWNvbnN0IHMgPSAxIC0gdDsKICAgIAkJCXRoaXMuX3cgPSBzICogdyArIHQgKiB0aGlzLl93OwogICAgCQkJdGhpcy5feCA9IHMgKiB4ICsgdCAqIHRoaXMuX3g7CiAgICAJCQl0aGlzLl95ID0gcyAqIHkgKyB0ICogdGhpcy5feTsKICAgIAkJCXRoaXMuX3ogPSBzICogeiArIHQgKiB0aGlzLl96OwoKICAgIAkJCXRoaXMubm9ybWFsaXplKCk7IC8vIG5vcm1hbGl6ZSBjYWxscyBfb25DaGFuZ2VDYWxsYmFjaygpCgogICAgCQkJcmV0dXJuIHRoaXM7CgogICAgCQl9CgogICAgCQljb25zdCBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoIHNxclNpbkhhbGZUaGV0YSApOwogICAgCQljb25zdCBoYWxmVGhldGEgPSBNYXRoLmF0YW4yKCBzaW5IYWxmVGhldGEsIGNvc0hhbGZUaGV0YSApOwogICAgCQljb25zdCByYXRpb0EgPSBNYXRoLnNpbiggKCAxIC0gdCApICogaGFsZlRoZXRhICkgLyBzaW5IYWxmVGhldGEsCiAgICAJCQlyYXRpb0IgPSBNYXRoLnNpbiggdCAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhOwoKICAgIAkJdGhpcy5fdyA9ICggdyAqIHJhdGlvQSArIHRoaXMuX3cgKiByYXRpb0IgKTsKICAgIAkJdGhpcy5feCA9ICggeCAqIHJhdGlvQSArIHRoaXMuX3ggKiByYXRpb0IgKTsKICAgIAkJdGhpcy5feSA9ICggeSAqIHJhdGlvQSArIHRoaXMuX3kgKiByYXRpb0IgKTsKICAgIAkJdGhpcy5feiA9ICggeiAqIHJhdGlvQSArIHRoaXMuX3ogKiByYXRpb0IgKTsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFBlcmZvcm1zIGEgc3BoZXJpY2FsIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdGhlIGdpdmVuIHF1YXRlcm5pb25zCiAgICAJICogYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcWEgLSBUaGUgc291cmNlIHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYiAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlzbGVycFF1YXRlcm5pb25zKCBxYSwgcWIsIHQgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5jb3B5KCBxYSApLnNsZXJwKCBxYiwgdCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIGEgdW5pZm9ybWx5IHJhbmRvbSwgbm9ybWFsaXplZCBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXJhbmRvbSgpIHsKCiAgICAJCS8vIEtlbiBTaG9lbWFrZQogICAgCQkvLyBVbmlmb3JtIHJhbmRvbSByb3RhdGlvbnMKICAgIAkJLy8gRC4gS2lyaywgZWRpdG9yLCBHcmFwaGljcyBHZW1zIElJSSwgcGFnZXMgMTI0LTEzMi4gQWNhZGVtaWMgUHJlc3MsIE5ldyBZb3JrLCAxOTkyLgoKICAgIAkJY29uc3QgdGhldGExID0gMiAqIE1hdGguUEkgKiBNYXRoLnJhbmRvbSgpOwogICAgCQljb25zdCB0aGV0YTIgPSAyICogTWF0aC5QSSAqIE1hdGgucmFuZG9tKCk7CgogICAgCQljb25zdCB4MCA9IE1hdGgucmFuZG9tKCk7CiAgICAJCWNvbnN0IHIxID0gTWF0aC5zcXJ0KCAxIC0geDAgKTsKICAgIAkJY29uc3QgcjIgPSBNYXRoLnNxcnQoIHgwICk7CgogICAgCQlyZXR1cm4gdGhpcy5zZXQoCiAgICAJCQlyMSAqIE1hdGguc2luKCB0aGV0YTEgKSwKICAgIAkJCXIxICogTWF0aC5jb3MoIHRoZXRhMSApLAogICAgCQkJcjIgKiBNYXRoLnNpbiggdGhldGEyICksCiAgICAJCQlyMiAqIE1hdGguY29zKCB0aGV0YTIgKSwKICAgIAkJKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHF1YXRlcm5pb24gaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHF1YXRlcm5pb24gdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHF1YXRlcm5pb24gaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggcXVhdGVybmlvbiApIHsKCiAgICAJCXJldHVybiAoIHF1YXRlcm5pb24uX3ggPT09IHRoaXMuX3ggKSAmJiAoIHF1YXRlcm5pb24uX3kgPT09IHRoaXMuX3kgKSAmJiAoIHF1YXRlcm5pb24uX3ogPT09IHRoaXMuX3ogKSAmJiAoIHF1YXRlcm5pb24uX3cgPT09IHRoaXMuX3cgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbidzIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gYXJyYXkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGFycmF5IC0gQW4gYXJyYXkgaG9sZGluZyB0aGUgcXVhdGVybmlvbiBjb21wb25lbnQgdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCXRoaXMuX3ggPSBhcnJheVsgb2Zmc2V0IF07CiAgICAJCXRoaXMuX3kgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwogICAgCQl0aGlzLl96ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKICAgIAkJdGhpcy5fdyA9IGFycmF5WyBvZmZzZXQgKyAzIF07CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXcml0ZXMgdGhlIGNvbXBvbmVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHF1YXRlcm5pb24gY29tcG9uZW50cy4KICAgIAkgKi8KICAgIAl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKICAgIAkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuX3k7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fdzsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgcXVhdGVybmlvbiBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgogICAgCQl0aGlzLl94ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CiAgICAJCXRoaXMuX3kgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKICAgIAkJdGhpcy5feiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwogICAgCQl0aGlzLl93ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGlzIG1ldGhvZHMgZGVmaW5lcyB0aGUgc2VyaWFsaXphdGlvbiByZXN1bHQgb2YgdGhpcyBjbGFzcy4gUmV0dXJucyB0aGUKICAgIAkgKiBudW1lcmljYWwgZWxlbWVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIGluIGFuIGFycmF5IG9mIGZvcm1hdCBgW3gsIHksIHosIHddYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBzZXJpYWxpemVkIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJdG9KU09OKCkgewoKICAgIAkJcmV0dXJuIHRoaXMudG9BcnJheSgpOwoKICAgIAl9CgogICAgCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAlfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgogICAgCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKICAgIAkJeWllbGQgdGhpcy5feDsKICAgIAkJeWllbGQgdGhpcy5feTsKICAgIAkJeWllbGQgdGhpcy5fejsKICAgIAkJeWllbGQgdGhpcy5fdzsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENsYXNzIHJlcHJlc2VudGluZyBhIDNEIHZlY3Rvci4gQSAzRCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCB0cmlwbGV0IG9mIG51bWJlcnMKICAgICAqIChsYWJlbGVkIHgsIHkgYW5kIHopLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgogICAgICoKICAgICAqIC0gQSBwb2ludCBpbiAzRCBzcGFjZS4KICAgICAqIC0gQSBkaXJlY3Rpb24gYW5kIGxlbmd0aCBpbiAzRCBzcGFjZS4gSW4gdGhyZWUuanMgdGhlIGxlbmd0aCB3aWxsCiAgICAgKiBhbHdheXMgYmUgdGhlIEV1Y2xpZGVhbiBkaXN0YW5jZShzdHJhaWdodC1saW5lIGRpc3RhbmNlKSBmcm9tIGAoMCwgMCwgMClgIHRvIGAoeCwgeSwgeilgCiAgICAgKiBhbmQgdGhlIGRpcmVjdGlvbiBpcyBhbHNvIG1lYXN1cmVkIGZyb20gYCgwLCAwLCAwKWAgdG93YXJkcyBgKHgsIHksIHopYC4KICAgICAqIC0gQW55IGFyYml0cmFyeSBvcmRlcmVkIHRyaXBsZXQgb2YgbnVtYmVycy4KICAgICAqCiAgICAgKiBUaGVyZSBhcmUgb3RoZXIgdGhpbmdzIGEgM0QgdmVjdG9yIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCwgc3VjaCBhcwogICAgICogbW9tZW50dW0gdmVjdG9ycyBhbmQgc28gb24sIGhvd2V2ZXIgdGhlc2UgYXJlIHRoZSBtb3N0CiAgICAgKiBjb21tb24gdXNlcyBpbiB0aHJlZS5qcy4KICAgICAqCiAgICAgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeilgIGluCiAgICAgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBhID0gbmV3IFRIUkVFLlZlY3RvcjMoIDAsIDEsIDAgKTsKICAgICAqCiAgICAgKiAvL25vIGFyZ3VtZW50czsgd2lsbCBiZSBpbml0aWFsaXNlZCB0byAoMCwgMCwgMCkKICAgICAqIGNvbnN0IGIgPSBuZXcgVEhSRUUuVmVjdG9yMyggKTsKICAgICAqCiAgICAgKiBjb25zdCBkID0gYS5kaXN0YW5jZVRvKCBiICk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgVmVjdG9yMyB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgM0QgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJVmVjdG9yMy5wcm90b3R5cGUuaXNWZWN0b3IzID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMueCA9IHg7CgogICAgCQkvKioKICAgIAkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLnkgPSB5OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB6IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy56ID0gejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIG9mIHRoZSB4IGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSBvZiB0aGUgeSBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgb2YgdGhlIHogY29tcG9uZW50LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldCggeCwgeSwgeiApIHsKCiAgICAJCWlmICggeiA9PT0gdW5kZWZpbmVkICkgeiA9IHRoaXMuejsgLy8gc3ByaXRlLnNjYWxlLnNldCh4LHkpCgogICAgCQl0aGlzLnggPSB4OwogICAgCQl0aGlzLnkgPSB5OwogICAgCQl0aGlzLnogPSB6OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHNhbWUgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHZhbHVlIHRvIHNldCBmb3IgYWxsIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFNjYWxhciggc2NhbGFyICkgewoKICAgIAkJdGhpcy54ID0gc2NhbGFyOwogICAgCQl0aGlzLnkgPSBzY2FsYXI7CiAgICAJCXRoaXMueiA9IHNjYWxhcjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHggY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFgoIHggKSB7CgogICAgCQl0aGlzLnggPSB4OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yJ3MgeSBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0WSggeSApIHsKCiAgICAJCXRoaXMueSA9IHk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IncyB6IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRaKCB6ICkgewoKICAgIAkJdGhpcy56ID0gejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFsbG93cyB0byBzZXQgYSB2ZWN0b3IgY29tcG9uZW50IHdpdGggYW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwgYDJgIGVxdWFscyB0byB6LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgogICAgCQlzd2l0Y2ggKCBpbmRleCApIHsKCiAgICAJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKICAgIAkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwogICAgCQkJY2FzZSAyOiB0aGlzLnogPSB2YWx1ZTsgYnJlYWs7CiAgICAJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwgYDJgIGVxdWFscyB0byB6LgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gQSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlLgogICAgCSAqLwogICAgCWdldENvbXBvbmVudCggaW5kZXggKSB7CgogICAgCQlzd2l0Y2ggKCBpbmRleCApIHsKCiAgICAJCQljYXNlIDA6IHJldHVybiB0aGlzLng7CiAgICAJCQljYXNlIDE6IHJldHVybiB0aGlzLnk7CiAgICAJCQljYXNlIDI6IHJldHVybiB0aGlzLno7CiAgICAJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgdmVjdG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55LCB0aGlzLnogKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY29weSggdiApIHsKCiAgICAJCXRoaXMueCA9IHYueDsKICAgIAkJdGhpcy55ID0gdi55OwogICAgCQl0aGlzLnogPSB2Lno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gYWRkLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZCggdiApIHsKCiAgICAJCXRoaXMueCArPSB2Lng7CiAgICAJCXRoaXMueSArPSB2Lnk7CiAgICAJCXRoaXMueiArPSB2Lno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgdG8gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBhZGQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkU2NhbGFyKCBzICkgewoKICAgIAkJdGhpcy54ICs9IHM7CiAgICAJCXRoaXMueSArPSBzOwogICAgCQl0aGlzLnogKz0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQl0aGlzLnggPSBhLnggKyBiLng7CiAgICAJCXRoaXMueSA9IGEueSArIGIueTsKICAgIAkJdGhpcy56ID0gYS56ICsgYi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHNjYWxlZCBieSB0aGUgZ2l2ZW4gZmFjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN8VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgZmFjdG9yIHRoYXQgc2NhbGVzIGB2YC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgogICAgCQl0aGlzLnggKz0gdi54ICogczsKICAgIAkJdGhpcy55ICs9IHYueSAqIHM7CiAgICAJCXRoaXMueiArPSB2LnogKiBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiB2ZWN0b3IgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBzdWJ0cmFjdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzdWIoIHYgKSB7CgogICAgCQl0aGlzLnggLT0gdi54OwogICAgCQl0aGlzLnkgLT0gdi55OwogICAgCQl0aGlzLnogLT0gdi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgZnJvbSBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIHN1YnRyYWN0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXN1YlNjYWxhciggcyApIHsKCiAgICAJCXRoaXMueCAtPSBzOwogICAgCQl0aGlzLnkgLT0gczsKICAgIAkJdGhpcy56IC09IHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQl0aGlzLnggPSBhLnggLSBiLng7CiAgICAJCXRoaXMueSA9IGEueSAtIGIueTsKICAgIAkJdGhpcy56ID0gYS56IC0gYi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbXVsdGlwbHkoIHYgKSB7CgogICAgCQl0aGlzLnggKj0gdi54OwogICAgCQl0aGlzLnkgKj0gdi55OwogICAgCQl0aGlzLnogKj0gdi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHdpdGggYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIG11bHRpcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnggKj0gc2NhbGFyOwogICAgCQl0aGlzLnkgKj0gc2NhbGFyOwogICAgCQl0aGlzLnogKj0gc2NhbGFyOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbXVsdGlwbHlWZWN0b3JzKCBhLCBiICkgewoKICAgIAkJdGhpcy54ID0gYS54ICogYi54OwogICAgCQl0aGlzLnkgPSBhLnkgKiBiLnk7CiAgICAJCXRoaXMueiA9IGEueiAqIGIuejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgdGhlIGdpdmVuIEV1bGVyIHJvdGF0aW9uIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgYW5nbGVzLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5RXVsZXIoIGV1bGVyICkgewoKICAgIAkJcmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQ0LnNldEZyb21FdWxlciggZXVsZXIgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgYSByb3RhdGlvbiBzcGVjaWZpZWQgYnkgYW4gYXhpcyBhbmQgYW4gYW5nbGUgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBBIG5vcm1hbGl6ZWQgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgcm90YXRpb24gYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhcHBseUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uJDQuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gM3gzIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSAzeDMgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4MyggbSApIHsKCiAgICAJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF0gKiB6OwogICAgCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXSAqIHo7CiAgICAJCXRoaXMueiA9IGVbIDIgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOCBdICogejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIG5vcm1hbCBtYXRyaXggYW5kIG5vcm1hbGl6ZXMKICAgIAkgKiB0aGUgcmVzdWx0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG5vcm1hbCBtYXRyaXguCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYXBwbHlOb3JtYWxNYXRyaXgoIG0gKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDMoIG0gKS5ub3JtYWxpemUoKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoaXMgdmVjdG9yICh3aXRoIGFuIGltcGxpY2l0IDEgaW4gdGhlIDR0aCBkaW1lbnNpb24pIGJ5IG0sIGFuZAogICAgCSAqIGRpdmlkZXMgYnkgcGVyc3BlY3RpdmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIGFwcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbSApIHsKCiAgICAJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJY29uc3QgdyA9IDEgLyAoIGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICk7CgogICAgCQl0aGlzLnggPSAoIGVbIDAgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgOCBdICogeiArIGVbIDEyIF0gKSAqIHc7CiAgICAJCXRoaXMueSA9ICggZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSApICogdzsKICAgIAkJdGhpcy56ID0gKCBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSApICogdzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgdGhlIGdpdmVuIFF1YXRlcm5pb24gdG8gdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbi4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhcHBseVF1YXRlcm5pb24oIHEgKSB7CgogICAgCQkvLyBxdWF0ZXJuaW9uIHEgaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoCgogICAgCQljb25zdCB2eCA9IHRoaXMueCwgdnkgPSB0aGlzLnksIHZ6ID0gdGhpcy56OwogICAgCQljb25zdCBxeCA9IHEueCwgcXkgPSBxLnksIHF6ID0gcS56LCBxdyA9IHEudzsKCiAgICAJCS8vIHQgPSAyICogY3Jvc3MoIHEueHl6LCB2ICk7CiAgICAJCWNvbnN0IHR4ID0gMiAqICggcXkgKiB2eiAtIHF6ICogdnkgKTsKICAgIAkJY29uc3QgdHkgPSAyICogKCBxeiAqIHZ4IC0gcXggKiB2eiApOwogICAgCQljb25zdCB0eiA9IDIgKiAoIHF4ICogdnkgLSBxeSAqIHZ4ICk7CgogICAgCQkvLyB2ICsgcS53ICogdCArIGNyb3NzKCBxLnh5eiwgdCApOwogICAgCQl0aGlzLnggPSB2eCArIHF3ICogdHggKyBxeSAqIHR6IC0gcXogKiB0eTsKICAgIAkJdGhpcy55ID0gdnkgKyBxdyAqIHR5ICsgcXogKiB0eCAtIHF4ICogdHo7CiAgICAJCXRoaXMueiA9IHZ6ICsgcXcgKiB0eiArIHF4ICogdHkgLSBxeSAqIHR4OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJvamVjdHMgdGhpcyB2ZWN0b3IgZnJvbSB3b3JsZCBzcGFjZSBpbnRvIHRoZSBjYW1lcmEncyBub3JtYWxpemVkCiAgICAJICogZGV2aWNlIGNvb3JkaW5hdGUgKE5EQykgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlwcm9qZWN0KCBjYW1lcmEgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVW5wcm9qZWN0cyB0aGlzIHZlY3RvciBmcm9tIHRoZSBjYW1lcmEncyBub3JtYWxpemVkIGRldmljZSBjb29yZGluYXRlIChOREMpCiAgICAJICogc3BhY2UgaW50byB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXVucHJvamVjdCggY2FtZXJhICkgewoKICAgIAkJcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zZm9ybXMgdGhlIGRpcmVjdGlvbiBvZiB0aGlzIHZlY3RvciBieSBhIG1hdHJpeCAodGhlIHVwcGVyIGxlZnQgMyB4IDMKICAgIAkgKiBzdWJzZXQgb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXggYW5kIHRoZW4gbm9ybWFsaXplcyB0aGUgcmVzdWx0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAl0cmFuc2Zvcm1EaXJlY3Rpb24oIG0gKSB7CgogICAgCQkvLyBpbnB1dDogVEhSRUUuTWF0cml4NCBhZmZpbmUgbWF0cml4CiAgICAJCS8vIHZlY3RvciBpbnRlcnByZXRlZCBhcyBhIGRpcmVjdGlvbgoKICAgIAkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKICAgIAkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgogICAgCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHo7CiAgICAJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogejsKICAgIAkJdGhpcy56ID0gZVsgMiBdICogeCArIGVbIDYgXSAqIHkgKyBlWyAxMCBdICogejsKCiAgICAJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZGl2aWRlKCB2ICkgewoKICAgIAkJdGhpcy54IC89IHYueDsKICAgIAkJdGhpcy55IC89IHYueTsKICAgIAkJdGhpcy56IC89IHYuejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5IG9yIHoKICAgIAkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWluIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltaW4oIHYgKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5taW4oIHRoaXMueSwgdi55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgubWluKCB0aGlzLnosIHYueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5IG9yIHoKICAgIAkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltYXgoIHYgKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgubWF4KCB0aGlzLnosIHYueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmVjdG9yJ3MgeCwgeSBvciB6CiAgICAJICogdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZSwKICAgIAkgKiBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gbWluIC0gVGhlIG1pbmltdW0geCwgeSBhbmQgeiB2YWx1ZXMuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBtYXggLSBUaGUgbWF4aW11bSB4LCB5IGFuZCB6IHZhbHVlcyBpbiB0aGUgZGVzaXJlZCByYW5nZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljbGFtcCggbWluLCBtYXggKSB7CgogICAgCQkvLyBhc3N1bWVzIG1pbiA8IG1heCwgY29tcG9uZW50d2lzZQoKICAgIAkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluLngsIG1heC54ICk7CiAgICAJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pbi55LCBtYXgueSApOwogICAgCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW4ueiwgbWF4LnogKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlcyBhcmUgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIHRoZXkgYXJlCiAgICAJICogcmVwbGFjZWQgYnkgdGhlIG1heCB2YWx1ZS4KICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZXMgYXJlIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCB0aGV5IGFyZQogICAgCSAqIHJlcGxhY2VkIGJ5IHRoZSBtaW4gdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWluVmFsIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXhWYWwgLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKICAgIAkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluVmFsLCBtYXhWYWwgKTsKICAgIAkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluVmFsLCBtYXhWYWwgKTsKICAgIAkJdGhpcy56ID0gY2xhbXAoIHRoaXMueiwgbWluVmFsLCBtYXhWYWwgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieQogICAgCSAqIHRoZSBtYXggdmFsdWUuCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZQogICAgCSAqIG1pbiB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW4gLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1heCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljbGFtcExlbmd0aCggbWluLCBtYXggKSB7CgogICAgCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKICAgIAkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBjbGFtcCggbGVuZ3RoLCBtaW4sIG1heCApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZmxvb3IoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5mbG9vciggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGguZmxvb3IoIHRoaXMueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNlaWwoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwogICAgCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcm91bmQoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG93YXJkcyB6ZXJvICh1cCBpZiBuZWdhdGl2ZSwKICAgIAkgKiBkb3duIGlmIHBvc2l0aXZlKSB0byBhbiBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcm91bmRUb1plcm8oKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnRydW5jKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC50cnVuYyggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgudHJ1bmMoIHRoaXMueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW52ZXJ0cyB0aGlzIHZlY3RvciAtIGkuZS4gc2V0cyB4ID0gLXgsIHkgPSAteSBhbmQgeiA9IC16LgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbmVnYXRlKCkgewoKICAgIAkJdGhpcy54ID0gLSB0aGlzLng7CiAgICAJCXRoaXMueSA9IC0gdGhpcy55OwogICAgCQl0aGlzLnogPSAtIHRoaXMuejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCiAgICAJICovCiAgICAJZG90KCB2ICkgewoKICAgIAkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKCiAgICAJfQoKICAgIAkvLyBUT0RPIGxlbmd0aFNxdWFyZWQ/CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBzcXVhcmUgb2YgdGhlIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tCiAgICAJICogKDAsIDAsIDApIHRvICh4LCB5LCB6KS4gSWYgeW91IGFyZSBjb21wYXJpbmcgdGhlIGxlbmd0aHMgb2YgdmVjdG9ycywgeW91IHNob3VsZAogICAgCSAqIGNvbXBhcmUgdGhlIGxlbmd0aCBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZW5ndGhTcSgpIHsKCiAgICAJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLno7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlICBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbSAoMCwgMCwgMCkgdG8gKHgsIHksIHopLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlbmd0aCgpIHsKCiAgICAJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBNYW5oYXR0YW4gbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1hbmhhdHRhbkxlbmd0aCgpIHsKCiAgICAJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhpcyB2ZWN0b3IgdG8gYSB1bml0IHZlY3RvciAtIHRoYXQgaXMsIHNldHMgaXQgZXF1YWwgdG8gYSB2ZWN0b3IKICAgIAkgKiB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0IHdpdGggYSB2ZWN0b3IgbGVuZ3RoIG9mIGAxYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW5vcm1hbGl6ZSgpIHsKCiAgICAJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHZlY3RvciB0byBhIHZlY3RvciB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0CiAgICAJICogd2l0aCB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggLSBUaGUgbmV3IGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRMZW5ndGgoIGxlbmd0aCApIHsKCiAgICAJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9yIGFuZCB0aGlzIGluc3RhbmNlLCB3aGVyZQogICAgCSAqIGFscGhhIGlzIHRoZSBwZXJjZW50IGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgdGhpcwogICAgCSAqIHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsIGJlIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGludGVycG9sYXRlIHRvd2FyZHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZXJwKCB2LCBhbHBoYSApIHsKCiAgICAJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CiAgICAJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CiAgICAJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9ycywgd2hlcmUgYWxwaGEgaXMgdGhlIHBlcmNlbnQKICAgIAkgKiBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIGZpcnN0IHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsCiAgICAJICogYmUgdGhlIHNlY29uZCBvbmUuIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVGhlIGZpcnN0IHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYyIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCiAgICAJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKICAgIAkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwogICAgCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDYWxjdWxhdGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBjcm9zcyBwcm9kdWN0IHdpdGguCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHJlc3VsdCBvZiB0aGUgY3Jvc3MgcHJvZHVjdC4KICAgIAkgKi8KICAgIAljcm9zcyggdiApIHsKCiAgICAJCXJldHVybiB0aGlzLmNyb3NzVmVjdG9ycyggdGhpcywgdiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CiAgICAJICogaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY3Jvc3NWZWN0b3JzKCBhLCBiICkgewoKICAgIAkJY29uc3QgYXggPSBhLngsIGF5ID0gYS55LCBheiA9IGEuejsKICAgIAkJY29uc3QgYnggPSBiLngsIGJ5ID0gYi55LCBieiA9IGIuejsKCiAgICAJCXRoaXMueCA9IGF5ICogYnogLSBheiAqIGJ5OwogICAgCQl0aGlzLnkgPSBheiAqIGJ4IC0gYXggKiBiejsKICAgIAkJdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQcm9qZWN0cyB0aGlzIHZlY3RvciBvbnRvIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIHByb2plY3QgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcHJvamVjdE9uVmVjdG9yKCB2ICkgewoKICAgIAkJY29uc3QgZGVub21pbmF0b3IgPSB2Lmxlbmd0aFNxKCk7CgogICAgCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwICk7CgogICAgCQljb25zdCBzY2FsYXIgPSB2LmRvdCggdGhpcyApIC8gZGVub21pbmF0b3I7CgogICAgCQlyZXR1cm4gdGhpcy5jb3B5KCB2ICkubXVsdGlwbHlTY2FsYXIoIHNjYWxhciApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFByb2plY3RzIHRoaXMgdmVjdG9yIG9udG8gYSBwbGFuZSBieSBzdWJ0cmFjdGluZyB0aGlzCiAgICAJICogdmVjdG9yIHByb2plY3RlZCBvbnRvIHRoZSBwbGFuZSdzIG5vcm1hbCBmcm9tIHRoaXMgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwbGFuZU5vcm1hbCAtIFRoZSBwbGFuZSBub3JtYWwuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcHJvamVjdE9uUGxhbmUoIHBsYW5lTm9ybWFsICkgewoKICAgIAkJX3ZlY3RvciRjLmNvcHkoIHRoaXMgKS5wcm9qZWN0T25WZWN0b3IoIHBsYW5lTm9ybWFsICk7CgogICAgCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlZmxlY3RzIHRoaXMgdmVjdG9yIG9mZiBhIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGdpdmVuIG5vcm1hbCB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IG5vcm1hbCAtIFRoZSAobm9ybWFsaXplZCkgbm9ybWFsIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyZWZsZWN0KCBub3JtYWwgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYy5jb3B5KCBub3JtYWwgKS5tdWx0aXBseVNjYWxhciggMiAqIHRoaXMuZG90KCBub3JtYWwgKSApICk7CgogICAgCX0KICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UgaW4gcmFkaWFucy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgYW5nbGUgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqLwogICAgCWFuZ2xlVG8oIHYgKSB7CgogICAgCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgogICAgCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKICAgIAkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgogICAgCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKICAgIAkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtMSwgMSApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvKCB2ICkgewoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICogSWYgeW91IGFyZSBqdXN0IGNvbXBhcmluZyB0aGUgZGlzdGFuY2Ugd2l0aCBhbm90aGVyIGRpc3RhbmNlLCB5b3Ugc2hvdWxkIGNvbXBhcmUKICAgIAkgKiB0aGUgZGlzdGFuY2Ugc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgc3F1YXJlZCBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKICAgIAkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55LCBkeiA9IHRoaXMueiAtIHYuejsKCiAgICAJCXJldHVybiBkeCAqIGR4ICsgZHkgKiBkeSArIGR6ICogZHo7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIE1hbmhhdHRhbiBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKICAgIAkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKSArIE1hdGguYWJzKCB0aGlzLnogLSB2LnogKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBzcGhlcmljYWwgY29vcmRpbmF0ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyaWNhbH0gcyAtIFRoZSBzcGhlcmljYWwgY29vcmRpbmF0ZXMuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0RnJvbVNwaGVyaWNhbCggcyApIHsKCiAgICAJCXJldHVybiB0aGlzLnNldEZyb21TcGhlcmljYWxDb29yZHMoIHMucmFkaXVzLCBzLnBoaSwgcy50aGV0YSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIHNwaGVyaWNhbCBjb29yZGluYXRlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgLSBUaGUgcmFkaXVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBwaGkgLSBUaGUgcGhpIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHRoZXRhIC0gVGhlIHRoZXRhIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0RnJvbVNwaGVyaWNhbENvb3JkcyggcmFkaXVzLCBwaGksIHRoZXRhICkgewoKICAgIAkJY29uc3Qgc2luUGhpUmFkaXVzID0gTWF0aC5zaW4oIHBoaSApICogcmFkaXVzOwoKICAgIAkJdGhpcy54ID0gc2luUGhpUmFkaXVzICogTWF0aC5zaW4oIHRoZXRhICk7CiAgICAJCXRoaXMueSA9IE1hdGguY29zKCBwaGkgKSAqIHJhZGl1czsKICAgIAkJdGhpcy56ID0gc2luUGhpUmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBjeWxpbmRyaWNhbCBjb29yZGluYXRlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q3lsaW5kcmljYWx9IGMgLSBUaGUgY3lsaW5kcmljYWwgY29vcmRpbmF0ZXMuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0RnJvbUN5bGluZHJpY2FsKCBjICkgewoKICAgIAkJcmV0dXJuIHRoaXMuc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKCBjLnJhZGl1cywgYy50aGV0YSwgYy55ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gY3lsaW5kcmljYWwgY29vcmRpbmF0ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIC0gVGhlIHJhZGl1cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgdGhldGEgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IHZhbHVlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEZyb21DeWxpbmRyaWNhbENvb3JkcyggcmFkaXVzLCB0aGV0YSwgeSApIHsKCiAgICAJCXRoaXMueCA9IHJhZGl1cyAqIE1hdGguc2luKCB0aGV0YSApOwogICAgCQl0aGlzLnkgPSB5OwogICAgCQl0aGlzLnogPSByYWRpdXMgKiBNYXRoLmNvcyggdGhldGEgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBwb3NpdGlvbiBlbGVtZW50cyBvZiB0aGUKICAgIAkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgogICAgCQljb25zdCBlID0gbS5lbGVtZW50czsKCiAgICAJCXRoaXMueCA9IGVbIDEyIF07CiAgICAJCXRoaXMueSA9IGVbIDEzIF07CiAgICAJCXRoaXMueiA9IGVbIDE0IF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2NhbGUgZWxlbWVudHMgb2YgdGhlCiAgICAJICogZ2l2ZW4gdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIDR4NCBtYXRyaXguCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0RnJvbU1hdHJpeFNjYWxlKCBtICkgewoKICAgIAkJY29uc3Qgc3ggPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDAgKS5sZW5ndGgoKTsKICAgIAkJY29uc3Qgc3kgPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKICAgIAkJY29uc3Qgc3ogPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDIgKS5sZW5ndGgoKTsKCiAgICAJCXRoaXMueCA9IHN4OwogICAgCQl0aGlzLnkgPSBzeTsKICAgIAkJdGhpcy56ID0gc3o7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBzcGVjaWZpZWQgbWF0cml4IGNvbHVtbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb2x1bW4gaW5kZXguCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgaW5kZXggKSB7CgogICAgCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogNCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIHNwZWNpZmllZCBtYXRyaXggY29sdW1uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbHVtbiBpbmRleC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4M0NvbHVtbiggbSwgaW5kZXggKSB7CgogICAgCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogMyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIEV1bGVyIGFuZ2xlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7RXVsZXJ9IGUgLSBUaGUgRXVsZXIgYW5nbGVzIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tRXVsZXIoIGUgKSB7CgogICAgCQl0aGlzLnggPSBlLl94OwogICAgCQl0aGlzLnkgPSBlLl95OwogICAgCQl0aGlzLnogPSBlLl96OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgUkdCIGNvbXBvbmVudHMgb2YgdGhlCiAgICAJICogZ2l2ZW4gY29sb3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjIC0gVGhlIGNvbG9yIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tQ29sb3IoIGMgKSB7CgogICAgCQl0aGlzLnggPSBjLnI7CiAgICAJCXRoaXMueSA9IGMuZzsKICAgIAkJdGhpcy56ID0gYy5iOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIHYgKSB7CgogICAgCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyB2ZWN0b3IncyB4IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0IF1gLCB5IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMSBdYAogICAgCSAqIGFuZCB6IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMiBdYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKICAgIAkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKICAgIAkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAogICAgCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLno7CgogICAgCQlyZXR1cm4gYXJyYXk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKICAgIAkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CiAgICAJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwogICAgCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgZWFjaCBjb21wb25lbnQgb2YgdGhpcyB2ZWN0b3IgdG8gYSBwc2V1ZG8tcmFuZG9tIHZhbHVlIGJldHdlZW4gYDBgIGFuZAogICAgCSAqIGAxYCwgZXhjbHVkaW5nIGAxYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXJhbmRvbSgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgucmFuZG9tKCk7CiAgICAJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CiAgICAJCXRoaXMueiA9IE1hdGgucmFuZG9tKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdW5pZm9ybWx5IHJhbmRvbSBwb2ludCBvbiBhIHVuaXQgc3BoZXJlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcmFuZG9tRGlyZWN0aW9uKCkgewoKICAgIAkJLy8gaHR0cHM6Ly9tYXRod29ybGQud29sZnJhbS5jb20vU3BoZXJlUG9pbnRQaWNraW5nLmh0bWwKCiAgICAJCWNvbnN0IHRoZXRhID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOwogICAgCQljb25zdCB1ID0gTWF0aC5yYW5kb20oKSAqIDIgLSAxOwogICAgCQljb25zdCBjID0gTWF0aC5zcXJ0KCAxIC0gdSAqIHUgKTsKCiAgICAJCXRoaXMueCA9IGMgKiBNYXRoLmNvcyggdGhldGEgKTsKICAgIAkJdGhpcy55ID0gdTsKICAgIAkJdGhpcy56ID0gYyAqIE1hdGguc2luKCB0aGV0YSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgogICAgCQl5aWVsZCB0aGlzLng7CiAgICAJCXlpZWxkIHRoaXMueTsKICAgIAkJeWllbGQgdGhpcy56OwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF92ZWN0b3IkYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9xdWF0ZXJuaW9uJDQgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGEgM3gzIG1hdHJpeC4KICAgICAqCiAgICAgKiBBIE5vdGUgb24gUm93LU1ham9yIGFuZCBDb2x1bW4tTWFqb3IgT3JkZXJpbmc6CiAgICAgKgogICAgICogVGhlIGNvbnN0cnVjdG9yIGFuZCB7QGxpbmsgTWF0cml4MyNzZXR9IG1ldGhvZCB0YWtlIGFyZ3VtZW50cyBpbgogICAgICogW3Jvdy1tYWpvcl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUm93LV9hbmRfY29sdW1uLW1ham9yX29yZGVyI0NvbHVtbi1tYWpvcl9vcmRlcn0KICAgICAqIG9yZGVyLCB3aGlsZSBpbnRlcm5hbGx5IHRoZXkgYXJlIHN0b3JlZCBpbiB0aGUge0BsaW5rIE1hdHJpeDMjZWxlbWVudHN9IGFycmF5IGluIGNvbHVtbi1tYWpvciBvcmRlci4KICAgICAqIFRoaXMgbWVhbnMgdGhhdCBjYWxsaW5nOgogICAgICogYGBganMKICAgICAqIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWF0cml4KCk7CiAgICAgKiBtLnNldCggMTEsIDEyLCAxMywKICAgICAqICAgICAgICAyMSwgMjIsIDIzLAogICAgICogICAgICAgIDMxLCAzMiwgMzMgKTsKICAgICAqIGBgYAogICAgICogd2lsbCByZXN1bHQgaW4gdGhlIGVsZW1lbnRzIGFycmF5IGNvbnRhaW5pbmc6CiAgICAgKiBgYGBqcwogICAgICogbS5lbGVtZW50cyA9IFsgMTEsIDIxLCAzMSwKICAgICAqICAgICAgICAgICAgICAgIDEyLCAyMiwgMzIsCiAgICAgKiAgICAgICAgICAgICAgICAxMywgMjMsIDMzIF07CiAgICAgKiBgYGAKICAgICAqIGFuZCBpbnRlcm5hbGx5IGFsbCBjYWxjdWxhdGlvbnMgYXJlIHBlcmZvcm1lZCB1c2luZyBjb2x1bW4tbWFqb3Igb3JkZXJpbmcuCiAgICAgKiBIb3dldmVyLCBhcyB0aGUgYWN0dWFsIG9yZGVyaW5nIG1ha2VzIG5vIGRpZmZlcmVuY2UgbWF0aGVtYXRpY2FsbHkgYW5kCiAgICAgKiBtb3N0IHBlb3BsZSBhcmUgdXNlZCB0byB0aGlua2luZyBhYm91dCBtYXRyaWNlcyBpbiByb3ctbWFqb3Igb3JkZXIsIHRoZQogICAgICogdGhyZWUuanMgZG9jdW1lbnRhdGlvbiBzaG93cyBtYXRyaWNlcyBpbiByb3ctbWFqb3Igb3JkZXIuIEp1c3QgYmVhciBpbgogICAgICogbWluZCB0aGF0IGlmIHlvdSBhcmUgcmVhZGluZyB0aGUgc291cmNlIGNvZGUsIHlvdSdsbCBoYXZlIHRvIHRha2UgdGhlCiAgICAgKiB0cmFuc3Bvc2Ugb2YgYW55IG1hdHJpY2VzIG91dGxpbmVkIGhlcmUgdG8gbWFrZSBzZW5zZSBvZiB0aGUgY2FsY3VsYXRpb25zLgogICAgICovCiAgICBjbGFzcyBNYXRyaXgzIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyAzeDMgbWF0cml4LiBUaGUgYXJndW1lbnRzIGFyZSBzdXBwb3NlZCB0byBiZQogICAgCSAqIGluIHJvdy1tYWpvciBvcmRlci4gSWYgbm8gYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdG9yCiAgICAJICogaW5pdGlhbGl6ZXMgdGhlIG1hdHJpeCBhcyBhbiBpZGVudGl0eSBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zMV0gLSAzLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzJdIC0gMy0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMzXSAtIDMtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjIxLCBuMjIsIG4yMywgbjMxLCBuMzIsIG4zMyApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQlNYXRyaXgzLnByb3RvdHlwZS5pc01hdHJpeDMgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgY29sdW1uLW1ham9yIGxpc3Qgb2YgbWF0cml4IHZhbHVlcy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PG51bWJlcj59CiAgICAJCSAqLwogICAgCQl0aGlzLmVsZW1lbnRzID0gWwoKICAgIAkJCTEsIDAsIDAsCiAgICAJCQkwLCAxLCAwLAogICAgCQkJMCwgMCwgMQoKICAgIAkJXTsKCiAgICAJCWlmICggbjExICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4LlRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCiAgICAJICogaW4gcm93LW1ham9yIG9yZGVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTFdIC0gMS0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEyXSAtIDEtMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xM10gLSAxLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjFdIC0gMi0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIyXSAtIDItMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yM10gLSAyLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJdGVbIDAgXSA9IG4xMTsgdGVbIDEgXSA9IG4yMTsgdGVbIDIgXSA9IG4zMTsKICAgIAkJdGVbIDMgXSA9IG4xMjsgdGVbIDQgXSA9IG4yMjsgdGVbIDUgXSA9IG4zMjsKICAgIAkJdGVbIDYgXSA9IG4xMzsgdGVbIDcgXSA9IG4yMzsgdGVbIDggXSA9IG4zMzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggdG8gdGhlIDN4MyBpZGVudGl0eSBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlpZGVudGl0eSgpIHsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCTEsIDAsIDAsCiAgICAJCQkwLCAxLCAwLAogICAgCQkJMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRyaXggdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSBtYXRyaXggdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAljb3B5KCBtICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgogICAgCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOwogICAgCQl0ZVsgMyBdID0gbWVbIDMgXTsgdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOwogICAgCQl0ZVsgNiBdID0gbWVbIDYgXTsgdGVbIDcgXSA9IG1lWyA3IF07IHRlWyA4IF0gPSBtZVsgOCBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXh0cmFjdHMgdGhlIGJhc2lzIG9mIHRoaXMgbWF0cml4IGludG8gdGhlIHRocmVlIGF4aXMgdmVjdG9ycyBwcm92aWRlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30geEF4aXMgLSBUaGUgYmFzaXMncyB4IGF4aXMuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB5QXhpcyAtIFRoZSBiYXNpcydzIHkgYXhpcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHpBeGlzIC0gVGhlIGJhc2lzJ3MgeiBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCiAgICAJCXhBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAwICk7CiAgICAJCXlBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAxICk7CiAgICAJCXpBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAyICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXQgdGhpcyBtYXRyaXggdG8gdGhlIHVwcGVyIDN4MyBtYXRyaXggb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4NCggbSApIHsKCiAgICAJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCW1lWyAwIF0sIG1lWyA0IF0sIG1lWyA4IF0sCiAgICAJCQltZVsgMSBdLCBtZVsgNSBdLCBtZVsgOSBdLAogICAgCQkJbWVbIDIgXSwgbWVbIDYgXSwgbWVbIDEwIF0KCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQb3N0LW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDN4MyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbXVsdGlwbHkoIG0gKSB7CgogICAgCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJlLW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDN4MyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJcHJlbXVsdGlwbHkoIG0gKSB7CgogICAgCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGVzIHRoZSBnaXZlbiAzeDMgbWF0cmljZXMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CiAgICAJICogaW4gdGhpcyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IGEgLSBUaGUgZmlyc3QgbWF0cml4LgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gYiAtIFRoZSBzZWNvbmQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgogICAgCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CiAgICAJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDMgXSwgYTEzID0gYWVbIDYgXTsKICAgIAkJY29uc3QgYTIxID0gYWVbIDEgXSwgYTIyID0gYWVbIDQgXSwgYTIzID0gYWVbIDcgXTsKICAgIAkJY29uc3QgYTMxID0gYWVbIDIgXSwgYTMyID0gYWVbIDUgXSwgYTMzID0gYWVbIDggXTsKCiAgICAJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyAzIF0sIGIxMyA9IGJlWyA2IF07CiAgICAJCWNvbnN0IGIyMSA9IGJlWyAxIF0sIGIyMiA9IGJlWyA0IF0sIGIyMyA9IGJlWyA3IF07CiAgICAJCWNvbnN0IGIzMSA9IGJlWyAyIF0sIGIzMiA9IGJlWyA1IF0sIGIzMyA9IGJlWyA4IF07CgogICAgCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxOwogICAgCQl0ZVsgMyBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyOwogICAgCQl0ZVsgNiBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzOwoKICAgIAkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgIAkJdGVbIDQgXSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgIAkJdGVbIDcgXSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKCiAgICAJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CiAgICAJCXRlWyA1IF0gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CiAgICAJCXRlWyA4IF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIGV2ZXJ5IGNvbXBvbmVudCBvZiB0aGUgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQl0ZVsgMCBdICo9IHM7IHRlWyAzIF0gKj0gczsgdGVbIDYgXSAqPSBzOwogICAgCQl0ZVsgMSBdICo9IHM7IHRlWyA0IF0gKj0gczsgdGVbIDcgXSAqPSBzOwogICAgCQl0ZVsgMiBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDggXSAqPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgYW5kIHJldHVybnMgdGhlIGRldGVybWluYW50IG9mIHRoaXMgbWF0cml4LgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGV0ZXJtaW5hbnQuCiAgICAJICovCiAgICAJZGV0ZXJtaW5hbnQoKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQljb25zdCBhID0gdGVbIDAgXSwgYiA9IHRlWyAxIF0sIGMgPSB0ZVsgMiBdLAogICAgCQkJZCA9IHRlWyAzIF0sIGUgPSB0ZVsgNCBdLCBmID0gdGVbIDUgXSwKICAgIAkJCWcgPSB0ZVsgNiBdLCBoID0gdGVbIDcgXSwgaSA9IHRlWyA4IF07CgogICAgCQlyZXR1cm4gYSAqIGUgKiBpIC0gYSAqIGYgKiBoIC0gYiAqIGQgKiBpICsgYiAqIGYgKiBnICsgYyAqIGQgKiBoIC0gYyAqIGUgKiBnOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludmVydHMgdGhpcyBtYXRyaXgsIHVzaW5nIHRoZSBbYW5hbHl0aWMgbWV0aG9kXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnRpYmxlX21hdHJpeCNBbmFseXRpY19zb2x1dGlvbn0uCiAgICAJICogWW91IGNhbiBub3QgaW52ZXJ0IHdpdGggYSBkZXRlcm1pbmFudCBvZiB6ZXJvLiBJZiB5b3UgYXR0ZW1wdCB0aGlzLCB0aGUgbWV0aG9kIHByb2R1Y2VzCiAgICAJICogYSB6ZXJvIG1hdHJpeCBpbnN0ZWFkLgogICAgCSAqCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJaW52ZXJ0KCkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKICAgIAkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sCiAgICAJCQluMTIgPSB0ZVsgMyBdLCBuMjIgPSB0ZVsgNCBdLCBuMzIgPSB0ZVsgNSBdLAogICAgCQkJbjEzID0gdGVbIDYgXSwgbjIzID0gdGVbIDcgXSwgbjMzID0gdGVbIDggXSwKCiAgICAJCQl0MTEgPSBuMzMgKiBuMjIgLSBuMzIgKiBuMjMsCiAgICAJCQl0MTIgPSBuMzIgKiBuMTMgLSBuMzMgKiBuMTIsCiAgICAJCQl0MTMgPSBuMjMgKiBuMTIgLSBuMjIgKiBuMTMsCgogICAgCQkJZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzOwoKICAgIAkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCiAgICAJCWNvbnN0IGRldEludiA9IDEgLyBkZXQ7CgogICAgCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwogICAgCQl0ZVsgMSBdID0gKCBuMzEgKiBuMjMgLSBuMzMgKiBuMjEgKSAqIGRldEludjsKICAgIAkJdGVbIDIgXSA9ICggbjMyICogbjIxIC0gbjMxICogbjIyICkgKiBkZXRJbnY7CgogICAgCQl0ZVsgMyBdID0gdDEyICogZGV0SW52OwogICAgCQl0ZVsgNCBdID0gKCBuMzMgKiBuMTEgLSBuMzEgKiBuMTMgKSAqIGRldEludjsKICAgIAkJdGVbIDUgXSA9ICggbjMxICogbjEyIC0gbjMyICogbjExICkgKiBkZXRJbnY7CgogICAgCQl0ZVsgNiBdID0gdDEzICogZGV0SW52OwogICAgCQl0ZVsgNyBdID0gKCBuMjEgKiBuMTMgLSBuMjMgKiBuMTEgKSAqIGRldEludjsKICAgIAkJdGVbIDggXSA9ICggbjIyICogbjExIC0gbjIxICogbjEyICkgKiBkZXRJbnY7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc3Bvc2VzIHRoaXMgbWF0cml4IGluIHBsYWNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJdHJhbnNwb3NlKCkgewoKICAgIAkJbGV0IHRtcDsKICAgIAkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQl0bXAgPSBtWyAxIF07IG1bIDEgXSA9IG1bIDMgXTsgbVsgMyBdID0gdG1wOwogICAgCQl0bXAgPSBtWyAyIF07IG1bIDIgXSA9IG1bIDYgXTsgbVsgNiBdID0gdG1wOwogICAgCQl0bXAgPSBtWyA1IF07IG1bIDUgXSA9IG1bIDcgXTsgbVsgNyBdID0gdG1wOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIG5vcm1hbCBtYXRyaXggd2hpY2ggaXMgdGhlIGludmVyc2UgdHJhbnNwb3NlIG9mIHRoZSB1cHBlcgogICAgCSAqIGxlZnQgM3gzIHBvcnRpb24gb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeDQgLSBUaGUgNHg0IG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlnZXROb3JtYWxNYXRyaXgoIG1hdHJpeDQgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4NCggbWF0cml4NCApLmludmVydCgpLnRyYW5zcG9zZSgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zcG9zZXMgdGhpcyBtYXRyaXggaW50byB0aGUgc3VwcGxpZWQgYXJyYXksIGFuZCByZXR1cm5zIGl0c2VsZiB1bmNoYW5nZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IHIgLSBBbiBhcnJheSB0byBzdG9yZSB0aGUgdHJhbnNwb3NlZCBtYXRyaXggZWxlbWVudHMuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJdHJhbnNwb3NlSW50b0FycmF5KCByICkgewoKICAgIAkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQlyWyAwIF0gPSBtWyAwIF07CiAgICAJCXJbIDEgXSA9IG1bIDMgXTsKICAgIAkJclsgMiBdID0gbVsgNiBdOwogICAgCQlyWyAzIF0gPSBtWyAxIF07CiAgICAJCXJbIDQgXSA9IG1bIDQgXTsKICAgIAkJclsgNSBdID0gbVsgNyBdOwogICAgCQlyWyA2IF0gPSBtWyAyIF07CiAgICAJCXJbIDcgXSA9IG1bIDUgXTsKICAgIAkJclsgOCBdID0gbVsgOCBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgVVYgdHJhbnNmb3JtIG1hdHJpeCBmcm9tIG9mZnNldCwgcmVwZWF0LCByb3RhdGlvbiwgYW5kIGNlbnRlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0eCAtIE9mZnNldCB4LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0eSAtIE9mZnNldCB5LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzeCAtIFJlcGVhdCB4LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzeSAtIFJlcGVhdCB5LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSByb3RhdGlvbiAtIFJvdGF0aW9uLCBpbiByYWRpYW5zLiBQb3NpdGl2ZSB2YWx1ZXMgcm90YXRlIGNvdW50ZXJjbG9ja3dpc2UuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGN4IC0gQ2VudGVyIHggb2Ygcm90YXRpb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGN5IC0gQ2VudGVyIHkgb2Ygcm90YXRpb24KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzZXRVdlRyYW5zZm9ybSggdHgsIHR5LCBzeCwgc3ksIHJvdGF0aW9uLCBjeCwgY3kgKSB7CgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIHJvdGF0aW9uICk7CiAgICAJCWNvbnN0IHMgPSBNYXRoLnNpbiggcm90YXRpb24gKTsKCiAgICAJCXRoaXMuc2V0KAogICAgCQkJc3ggKiBjLCBzeCAqIHMsIC0gc3ggKiAoIGMgKiBjeCArIHMgKiBjeSApICsgY3ggKyB0eCwKICAgIAkJCS0gc3kgKiBzLCBzeSAqIGMsIC0gc3kgKiAoIC0gcyAqIGN4ICsgYyAqIGN5ICkgKyBjeSArIHR5LAogICAgCQkJMCwgMCwgMQogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2NhbGVzIHRoaXMgbWF0cml4IHdpdGggdGhlIGdpdmVuIHNjYWxhciB2YWx1ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3ggLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBYIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCXNjYWxlKCBzeCwgc3kgKSB7CgogICAgCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVNjYWxlKCBzeCwgc3kgKSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgcm90YXRpb24gaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlyb3RhdGUoIHRoZXRhICkgewoKICAgIAkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VSb3RhdGlvbiggLSB0aGV0YSApICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2xhdGVzIHRoaXMgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIgdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHR4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdHkgLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgWSBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCXRyYW5zbGF0ZSggdHgsIHR5ICkgewoKICAgIAkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VUcmFuc2xhdGlvbiggdHgsIHR5ICkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8vIGZvciAyRCBUcmFuc2Zvcm1zCgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSAyRCB0cmFuc2xhdGlvbiB0cmFuc2Zvcm0uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IyfSB4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcyBvciBhbHRlcm5hdGl2ZWx5IGEgdHJhbnNsYXRpb24gdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFkgYXhpcy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlVHJhbnNsYXRpb24oIHgsIHkgKSB7CgogICAgCQlpZiAoIHguaXNWZWN0b3IyICkgewoKICAgIAkJCXRoaXMuc2V0KAoKICAgIAkJCQkxLCAwLCB4LngsCiAgICAJCQkJMCwgMSwgeC55LAogICAgCQkJCTAsIDAsIDEKCiAgICAJCQkpOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aGlzLnNldCgKCiAgICAJCQkJMSwgMCwgeCwKICAgIAkJCQkwLCAxLCB5LAogICAgCQkJCTAsIDAsIDEKCiAgICAJCQkpOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIDJEIHJvdGF0aW9uYWwgdHJhbnNmb3JtYXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgcm90YXRpb24gaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlUm90YXRpb24oIHRoZXRhICkgewoKICAgIAkJLy8gY291bnRlcmNsb2Nrd2lzZQoKICAgIAkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApOwogICAgCQljb25zdCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQljLCAtIHMsIDAsCiAgICAJCQlzLCBjLCAwLAogICAgCQkJMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSAyRCBzY2FsZSB0cmFuc2Zvcm0uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFggYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFkgYXhpcy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlU2NhbGUoIHgsIHkgKSB7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQl4LCAwLCAwLAogICAgCQkJMCwgeSwgMCwKICAgIAkJCTAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIG1hdHJpeCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG1hdHJpeCAtIFRoZSBtYXRyaXggdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIG1hdHJpeCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCBtYXRyaXggKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWNvbnN0IG1lID0gbWF0cml4LmVsZW1lbnRzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgOTsgaSArKyApIHsKCiAgICAJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdHJ1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFycmF5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKICAgIAkJCXRoaXMuZWxlbWVudHNbIGkgXSA9IGFycmF5WyBpICsgb2Zmc2V0IF07CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXcml0ZXMgdGhlIGVsZW1lbnRzIG9mIHRoaXMgbWF0cml4IHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGVbIDEgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRlWyAyIF07CgogICAgCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDQgXSA9IHRlWyA0IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyA1IF0gPSB0ZVsgNSBdOwoKICAgIAkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgOCBdID0gdGVbIDggXTsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbWF0cml4IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5mcm9tQXJyYXkoIHRoaXMuZWxlbWVudHMgKTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfbTMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgogICAgZnVuY3Rpb24gYXJyYXlOZWVkc1VpbnQzMiggYXJyYXkgKSB7CgogICAgCS8vIGFzc3VtZXMgbGFyZ2VyIHZhbHVlcyB1c3VhbGx5IG9uIGxhc3QKCiAgICAJZm9yICggbGV0IGkgPSBhcnJheS5sZW5ndGggLSAxOyBpID49IDA7IC0tIGkgKSB7CgogICAgCQlpZiAoIGFycmF5WyBpIF0gPj0gNjU1MzUgKSByZXR1cm4gdHJ1ZTsgLy8gYWNjb3VudCBmb3IgUFJJTUlUSVZFX1JFU1RBUlRfRklYRURfSU5ERVgsICMyNDU2NQoKICAgIAl9CgogICAgCXJldHVybiBmYWxzZTsKCiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlRWxlbWVudE5TKCBuYW1lICkgewoKICAgIAlyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCcsIG5hbWUgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ2FudmFzRWxlbWVudCgpIHsKCiAgICAJY29uc3QgY2FudmFzID0gY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwogICAgCWNhbnZhcy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIAlyZXR1cm4gY2FudmFzOwoKICAgIH0KCiAgICBjb25zdCBfY2FjaGUgPSB7fTsKCiAgICBmdW5jdGlvbiB3YXJuT25jZSggbWVzc2FnZSApIHsKCiAgICAJaWYgKCBtZXNzYWdlIGluIF9jYWNoZSApIHJldHVybjsKCiAgICAJX2NhY2hlWyBtZXNzYWdlIF0gPSB0cnVlOwoKICAgIAljb25zb2xlLndhcm4oIG1lc3NhZ2UgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gcHJvYmVBc3luYyggZ2wsIHN5bmMsIGludGVydmFsICkgewoKICAgIAlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKICAgIAkJZnVuY3Rpb24gcHJvYmUoKSB7CgogICAgCQkJc3dpdGNoICggZ2wuY2xpZW50V2FpdFN5bmMoIHN5bmMsIGdsLlNZTkNfRkxVU0hfQ09NTUFORFNfQklULCAwICkgKSB7CgogICAgCQkJCWNhc2UgZ2wuV0FJVF9GQUlMRUQ6CiAgICAJCQkJCXJlamVjdCgpOwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSBnbC5USU1FT1VUX0VYUElSRUQ6CiAgICAJCQkJCXNldFRpbWVvdXQoIHByb2JlLCBpbnRlcnZhbCApOwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJZGVmYXVsdDoKICAgIAkJCQkJcmVzb2x2ZSgpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXNldFRpbWVvdXQoIHByb2JlLCBpbnRlcnZhbCApOwoKICAgIAl9ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHRvTm9ybWFsaXplZFByb2plY3Rpb25NYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSB7CgogICAgCWNvbnN0IG0gPSBwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwoKICAgIAkvLyBDb252ZXJ0IFstMSwgMV0gdG8gWzAsIDFdIHByb2plY3Rpb24gbWF0cml4CiAgICAJbVsgMiBdID0gMC41ICogbVsgMiBdICsgMC41ICogbVsgMyBdOwogICAgCW1bIDYgXSA9IDAuNSAqIG1bIDYgXSArIDAuNSAqIG1bIDcgXTsKICAgIAltWyAxMCBdID0gMC41ICogbVsgMTAgXSArIDAuNSAqIG1bIDExIF07CiAgICAJbVsgMTQgXSA9IDAuNSAqIG1bIDE0IF0gKyAwLjUgKiBtWyAxNSBdOwoKICAgIH0KCiAgICBmdW5jdGlvbiB0b1JldmVyc2VkUHJvamVjdGlvbk1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApIHsKCiAgICAJY29uc3QgbSA9IHByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CiAgICAJY29uc3QgaXNQZXJzcGVjdGl2ZU1hdHJpeCA9IG1bIDExIF0gPT09IC0xOwoKICAgIAkvLyBSZXZlcnNlIFswLCAxXSBwcm9qZWN0aW9uIG1hdHJpeAogICAgCWlmICggaXNQZXJzcGVjdGl2ZU1hdHJpeCApIHsKCiAgICAJCW1bIDEwIF0gPSAtIG1bIDEwIF0gLSAxOwogICAgCQltWyAxNCBdID0gLSBtWyAxNCBdOwoKICAgIAl9IGVsc2UgewoKICAgIAkJbVsgMTAgXSA9IC0gbVsgMTAgXTsKICAgIAkJbVsgMTQgXSA9IC0gbVsgMTQgXSArIDE7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgTElORUFSX1JFQzcwOV9UT19YWVogPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkuc2V0KAogICAgCTAuNDEyMzkwOCwgMC4zNTc1ODQzLCAwLjE4MDQ4MDgsCiAgICAJMC4yMTI2MzkwLCAwLjcxNTE2ODcsIDAuMDcyMTkyMywKICAgIAkwLjAxOTMzMDgsIDAuMTE5MTk0OCwgMC45NTA1MzIyCiAgICApOwoKICAgIGNvbnN0IFhZWl9UT19MSU5FQVJfUkVDNzA5ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpLnNldCgKICAgIAkzLjI0MDk2OTksIC0xLjUzNzM4MzIsIC0wLjQ5ODYxMDgsCiAgICAJLTAuOTY5MjQzNiwgMS44NzU5Njc1LCAwLjA0MTU1NTEsCiAgICAJMC4wNTU2MzAxLCAtMC4yMDM5NzcsIDEuMDU2OTcxNQogICAgKTsKCiAgICBmdW5jdGlvbiBjcmVhdGVDb2xvck1hbmFnZW1lbnQoKSB7CgogICAgCWNvbnN0IENvbG9yTWFuYWdlbWVudCA9IHsKCiAgICAJCWVuYWJsZWQ6IHRydWUsCgogICAgCQl3b3JraW5nQ29sb3JTcGFjZTogTGluZWFyU1JHQkNvbG9yU3BhY2UsCgogICAgCQkvKioKICAgIAkJICogSW1wbGVtZW50YXRpb25zIG9mIHN1cHBvcnRlZCBjb2xvciBzcGFjZXMuCiAgICAJCSAqCiAgICAJCSAqIFJlcXVpcmVkOgogICAgCQkgKgktIHByaW1hcmllczogY2hyb21hdGljaXR5IGNvb3JkaW5hdGVzIFsgcnggcnkgZ3ggZ3kgYnggYnkgXQogICAgCQkgKgktIHdoaXRlUG9pbnQ6IHJlZmVyZW5jZSB3aGl0ZSBbIHggeSBdCiAgICAJCSAqCS0gdHJhbnNmZXI6IHRyYW5zZmVyIGZ1bmN0aW9uIChwcmUtZGVmaW5lZCkKICAgIAkJICoJLSB0b1hZWjogTWF0cml4MyBSR0IgdG8gWFlaIHRyYW5zZm9ybQogICAgCQkgKgktIGZyb21YWVo6IE1hdHJpeDMgWFlaIHRvIFJHQiB0cmFuc2Zvcm0KICAgIAkJICoJLSBsdW1pbmFuY2VDb2VmZmljaWVudHM6IFJHQiBsdW1pbmFuY2UgY29lZmZpY2llbnRzCiAgICAJCSAqCiAgICAJCSAqIE9wdGlvbmFsOgogICAgCQkgKiAgLSBvdXRwdXRDb2xvclNwYWNlQ29uZmlnOiB7IGRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOiBDb2xvclNwYWNlIH0KICAgIAkJICogIC0gd29ya2luZ0NvbG9yU3BhY2VDb25maWc6IHsgdW5wYWNrQ29sb3JTcGFjZTogQ29sb3JTcGFjZSB9CiAgICAJCSAqCiAgICAJCSAqIFJlZmVyZW5jZToKICAgIAkJICogLSBodHRwczovL3d3dy5ydXNzZWxsY290dHJlbGwuY29tL3Bob3RvL21hdHJpeENhbGN1bGF0b3IuaHRtCiAgICAJCSAqLwogICAgCQlzcGFjZXM6IHt9LAoKICAgIAkJY29udmVydDogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSwgdGFyZ2V0Q29sb3JTcGFjZSApIHsKCiAgICAJCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgfHwgc291cmNlQ29sb3JTcGFjZSA9PT0gdGFyZ2V0Q29sb3JTcGFjZSB8fCAhIHNvdXJjZUNvbG9yU3BhY2UgfHwgISB0YXJnZXRDb2xvclNwYWNlICkgewoKICAgIAkJCQlyZXR1cm4gY29sb3I7CgogICAgCQkJfQoKICAgIAkJCWlmICggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKICAgIAkJCQljb2xvci5yID0gU1JHQlRvTGluZWFyKCBjb2xvci5yICk7CiAgICAJCQkJY29sb3IuZyA9IFNSR0JUb0xpbmVhciggY29sb3IuZyApOwogICAgCQkJCWNvbG9yLmIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmIgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0aGlzLnNwYWNlc1sgc291cmNlQ29sb3JTcGFjZSBdLnByaW1hcmllcyAhPT0gdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS5wcmltYXJpZXMgKSB7CgogICAgCQkJCWNvbG9yLmFwcGx5TWF0cml4MyggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1hZWiApOwogICAgCQkJCWNvbG9yLmFwcGx5TWF0cml4MyggdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS5mcm9tWFlaICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS50cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKICAgIAkJCQljb2xvci5yID0gTGluZWFyVG9TUkdCKCBjb2xvci5yICk7CiAgICAJCQkJY29sb3IuZyA9IExpbmVhclRvU1JHQiggY29sb3IuZyApOwogICAgCQkJCWNvbG9yLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGNvbG9yOwoKICAgIAkJfSwKCiAgICAJCXdvcmtpbmdUb0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3IsIHRhcmdldENvbG9yU3BhY2UgKSB7CgogICAgCQkJcmV0dXJuIHRoaXMuY29udmVydCggY29sb3IsIHRoaXMud29ya2luZ0NvbG9yU3BhY2UsIHRhcmdldENvbG9yU3BhY2UgKTsKCiAgICAJCX0sCgogICAgCQljb2xvclNwYWNlVG9Xb3JraW5nOiBmdW5jdGlvbiAoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlICkgewoKICAgIAkJCXJldHVybiB0aGlzLmNvbnZlcnQoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlLCB0aGlzLndvcmtpbmdDb2xvclNwYWNlICk7CgogICAgCQl9LAoKICAgIAkJZ2V0UHJpbWFyaWVzOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgogICAgCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ucHJpbWFyaWVzOwoKICAgIAkJfSwKCiAgICAJCWdldFRyYW5zZmVyOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgogICAgCQkJaWYgKCBjb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgKSByZXR1cm4gTGluZWFyVHJhbnNmZXI7CgogICAgCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0udHJhbnNmZXI7CgogICAgCQl9LAoKICAgIAkJZ2V0THVtaW5hbmNlQ29lZmZpY2llbnRzOiBmdW5jdGlvbiAoIHRhcmdldCwgY29sb3JTcGFjZSA9IHRoaXMud29ya2luZ0NvbG9yU3BhY2UgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5mcm9tQXJyYXkoIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ubHVtaW5hbmNlQ29lZmZpY2llbnRzICk7CgogICAgCQl9LAoKICAgIAkJZGVmaW5lOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2VzICkgewoKICAgIAkJCU9iamVjdC5hc3NpZ24oIHRoaXMuc3BhY2VzLCBjb2xvclNwYWNlcyApOwoKICAgIAkJfSwKCiAgICAJCS8vIEludGVybmFsIEFQSXMKCiAgICAJCV9nZXRNYXRyaXg6IGZ1bmN0aW9uICggdGFyZ2V0TWF0cml4LCBzb3VyY2VDb2xvclNwYWNlLCB0YXJnZXRDb2xvclNwYWNlICkgewoKICAgIAkJCXJldHVybiB0YXJnZXRNYXRyaXgKICAgIAkJCQkuY29weSggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1hZWiApCiAgICAJCQkJLm11bHRpcGx5KCB0aGlzLnNwYWNlc1sgdGFyZ2V0Q29sb3JTcGFjZSBdLmZyb21YWVogKTsKCiAgICAJCX0sCgogICAgCQlfZ2V0RHJhd2luZ0J1ZmZlckNvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3JTcGFjZSApIHsKCiAgICAJCQlyZXR1cm4gdGhpcy5zcGFjZXNbIGNvbG9yU3BhY2UgXS5vdXRwdXRDb2xvclNwYWNlQ29uZmlnLmRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOwoKICAgIAkJfSwKCiAgICAJCV9nZXRVbnBhY2tDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgPSB0aGlzLndvcmtpbmdDb2xvclNwYWNlICkgewoKICAgIAkJCXJldHVybiB0aGlzLnNwYWNlc1sgY29sb3JTcGFjZSBdLndvcmtpbmdDb2xvclNwYWNlQ29uZmlnLnVucGFja0NvbG9yU3BhY2U7CgogICAgCQl9LAoKICAgIAkJLy8gRGVwcmVjYXRlZAoKICAgIAkJZnJvbVdvcmtpbmdDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICkgewoKICAgIAkJCXdhcm5PbmNlKCAnVEhSRUUuQ29sb3JNYW5hZ2VtZW50OiAuZnJvbVdvcmtpbmdDb2xvclNwYWNlKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAud29ya2luZ1RvQ29sb3JTcGFjZSgpLicgKTsgLy8gQGRlcHJlY2F0ZWQsIHIxNzcKCiAgICAJCQlyZXR1cm4gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICk7CgogICAgCQl9LAoKICAgIAkJdG9Xb3JraW5nQ29sb3JTcGFjZTogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSApIHsKCiAgICAJCQl3YXJuT25jZSggJ1RIUkVFLkNvbG9yTWFuYWdlbWVudDogLnRvV29ya2luZ0NvbG9yU3BhY2UoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5jb2xvclNwYWNlVG9Xb3JraW5nKCkuJyApOyAvLyBAZGVwcmVjYXRlZCwgcjE3NwoKICAgIAkJCXJldHVybiBDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UgKTsKCiAgICAJCX0sCgogICAgCX07CgogICAgCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgIAkgKiBzUkdCIGRlZmluaXRpb25zCiAgICAJICovCgogICAgCWNvbnN0IFJFQzcwOV9QUklNQVJJRVMgPSBbIDAuNjQwLCAwLjMzMCwgMC4zMDAsIDAuNjAwLCAwLjE1MCwgMC4wNjAgXTsKICAgIAljb25zdCBSRUM3MDlfTFVNSU5BTkNFX0NPRUZGSUNJRU5UUyA9IFsgMC4yMTI2LCAwLjcxNTIsIDAuMDcyMiBdOwogICAgCWNvbnN0IEQ2NSA9IFsgMC4zMTI3LCAwLjMyOTAgXTsKCiAgICAJQ29sb3JNYW5hZ2VtZW50LmRlZmluZSggewoKICAgIAkJWyBMaW5lYXJTUkdCQ29sb3JTcGFjZSBdOiB7CiAgICAJCQlwcmltYXJpZXM6IFJFQzcwOV9QUklNQVJJRVMsCiAgICAJCQl3aGl0ZVBvaW50OiBENjUsCiAgICAJCQl0cmFuc2ZlcjogTGluZWFyVHJhbnNmZXIsCiAgICAJCQl0b1hZWjogTElORUFSX1JFQzcwOV9UT19YWVosCiAgICAJCQlmcm9tWFlaOiBYWVpfVE9fTElORUFSX1JFQzcwOSwKICAgIAkJCWx1bWluYW5jZUNvZWZmaWNpZW50czogUkVDNzA5X0xVTUlOQU5DRV9DT0VGRklDSUVOVFMsCiAgICAJCQl3b3JraW5nQ29sb3JTcGFjZUNvbmZpZzogeyB1bnBhY2tDb2xvclNwYWNlOiBTUkdCQ29sb3JTcGFjZSB9LAogICAgCQkJb3V0cHV0Q29sb3JTcGFjZUNvbmZpZzogeyBkcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogU1JHQkNvbG9yU3BhY2UgfQogICAgCQl9LAoKICAgIAkJWyBTUkdCQ29sb3JTcGFjZSBdOiB7CiAgICAJCQlwcmltYXJpZXM6IFJFQzcwOV9QUklNQVJJRVMsCiAgICAJCQl3aGl0ZVBvaW50OiBENjUsCiAgICAJCQl0cmFuc2ZlcjogU1JHQlRyYW5zZmVyLAogICAgCQkJdG9YWVo6IExJTkVBUl9SRUM3MDlfVE9fWFlaLAogICAgCQkJZnJvbVhZWjogWFlaX1RPX0xJTkVBUl9SRUM3MDksCiAgICAJCQlsdW1pbmFuY2VDb2VmZmljaWVudHM6IFJFQzcwOV9MVU1JTkFOQ0VfQ09FRkZJQ0lFTlRTLAogICAgCQkJb3V0cHV0Q29sb3JTcGFjZUNvbmZpZzogeyBkcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogU1JHQkNvbG9yU3BhY2UgfQogICAgCQl9LAoKICAgIAl9ICk7CgogICAgCXJldHVybiBDb2xvck1hbmFnZW1lbnQ7CgogICAgfQoKICAgIGNvbnN0IENvbG9yTWFuYWdlbWVudCA9IC8qQF9fUFVSRV9fKi8gY3JlYXRlQ29sb3JNYW5hZ2VtZW50KCk7CgogICAgZnVuY3Rpb24gU1JHQlRvTGluZWFyKCBjICkgewoKICAgIAlyZXR1cm4gKCBjIDwgMC4wNDA0NSApID8gYyAqIDAuMDc3Mzk5MzgwOCA6IE1hdGgucG93KCBjICogMC45NDc4NjcyOTg2ICsgMC4wNTIxMzI3MDE0LCAyLjQgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gTGluZWFyVG9TUkdCKCBjICkgewoKICAgIAlyZXR1cm4gKCBjIDwgMC4wMDMxMzA4ICkgPyBjICogMTIuOTIgOiAxLjA1NSAqICggTWF0aC5wb3coIGMsIDAuNDE2NjYgKSApIC0gMC4wNTU7CgogICAgfQoKICAgIGxldCBfY2FudmFzOwoKICAgIC8qKgogICAgICogQSBjbGFzcyBjb250YWluaW5nIHV0aWxpdHkgZnVuY3Rpb25zIGZvciBpbWFnZXMuCiAgICAgKgogICAgICogQGhpZGVjb25zdHJ1Y3RvcgogICAgICovCiAgICBjbGFzcyBJbWFnZVV0aWxzIHsKCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIGRhdGEgVVJJIGNvbnRhaW5pbmcgYSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gaW1hZ2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhIVE1MSW1hZ2VFbGVtZW50fEhUTUxDYW52YXNFbGVtZW50KX0gaW1hZ2UgLSBUaGUgaW1hZ2Ugb2JqZWN0LgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbdHlwZT0naW1hZ2UvcG5nJ10gLSBJbmRpY2F0ZXMgdGhlIGltYWdlIGZvcm1hdC4KICAgIAkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBkYXRhIFVSSS4KICAgIAkgKi8KICAgIAlzdGF0aWMgZ2V0RGF0YVVSTCggaW1hZ2UsIHR5cGUgPSAnaW1hZ2UvcG5nJyApIHsKCiAgICAJCWlmICggL15kYXRhOi9pLnRlc3QoIGltYWdlLnNyYyApICkgewoKICAgIAkJCXJldHVybiBpbWFnZS5zcmM7CgogICAgCQl9CgogICAgCQlpZiAoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgogICAgCQkJcmV0dXJuIGltYWdlLnNyYzsKCiAgICAJCX0KCiAgICAJCWxldCBjYW52YXM7CgogICAgCQlpZiAoIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB7CgogICAgCQkJY2FudmFzID0gaW1hZ2U7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggX2NhbnZhcyA9PT0gdW5kZWZpbmVkICkgX2NhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCiAgICAJCQlfY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAJCQlfY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKCiAgICAJCQljb25zdCBjb250ZXh0ID0gX2NhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgogICAgCQkJaWYgKCBpbWFnZSBpbnN0YW5jZW9mIEltYWdlRGF0YSApIHsKCiAgICAJCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlLCAwLCAwICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgogICAgCQkJfQoKICAgIAkJCWNhbnZhcyA9IF9jYW52YXM7CgogICAgCQl9CgogICAgCQlyZXR1cm4gY2FudmFzLnRvRGF0YVVSTCggdHlwZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbnZlcnRzIHRoZSBnaXZlbiBzUkdCIGltYWdlIGRhdGEgdG8gbGluZWFyIGNvbG9yIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHsoSFRNTEltYWdlRWxlbWVudHxIVE1MQ2FudmFzRWxlbWVudHxJbWFnZUJpdG1hcHxPYmplY3QpfSBpbWFnZSAtIFRoZSBpbWFnZSBvYmplY3QuCiAgICAJICogQHJldHVybiB7SFRNTENhbnZhc0VsZW1lbnR8T2JqZWN0fSBUaGUgY29udmVydGVkIGltYWdlLgogICAgCSAqLwogICAgCXN0YXRpYyBzUkdCVG9MaW5lYXIoIGltYWdlICkgewoKICAgIAkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAogICAgCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAogICAgCQkJKCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAgKSApIHsKCiAgICAJCQljb25zdCBjYW52YXMgPSBjcmVhdGVFbGVtZW50TlMoICdjYW52YXMnICk7CgogICAgCQkJY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAJCQljYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKICAgIAkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwogICAgCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgogICAgCQkJY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKICAgIAkJCWNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJZGF0YVsgaSBdID0gU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NTsKCiAgICAJCQl9CgogICAgCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlRGF0YSwgMCwgMCApOwoKICAgIAkJCXJldHVybiBjYW52YXM7CgogICAgCQl9IGVsc2UgaWYgKCBpbWFnZS5kYXRhICkgewoKICAgIAkJCWNvbnN0IGRhdGEgPSBpbWFnZS5kYXRhLnNsaWNlKCAwICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWlmICggZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgfHwgZGF0YSBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5ICkgewoKICAgIAkJCQkJZGF0YVsgaSBdID0gTWF0aC5mbG9vciggU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gYXNzdW1pbmcgZmxvYXQKCiAgICAJCQkJCWRhdGFbIGkgXSA9IFNSR0JUb0xpbmVhciggZGF0YVsgaSBdICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIHsKICAgIAkJCQlkYXRhOiBkYXRhLAogICAgCQkJCXdpZHRoOiBpbWFnZS53aWR0aCwKICAgIAkJCQloZWlnaHQ6IGltYWdlLmhlaWdodAogICAgCQkJfTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VVdGlscy5zUkdCVG9MaW5lYXIoKTogVW5zdXBwb3J0ZWQgaW1hZ2UgdHlwZS4gTm8gY29sb3Igc3BhY2UgY29udmVyc2lvbiBhcHBsaWVkLicgKTsKICAgIAkJCXJldHVybiBpbWFnZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICBsZXQgX3NvdXJjZUlkID0gMDsKCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgdGhlIGRhdGEgc291cmNlIG9mIGEgdGV4dHVyZS4KICAgICAqCiAgICAgKiBUaGUgbWFpbiBwdXJwb3NlIG9mIHRoaXMgY2xhc3MgaXMgdG8gZGVjb3VwbGUgdGhlIGRhdGEgZGVmaW5pdGlvbiBmcm9tIHRoZSB0ZXh0dXJlCiAgICAgKiBkZWZpbml0aW9uIHNvIHRoZSBzYW1lIGRhdGEgY2FuIGJlIHVzZWQgd2l0aCBtdWx0aXBsZSB0ZXh0dXJlIGluc3RhbmNlcy4KICAgICAqLwogICAgY2xhc3MgU291cmNlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyB2aWRlbyB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHthbnl9IFtkYXRhPW51bGxdIC0gVGhlIGRhdGEgZGVmaW5pdGlvbiBvZiBhIHRleHR1cmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNTb3VyY2UgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBJRCBvZiB0aGUgc291cmNlLgogICAgCQkgKgogICAgCQkgKiBAbmFtZSBTb3VyY2UjaWQKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9zb3VyY2VJZCArKyB9ICk7CgogICAgCQkvKioKICAgIAkJICogVGhlIFVVSUQgb2YgdGhlIHNvdXJjZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2FueX0KICAgIAkJICovCiAgICAJCXRoaXMuZGF0YSA9IGRhdGE7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHJlbGV2YW50IHdoZW4ge0BsaW5rIFNvdXJjZSNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYCBhbmQKICAgIAkJICogcHJvdmlkZXMgbW9yZSBjb250cm9sIG9uIGhvdyB0ZXh0dXJlIGRhdGEgc2hvdWxkIGJlIHByb2Nlc3NlZC4gV2hlbiBgZGF0YVJlYWR5YCBpcyBzZXQKICAgIAkJICogdG8gYGZhbHNlYCwgdGhlIGVuZ2luZSBwZXJmb3JtcyB0aGUgbWVtb3J5IGFsbG9jYXRpb24gKGlmIG5lY2Vzc2FyeSkgYnV0IGRvZXMgbm90IHRyYW5zZmVyCiAgICAJCSAqIHRoZSBkYXRhIGludG8gdGhlIEdQVSBtZW1vcnkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmRhdGFSZWFkeSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBzdGFydHMgYXQgYDBgIGFuZCBjb3VudHMgaG93IG1hbnkgdGltZXMge0BsaW5rIFNvdXJjZSNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMudmVyc2lvbiA9IDA7CgogICAgCX0KCiAgICAJZ2V0U2l6ZSggdGFyZ2V0ICkgewoKICAgIAkJY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAJCWlmICggZGF0YSBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQgKSB7CgogICAgCQkJdGFyZ2V0LnNldCggZGF0YS52aWRlb1dpZHRoLCBkYXRhLnZpZGVvSGVpZ2h0ICk7CgogICAgCQl9IGVsc2UgaWYgKCBkYXRhICE9PSBudWxsICkgewoKICAgIAkJCXRhcmdldC5zZXQoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLmRlcHRoIHx8IDAgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGFyZ2V0LnNldCggMCwgMCwgMCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRhcmdldDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXaGVuIHRoZSBwcm9wZXJ0eSBpcyBzZXQgdG8gYHRydWVgLCB0aGUgZW5naW5lIGFsbG9jYXRlcyB0aGUgbWVtb3J5CiAgICAJICogZm9yIHRoZSB0ZXh0dXJlIChpZiBuZWNlc3NhcnkpIGFuZCB0cmlnZ2VycyB0aGUgYWN0dWFsIHRleHR1cmUgdXBsb2FkCiAgICAJICogdG8gdGhlIEdQVSBuZXh0IHRpbWUgdGhlIHNvdXJjZSBpcyB1c2VkLgogICAgCSAqCiAgICAJICogQHR5cGUge2Jvb2xlYW59CiAgICAJICogQGRlZmF1bHQgZmFsc2UKICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAgICAJICovCiAgICAJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCiAgICAJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VyaWFsaXplcyB0aGUgc291cmNlIGludG8gSlNPTi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIHNvdXJjZS4KICAgIAkgKiBAc2VlIHtAbGluayBPYmplY3RMb2FkZXIjcGFyc2V9CiAgICAJICovCiAgICAJdG9KU09OKCBtZXRhICkgewoKICAgIAkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgogICAgCQlpZiAoICEgaXNSb290T2JqZWN0ICYmIG1ldGEuaW1hZ2VzWyB0aGlzLnV1aWQgXSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXJldHVybiBtZXRhLmltYWdlc1sgdGhpcy51dWlkIF07CgogICAgCQl9CgogICAgCQljb25zdCBvdXRwdXQgPSB7CiAgICAJCQl1dWlkOiB0aGlzLnV1aWQsCiAgICAJCQl1cmw6ICcnCiAgICAJCX07CgogICAgCQljb25zdCBkYXRhID0gdGhpcy5kYXRhOwoKICAgIAkJaWYgKCBkYXRhICE9PSBudWxsICkgewoKICAgIAkJCWxldCB1cmw7CgogICAgCQkJaWYgKCBBcnJheS5pc0FycmF5KCBkYXRhICkgKSB7CgogICAgCQkJCS8vIGN1YmUgdGV4dHVyZQoKICAgIAkJCQl1cmwgPSBbXTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZGF0YS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJaWYgKCBkYXRhWyBpIF0uaXNEYXRhVGV4dHVyZSApIHsKCiAgICAJCQkJCQl1cmwucHVzaCggc2VyaWFsaXplSW1hZ2UoIGRhdGFbIGkgXS5pbWFnZSApICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCXVybC5wdXNoKCBzZXJpYWxpemVJbWFnZSggZGF0YVsgaSBdICkgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCS8vIHRleHR1cmUKCiAgICAJCQkJdXJsID0gc2VyaWFsaXplSW1hZ2UoIGRhdGEgKTsKCiAgICAJCQl9CgogICAgCQkJb3V0cHV0LnVybCA9IHVybDsKCiAgICAJCX0KCiAgICAJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgogICAgCQkJbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdID0gb3V0cHV0OwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIG91dHB1dDsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXJpYWxpemVJbWFnZSggaW1hZ2UgKSB7CgogICAgCWlmICggKCB0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgfHwKICAgIAkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAogICAgCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKICAgIAkJLy8gZGVmYXVsdCBpbWFnZXMKCiAgICAJCXJldHVybiBJbWFnZVV0aWxzLmdldERhdGFVUkwoIGltYWdlICk7CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGltYWdlLmRhdGEgKSB7CgogICAgCQkJLy8gaW1hZ2VzIG9mIERhdGFUZXh0dXJlCgogICAgCQkJcmV0dXJuIHsKICAgIAkJCQlkYXRhOiBBcnJheS5mcm9tKCBpbWFnZS5kYXRhICksCiAgICAJCQkJd2lkdGg6IGltYWdlLndpZHRoLAogICAgCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0LAogICAgCQkJCXR5cGU6IGltYWdlLmRhdGEuY29uc3RydWN0b3IubmFtZQogICAgCQkJfTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVGV4dHVyZTogVW5hYmxlIHRvIHNlcmlhbGl6ZSBUZXh0dXJlLicgKTsKICAgIAkJCXJldHVybiB7fTsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICBsZXQgX3RleHR1cmVJZCA9IDA7CgogICAgY29uc3QgX3RlbXBWZWMzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIC8qKgogICAgICogQmFzZSBjbGFzcyBmb3IgYWxsIHRleHR1cmVzLgogICAgICoKICAgICAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIHRleHR1cmUsIGl0cyBkaW1lbnNpb25zLCBmb3JtYXQsIGFuZCB0eXBlCiAgICAgKiBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwgY2FsbCB7QGxpbmsgVGV4dHVyZSNkaXNwb3NlfSBvbiB0aGUgdGV4dHVyZSBhbmQgaW5zdGFudGlhdGUgYSBuZXcgb25lLgogICAgICoKICAgICAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKICAgICAqLwogICAgY2xhc3MgVGV4dHVyZSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgdGV4dHVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7P09iamVjdH0gW2ltYWdlPVRleHR1cmUuREVGQVVMVF9JTUFHRV0gLSBUaGUgaW1hZ2UgaG9sZGluZyB0aGUgdGV4dHVyZSBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBpbWFnZSA9IFRleHR1cmUuREVGQVVMVF9JTUFHRSwgbWFwcGluZyA9IFRleHR1cmUuREVGQVVMVF9NQVBQSU5HLCB3cmFwUyA9IENsYW1wVG9FZGdlV3JhcHBpbmcsIHdyYXBUID0gQ2xhbXBUb0VkZ2VXcmFwcGluZywgbWFnRmlsdGVyID0gTGluZWFyRmlsdGVyLCBtaW5GaWx0ZXIgPSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsIGZvcm1hdCA9IFJHQkFGb3JtYXQsIHR5cGUgPSBVbnNpZ25lZEJ5dGVUeXBlLCBhbmlzb3Ryb3B5ID0gVGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFksIGNvbG9yU3BhY2UgPSBOb0NvbG9yU3BhY2UgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNUZXh0dXJlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgSUQgb2YgdGhlIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIEBuYW1lIFRleHR1cmUjaWQKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF90ZXh0dXJlSWQgKysgfSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBVVUlEIG9mIHRoZSBtYXRlcmlhbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbmFtZSBvZiB0aGUgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqLwogICAgCQl0aGlzLm5hbWUgPSAnJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4gQSByZWZlcmVuY2UgdG8gdGhlIGRhdGEgc291cmNlIGNhbiBiZQogICAgCQkgKiBzaGFyZWQgYWNyb3NzIHRleHR1cmVzLiBUaGlzIGlzIG9mdGVuIHVzZWZ1bCBpbiBjb250ZXh0IG9mIHNwcml0ZXNoZWV0cwogICAgCQkgKiB3aGVyZSBtdWx0aXBsZSB0ZXh0dXJlcyByZW5kZXIgdGhlIHNhbWUgZGF0YSBidXQgd2l0aCBkaWZmZXJlbnQgdGV4dHVyZQogICAgCQkgKiB0cmFuc2Zvcm1hdGlvbnMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtTb3VyY2V9CiAgICAJCSAqLwogICAgCQl0aGlzLnNvdXJjZSA9IG5ldyBTb3VyY2UoIGltYWdlICk7CgogICAgCQkvKioKICAgIAkJICogQW4gYXJyYXkgaG9sZGluZyB1c2VyLWRlZmluZWQgbWlwbWFwcy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PE9iamVjdD59CiAgICAJCSAqLwogICAgCQl0aGlzLm1pcG1hcHMgPSBbXTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgYXBwbGllZCB0byB0aGUgb2JqZWN0LiBUaGUgdmFsdWUgYFVWTWFwcGluZ2AKICAgIAkJICogaXMgdGhlIGRlZmF1bHQsIHdoZXJlIHRleHR1cmUgb3IgdXYgY29vcmRpbmF0ZXMgYXJlIHVzZWQgdG8gYXBwbHkgdGhlIG1hcC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhVVk1hcHBpbmd8Q3ViZVJlZmxlY3Rpb25NYXBwaW5nfEN1YmVSZWZyYWN0aW9uTWFwcGluZ3xFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZ3xFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZ3xDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyl9CiAgICAJCSAqIEBkZWZhdWx0IFVWTWFwcGluZwogICAgCQkqLwogICAgCQl0aGlzLm1hcHBpbmcgPSBtYXBwaW5nOwoKICAgIAkJLyoqCiAgICAJCSAqIExldHMgeW91IHNlbGVjdCB0aGUgdXYgYXR0cmlidXRlIHRvIG1hcCB0aGUgdGV4dHVyZSB0by4gYDBgIGZvciBgdXZgLAogICAgCQkgKiBgMWAgZm9yIGB1djFgLCBgMmAgZm9yIGB1djJgIGFuZCBgM2AgZm9yIGB1djNgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmNoYW5uZWwgPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZGVmaW5lcyBob3cgdGhlIHRleHR1cmUgaXMgd3JhcHBlZCBob3Jpem9udGFsbHkgYW5kIGNvcnJlc3BvbmRzIHRvCiAgICAJCSAqICpVKiBpbiBVViBtYXBwaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CiAgICAJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKICAgIAkJICovCiAgICAJCXRoaXMud3JhcFMgPSB3cmFwUzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGlzIHdyYXBwZWQgaG9yaXpvbnRhbGx5IGFuZCBjb3JyZXNwb25kcyB0bwogICAgCQkgKiAqViogaW4gVVYgbWFwcGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhSZXBlYXRXcmFwcGluZ3xDbGFtcFRvRWRnZVdyYXBwaW5nfE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcpfQogICAgCQkgKiBAZGVmYXVsdCBDbGFtcFRvRWRnZVdyYXBwaW5nCiAgICAJCSAqLwogICAgCQl0aGlzLndyYXBUID0gd3JhcFQ7CgogICAgCQkvKioKICAgIAkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQogICAgCQkgKiBAZGVmYXVsdCBMaW5lYXJGaWx0ZXIKICAgIAkJICovCiAgICAJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyB0aGUgdGV4dHVyZSBpcyBzYW1wbGVkIHdoZW4gYSB0ZXhlbCBjb3ZlcnMgbGVzcyB0aGFuIG9uZSBwaXhlbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhOZWFyZXN0RmlsdGVyfE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyfE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXJ8TGluZWFyRmlsdGVyfExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXJ8TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyKX0KICAgIAkJICogQGRlZmF1bHQgTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyCiAgICAJCSAqLwogICAgCQl0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbnVtYmVyIG9mIHNhbXBsZXMgdGFrZW4gYWxvbmcgdGhlIGF4aXMgdGhyb3VnaCB0aGUgcGl4ZWwgdGhhdCBoYXMgdGhlCiAgICAJCSAqIGhpZ2hlc3QgZGVuc2l0eSBvZiB0ZXhlbHMuIEJ5IGRlZmF1bHQsIHRoaXMgdmFsdWUgaXMgYDFgLiBBIGhpZ2hlciB2YWx1ZQogICAgCQkgKiBnaXZlcyBhIGxlc3MgYmx1cnJ5IHJlc3VsdCB0aGFuIGEgYmFzaWMgbWlwbWFwLCBhdCB0aGUgY29zdCBvZiBtb3JlCiAgICAJCSAqIHRleHR1cmUgc2FtcGxlcyBiZWluZyB1c2VkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmFuaXNvdHJvcHkgPSBhbmlzb3Ryb3B5OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBmb3JtYXQgb2YgdGhlIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IFJHQkFGb3JtYXQKICAgIAkJICovCiAgICAJCXRoaXMuZm9ybWF0ID0gZm9ybWF0OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkZWZhdWx0IGludGVybmFsIGZvcm1hdCBpcyBkZXJpdmVkIGZyb20ge0BsaW5rIFRleHR1cmUjZm9ybWF0fSBhbmQge0BsaW5rIFRleHR1cmUjdHlwZX0gYW5kCiAgICAJCSAqIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGRhdGEgaXMgZ29pbmcgdG8gYmUgc3RvcmVkIG9uIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIFRoaXMgcHJvcGVydHkgYWxsb3dzIHRvIG92ZXJ3cml0ZSB0aGUgZGVmYXVsdCBmb3JtYXQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/c3RyaW5nfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmludGVybmFsRm9ybWF0ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZGF0YSB0eXBlIG9mIHRoZSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCBVbnNpZ25lZEJ5dGVUeXBlCiAgICAJCSAqLwogICAgCQl0aGlzLnR5cGUgPSB0eXBlOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyBtdWNoIGEgc2luZ2xlIHJlcGV0aXRpb24gb2YgdGhlIHRleHR1cmUgaXMgb2Zmc2V0IGZyb20gdGhlIGJlZ2lubmluZywKICAgIAkJICogaW4gZWFjaCBkaXJlY3Rpb24gVSBhbmQgVi4gVHlwaWNhbCByYW5nZSBpcyBgMC4wYCB0byBgMS4wYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjJ9CiAgICAJCSAqIEBkZWZhdWx0ICgwLDApCiAgICAJCSAqLwogICAgCQl0aGlzLm9mZnNldCA9IG5ldyBWZWN0b3IyKCAwLCAwICk7CgogICAgCQkvKioKICAgIAkJICogSG93IG1hbnkgdGltZXMgdGhlIHRleHR1cmUgaXMgcmVwZWF0ZWQgYWNyb3NzIHRoZSBzdXJmYWNlLCBpbiBlYWNoCiAgICAJCSAqIGRpcmVjdGlvbiBVIGFuZCBWLiBJZiByZXBlYXQgaXMgc2V0IGdyZWF0ZXIgdGhhbiBgMWAgaW4gZWl0aGVyIGRpcmVjdGlvbiwKICAgIAkJICogdGhlIGNvcnJlc3BvbmRpbmcgd3JhcCBwYXJhbWV0ZXIgc2hvdWxkIGFsc28gYmUgc2V0IHRvIGBSZXBlYXRXcmFwcGluZ2AKICAgIAkJICogb3IgYE1pcnJvcmVkUmVwZWF0V3JhcHBpbmdgIHRvIGFjaGlldmUgdGhlIGRlc2lyZWQgdGlsaW5nIGVmZmVjdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjJ9CiAgICAJCSAqIEBkZWZhdWx0ICgxLDEpCiAgICAJCSAqLwogICAgCQl0aGlzLnJlcGVhdCA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgogICAgCQkvKioKICAgIAkJICogVGhlIHBvaW50IGFyb3VuZCB3aGljaCByb3RhdGlvbiBvY2N1cnMuIEEgdmFsdWUgb2YgYCgwLjUsIDAuNSlgIGNvcnJlc3BvbmRzCiAgICAJCSAqIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHRleHR1cmUuIERlZmF1bHQgaXMgYCgwLCAwKWAsIHRoZSBsb3dlciBsZWZ0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yMn0KICAgIAkJICogQGRlZmF1bHQgKDAsMCkKICAgIAkJICovCiAgICAJCXRoaXMuY2VudGVyID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgbXVjaCB0aGUgdGV4dHVyZSBpcyByb3RhdGVkIGFyb3VuZCB0aGUgY2VudGVyIHBvaW50LCBpbiByYWRpYW5zLgogICAgCQkgKiBQb3NpdGl2ZSB2YWx1ZXMgYXJlIGNvdW50ZXItY2xvY2t3aXNlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnJvdGF0aW9uID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIHVwZGF0ZSB0aGUgdGV4dHVyZSdzIHV2LXRyYW5zZm9ybWF0aW9uIHtAbGluayBUZXh0dXJlI21hdHJpeH0KICAgIAkJICogZnJvbSB0aGUgcHJvcGVydGllcyB7QGxpbmsgVGV4dHVyZSNvZmZzZXR9LCB7QGxpbmsgVGV4dHVyZSNyZXBlYXR9LAogICAgCQkgKiB7QGxpbmsgVGV4dHVyZSNyb3RhdGlvbn0sIGFuZCB7QGxpbmsgVGV4dHVyZSNjZW50ZXJ9LgogICAgCQkgKgogICAgCQkgKiBTZXQgdGhpcyB0byBgZmFsc2VgIGlmIHlvdSBhcmUgc3BlY2lmeWluZyB0aGUgdXYtdHJhbnNmb3JtIG1hdHJpeCBkaXJlY3RseS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIHV2LXRyYW5zZm9ybWF0aW9uIG1hdHJpeCBvZiB0aGUgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge01hdHJpeDN9CiAgICAJCSAqLwogICAgCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogU2V0IHRoaXMgdG8gYGZhbHNlYCBpZiB5b3UgYXJlIGNyZWF0aW5nIG1pcG1hcHMgbWFudWFsbHkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIGFscGhhIGNoYW5uZWwsIGlmIHByZXNlbnQsIGlzIG11bHRpcGxpZWQgaW50byB0aGUKICAgIAkJICogY29sb3IgY2hhbm5lbHMgd2hlbiB0aGUgdGV4dHVyZSBpcyB1cGxvYWRlZCB0byB0aGUgR1BVLgogICAgCQkgKgogICAgCQkgKiBOb3RlIHRoYXQgdGhpcyBwcm9wZXJ0eSBoYXMgbm8gZWZmZWN0IHdoZW4gdXNpbmcgYEltYWdlQml0bWFwYC4gWW91IG5lZWQgdG8KICAgIAkJICogY29uZmlndXJlIHByZW11bHRpcGx5IGFscGhhIG9uIGJpdG1hcCBjcmVhdGlvbiBpbnN0ZWFkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSB0ZXh0dXJlIGlzIGZsaXBwZWQgYWxvbmcgdGhlIHZlcnRpY2FsIGF4aXMgd2hlbgogICAgCQkgKiB1cGxvYWRlZCB0byB0aGUgR1BVLgogICAgCQkgKgogICAgCQkgKiBOb3RlIHRoYXQgdGhpcyBwcm9wZXJ0eSBoYXMgbm8gZWZmZWN0IHdoZW4gdXNpbmcgYEltYWdlQml0bWFwYC4gWW91IG5lZWQgdG8KICAgIAkJICogY29uZmlndXJlIHRoZSBmbGlwIG9uIGJpdG1hcCBjcmVhdGlvbiBpbnN0ZWFkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5mbGlwWSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogU3BlY2lmaWVzIHRoZSBhbGlnbm1lbnQgcmVxdWlyZW1lbnRzIGZvciB0aGUgc3RhcnQgb2YgZWFjaCBwaXhlbCByb3cgaW4gbWVtb3J5LgogICAgCQkgKiBUaGUgYWxsb3dhYmxlIHZhbHVlcyBhcmUgYDFgIChieXRlLWFsaWdubWVudCksIGAyYCAocm93cyBhbGlnbmVkIHRvIGV2ZW4tbnVtYmVyZWQgYnl0ZXMpLAogICAgCQkgKiBgNGAgKHdvcmQtYWxpZ25tZW50KSwgYW5kIGA4YCAocm93cyBzdGFydCBvbiBkb3VibGUtd29yZCBib3VuZGFyaWVzKS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgNAogICAgCQkgKi8KICAgIAkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSA0OwkvLyB2YWxpZCB2YWx1ZXM6IDEsIDIsIDQsIDggKHNlZSBodHRwOi8vd3d3Lmtocm9ub3Mub3JnL29wZW5nbGVzL3Nkay9kb2NzL21hbi94aHRtbC9nbFBpeGVsU3RvcmVpLnhtbCkKCiAgICAJCS8qKgogICAgCQkgKiBUZXh0dXJlcyBjb250YWluaW5nIGNvbG9yIGRhdGEgc2hvdWxkIGJlIGFubm90YXRlZCB3aXRoIGBTUkdCQ29sb3JTcGFjZWAgb3IgYExpbmVhclNSR0JDb2xvclNwYWNlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQGRlZmF1bHQgTm9Db2xvclNwYWNlCiAgICAJCSAqLwogICAgCQl0aGlzLmNvbG9yU3BhY2UgPSBjb2xvclNwYWNlOwoKICAgIAkJLyoqCiAgICAJCSAqIEFuIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIHN0b3JlIGN1c3RvbSBkYXRhIGFib3V0IHRoZSB0ZXh0dXJlLiBJdAogICAgCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy51c2VyRGF0YSA9IHt9OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gb25seSB1cGRhdGUgYSBzdWJyZWdpb24gb3Igc3BlY2lmaWMgcm93cyBvZiB0aGUgdGV4dHVyZSAoZm9yIGV4YW1wbGUsIGp1c3QgdGhlCiAgICAJCSAqIGZpcnN0IDMgcm93cykuIFVzZSB0aGUgYGFkZFVwZGF0ZVJhbmdlKClgIGZ1bmN0aW9uIHRvIGFkZCByYW5nZXMgdG8gdGhpcyBhcnJheS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PE9iamVjdD59CiAgICAJCSAqLwogICAgCQl0aGlzLnVwZGF0ZVJhbmdlcyA9IFtdOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgc3RhcnRzIGF0IGAwYCBhbmQgY291bnRzIGhvdyBtYW55IHRpbWVzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy52ZXJzaW9uID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBBIGNhbGxiYWNrIGZ1bmN0aW9uLCBjYWxsZWQgd2hlbiB0aGUgdGV4dHVyZSBpcyB1cGRhdGVkIChlLmcuLCB3aGVuCiAgICAJCSAqIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBoYXMgYmVlbiBzZXQgdG8gdHJ1ZSBhbmQgdGhlbiB0aGUgdGV4dHVyZSBpcyB1c2VkKS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9GdW5jdGlvbn0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5vblVwZGF0ZSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogQW4gb3B0aW9uYWwgYmFjayByZWZlcmVuY2UgdG8gdGhlIHRleHR1cmVzIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KFJlbmRlclRhcmdldHxXZWJHTFJlbmRlclRhcmdldCl9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMucmVuZGVyVGFyZ2V0ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBJbmRpY2F0ZXMgd2hldGhlciBhIHRleHR1cmUgYmVsb25ncyB0byBhIHJlbmRlciB0YXJnZXQgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIEluZGljYXRlcyBpZiBhIHRleHR1cmUgc2hvdWxkIGJlIGhhbmRsZWQgbGlrZSBhIHRleHR1cmUgYXJyYXkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuaXNBcnJheVRleHR1cmUgPSBpbWFnZSAmJiBpbWFnZS5kZXB0aCAmJiBpbWFnZS5kZXB0aCA+IDEgPyB0cnVlIDogZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhpcyB0ZXh0dXJlIHNob3VsZCBiZSBwcm9jZXNzZWQgYnkgYFBNUkVNR2VuZXJhdG9yYCBvciBub3QKICAgIAkJICogKG9ubHkgcmVsZXZhbnQgZm9yIHJlbmRlciB0YXJnZXQgdGV4dHVyZXMpLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5wbXJlbVZlcnNpb24gPSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCiAgICAJICovCiAgICAJZ2V0IHdpZHRoKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLng7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCiAgICAJICovCiAgICAJZ2V0IGhlaWdodCgpIHsKCiAgICAJCXJldHVybiB0aGlzLnNvdXJjZS5nZXRTaXplKCBfdGVtcFZlYzMgKS55OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSBkZXB0aCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCiAgICAJICovCiAgICAJZ2V0IGRlcHRoKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLno7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGltYWdlIG9iamVjdCBob2xkaW5nIHRoZSB0ZXh0dXJlIGRhdGEuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7P09iamVjdH0KICAgIAkgKi8KICAgIAlnZXQgaW1hZ2UoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zb3VyY2UuZGF0YTsKCiAgICAJfQoKICAgIAlzZXQgaW1hZ2UoIHZhbHVlID0gbnVsbCApIHsKCiAgICAJCXRoaXMuc291cmNlLmRhdGEgPSB2YWx1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBVcGRhdGVzIHRoZSB0ZXh0dXJlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBmcm9tIHRoZSBmcm9tIHRoZSBwcm9wZXJ0aWVzIHtAbGluayBUZXh0dXJlI29mZnNldH0sCiAgICAJICoge0BsaW5rIFRleHR1cmUjcmVwZWF0fSwge0BsaW5rIFRleHR1cmUjcm90YXRpb259LCBhbmQge0BsaW5rIFRleHR1cmUjY2VudGVyfS4KICAgIAkgKi8KICAgIAl1cGRhdGVNYXRyaXgoKSB7CgogICAgCQl0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSggdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSwgdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueSwgdGhpcy5yb3RhdGlvbiwgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgYSByYW5nZSBvZiBkYXRhIGluIHRoZSBkYXRhIHRleHR1cmUgdG8gYmUgdXBkYXRlZCBvbiB0aGUgR1BVLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gUG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgdXBkYXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIFRoZSBudW1iZXIgb2YgY29tcG9uZW50cyB0byB1cGRhdGUuCiAgICAJICovCiAgICAJYWRkVXBkYXRlUmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCiAgICAJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDbGVhcnMgdGhlIHVwZGF0ZSByYW5nZXMuCiAgICAJICovCiAgICAJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgogICAgCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgdGV4dHVyZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VGV4dHVyZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB0ZXh0dXJlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1RleHR1cmV9IHNvdXJjZSAtIFRoZSB0ZXh0dXJlIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7VGV4dHVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCiAgICAJCXRoaXMuc291cmNlID0gc291cmNlLnNvdXJjZTsKICAgIAkJdGhpcy5taXBtYXBzID0gc291cmNlLm1pcG1hcHMuc2xpY2UoIDAgKTsKCiAgICAJCXRoaXMubWFwcGluZyA9IHNvdXJjZS5tYXBwaW5nOwogICAgCQl0aGlzLmNoYW5uZWwgPSBzb3VyY2UuY2hhbm5lbDsKCiAgICAJCXRoaXMud3JhcFMgPSBzb3VyY2Uud3JhcFM7CiAgICAJCXRoaXMud3JhcFQgPSBzb3VyY2Uud3JhcFQ7CgogICAgCQl0aGlzLm1hZ0ZpbHRlciA9IHNvdXJjZS5tYWdGaWx0ZXI7CiAgICAJCXRoaXMubWluRmlsdGVyID0gc291cmNlLm1pbkZpbHRlcjsKCiAgICAJCXRoaXMuYW5pc290cm9weSA9IHNvdXJjZS5hbmlzb3Ryb3B5OwoKICAgIAkJdGhpcy5mb3JtYXQgPSBzb3VyY2UuZm9ybWF0OwogICAgCQl0aGlzLmludGVybmFsRm9ybWF0ID0gc291cmNlLmludGVybmFsRm9ybWF0OwogICAgCQl0aGlzLnR5cGUgPSBzb3VyY2UudHlwZTsKCiAgICAJCXRoaXMub2Zmc2V0LmNvcHkoIHNvdXJjZS5vZmZzZXQgKTsKICAgIAkJdGhpcy5yZXBlYXQuY29weSggc291cmNlLnJlcGVhdCApOwogICAgCQl0aGlzLmNlbnRlci5jb3B5KCBzb3VyY2UuY2VudGVyICk7CiAgICAJCXRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CgogICAgCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKICAgIAkJdGhpcy5tYXRyaXguY29weSggc291cmNlLm1hdHJpeCApOwoKICAgIAkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBzb3VyY2UuZ2VuZXJhdGVNaXBtYXBzOwogICAgCQl0aGlzLnByZW11bHRpcGx5QWxwaGEgPSBzb3VyY2UucHJlbXVsdGlwbHlBbHBoYTsKICAgIAkJdGhpcy5mbGlwWSA9IHNvdXJjZS5mbGlwWTsKICAgIAkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSBzb3VyY2UudW5wYWNrQWxpZ25tZW50OwogICAgCQl0aGlzLmNvbG9yU3BhY2UgPSBzb3VyY2UuY29sb3JTcGFjZTsKCiAgICAJCXRoaXMucmVuZGVyVGFyZ2V0ID0gc291cmNlLnJlbmRlclRhcmdldDsKICAgIAkJdGhpcy5pc1JlbmRlclRhcmdldFRleHR1cmUgPSBzb3VyY2UuaXNSZW5kZXJUYXJnZXRUZXh0dXJlOwogICAgCQl0aGlzLmlzQXJyYXlUZXh0dXJlID0gc291cmNlLmlzQXJyYXlUZXh0dXJlOwoKICAgIAkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKICAgIAkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdGV4dHVyZSdzIHByb3BlcnRpZXMgYmFzZWQgb24gYHZhbHVlc2AuCiAgICAJICogQHBhcmFtIHtPYmplY3R9IHZhbHVlcyAtIEEgY29udGFpbmVyIHdpdGggdGV4dHVyZSBwYXJhbWV0ZXJzLgogICAgCSAqLwogICAgCXNldFZhbHVlcyggdmFsdWVzICkgewoKICAgIAkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCiAgICAJCQljb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1sga2V5IF07CgogICAgCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5UZXh0dXJlLnNldFZhbHVlcygpOiBwYXJhbWV0ZXIgJyR7IGtleSB9JyBoYXMgdmFsdWUgb2YgdW5kZWZpbmVkLmAgKTsKICAgIAkJCQljb250aW51ZTsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgY3VycmVudFZhbHVlID0gdGhpc1sga2V5IF07CgogICAgCQkJaWYgKCBjdXJyZW50VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCBgVEhSRUUuVGV4dHVyZS5zZXRWYWx1ZXMoKTogcHJvcGVydHkgJyR7IGtleSB9JyBkb2VzIG5vdCBleGlzdC5gICk7CiAgICAJCQkJY29udGludWU7CgogICAgCQkJfQoKICAgIAkJCWlmICggKCBjdXJyZW50VmFsdWUgJiYgbmV3VmFsdWUgKSAmJiAoIGN1cnJlbnRWYWx1ZS5pc1ZlY3RvcjIgJiYgbmV3VmFsdWUuaXNWZWN0b3IyICkgKSB7CgogICAgCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKICAgIAkJCX0gZWxzZSBpZiAoICggY3VycmVudFZhbHVlICYmIG5ld1ZhbHVlICkgJiYgKCBjdXJyZW50VmFsdWUuaXNWZWN0b3IzICYmIG5ld1ZhbHVlLmlzVmVjdG9yMyApICkgewoKICAgIAkJCQljdXJyZW50VmFsdWUuY29weSggbmV3VmFsdWUgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCAoIGN1cnJlbnRWYWx1ZSAmJiBuZXdWYWx1ZSApICYmICggY3VycmVudFZhbHVlLmlzTWF0cml4MyAmJiBuZXdWYWx1ZS5pc01hdHJpeDMgKSApIHsKCiAgICAJCQkJY3VycmVudFZhbHVlLmNvcHkoIG5ld1ZhbHVlICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJdGhpc1sga2V5IF0gPSBuZXdWYWx1ZTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VyaWFsaXplcyB0aGUgdGV4dHVyZSBpbnRvIEpTT04uCiAgICAJICoKICAgIAkgKiBAcGFyYW0gez8oT2JqZWN0fHN0cmluZyl9IG1ldGEgLSBBbiBvcHRpb25hbCB2YWx1ZSBob2xkaW5nIG1ldGEgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNlcmlhbGl6YXRpb24uCiAgICAJICogQHJldHVybiB7T2JqZWN0fSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCB0ZXh0dXJlLgogICAgCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KICAgIAkgKi8KICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCiAgICAJCWlmICggISBpc1Jvb3RPYmplY3QgJiYgbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlyZXR1cm4gbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF07CgogICAgCQl9CgogICAgCQljb25zdCBvdXRwdXQgPSB7CgogICAgCQkJbWV0YWRhdGE6IHsKICAgIAkJCQl2ZXJzaW9uOiA0LjcsCiAgICAJCQkJdHlwZTogJ1RleHR1cmUnLAogICAgCQkJCWdlbmVyYXRvcjogJ1RleHR1cmUudG9KU09OJwogICAgCQkJfSwKCiAgICAJCQl1dWlkOiB0aGlzLnV1aWQsCiAgICAJCQluYW1lOiB0aGlzLm5hbWUsCgogICAgCQkJaW1hZ2U6IHRoaXMuc291cmNlLnRvSlNPTiggbWV0YSApLnV1aWQsCgogICAgCQkJbWFwcGluZzogdGhpcy5tYXBwaW5nLAogICAgCQkJY2hhbm5lbDogdGhpcy5jaGFubmVsLAoKICAgIAkJCXJlcGVhdDogWyB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55IF0sCiAgICAJCQlvZmZzZXQ6IFsgdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSBdLAogICAgCQkJY2VudGVyOiBbIHRoaXMuY2VudGVyLngsIHRoaXMuY2VudGVyLnkgXSwKICAgIAkJCXJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAoKICAgIAkJCXdyYXA6IFsgdGhpcy53cmFwUywgdGhpcy53cmFwVCBdLAoKICAgIAkJCWZvcm1hdDogdGhpcy5mb3JtYXQsCiAgICAJCQlpbnRlcm5hbEZvcm1hdDogdGhpcy5pbnRlcm5hbEZvcm1hdCwKICAgIAkJCXR5cGU6IHRoaXMudHlwZSwKICAgIAkJCWNvbG9yU3BhY2U6IHRoaXMuY29sb3JTcGFjZSwKCiAgICAJCQltaW5GaWx0ZXI6IHRoaXMubWluRmlsdGVyLAogICAgCQkJbWFnRmlsdGVyOiB0aGlzLm1hZ0ZpbHRlciwKICAgIAkJCWFuaXNvdHJvcHk6IHRoaXMuYW5pc290cm9weSwKCiAgICAJCQlmbGlwWTogdGhpcy5mbGlwWSwKCiAgICAJCQlnZW5lcmF0ZU1pcG1hcHM6IHRoaXMuZ2VuZXJhdGVNaXBtYXBzLAogICAgCQkJcHJlbXVsdGlwbHlBbHBoYTogdGhpcy5wcmVtdWx0aXBseUFscGhhLAogICAgCQkJdW5wYWNrQWxpZ25tZW50OiB0aGlzLnVucGFja0FsaWdubWVudAoKICAgIAkJfTsKCiAgICAJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb3V0cHV0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCiAgICAJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgogICAgCQkJbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gPSBvdXRwdXQ7CgogICAgCQl9CgogICAgCQlyZXR1cm4gb3V0cHV0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwogICAgCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgogICAgCSAqCiAgICAJICogQGZpcmVzIFRleHR1cmUjZGlzcG9zZQogICAgCSAqLwogICAgCWRpc3Bvc2UoKSB7CgogICAgCQkvKioKICAgIAkJICogRmlyZXMgd2hlbiB0aGUgdGV4dHVyZSBoYXMgYmVlbiBkaXNwb3NlZCBvZi4KICAgIAkJICoKICAgIAkJICogQGV2ZW50IFRleHR1cmUjZGlzcG9zZQogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNmb3JtcyB0aGUgZ2l2ZW4gdXYgdmVjdG9yIHdpdGggdGhlIHRleHR1cmVzIHV2IHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdXYgLSBUaGUgdXYgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IFRoZSB0cmFuc2Zvcm1lZCB1diB2ZWN0b3IuCiAgICAJICovCiAgICAJdHJhbnNmb3JtVXYoIHV2ICkgewoKICAgIAkJaWYgKCB0aGlzLm1hcHBpbmcgIT09IFVWTWFwcGluZyApIHJldHVybiB1djsKCiAgICAJCXV2LmFwcGx5TWF0cml4MyggdGhpcy5tYXRyaXggKTsKCiAgICAJCWlmICggdXYueCA8IDAgfHwgdXYueCA+IDEgKSB7CgogICAgCQkJc3dpdGNoICggdGhpcy53cmFwUyApIHsKCiAgICAJCQkJY2FzZSBSZXBlYXRXcmFwcGluZzoKCiAgICAJCQkJCXV2LnggPSB1di54IC0gTWF0aC5mbG9vciggdXYueCApOwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSBDbGFtcFRvRWRnZVdyYXBwaW5nOgoKICAgIAkJCQkJdXYueCA9IHV2LnggPCAwID8gMCA6IDE7CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6CgogICAgCQkJCQlpZiAoIE1hdGguYWJzKCBNYXRoLmZsb29yKCB1di54ICkgJSAyICkgPT09IDEgKSB7CgogICAgCQkJCQkJdXYueCA9IE1hdGguY2VpbCggdXYueCApIC0gdXYueDsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJdXYueCA9IHV2LnggLSBNYXRoLmZsb29yKCB1di54ICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlicmVhazsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIHV2LnkgPCAwIHx8IHV2LnkgPiAxICkgewoKICAgIAkJCXN3aXRjaCAoIHRoaXMud3JhcFQgKSB7CgogICAgCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgogICAgCQkJCQl1di55ID0gdXYueSAtIE1hdGguZmxvb3IoIHV2LnkgKTsKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCiAgICAJCQkJCXV2LnkgPSB1di55IDwgMCA/IDAgOiAxOwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKICAgIAkJCQkJaWYgKCBNYXRoLmFicyggTWF0aC5mbG9vciggdXYueSApICUgMiApID09PSAxICkgewoKICAgIAkJCQkJCXV2LnkgPSBNYXRoLmNlaWwoIHV2LnkgKSAtIHV2Lnk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCXV2LnkgPSB1di55IC0gTWF0aC5mbG9vciggdXYueSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmZsaXBZICkgewoKICAgIAkJCXV2LnkgPSAxIC0gdXYueTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB1djsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXR0aW5nIHRoaXMgcHJvcGVydHkgdG8gYHRydWVgIGluZGljYXRlcyB0aGUgZW5naW5lIHRoZSB0ZXh0dXJlCiAgICAJICogbXVzdCBiZSB1cGRhdGVkIGluIHRoZSBuZXh0IHJlbmRlci4gVGhpcyB0cmlnZ2VycyBhIHRleHR1cmUgdXBsb2FkCiAgICAJICogdG8gdGhlIEdQVSBhbmQgZW5zdXJlcyBjb3JyZWN0IHRleHR1cmUgcGFyYW1ldGVyIGNvbmZpZ3VyYXRpb24uCiAgICAJICoKICAgIAkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkgKiBAZGVmYXVsdCBmYWxzZQogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICAgIAkgKi8KICAgIAlzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKICAgIAkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQl0aGlzLnZlcnNpb24gKys7CiAgICAJCQl0aGlzLnNvdXJjZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0dGluZyB0aGlzIHByb3BlcnR5IHRvIGB0cnVlYCBpbmRpY2F0ZXMgdGhlIGVuZ2luZSB0aGUgUE1SRU0KICAgIAkgKiBtdXN0IGJlIHJlZ2VuZXJhdGVkLgogICAgCSAqCiAgICAJICogQHR5cGUge2Jvb2xlYW59CiAgICAJICogQGRlZmF1bHQgZmFsc2UKICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAgICAJICovCiAgICAJc2V0IG5lZWRzUE1SRU1VcGRhdGUoIHZhbHVlICkgewoKICAgIAkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQl0aGlzLnBtcmVtVmVyc2lvbiArKzsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IGltYWdlIGZvciBhbGwgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQHR5cGUgez9JbWFnZX0KICAgICAqIEBkZWZhdWx0IG51bGwKICAgICAqLwogICAgVGV4dHVyZS5ERUZBVUxUX0lNQUdFID0gbnVsbDsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IG1hcHBpbmcgZm9yIGFsbCB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGRlZmF1bHQgVVZNYXBwaW5nCiAgICAgKi8KICAgIFRleHR1cmUuREVGQVVMVF9NQVBQSU5HID0gVVZNYXBwaW5nOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgYW5pc290cm9weSB2YWx1ZSBmb3IgYWxsIHRleHR1cmVzLgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KICAgIFRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZID0gMTsKCiAgICAvKioKICAgICAqIENsYXNzIHJlcHJlc2VudGluZyBhIDREIHZlY3Rvci4gQSA0RCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCBxdWFkcnVwbGV0IG9mIG51bWJlcnMKICAgICAqIChsYWJlbGVkIHgsIHksIHogYW5kIHcpLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgogICAgICoKICAgICAqIC0gQSBwb2ludCBpbiA0RCBzcGFjZS4KICAgICAqIC0gQSBkaXJlY3Rpb24gYW5kIGxlbmd0aCBpbiA0RCBzcGFjZS4gSW4gdGhyZWUuanMgdGhlIGxlbmd0aCB3aWxsCiAgICAgKiBhbHdheXMgYmUgdGhlIEV1Y2xpZGVhbiBkaXN0YW5jZShzdHJhaWdodC1saW5lIGRpc3RhbmNlKSBmcm9tIGAoMCwgMCwgMCwgMClgIHRvIGAoeCwgeSwgeiwgdylgCiAgICAgKiBhbmQgdGhlIGRpcmVjdGlvbiBpcyBhbHNvIG1lYXN1cmVkIGZyb20gYCgwLCAwLCAwLCAwKWAgdG93YXJkcyBgKHgsIHksIHosIHcpYC4KICAgICAqIC0gQW55IGFyYml0cmFyeSBvcmRlcmVkIHF1YWRydXBsZXQgb2YgbnVtYmVycy4KICAgICAqCiAgICAgKiBUaGVyZSBhcmUgb3RoZXIgdGhpbmdzIGEgNEQgdmVjdG9yIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCwgaG93ZXZlciB0aGVzZQogICAgICogYXJlIHRoZSBtb3N0IGNvbW1vbiB1c2VzIGluICp0aHJlZS5qcyouCiAgICAgKgogICAgICogSXRlcmF0aW5nIHRocm91Z2ggYSB2ZWN0b3IgaW5zdGFuY2Ugd2lsbCB5aWVsZCBpdHMgY29tcG9uZW50cyBgKHgsIHksIHosIHcpYCBpbgogICAgICogdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgYSA9IG5ldyBUSFJFRS5WZWN0b3I0KCAwLCAxLCAwLCAwICk7CiAgICAgKgogICAgICogLy9ubyBhcmd1bWVudHM7IHdpbGwgYmUgaW5pdGlhbGlzZWQgdG8gKDAsIDAsIDAsIDEpCiAgICAgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjQoICk7CiAgICAgKgogICAgICogY29uc3QgZCA9IGEuZG90KCBiICk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgVmVjdG9yNCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgNEQgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3PTFdIC0gVGhlIHcgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCVZlY3RvcjQucHJvdG90eXBlLmlzVmVjdG9yNCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLnggPSB4OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB5IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy55ID0geTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgeiB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMueiA9IHo7CgogICAgCQkvKioKICAgIAkJICogVGhlIHcgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLncgPSB3OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFsaWFzIGZvciB7QGxpbmsgVmVjdG9yNCN6fS4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICovCiAgICAJZ2V0IHdpZHRoKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuejsKCiAgICAJfQoKICAgIAlzZXQgd2lkdGgoIHZhbHVlICkgewoKICAgIAkJdGhpcy56ID0gdmFsdWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3I0I3d9LgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKi8KICAgIAlnZXQgaGVpZ2h0KCkgewoKICAgIAkJcmV0dXJuIHRoaXMudzsKCiAgICAJfQoKICAgIAlzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCiAgICAJCXRoaXMudyA9IHZhbHVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBvZiB0aGUgeiBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgb2YgdGhlIHcgY29tcG9uZW50LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldCggeCwgeSwgeiwgdyApIHsKCiAgICAJCXRoaXMueCA9IHg7CiAgICAJCXRoaXMueSA9IHk7CiAgICAJCXRoaXMueiA9IHo7CiAgICAJCXRoaXMudyA9IHc7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2FtZSB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgdmFsdWUgdG8gc2V0IGZvciBhbGwgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnggPSBzY2FsYXI7CiAgICAJCXRoaXMueSA9IHNjYWxhcjsKICAgIAkJdGhpcy56ID0gc2NhbGFyOwogICAgCQl0aGlzLncgPSBzY2FsYXI7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IncyB4IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRYKCB4ICkgewoKICAgIAkJdGhpcy54ID0geDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHkgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFkoIHkgKSB7CgogICAgCQl0aGlzLnkgPSB5OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yJ3MgeiBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0WiggeiApIHsKCiAgICAJCXRoaXMueiA9IHo7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IncyB3IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRXKCB3ICkgewoKICAgIAkJdGhpcy53ID0gdzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFsbG93cyB0byBzZXQgYSB2ZWN0b3IgY29tcG9uZW50IHdpdGggYW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwKICAgIAkgKiBgMmAgZXF1YWxzIHRvIHosIGAzYCBlcXVhbHMgdG8gdy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldENvbXBvbmVudCggaW5kZXgsIHZhbHVlICkgewoKICAgIAkJc3dpdGNoICggaW5kZXggKSB7CgogICAgCQkJY2FzZSAwOiB0aGlzLnggPSB2YWx1ZTsgYnJlYWs7CiAgICAJCQljYXNlIDE6IHRoaXMueSA9IHZhbHVlOyBicmVhazsKICAgIAkJCWNhc2UgMjogdGhpcy56ID0gdmFsdWU7IGJyZWFrOwogICAgCQkJY2FzZSAzOiB0aGlzLncgPSB2YWx1ZTsgYnJlYWs7CiAgICAJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwKICAgIAkgKiBgMmAgZXF1YWxzIHRvIHosIGAzYCBlcXVhbHMgdG8gdy4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IEEgdmVjdG9yIGNvbXBvbmVudCB2YWx1ZS4KICAgIAkgKi8KICAgIAlnZXRDb21wb25lbnQoIGluZGV4ICkgewoKICAgIAkJc3dpdGNoICggaW5kZXggKSB7CgogICAgCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwogICAgCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwogICAgCQkJY2FzZSAyOiByZXR1cm4gdGhpcy56OwogICAgCQkJY2FzZSAzOiByZXR1cm4gdGhpcy53OwogICAgCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IHZlY3RvciB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN8VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljb3B5KCB2ICkgewoKICAgIAkJdGhpcy54ID0gdi54OwogICAgCQl0aGlzLnkgPSB2Lnk7CiAgICAJCXRoaXMueiA9IHYuejsKICAgIAkJdGhpcy53ID0gKCB2LncgIT09IHVuZGVmaW5lZCApID8gdi53IDogMTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBhZGQuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkKCB2ICkgewoKICAgIAkJdGhpcy54ICs9IHYueDsKICAgIAkJdGhpcy55ICs9IHYueTsKICAgIAkJdGhpcy56ICs9IHYuejsKICAgIAkJdGhpcy53ICs9IHYudzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB0byBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIGFkZC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhZGRTY2FsYXIoIHMgKSB7CgogICAgCQl0aGlzLnggKz0gczsKICAgIAkJdGhpcy55ICs9IHM7CiAgICAJCXRoaXMueiArPSBzOwogICAgCQl0aGlzLncgKz0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQl0aGlzLnggPSBhLnggKyBiLng7CiAgICAJCXRoaXMueSA9IGEueSArIGIueTsKICAgIAkJdGhpcy56ID0gYS56ICsgYi56OwogICAgCQl0aGlzLncgPSBhLncgKyBiLnc7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3Igc2NhbGVkIGJ5IHRoZSBnaXZlbiBmYWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgZmFjdG9yIHRoYXQgc2NhbGVzIGB2YC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgogICAgCQl0aGlzLnggKz0gdi54ICogczsKICAgIAkJdGhpcy55ICs9IHYueSAqIHM7CiAgICAJCXRoaXMueiArPSB2LnogKiBzOwogICAgCQl0aGlzLncgKz0gdi53ICogczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gc3VidHJhY3QuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc3ViKCB2ICkgewoKICAgIAkJdGhpcy54IC09IHYueDsKICAgIAkJdGhpcy55IC09IHYueTsKICAgIAkJdGhpcy56IC09IHYuejsKICAgIAkJdGhpcy53IC09IHYudzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIGZyb20gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBzdWJ0cmFjdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzdWJTY2FsYXIoIHMgKSB7CgogICAgCQl0aGlzLnggLT0gczsKICAgIAkJdGhpcy55IC09IHM7CiAgICAJCXRoaXMueiAtPSBzOwogICAgCQl0aGlzLncgLT0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc3ViVmVjdG9ycyggYSwgYiApIHsKCiAgICAJCXRoaXMueCA9IGEueCAtIGIueDsKICAgIAkJdGhpcy55ID0gYS55IC0gYi55OwogICAgCQl0aGlzLnogPSBhLnogLSBiLno7CiAgICAJCXRoaXMudyA9IGEudyAtIGIudzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIG11bHRpcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW11bHRpcGx5KCB2ICkgewoKICAgIAkJdGhpcy54ICo9IHYueDsKICAgIAkJdGhpcy55ICo9IHYueTsKICAgIAkJdGhpcy56ICo9IHYuejsKICAgIAkJdGhpcy53ICo9IHYudzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKICAgIAkJdGhpcy54ICo9IHNjYWxhcjsKICAgIAkJdGhpcy55ICo9IHNjYWxhcjsKICAgIAkJdGhpcy56ICo9IHNjYWxhcjsKICAgIAkJdGhpcy53ICo9IHNjYWxhcjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbSApIHsKCiAgICAJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLnosIHcgPSB0aGlzLnc7CiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6ICsgZVsgMTIgXSAqIHc7CiAgICAJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogeiArIGVbIDEzIF0gKiB3OwogICAgCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSAqIHc7CiAgICAJCXRoaXMudyA9IGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICogdzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZGl2aWRlKCB2ICkgewoKICAgIAkJdGhpcy54IC89IHYueDsKICAgIAkJdGhpcy55IC89IHYueTsKICAgIAkJdGhpcy56IC89IHYuejsKICAgIAkJdGhpcy53IC89IHYudzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeCwgeSBhbmQgeiBjb21wb25lbnRzIG9mIHRoaXMKICAgIAkgKiB2ZWN0b3IgdG8gdGhlIHF1YXRlcm5pb24ncyBheGlzIGFuZCB3IHRvIHRoZSBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBRdWF0ZXJuaW9uIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRBeGlzQW5nbGVGcm9tUXVhdGVybmlvbiggcSApIHsKCiAgICAJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9xdWF0ZXJuaW9uVG9BbmdsZS9pbmRleC5odG0KCiAgICAJCS8vIHEgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgogICAgCQl0aGlzLncgPSAyICogTWF0aC5hY29zKCBxLncgKTsKCiAgICAJCWNvbnN0IHMgPSBNYXRoLnNxcnQoIDEgLSBxLncgKiBxLncgKTsKCiAgICAJCWlmICggcyA8IDAuMDAwMSApIHsKCiAgICAJCQl0aGlzLnggPSAxOwogICAgCQkJdGhpcy55ID0gMDsKICAgIAkJCXRoaXMueiA9IDA7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMueCA9IHEueCAvIHM7CiAgICAJCQl0aGlzLnkgPSBxLnkgLyBzOwogICAgCQkJdGhpcy56ID0gcS56IC8gczsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHgsIHkgYW5kIHogY29tcG9uZW50cyBvZiB0aGlzCiAgICAJICogdmVjdG9yIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uIGFuZCB3IHRvIHRoZSBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEEgNHg0IG1hdHJpeCBvZiB3aGljaCB0aGUgdXBwZXIgbGVmdCAzeDMgbWF0cml4IGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXguCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0QXhpc0FuZ2xlRnJvbVJvdGF0aW9uTWF0cml4KCBtICkgewoKICAgIAkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL21hdHJpeFRvQW5nbGUvaW5kZXguaHRtCgogICAgCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKICAgIAkJbGV0IGFuZ2xlLCB4LCB5LCB6OyAvLyB2YXJpYWJsZXMgZm9yIHJlc3VsdAogICAgCQljb25zdCBlcHNpbG9uID0gMC4wMSwJCS8vIG1hcmdpbiB0byBhbGxvdyBmb3Igcm91bmRpbmcgZXJyb3JzCiAgICAJCQllcHNpbG9uMiA9IDAuMSwJCS8vIG1hcmdpbiB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIDAgYW5kIDE4MCBkZWdyZWVzCgogICAgCQkJdGUgPSBtLmVsZW1lbnRzLAoKICAgIAkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCiAgICAJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAogICAgCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF07CgogICAgCQlpZiAoICggTWF0aC5hYnMoIG0xMiAtIG0yMSApIDwgZXBzaWxvbiApICYmCiAgICAJCSAgICAgKCBNYXRoLmFicyggbTEzIC0gbTMxICkgPCBlcHNpbG9uICkgJiYKICAgIAkJICAgICAoIE1hdGguYWJzKCBtMjMgLSBtMzIgKSA8IGVwc2lsb24gKSApIHsKCiAgICAJCQkvLyBzaW5ndWxhcml0eSBmb3VuZAogICAgCQkJLy8gZmlyc3QgY2hlY2sgZm9yIGlkZW50aXR5IG1hdHJpeCB3aGljaCBtdXN0IGhhdmUgKzEgZm9yIGFsbCB0ZXJtcwogICAgCQkJLy8gaW4gbGVhZGluZyBkaWFnb25hbCBhbmQgemVybyBpbiBvdGhlciB0ZXJtcwoKICAgIAkJCWlmICggKCBNYXRoLmFicyggbTEyICsgbTIxICkgPCBlcHNpbG9uMiApICYmCiAgICAJCQkgICAgICggTWF0aC5hYnMoIG0xMyArIG0zMSApIDwgZXBzaWxvbjIgKSAmJgogICAgCQkJICAgICAoIE1hdGguYWJzKCBtMjMgKyBtMzIgKSA8IGVwc2lsb24yICkgJiYKICAgIAkJCSAgICAgKCBNYXRoLmFicyggbTExICsgbTIyICsgbTMzIC0gMyApIDwgZXBzaWxvbjIgKSApIHsKCiAgICAJCQkJLy8gdGhpcyBzaW5ndWxhcml0eSBpcyBpZGVudGl0eSBtYXRyaXggc28gYW5nbGUgPSAwCgogICAgCQkJCXRoaXMuc2V0KCAxLCAwLCAwLCAwICk7CgogICAgCQkJCXJldHVybiB0aGlzOyAvLyB6ZXJvIGFuZ2xlLCBhcmJpdHJhcnkgYXhpcwoKICAgIAkJCX0KCiAgICAJCQkvLyBvdGhlcndpc2UgdGhpcyBzaW5ndWxhcml0eSBpcyBhbmdsZSA9IDE4MAoKICAgIAkJCWFuZ2xlID0gTWF0aC5QSTsKCiAgICAJCQljb25zdCB4eCA9ICggbTExICsgMSApIC8gMjsKICAgIAkJCWNvbnN0IHl5ID0gKCBtMjIgKyAxICkgLyAyOwogICAgCQkJY29uc3QgenogPSAoIG0zMyArIDEgKSAvIDI7CiAgICAJCQljb25zdCB4eSA9ICggbTEyICsgbTIxICkgLyA0OwogICAgCQkJY29uc3QgeHogPSAoIG0xMyArIG0zMSApIC8gNDsKICAgIAkJCWNvbnN0IHl6ID0gKCBtMjMgKyBtMzIgKSAvIDQ7CgogICAgCQkJaWYgKCAoIHh4ID4geXkgKSAmJiAoIHh4ID4genogKSApIHsKCiAgICAJCQkJLy8gbTExIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCiAgICAJCQkJaWYgKCB4eCA8IGVwc2lsb24gKSB7CgogICAgCQkJCQl4ID0gMDsKICAgIAkJCQkJeSA9IDAuNzA3MTA2NzgxOwogICAgCQkJCQl6ID0gMC43MDcxMDY3ODE7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl4ID0gTWF0aC5zcXJ0KCB4eCApOwogICAgCQkJCQl5ID0geHkgLyB4OwogICAgCQkJCQl6ID0geHogLyB4OwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggeXkgPiB6eiApIHsKCiAgICAJCQkJLy8gbTIyIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCiAgICAJCQkJaWYgKCB5eSA8IGVwc2lsb24gKSB7CgogICAgCQkJCQl4ID0gMC43MDcxMDY3ODE7CiAgICAJCQkJCXkgPSAwOwogICAgCQkJCQl6ID0gMC43MDcxMDY3ODE7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl5ID0gTWF0aC5zcXJ0KCB5eSApOwogICAgCQkJCQl4ID0geHkgLyB5OwogICAgCQkJCQl6ID0geXogLyB5OwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJLy8gbTMzIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0gc28gYmFzZSByZXN1bHQgb24gdGhpcwoKICAgIAkJCQlpZiAoIHp6IDwgZXBzaWxvbiApIHsKCiAgICAJCQkJCXggPSAwLjcwNzEwNjc4MTsKICAgIAkJCQkJeSA9IDAuNzA3MTA2NzgxOwogICAgCQkJCQl6ID0gMDsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXogPSBNYXRoLnNxcnQoIHp6ICk7CiAgICAJCQkJCXggPSB4eiAvIHo7CiAgICAJCQkJCXkgPSB5eiAvIHo7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJdGhpcy5zZXQoIHgsIHksIHosIGFuZ2xlICk7CgogICAgCQkJcmV0dXJuIHRoaXM7IC8vIHJldHVybiAxODAgZGVnIHJvdGF0aW9uCgogICAgCQl9CgogICAgCQkvLyBhcyB3ZSBoYXZlIHJlYWNoZWQgaGVyZSB0aGVyZSBhcmUgbm8gc2luZ3VsYXJpdGllcyBzbyB3ZSBjYW4gaGFuZGxlIG5vcm1hbGx5CgogICAgCQlsZXQgcyA9IE1hdGguc3FydCggKCBtMzIgLSBtMjMgKSAqICggbTMyIC0gbTIzICkgKwogICAgCQkJKCBtMTMgLSBtMzEgKSAqICggbTEzIC0gbTMxICkgKwogICAgCQkJKCBtMjEgLSBtMTIgKSAqICggbTIxIC0gbTEyICkgKTsgLy8gdXNlZCB0byBub3JtYWxpemUKCiAgICAJCWlmICggTWF0aC5hYnMoIHMgKSA8IDAuMDAxICkgcyA9IDE7CgogICAgCQkvLyBwcmV2ZW50IGRpdmlkZSBieSB6ZXJvLCBzaG91bGQgbm90IGhhcHBlbiBpZiBtYXRyaXggaXMgb3J0aG9nb25hbCBhbmQgc2hvdWxkIGJlCiAgICAJCS8vIGNhdWdodCBieSBzaW5ndWxhcml0eSB0ZXN0IGFib3ZlLCBidXQgSSd2ZSBsZWZ0IGl0IGluIGp1c3QgaW4gY2FzZQoKICAgIAkJdGhpcy54ID0gKCBtMzIgLSBtMjMgKSAvIHM7CiAgICAJCXRoaXMueSA9ICggbTEzIC0gbTMxICkgLyBzOwogICAgCQl0aGlzLnogPSAoIG0yMSAtIG0xMiApIC8gczsKICAgIAkJdGhpcy53ID0gTWF0aC5hY29zKCAoIG0xMSArIG0yMiArIG0zMyAtIDEgKSAvIDIgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBwb3NpdGlvbiBlbGVtZW50cyBvZiB0aGUKICAgIAkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgogICAgCQljb25zdCBlID0gbS5lbGVtZW50czsKCiAgICAJCXRoaXMueCA9IGVbIDEyIF07CiAgICAJCXRoaXMueSA9IGVbIDEzIF07CiAgICAJCXRoaXMueiA9IGVbIDE0IF07CiAgICAJCXRoaXMudyA9IGVbIDE1IF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHgsIHksIHogb3IgdwogICAgCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtaW4gdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1pbiggdiApIHsKCiAgICAJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5taW4oIHRoaXMueiwgdi56ICk7CiAgICAJCXRoaXMudyA9IE1hdGgubWluKCB0aGlzLncsIHYudyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5LCB6IG9yIHcKICAgIAkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltYXgoIHYgKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgubWF4KCB0aGlzLnosIHYueiApOwogICAgCQl0aGlzLncgPSBNYXRoLm1heCggdGhpcy53LCB2LncgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZlY3RvcidzIHgsIHksIHogb3IgdwogICAgCSAqIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUsCiAgICAJICogaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IG1pbiAtIFRoZSBtaW5pbXVtIHgsIHkgYW5kIHogdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gbWF4IC0gVGhlIG1heGltdW0geCwgeSBhbmQgeiB2YWx1ZXMgaW4gdGhlIGRlc2lyZWQgcmFuZ2UuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2xhbXAoIG1pbiwgbWF4ICkgewoKICAgIAkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCiAgICAJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pbi54LCBtYXgueCApOwogICAgCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW4ueSwgbWF4LnkgKTsKICAgIAkJdGhpcy56ID0gY2xhbXAoIHRoaXMueiwgbWluLnosIG1heC56ICk7CiAgICAJCXRoaXMudyA9IGNsYW1wKCB0aGlzLncsIG1pbi53LCBtYXgudyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWVzIGFyZSBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgdGhleSBhcmUKICAgIAkgKiByZXBsYWNlZCBieSB0aGUgbWF4IHZhbHVlLgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlcyBhcmUgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIHRoZXkgYXJlCiAgICAJICogcmVwbGFjZWQgYnkgdGhlIG1pbiB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW5WYWwgLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1heFZhbCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgogICAgCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW5WYWwsIG1heFZhbCApOwogICAgCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW5WYWwsIG1heFZhbCApOwogICAgCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW5WYWwsIG1heFZhbCApOwogICAgCQl0aGlzLncgPSBjbGFtcCggdGhpcy53LCBtaW5WYWwsIG1heFZhbCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5CiAgICAJICogdGhlIG1heCB2YWx1ZS4KICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlCiAgICAJICogbWluIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNsYW1wTGVuZ3RoKCBtaW4sIG1heCApIHsKCiAgICAJCWNvbnN0IGxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7CgogICAgCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIGNsYW1wKCBsZW5ndGgsIG1pbiwgbWF4ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCBkb3duIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmbG9vcigpIHsKCiAgICAJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLmZsb29yKCB0aGlzLnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5mbG9vciggdGhpcy56ICk7CiAgICAJCXRoaXMudyA9IE1hdGguZmxvb3IoIHRoaXMudyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNlaWwoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwogICAgCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwogICAgCQl0aGlzLncgPSBNYXRoLmNlaWwoIHRoaXMudyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcm91bmQoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwogICAgCQl0aGlzLncgPSBNYXRoLnJvdW5kKCB0aGlzLncgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIHRvd2FyZHMgemVybyAodXAgaWYgbmVnYXRpdmUsCiAgICAJICogZG93biBpZiBwb3NpdGl2ZSkgdG8gYW4gaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXJvdW5kVG9aZXJvKCkgewoKICAgIAkJdGhpcy54ID0gTWF0aC50cnVuYyggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwogICAgCQl0aGlzLnogPSBNYXRoLnRydW5jKCB0aGlzLnogKTsKICAgIAkJdGhpcy53ID0gTWF0aC50cnVuYyggdGhpcy53ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnZlcnRzIHRoaXMgdmVjdG9yIC0gaS5lLiBzZXRzIHggPSAteCwgeSA9IC15LCB6ID0gLXosIHcgPSAtdy4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW5lZ2F0ZSgpIHsKCiAgICAJCXRoaXMueCA9IC0gdGhpcy54OwogICAgCQl0aGlzLnkgPSAtIHRoaXMueTsKICAgIAkJdGhpcy56ID0gLSB0aGlzLno7CiAgICAJCXRoaXMudyA9IC0gdGhpcy53OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2FsY3VsYXRlcyB0aGUgZG90IHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGRvdCBwcm9kdWN0IHdpdGguCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIHRoZSBkb3QgcHJvZHVjdC4KICAgIAkgKi8KICAgIAlkb3QoIHYgKSB7CgogICAgCQlyZXR1cm4gdGhpcy54ICogdi54ICsgdGhpcy55ICogdi55ICsgdGhpcy56ICogdi56ICsgdGhpcy53ICogdi53OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBzcXVhcmUgb2YgdGhlIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tCiAgICAJICogKDAsIDAsIDAsIDApIHRvICh4LCB5LCB6LCB3KS4gSWYgeW91IGFyZSBjb21wYXJpbmcgdGhlIGxlbmd0aHMgb2YgdmVjdG9ycywgeW91IHNob3VsZAogICAgCSAqIGNvbXBhcmUgdGhlIGxlbmd0aCBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZW5ndGhTcSgpIHsKCiAgICAJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLnc7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlICBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbSAoMCwgMCwgMCwgMCkgdG8gKHgsIHksIHosIHcpLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlbmd0aCgpIHsKCiAgICAJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBNYW5oYXR0YW4gbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1hbmhhdHRhbkxlbmd0aCgpIHsKCiAgICAJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICkgKyBNYXRoLmFicyggdGhpcy53ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhpcyB2ZWN0b3IgdG8gYSB1bml0IHZlY3RvciAtIHRoYXQgaXMsIHNldHMgaXQgZXF1YWwgdG8gYSB2ZWN0b3IKICAgIAkgKiB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0IHdpdGggYSB2ZWN0b3IgbGVuZ3RoIG9mIGAxYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW5vcm1hbGl6ZSgpIHsKCiAgICAJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHZlY3RvciB0byBhIHZlY3RvciB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0CiAgICAJICogd2l0aCB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggLSBUaGUgbmV3IGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRMZW5ndGgoIGxlbmd0aCApIHsKCiAgICAJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9yIGFuZCB0aGlzIGluc3RhbmNlLCB3aGVyZQogICAgCSAqIGFscGhhIGlzIHRoZSBwZXJjZW50IGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgdGhpcwogICAgCSAqIHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsIGJlIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGludGVycG9sYXRlIHRvd2FyZHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZXJwKCB2LCBhbHBoYSApIHsKCiAgICAJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CiAgICAJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CiAgICAJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CiAgICAJCXRoaXMudyArPSAoIHYudyAtIHRoaXMudyApICogYWxwaGE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9ycywgd2hlcmUgYWxwaGEgaXMgdGhlIHBlcmNlbnQKICAgIAkgKiBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIGZpcnN0IHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsCiAgICAJICogYmUgdGhlIHNlY29uZCBvbmUuIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYxIC0gVGhlIGZpcnN0IHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYyIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCiAgICAJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKICAgIAkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwogICAgCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CiAgICAJCXRoaXMudyA9IHYxLncgKyAoIHYyLncgLSB2MS53ICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCB2ICkgewoKICAgIAkJcmV0dXJuICggKCB2LnggPT09IHRoaXMueCApICYmICggdi55ID09PSB0aGlzLnkgKSAmJiAoIHYueiA9PT0gdGhpcy56ICkgJiYgKCB2LncgPT09IHRoaXMudyApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHZlY3RvcidzIHggdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgXWAsIHkgdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAxIF1gLAogICAgCSAqIHogdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAyIF1gLCB3IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMyBdYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKICAgIAkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKICAgIAkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKICAgIAkJdGhpcy53ID0gYXJyYXlbIG9mZnNldCArIDMgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAogICAgCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLno7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLnc7CgogICAgCQlyZXR1cm4gYXJyYXk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKICAgIAkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CiAgICAJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwogICAgCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKICAgIAkJdGhpcy53ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIGVhY2ggY29tcG9uZW50IG9mIHRoaXMgdmVjdG9yIHRvIGEgcHNldWRvLXJhbmRvbSB2YWx1ZSBiZXR3ZWVuIGAwYCBhbmQKICAgIAkgKiBgMWAsIGV4Y2x1ZGluZyBgMWAuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyYW5kb20oKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwogICAgCQl0aGlzLnkgPSBNYXRoLnJhbmRvbSgpOwogICAgCQl0aGlzLnogPSBNYXRoLnJhbmRvbSgpOwogICAgCQl0aGlzLncgPSBNYXRoLnJhbmRvbSgpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgogICAgCQl5aWVsZCB0aGlzLng7CiAgICAJCXlpZWxkIHRoaXMueTsKICAgIAkJeWllbGQgdGhpcy56OwogICAgCQl5aWVsZCB0aGlzLnc7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIHJlbmRlciB0YXJnZXQgaXMgYSBidWZmZXIgd2hlcmUgdGhlIHZpZGVvIGNhcmQgZHJhd3MgcGl4ZWxzIGZvciBhIHNjZW5lCiAgICAgKiB0aGF0IGlzIGJlaW5nIHJlbmRlcmVkIGluIHRoZSBiYWNrZ3JvdW5kLiBJdCBpcyB1c2VkIGluIGRpZmZlcmVudCBlZmZlY3RzLAogICAgICogc3VjaCBhcyBhcHBseWluZyBwb3N0cHJvY2Vzc2luZyB0byBhIHJlbmRlcmVkIGltYWdlIGJlZm9yZSBkaXNwbGF5aW5nIGl0CiAgICAgKiBvbiB0aGUgc2NyZWVuLgogICAgICoKICAgICAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKICAgICAqLwogICAgY2xhc3MgUmVuZGVyVGFyZ2V0IGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCiAgICAJLyoqCiAgICAJICogUmVuZGVyIHRhcmdldCBvcHRpb25zLgogICAgCSAqCiAgICAJICogQHR5cGVkZWYge09iamVjdH0gUmVuZGVyVGFyZ2V0fk9wdGlvbnMKICAgIAkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtnZW5lcmF0ZU1pcG1hcHM9ZmFsc2VdIC0gV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIG9yIG5vdC4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyLgogICAgCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgogICAgCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCiAgICAJICogQHByb3BlcnR5IHs/c3RyaW5nfSBbaW50ZXJuYWxGb3JtYXQ9bnVsbF0gLSBUaGUgdGV4dHVyZSdzIGludGVybmFsIGZvcm1hdC4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHRleHR1cmUncyB1diB3cmFwcGluZyBtb2RlLgogICAgCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgdGV4dHVyZSdzIHV2IHdyYXBwaW5nIG1vZGUuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFthbmlzb3Ryb3B5PTFdIC0gVGhlIHRleHR1cmUncyBhbmlzb3Ryb3B5IHZhbHVlLgogICAgCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIHRleHR1cmUncyBjb2xvciBzcGFjZS4KICAgIAkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtkZXB0aEJ1ZmZlcj10cnVlXSAtIFdoZXRoZXIgdG8gYWxsb2NhdGUgYSBkZXB0aCBidWZmZXIgb3Igbm90LgogICAgCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3N0ZW5jaWxCdWZmZXI9ZmFsc2VdIC0gV2hldGhlciB0byBhbGxvY2F0ZSBhIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KICAgIAkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtyZXNvbHZlRGVwdGhCdWZmZXI9dHJ1ZV0gLSBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCiAgICAJICogQHByb3BlcnR5IHtib29sZWFufSBbcmVzb2x2ZVN0ZW5jaWxCdWZmZXI9dHJ1ZV0gLSBXaGV0aGVyICB0byByZXNvbHZlIHRoZSBzdGVuY2lsIGJ1ZmZlciBvciBub3QuCiAgICAJICogQHByb3BlcnR5IHs/VGV4dHVyZX0gW2RlcHRoVGV4dHVyZT1udWxsXSAtIFJlZmVyZW5jZSB0byBhIGRlcHRoIHRleHR1cmUuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFtzYW1wbGVzPTBdIC0gVGhlIE1TQUEgc2FtcGxlcyBjb3VudC4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW2NvdW50PTFdIC0gRGVmaW5lcyB0aGUgbnVtYmVyIG9mIGNvbG9yIGF0dGFjaG1lbnRzIC4gTXVzdCBiZSBhdCBsZWFzdCBgMWAuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSB0ZXh0dXJlIGRlcHRoLgogICAgCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW211bHRpdmlldz1mYWxzZV0gLSBXaGV0aGVyIHRoaXMgdGFyZ2V0IGlzIHVzZWQgZm9yIG11bHRpdmlldyByZW5kZXJpbmcuCiAgICAJICovCgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgcmVuZGVyIHRhcmdldC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgogICAgCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHsKICAgIAkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCiAgICAJCQlpbnRlcm5hbEZvcm1hdDogbnVsbCwKICAgIAkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAogICAgCQkJZGVwdGhCdWZmZXI6IHRydWUsCiAgICAJCQlzdGVuY2lsQnVmZmVyOiBmYWxzZSwKICAgIAkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogdHJ1ZSwKICAgIAkJCXJlc29sdmVTdGVuY2lsQnVmZmVyOiB0cnVlLAogICAgCQkJZGVwdGhUZXh0dXJlOiBudWxsLAogICAgCQkJc2FtcGxlczogMCwKICAgIAkJCWNvdW50OiAxLAogICAgCQkJZGVwdGg6IDEsCiAgICAJCQltdWx0aXZpZXc6IGZhbHNlCiAgICAJCX0sIG9wdGlvbnMgKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMud2lkdGggPSB3aWR0aDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLmhlaWdodCA9IGhlaWdodDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZGVwdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuZGVwdGggPSBvcHRpb25zLmRlcHRoOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgcmVjdGFuZ3VsYXIgYXJlYSBpbnNpZGUgdGhlIHJlbmRlciB0YXJnZXQncyB2aWV3cG9ydC4gRnJhZ21lbnRzIHRoYXQgYXJlCiAgICAJCSAqIG91dHNpZGUgdGhlIGFyZWEgd2lsbCBiZSBkaXNjYXJkZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtWZWN0b3I0fQogICAgCQkgKiBAZGVmYXVsdCAoMCwwLHdpZHRoLGhlaWdodCkKICAgIAkJICovCiAgICAJCXRoaXMuc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCQkvKioKICAgIAkJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBzaG91bGQgYmUgZW5hYmxlZCB3aGVuIHJlbmRlcmluZyBpbnRvCiAgICAJCSAqIHRoaXMgcmVuZGVyIHRhcmdldCBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgcmVjdGFuZ3VsYXIgYXJlYSByZXByZXNlbnRpbmcgdGhlIHJlbmRlciB0YXJnZXQncyB2aWV3cG9ydC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjR9CiAgICAJCSAqIEBkZWZhdWx0ICgwLDAsd2lkdGgsaGVpZ2h0KQogICAgCQkgKi8KICAgIAkJdGhpcy52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IG9wdGlvbnMuZGVwdGggfTsKCiAgICAJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSggaW1hZ2UgKTsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBhcnJheSBvZiB0ZXh0dXJlcy4gRWFjaCBjb2xvciBhdHRhY2htZW50IGlzIHJlcHJlc2VudGVkIGFzIGEgc2VwYXJhdGUgdGV4dHVyZS4KICAgIAkJICogSGFzIGF0IGxlYXN0IGEgc2luZ2xlIGVudHJ5IGZvciB0aGUgZGVmYXVsdCBjb2xvciBhdHRhY2htZW50LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8VGV4dHVyZT59CiAgICAJCSAqLwogICAgCQl0aGlzLnRleHR1cmVzID0gW107CgogICAgCQljb25zdCBjb3VudCA9IG9wdGlvbnMuY291bnQ7CiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKICAgIAkJCXRoaXMudGV4dHVyZXNbIGkgXSA9IHRleHR1cmUuY2xvbmUoKTsKICAgIAkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwogICAgCQkJdGhpcy50ZXh0dXJlc1sgaSBdLnJlbmRlclRhcmdldCA9IHRoaXM7CgogICAgCQl9CgogICAgCQl0aGlzLl9zZXRUZXh0dXJlT3B0aW9ucyggb3B0aW9ucyApOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gYWxsb2NhdGUgYSBkZXB0aCBidWZmZXIgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aEJ1ZmZlciA9IG9wdGlvbnMuZGVwdGhCdWZmZXI7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBhbGxvY2F0ZSBhIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLnN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnN0ZW5jaWxCdWZmZXI7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byByZXNvbHZlIHRoZSBkZXB0aCBidWZmZXIgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5yZXNvbHZlRGVwdGhCdWZmZXIgPSBvcHRpb25zLnJlc29sdmVEZXB0aEJ1ZmZlcjsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMucmVzb2x2ZVN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnJlc29sdmVTdGVuY2lsQnVmZmVyOwoKICAgIAkJdGhpcy5fZGVwdGhUZXh0dXJlID0gbnVsbDsKICAgIAkJdGhpcy5kZXB0aFRleHR1cmUgPSBvcHRpb25zLmRlcHRoVGV4dHVyZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbnVtYmVyIG9mIE1TQUEgc2FtcGxlcy4KICAgIAkJICoKICAgIAkJICogQSB2YWx1ZSBvZiBgMGAgZGlzYWJsZXMgTVNBQS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5zYW1wbGVzID0gb3B0aW9ucy5zYW1wbGVzOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gdGhpcyB0YXJnZXQgaXMgdXNlZCBpbiBtdWx0aXZpZXcgcmVuZGVyaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMubXVsdGl2aWV3ID0gb3B0aW9ucy5tdWx0aXZpZXc7CgogICAgCX0KCiAgICAJX3NldFRleHR1cmVPcHRpb25zKCBvcHRpb25zID0ge30gKSB7CgogICAgCQljb25zdCB2YWx1ZXMgPSB7CiAgICAJCQltaW5GaWx0ZXI6IExpbmVhckZpbHRlciwKICAgIAkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCiAgICAJCQlmbGlwWTogZmFsc2UsCiAgICAJCQlpbnRlcm5hbEZvcm1hdDogbnVsbAogICAgCQl9OwoKICAgIAkJaWYgKCBvcHRpb25zLm1hcHBpbmcgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5tYXBwaW5nID0gb3B0aW9ucy5tYXBwaW5nOwogICAgCQlpZiAoIG9wdGlvbnMud3JhcFMgIT09IHVuZGVmaW5lZCApIHZhbHVlcy53cmFwUyA9IG9wdGlvbnMud3JhcFM7CiAgICAJCWlmICggb3B0aW9ucy53cmFwVCAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLndyYXBUID0gb3B0aW9ucy53cmFwVDsKICAgIAkJaWYgKCBvcHRpb25zLndyYXBSICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMud3JhcFIgPSBvcHRpb25zLndyYXBSOwogICAgCQlpZiAoIG9wdGlvbnMubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMubWFnRmlsdGVyID0gb3B0aW9ucy5tYWdGaWx0ZXI7CiAgICAJCWlmICggb3B0aW9ucy5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlcjsKICAgIAkJaWYgKCBvcHRpb25zLmZvcm1hdCAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLmZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0OwogICAgCQlpZiAoIG9wdGlvbnMudHlwZSAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLnR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICAJCWlmICggb3B0aW9ucy5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuYW5pc290cm9weSA9IG9wdGlvbnMuYW5pc290cm9weTsKICAgIAkJaWYgKCBvcHRpb25zLmNvbG9yU3BhY2UgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5jb2xvclNwYWNlID0gb3B0aW9ucy5jb2xvclNwYWNlOwogICAgCQlpZiAoIG9wdGlvbnMuZmxpcFkgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5mbGlwWSA9IG9wdGlvbnMuZmxpcFk7CiAgICAJCWlmICggb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5nZW5lcmF0ZU1pcG1hcHMgPSBvcHRpb25zLmdlbmVyYXRlTWlwbWFwczsKICAgIAkJaWYgKCBvcHRpb25zLmludGVybmFsRm9ybWF0ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuaW50ZXJuYWxGb3JtYXQgPSBvcHRpb25zLmludGVybmFsRm9ybWF0OwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbIGkgXTsKICAgIAkJCXRleHR1cmUuc2V0VmFsdWVzKCB2YWx1ZXMgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgdGV4dHVyZSByZXByZXNlbnRpbmcgdGhlIGRlZmF1bHQgY29sb3IgYXR0YWNobWVudC4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtUZXh0dXJlfQogICAgCSAqLwogICAgCWdldCB0ZXh0dXJlKCkgewoKICAgIAkJcmV0dXJuIHRoaXMudGV4dHVyZXNbIDAgXTsKCiAgICAJfQoKICAgIAlzZXQgdGV4dHVyZSggdmFsdWUgKSB7CgogICAgCQl0aGlzLnRleHR1cmVzWyAwIF0gPSB2YWx1ZTsKCiAgICAJfQoKICAgIAlzZXQgZGVwdGhUZXh0dXJlKCBjdXJyZW50ICkgewoKICAgIAkJaWYgKCB0aGlzLl9kZXB0aFRleHR1cmUgIT09IG51bGwgKSB0aGlzLl9kZXB0aFRleHR1cmUucmVuZGVyVGFyZ2V0ID0gbnVsbDsKICAgIAkJaWYgKCBjdXJyZW50ICE9PSBudWxsICkgY3VycmVudC5yZW5kZXJUYXJnZXQgPSB0aGlzOwoKICAgIAkJdGhpcy5fZGVwdGhUZXh0dXJlID0gY3VycmVudDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnN0ZWFkIG9mIHNhdmluZyB0aGUgZGVwdGggaW4gYSByZW5kZXJidWZmZXIsIGEgdGV4dHVyZQogICAgCSAqIGNhbiBiZSB1c2VkIGluc3RlYWQgd2hpY2ggaXMgdXNlZnVsIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcKICAgIAkgKiBlLmcuIGluIGNvbnRleHQgb2YgcG9zdC1wcm9jZXNzaW5nLgogICAgCSAqCiAgICAJICogQHR5cGUgez9EZXB0aFRleHR1cmV9CiAgICAJICogQGRlZmF1bHQgbnVsbAogICAgCSAqLwogICAgCWdldCBkZXB0aFRleHR1cmUoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fZGVwdGhUZXh0dXJlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHNpemUgb2YgdGhpcyByZW5kZXIgdGFyZ2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGguCiAgICAJICovCiAgICAJc2V0U2l6ZSggd2lkdGgsIGhlaWdodCwgZGVwdGggPSAxICkgewoKICAgIAkJaWYgKCB0aGlzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuZGVwdGggIT09IGRlcHRoICkgewoKICAgIAkJCXRoaXMud2lkdGggPSB3aWR0aDsKICAgIAkJCXRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgCQkJdGhpcy5kZXB0aCA9IGRlcHRoOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLnRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaW1hZ2Uud2lkdGggPSB3aWR0aDsKICAgIAkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaW1hZ2UuaGVpZ2h0ID0gaGVpZ2h0OwogICAgCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5kZXB0aCA9IGRlcHRoOwogICAgCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc0FycmF5VGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5kZXB0aCA+IDE7CgogICAgCQkJfQoKICAgIAkJCXRoaXMuZGlzcG9zZSgpOwoKICAgIAkJfQoKICAgIAkJdGhpcy52aWV3cG9ydC5zZXQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKICAgIAkJdGhpcy5zY2lzc29yLnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgcmVuZGVyIHRhcmdldCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UmVuZGVyVGFyZ2V0fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSBzZXR0aW5ncyBvZiB0aGUgZ2l2ZW4gcmVuZGVyIHRhcmdldC4gVGhpcyBpcyBhIHN0cnVjdHVyYWwgY29weSBzbwogICAgCSAqIG5vIHJlc291cmNlcyBhcmUgc2hhcmVkIGJldHdlZW4gcmVuZGVyIHRhcmdldHMgYWZ0ZXIgdGhlIGNvcHkuIFRoYXQgaW5jbHVkZXMKICAgIAkgKiBhbGwgTVJUIHRleHR1cmVzIGFuZCB0aGUgZGVwdGggdGV4dHVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fSBzb3VyY2UgLSBUaGUgcmVuZGVyIHRhcmdldCB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge1JlbmRlclRhcmdldH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQl0aGlzLndpZHRoID0gc291cmNlLndpZHRoOwogICAgCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CiAgICAJCXRoaXMuZGVwdGggPSBzb3VyY2UuZGVwdGg7CgogICAgCQl0aGlzLnNjaXNzb3IuY29weSggc291cmNlLnNjaXNzb3IgKTsKICAgIAkJdGhpcy5zY2lzc29yVGVzdCA9IHNvdXJjZS5zY2lzc29yVGVzdDsKCiAgICAJCXRoaXMudmlld3BvcnQuY29weSggc291cmNlLnZpZXdwb3J0ICk7CgogICAgCQl0aGlzLnRleHR1cmVzLmxlbmd0aCA9IDA7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gc291cmNlLnRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCXRoaXMudGV4dHVyZXNbIGkgXSA9IHNvdXJjZS50ZXh0dXJlc1sgaSBdLmNsb25lKCk7CiAgICAJCQl0aGlzLnRleHR1cmVzWyBpIF0uaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKICAgIAkJCXRoaXMudGV4dHVyZXNbIGkgXS5yZW5kZXJUYXJnZXQgPSB0aGlzOwoKICAgIAkJCS8vIGVuc3VyZSBpbWFnZSBvYmplY3QgaXMgbm90IHNoYXJlZCwgc2VlICMyMDMyOAoKICAgIAkJCWNvbnN0IGltYWdlID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS50ZXh0dXJlc1sgaSBdLmltYWdlICk7CiAgICAJCQl0aGlzLnRleHR1cmVzWyBpIF0uc291cmNlID0gbmV3IFNvdXJjZSggaW1hZ2UgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMuZGVwdGhCdWZmZXIgPSBzb3VyY2UuZGVwdGhCdWZmZXI7CiAgICAJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwoKICAgIAkJdGhpcy5yZXNvbHZlRGVwdGhCdWZmZXIgPSBzb3VyY2UucmVzb2x2ZURlcHRoQnVmZmVyOwogICAgCQl0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyID0gc291cmNlLnJlc29sdmVTdGVuY2lsQnVmZmVyOwoKICAgIAkJaWYgKCBzb3VyY2UuZGVwdGhUZXh0dXJlICE9PSBudWxsICkgdGhpcy5kZXB0aFRleHR1cmUgPSBzb3VyY2UuZGVwdGhUZXh0dXJlLmNsb25lKCk7CgogICAgCQl0aGlzLnNhbXBsZXMgPSBzb3VyY2Uuc2FtcGxlczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwogICAgCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgogICAgCSAqCiAgICAJICogQGZpcmVzIFJlbmRlclRhcmdldCNkaXNwb3NlCiAgICAJICovCiAgICAJZGlzcG9zZSgpIHsKCiAgICAJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSByZW5kZXIgdGFyZ2V0IHVzZWQgaW4gY29udGV4dCBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCiAgICAgKgogICAgICogQGF1Z21lbnRzIFJlbmRlclRhcmdldAogICAgICovCiAgICBjbGFzcyBXZWJHTFJlbmRlclRhcmdldCBleHRlbmRzIFJlbmRlclRhcmdldCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgM0QgcmVuZGVyIHRhcmdldC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgogICAgCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgogICAgCQlzdXBlciggd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNXZWJHTFJlbmRlclRhcmdldCA9IHRydWU7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRleHR1cmVzIGRpcmVjdGx5IGZyb20gcmF3IGJ1ZmZlciBkYXRhLgogICAgICoKICAgICAqIEBhdWdtZW50cyBUZXh0dXJlCiAgICAgKi8KICAgIGNsYXNzIERhdGFBcnJheVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBkYXRhIGFycmF5IHRleHR1cmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0gez9UeXBlZEFycmF5fSBbZGF0YT1udWxsXSAtIFRoZSBidWZmZXIgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoPTFdIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0PTFdIC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBkYXRhID0gbnVsbCwgd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEgKSB7CgogICAgCQlzdXBlciggbnVsbCApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNEYXRhQXJyYXlUZXh0dXJlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgaW1hZ2UgZGVmaW5pdGlvbiBvZiBhIGRhdGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3tkYXRhOlR5cGVkQXJyYXksd2lkdGg6bnVtYmVyLGhlaWdodDpudW1iZXIsZGVwdGg6bnVtYmVyfX0KICAgIAkJICovCiAgICAJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgogICAgCQkvKioKICAgIAkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQogICAgCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCiAgICAJCSAqLwogICAgCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgogICAgCQkvKioKICAgIAkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQogICAgCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCiAgICAJCSAqLwogICAgCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGluIHRoZSBkZXB0aCBhbmQgY29ycmVzcG9uZHMgdG8KICAgIAkJICogKlcqIGluIFVWVyBtYXBwaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CiAgICAJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKICAgIAkJICovCiAgICAJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgbWlwbWFwcyAoaWYgcG9zc2libGUpIGZvciBhIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCiAgICAJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYDFgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgogICAgCQkvKioKICAgIAkJICogQSBzZXQgb2YgYWxsIGxheWVycyB3aGljaCBuZWVkIHRvIGJlIHVwZGF0ZWQgaW4gdGhlIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtTZXQ8bnVtYmVyPn0KICAgIAkJICovCiAgICAJCXRoaXMubGF5ZXJVcGRhdGVzID0gbmV3IFNldCgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERlc2NyaWJlcyB0aGF0IGEgc3BlY2lmaWMgbGF5ZXIgb2YgdGhlIHRleHR1cmUgbmVlZHMgdG8gYmUgdXBkYXRlZC4KICAgIAkgKiBOb3JtYWxseSB3aGVuIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLCB0aGUKICAgIAkgKiBlbnRpcmUgZGF0YSB0ZXh0dXJlIGFycmF5IGlzIHNlbnQgdG8gdGhlIEdQVS4gTWFya2luZyBzcGVjaWZpYwogICAgCSAqIGxheWVycyB3aWxsIG9ubHkgdHJhbnNtaXQgc3Vic2V0cyBvZiBhbGwgbWlwbWFwcyBhc3NvY2lhdGVkIHdpdGggYQogICAgCSAqIHNwZWNpZmljIGRlcHRoIGluIHRoZSBhcnJheSB3aGljaCBpcyBvZnRlbiBtdWNoIG1vcmUgcGVyZm9ybWFudC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllckluZGV4IC0gVGhlIGxheWVyIGluZGV4IHRoYXQgc2hvdWxkIGJlIHVwZGF0ZWQuCiAgICAJICovCiAgICAJYWRkTGF5ZXJVcGRhdGUoIGxheWVySW5kZXggKSB7CgogICAgCQl0aGlzLmxheWVyVXBkYXRlcy5hZGQoIGxheWVySW5kZXggKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXNldHMgdGhlIGxheWVyIHVwZGF0ZXMgcmVnaXN0cnkuCiAgICAJICovCiAgICAJY2xlYXJMYXllclVwZGF0ZXMoKSB7CgogICAgCQl0aGlzLmxheWVyVXBkYXRlcy5jbGVhcigpOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhIHRocmVlLWRpbWVuc2lvbmFsIHRleHR1cmUgZnJvbSByYXcgZGF0YSwgd2l0aCBwYXJhbWV0ZXJzIHRvCiAgICAgKiBkaXZpZGUgaXQgaW50byB3aWR0aCwgaGVpZ2h0LCBhbmQgZGVwdGguCiAgICAgKgogICAgICogQGF1Z21lbnRzIFRleHR1cmUKICAgICAqLwogICAgY2xhc3MgRGF0YTNEVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGRhdGEgYXJyYXkgdGV4dHVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7P1R5cGVkQXJyYXl9IFtkYXRhPW51bGxdIC0gVGhlIGJ1ZmZlciBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHRleHR1cmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGggb2YgdGhlIHRleHR1cmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCiAgICAJCS8vIFdlJ3JlIGdvaW5nIHRvIGFkZCAuc2V0WFhYKCkgbWV0aG9kcyBmb3Igc2V0dGluZyBwcm9wZXJ0aWVzIGxhdGVyLgogICAgCQkvLyBVc2VycyBjYW4gc3RpbGwgc2V0IGluIERhdGEzRFRleHR1cmUgZGlyZWN0bHkuCiAgICAJCS8vCiAgICAJCS8vCWNvbnN0IHRleHR1cmUgPSBuZXcgVEhSRUUuRGF0YTNEVGV4dHVyZSggZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggKTsKICAgIAkJLy8gCXRleHR1cmUuYW5pc290cm9weSA9IDE2OwogICAgCQkvLwogICAgCQkvLyBTZWUgIzE0ODM5CgogICAgCQlzdXBlciggbnVsbCApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNEYXRhM0RUZXh0dXJlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgaW1hZ2UgZGVmaW5pdGlvbiBvZiBhIGRhdGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3tkYXRhOlR5cGVkQXJyYXksd2lkdGg6bnVtYmVyLGhlaWdodDpudW1iZXIsZGVwdGg6bnVtYmVyfX0KICAgIAkJICovCiAgICAJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgogICAgCQkvKioKICAgIAkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQogICAgCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCiAgICAJCSAqLwogICAgCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgogICAgCQkvKioKICAgIAkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQogICAgCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCiAgICAJCSAqLwogICAgCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGluIHRoZSBkZXB0aCBhbmQgY29ycmVzcG9uZHMgdG8KICAgIAkJICogKlcqIGluIFVWVyBtYXBwaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CiAgICAJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKICAgIAkJICovCiAgICAJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgbWlwbWFwcyAoaWYgcG9zc2libGUpIGZvciBhIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCiAgICAJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYDFgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGFuIGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggKEFBQkIpIGluIDNEIHNwYWNlLgogICAgICovCiAgICBjbGFzcyBCb3gzIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFttaW49KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KV0gLSBBIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBib3guCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbbWF4PSgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSldIC0gQSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgYm94LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBtaW4gPSBuZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApLCBtYXggPSBuZXcgVmVjdG9yMyggLSBJbmZpbml0eSwgLSBJbmZpbml0eSwgLSBJbmZpbml0eSApICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNCb3gzID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLm1pbiA9IG1pbjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLm1heCA9IG1heDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBsb3dlciBhbmQgdXBwZXIgYm91bmRhcmllcyBvZiB0aGlzIGJveC4KICAgIAkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgY29waWVzIHRoZSB2YWx1ZXMgZnJvbSB0aGUgZ2l2ZW4gb2JqZWN0cy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gbWluIC0gVGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBib3guCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBtYXggLSBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlzZXQoIG1pbiwgbWF4ICkgewoKICAgIAkJdGhpcy5taW4uY29weSggbWluICk7CiAgICAJCXRoaXMubWF4LmNvcHkoIG1heCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJveCBzbyBpdCBlbmNsb3NlcyB0aGUgcG9zaXRpb24gZGF0YQogICAgCSAqIGluIHRoZSBnaXZlbiBhcnJheS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEuCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJc2V0RnJvbUFycmF5KCBhcnJheSApIHsKCiAgICAJCXRoaXMubWFrZUVtcHR5KCk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKz0gMyApIHsKCiAgICAJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYi5mcm9tQXJyYXkoIGFycmF5LCBpICkgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHVwcGVyIGFuZCBsb3dlciBib3VuZHMgb2YgdGhpcyBib3ggc28gaXQgZW5jbG9zZXMgdGhlIHBvc2l0aW9uIGRhdGEKICAgIAkgKiBpbiB0aGUgZ2l2ZW4gYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBBIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyAzRCBwb3NpdGlvbiBkYXRhLgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCXNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIHsKCiAgICAJCXRoaXMubWFrZUVtcHR5KCk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpICkgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHVwcGVyIGFuZCBsb3dlciBib3VuZHMgb2YgdGhpcyBib3ggc28gaXQgZW5jbG9zZXMgdGhlIHBvc2l0aW9uIGRhdGEKICAgIAkgKiBpbiB0aGUgZ2l2ZW4gYXJyYXkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBbiBhcnJheSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEgYXMgaW5zdGFuY2VzIG9mIHtAbGluayBWZWN0b3IzfS4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgogICAgCQl0aGlzLm1ha2VFbXB0eSgpOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIHBvaW50c1sgaSBdICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDZW50ZXJzIHRoaXMgYm94IG9uIHRoZSBnaXZlbiBjZW50ZXIgdmVjdG9yIGFuZCBzZXRzIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQKICAgIAkgKiBkZXB0aCB0byB0aGUgZ2l2ZW4gc2l6ZSB2YWx1ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGNlbnRlciAtIFRoZSBjZW50ZXIgb2YgdGhlIGJveC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHNpemUgLSBUaGUgeCwgeSBhbmQgeiBkaW1lbnNpb25zIG9mIHRoZSBib3guCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJc2V0RnJvbUNlbnRlckFuZFNpemUoIGNlbnRlciwgc2l6ZSApIHsKCiAgICAJCWNvbnN0IGhhbGZTaXplID0gX3ZlY3RvciRiLmNvcHkoIHNpemUgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgogICAgCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CiAgICAJCXRoaXMubWF4LmNvcHkoIGNlbnRlciApLmFkZCggaGFsZlNpemUgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSB3b3JsZC1heGlzLWFsaWduZWQgYm91bmRpbmcgYm94IGZvciB0aGUgZ2l2ZW4gM0Qgb2JqZWN0CiAgICAJICogKGluY2x1ZGluZyBpdHMgY2hpbGRyZW4pLCBhY2NvdW50aW5nIGZvciB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLAogICAgCSAqIHdvcmxkIHRyYW5zZm9ybXMuIFRoZSBmdW5jdGlvbiBtYXkgcmVzdWx0IGluIGEgbGFyZ2VyIGJveCB0aGFuIHN0cmljdGx5IG5lY2Vzc2FyeS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gY29tcHV0ZSB0aGUgYm91bmRpbmcgYm94IGZvci4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtwcmVjaXNlPWZhbHNlXSAtIElmIHNldCB0byBgdHJ1ZWAsIHRoZSBtZXRob2QgY29tcHV0ZXMgdGhlIHNtYWxsZXN0CiAgICAJICogd29ybGQtYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveCBhdCB0aGUgZXhwZW5zZSBvZiBtb3JlIGNvbXB1dGF0aW9uLgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCXNldEZyb21PYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKICAgIAkJdGhpcy5tYWtlRW1wdHkoKTsKCiAgICAJCXJldHVybiB0aGlzLmV4cGFuZEJ5T2JqZWN0KCBvYmplY3QsIHByZWNpc2UgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IGJveCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7Qm94M30gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBib3ggdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWNvcHkoIGJveCApIHsKCiAgICAJCXRoaXMubWluLmNvcHkoIGJveC5taW4gKTsKICAgIAkJdGhpcy5tYXguY29weSggYm94Lm1heCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTWFrZXMgdGhpcyBib3ggZW1wdHkgd2hpY2ggbWVhbnMgaW4gZW5jbG9zZXMgYSB6ZXJvIHNwYWNlIGluIDNELgogICAgCSAqCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJbWFrZUVtcHR5KCkgewoKICAgIAkJdGhpcy5taW4ueCA9IHRoaXMubWluLnkgPSB0aGlzLm1pbi56ID0gKyBJbmZpbml0eTsKICAgIAkJdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSB0aGlzLm1heC56ID0gLSBJbmZpbml0eTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGJveCBpbmNsdWRlcyB6ZXJvIHBvaW50cyB3aXRoaW4gaXRzIGJvdW5kcy4KICAgIAkgKiBOb3RlIHRoYXQgYSBib3ggd2l0aCBlcXVhbCBsb3dlciBhbmQgdXBwZXIgYm91bmRzIHN0aWxsIGluY2x1ZGVzIG9uZQogICAgCSAqIHBvaW50LCB0aGUgb25lIGJvdGggYm91bmRzIHNoYXJlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGJveCBpcyBlbXB0eSBvciBub3QuCiAgICAJICovCiAgICAJaXNFbXB0eSgpIHsKCiAgICAJCS8vIHRoaXMgaXMgYSBtb3JlIHJvYnVzdCBjaGVjayBmb3IgZW1wdHkgdGhhbiAoIHZvbHVtZSA8PSAwICkgYmVjYXVzZSB2b2x1bWUgY2FuIGdldCBwb3NpdGl2ZSB3aXRoIHR3byBuZWdhdGl2ZSBheGVzCgogICAgCQlyZXR1cm4gKCB0aGlzLm1heC54IDwgdGhpcy5taW4ueCApIHx8ICggdGhpcy5tYXgueSA8IHRoaXMubWluLnkgKSB8fCAoIHRoaXMubWF4LnogPCB0aGlzLm1pbi56ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgY2VudGVyIHBvaW50IG9mIHRoaXMgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2VudGVyIHBvaW50LgogICAgCSAqLwogICAgCWdldENlbnRlciggdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCwgMCApIDogdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMubWluLCB0aGlzLm1heCApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBkaW1lbnNpb25zIG9mIHRoaXMgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgc2l6ZS4KICAgIAkgKi8KICAgIAlnZXRTaXplKCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwLCAwICkgOiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5tYXgsIHRoaXMubWluICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIGJveCB0byBpbmNsdWRlIHRoZSBnaXZlbiBwb2ludC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdGhhdCBzaG91bGQgYmUgaW5jbHVkZWQgYnkgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlleHBhbmRCeVBvaW50KCBwb2ludCApIHsKCiAgICAJCXRoaXMubWluLm1pbiggcG9pbnQgKTsKICAgIAkJdGhpcy5tYXgubWF4KCBwb2ludCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXhwYW5kcyB0aGlzIGJveCBlcXVpbGF0ZXJhbGx5IGJ5IHRoZSBnaXZlbiB2ZWN0b3IuIFRoZSB3aWR0aCBvZiB0aGlzCiAgICAJICogYm94IHdpbGwgYmUgZXhwYW5kZWQgYnkgdGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgaW4gYm90aAogICAgCSAqIGRpcmVjdGlvbnMuIFRoZSBoZWlnaHQgb2YgdGhpcyBib3ggd2lsbCBiZSBleHBhbmRlZCBieSB0aGUgeSBjb21wb25lbnQgb2YKICAgIAkgKiB0aGUgdmVjdG9yIGluIGJvdGggZGlyZWN0aW9ucy4gVGhlIGRlcHRoIG9mIHRoaXMgYm94IHdpbGwgYmUKICAgIAkgKiBleHBhbmRlZCBieSB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBpbiBib3RoIGRpcmVjdGlvbnMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZlY3RvciAtIFRoZSB2ZWN0b3IgdGhhdCBzaG91bGQgZXhwYW5kIHRoZSBib3VuZGluZyBib3guCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJZXhwYW5kQnlWZWN0b3IoIHZlY3RvciApIHsKCiAgICAJCXRoaXMubWluLnN1YiggdmVjdG9yICk7CiAgICAJCXRoaXMubWF4LmFkZCggdmVjdG9yICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHBhbmRzIGVhY2ggZGltZW5zaW9uIG9mIHRoZSBib3ggYnkgdGhlIGdpdmVuIHNjYWxhci4gSWYgbmVnYXRpdmUsIHRoZQogICAgCSAqIGRpbWVuc2lvbnMgb2YgdGhlIGJveCB3aWxsIGJlIGNvbnRyYWN0ZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB2YWx1ZSB0aGF0IHNob3VsZCBleHBhbmQgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlleHBhbmRCeVNjYWxhciggc2NhbGFyICkgewoKICAgIAkJdGhpcy5taW4uYWRkU2NhbGFyKCAtIHNjYWxhciApOwogICAgCQl0aGlzLm1heC5hZGRTY2FsYXIoIHNjYWxhciApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIGJveCB0byBpbmNsdWRlIHRoZSBnaXZlbiAzRCBvYmplY3QgYW5kCiAgICAJICogaXRzIGNoaWxkcmVuLCBhY2NvdW50aW5nIGZvciB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZAogICAgCSAqIHRyYW5zZm9ybXMuIFRoZSBmdW5jdGlvbiBtYXkgcmVzdWx0IGluIGEgbGFyZ2VyIGJveCB0aGFuIHN0cmljdGx5CiAgICAJICogbmVjZXNzYXJ5ICh1bmxlc3MgdGhlIHByZWNpc2UgcGFyYW1ldGVyIGlzIHNldCB0byB0cnVlKS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdGhhdCBzaG91bGQgZXhwYW5kIHRoZSBib3VuZGluZyBib3guCiAgICAJICogQHBhcmFtIHtib29sZWFufSBwcmVjaXNlIC0gSWYgc2V0IHRvIGB0cnVlYCwgdGhlIG1ldGhvZCBleHBhbmRzIHRoZSBib3VuZGluZyBib3gKICAgIAkgKiBhcyBsaXR0bGUgYXMgbmVjZXNzYXJ5IGF0IHRoZSBleHBlbnNlIG9mIG1vcmUgY29tcHV0YXRpb24uCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJZXhwYW5kQnlPYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKICAgIAkJLy8gQ29tcHV0ZXMgdGhlIHdvcmxkLWF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggb2YgYW4gb2JqZWN0IChpbmNsdWRpbmcgaXRzIGNoaWxkcmVuKSwKICAgIAkJLy8gYWNjb3VudGluZyBmb3IgYm90aCB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZCB0cmFuc2Zvcm1zCgogICAgCQlvYmplY3QudXBkYXRlV29ybGRNYXRyaXgoIGZhbHNlLCBmYWxzZSApOwoKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgogICAgCQlpZiAoIGdlb21ldHJ5ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCiAgICAJCQkvLyBwcmVjaXNlIEFBQkIgY29tcHV0YXRpb24gYmFzZWQgb24gdmVydGV4IGRhdGEgcmVxdWlyZXMgYXQgbGVhc3QgYSBwb3NpdGlvbiBhdHRyaWJ1dGUuCiAgICAJCQkvLyBpbnN0YW5jaW5nIGlzbid0IHN1cHBvcnRlZCBzbyBmYXIgYW5kIHVzZXMgdGhlIG5vcm1hbCAoY29uc2VydmF0aXZlKSBjb2RlIHBhdGguCgogICAgCQkJaWYgKCBwcmVjaXNlID09PSB0cnVlICYmIHBvc2l0aW9uQXR0cmlidXRlICE9PSB1bmRlZmluZWQgJiYgb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJaWYgKCBvYmplY3QuaXNNZXNoID09PSB0cnVlICkgewoKICAgIAkJCQkJCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggaSwgX3ZlY3RvciRiICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCV92ZWN0b3IkYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJX3ZlY3RvciRiLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJCXRoaXMuZXhwYW5kQnlQb2ludCggX3ZlY3RvciRiICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ0JveCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJLy8gb2JqZWN0LWxldmVsIGJvdW5kaW5nIGJveAoKICAgIAkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgogICAgCQkJCQkJb2JqZWN0LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJX2JveCQ0LmNvcHkoIG9iamVjdC5ib3VuZGluZ0JveCApOwoKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCS8vIGdlb21ldHJ5LWxldmVsIGJvdW5kaW5nIGJveAoKICAgIAkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCiAgICAJCQkJCQlnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCV9ib3gkNC5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApOwoKICAgIAkJCQl9CgogICAgCQkJCV9ib3gkNC5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKICAgIAkJCQl0aGlzLnVuaW9uKCBfYm94JDQgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJdGhpcy5leHBhbmRCeU9iamVjdCggY2hpbGRyZW5bIGkgXSwgcHJlY2lzZSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50IGxpZXMgd2l0aGluIG9yIG9uIHRoZSBib3VuZGFyaWVzIG9mIHRoaXMgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGJvdW5kaW5nIGJveCBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgb3Igbm90LgogICAgCSAqLwogICAgCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKICAgIAkJcmV0dXJuIHBvaW50LnggPj0gdGhpcy5taW4ueCAmJiBwb2ludC54IDw9IHRoaXMubWF4LnggJiYKICAgIAkJCXBvaW50LnkgPj0gdGhpcy5taW4ueSAmJiBwb2ludC55IDw9IHRoaXMubWF4LnkgJiYKICAgIAkJCXBvaW50LnogPj0gdGhpcy5taW4ueiAmJiBwb2ludC56IDw9IHRoaXMubWF4Lno7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBib3VuZGluZyBib3ggaW5jbHVkZXMgdGhlIGVudGlyZXR5IG9mIHRoZSBnaXZlbiBib3VuZGluZyBib3guCiAgICAJICogSWYgdGhpcyBib3ggYW5kIHRoZSBnaXZlbiBvbmUgYXJlIGlkZW50aWNhbCwgdGhpcyBmdW5jdGlvbiBhbHNvIHJldHVybnMgYHRydWVgLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm91bmRpbmcgYm94IHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYm91bmRpbmcgYm94IGNvbnRhaW5zIHRoZSBnaXZlbiBib3VuZGluZyBib3ggb3Igbm90LgogICAgCSAqLwogICAgCWNvbnRhaW5zQm94KCBib3ggKSB7CgogICAgCQlyZXR1cm4gdGhpcy5taW4ueCA8PSBib3gubWluLnggJiYgYm94Lm1heC54IDw9IHRoaXMubWF4LnggJiYKICAgIAkJCXRoaXMubWluLnkgPD0gYm94Lm1pbi55ICYmIGJveC5tYXgueSA8PSB0aGlzLm1heC55ICYmCiAgICAJCQl0aGlzLm1pbi56IDw9IGJveC5taW4ueiAmJiBib3gubWF4LnogPD0gdGhpcy5tYXguejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgcG9pbnQgYXMgYSBwcm9wb3J0aW9uIG9mIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQgZGVwdGguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBwb2ludCBpbiAzRCBzcGFjZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcG9pbnQgYXMgYSBwcm9wb3J0aW9uIG9mIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQgZGVwdGguCiAgICAJICovCiAgICAJZ2V0UGFyYW1ldGVyKCBwb2ludCwgdGFyZ2V0ICkgewoKICAgIAkJLy8gVGhpcyBjYW4gcG90ZW50aWFsbHkgaGF2ZSBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBib3gKICAgIAkJLy8gaGFzIGEgc2l6ZSBkaW1lbnNpb24gb2YgMC4KCiAgICAJCXJldHVybiB0YXJnZXQuc2V0KAogICAgCQkJKCBwb2ludC54IC0gdGhpcy5taW4ueCApIC8gKCB0aGlzLm1heC54IC0gdGhpcy5taW4ueCApLAogICAgCQkJKCBwb2ludC55IC0gdGhpcy5taW4ueSApIC8gKCB0aGlzLm1heC55IC0gdGhpcy5taW4ueSApLAogICAgCQkJKCBwb2ludC56IC0gdGhpcy5taW4ueiApIC8gKCB0aGlzLm1heC56IC0gdGhpcy5taW4ueiApCiAgICAJCSk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWludGVyc2VjdHNCb3goIGJveCApIHsKCiAgICAJCS8vIHVzaW5nIDYgc3BsaXR0aW5nIHBsYW5lcyB0byBydWxlIG91dCBpbnRlcnNlY3Rpb25zLgogICAgCQlyZXR1cm4gYm94Lm1heC54ID49IHRoaXMubWluLnggJiYgYm94Lm1pbi54IDw9IHRoaXMubWF4LnggJiYKICAgIAkJCWJveC5tYXgueSA+PSB0aGlzLm1pbi55ICYmIGJveC5taW4ueSA8PSB0aGlzLm1heC55ICYmCiAgICAJCQlib3gubWF4LnogPj0gdGhpcy5taW4ueiAmJiBib3gubWluLnogPD0gdGhpcy5tYXguejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgYm91bmRpbmcgc3BoZXJlIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgogICAgCQkvLyBGaW5kIHRoZSBwb2ludCBvbiB0aGUgQUFCQiBjbG9zZXN0IHRvIHRoZSBzcGhlcmUgY2VudGVyLgogICAgCQl0aGlzLmNsYW1wUG9pbnQoIHNwaGVyZS5jZW50ZXIsIF92ZWN0b3IkYiApOwoKICAgIAkJLy8gSWYgdGhhdCBwb2ludCBpcyBpbnNpZGUgdGhlIHNwaGVyZSwgdGhlIEFBQkIgYW5kIHNwaGVyZSBpbnRlcnNlY3QuCiAgICAJCXJldHVybiBfdmVjdG9yJGIuZGlzdGFuY2VUb1NxdWFyZWQoIHNwaGVyZS5jZW50ZXIgKSA8PSAoIHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBsYW5lIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcGxhbmUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWludGVyc2VjdHNQbGFuZSggcGxhbmUgKSB7CgogICAgCQkvLyBXZSBjb21wdXRlIHRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGRvdCBwcm9kdWN0IHZhbHVlcy4gSWYgdGhvc2UgdmFsdWVzCiAgICAJCS8vIGFyZSBvbiB0aGUgc2FtZSBzaWRlIChiYWNrIG9yIGZyb250KSBvZiB0aGUgcGxhbmUsIHRoZW4gdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoKICAgIAkJbGV0IG1pbiwgbWF4OwoKICAgIAkJaWYgKCBwbGFuZS5ub3JtYWwueCA+IDAgKSB7CgogICAgCQkJbWluID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwogICAgCQkJbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1heC54OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQltaW4gPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWF4Lng7CiAgICAJCQltYXggPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWluLng7CgogICAgCQl9CgogICAgCQlpZiAoIHBsYW5lLm5vcm1hbC55ID4gMCApIHsKCiAgICAJCQltaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwogICAgCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKICAgIAkJCW1heCArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWluLnk7CgogICAgCQl9CgogICAgCQlpZiAoIHBsYW5lLm5vcm1hbC56ID4gMCApIHsKCiAgICAJCQltaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwogICAgCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKICAgIAkJCW1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CgogICAgCQl9CgogICAgCQlyZXR1cm4gKCBtaW4gPD0gLSBwbGFuZS5jb25zdGFudCAmJiBtYXggPj0gLSBwbGFuZS5jb25zdGFudCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1RyaWFuZ2xlfSB0cmlhbmdsZSAtIFRoZSB0cmlhbmdsZSB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIHRyaWFuZ2xlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzVHJpYW5nbGUoIHRyaWFuZ2xlICkgewoKICAgIAkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCiAgICAJCQlyZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQkvLyBjb21wdXRlIGJveCBjZW50ZXIgYW5kIGV4dGVudHMKICAgIAkJdGhpcy5nZXRDZW50ZXIoIF9jZW50ZXIgKTsKICAgIAkJX2V4dGVudHMuc3ViVmVjdG9ycyggdGhpcy5tYXgsIF9jZW50ZXIgKTsKCiAgICAJCS8vIHRyYW5zbGF0ZSB0cmlhbmdsZSB0byBhYWJiIG9yaWdpbgogICAgCQlfdjAkMi5zdWJWZWN0b3JzKCB0cmlhbmdsZS5hLCBfY2VudGVyICk7CiAgICAJCV92MSQ3LnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmIsIF9jZW50ZXIgKTsKICAgIAkJX3YyJDQuc3ViVmVjdG9ycyggdHJpYW5nbGUuYywgX2NlbnRlciApOwoKICAgIAkJLy8gY29tcHV0ZSBlZGdlIHZlY3RvcnMgZm9yIHRyaWFuZ2xlCiAgICAJCV9mMC5zdWJWZWN0b3JzKCBfdjEkNywgX3YwJDIgKTsKICAgIAkJX2YxLnN1YlZlY3RvcnMoIF92MiQ0LCBfdjEkNyApOwogICAgCQlfZjIuc3ViVmVjdG9ycyggX3YwJDIsIF92MiQ0ICk7CgogICAgCQkvLyB0ZXN0IGFnYWluc3QgYXhlcyB0aGF0IGFyZSBnaXZlbiBieSBjcm9zcyBwcm9kdWN0IGNvbWJpbmF0aW9ucyBvZiB0aGUgZWRnZXMgb2YgdGhlIHRyaWFuZ2xlIGFuZCB0aGUgZWRnZXMgb2YgdGhlIGFhYmIKICAgIAkJLy8gbWFrZSBhbiBheGlzIHRlc3Rpbmcgb2YgZWFjaCBvZiB0aGUgMyBzaWRlcyBvZiB0aGUgYWFiYiBhZ2FpbnN0IGVhY2ggb2YgdGhlIDMgc2lkZXMgb2YgdGhlIHRyaWFuZ2xlID0gOSBheGlzIG9mIHNlcGFyYXRpb24KICAgIAkJLy8gYXhpc19paiA9IHVfaSB4IGZfaiAodTAsIHUxLCB1MiA9IGZhY2Ugbm9ybWFscyBvZiBhYWJiID0geCx5LHogYXhlcyB2ZWN0b3JzIHNpbmNlIGFhYmIgaXMgYXhpcyBhbGlnbmVkKQogICAgCQlsZXQgYXhlcyA9IFsKICAgIAkJCTAsIC0gX2YwLnosIF9mMC55LCAwLCAtIF9mMS56LCBfZjEueSwgMCwgLSBfZjIueiwgX2YyLnksCiAgICAJCQlfZjAueiwgMCwgLSBfZjAueCwgX2YxLnosIDAsIC0gX2YxLngsIF9mMi56LCAwLCAtIF9mMi54LAogICAgCQkJLSBfZjAueSwgX2YwLngsIDAsIC0gX2YxLnksIF9mMS54LCAwLCAtIF9mMi55LCBfZjIueCwgMAogICAgCQldOwogICAgCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCiAgICAJCQlyZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQkvLyB0ZXN0IDMgZmFjZSBub3JtYWxzIGZyb20gdGhlIGFhYmIKICAgIAkJYXhlcyA9IFsgMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSBdOwogICAgCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCiAgICAJCQlyZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQkvLyBmaW5hbGx5IHRlc3RpbmcgdGhlIGZhY2Ugbm9ybWFsIG9mIHRoZSB0cmlhbmdsZQogICAgCQkvLyB1c2UgYWxyZWFkeSBleGlzdGluZyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMgaGVyZQogICAgCQlfdHJpYW5nbGVOb3JtYWwuY3Jvc3NWZWN0b3JzKCBfZjAsIF9mMSApOwogICAgCQlheGVzID0gWyBfdHJpYW5nbGVOb3JtYWwueCwgX3RyaWFuZ2xlTm9ybWFsLnksIF90cmlhbmdsZU5vcm1hbC56IF07CgogICAgCQlyZXR1cm4gc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDbGFtcHMgdGhlIGdpdmVuIHBvaW50IHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoaXMgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjbGFtcC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjbGFtcGVkIHBvaW50LgogICAgCSAqLwogICAgCWNsYW1wUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuY2xhbXAoIHRoaXMubWluLCB0aGlzLm1heCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBmcm9tIGFueSBlZGdlIG9mIHRoaXMgYm94IHRvIHRoZSBzcGVjaWZpZWQgcG9pbnQuIElmCiAgICAJICogdGhlIGdpdmVuIHBvaW50IGxpZXMgaW5zaWRlIG9mIHRoaXMgYm94LCB0aGUgZGlzdGFuY2Ugd2lsbCBiZSBgMGAuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKICAgIAkJcmV0dXJuIHRoaXMuY2xhbXBQb2ludCggcG9pbnQsIF92ZWN0b3IkYiApLmRpc3RhbmNlVG8oIHBvaW50ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIGJvdW5kaW5nIHNwaGVyZSB0aGF0IGVuY2xvc2VzIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHRhcmdldCAtIFRoZSB0YXJnZXQgc3BoZXJlIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gVGhlIGJvdW5kaW5nIHNwaGVyZSB0aGF0IGVuY2xvc2VzIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWdldEJvdW5kaW5nU3BoZXJlKCB0YXJnZXQgKSB7CgogICAgCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKICAgIAkJCXRhcmdldC5tYWtlRW1wdHkoKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhpcy5nZXRDZW50ZXIoIHRhcmdldC5jZW50ZXIgKTsKCiAgICAJCQl0YXJnZXQucmFkaXVzID0gdGhpcy5nZXRTaXplKCBfdmVjdG9yJGIgKS5sZW5ndGgoKSAqIDAuNTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBvZiB0aGlzIGJvdW5kaW5nIGJveCBhbmQgdGhlIGdpdmVuIG9uZSwgc2V0dGluZyB0aGUgdXBwZXIKICAgIAkgKiBib3VuZCBvZiB0aGlzIGJveCB0byB0aGUgbGVzc2VyIG9mIHRoZSB0d28gYm94ZXMnIHVwcGVyIGJvdW5kcyBhbmQgdGhlCiAgICAJICogbG93ZXIgYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGdyZWF0ZXIgb2YgdGhlIHR3byBib3hlcycgbG93ZXIgYm91bmRzLiBJZgogICAgCSAqIHRoZXJlJ3Mgbm8gb3ZlcmxhcCwgbWFrZXMgdGhpcyBib3ggZW1wdHkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gaW50ZXJzZWN0IHdpdGguCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJaW50ZXJzZWN0KCBib3ggKSB7CgogICAgCQl0aGlzLm1pbi5tYXgoIGJveC5taW4gKTsKICAgIAkJdGhpcy5tYXgubWluKCBib3gubWF4ICk7CgogICAgCQkvLyBlbnN1cmUgdGhhdCBpZiB0aGVyZSBpcyBubyBvdmVybGFwLCB0aGUgcmVzdWx0IGlzIGZ1bGx5IGVtcHR5LCBub3Qgc2xpZ2h0bHkgZW1wdHkgd2l0aCBub24taW5mLytpbmYgdmFsdWVzIHRoYXQgd2lsbCBjYXVzZSBzdWJzZXF1ZW5jZSBpbnRlcnNlY3RzIHRvIGVycm9uZW91c2x5IHJldHVybiB2YWxpZCB2YWx1ZXMuCiAgICAJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB0aGlzLm1ha2VFbXB0eSgpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHVuaW9uIG9mIHRoaXMgYm94IGFuZCBhbm90aGVyIGFuZCB0aGUgZ2l2ZW4gb25lLCBzZXR0aW5nIHRoZSB1cHBlcgogICAgCSAqIGJvdW5kIG9mIHRoaXMgYm94IHRvIHRoZSBncmVhdGVyIG9mIHRoZSB0d28gYm94ZXMnIHVwcGVyIGJvdW5kcyBhbmQgdGhlCiAgICAJICogbG93ZXIgYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGxlc3NlciBvZiB0aGUgdHdvIGJveGVzJyBsb3dlciBib3VuZHMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdGhhdCB3aWxsIGJlIHVuaW9uZWQgd2l0aCB0aGlzIGluc3RhbmNlLgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCXVuaW9uKCBib3ggKSB7CgogICAgCQl0aGlzLm1pbi5taW4oIGJveC5taW4gKTsKICAgIAkJdGhpcy5tYXgubWF4KCBib3gubWF4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2Zvcm1zIHRoaXMgYm91bmRpbmcgYm94IGJ5IHRoZSBnaXZlbiA0eDQgdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKICAgIAkJLy8gdHJhbnNmb3JtIG9mIGVtcHR5IGJveCBpcyBhbiBlbXB0eSBib3guCiAgICAJCWlmICggdGhpcy5pc0VtcHR5KCkgKSByZXR1cm4gdGhpczsKCiAgICAJCS8vIE5PVEU6IEkgYW0gdXNpbmcgYSBiaW5hcnkgcGF0dGVybiB0byBzcGVjaWZ5IGFsbCAyXjMgY29tYmluYXRpb25zIGJlbG93CiAgICAJCV9wb2ludHNbIDAgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWluLnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMDAKICAgIAkJX3BvaW50c1sgMSBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAwMQogICAgCQlfcG9pbnRzWyAyIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1heC55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDEwCiAgICAJCV9wb2ludHNbIDMgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWF4LnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMTEKICAgIAkJX3BvaW50c1sgNCBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDEwMAogICAgCQlfcG9pbnRzWyA1IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAxCiAgICAJCV9wb2ludHNbIDYgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWF4LnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMTAKICAgIAkJX3BvaW50c1sgNyBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDExMQoKICAgIAkJdGhpcy5zZXRGcm9tUG9pbnRzKCBfcG9pbnRzICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiBvZmZzZXQgdG8gYm90aCB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJvdW5kaW5nIGJveCwKICAgIAkgKiBlZmZlY3RpdmVseSBtb3ZpbmcgaXQgaW4gM0Qgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQgdGhhdCBzaG91bGQgYmUgdXNlZCB0byB0cmFuc2xhdGUgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGUoIG9mZnNldCApIHsKCiAgICAJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CiAgICAJCXRoaXMubWF4LmFkZCggb2Zmc2V0ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGJvdW5kaW5nIGJveCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGJvdW5kaW5nIGJveCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCBib3ggKSB7CgogICAgCQlyZXR1cm4gYm94Lm1pbi5lcXVhbHMoIHRoaXMubWluICkgJiYgYm94Lm1heC5lcXVhbHMoIHRoaXMubWF4ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IFNlcmlhbGl6ZWQgc3RydWN0dXJlIHdpdGggZmllbGRzIHJlcHJlc2VudGluZyB0aGUgb2JqZWN0IHN0YXRlLgogICAgCSAqLwogICAgCXRvSlNPTigpIHsKCiAgICAJCXJldHVybiB7CiAgICAJCQltaW46IHRoaXMubWluLnRvQXJyYXkoKSwKICAgIAkJCW1heDogdGhpcy5tYXgudG9BcnJheSgpCiAgICAJCX07CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0ganNvbiAtIFRoZSBzZXJpYWxpemVkIGpzb24gdG8gc2V0IHRoZSBib3ggZnJvbS4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlmcm9tSlNPTigganNvbiApIHsKCiAgICAJCXRoaXMubWluLmZyb21BcnJheSgganNvbi5taW4gKTsKICAgIAkJdGhpcy5tYXguZnJvbUFycmF5KCBqc29uLm1heCApOwogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfcG9pbnRzID0gWwogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkKICAgIF07CgogICAgY29uc3QgX3ZlY3RvciRiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGNvbnN0IF9ib3gkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKCiAgICAvLyB0cmlhbmdsZSBjZW50ZXJlZCB2ZXJ0aWNlcwoKICAgIGNvbnN0IF92MCQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3YxJDcgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdjIkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICAvLyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMKCiAgICBjb25zdCBfZjAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfZjEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfZjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX2NlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9leHRlbnRzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3RyaWFuZ2xlTm9ybWFsID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3Rlc3RBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGZ1bmN0aW9uIHNhdEZvckF4ZXMoIGF4ZXMsIHYwLCB2MSwgdjIsIGV4dGVudHMgKSB7CgogICAgCWZvciAoIGxldCBpID0gMCwgaiA9IGF4ZXMubGVuZ3RoIC0gMzsgaSA8PSBqOyBpICs9IDMgKSB7CgogICAgCQlfdGVzdEF4aXMuZnJvbUFycmF5KCBheGVzLCBpICk7CiAgICAJCS8vIHByb2plY3QgdGhlIGFhYmIgb250byB0aGUgc2VwYXJhdGluZyBheGlzCiAgICAJCWNvbnN0IHIgPSBleHRlbnRzLnggKiBNYXRoLmFicyggX3Rlc3RBeGlzLnggKSArIGV4dGVudHMueSAqIE1hdGguYWJzKCBfdGVzdEF4aXMueSApICsgZXh0ZW50cy56ICogTWF0aC5hYnMoIF90ZXN0QXhpcy56ICk7CiAgICAJCS8vIHByb2plY3QgYWxsIDMgdmVydGljZXMgb2YgdGhlIHRyaWFuZ2xlIG9udG8gdGhlIHNlcGFyYXRpbmcgYXhpcwogICAgCQljb25zdCBwMCA9IHYwLmRvdCggX3Rlc3RBeGlzICk7CiAgICAJCWNvbnN0IHAxID0gdjEuZG90KCBfdGVzdEF4aXMgKTsKICAgIAkJY29uc3QgcDIgPSB2Mi5kb3QoIF90ZXN0QXhpcyApOwogICAgCQkvLyBhY3R1YWwgdGVzdCwgYmFzaWNhbGx5IHNlZSBpZiBlaXRoZXIgb2YgdGhlIG1vc3QgZXh0cmVtZSBvZiB0aGUgdHJpYW5nbGUgcG9pbnRzIGludGVyc2VjdHMgcgogICAgCQlpZiAoIE1hdGgubWF4KCAtIE1hdGgubWF4KCBwMCwgcDEsIHAyICksIE1hdGgubWluKCBwMCwgcDEsIHAyICkgKSA+IHIgKSB7CgogICAgCQkJLy8gcG9pbnRzIG9mIHRoZSBwcm9qZWN0ZWQgdHJpYW5nbGUgYXJlIG91dHNpZGUgdGhlIHByb2plY3RlZCBoYWxmLWxlbmd0aCBvZiB0aGUgYWFiYgogICAgCQkJLy8gdGhlIGF4aXMgaXMgc2VwYXJhdGluZyBhbmQgd2UgY2FuIGV4aXQKICAgIAkJCXJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gdHJ1ZTsKCiAgICB9CgogICAgY29uc3QgX2JveCQzID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwogICAgY29uc3QgX3YxJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdjIkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICAvKioKICAgICAqIEFuIGFuYWx5dGljYWwgM0Qgc3BoZXJlIGRlZmluZWQgYnkgYSBjZW50ZXIgYW5kIHJhZGl1cy4gVGhpcyBjbGFzcyBpcyBtYWlubHkKICAgICAqIHVzZWQgYXMgYSBCb3VuZGluZyBTcGhlcmUgZm9yIDNEIG9iamVjdHMuCiAgICAgKi8KICAgIGNsYXNzIFNwaGVyZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgc3BoZXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbY2VudGVyPSgwLDAsMCldIC0gVGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtyYWRpdXM9LTFdIC0gVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpLCByYWRpdXMgPSAtMSApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzU3BoZXJlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLmNlbnRlciA9IGNlbnRlcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBzcGhlcmUncyBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gY2VudGVyIC0gVGhlIGNlbnRlci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIC0gVGhlIHJhZGl1cy4KICAgIAkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgogICAgCSAqLwogICAgCXNldCggY2VudGVyLCByYWRpdXMgKSB7CgogICAgCQl0aGlzLmNlbnRlci5jb3B5KCBjZW50ZXIgKTsKICAgIAkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgbWluaW11bSBib3VuZGluZyBzcGhlcmUgZm9yIGxpc3Qgb2YgcG9pbnRzLgogICAgCSAqIElmIHRoZSBvcHRpb25hbCBjZW50ZXIgcG9pbnQgaXMgZ2l2ZW4sIGl0IGlzIHVzZWQgYXMgdGhlIHNwaGVyZSdzCiAgICAJICogY2VudGVyLiBPdGhlcndpc2UsIHRoZSBjZW50ZXIgb2YgdGhlIGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3gKICAgIAkgKiBlbmNvbXBhc3NpbmcgdGhlIHBvaW50cyBpcyBjYWxjdWxhdGVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxWZWN0b3IzPn0gcG9pbnRzIC0gQSBsaXN0IG9mIHBvaW50cyBpbiAzRCBzcGFjZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbENlbnRlcl0gLSBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUuCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KICAgIAkgKi8KICAgIAlzZXRGcm9tUG9pbnRzKCBwb2ludHMsIG9wdGlvbmFsQ2VudGVyICkgewoKICAgIAkJY29uc3QgY2VudGVyID0gdGhpcy5jZW50ZXI7CgogICAgCQlpZiAoIG9wdGlvbmFsQ2VudGVyICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY2VudGVyLmNvcHkoIG9wdGlvbmFsQ2VudGVyICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCV9ib3gkMy5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKS5nZXRDZW50ZXIoIGNlbnRlciApOwoKICAgIAkJfQoKICAgIAkJbGV0IG1heFJhZGl1c1NxID0gMDsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnRzWyBpIF0gKSApOwoKICAgIAkJfQoKICAgIAkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gc3BoZXJlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJY29weSggc3BoZXJlICkgewoKICAgIAkJdGhpcy5jZW50ZXIuY29weSggc3BoZXJlLmNlbnRlciApOwogICAgCQl0aGlzLnJhZGl1cyA9IHNwaGVyZS5yYWRpdXM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc3BoZXJlIGlzIGVtcHR5ICh0aGUgcmFkaXVzIHNldCB0byBhIG5lZ2F0aXZlIG51bWJlcikuCiAgICAJICoKICAgIAkgKiBTcGhlcmVzIHdpdGggYSByYWRpdXMgb2YgYDBgIGNvbnRhaW4gb25seSB0aGVpciBjZW50ZXIgcG9pbnQgYW5kIGFyZSBub3QKICAgIAkgKiBjb25zaWRlcmVkIHRvIGJlIGVtcHR5LgogICAgCSAqCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpcyBlbXB0eSBvciBub3QuCiAgICAJICovCiAgICAJaXNFbXB0eSgpIHsKCiAgICAJCXJldHVybiAoIHRoaXMucmFkaXVzIDwgMCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE1ha2VzIHRoaXMgc3BoZXJlIGVtcHR5IHdoaWNoIG1lYW5zIGluIGVuY2xvc2VzIGEgemVybyBzcGFjZSBpbiAzRC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJbWFrZUVtcHR5KCkgewoKICAgIAkJdGhpcy5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CiAgICAJCXRoaXMucmFkaXVzID0gLTE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgaW5jbHVzaXZlIG9mCiAgICAJICogdGhlIHN1cmZhY2Ugb2YgdGhlIHNwaGVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY2hlY2suCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgb3Igbm90LgogICAgCSAqLwogICAgCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKICAgIAkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuY2VudGVyICkgPD0gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBjbG9zZXN0IGRpc3RhbmNlIGZyb20gdGhlIGJvdW5kYXJ5IG9mIHRoZSBzcGhlcmUgdG8gdGhlCiAgICAJICogZ2l2ZW4gcG9pbnQuIElmIHRoZSBzcGhlcmUgY29udGFpbnMgdGhlIHBvaW50LCB0aGUgZGlzdGFuY2Ugd2lsbAogICAgCSAqIGJlIG5lZ2F0aXZlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZSB0byB0aGUgcG9pbnQuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCiAgICAJCXJldHVybiAoIHBvaW50LmRpc3RhbmNlVG8oIHRoaXMuY2VudGVyICkgLSB0aGlzLnJhZGl1cyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gb25lIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgogICAgCQljb25zdCByYWRpdXNTdW0gPSB0aGlzLnJhZGl1cyArIHNwaGVyZS5yYWRpdXM7CgogICAgCQlyZXR1cm4gc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHJhZGl1c1N1bSAqIHJhZGl1c1N1bSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0JveCggYm94ICkgewoKICAgIAkJcmV0dXJuIGJveC5pbnRlcnNlY3RzU3BoZXJlKCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKICAgIAkJcmV0dXJuIE1hdGguYWJzKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMuY2VudGVyICkgKSA8PSB0aGlzLnJhZGl1czsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDbGFtcHMgYSBwb2ludCB3aXRoaW4gdGhlIHNwaGVyZS4gSWYgdGhlIHBvaW50IGlzIG91dHNpZGUgdGhlIHNwaGVyZSwgaXQKICAgIAkgKiB3aWxsIGNsYW1wIGl0IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBlZGdlIG9mIHRoZSBzcGhlcmUuIFBvaW50cwogICAgCSAqIGFscmVhZHkgaW5zaWRlIHRoZSBzcGhlcmUgd2lsbCBub3QgYmUgYWZmZWN0ZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBsYW5lIHRvIGNsYW1wLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsYW1wZWQgcG9pbnQuCiAgICAJICovCiAgICAJY2xhbXBQb2ludCggcG9pbnQsIHRhcmdldCApIHsKCiAgICAJCWNvbnN0IGRlbHRhTGVuZ3RoU3EgPSB0aGlzLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCiAgICAJCXRhcmdldC5jb3B5KCBwb2ludCApOwoKICAgIAkJaWYgKCBkZWx0YUxlbmd0aFNxID4gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKSB7CgogICAgCQkJdGFyZ2V0LnN1YiggdGhpcy5jZW50ZXIgKS5ub3JtYWxpemUoKTsKICAgIAkJCXRhcmdldC5tdWx0aXBseVNjYWxhciggdGhpcy5yYWRpdXMgKS5hZGQoIHRoaXMuY2VudGVyICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBib3VuZGluZyBib3ggdGhhdCBlbmNsb3NlcyB0aGlzIHNwaGVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gdGFyZ2V0IC0gVGhlIHRhcmdldCBib3ggdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7Qm94M30gVGhlIGJvdW5kaW5nIGJveCB0aGF0IGVuY2xvc2VzIHRoaXMgc3BoZXJlLgogICAgCSAqLwogICAgCWdldEJvdW5kaW5nQm94KCB0YXJnZXQgKSB7CgogICAgCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKICAgIAkJCS8vIEVtcHR5IHNwaGVyZSBwcm9kdWNlcyBlbXB0eSBib3VuZGluZyBib3gKICAgIAkJCXRhcmdldC5tYWtlRW1wdHkoKTsKICAgIAkJCXJldHVybiB0YXJnZXQ7CgogICAgCQl9CgogICAgCQl0YXJnZXQuc2V0KCB0aGlzLmNlbnRlciwgdGhpcy5jZW50ZXIgKTsKICAgIAkJdGFyZ2V0LmV4cGFuZEJ5U2NhbGFyKCB0aGlzLnJhZGl1cyApOwoKICAgIAkJcmV0dXJuIHRhcmdldDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2Zvcm1zIHRoaXMgc3BoZXJlIHdpdGggdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KICAgIAkgKi8KICAgIAlhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCiAgICAJCXRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CiAgICAJCXRoaXMucmFkaXVzID0gdGhpcy5yYWRpdXMgKiBtYXRyaXguZ2V0TWF4U2NhbGVPbkF4aXMoKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZXMgdGhlIHNwaGVyZSdzIGNlbnRlciBieSB0aGUgZ2l2ZW4gb2Zmc2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBvZmZzZXQgLSBUaGUgb2Zmc2V0LgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgogICAgCQl0aGlzLmNlbnRlci5hZGQoIG9mZnNldCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIHNwaGVyZSB0byBpbmNsdWRlIHRoZSBnaXZlbiBwb2ludC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gaW5jbHVkZS4KICAgIAkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgogICAgCSAqLwogICAgCWV4cGFuZEJ5UG9pbnQoIHBvaW50ICkgewoKICAgIAkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCiAgICAJCQl0aGlzLmNlbnRlci5jb3B5KCBwb2ludCApOwoKICAgIAkJCXRoaXMucmFkaXVzID0gMDsKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCV92MSQ2LnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLmNlbnRlciApOwoKICAgIAkJY29uc3QgbGVuZ3RoU3EgPSBfdjEkNi5sZW5ndGhTcSgpOwoKICAgIAkJaWYgKCBsZW5ndGhTcSA+ICggdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyApICkgewoKICAgIAkJCS8vIGNhbGN1bGF0ZSB0aGUgbWluaW1hbCBzcGhlcmUKCiAgICAJCQljb25zdCBsZW5ndGggPSBNYXRoLnNxcnQoIGxlbmd0aFNxICk7CgogICAgCQkJY29uc3QgZGVsdGEgPSAoIGxlbmd0aCAtIHRoaXMucmFkaXVzICkgKiAwLjU7CgogICAgCQkJdGhpcy5jZW50ZXIuYWRkU2NhbGVkVmVjdG9yKCBfdjEkNiwgZGVsdGEgLyBsZW5ndGggKTsKCiAgICAJCQl0aGlzLnJhZGl1cyArPSBkZWx0YTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEV4cGFuZHMgdGhpcyBzcGhlcmUgdG8gZW5jbG9zZSBib3RoIHRoZSBvcmlnaW5hbCBzcGhlcmUgYW5kIHRoZSBnaXZlbiBzcGhlcmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbmNsdWRlLgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJdW5pb24oIHNwaGVyZSApIHsKCiAgICAJCWlmICggc3BoZXJlLmlzRW1wdHkoKSApIHsKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgogICAgCQkJdGhpcy5jb3B5KCBzcGhlcmUgKTsKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5jZW50ZXIuZXF1YWxzKCBzcGhlcmUuY2VudGVyICkgPT09IHRydWUgKSB7CgogICAgCQkJIHRoaXMucmFkaXVzID0gTWF0aC5tYXgoIHRoaXMucmFkaXVzLCBzcGhlcmUucmFkaXVzICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCV92MiQzLnN1YlZlY3RvcnMoIHNwaGVyZS5jZW50ZXIsIHRoaXMuY2VudGVyICkuc2V0TGVuZ3RoKCBzcGhlcmUucmFkaXVzICk7CgogICAgCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuYWRkKCBfdjIkMyApICk7CgogICAgCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuc3ViKCBfdjIkMyApICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgc3BoZXJlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIHNwaGVyZSApIHsKCiAgICAJCXJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyggdGhpcy5jZW50ZXIgKSAmJiAoIHNwaGVyZS5yYWRpdXMgPT09IHRoaXMucmFkaXVzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyBzcGhlcmUgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBzZXJpYWxpemVkIHN0cnVjdHVyZSBvZiB0aGUgYm91bmRpbmcgc3BoZXJlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7T2JqZWN0fSBTZXJpYWxpemVkIHN0cnVjdHVyZSB3aXRoIGZpZWxkcyByZXByZXNlbnRpbmcgdGhlIG9iamVjdCBzdGF0ZS4KICAgIAkgKi8KICAgIAl0b0pTT04oKSB7CgogICAgCQlyZXR1cm4gewogICAgCQkJcmFkaXVzOiB0aGlzLnJhZGl1cywKICAgIAkJCWNlbnRlcjogdGhpcy5jZW50ZXIudG9BcnJheSgpCiAgICAJCX07CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBzcGhlcmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0ganNvbiAtIFRoZSBzZXJpYWxpemVkIGpzb24gdG8gc2V0IHRoZSBzcGhlcmUgZnJvbS4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIHNwaGVyZS4KICAgIAkgKi8KICAgIAlmcm9tSlNPTigganNvbiApIHsKCiAgICAJCXRoaXMucmFkaXVzID0ganNvbi5yYWRpdXM7CiAgICAJCXRoaXMuY2VudGVyLmZyb21BcnJheSgganNvbi5jZW50ZXIgKTsKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX3ZlY3RvciRhID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3NlZ0NlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9zZWdEaXIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfZGlmZiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfZWRnZTEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfZWRnZTIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfbm9ybWFsJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgLyoqCiAgICAgKiBBIHJheSB0aGF0IGVtaXRzIGZyb20gYW4gb3JpZ2luIGluIGEgY2VydGFpbiBkaXJlY3Rpb24uIFRoZSBjbGFzcyBpcyB1c2VkIGJ5CiAgICAgKiB7QGxpbmsgUmF5Y2FzdGVyfSB0byBhc3Npc3Qgd2l0aCByYXljYXN0aW5nLiBSYXljYXN0aW5nIGlzIHVzZWQgZm9yCiAgICAgKiBtb3VzZSBwaWNraW5nICh3b3JraW5nIG91dCB3aGF0IG9iamVjdHMgaW4gdGhlIDNEIHNwYWNlIHRoZSBtb3VzZSBpcyBvdmVyKQogICAgICogYW1vbmdzdCBvdGhlciB0aGluZ3MuCiAgICAgKi8KICAgIGNsYXNzIFJheSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgcmF5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbb3JpZ2luPSgwLDAsMCldIC0gVGhlIG9yaWdpbiBvZiB0aGUgcmF5LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW2RpcmVjdGlvbj0oMCwwLC0xKV0gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiBvZiB0aGUgcmF5LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBvcmlnaW4gPSBuZXcgVmVjdG9yMygpLCBkaXJlY3Rpb24gPSBuZXcgVmVjdG9yMyggMCwgMCwgLTEgKSApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgb3JpZ2luIG9mIHRoZSByYXkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtWZWN0b3IzfQogICAgCQkgKi8KICAgIAkJdGhpcy5vcmlnaW4gPSBvcmlnaW47CgogICAgCQkvKioKICAgIAkJICogVGhlIChub3JtYWxpemVkKSBkaXJlY3Rpb24gb2YgdGhlIHJheS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSByYXkncyBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gb3JpZ2luIC0gVGhlIG9yaWdpbi4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGRpcmVjdGlvbiAtIFRoZSBkaXJlY3Rpb24uCiAgICAJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KICAgIAkgKi8KICAgIAlzZXQoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKICAgIAkJdGhpcy5vcmlnaW4uY29weSggb3JpZ2luICk7CiAgICAJCXRoaXMuZGlyZWN0aW9uLmNvcHkoIGRpcmVjdGlvbiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIHJheSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtSYXl9IHJheSAtIFRoZSByYXkgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtSYXl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcmF5LgogICAgCSAqLwogICAgCWNvcHkoIHJheSApIHsKCiAgICAJCXRoaXMub3JpZ2luLmNvcHkoIHJheS5vcmlnaW4gKTsKICAgIAkJdGhpcy5kaXJlY3Rpb24uY29weSggcmF5LmRpcmVjdGlvbiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHZlY3RvciB0aGF0IGlzIGxvY2F0ZWQgYXQgYSBnaXZlbiBkaXN0YW5jZSBhbG9uZyB0aGlzIHJheS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGRpc3RhbmNlIGFsb25nIHRoZSByYXkgdG8gcmV0cmlldmUgYSBwb3NpdGlvbiBmb3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHBvc2l0aW9uIG9uIHRoZSByYXkuCiAgICAJICovCiAgICAJYXQoIHQsIHRhcmdldCApIHsKCiAgICAJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCB0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRqdXN0cyB0aGUgZGlyZWN0aW9uIG9mIHRoZSByYXkgdG8gcG9pbnQgYXQgdGhlIGdpdmVuIHZlY3RvciBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB0YXJnZXQgcG9zaXRpb24uCiAgICAJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KICAgIAkgKi8KICAgIAlsb29rQXQoIHYgKSB7CgogICAgCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCB2ICkuc3ViKCB0aGlzLm9yaWdpbiApLm5vcm1hbGl6ZSgpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2hpZnQgdGhlIG9yaWdpbiBvZiB0aGlzIHJheSBhbG9uZyBpdHMgZGlyZWN0aW9uIGJ5IHRoZSBnaXZlbiBkaXN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGRpc3RhbmNlIGFsb25nIHRoZSByYXkgdG8gaW50ZXJwb2xhdGUuCiAgICAJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KICAgIAkgKi8KICAgIAlyZWNhc3QoIHQgKSB7CgogICAgCQl0aGlzLm9yaWdpbi5jb3B5KCB0aGlzLmF0KCB0LCBfdmVjdG9yJGEgKSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgcG9pbnQgYWxvbmcgdGhpcyByYXkgdGhhdCBpcyBjbG9zZXN0IHRvIHRoZSBnaXZlbiBwb2ludC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGdldCB0aGUgY2xvc2V0IGxvY2F0aW9uIG9uIHRoZSByYXkgZm9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhpcyByYXkuCiAgICAJICovCiAgICAJY2xvc2VzdFBvaW50VG9Qb2ludCggcG9pbnQsIHRhcmdldCApIHsKCiAgICAJCXRhcmdldC5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKTsKCiAgICAJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gdGFyZ2V0LmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCiAgICAJCWlmICggZGlyZWN0aW9uRGlzdGFuY2UgPCAwICkgewoKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBkaXJlY3Rpb25EaXN0YW5jZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGRpc3RhbmNlIG9mIHRoZSBjbG9zZXN0IGFwcHJvYWNoIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBwb2ludC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgc3F1YXJlZCBkaXN0YW5jZSBvZiB0aGUgY2xvc2VzdCBhcHByb2FjaCBiZXR3ZWVuIHRoaXMgcmF5IGFuZCB0aGUgZ2l2ZW4gcG9pbnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBwb2ludCBpbiAzRCBzcGFjZSB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApIHsKCiAgICAJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gX3ZlY3RvciRhLnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLm9yaWdpbiApLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCiAgICAJCS8vIHBvaW50IGJlaGluZCB0aGUgcmF5CgogICAgCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCiAgICAJCQlyZXR1cm4gdGhpcy5vcmlnaW4uZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgogICAgCQl9CgogICAgCQlfdmVjdG9yJGEuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBkaXJlY3Rpb25EaXN0YW5jZSApOwoKICAgIAkJcmV0dXJuIF92ZWN0b3IkYS5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBzcXVhcmVkIGRpc3RhbmNlIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYwIC0gVGhlIHN0YXJ0IHBvaW50IG9mIHRoZSBsaW5lIHNlZ21lbnQuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2MSAtIFRoZSBlbmQgcG9pbnQgb2YgdGhlIGxpbmUgc2VnbWVudC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbFBvaW50T25SYXldIC0gV2hlbiBwcm92aWRlZCwgaXQgcmVjZWl2ZXMgdGhlIHBvaW50IG9uIHRoaXMgcmF5IHRoYXQgaXMgY2xvc2VzdCB0byB0aGUgc2VnbWVudC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbFBvaW50T25TZWdtZW50XSAtIFdoZW4gcHJvdmlkZWQsIGl0IHJlY2VpdmVzIHRoZSBwb2ludCBvbiB0aGUgbGluZSBzZWdtZW50IHRoYXQgaXMgY2xvc2VzdCB0byB0aGlzIHJheS4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlU3FUb1NlZ21lbnQoIHYwLCB2MSwgb3B0aW9uYWxQb2ludE9uUmF5LCBvcHRpb25hbFBvaW50T25TZWdtZW50ICkgewoKICAgIAkJLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vcG1qb25pYWsvR2VvbWV0cmljVG9vbHMvYmxvYi9tYXN0ZXIvR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVEaXN0UmF5U2VnbWVudC5oCiAgICAJCS8vIEl0IHJldHVybnMgdGhlIG1pbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSByYXkgYW5kIHRoZSBzZWdtZW50CiAgICAJCS8vIGRlZmluZWQgYnkgdjAgYW5kIHYxCiAgICAJCS8vIEl0IGNhbiBhbHNvIHNldCB0d28gb3B0aW9uYWwgdGFyZ2V0cyA6CiAgICAJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHJheQogICAgCQkvLyAtIFRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzZWdtZW50CgogICAgCQlfc2VnQ2VudGVyLmNvcHkoIHYwICkuYWRkKCB2MSApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKICAgIAkJX3NlZ0Rpci5jb3B5KCB2MSApLnN1YiggdjAgKS5ub3JtYWxpemUoKTsKICAgIAkJX2RpZmYuY29weSggdGhpcy5vcmlnaW4gKS5zdWIoIF9zZWdDZW50ZXIgKTsKCiAgICAJCWNvbnN0IHNlZ0V4dGVudCA9IHYwLmRpc3RhbmNlVG8oIHYxICkgKiAwLjU7CiAgICAJCWNvbnN0IGEwMSA9IC0gdGhpcy5kaXJlY3Rpb24uZG90KCBfc2VnRGlyICk7CiAgICAJCWNvbnN0IGIwID0gX2RpZmYuZG90KCB0aGlzLmRpcmVjdGlvbiApOwogICAgCQljb25zdCBiMSA9IC0gX2RpZmYuZG90KCBfc2VnRGlyICk7CiAgICAJCWNvbnN0IGMgPSBfZGlmZi5sZW5ndGhTcSgpOwogICAgCQljb25zdCBkZXQgPSBNYXRoLmFicyggMSAtIGEwMSAqIGEwMSApOwogICAgCQlsZXQgczAsIHMxLCBzcXJEaXN0LCBleHREZXQ7CgogICAgCQlpZiAoIGRldCA+IDAgKSB7CgogICAgCQkJLy8gVGhlIHJheSBhbmQgc2VnbWVudCBhcmUgbm90IHBhcmFsbGVsLgoKICAgIAkJCXMwID0gYTAxICogYjEgLSBiMDsKICAgIAkJCXMxID0gYTAxICogYjAgLSBiMTsKICAgIAkJCWV4dERldCA9IHNlZ0V4dGVudCAqIGRldDsKCiAgICAJCQlpZiAoIHMwID49IDAgKSB7CgogICAgCQkJCWlmICggczEgPj0gLSBleHREZXQgKSB7CgogICAgCQkJCQlpZiAoIHMxIDw9IGV4dERldCApIHsKCiAgICAJCQkJCQkvLyByZWdpb24gMAogICAgCQkJCQkJLy8gTWluaW11bSBhdCBpbnRlcmlvciBwb2ludHMgb2YgcmF5IGFuZCBzZWdtZW50LgoKICAgIAkJCQkJCWNvbnN0IGludkRldCA9IDEgLyBkZXQ7CiAgICAJCQkJCQlzMCAqPSBpbnZEZXQ7CiAgICAJCQkJCQlzMSAqPSBpbnZEZXQ7CiAgICAJCQkJCQlzcXJEaXN0ID0gczAgKiAoIHMwICsgYTAxICogczEgKyAyICogYjAgKSArIHMxICogKCBhMDEgKiBzMCArIHMxICsgMiAqIGIxICkgKyBjOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkvLyByZWdpb24gMQoKICAgIAkJCQkJCXMxID0gc2VnRXh0ZW50OwogICAgCQkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwogICAgCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCS8vIHJlZ2lvbiA1CgogICAgCQkJCQlzMSA9IC0gc2VnRXh0ZW50OwogICAgCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CiAgICAJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlpZiAoIHMxIDw9IC0gZXh0RGV0ICkgewoKICAgIAkJCQkJLy8gcmVnaW9uIDQKCiAgICAJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCAtIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKICAgIAkJCQkJczEgPSAoIHMwID4gMCApID8gLSBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwogICAgCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBzMSA8PSBleHREZXQgKSB7CgogICAgCQkJCQkvLyByZWdpb24gMwoKICAgIAkJCQkJczAgPSAwOwogICAgCQkJCQlzMSA9IE1hdGgubWluKCBNYXRoLm1heCggLSBzZWdFeHRlbnQsIC0gYjEgKSwgc2VnRXh0ZW50ICk7CiAgICAJCQkJCXNxckRpc3QgPSBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQkvLyByZWdpb24gMgoKICAgIAkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKICAgIAkJCQkJczEgPSAoIHMwID4gMCApID8gc2VnRXh0ZW50IDogTWF0aC5taW4oIE1hdGgubWF4KCAtIHNlZ0V4dGVudCwgLSBiMSApLCBzZWdFeHRlbnQgKTsKICAgIAkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJLy8gUmF5IGFuZCBzZWdtZW50IGFyZSBwYXJhbGxlbC4KCiAgICAJCQlzMSA9ICggYTAxID4gMCApID8gLSBzZWdFeHRlbnQgOiBzZWdFeHRlbnQ7CiAgICAJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CiAgICAJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKICAgIAkJfQoKICAgIAkJaWYgKCBvcHRpb25hbFBvaW50T25SYXkgKSB7CgogICAgCQkJb3B0aW9uYWxQb2ludE9uUmF5LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgczAgKTsKCiAgICAJCX0KCiAgICAJCWlmICggb3B0aW9uYWxQb2ludE9uU2VnbWVudCApIHsKCiAgICAJCQlvcHRpb25hbFBvaW50T25TZWdtZW50LmNvcHkoIF9zZWdDZW50ZXIgKS5hZGRTY2FsZWRWZWN0b3IoIF9zZWdEaXIsIHMxICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gc3FyRGlzdDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnRlcnNlY3RzIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIHNwaGVyZSwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KICAgIAkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gaW50ZXJzZWN0LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCiAgICAJICovCiAgICAJaW50ZXJzZWN0U3BoZXJlKCBzcGhlcmUsIHRhcmdldCApIHsKCiAgICAJCV92ZWN0b3IkYS5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLm9yaWdpbiApOwogICAgCQljb25zdCB0Y2EgPSBfdmVjdG9yJGEuZG90KCB0aGlzLmRpcmVjdGlvbiApOwogICAgCQljb25zdCBkMiA9IF92ZWN0b3IkYS5kb3QoIF92ZWN0b3IkYSApIC0gdGNhICogdGNhOwogICAgCQljb25zdCByYWRpdXMyID0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CgogICAgCQlpZiAoIGQyID4gcmFkaXVzMiApIHJldHVybiBudWxsOwoKICAgIAkJY29uc3QgdGhjID0gTWF0aC5zcXJ0KCByYWRpdXMyIC0gZDIgKTsKCiAgICAJCS8vIHQwID0gZmlyc3QgaW50ZXJzZWN0IHBvaW50IC0gZW50cmFuY2Ugb24gZnJvbnQgb2Ygc3BoZXJlCiAgICAJCWNvbnN0IHQwID0gdGNhIC0gdGhjOwoKICAgIAkJLy8gdDEgPSBzZWNvbmQgaW50ZXJzZWN0IHBvaW50IC0gZXhpdCBwb2ludCBvbiBiYWNrIG9mIHNwaGVyZQogICAgCQljb25zdCB0MSA9IHRjYSArIHRoYzsKCiAgICAJCS8vIHRlc3QgdG8gc2VlIGlmIHQxIGlzIGJlaGluZCB0aGUgcmF5IC0gaWYgc28sIHJldHVybiBudWxsCiAgICAJCWlmICggdDEgPCAwICkgcmV0dXJuIG51bGw7CgogICAgCQkvLyB0ZXN0IHRvIHNlZSBpZiB0MCBpcyBiZWhpbmQgdGhlIHJheToKICAgIAkJLy8gaWYgaXQgaXMsIHRoZSByYXkgaXMgaW5zaWRlIHRoZSBzcGhlcmUsIHNvIHJldHVybiB0aGUgc2Vjb25kIGV4aXQgcG9pbnQgc2NhbGVkIGJ5IHQxLAogICAgCQkvLyBpbiBvcmRlciB0byBhbHdheXMgcmV0dXJuIGFuIGludGVyc2VjdCBwb2ludCB0aGF0IGlzIGluIGZyb250IG9mIHRoZSByYXkuCiAgICAJCWlmICggdDAgPCAwICkgcmV0dXJuIHRoaXMuYXQoIHQxLCB0YXJnZXQgKTsKCiAgICAJCS8vIGVsc2UgdDAgaXMgaW4gZnJvbnQgb2YgdGhlIHJheSwgc28gcmV0dXJuIHRoZSBmaXJzdCBjb2xsaXNpb24gcG9pbnQgc2NhbGVkIGJ5IHQwCiAgICAJCXJldHVybiB0aGlzLmF0KCB0MCwgdGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBzcGhlcmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbnRlcnNlY3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKICAgIAkJaWYgKCBzcGhlcmUucmFkaXVzIDwgMCApIHJldHVybiBmYWxzZTsgLy8gaGFuZGxlIGVtcHR5IHNwaGVyZXMsIHNlZSAjMzExODcKCiAgICAJCXJldHVybiB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgPD0gKCBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1cyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSByYXkncyBvcmlnaW4gdG8gdGhlIGdpdmVuIHBsYW5lLiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgcmF5CiAgICAJICogZG9lcyBub3QgaW50ZXJzZWN0IHdpdGggdGhlIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgdG8uCiAgICAJICogQHJldHVybiB7P251bWJlcn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZSBvciBub3QuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1BsYW5lKCBwbGFuZSApIHsKCiAgICAJCWNvbnN0IGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCiAgICAJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgogICAgCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgogICAgCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICkgPT09IDAgKSB7CgogICAgCQkJCXJldHVybiAwOwoKICAgIAkJCX0KCiAgICAJCQkvLyBOdWxsIGlzIHByZWZlcmFibGUgdG8gdW5kZWZpbmVkIHNpbmNlIHVuZGVmaW5lZCBtZWFucy4uLi4gaXQgaXMgdW5kZWZpbmVkCgogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9CgogICAgCQljb25zdCB0ID0gLSAoIHRoaXMub3JpZ2luLmRvdCggcGxhbmUubm9ybWFsICkgKyBwbGFuZS5jb25zdGFudCApIC8gZGVub21pbmF0b3I7CgogICAgCQkvLyBSZXR1cm4gaWYgdGhlIHJheSBuZXZlciBpbnRlcnNlY3RzIHRoZSBwbGFuZQoKICAgIAkJcmV0dXJuIHQgPj0gMCA/IHQgOiBudWxsOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUsIHJldHVybmluZyB0aGUgaW50ZXJzZWN0aW9uCiAgICAJICogcG9pbnQgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGludGVyc2VjdC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJzZWN0aW9uIHBvaW50LgogICAgCSAqLwogICAgCWludGVyc2VjdFBsYW5lKCBwbGFuZSwgdGFyZ2V0ICkgewoKICAgIAkJY29uc3QgdCA9IHRoaXMuZGlzdGFuY2VUb1BsYW5lKCBwbGFuZSApOwoKICAgIAkJaWYgKCB0ID09PSBudWxsICkgewoKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXMuYXQoIHQsIHRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byBpbnRlcnNlY3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKICAgIAkJLy8gY2hlY2sgaWYgdGhlIHJheSBsaWVzIG9uIHRoZSBwbGFuZSBmaXJzdAoKICAgIAkJY29uc3QgZGlzdFRvUG9pbnQgPSBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICk7CgogICAgCQlpZiAoIGRpc3RUb1BvaW50ID09PSAwICkgewoKICAgIAkJCXJldHVybiB0cnVlOwoKICAgIAkJfQoKICAgIAkJY29uc3QgZGVub21pbmF0b3IgPSBwbGFuZS5ub3JtYWwuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKICAgIAkJaWYgKCBkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCApIHsKCiAgICAJCQlyZXR1cm4gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCS8vIHJheSBvcmlnaW4gaXMgYmVoaW5kIHRoZSBwbGFuZSAoYW5kIGlzIHBvaW50aW5nIGJlaGluZCBpdCkKCiAgICAJCXJldHVybiBmYWxzZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnRlcnNlY3RzIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIGJvdW5kaW5nIGJveCwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KICAgIAkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIGludGVyc2VjdC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJzZWN0aW9uIHBvaW50LgogICAgCSAqLwogICAgCWludGVyc2VjdEJveCggYm94LCB0YXJnZXQgKSB7CgogICAgCQlsZXQgdG1pbiwgdG1heCwgdHltaW4sIHR5bWF4LCB0em1pbiwgdHptYXg7CgogICAgCQljb25zdCBpbnZkaXJ4ID0gMSAvIHRoaXMuZGlyZWN0aW9uLngsCiAgICAJCQlpbnZkaXJ5ID0gMSAvIHRoaXMuZGlyZWN0aW9uLnksCiAgICAJCQlpbnZkaXJ6ID0gMSAvIHRoaXMuZGlyZWN0aW9uLno7CgogICAgCQljb25zdCBvcmlnaW4gPSB0aGlzLm9yaWdpbjsKCiAgICAJCWlmICggaW52ZGlyeCA+PSAwICkgewoKICAgIAkJCXRtaW4gPSAoIGJveC5taW4ueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwogICAgCQkJdG1heCA9ICggYm94Lm1heC54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRtaW4gPSAoIGJveC5tYXgueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwogICAgCQkJdG1heCA9ICggYm94Lm1pbi54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgogICAgCQl9CgogICAgCQlpZiAoIGludmRpcnkgPj0gMCApIHsKCiAgICAJCQl0eW1pbiA9ICggYm94Lm1pbi55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CiAgICAJCQl0eW1heCA9ICggYm94Lm1heC55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXR5bWluID0gKCBib3gubWF4LnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKICAgIAkJCXR5bWF4ID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCiAgICAJCX0KCiAgICAJCWlmICggKCB0bWluID4gdHltYXggKSB8fCAoIHR5bWluID4gdG1heCApICkgcmV0dXJuIG51bGw7CgogICAgCQlpZiAoIHR5bWluID4gdG1pbiB8fCBpc05hTiggdG1pbiApICkgdG1pbiA9IHR5bWluOwoKICAgIAkJaWYgKCB0eW1heCA8IHRtYXggfHwgaXNOYU4oIHRtYXggKSApIHRtYXggPSB0eW1heDsKCiAgICAJCWlmICggaW52ZGlyeiA+PSAwICkgewoKICAgIAkJCXR6bWluID0gKCBib3gubWluLnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKICAgIAkJCXR6bWF4ID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdHptaW4gPSAoIGJveC5tYXgueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwogICAgCQkJdHptYXggPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKICAgIAkJfQoKICAgIAkJaWYgKCAoIHRtaW4gPiB0em1heCApIHx8ICggdHptaW4gPiB0bWF4ICkgKSByZXR1cm4gbnVsbDsKCiAgICAJCWlmICggdHptaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4gKSB0bWluID0gdHptaW47CgogICAgCQlpZiAoIHR6bWF4IDwgdG1heCB8fCB0bWF4ICE9PSB0bWF4ICkgdG1heCA9IHR6bWF4OwoKICAgIAkJLy9yZXR1cm4gcG9pbnQgY2xvc2VzdCB0byB0aGUgcmF5IChwb3NpdGl2ZSBzaWRlKQoKICAgIAkJaWYgKCB0bWF4IDwgMCApIHJldHVybiBudWxsOwoKICAgIAkJcmV0dXJuIHRoaXMuYXQoIHRtaW4gPj0gMCA/IHRtaW4gOiB0bWF4LCB0YXJnZXQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBpbnRlcnNlY3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0JveCggYm94ICkgewoKICAgIAkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0Qm94KCBib3gsIF92ZWN0b3IkYSApICE9PSBudWxsOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gdHJpYW5nbGUsIHJldHVybmluZyB0aGUgaW50ZXJzZWN0aW9uCiAgICAJICogcG9pbnQgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZXJ0ZXggb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVydGV4IG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgdmVydGV4IG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IGJhY2tmYWNlQ3VsbGluZyAtIFdoZXRoZXIgdG8gdXNlIGJhY2tmYWNlIGN1bGxpbmcgb3Igbm90LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCiAgICAJICovCiAgICAJaW50ZXJzZWN0VHJpYW5nbGUoIGEsIGIsIGMsIGJhY2tmYWNlQ3VsbGluZywgdGFyZ2V0ICkgewoKICAgIAkJLy8gQ29tcHV0ZSB0aGUgb2Zmc2V0IG9yaWdpbiwgZWRnZXMsIGFuZCBub3JtYWwuCgogICAgCQkvLyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9wbWpvbmlhay9HZW9tZXRyaWNUb29scy9ibG9iL21hc3Rlci9HVEVuZ2luZS9JbmNsdWRlL01hdGhlbWF0aWNzL0d0ZUludHJSYXkzVHJpYW5nbGUzLmgKCiAgICAJCV9lZGdlMS5zdWJWZWN0b3JzKCBiLCBhICk7CiAgICAJCV9lZGdlMi5zdWJWZWN0b3JzKCBjLCBhICk7CiAgICAJCV9ub3JtYWwkMS5jcm9zc1ZlY3RvcnMoIF9lZGdlMSwgX2VkZ2UyICk7CgogICAgCQkvLyBTb2x2ZSBRICsgdCpEID0gYjEqRTEgKyBiMipFMiAoUSA9IGtEaWZmLCBEID0gcmF5IGRpcmVjdGlvbiwKICAgIAkJLy8gRTEgPSBrRWRnZTEsIEUyID0ga0VkZ2UyLCBOID0gQ3Jvc3MoRTEsRTIpKSBieQogICAgCQkvLyAgIHxEb3QoRCxOKXwqYjEgPSBzaWduKERvdChELE4pKSpEb3QoRCxDcm9zcyhRLEUyKSkKICAgIAkJLy8gICB8RG90KEQsTil8KmIyID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoRTEsUSkpCiAgICAJCS8vICAgfERvdChELE4pfCp0ID0gLXNpZ24oRG90KEQsTikpKkRvdChRLE4pCiAgICAJCWxldCBEZE4gPSB0aGlzLmRpcmVjdGlvbi5kb3QoIF9ub3JtYWwkMSApOwogICAgCQlsZXQgc2lnbjsKCiAgICAJCWlmICggRGROID4gMCApIHsKCiAgICAJCQlpZiAoIGJhY2tmYWNlQ3VsbGluZyApIHJldHVybiBudWxsOwogICAgCQkJc2lnbiA9IDE7CgogICAgCQl9IGVsc2UgaWYgKCBEZE4gPCAwICkgewoKICAgIAkJCXNpZ24gPSAtMTsKICAgIAkJCURkTiA9IC0gRGROOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCV9kaWZmLnN1YlZlY3RvcnMoIHRoaXMub3JpZ2luLCBhICk7CiAgICAJCWNvbnN0IERkUXhFMiA9IHNpZ24gKiB0aGlzLmRpcmVjdGlvbi5kb3QoIF9lZGdlMi5jcm9zc1ZlY3RvcnMoIF9kaWZmLCBfZWRnZTIgKSApOwoKICAgIAkJLy8gYjEgPCAwLCBubyBpbnRlcnNlY3Rpb24KICAgIAkJaWYgKCBEZFF4RTIgPCAwICkgewoKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJY29uc3QgRGRFMXhRID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UxLmNyb3NzKCBfZGlmZiApICk7CgogICAgCQkvLyBiMiA8IDAsIG5vIGludGVyc2VjdGlvbgogICAgCQlpZiAoIERkRTF4USA8IDAgKSB7CgogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9CgogICAgCQkvLyBiMStiMiA+IDEsIG5vIGludGVyc2VjdGlvbgogICAgCQlpZiAoIERkUXhFMiArIERkRTF4USA+IERkTiApIHsKCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCS8vIExpbmUgaW50ZXJzZWN0cyB0cmlhbmdsZSwgY2hlY2sgaWYgcmF5IGRvZXMuCiAgICAJCWNvbnN0IFFkTiA9IC0gc2lnbiAqIF9kaWZmLmRvdCggX25vcm1hbCQxICk7CgogICAgCQkvLyB0IDwgMCwgbm8gaW50ZXJzZWN0aW9uCiAgICAJCWlmICggUWROIDwgMCApIHsKCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCS8vIFJheSBpbnRlcnNlY3RzIHRyaWFuZ2xlLgogICAgCQlyZXR1cm4gdGhpcy5hdCggUWROIC8gRGROLCB0YXJnZXQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2Zvcm1zIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeDQgLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqIEByZXR1cm4ge1JheX0gQSByZWZlcmVuY2UgdG8gdGhpcyByYXkuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtYXRyaXg0ICkgewoKICAgIAkJdGhpcy5vcmlnaW4uYXBwbHlNYXRyaXg0KCBtYXRyaXg0ICk7CiAgICAJCXRoaXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4NCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtSYXl9IHJheSAtIFRoZSByYXkgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCByYXkgKSB7CgogICAgCQlyZXR1cm4gcmF5Lm9yaWdpbi5lcXVhbHMoIHRoaXMub3JpZ2luICkgJiYgcmF5LmRpcmVjdGlvbi5lcXVhbHMoIHRoaXMuZGlyZWN0aW9uICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyByYXkgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1JheX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyBhIDR4NCBtYXRyaXguCiAgICAgKgogICAgICogVGhlIG1vc3QgY29tbW9uIHVzZSBvZiBhIDR4NCBtYXRyaXggaW4gM0QgY29tcHV0ZXIgZ3JhcGhpY3MgaXMgYXMgYSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAgKiBGb3IgYW4gaW50cm9kdWN0aW9uIHRvIHRyYW5zZm9ybWF0aW9uIG1hdHJpY2VzIGFzIHVzZWQgaW4gV2ViR0wsIGNoZWNrIG91dCBbdGhpcyB0dXRvcmlhbF17QGxpbmsgaHR0cHM6Ly93d3cub3BlbmdsLXR1dG9yaWFsLm9yZy9iZWdpbm5lcnMtdHV0b3JpYWxzL3R1dG9yaWFsLTMtbWF0cmljZXN9CiAgICAgKgogICAgICogVGhpcyBhbGxvd3MgYSAzRCB2ZWN0b3IgcmVwcmVzZW50aW5nIGEgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdW5kZXJnbwogICAgICogdHJhbnNmb3JtYXRpb25zIHN1Y2ggYXMgdHJhbnNsYXRpb24sIHJvdGF0aW9uLCBzaGVhciwgc2NhbGUsIHJlZmxlY3Rpb24sCiAgICAgKiBvcnRob2dvbmFsIG9yIHBlcnNwZWN0aXZlIHByb2plY3Rpb24gYW5kIHNvIG9uLCBieSBiZWluZyBtdWx0aXBsaWVkIGJ5IHRoZQogICAgICogbWF0cml4LiBUaGlzIGlzIGtub3duIGFzIGBhcHBseWluZ2AgdGhlIG1hdHJpeCB0byB0aGUgdmVjdG9yLgogICAgICoKICAgICAqIEEgTm90ZSBvbiBSb3ctTWFqb3IgYW5kIENvbHVtbi1NYWpvciBPcmRlcmluZzoKICAgICAqCiAgICAgKiBUaGUgY29uc3RydWN0b3IgYW5kIHtAbGluayBNYXRyaXgzI3NldH0gbWV0aG9kIHRha2UgYXJndW1lbnRzIGluCiAgICAgKiBbcm93LW1ham9yXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3ctX2FuZF9jb2x1bW4tbWFqb3Jfb3JkZXIjQ29sdW1uLW1ham9yX29yZGVyfQogICAgICogb3JkZXIsIHdoaWxlIGludGVybmFsbHkgdGhleSBhcmUgc3RvcmVkIGluIHRoZSB7QGxpbmsgTWF0cml4MyNlbGVtZW50c30gYXJyYXkgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgICogVGhpcyBtZWFucyB0aGF0IGNhbGxpbmc6CiAgICAgKiBgYGBqcwogICAgICogY29uc3QgbSA9IG5ldyBUSFJFRS5NYXRyaXg0KCk7CiAgICAgKiBtLnNldCggMTEsIDEyLCAxMywgMTQsCiAgICAgKiAgICAgICAgMjEsIDIyLCAyMywgMjQsCiAgICAgKiAgICAgICAgMzEsIDMyLCAzMywgMzQsCiAgICAgKiAgICAgICAgNDEsIDQyLCA0MywgNDQgKTsKICAgICAqIGBgYAogICAgICogd2lsbCByZXN1bHQgaW4gdGhlIGVsZW1lbnRzIGFycmF5IGNvbnRhaW5pbmc6CiAgICAgKiBgYGBqcwogICAgICogbS5lbGVtZW50cyA9IFsgMTEsIDIxLCAzMSwgNDEsCiAgICAgKiAgICAgICAgICAgICAgICAxMiwgMjIsIDMyLCA0MiwKICAgICAqICAgICAgICAgICAgICAgIDEzLCAyMywgMzMsIDQzLAogICAgICogICAgICAgICAgICAgICAgMTQsIDI0LCAzNCwgNDQgXTsKICAgICAqIGBgYAogICAgICogYW5kIGludGVybmFsbHkgYWxsIGNhbGN1bGF0aW9ucyBhcmUgcGVyZm9ybWVkIHVzaW5nIGNvbHVtbi1tYWpvciBvcmRlcmluZy4KICAgICAqIEhvd2V2ZXIsIGFzIHRoZSBhY3R1YWwgb3JkZXJpbmcgbWFrZXMgbm8gZGlmZmVyZW5jZSBtYXRoZW1hdGljYWxseSBhbmQKICAgICAqIG1vc3QgcGVvcGxlIGFyZSB1c2VkIHRvIHRoaW5raW5nIGFib3V0IG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlciwgdGhlCiAgICAgKiB0aHJlZS5qcyBkb2N1bWVudGF0aW9uIHNob3dzIG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlci4gSnVzdCBiZWFyIGluCiAgICAgKiBtaW5kIHRoYXQgaWYgeW91IGFyZSByZWFkaW5nIHRoZSBzb3VyY2UgY29kZSwgeW91J2xsIGhhdmUgdG8gdGFrZSB0aGUKICAgICAqIHRyYW5zcG9zZSBvZiBhbnkgbWF0cmljZXMgb3V0bGluZWQgaGVyZSB0byBtYWtlIHNlbnNlIG9mIHRoZSBjYWxjdWxhdGlvbnMuCiAgICAgKi8KICAgIGNsYXNzIE1hdHJpeDQgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IDR4NCBtYXRyaXguIFRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCiAgICAJICogaW4gcm93LW1ham9yIG9yZGVyLiBJZiBubyBhcmd1bWVudHMgYXJlIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0b3IKICAgIAkgKiBpbml0aWFsaXplcyB0aGUgbWF0cml4IGFzIGFuIGlkZW50aXR5IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjExXSAtIDEtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xMl0gLSAxLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTNdIC0gMS0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjE0XSAtIDEtNCBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yNF0gLSAyLTQgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzRdIC0gMy00IG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQxXSAtIDQtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW240Ml0gLSA0LTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuNDNdIC0gNC0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQ0XSAtIDQtNCBtYXRyaXggZWxlbWVudC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCU1hdHJpeDQucHJvdG90eXBlLmlzTWF0cml4NCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogQSBjb2x1bW4tbWFqb3IgbGlzdCBvZiBtYXRyaXggdmFsdWVzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPn0KICAgIAkJICovCiAgICAJCXRoaXMuZWxlbWVudHMgPSBbCgogICAgCQkJMSwgMCwgMCwgMCwKICAgIAkJCTAsIDEsIDAsIDAsCiAgICAJCQkwLCAwLCAxLCAwLAogICAgCQkJMCwgMCwgMCwgMQoKICAgIAkJXTsKCiAgICAJCWlmICggbjExICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtYXRyaXguVGhlIGFyZ3VtZW50cyBhcmUgc3VwcG9zZWQgdG8gYmUKICAgIAkgKiBpbiByb3ctbWFqb3Igb3JkZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xNF0gLSAxLTQgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjFdIC0gMi0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIyXSAtIDItMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yM10gLSAyLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjRdIC0gMi00IG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMxXSAtIDMtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zMl0gLSAzLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzNdIC0gMy0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjM0XSAtIDMtNCBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW240MV0gLSA0LTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuNDJdIC0gNC0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQzXSAtIDQtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW240NF0gLSA0LTQgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMTQsIG4yMSwgbjIyLCBuMjMsIG4yNCwgbjMxLCBuMzIsIG4zMywgbjM0LCBuNDEsIG40MiwgbjQzLCBuNDQgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQl0ZVsgMCBdID0gbjExOyB0ZVsgNCBdID0gbjEyOyB0ZVsgOCBdID0gbjEzOyB0ZVsgMTIgXSA9IG4xNDsKICAgIAkJdGVbIDEgXSA9IG4yMTsgdGVbIDUgXSA9IG4yMjsgdGVbIDkgXSA9IG4yMzsgdGVbIDEzIF0gPSBuMjQ7CiAgICAJCXRlWyAyIF0gPSBuMzE7IHRlWyA2IF0gPSBuMzI7IHRlWyAxMCBdID0gbjMzOyB0ZVsgMTQgXSA9IG4zNDsKICAgIAkJdGVbIDMgXSA9IG40MTsgdGVbIDcgXSA9IG40MjsgdGVbIDExIF0gPSBuNDM7IHRlWyAxNSBdID0gbjQ0OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgNHg0IGlkZW50aXR5IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWlkZW50aXR5KCkgewoKICAgIAkJdGhpcy5zZXQoCgogICAgCQkJMSwgMCwgMCwgMCwKICAgIAkJCTAsIDEsIDAsIDAsCiAgICAJCQkwLCAwLCAxLCAwLAogICAgCQkJMCwgMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBtYXRyaXggd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgTWF0cml4NCgpLmZyb21BcnJheSggdGhpcy5lbGVtZW50cyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRyaXggdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAljb3B5KCBtICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgogICAgCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOyB0ZVsgMyBdID0gbWVbIDMgXTsKICAgIAkJdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOyB0ZVsgNiBdID0gbWVbIDYgXTsgdGVbIDcgXSA9IG1lWyA3IF07CiAgICAJCXRlWyA4IF0gPSBtZVsgOCBdOyB0ZVsgOSBdID0gbWVbIDkgXTsgdGVbIDEwIF0gPSBtZVsgMTAgXTsgdGVbIDExIF0gPSBtZVsgMTEgXTsKICAgIAkJdGVbIDEyIF0gPSBtZVsgMTIgXTsgdGVbIDEzIF0gPSBtZVsgMTMgXTsgdGVbIDE0IF0gPSBtZVsgMTQgXTsgdGVbIDE1IF0gPSBtZVsgMTUgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdHJhbnNsYXRpb24gY29tcG9uZW50IG9mIHRoZSBnaXZlbiBtYXRyaXgKICAgIAkgKiBpbnRvIHRoaXMgbWF0cml4J3MgdHJhbnNsYXRpb24gY29tcG9uZW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBjb3B5IHRoZSB0cmFuc2xhdGlvbiBjb21wb25lbnQuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJY29weVBvc2l0aW9uKCBtICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLCBtZSA9IG0uZWxlbWVudHM7CgogICAgCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOwogICAgCQl0ZVsgMTMgXSA9IG1lWyAxMyBdOwogICAgCQl0ZVsgMTQgXSA9IG1lWyAxNCBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0IHRoZSB1cHBlciAzeDMgZWxlbWVudHMgb2YgdGhpcyBtYXRyaXggdG8gdGhlIHZhbHVlcyBvZiBnaXZlbiAzeDMgbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJc2V0RnJvbU1hdHJpeDMoIG0gKSB7CgogICAgCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQltZVsgMCBdLCBtZVsgMyBdLCBtZVsgNiBdLCAwLAogICAgCQkJbWVbIDEgXSwgbWVbIDQgXSwgbWVbIDcgXSwgMCwKICAgIAkJCW1lWyAyIF0sIG1lWyA1IF0sIG1lWyA4IF0sIDAsCiAgICAJCQkwLCAwLCAwLCAxCgogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXh0cmFjdHMgdGhlIGJhc2lzIG9mIHRoaXMgbWF0cml4IGludG8gdGhlIHRocmVlIGF4aXMgdmVjdG9ycyBwcm92aWRlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30geEF4aXMgLSBUaGUgYmFzaXMncyB4IGF4aXMuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB5QXhpcyAtIFRoZSBiYXNpcydzIHkgYXhpcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHpBeGlzIC0gVGhlIGJhc2lzJ3MgeiBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCiAgICAJCXhBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDAgKTsKICAgIAkJeUF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMSApOwogICAgCQl6QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAyICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiBiYXNpcyB2ZWN0b3JzIHRvIHRoaXMgbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB4QXhpcyAtIFRoZSBiYXNpcydzIHggYXhpcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHlBeGlzIC0gVGhlIGJhc2lzJ3MgeSBheGlzLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gekF4aXMgLSBUaGUgYmFzaXMncyB6IGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZUJhc2lzKCB4QXhpcywgeUF4aXMsIHpBeGlzICkgewoKICAgIAkJdGhpcy5zZXQoCiAgICAJCQl4QXhpcy54LCB5QXhpcy54LCB6QXhpcy54LCAwLAogICAgCQkJeEF4aXMueSwgeUF4aXMueSwgekF4aXMueSwgMCwKICAgIAkJCXhBeGlzLnosIHlBeGlzLnosIHpBeGlzLnosIDAsCiAgICAJCQkwLCAwLCAwLCAxCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHRyYWN0cyB0aGUgcm90YXRpb24gY29tcG9uZW50IG9mIHRoZSBnaXZlbiBtYXRyaXgKICAgIAkgKiBpbnRvIHRoaXMgbWF0cml4J3Mgcm90YXRpb24gY29tcG9uZW50LgogICAgCSAqCiAgICAJICogTm90ZTogVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCByZWZsZWN0aW9uIG1hdHJpY2VzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlleHRyYWN0Um90YXRpb24oIG0gKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCiAgICAJCWNvbnN0IHNjYWxlWCA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CiAgICAJCWNvbnN0IHNjYWxlWSA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAxICkubGVuZ3RoKCk7CiAgICAJCWNvbnN0IHNjYWxlWiA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAyICkubGVuZ3RoKCk7CgogICAgCQl0ZVsgMCBdID0gbWVbIDAgXSAqIHNjYWxlWDsKICAgIAkJdGVbIDEgXSA9IG1lWyAxIF0gKiBzY2FsZVg7CiAgICAJCXRlWyAyIF0gPSBtZVsgMiBdICogc2NhbGVYOwogICAgCQl0ZVsgMyBdID0gMDsKCiAgICAJCXRlWyA0IF0gPSBtZVsgNCBdICogc2NhbGVZOwogICAgCQl0ZVsgNSBdID0gbWVbIDUgXSAqIHNjYWxlWTsKICAgIAkJdGVbIDYgXSA9IG1lWyA2IF0gKiBzY2FsZVk7CiAgICAJCXRlWyA3IF0gPSAwOwoKICAgIAkJdGVbIDggXSA9IG1lWyA4IF0gKiBzY2FsZVo7CiAgICAJCXRlWyA5IF0gPSBtZVsgOSBdICogc2NhbGVaOwogICAgCQl0ZVsgMTAgXSA9IG1lWyAxMCBdICogc2NhbGVaOwogICAgCQl0ZVsgMTEgXSA9IDA7CgogICAgCQl0ZVsgMTIgXSA9IDA7CiAgICAJCXRlWyAxMyBdID0gMDsKICAgIAkJdGVbIDE0IF0gPSAwOwogICAgCQl0ZVsgMTUgXSA9IDE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgKHRoZSB1cHBlciBsZWZ0IDN4MyBtYXRyaXgpIG9mIHRoaXMgbWF0cml4IHRvCiAgICAJICogdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieSB0aGUgZ2l2ZW4gRXVsZXIgYW5nbGVzLiBUaGUgcmVzdCBvZgogICAgCSAqIHRoZSBtYXRyaXggaXMgc2V0IHRvIHRoZSBpZGVudGl0eS4gRGVwZW5kaW5nIG9uIHRoZSB7QGxpbmsgRXVsZXIjb3JkZXJ9LAogICAgCSAqIHRoZXJlIGFyZSBzaXggcG9zc2libGUgb3V0Y29tZXMuIFNlZSBbdGhpcyBwYWdlXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlcl9hbmdsZXMjUm90YXRpb25fbWF0cml4fQogICAgCSAqIGZvciBhIGNvbXBsZXRlIGxpc3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVJvdGF0aW9uRnJvbUV1bGVyKCBldWxlciApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWNvbnN0IHggPSBldWxlci54LCB5ID0gZXVsZXIueSwgeiA9IGV1bGVyLno7CiAgICAJCWNvbnN0IGEgPSBNYXRoLmNvcyggeCApLCBiID0gTWF0aC5zaW4oIHggKTsKICAgIAkJY29uc3QgYyA9IE1hdGguY29zKCB5ICksIGQgPSBNYXRoLnNpbiggeSApOwogICAgCQljb25zdCBlID0gTWF0aC5jb3MoIHogKSwgZiA9IE1hdGguc2luKCB6ICk7CgogICAgCQlpZiAoIGV1bGVyLm9yZGVyID09PSAnWFlaJyApIHsKCiAgICAJCQljb25zdCBhZSA9IGEgKiBlLCBhZiA9IGEgKiBmLCBiZSA9IGIgKiBlLCBiZiA9IGIgKiBmOwoKICAgIAkJCXRlWyAwIF0gPSBjICogZTsKICAgIAkJCXRlWyA0IF0gPSAtIGMgKiBmOwogICAgCQkJdGVbIDggXSA9IGQ7CgogICAgCQkJdGVbIDEgXSA9IGFmICsgYmUgKiBkOwogICAgCQkJdGVbIDUgXSA9IGFlIC0gYmYgKiBkOwogICAgCQkJdGVbIDkgXSA9IC0gYiAqIGM7CgogICAgCQkJdGVbIDIgXSA9IGJmIC0gYWUgKiBkOwogICAgCQkJdGVbIDYgXSA9IGJlICsgYWYgKiBkOwogICAgCQkJdGVbIDEwIF0gPSBhICogYzsKCiAgICAJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWVhaJyApIHsKCiAgICAJCQljb25zdCBjZSA9IGMgKiBlLCBjZiA9IGMgKiBmLCBkZSA9IGQgKiBlLCBkZiA9IGQgKiBmOwoKICAgIAkJCXRlWyAwIF0gPSBjZSArIGRmICogYjsKICAgIAkJCXRlWyA0IF0gPSBkZSAqIGIgLSBjZjsKICAgIAkJCXRlWyA4IF0gPSBhICogZDsKCiAgICAJCQl0ZVsgMSBdID0gYSAqIGY7CiAgICAJCQl0ZVsgNSBdID0gYSAqIGU7CiAgICAJCQl0ZVsgOSBdID0gLSBiOwoKICAgIAkJCXRlWyAyIF0gPSBjZiAqIGIgLSBkZTsKICAgIAkJCXRlWyA2IF0gPSBkZiArIGNlICogYjsKICAgIAkJCXRlWyAxMCBdID0gYSAqIGM7CgogICAgCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1pYWScgKSB7CgogICAgCQkJY29uc3QgY2UgPSBjICogZSwgY2YgPSBjICogZiwgZGUgPSBkICogZSwgZGYgPSBkICogZjsKCiAgICAJCQl0ZVsgMCBdID0gY2UgLSBkZiAqIGI7CiAgICAJCQl0ZVsgNCBdID0gLSBhICogZjsKICAgIAkJCXRlWyA4IF0gPSBkZSArIGNmICogYjsKCiAgICAJCQl0ZVsgMSBdID0gY2YgKyBkZSAqIGI7CiAgICAJCQl0ZVsgNSBdID0gYSAqIGU7CiAgICAJCQl0ZVsgOSBdID0gZGYgLSBjZSAqIGI7CgogICAgCQkJdGVbIDIgXSA9IC0gYSAqIGQ7CiAgICAJCQl0ZVsgNiBdID0gYjsKICAgIAkJCXRlWyAxMCBdID0gYSAqIGM7CgogICAgCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1pZWCcgKSB7CgogICAgCQkJY29uc3QgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKCiAgICAJCQl0ZVsgMCBdID0gYyAqIGU7CiAgICAJCQl0ZVsgNCBdID0gYmUgKiBkIC0gYWY7CiAgICAJCQl0ZVsgOCBdID0gYWUgKiBkICsgYmY7CgogICAgCQkJdGVbIDEgXSA9IGMgKiBmOwogICAgCQkJdGVbIDUgXSA9IGJmICogZCArIGFlOwogICAgCQkJdGVbIDkgXSA9IGFmICogZCAtIGJlOwoKICAgIAkJCXRlWyAyIF0gPSAtIGQ7CiAgICAJCQl0ZVsgNiBdID0gYiAqIGM7CiAgICAJCQl0ZVsgMTAgXSA9IGEgKiBjOwoKICAgIAkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWlgnICkgewoKICAgIAkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgogICAgCQkJdGVbIDAgXSA9IGMgKiBlOwogICAgCQkJdGVbIDQgXSA9IGJkIC0gYWMgKiBmOwogICAgCQkJdGVbIDggXSA9IGJjICogZiArIGFkOwoKICAgIAkJCXRlWyAxIF0gPSBmOwogICAgCQkJdGVbIDUgXSA9IGEgKiBlOwogICAgCQkJdGVbIDkgXSA9IC0gYiAqIGU7CgogICAgCQkJdGVbIDIgXSA9IC0gZCAqIGU7CiAgICAJCQl0ZVsgNiBdID0gYWQgKiBmICsgYmM7CiAgICAJCQl0ZVsgMTAgXSA9IGFjIC0gYmQgKiBmOwoKICAgIAkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdYWlknICkgewoKICAgIAkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgogICAgCQkJdGVbIDAgXSA9IGMgKiBlOwogICAgCQkJdGVbIDQgXSA9IC0gZjsKICAgIAkJCXRlWyA4IF0gPSBkICogZTsKCiAgICAJCQl0ZVsgMSBdID0gYWMgKiBmICsgYmQ7CiAgICAJCQl0ZVsgNSBdID0gYSAqIGU7CiAgICAJCQl0ZVsgOSBdID0gYWQgKiBmIC0gYmM7CgogICAgCQkJdGVbIDIgXSA9IGJjICogZiAtIGFkOwogICAgCQkJdGVbIDYgXSA9IGIgKiBlOwogICAgCQkJdGVbIDEwIF0gPSBiZCAqIGYgKyBhYzsKCiAgICAJCX0KCiAgICAJCS8vIGJvdHRvbSByb3cKICAgIAkJdGVbIDMgXSA9IDA7CiAgICAJCXRlWyA3IF0gPSAwOwogICAgCQl0ZVsgMTEgXSA9IDA7CgogICAgCQkvLyBsYXN0IGNvbHVtbgogICAgCQl0ZVsgMTIgXSA9IDA7CiAgICAJCXRlWyAxMyBdID0gMDsKICAgIAkJdGVbIDE0IF0gPSAwOwogICAgCQl0ZVsgMTUgXSA9IDE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgb2YgdGhpcyBtYXRyaXggdG8gdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieQogICAgCSAqIHRoZSBnaXZlbiBRdWF0ZXJuaW9uIGFzIG91dGxpbmVkIFtoZXJlXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3RhdGlvbl9tYXRyaXgjUXVhdGVybmlvbn0KICAgIAkgKiBUaGUgcmVzdCBvZiB0aGUgbWF0cml4IGlzIHNldCB0byB0aGUgaWRlbnRpdHkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbi4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApIHsKCiAgICAJCXJldHVybiB0aGlzLmNvbXBvc2UoIF96ZXJvLCBxLCBfb25lICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgcm90YXRpb24gY29tcG9uZW50IG9mIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgsIGxvb2tpbmcgZnJvbSBgZXllYCB0b3dhcmRzCiAgICAJICogYHRhcmdldGAsIGFuZCBvcmllbnRlZCBieSB0aGUgdXAtZGlyZWN0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBleWUgLSBUaGUgZXllIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdXAgLSBUaGUgdXAgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWxvb2tBdCggZXllLCB0YXJnZXQsIHVwICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJX3ouc3ViVmVjdG9ycyggZXllLCB0YXJnZXQgKTsKCiAgICAJCWlmICggX3oubGVuZ3RoU3EoKSA9PT0gMCApIHsKCiAgICAJCQkvLyBleWUgYW5kIHRhcmdldCBhcmUgaW4gdGhlIHNhbWUgcG9zaXRpb24KCiAgICAJCQlfei56ID0gMTsKCiAgICAJCX0KCiAgICAJCV96Lm5vcm1hbGl6ZSgpOwogICAgCQlfeC5jcm9zc1ZlY3RvcnMoIHVwLCBfeiApOwoKICAgIAkJaWYgKCBfeC5sZW5ndGhTcSgpID09PSAwICkgewoKICAgIAkJCS8vIHVwIGFuZCB6IGFyZSBwYXJhbGxlbAoKICAgIAkJCWlmICggTWF0aC5hYnMoIHVwLnogKSA9PT0gMSApIHsKCiAgICAJCQkJX3oueCArPSAwLjAwMDE7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJX3oueiArPSAwLjAwMDE7CgogICAgCQkJfQoKICAgIAkJCV96Lm5vcm1hbGl6ZSgpOwogICAgCQkJX3guY3Jvc3NWZWN0b3JzKCB1cCwgX3ogKTsKCiAgICAJCX0KCiAgICAJCV94Lm5vcm1hbGl6ZSgpOwogICAgCQlfeS5jcm9zc1ZlY3RvcnMoIF96LCBfeCApOwoKICAgIAkJdGVbIDAgXSA9IF94Lng7IHRlWyA0IF0gPSBfeS54OyB0ZVsgOCBdID0gX3oueDsKICAgIAkJdGVbIDEgXSA9IF94Lnk7IHRlWyA1IF0gPSBfeS55OyB0ZVsgOSBdID0gX3oueTsKICAgIAkJdGVbIDIgXSA9IF94Lno7IHRlWyA2IF0gPSBfeS56OyB0ZVsgMTAgXSA9IF96Lno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQb3N0LW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDR4NCBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbXVsdGlwbHkoIG0gKSB7CgogICAgCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJlLW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDR4NCBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJcHJlbXVsdGlwbHkoIG0gKSB7CgogICAgCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGVzIHRoZSBnaXZlbiA0eDQgbWF0cmljZXMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CiAgICAJICogaW4gdGhpcyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IGEgLSBUaGUgZmlyc3QgbWF0cml4LgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gYiAtIFRoZSBzZWNvbmQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgogICAgCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CiAgICAJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDQgXSwgYTEzID0gYWVbIDggXSwgYTE0ID0gYWVbIDEyIF07CiAgICAJCWNvbnN0IGEyMSA9IGFlWyAxIF0sIGEyMiA9IGFlWyA1IF0sIGEyMyA9IGFlWyA5IF0sIGEyNCA9IGFlWyAxMyBdOwogICAgCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNiBdLCBhMzMgPSBhZVsgMTAgXSwgYTM0ID0gYWVbIDE0IF07CiAgICAJCWNvbnN0IGE0MSA9IGFlWyAzIF0sIGE0MiA9IGFlWyA3IF0sIGE0MyA9IGFlWyAxMSBdLCBhNDQgPSBhZVsgMTUgXTsKCiAgICAJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyA0IF0sIGIxMyA9IGJlWyA4IF0sIGIxNCA9IGJlWyAxMiBdOwogICAgCQljb25zdCBiMjEgPSBiZVsgMSBdLCBiMjIgPSBiZVsgNSBdLCBiMjMgPSBiZVsgOSBdLCBiMjQgPSBiZVsgMTMgXTsKICAgIAkJY29uc3QgYjMxID0gYmVbIDIgXSwgYjMyID0gYmVbIDYgXSwgYjMzID0gYmVbIDEwIF0sIGIzNCA9IGJlWyAxNCBdOwogICAgCQljb25zdCBiNDEgPSBiZVsgMyBdLCBiNDIgPSBiZVsgNyBdLCBiNDMgPSBiZVsgMTEgXSwgYjQ0ID0gYmVbIDE1IF07CgogICAgCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwogICAgCQl0ZVsgNCBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyICsgYTE0ICogYjQyOwogICAgCQl0ZVsgOCBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzICsgYTE0ICogYjQzOwogICAgCQl0ZVsgMTIgXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKCiAgICAJCXRlWyAxIF0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzEgKyBhMjQgKiBiNDE7CiAgICAJCXRlWyA1IF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzIgKyBhMjQgKiBiNDI7CiAgICAJCXRlWyA5IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzMgKyBhMjQgKiBiNDM7CiAgICAJCXRlWyAxMyBdID0gYTIxICogYjE0ICsgYTIyICogYjI0ICsgYTIzICogYjM0ICsgYTI0ICogYjQ0OwoKICAgIAkJdGVbIDIgXSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMSArIGEzNCAqIGI0MTsKICAgIAkJdGVbIDYgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMiArIGEzNCAqIGI0MjsKICAgIAkJdGVbIDEwIF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzMgKyBhMzQgKiBiNDM7CiAgICAJCXRlWyAxNCBdID0gYTMxICogYjE0ICsgYTMyICogYjI0ICsgYTMzICogYjM0ICsgYTM0ICogYjQ0OwoKICAgIAkJdGVbIDMgXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKICAgIAkJdGVbIDcgXSA9IGE0MSAqIGIxMiArIGE0MiAqIGIyMiArIGE0MyAqIGIzMiArIGE0NCAqIGI0MjsKICAgIAkJdGVbIDExIF0gPSBhNDEgKiBiMTMgKyBhNDIgKiBiMjMgKyBhNDMgKiBiMzMgKyBhNDQgKiBiNDM7CiAgICAJCXRlWyAxNSBdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyBldmVyeSBjb21wb25lbnQgb2YgdGhlIG1hdHJpeCBieSB0aGUgZ2l2ZW4gc2NhbGFyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW11bHRpcGx5U2NhbGFyKCBzICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJdGVbIDAgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA4IF0gKj0gczsgdGVbIDEyIF0gKj0gczsKICAgIAkJdGVbIDEgXSAqPSBzOyB0ZVsgNSBdICo9IHM7IHRlWyA5IF0gKj0gczsgdGVbIDEzIF0gKj0gczsKICAgIAkJdGVbIDIgXSAqPSBzOyB0ZVsgNiBdICo9IHM7IHRlWyAxMCBdICo9IHM7IHRlWyAxNCBdICo9IHM7CiAgICAJCXRlWyAzIF0gKj0gczsgdGVbIDcgXSAqPSBzOyB0ZVsgMTEgXSAqPSBzOyB0ZVsgMTUgXSAqPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgYW5kIHJldHVybnMgdGhlIGRldGVybWluYW50IG9mIHRoaXMgbWF0cml4LgogICAgCSAqCiAgICAJICogQmFzZWQgb24gdGhlIG1ldGhvZCBvdXRsaW5lZCBbaGVyZV17QGxpbmsgaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtbH0uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkZXRlcm1pbmFudC4KICAgIAkgKi8KICAgIAlkZXRlcm1pbmFudCgpIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWNvbnN0IG4xMSA9IHRlWyAwIF0sIG4xMiA9IHRlWyA0IF0sIG4xMyA9IHRlWyA4IF0sIG4xNCA9IHRlWyAxMiBdOwogICAgCQljb25zdCBuMjEgPSB0ZVsgMSBdLCBuMjIgPSB0ZVsgNSBdLCBuMjMgPSB0ZVsgOSBdLCBuMjQgPSB0ZVsgMTMgXTsKICAgIAkJY29uc3QgbjMxID0gdGVbIDIgXSwgbjMyID0gdGVbIDYgXSwgbjMzID0gdGVbIDEwIF0sIG4zNCA9IHRlWyAxNCBdOwogICAgCQljb25zdCBuNDEgPSB0ZVsgMyBdLCBuNDIgPSB0ZVsgNyBdLCBuNDMgPSB0ZVsgMTEgXSwgbjQ0ID0gdGVbIDE1IF07CgogICAgCQkvL1RPRE86IG1ha2UgdGhpcyBtb3JlIGVmZmljaWVudAoKICAgIAkJcmV0dXJuICgKICAgIAkJCW40MSAqICgKICAgIAkJCQkrIG4xNCAqIG4yMyAqIG4zMgogICAgCQkJCSAtIG4xMyAqIG4yNCAqIG4zMgogICAgCQkJCSAtIG4xNCAqIG4yMiAqIG4zMwogICAgCQkJCSArIG4xMiAqIG4yNCAqIG4zMwogICAgCQkJCSArIG4xMyAqIG4yMiAqIG4zNAogICAgCQkJCSAtIG4xMiAqIG4yMyAqIG4zNAogICAgCQkJKSArCiAgICAJCQluNDIgKiAoCiAgICAJCQkJKyBuMTEgKiBuMjMgKiBuMzQKICAgIAkJCQkgLSBuMTEgKiBuMjQgKiBuMzMKICAgIAkJCQkgKyBuMTQgKiBuMjEgKiBuMzMKICAgIAkJCQkgLSBuMTMgKiBuMjEgKiBuMzQKICAgIAkJCQkgKyBuMTMgKiBuMjQgKiBuMzEKICAgIAkJCQkgLSBuMTQgKiBuMjMgKiBuMzEKICAgIAkJCSkgKwogICAgCQkJbjQzICogKAogICAgCQkJCSsgbjExICogbjI0ICogbjMyCiAgICAJCQkJIC0gbjExICogbjIyICogbjM0CiAgICAJCQkJIC0gbjE0ICogbjIxICogbjMyCiAgICAJCQkJICsgbjEyICogbjIxICogbjM0CiAgICAJCQkJICsgbjE0ICogbjIyICogbjMxCiAgICAJCQkJIC0gbjEyICogbjI0ICogbjMxCiAgICAJCQkpICsKICAgIAkJCW40NCAqICgKICAgIAkJCQktIG4xMyAqIG4yMiAqIG4zMQogICAgCQkJCSAtIG4xMSAqIG4yMyAqIG4zMgogICAgCQkJCSArIG4xMSAqIG4yMiAqIG4zMwogICAgCQkJCSArIG4xMyAqIG4yMSAqIG4zMgogICAgCQkJCSAtIG4xMiAqIG4yMSAqIG4zMwogICAgCQkJCSArIG4xMiAqIG4yMyAqIG4zMQogICAgCQkJKQoKICAgIAkJKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc3Bvc2VzIHRoaXMgbWF0cml4IGluIHBsYWNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJdHJhbnNwb3NlKCkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgCQlsZXQgdG1wOwoKICAgIAkJdG1wID0gdGVbIDEgXTsgdGVbIDEgXSA9IHRlWyA0IF07IHRlWyA0IF0gPSB0bXA7CiAgICAJCXRtcCA9IHRlWyAyIF07IHRlWyAyIF0gPSB0ZVsgOCBdOyB0ZVsgOCBdID0gdG1wOwogICAgCQl0bXAgPSB0ZVsgNiBdOyB0ZVsgNiBdID0gdGVbIDkgXTsgdGVbIDkgXSA9IHRtcDsKCiAgICAJCXRtcCA9IHRlWyAzIF07IHRlWyAzIF0gPSB0ZVsgMTIgXTsgdGVbIDEyIF0gPSB0bXA7CiAgICAJCXRtcCA9IHRlWyA3IF07IHRlWyA3IF0gPSB0ZVsgMTMgXTsgdGVbIDEzIF0gPSB0bXA7CiAgICAJCXRtcCA9IHRlWyAxMSBdOyB0ZVsgMTEgXSA9IHRlWyAxNCBdOyB0ZVsgMTQgXSA9IHRtcDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHBvc2l0aW9uIGNvbXBvbmVudCBmb3IgdGhpcyBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLAogICAgCSAqIHdpdGhvdXQgYWZmZWN0aW5nIHRoZSByZXN0IG9mIHRoZSBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IzfSB4IC0gVGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3Igb3IgYWx0ZXJuYXRpdmVseSB0aGUgdmVjdG9yIG9iamVjdC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHogY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJc2V0UG9zaXRpb24oIHgsIHksIHogKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQlpZiAoIHguaXNWZWN0b3IzICkgewoKICAgIAkJCXRlWyAxMiBdID0geC54OwogICAgCQkJdGVbIDEzIF0gPSB4Lnk7CiAgICAJCQl0ZVsgMTQgXSA9IHguejsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGVbIDEyIF0gPSB4OwogICAgCQkJdGVbIDEzIF0gPSB5OwogICAgCQkJdGVbIDE0IF0gPSB6OwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW52ZXJ0cyB0aGlzIG1hdHJpeCwgdXNpbmcgdGhlIFthbmFseXRpYyBtZXRob2Rde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVydGlibGVfbWF0cml4I0FuYWx5dGljX3NvbHV0aW9ufS4KICAgIAkgKiBZb3UgY2FuIG5vdCBpbnZlcnQgd2l0aCBhIGRldGVybWluYW50IG9mIHplcm8uIElmIHlvdSBhdHRlbXB0IHRoaXMsIHRoZSBtZXRob2QgcHJvZHVjZXMKICAgIAkgKiBhIHplcm8gbWF0cml4IGluc3RlYWQuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlpbnZlcnQoKSB7CgogICAgCQkvLyBiYXNlZCBvbiBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL21hdHJpeC9mdW5jdGlvbnMvaW52ZXJzZS9mb3VyRC9pbmRleC5odG0KICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKICAgIAkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sIG40MSA9IHRlWyAzIF0sCiAgICAJCQluMTIgPSB0ZVsgNCBdLCBuMjIgPSB0ZVsgNSBdLCBuMzIgPSB0ZVsgNiBdLCBuNDIgPSB0ZVsgNyBdLAogICAgCQkJbjEzID0gdGVbIDggXSwgbjIzID0gdGVbIDkgXSwgbjMzID0gdGVbIDEwIF0sIG40MyA9IHRlWyAxMSBdLAogICAgCQkJbjE0ID0gdGVbIDEyIF0sIG4yNCA9IHRlWyAxMyBdLCBuMzQgPSB0ZVsgMTQgXSwgbjQ0ID0gdGVbIDE1IF0sCgogICAgCQkJdDExID0gbjIzICogbjM0ICogbjQyIC0gbjI0ICogbjMzICogbjQyICsgbjI0ICogbjMyICogbjQzIC0gbjIyICogbjM0ICogbjQzIC0gbjIzICogbjMyICogbjQ0ICsgbjIyICogbjMzICogbjQ0LAogICAgCQkJdDEyID0gbjE0ICogbjMzICogbjQyIC0gbjEzICogbjM0ICogbjQyIC0gbjE0ICogbjMyICogbjQzICsgbjEyICogbjM0ICogbjQzICsgbjEzICogbjMyICogbjQ0IC0gbjEyICogbjMzICogbjQ0LAogICAgCQkJdDEzID0gbjEzICogbjI0ICogbjQyIC0gbjE0ICogbjIzICogbjQyICsgbjE0ICogbjIyICogbjQzIC0gbjEyICogbjI0ICogbjQzIC0gbjEzICogbjIyICogbjQ0ICsgbjEyICogbjIzICogbjQ0LAogICAgCQkJdDE0ID0gbjE0ICogbjIzICogbjMyIC0gbjEzICogbjI0ICogbjMyIC0gbjE0ICogbjIyICogbjMzICsgbjEyICogbjI0ICogbjMzICsgbjEzICogbjIyICogbjM0IC0gbjEyICogbjIzICogbjM0OwoKICAgIAkJY29uc3QgZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzICsgbjQxICogdDE0OwoKICAgIAkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCiAgICAJCWNvbnN0IGRldEludiA9IDEgLyBkZXQ7CgogICAgCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwogICAgCQl0ZVsgMSBdID0gKCBuMjQgKiBuMzMgKiBuNDEgLSBuMjMgKiBuMzQgKiBuNDEgLSBuMjQgKiBuMzEgKiBuNDMgKyBuMjEgKiBuMzQgKiBuNDMgKyBuMjMgKiBuMzEgKiBuNDQgLSBuMjEgKiBuMzMgKiBuNDQgKSAqIGRldEludjsKICAgIAkJdGVbIDIgXSA9ICggbjIyICogbjM0ICogbjQxIC0gbjI0ICogbjMyICogbjQxICsgbjI0ICogbjMxICogbjQyIC0gbjIxICogbjM0ICogbjQyIC0gbjIyICogbjMxICogbjQ0ICsgbjIxICogbjMyICogbjQ0ICkgKiBkZXRJbnY7CiAgICAJCXRlWyAzIF0gPSAoIG4yMyAqIG4zMiAqIG40MSAtIG4yMiAqIG4zMyAqIG40MSAtIG4yMyAqIG4zMSAqIG40MiArIG4yMSAqIG4zMyAqIG40MiArIG4yMiAqIG4zMSAqIG40MyAtIG4yMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKICAgIAkJdGVbIDQgXSA9IHQxMiAqIGRldEludjsKICAgIAkJdGVbIDUgXSA9ICggbjEzICogbjM0ICogbjQxIC0gbjE0ICogbjMzICogbjQxICsgbjE0ICogbjMxICogbjQzIC0gbjExICogbjM0ICogbjQzIC0gbjEzICogbjMxICogbjQ0ICsgbjExICogbjMzICogbjQ0ICkgKiBkZXRJbnY7CiAgICAJCXRlWyA2IF0gPSAoIG4xNCAqIG4zMiAqIG40MSAtIG4xMiAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMSAqIG40MiArIG4xMSAqIG4zNCAqIG40MiArIG4xMiAqIG4zMSAqIG40NCAtIG4xMSAqIG4zMiAqIG40NCApICogZGV0SW52OwogICAgCQl0ZVsgNyBdID0gKCBuMTIgKiBuMzMgKiBuNDEgLSBuMTMgKiBuMzIgKiBuNDEgKyBuMTMgKiBuMzEgKiBuNDIgLSBuMTEgKiBuMzMgKiBuNDIgLSBuMTIgKiBuMzEgKiBuNDMgKyBuMTEgKiBuMzIgKiBuNDMgKSAqIGRldEludjsKCiAgICAJCXRlWyA4IF0gPSB0MTMgKiBkZXRJbnY7CiAgICAJCXRlWyA5IF0gPSAoIG4xNCAqIG4yMyAqIG40MSAtIG4xMyAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMSAqIG40MyArIG4xMSAqIG4yNCAqIG40MyArIG4xMyAqIG4yMSAqIG40NCAtIG4xMSAqIG4yMyAqIG40NCApICogZGV0SW52OwogICAgCQl0ZVsgMTAgXSA9ICggbjEyICogbjI0ICogbjQxIC0gbjE0ICogbjIyICogbjQxICsgbjE0ICogbjIxICogbjQyIC0gbjExICogbjI0ICogbjQyIC0gbjEyICogbjIxICogbjQ0ICsgbjExICogbjIyICogbjQ0ICkgKiBkZXRJbnY7CiAgICAJCXRlWyAxMSBdID0gKCBuMTMgKiBuMjIgKiBuNDEgLSBuMTIgKiBuMjMgKiBuNDEgLSBuMTMgKiBuMjEgKiBuNDIgKyBuMTEgKiBuMjMgKiBuNDIgKyBuMTIgKiBuMjEgKiBuNDMgLSBuMTEgKiBuMjIgKiBuNDMgKSAqIGRldEludjsKCiAgICAJCXRlWyAxMiBdID0gdDE0ICogZGV0SW52OwogICAgCQl0ZVsgMTMgXSA9ICggbjEzICogbjI0ICogbjMxIC0gbjE0ICogbjIzICogbjMxICsgbjE0ICogbjIxICogbjMzIC0gbjExICogbjI0ICogbjMzIC0gbjEzICogbjIxICogbjM0ICsgbjExICogbjIzICogbjM0ICkgKiBkZXRJbnY7CiAgICAJCXRlWyAxNCBdID0gKCBuMTQgKiBuMjIgKiBuMzEgLSBuMTIgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjEgKiBuMzIgKyBuMTEgKiBuMjQgKiBuMzIgKyBuMTIgKiBuMjEgKiBuMzQgLSBuMTEgKiBuMjIgKiBuMzQgKSAqIGRldEludjsKICAgIAkJdGVbIDE1IF0gPSAoIG4xMiAqIG4yMyAqIG4zMSAtIG4xMyAqIG4yMiAqIG4zMSArIG4xMyAqIG4yMSAqIG4zMiAtIG4xMSAqIG4yMyAqIG4zMiAtIG4xMiAqIG4yMSAqIG4zMyArIG4xMSAqIG4yMiAqIG4zMyApICogZGV0SW52OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgY29sdW1ucyBvZiB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHNjYWxlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzY2FsZSggdiApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgIAkJY29uc3QgeCA9IHYueCwgeSA9IHYueSwgeiA9IHYuejsKCiAgICAJCXRlWyAwIF0gKj0geDsgdGVbIDQgXSAqPSB5OyB0ZVsgOCBdICo9IHo7CiAgICAJCXRlWyAxIF0gKj0geDsgdGVbIDUgXSAqPSB5OyB0ZVsgOSBdICo9IHo7CiAgICAJCXRlWyAyIF0gKj0geDsgdGVbIDYgXSAqPSB5OyB0ZVsgMTAgXSAqPSB6OwogICAgCQl0ZVsgMyBdICo9IHg7IHRlWyA3IF0gKj0geTsgdGVbIDExIF0gKj0gejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEdldHMgdGhlIG1heGltdW0gc2NhbGUgdmFsdWUgb2YgdGhlIHRocmVlIGF4ZXMuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBtYXhpbXVtIHNjYWxlLgogICAgCSAqLwogICAgCWdldE1heFNjYWxlT25BeGlzKCkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJY29uc3Qgc2NhbGVYU3EgPSB0ZVsgMCBdICogdGVbIDAgXSArIHRlWyAxIF0gKiB0ZVsgMSBdICsgdGVbIDIgXSAqIHRlWyAyIF07CiAgICAJCWNvbnN0IHNjYWxlWVNxID0gdGVbIDQgXSAqIHRlWyA0IF0gKyB0ZVsgNSBdICogdGVbIDUgXSArIHRlWyA2IF0gKiB0ZVsgNiBdOwogICAgCQljb25zdCBzY2FsZVpTcSA9IHRlWyA4IF0gKiB0ZVsgOCBdICsgdGVbIDkgXSAqIHRlWyA5IF0gKyB0ZVsgMTAgXSAqIHRlWyAxMCBdOwoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggTWF0aC5tYXgoIHNjYWxlWFNxLCBzY2FsZVlTcSwgc2NhbGVaU3EgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSB0cmFuc2xhdGlvbiB0cmFuc2Zvcm0gZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ8VmVjdG9yM30geCAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBYIGF4aXMgb3IgYWx0ZXJuYXRpdmVseSBhIHRyYW5zbGF0aW9uIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBZIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgeiBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VUcmFuc2xhdGlvbiggeCwgeSwgeiApIHsKCiAgICAJCWlmICggeC5pc1ZlY3RvcjMgKSB7CgogICAgCQkJdGhpcy5zZXQoCgogICAgCQkJCTEsIDAsIDAsIHgueCwKICAgIAkJCQkwLCAxLCAwLCB4LnksCiAgICAJCQkJMCwgMCwgMSwgeC56LAogICAgCQkJCTAsIDAsIDAsIDEKCiAgICAJCQkpOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aGlzLnNldCgKCiAgICAJCQkJMSwgMCwgMCwgeCwKICAgIAkJCQkwLCAxLCAwLCB5LAogICAgCQkJCTAsIDAsIDEsIHosCiAgICAJCQkJMCwgMCwgMCwgMQoKICAgIAkJCSk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFggYXhpcyBieQogICAgCSAqIHRoZSBnaXZlbiBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VSb3RhdGlvblgoIHRoZXRhICkgewoKICAgIAkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQkxLCAwLCAwLCAwLAogICAgCQkJMCwgYywgLSBzLCAwLAogICAgCQkJMCwgcywgYywgMCwKICAgIAkJCTAsIDAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFkgYXhpcyBieQogICAgCSAqIHRoZSBnaXZlbiBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VSb3RhdGlvblkoIHRoZXRhICkgewoKICAgIAkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQkgYywgMCwgcywgMCwKICAgIAkJCSAwLCAxLCAwLCAwLAogICAgCQkJLSBzLCAwLCBjLCAwLAogICAgCQkJIDAsIDAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFogYXhpcyBieQogICAgCSAqIHRoZSBnaXZlbiBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VSb3RhdGlvblooIHRoZXRhICkgewoKICAgIAkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQljLCAtIHMsIDAsIDAsCiAgICAJCQlzLCBjLCAwLCAwLAogICAgCQkJMCwgMCwgMSwgMCwKICAgIAkJCTAsIDAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIGdpdmVuIGF4aXMgYnkKICAgIAkgKiB0aGUgZ2l2ZW4gYW5nbGUuCiAgICAJICoKICAgIAkgKiBUaGlzIGlzIGEgc29tZXdoYXQgY29udHJvdmVyc2lhbCBidXQgbWF0aGVtYXRpY2FsbHkgc291bmQgYWx0ZXJuYXRpdmUgdG8KICAgIAkgKiByb3RhdGluZyB2aWEgUXVhdGVybmlvbnMuIFNlZSB0aGUgZGlzY3Vzc2lvbiBbaGVyZV17QGxpbmsgaHR0cHM6Ly93d3cuZ2FtZWRldi5uZXQvYXJ0aWNsZXMvcHJvZ3JhbW1pbmcvbWF0aC1hbmQtcGh5c2ljcy9kby13ZS1yZWFsbHktbmVlZC1xdWF0ZXJuaW9ucy1yMTE5OX0uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgbm9ybWFsaXplZCByb3RhdGlvbiBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VSb3RhdGlvbkF4aXMoIGF4aXMsIGFuZ2xlICkgewoKICAgIAkJLy8gQmFzZWQgb24gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9yZWZlcmVuY2UvYXJ0aWNsZXMvYXJ0aWNsZTExOTkuYXNwCgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIGFuZ2xlICk7CiAgICAJCWNvbnN0IHMgPSBNYXRoLnNpbiggYW5nbGUgKTsKICAgIAkJY29uc3QgdCA9IDEgLSBjOwogICAgCQljb25zdCB4ID0gYXhpcy54LCB5ID0gYXhpcy55LCB6ID0gYXhpcy56OwogICAgCQljb25zdCB0eCA9IHQgKiB4LCB0eSA9IHQgKiB5OwoKICAgIAkJdGhpcy5zZXQoCgogICAgCQkJdHggKiB4ICsgYywgdHggKiB5IC0gcyAqIHosIHR4ICogeiArIHMgKiB5LCAwLAogICAgCQkJdHggKiB5ICsgcyAqIHosIHR5ICogeSArIGMsIHR5ICogeiAtIHMgKiB4LCAwLAogICAgCQkJdHggKiB6IC0gcyAqIHksIHR5ICogeiArIHMgKiB4LCB0ICogeiAqIHogKyBjLCAwLAogICAgCQkJMCwgMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSBzY2FsZSB0cmFuc2Zvcm1hdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWCBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWiBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VTY2FsZSggeCwgeSwgeiApIHsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCXgsIDAsIDAsIDAsCiAgICAJCQkwLCB5LCAwLCAwLAogICAgCQkJMCwgMCwgeiwgMCwKICAgIAkJCTAsIDAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgc2hlYXIgdHJhbnNmb3JtYXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geHkgLSBUaGUgYW1vdW50IHRvIHNoZWFyIFggYnkgWS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geHogLSBUaGUgYW1vdW50IHRvIHNoZWFyIFggYnkgWi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geXggLSBUaGUgYW1vdW50IHRvIHNoZWFyIFkgYnkgWC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geXogLSBUaGUgYW1vdW50IHRvIHNoZWFyIFkgYnkgWi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0genggLSBUaGUgYW1vdW50IHRvIHNoZWFyIFogYnkgWC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0genkgLSBUaGUgYW1vdW50IHRvIHNoZWFyIFogYnkgWS4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlU2hlYXIoIHh5LCB4eiwgeXgsIHl6LCB6eCwgenkgKSB7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQkxLCB5eCwgengsIDAsCiAgICAJCQl4eSwgMSwgenksIDAsCiAgICAJCQl4eiwgeXosIDEsIDAsCiAgICAJCQkwLCAwLCAwLCAxCgogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgdHJhbnNmb3JtYXRpb24gY29tcG9zZWQgb2YgdGhlIGdpdmVuIHBvc2l0aW9uLAogICAgCSAqIHJvdGF0aW9uIChRdWF0ZXJuaW9uKSBhbmQgc2NhbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvc2l0aW9uIC0gVGhlIHBvc2l0aW9uIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHF1YXRlcm5pb24gLSBUaGUgcm90YXRpb24gYXMgYSBRdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gc2NhbGUgLSBUaGUgc2NhbGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWNvbnN0IHggPSBxdWF0ZXJuaW9uLl94LCB5ID0gcXVhdGVybmlvbi5feSwgeiA9IHF1YXRlcm5pb24uX3osIHcgPSBxdWF0ZXJuaW9uLl93OwogICAgCQljb25zdCB4MiA9IHggKyB4LAl5MiA9IHkgKyB5LCB6MiA9IHogKyB6OwogICAgCQljb25zdCB4eCA9IHggKiB4MiwgeHkgPSB4ICogeTIsIHh6ID0geCAqIHoyOwogICAgCQljb25zdCB5eSA9IHkgKiB5MiwgeXogPSB5ICogejIsIHp6ID0geiAqIHoyOwogICAgCQljb25zdCB3eCA9IHcgKiB4Miwgd3kgPSB3ICogeTIsIHd6ID0gdyAqIHoyOwoKICAgIAkJY29uc3Qgc3ggPSBzY2FsZS54LCBzeSA9IHNjYWxlLnksIHN6ID0gc2NhbGUuejsKCiAgICAJCXRlWyAwIF0gPSAoIDEgLSAoIHl5ICsgenogKSApICogc3g7CiAgICAJCXRlWyAxIF0gPSAoIHh5ICsgd3ogKSAqIHN4OwogICAgCQl0ZVsgMiBdID0gKCB4eiAtIHd5ICkgKiBzeDsKICAgIAkJdGVbIDMgXSA9IDA7CgogICAgCQl0ZVsgNCBdID0gKCB4eSAtIHd6ICkgKiBzeTsKICAgIAkJdGVbIDUgXSA9ICggMSAtICggeHggKyB6eiApICkgKiBzeTsKICAgIAkJdGVbIDYgXSA9ICggeXogKyB3eCApICogc3k7CiAgICAJCXRlWyA3IF0gPSAwOwoKICAgIAkJdGVbIDggXSA9ICggeHogKyB3eSApICogc3o7CiAgICAJCXRlWyA5IF0gPSAoIHl6IC0gd3ggKSAqIHN6OwogICAgCQl0ZVsgMTAgXSA9ICggMSAtICggeHggKyB5eSApICkgKiBzejsKICAgIAkJdGVbIDExIF0gPSAwOwoKICAgIAkJdGVbIDEyIF0gPSBwb3NpdGlvbi54OwogICAgCQl0ZVsgMTMgXSA9IHBvc2l0aW9uLnk7CiAgICAJCXRlWyAxNCBdID0gcG9zaXRpb24uejsKICAgIAkJdGVbIDE1IF0gPSAxOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGVjb21wb3NlcyB0aGlzIG1hdHJpeCBpbnRvIGl0cyBwb3NpdGlvbiwgcm90YXRpb24gYW5kIHNjYWxlIGNvbXBvbmVudHMKICAgIAkgKiBhbmQgcHJvdmlkZXMgdGhlIHJlc3VsdCBpbiB0aGUgZ2l2ZW4gb2JqZWN0cy4KICAgIAkgKgogICAgCSAqIE5vdGU6IE5vdCBhbGwgbWF0cmljZXMgYXJlIGRlY29tcG9zYWJsZSBpbiB0aGlzIHdheS4gRm9yIGV4YW1wbGUsIGlmIGFuCiAgICAJICogb2JqZWN0IGhhcyBhIG5vbi11bmlmb3JtbHkgc2NhbGVkIHBhcmVudCwgdGhlbiB0aGUgb2JqZWN0J3Mgd29ybGQgbWF0cml4CiAgICAJICogbWF5IG5vdCBiZSBkZWNvbXBvc2FibGUsIGFuZCB0aGlzIG1ldGhvZCBtYXkgbm90IGJlIGFwcHJvcHJpYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb3NpdGlvbiAtIFRoZSBwb3NpdGlvbiB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHJvdGF0aW9uIGFzIGEgUXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHNjYWxlIC0gVGhlIHNjYWxlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlkZWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWxldCBzeCA9IF92MSQ1LnNldCggdGVbIDAgXSwgdGVbIDEgXSwgdGVbIDIgXSApLmxlbmd0aCgpOwogICAgCQljb25zdCBzeSA9IF92MSQ1LnNldCggdGVbIDQgXSwgdGVbIDUgXSwgdGVbIDYgXSApLmxlbmd0aCgpOwogICAgCQljb25zdCBzeiA9IF92MSQ1LnNldCggdGVbIDggXSwgdGVbIDkgXSwgdGVbIDEwIF0gKS5sZW5ndGgoKTsKCiAgICAJCS8vIGlmIGRldGVybWluZSBpcyBuZWdhdGl2ZSwgd2UgbmVlZCB0byBpbnZlcnQgb25lIHNjYWxlCiAgICAJCWNvbnN0IGRldCA9IHRoaXMuZGV0ZXJtaW5hbnQoKTsKICAgIAkJaWYgKCBkZXQgPCAwICkgc3ggPSAtIHN4OwoKICAgIAkJcG9zaXRpb24ueCA9IHRlWyAxMiBdOwogICAgCQlwb3NpdGlvbi55ID0gdGVbIDEzIF07CiAgICAJCXBvc2l0aW9uLnogPSB0ZVsgMTQgXTsKCiAgICAJCS8vIHNjYWxlIHRoZSByb3RhdGlvbiBwYXJ0CiAgICAJCV9tMSQyLmNvcHkoIHRoaXMgKTsKCiAgICAJCWNvbnN0IGludlNYID0gMSAvIHN4OwogICAgCQljb25zdCBpbnZTWSA9IDEgLyBzeTsKICAgIAkJY29uc3QgaW52U1ogPSAxIC8gc3o7CgogICAgCQlfbTEkMi5lbGVtZW50c1sgMCBdICo9IGludlNYOwogICAgCQlfbTEkMi5lbGVtZW50c1sgMSBdICo9IGludlNYOwogICAgCQlfbTEkMi5lbGVtZW50c1sgMiBdICo9IGludlNYOwoKICAgIAkJX20xJDIuZWxlbWVudHNbIDQgXSAqPSBpbnZTWTsKICAgIAkJX20xJDIuZWxlbWVudHNbIDUgXSAqPSBpbnZTWTsKICAgIAkJX20xJDIuZWxlbWVudHNbIDYgXSAqPSBpbnZTWTsKCiAgICAJCV9tMSQyLmVsZW1lbnRzWyA4IF0gKj0gaW52U1o7CiAgICAJCV9tMSQyLmVsZW1lbnRzWyA5IF0gKj0gaW52U1o7CiAgICAJCV9tMSQyLmVsZW1lbnRzWyAxMCBdICo9IGludlNaOwoKICAgIAkJcXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQyICk7CgogICAgCQlzY2FsZS54ID0gc3g7CiAgICAJCXNjYWxlLnkgPSBzeTsKICAgIAkJc2NhbGUueiA9IHN6OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ3JlYXRlcyBhIHBlcnNwZWN0aXZlIHByb2plY3Rpb24gbWF0cml4LiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSBieQogICAgCSAqIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSN1cGRhdGVQcm9qZWN0aW9uTWF0cml4fS4KCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgLSBMZWZ0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHJpZ2h0IC0gUmlnaHQgYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdG9wIC0gVG9wIGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbSAtIEJvdHRvbSBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBuZWFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgZmFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0gW2Nvb3JkaW5hdGVTeXN0ZW09V2ViR0xDb29yZGluYXRlU3lzdGVtXSAtIFRoZSBjb29yZGluYXRlIHN5c3RlbS4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlUGVyc3BlY3RpdmUoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgbmVhciwgZmFyLCBjb29yZGluYXRlU3lzdGVtID0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgCQljb25zdCB4ID0gMiAqIG5lYXIgLyAoIHJpZ2h0IC0gbGVmdCApOwogICAgCQljb25zdCB5ID0gMiAqIG5lYXIgLyAoIHRvcCAtIGJvdHRvbSApOwoKICAgIAkJY29uc3QgYSA9ICggcmlnaHQgKyBsZWZ0ICkgLyAoIHJpZ2h0IC0gbGVmdCApOwogICAgCQljb25zdCBiID0gKCB0b3AgKyBib3R0b20gKSAvICggdG9wIC0gYm90dG9tICk7CgogICAgCQlsZXQgYywgZDsKCiAgICAJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCWMgPSAtICggZmFyICsgbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CiAgICAJCQlkID0gKCAtMiAqIGZhciAqIG5lYXIgKSAvICggZmFyIC0gbmVhciApOwoKICAgIAkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCiAgICAJCQljID0gLSBmYXIgLyAoIGZhciAtIG5lYXIgKTsKICAgIAkJCWQgPSAoIC0gZmFyICogbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLk1hdHJpeDQubWFrZVBlcnNwZWN0aXZlKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgogICAgCQl9CgogICAgCQl0ZVsgMCBdID0geDsJdGVbIDQgXSA9IDA7CXRlWyA4IF0gPSBhOyAJdGVbIDEyIF0gPSAwOwogICAgCQl0ZVsgMSBdID0gMDsJdGVbIDUgXSA9IHk7CXRlWyA5IF0gPSBiOyAJdGVbIDEzIF0gPSAwOwogICAgCQl0ZVsgMiBdID0gMDsJdGVbIDYgXSA9IDA7CXRlWyAxMCBdID0gYzsgCXRlWyAxNCBdID0gZDsKICAgIAkJdGVbIDMgXSA9IDA7CXRlWyA3IF0gPSAwOwl0ZVsgMTEgXSA9IC0xOwl0ZVsgMTUgXSA9IDA7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDcmVhdGVzIGEgb3J0aG9ncmFwaGljIHByb2plY3Rpb24gbWF0cml4LiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSBieQogICAgCSAqIHtAbGluayBPcnRob2dyYXBoaWNDYW1lcmEjdXBkYXRlUHJvamVjdGlvbk1hdHJpeH0uCgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0IC0gTGVmdCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSByaWdodCAtIFJpZ2h0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHRvcCAtIFRvcCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBib3R0b20gLSBCb3R0b20gYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbmVhciAtIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGZhciAtIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIGZhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0geyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9IFtjb29yZGluYXRlU3lzdGVtPVdlYkdMQ29vcmRpbmF0ZVN5c3RlbV0gLSBUaGUgY29vcmRpbmF0ZSBzeXN0ZW0uCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZU9ydGhvZ3JhcGhpYyggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIsIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWNvbnN0IHcgPSAxLjAgLyAoIHJpZ2h0IC0gbGVmdCApOwogICAgCQljb25zdCBoID0gMS4wIC8gKCB0b3AgLSBib3R0b20gKTsKICAgIAkJY29uc3QgcCA9IDEuMCAvICggZmFyIC0gbmVhciApOwoKICAgIAkJY29uc3QgeCA9ICggcmlnaHQgKyBsZWZ0ICkgKiB3OwogICAgCQljb25zdCB5ID0gKCB0b3AgKyBib3R0b20gKSAqIGg7CgogICAgCQlsZXQgeiwgekludjsKCiAgICAJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCXogPSAoIGZhciArIG5lYXIgKSAqIHA7CiAgICAJCQl6SW52ID0gLTIgKiBwOwoKICAgIAkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCiAgICAJCQl6ID0gbmVhciAqIHA7CiAgICAJCQl6SW52ID0gLTEgKiBwOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5NYXRyaXg0Lm1ha2VPcnRob2dyYXBoaWMoKTogSW52YWxpZCBjb29yZGluYXRlIHN5c3RlbTogJyArIGNvb3JkaW5hdGVTeXN0ZW0gKTsKCiAgICAJCX0KCiAgICAJCXRlWyAwIF0gPSAyICogdzsJdGVbIDQgXSA9IDA7CQl0ZVsgOCBdID0gMDsgCQl0ZVsgMTIgXSA9IC0geDsKICAgIAkJdGVbIDEgXSA9IDA7IAkJdGVbIDUgXSA9IDIgKiBoOwl0ZVsgOSBdID0gMDsgCQl0ZVsgMTMgXSA9IC0geTsKICAgIAkJdGVbIDIgXSA9IDA7IAkJdGVbIDYgXSA9IDA7CQl0ZVsgMTAgXSA9IHpJbnY7CXRlWyAxNCBdID0gLSB6OwogICAgCQl0ZVsgMyBdID0gMDsgCQl0ZVsgNyBdID0gMDsJCXRlWyAxMSBdID0gMDsJCXRlWyAxNSBdID0gMTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIG1hdHJpeCB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIG1hdHJpeCApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgIAkJY29uc3QgbWUgPSBtYXRyaXguZWxlbWVudHM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCiAgICAJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdHJ1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFycmF5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCiAgICAJCQl0aGlzLmVsZW1lbnRzWyBpIF0gPSBhcnJheVsgaSArIG9mZnNldCBdOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV3JpdGVzIHRoZSBlbGVtZW50cyBvZiB0aGlzIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAogICAgCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgbWF0cml4IGVsZW1lbnRzIGluIGNvbHVtbi1tYWpvciBvcmRlci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgbWF0cml4IGVsZW1lbnRzIGluIGNvbHVtbi1tYWpvciBvcmRlci4KICAgIAkgKi8KICAgIAl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJYXJyYXlbIG9mZnNldCBdID0gdGVbIDAgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRlWyAxIF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCiAgICAJCWFycmF5WyBvZmZzZXQgKyA0IF0gPSB0ZVsgNCBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoKICAgIAkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyA5IF0gPSB0ZVsgOSBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMTAgXSA9IHRlWyAxMCBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMTEgXSA9IHRlWyAxMSBdOwoKICAgIAkJYXJyYXlbIG9mZnNldCArIDEyIF0gPSB0ZVsgMTIgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEzIF0gPSB0ZVsgMTMgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDE0IF0gPSB0ZVsgMTQgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDE1IF0gPSB0ZVsgMTUgXTsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfdjEkNSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9tMSQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwogICAgY29uc3QgX3plcm8gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAwLCAwICk7CiAgICBjb25zdCBfb25lID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwogICAgY29uc3QgX3ggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfeSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF96ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGNvbnN0IF9tYXRyaXgkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKICAgIGNvbnN0IF9xdWF0ZXJuaW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgLyoqCiAgICAgKiBBIGNsYXNzIHJlcHJlc2VudGluZyBFdWxlciBhbmdsZXMuCiAgICAgKgogICAgICogRXVsZXIgYW5nbGVzIGRlc2NyaWJlIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBieSByb3RhdGluZyBhbiBvYmplY3Qgb24KICAgICAqIGl0cyB2YXJpb3VzIGF4ZXMgaW4gc3BlY2lmaWVkIGFtb3VudHMgcGVyIGF4aXMsIGFuZCBhIHNwZWNpZmllZCBheGlzCiAgICAgKiBvcmRlci4KICAgICAqCiAgICAgKiBJdGVyYXRpbmcgdGhyb3VnaCBhbiBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzICh4LCB5LCB6LAogICAgICogb3JkZXIpIGluIHRoZSBjb3JyZXNwb25kaW5nIG9yZGVyLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBhID0gbmV3IFRIUkVFLkV1bGVyKCAwLCAxLCAxLjU3LCAnWFlaJyApOwogICAgICogY29uc3QgYiA9IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAwLCAxICk7CiAgICAgKiBiLmFwcGx5RXVsZXIoYSk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgRXVsZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGV1bGVyIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgYW5nbGUgb2YgdGhlIHkgYXhpcyBpbiByYWRpYW5zLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbej0wXSAtIFRoZSBhbmdsZSBvZiB0aGUgeiBheGlzIGluIHJhZGlhbnMuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcj1FdWxlci5ERUZBVUxUX09SREVSXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAsIHogPSAwLCBvcmRlciA9IEV1bGVyLkRFRkFVTFRfT1JERVIgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0V1bGVyID0gdHJ1ZTsKCiAgICAJCXRoaXMuX3ggPSB4OwogICAgCQl0aGlzLl95ID0geTsKICAgIAkJdGhpcy5feiA9IHo7CiAgICAJCXRoaXMuX29yZGVyID0gb3JkZXI7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgMAogICAgCSAqLwogICAgCWdldCB4KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3g7CgogICAgCX0KCiAgICAJc2V0IHgoIHZhbHVlICkgewoKICAgIAkJdGhpcy5feCA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGFuZ2xlIG9mIHRoZSB5IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgMAogICAgCSAqLwogICAgCWdldCB5KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3k7CgogICAgCX0KCiAgICAJc2V0IHkoIHZhbHVlICkgewoKICAgIAkJdGhpcy5feSA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGFuZ2xlIG9mIHRoZSB6IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgMAogICAgCSAqLwogICAgCWdldCB6KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3o7CgogICAgCX0KCiAgICAJc2V0IHooIHZhbHVlICkgewoKICAgIAkJdGhpcy5feiA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7c3RyaW5nfQogICAgCSAqIEBkZWZhdWx0ICdYWVonCiAgICAJICovCiAgICAJZ2V0IG9yZGVyKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX29yZGVyOwoKICAgIAl9CgogICAgCXNldCBvcmRlciggdmFsdWUgKSB7CgogICAgCQl0aGlzLl9vcmRlciA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgRXVsZXIgY29tcG9uZW50cy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbmdsZSBvZiB0aGUgeSBheGlzIGluIHJhZGlhbnMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW5nbGUgb2YgdGhlIHogYXhpcyBpbiByYWRpYW5zLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0KCB4LCB5LCB6LCBvcmRlciA9IHRoaXMuX29yZGVyICkgewoKICAgIAkJdGhpcy5feCA9IHg7CiAgICAJCXRoaXMuX3kgPSB5OwogICAgCQl0aGlzLl96ID0gejsKICAgIAkJdGhpcy5fb3JkZXIgPSBvcmRlcjsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgRXVsZXIgaW5zdGFuY2Ugd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0V1bGVyfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX29yZGVyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIEV1bGVyIGluc3RhbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBpbnN0YW5jZSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNvcHkoIGV1bGVyICkgewoKICAgIAkJdGhpcy5feCA9IGV1bGVyLl94OwogICAgCQl0aGlzLl95ID0gZXVsZXIuX3k7CiAgICAJCXRoaXMuX3ogPSBldWxlci5fejsKICAgIAkJdGhpcy5fb3JkZXIgPSBldWxlci5fb3JkZXI7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIGEgcHVyZSByb3RhdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBBIDR4NCBtYXRyaXggb2Ygd2hpY2ggdGhlIHVwcGVyIDN4MyBvZiBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLiB1bnNjYWxlZCkuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGU9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBpbnRlcm5hbCBgb25DaGFuZ2VgIGNhbGxiYWNrIHNob3VsZCBiZSBleGVjdXRlZCBvciBub3QuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtLCBvcmRlciA9IHRoaXMuX29yZGVyLCB1cGRhdGUgPSB0cnVlICkgewoKICAgIAkJY29uc3QgdGUgPSBtLmVsZW1lbnRzOwogICAgCQljb25zdCBtMTEgPSB0ZVsgMCBdLCBtMTIgPSB0ZVsgNCBdLCBtMTMgPSB0ZVsgOCBdOwogICAgCQljb25zdCBtMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdOwogICAgCQljb25zdCBtMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXTsKCiAgICAJCXN3aXRjaCAoIG9yZGVyICkgewoKICAgIAkJCWNhc2UgJ1hZWic6CgogICAgCQkJCXRoaXMuX3kgPSBNYXRoLmFzaW4oIGNsYW1wKCBtMTMsIC0xLCAxICkgKTsKCiAgICAJCQkJaWYgKCBNYXRoLmFicyggbTEzICkgPCAwLjk5OTk5OTkgKSB7CgogICAgCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0zMyApOwogICAgCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0xMSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIG0zMiwgbTIyICk7CiAgICAJCQkJCXRoaXMuX3ogPSAwOwoKICAgIAkJCQl9CgogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1lYWic6CgogICAgCQkJCXRoaXMuX3ggPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0yMywgLTEsIDEgKSApOwoKICAgIAkJCQlpZiAoIE1hdGguYWJzKCBtMjMgKSA8IDAuOTk5OTk5OSApIHsKCiAgICAJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwogICAgCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMjIgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTExICk7CiAgICAJCQkJCXRoaXMuX3ogPSAwOwoKICAgIAkJCQl9CgogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1pYWSc6CgogICAgCQkJCXRoaXMuX3ggPSBNYXRoLmFzaW4oIGNsYW1wKCBtMzIsIC0xLCAxICkgKTsKCiAgICAJCQkJaWYgKCBNYXRoLmFicyggbTMyICkgPCAwLjk5OTk5OTkgKSB7CgogICAgCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0zMyApOwogICAgCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5feSA9IDA7CiAgICAJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKICAgIAkJCQl9CgogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1pZWCc6CgogICAgCQkJCXRoaXMuX3kgPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0zMSwgLTEsIDEgKSApOwoKICAgIAkJCQlpZiAoIE1hdGguYWJzKCBtMzEgKSA8IDAuOTk5OTk5OSApIHsKCiAgICAJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0zMyApOwogICAgCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMTEgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXRoaXMuX3ggPSAwOwogICAgCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKICAgIAkJCQl9CgogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1laWCc6CgogICAgCQkJCXRoaXMuX3ogPSBNYXRoLmFzaW4oIGNsYW1wKCBtMjEsIC0xLCAxICkgKTsKCiAgICAJCQkJaWYgKCBNYXRoLmFicyggbTIxICkgPCAwLjk5OTk5OTkgKSB7CgogICAgCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0yMiApOwogICAgCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5feCA9IDA7CiAgICAJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoKICAgIAkJCQl9CgogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1haWSc6CgogICAgCQkJCXRoaXMuX3ogPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0xMiwgLTEsIDEgKSApOwoKICAgIAkJCQlpZiAoIE1hdGguYWJzKCBtMTIgKSA8IDAuOTk5OTk5OSApIHsKCiAgICAJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0yMiApOwogICAgCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMTEgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCAtIG0yMywgbTMzICk7CiAgICAJCQkJCXRoaXMuX3kgPSAwOwoKICAgIAkJCQl9CgogICAgCQkJCWJyZWFrOwoKICAgIAkJCWRlZmF1bHQ6CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkV1bGVyOiAuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCkgZW5jb3VudGVyZWQgYW4gdW5rbm93biBvcmRlcjogJyArIG9yZGVyICk7CgogICAgCQl9CgogICAgCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKICAgIAkJaWYgKCB1cGRhdGUgPT09IHRydWUgKSB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIGEgbm9ybWFsaXplZCBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gQSBub3JtYWxpemVkIFF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGU9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBpbnRlcm5hbCBgb25DaGFuZ2VgIGNhbGxiYWNrIHNob3VsZCBiZSBleGVjdXRlZCBvciBub3QuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0RnJvbVF1YXRlcm5pb24oIHEsIG9yZGVyLCB1cGRhdGUgKSB7CgogICAgCQlfbWF0cml4JDIubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKTsKCiAgICAJCXJldHVybiB0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX21hdHJpeCQyLCBvcmRlciwgdXBkYXRlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgYW5nbGVzIG9mIHRoaXMgRXVsZXIgaW5zdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW29yZGVyXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgogICAgCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldEZyb21WZWN0b3IzKCB2LCBvcmRlciA9IHRoaXMuX29yZGVyICkgewoKICAgIAkJcmV0dXJuIHRoaXMuc2V0KCB2LngsIHYueSwgdi56LCBvcmRlciApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlc2V0cyB0aGUgZXVsZXIgYW5nbGUgd2l0aCBhIG5ldyBvcmRlciBieSBjcmVhdGluZyBhIHF1YXRlcm5pb24gZnJvbSB0aGlzCiAgICAJICogZXVsZXIgYW5nbGUgYW5kIHRoZW4gc2V0dGluZyB0aGlzIGV1bGVyIGFuZ2xlIHdpdGggdGhlIHF1YXRlcm5pb24gYW5kIHRoZQogICAgCSAqIG5ldyBvcmRlci4KICAgIAkgKgogICAgCSAqIFdhcm5pbmc6IFRoaXMgZGlzY2FyZHMgcmV2b2x1dGlvbiBpbmZvcm1hdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbbmV3T3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBuZXcgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgogICAgCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJlb3JkZXIoIG5ld09yZGVyICkgewoKICAgIAkJX3F1YXRlcm5pb24kMy5zZXRGcm9tRXVsZXIoIHRoaXMgKTsKCiAgICAJCXJldHVybiB0aGlzLnNldEZyb21RdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQzLCBuZXdPcmRlciApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgRXVsZXIgaW5zdGFuY2UgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgaW5zdGFuY2UgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIEV1bGVyIGluc3RhbmNlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIGV1bGVyICkgewoKICAgIAkJcmV0dXJuICggZXVsZXIuX3ggPT09IHRoaXMuX3ggKSAmJiAoIGV1bGVyLl95ID09PSB0aGlzLl95ICkgJiYgKCBldWxlci5feiA9PT0gdGhpcy5feiApICYmICggZXVsZXIuX29yZGVyID09PSB0aGlzLl9vcmRlciApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBFdWxlciBpbnN0YW5jZSdzIGNvbXBvbmVudHMgdG8gdmFsdWVzIGZyb20gdGhlIGdpdmVuIGFycmF5LiBUaGUgZmlyc3QgdGhyZWUKICAgIAkgKiBlbnRyaWVzIG9mIHRoZSBhcnJheSBhcmUgYXNzaWduIHRvIHRoZSB4LHkgYW5kIHogY29tcG9uZW50cy4gQW4gb3B0aW9uYWwgZm91cnRoIGVudHJ5CiAgICAJICogZGVmaW5lcyB0aGUgRXVsZXIgb3JkZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcixudW1iZXIsbnVtYmVyLD9zdHJpbmc+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIEV1bGVyIGNvbXBvbmVudCB2YWx1ZXMuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSApIHsKCiAgICAJCXRoaXMuX3ggPSBhcnJheVsgMCBdOwogICAgCQl0aGlzLl95ID0gYXJyYXlbIDEgXTsKICAgIAkJdGhpcy5feiA9IGFycmF5WyAyIF07CiAgICAJCWlmICggYXJyYXlbIDMgXSAhPT0gdW5kZWZpbmVkICkgdGhpcy5fb3JkZXIgPSBhcnJheVsgMyBdOwoKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV3JpdGVzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgRXVsZXIgaW5zdGFuY2UgdG8gdGhlIGdpdmVuIGFycmF5LiBJZiBubyBhcnJheSBpcyBwcm92aWRlZCwKICAgIAkgKiB0aGUgbWV0aG9kIHJldHVybnMgYSBuZXcgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcixudW1iZXIsbnVtYmVyLHN0cmluZz59IFthcnJheT1bXV0gLSBUaGUgdGFyZ2V0IGFycmF5IGhvbGRpbmcgdGhlIEV1bGVyIGNvbXBvbmVudHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyLG51bWJlcixudW1iZXIsc3RyaW5nPn0gVGhlIEV1bGVyIGNvbXBvbmVudHMuCiAgICAJICovCiAgICAJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMuX3g7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLl95OwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy5fejsKICAgIAkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRoaXMuX29yZGVyOwoKICAgIAkJcmV0dXJuIGFycmF5OwoKICAgIAl9CgogICAgCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAlfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgogICAgCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKICAgIAkJeWllbGQgdGhpcy5feDsKICAgIAkJeWllbGQgdGhpcy5feTsKICAgIAkJeWllbGQgdGhpcy5fejsKICAgIAkJeWllbGQgdGhpcy5fb3JkZXI7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBFdWxlciBhbmdsZSBvcmRlci4KICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAdHlwZSB7c3RyaW5nfQogICAgICogQGRlZmF1bHQgJ1hZWicKICAgICAqLwogICAgRXVsZXIuREVGQVVMVF9PUkRFUiA9ICdYWVonOwoKICAgIC8qKgogICAgICogQSBsYXllcnMgb2JqZWN0IGFzc2lnbnMgYW4gM0Qgb2JqZWN0IHRvIDEgb3IgbW9yZSBvZiAzMgogICAgICogbGF5ZXJzIG51bWJlcmVkIGAwYCB0byBgMzFgIC0gaW50ZXJuYWxseSB0aGUgbGF5ZXJzIGFyZSBzdG9yZWQgYXMgYQogICAgICogYml0IG1hc2tdLCBhbmQgYnkgZGVmYXVsdCBhbGwgM0Qgb2JqZWN0cyBhcmUgYSBtZW1iZXIgb2YgbGF5ZXIgYDBgLgogICAgICoKICAgICAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gY29udHJvbCB2aXNpYmlsaXR5IC0gYW4gb2JqZWN0IG11c3Qgc2hhcmUgYSBsYXllciB3aXRoCiAgICAgKiBhIGNhbWVyYSB0byBiZSB2aXNpYmxlIHdoZW4gdGhhdCBjYW1lcmEncyB2aWV3IGlzCiAgICAgKiByZW5kZXJlZC4KICAgICAqCiAgICAgKiBBbGwgY2xhc3NlcyB0aGF0IGluaGVyaXQgZnJvbSB7QGxpbmsgT2JqZWN0M0R9IGhhdmUgYW4gYGxheWVyc2AgcHJvcGVydHkgd2hpY2gKICAgICAqIGlzIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuCiAgICAgKi8KICAgIGNsYXNzIExheWVycyB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgbGF5ZXJzIGluc3RhbmNlLCB3aXRoIG1lbWJlcnNoaXAKICAgIAkgKiBpbml0aWFsbHkgc2V0IHRvIGxheWVyIGAwYC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvcigpIHsKCiAgICAJCS8qKgogICAgCQkgKiBBIGJpdCBtYXNrIHN0b3Jpbmcgd2hpY2ggb2YgdGhlIDMyIGxheWVycyB0aGlzIGxheWVycyBvYmplY3QgaXMgY3VycmVudGx5CiAgICAJCSAqIGEgbWVtYmVyIG9mLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy5tYXNrID0gMSB8IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyBtZW1iZXJzaGlwIHRvIHRoZSBnaXZlbiBsYXllciwgYW5kIHJlbW92ZSBtZW1iZXJzaGlwIGFsbCBvdGhlciBsYXllcnMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbGF5ZXIgLSBUaGUgbGF5ZXIgdG8gc2V0LgogICAgCSAqLwogICAgCXNldCggbGF5ZXIgKSB7CgogICAgCQl0aGlzLm1hc2sgPSAoIDEgPDwgbGF5ZXIgfCAwICkgPj4+IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyBtZW1iZXJzaGlwIG9mIHRoZSBnaXZlbiBsYXllci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byBlbmFibGUuCiAgICAJICovCiAgICAJZW5hYmxlKCBsYXllciApIHsKCiAgICAJCXRoaXMubWFzayB8PSAxIDw8IGxheWVyIHwgMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIG1lbWJlcnNoaXAgdG8gYWxsIGxheWVycy4KICAgIAkgKi8KICAgIAllbmFibGVBbGwoKSB7CgogICAgCQl0aGlzLm1hc2sgPSAweGZmZmZmZmZmIHwgMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUb2dnbGVzIHRoZSBtZW1iZXJzaGlwIG9mIHRoZSBnaXZlbiBsYXllci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byB0b2dnbGUuCiAgICAJICovCiAgICAJdG9nZ2xlKCBsYXllciApIHsKCiAgICAJCXRoaXMubWFzayBePSAxIDw8IGxheWVyIHwgMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIG1lbWJlcnNoaXAgb2YgdGhlIGdpdmVuIGxheWVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIGVuYWJsZS4KICAgIAkgKi8KICAgIAlkaXNhYmxlKCBsYXllciApIHsKCiAgICAJCXRoaXMubWFzayAmPSB+ICggMSA8PCBsYXllciB8IDAgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIHRoZSBtZW1iZXJzaGlwIGZyb20gYWxsIGxheWVycy4KICAgIAkgKi8KICAgIAlkaXNhYmxlQWxsKCkgewoKICAgIAkJdGhpcy5tYXNrID0gMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGFuZCB0aGUgZ2l2ZW4gbGF5ZXJzIG9iamVjdCBoYXZlIGF0IGxlYXN0IG9uZQogICAgCSAqIGxheWVyIGluIGNvbW1vbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TGF5ZXJzfSBsYXllcnMgLSBUaGUgbGF5ZXJzIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbiB9IFdoZXRoZXIgdGhpcyBhbmQgdGhlIGdpdmVuIGxheWVycyBvYmplY3QgaGF2ZSBhdCBsZWFzdCBvbmUgbGF5ZXIgaW4gY29tbW9uIG9yIG5vdC4KICAgIAkgKi8KICAgIAl0ZXN0KCBsYXllcnMgKSB7CgogICAgCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiBsYXllcnMubWFzayApICE9PSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBsYXllciBpcyBlbmFibGVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbiB9IFdoZXRoZXIgdGhlIGdpdmVuIGxheWVyIGlzIGVuYWJsZWQgb3Igbm90LgogICAgCSAqLwogICAgCWlzRW5hYmxlZCggbGF5ZXIgKSB7CgogICAgCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiAoIDEgPDwgbGF5ZXIgfCAwICkgKSAhPT0gMDsKCiAgICAJfQoKICAgIH0KCiAgICBsZXQgX29iamVjdDNESWQgPSAwOwoKICAgIGNvbnN0IF92MSQ0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ExID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwogICAgY29uc3QgX20xJDEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKICAgIGNvbnN0IF90YXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX3Bvc2l0aW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfc2NhbGUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9xdWF0ZXJuaW9uJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgY29uc3QgX3hBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMCwgMCApOwogICAgY29uc3QgX3lBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwogICAgY29uc3QgX3pBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMCwgMSApOwoKICAgIC8qKgogICAgICogRmlyZXMgd2hlbiB0aGUgb2JqZWN0IGhhcyBiZWVuIGFkZGVkIHRvIGl0cyBwYXJlbnQgb2JqZWN0LgogICAgICoKICAgICAqIEBldmVudCBPYmplY3QzRCNhZGRlZAogICAgICogQHR5cGUge09iamVjdH0KICAgICAqLwogICAgY29uc3QgX2FkZGVkRXZlbnQgPSB7IHR5cGU6ICdhZGRlZCcgfTsKCiAgICAvKioKICAgICAqIEZpcmVzIHdoZW4gdGhlIG9iamVjdCBoYXMgYmVlbiByZW1vdmVkIGZyb20gaXRzIHBhcmVudCBvYmplY3QuCiAgICAgKgogICAgICogQGV2ZW50IE9iamVjdDNEI3JlbW92ZWQKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKi8KICAgIGNvbnN0IF9yZW1vdmVkRXZlbnQgPSB7IHR5cGU6ICdyZW1vdmVkJyB9OwoKICAgIC8qKgogICAgICogRmlyZXMgd2hlbiBhIG5ldyBjaGlsZCBvYmplY3QgaGFzIGJlZW4gYWRkZWQuCiAgICAgKgogICAgICogQGV2ZW50IE9iamVjdDNEI2NoaWxkYWRkZWQKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKi8KICAgIGNvbnN0IF9jaGlsZGFkZGVkRXZlbnQgPSB7IHR5cGU6ICdjaGlsZGFkZGVkJywgY2hpbGQ6IG51bGwgfTsKCiAgICAvKioKICAgICAqIEZpcmVzIHdoZW4gYSBjaGlsZCBvYmplY3QgaGFzIGJlZW4gcmVtb3ZlZC4KICAgICAqCiAgICAgKiBAZXZlbnQgT2JqZWN0M0QjY2hpbGRyZW1vdmVkCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICovCiAgICBjb25zdCBfY2hpbGRyZW1vdmVkRXZlbnQgPSB7IHR5cGU6ICdjaGlsZHJlbW92ZWQnLCBjaGlsZDogbnVsbCB9OwoKICAgIC8qKgogICAgICogVGhpcyBpcyB0aGUgYmFzZSBjbGFzcyBmb3IgbW9zdCBvYmplY3RzIGluIHRocmVlLmpzIGFuZCBwcm92aWRlcyBhIHNldCBvZgogICAgICogcHJvcGVydGllcyBhbmQgbWV0aG9kcyBmb3IgbWFuaXB1bGF0aW5nIG9iamVjdHMgaW4gM0Qgc3BhY2UuCiAgICAgKgogICAgICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgogICAgICovCiAgICBjbGFzcyBPYmplY3QzRCBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgM0Qgb2JqZWN0LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzT2JqZWN0M0QgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBJRCBvZiB0aGUgM0Qgb2JqZWN0LgogICAgCQkgKgogICAgCQkgKiBAbmFtZSBPYmplY3QzRCNpZAogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX29iamVjdDNESWQgKysgfSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBVVUlEIG9mIHRoZSAzRCBvYmplY3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKi8KICAgIAkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgogICAgCQkvKioKICAgIAkJICogVGhlIG5hbWUgb2YgdGhlIDNEIG9iamVjdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMubmFtZSA9ICcnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB0eXBlIHByb3BlcnR5IGlzIHVzZWQgZm9yIGRldGVjdGluZyB0aGUgb2JqZWN0IHR5cGUKICAgIAkJICogaW4gY29udGV4dCBvZiBzZXJpYWxpemF0aW9uL2Rlc2VyaWFsaXphdGlvbi4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQl0aGlzLnR5cGUgPSAnT2JqZWN0M0QnOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgb2JqZWN0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P09iamVjdDNEfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLnBhcmVudCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogQW4gYXJyYXkgaG9sZGluZyB0aGUgY2hpbGQgM0Qgb2JqZWN0cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0M0Q+fQogICAgCQkgKi8KICAgIAkJdGhpcy5jaGlsZHJlbiA9IFtdOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgdGhlIGB1cGAgZGlyZWN0aW9uIG9mIHRoZSAzRCBvYmplY3Qgd2hpY2ggaW5mbHVlbmNlcwogICAgCQkgKiB0aGUgb3JpZW50YXRpb24gdmlhIG1ldGhvZHMgbGlrZSB7QGxpbmsgT2JqZWN0M0QjbG9va0F0fS4KICAgIAkJICoKICAgIAkJICogVGhlIGRlZmF1bHQgdmFsdWVzIGZvciBhbGwgM0Qgb2JqZWN0cyBpcyBkZWZpbmVkIGJ5IGBPYmplY3QzRC5ERUZBVUxUX1VQYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLnVwID0gT2JqZWN0M0QuREVGQVVMVF9VUC5jbG9uZSgpOwoKICAgIAkJY29uc3QgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwogICAgCQljb25zdCByb3RhdGlvbiA9IG5ldyBFdWxlcigpOwogICAgCQljb25zdCBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgIAkJY29uc3Qgc2NhbGUgPSBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwoKICAgIAkJZnVuY3Rpb24gb25Sb3RhdGlvbkNoYW5nZSgpIHsKCiAgICAJCQlxdWF0ZXJuaW9uLnNldEZyb21FdWxlciggcm90YXRpb24sIGZhbHNlICk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBvblF1YXRlcm5pb25DaGFuZ2UoKSB7CgogICAgCQkJcm90YXRpb24uc2V0RnJvbVF1YXRlcm5pb24oIHF1YXRlcm5pb24sIHVuZGVmaW5lZCwgZmFsc2UgKTsKCiAgICAJCX0KCiAgICAJCXJvdGF0aW9uLl9vbkNoYW5nZSggb25Sb3RhdGlvbkNoYW5nZSApOwogICAgCQlxdWF0ZXJuaW9uLl9vbkNoYW5nZSggb25RdWF0ZXJuaW9uQ2hhbmdlICk7CgogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydGllcyggdGhpcywgewogICAgCQkJLyoqCiAgICAJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBsb2NhbCBwb3NpdGlvbi4KICAgIAkJCSAqCiAgICAJCQkgKiBAbmFtZSBPYmplY3QzRCNwb3NpdGlvbgogICAgCQkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCQkgKiBAZGVmYXVsdCAoMCwwLDApCiAgICAJCQkgKi8KICAgIAkJCXBvc2l0aW9uOiB7CiAgICAJCQkJY29uZmlndXJhYmxlOiB0cnVlLAogICAgCQkJCWVudW1lcmFibGU6IHRydWUsCiAgICAJCQkJdmFsdWU6IHBvc2l0aW9uCiAgICAJCQl9LAogICAgCQkJLyoqCiAgICAJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBsb2NhbCByb3RhdGlvbiBhcyBFdWxlciBhbmdsZXMsIGluIHJhZGlhbnMuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgT2JqZWN0M0Qjcm90YXRpb24KICAgIAkJCSAqIEB0eXBlIHtFdWxlcn0KICAgIAkJCSAqIEBkZWZhdWx0ICgwLDAsMCkKICAgIAkJCSAqLwogICAgCQkJcm90YXRpb246IHsKICAgIAkJCQljb25maWd1cmFibGU6IHRydWUsCiAgICAJCQkJZW51bWVyYWJsZTogdHJ1ZSwKICAgIAkJCQl2YWx1ZTogcm90YXRpb24KICAgIAkJCX0sCiAgICAJCQkvKioKICAgIAkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHJvdGF0aW9uIGFzIFF1YXRlcm5pb25zLgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIE9iamVjdDNEI3F1YXRlcm5pb24KICAgIAkJCSAqIEB0eXBlIHtRdWF0ZXJuaW9ufQogICAgCQkJICovCiAgICAJCQlxdWF0ZXJuaW9uOiB7CiAgICAJCQkJY29uZmlndXJhYmxlOiB0cnVlLAogICAgCQkJCWVudW1lcmFibGU6IHRydWUsCiAgICAJCQkJdmFsdWU6IHF1YXRlcm5pb24KICAgIAkJCX0sCiAgICAJCQkvKioKICAgIAkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHNjYWxlLgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIE9iamVjdDNEI3NjYWxlCiAgICAJCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJCSAqIEBkZWZhdWx0ICgxLDEsMSkKICAgIAkJCSAqLwogICAgCQkJc2NhbGU6IHsKICAgIAkJCQljb25maWd1cmFibGU6IHRydWUsCiAgICAJCQkJZW51bWVyYWJsZTogdHJ1ZSwKICAgIAkJCQl2YWx1ZTogc2NhbGUKICAgIAkJCX0sCiAgICAJCQkvKioKICAgIAkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIG1vZGVsLXZpZXcgbWF0cml4LgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIE9iamVjdDNEI21vZGVsVmlld01hdHJpeAogICAgCQkJICogQHR5cGUge01hdHJpeDR9CiAgICAJCQkgKi8KICAgIAkJCW1vZGVsVmlld01hdHJpeDogewogICAgCQkJCXZhbHVlOiBuZXcgTWF0cml4NCgpCiAgICAJCQl9LAogICAgCQkJLyoqCiAgICAJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBub3JtYWwgbWF0cml4LgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIE9iamVjdDNEI25vcm1hbE1hdHJpeAogICAgCQkJICogQHR5cGUge01hdHJpeDN9CiAgICAJCQkgKi8KICAgIAkJCW5vcm1hbE1hdHJpeDogewogICAgCQkJCXZhbHVlOiBuZXcgTWF0cml4MygpCiAgICAJCQl9CiAgICAJCX0gKTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gbG9jYWwgc3BhY2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtNYXRyaXg0fQogICAgCQkgKi8KICAgIAkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBpbiB3b3JsZCBzcGFjZS4KICAgIAkJICogSWYgdGhlIDNEIG9iamVjdCBoYXMgbm8gcGFyZW50LCB0aGVuIGl0J3MgaWRlbnRpY2FsIHRvIHRoZSBsb2NhbCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKICAgIAkJICoKICAgIAkJICogQHR5cGUge01hdHJpeDR9CiAgICAJCSAqLwogICAgCQl0aGlzLm1hdHJpeFdvcmxkID0gbmV3IE1hdHJpeDQoKTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgbG9jYWwgbWF0cml4IGZyb20gcG9zaXRpb24sCiAgICAJCSAqIHJvdGF0aW9uIGFuZCBzY2FsZSBldmVyeSBmcmFtZS4KICAgIAkJICoKICAgIAkJICogVGhlIGRlZmF1bHQgdmFsdWVzIGZvciBhbGwgM0Qgb2JqZWN0cyBpcyBkZWZpbmVkIGJ5IGBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgd29ybGQgbWF0cml4IGZyb20gdGhlIGN1cnJlbnQgbG9jYWwKICAgIAkJICogbWF0cml4IGFuZCB0aGUgb2JqZWN0J3MgdHJhbnNmb3JtYXRpb24gaGllcmFyY2h5LgogICAgCQkgKgogICAgCQkgKiBUaGUgZGVmYXVsdCB2YWx1ZXMgZm9yIGFsbCAzRCBvYmplY3RzIGlzIGRlZmluZWQgYnkgYE9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID0gT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfV09STERfQVVUT19VUERBVEU7IC8vIGNoZWNrZWQgYnkgdGhlIHJlbmRlcmVyCgogICAgCQkvKioKICAgIAkJICogV2hlbiBzZXQgdG8gYHRydWVgLCBpdCBjYWxjdWxhdGVzIHRoZSB3b3JsZCBtYXRyaXggaW4gdGhhdCBmcmFtZSBhbmQgcmVzZXRzIHRoaXMgcHJvcGVydHkKICAgIAkJICogdG8gYGZhbHNlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbGF5ZXIgbWVtYmVyc2hpcCBvZiB0aGUgM0Qgb2JqZWN0LiBUaGUgM0Qgb2JqZWN0IGlzIG9ubHkgdmlzaWJsZSBpZiBpdCBoYXMKICAgIAkJICogYXQgbGVhc3Qgb25lIGxheWVyIGluIGNvbW1vbiB3aXRoIHRoZSBjYW1lcmEgaW4gdXNlLiBUaGlzIHByb3BlcnR5IGNhbiBhbHNvIGJlCiAgICAJCSAqIHVzZWQgdG8gZmlsdGVyIG91dCB1bndhbnRlZCBvYmplY3RzIGluIHJheS1pbnRlcnNlY3Rpb24gdGVzdHMgd2hlbiB1c2luZyB7QGxpbmsgUmF5Y2FzdGVyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0xheWVyc30KICAgIAkJICovCiAgICAJCXRoaXMubGF5ZXJzID0gbmV3IExheWVycygpOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBnZXRzIHJlbmRlcmVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy52aXNpYmxlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSAzRCBvYmplY3QgZ2V0cyByZW5kZXJlZCBpbnRvIHNoYWRvdyBtYXBzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuY2FzdFNoYWRvdyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBpcyBhZmZlY3RlZCBieSBzaGFkb3dzIGluIHRoZSBzY2VuZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSAzRCBvYmplY3QgaXMgaG9ub3JlZCBieSB2aWV3IGZydXN0dW0gY3VsbGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhpcyB2YWx1ZSBhbGxvd3MgdGhlIGRlZmF1bHQgcmVuZGVyaW5nIG9yZGVyIG9mIHNjZW5lIGdyYXBoIG9iamVjdHMgdG8gYmUKICAgIAkJICogb3ZlcnJpZGRlbiBhbHRob3VnaCBvcGFxdWUgYW5kIHRyYW5zcGFyZW50IG9iamVjdHMgcmVtYWluIHNvcnRlZCBpbmRlcGVuZGVudGx5LgogICAgCQkgKiBXaGVuIHRoaXMgcHJvcGVydHkgaXMgc2V0IGZvciBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgR3JvdXB9LGFsbCBkZXNjZW5kYW50cwogICAgCQkgKiBvYmplY3RzIHdpbGwgYmUgc29ydGVkIGFuZCByZW5kZXJlZCB0b2dldGhlci4gU29ydGluZyBpcyBmcm9tIGxvd2VzdCB0byBoaWdoZXN0CiAgICAJCSAqIHJlbmRlciBvcmRlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5yZW5kZXJPcmRlciA9IDA7CgogICAgCQkvKioKICAgIAkJICogQW4gYXJyYXkgaG9sZGluZyB0aGUgYW5pbWF0aW9uIGNsaXBzIG9mIHRoZSAzRCBvYmplY3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxBbmltYXRpb25DbGlwPn0KICAgIAkJICovCiAgICAJCXRoaXMuYW5pbWF0aW9ucyA9IFtdOwoKICAgIAkJLyoqCiAgICAJCSAqIEN1c3RvbSBkZXB0aCBtYXRlcmlhbCB0byBiZSB1c2VkIHdoZW4gcmVuZGVyaW5nIHRvIHRoZSBkZXB0aCBtYXAuIENhbiBvbmx5IGJlIHVzZWQKICAgIAkJICogaW4gY29udGV4dCBvZiBtZXNoZXMuIFdoZW4gc2hhZG93LWNhc3Rpbmcgd2l0aCBhIHtAbGluayBEaXJlY3Rpb25hbExpZ2h0fSBvciB7QGxpbmsgU3BvdExpZ2h0fSwKICAgIAkJICogaWYgeW91IGFyZSBtb2RpZnlpbmcgdmVydGV4IHBvc2l0aW9ucyBpbiB0aGUgdmVydGV4IHNoYWRlciB5b3UgbXVzdCBzcGVjaWZ5IGEgY3VzdG9tIGRlcHRoCiAgICAJCSAqIG1hdGVyaWFsIGZvciBwcm9wZXIgc2hhZG93cy4KICAgIAkJICoKICAgIAkJICogT25seSByZWxldmFudCBpbiBjb250ZXh0IG9mIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhNYXRlcmlhbHx1bmRlZmluZWQpfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMuY3VzdG9tRGVwdGhNYXRlcmlhbCA9IHVuZGVmaW5lZDsKCiAgICAJCS8qKgogICAgCQkgKiBTYW1lIGFzIHtAbGluayBPYmplY3QzRCNjdXN0b21EZXB0aE1hdGVyaWFsfSwgYnV0IHVzZWQgd2l0aCB7QGxpbmsgUG9pbnRMaWdodH0uCiAgICAJCSAqCiAgICAJCSAqIE9ubHkgcmVsZXZhbnQgaW4gY29udGV4dCBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTWF0ZXJpYWx8dW5kZWZpbmVkKX0KICAgIAkJICogQGRlZmF1bHQgdW5kZWZpbmVkCiAgICAJCSAqLwogICAgCQl0aGlzLmN1c3RvbURpc3RhbmNlTWF0ZXJpYWwgPSB1bmRlZmluZWQ7CgogICAgCQkvKioKICAgIAkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIDNEIG9iamVjdC4gSXQKICAgIAkJICogc2hvdWxkIG5vdCBob2xkIHJlZmVyZW5jZXMgdG8gZnVuY3Rpb25zIGFzIHRoZXNlIHdpbGwgbm90IGJlIGNsb25lZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdH0KICAgIAkJICovCiAgICAJCXRoaXMudXNlckRhdGEgPSB7fTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBIGNhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgaW1tZWRpYXRlbHkgYmVmb3JlIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkIHRvIGEgc2hhZG93IG1hcC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UmVuZGVyZXJ8V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBzY2VuZS4KICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gc2hhZG93Q2FtZXJhIC0gVGhlIHNoYWRvdyBjYW1lcmEuCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCiAgICAJICogQHBhcmFtIHtNYXRlcmlhbH0gZGVwdGhNYXRlcmlhbCAtIFRoZSBkZXB0aCBtYXRlcmlhbC4KICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KICAgIAkgKi8KICAgIAlvbkJlZm9yZVNoYWRvdyggLyogcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCAqLyApIHt9CgogICAgCS8qKgogICAgCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBhZnRlciBhIDNEIG9iamVjdCBpcyByZW5kZXJlZCB0byBhIHNoYWRvdyBtYXAuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCiAgICAJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCiAgICAJICogQHBhcmFtIHtDYW1lcmF9IHNoYWRvd0NhbWVyYSAtIFRoZSBzaGFkb3cgY2FtZXJhLgogICAgCSAqIEBwYXJhbSB7QnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5IC0gVGhlIDNEIG9iamVjdCdzIGdlb21ldHJ5LgogICAgCSAqIEBwYXJhbSB7TWF0ZXJpYWx9IGRlcHRoTWF0ZXJpYWwgLSBUaGUgZGVwdGggbWF0ZXJpYWwuCiAgICAJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCiAgICAJICovCiAgICAJb25BZnRlclNoYWRvdyggLyogcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCAqLyApIHt9CgogICAgCS8qKgogICAgCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgYSAzRCBvYmplY3QgaXMgcmVuZGVyZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCiAgICAJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCiAgICAJICogQHBhcmFtIHtNYXRlcmlhbH0gbWF0ZXJpYWwgLSBUaGUgM0Qgb2JqZWN0J3MgbWF0ZXJpYWwuCiAgICAJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCiAgICAJICovCiAgICAJb25CZWZvcmVSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCiAgICAJLyoqCiAgICAJICogQSBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGFmdGVyIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtSZW5kZXJlcnxXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0LgogICAgCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhIHRoYXQgaXMgdXNlZCB0byByZW5kZXIgdGhlIHNjZW5lLgogICAgCSAqIEBwYXJhbSB7QnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5IC0gVGhlIDNEIG9iamVjdCdzIGdlb21ldHJ5LgogICAgCSAqIEBwYXJhbSB7TWF0ZXJpYWx9IG1hdGVyaWFsIC0gVGhlIDNEIG9iamVjdCdzIG1hdGVyaWFsLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBncm91cCAtIFRoZSBnZW9tZXRyeSBncm91cCBkYXRhLgogICAgCSAqLwogICAgCW9uQWZ0ZXJSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gdHJhbnNmb3JtYXRpb24gbWF0cml4IHRvIHRoZSBvYmplY3QgYW5kIHVwZGF0ZXMgdGhlIG9iamVjdCdzIHBvc2l0aW9uLAogICAgCSAqIHJvdGF0aW9uIGFuZCBzY2FsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKi8KICAgIAlhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCiAgICAJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCiAgICAJCXRoaXMubWF0cml4LnByZW11bHRpcGx5KCBtYXRyaXggKTsKCiAgICAJCXRoaXMubWF0cml4LmRlY29tcG9zZSggdGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCB0aGlzLnNjYWxlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyBhIHJvdGF0aW9uIHJlcHJlc2VudGVkIGJ5IGdpdmVuIHRoZSBxdWF0ZXJuaW9uIHRvIHRoZSAzRCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgcXVhdGVybmlvbi4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlhcHBseVF1YXRlcm5pb24oIHEgKSB7CgogICAgCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIHEgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIGFuIGF4aXMvYW5nbGUgY291cGxlIHRvIHRoZSAzRCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqLwogICAgCXNldFJvdGF0aW9uRnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgogICAgCQkvLyBhc3N1bWVzIGF4aXMgaXMgbm9ybWFsaXplZAoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZ2l2ZW4gcm90YXRpb24gcmVwcmVzZW50ZWQgYXMgRXVsZXIgYW5nbGVzIHRvIHRoZSAzRCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCiAgICAJICovCiAgICAJc2V0Um90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciggZXVsZXIsIHRydWUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiByb3RhdGlvbiByZXByZXNlbnRlZCBhcyByb3RhdGlvbiBtYXRyaXggdG8gdGhlIDNEIG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEFsdGhvdWdoIGEgNHg0IG1hdHJpeCBpcyBleHBlY3RlZCwgdGhlIHVwcGVyIDN4MyBwb3J0aW9uIG11c3QgYmUKICAgIAkgKiBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKS4KICAgIAkgKi8KICAgIAlzZXRSb3RhdGlvbkZyb21NYXRyaXgoIG0gKSB7CgogICAgCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIGEgUXVhdGVybmlvbiB0byB0aGUgM0Qgb2JqZWN0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24KICAgIAkgKi8KICAgIAlzZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKICAgIAkJLy8gYXNzdW1lcyBxIGlzIG5vcm1hbGl6ZWQKCiAgICAJCXRoaXMucXVhdGVybmlvbi5jb3B5KCBxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFsb25nIGFuIGF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJvdGF0ZU9uQXhpcyggYXhpcywgYW5nbGUgKSB7CgogICAgCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gb2JqZWN0IHNwYWNlCiAgICAJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgogICAgCQlfcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCiAgICAJCXRoaXMucXVhdGVybmlvbi5tdWx0aXBseSggX3ExICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYWxvbmcgYW4gYXhpcyBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSAobm9ybWFsaXplZCkgYXhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcm90YXRlT25Xb3JsZEF4aXMoIGF4aXMsIGFuZ2xlICkgewoKICAgIAkJLy8gcm90YXRlIG9iamVjdCBvbiBheGlzIGluIHdvcmxkIHNwYWNlCiAgICAJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCiAgICAJCS8vIG1ldGhvZCBhc3N1bWVzIG5vIHJvdGF0ZWQgcGFyZW50CgogICAgCQlfcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCiAgICAJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYXJvdW5kIGl0cyBYIGF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlyb3RhdGVYKCBhbmdsZSApIHsKCiAgICAJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggX3hBeGlzLCBhbmdsZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIDNEIG9iamVjdCBhcm91bmQgaXRzIFkgYXhpcyBpbiBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJvdGF0ZVkoIGFuZ2xlICkgewoKICAgIAkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCBfeUF4aXMsIGFuZ2xlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFyb3VuZCBpdHMgWiBheGlzIGluIGxvY2FsIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcm90YXRlWiggYW5nbGUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIF96QXhpcywgYW5nbGUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIHRoZSBnaXZlbiBheGlzIGluIGxvY2FsIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBheGlzIC0gVGhlIChub3JtYWxpemVkKSBheGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdHJhbnNsYXRlT25BeGlzKCBheGlzLCBkaXN0YW5jZSApIHsKCiAgICAJCS8vIHRyYW5zbGF0ZSBvYmplY3QgYnkgZGlzdGFuY2UgYWxvbmcgYXhpcyBpbiBvYmplY3Qgc3BhY2UKICAgIAkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCiAgICAJCV92MSQ0LmNvcHkoIGF4aXMgKS5hcHBseVF1YXRlcm5pb24oIHRoaXMucXVhdGVybmlvbiApOwoKICAgIAkJdGhpcy5wb3NpdGlvbi5hZGQoIF92MSQ0Lm11bHRpcGx5U2NhbGFyKCBkaXN0YW5jZSApICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBYLWF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdHJhbnNsYXRlWCggZGlzdGFuY2UgKSB7CgogICAgCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF94QXhpcywgZGlzdGFuY2UgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBZLWF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdHJhbnNsYXRlWSggZGlzdGFuY2UgKSB7CgogICAgCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF95QXhpcywgZGlzdGFuY2UgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBaLWF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdHJhbnNsYXRlWiggZGlzdGFuY2UgKSB7CgogICAgCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF96QXhpcywgZGlzdGFuY2UgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyAzRCBvYmplY3QncyBsb2NhbCBzcGFjZSB0byB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0byBjb252ZXJ0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb252ZXJ0ZWQgdmVjdG9yLgogICAgCSAqLwogICAgCWxvY2FsVG9Xb3JsZCggdmVjdG9yICkgewoKICAgIAkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhlIGdpdmVuIHZlY3RvciBmcm9tIHRoaXMgM0Qgb2JqZWN0J3Mgd29yZCBzcGFjZSB0byBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0byBjb252ZXJ0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb252ZXJ0ZWQgdmVjdG9yLgogICAgCSAqLwogICAgCXdvcmxkVG9Mb2NhbCggdmVjdG9yICkgewoKICAgIAkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCBfbTEkMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIG9iamVjdCB0byBmYWNlIGEgcG9pbnQgaW4gd29ybGQgc3BhY2UuCiAgICAJICoKICAgIAkgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IG9iamVjdHMgaGF2aW5nIG5vbi11bmlmb3JtbHktc2NhbGVkIHBhcmVudChzKS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfFZlY3RvcjN9IHggLSBUaGUgeCBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLiBBbHRlcm5hdGl2ZWx5LCBhIHZlY3RvciByZXByZXNlbnRpbmcgYSBwb3NpdGlvbiBpbiB3b3JsZCBzcGFjZQogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbeV0gLSBUaGUgeSBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbel0gLSBUaGUgeiBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLgogICAgCSAqLwogICAgCWxvb2tBdCggeCwgeSwgeiApIHsKCiAgICAJCS8vIFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgb2JqZWN0cyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgcGFyZW50KHMpCgogICAgCQlpZiAoIHguaXNWZWN0b3IzICkgewoKICAgIAkJCV90YXJnZXQuY29weSggeCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlfdGFyZ2V0LnNldCggeCwgeSwgeiApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJX3Bvc2l0aW9uJDMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgogICAgCQlpZiAoIHRoaXMuaXNDYW1lcmEgfHwgdGhpcy5pc0xpZ2h0ICkgewoKICAgIAkJCV9tMSQxJDEubG9va0F0KCBfcG9zaXRpb24kMywgX3RhcmdldCwgdGhpcy51cCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlfbTEkMSQxLmxvb2tBdCggX3RhcmdldCwgX3Bvc2l0aW9uJDMsIHRoaXMudXAgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxJDEgKTsKCiAgICAJCWlmICggcGFyZW50ICkgewoKICAgIAkJCV9tMSQxJDEuZXh0cmFjdFJvdGF0aW9uKCBwYXJlbnQubWF0cml4V29ybGQgKTsKICAgIAkJCV9xMS5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxJDEgKTsKICAgIAkJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExLmludmVydCgpICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gM0Qgb2JqZWN0IGFzIGEgY2hpbGQgdG8gdGhpcyAzRCBvYmplY3QuIEFuIGFyYml0cmFyeSBudW1iZXIgb2YKICAgIAkgKiBvYmplY3RzIG1heSBiZSBhZGRlZC4gQW55IGN1cnJlbnQgcGFyZW50IG9uIGFuIG9iamVjdCBwYXNzZWQgaW4gaGVyZSB3aWxsIGJlCiAgICAJICogcmVtb3ZlZCwgc2luY2UgYW4gb2JqZWN0IGNhbiBoYXZlIGF0IG1vc3Qgb25lIHBhcmVudC4KICAgIAkgKgogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNhZGRlZAogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZGFkZGVkCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0byBhZGQuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYWRkKCBvYmplY3QgKSB7CgogICAgCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCXRoaXMuYWRkKCBhcmd1bWVudHNbIGkgXSApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCWlmICggb2JqZWN0ID09PSB0aGlzICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBjYW5cJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuJywgb2JqZWN0ICk7CiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCWlmICggb2JqZWN0ICYmIG9iamVjdC5pc09iamVjdDNEICkgewoKICAgIAkJCW9iamVjdC5yZW1vdmVGcm9tUGFyZW50KCk7CiAgICAJCQlvYmplY3QucGFyZW50ID0gdGhpczsKICAgIAkJCXRoaXMuY2hpbGRyZW4ucHVzaCggb2JqZWN0ICk7CgogICAgCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgogICAgCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG9iamVjdDsKICAgIAkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkYWRkZWRFdmVudCApOwogICAgCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG51bGw7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuJywgb2JqZWN0ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgY2hpbGQgZnJvbSB0aGlzIDNEIG9iamVjdC4KICAgIAkgKiBBbiBhcmJpdHJhcnkgbnVtYmVyIG9mIG9iamVjdHMgbWF5IGJlIHJlbW92ZWQuCiAgICAJICoKICAgIAkgKiBAZmlyZXMgT2JqZWN0M0QjcmVtb3ZlZAogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZHJlbW92ZWQKICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIHJlbW92ZS4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlyZW1vdmUoIG9iamVjdCApIHsKCiAgICAJCWlmICggYXJndW1lbnRzLmxlbmd0aCA+IDEgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJdGhpcy5yZW1vdmUoIGFyZ3VtZW50c1sgaSBdICk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJY29uc3QgaW5kZXggPSB0aGlzLmNoaWxkcmVuLmluZGV4T2YoIG9iamVjdCApOwoKICAgIAkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgogICAgCQkJb2JqZWN0LnBhcmVudCA9IG51bGw7CiAgICAJCQl0aGlzLmNoaWxkcmVuLnNwbGljZSggaW5kZXgsIDEgKTsKCiAgICAJCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggX3JlbW92ZWRFdmVudCApOwoKICAgIAkJCV9jaGlsZHJlbW92ZWRFdmVudC5jaGlsZCA9IG9iamVjdDsKICAgIAkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkcmVtb3ZlZEV2ZW50ICk7CiAgICAJCQlfY2hpbGRyZW1vdmVkRXZlbnQuY2hpbGQgPSBudWxsOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVtb3ZlcyB0aGlzIDNEIG9iamVjdCBmcm9tIGl0cyBjdXJyZW50IHBhcmVudC4KICAgIAkgKgogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNyZW1vdmVkCiAgICAJICogQGZpcmVzIE9iamVjdDNEI2NoaWxkcmVtb3ZlZAogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJlbW92ZUZyb21QYXJlbnQoKSB7CgogICAgCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCiAgICAJCWlmICggcGFyZW50ICE9PSBudWxsICkgewoKICAgIAkJCXBhcmVudC5yZW1vdmUoIHRoaXMgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlbW92ZXMgYWxsIGNoaWxkIG9iamVjdHMuCiAgICAJICoKICAgIAkgKiBAZmlyZXMgT2JqZWN0M0QjcmVtb3ZlZAogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZHJlbW92ZWQKICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbGVhcigpIHsKCiAgICAJCXJldHVybiB0aGlzLnJlbW92ZSggLi4uIHRoaXMuY2hpbGRyZW4gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzIDNEIG9iamVjdCwgd2hpbGUgbWFpbnRhaW5pbmcgdGhlIG9iamVjdCdzIHdvcmxkCiAgICAJICogdHJhbnNmb3JtLiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykuCiAgICAJICoKICAgIAkgKiBAZmlyZXMgT2JqZWN0M0QjYWRkZWQKICAgIAkgKiBAZmlyZXMgT2JqZWN0M0QjY2hpbGRhZGRlZAogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gYXR0YWNoLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWF0dGFjaCggb2JqZWN0ICkgewoKICAgIAkJLy8gYWRkcyBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzLCB3aGlsZSBtYWludGFpbmluZyB0aGUgb2JqZWN0J3Mgd29ybGQgdHJhbnNmb3JtCgogICAgCQkvLyBOb3RlOiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykKCiAgICAJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgogICAgCQlfbTEkMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCiAgICAJCWlmICggb2JqZWN0LnBhcmVudCAhPT0gbnVsbCApIHsKCiAgICAJCQlvYmplY3QucGFyZW50LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJCV9tMSQxJDEubXVsdGlwbHkoIG9iamVjdC5wYXJlbnQubWF0cml4V29ybGQgKTsKCiAgICAJCX0KCiAgICAJCW9iamVjdC5hcHBseU1hdHJpeDQoIF9tMSQxJDEgKTsKCiAgICAJCW9iamVjdC5yZW1vdmVGcm9tUGFyZW50KCk7CiAgICAJCW9iamVjdC5wYXJlbnQgPSB0aGlzOwogICAgCQl0aGlzLmNoaWxkcmVuLnB1c2goIG9iamVjdCApOwoKICAgIAkJb2JqZWN0LnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgdHJ1ZSApOwoKICAgIAkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgogICAgCQlfY2hpbGRhZGRlZEV2ZW50LmNoaWxkID0gb2JqZWN0OwogICAgCQl0aGlzLmRpc3BhdGNoRXZlbnQoIF9jaGlsZGFkZGVkRXZlbnQgKTsKICAgIAkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG51bGw7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZWFyY2hlcyB0aHJvdWdoIHRoZSAzRCBvYmplY3QgYW5kIGl0cyBjaGlsZHJlbiwgc3RhcnRpbmcgd2l0aCB0aGUgM0Qgb2JqZWN0CiAgICAJICogaXRzZWxmLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgd2l0aCBhIG1hdGNoaW5nIElELgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGlkIC0gVGhlIGlkLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfHVuZGVmaW5lZH0gVGhlIGZvdW5kIDNEIG9iamVjdC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBubyAzRCBvYmplY3QgaGFzIGJlZW4gZm91bmQuCiAgICAJICovCiAgICAJZ2V0T2JqZWN0QnlJZCggaWQgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnaWQnLCBpZCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKICAgIAkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIHRoZSBmaXJzdCB3aXRoIGEgbWF0Y2hpbmcgbmFtZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R8dW5kZWZpbmVkfSBUaGUgZm91bmQgM0Qgb2JqZWN0LiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIG5vIDNEIG9iamVjdCBoYXMgYmVlbiBmb3VuZC4KICAgIAkgKi8KICAgIAlnZXRPYmplY3RCeU5hbWUoIG5hbWUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnbmFtZScsIG5hbWUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZWFyY2hlcyB0aHJvdWdoIHRoZSAzRCBvYmplY3QgYW5kIGl0cyBjaGlsZHJlbiwgc3RhcnRpbmcgd2l0aCB0aGUgM0Qgb2JqZWN0CiAgICAJICogaXRzZWxmLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgd2l0aCBhIG1hdGNoaW5nIHByb3BlcnR5IHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkuCiAgICAJICogQHBhcmFtIHthbnl9IHZhbHVlIC0gVGhlIHZhbHVlLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfHVuZGVmaW5lZH0gVGhlIGZvdW5kIDNEIG9iamVjdC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBubyAzRCBvYmplY3QgaGFzIGJlZW4gZm91bmQuCiAgICAJICovCiAgICAJZ2V0T2JqZWN0QnlQcm9wZXJ0eSggbmFtZSwgdmFsdWUgKSB7CgogICAgCQlpZiAoIHRoaXNbIG5hbWUgXSA9PT0gdmFsdWUgKSByZXR1cm4gdGhpczsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQljb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW5bIGkgXTsKICAgIAkJCWNvbnN0IG9iamVjdCA9IGNoaWxkLmdldE9iamVjdEJ5UHJvcGVydHkoIG5hbWUsIHZhbHVlICk7CgogICAgCQkJaWYgKCBvYmplY3QgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJcmV0dXJuIG9iamVjdDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gdW5kZWZpbmVkOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKICAgIAkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIGFsbCAzRCBvYmplY3RzIHdpdGggYSBtYXRjaGluZyBwcm9wZXJ0eSB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5LgogICAgCSAqIEBwYXJhbSB7YW55fSB2YWx1ZSAtIFRoZSB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge0FycmF5PE9iamVjdDNEPn0gcmVzdWx0IC0gVGhlIG1ldGhvZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0FycmF5PE9iamVjdDNEPn0gVGhlIGZvdW5kIDNEIG9iamVjdHMuCiAgICAJICovCiAgICAJZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgPSBbXSApIHsKCiAgICAJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJlc3VsdC5wdXNoKCB0aGlzICk7CgogICAgCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNoaWxkcmVuWyBpIF0uZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiByZXN1bHQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoZSByZXN1bHQgaXMgc3RvcmVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSAzRCBvYmplY3QncyBwb3NpdGlvbiBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKi8KICAgIAlnZXRXb3JsZFBvc2l0aW9uKCB0YXJnZXQgKSB7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJcmV0dXJuIHRhcmdldC5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubWF0cml4V29ybGQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgUXVhdGVybmlvbiByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHRhcmdldCAtIFRoZSB0YXJnZXQgUXVhdGVybmlvbiB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBUaGUgM0Qgb2JqZWN0J3Mgcm90YXRpb24gaW4gd29ybGQgc3BhY2UuCiAgICAJICovCiAgICAJZ2V0V29ybGRRdWF0ZXJuaW9uKCB0YXJnZXQgKSB7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQzLCB0YXJnZXQsIF9zY2FsZSQyICk7CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSBzY2FsZSBvZiB0aGUgM0Qgb2JqZWN0IGluIHdvcmxkIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgM0Qgb2JqZWN0J3Mgc2NhbGUgaW4gd29ybGQgc3BhY2UuCiAgICAJICovCiAgICAJZ2V0V29ybGRTY2FsZSggdGFyZ2V0ICkgewoKICAgIAkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCXRoaXMubWF0cml4V29ybGQuZGVjb21wb3NlKCBfcG9zaXRpb24kMywgX3F1YXRlcm5pb24kMiwgdGFyZ2V0ICk7CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSAoImxvb2siKSBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIGRpcmVjdGlvbiBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKi8KICAgIAlnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKICAgIAkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCWNvbnN0IGUgPSB0aGlzLm1hdHJpeFdvcmxkLmVsZW1lbnRzOwoKICAgIAkJcmV0dXJuIHRhcmdldC5zZXQoIGVbIDggXSwgZVsgOSBdLCBlWyAxMCBdICkubm9ybWFsaXplKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWJzdHJhY3QgbWV0aG9kIHRvIGdldCBpbnRlcnNlY3Rpb25zIGJldHdlZW4gYSBjYXN0ZWQgcmF5IGFuZCB0aGlzCiAgICAJICogM0Qgb2JqZWN0LiBSZW5kZXJhYmxlIDNEIG9iamVjdHMgc3VjaCBhcyB7QGxpbmsgTWVzaH0sIHtAbGluayBMaW5lfSBvciB7QGxpbmsgUG9pbnRzfQogICAgCSAqIGltcGxlbWVudCB0aGlzIG1ldGhvZCBpbiBvcmRlciB0byB1c2UgcmF5Y2FzdGluZy4KICAgIAkgKgogICAgCSAqIEBhYnN0cmFjdAogICAgCSAqIEBwYXJhbSB7UmF5Y2FzdGVyfSByYXljYXN0ZXIgLSBUaGUgcmF5Y2FzdGVyLgogICAgCSAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gaW50ZXJzZWN0cyAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIHJlc3VsdCBvZiB0aGUgbWV0aG9kLgogICAgCSAqLwogICAgCXJheWNhc3QoIC8qIHJheWNhc3RlciwgaW50ZXJzZWN0cyAqLyApIHt9CgogICAgCS8qKgogICAgCSAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBvbiB0aGlzIDNEIG9iamVjdCBhbmQgYWxsIGRlc2NlbmRhbnRzLgogICAgCSAqCiAgICAJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgogICAgCSAqLwogICAgCXRyYXZlcnNlKCBjYWxsYmFjayApIHsKCiAgICAJCWNhbGxiYWNrKCB0aGlzICk7CgogICAgCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNoaWxkcmVuWyBpIF0udHJhdmVyc2UoIGNhbGxiYWNrICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTGlrZSB7QGxpbmsgT2JqZWN0M0QjdHJhdmVyc2V9LCBidXQgdGhlIGNhbGxiYWNrIHdpbGwgb25seSBiZSBleGVjdXRlZCBmb3IgdmlzaWJsZSAzRCBvYmplY3RzLgogICAgCSAqIERlc2NlbmRhbnRzIG9mIGludmlzaWJsZSAzRCBvYmplY3RzIGFyZSBub3QgdHJhdmVyc2VkLgogICAgCSAqCiAgICAJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgogICAgCSAqLwogICAgCXRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKSB7CgogICAgCQlpZiAoIHRoaXMudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgogICAgCQljYWxsYmFjayggdGhpcyApOwoKICAgIAkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQljaGlsZHJlblsgaSBdLnRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaWtlIHtAbGluayBPYmplY3QzRCN0cmF2ZXJzZX0sIGJ1dCB0aGUgY2FsbGJhY2sgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGZvciBhbGwgYW5jZXN0b3JzLgogICAgCSAqCiAgICAJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgogICAgCSAqLwogICAgCXRyYXZlcnNlQW5jZXN0b3JzKCBjYWxsYmFjayApIHsKCiAgICAJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKICAgIAkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgogICAgCQkJY2FsbGJhY2soIHBhcmVudCApOwoKICAgIAkJCXBhcmVudC50cmF2ZXJzZUFuY2VzdG9ycyggY2FsbGJhY2sgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBVcGRhdGVzIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gbG9jYWwgc3BhY2UgYnkgY29tcHV0aW5nIGl0IGZyb20gdGhlIGN1cnJlbnQKICAgIAkgKiBwb3NpdGlvbiwgcm90YXRpb24gYW5kIHNjYWxlIHZhbHVlcy4KICAgIAkgKi8KICAgIAl1cGRhdGVNYXRyaXgoKSB7CgogICAgCQl0aGlzLm1hdHJpeC5jb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCiAgICAJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVXBkYXRlcyB0aGUgdHJhbnNmb3JtYXRpb24gbWF0cml4IGluIHdvcmxkIHNwYWNlIG9mIHRoaXMgM0Qgb2JqZWN0cyBhbmQgaXRzIGRlc2NlbmRhbnRzLgogICAgCSAqCiAgICAJICogVG8gZW5zdXJlIGNvcnJlY3QgcmVzdWx0cywgdGhpcyBtZXRob2QgYWxzbyByZWNvbXB1dGVzIHRoZSAzRCBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4KICAgIAkgKiBsb2NhbCBzcGFjZS4gVGhlIGNvbXB1dGF0aW9uIG9mIHRoZSBsb2NhbCBhbmQgd29ybGQgbWF0cml4IGNhbiBiZSBjb250cm9sbGVkIHdpdGggdGhlCiAgICAJICoge0BsaW5rIE9iamVjdDNEI21hdHJpeEF1dG9VcGRhdGV9IGFuZCB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBmbGFncyB3aGljaCBhcmUgYm90aAogICAgCSAqIGB0cnVlYCBieSBkZWZhdWx0LiAgU2V0IHRoZXNlIGZsYWdzIHRvIGBmYWxzZWAgaWYgeW91IG5lZWQgbW9yZSBjb250cm9sIG92ZXIgdGhlIHVwZGF0ZSBtYXRyaXggcHJvY2Vzcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlPWZhbHNlXSAtIFdoZW4gc2V0IHRvIGB0cnVlYCwgYSByZWNvbXB1dGF0aW9uIG9mIHdvcmxkIG1hdHJpY2VzIGlzIGZvcmNlZCBldmVuCiAgICAJICogd2hlbiB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBpcyBzZXQgdG8gYGZhbHNlYC4KICAgIAkgKi8KICAgIAl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgogICAgCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgogICAgCQlpZiAoIHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSB8fCBmb3JjZSApIHsKCiAgICAJCQlpZiAoIHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKICAgIAkJCQlpZiAoIHRoaXMucGFyZW50ID09PSBudWxsICkgewoKICAgIAkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5tYXRyaXhXb3JsZC5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLnBhcmVudC5tYXRyaXhXb3JsZCwgdGhpcy5tYXRyaXggKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCiAgICAJCQlmb3JjZSA9IHRydWU7CgogICAgCQl9CgogICAgCQkvLyBtYWtlIHN1cmUgZGVzY2VuZGFudHMgYXJlIHVwZGF0ZWQgaWYgcmVxdWlyZWQKCiAgICAJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKICAgIAkJCWNoaWxkLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFuIGFsdGVybmF0aXZlIHZlcnNpb24gb2Yge0BsaW5rIE9iamVjdDNEI3VwZGF0ZU1hdHJpeFdvcmxkfSB3aXRoIG1vcmUgY29udHJvbCBvdmVyIHRoZQogICAgCSAqIHVwZGF0ZSBvZiBhbmNlc3RvciBhbmQgZGVzY2VuZGFudCBub2Rlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZVBhcmVudHM9ZmFsc2VdIFdoZXRoZXIgYW5jZXN0b3Igbm9kZXMgc2hvdWxkIGJlIHVwZGF0ZWQgb3Igbm90LgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZUNoaWxkcmVuPWZhbHNlXSBXaGV0aGVyIGRlc2NlbmRhbnQgbm9kZXMgc2hvdWxkIGJlIHVwZGF0ZWQgb3Igbm90LgogICAgCSAqLwogICAgCXVwZGF0ZVdvcmxkTWF0cml4KCB1cGRhdGVQYXJlbnRzLCB1cGRhdGVDaGlsZHJlbiApIHsKCiAgICAJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKICAgIAkJaWYgKCB1cGRhdGVQYXJlbnRzID09PSB0cnVlICYmIHBhcmVudCAhPT0gbnVsbCApIHsKCiAgICAJCQlwYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgogICAgCQlpZiAoIHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKICAgIAkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgogICAgCQkJCXRoaXMubWF0cml4V29ybGQuY29weSggdGhpcy5tYXRyaXggKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIG1ha2Ugc3VyZSBkZXNjZW5kYW50cyBhcmUgdXBkYXRlZAoKICAgIAkJaWYgKCB1cGRhdGVDaGlsZHJlbiA9PT0gdHJ1ZSApIHsKCiAgICAJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKICAgIAkJCQljaGlsZC51cGRhdGVXb3JsZE1hdHJpeCggZmFsc2UsIHRydWUgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VyaWFsaXplcyB0aGUgM0Qgb2JqZWN0IGludG8gSlNPTi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIDNEIG9iamVjdC4KICAgIAkgKiBAc2VlIHtAbGluayBPYmplY3RMb2FkZXIjcGFyc2V9CiAgICAJICovCiAgICAJdG9KU09OKCBtZXRhICkgewoKICAgIAkJLy8gbWV0YSBpcyBhIHN0cmluZyB3aGVuIGNhbGxlZCBmcm9tIEpTT04uc3RyaW5naWZ5CiAgICAJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKICAgIAkJY29uc3Qgb3V0cHV0ID0ge307CgogICAgCQkvLyBtZXRhIGlzIGEgaGFzaCB1c2VkIHRvIGNvbGxlY3QgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLgogICAgCQkvLyBub3QgcHJvdmlkaW5nIGl0IGltcGxpZXMgdGhhdCB0aGlzIGlzIHRoZSByb290IG9iamVjdAogICAgCQkvLyBiZWluZyBzZXJpYWxpemVkLgogICAgCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCiAgICAJCQkvLyBpbml0aWFsaXplIG1ldGEgb2JqCiAgICAJCQltZXRhID0gewogICAgCQkJCWdlb21ldHJpZXM6IHt9LAogICAgCQkJCW1hdGVyaWFsczoge30sCiAgICAJCQkJdGV4dHVyZXM6IHt9LAogICAgCQkJCWltYWdlczoge30sCiAgICAJCQkJc2hhcGVzOiB7fSwKICAgIAkJCQlza2VsZXRvbnM6IHt9LAogICAgCQkJCWFuaW1hdGlvbnM6IHt9LAogICAgCQkJCW5vZGVzOiB7fQogICAgCQkJfTsKCiAgICAJCQlvdXRwdXQubWV0YWRhdGEgPSB7CiAgICAJCQkJdmVyc2lvbjogNC43LAogICAgCQkJCXR5cGU6ICdPYmplY3QnLAogICAgCQkJCWdlbmVyYXRvcjogJ09iamVjdDNELnRvSlNPTicKICAgIAkJCX07CgogICAgCQl9CgogICAgCQkvLyBzdGFuZGFyZCBPYmplY3QzRCBzZXJpYWxpemF0aW9uCgogICAgCQljb25zdCBvYmplY3QgPSB7fTsKCiAgICAJCW9iamVjdC51dWlkID0gdGhpcy51dWlkOwogICAgCQlvYmplY3QudHlwZSA9IHRoaXMudHlwZTsKCiAgICAJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIG9iamVjdC5uYW1lID0gdGhpcy5uYW1lOwogICAgCQlpZiAoIHRoaXMuY2FzdFNoYWRvdyA9PT0gdHJ1ZSApIG9iamVjdC5jYXN0U2hhZG93ID0gdHJ1ZTsKICAgIAkJaWYgKCB0aGlzLnJlY2VpdmVTaGFkb3cgPT09IHRydWUgKSBvYmplY3QucmVjZWl2ZVNoYWRvdyA9IHRydWU7CiAgICAJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIG9iamVjdC52aXNpYmxlID0gZmFsc2U7CiAgICAJCWlmICggdGhpcy5mcnVzdHVtQ3VsbGVkID09PSBmYWxzZSApIG9iamVjdC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CiAgICAJCWlmICggdGhpcy5yZW5kZXJPcmRlciAhPT0gMCApIG9iamVjdC5yZW5kZXJPcmRlciA9IHRoaXMucmVuZGVyT3JkZXI7CiAgICAJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb2JqZWN0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCiAgICAJCW9iamVjdC5sYXllcnMgPSB0aGlzLmxheWVycy5tYXNrOwogICAgCQlvYmplY3QubWF0cml4ID0gdGhpcy5tYXRyaXgudG9BcnJheSgpOwogICAgCQlvYmplY3QudXAgPSB0aGlzLnVwLnRvQXJyYXkoKTsKCiAgICAJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlID09PSBmYWxzZSApIG9iamVjdC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgogICAgCQkvLyBvYmplY3Qgc3BlY2lmaWMgcHJvcGVydGllcwoKICAgIAkJaWYgKCB0aGlzLmlzSW5zdGFuY2VkTWVzaCApIHsKCiAgICAJCQlvYmplY3QudHlwZSA9ICdJbnN0YW5jZWRNZXNoJzsKICAgIAkJCW9iamVjdC5jb3VudCA9IHRoaXMuY291bnQ7CiAgICAJCQlvYmplY3QuaW5zdGFuY2VNYXRyaXggPSB0aGlzLmluc3RhbmNlTWF0cml4LnRvSlNPTigpOwogICAgCQkJaWYgKCB0aGlzLmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSBvYmplY3QuaW5zdGFuY2VDb2xvciA9IHRoaXMuaW5zdGFuY2VDb2xvci50b0pTT04oKTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5pc0JhdGNoZWRNZXNoICkgewoKICAgIAkJCW9iamVjdC50eXBlID0gJ0JhdGNoZWRNZXNoJzsKICAgIAkJCW9iamVjdC5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkID0gdGhpcy5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkOwogICAgCQkJb2JqZWN0LnNvcnRPYmplY3RzID0gdGhpcy5zb3J0T2JqZWN0czsKCiAgICAJCQlvYmplY3QuZHJhd1JhbmdlcyA9IHRoaXMuX2RyYXdSYW5nZXM7CiAgICAJCQlvYmplY3QucmVzZXJ2ZWRSYW5nZXMgPSB0aGlzLl9yZXNlcnZlZFJhbmdlczsKCiAgICAJCQlvYmplY3QuZ2VvbWV0cnlJbmZvID0gdGhpcy5fZ2VvbWV0cnlJbmZvLm1hcCggaW5mbyA9PiAoIHsKICAgIAkJCQkuLi5pbmZvLAogICAgCQkJCWJvdW5kaW5nQm94OiBpbmZvLmJvdW5kaW5nQm94ID8gaW5mby5ib3VuZGluZ0JveC50b0pTT04oKSA6IHVuZGVmaW5lZCwKICAgIAkJCQlib3VuZGluZ1NwaGVyZTogaW5mby5ib3VuZGluZ1NwaGVyZSA/IGluZm8uYm91bmRpbmdTcGhlcmUudG9KU09OKCkgOiB1bmRlZmluZWQKICAgIAkJCX0gKSApOwogICAgCQkJb2JqZWN0Lmluc3RhbmNlSW5mbyA9IHRoaXMuX2luc3RhbmNlSW5mby5tYXAoIGluZm8gPT4gKCB7IC4uLmluZm8gfSApICk7CgogICAgCQkJb2JqZWN0LmF2YWlsYWJsZUluc3RhbmNlSWRzID0gdGhpcy5fYXZhaWxhYmxlSW5zdGFuY2VJZHMuc2xpY2UoKTsKICAgIAkJCW9iamVjdC5hdmFpbGFibGVHZW9tZXRyeUlkcyA9IHRoaXMuX2F2YWlsYWJsZUdlb21ldHJ5SWRzLnNsaWNlKCk7CgogICAgCQkJb2JqZWN0Lm5leHRJbmRleFN0YXJ0ID0gdGhpcy5fbmV4dEluZGV4U3RhcnQ7CiAgICAJCQlvYmplY3QubmV4dFZlcnRleFN0YXJ0ID0gdGhpcy5fbmV4dFZlcnRleFN0YXJ0OwogICAgCQkJb2JqZWN0Lmdlb21ldHJ5Q291bnQgPSB0aGlzLl9nZW9tZXRyeUNvdW50OwoKICAgIAkJCW9iamVjdC5tYXhJbnN0YW5jZUNvdW50ID0gdGhpcy5fbWF4SW5zdGFuY2VDb3VudDsKICAgIAkJCW9iamVjdC5tYXhWZXJ0ZXhDb3VudCA9IHRoaXMuX21heFZlcnRleENvdW50OwogICAgCQkJb2JqZWN0Lm1heEluZGV4Q291bnQgPSB0aGlzLl9tYXhJbmRleENvdW50OwoKICAgIAkJCW9iamVjdC5nZW9tZXRyeUluaXRpYWxpemVkID0gdGhpcy5fZ2VvbWV0cnlJbml0aWFsaXplZDsKCiAgICAJCQlvYmplY3QubWF0cmljZXNUZXh0dXJlID0gdGhpcy5fbWF0cmljZXNUZXh0dXJlLnRvSlNPTiggbWV0YSApOwoKICAgIAkJCW9iamVjdC5pbmRpcmVjdFRleHR1cmUgPSB0aGlzLl9pbmRpcmVjdFRleHR1cmUudG9KU09OKCBtZXRhICk7CgogICAgCQkJaWYgKCB0aGlzLl9jb2xvcnNUZXh0dXJlICE9PSBudWxsICkgewoKICAgIAkJCQlvYmplY3QuY29sb3JzVGV4dHVyZSA9IHRoaXMuX2NvbG9yc1RleHR1cmUudG9KU09OKCBtZXRhICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJb2JqZWN0LmJvdW5kaW5nU3BoZXJlID0gdGhpcy5ib3VuZGluZ1NwaGVyZS50b0pTT04oKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKICAgIAkJCQlvYmplY3QuYm91bmRpbmdCb3ggPSB0aGlzLmJvdW5kaW5nQm94LnRvSlNPTigpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQlmdW5jdGlvbiBzZXJpYWxpemUoIGxpYnJhcnksIGVsZW1lbnQgKSB7CgogICAgCQkJaWYgKCBsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9IGVsZW1lbnQudG9KU09OKCBtZXRhICk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBlbGVtZW50LnV1aWQ7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuaXNTY2VuZSApIHsKCiAgICAJCQlpZiAoIHRoaXMuYmFja2dyb3VuZCApIHsKCiAgICAJCQkJaWYgKCB0aGlzLmJhY2tncm91bmQuaXNDb2xvciApIHsKCiAgICAJCQkJCW9iamVjdC5iYWNrZ3JvdW5kID0gdGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOwoKICAgIAkJCQl9IGVsc2UgaWYgKCB0aGlzLmJhY2tncm91bmQuaXNUZXh0dXJlICkgewoKICAgIAkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHRoaXMuZW52aXJvbm1lbnQgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1JlbmRlclRhcmdldFRleHR1cmUgIT09IHRydWUgKSB7CgogICAgCQkJCW9iamVjdC5lbnZpcm9ubWVudCA9IHRoaXMuZW52aXJvbm1lbnQudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCB0aGlzLmlzTWVzaCB8fCB0aGlzLmlzTGluZSB8fCB0aGlzLmlzUG9pbnRzICkgewoKICAgIAkJCW9iamVjdC5nZW9tZXRyeSA9IHNlcmlhbGl6ZSggbWV0YS5nZW9tZXRyaWVzLCB0aGlzLmdlb21ldHJ5ICk7CgogICAgCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuZ2VvbWV0cnkucGFyYW1ldGVyczsKCiAgICAJCQlpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCAmJiBwYXJhbWV0ZXJzLnNoYXBlcyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljb25zdCBzaGFwZXMgPSBwYXJhbWV0ZXJzLnNoYXBlczsKCiAgICAJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBzaGFwZXMgKSApIHsKCiAgICAJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBpIF07CgogICAgCQkJCQkJc2VyaWFsaXplKCBtZXRhLnNoYXBlcywgc2hhcGUgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXNlcmlhbGl6ZSggbWV0YS5zaGFwZXMsIHNoYXBlcyApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmlzU2tpbm5lZE1lc2ggKSB7CgogICAgCQkJb2JqZWN0LmJpbmRNb2RlID0gdGhpcy5iaW5kTW9kZTsKICAgIAkJCW9iamVjdC5iaW5kTWF0cml4ID0gdGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKTsKCiAgICAJCQlpZiAoIHRoaXMuc2tlbGV0b24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJc2VyaWFsaXplKCBtZXRhLnNrZWxldG9ucywgdGhpcy5za2VsZXRvbiApOwoKICAgIAkJCQlvYmplY3Quc2tlbGV0b24gPSB0aGlzLnNrZWxldG9uLnV1aWQ7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLm1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJaWYgKCBBcnJheS5pc0FycmF5KCB0aGlzLm1hdGVyaWFsICkgKSB7CgogICAgCQkJCWNvbnN0IHV1aWRzID0gW107CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMubWF0ZXJpYWwubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJCXV1aWRzLnB1c2goIHNlcmlhbGl6ZSggbWV0YS5tYXRlcmlhbHMsIHRoaXMubWF0ZXJpYWxbIGkgXSApICk7CgogICAgCQkJCX0KCiAgICAJCQkJb2JqZWN0Lm1hdGVyaWFsID0gdXVpZHM7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJb2JqZWN0Lm1hdGVyaWFsID0gc2VyaWFsaXplKCBtZXRhLm1hdGVyaWFscywgdGhpcy5tYXRlcmlhbCApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQlpZiAoIHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCApIHsKCiAgICAJCQlvYmplY3QuY2hpbGRyZW4gPSBbXTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJb2JqZWN0LmNoaWxkcmVuLnB1c2goIHRoaXMuY2hpbGRyZW5bIGkgXS50b0pTT04oIG1ldGEgKS5vYmplY3QgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLwoKICAgIAkJaWYgKCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoID4gMCApIHsKCiAgICAJCQlvYmplY3QuYW5pbWF0aW9ucyA9IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uc1sgaSBdOwoKICAgIAkJCQlvYmplY3QuYW5pbWF0aW9ucy5wdXNoKCBzZXJpYWxpemUoIG1ldGEuYW5pbWF0aW9ucywgYW5pbWF0aW9uICkgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCiAgICAJCQljb25zdCBnZW9tZXRyaWVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5nZW9tZXRyaWVzICk7CiAgICAJCQljb25zdCBtYXRlcmlhbHMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLm1hdGVyaWFscyApOwogICAgCQkJY29uc3QgdGV4dHVyZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLnRleHR1cmVzICk7CiAgICAJCQljb25zdCBpbWFnZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmltYWdlcyApOwogICAgCQkJY29uc3Qgc2hhcGVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5zaGFwZXMgKTsKICAgIAkJCWNvbnN0IHNrZWxldG9ucyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuc2tlbGV0b25zICk7CiAgICAJCQljb25zdCBhbmltYXRpb25zID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5hbmltYXRpb25zICk7CiAgICAJCQljb25zdCBub2RlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEubm9kZXMgKTsKCiAgICAJCQlpZiAoIGdlb21ldHJpZXMubGVuZ3RoID4gMCApIG91dHB1dC5nZW9tZXRyaWVzID0gZ2VvbWV0cmllczsKICAgIAkJCWlmICggbWF0ZXJpYWxzLmxlbmd0aCA+IDAgKSBvdXRwdXQubWF0ZXJpYWxzID0gbWF0ZXJpYWxzOwogICAgCQkJaWYgKCB0ZXh0dXJlcy5sZW5ndGggPiAwICkgb3V0cHV0LnRleHR1cmVzID0gdGV4dHVyZXM7CiAgICAJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgb3V0cHV0LmltYWdlcyA9IGltYWdlczsKICAgIAkJCWlmICggc2hhcGVzLmxlbmd0aCA+IDAgKSBvdXRwdXQuc2hhcGVzID0gc2hhcGVzOwogICAgCQkJaWYgKCBza2VsZXRvbnMubGVuZ3RoID4gMCApIG91dHB1dC5za2VsZXRvbnMgPSBza2VsZXRvbnM7CiAgICAJCQlpZiAoIGFuaW1hdGlvbnMubGVuZ3RoID4gMCApIG91dHB1dC5hbmltYXRpb25zID0gYW5pbWF0aW9uczsKICAgIAkJCWlmICggbm9kZXMubGVuZ3RoID4gMCApIG91dHB1dC5ub2RlcyA9IG5vZGVzOwoKICAgIAkJfQoKICAgIAkJb3V0cHV0Lm9iamVjdCA9IG9iamVjdDsKCiAgICAJCXJldHVybiBvdXRwdXQ7CgogICAgCQkvLyBleHRyYWN0IGRhdGEgZnJvbSB0aGUgY2FjaGUgaGFzaAogICAgCQkvLyByZW1vdmUgbWV0YWRhdGEgb24gZWFjaCBpdGVtCiAgICAJCS8vIGFuZCByZXR1cm4gYXMgYXJyYXkKICAgIAkJZnVuY3Rpb24gZXh0cmFjdEZyb21DYWNoZSggY2FjaGUgKSB7CgogICAgCQkJY29uc3QgdmFsdWVzID0gW107CiAgICAJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgogICAgCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CiAgICAJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CiAgICAJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIHZhbHVlczsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IDNEIG9iamVjdCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbcmVjdXJzaXZlPXRydWVdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBkZXNjZW5kYW50cyBvZiB0aGUgM0Qgb2JqZWN0IGFyZSBhbHNvIGNsb25lZC4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCByZWN1cnNpdmUgKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzLCByZWN1cnNpdmUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gM0Qgb2JqZWN0IHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBzb3VyY2UgLSBUaGUgM0Qgb2JqZWN0IHRvIGNvcHkuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbcmVjdXJzaXZlPXRydWVdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBkZXNjZW5kYW50cyBvZiB0aGUgM0Qgb2JqZWN0IGFyZSBjbG9uZWQuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weSggc291cmNlLCByZWN1cnNpdmUgPSB0cnVlICkgewoKICAgIAkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgogICAgCQl0aGlzLnVwLmNvcHkoIHNvdXJjZS51cCApOwoKICAgIAkJdGhpcy5wb3NpdGlvbi5jb3B5KCBzb3VyY2UucG9zaXRpb24gKTsKICAgIAkJdGhpcy5yb3RhdGlvbi5vcmRlciA9IHNvdXJjZS5yb3RhdGlvbi5vcmRlcjsKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHNvdXJjZS5xdWF0ZXJuaW9uICk7CiAgICAJCXRoaXMuc2NhbGUuY29weSggc291cmNlLnNjYWxlICk7CgogICAgCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CiAgICAJCXRoaXMubWF0cml4V29ybGQuY29weSggc291cmNlLm1hdHJpeFdvcmxkICk7CgogICAgCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCiAgICAJCXRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZTsKICAgIAkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU7CgogICAgCQl0aGlzLmxheWVycy5tYXNrID0gc291cmNlLmxheWVycy5tYXNrOwogICAgCQl0aGlzLnZpc2libGUgPSBzb3VyY2UudmlzaWJsZTsKCiAgICAJCXRoaXMuY2FzdFNoYWRvdyA9IHNvdXJjZS5jYXN0U2hhZG93OwogICAgCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBzb3VyY2UucmVjZWl2ZVNoYWRvdzsKCiAgICAJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHNvdXJjZS5mcnVzdHVtQ3VsbGVkOwogICAgCQl0aGlzLnJlbmRlck9yZGVyID0gc291cmNlLnJlbmRlck9yZGVyOwoKICAgIAkJdGhpcy5hbmltYXRpb25zID0gc291cmNlLmFuaW1hdGlvbnMuc2xpY2UoKTsKCiAgICAJCXRoaXMudXNlckRhdGEgPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeSggc291cmNlLnVzZXJEYXRhICkgKTsKCiAgICAJCWlmICggcmVjdXJzaXZlID09PSB0cnVlICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNvdXJjZS5jaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGNoaWxkID0gc291cmNlLmNoaWxkcmVuWyBpIF07CiAgICAJCQkJdGhpcy5hZGQoIGNoaWxkLmNsb25lKCkgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IHVwIGRpcmVjdGlvbiBmb3Igb2JqZWN0cywgYWxzbyB1c2VkIGFzIHRoZSBkZWZhdWx0CiAgICAgKiBwb3NpdGlvbiBmb3Ige0BsaW5rIERpcmVjdGlvbmFsTGlnaHR9IGFuZCB7QGxpbmsgSGVtaXNwaGVyZUxpZ2h0fS4KICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAdHlwZSB7VmVjdG9yM30KICAgICAqIEBkZWZhdWx0ICgwLDEsMCkKICAgICAqLwogICAgT2JqZWN0M0QuREVGQVVMVF9VUCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IHNldHRpbmcgZm9yIHtAbGluayBPYmplY3QzRCNtYXRyaXhBdXRvVXBkYXRlfSBmb3IKICAgICAqIG5ld2x5IGNyZWF0ZWQgM0Qgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwogICAgT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfQVVUT19VUERBVEUgPSB0cnVlOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgc2V0dGluZyBmb3Ige0BsaW5rIE9iamVjdDNEI21hdHJpeFdvcmxkQXV0b1VwZGF0ZX0gZm9yCiAgICAgKiBuZXdseSBjcmVhdGVkIDNEIG9iamVjdHMuCiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KICAgIE9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFID0gdHJ1ZTsKCiAgICBjb25zdCBfdjAkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92MSQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3YyJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdjMkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfdmFiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ZhYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92YmMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdmFwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ZicCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92Y3AgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX3Y0MCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjQoKTsKICAgIGNvbnN0IF92NDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3I0KCk7CiAgICBjb25zdCBfdjQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yNCgpOwoKICAgIC8qKgogICAgICogQSBnZW9tZXRyaWMgdHJpYW5nbGUgYXMgZGVmaW5lZCBieSB0aHJlZSB2ZWN0b3JzIHJlcHJlc2VudGluZyBpdHMgdGhyZWUgY29ybmVycy4KICAgICAqLwogICAgY2xhc3MgVHJpYW5nbGUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRyaWFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbYT0oMCwwLDApXSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW2I9KDAsMCwwKV0gLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbYz0oMCwwLDApXSAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBhID0gbmV3IFZlY3RvcjMoKSwgYiA9IG5ldyBWZWN0b3IzKCksIGMgPSBuZXcgVmVjdG9yMygpICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMuYSA9IGE7CgogICAgCQkvKioKICAgIAkJICogVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMuYiA9IGI7CgogICAgCQkvKioKICAgIAkJICogVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtWZWN0b3IzfQogICAgCQkgKi8KICAgIAkJdGhpcy5jID0gYzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIHZlY3RvciBvZiBhIHRyaWFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3Mgbm9ybWFsLgogICAgCSAqLwogICAgCXN0YXRpYyBnZXROb3JtYWwoIGEsIGIsIGMsIHRhcmdldCApIHsKCiAgICAJCXRhcmdldC5zdWJWZWN0b3JzKCBjLCBiICk7CiAgICAJCV92MCQxLnN1YlZlY3RvcnMoIGEsIGIgKTsKICAgIAkJdGFyZ2V0LmNyb3NzKCBfdjAkMSApOwoKICAgIAkJY29uc3QgdGFyZ2V0TGVuZ3RoU3EgPSB0YXJnZXQubGVuZ3RoU3EoKTsKICAgIAkJaWYgKCB0YXJnZXRMZW5ndGhTcSA+IDAgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5tdWx0aXBseVNjYWxhciggMSAvIE1hdGguc3FydCggdGFyZ2V0TGVuZ3RoU3EgKSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRhcmdldC5zZXQoIDAsIDAsIDAgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyBhIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZyb20gdGhlIGdpdmVuIHZlY3Rvci4KICAgIAkgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgdHJpYW5nbGUgaXMgZGVnZW5lcmF0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgZm9yIHRoZSBnaXZlbiBwb2ludAogICAgCSAqLwogICAgCXN0YXRpYyBnZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCB0YXJnZXQgKSB7CgogICAgCQkvLyBiYXNlZCBvbjogaHR0cDovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbAoKICAgIAkJX3YwJDEuc3ViVmVjdG9ycyggYywgYSApOwogICAgCQlfdjEkMy5zdWJWZWN0b3JzKCBiLCBhICk7CiAgICAJCV92MiQyLnN1YlZlY3RvcnMoIHBvaW50LCBhICk7CgogICAgCQljb25zdCBkb3QwMCA9IF92MCQxLmRvdCggX3YwJDEgKTsKICAgIAkJY29uc3QgZG90MDEgPSBfdjAkMS5kb3QoIF92MSQzICk7CiAgICAJCWNvbnN0IGRvdDAyID0gX3YwJDEuZG90KCBfdjIkMiApOwogICAgCQljb25zdCBkb3QxMSA9IF92MSQzLmRvdCggX3YxJDMgKTsKICAgIAkJY29uc3QgZG90MTIgPSBfdjEkMy5kb3QoIF92MiQyICk7CgogICAgCQljb25zdCBkZW5vbSA9ICggZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDEgKTsKCiAgICAJCS8vIGNvbGxpbmVhciBvciBzaW5ndWxhciB0cmlhbmdsZQogICAgCQlpZiAoIGRlbm9tID09PSAwICkgewoKICAgIAkJCXRhcmdldC5zZXQoIDAsIDAsIDAgKTsKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJY29uc3QgaW52RGVub20gPSAxIC8gZGVub207CiAgICAJCWNvbnN0IHUgPSAoIGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyICkgKiBpbnZEZW5vbTsKICAgIAkJY29uc3QgdiA9ICggZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIgKSAqIGludkRlbm9tOwoKICAgIAkJLy8gYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgbXVzdCBhbHdheXMgc3VtIHRvIDEKICAgIAkJcmV0dXJuIHRhcmdldC5zZXQoIDEgLSB1IC0gdiwgdiwgdSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBwb2ludCwgd2hlbiBwcm9qZWN0ZWQgb250byB0aGUgcGxhbmUgb2YgdGhlCiAgICAJICogdHJpYW5nbGUsIGxpZXMgd2l0aGluIHRoZSB0cmlhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdGVzdC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQogICAgCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUgb3Igbm90LgogICAgCSAqLwogICAgCXN0YXRpYyBjb250YWluc1BvaW50KCBwb2ludCwgYSwgYiwgYyApIHsKCiAgICAJCS8vIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlIHRoZW4gd2UgY2FuJ3QgY29udGFpbiBhIHBvaW50CiAgICAJCWlmICggdGhpcy5nZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCBfdjMkMiApID09PSBudWxsICkgewoKICAgIAkJCXJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiAoIF92MyQyLnggPj0gMCApICYmICggX3YzJDIueSA+PSAwICkgJiYgKCAoIF92MyQyLnggKyBfdjMkMi55ICkgPD0gMSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSB2YWx1ZSBiYXJ5Y2VudHJpY2FsbHkgaW50ZXJwb2xhdGVkIGZvciB0aGUgZ2l2ZW4gcG9pbnQgb24gdGhlCiAgICAJICogdHJpYW5nbGUuIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFBvc2l0aW9uIG9mIGludGVycG9sYXRlZCBwb2ludC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAxIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwMiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAzIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2MSAtIFZhbHVlIHRvIGludGVycG9sYXRlIG9mIGZpcnN0IHZlcnRleC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYyIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2Ygc2Vjb25kIHZlcnRleC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYzIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgdGhpcmQgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnBvbGF0ZWQgdmFsdWUuCiAgICAJICovCiAgICAJc3RhdGljIGdldEludGVycG9sYXRpb24oIHBvaW50LCBwMSwgcDIsIHAzLCB2MSwgdjIsIHYzLCB0YXJnZXQgKSB7CgogICAgCQlpZiAoIHRoaXMuZ2V0QmFyeWNvb3JkKCBwb2ludCwgcDEsIHAyLCBwMywgX3YzJDIgKSA9PT0gbnVsbCApIHsKCiAgICAJCQl0YXJnZXQueCA9IDA7CiAgICAJCQl0YXJnZXQueSA9IDA7CiAgICAJCQlpZiAoICd6JyBpbiB0YXJnZXQgKSB0YXJnZXQueiA9IDA7CiAgICAJCQlpZiAoICd3JyBpbiB0YXJnZXQgKSB0YXJnZXQudyA9IDA7CiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCXRhcmdldC5zZXRTY2FsYXIoIDAgKTsKICAgIAkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjEsIF92MyQyLnggKTsKICAgIAkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjIsIF92MyQyLnkgKTsKICAgIAkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjMsIF92MyQyLnogKTsKCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHZhbHVlIGJhcnljZW50cmljYWxseSBpbnRlcnBvbGF0ZWQgZm9yIHRoZSBnaXZlbiBhdHRyaWJ1dGUgYW5kIGluZGljZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0ciAtIFRoZSBhdHRyaWJ1dGUgdG8gaW50ZXJwb2xhdGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gSW5kZXggb2YgZmlyc3QgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIEluZGV4IG9mIHNlY29uZCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkzIC0gSW5kZXggb2YgdGhpcmQgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYmFyeWNvb3JkIC0gVGhlIGJhcnljb29yZGluYXRlIHZhbHVlIHRvIHVzZSB0byBpbnRlcnBvbGF0ZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBpbnRlcnBvbGF0ZWQgYXR0cmlidXRlIHZhbHVlLgogICAgCSAqLwogICAgCXN0YXRpYyBnZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIGF0dHIsIGkxLCBpMiwgaTMsIGJhcnljb29yZCwgdGFyZ2V0ICkgewoKICAgIAkJX3Y0MC5zZXRTY2FsYXIoIDAgKTsKICAgIAkJX3Y0MS5zZXRTY2FsYXIoIDAgKTsKICAgIAkJX3Y0Mi5zZXRTY2FsYXIoIDAgKTsKCiAgICAJCV92NDAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0ciwgaTEgKTsKICAgIAkJX3Y0MS5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyLCBpMiApOwogICAgCQlfdjQyLmZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHIsIGkzICk7CgogICAgCQl0YXJnZXQuc2V0U2NhbGFyKCAwICk7CiAgICAJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDAsIGJhcnljb29yZC54ICk7CiAgICAJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDEsIGJhcnljb29yZC55ICk7CiAgICAJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDIsIGJhcnljb29yZC56ICk7CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSB0cmlhbmdsZSBpcyBvcmllbnRlZCB0b3dhcmRzIHRoZSBnaXZlbiBkaXJlY3Rpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBkaXJlY3Rpb24gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdHJpYW5nbGUgaXMgb3JpZW50ZWQgdG93YXJkcyB0aGUgZ2l2ZW4gZGlyZWN0aW9uIG9yIG5vdC4KICAgIAkgKi8KICAgIAlzdGF0aWMgaXNGcm9udEZhY2luZyggYSwgYiwgYywgZGlyZWN0aW9uICkgewoKICAgIAkJX3YwJDEuc3ViVmVjdG9ycyggYywgYiApOwogICAgCQlfdjEkMy5zdWJWZWN0b3JzKCBhLCBiICk7CgogICAgCQkvLyBzdHJpY3RseSBmcm9udCBmYWNpbmcKICAgIAkJcmV0dXJuICggX3YwJDEuY3Jvc3MoIF92MSQzICkuZG90KCBkaXJlY3Rpb24gKSA8IDAgKSA/IHRydWUgOiBmYWxzZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcmV0dXJuIHtUcmlhbmdsZX0gQSByZWZlcmVuY2UgdG8gdGhpcyB0cmlhbmdsZS4KICAgIAkgKi8KICAgIAlzZXQoIGEsIGIsIGMgKSB7CgogICAgCQl0aGlzLmEuY29weSggYSApOwogICAgCQl0aGlzLmIuY29weSggYiApOwogICAgCQl0aGlzLmMuY29weSggYyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdHJpYW5nbGUncyB2ZXJ0aWNlcyBieSBjb3B5aW5nIHRoZSBnaXZlbiBhcnJheSB2YWx1ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBbiBhcnJheSB3aXRoIDNEIHBvaW50cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaTAgLSBUaGUgYXJyYXkgaW5kZXggcmVwcmVzZW50aW5nIHRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpMSAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCiAgICAJICovCiAgICAJc2V0RnJvbVBvaW50c0FuZEluZGljZXMoIHBvaW50cywgaTAsIGkxLCBpMiApIHsKCiAgICAJCXRoaXMuYS5jb3B5KCBwb2ludHNbIGkwIF0gKTsKICAgIAkJdGhpcy5iLmNvcHkoIHBvaW50c1sgaTEgXSApOwogICAgCQl0aGlzLmMuY29weSggcG9pbnRzWyBpMiBdICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIGF0dHJpYnV0ZSB2YWx1ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gQSBidWZmZXIgYXR0cmlidXRlIHdpdGggM0QgcG9pbnRzIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkwIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIFRoZSBhdHRyaWJ1dGUgaW5kZXggcmVwcmVzZW50aW5nIHRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEByZXR1cm4ge1RyaWFuZ2xlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHRyaWFuZ2xlLgogICAgCSAqLwogICAgCXNldEZyb21BdHRyaWJ1dGVBbmRJbmRpY2VzKCBhdHRyaWJ1dGUsIGkwLCBpMSwgaTIgKSB7CgogICAgCQl0aGlzLmEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMCApOwogICAgCQl0aGlzLmIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMSApOwogICAgCQl0aGlzLmMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyB0cmlhbmdsZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VHJpYW5nbGV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdHJpYW5nbGUgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VHJpYW5nbGV9IHRyaWFuZ2xlIC0gVGhlIHRyaWFuZ2xlIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCiAgICAJICovCiAgICAJY29weSggdHJpYW5nbGUgKSB7CgogICAgCQl0aGlzLmEuY29weSggdHJpYW5nbGUuYSApOwogICAgCQl0aGlzLmIuY29weSggdHJpYW5nbGUuYiApOwogICAgCQl0aGlzLmMuY29weSggdHJpYW5nbGUuYyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIGFyZWEgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgdHJpYW5nbGUncyBhcmVhLgogICAgCSAqLwogICAgCWdldEFyZWEoKSB7CgogICAgCQlfdjAkMS5zdWJWZWN0b3JzKCB0aGlzLmMsIHRoaXMuYiApOwogICAgCQlfdjEkMy5zdWJWZWN0b3JzKCB0aGlzLmEsIHRoaXMuYiApOwoKICAgIAkJcmV0dXJuIF92MCQxLmNyb3NzKCBfdjEkMyApLmxlbmd0aCgpICogMC41OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBtaWRwb2ludCBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSB0cmlhbmdsZSdzIG1pZHBvaW50LgogICAgCSAqLwogICAgCWdldE1pZHBvaW50KCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICkuYWRkKCB0aGlzLmMgKS5tdWx0aXBseVNjYWxhciggMSAvIDMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3Mgbm9ybWFsLgogICAgCSAqLwogICAgCWdldE5vcm1hbCggdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIFRyaWFuZ2xlLmdldE5vcm1hbCggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYywgdGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgYSBwbGFuZSB0aGUgdHJpYW5nbGUgbGllcyB3aXRoaW4uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1BsYW5lfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gVGhlIHBsYW5lIHRoZSB0cmlhbmdsZSBsaWVzIHdpdGhpbi4KICAgIAkgKi8KICAgIAlnZXRQbGFuZSggdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIHRhcmdldC5zZXRGcm9tQ29wbGFuYXJQb2ludHMoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyBhIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZyb20gdGhlIGdpdmVuIHZlY3Rvci4KICAgIAkgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgdHJpYW5nbGUgaXMgZGVnZW5lcmF0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyBmb3IgdGhlIGdpdmVuIHBvaW50CiAgICAJICovCiAgICAJZ2V0QmFyeWNvb3JkKCBwb2ludCwgdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIFRyaWFuZ2xlLmdldEJhcnljb29yZCggcG9pbnQsIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSB2YWx1ZSBiYXJ5Y2VudHJpY2FsbHkgaW50ZXJwb2xhdGVkIGZvciB0aGUgZ2l2ZW4gcG9pbnQgb24gdGhlCiAgICAJICogdHJpYW5nbGUuIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFBvc2l0aW9uIG9mIGludGVycG9sYXRlZCBwb2ludC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgZmlyc3QgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjIgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiBzZWNvbmQgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjMgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiB0aGlyZCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVycG9sYXRlZCB2YWx1ZS4KICAgIAkgKi8KICAgIAlnZXRJbnRlcnBvbGF0aW9uKCBwb2ludCwgdjEsIHYyLCB2MywgdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB2MSwgdjIsIHYzLCB0YXJnZXQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQogICAgCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IGluIDNEIHNwYWNlIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQogICAgCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUgb3Igbm90LgogICAgCSAqLwogICAgCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKICAgIAkJcmV0dXJuIFRyaWFuZ2xlLmNvbnRhaW5zUG9pbnQoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gZGlyZWN0aW9uIC0gVGhlIChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbiBvciBub3QuCiAgICAJICovCiAgICAJaXNGcm9udEZhY2luZyggZGlyZWN0aW9uICkgewoKICAgIAkJcmV0dXJuIFRyaWFuZ2xlLmlzRnJvbnRGYWNpbmcoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIGRpcmVjdGlvbiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdHJpYW5nbGUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gaW50ZXJzZWN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0JveCggYm94ICkgewoKICAgIAkJcmV0dXJuIGJveC5pbnRlcnNlY3RzVHJpYW5nbGUoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSB0cmlhbmdsZSB0byB0aGUgZ2l2ZW4gcG9pbnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgY2xvc2VzdCBwb2ludCBmb3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgdHJpYW5nbGUuCiAgICAJICovCiAgICAJY2xvc2VzdFBvaW50VG9Qb2ludCggcCwgdGFyZ2V0ICkgewoKICAgIAkJY29uc3QgYSA9IHRoaXMuYSwgYiA9IHRoaXMuYiwgYyA9IHRoaXMuYzsKICAgIAkJbGV0IHYsIHc7CgogICAgCQkvLyBhbGdvcml0aG0gdGhhbmtzIHRvIFJlYWwtVGltZSBDb2xsaXNpb24gRGV0ZWN0aW9uIGJ5IENocmlzdGVyIEVyaWNzb24sCiAgICAJCS8vIHB1Ymxpc2hlZCBieSBNb3JnYW4gS2F1Zm1hbm4gUHVibGlzaGVycywgKGMpIDIwMDUgRWxzZXZpZXIgSW5jLiwKICAgIAkJLy8gdW5kZXIgdGhlIGFjY29tcGFueWluZyBsaWNlbnNlOyBzZWUgY2hhcHRlciA1LjEuNSBmb3IgZGV0YWlsZWQgZXhwbGFuYXRpb24uCiAgICAJCS8vIGJhc2ljYWxseSwgd2UncmUgZGlzdGluZ3Vpc2hpbmcgd2hpY2ggb2YgdGhlIHZvcm9ub2kgcmVnaW9ucyBvZiB0aGUgdHJpYW5nbGUKICAgIAkJLy8gdGhlIHBvaW50IGxpZXMgaW4gd2l0aCB0aGUgbWluaW11bSBhbW91bnQgb2YgcmVkdW5kYW50IGNvbXB1dGF0aW9uLgoKICAgIAkJX3ZhYi5zdWJWZWN0b3JzKCBiLCBhICk7CiAgICAJCV92YWMuc3ViVmVjdG9ycyggYywgYSApOwogICAgCQlfdmFwLnN1YlZlY3RvcnMoIHAsIGEgKTsKICAgIAkJY29uc3QgZDEgPSBfdmFiLmRvdCggX3ZhcCApOwogICAgCQljb25zdCBkMiA9IF92YWMuZG90KCBfdmFwICk7CiAgICAJCWlmICggZDEgPD0gMCAmJiBkMiA8PSAwICkgewoKICAgIAkJCS8vIHZlcnRleCByZWdpb24gb2YgQTsgYmFyeWNlbnRyaWMgY29vcmRzICgxLCAwLCAwKQogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICk7CgogICAgCQl9CgogICAgCQlfdmJwLnN1YlZlY3RvcnMoIHAsIGIgKTsKICAgIAkJY29uc3QgZDMgPSBfdmFiLmRvdCggX3ZicCApOwogICAgCQljb25zdCBkNCA9IF92YWMuZG90KCBfdmJwICk7CiAgICAJCWlmICggZDMgPj0gMCAmJiBkNCA8PSBkMyApIHsKCiAgICAJCQkvLyB2ZXJ0ZXggcmVnaW9uIG9mIEI7IGJhcnljZW50cmljIGNvb3JkcyAoMCwgMSwgMCkKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggYiApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgdmMgPSBkMSAqIGQ0IC0gZDMgKiBkMjsKICAgIAkJaWYgKCB2YyA8PSAwICYmIGQxID49IDAgJiYgZDMgPD0gMCApIHsKCiAgICAJCQl2ID0gZDEgLyAoIGQxIC0gZDMgKTsKICAgIAkJCS8vIGVkZ2UgcmVnaW9uIG9mIEFCOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDEtdiwgdiwgMCkKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggX3ZhYiwgdiApOwoKICAgIAkJfQoKICAgIAkJX3ZjcC5zdWJWZWN0b3JzKCBwLCBjICk7CiAgICAJCWNvbnN0IGQ1ID0gX3ZhYi5kb3QoIF92Y3AgKTsKICAgIAkJY29uc3QgZDYgPSBfdmFjLmRvdCggX3ZjcCApOwogICAgCQlpZiAoIGQ2ID49IDAgJiYgZDUgPD0gZDYgKSB7CgogICAgCQkJLy8gdmVydGV4IHJlZ2lvbiBvZiBDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDAsIDEpCiAgICAJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGMgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHZiID0gZDUgKiBkMiAtIGQxICogZDY7CiAgICAJCWlmICggdmIgPD0gMCAmJiBkMiA+PSAwICYmIGQ2IDw9IDAgKSB7CgogICAgCQkJdyA9IGQyIC8gKCBkMiAtIGQ2ICk7CiAgICAJCQkvLyBlZGdlIHJlZ2lvbiBvZiBBQzsgYmFyeWNlbnRyaWMgY29vcmRzICgxLXcsIDAsIHcpCiAgICAJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWMsIHcgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHZhID0gZDMgKiBkNiAtIGQ1ICogZDQ7CiAgICAJCWlmICggdmEgPD0gMCAmJiAoIGQ0IC0gZDMgKSA+PSAwICYmICggZDUgLSBkNiApID49IDAgKSB7CgogICAgCQkJX3ZiYy5zdWJWZWN0b3JzKCBjLCBiICk7CiAgICAJCQl3ID0gKCBkNCAtIGQzICkgLyAoICggZDQgLSBkMyApICsgKCBkNSAtIGQ2ICkgKTsKICAgIAkJCS8vIGVkZ2UgcmVnaW9uIG9mIEJDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDEtdywgdykKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggYiApLmFkZFNjYWxlZFZlY3RvciggX3ZiYywgdyApOyAvLyBlZGdlIHJlZ2lvbiBvZiBCQwoKICAgIAkJfQoKICAgIAkJLy8gZmFjZSByZWdpb24KICAgIAkJY29uc3QgZGVub20gPSAxIC8gKCB2YSArIHZiICsgdmMgKTsKICAgIAkJLy8gdSA9IHZhICogZGVub20KICAgIAkJdiA9IHZiICogZGVub207CiAgICAJCXcgPSB2YyAqIGRlbm9tOwoKICAgIAkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFiLCB2ICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFjLCB3ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB0cmlhbmdsZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1RyaWFuZ2xlfSB0cmlhbmdsZSAtIFRoZSB0cmlhbmdsZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdHJpYW5nbGUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggdHJpYW5nbGUgKSB7CgogICAgCQlyZXR1cm4gdHJpYW5nbGUuYS5lcXVhbHMoIHRoaXMuYSApICYmIHRyaWFuZ2xlLmIuZXF1YWxzKCB0aGlzLmIgKSAmJiB0cmlhbmdsZS5jLmVxdWFscyggdGhpcy5jICk7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX2NvbG9yS2V5d29yZHMgPSB7ICdhbGljZWJsdWUnOiAweEYwRjhGRiwgJ2FudGlxdWV3aGl0ZSc6IDB4RkFFQkQ3LCAnYXF1YSc6IDB4MDBGRkZGLCAnYXF1YW1hcmluZSc6IDB4N0ZGRkQ0LCAnYXp1cmUnOiAweEYwRkZGRiwKICAgIAknYmVpZ2UnOiAweEY1RjVEQywgJ2Jpc3F1ZSc6IDB4RkZFNEM0LCAnYmxhY2snOiAweDAwMDAwMCwgJ2JsYW5jaGVkYWxtb25kJzogMHhGRkVCQ0QsICdibHVlJzogMHgwMDAwRkYsICdibHVldmlvbGV0JzogMHg4QTJCRTIsCiAgICAJJ2Jyb3duJzogMHhBNTJBMkEsICdidXJseXdvb2QnOiAweERFQjg4NywgJ2NhZGV0Ymx1ZSc6IDB4NUY5RUEwLCAnY2hhcnRyZXVzZSc6IDB4N0ZGRjAwLCAnY2hvY29sYXRlJzogMHhEMjY5MUUsICdjb3JhbCc6IDB4RkY3RjUwLAogICAgCSdjb3JuZmxvd2VyYmx1ZSc6IDB4NjQ5NUVELCAnY29ybnNpbGsnOiAweEZGRjhEQywgJ2NyaW1zb24nOiAweERDMTQzQywgJ2N5YW4nOiAweDAwRkZGRiwgJ2RhcmtibHVlJzogMHgwMDAwOEIsICdkYXJrY3lhbic6IDB4MDA4QjhCLAogICAgCSdkYXJrZ29sZGVucm9kJzogMHhCODg2MEIsICdkYXJrZ3JheSc6IDB4QTlBOUE5LCAnZGFya2dyZWVuJzogMHgwMDY0MDAsICdkYXJrZ3JleSc6IDB4QTlBOUE5LCAnZGFya2toYWtpJzogMHhCREI3NkIsICdkYXJrbWFnZW50YSc6IDB4OEIwMDhCLAogICAgCSdkYXJrb2xpdmVncmVlbic6IDB4NTU2QjJGLCAnZGFya29yYW5nZSc6IDB4RkY4QzAwLCAnZGFya29yY2hpZCc6IDB4OTkzMkNDLCAnZGFya3JlZCc6IDB4OEIwMDAwLCAnZGFya3NhbG1vbic6IDB4RTk5NjdBLCAnZGFya3NlYWdyZWVuJzogMHg4RkJDOEYsCiAgICAJJ2RhcmtzbGF0ZWJsdWUnOiAweDQ4M0Q4QiwgJ2RhcmtzbGF0ZWdyYXknOiAweDJGNEY0RiwgJ2RhcmtzbGF0ZWdyZXknOiAweDJGNEY0RiwgJ2Rhcmt0dXJxdW9pc2UnOiAweDAwQ0VEMSwgJ2Rhcmt2aW9sZXQnOiAweDk0MDBEMywKICAgIAknZGVlcHBpbmsnOiAweEZGMTQ5MywgJ2RlZXBza3libHVlJzogMHgwMEJGRkYsICdkaW1ncmF5JzogMHg2OTY5NjksICdkaW1ncmV5JzogMHg2OTY5NjksICdkb2RnZXJibHVlJzogMHgxRTkwRkYsICdmaXJlYnJpY2snOiAweEIyMjIyMiwKICAgIAknZmxvcmFsd2hpdGUnOiAweEZGRkFGMCwgJ2ZvcmVzdGdyZWVuJzogMHgyMjhCMjIsICdmdWNoc2lhJzogMHhGRjAwRkYsICdnYWluc2Jvcm8nOiAweERDRENEQywgJ2dob3N0d2hpdGUnOiAweEY4RjhGRiwgJ2dvbGQnOiAweEZGRDcwMCwKICAgIAknZ29sZGVucm9kJzogMHhEQUE1MjAsICdncmF5JzogMHg4MDgwODAsICdncmVlbic6IDB4MDA4MDAwLCAnZ3JlZW55ZWxsb3cnOiAweEFERkYyRiwgJ2dyZXknOiAweDgwODA4MCwgJ2hvbmV5ZGV3JzogMHhGMEZGRjAsICdob3RwaW5rJzogMHhGRjY5QjQsCiAgICAJJ2luZGlhbnJlZCc6IDB4Q0Q1QzVDLCAnaW5kaWdvJzogMHg0QjAwODIsICdpdm9yeSc6IDB4RkZGRkYwLCAna2hha2knOiAweEYwRTY4QywgJ2xhdmVuZGVyJzogMHhFNkU2RkEsICdsYXZlbmRlcmJsdXNoJzogMHhGRkYwRjUsICdsYXduZ3JlZW4nOiAweDdDRkMwMCwKICAgIAknbGVtb25jaGlmZm9uJzogMHhGRkZBQ0QsICdsaWdodGJsdWUnOiAweEFERDhFNiwgJ2xpZ2h0Y29yYWwnOiAweEYwODA4MCwgJ2xpZ2h0Y3lhbic6IDB4RTBGRkZGLCAnbGlnaHRnb2xkZW5yb2R5ZWxsb3cnOiAweEZBRkFEMiwgJ2xpZ2h0Z3JheSc6IDB4RDNEM0QzLAogICAgCSdsaWdodGdyZWVuJzogMHg5MEVFOTAsICdsaWdodGdyZXknOiAweEQzRDNEMywgJ2xpZ2h0cGluayc6IDB4RkZCNkMxLCAnbGlnaHRzYWxtb24nOiAweEZGQTA3QSwgJ2xpZ2h0c2VhZ3JlZW4nOiAweDIwQjJBQSwgJ2xpZ2h0c2t5Ymx1ZSc6IDB4ODdDRUZBLAogICAgCSdsaWdodHNsYXRlZ3JheSc6IDB4Nzc4ODk5LCAnbGlnaHRzbGF0ZWdyZXknOiAweDc3ODg5OSwgJ2xpZ2h0c3RlZWxibHVlJzogMHhCMEM0REUsICdsaWdodHllbGxvdyc6IDB4RkZGRkUwLCAnbGltZSc6IDB4MDBGRjAwLCAnbGltZWdyZWVuJzogMHgzMkNEMzIsCiAgICAJJ2xpbmVuJzogMHhGQUYwRTYsICdtYWdlbnRhJzogMHhGRjAwRkYsICdtYXJvb24nOiAweDgwMDAwMCwgJ21lZGl1bWFxdWFtYXJpbmUnOiAweDY2Q0RBQSwgJ21lZGl1bWJsdWUnOiAweDAwMDBDRCwgJ21lZGl1bW9yY2hpZCc6IDB4QkE1NUQzLAogICAgCSdtZWRpdW1wdXJwbGUnOiAweDkzNzBEQiwgJ21lZGl1bXNlYWdyZWVuJzogMHgzQ0IzNzEsICdtZWRpdW1zbGF0ZWJsdWUnOiAweDdCNjhFRSwgJ21lZGl1bXNwcmluZ2dyZWVuJzogMHgwMEZBOUEsICdtZWRpdW10dXJxdW9pc2UnOiAweDQ4RDFDQywKICAgIAknbWVkaXVtdmlvbGV0cmVkJzogMHhDNzE1ODUsICdtaWRuaWdodGJsdWUnOiAweDE5MTk3MCwgJ21pbnRjcmVhbSc6IDB4RjVGRkZBLCAnbWlzdHlyb3NlJzogMHhGRkU0RTEsICdtb2NjYXNpbic6IDB4RkZFNEI1LCAnbmF2YWpvd2hpdGUnOiAweEZGREVBRCwKICAgIAknbmF2eSc6IDB4MDAwMDgwLCAnb2xkbGFjZSc6IDB4RkRGNUU2LCAnb2xpdmUnOiAweDgwODAwMCwgJ29saXZlZHJhYic6IDB4NkI4RTIzLCAnb3JhbmdlJzogMHhGRkE1MDAsICdvcmFuZ2VyZWQnOiAweEZGNDUwMCwgJ29yY2hpZCc6IDB4REE3MEQ2LAogICAgCSdwYWxlZ29sZGVucm9kJzogMHhFRUU4QUEsICdwYWxlZ3JlZW4nOiAweDk4RkI5OCwgJ3BhbGV0dXJxdW9pc2UnOiAweEFGRUVFRSwgJ3BhbGV2aW9sZXRyZWQnOiAweERCNzA5MywgJ3BhcGF5YXdoaXAnOiAweEZGRUZENSwgJ3BlYWNocHVmZic6IDB4RkZEQUI5LAogICAgCSdwZXJ1JzogMHhDRDg1M0YsICdwaW5rJzogMHhGRkMwQ0IsICdwbHVtJzogMHhEREEwREQsICdwb3dkZXJibHVlJzogMHhCMEUwRTYsICdwdXJwbGUnOiAweDgwMDA4MCwgJ3JlYmVjY2FwdXJwbGUnOiAweDY2MzM5OSwgJ3JlZCc6IDB4RkYwMDAwLCAncm9zeWJyb3duJzogMHhCQzhGOEYsCiAgICAJJ3JveWFsYmx1ZSc6IDB4NDE2OUUxLCAnc2FkZGxlYnJvd24nOiAweDhCNDUxMywgJ3NhbG1vbic6IDB4RkE4MDcyLCAnc2FuZHlicm93bic6IDB4RjRBNDYwLCAnc2VhZ3JlZW4nOiAweDJFOEI1NywgJ3NlYXNoZWxsJzogMHhGRkY1RUUsCiAgICAJJ3NpZW5uYSc6IDB4QTA1MjJELCAnc2lsdmVyJzogMHhDMEMwQzAsICdza3libHVlJzogMHg4N0NFRUIsICdzbGF0ZWJsdWUnOiAweDZBNUFDRCwgJ3NsYXRlZ3JheSc6IDB4NzA4MDkwLCAnc2xhdGVncmV5JzogMHg3MDgwOTAsICdzbm93JzogMHhGRkZBRkEsCiAgICAJJ3NwcmluZ2dyZWVuJzogMHgwMEZGN0YsICdzdGVlbGJsdWUnOiAweDQ2ODJCNCwgJ3Rhbic6IDB4RDJCNDhDLCAndGVhbCc6IDB4MDA4MDgwLCAndGhpc3RsZSc6IDB4RDhCRkQ4LCAndG9tYXRvJzogMHhGRjYzNDcsICd0dXJxdW9pc2UnOiAweDQwRTBEMCwKICAgIAkndmlvbGV0JzogMHhFRTgyRUUsICd3aGVhdCc6IDB4RjVERUIzLCAnd2hpdGUnOiAweEZGRkZGRiwgJ3doaXRlc21va2UnOiAweEY1RjVGNSwgJ3llbGxvdyc6IDB4RkZGRjAwLCAneWVsbG93Z3JlZW4nOiAweDlBQ0QzMiB9OwoKICAgIGNvbnN0IF9oc2xBID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CiAgICBjb25zdCBfaHNsQiA9IHsgaDogMCwgczogMCwgbDogMCB9OwoKICAgIGZ1bmN0aW9uIGh1ZTJyZ2IoIHAsIHEsIHQgKSB7CgogICAgCWlmICggdCA8IDAgKSB0ICs9IDE7CiAgICAJaWYgKCB0ID4gMSApIHQgLT0gMTsKICAgIAlpZiAoIHQgPCAxIC8gNiApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqIHQ7CiAgICAJaWYgKCB0IDwgMSAvIDIgKSByZXR1cm4gcTsKICAgIAlpZiAoIHQgPCAyIC8gMyApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqICggMiAvIDMgLSB0ICk7CiAgICAJcmV0dXJuIHA7CgogICAgfQoKICAgIC8qKgogICAgICogQSBDb2xvciBpbnN0YW5jZSBpcyByZXByZXNlbnRlZCBieSBSR0IgY29tcG9uZW50cyBpbiB0aGUgbGluZWFyIDxpPndvcmtpbmcKICAgICAqIGNvbG9yIHNwYWNlPC9pPiwgd2hpY2ggZGVmYXVsdHMgdG8gYExpbmVhclNSR0JDb2xvclNwYWNlYC4gSW5wdXRzCiAgICAgKiBjb252ZW50aW9uYWxseSB1c2luZyBgU1JHQkNvbG9yU3BhY2VgIChzdWNoIGFzIGhleGFkZWNpbWFscyBhbmQgQ1NTCiAgICAgKiBzdHJpbmdzKSBhcmUgY29udmVydGVkIHRvIHRoZSB3b3JraW5nIGNvbG9yIHNwYWNlIGF1dG9tYXRpY2FsbHkuCiAgICAgKgogICAgICogYGBganMKICAgICAqIC8vIGNvbnZlcnRlZCBhdXRvbWF0aWNhbGx5IGZyb20gU1JHQkNvbG9yU3BhY2UgdG8gTGluZWFyU1JHQkNvbG9yU3BhY2UKICAgICAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0SGV4KCAweDExMjIzMyApOwogICAgICogYGBgCiAgICAgKiBTb3VyY2UgY29sb3Igc3BhY2VzIG1heSBiZSBzcGVjaWZpZWQgZXhwbGljaXRseSwgdG8gZW5zdXJlIGNvcnJlY3QgY29udmVyc2lvbnMuCiAgICAgKiBgYGBqcwogICAgICogLy8gYXNzdW1lZCBhbHJlYWR5IExpbmVhclNSR0JDb2xvclNwYWNlOyBubyBjb252ZXJzaW9uCiAgICAgKiBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQiggMC41LCAwLjUsIDAuNSApOwogICAgICoKICAgICAqIC8vIGNvbnZlcnRlZCBleHBsaWNpdGx5IGZyb20gU1JHQkNvbG9yU3BhY2UgdG8gTGluZWFyU1JHQkNvbG9yU3BhY2UKICAgICAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKCAwLjUsIDAuNSwgMC41LCBTUkdCQ29sb3JTcGFjZSApOwogICAgICogYGBgCiAgICAgKiBJZiBUSFJFRS5Db2xvck1hbmFnZW1lbnQgaXMgZGlzYWJsZWQsIG5vIGNvbnZlcnNpb25zIG9jY3VyLiBGb3IgZGV0YWlscywKICAgICAqIHNlZSA8aT5Db2xvciBtYW5hZ2VtZW50PC9pPi4gSXRlcmF0aW5nIHRocm91Z2ggYSBDb2xvciBpbnN0YW5jZSB3aWxsIHlpZWxkCiAgICAgKiBpdHMgY29tcG9uZW50cyAociwgZywgYikgaW4gdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuIEEgQ29sb3IgY2FuIGJlIGluaXRpYWxpc2VkCiAgICAgKiBpbiBhbnkgb2YgdGhlIGZvbGxvd2luZyB3YXlzOgogICAgICogYGBganMKICAgICAqIC8vZW1wdHkgY29uc3RydWN0b3IgLSB3aWxsIGRlZmF1bHQgd2hpdGUKICAgICAqIGNvbnN0IGNvbG9yMSA9IG5ldyBUSFJFRS5Db2xvcigpOwogICAgICoKICAgICAqIC8vSGV4YWRlY2ltYWwgY29sb3IgKHJlY29tbWVuZGVkKQogICAgICogY29uc3QgY29sb3IyID0gbmV3IFRIUkVFLkNvbG9yKCAweGZmMDAwMCApOwogICAgICoKICAgICAqIC8vUkdCIHN0cmluZwogICAgICogY29uc3QgY29sb3IzID0gbmV3IFRIUkVFLkNvbG9yKCJyZ2IoMjU1LCAwLCAwKSIpOwogICAgICogY29uc3QgY29sb3I0ID0gbmV3IFRIUkVFLkNvbG9yKCJyZ2IoMTAwJSwgMCUsIDAlKSIpOwogICAgICoKICAgICAqIC8vWDExIGNvbG9yIG5hbWUgLSBhbGwgMTQwIGNvbG9yIG5hbWVzIGFyZSBzdXBwb3J0ZWQuCiAgICAgKiAvL05vdGUgdGhlIGxhY2sgb2YgQ2FtZWxDYXNlIGluIHRoZSBuYW1lCiAgICAgKiBjb25zdCBjb2xvcjUgPSBuZXcgVEhSRUUuQ29sb3IoICdza3libHVlJyApOwogICAgICogLy9IU0wgc3RyaW5nCiAgICAgKiBjb25zdCBjb2xvcjYgPSBuZXcgVEhSRUUuQ29sb3IoImhzbCgwLCAxMDAlLCA1MCUpIik7CiAgICAgKgogICAgICogLy9TZXBhcmF0ZSBSR0IgdmFsdWVzIGJldHdlZW4gMCBhbmQgMQogICAgICogY29uc3QgY29sb3I3ID0gbmV3IFRIUkVFLkNvbG9yKCAxLCAwLCAwICk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgQ29sb3IgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbG9yLgogICAgCSAqCiAgICAJICogTm90ZSB0aGF0IHN0YW5kYXJkIG1ldGhvZCBvZiBzcGVjaWZ5aW5nIGNvbG9yIGluIHRocmVlLmpzIGlzIHdpdGggYSBoZXhhZGVjaW1hbCB0cmlwbGV0LAogICAgCSAqIGFuZCB0aGF0IG1ldGhvZCBpcyB1c2VkIHRocm91Z2hvdXQgdGhlIHJlc3Qgb2YgdGhlIGRvY3VtZW50YXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhudW1iZXJ8c3RyaW5nfENvbG9yKX0gW3JdIC0gVGhlIHJlZCBjb21wb25lbnQgb2YgdGhlIGNvbG9yLiBJZiBgZ2AgYW5kIGBiYCBhcmUKICAgIAkgKiBub3QgcHJvdmlkZWQsIGl0IGNhbiBiZSBoZXhhZGVjaW1hbCB0cmlwbGV0LCBhIENTUy1zdHlsZSBzdHJpbmcgb3IgYW5vdGhlciBgQ29sb3JgIGluc3RhbmNlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZ10gLSBUaGUgZ3JlZW4gY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbYl0gLSBUaGUgYmx1ZSBjb21wb25lbnQuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHIsIGcsIGIgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0NvbG9yID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgcmVkIGNvbXBvbmVudC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5yID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZ3JlZW4gY29tcG9uZW50LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLmcgPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBibHVlIGNvbXBvbmVudC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5iID0gMTsKCiAgICAJCXJldHVybiB0aGlzLnNldCggciwgZywgYiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGNvbG9ycydzIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHsobnVtYmVyfHN0cmluZ3xDb2xvcil9IFtyXSAtIFRoZSByZWQgY29tcG9uZW50IG9mIHRoZSBjb2xvci4gSWYgYGdgIGFuZCBgYmAgYXJlCiAgICAJICogbm90IHByb3ZpZGVkLCBpdCBjYW4gYmUgaGV4YWRlY2ltYWwgdHJpcGxldCwgYSBDU1Mtc3R5bGUgc3RyaW5nIG9yIGFub3RoZXIgYENvbG9yYCBpbnN0YW5jZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2ddIC0gVGhlIGdyZWVuIGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2JdIC0gVGhlIGJsdWUgY29tcG9uZW50LgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXNldCggciwgZywgYiApIHsKCiAgICAJCWlmICggZyA9PT0gdW5kZWZpbmVkICYmIGIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkvLyByIGlzIFRIUkVFLkNvbG9yLCBoZXggb3Igc3RyaW5nCgogICAgCQkJY29uc3QgdmFsdWUgPSByOwoKICAgIAkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNDb2xvciApIHsKCiAgICAJCQkJdGhpcy5jb3B5KCB2YWx1ZSApOwoKICAgIAkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgKSB7CgogICAgCQkJCXRoaXMuc2V0SGV4KCB2YWx1ZSApOwoKICAgIAkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgKSB7CgogICAgCQkJCXRoaXMuc2V0U3R5bGUoIHZhbHVlICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aGlzLnNldFJHQiggciwgZywgYiApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29sb3JzJ3MgY29tcG9uZW50cyB0byB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnIgPSBzY2FsYXI7CiAgICAJCXRoaXMuZyA9IHNjYWxhcjsKICAgIAkJdGhpcy5iID0gc2NhbGFyOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gYSBoZXhhZGVjaW1hbCB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBoZXggLSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlzZXRIZXgoIGhleCwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKICAgIAkJaGV4ID0gTWF0aC5mbG9vciggaGV4ICk7CgogICAgCQl0aGlzLnIgPSAoIGhleCA+PiAxNiAmIDI1NSApIC8gMjU1OwogICAgCQl0aGlzLmcgPSAoIGhleCA+PiA4ICYgMjU1ICkgLyAyNTU7CiAgICAJCXRoaXMuYiA9ICggaGV4ICYgMjU1ICkgLyAyNTU7CgogICAgCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gUkdCIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSByIC0gUmVkIGNoYW5uZWwgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGcgLSBHcmVlbiBjaGFubmVsIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBiIC0gQmx1ZSBjaGFubmVsIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXNldFJHQiggciwgZywgYiwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCiAgICAJCXRoaXMuciA9IHI7CiAgICAJCXRoaXMuZyA9IGc7CiAgICAJCXRoaXMuYiA9IGI7CgogICAgCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gUkdCIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBoIC0gSHVlIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gU2F0dXJhdGlvbiB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbCAtIExpZ2h0bmVzcyB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Q29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlzZXRIU0woIGgsIHMsIGwsIGNvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKSB7CgogICAgCQkvLyBoLHMsbCByYW5nZXMgYXJlIGluIDAuMCAtIDEuMAogICAgCQloID0gZXVjbGlkZWFuTW9kdWxvKCBoLCAxICk7CiAgICAJCXMgPSBjbGFtcCggcywgMCwgMSApOwogICAgCQlsID0gY2xhbXAoIGwsIDAsIDEgKTsKCiAgICAJCWlmICggcyA9PT0gMCApIHsKCiAgICAJCQl0aGlzLnIgPSB0aGlzLmcgPSB0aGlzLmIgPSBsOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zdCBwID0gbCA8PSAwLjUgPyBsICogKCAxICsgcyApIDogbCArIHMgLSAoIGwgKiBzICk7CiAgICAJCQljb25zdCBxID0gKCAyICogbCApIC0gcDsKCiAgICAJCQl0aGlzLnIgPSBodWUycmdiKCBxLCBwLCBoICsgMSAvIDMgKTsKICAgIAkJCXRoaXMuZyA9IGh1ZTJyZ2IoIHEsIHAsIGggKTsKICAgIAkJCXRoaXMuYiA9IGh1ZTJyZ2IoIHEsIHAsIGggLSAxIC8gMyApOwoKICAgIAkJfQoKICAgIAkJQ29sb3JNYW5hZ2VtZW50LmNvbG9yU3BhY2VUb1dvcmtpbmcoIHRoaXMsIGNvbG9yU3BhY2UgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBjb2xvciBmcm9tIGEgQ1NTLXN0eWxlIHN0cmluZy4gRm9yIGV4YW1wbGUsIGByZ2IoMjUwLCAwLDApYCwKICAgIAkgKiBgcmdiKDEwMCUsIDAlLCAwJSlgLCBgaHNsKDAsIDEwMCUsIDUwJSlgLCBgI2ZmMDAwMGAsIGAjZjAwYCwgb3IgYHJlZGAgKCBvcgogICAgCSAqIGFueSBbWDExIGNvbG9yIG5hbWVde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1gxMV9jb2xvcl9uYW1lcyNDb2xvcl9uYW1lX2NoYXJ0fSAtCiAgICAJICogYWxsIDE0MCBjb2xvciBuYW1lcyBhcmUgc3VwcG9ydGVkKS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZSAtIENvbG9yIGFzIGEgQ1NTLXN0eWxlIHN0cmluZy4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXNldFN0eWxlKCBzdHlsZSwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKICAgIAkJZnVuY3Rpb24gaGFuZGxlQWxwaGEoIHN0cmluZyApIHsKCiAgICAJCQlpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJCWlmICggcGFyc2VGbG9hdCggc3RyaW5nICkgPCAxICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogQWxwaGEgY29tcG9uZW50IG9mICcgKyBzdHlsZSArICcgd2lsbCBiZSBpZ25vcmVkLicgKTsKCiAgICAJCQl9CgogICAgCQl9CgoKICAgIAkJbGV0IG07CgogICAgCQlpZiAoIG0gPSAvXihcdyspXCgoW15cKV0qKVwpLy5leGVjKCBzdHlsZSApICkgewoKICAgIAkJCS8vIHJnYiAvIGhzbAoKICAgIAkJCWxldCBjb2xvcjsKICAgIAkJCWNvbnN0IG5hbWUgPSBtWyAxIF07CiAgICAJCQljb25zdCBjb21wb25lbnRzID0gbVsgMiBdOwoKICAgIAkJCXN3aXRjaCAoIG5hbWUgKSB7CgogICAgCQkJCWNhc2UgJ3JnYic6CiAgICAJCQkJY2FzZSAncmdiYSc6CgogICAgCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVxzKixccyooXGQrKVxzKixccyooXGQrKVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKICAgIAkJCQkJCS8vIHJnYigyNTUsMCwwKSByZ2JhKDI1NSwwLDAsMC41KQoKICAgIAkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgogICAgCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAogICAgCQkJCQkJCU1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMSBdLCAxMCApICkgLyAyNTUsCiAgICAJCQkJCQkJTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDI1NSwKICAgIAkJCQkJCQlNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMjU1LAogICAgCQkJCQkJCWNvbG9yU3BhY2UKICAgIAkJCQkJCSk7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVwlXHMqLFxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKICAgIAkJCQkJCS8vIHJnYigxMDAlLDAlLDAlKSByZ2JhKDEwMCUsMCUsMCUsMC41KQoKICAgIAkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgogICAgCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAogICAgCQkJCQkJCU1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMSBdLCAxMCApICkgLyAxMDAsCiAgICAJCQkJCQkJTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDEwMCwKICAgIAkJCQkJCQlNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMTAwLAogICAgCQkJCQkJCWNvbG9yU3BhY2UKICAgIAkJCQkJCSk7CgogICAgCQkJCQl9CgogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSAnaHNsJzoKICAgIAkJCQljYXNlICdoc2xhJzoKCiAgICAJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCpcLj9cZCspXHMqLFxzKihcZCpcLj9cZCspXCVccyosXHMqKFxkKlwuP1xkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKICAgIAkJCQkJCS8vIGhzbCgxMjAsNTAlLDUwJSkgaHNsYSgxMjAsNTAlLDUwJSwwLjUpCgogICAgCQkJCQkJaGFuZGxlQWxwaGEoIGNvbG9yWyA0IF0gKTsKCiAgICAJCQkJCQlyZXR1cm4gdGhpcy5zZXRIU0woCiAgICAJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDEgXSApIC8gMzYwLAogICAgCQkJCQkJCXBhcnNlRmxvYXQoIGNvbG9yWyAyIF0gKSAvIDEwMCwKICAgIAkJCQkJCQlwYXJzZUZsb2F0KCBjb2xvclsgMyBdICkgLyAxMDAsCiAgICAJCQkJCQkJY29sb3JTcGFjZQogICAgCQkJCQkJKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQlkZWZhdWx0OgoKICAgIAkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgbW9kZWwgJyArIHN0eWxlICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIGlmICggbSA9IC9eXCMoW0EtRmEtZlxkXSspJC8uZXhlYyggc3R5bGUgKSApIHsKCiAgICAJCQkvLyBoZXggY29sb3IKCiAgICAJCQljb25zdCBoZXggPSBtWyAxIF07CiAgICAJCQljb25zdCBzaXplID0gaGV4Lmxlbmd0aDsKCiAgICAJCQlpZiAoIHNpemUgPT09IDMgKSB7CgogICAgCQkJCS8vICNmZjAKICAgIAkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCiAgICAJCQkJCXBhcnNlSW50KCBoZXguY2hhckF0KCAwICksIDE2ICkgLyAxNSwKICAgIAkJCQkJcGFyc2VJbnQoIGhleC5jaGFyQXQoIDEgKSwgMTYgKSAvIDE1LAogICAgCQkJCQlwYXJzZUludCggaGV4LmNoYXJBdCggMiApLCAxNiApIC8gMTUsCiAgICAJCQkJCWNvbG9yU3BhY2UKICAgIAkJCQkpOwoKICAgIAkJCX0gZWxzZSBpZiAoIHNpemUgPT09IDYgKSB7CgogICAgCQkJCS8vICNmZjAwMDAKICAgIAkJCQlyZXR1cm4gdGhpcy5zZXRIZXgoIHBhcnNlSW50KCBoZXgsIDE2ICksIGNvbG9yU3BhY2UgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogSW52YWxpZCBoZXggY29sb3IgJyArIHN0eWxlICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIGlmICggc3R5bGUgJiYgc3R5bGUubGVuZ3RoID4gMCApIHsKCiAgICAJCQlyZXR1cm4gdGhpcy5zZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgY29sb3IgZnJvbSBhIGNvbG9yIG5hbWUuIEZhc3RlciB0aGFuIHtAbGluayBDb2xvciNzZXRTdHlsZX0gaWYKICAgIAkgKiB5b3UgZG9uJ3QgbmVlZCB0aGUgb3RoZXIgQ1NTLXN0eWxlIGZvcm1hdHMuCiAgICAJICoKICAgIAkgKiBGb3IgY29udmVuaWVuY2UsIHRoZSBsaXN0IG9mIG5hbWVzIGlzIGV4cG9zZWQgaW4gYENvbG9yLk5BTUVTYCBhcyBhIGhhc2guCiAgICAJICogYGBganMKICAgIAkgKiBDb2xvci5OQU1FUy5hbGljZWJsdWUgLy8gcmV0dXJucyAweEYwRjhGRgogICAgCSAqIGBgYAogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlIC0gVGhlIGNvbG9yIG5hbWUuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlzZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgogICAgCQkvLyBjb2xvciBrZXl3b3JkcwogICAgCQljb25zdCBoZXggPSBfY29sb3JLZXl3b3Jkc1sgc3R5bGUudG9Mb3dlckNhc2UoKSBdOwoKICAgIAkJaWYgKCBoZXggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkvLyByZWQKICAgIAkJCXRoaXMuc2V0SGV4KCBoZXgsIGNvbG9yU3BhY2UgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJLy8gdW5rbm93biBjb2xvcgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgJyArIHN0eWxlICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IGNvbG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLnIsIHRoaXMuZywgdGhpcy5iICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWNvcHkoIGNvbG9yICkgewoKICAgIAkJdGhpcy5yID0gY29sb3IucjsKICAgIAkJdGhpcy5nID0gY29sb3IuZzsKICAgIAkJdGhpcy5iID0gY29sb3IuYjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgZ2l2ZW4gY29sb3IgaW50byB0aGlzIGNvbG9yLCBhbmQgdGhlbiBjb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20KICAgIAkgKiBgU1JHQkNvbG9yU3BhY2VgIHRvIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb3B5L2NvbnZlcnQuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJY29weVNSR0JUb0xpbmVhciggY29sb3IgKSB7CgogICAgCQl0aGlzLnIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLnIgKTsKICAgIAkJdGhpcy5nID0gU1JHQlRvTGluZWFyKCBjb2xvci5nICk7CiAgICAJCXRoaXMuYiA9IFNSR0JUb0xpbmVhciggY29sb3IuYiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSBnaXZlbiBjb2xvciBpbnRvIHRoaXMgY29sb3IsIGFuZCB0aGVuIGNvbnZlcnRzIHRoaXMgY29sb3IgZnJvbQogICAgCSAqIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAgdG8gYFNSR0JDb2xvclNwYWNlYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvcHkvY29udmVydC4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAljb3B5TGluZWFyVG9TUkdCKCBjb2xvciApIHsKCiAgICAJCXRoaXMuciA9IExpbmVhclRvU1JHQiggY29sb3IuciApOwogICAgCQl0aGlzLmcgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmcgKTsKICAgIAkJdGhpcy5iID0gTGluZWFyVG9TUkdCKCBjb2xvci5iICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20gYFNSR0JDb2xvclNwYWNlYCB0byBgTGluZWFyU1JHQkNvbG9yU3BhY2VgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJY29udmVydFNSR0JUb0xpbmVhcigpIHsKCiAgICAJCXRoaXMuY29weVNSR0JUb0xpbmVhciggdGhpcyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhpcyBjb2xvciBmcm9tIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAgdG8gYFNSR0JDb2xvclNwYWNlYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWNvbnZlcnRMaW5lYXJUb1NSR0IoKSB7CgogICAgCQl0aGlzLmNvcHlMaW5lYXJUb1NSR0IoIHRoaXMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGhleGFkZWNpbWFsIHZhbHVlIG9mIHRoaXMgY29sb3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGhleGFkZWNpbWFsIHZhbHVlLgogICAgCSAqLwogICAgCWdldEhleCggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKICAgIAkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCiAgICAJCXJldHVybiBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLnIgKiAyNTUsIDAsIDI1NSApICkgKiA2NTUzNiArIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuZyAqIDI1NSwgMCwgMjU1ICkgKSAqIDI1NiArIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuYiAqIDI1NSwgMCwgMjU1ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBoZXhhZGVjaW1hbCB2YWx1ZSBvZiB0aGlzIGNvbG9yIGFzIGEgc3RyaW5nIChmb3IgZXhhbXBsZSwgJ0ZGRkZGRicpLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBoZXhhZGVjaW1hbCB2YWx1ZSBhcyBhIHN0cmluZy4KICAgIAkgKi8KICAgIAlnZXRIZXhTdHJpbmcoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCiAgICAJCXJldHVybiAoICcwMDAwMDAnICsgdGhpcy5nZXRIZXgoIGNvbG9yU3BhY2UgKS50b1N0cmluZyggMTYgKSApLnNsaWNlKCAtNiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbnZlcnRzIHRoZSBjb2xvcnMgUkdCIHZhbHVlcyBpbnRvIHRoZSBIU0wgZm9ybWF0IGFuZCBzdG9yZXMgdGhlbSBpbnRvIHRoZQogICAgCSAqIGdpdmVuIHRhcmdldCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3toOm51bWJlcixzOm51bWJlcixsOm51bWJlcn19IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge3toOm51bWJlcixzOm51bWJlcixsOm51bWJlcn19IFRoZSBIU0wgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlnZXRIU0woIHRhcmdldCwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCiAgICAJCS8vIGgscyxsIHJhbmdlcyBhcmUgaW4gMC4wIC0gMS4wCgogICAgCQlDb2xvck1hbmFnZW1lbnQud29ya2luZ1RvQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKICAgIAkJY29uc3QgciA9IF9jb2xvci5yLCBnID0gX2NvbG9yLmcsIGIgPSBfY29sb3IuYjsKCiAgICAJCWNvbnN0IG1heCA9IE1hdGgubWF4KCByLCBnLCBiICk7CiAgICAJCWNvbnN0IG1pbiA9IE1hdGgubWluKCByLCBnLCBiICk7CgogICAgCQlsZXQgaHVlLCBzYXR1cmF0aW9uOwogICAgCQljb25zdCBsaWdodG5lc3MgPSAoIG1pbiArIG1heCApIC8gMi4wOwoKICAgIAkJaWYgKCBtaW4gPT09IG1heCApIHsKCiAgICAJCQlodWUgPSAwOwogICAgCQkJc2F0dXJhdGlvbiA9IDA7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnN0IGRlbHRhID0gbWF4IC0gbWluOwoKICAgIAkJCXNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAoIG1heCArIG1pbiApIDogZGVsdGEgLyAoIDIgLSBtYXggLSBtaW4gKTsKCiAgICAJCQlzd2l0Y2ggKCBtYXggKSB7CgogICAgCQkJCWNhc2UgcjogaHVlID0gKCBnIC0gYiApIC8gZGVsdGEgKyAoIGcgPCBiID8gNiA6IDAgKTsgYnJlYWs7CiAgICAJCQkJY2FzZSBnOiBodWUgPSAoIGIgLSByICkgLyBkZWx0YSArIDI7IGJyZWFrOwogICAgCQkJCWNhc2UgYjogaHVlID0gKCByIC0gZyApIC8gZGVsdGEgKyA0OyBicmVhazsKCiAgICAJCQl9CgogICAgCQkJaHVlIC89IDY7CgogICAgCQl9CgogICAgCQl0YXJnZXQuaCA9IGh1ZTsKICAgIAkJdGFyZ2V0LnMgPSBzYXR1cmF0aW9uOwogICAgCQl0YXJnZXQubCA9IGxpZ2h0bmVzczsKCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yIGFuZCBzdG9yZXMgdGhlbSBpbnRvIHRoZSBnaXZlbiB0YXJnZXQgb2JqZWN0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gdGFyZ2V0IC0gVGhlIHRhcmdldCBjb2xvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Q29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gVGhlIFJHQiByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWdldFJHQiggdGFyZ2V0LCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKICAgIAkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCiAgICAJCXRhcmdldC5yID0gX2NvbG9yLnI7CiAgICAJCXRhcmdldC5nID0gX2NvbG9yLmc7CiAgICAJCXRhcmdldC5iID0gX2NvbG9yLmI7CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoaXMgY29sb3IgYXMgYSBDU1Mgc3R5bGUgc3RyaW5nLiBFeGFtcGxlOiBgcmdiKDI1NSwwLDApYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1TUkdCQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCiAgICAJICogQHJldHVybiB7c3RyaW5nfSBUaGUgQ1NTIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJZ2V0U3R5bGUoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCiAgICAJCUNvbG9yTWFuYWdlbWVudC53b3JraW5nVG9Db2xvclNwYWNlKCBfY29sb3IuY29weSggdGhpcyApLCBjb2xvclNwYWNlICk7CgogICAgCQljb25zdCByID0gX2NvbG9yLnIsIGcgPSBfY29sb3IuZywgYiA9IF9jb2xvci5iOwoKICAgIAkJaWYgKCBjb2xvclNwYWNlICE9PSBTUkdCQ29sb3JTcGFjZSApIHsKCiAgICAJCQkvLyBSZXF1aXJlcyBDU1MgQ29sb3IgTW9kdWxlIExldmVsIDQgKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtY29sb3ItNC8pLgogICAgCQkJcmV0dXJuIGBjb2xvcigkeyBjb2xvclNwYWNlIH0gJHsgci50b0ZpeGVkKCAzICkgfSAkeyBnLnRvRml4ZWQoIDMgKSB9ICR7IGIudG9GaXhlZCggMyApIH0pYDsKCiAgICAJCX0KCiAgICAJCXJldHVybiBgcmdiKCR7IE1hdGgucm91bmQoIHIgKiAyNTUgKSB9LCR7IE1hdGgucm91bmQoIGcgKiAyNTUgKSB9LCR7IE1hdGgucm91bmQoIGIgKiAyNTUgKSB9KWA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gSFNMIHZhbHVlcyB0byB0aGlzIGNvbG9yJ3MgdmFsdWVzLgogICAgCSAqIEludGVybmFsbHksIHRoaXMgY29udmVydHMgdGhlIGNvbG9yJ3MgUkdCIHZhbHVlcyB0byBIU0wsIGFkZHMgSFNMCiAgICAJICogYW5kIHRoZW4gY29udmVydHMgdGhlIGNvbG9yIGJhY2sgdG8gUkdCLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGggLSBIdWUgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBTYXR1cmF0aW9uIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsIC0gTGlnaHRuZXNzIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCW9mZnNldEhTTCggaCwgcywgbCApIHsKCiAgICAJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoKICAgIAkJcmV0dXJuIHRoaXMuc2V0SFNMKCBfaHNsQS5oICsgaCwgX2hzbEEucyArIHMsIF9oc2xBLmwgKyBsICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3IgdG8gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGFkZC4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlhZGQoIGNvbG9yICkgewoKICAgIAkJdGhpcy5yICs9IGNvbG9yLnI7CiAgICAJCXRoaXMuZyArPSBjb2xvci5nOwogICAgCQl0aGlzLmIgKz0gY29sb3IuYjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIFJHQiB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMSAtIFRoZSBmaXJzdCBjb2xvci4KICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvcjIgLSBUaGUgc2Vjb25kIGNvbG9yLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWFkZENvbG9ycyggY29sb3IxLCBjb2xvcjIgKSB7CgogICAgCQl0aGlzLnIgPSBjb2xvcjEuciArIGNvbG9yMi5yOwogICAgCQl0aGlzLmcgPSBjb2xvcjEuZyArIGNvbG9yMi5nOwogICAgCQl0aGlzLmIgPSBjb2xvcjEuYiArIGNvbG9yMi5iOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWFkZFNjYWxhciggcyApIHsKCiAgICAJCXRoaXMuciArPSBzOwogICAgCQl0aGlzLmcgKz0gczsKICAgIAkJdGhpcy5iICs9IHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdWJ0cmFjdHMgdGhlIFJHQiB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9yIGZyb20gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIHN1YnRyYWN0LgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXN1YiggY29sb3IgKSB7CgogICAgCQl0aGlzLnIgPSBNYXRoLm1heCggMCwgdGhpcy5yIC0gY29sb3IuciApOwogICAgCQl0aGlzLmcgPSBNYXRoLm1heCggMCwgdGhpcy5nIC0gY29sb3IuZyApOwogICAgCQl0aGlzLmIgPSBNYXRoLm1heCggMCwgdGhpcy5iIC0gY29sb3IuYiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3Igd2l0aCB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gbXVsdGlwbHkuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJbXVsdGlwbHkoIGNvbG9yICkgewoKICAgIAkJdGhpcy5yICo9IGNvbG9yLnI7CiAgICAJCXRoaXMuZyAqPSBjb2xvci5nOwogICAgCQl0aGlzLmIgKj0gY29sb3IuYjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gbXVsdGlwbHkuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgogICAgCQl0aGlzLnIgKj0gczsKICAgIAkJdGhpcy5nICo9IHM7CiAgICAJCXRoaXMuYiAqPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIHRoaXMgY29sb3IncyBSR0IgdmFsdWVzIHRvd2FyZCB0aGUgUkdCIHZhbHVlcyBvZiB0aGUKICAgIAkgKiBnaXZlbiBjb2xvci4gVGhlIGFscGhhIGFyZ3VtZW50IGNhbiBiZSB0aG91Z2h0IG9mIGFzIHRoZSByYXRpbyBiZXR3ZWVuCiAgICAJICogdGhlIHR3byBjb2xvcnMsIHdoZXJlIGAwLjBgIGlzIHRoaXMgY29sb3IgYW5kIGAxLjBgIGlzIHRoZSBmaXJzdCBhcmd1bWVudC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvbnZlcmdlIG9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJbGVycCggY29sb3IsIGFscGhhICkgewoKICAgIAkJdGhpcy5yICs9ICggY29sb3IuciAtIHRoaXMuciApICogYWxwaGE7CiAgICAJCXRoaXMuZyArPSAoIGNvbG9yLmcgLSB0aGlzLmcgKSAqIGFscGhhOwogICAgCQl0aGlzLmIgKz0gKCBjb2xvci5iIC0gdGhpcy5iICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiBjb2xvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCiAgICAJICogVGhlIGFscGhhIGFyZ3VtZW50IGNhbiBiZSB0aG91Z2h0IG9mIGFzIHRoZSByYXRpbyBiZXR3ZWVuIHRoZSB0d28gY29sb3JzLCB3aGVyZSBgMC4wYAogICAgCSAqIGlzIHRoZSBmaXJzdCBhbmQgYDEuMGAgaXMgdGhlIHNlY29uZCBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMSAtIFRoZSBmaXJzdCBjb2xvci4KICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvcjIgLSBUaGUgc2Vjb25kIGNvbG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJbGVycENvbG9ycyggY29sb3IxLCBjb2xvcjIsIGFscGhhICkgewoKICAgIAkJdGhpcy5yID0gY29sb3IxLnIgKyAoIGNvbG9yMi5yIC0gY29sb3IxLnIgKSAqIGFscGhhOwogICAgCQl0aGlzLmcgPSBjb2xvcjEuZyArICggY29sb3IyLmcgLSBjb2xvcjEuZyApICogYWxwaGE7CiAgICAJCXRoaXMuYiA9IGNvbG9yMS5iICsgKCBjb2xvcjIuYiAtIGNvbG9yMS5iICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyB0aGlzIGNvbG9yJ3MgSFNMIHZhbHVlcyB0b3dhcmQgdGhlIEhTTCB2YWx1ZXMgb2YgdGhlCiAgICAJICogZ2l2ZW4gY29sb3IuIEl0IGRpZmZlcnMgZnJvbSB7QGxpbmsgQ29sb3IjbGVycH0gYnkgbm90IGludGVycG9sYXRpbmcgc3RyYWlnaHQKICAgIAkgKiBmcm9tIG9uZSBjb2xvciB0byB0aGUgb3RoZXIsIGJ1dCBpbnN0ZWFkIGdvaW5nIHRocm91Z2ggYWxsIHRoZSBodWVzIGluIGJldHdlZW4KICAgIAkgKiB0aG9zZSB0d28gY29sb3JzLiBUaGUgYWxwaGEgYXJndW1lbnQgY2FuIGJlIHRob3VnaHQgb2YgYXMgdGhlIHJhdGlvIGJldHdlZW4KICAgIAkgKiB0aGUgdHdvIGNvbG9ycywgd2hlcmUgMC4wIGlzIHRoaXMgY29sb3IgYW5kIDEuMCBpcyB0aGUgZmlyc3QgYXJndW1lbnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb252ZXJnZSBvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsMV1gLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWxlcnBIU0woIGNvbG9yLCBhbHBoYSApIHsKCiAgICAJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwogICAgCQljb2xvci5nZXRIU0woIF9oc2xCICk7CgogICAgCQljb25zdCBoID0gbGVycCggX2hzbEEuaCwgX2hzbEIuaCwgYWxwaGEgKTsKICAgIAkJY29uc3QgcyA9IGxlcnAoIF9oc2xBLnMsIF9oc2xCLnMsIGFscGhhICk7CiAgICAJCWNvbnN0IGwgPSBsZXJwKCBfaHNsQS5sLCBfaHNsQi5sLCBhbHBoYSApOwoKICAgIAkJdGhpcy5zZXRIU0woIGgsIHMsIGwgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGNvbG9yJ3MgUkdCIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gM0QgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBzZXQuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJc2V0RnJvbVZlY3RvcjMoIHYgKSB7CgogICAgCQl0aGlzLnIgPSB2Lng7CiAgICAJCXRoaXMuZyA9IHYueTsKICAgIAkJdGhpcy5iID0gdi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNmb3JtcyB0aGlzIGNvbG9yIHdpdGggdGhlIGdpdmVuIDN4MyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4MyggbSApIHsKCiAgICAJCWNvbnN0IHIgPSB0aGlzLnIsIGcgPSB0aGlzLmcsIGIgPSB0aGlzLmI7CiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy5yID0gZVsgMCBdICogciArIGVbIDMgXSAqIGcgKyBlWyA2IF0gKiBiOwogICAgCQl0aGlzLmcgPSBlWyAxIF0gKiByICsgZVsgNCBdICogZyArIGVbIDcgXSAqIGI7CiAgICAJCXRoaXMuYiA9IGVbIDIgXSAqIHIgKyBlWyA1IF0gKiBnICsgZVsgOCBdICogYjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgY29sb3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gYyAtIFRoZSBjb2xvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgY29sb3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggYyApIHsKCiAgICAJCXJldHVybiAoIGMuciA9PT0gdGhpcy5yICkgJiYgKCBjLmcgPT09IHRoaXMuZyApICYmICggYy5iID09PSB0aGlzLmIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgY29sb3IncyBSR0IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBhcnJheS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSBSR0IgdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKICAgIAkJdGhpcy5yID0gYXJyYXlbIG9mZnNldCBdOwogICAgCQl0aGlzLmcgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwogICAgCQl0aGlzLmIgPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV3JpdGVzIHRoZSBSR0IgY29tcG9uZW50cyBvZiB0aGlzIGNvbG9yIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBjb2xvciBjb21wb25lbnRzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBjb2xvciBjb21wb25lbnRzLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLnI7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLmc7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLmI7CgogICAgCQlyZXR1cm4gYXJyYXk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIGNvbG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyBjb2xvciBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCiAgICAJCXRoaXMuciA9IGF0dHJpYnV0ZS5nZXRYKCBpbmRleCApOwogICAgCQl0aGlzLmcgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKICAgIAkJdGhpcy5iID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGlzIG1ldGhvZHMgZGVmaW5lcyB0aGUgc2VyaWFsaXphdGlvbiByZXN1bHQgb2YgdGhpcyBjbGFzcy4gUmV0dXJucyB0aGUgY29sb3IKICAgIAkgKiBhcyBhIGhleGFkZWNpbWFsIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCiAgICAJICovCiAgICAJdG9KU09OKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuZ2V0SGV4KCk7CgogICAgCX0KCiAgICAJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgogICAgCQl5aWVsZCB0aGlzLnI7CiAgICAJCXlpZWxkIHRoaXMuZzsKICAgIAkJeWllbGQgdGhpcy5iOwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF9jb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CgogICAgLyoqCiAgICAgKiBBIGRpY3Rpb25hcnkgd2l0aCBYMTEgY29sb3IgbmFtZXMuCiAgICAgKgogICAgICogTm90ZSB0aGF0IG11bHRpcGxlIHdvcmRzIHN1Y2ggYXMgRGFyayBPcmFuZ2UgYmVjb21lIHRoZSBzdHJpbmcgJ2RhcmtvcmFuZ2UnLgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKi8KICAgIENvbG9yLk5BTUVTID0gX2NvbG9yS2V5d29yZHM7CgogICAgbGV0IF9tYXRlcmlhbElkID0gMDsKCiAgICAvKioKICAgICAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIG1hdGVyaWFscy4KICAgICAqCiAgICAgKiBNYXRlcmlhbHMgZGVmaW5lIHRoZSBhcHBlYXJhbmNlIG9mIHJlbmRlcmFibGUgM0Qgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAYWJzdHJhY3QKICAgICAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKICAgICAqLwogICAgY2xhc3MgTWF0ZXJpYWwgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1hdGVyaWFsLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzTWF0ZXJpYWwgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBJRCBvZiB0aGUgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEBuYW1lIE1hdGVyaWFsI2lkCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKi8KICAgIAkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfbWF0ZXJpYWxJZCArKyB9ICk7CgogICAgCQkvKioKICAgIAkJICogVGhlIFVVSUQgb2YgdGhlIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBuYW1lIG9mIHRoZSBtYXRlcmlhbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMubmFtZSA9ICcnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB0eXBlIHByb3BlcnR5IGlzIHVzZWQgZm9yIGRldGVjdGluZyB0aGUgb2JqZWN0IHR5cGUKICAgIAkJICogaW4gY29udGV4dCBvZiBzZXJpYWxpemF0aW9uL2Rlc2VyaWFsaXphdGlvbi4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQl0aGlzLnR5cGUgPSAnTWF0ZXJpYWwnOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIHR5cGUgb2YgdGhlIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBJdCBtdXN0IGJlIHNldCB0byBgQ3VzdG9tQmxlbmRpbmdgIGlmIGN1c3RvbSBibGVuZGluZyBwcm9wZXJ0aWVzIGxpa2UKICAgIAkJICoge0BsaW5rIE1hdGVyaWFsI2JsZW5kU3JjfSwge0BsaW5rIE1hdGVyaWFsI2JsZW5kRHN0fSBvciB7QGxpbmsgTWF0ZXJpYWwjYmxlbmRFcXVhdGlvbn0KICAgIAkJICogc2hvdWxkIGhhdmUgYW55IGVmZmVjdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhOb0JsZW5kaW5nfE5vcm1hbEJsZW5kaW5nfEFkZGl0aXZlQmxlbmRpbmd8U3VidHJhY3RpdmVCbGVuZGluZ3xNdWx0aXBseUJsZW5kaW5nfEN1c3RvbUJsZW5kaW5nKX0KICAgIAkJICogQGRlZmF1bHQgTm9ybWFsQmxlbmRpbmcKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmRpbmcgPSBOb3JtYWxCbGVuZGluZzsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHdoaWNoIHNpZGUgb2YgZmFjZXMgd2lsbCBiZSByZW5kZXJlZCAtIGZyb250LCBiYWNrIG9yIGJvdGguCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoRnJvbnRTaWRlfEJhY2tTaWRlfERvdWJsZVNpZGUpfQogICAgCQkgKiBAZGVmYXVsdCBGcm9udFNpZGUKICAgIAkJICovCiAgICAJCXRoaXMuc2lkZSA9IEZyb250U2lkZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB2ZXJ0ZXggY29sb3JzIHNob3VsZCBiZSB1c2VkLgogICAgCQkgKgogICAgCQkgKiBUaGUgZW5naW5lIHN1cHBvcnRzIFJHQiBhbmQgUkdCQSB2ZXJ0ZXggY29sb3JzIGRlcGVuZGluZyBvbiB3aGV0aGVyIGEgdGhyZWUgKFJHQikgb3IKICAgIAkJICogZm91ciAoUkdCQSkgY29tcG9uZW50IGNvbG9yIGJ1ZmZlciBhdHRyaWJ1dGUgaXMgdXNlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLnZlcnRleENvbG9ycyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgaG93IHRyYW5zcGFyZW50IHRoZSBtYXRlcmlhbCBpcy4KICAgIAkJICogQSB2YWx1ZSBvZiBgMC4wYCBpbmRpY2F0ZXMgZnVsbHkgdHJhbnNwYXJlbnQsIGAxLjBgIGlzIGZ1bGx5IG9wYXF1ZS4KICAgIAkJICoKICAgIAkJICogSWYgdGhlIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gaXMgbm90IHNldCB0byBgdHJ1ZWAsCiAgICAJCSAqIHRoZSBtYXRlcmlhbCB3aWxsIHJlbWFpbiBmdWxseSBvcGFxdWUgYW5kIHRoaXMgdmFsdWUgd2lsbCBvbmx5IGFmZmVjdCBpdHMgY29sb3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMub3BhY2l0eSA9IDE7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgaXMgdHJhbnNwYXJlbnQuIFRoaXMgaGFzIGFuIGVmZmVjdCBvbgogICAgCQkgKiByZW5kZXJpbmcgYXMgdHJhbnNwYXJlbnQgb2JqZWN0cyBuZWVkIHNwZWNpYWwgdHJlYXRtZW50IGFuZCBhcmUgcmVuZGVyZWQKICAgIAkJICogYWZ0ZXIgbm9uLXRyYW5zcGFyZW50IG9iamVjdHMuCiAgICAJCSAqCiAgICAJCSAqIFdoZW4gc2V0IHRvIHRydWUsIHRoZSBleHRlbnQgdG8gd2hpY2ggdGhlIG1hdGVyaWFsIGlzIHRyYW5zcGFyZW50IGlzCiAgICAJCSAqIGNvbnRyb2xsZWQgYnkge0BsaW5rIE1hdGVyaWFsI29wYWNpdHl9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMudHJhbnNwYXJlbnQgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBFbmFibGVzIGFscGhhIGhhc2hlZCB0cmFuc3BhcmVuY3ksIGFuIGFsdGVybmF0aXZlIHRvIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3IKICAgIAkJICoge0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uIFRoZSBtYXRlcmlhbCB3aWxsIG5vdCBiZSByZW5kZXJlZCBpZiBvcGFjaXR5IGlzIGxvd2VyIHRoYW4KICAgIAkJICogYSByYW5kb20gdGhyZXNob2xkLiBSYW5kb21pemF0aW9uIGludHJvZHVjZXMgc29tZSBncmFpbiBvciBub2lzZSwgYnV0IGFwcHJveGltYXRlcyBhbHBoYQogICAgCQkgKiBibGVuZGluZyB3aXRob3V0IHRoZSBhc3NvY2lhdGVkIHByb2JsZW1zIG9mIHNvcnRpbmcuIFVzaW5nIFRBQSBjYW4gcmVkdWNlIHRoZSByZXN1bHRpbmcgbm9pc2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5hbHBoYUhhc2ggPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBzb3VyY2UgZmFjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CiAgICAJCSAqIEBkZWZhdWx0IFNyY0FscGhhRmFjdG9yCiAgICAJCSAqLwogICAgCQl0aGlzLmJsZW5kU3JjID0gU3JjQWxwaGFGYWN0b3I7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZGVzdGluYXRpb24gZmFjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CiAgICAJCSAqIEBkZWZhdWx0IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmREc3QgPSBPbmVNaW51c1NyY0FscGhhRmFjdG9yOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIGVxdWF0aW9uLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KEFkZEVxdWF0aW9ufFN1YnRyYWN0RXF1YXRpb258UmV2ZXJzZVN1YnRyYWN0RXF1YXRpb258TWluRXF1YXRpb258TWF4RXF1YXRpb24pfQogICAgCQkgKiBAZGVmYXVsdCBBZGRFcXVhdGlvbgogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgc291cmNlIGFscGhhIGZhY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oWmVyb0ZhY3RvcnxPbmVGYWN0b3J8U3JjQ29sb3JGYWN0b3J8T25lTWludXNTcmNDb2xvckZhY3RvcnxTcmNBbHBoYUZhY3RvcnxPbmVNaW51c1NyY0FscGhhRmFjdG9yfERzdEFscGhhRmFjdG9yfE9uZU1pbnVzRHN0QWxwaGFGYWN0b3J8RHN0Q29sb3JGYWN0b3J8T25lTWludXNEc3RDb2xvckZhY3RvcnxTcmNBbHBoYVNhdHVyYXRlRmFjdG9yfENvbnN0YW50Q29sb3JGYWN0b3J8T25lTWludXNDb25zdGFudENvbG9yRmFjdG9yfENvbnN0YW50QWxwaGFGYWN0b3J8T25lTWludXNDb25zdGFudEFscGhhRmFjdG9yKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZFNyY0FscGhhID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBkZXN0aW5hdGlvbiBhbHBoYSBmYWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmREc3RBbHBoYSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZXF1YXRpb24gb2YgdGhlIGFscGhhIGNoYW5uZWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KEFkZEVxdWF0aW9ufFN1YnRyYWN0RXF1YXRpb258UmV2ZXJzZVN1YnRyYWN0RXF1YXRpb258TWluRXF1YXRpb258TWF4RXF1YXRpb24pfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogUmVwcmVzZW50cyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgY29uc3RhbnQgYmxlbmQgY29sb3IuCiAgICAJCSAqCiAgICAJCSAqIFRoaXMgcHJvcGVydHkgaGFzIG9ubHkgYW4gZWZmZWN0IHdoZW4gdXNpbmcgY3VzdG9tIGJsZW5kaW5nIHdpdGggYENvbnN0YW50Q29sb3JgIG9yIGBPbmVNaW51c0NvbnN0YW50Q29sb3JgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Q29sb3J9CiAgICAJCSAqIEBkZWZhdWx0ICgwLDAsMCkKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmRDb2xvciA9IG5ldyBDb2xvciggMCwgMCwgMCApOwoKICAgIAkJLyoqCiAgICAJCSAqIFJlcHJlc2VudHMgdGhlIGFscGhhIHZhbHVlIG9mIHRoZSBjb25zdGFudCBibGVuZCBjb2xvci4KICAgIAkJICoKICAgIAkJICogVGhpcyBwcm9wZXJ0eSBoYXMgb25seSBhbiBlZmZlY3Qgd2hlbiB1c2luZyBjdXN0b20gYmxlbmRpbmcgd2l0aCBgQ29uc3RhbnRBbHBoYWAgb3IgYE9uZU1pbnVzQ29uc3RhbnRBbHBoYWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmRBbHBoYSA9IDA7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgZGVwdGggZnVuY3Rpb24uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTmV2ZXJEZXB0aHxBbHdheXNEZXB0aHxMZXNzRGVwdGh8TGVzc0VxdWFsRGVwdGh8RXF1YWxEZXB0aHxHcmVhdGVyRXF1YWxEZXB0aHxHcmVhdGVyRGVwdGh8Tm90RXF1YWxEZXB0aCl9CiAgICAJCSAqIEBkZWZhdWx0IExlc3NFcXVhbERlcHRoCiAgICAJCSAqLwogICAgCQl0aGlzLmRlcHRoRnVuYyA9IExlc3NFcXVhbERlcHRoOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gaGF2ZSBkZXB0aCB0ZXN0IGVuYWJsZWQgd2hlbiByZW5kZXJpbmcgdGhpcyBtYXRlcmlhbC4KICAgIAkJICogV2hlbiB0aGUgZGVwdGggdGVzdCBpcyBkaXNhYmxlZCwgdGhlIGRlcHRoIHdyaXRlIHdpbGwgYWxzbyBiZSBpbXBsaWNpdGx5IGRpc2FibGVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aFRlc3QgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgcmVuZGVyaW5nIHRoaXMgbWF0ZXJpYWwgaGFzIGFueSBlZmZlY3Qgb24gdGhlIGRlcHRoIGJ1ZmZlci4KICAgIAkJICoKICAgIAkJICogV2hlbiBkcmF3aW5nIDJEIG92ZXJsYXlzIGl0IGNhbiBiZSB1c2VmdWwgdG8gZGlzYWJsZSB0aGUgZGVwdGggd3JpdGluZyBpbgogICAgCQkgKiBvcmRlciB0byBsYXllciBzZXZlcmFsIHRoaW5ncyB0b2dldGhlciB3aXRob3V0IGNyZWF0aW5nIHotaW5kZXggYXJ0aWZhY3RzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aFdyaXRlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgYml0IG1hc2sgdG8gdXNlIHdoZW4gd3JpdGluZyB0byB0aGUgc3RlbmNpbCBidWZmZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDB4ZmYKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbFdyaXRlTWFzayA9IDB4ZmY7CgogICAgCQkvKioKICAgIAkJICogVGhlIHN0ZW5jaWwgY29tcGFyaXNvbiBmdW5jdGlvbiB0byB1c2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtOZXZlclN0ZW5jaWxGdW5jfExlc3NTdGVuY2lsRnVuY3xFcXVhbFN0ZW5jaWxGdW5jfExlc3NFcXVhbFN0ZW5jaWxGdW5jfEdyZWF0ZXJTdGVuY2lsRnVuY3xOb3RFcXVhbFN0ZW5jaWxGdW5jfEdyZWF0ZXJFcXVhbFN0ZW5jaWxGdW5jfEFsd2F5c1N0ZW5jaWxGdW5jfQogICAgCQkgKiBAZGVmYXVsdCBBbHdheXNTdGVuY2lsRnVuYwogICAgCQkgKi8KICAgIAkJdGhpcy5zdGVuY2lsRnVuYyA9IEFsd2F5c1N0ZW5jaWxGdW5jOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB2YWx1ZSB0byB1c2Ugd2hlbiBwZXJmb3JtaW5nIHN0ZW5jaWwgY29tcGFyaXNvbnMgb3Igc3RlbmNpbCBvcGVyYXRpb25zLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnN0ZW5jaWxSZWYgPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBiaXQgbWFzayB0byB1c2Ugd2hlbiBjb21wYXJpbmcgYWdhaW5zdCB0aGUgc3RlbmNpbCBidWZmZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDB4ZmYKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbEZ1bmNNYXNrID0gMHhmZjsKCiAgICAJCS8qKgogICAgCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucyBgZmFsc2VgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7WmVyb1N0ZW5jaWxPcHxLZWVwU3RlbmNpbE9wfFJlcGxhY2VTdGVuY2lsT3B8SW5jcmVtZW50U3RlbmNpbE9wfERlY3JlbWVudFN0ZW5jaWxPcHxJbmNyZW1lbnRXcmFwU3RlbmNpbE9wfERlY3JlbWVudFdyYXBTdGVuY2lsT3B8SW52ZXJ0U3RlbmNpbE9wfQogICAgCQkgKiBAZGVmYXVsdCBLZWVwU3RlbmNpbE9wCiAgICAJCSAqLwogICAgCQl0aGlzLnN0ZW5jaWxGYWlsID0gS2VlcFN0ZW5jaWxPcDsKCiAgICAJCS8qKgogICAgCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucwogICAgCQkgKiBgdHJ1ZWAgYnV0IHRoZSBkZXB0aCB0ZXN0IGZhaWxzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7WmVyb1N0ZW5jaWxPcHxLZWVwU3RlbmNpbE9wfFJlcGxhY2VTdGVuY2lsT3B8SW5jcmVtZW50U3RlbmNpbE9wfERlY3JlbWVudFN0ZW5jaWxPcHxJbmNyZW1lbnRXcmFwU3RlbmNpbE9wfERlY3JlbWVudFdyYXBTdGVuY2lsT3B8SW52ZXJ0U3RlbmNpbE9wfQogICAgCQkgKiBAZGVmYXVsdCBLZWVwU3RlbmNpbE9wCiAgICAJCSAqLwogICAgCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IEtlZXBTdGVuY2lsT3A7CgogICAgCQkvKioKICAgIAkJICogV2hpY2ggc3RlbmNpbCBvcGVyYXRpb24gdG8gcGVyZm9ybSB3aGVuIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uIHJldHVybnMKICAgIAkJICogYHRydWVgIGFuZCB0aGUgZGVwdGggdGVzdCBwYXNzZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtaZXJvU3RlbmNpbE9wfEtlZXBTdGVuY2lsT3B8UmVwbGFjZVN0ZW5jaWxPcHxJbmNyZW1lbnRTdGVuY2lsT3B8RGVjcmVtZW50U3RlbmNpbE9wfEluY3JlbWVudFdyYXBTdGVuY2lsT3B8RGVjcmVtZW50V3JhcFN0ZW5jaWxPcHxJbnZlcnRTdGVuY2lsT3B9CiAgICAJCSAqIEBkZWZhdWx0IEtlZXBTdGVuY2lsT3AKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbFpQYXNzID0gS2VlcFN0ZW5jaWxPcDsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHN0ZW5jaWwgb3BlcmF0aW9ucyBhcmUgcGVyZm9ybWVkIGFnYWluc3QgdGhlIHN0ZW5jaWwgYnVmZmVyLiBJbgogICAgCQkgKiBvcmRlciB0byBwZXJmb3JtIHdyaXRlcyBvciBjb21wYXJpc29ucyBhZ2FpbnN0IHRoZSBzdGVuY2lsIGJ1ZmZlciB0aGlzCiAgICAJCSAqIHZhbHVlIG11c3QgYmUgYHRydWVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbFdyaXRlID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogVXNlci1kZWZpbmVkIGNsaXBwaW5nIHBsYW5lcyBzcGVjaWZpZWQgYXMgVEhSRUUuUGxhbmUgb2JqZWN0cyBpbiB3b3JsZAogICAgCQkgKiBzcGFjZS4gVGhlc2UgcGxhbmVzIGFwcGx5IHRvIHRoZSBvYmplY3RzIHRoaXMgbWF0ZXJpYWwgaXMgYXR0YWNoZWQgdG8uCiAgICAJCSAqIFBvaW50cyBpbiBzcGFjZSB3aG9zZSBzaWduZWQgZGlzdGFuY2UgdG8gdGhlIHBsYW5lIGlzIG5lZ2F0aXZlIGFyZSBjbGlwcGVkCiAgICAJCSAqIChub3QgcmVuZGVyZWQpLiBUaGlzIHJlcXVpcmVzIHtAbGluayBXZWJHTFJlbmRlcmVyI2xvY2FsQ2xpcHBpbmdFbmFibGVkfSB0bwogICAgCQkgKiBiZSBgdHJ1ZWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/QXJyYXk8UGxhbmU+fQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBDaGFuZ2VzIHRoZSBiZWhhdmlvciBvZiBjbGlwcGluZyBwbGFuZXMgc28gdGhhdCBvbmx5IHRoZWlyIGludGVyc2VjdGlvbiBpcwogICAgCQkgKiBjbGlwcGVkLCByYXRoZXIgdGhhbiB0aGVpciB1bmlvbi4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmNsaXBJbnRlcnNlY3Rpb24gPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHdoZXRoZXIgdG8gY2xpcCBzaGFkb3dzIGFjY29yZGluZyB0byB0aGUgY2xpcHBpbmcgcGxhbmVzIHNwZWNpZmllZAogICAgCQkgKiBvbiB0aGlzIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuY2xpcFNoYWRvd3MgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHdoaWNoIHNpZGUgb2YgZmFjZXMgY2FzdCBzaGFkb3dzLiBJZiBgbnVsbGAsIHRoZSBzaWRlIGNhc3Rpbmcgc2hhZG93cwogICAgCQkgKiBpcyBkZXRlcm1pbmVkIGFzIGZvbGxvd3M6CiAgICAJCSAqCiAgICAJCSAqIC0gV2hlbiB7QGxpbmsgTWF0ZXJpYWwjc2lkZX0gaXMgc2V0IHRvIGBGcm9udFNpZGVgLCB0aGUgYmFjayBzaWRlIGNhc3Qgc2hhZG93cy4KICAgIAkJICogLSBXaGVuIHtAbGluayBNYXRlcmlhbCNzaWRlfSBpcyBzZXQgdG8gYEJhY2tTaWRlYCwgdGhlIGZyb250IHNpZGUgY2FzdCBzaGFkb3dzLgogICAgCQkgKiAtIFdoZW4ge0BsaW5rIE1hdGVyaWFsI3NpZGV9IGlzIHNldCB0byBgRG91YmxlU2lkZWAsIGJvdGggc2lkZXMgY2FzdCBzaGFkb3dzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7PyhGcm9udFNpZGV8QmFja1NpZGV8RG91YmxlU2lkZSl9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuc2hhZG93U2lkZSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byByZW5kZXIgdGhlIG1hdGVyaWFsJ3MgY29sb3IuCiAgICAJCSAqCiAgICAJCSAqIFRoaXMgY2FuIGJlIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCB7QGxpbmsgT2JqZWN0M0QjcmVuZGVyT2Rlcn0gdG8gY3JlYXRlIGludmlzaWJsZQogICAgCQkgKiBvYmplY3RzIHRoYXQgb2NjbHVkZSBvdGhlciBvYmplY3RzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5jb2xvcldyaXRlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBPdmVycmlkZSB0aGUgcmVuZGVyZXIncyBkZWZhdWx0IHByZWNpc2lvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oJ2hpZ2hwJ3wnbWVkaXVtcCd8J2xvd3AnKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5wcmVjaXNpb24gPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gdXNlIHBvbHlnb24gb2Zmc2V0IG9yIG5vdC4gV2hlbiBlbmFibGVkLCBlYWNoIGZyYWdtZW50J3MgZGVwdGggdmFsdWUgd2lsbAogICAgCQkgKiBiZSBvZmZzZXQgYWZ0ZXIgaXQgaXMgaW50ZXJwb2xhdGVkIGZyb20gdGhlIGRlcHRoIHZhbHVlcyBvZiB0aGUgYXBwcm9wcmlhdGUgdmVydGljZXMuCiAgICAJCSAqIFRoZSBvZmZzZXQgaXMgYWRkZWQgYmVmb3JlIHRoZSBkZXB0aCB0ZXN0IGlzIHBlcmZvcm1lZCBhbmQgYmVmb3JlIHRoZSB2YWx1ZSBpcyB3cml0dGVuCiAgICAJCSAqIGludG8gdGhlIGRlcHRoIGJ1ZmZlci4KICAgIAkJICoKICAgIAkJICogQ2FuIGJlIHVzZWZ1bCBmb3IgcmVuZGVyaW5nIGhpZGRlbi1saW5lIGltYWdlcywgZm9yIGFwcGx5aW5nIGRlY2FscyB0byBzdXJmYWNlcywgYW5kIGZvcgogICAgCQkgKiByZW5kZXJpbmcgc29saWRzIHdpdGggaGlnaGxpZ2h0ZWQgZWRnZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogU3BlY2lmaWVzIGEgc2NhbGUgZmFjdG9yIHRoYXQgaXMgdXNlZCB0byBjcmVhdGUgYSB2YXJpYWJsZSBkZXB0aCBvZmZzZXQgZm9yIGVhY2ggcG9seWdvbi4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBJcyBtdWx0aXBsaWVkIGJ5IGFuIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHZhbHVlIHRvIGNyZWF0ZSBhIGNvbnN0YW50IGRlcHRoIG9mZnNldC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gYXBwbHkgZGl0aGVyaW5nIHRvIHRoZSBjb2xvciB0byByZW1vdmUgdGhlIGFwcGVhcmFuY2Ugb2YgYmFuZGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmRpdGhlcmluZyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgYWxwaGEgdG8gY292ZXJhZ2Ugc2hvdWxkIGJlIGVuYWJsZWQgb3Igbm90LiBDYW4gb25seSBiZSB1c2VkIHdpdGggTVNBQS1lbmFibGVkIGNvbnRleHRzCiAgICAJCSAqIChtZWFuaW5nIHdoZW4gdGhlIHJlbmRlcmVyIHdhcyBjcmVhdGVkIHdpdGggKmFudGlhbGlhcyogcGFyYW1ldGVyIHNldCB0byBgdHJ1ZWApLiBFbmFibGluZyB0aGlzCiAgICAJCSAqIHdpbGwgc21vb3RoIGFsaWFzaW5nIG9uIGNsaXAgcGxhbmUgZWRnZXMgYW5kIGFscGhhVGVzdC1jbGlwcGVkIGVkZ2VzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuYWxwaGFUb0NvdmVyYWdlID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBwcmVtdWx0aXBseSB0aGUgYWxwaGEgKHRyYW5zcGFyZW5jeSkgdmFsdWUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIGRvdWJsZS1zaWRlZCwgdHJhbnNwYXJlbnQgb2JqZWN0cyBzaG91bGQgYmUgcmVuZGVyZWQgd2l0aCBhIHNpbmdsZSBwYXNzIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogVGhlIGVuZ2luZSByZW5kZXJzIGRvdWJsZS1zaWRlZCwgdHJhbnNwYXJlbnQgb2JqZWN0cyB3aXRoIHR3byBkcmF3IGNhbGxzIChiYWNrIGZhY2VzIGZpcnN0LAogICAgCQkgKiB0aGVuIGZyb250IGZhY2VzKSB0byBtaXRpZ2F0ZSB0cmFuc3BhcmVuY3kgYXJ0aWZhY3RzLiBUaGVyZSBhcmUgc2NlbmFyaW9zIGhvd2V2ZXIgd2hlcmUgdGhpcwogICAgCQkgKiBhcHByb2FjaCBwcm9kdWNlcyBubyBxdWFsaXR5IGdhaW5zIGJ1dCBzdGlsbCBkb3VibGVzIGRyYXcgY2FsbHMgZS5nLiB3aGVuIHJlbmRlcmluZyBmbGF0CiAgICAJCSAqIHZlZ2V0YXRpb24gbGlrZSBncmFzcyBzcHJpdGVzLiBJbiB0aGVzZSBjYXNlcywgc2V0IHRoZSBgZm9yY2VTaW5nbGVQYXNzYCBmbGFnIHRvIGB0cnVlYCB0bwogICAgCQkgKiBkaXNhYmxlIHRoZSB0d28gcGFzcyByZW5kZXJpbmcgdG8gYXZvaWQgcGVyZm9ybWFuY2UgaXNzdWVzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciBpdCdzIHBvc3NpYmxlIHRvIG92ZXJyaWRlIHRoZSBtYXRlcmlhbCB3aXRoIHtAbGluayBTY2VuZSNvdmVycmlkZU1hdGVyaWFsfSBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmFsbG93T3ZlcnJpZGUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hldGhlciAzRCBvYmplY3RzIHVzaW5nIHRoaXMgbWF0ZXJpYWwgYXJlIHZpc2libGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIGlzIHRvbmUgbWFwcGVkIGFjY29yZGluZyB0byB0aGUgcmVuZGVyZXIncyB0b25lIG1hcHBpbmcgc2V0dGluZy4KICAgIAkJICoKICAgIAkJICogSXQgaXMgaWdub3JlZCB3aGVuIHJlbmRlcmluZyB0byBhIHJlbmRlciB0YXJnZXQgb3IgdXNpbmcgcG9zdCBwcm9jZXNzaW5nIG9yIHdoZW4gdXNpbmcKICAgIAkJICogYFdlYkdQVVJlbmRlcmVyYC4gSW4gYWxsIHRoZXNlIGNhc2VzLCBhbGwgbWF0ZXJpYWxzIGFyZSBob25vcmVkIGJ5IHRvbmUgbWFwcGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMudG9uZU1hcHBlZCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIE1hdGVyaWFsLiBJdAogICAgCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy51c2VyRGF0YSA9IHt9OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgc3RhcnRzIGF0IGAwYCBhbmQgY291bnRzIGhvdyBtYW55IHRpbWVzIHtAbGluayBNYXRlcmlhbCNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMudmVyc2lvbiA9IDA7CgogICAgCQl0aGlzLl9hbHBoYVRlc3QgPSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGFscGhhIHZhbHVlIHRvIGJlIHVzZWQgd2hlbiBydW5uaW5nIGFuIGFscGhhIHRlc3QuIFRoZSBtYXRlcmlhbAogICAgCSAqIHdpbGwgbm90IGJlIHJlbmRlcmVkIGlmIHRoZSBvcGFjaXR5IGlzIGxvd2VyIHRoYW4gdGhpcyB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQHJlYWRvbmx5CiAgICAJICogQGRlZmF1bHQgMAogICAgCSAqLwogICAgCWdldCBhbHBoYVRlc3QoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fYWxwaGFUZXN0OwoKICAgIAl9CgogICAgCXNldCBhbHBoYVRlc3QoIHZhbHVlICkgewoKICAgIAkJaWYgKCB0aGlzLl9hbHBoYVRlc3QgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgogICAgCQkJdGhpcy52ZXJzaW9uICsrOwoKICAgIAkJfQoKICAgIAkJdGhpcy5fYWxwaGFUZXN0ID0gdmFsdWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIG1hdGVyaWFsIGlzIHVzZWQgdG8gcmVuZGVyIGEgM0Qgb2JqZWN0LgogICAgCSAqCiAgICAJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgLSBUaGUgc2NlbmUuCiAgICAJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KICAgIAkgKi8KICAgIAlvbkJlZm9yZVJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICovICkge30KCiAgICAJLyoqCiAgICAJICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIHNoYWRlcgogICAgCSAqIHByb2dyYW0gaXMgY29tcGlsZWQuIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdpdGggdGhlIHNoYWRlciBzb3VyY2UgY29kZQogICAgCSAqIGFzIGEgcGFyYW1ldGVyLiBVc2VmdWwgZm9yIHRoZSBtb2RpZmljYXRpb24gb2YgYnVpbHQtaW4gbWF0ZXJpYWxzLgogICAgCSAqCiAgICAJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4gVGhlCiAgICAJICogcmVjb21tZW5kZWQgYXBwcm9hY2ggd2hlbiBjdXN0b21pemluZyBtYXRlcmlhbHMgaXMgdG8gdXNlIGBXZWJHUFVSZW5kZXJlcmAgd2l0aCB0aGUgbmV3CiAgICAJICogTm9kZSBNYXRlcmlhbCBzeXN0ZW0gYW5kIFtUU0xde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvd2lraS9UaHJlZS5qcy1TaGFkaW5nLUxhbmd1YWdlfS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7e3ZlcnRleFNoYWRlcjpzdHJpbmcsZnJhZ21lbnRTaGFkZXI6c3RyaW5nLHVuaWZvcm1zOk9iamVjdH19IHNoYWRlcm9iamVjdCAtIFRoZSBvYmplY3QgaG9sZHMgdGhlIHVuaWZvcm1zIGFuZCB0aGUgdmVydGV4IGFuZCBmcmFnbWVudCBzaGFkZXIgc291cmNlLgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBBIHJlZmVyZW5jZSB0byB0aGUgcmVuZGVyZXIuCiAgICAJICovCiAgICAJb25CZWZvcmVDb21waWxlKCAvKiBzaGFkZXJvYmplY3QsIHJlbmRlcmVyICovICkge30KCiAgICAJLyoqCiAgICAJICogSW4gY2FzZSB7QGxpbmsgTWF0ZXJpYWwjb25CZWZvcmVDb21waWxlfSBpcyB1c2VkLCB0aGlzIGNhbGxiYWNrIGNhbiBiZSB1c2VkIHRvIGlkZW50aWZ5CiAgICAJICogdmFsdWVzIG9mIHNldHRpbmdzIHVzZWQgaW4gYG9uQmVmb3JlQ29tcGlsZSgpYCwgc28gdGhyZWUuanMgY2FuIHJldXNlIGEgY2FjaGVkCiAgICAJICogc2hhZGVyIG9yIHJlY29tcGlsZSB0aGUgc2hhZGVyIGZvciB0aGlzIG1hdGVyaWFsIGFzIG5lZWRlZC4KICAgIAkgKgogICAgCSAqIFRoaXMgbWV0aG9kIGNhbiBvbmx5IGJlIHVzZWQgd2hlbiByZW5kZXJpbmcgd2l0aCB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjdXN0b20gcHJvZ3JhbSBjYWNoZSBrZXkuCiAgICAJICovCiAgICAJY3VzdG9tUHJvZ3JhbUNhY2hlS2V5KCkgewoKICAgIAkJcmV0dXJuIHRoaXMub25CZWZvcmVDb21waWxlLnRvU3RyaW5nKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgdG8gc2V0IGRlZmF1bHQgdmFsdWVzIGZyb20gcGFyYW1ldGVyIG9iamVjdHMuCiAgICAJICogSXQgaXMgYSBnZW5lcmljIGltcGxlbWVudGF0aW9uIHNvIGl0IGNhbiBiZSB1c2VkIHdpdGggZGlmZmVyZW50IHR5cGVzCiAgICAJICogb2YgbWF0ZXJpYWxzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3R9IFt2YWx1ZXNdIC0gVGhlIG1hdGVyaWFsIHZhbHVlcyB0byBzZXQuCiAgICAJICovCiAgICAJc2V0VmFsdWVzKCB2YWx1ZXMgKSB7CgogICAgCQlpZiAoIHZhbHVlcyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCiAgICAJCQljb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1sga2V5IF07CgogICAgCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5NYXRlcmlhbDogcGFyYW1ldGVyICckeyBrZXkgfScgaGFzIHZhbHVlIG9mIHVuZGVmaW5lZC5gICk7CiAgICAJCQkJY29udGludWU7CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRoaXNbIGtleSBdOwoKICAgIAkJCWlmICggY3VycmVudFZhbHVlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk1hdGVyaWFsOiAnJHsga2V5IH0nIGlzIG5vdCBhIHByb3BlcnR5IG9mIFRIUkVFLiR7IHRoaXMudHlwZSB9LmAgKTsKICAgIAkJCQljb250aW51ZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzQ29sb3IgKSB7CgogICAgCQkJCWN1cnJlbnRWYWx1ZS5zZXQoIG5ld1ZhbHVlICk7CgogICAgCQkJfSBlbHNlIGlmICggKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzVmVjdG9yMyApICYmICggbmV3VmFsdWUgJiYgbmV3VmFsdWUuaXNWZWN0b3IzICkgKSB7CgogICAgCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXRoaXNbIGtleSBdID0gbmV3VmFsdWU7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNlcmlhbGl6ZXMgdGhlIG1hdGVyaWFsIGludG8gSlNPTi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIG1hdGVyaWFsLgogICAgCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KICAgIAkgKi8KICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCiAgICAJCWlmICggaXNSb290T2JqZWN0ICkgewoKICAgIAkJCW1ldGEgPSB7CiAgICAJCQkJdGV4dHVyZXM6IHt9LAogICAgCQkJCWltYWdlczoge30KICAgIAkJCX07CgogICAgCQl9CgogICAgCQljb25zdCBkYXRhID0gewogICAgCQkJbWV0YWRhdGE6IHsKICAgIAkJCQl2ZXJzaW9uOiA0LjcsCiAgICAJCQkJdHlwZTogJ01hdGVyaWFsJywKICAgIAkJCQlnZW5lcmF0b3I6ICdNYXRlcmlhbC50b0pTT04nCiAgICAJCQl9CiAgICAJCX07CgogICAgCQkvLyBzdGFuZGFyZCBNYXRlcmlhbCBzZXJpYWxpemF0aW9uCiAgICAJCWRhdGEudXVpZCA9IHRoaXMudXVpZDsKICAgIAkJZGF0YS50eXBlID0gdGhpcy50eXBlOwoKICAgIAkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoKICAgIAkJaWYgKCB0aGlzLmNvbG9yICYmIHRoaXMuY29sb3IuaXNDb2xvciApIGRhdGEuY29sb3IgPSB0aGlzLmNvbG9yLmdldEhleCgpOwoKICAgIAkJaWYgKCB0aGlzLnJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5yb3VnaG5lc3MgPSB0aGlzLnJvdWdobmVzczsKICAgIAkJaWYgKCB0aGlzLm1ldGFsbmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5tZXRhbG5lc3MgPSB0aGlzLm1ldGFsbmVzczsKCiAgICAJCWlmICggdGhpcy5zaGVlbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaGVlbiA9IHRoaXMuc2hlZW47CiAgICAJCWlmICggdGhpcy5zaGVlbkNvbG9yICYmIHRoaXMuc2hlZW5Db2xvci5pc0NvbG9yICkgZGF0YS5zaGVlbkNvbG9yID0gdGhpcy5zaGVlbkNvbG9yLmdldEhleCgpOwogICAgCQlpZiAoIHRoaXMuc2hlZW5Sb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hlZW5Sb3VnaG5lc3MgPSB0aGlzLnNoZWVuUm91Z2huZXNzOwogICAgCQlpZiAoIHRoaXMuZW1pc3NpdmUgJiYgdGhpcy5lbWlzc2l2ZS5pc0NvbG9yICkgZGF0YS5lbWlzc2l2ZSA9IHRoaXMuZW1pc3NpdmUuZ2V0SGV4KCk7CiAgICAJCWlmICggdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgIT09IDEgKSBkYXRhLmVtaXNzaXZlSW50ZW5zaXR5ID0gdGhpcy5lbWlzc2l2ZUludGVuc2l0eTsKCiAgICAJCWlmICggdGhpcy5zcGVjdWxhciAmJiB0aGlzLnNwZWN1bGFyLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyID0gdGhpcy5zcGVjdWxhci5nZXRIZXgoKTsKICAgIAkJaWYgKCB0aGlzLnNwZWN1bGFySW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBkYXRhLnNwZWN1bGFySW50ZW5zaXR5ID0gdGhpcy5zcGVjdWxhckludGVuc2l0eTsKICAgIAkJaWYgKCB0aGlzLnNwZWN1bGFyQ29sb3IgJiYgdGhpcy5zcGVjdWxhckNvbG9yLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyQ29sb3IgPSB0aGlzLnNwZWN1bGFyQ29sb3IuZ2V0SGV4KCk7CiAgICAJCWlmICggdGhpcy5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hpbmluZXNzID0gdGhpcy5zaGluaW5lc3M7CiAgICAJCWlmICggdGhpcy5jbGVhcmNvYXQgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0ID0gdGhpcy5jbGVhcmNvYXQ7CiAgICAJCWlmICggdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0Um91Z2huZXNzID0gdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3M7CgogICAgCQlpZiAoIHRoaXMuY2xlYXJjb2F0TWFwICYmIHRoaXMuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmNsZWFyY29hdE1hcCA9IHRoaXMuY2xlYXJjb2F0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwICYmIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwICYmIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmNsZWFyY29hdE5vcm1hbE1hcCA9IHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCQlkYXRhLmNsZWFyY29hdE5vcm1hbFNjYWxlID0gdGhpcy5jbGVhcmNvYXROb3JtYWxTY2FsZS50b0FycmF5KCk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuZGlzcGVyc2lvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5kaXNwZXJzaW9uID0gdGhpcy5kaXNwZXJzaW9uOwoKICAgIAkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlID0gdGhpcy5pcmlkZXNjZW5jZTsKICAgIAkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlSU9SICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlSU9SID0gdGhpcy5pcmlkZXNjZW5jZUlPUjsKICAgIAkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZTsKCiAgICAJCWlmICggdGhpcy5pcmlkZXNjZW5jZU1hcCAmJiB0aGlzLmlyaWRlc2NlbmNlTWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmlyaWRlc2NlbmNlTWFwID0gdGhpcy5pcmlkZXNjZW5jZU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICYmIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPSB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuYW5pc290cm9weSAhPT0gdW5kZWZpbmVkICkgZGF0YS5hbmlzb3Ryb3B5ID0gdGhpcy5hbmlzb3Ryb3B5OwogICAgCQlpZiAoIHRoaXMuYW5pc290cm9weVJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmFuaXNvdHJvcHlSb3RhdGlvbiA9IHRoaXMuYW5pc290cm9weVJvdGF0aW9uOwoKICAgIAkJaWYgKCB0aGlzLmFuaXNvdHJvcHlNYXAgJiYgdGhpcy5hbmlzb3Ryb3B5TWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmFuaXNvdHJvcHlNYXAgPSB0aGlzLmFuaXNvdHJvcHlNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5tYXAgJiYgdGhpcy5tYXAuaXNUZXh0dXJlICkgZGF0YS5tYXAgPSB0aGlzLm1hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQlpZiAoIHRoaXMubWF0Y2FwICYmIHRoaXMubWF0Y2FwLmlzVGV4dHVyZSApIGRhdGEubWF0Y2FwID0gdGhpcy5tYXRjYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJaWYgKCB0aGlzLmFscGhhTWFwICYmIHRoaXMuYWxwaGFNYXAuaXNUZXh0dXJlICkgZGF0YS5hbHBoYU1hcCA9IHRoaXMuYWxwaGFNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCWlmICggdGhpcy5saWdodE1hcCAmJiB0aGlzLmxpZ2h0TWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmxpZ2h0TWFwID0gdGhpcy5saWdodE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQkJZGF0YS5saWdodE1hcEludGVuc2l0eSA9IHRoaXMubGlnaHRNYXBJbnRlbnNpdHk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuYW9NYXAgJiYgdGhpcy5hb01hcC5pc1RleHR1cmUgKSB7CgogICAgCQkJZGF0YS5hb01hcCA9IHRoaXMuYW9NYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJCWRhdGEuYW9NYXBJbnRlbnNpdHkgPSB0aGlzLmFvTWFwSW50ZW5zaXR5OwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmJ1bXBNYXAgJiYgdGhpcy5idW1wTWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmJ1bXBNYXAgPSB0aGlzLmJ1bXBNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJCWRhdGEuYnVtcFNjYWxlID0gdGhpcy5idW1wU2NhbGU7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMubm9ybWFsTWFwICYmIHRoaXMubm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLm5vcm1hbE1hcCA9IHRoaXMubm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCQlkYXRhLm5vcm1hbE1hcFR5cGUgPSB0aGlzLm5vcm1hbE1hcFR5cGU7CiAgICAJCQlkYXRhLm5vcm1hbFNjYWxlID0gdGhpcy5ub3JtYWxTY2FsZS50b0FycmF5KCk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuZGlzcGxhY2VtZW50TWFwICYmIHRoaXMuZGlzcGxhY2VtZW50TWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmRpc3BsYWNlbWVudE1hcCA9IHRoaXMuZGlzcGxhY2VtZW50TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCQlkYXRhLmRpc3BsYWNlbWVudFNjYWxlID0gdGhpcy5kaXNwbGFjZW1lbnRTY2FsZTsKICAgIAkJCWRhdGEuZGlzcGxhY2VtZW50QmlhcyA9IHRoaXMuZGlzcGxhY2VtZW50QmlhczsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5yb3VnaG5lc3NNYXAgJiYgdGhpcy5yb3VnaG5lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS5yb3VnaG5lc3NNYXAgPSB0aGlzLnJvdWdobmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQlpZiAoIHRoaXMubWV0YWxuZXNzTWFwICYmIHRoaXMubWV0YWxuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEubWV0YWxuZXNzTWFwID0gdGhpcy5tZXRhbG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCWlmICggdGhpcy5lbWlzc2l2ZU1hcCAmJiB0aGlzLmVtaXNzaXZlTWFwLmlzVGV4dHVyZSApIGRhdGEuZW1pc3NpdmVNYXAgPSB0aGlzLmVtaXNzaXZlTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCWlmICggdGhpcy5zcGVjdWxhck1hcCAmJiB0aGlzLnNwZWN1bGFyTWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJNYXAgPSB0aGlzLnNwZWN1bGFyTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCWlmICggdGhpcy5zcGVjdWxhckludGVuc2l0eU1hcCAmJiB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCWlmICggdGhpcy5zcGVjdWxhckNvbG9yTWFwICYmIHRoaXMuc3BlY3VsYXJDb2xvck1hcC5pc1RleHR1cmUgKSBkYXRhLnNwZWN1bGFyQ29sb3JNYXAgPSB0aGlzLnNwZWN1bGFyQ29sb3JNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCWlmICggdGhpcy5lbnZNYXAgJiYgdGhpcy5lbnZNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuZW52TWFwID0gdGhpcy5lbnZNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCQlpZiAoIHRoaXMuY29tYmluZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5jb21iaW5lID0gdGhpcy5jb21iaW5lOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmVudk1hcFJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmVudk1hcFJvdGF0aW9uID0gdGhpcy5lbnZNYXBSb3RhdGlvbi50b0FycmF5KCk7CiAgICAJCWlmICggdGhpcy5lbnZNYXBJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuZW52TWFwSW50ZW5zaXR5ID0gdGhpcy5lbnZNYXBJbnRlbnNpdHk7CiAgICAJCWlmICggdGhpcy5yZWZsZWN0aXZpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEucmVmbGVjdGl2aXR5ID0gdGhpcy5yZWZsZWN0aXZpdHk7CiAgICAJCWlmICggdGhpcy5yZWZyYWN0aW9uUmF0aW8gIT09IHVuZGVmaW5lZCApIGRhdGEucmVmcmFjdGlvblJhdGlvID0gdGhpcy5yZWZyYWN0aW9uUmF0aW87CgogICAgCQlpZiAoIHRoaXMuZ3JhZGllbnRNYXAgJiYgdGhpcy5ncmFkaWVudE1hcC5pc1RleHR1cmUgKSB7CgogICAgCQkJZGF0YS5ncmFkaWVudE1hcCA9IHRoaXMuZ3JhZGllbnRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy50cmFuc21pc3Npb24gIT09IHVuZGVmaW5lZCApIGRhdGEudHJhbnNtaXNzaW9uID0gdGhpcy50cmFuc21pc3Npb247CiAgICAJCWlmICggdGhpcy50cmFuc21pc3Npb25NYXAgJiYgdGhpcy50cmFuc21pc3Npb25NYXAuaXNUZXh0dXJlICkgZGF0YS50cmFuc21pc3Npb25NYXAgPSB0aGlzLnRyYW5zbWlzc2lvbk1hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQlpZiAoIHRoaXMudGhpY2tuZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnRoaWNrbmVzcyA9IHRoaXMudGhpY2tuZXNzOwogICAgCQlpZiAoIHRoaXMudGhpY2tuZXNzTWFwICYmIHRoaXMudGhpY2tuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEudGhpY2tuZXNzTWFwID0gdGhpcy50aGlja25lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJaWYgKCB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgIT09IEluZmluaXR5ICkgZGF0YS5hdHRlbnVhdGlvbkRpc3RhbmNlID0gdGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlOwogICAgCQlpZiAoIHRoaXMuYXR0ZW51YXRpb25Db2xvciAhPT0gdW5kZWZpbmVkICkgZGF0YS5hdHRlbnVhdGlvbkNvbG9yID0gdGhpcy5hdHRlbnVhdGlvbkNvbG9yLmdldEhleCgpOwoKICAgIAkJaWYgKCB0aGlzLnNpemUgIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZSA9IHRoaXMuc2l6ZTsKICAgIAkJaWYgKCB0aGlzLnNoYWRvd1NpZGUgIT09IG51bGwgKSBkYXRhLnNoYWRvd1NpZGUgPSB0aGlzLnNoYWRvd1NpZGU7CiAgICAJCWlmICggdGhpcy5zaXplQXR0ZW51YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZUF0dGVudWF0aW9uID0gdGhpcy5zaXplQXR0ZW51YXRpb247CgogICAgCQlpZiAoIHRoaXMuYmxlbmRpbmcgIT09IE5vcm1hbEJsZW5kaW5nICkgZGF0YS5ibGVuZGluZyA9IHRoaXMuYmxlbmRpbmc7CiAgICAJCWlmICggdGhpcy5zaWRlICE9PSBGcm9udFNpZGUgKSBkYXRhLnNpZGUgPSB0aGlzLnNpZGU7CiAgICAJCWlmICggdGhpcy52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgKSBkYXRhLnZlcnRleENvbG9ycyA9IHRydWU7CgogICAgCQlpZiAoIHRoaXMub3BhY2l0eSA8IDEgKSBkYXRhLm9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7CiAgICAJCWlmICggdGhpcy50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIGRhdGEudHJhbnNwYXJlbnQgPSB0cnVlOwoKICAgIAkJaWYgKCB0aGlzLmJsZW5kU3JjICE9PSBTcmNBbHBoYUZhY3RvciApIGRhdGEuYmxlbmRTcmMgPSB0aGlzLmJsZW5kU3JjOwogICAgCQlpZiAoIHRoaXMuYmxlbmREc3QgIT09IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgKSBkYXRhLmJsZW5kRHN0ID0gdGhpcy5ibGVuZERzdDsKICAgIAkJaWYgKCB0aGlzLmJsZW5kRXF1YXRpb24gIT09IEFkZEVxdWF0aW9uICkgZGF0YS5ibGVuZEVxdWF0aW9uID0gdGhpcy5ibGVuZEVxdWF0aW9uOwogICAgCQlpZiAoIHRoaXMuYmxlbmRTcmNBbHBoYSAhPT0gbnVsbCApIGRhdGEuYmxlbmRTcmNBbHBoYSA9IHRoaXMuYmxlbmRTcmNBbHBoYTsKICAgIAkJaWYgKCB0aGlzLmJsZW5kRHN0QWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRHN0QWxwaGEgPSB0aGlzLmJsZW5kRHN0QWxwaGE7CiAgICAJCWlmICggdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRXF1YXRpb25BbHBoYSA9IHRoaXMuYmxlbmRFcXVhdGlvbkFscGhhOwogICAgCQlpZiAoIHRoaXMuYmxlbmRDb2xvciAmJiB0aGlzLmJsZW5kQ29sb3IuaXNDb2xvciApIGRhdGEuYmxlbmRDb2xvciA9IHRoaXMuYmxlbmRDb2xvci5nZXRIZXgoKTsKICAgIAkJaWYgKCB0aGlzLmJsZW5kQWxwaGEgIT09IDAgKSBkYXRhLmJsZW5kQWxwaGEgPSB0aGlzLmJsZW5kQWxwaGE7CgogICAgCQlpZiAoIHRoaXMuZGVwdGhGdW5jICE9PSBMZXNzRXF1YWxEZXB0aCApIGRhdGEuZGVwdGhGdW5jID0gdGhpcy5kZXB0aEZ1bmM7CiAgICAJCWlmICggdGhpcy5kZXB0aFRlc3QgPT09IGZhbHNlICkgZGF0YS5kZXB0aFRlc3QgPSB0aGlzLmRlcHRoVGVzdDsKICAgIAkJaWYgKCB0aGlzLmRlcHRoV3JpdGUgPT09IGZhbHNlICkgZGF0YS5kZXB0aFdyaXRlID0gdGhpcy5kZXB0aFdyaXRlOwogICAgCQlpZiAoIHRoaXMuY29sb3JXcml0ZSA9PT0gZmFsc2UgKSBkYXRhLmNvbG9yV3JpdGUgPSB0aGlzLmNvbG9yV3JpdGU7CgogICAgCQlpZiAoIHRoaXMuc3RlbmNpbFdyaXRlTWFzayAhPT0gMHhmZiApIGRhdGEuc3RlbmNpbFdyaXRlTWFzayA9IHRoaXMuc3RlbmNpbFdyaXRlTWFzazsKICAgIAkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jICE9PSBBbHdheXNTdGVuY2lsRnVuYyApIGRhdGEuc3RlbmNpbEZ1bmMgPSB0aGlzLnN0ZW5jaWxGdW5jOwogICAgCQlpZiAoIHRoaXMuc3RlbmNpbFJlZiAhPT0gMCApIGRhdGEuc3RlbmNpbFJlZiA9IHRoaXMuc3RlbmNpbFJlZjsKICAgIAkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jTWFzayAhPT0gMHhmZiApIGRhdGEuc3RlbmNpbEZ1bmNNYXNrID0gdGhpcy5zdGVuY2lsRnVuY01hc2s7CiAgICAJCWlmICggdGhpcy5zdGVuY2lsRmFpbCAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbEZhaWwgPSB0aGlzLnN0ZW5jaWxGYWlsOwogICAgCQlpZiAoIHRoaXMuc3RlbmNpbFpGYWlsICE9PSBLZWVwU3RlbmNpbE9wICkgZGF0YS5zdGVuY2lsWkZhaWwgPSB0aGlzLnN0ZW5jaWxaRmFpbDsKICAgIAkJaWYgKCB0aGlzLnN0ZW5jaWxaUGFzcyAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbFpQYXNzID0gdGhpcy5zdGVuY2lsWlBhc3M7CiAgICAJCWlmICggdGhpcy5zdGVuY2lsV3JpdGUgPT09IHRydWUgKSBkYXRhLnN0ZW5jaWxXcml0ZSA9IHRoaXMuc3RlbmNpbFdyaXRlOwoKICAgIAkJLy8gcm90YXRpb24gKFNwcml0ZU1hdGVyaWFsKQogICAgCQlpZiAoIHRoaXMucm90YXRpb24gIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJvdGF0aW9uICE9PSAwICkgZGF0YS5yb3RhdGlvbiA9IHRoaXMucm90YXRpb247CgogICAgCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldCA9PT0gdHJ1ZSApIGRhdGEucG9seWdvbk9mZnNldCA9IHRydWU7CiAgICAJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yOwogICAgCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldFVuaXRzICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0VW5pdHMgPSB0aGlzLnBvbHlnb25PZmZzZXRVbml0czsKCiAgICAJCWlmICggdGhpcy5saW5ld2lkdGggIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxpbmV3aWR0aCAhPT0gMSApIGRhdGEubGluZXdpZHRoID0gdGhpcy5saW5ld2lkdGg7CiAgICAJCWlmICggdGhpcy5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5kYXNoU2l6ZSA9IHRoaXMuZGFzaFNpemU7CiAgICAJCWlmICggdGhpcy5nYXBTaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLmdhcFNpemUgPSB0aGlzLmdhcFNpemU7CiAgICAJCWlmICggdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgCQlpZiAoIHRoaXMuZGl0aGVyaW5nID09PSB0cnVlICkgZGF0YS5kaXRoZXJpbmcgPSB0cnVlOwoKICAgIAkJaWYgKCB0aGlzLmFscGhhVGVzdCA+IDAgKSBkYXRhLmFscGhhVGVzdCA9IHRoaXMuYWxwaGFUZXN0OwogICAgCQlpZiAoIHRoaXMuYWxwaGFIYXNoID09PSB0cnVlICkgZGF0YS5hbHBoYUhhc2ggPSB0cnVlOwogICAgCQlpZiAoIHRoaXMuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlICkgZGF0YS5hbHBoYVRvQ292ZXJhZ2UgPSB0cnVlOwogICAgCQlpZiAoIHRoaXMucHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgZGF0YS5wcmVtdWx0aXBsaWVkQWxwaGEgPSB0cnVlOwogICAgCQlpZiAoIHRoaXMuZm9yY2VTaW5nbGVQYXNzID09PSB0cnVlICkgZGF0YS5mb3JjZVNpbmdsZVBhc3MgPSB0cnVlOwoKICAgIAkJaWYgKCB0aGlzLndpcmVmcmFtZSA9PT0gdHJ1ZSApIGRhdGEud2lyZWZyYW1lID0gdHJ1ZTsKICAgIAkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA+IDEgKSBkYXRhLndpcmVmcmFtZUxpbmV3aWR0aCA9IHRoaXMud2lyZWZyYW1lTGluZXdpZHRoOwogICAgCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWNhcCAhPT0gJ3JvdW5kJyApIGRhdGEud2lyZWZyYW1lTGluZWNhcCA9IHRoaXMud2lyZWZyYW1lTGluZWNhcDsKICAgIAkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmVqb2luICE9PSAncm91bmQnICkgZGF0YS53aXJlZnJhbWVMaW5lam9pbiA9IHRoaXMud2lyZWZyYW1lTGluZWpvaW47CgogICAgCQlpZiAoIHRoaXMuZmxhdFNoYWRpbmcgPT09IHRydWUgKSBkYXRhLmZsYXRTaGFkaW5nID0gdHJ1ZTsKCiAgICAJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIGRhdGEudmlzaWJsZSA9IGZhbHNlOwoKICAgIAkJaWYgKCB0aGlzLnRvbmVNYXBwZWQgPT09IGZhbHNlICkgZGF0YS50b25lTWFwcGVkID0gZmFsc2U7CgogICAgCQlpZiAoIHRoaXMuZm9nID09PSBmYWxzZSApIGRhdGEuZm9nID0gZmFsc2U7CgogICAgCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKICAgIAkJLy8gVE9ETzogQ29waWVkIGZyb20gT2JqZWN0M0QudG9KU09OCgogICAgCQlmdW5jdGlvbiBleHRyYWN0RnJvbUNhY2hlKCBjYWNoZSApIHsKCiAgICAJCQljb25zdCB2YWx1ZXMgPSBbXTsKCiAgICAJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgogICAgCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CiAgICAJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CiAgICAJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIHZhbHVlczsKCiAgICAJCX0KCiAgICAJCWlmICggaXNSb290T2JqZWN0ICkgewoKICAgIAkJCWNvbnN0IHRleHR1cmVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS50ZXh0dXJlcyApOwogICAgCQkJY29uc3QgaW1hZ2VzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5pbWFnZXMgKTsKCiAgICAJCQlpZiAoIHRleHR1cmVzLmxlbmd0aCA+IDAgKSBkYXRhLnRleHR1cmVzID0gdGV4dHVyZXM7CiAgICAJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgZGF0YS5pbWFnZXMgPSBpbWFnZXM7CgogICAgCQl9CgogICAgCQlyZXR1cm4gZGF0YTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IG1hdGVyaWFsIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRlcmlhbH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRlcmlhbCB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRlcmlhbH0gc291cmNlIC0gVGhlIG1hdGVyaWFsIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7TWF0ZXJpYWx9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weSggc291cmNlICkgewoKICAgIAkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgogICAgCQl0aGlzLmJsZW5kaW5nID0gc291cmNlLmJsZW5kaW5nOwogICAgCQl0aGlzLnNpZGUgPSBzb3VyY2Uuc2lkZTsKICAgIAkJdGhpcy52ZXJ0ZXhDb2xvcnMgPSBzb3VyY2UudmVydGV4Q29sb3JzOwoKICAgIAkJdGhpcy5vcGFjaXR5ID0gc291cmNlLm9wYWNpdHk7CiAgICAJCXRoaXMudHJhbnNwYXJlbnQgPSBzb3VyY2UudHJhbnNwYXJlbnQ7CgogICAgCQl0aGlzLmJsZW5kU3JjID0gc291cmNlLmJsZW5kU3JjOwogICAgCQl0aGlzLmJsZW5kRHN0ID0gc291cmNlLmJsZW5kRHN0OwogICAgCQl0aGlzLmJsZW5kRXF1YXRpb24gPSBzb3VyY2UuYmxlbmRFcXVhdGlvbjsKICAgIAkJdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7CiAgICAJCXRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhOwogICAgCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uQWxwaGE7CiAgICAJCXRoaXMuYmxlbmRDb2xvci5jb3B5KCBzb3VyY2UuYmxlbmRDb2xvciApOwogICAgCQl0aGlzLmJsZW5kQWxwaGEgPSBzb3VyY2UuYmxlbmRBbHBoYTsKCiAgICAJCXRoaXMuZGVwdGhGdW5jID0gc291cmNlLmRlcHRoRnVuYzsKICAgIAkJdGhpcy5kZXB0aFRlc3QgPSBzb3VyY2UuZGVwdGhUZXN0OwogICAgCQl0aGlzLmRlcHRoV3JpdGUgPSBzb3VyY2UuZGVwdGhXcml0ZTsKCiAgICAJCXRoaXMuc3RlbmNpbFdyaXRlTWFzayA9IHNvdXJjZS5zdGVuY2lsV3JpdGVNYXNrOwogICAgCQl0aGlzLnN0ZW5jaWxGdW5jID0gc291cmNlLnN0ZW5jaWxGdW5jOwogICAgCQl0aGlzLnN0ZW5jaWxSZWYgPSBzb3VyY2Uuc3RlbmNpbFJlZjsKICAgIAkJdGhpcy5zdGVuY2lsRnVuY01hc2sgPSBzb3VyY2Uuc3RlbmNpbEZ1bmNNYXNrOwogICAgCQl0aGlzLnN0ZW5jaWxGYWlsID0gc291cmNlLnN0ZW5jaWxGYWlsOwogICAgCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IHNvdXJjZS5zdGVuY2lsWkZhaWw7CiAgICAJCXRoaXMuc3RlbmNpbFpQYXNzID0gc291cmNlLnN0ZW5jaWxaUGFzczsKICAgIAkJdGhpcy5zdGVuY2lsV3JpdGUgPSBzb3VyY2Uuc3RlbmNpbFdyaXRlOwoKICAgIAkJY29uc3Qgc3JjUGxhbmVzID0gc291cmNlLmNsaXBwaW5nUGxhbmVzOwogICAgCQlsZXQgZHN0UGxhbmVzID0gbnVsbDsKCiAgICAJCWlmICggc3JjUGxhbmVzICE9PSBudWxsICkgewoKICAgIAkJCWNvbnN0IG4gPSBzcmNQbGFuZXMubGVuZ3RoOwogICAgCQkJZHN0UGxhbmVzID0gbmV3IEFycmF5KCBuICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJCQlkc3RQbGFuZXNbIGkgXSA9IHNyY1BsYW5lc1sgaSBdLmNsb25lKCk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJdGhpcy5jbGlwcGluZ1BsYW5lcyA9IGRzdFBsYW5lczsKICAgIAkJdGhpcy5jbGlwSW50ZXJzZWN0aW9uID0gc291cmNlLmNsaXBJbnRlcnNlY3Rpb247CiAgICAJCXRoaXMuY2xpcFNoYWRvd3MgPSBzb3VyY2UuY2xpcFNoYWRvd3M7CgogICAgCQl0aGlzLnNoYWRvd1NpZGUgPSBzb3VyY2Uuc2hhZG93U2lkZTsKCiAgICAJCXRoaXMuY29sb3JXcml0ZSA9IHNvdXJjZS5jb2xvcldyaXRlOwoKICAgIAkJdGhpcy5wcmVjaXNpb24gPSBzb3VyY2UucHJlY2lzaW9uOwoKICAgIAkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gc291cmNlLnBvbHlnb25PZmZzZXQ7CiAgICAJCXRoaXMucG9seWdvbk9mZnNldEZhY3RvciA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0RmFjdG9yOwogICAgCQl0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0VW5pdHM7CgogICAgCQl0aGlzLmRpdGhlcmluZyA9IHNvdXJjZS5kaXRoZXJpbmc7CgogICAgCQl0aGlzLmFscGhhVGVzdCA9IHNvdXJjZS5hbHBoYVRlc3Q7CiAgICAJCXRoaXMuYWxwaGFIYXNoID0gc291cmNlLmFscGhhSGFzaDsKICAgIAkJdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBzb3VyY2UuYWxwaGFUb0NvdmVyYWdlOwogICAgCQl0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBsaWVkQWxwaGE7CiAgICAJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gc291cmNlLmZvcmNlU2luZ2xlUGFzczsKCiAgICAJCXRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwoKICAgIAkJdGhpcy50b25lTWFwcGVkID0gc291cmNlLnRvbmVNYXBwZWQ7CgogICAgCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBGcmVlcyB0aGUgR1BVLXJlbGF0ZWQgcmVzb3VyY2VzIGFsbG9jYXRlZCBieSB0aGlzIGluc3RhbmNlLiBDYWxsIHRoaXMKICAgIAkgKiBtZXRob2Qgd2hlbmV2ZXIgdGhpcyBpbnN0YW5jZSBpcyBubyBsb25nZXIgdXNlZCBpbiB5b3VyIGFwcC4KICAgIAkgKgogICAgCSAqIEBmaXJlcyBNYXRlcmlhbCNkaXNwb3NlCiAgICAJICovCiAgICAJZGlzcG9zZSgpIHsKCiAgICAJCS8qKgogICAgCQkgKiBGaXJlcyB3aGVuIHRoZSBtYXRlcmlhbCBoYXMgYmVlbiBkaXNwb3NlZCBvZi4KICAgIAkJICoKICAgIAkJICogQGV2ZW50IE1hdGVyaWFsI2Rpc3Bvc2UKICAgIAkJICogQHR5cGUge09iamVjdH0KICAgIAkJICovCiAgICAJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHRpbmcgdGhpcyBwcm9wZXJ0eSB0byBgdHJ1ZWAgaW5kaWNhdGVzIHRoZSBlbmdpbmUgdGhlIG1hdGVyaWFsCiAgICAJICogbmVlZHMgdG8gYmUgcmVjb21waWxlZC4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtib29sZWFufQogICAgCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQogICAgCSAqLwogICAgCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgogICAgCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSBtYXRlcmlhbCBmb3IgZHJhd2luZyBnZW9tZXRyaWVzIGluIGEgc2ltcGxlIHNoYWRlZCAoZmxhdCBvciB3aXJlZnJhbWUpIHdheS4KICAgICAqCiAgICAgKiBUaGlzIG1hdGVyaWFsIGlzIG5vdCBhZmZlY3RlZCBieSBsaWdodHMuCiAgICAgKgogICAgICogQGF1Z21lbnRzIE1hdGVyaWFsCiAgICAgKi8KICAgIGNsYXNzIE1lc2hCYXNpY01hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2ggYmFzaWMgbWF0ZXJpYWwuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0gW3BhcmFtZXRlcnNdIC0gQW4gb2JqZWN0IHdpdGggb25lIG9yIG1vcmUgcHJvcGVydGllcwogICAgCSAqIGRlZmluaW5nIHRoZSBtYXRlcmlhbCdzIGFwcGVhcmFuY2UuIEFueSBwcm9wZXJ0eSBvZiB0aGUgbWF0ZXJpYWwKICAgIAkgKiAoaW5jbHVkaW5nIGFueSBwcm9wZXJ0eSBmcm9tIGluaGVyaXRlZCBtYXRlcmlhbHMpIGNhbiBiZSBwYXNzZWQKICAgIAkgKiBpbiBoZXJlLiBDb2xvciB2YWx1ZXMgY2FuIGJlIHBhc3NlZCBhbnkgdHlwZSBvZiB2YWx1ZSBhY2NlcHRlZAogICAgCSAqIGJ5IHtAbGluayBDb2xvciNzZXR9LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzTWVzaEJhc2ljTWF0ZXJpYWwgPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ01lc2hCYXNpY01hdGVyaWFsJzsKCiAgICAJCS8qKgogICAgCQkgKiBDb2xvciBvZiB0aGUgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtDb2xvcn0KICAgIAkJICogQGRlZmF1bHQgKDEsMSwxKQogICAgCQkgKi8KICAgIAkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZW1pc3NpdmUKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAogICAgCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uIFRoZSB0ZXh0dXJlIG1hcAogICAgCQkgKiBjb2xvciBpcyBtb2R1bGF0ZWQgYnkgdGhlIGRpZmZ1c2UgYGNvbG9yYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLm1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGxpZ2h0IG1hcC4gUmVxdWlyZXMgYSBzZWNvbmQgc2V0IG9mIFVWcy4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBJbnRlbnNpdHkgb2YgdGhlIGJha2VkIGxpZ2h0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSByZWQgY2hhbm5lbCBvZiB0aGlzIHRleHR1cmUgaXMgdXNlZCBhcyB0aGUgYW1iaWVudCBvY2NsdXNpb24gbWFwLgogICAgCQkgKiBSZXF1aXJlcyBhIHNlY29uZCBzZXQgb2YgVVZzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYW9NYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEludGVuc2l0eSBvZiB0aGUgYW1iaWVudCBvY2NsdXNpb24gZWZmZWN0LiBSYW5nZSBpcyBgWzAsMV1gLCB3aGVyZSBgMGAKICAgIAkJICogZGlzYWJsZXMgYW1iaWVudCBvY2NsdXNpb24uIFdoZXJlIGludGVuc2l0eSBpcyBgMWAgYW5kIHRoZSBBTyBtYXAncwogICAgCQkgKiByZWQgY2hhbm5lbCBpcyBhbHNvIGAxYCwgYW1iaWVudCBsaWdodCBpcyBmdWxseSBvY2NsdWRlZCBvbiBhIHN1cmZhY2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSAxLjA7CgogICAgCQkvKioKICAgIAkJICogU3BlY3VsYXIgbWFwIHVzZWQgYnkgdGhlIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKICAgIAkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KICAgIAkJICoKICAgIAkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCiAgICAJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCiAgICAJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKICAgIAkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAogICAgCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGVudmlyb25tZW50IG1hcC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmVudk1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBlbnZpcm9ubWVudCBtYXAgaW4gcmFkaWFucy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0V1bGVyfQogICAgCQkgKiBAZGVmYXVsdCAoMCwwLDApCiAgICAJCSAqLwogICAgCQl0aGlzLmVudk1hcFJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CgogICAgCQkvKioKICAgIAkJICogSG93IHRvIGNvbWJpbmUgdGhlIHJlc3VsdCBvZiB0aGUgc3VyZmFjZSdzIGNvbG9yIHdpdGggdGhlIGVudmlyb25tZW50IG1hcCwgaWYgYW55LgogICAgCQkgKgogICAgCQkgKiBXaGVuIHNldCB0byBgTWl4T3BlcmF0aW9uYCwgdGhlIHtAbGluayBNZXNoQmFzaWNNYXRlcmlhbCNyZWZsZWN0aXZpdHl9IGlzIHVzZWQgdG8KICAgIAkJICogYmxlbmQgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycy4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhNdWx0aXBseU9wZXJhdGlvbnxNaXhPcGVyYXRpb258QWRkT3BlcmF0aW9uKX0KICAgIAkJICogQGRlZmF1bHQgTXVsdGlwbHlPcGVyYXRpb24KICAgIAkJICovCiAgICAJCXRoaXMuY29tYmluZSA9IE11bHRpcGx5T3BlcmF0aW9uOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyBtdWNoIHRoZSBlbnZpcm9ubWVudCBtYXAgYWZmZWN0cyB0aGUgc3VyZmFjZS4KICAgIAkJICogVGhlIHZhbGlkIHJhbmdlIGlzIGJldHdlZW4gYDBgIChubyByZWZsZWN0aW9ucykgYW5kIGAxYCAoZnVsbCByZWZsZWN0aW9ucykuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMucmVmbGVjdGl2aXR5ID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgaW5kZXggb2YgcmVmcmFjdGlvbiAoSU9SKSBvZiBhaXIgKGFwcHJveGltYXRlbHkgMSkgZGl2aWRlZCBieSB0aGUKICAgIAkJICogaW5kZXggb2YgcmVmcmFjdGlvbiBvZiB0aGUgbWF0ZXJpYWwuIEl0IGlzIHVzZWQgd2l0aCBlbnZpcm9ubWVudCBtYXBwaW5nCiAgICAJCSAqIG1vZGVzIHtAbGluayBDdWJlUmVmcmFjdGlvbk1hcHBpbmd9IGFuZCB7QGxpbmsgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmd9LgogICAgCQkgKiBUaGUgcmVmcmFjdGlvbiByYXRpbyBzaG91bGQgbm90IGV4Y2VlZCBgMWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAuOTgKICAgIAkJICovCiAgICAJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCiAgICAJCS8qKgogICAgCQkgKiBSZW5kZXJzIHRoZSBnZW9tZXRyeSBhcyBhIHdpcmVmcmFtZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIENvbnRyb2xzIHRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZS4KICAgIAkJICoKICAgIAkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIGFwcGVhcmFuY2Ugb2Ygd2lyZWZyYW1lIGVuZHMuCiAgICAJCSAqCiAgICAJCSAqIENhbiBvbmx5IGJlIHVzZWQgd2l0aCB7QGxpbmsgU1ZHUmVuZGVyZXJ9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KCdyb3VuZCd8J2JldmVsJ3wnbWl0ZXInKX0KICAgIAkJICogQGRlZmF1bHQgJ3JvdW5kJwogICAgCQkgKi8KICAgIAkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIGFwcGVhcmFuY2Ugb2Ygd2lyZWZyYW1lIGpvaW50cy4KICAgIAkJICoKICAgIAkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoJ3JvdW5kJ3wnYmV2ZWwnfCdtaXRlcicpfQogICAgCQkgKiBAZGVmYXVsdCAncm91bmQnCiAgICAJCSAqLwogICAgCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRoZSBtYXRlcmlhbCBpcyBhZmZlY3RlZCBieSBmb2cgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5mb2cgPSB0cnVlOwoKICAgIAkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCiAgICAJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgogICAgCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgogICAgCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwogICAgCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKICAgIAkJdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKICAgIAkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCiAgICAJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgogICAgCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKICAgIAkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwogICAgCQl0aGlzLmVudk1hcFJvdGF0aW9uLmNvcHkoIHNvdXJjZS5lbnZNYXBSb3RhdGlvbiApOwogICAgCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKICAgIAkJdGhpcy5yZWZsZWN0aXZpdHkgPSBzb3VyY2UucmVmbGVjdGl2aXR5OwogICAgCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CgogICAgCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CiAgICAJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKICAgIAkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CiAgICAJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgogICAgCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfdmVjdG9yJDkgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdmVjdG9yMiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKICAgIGxldCBfaWQkMiA9IDA7CgogICAgLyoqCiAgICAgKiBUaGlzIGNsYXNzIHN0b3JlcyBkYXRhIGZvciBhbiBhdHRyaWJ1dGUgKHN1Y2ggYXMgdmVydGV4IHBvc2l0aW9ucywgZmFjZQogICAgICogaW5kaWNlcywgbm9ybWFscywgY29sb3JzLCBVVnMsIGFuZCBhbnkgY3VzdG9tIGF0dHJpYnV0ZXMgKSBhc3NvY2lhdGVkIHdpdGgKICAgICAqIGEgZ2VvbWV0cnksIHdoaWNoIGFsbG93cyBmb3IgbW9yZSBlZmZpY2llbnQgcGFzc2luZyBvZiBkYXRhIHRvIHRoZSBHUFUuCiAgICAgKgogICAgICogV2hlbiB3b3JraW5nIHdpdGggdmVjdG9yLWxpa2UgZGF0YSwgdGhlIGBmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4IClgCiAgICAgKiBoZWxwZXIgbWV0aG9kcyBvbiB2ZWN0b3IgYW5kIGNvbG9yIGNsYXNzIG1pZ2h0IGJlIGhlbHBmdWwuIEUuZy4ge0BsaW5rIFZlY3RvcjMjZnJvbUJ1ZmZlckF0dHJpYnV0ZX0uCiAgICAgKi8KICAgIGNsYXNzIEJ1ZmZlckF0dHJpYnV0ZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgPSBmYWxzZSApIHsKCiAgICAJCWlmICggQXJyYXkuaXNBcnJheSggYXJyYXkgKSApIHsKCiAgICAJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4nICk7CgogICAgCQl9CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0J1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIElEIG9mIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCQkgKgogICAgCQkgKiBAbmFtZSBCdWZmZXJBdHRyaWJ1dGUjaWQKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQyICsrIH0gKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbmFtZSBvZiB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMubmFtZSA9ICcnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4gSXQgc2hvdWxkIGhhdmUgYGl0ZW1TaXplICogbnVtVmVydGljZXNgCiAgICAJCSAqIGVsZW1lbnRzLCB3aGVyZSBgbnVtVmVydGljZXNgIGlzIHRoZSBudW1iZXIgb2YgdmVydGljZXMgaW4gdGhlIGFzc29jaWF0ZWQgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtUeXBlZEFycmF5fQogICAgCQkgKi8KICAgIAkJdGhpcy5hcnJheSA9IGFycmF5OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBudW1iZXIgb2YgdmFsdWVzIG9mIHRoZSBhcnJheSB0aGF0IHNob3VsZCBiZSBhc3NvY2lhdGVkIHdpdGggYSBwYXJ0aWN1bGFyIHZlcnRleC4KICAgIAkJICogRm9yIGluc3RhbmNlLCBpZiB0aGlzIGF0dHJpYnV0ZSBpcyBzdG9yaW5nIGEgMy1jb21wb25lbnQgdmVjdG9yIChzdWNoIGFzIGEgcG9zaXRpb24sCiAgICAJCSAqIG5vcm1hbCwgb3IgY29sb3IpLCB0aGVuIHRoZSB2YWx1ZSBzaG91bGQgYmUgYDNgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoKICAgIAkJLyoqCiAgICAJCSAqIFJlcHJlc2VudHMgdGhlIG51bWJlciBvZiBpdGVtcyB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUgc3RvcmVzLiBJdCBpcyBpbnRlcm5hbGx5IGNvbXB1dGVkCiAgICAJCSAqIGJ5IGRpdmlkaW5nIHRoZSBgYXJyYXlgIGxlbmd0aCBieSB0aGUgYGl0ZW1TaXplYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQl0aGlzLmNvdW50ID0gYXJyYXkgIT09IHVuZGVmaW5lZCA/IGFycmF5Lmxlbmd0aCAvIGl0ZW1TaXplIDogMDsKCiAgICAJCS8qKgogICAgCQkgKiBBcHBsaWVzIHRvIGludGVnZXIgZGF0YSBvbmx5LiBJbmRpY2F0ZXMgaG93IHRoZSB1bmRlcmx5aW5nIGRhdGEgaW4gdGhlIGJ1ZmZlciBtYXBzIHRvCiAgICAJCSAqIHRoZSB2YWx1ZXMgaW4gdGhlIEdMU0wgY29kZS4gRm9yIGluc3RhbmNlLCBpZiBgYXJyYXlgIGlzIGFuIGluc3RhbmNlIG9mIGBVSW50MTZBcnJheWAsCiAgICAJCSAqIGFuZCBgbm9ybWFsaXplZGAgaXMgYHRydWVgLCB0aGUgdmFsdWVzIGAwIC0gKzY1NTM1YCBpbiB0aGUgYXJyYXkgZGF0YSB3aWxsIGJlIG1hcHBlZCB0bwogICAgCQkgKiBgMC4wZiAtICsxLjBmYCBpbiB0aGUgR0xTTCBhdHRyaWJ1dGUuIElmIGBub3JtYWxpemVkYCBpcyBgZmFsc2VgLCB0aGUgdmFsdWVzIHdpbGwgYmUgY29udmVydGVkCiAgICAJCSAqIHRvIGZsb2F0cyB1bm1vZGlmaWVkLCBpLmUuIGA2NTUzNWAgYmVjb21lcyBgNjU1MzUuMGZgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICovCiAgICAJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQ7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgaW50ZW5kZWQgdXNhZ2UgcGF0dGVybiBvZiB0aGUgZGF0YSBzdG9yZSBmb3Igb3B0aW1pemF0aW9uIHB1cnBvc2VzLgogICAgCQkgKgogICAgCQkgKiBOb3RlOiBBZnRlciB0aGUgaW5pdGlhbCB1c2Ugb2YgYSBidWZmZXIsIGl0cyB1c2FnZSBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwKICAgIAkJICogaW5zdGFudGlhdGUgYSBuZXcgb25lIGFuZCBzZXQgdGhlIGRlc2lyZWQgdXNhZ2UgYmVmb3JlIHRoZSBuZXh0IHJlbmRlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhTdGF0aWNEcmF3VXNhZ2V8RHluYW1pY0RyYXdVc2FnZXxTdHJlYW1EcmF3VXNhZ2V8U3RhdGljUmVhZFVzYWdlfER5bmFtaWNSZWFkVXNhZ2V8U3RyZWFtUmVhZFVzYWdlfFN0YXRpY0NvcHlVc2FnZXxEeW5hbWljQ29weVVzYWdlfFN0cmVhbUNvcHlVc2FnZSl9CiAgICAJCSAqIEBkZWZhdWx0IFN0YXRpY0RyYXdVc2FnZQogICAgCQkgKi8KICAgIAkJdGhpcy51c2FnZSA9IFN0YXRpY0RyYXdVc2FnZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIG9ubHkgdXBkYXRlIHNvbWUgY29tcG9uZW50cyBvZiBzdG9yZWQgdmVjdG9ycyAoZm9yIGV4YW1wbGUsIGp1c3QgdGhlCiAgICAJCSAqIGNvbXBvbmVudCByZWxhdGVkIHRvIGNvbG9yKS4gVXNlIHRoZSBgYWRkVXBkYXRlUmFuZ2UoKWAgZnVuY3Rpb24gdG8gYWRkIHJhbmdlcyB0byB0aGlzIGFycmF5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0Pn0KICAgIAkJICovCiAgICAJCXRoaXMudXBkYXRlUmFuZ2VzID0gW107CgogICAgCQkvKioKICAgIAkJICogQ29uZmlndXJlcyB0aGUgYm91bmQgR1BVIHR5cGUgZm9yIHVzZSBpbiBzaGFkZXJzLgogICAgCQkgKgogICAgCQkgKiBOb3RlOiB0aGlzIG9ubHkgaGFzIGFuIGVmZmVjdCBmb3IgaW50ZWdlciBhcnJheXMgYW5kIGlzIG5vdCBjb25maWd1cmFibGUgZm9yIGZsb2F0IGFycmF5cy4KICAgIAkJICogRm9yIGxvd2VyIHByZWNpc2lvbiBmbG9hdCB0eXBlcywgdXNlIGBGbG9hdDE2QnVmZmVyQXR0cmlidXRlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhGbG9hdFR5cGV8SW50VHlwZSl9CiAgICAJCSAqIEBkZWZhdWx0IEZsb2F0VHlwZQogICAgCQkgKi8KICAgIAkJdGhpcy5ncHVUeXBlID0gRmxvYXRUeXBlOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgdmVyc2lvbiBudW1iZXIsIGluY3JlbWVudGVkIGV2ZXJ5IHRpbWUgdGhlIGBuZWVkc1VwZGF0ZWAgaXMgc2V0IHRvIGB0cnVlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMudmVyc2lvbiA9IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIGFmdGVyIHRoZSByZW5kZXJlciBoYXMgdHJhbnNmZXJyZWQgdGhlIGF0dHJpYnV0ZQogICAgCSAqIGFycmF5IGRhdGEgdG8gdGhlIEdQVS4KICAgIAkgKi8KICAgIAlvblVwbG9hZENhbGxiYWNrKCkge30KCiAgICAJLyoqCiAgICAJICogRmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoaXMgYXR0cmlidXRlIGhhcyBjaGFuZ2VkIGFuZCBzaG91bGQgYmUgcmUtc2VudCB0bwogICAgCSAqIHRoZSBHUFUuIFNldCB0aGlzIHRvIGB0cnVlYCB3aGVuIHlvdSBtb2RpZnkgdGhlIHZhbHVlIG9mIHRoZSBhcnJheS4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgZmFsc2UKICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAgICAJICovCiAgICAJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCiAgICAJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdXNhZ2Ugb2YgdGhpcyBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHsoU3RhdGljRHJhd1VzYWdlfER5bmFtaWNEcmF3VXNhZ2V8U3RyZWFtRHJhd1VzYWdlfFN0YXRpY1JlYWRVc2FnZXxEeW5hbWljUmVhZFVzYWdlfFN0cmVhbVJlYWRVc2FnZXxTdGF0aWNDb3B5VXNhZ2V8RHluYW1pY0NvcHlVc2FnZXxTdHJlYW1Db3B5VXNhZ2UpfSB2YWx1ZSAtIFRoZSB1c2FnZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICovCiAgICAJc2V0VXNhZ2UoIHZhbHVlICkgewoKICAgIAkJdGhpcy51c2FnZSA9IHZhbHVlOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyBhIHJhbmdlIG9mIGRhdGEgaW4gdGhlIGRhdGEgYXJyYXkgdG8gYmUgdXBkYXRlZCBvbiB0aGUgR1BVLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gUG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgdXBkYXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIFRoZSBudW1iZXIgb2YgY29tcG9uZW50cyB0byB1cGRhdGUuCiAgICAJICovCiAgICAJYWRkVXBkYXRlUmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCiAgICAJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDbGVhcnMgdGhlIHVwZGF0ZSByYW5nZXMuCiAgICAJICovCiAgICAJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgogICAgCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gc291cmNlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weSggc291cmNlICkgewoKICAgIAkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CiAgICAJCXRoaXMuYXJyYXkgPSBuZXcgc291cmNlLmFycmF5LmNvbnN0cnVjdG9yKCBzb3VyY2UuYXJyYXkgKTsKICAgIAkJdGhpcy5pdGVtU2l6ZSA9IHNvdXJjZS5pdGVtU2l6ZTsKICAgIAkJdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKICAgIAkJdGhpcy5ub3JtYWxpemVkID0gc291cmNlLm5vcm1hbGl6ZWQ7CgogICAgCQl0aGlzLnVzYWdlID0gc291cmNlLnVzYWdlOwogICAgCQl0aGlzLmdwdVR5cGUgPSBzb3VyY2UuZ3B1VHlwZTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyBhIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlIHRvIHRoaXMgb25lLiBUaGUgc3RhcnQKICAgIAkgKiBhbmQgZGVzdGluYXRpb24gcG9zaXRpb24gaW4gdGhlIGF0dHJpYnV0ZSBidWZmZXJzIGFyZSByZXByZXNlbnRlZCBieSB0aGUKICAgIAkgKiBnaXZlbiBpbmRpY2VzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4MSAtIFRoZSBkZXN0aW5hdGlvbiBpbmRleCBpbnRvIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gY29weSBmcm9tLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleDIgLSBUaGUgc291cmNlIGluZGV4IGludG8gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNvcHlBdCggaW5kZXgxLCBhdHRyaWJ1dGUsIGluZGV4MiApIHsKCiAgICAJCWluZGV4MSAqPSB0aGlzLml0ZW1TaXplOwogICAgCQlpbmRleDIgKj0gYXR0cmlidXRlLml0ZW1TaXplOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5pdGVtU2l6ZTsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJdGhpcy5hcnJheVsgaW5kZXgxICsgaSBdID0gYXR0cmlidXRlLmFycmF5WyBpbmRleDIgKyBpIF07CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIGdpdmVuIGFycmF5IGRhdGEgaW50byB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhUeXBlZEFycmF5fEFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weUFycmF5KCBhcnJheSApIHsKCiAgICAJCXRoaXMuYXJyYXkuc2V0KCBhcnJheSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gM3gzIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBXb3JrcyB3aXRoCiAgICAJICogaXRlbSBzaXplIGAyYCBhbmQgYDNgLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXgzKCBtICkgewoKICAgIAkJaWYgKCB0aGlzLml0ZW1TaXplID09PSAyICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQlfdmVjdG9yMiQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKICAgIAkJCQlfdmVjdG9yMiQxLmFwcGx5TWF0cml4MyggbSApOwoKICAgIAkJCQl0aGlzLnNldFhZKCBpLCBfdmVjdG9yMiQxLngsIF92ZWN0b3IyJDEueSApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSBpZiAoIHRoaXMuaXRlbVNpemUgPT09IDMgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CiAgICAJCQkJX3ZlY3RvciQ5LmFwcGx5TWF0cml4MyggbSApOwoKICAgIAkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgdGhlIGdpdmVuIDR4NCBtYXRyaXggdG8gdGhlIGdpdmVuIGF0dHJpYnV0ZS4gT25seSB3b3JrcyB3aXRoCiAgICAJICogaXRlbSBzaXplIGAzYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbSApIHsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgogICAgCQkJX3ZlY3RvciQ5LmFwcGx5TWF0cml4NCggbSApOwoKICAgIAkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBcHBsaWVzIHRoZSBnaXZlbiAzeDMgbm9ybWFsIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKICAgIAkgKiBpdGVtIHNpemUgYDNgLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG5vcm1hbCBtYXRyaXggdG8gYXBwbHkuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCiAgICAJCQlfdmVjdG9yJDkuYXBwbHlOb3JtYWxNYXRyaXgoIG0gKTsKCiAgICAJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKICAgIAkgKiBpdGVtIHNpemUgYDNgIGFuZCB3aXRoIGRpcmVjdGlvbiB2ZWN0b3JzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdHJhbnNmb3JtRGlyZWN0aW9uKCBtICkgewoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCiAgICAJCQlfdmVjdG9yJDkudHJhbnNmb3JtRGlyZWN0aW9uKCBtICk7CgogICAgCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkOS54LCBfdmVjdG9yJDkueSwgX3ZlY3RvciQ5LnogKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIGFycmF5IGRhdGEgaW4gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhUeXBlZEFycmF5fEFycmF5KX0gdmFsdWUgLSBUaGUgYXJyYXkgZGF0YSB0byBzZXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBUaGUgb2Zmc2V0IGluIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZSdzIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXQoIHZhbHVlLCBvZmZzZXQgPSAwICkgewoKICAgIAkJLy8gTWF0Y2hpbmcgQnVmZmVyQXR0cmlidXRlIGNvbnN0cnVjdG9yLCBkbyBub3Qgbm9ybWFsaXplIHRoZSBhcnJheS4KICAgIAkJdGhpcy5hcnJheS5zZXQoIHZhbHVlLCBvZmZzZXQgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGdpdmVuIGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBjb21wb25lbnQgLSBUaGUgY29tcG9uZW50IGluZGV4LgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJldHVybmVkIHZhbHVlLgogICAgCSAqLwogICAgCWdldENvbXBvbmVudCggaW5kZXgsIGNvbXBvbmVudCApIHsKCiAgICAJCWxldCB2YWx1ZSA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdOwoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IGRlbm9ybWFsaXplKCB2YWx1ZSwgdGhpcy5hcnJheSApOwoKICAgIAkJcmV0dXJuIHZhbHVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBnaXZlbiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gY29tcG9uZW50IC0gVGhlIGNvbXBvbmVudCBpbmRleC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRDb21wb25lbnQoIGluZGV4LCBjb21wb25lbnQsIHZhbHVlICkgewoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IG5vcm1hbGl6ZSQzKCB2YWx1ZSwgdGhpcy5hcnJheSApOwoKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgY29tcG9uZW50IF0gPSB2YWx1ZTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgeCBjb21wb25lbnQuCiAgICAJICovCiAgICAJZ2V0WCggaW5kZXggKSB7CgogICAgCQlsZXQgeCA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSBdOwoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gZGVub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCiAgICAJCXJldHVybiB4OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRYKCBpbmRleCwgeCApIHsKCiAgICAJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeCA9IG5vcm1hbGl6ZSQzKCB4LCB0aGlzLmFycmF5ICk7CgogICAgCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgXSA9IHg7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHkgY29tcG9uZW50LgogICAgCSAqLwogICAgCWdldFkoIGluZGV4ICkgewoKICAgIAkJbGV0IHkgPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxIF07CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBkZW5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKICAgIAkJcmV0dXJuIHk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeSBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFkoIGluZGV4LCB5ICkgewoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB5ID0gbm9ybWFsaXplJDMoIHksIHRoaXMuYXJyYXkgKTsKCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXSA9IHk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSB6IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHogY29tcG9uZW50LgogICAgCSAqLwogICAgCWdldFooIGluZGV4ICkgewoKICAgIAkJbGV0IHogPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF07CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBkZW5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKICAgIAkJcmV0dXJuIHo7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFooIGluZGV4LCB6ICkgewoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB6ID0gbm9ybWFsaXplJDMoIHosIHRoaXMuYXJyYXkgKTsKCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDIgXSA9IHo7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSB3IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHcgY29tcG9uZW50LgogICAgCSAqLwogICAgCWdldFcoIGluZGV4ICkgewoKICAgIAkJbGV0IHcgPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzIF07CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBkZW5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKICAgIAkJcmV0dXJuIHc7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdyBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdyAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFcoIGluZGV4LCB3ICkgewoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB3ID0gbm9ybWFsaXplJDMoIHcsIHRoaXMuYXJyYXkgKTsKCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDMgXSA9IHc7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB4IGFuZCB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIGZvciB0aGUgeCBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIGZvciB0aGUgeSBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRYWSggaW5kZXgsIHgsIHkgKSB7CgogICAgCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgogICAgCQkJeCA9IG5vcm1hbGl6ZSQzKCB4LCB0aGlzLmFycmF5ICk7CiAgICAJCQl5ID0gbm9ybWFsaXplJDMoIHksIHRoaXMuYXJyYXkgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeCwgeSBhbmQgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSBmb3IgdGhlIHggY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSBmb3IgdGhlIHkgY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBmb3IgdGhlIHogY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0WFlaKCBpbmRleCwgeCwgeSwgeiApIHsKCiAgICAJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCiAgICAJCQl4ID0gbm9ybWFsaXplJDMoIHgsIHRoaXMuYXJyYXkgKTsKICAgIAkJCXkgPSBub3JtYWxpemUkMyggeSwgdGhpcy5hcnJheSApOwogICAgCQkJeiA9IG5vcm1hbGl6ZSQzKCB6LCB0aGlzLmFycmF5ICk7CgogICAgCQl9CgogICAgCQl0aGlzLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKyAyIF0gPSB6OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeCwgeSwgeiBhbmQgdyBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSBmb3IgdGhlIHggY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSBmb3IgdGhlIHkgY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBmb3IgdGhlIHogY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdyAtIFRoZSB2YWx1ZSBmb3IgdGhlIHcgY29tcG9uZW50IHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0WFlaVyggaW5kZXgsIHgsIHksIHosIHcgKSB7CgogICAgCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgogICAgCQkJeCA9IG5vcm1hbGl6ZSQzKCB4LCB0aGlzLmFycmF5ICk7CiAgICAJCQl5ID0gbm9ybWFsaXplJDMoIHksIHRoaXMuYXJyYXkgKTsKICAgIAkJCXogPSBub3JtYWxpemUkMyggeiwgdGhpcy5hcnJheSApOwogICAgCQkJdyA9IG5vcm1hbGl6ZSQzKCB3LCB0aGlzLmFycmF5ICk7CgogICAgCQl9CgogICAgCQl0aGlzLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKyAyIF0gPSB6OwogICAgCQl0aGlzLmFycmF5WyBpbmRleCArIDMgXSA9IHc7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIGFmdGVyIHRoZSBSZW5kZXJlciBoYXMgdHJhbnNmZXJyZWQKICAgIAkgKiB0aGUgYXR0cmlidXRlIGFycmF5IGRhdGEgdG8gdGhlIEdQVS4gQ2FuIGJlIHVzZWQgdG8gcGVyZm9ybSBjbGVhbi11cCBvcGVyYXRpb25zIGFmdGVyCiAgICAJICogdGhlIHVwbG9hZCB3aGVuIGF0dHJpYnV0ZSBkYXRhIGFyZSBub3QgbmVlZGVkIGFueW1vcmUgb24gdGhlIENQVSBzaWRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBUaGUgYG9uVXBsb2FkKClgIGNhbGxiYWNrLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlvblVwbG9hZCggY2FsbGJhY2sgKSB7CgogICAgCQl0aGlzLm9uVXBsb2FkQ2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuYXJyYXksIHRoaXMuaXRlbVNpemUgKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VyaWFsaXplcyB0aGUgYnVmZmVyIGF0dHJpYnV0ZSBpbnRvIEpTT04uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICovCiAgICAJdG9KU09OKCkgewoKICAgIAkJY29uc3QgZGF0YSA9IHsKICAgIAkJCWl0ZW1TaXplOiB0aGlzLml0ZW1TaXplLAogICAgCQkJdHlwZTogdGhpcy5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLAogICAgCQkJYXJyYXk6IEFycmF5LmZyb20oIHRoaXMuYXJyYXkgKSwKICAgIAkJCW5vcm1hbGl6ZWQ6IHRoaXMubm9ybWFsaXplZAogICAgCQl9OwoKICAgIAkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwogICAgCQlpZiAoIHRoaXMudXNhZ2UgIT09IFN0YXRpY0RyYXdVc2FnZSApIGRhdGEudXNhZ2UgPSB0aGlzLnVzYWdlOwoKICAgIAkJcmV0dXJuIGRhdGE7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW50IGNsYXNzIHRoYXQgY2FuIGJlIHVzZWQgd2hlbiBjcmVhdGluZyBhIGBVSW50MTZgIGJ1ZmZlciBhdHRyaWJ1dGUgd2l0aAogICAgICogYSBwbGFpbiBgQXJyYXlgIGluc3RhbmNlLgogICAgICoKICAgICAqIEBhdWdtZW50cyBCdWZmZXJBdHRyaWJ1dGUKICAgICAqLwogICAgY2xhc3MgVWludDE2QnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHsoQXJyYXk8bnVtYmVyPnxVaW50MTZBcnJheSl9IGFycmF5IC0gVGhlIGFycmF5IGhvbGRpbmcgdGhlIGF0dHJpYnV0ZSBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpdGVtU2l6ZSAtIFRoZSBpdGVtIHNpemUuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbbm9ybWFsaXplZD1mYWxzZV0gLSBXaGV0aGVyIHRoZSBkYXRhIGFyZSBub3JtYWxpemVkIG9yIG5vdC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKICAgIAkJc3VwZXIoIG5ldyBVaW50MTZBcnJheSggYXJyYXkgKSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbnQgY2xhc3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIGEgYFVJbnQzMmAgYnVmZmVyIGF0dHJpYnV0ZSB3aXRoCiAgICAgKiBhIHBsYWluIGBBcnJheWAgaW5zdGFuY2UuCiAgICAgKgogICAgICogQGF1Z21lbnRzIEJ1ZmZlckF0dHJpYnV0ZQogICAgICovCiAgICBjbGFzcyBVaW50MzJCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fFVpbnQzMkFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgogICAgCQlzdXBlciggbmV3IFVpbnQzMkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVudCBjbGFzcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgYSBgRmxvYXQzMmAgYnVmZmVyIGF0dHJpYnV0ZSB3aXRoCiAgICAgKiBhIHBsYWluIGBBcnJheWAgaW5zdGFuY2UuCiAgICAgKgogICAgICogQGF1Z21lbnRzIEJ1ZmZlckF0dHJpYnV0ZQogICAgICovCiAgICBjbGFzcyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHsoQXJyYXk8bnVtYmVyPnxGbG9hdDMyQXJyYXkpfSBhcnJheSAtIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaXRlbVNpemUgLSBUaGUgaXRlbSBzaXplLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW25vcm1hbGl6ZWQ9ZmFsc2VdIC0gV2hldGhlciB0aGUgZGF0YSBhcmUgbm9ybWFsaXplZCBvciBub3QuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCiAgICAJCXN1cGVyKCBuZXcgRmxvYXQzMkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKICAgIAl9CgogICAgfQoKICAgIGxldCBfaWQkMSA9IDA7CgogICAgY29uc3QgX20xJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CiAgICBjb25zdCBfb2JqID0gLypAX19QVVJFX18qLyBuZXcgT2JqZWN0M0QoKTsKICAgIGNvbnN0IF9vZmZzZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfYm94JDIgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CiAgICBjb25zdCBfYm94TW9ycGhUYXJnZXRzID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwogICAgY29uc3QgX3ZlY3RvciQ4ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIC8qKgogICAgICogQSByZXByZXNlbnRhdGlvbiBvZiBtZXNoLCBsaW5lLCBvciBwb2ludCBnZW9tZXRyeS4gSW5jbHVkZXMgdmVydGV4CiAgICAgKiBwb3NpdGlvbnMsIGZhY2UgaW5kaWNlcywgbm9ybWFscywgY29sb3JzLCBVVnMsIGFuZCBjdXN0b20gYXR0cmlidXRlcwogICAgICogd2l0aGluIGJ1ZmZlcnMsIHJlZHVjaW5nIHRoZSBjb3N0IG9mIHBhc3NpbmcgYWxsIHRoaXMgZGF0YSB0byB0aGUgR1BVLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpOwogICAgICogLy8gY3JlYXRlIGEgc2ltcGxlIHNxdWFyZSBzaGFwZS4gV2UgZHVwbGljYXRlIHRoZSB0b3AgbGVmdCBhbmQgYm90dG9tIHJpZ2h0CiAgICAgKiAvLyB2ZXJ0aWNlcyBiZWNhdXNlIGVhY2ggdmVydGV4IG5lZWRzIHRvIGFwcGVhciBvbmNlIHBlciB0cmlhbmdsZS4KICAgICAqIGNvbnN0IHZlcnRpY2VzID0gbmV3IEZsb2F0MzJBcnJheSggWwogICAgICogCS0xLjAsIC0xLjAsICAxLjAsIC8vIHYwCiAgICAgKiAJIDEuMCwgLTEuMCwgIDEuMCwgLy8gdjEKICAgICAqIAkgMS4wLCAgMS4wLCAgMS4wLCAvLyB2MgogICAgICoKICAgICAqIAkgMS4wLCAgMS4wLCAgMS4wLCAvLyB2MwogICAgICogCS0xLjAsICAxLjAsICAxLjAsIC8vIHY0CiAgICAgKiAJLTEuMCwgLTEuMCwgIDEuMCAgLy8gdjUKICAgICAqIF0gKTsKICAgICAqIC8vIGl0ZW1TaXplID0gMyBiZWNhdXNlIHRoZXJlIGFyZSAzIHZhbHVlcyAoY29tcG9uZW50cykgcGVyIHZlcnRleAogICAgICogZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgVEhSRUUuQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CiAgICAgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZjAwMDAgfSApOwogICAgICogY29uc3QgbWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKICAgICAqLwogICAgY2xhc3MgQnVmZmVyR2VvbWV0cnkgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGdlb21ldHJ5LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzQnVmZmVyR2VvbWV0cnkgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBJRCBvZiB0aGUgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIEBuYW1lIEJ1ZmZlckdlb21ldHJ5I2lkCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKi8KICAgIAkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfaWQkMSArKyB9ICk7CgogICAgCQkvKioKICAgIAkJICogVGhlIFVVSUQgb2YgdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBuYW1lIG9mIHRoZSBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMubmFtZSA9ICcnOwogICAgCQl0aGlzLnR5cGUgPSAnQnVmZmVyR2VvbWV0cnknOwoKICAgIAkJLyoqCiAgICAJCSAqIEFsbG93cyBmb3IgdmVydGljZXMgdG8gYmUgcmUtdXNlZCBhY3Jvc3MgbXVsdGlwbGUgdHJpYW5nbGVzOyB0aGlzIGlzCiAgICAJCSAqIGNhbGxlZCB1c2luZyAiaW5kZXhlZCB0cmlhbmdsZXMiLiBFYWNoIHRyaWFuZ2xlIGlzIGFzc29jaWF0ZWQgd2l0aCB0aGUKICAgIAkJICogaW5kaWNlcyBvZiB0aHJlZSB2ZXJ0aWNlcy4gVGhpcyBhdHRyaWJ1dGUgdGhlcmVmb3JlIHN0b3JlcyB0aGUgaW5kZXggb2YKICAgIAkJICogZWFjaCB2ZXJ0ZXggZm9yIGVhY2ggdHJpYW5ndWxhciBmYWNlLiBJZiB0aGlzIGF0dHJpYnV0ZSBpcyBub3Qgc2V0LCB0aGUKICAgIAkJICogcmVuZGVyZXIgYXNzdW1lcyB0aGF0IGVhY2ggdGhyZWUgY29udGlndW91cyBwb3NpdGlvbnMgcmVwcmVzZW50IGEgc2luZ2xlIHRyaWFuZ2xlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P0J1ZmZlckF0dHJpYnV0ZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5pbmRleCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogQSAoc3RvcmFnZSkgYnVmZmVyIGF0dHJpYnV0ZSB3aGljaCB3YXMgZ2VuZXJhdGVkIHdpdGggYSBjb21wdXRlIHNoYWRlciBhbmQKICAgIAkJICogbm93IGRlZmluZXMgaW5kaXJlY3QgZHJhdyBjYWxscy4KICAgIAkJICoKICAgIAkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBXZWJHUFVSZW5kZXJlcn0gYW5kIGEgV2ViR1BVIGJhY2tlbmQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/QnVmZmVyQXR0cmlidXRlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmluZGlyZWN0ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGRpY3Rpb25hcnkgaGFzIGFzIGlkIHRoZSBuYW1lIG9mIHRoZSBhdHRyaWJ1dGUgdG8gYmUgc2V0IGFuZCBhcyB2YWx1ZQogICAgCQkgKiB0aGUgYnVmZmVyIGF0dHJpYnV0ZSB0byBzZXQgaXQgdG8uIFJhdGhlciB0aGFuIGFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IGRpcmVjdGx5LAogICAgCQkgKiB1c2UgYHNldEF0dHJpYnV0ZSgpYCBhbmQgYGdldEF0dHJpYnV0ZSgpYCB0byBhY2Nlc3MgYXR0cmlidXRlcyBvZiB0aGlzIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0PHN0cmluZywoQnVmZmVyQXR0cmlidXRlfEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKT59CiAgICAJCSAqLwogICAgCQl0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGRpY3Rpb25hcnkgaG9sZHMgdGhlIG1vcnBoIHRhcmdldHMgb2YgdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBOb3RlOiBPbmNlIHRoZSBnZW9tZXRyeSBoYXMgYmVlbiByZW5kZXJlZCwgdGhlIG1vcnBoIGF0dHJpYnV0ZSBkYXRhIGNhbm5vdAogICAgCQkgKiBiZSBjaGFuZ2VkLiBZb3Ugd2lsbCBoYXZlIHRvIGNhbGwgYGRpc3Bvc2UoKT8sIGFuZCBjcmVhdGUgYSBuZXcgZ2VvbWV0cnkgaW5zdGFuY2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwoKICAgIAkJLyoqCiAgICAJCSAqIFVzZWQgdG8gY29udHJvbCB0aGUgbW9ycGggdGFyZ2V0IGJlaGF2aW9yOyB3aGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBtb3JwaAogICAgCQkgKiB0YXJnZXQgZGF0YSBpcyB0cmVhdGVkIGFzIHJlbGF0aXZlIG9mZnNldHMsIHJhdGhlciB0aGFuIGFzIGFic29sdXRlCiAgICAJCSAqIHBvc2l0aW9ucy9ub3JtYWxzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmUgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBTcGxpdCB0aGUgZ2VvbWV0cnkgaW50byBncm91cHMsIGVhY2ggb2Ygd2hpY2ggd2lsbCBiZSByZW5kZXJlZCBpbiBhCiAgICAJCSAqIHNlcGFyYXRlIGRyYXcgY2FsbC4gVGhpcyBhbGxvd3MgYW4gYXJyYXkgb2YgbWF0ZXJpYWxzIHRvIGJlIHVzZWQgd2l0aCB0aGUgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIFVzZSBgYWRkR3JvdXAoKWAgYW5kIGBjbGVhckdyb3VwcygpYCB0byBlZGl0IGdyb3VwcywgcmF0aGVyIHRoYW4gbW9kaWZ5aW5nIHRoaXMgYXJyYXkgZGlyZWN0bHkuCiAgICAJCSAqCiAgICAJCSAqIEV2ZXJ5IHZlcnRleCBhbmQgaW5kZXggbXVzdCBiZWxvbmcgdG8gZXhhY3RseSBvbmUgZ3JvdXAg4oCUIGdyb3VwcyBtdXN0IG5vdCBzaGFyZSB2ZXJ0aWNlcyBvcgogICAgCQkgKiBpbmRpY2VzLCBhbmQgbXVzdCBub3QgbGVhdmUgdmVydGljZXMgb3IgaW5kaWNlcyB1bnVzZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxPYmplY3Q+fQogICAgCQkgKi8KICAgIAkJdGhpcy5ncm91cHMgPSBbXTsKCiAgICAJCS8qKgogICAgCQkgKiBCb3VuZGluZyBib3ggZm9yIHRoZSBnZW9tZXRyeSB3aGljaCBjYW4gYmUgY2FsY3VsYXRlZCB3aXRoIGBjb21wdXRlQm91bmRpbmdCb3goKWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtCb3gzfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBCb3VuZGluZyBzcGhlcmUgZm9yIHRoZSBnZW9tZXRyeSB3aGljaCBjYW4gYmUgY2FsY3VsYXRlZCB3aXRoIGBjb21wdXRlQm91bmRpbmdTcGhlcmUoKWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtTcGhlcmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIERldGVybWluZXMgdGhlIHBhcnQgb2YgdGhlIGdlb21ldHJ5IHRvIHJlbmRlci4gVGhpcyBzaG91bGQgbm90IGJlIHNldCBkaXJlY3RseSwKICAgIAkJICogaW5zdGVhZCB1c2UgYHNldERyYXdSYW5nZSgpYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3tzdGFydDpudW1iZXIsY291bnQ6bnVtYmVyfX0KICAgIAkJICovCiAgICAJCXRoaXMuZHJhd1JhbmdlID0geyBzdGFydDogMCwgY291bnQ6IEluZmluaXR5IH07CgogICAgCQkvKioKICAgIAkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIGdlb21ldHJ5LgogICAgCQkgKiBJdCBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy51c2VyRGF0YSA9IHt9OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGluZGV4IG9mIHRoaXMgZ2VvbWV0cnkuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHs/QnVmZmVyQXR0cmlidXRlfSBUaGUgaW5kZXguIFJldHVybnMgYG51bGxgIGlmIG5vIGluZGV4IGlzIGRlZmluZWQuCiAgICAJICovCiAgICAJZ2V0SW5kZXgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5pbmRleDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiBpbmRleCB0byB0aGlzIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fEJ1ZmZlckF0dHJpYnV0ZX0gaW5kZXggLSBUaGUgaW5kZXggdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldEluZGV4KCBpbmRleCApIHsKCiAgICAJCWlmICggQXJyYXkuaXNBcnJheSggaW5kZXggKSApIHsKCiAgICAJCQl0aGlzLmluZGV4ID0gbmV3ICggYXJyYXlOZWVkc1VpbnQzMiggaW5kZXggKSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSApKCBpbmRleCwgMSApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aGlzLmluZGV4ID0gaW5kZXg7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiBpbmRpcmVjdCBhdHRyaWJ1dGUgdG8gdGhpcyBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBpbmRpcmVjdCAtIFRoZSBhdHRyaWJ1dGUgaG9sZGluZyBpbmRpcmVjdCBkcmF3IGNhbGxzLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldEluZGlyZWN0KCBpbmRpcmVjdCApIHsKCiAgICAJCXRoaXMuaW5kaXJlY3QgPSBpbmRpcmVjdDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGluZGlyZWN0IGF0dHJpYnV0ZSBvZiB0aGlzIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHJldHVybiB7P0J1ZmZlckF0dHJpYnV0ZX0gVGhlIGluZGlyZWN0IGF0dHJpYnV0ZS4gUmV0dXJucyBgbnVsbGAgaWYgbm8gaW5kaXJlY3QgYXR0cmlidXRlIGlzIGRlZmluZWQuCiAgICAJICovCiAgICAJZ2V0SW5kaXJlY3QoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5pbmRpcmVjdDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBidWZmZXIgYXR0cmlidXRlIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIGF0dHJpYnV0ZSBuYW1lLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZXxJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZXx1bmRlZmluZWR9IFRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIFJldHVybnMgYHVuZGVmaW5lZGAgaWYgbm90IGF0dHJpYnV0ZSBoYXMgYmVlbiBmb3VuZC4KICAgIAkgKi8KICAgIAlnZXRBdHRyaWJ1dGUoIG5hbWUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZ2l2ZW4gYXR0cmlidXRlIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIGF0dHJpYnV0ZSBuYW1lLgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBUaGUgYXR0cmlidXRlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRBdHRyaWJ1dGUoIG5hbWUsIGF0dHJpYnV0ZSApIHsKCiAgICAJCXRoaXMuYXR0cmlidXRlc1sgbmFtZSBdID0gYXR0cmlidXRlOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGVsZXRlcyB0aGUgYXR0cmlidXRlIGZvciB0aGUgZ2l2ZW4gbmFtZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIGF0dHJpYnV0ZSBuYW1lIHRvIGRlbGV0ZS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlkZWxldGVBdHRyaWJ1dGUoIG5hbWUgKSB7CgogICAgCQlkZWxldGUgdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGdlb21ldHJ5IGhhcyBhbiBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGdlb21ldHJ5IGhhcyBhbiBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lIG9yIG5vdC4KICAgIAkgKi8KICAgIAloYXNBdHRyaWJ1dGUoIG5hbWUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF0gIT09IHVuZGVmaW5lZDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIGEgZ3JvdXAgdG8gdGhpcyBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydCAtIFRoZSBmaXJzdCBlbGVtZW50IGluIHRoaXMgZHJhdyBjYWxsLiBUaGF0IGlzIHRoZSBmaXJzdAogICAgCSAqIHZlcnRleCBmb3Igbm9uLWluZGV4ZWQgZ2VvbWV0cnksIG90aGVyd2lzZSB0aGUgZmlyc3QgdHJpYW5nbGUgaW5kZXguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IC0gU3BlY2lmaWVzIGhvdyBtYW55IHZlcnRpY2VzIChvciBpbmRpY2VzKSBhcmUgcGFydCBvZiB0aGlzIGdyb3VwLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWF0ZXJpYWxJbmRleD0wXSAtIFRoZSBtYXRlcmlhbCBhcnJheSBpbmRleCB0byB1c2UuCiAgICAJICovCiAgICAJYWRkR3JvdXAoIHN0YXJ0LCBjb3VudCwgbWF0ZXJpYWxJbmRleCA9IDAgKSB7CgogICAgCQl0aGlzLmdyb3Vwcy5wdXNoKCB7CgogICAgCQkJc3RhcnQ6IHN0YXJ0LAogICAgCQkJY291bnQ6IGNvdW50LAogICAgCQkJbWF0ZXJpYWxJbmRleDogbWF0ZXJpYWxJbmRleAoKICAgIAkJfSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENsZWFycyBhbGwgZ3JvdXBzLgogICAgCSAqLwogICAgCWNsZWFyR3JvdXBzKCkgewoKICAgIAkJdGhpcy5ncm91cHMgPSBbXTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBkcmF3IHJhbmdlIGZvciB0aGlzIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gVGhlIGZpcnN0IHZlcnRleCBmb3Igbm9uLWluZGV4ZWQgZ2VvbWV0cnksIG90aGVyd2lzZSB0aGUgZmlyc3QgdHJpYW5nbGUgaW5kZXguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IC0gRm9yIG5vbi1pbmRleGVkIEJ1ZmZlckdlb21ldHJ5LCBgY291bnRgIGlzIHRoZSBudW1iZXIgb2YgdmVydGljZXMgdG8gcmVuZGVyLgogICAgCSAqIEZvciBpbmRleGVkIEJ1ZmZlckdlb21ldHJ5LCBgY291bnRgIGlzIHRoZSBudW1iZXIgb2YgaW5kaWNlcyB0byByZW5kZXIuCiAgICAJICovCiAgICAJc2V0RHJhd1JhbmdlKCBzdGFydCwgY291bnQgKSB7CgogICAgCQl0aGlzLmRyYXdSYW5nZS5zdGFydCA9IHN0YXJ0OwogICAgCQl0aGlzLmRyYXdSYW5nZS5jb3VudCA9IGNvdW50OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggdG8gdGhlIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgbWF0cml4IHRvIGFwcGx5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKICAgIAkJY29uc3QgcG9zaXRpb24gPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb247CgogICAgCQlpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcG9zaXRpb24uYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKCiAgICAJCQlwb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCQljb25zdCBub3JtYWwgPSB0aGlzLmF0dHJpYnV0ZXMubm9ybWFsOwoKICAgIAkJaWYgKCBub3JtYWwgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQljb25zdCBub3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgogICAgCQkJbm9ybWFsLmFwcGx5Tm9ybWFsTWF0cml4KCBub3JtYWxNYXRyaXggKTsKCiAgICAJCQlub3JtYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJY29uc3QgdGFuZ2VudCA9IHRoaXMuYXR0cmlidXRlcy50YW5nZW50OwoKICAgIAkJaWYgKCB0YW5nZW50ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGFuZ2VudC50cmFuc2Zvcm1EaXJlY3Rpb24oIG1hdHJpeCApOwoKICAgIAkJCXRhbmdlbnQubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgdGhlIHJvdGF0aW9uIHJlcHJlc2VudGVkIGJ5IHRoZSBRdWF0ZXJuaW9uIHRvIHRoZSBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBRdWF0ZXJuaW9uIHRvIGFwcGx5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWFwcGx5UXVhdGVybmlvbiggcSApIHsKCiAgICAJCV9tMSQzLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICk7CgogICAgCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIGdlb21ldHJ5IGFib3V0IHRoZSBYIGF4aXMuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQogICAgCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3JvdGF0aW9ufSBmb3IgdHlwaWNhbAogICAgCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcm90YXRlWCggYW5nbGUgKSB7CgogICAgCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHgtYXhpcwoKICAgIAkJX20xJDMubWFrZVJvdGF0aW9uWCggYW5nbGUgKTsKCiAgICAJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgYWJvdXQgdGhlIFkgYXhpcy4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCiAgICAJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjcm90YXRpb259IGZvciB0eXBpY2FsCiAgICAJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlyb3RhdGVZKCBhbmdsZSApIHsKCiAgICAJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgeS1heGlzCgogICAgCQlfbTEkMy5tYWtlUm90YXRpb25ZKCBhbmdsZSApOwoKICAgIAkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSQzICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoZSBnZW9tZXRyeSBhYm91dCB0aGUgWiBheGlzLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKICAgIAkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNyb3RhdGlvbn0gZm9yIHR5cGljYWwKICAgIAkgKiByZWFsLXRpbWUgbWVzaCByb3RhdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJvdGF0ZVooIGFuZ2xlICkgewoKICAgIAkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB6LWF4aXMKCiAgICAJCV9tMSQzLm1ha2VSb3RhdGlvblooIGFuZ2xlICk7CgogICAgCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZXMgdGhlIGdlb21ldHJ5LiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKICAgIAkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNwb3NpdGlvbn0gZm9yIHR5cGljYWwKICAgIAkgKiByZWFsLXRpbWUgbWVzaCByb3RhdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHggb2Zmc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHkgb2Zmc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHogb2Zmc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXRyYW5zbGF0ZSggeCwgeSwgeiApIHsKCiAgICAJCS8vIHRyYW5zbGF0ZSBnZW9tZXRyeQoKICAgIAkJX20xJDMubWFrZVRyYW5zbGF0aW9uKCB4LCB5LCB6ICk7CgogICAgCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNjYWxlcyB0aGUgZ2VvbWV0cnkuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQogICAgCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3NjYWxlfSBmb3IgdHlwaWNhbAogICAgCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCBzY2FsZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IHNjYWxlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHogc2NhbGUuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2NhbGUoIHgsIHksIHogKSB7CgogICAgCQkvLyBzY2FsZSBnZW9tZXRyeQoKICAgIAkJX20xJDMubWFrZVNjYWxlKCB4LCB5LCB6ICk7CgogICAgCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIGdlb21ldHJ5IHRvIGZhY2UgYSBwb2ludCBpbiAzRCBzcGFjZS4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCiAgICAJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0QjbG9va0F0fSBmb3IgdHlwaWNhbAogICAgCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2ZWN0b3IgLSBUaGUgdGFyZ2V0IHBvaW50LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWxvb2tBdCggdmVjdG9yICkgewoKICAgIAkJX29iai5sb29rQXQoIHZlY3RvciApOwoKICAgIAkJX29iai51cGRhdGVNYXRyaXgoKTsKCiAgICAJCXRoaXMuYXBwbHlNYXRyaXg0KCBfb2JqLm1hdHJpeCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2VudGVyIHRoZSBnZW9tZXRyeSBiYXNlZCBvbiBpdHMgYm91bmRpbmcgYm94LgogICAgCSAqCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2VudGVyKCkgewoKICAgIAkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCiAgICAJCXRoaXMuYm91bmRpbmdCb3guZ2V0Q2VudGVyKCBfb2Zmc2V0ICkubmVnYXRlKCk7CgogICAgCQl0aGlzLnRyYW5zbGF0ZSggX29mZnNldC54LCBfb2Zmc2V0LnksIF9vZmZzZXQueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGVmaW5lcyBhIGdlb21ldHJ5IGJ5IGNyZWF0aW5nIGEgYHBvc2l0aW9uYCBhdHRyaWJ1dGUgYmFzZWQgb24gdGhlIGdpdmVuIGFycmF5IG9mIHBvaW50cy4gVGhlIGFycmF5CiAgICAJICogY2FuIGhvbGQgMkQgb3IgM0QgdmVjdG9ycy4gV2hlbiB1c2luZyB0d28tZGltZW5zaW9uYWwgZGF0YSwgdGhlIGB6YCBjb29yZGluYXRlIGZvciBhbGwgdmVydGljZXMgaXMKICAgIAkgKiBzZXQgdG8gYDBgLgogICAgCSAqCiAgICAJICogSWYgdGhlIG1ldGhvZCBpcyB1c2VkIHdpdGggYW4gZXhpc3RpbmcgYHBvc2l0aW9uYCBhdHRyaWJ1dGUsIHRoZSB2ZXJ0ZXggZGF0YSBhcmUgb3ZlcndyaXR0ZW4gd2l0aCB0aGUKICAgIAkgKiBkYXRhIGZyb20gdGhlIGFycmF5LiBUaGUgbGVuZ3RoIG9mIHRoZSBhcnJheSBtdXN0IG1hdGNoIHRoZSB2ZXJ0ZXggY291bnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjI+fEFycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBUaGUgcG9pbnRzLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldEZyb21Qb2ludHMoIHBvaW50cyApIHsKCiAgICAJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCiAgICAJCWlmICggcG9zaXRpb25BdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQljb25zdCBwb3NpdGlvbiA9IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQljb25zdCBwb2ludCA9IHBvaW50c1sgaSBdOwogICAgCQkJCXBvc2l0aW9uLnB1c2goIHBvaW50LngsIHBvaW50LnksIHBvaW50LnogfHwgMCApOwoKICAgIAkJCX0KCiAgICAJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCAzICkgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc3QgbCA9IE1hdGgubWluKCBwb2ludHMubGVuZ3RoLCBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudCApOyAvLyBtYWtlIHN1cmUgZGF0YSBkbyBub3QgZXhjZWVkIGJ1ZmZlciBzaXplCgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgcG9pbnQgPSBwb2ludHNbIGkgXTsKICAgIAkJCQlwb3NpdGlvbkF0dHJpYnV0ZS5zZXRYWVooIGksIHBvaW50LngsIHBvaW50LnksIHBvaW50LnogfHwgMCApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHBvaW50cy5sZW5ndGggPiBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudCApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnk6IEJ1ZmZlciBzaXplIHRvbyBzbWFsbCBmb3IgcG9pbnRzIGRhdGEuIFVzZSAuZGlzcG9zZSgpIGFuZCBjcmVhdGUgYSBuZXcgZ2VvbWV0cnkuJyApOwoKICAgIAkJCX0KCiAgICAJCQlwb3NpdGlvbkF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBnZW9tZXRyeSwgYW5kIHVwZGF0ZXMgdGhlIGBib3VuZGluZ0JveGAgbWVtYmVyLgogICAgCSAqIFRoZSBib3VuZGluZyBib3ggaXMgbm90IGNvbXB1dGVkIGJ5IHRoZSBlbmdpbmU7IGl0IG11c3QgYmUgY29tcHV0ZWQgYnkgeW91ciBhcHAuCiAgICAJICogWW91IG1heSBuZWVkIHRvIHJlY29tcHV0ZSB0aGUgYm91bmRpbmcgYm94IGlmIHRoZSBnZW9tZXRyeSB2ZXJ0aWNlcyBhcmUgbW9kaWZpZWQuCiAgICAJICovCiAgICAJY29tcHV0ZUJvdW5kaW5nQm94KCkgewoKICAgIAkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKICAgIAkJCXRoaXMuYm91bmRpbmdCb3ggPSBuZXcgQm94MygpOwoKICAgIAkJfQoKICAgIAkJY29uc3QgcG9zaXRpb24gPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgogICAgCQlpZiAoIHBvc2l0aW9uICYmIHBvc2l0aW9uLmlzR0xCdWZmZXJBdHRyaWJ1dGUgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOiBHTEJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBhIG1hbnVhbCBib3VuZGluZyBib3guJywgdGhpcyApOwoKICAgIAkJCXRoaXMuYm91bmRpbmdCb3guc2V0KAogICAgCQkJCW5ldyBWZWN0b3IzKCAtIEluZmluaXR5LCAtIEluZmluaXR5LCAtIEluZmluaXR5ICksCiAgICAJCQkJbmV3IFZlY3RvcjMoICsgSW5maW5pdHksICsgSW5maW5pdHksICsgSW5maW5pdHkgKQogICAgCQkJKTsKCiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQlpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGhpcy5ib3VuZGluZ0JveC5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiApOwoKICAgIAkJCS8vIHByb2Nlc3MgbW9ycGggYXR0cmlidXRlcyBpZiBwcmVzZW50CgogICAgCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvblsgaSBdOwogICAgCQkJCQlfYm94JDIuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUgKTsKCiAgICAJCQkJCWlmICggdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCiAgICAJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggdGhpcy5ib3VuZGluZ0JveC5taW4sIF9ib3gkMi5taW4gKTsKICAgIAkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ4ICk7CgogICAgCQkJCQkJX3ZlY3RvciQ4LmFkZFZlY3RvcnMoIHRoaXMuYm91bmRpbmdCb3gubWF4LCBfYm94JDIubWF4ICk7CiAgICAJCQkJCQl0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQl0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoIF9ib3gkMi5taW4gKTsKICAgIAkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX2JveCQyLm1heCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aGlzLmJvdW5kaW5nQm94Lm1ha2VFbXB0eSgpOwoKICAgIAkJfQoKICAgIAkJaWYgKCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueCApIHx8IGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi55ICkgfHwgaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnogKSApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IENvbXB1dGVkIG1pbi9tYXggaGF2ZSBOYU4gdmFsdWVzLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSBvZiB0aGUgZ2VvbWV0cnksIGFuZCB1cGRhdGVzIHRoZSBgYm91bmRpbmdTcGhlcmVgIG1lbWJlci4KICAgIAkgKiBUaGUgZW5naW5lIGF1dG9tYXRpY2FsbHkgY29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSB3aGVuIGl0IGlzIG5lZWRlZCwgZS5nLiwgZm9yIHJheSBjYXN0aW5nIG9yIHZpZXcgZnJ1c3R1bSBjdWxsaW5nLgogICAgCSAqIFlvdSBtYXkgbmVlZCB0byByZWNvbXB1dGUgdGhlIGJvdW5kaW5nIHNwaGVyZSBpZiB0aGUgZ2VvbWV0cnkgdmVydGljZXMgYXJlIG1vZGlmaWVkLgogICAgCSAqLwogICAgCWNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpIHsKCiAgICAJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gbmV3IFNwaGVyZSgpOwoKICAgIAkJfQoKICAgIAkJY29uc3QgcG9zaXRpb24gPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgogICAgCQlpZiAoIHBvc2l0aW9uICYmIHBvc2l0aW9uLmlzR0xCdWZmZXJBdHRyaWJ1dGUgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBHTEJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBhIG1hbnVhbCBib3VuZGluZyBzcGhlcmUuJywgdGhpcyApOwoKICAgIAkJCXRoaXMuYm91bmRpbmdTcGhlcmUuc2V0KCBuZXcgVmVjdG9yMygpLCBJbmZpbml0eSApOwoKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWlmICggcG9zaXRpb24gKSB7CgogICAgCQkJLy8gZmlyc3QsIGZpbmQgdGhlIGNlbnRlciBvZiB0aGUgYm91bmRpbmcgc3BoZXJlCgogICAgCQkJY29uc3QgY2VudGVyID0gdGhpcy5ib3VuZGluZ1NwaGVyZS5jZW50ZXI7CgogICAgCQkJX2JveCQyLnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgogICAgCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCiAgICAJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CiAgICAJCQkJCV9ib3hNb3JwaFRhcmdldHMuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUgKTsKCiAgICAJCQkJCWlmICggdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCiAgICAJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggX2JveCQyLm1pbiwgX2JveE1vcnBoVGFyZ2V0cy5taW4gKTsKICAgIAkJCQkJCV9ib3gkMi5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDggKTsKCiAgICAJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggX2JveCQyLm1heCwgX2JveE1vcnBoVGFyZ2V0cy5tYXggKTsKICAgIAkJCQkJCV9ib3gkMi5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDggKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF9ib3hNb3JwaFRhcmdldHMubWluICk7CiAgICAJCQkJCQlfYm94JDIuZXhwYW5kQnlQb2ludCggX2JveE1vcnBoVGFyZ2V0cy5tYXggKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlfYm94JDIuZ2V0Q2VudGVyKCBjZW50ZXIgKTsKCiAgICAJCQkvLyBzZWNvbmQsIHRyeSB0byBmaW5kIGEgYm91bmRpbmdTcGhlcmUgd2l0aCBhIHJhZGl1cyBzbWFsbGVyIHRoYW4gdGhlCiAgICAJCQkvLyBib3VuZGluZ1NwaGVyZSBvZiB0aGUgYm91bmRpbmdCb3g6IHNxcnQoMykgc21hbGxlciBpbiB0aGUgYmVzdCBjYXNlCgogICAgCQkJbGV0IG1heFJhZGl1c1NxID0gMDsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9zaXRpb24uY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJX3ZlY3RvciQ4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBpICk7CgogICAgCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IkOCApICk7CgogICAgCQkJfQoKICAgIAkJCS8vIHByb2Nlc3MgbW9ycGggYXR0cmlidXRlcyBpZiBwcmVzZW50CgogICAgCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvblsgaSBdOwogICAgCQkJCQljb25zdCBtb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgogICAgCQkJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gbW9ycGhBdHRyaWJ1dGUuY291bnQ7IGogPCBqbDsgaiArKyApIHsKCiAgICAJCQkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUsIGogKTsKCiAgICAJCQkJCQlpZiAoIG1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKICAgIAkJCQkJCQlfb2Zmc2V0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBqICk7CiAgICAJCQkJCQkJX3ZlY3RvciQ4LmFkZCggX29mZnNldCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQltYXhSYWRpdXNTcSA9IE1hdGgubWF4KCBtYXhSYWRpdXNTcSwgY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBfdmVjdG9yJDggKSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzID0gTWF0aC5zcXJ0KCBtYXhSYWRpdXNTcSApOwoKICAgIAkJCWlmICggaXNOYU4oIHRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzICkgKSB7CgogICAgCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTogQ29tcHV0ZWQgcmFkaXVzIGlzIE5hTi4gVGhlICJwb3NpdGlvbiIgYXR0cmlidXRlIGlzIGxpa2VseSB0byBoYXZlIE5hTiB2YWx1ZXMuJywgdGhpcyApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDYWxjdWxhdGVzIGFuZCBhZGRzIGEgdGFuZ2VudCBhdHRyaWJ1dGUgdG8gdGhpcyBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIFRoZSBjb21wdXRhdGlvbiBpcyBvbmx5IHN1cHBvcnRlZCBmb3IgaW5kZXhlZCBnZW9tZXRyaWVzIGFuZCBpZiBwb3NpdGlvbiwgbm9ybWFsLCBhbmQgdXYgYXR0cmlidXRlcwogICAgCSAqIGFyZSBkZWZpbmVkLiBXaGVuIHVzaW5nIGEgdGFuZ2VudCBzcGFjZSBub3JtYWwgbWFwLCBwcmVmZXIgdGhlIE1pa2tUU3BhY2UgYWxnb3JpdGhtIHByb3ZpZGVkIGJ5CiAgICAJICoge0BsaW5rIEJ1ZmZlckdlb21ldHJ5VXRpbHMjY29tcHV0ZU1pa2tUU3BhY2VUYW5nZW50c30gaW5zdGVhZC4KICAgIAkgKi8KICAgIAljb21wdXRlVGFuZ2VudHMoKSB7CgogICAgCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CiAgICAJCWNvbnN0IGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgogICAgCQkvLyBiYXNlZCBvbiBodHRwOi8vd3d3LnRlcmF0aG9uLmNvbS9jb2RlL3RhbmdlbnQuaHRtbAogICAgCQkvLyAocGVyIHZlcnRleCB0YW5nZW50cykKCiAgICAJCWlmICggaW5kZXggPT09IG51bGwgfHwKICAgIAkJCSBhdHRyaWJ1dGVzLnBvc2l0aW9uID09PSB1bmRlZmluZWQgfHwKICAgIAkJCSBhdHRyaWJ1dGVzLm5vcm1hbCA9PT0gdW5kZWZpbmVkIHx8CiAgICAJCQkgYXR0cmlidXRlcy51diA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogLmNvbXB1dGVUYW5nZW50cygpIGZhaWxlZC4gTWlzc2luZyByZXF1aXJlZCBhdHRyaWJ1dGVzIChpbmRleCwgcG9zaXRpb24sIG5vcm1hbCBvciB1diknICk7CiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCWNvbnN0IG5vcm1hbEF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMubm9ybWFsOwogICAgCQljb25zdCB1dkF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMudXY7CgogICAgCQlpZiAoIHRoaXMuaGFzQXR0cmlidXRlKCAndGFuZ2VudCcgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICd0YW5nZW50JywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggNCAqIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICksIDQgKSApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgdGFuZ2VudEF0dHJpYnV0ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCAndGFuZ2VudCcgKTsKCiAgICAJCWNvbnN0IHRhbjEgPSBbXSwgdGFuMiA9IFtdOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgKysgKSB7CgogICAgCQkJdGFuMVsgaSBdID0gbmV3IFZlY3RvcjMoKTsKICAgIAkJCXRhbjJbIGkgXSA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQl9CgogICAgCQljb25zdCB2QSA9IG5ldyBWZWN0b3IzKCksCiAgICAJCQl2QiA9IG5ldyBWZWN0b3IzKCksCiAgICAJCQl2QyA9IG5ldyBWZWN0b3IzKCksCgogICAgCQkJdXZBID0gbmV3IFZlY3RvcjIoKSwKICAgIAkJCXV2QiA9IG5ldyBWZWN0b3IyKCksCiAgICAJCQl1dkMgPSBuZXcgVmVjdG9yMigpLAoKICAgIAkJCXNkaXIgPSBuZXcgVmVjdG9yMygpLAogICAgCQkJdGRpciA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQlmdW5jdGlvbiBoYW5kbGVUcmlhbmdsZSggYSwgYiwgYyApIHsKCiAgICAJCQl2QS5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgYSApOwogICAgCQkJdkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGIgKTsKICAgIAkJCXZDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBjICk7CgogICAgCQkJdXZBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2QXR0cmlidXRlLCBhICk7CiAgICAJCQl1dkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXZBdHRyaWJ1dGUsIGIgKTsKICAgIAkJCXV2Qy5mcm9tQnVmZmVyQXR0cmlidXRlKCB1dkF0dHJpYnV0ZSwgYyApOwoKICAgIAkJCXZCLnN1YiggdkEgKTsKICAgIAkJCXZDLnN1YiggdkEgKTsKCiAgICAJCQl1dkIuc3ViKCB1dkEgKTsKICAgIAkJCXV2Qy5zdWIoIHV2QSApOwoKICAgIAkJCWNvbnN0IHIgPSAxLjAgLyAoIHV2Qi54ICogdXZDLnkgLSB1dkMueCAqIHV2Qi55ICk7CgogICAgCQkJLy8gc2lsZW50bHkgaWdub3JlIGRlZ2VuZXJhdGUgdXYgdHJpYW5nbGVzIGhhdmluZyBjb2luY2lkZW50IG9yIGNvbGluZWFyIHZlcnRpY2VzCgogICAgCQkJaWYgKCAhIGlzRmluaXRlKCByICkgKSByZXR1cm47CgogICAgCQkJc2Rpci5jb3B5KCB2QiApLm11bHRpcGx5U2NhbGFyKCB1dkMueSApLmFkZFNjYWxlZFZlY3RvciggdkMsIC0gdXZCLnkgKS5tdWx0aXBseVNjYWxhciggciApOwogICAgCQkJdGRpci5jb3B5KCB2QyApLm11bHRpcGx5U2NhbGFyKCB1dkIueCApLmFkZFNjYWxlZFZlY3RvciggdkIsIC0gdXZDLnggKS5tdWx0aXBseVNjYWxhciggciApOwoKICAgIAkJCXRhbjFbIGEgXS5hZGQoIHNkaXIgKTsKICAgIAkJCXRhbjFbIGIgXS5hZGQoIHNkaXIgKTsKICAgIAkJCXRhbjFbIGMgXS5hZGQoIHNkaXIgKTsKCiAgICAJCQl0YW4yWyBhIF0uYWRkKCB0ZGlyICk7CiAgICAJCQl0YW4yWyBiIF0uYWRkKCB0ZGlyICk7CiAgICAJCQl0YW4yWyBjIF0uYWRkKCB0ZGlyICk7CgogICAgCQl9CgogICAgCQlsZXQgZ3JvdXBzID0gdGhpcy5ncm91cHM7CgogICAgCQlpZiAoIGdyb3Vwcy5sZW5ndGggPT09IDAgKSB7CgogICAgCQkJZ3JvdXBzID0gWyB7CiAgICAJCQkJc3RhcnQ6IDAsCiAgICAJCQkJY291bnQ6IGluZGV4LmNvdW50CiAgICAJCQl9IF07CgogICAgCQl9CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyArKyBpICkgewoKICAgIAkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgogICAgCQkJY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKICAgIAkJCWNvbnN0IGNvdW50ID0gZ3JvdXAuY291bnQ7CgogICAgCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMyApIHsKCiAgICAJCQkJaGFuZGxlVHJpYW5nbGUoCiAgICAJCQkJCWluZGV4LmdldFgoIGogKyAwICksCiAgICAJCQkJCWluZGV4LmdldFgoIGogKyAxICksCiAgICAJCQkJCWluZGV4LmdldFgoIGogKyAyICkKICAgIAkJCQkpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWNvbnN0IHRtcCA9IG5ldyBWZWN0b3IzKCksIHRtcDIgPSBuZXcgVmVjdG9yMygpOwogICAgCQljb25zdCBuID0gbmV3IFZlY3RvcjMoKSwgbjIgPSBuZXcgVmVjdG9yMygpOwoKICAgIAkJZnVuY3Rpb24gaGFuZGxlVmVydGV4KCB2ICkgewoKICAgIAkJCW4uZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2ICk7CiAgICAJCQluMi5jb3B5KCBuICk7CgogICAgCQkJY29uc3QgdCA9IHRhbjFbIHYgXTsKCiAgICAJCQkvLyBHcmFtLVNjaG1pZHQgb3J0aG9nb25hbGl6ZQoKICAgIAkJCXRtcC5jb3B5KCB0ICk7CiAgICAJCQl0bXAuc3ViKCBuLm11bHRpcGx5U2NhbGFyKCBuLmRvdCggdCApICkgKS5ub3JtYWxpemUoKTsKCiAgICAJCQkvLyBDYWxjdWxhdGUgaGFuZGVkbmVzcwoKICAgIAkJCXRtcDIuY3Jvc3NWZWN0b3JzKCBuMiwgdCApOwogICAgCQkJY29uc3QgdGVzdCA9IHRtcDIuZG90KCB0YW4yWyB2IF0gKTsKICAgIAkJCWNvbnN0IHcgPSAoIHRlc3QgPCAwLjAgKSA/IC0xIDogMS4wOwoKICAgIAkJCXRhbmdlbnRBdHRyaWJ1dGUuc2V0WFlaVyggdiwgdG1wLngsIHRtcC55LCB0bXAueiwgdyApOwoKICAgIAkJfQoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgKysgaSApIHsKCiAgICAJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoKICAgIAkJCWNvbnN0IHN0YXJ0ID0gZ3JvdXAuc3RhcnQ7CiAgICAJCQljb25zdCBjb3VudCA9IGdyb3VwLmNvdW50OwoKICAgIAkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gc3RhcnQgKyBjb3VudDsgaiA8IGpsOyBqICs9IDMgKSB7CgogICAgCQkJCWhhbmRsZVZlcnRleCggaW5kZXguZ2V0WCggaiArIDAgKSApOwogICAgCQkJCWhhbmRsZVZlcnRleCggaW5kZXguZ2V0WCggaiArIDEgKSApOwogICAgCQkJCWhhbmRsZVZlcnRleCggaW5kZXguZ2V0WCggaiArIDIgKSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB2ZXJ0ZXggbm9ybWFscyBmb3IgdGhlIGdpdmVuIHZlcnRleCBkYXRhLiBGb3IgaW5kZXhlZCBnZW9tZXRyaWVzLCB0aGUgbWV0aG9kIHNldHMKICAgIAkgKiBlYWNoIHZlcnRleCBub3JtYWwgdG8gYmUgdGhlIGF2ZXJhZ2Ugb2YgdGhlIGZhY2Ugbm9ybWFscyBvZiB0aGUgZmFjZXMgdGhhdCBzaGFyZSB0aGF0IHZlcnRleC4KICAgIAkgKiBGb3Igbm9uLWluZGV4ZWQgZ2VvbWV0cmllcywgdmVydGljZXMgYXJlIG5vdCBzaGFyZWQsIGFuZCB0aGUgbWV0aG9kIHNldHMgZWFjaCB2ZXJ0ZXggbm9ybWFsCiAgICAJICogdG8gYmUgdGhlIHNhbWUgYXMgdGhlIGZhY2Ugbm9ybWFsLgogICAgCSAqLwogICAgCWNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCkgewoKICAgIAkJY29uc3QgaW5kZXggPSB0aGlzLmluZGV4OwogICAgCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgogICAgCQlpZiAoIHBvc2l0aW9uQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJbGV0IG5vcm1hbEF0dHJpYnV0ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCAnbm9ybWFsJyApOwoKICAgIAkJCWlmICggbm9ybWFsQXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCW5vcm1hbEF0dHJpYnV0ZSA9IG5ldyBCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICogMyApLCAzICk7CiAgICAJCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBub3JtYWxBdHRyaWJ1dGUgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQkvLyByZXNldCBleGlzdGluZyBub3JtYWxzIHRvIHplcm8KCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5vcm1hbEF0dHJpYnV0ZS5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSwgMCwgMCwgMCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IHBBID0gbmV3IFZlY3RvcjMoKSwgcEIgPSBuZXcgVmVjdG9yMygpLCBwQyA9IG5ldyBWZWN0b3IzKCk7CiAgICAJCQljb25zdCBuQSA9IG5ldyBWZWN0b3IzKCksIG5CID0gbmV3IFZlY3RvcjMoKSwgbkMgPSBuZXcgVmVjdG9yMygpOwogICAgCQkJY29uc3QgY2IgPSBuZXcgVmVjdG9yMygpLCBhYiA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQkJLy8gaW5kZXhlZCBlbGVtZW50cwoKICAgIAkJCWlmICggaW5kZXggKSB7CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBpbmRleC5jb3VudDsgaSA8IGlsOyBpICs9IDMgKSB7CgogICAgCQkJCQljb25zdCB2QSA9IGluZGV4LmdldFgoIGkgKyAwICk7CiAgICAJCQkJCWNvbnN0IHZCID0gaW5kZXguZ2V0WCggaSArIDEgKTsKICAgIAkJCQkJY29uc3QgdkMgPSBpbmRleC5nZXRYKCBpICsgMiApOwoKICAgIAkJCQkJcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZBICk7CiAgICAJCQkJCXBCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QiApOwogICAgCQkJCQlwQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgdkMgKTsKCiAgICAJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwogICAgCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKICAgIAkJCQkJY2IuY3Jvc3MoIGFiICk7CgogICAgCQkJCQluQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHZBICk7CiAgICAJCQkJCW5CLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbEF0dHJpYnV0ZSwgdkIgKTsKICAgIAkJCQkJbkMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2QyApOwoKICAgIAkJCQkJbkEuYWRkKCBjYiApOwogICAgCQkJCQluQi5hZGQoIGNiICk7CiAgICAJCQkJCW5DLmFkZCggY2IgKTsKCiAgICAJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIHZBLCBuQS54LCBuQS55LCBuQS56ICk7CiAgICAJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIHZCLCBuQi54LCBuQi55LCBuQi56ICk7CiAgICAJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIHZDLCBuQy54LCBuQy55LCBuQy56ICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQkvLyBub24taW5kZXhlZCBlbGVtZW50cyAodW5jb25uZWN0ZWQgdHJpYW5nbGUgc291cCkKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKz0gMyApIHsKCiAgICAJCQkJCXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMCApOwogICAgCQkJCQlwQi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDEgKTsKICAgIAkJCQkJcEMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAyICk7CgogICAgCQkJCQljYi5zdWJWZWN0b3JzKCBwQywgcEIgKTsKICAgIAkJCQkJYWIuc3ViVmVjdG9ycyggcEEsIHBCICk7CiAgICAJCQkJCWNiLmNyb3NzKCBhYiApOwoKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSArIDAsIGNiLngsIGNiLnksIGNiLnogKTsKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSArIDEsIGNiLngsIGNiLnksIGNiLnogKTsKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSArIDIsIGNiLngsIGNiLnksIGNiLnogKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQl0aGlzLm5vcm1hbGl6ZU5vcm1hbHMoKTsKCiAgICAJCQlub3JtYWxBdHRyaWJ1dGUubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEVuc3VyZXMgZXZlcnkgbm9ybWFsIHZlY3RvciBpbiBhIGdlb21ldHJ5IHdpbGwgaGF2ZSBhIG1hZ25pdHVkZSBvZiBgMWAuIFRoaXMgd2lsbAogICAgCSAqIGNvcnJlY3QgbGlnaHRpbmcgb24gdGhlIGdlb21ldHJ5IHN1cmZhY2VzLgogICAgCSAqLwogICAgCW5vcm1hbGl6ZU5vcm1hbHMoKSB7CgogICAgCQljb25zdCBub3JtYWxzID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBub3JtYWxzLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJX3ZlY3RvciQ4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIGkgKTsKCiAgICAJCQlfdmVjdG9yJDgubm9ybWFsaXplKCk7CgogICAgCQkJbm9ybWFscy5zZXRYWVooIGksIF92ZWN0b3IkOC54LCBfdmVjdG9yJDgueSwgX3ZlY3RvciQ4LnogKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm4gYSBuZXcgbm9uLWluZGV4IHZlcnNpb24gb2YgdGhpcyBpbmRleGVkIGdlb21ldHJ5LiBJZiB0aGUgZ2VvbWV0cnkKICAgIAkgKiBpcyBhbHJlYWR5IG5vbi1pbmRleGVkLCB0aGUgbWV0aG9kIGlzIGEgTk9PUC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBUaGUgbm9uLWluZGV4ZWQgdmVyc2lvbiBvZiB0aGlzIGluZGV4ZWQgZ2VvbWV0cnkuCiAgICAJICovCiAgICAJdG9Ob25JbmRleGVkKCkgewoKICAgIAkJZnVuY3Rpb24gY29udmVydEJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRpY2VzICkgewoKICAgIAkJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwogICAgCQkJY29uc3QgaXRlbVNpemUgPSBhdHRyaWJ1dGUuaXRlbVNpemU7CiAgICAJCQljb25zdCBub3JtYWxpemVkID0gYXR0cmlidXRlLm5vcm1hbGl6ZWQ7CgogICAgCQkJY29uc3QgYXJyYXkyID0gbmV3IGFycmF5LmNvbnN0cnVjdG9yKCBpbmRpY2VzLmxlbmd0aCAqIGl0ZW1TaXplICk7CgogICAgCQkJbGV0IGluZGV4ID0gMCwgaW5kZXgyID0gMDsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBpbmRpY2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgogICAgCQkJCQlpbmRleCA9IGluZGljZXNbIGkgXSAqIGF0dHJpYnV0ZS5kYXRhLnN0cmlkZSArIGF0dHJpYnV0ZS5vZmZzZXQ7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlpbmRleCA9IGluZGljZXNbIGkgXSAqIGl0ZW1TaXplOwoKICAgIAkJCQl9CgogICAgCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IGl0ZW1TaXplOyBqICsrICkgewoKICAgIAkJCQkJYXJyYXkyWyBpbmRleDIgKysgXSA9IGFycmF5WyBpbmRleCArKyBdOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBuZXcgQnVmZmVyQXR0cmlidXRlKCBhcnJheTIsIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgogICAgCQl9CgogICAgCQkvLwoKICAgIAkJaWYgKCB0aGlzLmluZGV4ID09PSBudWxsICkgewoKICAgIAkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LnRvTm9uSW5kZXhlZCgpOiBCdWZmZXJHZW9tZXRyeSBpcyBhbHJlYWR5IG5vbi1pbmRleGVkLicgKTsKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJY29uc3QgZ2VvbWV0cnkyID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgogICAgCQljb25zdCBpbmRpY2VzID0gdGhpcy5pbmRleC5hcnJheTsKICAgIAkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCiAgICAJCS8vIGF0dHJpYnV0ZXMKCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gYXR0cmlidXRlcyApIHsKCiAgICAJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCQkJY29uc3QgbmV3QXR0cmlidXRlID0gY29udmVydEJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRpY2VzICk7CgogICAgCQkJZ2VvbWV0cnkyLnNldEF0dHJpYnV0ZSggbmFtZSwgbmV3QXR0cmlidXRlICk7CgogICAgCQl9CgogICAgCQkvLyBtb3JwaCBhdHRyaWJ1dGVzCgogICAgCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSB0aGlzLm1vcnBoQXR0cmlidXRlczsKCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gbW9ycGhBdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IG1vcnBoQXJyYXkgPSBbXTsKICAgIAkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF07IC8vIG1vcnBoQXR0cmlidXRlOiBhcnJheSBvZiBGbG9hdDMyQnVmZmVyQXR0cmlidXRlcwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgYXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVbIGkgXTsKCiAgICAJCQkJY29uc3QgbmV3QXR0cmlidXRlID0gY29udmVydEJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRpY2VzICk7CgogICAgCQkJCW1vcnBoQXJyYXkucHVzaCggbmV3QXR0cmlidXRlICk7CgogICAgCQkJfQoKICAgIAkJCWdlb21ldHJ5Mi5tb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXSA9IG1vcnBoQXJyYXk7CgogICAgCQl9CgogICAgCQlnZW9tZXRyeTIubW9ycGhUYXJnZXRzUmVsYXRpdmUgPSB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKICAgIAkJLy8gZ3JvdXBzCgogICAgCQljb25zdCBncm91cHMgPSB0aGlzLmdyb3VwczsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CiAgICAJCQlnZW9tZXRyeTIuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGdlb21ldHJ5MjsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXJpYWxpemVzIHRoZSBnZW9tZXRyeSBpbnRvIEpTT04uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIGdlb21ldHJ5LgogICAgCSAqLwogICAgCXRvSlNPTigpIHsKCiAgICAJCWNvbnN0IGRhdGEgPSB7CiAgICAJCQltZXRhZGF0YTogewogICAgCQkJCXZlcnNpb246IDQuNywKICAgIAkJCQl0eXBlOiAnQnVmZmVyR2VvbWV0cnknLAogICAgCQkJCWdlbmVyYXRvcjogJ0J1ZmZlckdlb21ldHJ5LnRvSlNPTicKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8vIHN0YW5kYXJkIEJ1ZmZlckdlb21ldHJ5IHNlcmlhbGl6YXRpb24KCiAgICAJCWRhdGEudXVpZCA9IHRoaXMudXVpZDsKICAgIAkJZGF0YS50eXBlID0gdGhpcy50eXBlOwogICAgCQlpZiAoIHRoaXMubmFtZSAhPT0gJycgKSBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CiAgICAJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgZGF0YS51c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7CgogICAgCQlpZiAoIHRoaXMucGFyYW1ldGVycyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLnBhcmFtZXRlcnM7CgogICAgCQkJZm9yICggY29uc3Qga2V5IGluIHBhcmFtZXRlcnMgKSB7CgogICAgCQkJCWlmICggcGFyYW1ldGVyc1sga2V5IF0gIT09IHVuZGVmaW5lZCApIGRhdGFbIGtleSBdID0gcGFyYW1ldGVyc1sga2V5IF07CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBkYXRhOwoKICAgIAkJfQoKICAgIAkJLy8gZm9yIHNpbXBsaWNpdHkgdGhlIGNvZGUgYXNzdW1lcyBhdHRyaWJ1dGVzIGFyZSBub3Qgc2hhcmVkIGFjcm9zcyBnZW9tZXRyaWVzLCBzZWUgIzE1ODExCgogICAgCQlkYXRhLmRhdGEgPSB7IGF0dHJpYnV0ZXM6IHt9IH07CgogICAgCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CgogICAgCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCWRhdGEuZGF0YS5pbmRleCA9IHsKICAgIAkJCQl0eXBlOiBpbmRleC5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLAogICAgCQkJCWFycmF5OiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggaW5kZXguYXJyYXkgKQogICAgCQkJfTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGF0dHJpYnV0ZXMgPSB0aGlzLmF0dHJpYnV0ZXM7CgogICAgCQlmb3IgKCBjb25zdCBrZXkgaW4gYXR0cmlidXRlcyApIHsKCiAgICAJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBrZXkgXTsKCiAgICAJCQlkYXRhLmRhdGEuYXR0cmlidXRlc1sga2V5IF0gPSBhdHRyaWJ1dGUudG9KU09OKCBkYXRhLmRhdGEgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IHt9OwogICAgCQlsZXQgaGFzTW9ycGhBdHRyaWJ1dGVzID0gZmFsc2U7CgogICAgCQlmb3IgKCBjb25zdCBrZXkgaW4gdGhpcy5tb3JwaEF0dHJpYnV0ZXMgKSB7CgogICAgCQkJY29uc3QgYXR0cmlidXRlQXJyYXkgPSB0aGlzLm1vcnBoQXR0cmlidXRlc1sga2V5IF07CgogICAgCQkJY29uc3QgYXJyYXkgPSBbXTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlQXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZUFycmF5WyBpIF07CgogICAgCQkJCWFycmF5LnB1c2goIGF0dHJpYnV0ZS50b0pTT04oIGRhdGEuZGF0YSApICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggYXJyYXkubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJbW9ycGhBdHRyaWJ1dGVzWyBrZXkgXSA9IGFycmF5OwoKICAgIAkJCQloYXNNb3JwaEF0dHJpYnV0ZXMgPSB0cnVlOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggaGFzTW9ycGhBdHRyaWJ1dGVzICkgewoKICAgIAkJCWRhdGEuZGF0YS5tb3JwaEF0dHJpYnV0ZXMgPSBtb3JwaEF0dHJpYnV0ZXM7CiAgICAJCQlkYXRhLmRhdGEubW9ycGhUYXJnZXRzUmVsYXRpdmUgPSB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKICAgIAkJfQoKICAgIAkJY29uc3QgZ3JvdXBzID0gdGhpcy5ncm91cHM7CgogICAgCQlpZiAoIGdyb3Vwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCWRhdGEuZGF0YS5ncm91cHMgPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeSggZ3JvdXBzICkgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGJvdW5kaW5nU3BoZXJlID0gdGhpcy5ib3VuZGluZ1NwaGVyZTsKCiAgICAJCWlmICggYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgogICAgCQkJZGF0YS5kYXRhLmJvdW5kaW5nU3BoZXJlID0gYm91bmRpbmdTcGhlcmUudG9KU09OKCk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gZGF0YTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IGdlb21ldHJ5IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBnZW9tZXRyeSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gc291cmNlIC0gVGhlIGdlb21ldHJ5IHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weSggc291cmNlICkgewoKICAgIAkJLy8gcmVzZXQKCiAgICAJCXRoaXMuaW5kZXggPSBudWxsOwogICAgCQl0aGlzLmF0dHJpYnV0ZXMgPSB7fTsKICAgIAkJdGhpcy5tb3JwaEF0dHJpYnV0ZXMgPSB7fTsKICAgIAkJdGhpcy5ncm91cHMgPSBbXTsKICAgIAkJdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CiAgICAJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKICAgIAkJLy8gdXNlZCBmb3Igc3RvcmluZyBjbG9uZWQsIHNoYXJlZCBkYXRhCgogICAgCQljb25zdCBkYXRhID0ge307CgogICAgCQkvLyBuYW1lCgogICAgCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCiAgICAJCS8vIGluZGV4CgogICAgCQljb25zdCBpbmRleCA9IHNvdXJjZS5pbmRleDsKCiAgICAJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5zZXRJbmRleCggaW5kZXguY2xvbmUoKSApOwoKICAgIAkJfQoKICAgIAkJLy8gYXR0cmlidXRlcwoKICAgIAkJY29uc3QgYXR0cmlidXRlcyA9IHNvdXJjZS5hdHRyaWJ1dGVzOwoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBhdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKICAgIAkJCXRoaXMuc2V0QXR0cmlidXRlKCBuYW1lLCBhdHRyaWJ1dGUuY2xvbmUoIGRhdGEgKSApOwoKICAgIAkJfQoKICAgIAkJLy8gbW9ycGggYXR0cmlidXRlcwoKICAgIAkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gc291cmNlLm1vcnBoQXR0cmlidXRlczsKCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gbW9ycGhBdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IGFycmF5ID0gW107CiAgICAJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sgbmFtZSBdOyAvLyBtb3JwaEF0dHJpYnV0ZTogYXJyYXkgb2YgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZXMKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQlhcnJheS5wdXNoKCBtb3JwaEF0dHJpYnV0ZVsgaSBdLmNsb25lKCBkYXRhICkgKTsKCiAgICAJCQl9CgogICAgCQkJdGhpcy5tb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXSA9IGFycmF5OwoKICAgIAkJfQoKICAgIAkJdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHNvdXJjZS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCiAgICAJCS8vIGdyb3VwcwoKICAgIAkJY29uc3QgZ3JvdXBzID0gc291cmNlLmdyb3VwczsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CiAgICAJCQl0aGlzLmFkZEdyb3VwKCBncm91cC5zdGFydCwgZ3JvdXAuY291bnQsIGdyb3VwLm1hdGVyaWFsSW5kZXggKTsKCiAgICAJCX0KCiAgICAJCS8vIGJvdW5kaW5nIGJveAoKICAgIAkJY29uc3QgYm91bmRpbmdCb3ggPSBzb3VyY2UuYm91bmRpbmdCb3g7CgogICAgCQlpZiAoIGJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMuYm91bmRpbmdCb3ggPSBib3VuZGluZ0JveC5jbG9uZSgpOwoKICAgIAkJfQoKICAgIAkJLy8gYm91bmRpbmcgc3BoZXJlCgogICAgCQljb25zdCBib3VuZGluZ1NwaGVyZSA9IHNvdXJjZS5ib3VuZGluZ1NwaGVyZTsKCiAgICAJCWlmICggYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IGJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CgogICAgCQl9CgogICAgCQkvLyBkcmF3IHJhbmdlCgogICAgCQl0aGlzLmRyYXdSYW5nZS5zdGFydCA9IHNvdXJjZS5kcmF3UmFuZ2Uuc3RhcnQ7CiAgICAJCXRoaXMuZHJhd1JhbmdlLmNvdW50ID0gc291cmNlLmRyYXdSYW5nZS5jb3VudDsKCiAgICAJCS8vIHVzZXIgZGF0YQoKICAgIAkJdGhpcy51c2VyRGF0YSA9IHNvdXJjZS51c2VyRGF0YTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwogICAgCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgogICAgCSAqCiAgICAJICogQGZpcmVzIEJ1ZmZlckdlb21ldHJ5I2Rpc3Bvc2UKICAgIAkgKi8KICAgIAlkaXNwb3NlKCkgewoKICAgIAkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX2ludmVyc2VNYXRyaXgkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKICAgIGNvbnN0IF9yYXkkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFJheSgpOwogICAgY29uc3QgX3NwaGVyZSQ2ID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CiAgICBjb25zdCBfc3BoZXJlSGl0QXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX3ZBJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdkIkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92QyQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGNvbnN0IF90ZW1wQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9tb3JwaEEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX2ludGVyc2VjdGlvblBvaW50ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX2ludGVyc2VjdGlvblBvaW50V29ybGQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgLyoqCiAgICAgKiBDbGFzcyByZXByZXNlbnRpbmcgdHJpYW5ndWxhciBwb2x5Z29uIG1lc2ggYmFzZWQgb2JqZWN0cy4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDEsIDEgKTsKICAgICAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmYwMCB9ICk7CiAgICAgKiBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwogICAgICogc2NlbmUuYWRkKCBtZXNoICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAYXVnbWVudHMgT2JqZWN0M0QKICAgICAqLwogICAgY2xhc3MgTWVzaCBleHRlbmRzIE9iamVjdDNEIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBtZXNoLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gW2dlb21ldHJ5XSAtIFRoZSBtZXNoIGdlb21ldHJ5LgogICAgCSAqIEBwYXJhbSB7TWF0ZXJpYWx8QXJyYXk8TWF0ZXJpYWw+fSBbbWF0ZXJpYWxdIC0gVGhlIG1lc2ggbWF0ZXJpYWwuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCksIG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCkgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNNZXNoID0gdHJ1ZTsKCiAgICAJCXRoaXMudHlwZSA9ICdNZXNoJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbWVzaCBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0J1ZmZlckdlb21ldHJ5fQogICAgCQkgKi8KICAgIAkJdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBtZXNoIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TWF0ZXJpYWx8QXJyYXk8TWF0ZXJpYWw+fQogICAgCQkgKiBAZGVmYXVsdCBNZXNoQmFzaWNNYXRlcmlhbAogICAgCQkgKi8KICAgIAkJdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgZGljdGlvbmFyeSByZXByZXNlbnRpbmcgdGhlIG1vcnBoIHRhcmdldHMgaW4gdGhlIGdlb21ldHJ5LiBUaGUga2V5IGlzIHRoZQogICAgCQkgKiBtb3JwaCB0YXJnZXRzIG5hbWUsIHRoZSB2YWx1ZSBpdHMgYXR0cmlidXRlIGluZGV4LiBUaGlzIG1lbWJlciBpcyBgdW5kZWZpbmVkYAogICAgCQkgKiBieSBkZWZhdWx0IGFuZCBvbmx5IHNldCB3aGVuIG1vcnBoIHRhcmdldHMgYXJlIGRldGVjdGVkIGluIHRoZSBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdDxTdHJpbmcsbnVtYmVyPnx1bmRlZmluZWR9CiAgICAJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAogICAgCQkgKi8KICAgIAkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSB1bmRlZmluZWQ7CgogICAgCQkvKioKICAgIAkJICogQW4gYXJyYXkgb2Ygd2VpZ2h0cyB0eXBpY2FsbHkgaW4gdGhlIHJhbmdlIGBbMCwxXWAgdGhhdCBzcGVjaWZ5IGhvdyBtdWNoIG9mIHRoZSBtb3JwaAogICAgCQkgKiBpcyBhcHBsaWVkLiBUaGlzIG1lbWJlciBpcyBgdW5kZWZpbmVkYCBieSBkZWZhdWx0IGFuZCBvbmx5IHNldCB3aGVuIG1vcnBoIHRhcmdldHMgYXJlCiAgICAJCSAqIGRldGVjdGVkIGluIHRoZSBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PG51bWJlcj58dW5kZWZpbmVkfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gdW5kZWZpbmVkOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBudW1iZXIgb2YgaW5zdGFuY2VzIG9mIHRoaXMgbWVzaC4KICAgIAkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBXZWJHUFVSZW5kZXJlcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuY291bnQgPSAxOwoKICAgIAkJdGhpcy51cGRhdGVNb3JwaFRhcmdldHMoKTsKCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgogICAgCQlpZiAoIHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyA9IHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMuc2xpY2UoKTsKCiAgICAJCX0KCiAgICAJCWlmICggc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5tb3JwaFRhcmdldERpY3Rpb25hcnkgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMubWF0ZXJpYWwgPSBBcnJheS5pc0FycmF5KCBzb3VyY2UubWF0ZXJpYWwgKSA/IHNvdXJjZS5tYXRlcmlhbC5zbGljZSgpIDogc291cmNlLm1hdGVyaWFsOwogICAgCQl0aGlzLmdlb21ldHJ5ID0gc291cmNlLmdlb21ldHJ5OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmFsdWVzIG9mIHtAbGluayBNZXNoI21vcnBoVGFyZ2V0RGljdGlvbmFyeX0gYW5kIHtAbGluayBNZXNoI21vcnBoVGFyZ2V0SW5mbHVlbmNlc30KICAgIAkgKiB0byBtYWtlIHN1cmUgZXhpc3RpbmcgbW9ycGggdGFyZ2V0cyBjYW4gaW5mbHVlbmNlIHRoaXMgM0Qgb2JqZWN0LgogICAgCSAqLwogICAgCXVwZGF0ZU1vcnBoVGFyZ2V0cygpIHsKCiAgICAJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKICAgIAkJY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKCBtb3JwaEF0dHJpYnV0ZXMgKTsKCiAgICAJCWlmICgga2V5cy5sZW5ndGggPiAwICkgewoKICAgIAkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBrZXlzWyAwIF0gXTsKCiAgICAJCQlpZiAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gW107CiAgICAJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSB7fTsKCiAgICAJCQkJZm9yICggbGV0IG0gPSAwLCBtbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgbSA8IG1sOyBtICsrICkgewoKICAgIAkJCQkJY29uc3QgbmFtZSA9IG1vcnBoQXR0cmlidXRlWyBtIF0ubmFtZSB8fCBTdHJpbmcoIG0gKTsKCiAgICAJCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzLnB1c2goIDAgKTsKICAgIAkJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnlbIG5hbWUgXSA9IG07CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgbG9jYWwtc3BhY2UgcG9zaXRpb24gb2YgdGhlIHZlcnRleCBhdCB0aGUgZ2l2ZW4gaW5kZXgsIHRha2luZyBpbnRvCiAgICAJICogYWNjb3VudCB0aGUgY3VycmVudCBhbmltYXRpb24gc3RhdGUgb2YgYm90aCBtb3JwaCB0YXJnZXRzIGFuZCBza2lubmluZy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSB2ZXJ0ZXggaW5kZXguCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IG9iamVjdCB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgdmVydGV4IHBvc2l0aW9uIGluIGxvY2FsIHNwYWNlLgogICAgCSAqLwogICAgCWdldFZlcnRleFBvc2l0aW9uKCBpbmRleCwgdGFyZ2V0ICkgewoKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwogICAgCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCWNvbnN0IG1vcnBoUG9zaXRpb24gPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCWNvbnN0IG1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgogICAgCQl0YXJnZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGluZGV4ICk7CgogICAgCQljb25zdCBtb3JwaEluZmx1ZW5jZXMgPSB0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlczsKCiAgICAJCWlmICggbW9ycGhQb3NpdGlvbiAmJiBtb3JwaEluZmx1ZW5jZXMgKSB7CgogICAgCQkJX21vcnBoQS5zZXQoIDAsIDAsIDAgKTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgaW5mbHVlbmNlID0gbW9ycGhJbmZsdWVuY2VzWyBpIF07CiAgICAJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaFBvc2l0aW9uWyBpIF07CgogICAgCQkJCWlmICggaW5mbHVlbmNlID09PSAwICkgY29udGludWU7CgogICAgCQkJCV90ZW1wQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgaW5kZXggKTsKCiAgICAJCQkJaWYgKCBtb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCiAgICAJCQkJCV9tb3JwaEEuYWRkU2NhbGVkVmVjdG9yKCBfdGVtcEEsIGluZmx1ZW5jZSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJX21vcnBoQS5hZGRTY2FsZWRWZWN0b3IoIF90ZW1wQS5zdWIoIHRhcmdldCApLCBpbmZsdWVuY2UgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQl0YXJnZXQuYWRkKCBfbW9ycGhBICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIGludGVyc2VjdGlvbiBwb2ludHMgYmV0d2VlbiBhIGNhc3RlZCByYXkgYW5kIHRoaXMgbGluZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UmF5Y2FzdGVyfSByYXljYXN0ZXIgLSBUaGUgcmF5Y2FzdGVyLgogICAgCSAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gaW50ZXJzZWN0cyAtIFRoZSB0YXJnZXQgYXJyYXkgdGhhdCBob2xkcyB0aGUgaW50ZXJzZWN0aW9uIHBvaW50cy4KICAgIAkgKi8KICAgIAlyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgogICAgCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICAJCWNvbnN0IG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKICAgIAkJY29uc3QgbWF0cml4V29ybGQgPSB0aGlzLm1hdHJpeFdvcmxkOwoKICAgIAkJaWYgKCBtYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJLy8gdGVzdCB3aXRoIGJvdW5kaW5nIHNwaGVyZSBpbiB3b3JsZCBzcGFjZQoKICAgIAkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKICAgIAkJX3NwaGVyZSQ2LmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICk7CiAgICAJCV9zcGhlcmUkNi5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgogICAgCQkvLyBjaGVjayBkaXN0YW5jZSBmcm9tIHJheSBvcmlnaW4gdG8gYm91bmRpbmcgc3BoZXJlCgogICAgCQlfcmF5JDMuY29weSggcmF5Y2FzdGVyLnJheSApLnJlY2FzdCggcmF5Y2FzdGVyLm5lYXIgKTsKCiAgICAJCWlmICggX3NwaGVyZSQ2LmNvbnRhaW5zUG9pbnQoIF9yYXkkMy5vcmlnaW4gKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJaWYgKCBfcmF5JDMuaW50ZXJzZWN0U3BoZXJlKCBfc3BoZXJlJDYsIF9zcGhlcmVIaXRBdCApID09PSBudWxsICkgcmV0dXJuOwoKICAgIAkJCWlmICggX3JheSQzLm9yaWdpbi5kaXN0YW5jZVRvU3F1YXJlZCggX3NwaGVyZUhpdEF0ICkgPiAoIHJheWNhc3Rlci5mYXIgLSByYXljYXN0ZXIubmVhciApICoqIDIgKSByZXR1cm47CgogICAgCQl9CgogICAgCQkvLyBjb252ZXJ0IHJheSB0byBsb2NhbCBzcGFjZSBvZiBtZXNoCgogICAgCQlfaW52ZXJzZU1hdHJpeCQzLmNvcHkoIG1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CiAgICAJCV9yYXkkMy5jb3B5KCByYXljYXN0ZXIucmF5ICkuYXBwbHlNYXRyaXg0KCBfaW52ZXJzZU1hdHJpeCQzICk7CgogICAgCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgYm94IGluIGxvY2FsIHNwYWNlCgogICAgCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKICAgIAkJCWlmICggX3JheSQzLmludGVyc2VjdHNCb3goIGdlb21ldHJ5LmJvdW5kaW5nQm94ICkgPT09IGZhbHNlICkgcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJLy8gdGVzdCBmb3IgaW50ZXJzZWN0aW9ucyB3aXRoIGdlb21ldHJ5CgogICAgCQl0aGlzLl9jb21wdXRlSW50ZXJzZWN0aW9ucyggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCBfcmF5JDMgKTsKCiAgICAJfQoKICAgIAlfY29tcHV0ZUludGVyc2VjdGlvbnMoIHJheWNhc3RlciwgaW50ZXJzZWN0cywgcmF5TG9jYWxTcGFjZSApIHsKCiAgICAJCWxldCBpbnRlcnNlY3Rpb247CgogICAgCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICAJCWNvbnN0IG1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKCiAgICAJCWNvbnN0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CiAgICAJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgIAkJY29uc3QgdXYgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2OwogICAgCQljb25zdCB1djEgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2MTsKICAgIAkJY29uc3Qgbm9ybWFsID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5ub3JtYWw7CiAgICAJCWNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKICAgIAkJY29uc3QgZHJhd1JhbmdlID0gZ2VvbWV0cnkuZHJhd1JhbmdlOwoKICAgIAkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCiAgICAJCQkvLyBpbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKICAgIAkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CiAgICAJCQkJCWNvbnN0IGdyb3VwTWF0ZXJpYWwgPSBtYXRlcmlhbFsgZ3JvdXAubWF0ZXJpYWxJbmRleCBdOwoKICAgIAkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwogICAgCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggaW5kZXguY291bnQsIE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApICk7CgogICAgCQkJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IGVuZDsgaiA8IGpsOyBqICs9IDMgKSB7CgogICAgCQkJCQkJY29uc3QgYSA9IGluZGV4LmdldFgoIGogKTsKICAgIAkJCQkJCWNvbnN0IGIgPSBpbmRleC5nZXRYKCBqICsgMSApOwogICAgCQkJCQkJY29uc3QgYyA9IGluZGV4LmdldFgoIGogKyAyICk7CgogICAgCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgZ3JvdXBNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCiAgICAJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCiAgICAJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGogLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBpbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKICAgIAkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZS5tYXRlcmlhbEluZGV4ID0gZ3JvdXAubWF0ZXJpYWxJbmRleDsKICAgIAkJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwogICAgCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBpbmRleC5jb3VudCwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IHN0YXJ0LCBpbCA9IGVuZDsgaSA8IGlsOyBpICs9IDMgKSB7CgogICAgCQkJCQljb25zdCBhID0gaW5kZXguZ2V0WCggaSApOwogICAgCQkJCQljb25zdCBiID0gaW5kZXguZ2V0WCggaSArIDEgKTsKICAgIAkJCQkJY29uc3QgYyA9IGluZGV4LmdldFgoIGkgKyAyICk7CgogICAgCQkJCQlpbnRlcnNlY3Rpb24gPSBjaGVja0dlb21ldHJ5SW50ZXJzZWN0aW9uKCB0aGlzLCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCiAgICAJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKICAgIAkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBpIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gaW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCiAgICAJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIGlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkvLyBub24taW5kZXhlZCBidWZmZXIgZ2VvbWV0cnkKCiAgICAJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwogICAgCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCiAgICAJCQkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIGdyb3VwLnN0YXJ0LCBkcmF3UmFuZ2Uuc3RhcnQgKTsKICAgIAkJCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIHBvc2l0aW9uLmNvdW50LCBNYXRoLm1pbiggKCBncm91cC5zdGFydCArIGdyb3VwLmNvdW50ICksICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKSApOwoKICAgIAkJCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBlbmQ7IGogPCBqbDsgaiArPSAzICkgewoKICAgIAkJCQkJCWNvbnN0IGEgPSBqOwogICAgCQkJCQkJY29uc3QgYiA9IGogKyAxOwogICAgCQkJCQkJY29uc3QgYyA9IGogKyAyOwoKICAgIAkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIGdyb3VwTWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgogICAgCQkJCQkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgogICAgCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBqIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gbm9uLWluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwogICAgCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwogICAgCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggMCwgZHJhd1JhbmdlLnN0YXJ0ICk7CiAgICAJCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIHBvc2l0aW9uLmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgogICAgCQkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKz0gMyApIHsKCiAgICAJCQkJCWNvbnN0IGEgPSBpOwogICAgCQkJCQljb25zdCBiID0gaSArIDE7CiAgICAJCQkJCWNvbnN0IGMgPSBpICsgMjsKCiAgICAJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKICAgIAkJCQkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgogICAgCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBub24taW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCiAgICAJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrSW50ZXJzZWN0aW9uJDEoIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBwQSwgcEIsIHBDLCBwb2ludCApIHsKCiAgICAJbGV0IGludGVyc2VjdDsKCiAgICAJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCiAgICAJCWludGVyc2VjdCA9IHJheS5pbnRlcnNlY3RUcmlhbmdsZSggcEMsIHBCLCBwQSwgdHJ1ZSwgcG9pbnQgKTsKCiAgICAJfSBlbHNlIHsKCiAgICAJCWludGVyc2VjdCA9IHJheS5pbnRlcnNlY3RUcmlhbmdsZSggcEEsIHBCLCBwQywgKCBtYXRlcmlhbC5zaWRlID09PSBGcm9udFNpZGUgKSwgcG9pbnQgKTsKCiAgICAJfQoKICAgIAlpZiAoIGludGVyc2VjdCA9PT0gbnVsbCApIHJldHVybiBudWxsOwoKICAgIAlfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5jb3B5KCBwb2ludCApOwogICAgCV9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgogICAgCWNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggX2ludGVyc2VjdGlvblBvaW50V29ybGQgKTsKCiAgICAJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIHJldHVybiBudWxsOwoKICAgIAlyZXR1cm4gewogICAgCQlkaXN0YW5jZTogZGlzdGFuY2UsCiAgICAJCXBvaW50OiBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpLAogICAgCQlvYmplY3Q6IG9iamVjdAogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKSB7CgogICAgCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggYSwgX3ZBJDEgKTsKICAgIAlvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGIsIF92QiQxICk7CiAgICAJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBjLCBfdkMkMSApOwoKICAgIAljb25zdCBpbnRlcnNlY3Rpb24gPSBjaGVja0ludGVyc2VjdGlvbiQxKCBvYmplY3QsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheSwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgX2ludGVyc2VjdGlvblBvaW50ICk7CgogICAgCWlmICggaW50ZXJzZWN0aW9uICkgewoKICAgIAkJY29uc3QgYmFyeWNvb3JkID0gbmV3IFZlY3RvcjMoKTsKICAgIAkJVHJpYW5nbGUuZ2V0QmFyeWNvb3JkKCBfaW50ZXJzZWN0aW9uUG9pbnQsIF92QSQxLCBfdkIkMSwgX3ZDJDEsIGJhcnljb29yZCApOwoKICAgIAkJaWYgKCB1diApIHsKCiAgICAJCQlpbnRlcnNlY3Rpb24udXYgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIHV2LCBhLCBiLCBjLCBiYXJ5Y29vcmQsIG5ldyBWZWN0b3IyKCkgKTsKCiAgICAJCX0KCiAgICAJCWlmICggdXYxICkgewoKICAgIAkJCWludGVyc2VjdGlvbi51djEgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIHV2MSwgYSwgYiwgYywgYmFyeWNvb3JkLCBuZXcgVmVjdG9yMigpICk7CgogICAgCQl9CgogICAgCQlpZiAoIG5vcm1hbCApIHsKCiAgICAJCQlpbnRlcnNlY3Rpb24ubm9ybWFsID0gVHJpYW5nbGUuZ2V0SW50ZXJwb2xhdGVkQXR0cmlidXRlKCBub3JtYWwsIGEsIGIsIGMsIGJhcnljb29yZCwgbmV3IFZlY3RvcjMoKSApOwoKICAgIAkJCWlmICggaW50ZXJzZWN0aW9uLm5vcm1hbC5kb3QoIHJheS5kaXJlY3Rpb24gKSA+IDAgKSB7CgogICAgCQkJCWludGVyc2VjdGlvbi5ub3JtYWwubXVsdGlwbHlTY2FsYXIoIC0xICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJY29uc3QgZmFjZSA9IHsKICAgIAkJCWE6IGEsCiAgICAJCQliOiBiLAogICAgCQkJYzogYywKICAgIAkJCW5vcm1hbDogbmV3IFZlY3RvcjMoKSwKICAgIAkJCW1hdGVyaWFsSW5kZXg6IDAKICAgIAkJfTsKCiAgICAJCVRyaWFuZ2xlLmdldE5vcm1hbCggX3ZBJDEsIF92QiQxLCBfdkMkMSwgZmFjZS5ub3JtYWwgKTsKCiAgICAJCWludGVyc2VjdGlvbi5mYWNlID0gZmFjZTsKICAgIAkJaW50ZXJzZWN0aW9uLmJhcnljb29yZCA9IGJhcnljb29yZDsKCiAgICAJfQoKICAgIAlyZXR1cm4gaW50ZXJzZWN0aW9uOwoKICAgIH0KCiAgICAvKioKICAgICAqIEEgZ2VvbWV0cnkgY2xhc3MgZm9yIGEgcmVjdGFuZ3VsYXIgY3Vib2lkIHdpdGggYSBnaXZlbiB3aWR0aCwgaGVpZ2h0LCBhbmQgZGVwdGguCiAgICAgKiBPbiBjcmVhdGlvbiwgdGhlIGN1Ym9pZCBpcyBjZW50cmVkIG9uIHRoZSBvcmlnaW4sIHdpdGggZWFjaCBlZGdlIHBhcmFsbGVsIHRvIG9uZQogICAgICogb2YgdGhlIGF4ZXMuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAxLCAxLCAxICk7CiAgICAgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHgwMGZmMDAgfSApOwogICAgICogY29uc3QgY3ViZSA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKICAgICAqIHNjZW5lLmFkZCggY3ViZSApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIEJ1ZmZlckdlb21ldHJ5CiAgICAgKi8KICAgIGNsYXNzIEJveEdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJveCBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGguIFRoYXQgaXMsIHRoZSBsZW5ndGggb2YgdGhlIGVkZ2VzIHBhcmFsbGVsIHRvIHRoZSBYIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0LiBUaGF0IGlzLCB0aGUgbGVuZ3RoIG9mIHRoZSBlZGdlcyBwYXJhbGxlbCB0byB0aGUgWSBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGguIFRoYXQgaXMsIHRoZSBsZW5ndGggb2YgdGhlIGVkZ2VzIHBhcmFsbGVsIHRvIHRoZSBaIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aFNlZ21lbnRzPTFdIC0gTnVtYmVyIG9mIHNlZ21lbnRlZCByZWN0YW5ndWxhciBmYWNlcyBhbG9uZyB0aGUgd2lkdGggb2YgdGhlIHNpZGVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0U2VnbWVudHM9MV0gLSBOdW1iZXIgb2Ygc2VnbWVudGVkIHJlY3Rhbmd1bGFyIGZhY2VzIGFsb25nIHRoZSBoZWlnaHQgb2YgdGhlIHNpZGVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGhTZWdtZW50cz0xXSAtIE51bWJlciBvZiBzZWdtZW50ZWQgcmVjdGFuZ3VsYXIgZmFjZXMgYWxvbmcgdGhlIGRlcHRoIG9mIHRoZSBzaWRlcy4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEsIHdpZHRoU2VnbWVudHMgPSAxLCBoZWlnaHRTZWdtZW50cyA9IDEsIGRlcHRoU2VnbWVudHMgPSAxICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCXRoaXMudHlwZSA9ICdCb3hHZW9tZXRyeSc7CgogICAgCQkvKioKICAgIAkJICogSG9sZHMgdGhlIGNvbnN0cnVjdG9yIHBhcmFtZXRlcnMgdGhhdCBoYXZlIGJlZW4KICAgIAkJICogdXNlZCB0byBnZW5lcmF0ZSB0aGUgZ2VvbWV0cnkuIEFueSBtb2RpZmljYXRpb24KICAgIAkJICogYWZ0ZXIgaW5zdGFudGlhdGlvbiBkb2VzIG5vdCBjaGFuZ2UgdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy5wYXJhbWV0ZXJzID0gewogICAgCQkJd2lkdGg6IHdpZHRoLAogICAgCQkJaGVpZ2h0OiBoZWlnaHQsCiAgICAJCQlkZXB0aDogZGVwdGgsCiAgICAJCQl3aWR0aFNlZ21lbnRzOiB3aWR0aFNlZ21lbnRzLAogICAgCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzLAogICAgCQkJZGVwdGhTZWdtZW50czogZGVwdGhTZWdtZW50cwogICAgCQl9OwoKICAgIAkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKICAgIAkJLy8gc2VnbWVudHMKCiAgICAJCXdpZHRoU2VnbWVudHMgPSBNYXRoLmZsb29yKCB3aWR0aFNlZ21lbnRzICk7CiAgICAJCWhlaWdodFNlZ21lbnRzID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKTsKICAgIAkJZGVwdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoIGRlcHRoU2VnbWVudHMgKTsKCiAgICAJCS8vIGJ1ZmZlcnMKCiAgICAJCWNvbnN0IGluZGljZXMgPSBbXTsKICAgIAkJY29uc3QgdmVydGljZXMgPSBbXTsKICAgIAkJY29uc3Qgbm9ybWFscyA9IFtdOwogICAgCQljb25zdCB1dnMgPSBbXTsKCiAgICAJCS8vIGhlbHBlciB2YXJpYWJsZXMKCiAgICAJCWxldCBudW1iZXJPZlZlcnRpY2VzID0gMDsKICAgIAkJbGV0IGdyb3VwU3RhcnQgPSAwOwoKICAgIAkJLy8gYnVpbGQgZWFjaCBzaWRlIG9mIHRoZSBib3ggZ2VvbWV0cnkKCiAgICAJCWJ1aWxkUGxhbmUoICd6JywgJ3knLCAneCcsIC0xLCAtMSwgZGVwdGgsIGhlaWdodCwgd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAwICk7IC8vIHB4CiAgICAJCWJ1aWxkUGxhbmUoICd6JywgJ3knLCAneCcsIDEsIC0xLCBkZXB0aCwgaGVpZ2h0LCAtIHdpZHRoLCBkZXB0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgMSApOyAvLyBueAogICAgCQlidWlsZFBsYW5lKCAneCcsICd6JywgJ3knLCAxLCAxLCB3aWR0aCwgZGVwdGgsIGhlaWdodCwgd2lkdGhTZWdtZW50cywgZGVwdGhTZWdtZW50cywgMiApOyAvLyBweQogICAgCQlidWlsZFBsYW5lKCAneCcsICd6JywgJ3knLCAxLCAtMSwgd2lkdGgsIGRlcHRoLCAtIGhlaWdodCwgd2lkdGhTZWdtZW50cywgZGVwdGhTZWdtZW50cywgMyApOyAvLyBueQogICAgCQlidWlsZFBsYW5lKCAneCcsICd5JywgJ3onLCAxLCAtMSwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIHdpZHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCA0ICk7IC8vIHB6CiAgICAJCWJ1aWxkUGxhbmUoICd4JywgJ3knLCAneicsIC0xLCAtMSwgd2lkdGgsIGhlaWdodCwgLSBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDUgKTsgLy8gbnoKCiAgICAJCS8vIGJ1aWxkIGdlb21ldHJ5CgogICAgCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CiAgICAJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwogICAgCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKICAgIAkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKICAgIAkJZnVuY3Rpb24gYnVpbGRQbGFuZSggdSwgdiwgdywgdWRpciwgdmRpciwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdyaWRYLCBncmlkWSwgbWF0ZXJpYWxJbmRleCApIHsKCiAgICAJCQljb25zdCBzZWdtZW50V2lkdGggPSB3aWR0aCAvIGdyaWRYOwogICAgCQkJY29uc3Qgc2VnbWVudEhlaWdodCA9IGhlaWdodCAvIGdyaWRZOwoKICAgIAkJCWNvbnN0IHdpZHRoSGFsZiA9IHdpZHRoIC8gMjsKICAgIAkJCWNvbnN0IGhlaWdodEhhbGYgPSBoZWlnaHQgLyAyOwogICAgCQkJY29uc3QgZGVwdGhIYWxmID0gZGVwdGggLyAyOwoKICAgIAkJCWNvbnN0IGdyaWRYMSA9IGdyaWRYICsgMTsKICAgIAkJCWNvbnN0IGdyaWRZMSA9IGdyaWRZICsgMTsKCiAgICAJCQlsZXQgdmVydGV4Q291bnRlciA9IDA7CiAgICAJCQlsZXQgZ3JvdXBDb3VudCA9IDA7CgogICAgCQkJY29uc3QgdmVjdG9yID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgogICAgCQkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5ICsrICkgewoKICAgIAkJCQljb25zdCB5ID0gaXkgKiBzZWdtZW50SGVpZ2h0IC0gaGVpZ2h0SGFsZjsKCiAgICAJCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKICAgIAkJCQkJY29uc3QgeCA9IGl4ICogc2VnbWVudFdpZHRoIC0gd2lkdGhIYWxmOwoKICAgIAkJCQkJLy8gc2V0IHZhbHVlcyB0byBjb3JyZWN0IHZlY3RvciBjb21wb25lbnQKCiAgICAJCQkJCXZlY3RvclsgdSBdID0geCAqIHVkaXI7CiAgICAJCQkJCXZlY3RvclsgdiBdID0geSAqIHZkaXI7CiAgICAJCQkJCXZlY3RvclsgdyBdID0gZGVwdGhIYWxmOwoKICAgIAkJCQkJLy8gbm93IGFwcGx5IHZlY3RvciB0byB2ZXJ0ZXggYnVmZmVyCgogICAgCQkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56ICk7CgogICAgCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKICAgIAkJCQkJdmVjdG9yWyB1IF0gPSAwOwogICAgCQkJCQl2ZWN0b3JbIHYgXSA9IDA7CiAgICAJCQkJCXZlY3RvclsgdyBdID0gZGVwdGggPiAwID8gMSA6IC0xOwoKICAgIAkJCQkJLy8gbm93IGFwcGx5IHZlY3RvciB0byBub3JtYWwgYnVmZmVyCgogICAgCQkJCQlub3JtYWxzLnB1c2goIHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnogKTsKCiAgICAJCQkJCS8vIHV2cwoKICAgIAkJCQkJdXZzLnB1c2goIGl4IC8gZ3JpZFggKTsKICAgIAkJCQkJdXZzLnB1c2goIDEgLSAoIGl5IC8gZ3JpZFkgKSApOwoKICAgIAkJCQkJLy8gY291bnRlcnMKCiAgICAJCQkJCXZlcnRleENvdW50ZXIgKz0gMTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLyBpbmRpY2VzCgogICAgCQkJLy8gMS4geW91IG5lZWQgdGhyZWUgaW5kaWNlcyB0byBkcmF3IGEgc2luZ2xlIGZhY2UKICAgIAkJCS8vIDIuIGEgc2luZ2xlIHNlZ21lbnQgY29uc2lzdHMgb2YgdHdvIGZhY2VzCiAgICAJCQkvLyAzLiBzbyB3ZSBuZWVkIHRvIGdlbmVyYXRlIHNpeCAoMiozKSBpbmRpY2VzIHBlciBzZWdtZW50CgogICAgCQkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTsgaXkgKysgKSB7CgogICAgCQkJCWZvciAoIGxldCBpeCA9IDA7IGl4IDwgZ3JpZFg7IGl4ICsrICkgewoKICAgIAkJCQkJY29uc3QgYSA9IG51bWJlck9mVmVydGljZXMgKyBpeCArIGdyaWRYMSAqIGl5OwogICAgCQkJCQljb25zdCBiID0gbnVtYmVyT2ZWZXJ0aWNlcyArIGl4ICsgZ3JpZFgxICogKCBpeSArIDEgKTsKICAgIAkJCQkJY29uc3QgYyA9IG51bWJlck9mVmVydGljZXMgKyAoIGl4ICsgMSApICsgZ3JpZFgxICogKCBpeSArIDEgKTsKICAgIAkJCQkJY29uc3QgZCA9IG51bWJlck9mVmVydGljZXMgKyAoIGl4ICsgMSApICsgZ3JpZFgxICogaXk7CgogICAgCQkJCQkvLyBmYWNlcwoKICAgIAkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CiAgICAJCQkJCWluZGljZXMucHVzaCggYiwgYywgZCApOwoKICAgIAkJCQkJLy8gaW5jcmVhc2UgY291bnRlcgoKICAgIAkJCQkJZ3JvdXBDb3VudCArPSA2OwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIGFkZCBhIGdyb3VwIHRvIHRoZSBnZW9tZXRyeS4gdGhpcyB3aWxsIGVuc3VyZSBtdWx0aSBtYXRlcmlhbCBzdXBwb3J0CgogICAgCQkJc2NvcGUuYWRkR3JvdXAoIGdyb3VwU3RhcnQsIGdyb3VwQ291bnQsIG1hdGVyaWFsSW5kZXggKTsKCiAgICAJCQkvLyBjYWxjdWxhdGUgbmV3IHN0YXJ0IHZhbHVlIGZvciBncm91cHMKCiAgICAJCQlncm91cFN0YXJ0ICs9IGdyb3VwQ291bnQ7CgogICAgCQkJLy8gdXBkYXRlIHRvdGFsIG51bWJlciBvZiB2ZXJ0aWNlcwoKICAgIAkJCW51bWJlck9mVmVydGljZXMgKz0gdmVydGV4Q291bnRlcjsKCiAgICAJCX0KCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCiAgICAJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRmFjdG9yeSBtZXRob2QgZm9yIGNyZWF0aW5nIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgZnJvbSB0aGUgZ2l2ZW4KICAgIAkgKiBKU09OIG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCiAgICAJICogQHJldHVybiB7Qm94R2VvbWV0cnl9IEEgbmV3IGluc3RhbmNlLgogICAgCSAqLwogICAgCXN0YXRpYyBmcm9tSlNPTiggZGF0YSApIHsKCiAgICAJCXJldHVybiBuZXcgQm94R2VvbWV0cnkoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLmRlcHRoLCBkYXRhLndpZHRoU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMsIGRhdGEuZGVwdGhTZWdtZW50cyApOwoKICAgIAl9CgogICAgfQoKICAgIC8vIFVuaWZvcm0gVXRpbGl0aWVzCgogICAgZnVuY3Rpb24gY2xvbmVVbmlmb3Jtcyggc3JjICkgewoKICAgIAljb25zdCBkc3QgPSB7fTsKCiAgICAJZm9yICggY29uc3QgdSBpbiBzcmMgKSB7CgogICAgCQlkc3RbIHUgXSA9IHt9OwoKICAgIAkJZm9yICggY29uc3QgcCBpbiBzcmNbIHUgXSApIHsKCiAgICAJCQljb25zdCBwcm9wZXJ0eSA9IHNyY1sgdSBdWyBwIF07CgogICAgCQkJaWYgKCBwcm9wZXJ0eSAmJiAoIHByb3BlcnR5LmlzQ29sb3IgfHwKICAgIAkJCQlwcm9wZXJ0eS5pc01hdHJpeDMgfHwgcHJvcGVydHkuaXNNYXRyaXg0IHx8CiAgICAJCQkJcHJvcGVydHkuaXNWZWN0b3IyIHx8IHByb3BlcnR5LmlzVmVjdG9yMyB8fCBwcm9wZXJ0eS5pc1ZlY3RvcjQgfHwKICAgIAkJCQlwcm9wZXJ0eS5pc1RleHR1cmUgfHwgcHJvcGVydHkuaXNRdWF0ZXJuaW9uICkgKSB7CgogICAgCQkJCWlmICggcHJvcGVydHkuaXNSZW5kZXJUYXJnZXRUZXh0dXJlICkgewoKICAgIAkJCQkJY29uc29sZS53YXJuKCAnVW5pZm9ybXNVdGlsczogVGV4dHVyZXMgb2YgcmVuZGVyIHRhcmdldHMgY2Fubm90IGJlIGNsb25lZCB2aWEgY2xvbmVVbmlmb3JtcygpIG9yIG1lcmdlVW5pZm9ybXMoKS4nICk7CiAgICAJCQkJCWRzdFsgdSBdWyBwIF0gPSBudWxsOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJZHN0WyB1IF1bIHAgXSA9IHByb3BlcnR5LmNsb25lKCk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCBBcnJheS5pc0FycmF5KCBwcm9wZXJ0eSApICkgewoKICAgIAkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHkuc2xpY2UoKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiBkc3Q7CgogICAgfQoKICAgIGZ1bmN0aW9uIG1lcmdlVW5pZm9ybXMoIHVuaWZvcm1zICkgewoKICAgIAljb25zdCBtZXJnZWQgPSB7fTsKCiAgICAJZm9yICggbGV0IHUgPSAwOyB1IDwgdW5pZm9ybXMubGVuZ3RoOyB1ICsrICkgewoKICAgIAkJY29uc3QgdG1wID0gY2xvbmVVbmlmb3JtcyggdW5pZm9ybXNbIHUgXSApOwoKICAgIAkJZm9yICggY29uc3QgcCBpbiB0bXAgKSB7CgogICAgCQkJbWVyZ2VkWyBwIF0gPSB0bXBbIHAgXTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gbWVyZ2VkOwoKICAgIH0KCiAgICBmdW5jdGlvbiBjbG9uZVVuaWZvcm1zR3JvdXBzKCBzcmMgKSB7CgogICAgCWNvbnN0IGRzdCA9IFtdOwoKICAgIAlmb3IgKCBsZXQgdSA9IDA7IHUgPCBzcmMubGVuZ3RoOyB1ICsrICkgewoKICAgIAkJZHN0LnB1c2goIHNyY1sgdSBdLmNsb25lKCkgKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gZHN0OwoKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRVbmxpdFVuaWZvcm1Db2xvclNwYWNlKCByZW5kZXJlciApIHsKCiAgICAJY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKICAgIAlpZiAoIGN1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgKSB7CgogICAgCQkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjM5MzcjaXNzdWVjb21tZW50LTExMTEwNjczOTgKICAgIAkJcmV0dXJuIHJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2U7CgogICAgCX0KCiAgICAJLy8gaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9pc3N1ZXMvMjc4NjgKICAgIAlpZiAoIGN1cnJlbnRSZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApIHsKCiAgICAJCXJldHVybiBjdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuY29sb3JTcGFjZTsKCiAgICAJfQoKICAgIAlyZXR1cm4gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlOwoKICAgIH0KCiAgICAvLyBMZWdhY3kKCiAgICBjb25zdCBVbmlmb3Jtc1V0aWxzID0geyBjbG9uZTogY2xvbmVVbmlmb3JtcywgbWVyZ2U6IG1lcmdlVW5pZm9ybXMgfTsKCiAgICB2YXIgZGVmYXVsdF92ZXJ0ZXggPSAidm9pZCBtYWluKCkge1xuXHRnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG59IjsKCiAgICB2YXIgZGVmYXVsdF9mcmFnbWVudCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIDEuMCwgMC4wLCAwLjAsIDEuMCApO1xufSI7CgogICAgLyoqCiAgICAgKiBBIG1hdGVyaWFsIHJlbmRlcmVkIHdpdGggY3VzdG9tIHNoYWRlcnMuIEEgc2hhZGVyIGlzIGEgc21hbGwgcHJvZ3JhbSB3cml0dGVuIGluIEdMU0wuCiAgICAgKiB0aGF0IHJ1bnMgb24gdGhlIEdQVS4gWW91IG1heSB3YW50IHRvIHVzZSBhIGN1c3RvbSBzaGFkZXIgaWYgeW91IG5lZWQgdG8gaW1wbGVtZW50IGFuCiAgICAgKiBlZmZlY3Qgbm90IGluY2x1ZGVkIHdpdGggYW55IG9mIHRoZSBidWlsdC1pbiBtYXRlcmlhbHMuCiAgICAgKgogICAgICogVGhlcmUgYXJlIHRoZSBmb2xsb3dpbmcgbm90ZXMgdG8gYmVhciBpbiBtaW5kIHdoZW4gdXNpbmcgYSBgU2hhZGVyTWF0ZXJpYWxgOgogICAgICoKICAgICAqIC0gYFNoYWRlck1hdGVyaWFsYCBjYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LgogICAgICogLSBCdWlsdCBpbiBhdHRyaWJ1dGVzIGFuZCB1bmlmb3JtcyBhcmUgcGFzc2VkIHRvIHRoZSBzaGFkZXJzIGFsb25nIHdpdGggeW91ciBjb2RlLiBJZgogICAgICogeW91IGRvbid0IHdhbnQgdGhhdCwgdXNlIHtAbGluayBSYXdTaGFkZXJNYXRlcmlhbH0gaW5zdGVhZC4KICAgICAqIC0gWW91IGNhbiB1c2UgdGhlIGRpcmVjdGl2ZSBgI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydGAgYW5kIGAjcHJhZ21hIHVucm9sbF9sb29wX2VuZGAKICAgICAqIGluIG9yZGVyIHRvIHVucm9sbCBhIGBmb3JgIGxvb3AgaW4gR0xTTCBieSB0aGUgc2hhZGVyIHByZXByb2Nlc3Nvci4gVGhlIGRpcmVjdGl2ZSBoYXMKICAgICAqIHRvIGJlIHBsYWNlZCByaWdodCBhYm92ZSB0aGUgbG9vcC4gVGhlIGxvb3AgZm9ybWF0dGluZyBoYXMgdG8gY29ycmVzcG9uZCB0byBhIGRlZmluZWQgc3RhbmRhcmQuCiAgICAgKiAgIC0gVGhlIGxvb3AgaGFzIHRvIGJlIFtub3JtYWxpemVkXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Ob3JtYWxpemVkX2xvb3B9LgogICAgICogICAtIFRoZSBsb29wIHZhcmlhYmxlIGhhcyB0byBiZSAqaSouCiAgICAgKiAgIC0gVGhlIHZhbHVlIGBVTlJPTExFRF9MT09QX0lOREVYYCB3aWxsIGJlIHJlcGxhY2VkIHdpdGggdGhlIGV4cGxpY2l0bHkKICAgICAqIHZhbHVlIG9mICppKiBmb3IgdGhlIGdpdmVuIGl0ZXJhdGlvbiBhbmQgY2FuIGJlIHVzZWQgaW4gcHJlcHJvY2Vzc29yCiAgICAgKiBzdGF0ZW1lbnRzLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5TaGFkZXJNYXRlcmlhbCggewogICAgICogCXVuaWZvcm1zOiB7CiAgICAgKiAJCXRpbWU6IHsgdmFsdWU6IDEuMCB9LAogICAgICogCQlyZXNvbHV0aW9uOiB7IHZhbHVlOiBuZXcgVEhSRUUuVmVjdG9yMigpIH0KICAgICAqIAl9LAogICAgICogCXZlcnRleFNoYWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICd2ZXJ0ZXhTaGFkZXInICkudGV4dENvbnRlbnQsCiAgICAgKiAJZnJhZ21lbnRTaGFkZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnZnJhZ21lbnRTaGFkZXInICkudGV4dENvbnRlbnQKICAgICAqIH0gKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBNYXRlcmlhbAogICAgICovCiAgICBjbGFzcyBTaGFkZXJNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBzaGFkZXIgbWF0ZXJpYWwuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0gW3BhcmFtZXRlcnNdIC0gQW4gb2JqZWN0IHdpdGggb25lIG9yIG1vcmUgcHJvcGVydGllcwogICAgCSAqIGRlZmluaW5nIHRoZSBtYXRlcmlhbCdzIGFwcGVhcmFuY2UuIEFueSBwcm9wZXJ0eSBvZiB0aGUgbWF0ZXJpYWwKICAgIAkgKiAoaW5jbHVkaW5nIGFueSBwcm9wZXJ0eSBmcm9tIGluaGVyaXRlZCBtYXRlcmlhbHMpIGNhbiBiZSBwYXNzZWQKICAgIAkgKiBpbiBoZXJlLiBDb2xvciB2YWx1ZXMgY2FuIGJlIHBhc3NlZCBhbnkgdHlwZSBvZiB2YWx1ZSBhY2NlcHRlZAogICAgCSAqIGJ5IHtAbGluayBDb2xvciNzZXR9LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzU2hhZGVyTWF0ZXJpYWwgPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ1NoYWRlck1hdGVyaWFsJzsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIGN1c3RvbSBjb25zdGFudHMgdXNpbmcgYCNkZWZpbmVgIGRpcmVjdGl2ZXMgd2l0aGluIHRoZSBHTFNMIGNvZGUKICAgIAkJICogZm9yIGJvdGggdGhlIHZlcnRleCBzaGFkZXIgYW5kIHRoZSBmcmFnbWVudCBzaGFkZXI7IGVhY2gga2V5L3ZhbHVlIHBhaXIKICAgIAkJICogeWllbGRzIGFub3RoZXIgZGlyZWN0aXZlLgogICAgCQkgKiBgYGBqcwogICAgCQkgKiBkZWZpbmVzOiB7CiAgICAJCSAqIAlGT086IDE1LAogICAgCQkgKiAJQkFSOiB0cnVlCiAgICAJCSAqIH0KICAgIAkJICogYGBgCiAgICAJCSAqIFlpZWxkcyB0aGUgbGluZXM6CiAgICAJCSAqIGBgYAogICAgCQkgKiAjZGVmaW5lIEZPTyAxNQogICAgCQkgKiAjZGVmaW5lIEJBUiB0cnVlCiAgICAJCSAqIGBgYAogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy5kZWZpbmVzID0ge307CgogICAgCQkvKioKICAgIAkJICogQW4gb2JqZWN0IG9mIHRoZSBmb3JtOgogICAgCQkgKiBgYGBqcwogICAgCQkgKiB7CiAgICAJCSAqIAkidW5pZm9ybTEiOiB7IHZhbHVlOiAxLjAgfSwKICAgIAkJICogCSJ1bmlmb3JtMiI6IHsgdmFsdWU6IDIgfQogICAgCQkgKiB9CiAgICAJCSAqIGBgYAogICAgCQkgKiBzcGVjaWZ5aW5nIHRoZSB1bmlmb3JtcyB0byBiZSBwYXNzZWQgdG8gdGhlIHNoYWRlciBjb2RlOyBrZXlzIGFyZSB1bmlmb3JtCiAgICAJCSAqIG5hbWVzLCB2YWx1ZXMgYXJlIGRlZmluaXRpb25zIG9mIHRoZSBmb3JtCiAgICAJCSAqIGBgYAogICAgCQkgKiB7CiAgICAJCSAqIAl2YWx1ZTogMS4wCiAgICAJCSAqIH0KICAgIAkJICogYGBgCiAgICAJCSAqIHdoZXJlIGB2YWx1ZWAgaXMgdGhlIHZhbHVlIG9mIHRoZSB1bmlmb3JtLiBOYW1lcyBtdXN0IG1hdGNoIHRoZSBuYW1lIG9mCiAgICAJCSAqIHRoZSB1bmlmb3JtLCBhcyBkZWZpbmVkIGluIHRoZSBHTFNMIGNvZGUuIE5vdGUgdGhhdCB1bmlmb3JtcyBhcmUgcmVmcmVzaGVkCiAgICAJCSAqIG9uIGV2ZXJ5IGZyYW1lLCBzbyB1cGRhdGluZyB0aGUgdmFsdWUgb2YgdGhlIHVuaWZvcm0gd2lsbCBpbW1lZGlhdGVseQogICAgCQkgKiB1cGRhdGUgdGhlIHZhbHVlIGF2YWlsYWJsZSB0byB0aGUgR0xTTCBjb2RlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy51bmlmb3JtcyA9IHt9OwoKICAgIAkJLyoqCiAgICAJCSAqIEFuIGFycmF5IGhvbGRpbmcgdW5pZm9ybXMgZ3JvdXBzIGZvciBjb25maWd1cmluZyBVQk9zLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8VW5pZm9ybXNHcm91cD59CiAgICAJCSAqLwogICAgCQl0aGlzLnVuaWZvcm1zR3JvdXBzID0gW107CgogICAgCQkvKioKICAgIAkJICogVmVydGV4IHNoYWRlciBHTFNMIGNvZGUuIFRoaXMgaXMgdGhlIGFjdHVhbCBjb2RlIGZvciB0aGUgc2hhZGVyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy52ZXJ0ZXhTaGFkZXIgPSBkZWZhdWx0X3ZlcnRleDsKCiAgICAJCS8qKgogICAgCQkgKiBGcmFnbWVudCBzaGFkZXIgR0xTTCBjb2RlLiBUaGlzIGlzIHRoZSBhY3R1YWwgY29kZSBmb3IgdGhlIHNoYWRlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBkZWZhdWx0X2ZyYWdtZW50OwoKICAgIAkJLyoqCiAgICAJCSAqIENvbnRyb2xzIGxpbmUgdGhpY2tuZXNzIG9yIGxpbmVzLgogICAgCQkgKgogICAgCQkgKiBXZWJHTCBhbmQgV2ViR1BVIGlnbm9yZSB0aGlzIHNldHRpbmcgYW5kIGFsd2F5cyByZW5kZXIgbGluZSBwcmltaXRpdmVzIHdpdGggYQogICAgCQkgKiB3aWR0aCBvZiBvbmUgcGl4ZWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMubGluZXdpZHRoID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBSZW5kZXJzIHRoZSBnZW9tZXRyeSBhcyBhIHdpcmVmcmFtZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIENvbnRyb2xzIHRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZS4KICAgIAkJICoKICAgIAkJICogV2ViR0wgYW5kIFdlYkdQVSBpZ25vcmUgdGhpcyBwcm9wZXJ0eSBhbmQgYWx3YXlzIHJlbmRlcgogICAgCQkgKiAxIHBpeGVsIHdpZGUgbGluZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmUgd2hldGhlciB0aGUgbWF0ZXJpYWwgY29sb3IgaXMgYWZmZWN0ZWQgYnkgZ2xvYmFsIGZvZyBzZXR0aW5nczsgYHRydWVgCiAgICAJCSAqIHRvIHBhc3MgZm9nIHVuaWZvcm1zIHRvIHRoZSBzaGFkZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5mb2cgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHdoZXRoZXIgdGhpcyBtYXRlcmlhbCB1c2VzIGxpZ2h0aW5nOyBgdHJ1ZWAgdG8gcGFzcyB1bmlmb3JtIGRhdGEKICAgIAkJICogcmVsYXRlZCB0byBsaWdodGluZyB0byB0aGlzIHNoYWRlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmxpZ2h0cyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIHN1cHBvcnRzIGNsaXBwaW5nOyBgdHJ1ZWAgdG8gbGV0IHRoZSByZW5kZXJlcgogICAgCQkgKiBwYXNzIHRoZSBjbGlwcGluZ1BsYW5lcyB1bmlmb3JtLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuY2xpcHBpbmcgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGB0cnVlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5mb3JjZVNpbmdsZVBhc3MgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgb2JqZWN0IGFsbG93cyB0byBlbmFibGUgY2VydGFpbiBXZWJHTCAyIGV4dGVuc2lvbnMuCiAgICAJCSAqCiAgICAJCSAqIC0gY2xpcEN1bGxEaXN0YW5jZTogc2V0IHRvIGB0cnVlYCB0byB1c2UgdmVydGV4IHNoYWRlciBjbGlwcGluZwogICAgCQkgKiAtIG11bHRpRHJhdzogc2V0IHRvIGB0cnVlYCB0byB1c2UgdmVydGV4IHNoYWRlciBtdWx0aV9kcmF3IC8gZW5hYmxlIGdsX0RyYXdJRAogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7e2NsaXBDdWxsRGlzdGFuY2U6ZmFsc2UsbXVsdGlEcmF3OmZhbHNlfX0KICAgIAkJICovCiAgICAJCXRoaXMuZXh0ZW5zaW9ucyA9IHsKICAgIAkJCWNsaXBDdWxsRGlzdGFuY2U6IGZhbHNlLCAvLyBzZXQgdG8gdXNlIHZlcnRleCBzaGFkZXIgY2xpcHBpbmcKICAgIAkJCW11bHRpRHJhdzogZmFsc2UgLy8gc2V0IHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIG11bHRpX2RyYXcgLyBlbmFibGUgZ2xfRHJhd0lECiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogV2hlbiB0aGUgcmVuZGVyZWQgZ2VvbWV0cnkgZG9lc24ndCBpbmNsdWRlIHRoZXNlIGF0dHJpYnV0ZXMgYnV0IHRoZQogICAgCQkgKiBtYXRlcmlhbCBkb2VzLCB0aGVzZSBkZWZhdWx0IHZhbHVlcyB3aWxsIGJlIHBhc3NlZCB0byB0aGUgc2hhZGVycy4gVGhpcwogICAgCQkgKiBhdm9pZHMgZXJyb3JzIHdoZW4gYnVmZmVyIGRhdGEgaXMgbWlzc2luZy4KICAgIAkJICoKICAgIAkJICogLSBjb2xvcjogWyAxLCAxLCAxIF0KICAgIAkJICogLSB1djogWyAwLCAwIF0KICAgIAkJICogLSB1djE6IFsgMCwgMCBdCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgPSB7CiAgICAJCQknY29sb3InOiBbIDEsIDEsIDEgXSwKICAgIAkJCSd1dic6IFsgMCwgMCBdLAogICAgCQkJJ3V2MSc6IFsgMCwgMCBdCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0LCB0aGlzIGNhbGxzIFtnbC5iaW5kQXR0cmliTG9jYXRpb25de0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XZWJHTFJlbmRlcmluZ0NvbnRleHQvYmluZEF0dHJpYkxvY2F0aW9ufQogICAgCQkgKiB0byBiaW5kIGEgZ2VuZXJpYyB2ZXJ0ZXggaW5kZXggdG8gYW4gYXR0cmlidXRlIHZhcmlhYmxlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfHVuZGVmaW5lZH0KICAgIAkJICogQGRlZmF1bHQgdW5kZWZpbmVkCiAgICAJCSAqLwogICAgCQl0aGlzLmluZGV4MEF0dHJpYnV0ZU5hbWUgPSB1bmRlZmluZWQ7CgogICAgCQkvKioKICAgIAkJICogQ2FuIGJlIHVzZWQgdG8gZm9yY2UgYSB1bmlmb3JtIHVwZGF0ZSB3aGlsZSBjaGFuZ2luZyB1bmlmb3JtcyBpbgogICAgCQkgKiB7QGxpbmsgT2JqZWN0M0Qjb25CZWZvcmVSZW5kZXJ9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgR0xTTCB2ZXJzaW9uIG9mIGN1c3RvbSBzaGFkZXIgY29kZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oR0xTTDF8R0xTTDMpfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmdsc2xWZXJzaW9uID0gbnVsbDsKCiAgICAJCWlmICggcGFyYW1ldGVycyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJY29weSggc291cmNlICkgewoKICAgIAkJc3VwZXIuY29weSggc291cmNlICk7CgogICAgCQl0aGlzLmZyYWdtZW50U2hhZGVyID0gc291cmNlLmZyYWdtZW50U2hhZGVyOwogICAgCQl0aGlzLnZlcnRleFNoYWRlciA9IHNvdXJjZS52ZXJ0ZXhTaGFkZXI7CgogICAgCQl0aGlzLnVuaWZvcm1zID0gY2xvbmVVbmlmb3Jtcyggc291cmNlLnVuaWZvcm1zICk7CiAgICAJCXRoaXMudW5pZm9ybXNHcm91cHMgPSBjbG9uZVVuaWZvcm1zR3JvdXBzKCBzb3VyY2UudW5pZm9ybXNHcm91cHMgKTsKCiAgICAJCXRoaXMuZGVmaW5lcyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UuZGVmaW5lcyApOwoKICAgIAkJdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwogICAgCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgogICAgCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CiAgICAJCXRoaXMubGlnaHRzID0gc291cmNlLmxpZ2h0czsKICAgIAkJdGhpcy5jbGlwcGluZyA9IHNvdXJjZS5jbGlwcGluZzsKCiAgICAJCXRoaXMuZXh0ZW5zaW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UuZXh0ZW5zaW9ucyApOwoKICAgIAkJdGhpcy5nbHNsVmVyc2lvbiA9IHNvdXJjZS5nbHNsVmVyc2lvbjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCXRvSlNPTiggbWV0YSApIHsKCiAgICAJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCiAgICAJCWRhdGEuZ2xzbFZlcnNpb24gPSB0aGlzLmdsc2xWZXJzaW9uOwogICAgCQlkYXRhLnVuaWZvcm1zID0ge307CgogICAgCQlmb3IgKCBjb25zdCBuYW1lIGluIHRoaXMudW5pZm9ybXMgKSB7CgogICAgCQkJY29uc3QgdW5pZm9ybSA9IHRoaXMudW5pZm9ybXNbIG5hbWUgXTsKICAgIAkJCWNvbnN0IHZhbHVlID0gdW5pZm9ybS52YWx1ZTsKCiAgICAJCQlpZiAoIHZhbHVlICYmIHZhbHVlLmlzVGV4dHVyZSApIHsKCiAgICAJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewogICAgCQkJCQl0eXBlOiAndCcsCiAgICAJCQkJCXZhbHVlOiB2YWx1ZS50b0pTT04oIG1ldGEgKS51dWlkCiAgICAJCQkJfTsKCiAgICAJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc0NvbG9yICkgewoKICAgIAkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CiAgICAJCQkJCXR5cGU6ICdjJywKICAgIAkJCQkJdmFsdWU6IHZhbHVlLmdldEhleCgpCiAgICAJCQkJfTsKCiAgICAJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjIgKSB7CgogICAgCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKICAgIAkJCQkJdHlwZTogJ3YyJywKICAgIAkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgCQkJCX07CgogICAgCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3IzICkgewoKICAgIAkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CiAgICAJCQkJCXR5cGU6ICd2MycsCiAgICAJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKICAgIAkJCQl9OwoKICAgIAkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yNCApIHsKCiAgICAJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewogICAgCQkJCQl0eXBlOiAndjQnLAogICAgCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCiAgICAJCQkJfTsKCiAgICAJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDMgKSB7CgogICAgCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKICAgIAkJCQkJdHlwZTogJ20zJywKICAgIAkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgCQkJCX07CgogICAgCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNNYXRyaXg0ICkgewoKICAgIAkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CiAgICAJCQkJCXR5cGU6ICdtNCcsCiAgICAJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKICAgIAkJCQl9OwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKICAgIAkJCQkJdmFsdWU6IHZhbHVlCiAgICAJCQkJfTsKCiAgICAJCQkJLy8gbm90ZTogdGhlIGFycmF5IHZhcmlhbnRzIHYydiwgdjN2LCB2NHYsIG00diBhbmQgdHYgYXJlIG5vdCBzdXBwb3J0ZWQgc28gZmFyCgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy5kZWZpbmVzICkubGVuZ3RoID4gMCApIGRhdGEuZGVmaW5lcyA9IHRoaXMuZGVmaW5lczsKCiAgICAJCWRhdGEudmVydGV4U2hhZGVyID0gdGhpcy52ZXJ0ZXhTaGFkZXI7CiAgICAJCWRhdGEuZnJhZ21lbnRTaGFkZXIgPSB0aGlzLmZyYWdtZW50U2hhZGVyOwoKICAgIAkJZGF0YS5saWdodHMgPSB0aGlzLmxpZ2h0czsKICAgIAkJZGF0YS5jbGlwcGluZyA9IHRoaXMuY2xpcHBpbmc7CgogICAgCQljb25zdCBleHRlbnNpb25zID0ge307CgogICAgCQlmb3IgKCBjb25zdCBrZXkgaW4gdGhpcy5leHRlbnNpb25zICkgewoKICAgIAkJCWlmICggdGhpcy5leHRlbnNpb25zWyBrZXkgXSA9PT0gdHJ1ZSApIGV4dGVuc2lvbnNbIGtleSBdID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCWlmICggT2JqZWN0LmtleXMoIGV4dGVuc2lvbnMgKS5sZW5ndGggPiAwICkgZGF0YS5leHRlbnNpb25zID0gZXh0ZW5zaW9uczsKCiAgICAJCXJldHVybiBkYXRhOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgY2FtZXJhcy4gVGhpcyBjbGFzcyBzaG91bGQgYWx3YXlzIGJlIGluaGVyaXRlZAogICAgICogd2hlbiB5b3UgYnVpbGQgYSBuZXcgY2FtZXJhLgogICAgICoKICAgICAqIEBhYnN0cmFjdAogICAgICogQGF1Z21lbnRzIE9iamVjdDNECiAgICAgKi8KICAgIGNsYXNzIENhbWVyYSBleHRlbmRzIE9iamVjdDNEIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBjYW1lcmEuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNDYW1lcmEgPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ0NhbWVyYSc7CgogICAgCQkvKioKICAgIAkJICogVGhlIGludmVyc2Ugb2YgdGhlIGNhbWVyYSdzIHdvcmxkIG1hdHJpeC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge01hdHJpeDR9CiAgICAJCSAqLwogICAgCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cml4LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TWF0cml4NH0KICAgIAkJICovCiAgICAJCXRoaXMucHJvamVjdGlvbk1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgogICAgCQkvKioKICAgIAkJICogVGhlIGludmVyc2Ugb2YgdGhlIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cml4LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TWF0cml4NH0KICAgIAkJICovCiAgICAJCXRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UgPSBuZXcgTWF0cml4NCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBjb29yZGluYXRlIHN5c3RlbSBpbiB3aGljaCB0aGUgY2FtZXJhIGlzIHVzZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoV2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0pfQogICAgCQkgKi8KICAgIAkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gV2ViR0xDb29yZGluYXRlU3lzdGVtOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKICAgIAkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCiAgICAJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHNvdXJjZS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCiAgICAJCXRoaXMucHJvamVjdGlvbk1hdHJpeC5jb3B5KCBzb3VyY2UucHJvamVjdGlvbk1hdHJpeCApOwogICAgCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKICAgIAkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gc291cmNlLmNvb3JkaW5hdGVTeXN0ZW07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgKCJsb29rIikgZGlyZWN0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCiAgICAJICoKICAgIAkgKiBUaGlzIG1ldGhvZCBpcyBvdmVyd3JpdHRlbiBzaW5jZSBjYW1lcmFzIGhhdmUgYSBkaWZmZXJlbnQgZm9yd2FyZCB2ZWN0b3IgY29tcGFyZWQgdG8gb3RoZXIKICAgIAkgKiAzRCBvYmplY3RzLiBBIGNhbWVyYSBsb29rcyBkb3duIGl0cyBsb2NhbCwgbmVnYXRpdmUgei1heGlzIGJ5IGRlZmF1bHQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoZSByZXN1bHQgaXMgc3RvcmVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSAzRCBvYmplY3QncyBkaXJlY3Rpb24gaW4gd29ybGQgc3BhY2UuCiAgICAJICovCiAgICAJZ2V0V29ybGREaXJlY3Rpb24oIHRhcmdldCApIHsKCiAgICAJCXJldHVybiBzdXBlci5nZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkubmVnYXRlKCk7CgogICAgCX0KCiAgICAJdXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICkgewoKICAgIAkJc3VwZXIudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgogICAgCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgogICAgCX0KCiAgICAJdXBkYXRlV29ybGRNYXRyaXgoIHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuICkgewoKICAgIAkJc3VwZXIudXBkYXRlV29ybGRNYXRyaXgoIHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuICk7CgogICAgCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgogICAgCX0KCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX3YzJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfbWluVGFyZ2V0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwogICAgY29uc3QgX21heFRhcmdldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKCiAgICAvKioKICAgICAqIENhbWVyYSB0aGF0IHVzZXMgW3BlcnNwZWN0aXZlIHByb2plY3Rpb25de0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1BlcnNwZWN0aXZlXyhncmFwaGljYWwpfS4KICAgICAqCiAgICAgKiBUaGlzIHByb2plY3Rpb24gbW9kZSBpcyBkZXNpZ25lZCB0byBtaW1pYyB0aGUgd2F5IHRoZSBodW1hbiBleWUgc2Vlcy4gSXQKICAgICAqIGlzIHRoZSBtb3N0IGNvbW1vbiBwcm9qZWN0aW9uIG1vZGUgdXNlZCBmb3IgcmVuZGVyaW5nIGEgM0Qgc2NlbmUuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSggNDUsIHdpZHRoIC8gaGVpZ2h0LCAxLCAxMDAwICk7CiAgICAgKiBzY2VuZS5hZGQoIGNhbWVyYSApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIENhbWVyYQogICAgICovCiAgICBjbGFzcyBQZXJzcGVjdGl2ZUNhbWVyYSBleHRlbmRzIENhbWVyYSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgcGVyc3BlY3RpdmUgY2FtZXJhLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtmb3Y9NTBdIC0gVGhlIHZlcnRpY2FsIGZpZWxkIG9mIHZpZXcuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFthc3BlY3Q9MV0gLSBUaGUgYXNwZWN0IHJhdGlvLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbmVhcj0wLjFdIC0gVGhlIGNhbWVyYSdzIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtmYXI9MjAwMF0gLSBUaGUgY2FtZXJhJ3MgZmFyIHBsYW5lLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBmb3YgPSA1MCwgYXNwZWN0ID0gMSwgbmVhciA9IDAuMSwgZmFyID0gMjAwMCApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1BlcnNwZWN0aXZlQ2FtZXJhID0gdHJ1ZTsKCiAgICAJCXRoaXMudHlwZSA9ICdQZXJzcGVjdGl2ZUNhbWVyYSc7CgogICAgCQkvKioKICAgIAkJICogVGhlIHZlcnRpY2FsIGZpZWxkIG9mIHZpZXcsIGZyb20gYm90dG9tIHRvIHRvcCBvZiB2aWV3LAogICAgCQkgKiBpbiBkZWdyZWVzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCA1MAogICAgCQkgKi8KICAgIAkJdGhpcy5mb3YgPSBmb3Y7CgogICAgCQkvKioKICAgIAkJICogVGhlIHpvb20gZmFjdG9yIG9mIHRoZSBjYW1lcmEuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuem9vbSA9IDE7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNhbWVyYSdzIG5lYXIgcGxhbmUuIFRoZSB2YWxpZCByYW5nZSBpcyBncmVhdGVyIHRoYW4gYDBgCiAgICAJCSAqIGFuZCBsZXNzIHRoYW4gdGhlIGN1cnJlbnQgdmFsdWUgb2Yge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2Zhcn0uCiAgICAJCSAqCiAgICAJCSAqIE5vdGUgdGhhdCwgdW5saWtlIGZvciB0aGUge0BsaW5rIE9ydGhvZ3JhcGhpY0NhbWVyYX0sIGAwYCBpcyA8ZW0+bm90PC9lbT4gYQogICAgCQkgKiB2YWxpZCB2YWx1ZSBmb3IgYSBwZXJzcGVjdGl2ZSBjYW1lcmEncyBuZWFyIHBsYW5lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwLjEKICAgIAkJICovCiAgICAJCXRoaXMubmVhciA9IG5lYXI7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4gTXVzdCBiZSBncmVhdGVyIHRoYW4gdGhlCiAgICAJCSAqIGN1cnJlbnQgdmFsdWUgb2Yge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI25lYXJ9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAyMDAwCiAgICAJCSAqLwogICAgCQl0aGlzLmZhciA9IGZhcjsKCiAgICAJCS8qKgogICAgCQkgKiBPYmplY3QgZGlzdGFuY2UgdXNlZCBmb3Igc3RlcmVvc2NvcHkgYW5kIGRlcHRoLW9mLWZpZWxkIGVmZmVjdHMuIFRoaXMKICAgIAkJICogcGFyYW1ldGVyIGRvZXMgbm90IGluZmx1ZW5jZSB0aGUgcHJvamVjdGlvbiBtYXRyaXggdW5sZXNzIGEKICAgIAkJICoge0BsaW5rIFN0ZXJlb0NhbWVyYX0gaXMgYmVpbmcgdXNlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMTAKICAgIAkJICovCiAgICAJCXRoaXMuZm9jdXMgPSAxMDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgYXNwZWN0IHJhdGlvLCB1c3VhbGx5IHRoZSBjYW52YXMgd2lkdGggLyBjYW52YXMgaGVpZ2h0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLmFzcGVjdCA9IGFzcGVjdDsKCiAgICAJCS8qKgogICAgCQkgKiBSZXByZXNlbnRzIHRoZSBmcnVzdHVtIHdpbmRvdyBzcGVjaWZpY2F0aW9uLiBUaGlzIHByb3BlcnR5IHNob3VsZCBub3QgYmUgZWRpdGVkCiAgICAJCSAqIGRpcmVjdGx5IGJ1dCB2aWEge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI3NldFZpZXdPZmZzZXR9IGFuZCB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjY2xlYXJWaWV3T2Zmc2V0fS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9PYmplY3R9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMudmlldyA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogRmlsbSBzaXplIHVzZWQgZm9yIHRoZSBsYXJnZXIgYXhpcy4gRGVmYXVsdCBpcyBgMzVgIChtaWxsaW1ldGVycykuIFRoaXMKICAgIAkJICogcGFyYW1ldGVyIGRvZXMgbm90IGluZmx1ZW5jZSB0aGUgcHJvamVjdGlvbiBtYXRyaXggdW5sZXNzIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmaWxtT2Zmc2V0fQogICAgCQkgKiBpcyBzZXQgdG8gYSBub256ZXJvIHZhbHVlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAzNQogICAgCQkgKi8KICAgIAkJdGhpcy5maWxtR2F1Z2UgPSAzNTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3Jpem9udGFsIG9mZi1jZW50ZXIgb2Zmc2V0IGluIHRoZSBzYW1lIHVuaXQgYXMge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuZmlsbU9mZnNldCA9IDA7CgogICAgCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgogICAgCQl0aGlzLmZvdiA9IHNvdXJjZS5mb3Y7CiAgICAJCXRoaXMuem9vbSA9IHNvdXJjZS56b29tOwoKICAgIAkJdGhpcy5uZWFyID0gc291cmNlLm5lYXI7CiAgICAJCXRoaXMuZmFyID0gc291cmNlLmZhcjsKICAgIAkJdGhpcy5mb2N1cyA9IHNvdXJjZS5mb2N1czsKCiAgICAJCXRoaXMuYXNwZWN0ID0gc291cmNlLmFzcGVjdDsKICAgIAkJdGhpcy52aWV3ID0gc291cmNlLnZpZXcgPT09IG51bGwgPyBudWxsIDogT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS52aWV3ICk7CgogICAgCQl0aGlzLmZpbG1HYXVnZSA9IHNvdXJjZS5maWxtR2F1Z2U7CiAgICAJCXRoaXMuZmlsbU9mZnNldCA9IHNvdXJjZS5maWxtT2Zmc2V0OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgRk9WIGJ5IGZvY2FsIGxlbmd0aCBpbiByZXNwZWN0IHRvIHRoZSBjdXJyZW50IHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmaWxtR2F1Z2V9LgogICAgCSAqCiAgICAJICogVGhlIGRlZmF1bHQgZmlsbSBnYXVnZSBpcyAzNSwgc28gdGhhdCB0aGUgZm9jYWwgbGVuZ3RoIGNhbiBiZSBzcGVjaWZpZWQgZm9yCiAgICAJICogYSAzNW1tIChmdWxsIGZyYW1lKSBjYW1lcmEuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZm9jYWxMZW5ndGggLSBWYWx1ZXMgZm9yIGZvY2FsIGxlbmd0aCBhbmQgZmlsbSBnYXVnZSBtdXN0IGhhdmUgdGhlIHNhbWUgdW5pdC4KICAgIAkgKi8KICAgIAlzZXRGb2NhbExlbmd0aCggZm9jYWxMZW5ndGggKSB7CgogICAgCQkvKiogc2VlIHtAbGluayBodHRwOi8vd3d3LmJvYmF0a2lucy5jb20vcGhvdG9ncmFwaHkvdGVjaG5pY2FsL2ZpZWxkX29mX3ZpZXcuaHRtbH0gKi8KICAgIAkJY29uc3QgdkV4dGVudFNsb3BlID0gMC41ICogdGhpcy5nZXRGaWxtSGVpZ2h0KCkgLyBmb2NhbExlbmd0aDsKCiAgICAJCXRoaXMuZm92ID0gUkFEMkRFRyAqIDIgKiBNYXRoLmF0YW4oIHZFeHRlbnRTbG9wZSApOwogICAgCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBmb2NhbCBsZW5ndGggZnJvbSB0aGUgY3VycmVudCB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZm92fSBhbmQKICAgIAkgKiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNvbXB1dGVkIGZvY2FsIGxlbmd0aC4KICAgIAkgKi8KICAgIAlnZXRGb2NhbExlbmd0aCgpIHsKCiAgICAJCWNvbnN0IHZFeHRlbnRTbG9wZSA9IE1hdGgudGFuKCBERUcyUkFEICogMC41ICogdGhpcy5mb3YgKTsKCiAgICAJCXJldHVybiAwLjUgKiB0aGlzLmdldEZpbG1IZWlnaHQoKSAvIHZFeHRlbnRTbG9wZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IHZlcnRpY2FsIGZpZWxkIG9mIHZpZXcgYW5nbGUgaW4gZGVncmVlcyBjb25zaWRlcmluZyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjem9vbX0uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBlZmZlY3RpdmUgRk9WLgogICAgCSAqLwogICAgCWdldEVmZmVjdGl2ZUZPVigpIHsKCiAgICAJCXJldHVybiBSQUQyREVHICogMiAqIE1hdGguYXRhbigKICAgIAkJCU1hdGgudGFuKCBERUcyUkFEICogMC41ICogdGhpcy5mb3YgKSAvIHRoaXMuem9vbSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHdpZHRoIG9mIHRoZSBpbWFnZSBvbiB0aGUgZmlsbS4gSWYge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2FzcGVjdH0gaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAJICogZXF1YWwgdG8gb25lIChsYW5kc2NhcGUgZm9ybWF0KSwgdGhlIHJlc3VsdCBlcXVhbHMge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBmaWxtIHdpZHRoLgogICAgCSAqLwogICAgCWdldEZpbG1XaWR0aCgpIHsKCiAgICAJCS8vIGZpbG0gbm90IGNvbXBsZXRlbHkgY292ZXJlZCBpbiBwb3J0cmFpdCBmb3JtYXQgKGFzcGVjdCA8IDEpCiAgICAJCXJldHVybiB0aGlzLmZpbG1HYXVnZSAqIE1hdGgubWluKCB0aGlzLmFzcGVjdCwgMSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGhlaWdodCBvZiB0aGUgaW1hZ2Ugb24gdGhlIGZpbG0uIElmIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNhc3BlY3R9IGlzIGdyZWF0ZXIgdGhhbiBvcgogICAgCSAqIGVxdWFsIHRvIG9uZSAobGFuZHNjYXBlIGZvcm1hdCksIHRoZSByZXN1bHQgZXF1YWxzIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmaWxtR2F1Z2V9LgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZmlsbSB3aWR0aC4KICAgIAkgKi8KICAgIAlnZXRGaWxtSGVpZ2h0KCkgewoKICAgIAkJLy8gZmlsbSBub3QgY29tcGxldGVseSBjb3ZlcmVkIGluIGxhbmRzY2FwZSBmb3JtYXQgKGFzcGVjdCA+IDEpCiAgICAJCXJldHVybiB0aGlzLmZpbG1HYXVnZSAvIE1hdGgubWF4KCB0aGlzLmFzcGVjdCwgMSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSAyRCBib3VuZHMgb2YgdGhlIGNhbWVyYSdzIHZpZXdhYmxlIHJlY3RhbmdsZSBhdCBhIGdpdmVuIGRpc3RhbmNlIGFsb25nIHRoZSB2aWV3aW5nIGRpcmVjdGlvbi4KICAgIAkgKiBTZXRzIGBtaW5UYXJnZXRgIGFuZCBgbWF4VGFyZ2V0YCB0byB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIGxvd2VyLWxlZnQgYW5kIHVwcGVyLXJpZ2h0IGNvcm5lcnMgb2YgdGhlIHZpZXcgcmVjdGFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGRpc3RhbmNlIC0gVGhlIHZpZXdpbmcgZGlzdGFuY2UuCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSBtaW5UYXJnZXQgLSBUaGUgbG93ZXItbGVmdCBjb3JuZXIgb2YgdGhlIHZpZXcgcmVjdGFuZ2xlIGlzIHdyaXR0ZW4gaW50byB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1heFRhcmdldCAtIFRoZSB1cHBlci1yaWdodCBjb3JuZXIgb2YgdGhlIHZpZXcgcmVjdGFuZ2xlIGlzIHdyaXR0ZW4gaW50byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlnZXRWaWV3Qm91bmRzKCBkaXN0YW5jZSwgbWluVGFyZ2V0LCBtYXhUYXJnZXQgKSB7CgogICAgCQlfdjMkMS5zZXQoIC0xLCAtMSwgMC41ICkuYXBwbHlNYXRyaXg0KCB0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgogICAgCQltaW5UYXJnZXQuc2V0KCBfdjMkMS54LCBfdjMkMS55ICkubXVsdGlwbHlTY2FsYXIoIC0gZGlzdGFuY2UgLyBfdjMkMS56ICk7CgogICAgCQlfdjMkMS5zZXQoIDEsIDEsIDAuNSApLmFwcGx5TWF0cml4NCggdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKICAgIAkJbWF4VGFyZ2V0LnNldCggX3YzJDEueCwgX3YzJDEueSApLm11bHRpcGx5U2NhbGFyKCAtIGRpc3RhbmNlIC8gX3YzJDEueiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBjYW1lcmEncyB2aWV3YWJsZSByZWN0YW5nbGUgYXQgYSBnaXZlbiBkaXN0YW5jZSBhbG9uZyB0aGUgdmlld2luZyBkaXJlY3Rpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgdmlld2luZyBkaXN0YW5jZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSByZXN1bHQgd2hlcmUgeCBpcyB3aWR0aCBhbmQgeSBpcyBoZWlnaHQuCiAgICAJICogQHJldHVybnMge1ZlY3RvcjJ9IFRoZSB2aWV3IHNpemUuCiAgICAJICovCiAgICAJZ2V0Vmlld1NpemUoIGRpc3RhbmNlLCB0YXJnZXQgKSB7CgogICAgCQl0aGlzLmdldFZpZXdCb3VuZHMoIGRpc3RhbmNlLCBfbWluVGFyZ2V0LCBfbWF4VGFyZ2V0ICk7CgogICAgCQlyZXR1cm4gdGFyZ2V0LnN1YlZlY3RvcnMoIF9tYXhUYXJnZXQsIF9taW5UYXJnZXQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIGFuIG9mZnNldCBpbiBhIGxhcmdlciBmcnVzdHVtLiBUaGlzIGlzIHVzZWZ1bCBmb3IgbXVsdGktd2luZG93IG9yCiAgICAJICogbXVsdGktbW9uaXRvci9tdWx0aS1tYWNoaW5lIHNldHVwcy4KICAgIAkgKgogICAgCSAqIEZvciBleGFtcGxlLCBpZiB5b3UgaGF2ZSAzeDIgbW9uaXRvcnMgYW5kIGVhY2ggbW9uaXRvciBpcyAxOTIweDEwODAgYW5kCiAgICAJICogdGhlIG1vbml0b3JzIGFyZSBpbiBncmlkIGxpa2UgdGhpcwogICAgCSAqYGBgCiAgICAJICogICArLS0tKy0tLSstLS0rCiAgICAJICogICB8IEEgfCBCIHwgQyB8CiAgICAJICogICArLS0tKy0tLSstLS0rCiAgICAJICogICB8IEQgfCBFIHwgRiB8CiAgICAJICogICArLS0tKy0tLSstLS0rCiAgICAJICpgYGAKICAgIAkgKiB0aGVuIGZvciBlYWNoIG1vbml0b3IgeW91IHdvdWxkIGNhbGwgaXQgbGlrZSB0aGlzOgogICAgCSAqYGBganMKICAgIAkgKiBjb25zdCB3ID0gMTkyMDsKICAgIAkgKiBjb25zdCBoID0gMTA4MDsKICAgIAkgKiBjb25zdCBmdWxsV2lkdGggPSB3ICogMzsKICAgIAkgKiBjb25zdCBmdWxsSGVpZ2h0ID0gaCAqIDI7CiAgICAJICoKICAgIAkgKiAvLyAtLUEtLQogICAgCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAwLCBoICogMCwgdywgaCApOwogICAgCSAqIC8vIC0tQi0tCiAgICAJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDEsIGggKiAwLCB3LCBoICk7CiAgICAJICogLy8gLS1DLS0KICAgIAkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMiwgaCAqIDAsIHcsIGggKTsKICAgIAkgKiAvLyAtLUQtLQogICAgCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAwLCBoICogMSwgdywgaCApOwogICAgCSAqIC8vIC0tRS0tCiAgICAJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDEsIGggKiAxLCB3LCBoICk7CiAgICAJICogLy8gLS1GLS0KICAgIAkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMiwgaCAqIDEsIHcsIGggKTsKICAgIAkgKiBgYGAKICAgIAkgKgogICAgCSAqIE5vdGUgdGhlcmUgaXMgbm8gcmVhc29uIG1vbml0b3JzIGhhdmUgdG8gYmUgdGhlIHNhbWUgc2l6ZSBvciBpbiBhIGdyaWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZnVsbFdpZHRoIC0gVGhlIGZ1bGwgd2lkdGggb2YgbXVsdGl2aWV3IHNldHVwLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsSGVpZ2h0IC0gVGhlIGZ1bGwgaGVpZ2h0IG9mIG11bHRpdmlldyBzZXR1cC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBob3Jpem9udGFsIG9mZnNldCBvZiB0aGUgc3ViY2FtZXJhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZlcnRpY2FsIG9mZnNldCBvZiB0aGUgc3ViY2FtZXJhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiBzdWJjYW1lcmEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2Ygc3ViY2FtZXJhLgogICAgCSAqLwogICAgCXNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCiAgICAJCXRoaXMuYXNwZWN0ID0gZnVsbFdpZHRoIC8gZnVsbEhlaWdodDsKCiAgICAJCWlmICggdGhpcy52aWV3ID09PSBudWxsICkgewoKICAgIAkJCXRoaXMudmlldyA9IHsKICAgIAkJCQllbmFibGVkOiB0cnVlLAogICAgCQkJCWZ1bGxXaWR0aDogMSwKICAgIAkJCQlmdWxsSGVpZ2h0OiAxLAogICAgCQkJCW9mZnNldFg6IDAsCiAgICAJCQkJb2Zmc2V0WTogMCwKICAgIAkJCQl3aWR0aDogMSwKICAgIAkJCQloZWlnaHQ6IDEKICAgIAkJCX07CgogICAgCQl9CgogICAgCQl0aGlzLnZpZXcuZW5hYmxlZCA9IHRydWU7CiAgICAJCXRoaXMudmlldy5mdWxsV2lkdGggPSBmdWxsV2lkdGg7CiAgICAJCXRoaXMudmlldy5mdWxsSGVpZ2h0ID0gZnVsbEhlaWdodDsKICAgIAkJdGhpcy52aWV3Lm9mZnNldFggPSB4OwogICAgCQl0aGlzLnZpZXcub2Zmc2V0WSA9IHk7CiAgICAJCXRoaXMudmlldy53aWR0aCA9IHdpZHRoOwogICAgCQl0aGlzLnZpZXcuaGVpZ2h0ID0gaGVpZ2h0OwoKICAgIAkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVtb3ZlcyB0aGUgdmlldyBvZmZzZXQgZnJvbSB0aGUgcHJvamVjdGlvbiBtYXRyaXguCiAgICAJICovCiAgICAJY2xlYXJWaWV3T2Zmc2V0KCkgewoKICAgIAkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy52aWV3LmVuYWJsZWQgPSBmYWxzZTsKCiAgICAJCX0KCiAgICAJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFVwZGF0ZXMgdGhlIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cml4LiBNdXN0IGJlIGNhbGxlZCBhZnRlciBhbnkgY2hhbmdlIG9mCiAgICAJICogY2FtZXJhIHByb3BlcnRpZXMuCiAgICAJICovCiAgICAJdXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpIHsKCiAgICAJCWNvbnN0IG5lYXIgPSB0aGlzLm5lYXI7CiAgICAJCWxldCB0b3AgPSBuZWFyICogTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApIC8gdGhpcy56b29tOwogICAgCQlsZXQgaGVpZ2h0ID0gMiAqIHRvcDsKICAgIAkJbGV0IHdpZHRoID0gdGhpcy5hc3BlY3QgKiBoZWlnaHQ7CiAgICAJCWxldCBsZWZ0ID0gLTAuNSAqIHdpZHRoOwogICAgCQljb25zdCB2aWV3ID0gdGhpcy52aWV3OwoKICAgIAkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgJiYgdGhpcy52aWV3LmVuYWJsZWQgKSB7CgogICAgCQkJY29uc3QgZnVsbFdpZHRoID0gdmlldy5mdWxsV2lkdGgsCiAgICAJCQkJZnVsbEhlaWdodCA9IHZpZXcuZnVsbEhlaWdodDsKCiAgICAJCQlsZWZ0ICs9IHZpZXcub2Zmc2V0WCAqIHdpZHRoIC8gZnVsbFdpZHRoOwogICAgCQkJdG9wIC09IHZpZXcub2Zmc2V0WSAqIGhlaWdodCAvIGZ1bGxIZWlnaHQ7CiAgICAJCQl3aWR0aCAqPSB2aWV3LndpZHRoIC8gZnVsbFdpZHRoOwogICAgCQkJaGVpZ2h0ICo9IHZpZXcuaGVpZ2h0IC8gZnVsbEhlaWdodDsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHNrZXcgPSB0aGlzLmZpbG1PZmZzZXQ7CiAgICAJCWlmICggc2tldyAhPT0gMCApIGxlZnQgKz0gbmVhciAqIHNrZXcgLyB0aGlzLmdldEZpbG1XaWR0aCgpOwoKICAgIAkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgbGVmdCArIHdpZHRoLCB0b3AsIHRvcCAtIGhlaWdodCwgbmVhciwgdGhpcy5mYXIsIHRoaXMuY29vcmRpbmF0ZVN5c3RlbSApOwoKICAgIAkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCB0aGlzLnByb2plY3Rpb25NYXRyaXggKS5pbnZlcnQoKTsKCiAgICAJfQoKICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgogICAgCQlkYXRhLm9iamVjdC5mb3YgPSB0aGlzLmZvdjsKICAgIAkJZGF0YS5vYmplY3Quem9vbSA9IHRoaXMuem9vbTsKCiAgICAJCWRhdGEub2JqZWN0Lm5lYXIgPSB0aGlzLm5lYXI7CiAgICAJCWRhdGEub2JqZWN0LmZhciA9IHRoaXMuZmFyOwogICAgCQlkYXRhLm9iamVjdC5mb2N1cyA9IHRoaXMuZm9jdXM7CgogICAgCQlkYXRhLm9iamVjdC5hc3BlY3QgPSB0aGlzLmFzcGVjdDsKCiAgICAJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgZGF0YS5vYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCB0aGlzLnZpZXcgKTsKCiAgICAJCWRhdGEub2JqZWN0LmZpbG1HYXVnZSA9IHRoaXMuZmlsbUdhdWdlOwogICAgCQlkYXRhLm9iamVjdC5maWxtT2Zmc2V0ID0gdGhpcy5maWxtT2Zmc2V0OwoKICAgIAkJcmV0dXJuIGRhdGE7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgZm92ID0gLTkwOyAvLyBuZWdhdGl2ZSBmb3YgaXMgbm90IGFuIGVycm9yCiAgICBjb25zdCBhc3BlY3QgPSAxOwoKICAgIC8qKgogICAgICogQSBzcGVjaWFsIHR5cGUgb2YgY2FtZXJhIHRoYXQgaXMgcG9zaXRpb25lZCBpbiAzRCBzcGFjZSB0byByZW5kZXIgaXRzIHN1cnJvdW5kaW5ncyBpbnRvIGEKICAgICAqIGN1YmUgcmVuZGVyIHRhcmdldC4gVGhlIHJlbmRlciB0YXJnZXQgY2FuIHRoZW4gYmUgdXNlZCBhcyBhbiBlbnZpcm9ubWVudCBtYXAgZm9yIHJlbmRlcmluZwogICAgICogcmVhbHRpbWUgcmVmbGVjdGlvbnMgaW4geW91ciBzY2VuZS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogLy8gQ3JlYXRlIGN1YmUgcmVuZGVyIHRhcmdldAogICAgICogY29uc3QgY3ViZVJlbmRlclRhcmdldCA9IG5ldyBUSFJFRS5XZWJHTEN1YmVSZW5kZXJUYXJnZXQoIDI1NiwgeyBnZW5lcmF0ZU1pcG1hcHM6IHRydWUsIG1pbkZpbHRlcjogVEhSRUUuTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyIH0gKTsKICAgICAqCiAgICAgKiAvLyBDcmVhdGUgY3ViZSBjYW1lcmEKICAgICAqIGNvbnN0IGN1YmVDYW1lcmEgPSBuZXcgVEhSRUUuQ3ViZUNhbWVyYSggMSwgMTAwMDAwLCBjdWJlUmVuZGVyVGFyZ2V0ICk7CiAgICAgKiBzY2VuZS5hZGQoIGN1YmVDYW1lcmEgKTsKICAgICAqCiAgICAgKiAvLyBDcmVhdGUgY2FyCiAgICAgKiBjb25zdCBjaHJvbWVNYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZmZiwgZW52TWFwOiBjdWJlUmVuZGVyVGFyZ2V0LnRleHR1cmUgfSApOwogICAgICogY29uc3QgY2FyID0gbmV3IFRIUkVFLk1lc2goIGNhckdlb21ldHJ5LCBjaHJvbWVNYXRlcmlhbCApOwogICAgICogc2NlbmUuYWRkKCBjYXIgKTsKICAgICAqCiAgICAgKiAvLyBVcGRhdGUgdGhlIHJlbmRlciB0YXJnZXQgY3ViZQogICAgICogY2FyLnZpc2libGUgPSBmYWxzZTsKICAgICAqIGN1YmVDYW1lcmEucG9zaXRpb24uY29weSggY2FyLnBvc2l0aW9uICk7CiAgICAgKiBjdWJlQ2FtZXJhLnVwZGF0ZSggcmVuZGVyZXIsIHNjZW5lICk7CiAgICAgKgogICAgICogLy8gUmVuZGVyIHRoZSBzY2VuZQogICAgICogY2FyLnZpc2libGUgPSB0cnVlOwogICAgICogcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAYXVnbWVudHMgT2JqZWN0M0QKICAgICAqLwogICAgY2xhc3MgQ3ViZUNhbWVyYSBleHRlbmRzIE9iamVjdDNEIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBjdWJlIGNhbWVyYS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBuZWFyIC0gVGhlIGNhbWVyYSdzIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGZhciAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtXZWJHTEN1YmVSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSBjdWJlIHJlbmRlciB0YXJnZXQuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIG5lYXIsIGZhciwgcmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCXRoaXMudHlwZSA9ICdDdWJlQ2FtZXJhJzsKCiAgICAJCS8qKgogICAgCQkgKiBBIHJlZmVyZW5jZSB0byB0aGUgY3ViZSByZW5kZXIgdGFyZ2V0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7V2ViR0xDdWJlUmVuZGVyVGFyZ2V0fQogICAgCQkgKi8KICAgIAkJdGhpcy5yZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQ7CgogICAgCQkvKioKICAgIAkJICogVGhlIGN1cnJlbnQgYWN0aXZlIGNvb3JkaW5hdGUgc3lzdGVtLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7PyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuY29vcmRpbmF0ZVN5c3RlbSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGN1cnJlbnQgYWN0aXZlIG1pcG1hcCBsZXZlbAogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmFjdGl2ZU1pcG1hcExldmVsID0gMDsKCiAgICAJCWNvbnN0IGNhbWVyYVBYID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNhbWVyYVBYLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgCQl0aGlzLmFkZCggY2FtZXJhUFggKTsKCiAgICAJCWNvbnN0IGNhbWVyYU5YID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNhbWVyYU5YLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgCQl0aGlzLmFkZCggY2FtZXJhTlggKTsKCiAgICAJCWNvbnN0IGNhbWVyYVBZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNhbWVyYVBZLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgCQl0aGlzLmFkZCggY2FtZXJhUFkgKTsKCiAgICAJCWNvbnN0IGNhbWVyYU5ZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNhbWVyYU5ZLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgCQl0aGlzLmFkZCggY2FtZXJhTlkgKTsKCiAgICAJCWNvbnN0IGNhbWVyYVBaID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNhbWVyYVBaLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgCQl0aGlzLmFkZCggY2FtZXJhUFogKTsKCiAgICAJCWNvbnN0IGNhbWVyYU5aID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNhbWVyYU5aLmxheWVycyA9IHRoaXMubGF5ZXJzOwogICAgCQl0aGlzLmFkZCggY2FtZXJhTlogKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdXN0IGJlIGNhbGxlZCB3aGVuIHRoZSBjb29yZGluYXRlIHN5c3RlbSBvZiB0aGUgY3ViZSBjYW1lcmEgaXMgY2hhbmdlZC4KICAgIAkgKi8KICAgIAl1cGRhdGVDb29yZGluYXRlU3lzdGVtKCkgewoKICAgIAkJY29uc3QgY29vcmRpbmF0ZVN5c3RlbSA9IHRoaXMuY29vcmRpbmF0ZVN5c3RlbTsKCiAgICAJCWNvbnN0IGNhbWVyYXMgPSB0aGlzLmNoaWxkcmVuLmNvbmNhdCgpOwoKICAgIAkJY29uc3QgWyBjYW1lcmFQWCwgY2FtZXJhTlgsIGNhbWVyYVBZLCBjYW1lcmFOWSwgY2FtZXJhUFosIGNhbWVyYU5aIF0gPSBjYW1lcmFzOwoKICAgIAkJZm9yICggY29uc3QgY2FtZXJhIG9mIGNhbWVyYXMgKSB0aGlzLnJlbW92ZSggY2FtZXJhICk7CgogICAgCQlpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCiAgICAJCQljYW1lcmFQWC51cC5zZXQoIDAsIDEsIDAgKTsKICAgIAkJCWNhbWVyYVBYLmxvb2tBdCggMSwgMCwgMCApOwoKICAgIAkJCWNhbWVyYU5YLnVwLnNldCggMCwgMSwgMCApOwogICAgCQkJY2FtZXJhTlgubG9va0F0KCAtMSwgMCwgMCApOwoKICAgIAkJCWNhbWVyYVBZLnVwLnNldCggMCwgMCwgLTEgKTsKICAgIAkJCWNhbWVyYVBZLmxvb2tBdCggMCwgMSwgMCApOwoKICAgIAkJCWNhbWVyYU5ZLnVwLnNldCggMCwgMCwgMSApOwogICAgCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtMSwgMCApOwoKICAgIAkJCWNhbWVyYVBaLnVwLnNldCggMCwgMSwgMCApOwogICAgCQkJY2FtZXJhUFoubG9va0F0KCAwLCAwLCAxICk7CgogICAgCQkJY2FtZXJhTloudXAuc2V0KCAwLCAxLCAwICk7CiAgICAJCQljYW1lcmFOWi5sb29rQXQoIDAsIDAsIC0xICk7CgogICAgCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCWNhbWVyYVBYLnVwLnNldCggMCwgLTEsIDAgKTsKICAgIAkJCWNhbWVyYVBYLmxvb2tBdCggLTEsIDAsIDAgKTsKCiAgICAJCQljYW1lcmFOWC51cC5zZXQoIDAsIC0xLCAwICk7CiAgICAJCQljYW1lcmFOWC5sb29rQXQoIDEsIDAsIDAgKTsKCiAgICAJCQljYW1lcmFQWS51cC5zZXQoIDAsIDAsIDEgKTsKICAgIAkJCWNhbWVyYVBZLmxvb2tBdCggMCwgMSwgMCApOwoKICAgIAkJCWNhbWVyYU5ZLnVwLnNldCggMCwgMCwgLTEgKTsKICAgIAkJCWNhbWVyYU5ZLmxvb2tBdCggMCwgLTEsIDAgKTsKCiAgICAJCQljYW1lcmFQWi51cC5zZXQoIDAsIC0xLCAwICk7CiAgICAJCQljYW1lcmFQWi5sb29rQXQoIDAsIDAsIDEgKTsKCiAgICAJCQljYW1lcmFOWi51cC5zZXQoIDAsIC0xLCAwICk7CiAgICAJCQljYW1lcmFOWi5sb29rQXQoIDAsIDAsIC0xICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkN1YmVDYW1lcmEudXBkYXRlQ29vcmRpbmF0ZVN5c3RlbSgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKICAgIAkJfQoKICAgIAkJZm9yICggY29uc3QgY2FtZXJhIG9mIGNhbWVyYXMgKSB7CgogICAgCQkJdGhpcy5hZGQoIGNhbWVyYSApOwoKICAgIAkJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGxpbmcgdGhpcyBtZXRob2Qgd2lsbCByZW5kZXIgdGhlIGdpdmVuIHNjZW5lIHdpdGggdGhlIGdpdmVuIHJlbmRlcmVyCiAgICAJICogaW50byB0aGUgY3ViZSByZW5kZXIgdGFyZ2V0IG9mIHRoZSBjYW1lcmEuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhSZW5kZXJlcnxXZWJHTFJlbmRlcmVyKX0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgLSBUaGUgc2NlbmUgdG8gcmVuZGVyLgogICAgCSAqLwogICAgCXVwZGF0ZSggcmVuZGVyZXIsIHNjZW5lICkgewoKICAgIAkJaWYgKCB0aGlzLnBhcmVudCA9PT0gbnVsbCApIHRoaXMudXBkYXRlTWF0cml4V29ybGQoKTsKCiAgICAJCWNvbnN0IHsgcmVuZGVyVGFyZ2V0LCBhY3RpdmVNaXBtYXBMZXZlbCB9ID0gdGhpczsKCiAgICAJCWlmICggdGhpcy5jb29yZGluYXRlU3lzdGVtICE9PSByZW5kZXJlci5jb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCXRoaXMuY29vcmRpbmF0ZVN5c3RlbSA9IHJlbmRlcmVyLmNvb3JkaW5hdGVTeXN0ZW07CgogICAgCQkJdGhpcy51cGRhdGVDb29yZGluYXRlU3lzdGVtKCk7CgogICAgCQl9CgogICAgCQljb25zdCBbIGNhbWVyYVBYLCBjYW1lcmFOWCwgY2FtZXJhUFksIGNhbWVyYU5ZLCBjYW1lcmFQWiwgY2FtZXJhTlogXSA9IHRoaXMuY2hpbGRyZW47CgogICAgCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAJCWNvbnN0IGN1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IHJlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CiAgICAJCWNvbnN0IGN1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IHJlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CgogICAgCQljb25zdCBjdXJyZW50WHJFbmFibGVkID0gcmVuZGVyZXIueHIuZW5hYmxlZDsKCiAgICAJCXJlbmRlcmVyLnhyLmVuYWJsZWQgPSBmYWxzZTsKCiAgICAJCWNvbnN0IGdlbmVyYXRlTWlwbWFwcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwczsKCiAgICAJCXJlbmRlclRhcmdldC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDAsIGFjdGl2ZU1pcG1hcExldmVsICk7CiAgICAJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVBYICk7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKICAgIAkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlggKTsKCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCAyLCBhY3RpdmVNaXBtYXBMZXZlbCApOwogICAgCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWSApOwoKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDMsIGFjdGl2ZU1pcG1hcExldmVsICk7CiAgICAJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYU5ZICk7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgNCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKICAgIAkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhUFogKTsKCiAgICAJCS8vIG1pcG1hcHMgYXJlIGdlbmVyYXRlZCBkdXJpbmcgdGhlIGxhc3QgY2FsbCBvZiByZW5kZXIoKQogICAgCQkvLyBhdCB0aGlzIHBvaW50LCBhbGwgc2lkZXMgb2YgdGhlIGN1YmUgcmVuZGVyIHRhcmdldCBhcmUgZGVmaW5lZAoKICAgIAkJcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZ2VuZXJhdGVNaXBtYXBzOwoKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDUsIGFjdGl2ZU1pcG1hcExldmVsICk7CiAgICAJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYU5aICk7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQsIGN1cnJlbnRBY3RpdmVDdWJlRmFjZSwgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsICk7CgogICAgCQlyZW5kZXJlci54ci5lbmFibGVkID0gY3VycmVudFhyRW5hYmxlZDsKCiAgICAJCXJlbmRlclRhcmdldC50ZXh0dXJlLm5lZWRzUE1SRU1VcGRhdGUgPSB0cnVlOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ3JlYXRlcyBhIGN1YmUgdGV4dHVyZSBtYWRlIHVwIG9mIHNpeCBpbWFnZXMuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5DdWJlVGV4dHVyZUxvYWRlcigpOwogICAgICogbG9hZGVyLnNldFBhdGgoICd0ZXh0dXJlcy9jdWJlL3Bpc2EvJyApOwogICAgICoKICAgICAqIGNvbnN0IHRleHR1cmVDdWJlID0gbG9hZGVyLmxvYWQoIFsKICAgICAqIAkncHgucG5nJywgJ254LnBuZycsICdweS5wbmcnLCAnbnkucG5nJywgJ3B6LnBuZycsICduei5wbmcnCiAgICAgKiBdICk7CiAgICAgKgogICAgICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBlbnZNYXA6IHRleHR1cmVDdWJlIH0gKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBUZXh0dXJlCiAgICAgKi8KICAgIGNsYXNzIEN1YmVUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgY3ViZSB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxJbWFnZT59IFtpbWFnZXM9W11dIC0gQW4gYXJyYXkgaG9sZGluZyBhIGltYWdlIGZvciBlYWNoIHNpZGUgb2YgYSBjdWJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1DdWJlUmVmbGVjdGlvbk1hcHBpbmddIC0gVGhlIHRleHR1cmUgbWFwcGluZy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBTIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFQgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYWdGaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtYWcgZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWluRmlsdGVyPUxpbmVhck1pcG1hcExpbmVhckZpbHRlcl0gLSBUaGUgbWluIGZpbHRlciB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2Zvcm1hdD1SR0JBRm9ybWF0XSAtIFRoZSB0ZXh0dXJlIGZvcm1hdC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3R5cGU9VW5zaWduZWRCeXRlVHlwZV0gLSBUaGUgdGV4dHVyZSB0eXBlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbYW5pc290cm9weT1UZXh0dXJlLkRFRkFVTFRfQU5JU09UUk9QWV0gLSBUaGUgYW5pc290cm9weSB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Tm9Db2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZSB2YWx1ZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggaW1hZ2VzID0gW10sIG1hcHBpbmcgPSBDdWJlUmVmbGVjdGlvbk1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSwgY29sb3JTcGFjZSApIHsKCiAgICAJCXN1cGVyKCBpbWFnZXMsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSwgY29sb3JTcGFjZSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNDdWJlVGV4dHVyZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCiAgICAJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBbGlhcyBmb3Ige0BsaW5rIEN1YmVUZXh0dXJlI2ltYWdlfS4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtBcnJheTxJbWFnZT59CiAgICAJICovCiAgICAJZ2V0IGltYWdlcygpIHsKCiAgICAJCXJldHVybiB0aGlzLmltYWdlOwoKICAgIAl9CgogICAgCXNldCBpbWFnZXMoIHZhbHVlICkgewoKICAgIAkJdGhpcy5pbWFnZSA9IHZhbHVlOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSBjdWJlIHJlbmRlciB0YXJnZXQgdXNlZCBpbiBjb250ZXh0IG9mIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgV2ViR0xSZW5kZXJUYXJnZXQKICAgICAqLwogICAgY2xhc3MgV2ViR0xDdWJlUmVuZGVyVGFyZ2V0IGV4dGVuZHMgV2ViR0xSZW5kZXJUYXJnZXQgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGN1YmUgcmVuZGVyIHRhcmdldC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbc2l6ZT0xXSAtIFRoZSBzaXplIG9mIHRoZSByZW5kZXIgdGFyZ2V0LgogICAgCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3Rvciggc2l6ZSA9IDEsIG9wdGlvbnMgPSB7fSApIHsKCiAgICAJCXN1cGVyKCBzaXplLCBzaXplLCBvcHRpb25zICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9IHRydWU7CgogICAgCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHNpemUsIGhlaWdodDogc2l6ZSwgZGVwdGg6IDEgfTsKICAgIAkJY29uc3QgaW1hZ2VzID0gWyBpbWFnZSwgaW1hZ2UsIGltYWdlLCBpbWFnZSwgaW1hZ2UsIGltYWdlIF07CgogICAgCQkvKioKICAgIAkJICogT3ZlcndyaXR0ZW4gd2l0aCBhIGRpZmZlcmVudCB0ZXh0dXJlIHR5cGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtEYXRhQXJyYXlUZXh0dXJlfQogICAgCQkgKi8KICAgIAkJdGhpcy50ZXh0dXJlID0gbmV3IEN1YmVUZXh0dXJlKCBpbWFnZXMgKTsKICAgIAkJdGhpcy5fc2V0VGV4dHVyZU9wdGlvbnMoIG9wdGlvbnMgKTsKCiAgICAJCS8vIEJ5IGNvbnZlbnRpb24gLS0gbGlrZWx5IGJhc2VkIG9uIHRoZSBSZW5kZXJNYW4gc3BlYyBmcm9tIHRoZSAxOTkwJ3MgLS0gY3ViZSBtYXBzIGFyZSBzcGVjaWZpZWQgYnkgV2ViR0wgKGFuZCB0aHJlZS5qcykKICAgIAkJLy8gaW4gYSBjb29yZGluYXRlIHN5c3RlbSBpbiB3aGljaCBwb3NpdGl2ZS14IGlzIHRvIHRoZSByaWdodCB3aGVuIGxvb2tpbmcgdXAgdGhlIHBvc2l0aXZlLXogYXhpcyAtLSBpbiBvdGhlciB3b3JkcywKICAgIAkJLy8gaW4gYSBsZWZ0LWhhbmRlZCBjb29yZGluYXRlIHN5c3RlbS4gQnkgY29udGludWluZyB0aGlzIGNvbnZlbnRpb24sIHByZWV4aXN0aW5nIGN1YmUgbWFwcyBjb250aW51ZWQgdG8gcmVuZGVyIGNvcnJlY3RseS4KCiAgICAJCS8vIHRocmVlLmpzIHVzZXMgYSByaWdodC1oYW5kZWQgY29vcmRpbmF0ZSBzeXN0ZW0uIFNvIGVudmlyb25tZW50IG1hcHMgdXNlZCBpbiB0aHJlZS5qcyBhcHBlYXIgdG8gaGF2ZSBweCBhbmQgbnggc3dhcHBlZAogICAgCQkvLyBhbmQgdGhlIGZsYWcgaXNSZW5kZXJUYXJnZXRUZXh0dXJlIGNvbnRyb2xzIHRoaXMgY29udmVyc2lvbi4gVGhlIGZsaXAgaXMgbm90IHJlcXVpcmVkIHdoZW4gdXNpbmcgV2ViR0xDdWJlUmVuZGVyVGFyZ2V0LnRleHR1cmUKICAgIAkJLy8gYXMgYSBjdWJlIHRleHR1cmUgKHRoaXMgaXMgZGV0ZWN0ZWQgd2hlbiBpc1JlbmRlclRhcmdldFRleHR1cmUgaXMgc2V0IHRvIHRydWUgZm9yIGN1YmUgdGV4dHVyZXMpLgoKICAgIAkJdGhpcy50ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IHRydWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhlIGdpdmVuIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlIHRvIGEgY3ViZSBtYXAuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7VGV4dHVyZX0gdGV4dHVyZSAtIFRoZSBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZS4KICAgIAkgKiBAcmV0dXJuIHtXZWJHTEN1YmVSZW5kZXJUYXJnZXR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY3ViZSByZW5kZXIgdGFyZ2V0LgogICAgCSAqLwogICAgCWZyb21FcXVpcmVjdGFuZ3VsYXJUZXh0dXJlKCByZW5kZXJlciwgdGV4dHVyZSApIHsKCiAgICAJCXRoaXMudGV4dHVyZS50eXBlID0gdGV4dHVyZS50eXBlOwogICAgCQl0aGlzLnRleHR1cmUuY29sb3JTcGFjZSA9IHRleHR1cmUuY29sb3JTcGFjZTsKCiAgICAJCXRoaXMudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwczsKICAgIAkJdGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IHRleHR1cmUubWluRmlsdGVyOwogICAgCQl0aGlzLnRleHR1cmUubWFnRmlsdGVyID0gdGV4dHVyZS5tYWdGaWx0ZXI7CgogICAgCQljb25zdCBzaGFkZXIgPSB7CgogICAgCQkJdW5pZm9ybXM6IHsKICAgIAkJCQl0RXF1aXJlY3Q6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCX0sCgogICAgCQkJdmVydGV4U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJCXZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247CgoJCQkJdmVjMyB0cmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHsKCgkJCQkJcmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7CgoJCQkJfQoKCQkJCXZvaWQgbWFpbigpIHsKCgkJCQkJdldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTsKCgkJCQkJI2luY2x1ZGUgPGJlZ2luX3ZlcnRleD4KCQkJCQkjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+CgoJCQkJfQoJCQlgLAoKICAgIAkJCWZyYWdtZW50U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJCXVuaWZvcm0gc2FtcGxlcjJEIHRFcXVpcmVjdDsKCgkJCQl2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uOwoKCQkJCSNpbmNsdWRlIDxjb21tb24+CgoJCQkJdm9pZCBtYWluKCkgewoKCQkJCQl2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7CgoJCQkJCXZlYzIgc2FtcGxlVVYgPSBlcXVpcmVjdFV2KCBkaXJlY3Rpb24gKTsKCgkJCQkJZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKCB0RXF1aXJlY3QsIHNhbXBsZVVWICk7CgoJCQkJfQoJCQlgCiAgICAJCX07CgogICAgCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCb3hHZW9tZXRyeSggNSwgNSwgNSApOwoKICAgIAkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCiAgICAJCQluYW1lOiAnQ3ViZW1hcEZyb21FcXVpcmVjdCcsCgogICAgCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIHNoYWRlci51bmlmb3JtcyApLAogICAgCQkJdmVydGV4U2hhZGVyOiBzaGFkZXIudmVydGV4U2hhZGVyLAogICAgCQkJZnJhZ21lbnRTaGFkZXI6IHNoYWRlci5mcmFnbWVudFNoYWRlciwKICAgIAkJCXNpZGU6IEJhY2tTaWRlLAogICAgCQkJYmxlbmRpbmc6IE5vQmxlbmRpbmcKCiAgICAJCX0gKTsKCiAgICAJCW1hdGVyaWFsLnVuaWZvcm1zLnRFcXVpcmVjdC52YWx1ZSA9IHRleHR1cmU7CgogICAgCQljb25zdCBtZXNoID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKICAgIAkJY29uc3QgY3VycmVudE1pbkZpbHRlciA9IHRleHR1cmUubWluRmlsdGVyOwoKICAgIAkJLy8gQXZvaWQgYmx1cnJlZCBwb2xlcwogICAgCQlpZiAoIHRleHR1cmUubWluRmlsdGVyID09PSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgKSB0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCiAgICAJCWNvbnN0IGNhbWVyYSA9IG5ldyBDdWJlQ2FtZXJhKCAxLCAxMCwgdGhpcyApOwogICAgCQljYW1lcmEudXBkYXRlKCByZW5kZXJlciwgbWVzaCApOwoKICAgIAkJdGV4dHVyZS5taW5GaWx0ZXIgPSBjdXJyZW50TWluRmlsdGVyOwoKICAgIAkJbWVzaC5nZW9tZXRyeS5kaXNwb3NlKCk7CiAgICAJCW1lc2gubWF0ZXJpYWwuZGlzcG9zZSgpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2xlYXJzIHRoaXMgY3ViZSByZW5kZXIgdGFyZ2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtjb2xvcj10cnVlXSAtIFdoZXRoZXIgdGhlIGNvbG9yIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbZGVwdGg9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBkZXB0aCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3N0ZW5jaWw9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBzdGVuY2lsIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCiAgICAJICovCiAgICAJY2xlYXIoIHJlbmRlcmVyLCBjb2xvciA9IHRydWUsIGRlcHRoID0gdHJ1ZSwgc3RlbmNpbCA9IHRydWUgKSB7CgogICAgCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggdGhpcywgaSApOwoKICAgIAkJCXJlbmRlcmVyLmNsZWFyKCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwgKTsKCiAgICAJCX0KCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBpcyBhbG1vc3QgaWRlbnRpY2FsIHRvIGFuIHtAbGluayBPYmplY3QzRH0uIEl0cyBwdXJwb3NlIGlzIHRvCiAgICAgKiBtYWtlIHdvcmtpbmcgd2l0aCBncm91cHMgb2Ygb2JqZWN0cyBzeW50YWN0aWNhbGx5IGNsZWFyZXIuCiAgICAgKgogICAgICogYGBganMKICAgICAqIC8vIENyZWF0ZSBhIGdyb3VwIGFuZCBhZGQgdGhlIHR3byBjdWJlcy4KICAgICAqIC8vIFRoZXNlIGN1YmVzIGNhbiBub3cgYmUgcm90YXRlZCAvIHNjYWxlZCBldGMgYXMgYSBncm91cC4KICAgICAqIGNvbnN0IGdyb3VwID0gbmV3IFRIUkVFLkdyb3VwKCk7CiAgICAgKgogICAgICogZ3JvdXAuYWRkKCBtZXNoQSApOwogICAgICogZ3JvdXAuYWRkKCBtZXNoQiApOwogICAgICoKICAgICAqIHNjZW5lLmFkZCggZ3JvdXAgKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBPYmplY3QzRAogICAgICovCiAgICBjbGFzcyBHcm91cCBleHRlbmRzIE9iamVjdDNEIHsKCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNHcm91cCA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnR3JvdXAnOwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF9tb3ZlRXZlbnQgPSB7IHR5cGU6ICdtb3ZlJyB9OwoKICAgIC8qKgogICAgICogQ2xhc3MgZm9yIHJlcHJlc2VudGluZyBhIFhSIGNvbnRyb2xsZXIgd2l0aCBpdHMKICAgICAqIGRpZmZlcmVudCBjb29yZGluYXRlIHN5c3RlbXMuCiAgICAgKgogICAgICogQHByaXZhdGUKICAgICAqLwogICAgY2xhc3MgV2ViWFJDb250cm9sbGVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBYUiBjb250cm9sbGVyLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJLyoqCiAgICAJCSAqIEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSB0YXJnZXQgcmF5IHNwYWNlCiAgICAJCSAqIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCQkgKgogICAgCQkgKiBAcHJpdmF0ZQogICAgCQkgKiBAdHlwZSB7P0dyb3VwfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLl90YXJnZXRSYXkgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBncmlwIHNwYWNlCiAgICAJCSAqIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCQkgKgogICAgCQkgKiBAcHJpdmF0ZQogICAgCQkgKiBAdHlwZSB7P0dyb3VwfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLl9ncmlwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgaGFuZCBzcGFjZQogICAgCQkgKiBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkJICoKICAgIAkJICogQHByaXZhdGUKICAgIAkJICogQHR5cGUgez9Hcm91cH0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5faGFuZCA9IG51bGw7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgaGFuZCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgaGFuZCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKi8KICAgIAlnZXRIYW5kU3BhY2UoKSB7CgogICAgCQlpZiAoIHRoaXMuX2hhbmQgPT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5faGFuZCA9IG5ldyBHcm91cCgpOwogICAgCQkJdGhpcy5faGFuZC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CiAgICAJCQl0aGlzLl9oYW5kLnZpc2libGUgPSBmYWxzZTsKCiAgICAJCQl0aGlzLl9oYW5kLmpvaW50cyA9IHt9OwogICAgCQkJdGhpcy5faGFuZC5pbnB1dFN0YXRlID0geyBwaW5jaGluZzogZmFsc2UgfTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzLl9oYW5kOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIHRhcmdldCByYXkgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIHRhcmdldCByYXkgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJICovCiAgICAJZ2V0VGFyZ2V0UmF5U3BhY2UoKSB7CgogICAgCQlpZiAoIHRoaXMuX3RhcmdldFJheSA9PT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLl90YXJnZXRSYXkgPSBuZXcgR3JvdXAoKTsKICAgIAkJCXRoaXMuX3RhcmdldFJheS5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CiAgICAJCQl0aGlzLl90YXJnZXRSYXkudmlzaWJsZSA9IGZhbHNlOwogICAgCQkJdGhpcy5fdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAJCQl0aGlzLl90YXJnZXRSYXkubGluZWFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwogICAgCQkJdGhpcy5fdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwogICAgCQkJdGhpcy5fdGFyZ2V0UmF5LmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpcy5fdGFyZ2V0UmF5OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGdyaXAgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGdyaXAgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJICovCiAgICAJZ2V0R3JpcFNwYWNlKCkgewoKICAgIAkJaWYgKCB0aGlzLl9ncmlwID09PSBudWxsICkgewoKICAgIAkJCXRoaXMuX2dyaXAgPSBuZXcgR3JvdXAoKTsKICAgIAkJCXRoaXMuX2dyaXAubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwogICAgCQkJdGhpcy5fZ3JpcC52aXNpYmxlID0gZmFsc2U7CiAgICAJCQl0aGlzLl9ncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAJCQl0aGlzLl9ncmlwLmxpbmVhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKICAgIAkJCXRoaXMuX2dyaXAuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAJCQl0aGlzLl9ncmlwLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpcy5fZ3JpcDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEaXNwYXRjaGVzIHRoZSBnaXZlbiBldmVudCB0byB0aGUgZ3JvdXBzIHJlcHJlc2VudGluZwogICAgCSAqIHRoZSBkaWZmZXJlbnQgY29vcmRpbmF0ZSBzcGFjZXMgb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgLSBUaGUgZXZlbnQgdG8gZGlzcGF0Y2guCiAgICAJICogQHJldHVybiB7V2ViWFJDb250cm9sbGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3BhdGNoRXZlbnQoIGV2ZW50ICkgewoKICAgIAkJaWYgKCB0aGlzLl90YXJnZXRSYXkgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5fdGFyZ2V0UmF5LmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuX2dyaXAgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5fZ3JpcC5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLl9oYW5kICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMuX2hhbmQuZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbm5lY3RzIHRoZSBjb250cm9sbGVyIHdpdGggdGhlIGdpdmVuIFhSIGlucHV0IHNvdXJjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7WFJJbnB1dFNvdXJjZX0gaW5wdXRTb3VyY2UgLSBUaGUgaW5wdXQgc291cmNlLgogICAgCSAqIEByZXR1cm4ge1dlYlhSQ29udHJvbGxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb25uZWN0KCBpbnB1dFNvdXJjZSApIHsKCiAgICAJCWlmICggaW5wdXRTb3VyY2UgJiYgaW5wdXRTb3VyY2UuaGFuZCApIHsKCiAgICAJCQljb25zdCBoYW5kID0gdGhpcy5faGFuZDsKCiAgICAJCQlpZiAoIGhhbmQgKSB7CgogICAgCQkJCWZvciAoIGNvbnN0IGlucHV0am9pbnQgb2YgaW5wdXRTb3VyY2UuaGFuZC52YWx1ZXMoKSApIHsKCiAgICAJCQkJCS8vIEluaXRpYWxpemUgaGFuZCB3aXRoIGpvaW50cyB3aGVuIGNvbm5lY3RlZAogICAgCQkJCQl0aGlzLl9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnY29ubmVjdGVkJywgZGF0YTogaW5wdXRTb3VyY2UgfSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGlzY29ubmVjdHMgdGhlIGNvbnRyb2xsZXIgZnJvbSB0aGUgZ2l2ZW4gWFIgaW5wdXQgc291cmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtYUklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIFRoZSBpbnB1dCBzb3VyY2UuCiAgICAJICogQHJldHVybiB7V2ViWFJDb250cm9sbGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWRpc2Nvbm5lY3QoIGlucHV0U291cmNlICkgewoKICAgIAkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNjb25uZWN0ZWQnLCBkYXRhOiBpbnB1dFNvdXJjZSB9ICk7CgogICAgCQlpZiAoIHRoaXMuX3RhcmdldFJheSAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLl90YXJnZXRSYXkudmlzaWJsZSA9IGZhbHNlOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLl9ncmlwICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMuX2dyaXAudmlzaWJsZSA9IGZhbHNlOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLl9oYW5kICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMuX2hhbmQudmlzaWJsZSA9IGZhbHNlOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVXBkYXRlcyB0aGUgY29udHJvbGxlciB3aXRoIHRoZSBnaXZlbiBpbnB1dCBzb3VyY2UsIFhSIGZyYW1lIGFuZCByZWZlcmVuY2Ugc3BhY2UuCiAgICAJICogVGhpcyB1cGRhdGVzIHRoZSB0cmFuc2Zvcm1hdGlvbnMgb2YgdGhlIGdyb3VwcyB0aGF0IHJlcHJlc2VudCB0aGUgZGlmZmVyZW50CiAgICAJICogY29vcmRpbmF0ZSBzeXN0ZW1zIG9mIHRoZSBjb250cm9sbGVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtYUklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIFRoZSBpbnB1dCBzb3VyY2UuCiAgICAJICogQHBhcmFtIHtYUkZyYW1lfSBmcmFtZSAtIFRoZSBYUiBmcmFtZS4KICAgIAkgKiBAcGFyYW0ge1hSUmVmZXJlbmNlU3BhY2V9IHJlZmVyZW5jZVNwYWNlIC0gVGhlIHJlZmVyZW5jZSBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdXBkYXRlKCBpbnB1dFNvdXJjZSwgZnJhbWUsIHJlZmVyZW5jZVNwYWNlICkgewoKICAgIAkJbGV0IGlucHV0UG9zZSA9IG51bGw7CiAgICAJCWxldCBncmlwUG9zZSA9IG51bGw7CiAgICAJCWxldCBoYW5kUG9zZSA9IG51bGw7CgogICAgCQljb25zdCB0YXJnZXRSYXkgPSB0aGlzLl90YXJnZXRSYXk7CiAgICAJCWNvbnN0IGdyaXAgPSB0aGlzLl9ncmlwOwogICAgCQljb25zdCBoYW5kID0gdGhpcy5faGFuZDsKCiAgICAJCWlmICggaW5wdXRTb3VyY2UgJiYgZnJhbWUuc2Vzc2lvbi52aXNpYmlsaXR5U3RhdGUgIT09ICd2aXNpYmxlLWJsdXJyZWQnICkgewoKICAgIAkJCWlmICggaGFuZCAmJiBpbnB1dFNvdXJjZS5oYW5kICkgewoKICAgIAkJCQloYW5kUG9zZSA9IHRydWU7CgogICAgCQkJCWZvciAoIGNvbnN0IGlucHV0am9pbnQgb2YgaW5wdXRTb3VyY2UuaGFuZC52YWx1ZXMoKSApIHsKCiAgICAJCQkJCS8vIFVwZGF0ZSB0aGUgam9pbnRzIGdyb3VwcyB3aXRoIHRoZSBYUkpvaW50IHBvc2VzCiAgICAJCQkJCWNvbnN0IGpvaW50UG9zZSA9IGZyYW1lLmdldEpvaW50UG9zZSggaW5wdXRqb2ludCwgcmVmZXJlbmNlU3BhY2UgKTsKCiAgICAJCQkJCS8vIFRoZSB0cmFuc2Zvcm0gb2YgdGhpcyBqb2ludCB3aWxsIGJlIHVwZGF0ZWQgd2l0aCB0aGUgam9pbnQgcG9zZSBvbiBlYWNoIGZyYW1lCiAgICAJCQkJCWNvbnN0IGpvaW50ID0gdGhpcy5fZ2V0SGFuZEpvaW50KCBoYW5kLCBpbnB1dGpvaW50ICk7CgogICAgCQkJCQlpZiAoIGpvaW50UG9zZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJCQlqb2ludC5tYXRyaXguZnJvbUFycmF5KCBqb2ludFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwogICAgCQkJCQkJam9pbnQubWF0cml4LmRlY29tcG9zZSggam9pbnQucG9zaXRpb24sIGpvaW50LnJvdGF0aW9uLCBqb2ludC5zY2FsZSApOwogICAgCQkJCQkJam9pbnQubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAJCQkJCQlqb2ludC5qb2ludFJhZGl1cyA9IGpvaW50UG9zZS5yYWRpdXM7CgogICAgCQkJCQl9CgogICAgCQkJCQlqb2ludC52aXNpYmxlID0gam9pbnRQb3NlICE9PSBudWxsOwoKICAgIAkJCQl9CgogICAgCQkJCS8vIEN1c3RvbSBldmVudHMKCiAgICAJCQkJLy8gQ2hlY2sgcGluY2h6CiAgICAJCQkJY29uc3QgaW5kZXhUaXAgPSBoYW5kLmpvaW50c1sgJ2luZGV4LWZpbmdlci10aXAnIF07CiAgICAJCQkJY29uc3QgdGh1bWJUaXAgPSBoYW5kLmpvaW50c1sgJ3RodW1iLXRpcCcgXTsKICAgIAkJCQljb25zdCBkaXN0YW5jZSA9IGluZGV4VGlwLnBvc2l0aW9uLmRpc3RhbmNlVG8oIHRodW1iVGlwLnBvc2l0aW9uICk7CgogICAgCQkJCWNvbnN0IGRpc3RhbmNlVG9QaW5jaCA9IDAuMDI7CiAgICAJCQkJY29uc3QgdGhyZXNob2xkID0gMC4wMDU7CgogICAgCQkJCWlmICggaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlID4gZGlzdGFuY2VUb1BpbmNoICsgdGhyZXNob2xkICkgewoKICAgIAkJCQkJaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nID0gZmFsc2U7CiAgICAJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggewogICAgCQkJCQkJdHlwZTogJ3BpbmNoZW5kJywKICAgIAkJCQkJCWhhbmRlZG5lc3M6IGlucHV0U291cmNlLmhhbmRlZG5lc3MsCiAgICAJCQkJCQl0YXJnZXQ6IHRoaXMKICAgIAkJCQkJfSApOwoKICAgIAkJCQl9IGVsc2UgaWYgKCAhIGhhbmQuaW5wdXRTdGF0ZS5waW5jaGluZyAmJiBkaXN0YW5jZSA8PSBkaXN0YW5jZVRvUGluY2ggLSB0aHJlc2hvbGQgKSB7CgogICAgCQkJCQloYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSB0cnVlOwogICAgCQkJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsKICAgIAkJCQkJCXR5cGU6ICdwaW5jaHN0YXJ0JywKICAgIAkJCQkJCWhhbmRlZG5lc3M6IGlucHV0U291cmNlLmhhbmRlZG5lc3MsCiAgICAJCQkJCQl0YXJnZXQ6IHRoaXMKICAgIAkJCQkJfSApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJaWYgKCBncmlwICE9PSBudWxsICYmIGlucHV0U291cmNlLmdyaXBTcGFjZSApIHsKCiAgICAJCQkJCWdyaXBQb3NlID0gZnJhbWUuZ2V0UG9zZSggaW5wdXRTb3VyY2UuZ3JpcFNwYWNlLCByZWZlcmVuY2VTcGFjZSApOwoKICAgIAkJCQkJaWYgKCBncmlwUG9zZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJCQlncmlwLm1hdHJpeC5mcm9tQXJyYXkoIGdyaXBQb3NlLnRyYW5zZm9ybS5tYXRyaXggKTsKICAgIAkJCQkJCWdyaXAubWF0cml4LmRlY29tcG9zZSggZ3JpcC5wb3NpdGlvbiwgZ3JpcC5yb3RhdGlvbiwgZ3JpcC5zY2FsZSApOwogICAgCQkJCQkJZ3JpcC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQkJCQlpZiAoIGdyaXBQb3NlLmxpbmVhclZlbG9jaXR5ICkgewoKICAgIAkJCQkJCQlncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gdHJ1ZTsKICAgIAkJCQkJCQlncmlwLmxpbmVhclZlbG9jaXR5LmNvcHkoIGdyaXBQb3NlLmxpbmVhclZlbG9jaXR5ICk7CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJZ3JpcC5oYXNMaW5lYXJWZWxvY2l0eSA9IGZhbHNlOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQlpZiAoIGdyaXBQb3NlLmFuZ3VsYXJWZWxvY2l0eSApIHsKCiAgICAJCQkJCQkJZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSB0cnVlOwogICAgCQkJCQkJCWdyaXAuYW5ndWxhclZlbG9jaXR5LmNvcHkoIGdyaXBQb3NlLmFuZ3VsYXJWZWxvY2l0eSApOwoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCWdyaXAuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWlmICggdGFyZ2V0UmF5ICE9PSBudWxsICkgewoKICAgIAkJCQlpbnB1dFBvc2UgPSBmcmFtZS5nZXRQb3NlKCBpbnB1dFNvdXJjZS50YXJnZXRSYXlTcGFjZSwgcmVmZXJlbmNlU3BhY2UgKTsKCiAgICAJCQkJLy8gU29tZSBydW50aW1lcyAobmFtZWx5IFZpdmUgQ29zbW9zIHdpdGggVml2ZSBPcGVuWFIgUnVudGltZSkgaGF2ZSBvbmx5IGdyaXAgc3BhY2UgYW5kIHJheSBzcGFjZSBpcyBlcXVhbCB0byBpdAogICAgCQkJCWlmICggaW5wdXRQb3NlID09PSBudWxsICYmIGdyaXBQb3NlICE9PSBudWxsICkgewoKICAgIAkJCQkJaW5wdXRQb3NlID0gZ3JpcFBvc2U7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBpbnB1dFBvc2UgIT09IG51bGwgKSB7CgogICAgCQkJCQl0YXJnZXRSYXkubWF0cml4LmZyb21BcnJheSggaW5wdXRQb3NlLnRyYW5zZm9ybS5tYXRyaXggKTsKICAgIAkJCQkJdGFyZ2V0UmF5Lm1hdHJpeC5kZWNvbXBvc2UoIHRhcmdldFJheS5wb3NpdGlvbiwgdGFyZ2V0UmF5LnJvdGF0aW9uLCB0YXJnZXRSYXkuc2NhbGUgKTsKICAgIAkJCQkJdGFyZ2V0UmF5Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQkJaWYgKCBpbnB1dFBvc2UubGluZWFyVmVsb2NpdHkgKSB7CgogICAgCQkJCQkJdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gdHJ1ZTsKICAgIAkJCQkJCXRhcmdldFJheS5saW5lYXJWZWxvY2l0eS5jb3B5KCBpbnB1dFBvc2UubGluZWFyVmVsb2NpdHkgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoIGlucHV0UG9zZS5hbmd1bGFyVmVsb2NpdHkgKSB7CgogICAgCQkJCQkJdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IHRydWU7CiAgICAJCQkJCQl0YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5LmNvcHkoIGlucHV0UG9zZS5hbmd1bGFyVmVsb2NpdHkgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCBfbW92ZUV2ZW50ICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgoKICAgIAkJfQoKICAgIAkJaWYgKCB0YXJnZXRSYXkgIT09IG51bGwgKSB7CgogICAgCQkJdGFyZ2V0UmF5LnZpc2libGUgPSAoIGlucHV0UG9zZSAhPT0gbnVsbCApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBncmlwICE9PSBudWxsICkgewoKICAgIAkJCWdyaXAudmlzaWJsZSA9ICggZ3JpcFBvc2UgIT09IG51bGwgKTsKCiAgICAJCX0KCiAgICAJCWlmICggaGFuZCAhPT0gbnVsbCApIHsKCiAgICAJCQloYW5kLnZpc2libGUgPSAoIGhhbmRQb3NlICE9PSBudWxsICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIGpvaW50IGZvciB0aGUgZ2l2ZW4gaW5wdXQgam9pbnQuCiAgICAJICoKICAgIAkgKiBAcHJpdmF0ZQogICAgCSAqIEBwYXJhbSB7R3JvdXB9IGhhbmQgLSBUaGUgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlLgogICAgCSAqIEBwYXJhbSB7WFJKb2ludFNwYWNlfSBpbnB1dGpvaW50IC0gVGhlIGhhbmQgam9pbnQgZGF0YS4KICAgIAkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgam9pbnQgZm9yIHRoZSBnaXZlbiBpbnB1dCBqb2ludC4KICAgIAkgKi8KICAgIAlfZ2V0SGFuZEpvaW50KCBoYW5kLCBpbnB1dGpvaW50ICkgewoKICAgIAkJaWYgKCBoYW5kLmpvaW50c1sgaW5wdXRqb2ludC5qb2ludE5hbWUgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWNvbnN0IGpvaW50ID0gbmV3IEdyb3VwKCk7CiAgICAJCQlqb2ludC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CiAgICAJCQlqb2ludC52aXNpYmxlID0gZmFsc2U7CiAgICAJCQloYW5kLmpvaW50c1sgaW5wdXRqb2ludC5qb2ludE5hbWUgXSA9IGpvaW50OwoKICAgIAkJCWhhbmQuYWRkKCBqb2ludCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogU2NlbmVzIGFsbG93IHlvdSB0byBzZXQgdXAgd2hhdCBpcyB0byBiZSByZW5kZXJlZCBhbmQgd2hlcmUgYnkgdGhyZWUuanMuCiAgICAgKiBUaGlzIGlzIHdoZXJlIHlvdSBwbGFjZSAzRCBvYmplY3RzIGxpa2UgbWVzaGVzLCBsaW5lcyBvciBsaWdodHMuCiAgICAgKgogICAgICogQGF1Z21lbnRzIE9iamVjdDNECiAgICAgKi8KICAgIGNsYXNzIFNjZW5lIGV4dGVuZHMgT2JqZWN0M0QgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHNjZW5lLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzU2NlbmUgPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ1NjZW5lJzsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBiYWNrZ3JvdW5kIG9mIHRoZSBzY2VuZS4gVmFsaWQgaW5wdXRzIGFyZToKICAgIAkJICoKICAgIAkJICogLSBBIGNvbG9yIGZvciBkZWZpbmluZyBhIHVuaWZvcm0gY29sb3JlZCBiYWNrZ3JvdW5kLgogICAgCQkgKiAtIEEgdGV4dHVyZSBmb3IgZGVmaW5pbmcgYSAoZmxhdCkgdGV4dHVyZWQgYmFja2dyb3VuZC4KICAgIAkJICogLSBDdWJlIHRleHR1cmVzIG9yIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlcyBmb3IgZGVmaW5pbmcgYSBza3lib3guCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KENvbG9yfFRleHR1cmUpfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmJhY2tncm91bmQgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIGVudmlyb25tZW50IG1hcCBmb3IgYWxsIHBoeXNpY2FsIG1hdGVyaWFscyBpbiB0aGUgc2NlbmUuIEhvd2V2ZXIsCiAgICAJCSAqIGl0J3Mgbm90IHBvc3NpYmxlIHRvIG92ZXJ3cml0ZSBhbiBleGlzdGluZyB0ZXh0dXJlIGFzc2lnbmVkIHRvIHRoZSBgZW52TWFwYAogICAgCQkgKiBtYXRlcmlhbCBwcm9wZXJ0eS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmVudmlyb25tZW50ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBBIGZvZyBpbnN0YW5jZSBkZWZpbmluZyB0aGUgdHlwZSBvZiBmb2cgdGhhdCBhZmZlY3RzIGV2ZXJ5dGhpbmcKICAgIAkJICogcmVuZGVyZWQgaW4gdGhlIHNjZW5lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7PyhGb2d8Rm9nRXhwMil9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuZm9nID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSBibHVycmluZXNzIG9mIHRoZSBiYWNrZ3JvdW5kLiBPbmx5IGluZmx1ZW5jZXMgZW52aXJvbm1lbnQgbWFwcwogICAgCQkgKiBhc3NpZ25lZCB0byB7QGxpbmsgU2NlbmUjYmFja2dyb3VuZH0uIFZhbGlkIGlucHV0IGlzIGEgZmxvYXQgYmV0d2VlbiBgMGAKICAgIAkJICogYW5kIGAxYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IDA7CgogICAgCQkvKioKICAgIAkJICogQXR0ZW51YXRlcyB0aGUgY29sb3Igb2YgdGhlIGJhY2tncm91bmQuIE9ubHkgYXBwbGllcyB0byBiYWNrZ3JvdW5kIHRleHR1cmVzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLmJhY2tncm91bmRJbnRlbnNpdHkgPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSByb3RhdGlvbiBvZiB0aGUgYmFja2dyb3VuZCBpbiByYWRpYW5zLiBPbmx5IGluZmx1ZW5jZXMgZW52aXJvbm1lbnQgbWFwcwogICAgCQkgKiBhc3NpZ25lZCB0byB7QGxpbmsgU2NlbmUjYmFja2dyb3VuZH0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtFdWxlcn0KICAgIAkJICogQGRlZmF1bHQgKDAsMCwwKQogICAgCQkgKi8KICAgIAkJdGhpcy5iYWNrZ3JvdW5kUm90YXRpb24gPSBuZXcgRXVsZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBBdHRlbnVhdGVzIHRoZSBjb2xvciBvZiB0aGUgZW52aXJvbm1lbnQuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCiAgICAJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNlbnZpcm9ubWVudH0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSByb3RhdGlvbiBvZiB0aGUgZW52aXJvbm1lbnQgbWFwIGluIHJhZGlhbnMuIE9ubHkgaW5mbHVlbmNlcyBwaHlzaWNhbCBtYXRlcmlhbHMKICAgIAkJICogaW4gdGhlIHNjZW5lIHdoZW4ge0BsaW5rIFNjZW5lI2Vudmlyb25tZW50fSBpcyB1c2VkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7RXVsZXJ9CiAgICAJCSAqIEBkZWZhdWx0ICgwLDAsMCkKICAgIAkJICovCiAgICAJCXRoaXMuZW52aXJvbm1lbnRSb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIEZvcmNlcyBldmVyeXRoaW5nIGluIHRoZSBzY2VuZSB0byBiZSByZW5kZXJlZCB3aXRoIHRoZSBkZWZpbmVkIG1hdGVyaWFsLiBJdCBpcyBwb3NzaWJsZQogICAgCQkgKiB0byBleGNsdWRlIG1hdGVyaWFscyBmcm9tIG92ZXJyaWRlIGJ5IHNldHRpbmcge0BsaW5rIE1hdGVyaWFsI2FsbG93T3ZlcnJpZGV9IHRvIGBmYWxzZWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/TWF0ZXJpYWx9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMub3ZlcnJpZGVNYXRlcmlhbCA9IG51bGw7CgogICAgCQlpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKICAgIAkJCV9fVEhSRUVfREVWVE9PTFNfXy5kaXNwYXRjaEV2ZW50KCBuZXcgQ3VzdG9tRXZlbnQoICdvYnNlcnZlJywgeyBkZXRhaWw6IHRoaXMgfSApICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKICAgIAkJaWYgKCBzb3VyY2UuYmFja2dyb3VuZCAhPT0gbnVsbCApIHRoaXMuYmFja2dyb3VuZCA9IHNvdXJjZS5iYWNrZ3JvdW5kLmNsb25lKCk7CiAgICAJCWlmICggc291cmNlLmVudmlyb25tZW50ICE9PSBudWxsICkgdGhpcy5lbnZpcm9ubWVudCA9IHNvdXJjZS5lbnZpcm9ubWVudC5jbG9uZSgpOwogICAgCQlpZiAoIHNvdXJjZS5mb2cgIT09IG51bGwgKSB0aGlzLmZvZyA9IHNvdXJjZS5mb2cuY2xvbmUoKTsKCiAgICAJCXRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3MgPSBzb3VyY2UuYmFja2dyb3VuZEJsdXJyaW5lc3M7CiAgICAJCXRoaXMuYmFja2dyb3VuZEludGVuc2l0eSA9IHNvdXJjZS5iYWNrZ3JvdW5kSW50ZW5zaXR5OwogICAgCQl0aGlzLmJhY2tncm91bmRSb3RhdGlvbi5jb3B5KCBzb3VyY2UuYmFja2dyb3VuZFJvdGF0aW9uICk7CgogICAgCQl0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5ID0gc291cmNlLmVudmlyb25tZW50SW50ZW5zaXR5OwogICAgCQl0aGlzLmVudmlyb25tZW50Um90YXRpb24uY29weSggc291cmNlLmVudmlyb25tZW50Um90YXRpb24gKTsKCiAgICAJCWlmICggc291cmNlLm92ZXJyaWRlTWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLm92ZXJyaWRlTWF0ZXJpYWwgPSBzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbC5jbG9uZSgpOwoKICAgIAkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gc291cmNlLm1hdHJpeEF1dG9VcGRhdGU7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgogICAgCQlpZiAoIHRoaXMuZm9nICE9PSBudWxsICkgZGF0YS5vYmplY3QuZm9nID0gdGhpcy5mb2cudG9KU09OKCk7CgogICAgCQlpZiAoIHRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3MgPiAwICkgZGF0YS5vYmplY3QuYmFja2dyb3VuZEJsdXJyaW5lc3MgPSB0aGlzLmJhY2tncm91bmRCbHVycmluZXNzOwogICAgCQlpZiAoIHRoaXMuYmFja2dyb3VuZEludGVuc2l0eSAhPT0gMSApIGRhdGEub2JqZWN0LmJhY2tncm91bmRJbnRlbnNpdHkgPSB0aGlzLmJhY2tncm91bmRJbnRlbnNpdHk7CiAgICAJCWRhdGEub2JqZWN0LmJhY2tncm91bmRSb3RhdGlvbiA9IHRoaXMuYmFja2dyb3VuZFJvdGF0aW9uLnRvQXJyYXkoKTsKCiAgICAJCWlmICggdGhpcy5lbnZpcm9ubWVudEludGVuc2l0eSAhPT0gMSApIGRhdGEub2JqZWN0LmVudmlyb25tZW50SW50ZW5zaXR5ID0gdGhpcy5lbnZpcm9ubWVudEludGVuc2l0eTsKICAgIAkJZGF0YS5vYmplY3QuZW52aXJvbm1lbnRSb3RhdGlvbiA9IHRoaXMuZW52aXJvbm1lbnRSb3RhdGlvbi50b0FycmF5KCk7CgogICAgCQlyZXR1cm4gZGF0YTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfdmVjdG9yMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92ZWN0b3IyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX25vcm1hbE1hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKTsKCiAgICAvKioKICAgICAqIEEgdHdvIGRpbWVuc2lvbmFsIHN1cmZhY2UgdGhhdCBleHRlbmRzIGluZmluaXRlbHkgaW4gM0Qgc3BhY2UsIHJlcHJlc2VudGVkCiAgICAgKiBpbiBbSGVzc2lhbiBub3JtYWwgZm9ybV17QGxpbmsgaHR0cDovL21hdGh3b3JsZC53b2xmcmFtLmNvbS9IZXNzaWFuTm9ybWFsRm9ybS5odG1sfQogICAgICogYnkgYSB1bml0IGxlbmd0aCBub3JtYWwgdmVjdG9yIGFuZCBhIGNvbnN0YW50LgogICAgICovCiAgICBjbGFzcyBQbGFuZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtub3JtYWw9KDEsMCwwKV0gLSBBIHVuaXQgbGVuZ3RoIHZlY3RvciBkZWZpbmluZyB0aGUgbm9ybWFsIG9mIHRoZSBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2NvbnN0YW50PTBdIC0gVGhlIHNpZ25lZCBkaXN0YW5jZSBmcm9tIHRoZSBvcmlnaW4gdG8gdGhlIHBsYW5lLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBub3JtYWwgPSBuZXcgVmVjdG9yMyggMSwgMCwgMCApLCBjb25zdGFudCA9IDAgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1BsYW5lID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBBIHVuaXQgbGVuZ3RoIHZlY3RvciBkZWZpbmluZyB0aGUgbm9ybWFsIG9mIHRoZSBwbGFuZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLm5vcm1hbCA9IG5vcm1hbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIG9yaWdpbiB0byB0aGUgcGxhbmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuY29uc3RhbnQgPSBjb25zdGFudDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBwbGFuZSBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gbm9ybWFsIC0gVGhlIG5vcm1hbC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gY29uc3RhbnQgLSBUaGUgY29uc3RhbnQuCiAgICAJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCiAgICAJICovCiAgICAJc2V0KCBub3JtYWwsIGNvbnN0YW50ICkgewoKICAgIAkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CiAgICAJCXRoaXMuY29uc3RhbnQgPSBjb25zdGFudDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHBsYW5lIGNvbXBvbmVudHMgYnkgZGVmaW5pbmcgYHhgLCBgeWAsIGB6YCBhcyB0aGUKICAgIAkgKiBwbGFuZSBub3JtYWwgYW5kIGB3YCBhcyB0aGUgY29uc3RhbnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSBmb3IgdGhlIG5vcm1hbCdzIHggY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIGZvciB0aGUgbm9ybWFsJ3MgeSBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgZm9yIHRoZSBub3JtYWwncyB6IGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdyAtIFRoZSBjb25zdGFudCB2YWx1ZS4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAlzZXRDb21wb25lbnRzKCB4LCB5LCB6LCB3ICkgewoKICAgIAkJdGhpcy5ub3JtYWwuc2V0KCB4LCB5LCB6ICk7CiAgICAJCXRoaXMuY29uc3RhbnQgPSB3OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgcGxhbmUgZnJvbSB0aGUgZ2l2ZW4gbm9ybWFsIGFuZCBjb3BsYW5hciBwb2ludCAodGhhdCBpcyBhIHBvaW50CiAgICAJICogdGhhdCBsaWVzIG9udG8gdGhlIHBsYW5lKS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gbm9ybWFsIC0gVGhlIG5vcm1hbC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBjb3BsYW5hciBwb2ludC4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAlzZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBwb2ludCApIHsKCiAgICAJCXRoaXMubm9ybWFsLmNvcHkoIG5vcm1hbCApOwogICAgCQl0aGlzLmNvbnN0YW50ID0gLSBwb2ludC5kb3QoIHRoaXMubm9ybWFsICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBwbGFuZSBmcm9tIHRocmVlIGNvcGxhbmFyIHBvaW50cy4gVGhlIHdpbmRpbmcgb3JkZXIgaXMKICAgIAkgKiBhc3N1bWVkIHRvIGJlIGNvdW50ZXItY2xvY2t3aXNlLCBhbmQgZGV0ZXJtaW5lcyB0aGUgZGlyZWN0aW9uIG9mCiAgICAJICogdGhlIHBsYW5lIG5vcm1hbC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3BsYW5hciBwb2ludC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcGxhbmFyIHBvaW50LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCBjb3BsYW5hciBwb2ludC4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAlzZXRGcm9tQ29wbGFuYXJQb2ludHMoIGEsIGIsIGMgKSB7CgogICAgCQljb25zdCBub3JtYWwgPSBfdmVjdG9yMS5zdWJWZWN0b3JzKCBjLCBiICkuY3Jvc3MoIF92ZWN0b3IyLnN1YlZlY3RvcnMoIGEsIGIgKSApLm5vcm1hbGl6ZSgpOwoKICAgIAkJLy8gUTogc2hvdWxkIGFuIGVycm9yIGJlIHRocm93biBpZiBub3JtYWwgaXMgemVybyAoZS5nLiBkZWdlbmVyYXRlIHBsYW5lKT8KCiAgICAJCXRoaXMuc2V0RnJvbU5vcm1hbEFuZENvcGxhbmFyUG9pbnQoIG5vcm1hbCwgYSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIHBsYW5lIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCWNvcHkoIHBsYW5lICkgewoKICAgIAkJdGhpcy5ub3JtYWwuY29weSggcGxhbmUubm9ybWFsICk7CiAgICAJCXRoaXMuY29uc3RhbnQgPSBwbGFuZS5jb25zdGFudDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE5vcm1hbGl6ZXMgdGhlIHBsYW5lIG5vcm1hbCBhbmQgYWRqdXN0cyB0aGUgY29uc3RhbnQgYWNjb3JkaW5nbHkuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAlub3JtYWxpemUoKSB7CgogICAgCQkvLyBOb3RlOiB3aWxsIGxlYWQgdG8gYSBkaXZpZGUgYnkgemVybyBpZiB0aGUgcGxhbmUgaXMgaW52YWxpZC4KCiAgICAJCWNvbnN0IGludmVyc2VOb3JtYWxMZW5ndGggPSAxLjAgLyB0aGlzLm5vcm1hbC5sZW5ndGgoKTsKICAgIAkJdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIoIGludmVyc2VOb3JtYWxMZW5ndGggKTsKICAgIAkJdGhpcy5jb25zdGFudCAqPSBpbnZlcnNlTm9ybWFsTGVuZ3RoOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTmVnYXRlcyBib3RoIHRoZSBwbGFuZSBub3JtYWwgYW5kIHRoZSBjb25zdGFudC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCW5lZ2F0ZSgpIHsKCiAgICAJCXRoaXMuY29uc3RhbnQgKj0gLTE7CiAgICAJCXRoaXMubm9ybWFsLm5lZ2F0ZSgpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHBvaW50IHRvIHRoaXMgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIGZvci4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzaWduZWQgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCiAgICAJCXJldHVybiB0aGlzLm5vcm1hbC5kb3QoIHBvaW50ICkgKyB0aGlzLmNvbnN0YW50OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHNpZ25lZCBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiBzcGhlcmUgdG8gdGhpcyBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgc3BoZXJlIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIGZvci4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzaWduZWQgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1NwaGVyZSggc3BoZXJlICkgewoKICAgIAkJcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgLSBzcGhlcmUucmFkaXVzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFByb2plY3RzIGEgdGhlIGdpdmVuIHBvaW50IG9udG8gdGhlIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBwcm9qZWN0LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHByb2plY3RlZCBwb2ludCBvbiB0aGUgcGxhbmUuCiAgICAJICovCiAgICAJcHJvamVjdFBvaW50KCBwb2ludCwgdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIHRhcmdldC5jb3B5KCBwb2ludCApLmFkZFNjYWxlZFZlY3RvciggdGhpcy5ub3JtYWwsIC0gdGhpcy5kaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnQgb2YgdGhlIHBhc3NlZCBsaW5lIGFuZCB0aGUgcGxhbmUuIFJldHVybnMKICAgIAkgKiBgbnVsbGAgaWYgdGhlIGxpbmUgZG9lcyBub3QgaW50ZXJzZWN0LiBSZXR1cm5zIHRoZSBsaW5lJ3Mgc3RhcnRpbmcgcG9pbnQgaWYKICAgIAkgKiB0aGUgbGluZSBpcyBjb3BsYW5hciB3aXRoIHRoZSBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TGluZTN9IGxpbmUgLSBUaGUgbGluZSB0byBjb21wdXRlIHRoZSBpbnRlcnNlY3Rpb24gZm9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCiAgICAJICovCiAgICAJaW50ZXJzZWN0TGluZSggbGluZSwgdGFyZ2V0ICkgewoKICAgIAkJY29uc3QgZGlyZWN0aW9uID0gbGluZS5kZWx0YSggX3ZlY3RvcjEgKTsKCiAgICAJCWNvbnN0IGRlbm9taW5hdG9yID0gdGhpcy5ub3JtYWwuZG90KCBkaXJlY3Rpb24gKTsKCiAgICAJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgogICAgCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgogICAgCQkJaWYgKCB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5zdGFydCApID09PSAwICkgewoKICAgIAkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGxpbmUuc3RhcnQgKTsKCiAgICAJCQl9CgogICAgCQkJLy8gVW5zdXJlIGlmIHRoaXMgaXMgdGhlIGNvcnJlY3QgbWV0aG9kIHRvIGhhbmRsZSB0aGlzIGNhc2UuCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHQgPSAtICggbGluZS5zdGFydC5kb3QoIHRoaXMubm9ybWFsICkgKyB0aGlzLmNvbnN0YW50ICkgLyBkZW5vbWluYXRvcjsKCiAgICAJCWlmICggdCA8IDAgfHwgdCA+IDEgKSB7CgogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGxpbmUuc3RhcnQgKS5hZGRTY2FsZWRWZWN0b3IoIGRpcmVjdGlvbiwgdCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQgaW50ZXJzZWN0cyB3aXRoIChwYXNzZXMgdGhyb3VnaCkgdGhlIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtMaW5lM30gbGluZSAtIFRoZSBsaW5lIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gbGluZSBzZWdtZW50IGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUgb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNMaW5lKCBsaW5lICkgewoKICAgIAkJLy8gTm90ZTogdGhpcyB0ZXN0cyBpZiBhIGxpbmUgaW50ZXJzZWN0cyB0aGUgcGxhbmUsIG5vdCB3aGV0aGVyIGl0IChvciBpdHMgZW5kLXBvaW50cykgYXJlIGNvcGxhbmFyIHdpdGggaXQuCgogICAgCQljb25zdCBzdGFydFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5zdGFydCApOwogICAgCQljb25zdCBlbmRTaWduID0gdGhpcy5kaXN0YW5jZVRvUG9pbnQoIGxpbmUuZW5kICk7CgogICAgCQlyZXR1cm4gKCBzdGFydFNpZ24gPCAwICYmIGVuZFNpZ24gPiAwICkgfHwgKCBlbmRTaWduIDwgMCAmJiBzdGFydFNpZ24gPiAwICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm91bmRpbmcgYm94IHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUgb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNCb3goIGJveCApIHsKCiAgICAJCXJldHVybiBib3guaW50ZXJzZWN0c1BsYW5lKCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBib3VuZGluZyBzcGhlcmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKICAgIAkJcmV0dXJuIHNwaGVyZS5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgY29wbGFuYXIgdmVjdG9yIHRvIHRoZSBwbGFuZSwgYnkgY2FsY3VsYXRpbmcgdGhlCiAgICAJICogcHJvamVjdGlvbiBvZiB0aGUgbm9ybWFsIGF0IHRoZSBvcmlnaW4gb250byB0aGUgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb3BsYW5hciBwb2ludC4KICAgIAkgKi8KICAgIAljb3BsYW5hclBvaW50KCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMubm9ybWFsICkubXVsdGlwbHlTY2FsYXIoIC0gdGhpcy5jb25zdGFudCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGx5IGEgNHg0IG1hdHJpeCB0byB0aGUgcGxhbmUuIFRoZSBtYXRyaXggbXVzdCBiZSBhbiBhZmZpbmUsIGhvbW9nZW5lb3VzIHRyYW5zZm9ybS4KICAgIAkgKgogICAgCSAqIFRoZSBvcHRpb25hbCBub3JtYWwgbWF0cml4IGNhbiBiZSBwcmUtY29tcHV0ZWQgbGlrZSBzbzoKICAgIAkgKiBgYGBqcwogICAgCSAqIGNvbnN0IG9wdGlvbmFsTm9ybWFsTWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDMoKS5nZXROb3JtYWxNYXRyaXgoIG1hdHJpeCApOwogICAgCSAqIGBgYAogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gW29wdGlvbmFsTm9ybWFsTWF0cml4XSAtIEEgcHJlLWNvbXB1dGVkIG5vcm1hbCBtYXRyaXguCiAgICAJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtYXRyaXgsIG9wdGlvbmFsTm9ybWFsTWF0cml4ICkgewoKICAgIAkJY29uc3Qgbm9ybWFsTWF0cml4ID0gb3B0aW9uYWxOb3JtYWxNYXRyaXggfHwgX25vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIG1hdHJpeCApOwoKICAgIAkJY29uc3QgcmVmZXJlbmNlUG9pbnQgPSB0aGlzLmNvcGxhbmFyUG9pbnQoIF92ZWN0b3IxICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKCiAgICAJCWNvbnN0IG5vcm1hbCA9IHRoaXMubm9ybWFsLmFwcGx5TWF0cml4Myggbm9ybWFsTWF0cml4ICkubm9ybWFsaXplKCk7CgogICAgCQl0aGlzLmNvbnN0YW50ID0gLSByZWZlcmVuY2VQb2ludC5kb3QoIG5vcm1hbCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNsYXRlcyB0aGUgcGxhbmUgYnkgdGhlIGRpc3RhbmNlIGRlZmluZWQgYnkgdGhlIGdpdmVuIG9mZnNldCB2ZWN0b3IuCiAgICAJICogTm90ZSB0aGF0IHRoaXMgb25seSBhZmZlY3RzIHRoZSBwbGFuZSBjb25zdGFudCBhbmQgd2lsbCBub3QgYWZmZWN0IHRoZSBub3JtYWwgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBvZmZzZXQgLSBUaGUgb2Zmc2V0IHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGUoIG9mZnNldCApIHsKCiAgICAJCXRoaXMuY29uc3RhbnQgLT0gb2Zmc2V0LmRvdCggdGhpcy5ub3JtYWwgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcGxhbmUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHBsYW5lIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIHBsYW5lICkgewoKICAgIAkJcmV0dXJuIHBsYW5lLm5vcm1hbC5lcXVhbHMoIHRoaXMubm9ybWFsICkgJiYgKCBwbGFuZS5jb25zdGFudCA9PT0gdGhpcy5jb25zdGFudCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgcGxhbmUgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX3NwaGVyZSQzID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CiAgICBjb25zdCBfZGVmYXVsdFNwcml0ZUNlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDAuNSwgMC41ICk7CiAgICBjb25zdCBfdmVjdG9yJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgLyoqCiAgICAgKiBGcnVzdHVtcyBhcmUgdXNlZCB0byBkZXRlcm1pbmUgd2hhdCBpcyBpbnNpZGUgdGhlIGNhbWVyYSdzIGZpZWxkIG9mIHZpZXcuCiAgICAgKiBUaGV5IGhlbHAgc3BlZWQgdXAgdGhlIHJlbmRlcmluZyBwcm9jZXNzIC0gb2JqZWN0cyB3aGljaCBsaWUgb3V0c2lkZSBhIGNhbWVyYSdzCiAgICAgKiBmcnVzdHVtIGNhbiBzYWZlbHkgYmUgZXhjbHVkZWQgZnJvbSByZW5kZXJpbmcuCiAgICAgKgogICAgICogVGhpcyBjbGFzcyBpcyBtYWlubHkgaW50ZW5kZWQgZm9yIHVzZSBpbnRlcm5hbGx5IGJ5IGEgcmVuZGVyZXIuCiAgICAgKi8KICAgIGNsYXNzIEZydXN0dW0gewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGZydXN0dW0uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDBdIC0gVGhlIGZpcnN0IHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtQbGFuZX0gW3AxXSAtIFRoZSBzZWNvbmQgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDJdIC0gVGhlIHRoaXJkIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtQbGFuZX0gW3AzXSAtIFRoZSBmb3VydGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDRdIC0gVGhlIGZpZnRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtQbGFuZX0gW3A1XSAtIFRoZSBzaXh0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBwMCA9IG5ldyBQbGFuZSgpLCBwMSA9IG5ldyBQbGFuZSgpLCBwMiA9IG5ldyBQbGFuZSgpLCBwMyA9IG5ldyBQbGFuZSgpLCBwNCA9IG5ldyBQbGFuZSgpLCBwNSA9IG5ldyBQbGFuZSgpICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgYXJyYXkgaG9sZHMgdGhlIHBsYW5lcyB0aGF0IGVuY2xvc2UgdGhlIGZydXN0dW0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxQbGFuZT59CiAgICAJCSAqLwogICAgCQl0aGlzLnBsYW5lcyA9IFsgcDAsIHAxLCBwMiwgcDMsIHA0LCBwNSBdOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGZydXN0dW0gcGxhbmVzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHBsYW5lcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwMF0gLSBUaGUgZmlyc3QgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDFdIC0gVGhlIHNlY29uZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwMl0gLSBUaGUgdGhpcmQgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDNdIC0gVGhlIGZvdXJ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwNF0gLSBUaGUgZmlmdGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDVdIC0gVGhlIHNpeHRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICogQHJldHVybiB7RnJ1c3R1bX0gQSByZWZlcmVuY2UgdG8gdGhpcyBmcnVzdHVtLgogICAgCSAqLwogICAgCXNldCggcDAsIHAxLCBwMiwgcDMsIHA0LCBwNSApIHsKCiAgICAJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKICAgIAkJcGxhbmVzWyAwIF0uY29weSggcDAgKTsKICAgIAkJcGxhbmVzWyAxIF0uY29weSggcDEgKTsKICAgIAkJcGxhbmVzWyAyIF0uY29weSggcDIgKTsKICAgIAkJcGxhbmVzWyAzIF0uY29weSggcDMgKTsKICAgIAkJcGxhbmVzWyA0IF0uY29weSggcDQgKTsKICAgIAkJcGxhbmVzWyA1IF0uY29weSggcDUgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBmcnVzdHVtIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0ZydXN0dW19IGZydXN0dW0gLSBUaGUgZnJ1c3R1bSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge0ZydXN0dW19IEEgcmVmZXJlbmNlIHRvIHRoaXMgZnJ1c3R1bS4KICAgIAkgKi8KICAgIAljb3B5KCBmcnVzdHVtICkgewoKICAgIAkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCXBsYW5lc1sgaSBdLmNvcHkoIGZydXN0dW0ucGxhbmVzWyBpIF0gKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGZydXN0dW0gcGxhbmVzIGZyb20gdGhlIGdpdmVuIHByb2plY3Rpb24gbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIHByb2plY3Rpb24gbWF0cml4LgogICAgCSAqIEBwYXJhbSB7KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0gY29vcmRpbmF0ZVN5c3RlbSAtIFRoZSBjb29yZGluYXRlIHN5c3RlbS4KICAgIAkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIHJlZmVyZW5jZSB0byB0aGlzIGZydXN0dW0uCiAgICAJICovCiAgICAJc2V0RnJvbVByb2plY3Rpb25NYXRyaXgoIG0sIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKICAgIAkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwogICAgCQljb25zdCBtZTAgPSBtZVsgMCBdLCBtZTEgPSBtZVsgMSBdLCBtZTIgPSBtZVsgMiBdLCBtZTMgPSBtZVsgMyBdOwogICAgCQljb25zdCBtZTQgPSBtZVsgNCBdLCBtZTUgPSBtZVsgNSBdLCBtZTYgPSBtZVsgNiBdLCBtZTcgPSBtZVsgNyBdOwogICAgCQljb25zdCBtZTggPSBtZVsgOCBdLCBtZTkgPSBtZVsgOSBdLCBtZTEwID0gbWVbIDEwIF0sIG1lMTEgPSBtZVsgMTEgXTsKICAgIAkJY29uc3QgbWUxMiA9IG1lWyAxMiBdLCBtZTEzID0gbWVbIDEzIF0sIG1lMTQgPSBtZVsgMTQgXSwgbWUxNSA9IG1lWyAxNSBdOwoKICAgIAkJcGxhbmVzWyAwIF0uc2V0Q29tcG9uZW50cyggbWUzIC0gbWUwLCBtZTcgLSBtZTQsIG1lMTEgLSBtZTgsIG1lMTUgLSBtZTEyICkubm9ybWFsaXplKCk7CiAgICAJCXBsYW5lc1sgMSBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMCwgbWU3ICsgbWU0LCBtZTExICsgbWU4LCBtZTE1ICsgbWUxMiApLm5vcm1hbGl6ZSgpOwogICAgCQlwbGFuZXNbIDIgXS5zZXRDb21wb25lbnRzKCBtZTMgKyBtZTEsIG1lNyArIG1lNSwgbWUxMSArIG1lOSwgbWUxNSArIG1lMTMgKS5ub3JtYWxpemUoKTsKICAgIAkJcGxhbmVzWyAzIF0uc2V0Q29tcG9uZW50cyggbWUzIC0gbWUxLCBtZTcgLSBtZTUsIG1lMTEgLSBtZTksIG1lMTUgLSBtZTEzICkubm9ybWFsaXplKCk7CiAgICAJCXBsYW5lc1sgNCBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMiwgbWU3IC0gbWU2LCBtZTExIC0gbWUxMCwgbWUxNSAtIG1lMTQgKS5ub3JtYWxpemUoKTsKCiAgICAJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCXBsYW5lc1sgNSBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMiwgbWU3ICsgbWU2LCBtZTExICsgbWUxMCwgbWUxNSArIG1lMTQgKS5ub3JtYWxpemUoKTsKCiAgICAJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQkJcGxhbmVzWyA1IF0uc2V0Q29tcG9uZW50cyggbWUyLCBtZTYsIG1lMTAsIG1lMTQgKS5ub3JtYWxpemUoKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuRnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIDNEIG9iamVjdCdzIGJvdW5kaW5nIHNwaGVyZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgogICAgCSAqCiAgICAJICogTm90ZSB0aGF0IHRoZSAzRCBvYmplY3QgbXVzdCBoYXZlIGEgZ2VvbWV0cnkgc28gdGhhdCB0aGUgYm91bmRpbmcgc3BoZXJlIGNhbiBiZSBjYWxjdWxhdGVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIDNEIG9iamVjdCdzIGJvdW5kaW5nIHNwaGVyZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSB7CgogICAgCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgb2JqZWN0LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKICAgIAkJCV9zcGhlcmUkMy5jb3B5KCBvYmplY3QuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKCiAgICAJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgogICAgCQkJX3NwaGVyZSQzLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlICkuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzLmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkMyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBzcHJpdGUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3ByaXRlfSBzcHJpdGUgLSBUaGUgc3ByaXRlIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgc3ByaXRlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0gb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNTcHJpdGUoIHNwcml0ZSApIHsKCiAgICAJCV9zcGhlcmUkMy5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgogICAgCQljb25zdCBvZmZzZXQgPSBfZGVmYXVsdFNwcml0ZUNlbnRlci5kaXN0YW5jZVRvKCBzcHJpdGUuY2VudGVyICk7CgogICAgCQlfc3BoZXJlJDMucmFkaXVzID0gMC43MDcxMDY3ODExODY1NDc2ICsgb2Zmc2V0OwogICAgCQlfc3BoZXJlJDMuYXBwbHlNYXRyaXg0KCBzcHJpdGUubWF0cml4V29ybGQgKTsKCiAgICAJCXJldHVybiB0aGlzLmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkMyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBib3VuZGluZyBzcGhlcmUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgYm91bmRpbmcgc3BoZXJlIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0gb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCiAgICAJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwogICAgCQljb25zdCBjZW50ZXIgPSBzcGhlcmUuY2VudGVyOwogICAgCQljb25zdCBuZWdSYWRpdXMgPSAtIHNwaGVyZS5yYWRpdXM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCWNvbnN0IGRpc3RhbmNlID0gcGxhbmVzWyBpIF0uZGlzdGFuY2VUb1BvaW50KCBjZW50ZXIgKTsKCiAgICAJCQlpZiAoIGRpc3RhbmNlIDwgbmVnUmFkaXVzICkgewoKICAgIAkJCQlyZXR1cm4gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRydWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm91bmRpbmcgYm94IHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYm91bmRpbmcgYm94IGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0gb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNCb3goIGJveCApIHsKCiAgICAJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCiAgICAJCQljb25zdCBwbGFuZSA9IHBsYW5lc1sgaSBdOwoKICAgIAkJCS8vIGNvcm5lciBhdCBtYXggZGlzdGFuY2UKCiAgICAJCQlfdmVjdG9yJDYueCA9IHBsYW5lLm5vcm1hbC54ID4gMCA/IGJveC5tYXgueCA6IGJveC5taW4ueDsKICAgIAkJCV92ZWN0b3IkNi55ID0gcGxhbmUubm9ybWFsLnkgPiAwID8gYm94Lm1heC55IDogYm94Lm1pbi55OwogICAgCQkJX3ZlY3RvciQ2LnogPSBwbGFuZS5ub3JtYWwueiA+IDAgPyBib3gubWF4LnogOiBib3gubWluLno7CgogICAgCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIF92ZWN0b3IkNiApIDwgMCApIHsKCiAgICAJCQkJcmV0dXJuIGZhbHNlOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB0cnVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBwb2ludCBsaWVzIHdpdGhpbiB0aGUgZnJ1c3R1bS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBwb2ludCBsaWVzIHdpdGhpbiB0aGlzIGZydXN0dW0gb3Igbm90LgogICAgCSAqLwogICAgCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKICAgIAkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCWlmICggcGxhbmVzWyBpIF0uZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIDwgMCApIHsKCiAgICAJCQkJcmV0dXJuIGZhbHNlOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB0cnVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgZnJ1c3R1bSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7RnJ1c3R1bX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSB0ZXh0dXJlIGZvciB1c2Ugd2l0aCBhIHZpZGVvLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiAvLyBhc3N1bWluZyB5b3UgaGF2ZSBjcmVhdGVkIGEgSFRNTCB2aWRlbyBlbGVtZW50IHdpdGggaWQ9InZpZGVvIgogICAgICogY29uc3QgdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3ZpZGVvJyApOwogICAgICogY29uc3QgdGV4dHVyZSA9IG5ldyBUSFJFRS5WaWRlb1RleHR1cmUoIHZpZGVvICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBOb3RlOiBBZnRlciB0aGUgaW5pdGlhbCB1c2Ugb2YgYSB0ZXh0dXJlLCBpdHMgZGltZW5zaW9ucywgZm9ybWF0LCBhbmQgdHlwZQogICAgICogY2Fubm90IGJlIGNoYW5nZWQuIEluc3RlYWQsIGNhbGwge0BsaW5rIFRleHR1cmUjZGlzcG9zZX0gb24gdGhlIHRleHR1cmUgYW5kIGluc3RhbnRpYXRlIGEgbmV3IG9uZS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgVGV4dHVyZQogICAgICovCiAgICBjbGFzcyBWaWRlb1RleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyB2aWRlbyB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtIVE1MVmlkZW9FbGVtZW50fSB2aWRlbyAtIFRoZSB2aWRlbyBlbGVtZW50IHRvIHVzZSBhcyBhIGRhdGEgc291cmNlIGZvciB0aGUgdGV4dHVyZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hcHBpbmc9VGV4dHVyZS5ERUZBVUxUX01BUFBJTkddIC0gVGhlIHRleHR1cmUgbWFwcGluZy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBTIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFQgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYWdGaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtYWcgZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWluRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWluIGZpbHRlciB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2Zvcm1hdD1SR0JBRm9ybWF0XSAtIFRoZSB0ZXh0dXJlIGZvcm1hdC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3R5cGU9VW5zaWduZWRCeXRlVHlwZV0gLSBUaGUgdGV4dHVyZSB0eXBlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbYW5pc290cm9weT1UZXh0dXJlLkRFRkFVTFRfQU5JU09UUk9QWV0gLSBUaGUgYW5pc290cm9weSB2YWx1ZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggdmlkZW8sIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyID0gTGluZWFyRmlsdGVyLCBtaW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApIHsKCiAgICAJCXN1cGVyKCB2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1ZpZGVvVGV4dHVyZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCiAgICAJCWNvbnN0IHNjb3BlID0gdGhpczsKCiAgICAJCWZ1bmN0aW9uIHVwZGF0ZVZpZGVvKCkgewoKICAgIAkJCXNjb3BlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIAkJCXZpZGVvLnJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2soIHVwZGF0ZVZpZGVvICk7CgogICAgCQl9CgogICAgCQlpZiAoICdyZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrJyBpbiB2aWRlbyApIHsKCiAgICAJCQl2aWRlby5yZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrKCB1cGRhdGVWaWRlbyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLmltYWdlICkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZSByZW5kZXJlciBhbmQgc2V0cyB7QGxpbmsgVGV4dHVyZSNuZWVkc1VwZGF0ZX0KICAgIAkgKiB0byBgdHJ1ZWAgZXZlcnkgdGltZSBhIG5ldyBmcmFtZSBpcyBhdmFpbGFibGUuCiAgICAJICoKICAgIAkgKiBPbmx5IHJlbGV2YW50IGlmIGByZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrYCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoZSBicm93c2VyLgogICAgCSAqLwogICAgCXVwZGF0ZSgpIHsKCiAgICAJCWNvbnN0IHZpZGVvID0gdGhpcy5pbWFnZTsKICAgIAkJY29uc3QgaGFzVmlkZW9GcmFtZUNhbGxiYWNrID0gJ3JlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2snIGluIHZpZGVvOwoKICAgIAkJaWYgKCBoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPT09IGZhbHNlICYmIHZpZGVvLnJlYWR5U3RhdGUgPj0gdmlkZW8uSEFWRV9DVVJSRU5UX0RBVEEgKSB7CgogICAgCQkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgdGV4dHVyZSBmcm9tIGEgY2FudmFzIGVsZW1lbnQuCiAgICAgKgogICAgICogVGhpcyBpcyBhbG1vc3QgdGhlIHNhbWUgYXMgdGhlIGJhc2UgdGV4dHVyZSBjbGFzcywgZXhjZXB0IHRoYXQgaXQgc2V0cyB7QGxpbmsgVGV4dHVyZSNuZWVkc1VwZGF0ZX0KICAgICAqIHRvIGB0cnVlYCBpbW1lZGlhdGVseSBzaW5jZSBhIGNhbnZhcyBjYW4gZGlyZWN0bHkgYmUgdXNlZCBmb3IgcmVuZGVyaW5nLgogICAgICoKICAgICAqIEBhdWdtZW50cyBUZXh0dXJlCiAgICAgKi8KICAgIGNsYXNzIENhbnZhc1RleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtIVE1MQ2FudmFzRWxlbWVudH0gW2NhbnZhc10gLSBUaGUgSFRNTCBjYW52YXMgZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hcHBpbmc9VGV4dHVyZS5ERUZBVUxUX01BUFBJTkddIC0gVGhlIHRleHR1cmUgbWFwcGluZy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBTIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFQgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYWdGaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtYWcgZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWluRmlsdGVyPUxpbmVhck1pcG1hcExpbmVhckZpbHRlcl0gLSBUaGUgbWluIGZpbHRlciB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2Zvcm1hdD1SR0JBRm9ybWF0XSAtIFRoZSB0ZXh0dXJlIGZvcm1hdC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3R5cGU9VW5zaWduZWRCeXRlVHlwZV0gLSBUaGUgdGV4dHVyZSB0eXBlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbYW5pc290cm9weT1UZXh0dXJlLkRFRkFVTFRfQU5JU09UUk9QWV0gLSBUaGUgYW5pc290cm9weSB2YWx1ZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggY2FudmFzLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKSB7CgogICAgCQlzdXBlciggY2FudmFzLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzQ2FudmFzVGV4dHVyZSA9IHRydWU7CgogICAgCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHVzZWQgdG8gYXV0b21hdGljYWxseSBzYXZlIHRoZSBkZXB0aCBpbmZvcm1hdGlvbiBvZiBhCiAgICAgKiByZW5kZXJpbmcgaW50byBhIHRleHR1cmUuCiAgICAgKgogICAgICogQGF1Z21lbnRzIFRleHR1cmUKICAgICAqLwogICAgY2xhc3MgRGVwdGhUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgZGVwdGggdGV4dHVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3R5cGU9VW5zaWduZWRJbnRUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPVRleHR1cmUuREVGQVVMVF9NQVBQSU5HXSAtIFRoZSB0ZXh0dXJlIG1hcHBpbmcuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwUz1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwUyB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBUPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBUIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFnRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWFnIGZpbHRlciB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21pbkZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1pbiBmaWx0ZXIgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PURlcHRoRm9ybWF0XSAtIFRoZSB0ZXh0dXJlIGZvcm1hdC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB3aWR0aCwgaGVpZ2h0LCB0eXBlID0gVW5zaWduZWRJbnRUeXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIG1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIGFuaXNvdHJvcHksIGZvcm1hdCA9IERlcHRoRm9ybWF0LCBkZXB0aCA9IDEgKSB7CgogICAgCQlpZiAoIGZvcm1hdCAhPT0gRGVwdGhGb3JtYXQgJiYgZm9ybWF0ICE9PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnRGVwdGhUZXh0dXJlIGZvcm1hdCBtdXN0IGJlIGVpdGhlciBUSFJFRS5EZXB0aEZvcm1hdCBvciBUSFJFRS5EZXB0aFN0ZW5jaWxGb3JtYXQnICk7CgogICAgCQl9CgogICAgCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IGRlcHRoIH07CgogICAgCQlzdXBlciggaW1hZ2UsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNEZXB0aFRleHR1cmUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSB0ZXh0dXJlIGlzIGZsaXBwZWQgYWxvbmcgdGhlIHZlcnRpY2FsIGF4aXMgd2hlbgogICAgCQkgKiB1cGxvYWRlZCB0byB0aGUgR1BVLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmZsaXBZID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBDb2RlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRlcHRoIGNvbXBhcmUgZnVuY3Rpb24uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KE5ldmVyQ29tcGFyZXxMZXNzQ29tcGFyZXxFcXVhbENvbXBhcmV8TGVzc0VxdWFsQ29tcGFyZXxHcmVhdGVyQ29tcGFyZXxOb3RFcXVhbENvbXBhcmV8R3JlYXRlckVxdWFsQ29tcGFyZXxBbHdheXNDb21wYXJlKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBudWxsOwoKICAgIAl9CgoKICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCiAgICAJCXRoaXMuc291cmNlID0gbmV3IFNvdXJjZSggT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5pbWFnZSApICk7IC8vIHNlZSAjMzA1NDAKICAgIAkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBzb3VyY2UuY29tcGFyZUZ1bmN0aW9uOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJdG9KU09OKCBtZXRhICkgewoKICAgIAkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKICAgIAkJaWYgKCB0aGlzLmNvbXBhcmVGdW5jdGlvbiAhPT0gbnVsbCApIGRhdGEuY29tcGFyZUZ1bmN0aW9uID0gdGhpcy5jb21wYXJlRnVuY3Rpb247CgogICAgCQlyZXR1cm4gZGF0YTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIEEgZ2VvbWV0cnkgY2xhc3MgZm9yIHJlcHJlc2VudGluZyBhIHBsYW5lLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KCAxLCAxICk7CiAgICAgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSApOwogICAgICogY29uc3QgcGxhbmUgPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CiAgICAgKiBzY2VuZS5hZGQoIHBsYW5lICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAYXVnbWVudHMgQnVmZmVyR2VvbWV0cnkKICAgICAqLwogICAgY2xhc3MgUGxhbmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBwbGFuZSBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggYWxvbmcgdGhlIFggYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQgYWxvbmcgdGhlIFkgYXhpcwogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGhTZWdtZW50cz0xXSAtIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgYWxvbmcgdGhlIFggYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodFNlZ21lbnRzPTFdIC0gVGhlIG51bWJlciBvZiBzZWdtZW50cyBhbG9uZyB0aGUgWSBheGlzLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIHdpZHRoU2VnbWVudHMgPSAxLCBoZWlnaHRTZWdtZW50cyA9IDEgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJdGhpcy50eXBlID0gJ1BsYW5lR2VvbWV0cnknOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvbGRzIHRoZSBjb25zdHJ1Y3RvciBwYXJhbWV0ZXJzIHRoYXQgaGF2ZSBiZWVuCiAgICAJCSAqIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGdlb21ldHJ5LiBBbnkgbW9kaWZpY2F0aW9uCiAgICAJCSAqIGFmdGVyIGluc3RhbnRpYXRpb24gZG9lcyBub3QgY2hhbmdlIHRoZSBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdH0KICAgIAkJICovCiAgICAJCXRoaXMucGFyYW1ldGVycyA9IHsKICAgIAkJCXdpZHRoOiB3aWR0aCwKICAgIAkJCWhlaWdodDogaGVpZ2h0LAogICAgCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKICAgIAkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cwogICAgCQl9OwoKICAgIAkJY29uc3Qgd2lkdGhfaGFsZiA9IHdpZHRoIC8gMjsKICAgIAkJY29uc3QgaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyOwoKICAgIAkJY29uc3QgZ3JpZFggPSBNYXRoLmZsb29yKCB3aWR0aFNlZ21lbnRzICk7CiAgICAJCWNvbnN0IGdyaWRZID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKTsKCiAgICAJCWNvbnN0IGdyaWRYMSA9IGdyaWRYICsgMTsKICAgIAkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKICAgIAkJY29uc3Qgc2VnbWVudF93aWR0aCA9IHdpZHRoIC8gZ3JpZFg7CiAgICAJCWNvbnN0IHNlZ21lbnRfaGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgogICAgCQkvLwoKICAgIAkJY29uc3QgaW5kaWNlcyA9IFtdOwogICAgCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgCQljb25zdCBub3JtYWxzID0gW107CiAgICAJCWNvbnN0IHV2cyA9IFtdOwoKICAgIAkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5ICsrICkgewoKICAgIAkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRfaGVpZ2h0IC0gaGVpZ2h0X2hhbGY7CgogICAgCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKICAgIAkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50X3dpZHRoIC0gd2lkdGhfaGFsZjsKCiAgICAJCQkJdmVydGljZXMucHVzaCggeCwgLSB5LCAwICk7CgogICAgCQkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKICAgIAkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwogICAgCQkJCXV2cy5wdXNoKCAxIC0gKCBpeSAvIGdyaWRZICkgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCiAgICAJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCArKyApIHsKCiAgICAJCQkJY29uc3QgYSA9IGl4ICsgZ3JpZFgxICogaXk7CiAgICAJCQkJY29uc3QgYiA9IGl4ICsgZ3JpZFgxICogKCBpeSArIDEgKTsKICAgIAkJCQljb25zdCBjID0gKCBpeCArIDEgKSArIGdyaWRYMSAqICggaXkgKyAxICk7CiAgICAJCQkJY29uc3QgZCA9ICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCiAgICAJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CiAgICAJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwogICAgCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKICAgIAkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CiAgICAJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCiAgICAJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRmFjdG9yeSBtZXRob2QgZm9yIGNyZWF0aW5nIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgZnJvbSB0aGUgZ2l2ZW4KICAgIAkgKiBKU09OIG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCiAgICAJICogQHJldHVybiB7UGxhbmVHZW9tZXRyeX0gQSBuZXcgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKICAgIAkJcmV0dXJuIG5ldyBQbGFuZUdlb21ldHJ5KCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIG1hdGVyaWFsIGZvciBkcmF3aW5nIGdlb21ldHJ5IGJ5IGRlcHRoLiBEZXB0aCBpcyBiYXNlZCBvZmYgb2YgdGhlIGNhbWVyYQogICAgICogbmVhciBhbmQgZmFyIHBsYW5lLiBXaGl0ZSBpcyBuZWFyZXN0LCBibGFjayBpcyBmYXJ0aGVzdC4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgTWF0ZXJpYWwKICAgICAqLwogICAgY2xhc3MgTWVzaERlcHRoTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgbWVzaCBkZXB0aCBtYXRlcmlhbC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCiAgICAJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAogICAgCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAogICAgCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCiAgICAJICogYnkge0BsaW5rIENvbG9yI3NldH0uCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNNZXNoRGVwdGhNYXRlcmlhbCA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnTWVzaERlcHRoTWF0ZXJpYWwnOwoKICAgIAkJLyoqCiAgICAJCSAqIFR5cGUgZm9yIGRlcHRoIHBhY2tpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoQmFzaWNEZXB0aFBhY2tpbmd8UkdCQURlcHRoUGFja2luZ3xSR0JEZXB0aFBhY2tpbmd8UkdEZXB0aFBhY2tpbmcpfQogICAgCQkgKiBAZGVmYXVsdCBCYXNpY0RlcHRoUGFja2luZwogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aFBhY2tpbmcgPSBCYXNpY0RlcHRoUGFja2luZzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAogICAgCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5tYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKICAgIAkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KICAgIAkJICoKICAgIAkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCiAgICAJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCiAgICAJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKICAgIAkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAogICAgCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGRpc3BsYWNlbWVudCBtYXAgYWZmZWN0cyB0aGUgcG9zaXRpb24gb2YgdGhlIG1lc2gncyB2ZXJ0aWNlcy4gVW5saWtlCiAgICAJCSAqIG90aGVyIG1hcHMgd2hpY2ggb25seSBhZmZlY3QgdGhlIGxpZ2h0IGFuZCBzaGFkZSBvZiB0aGUgbWF0ZXJpYWwgdGhlCiAgICAJCSAqIGRpc3BsYWNlZCB2ZXJ0aWNlcyBjYW4gY2FzdCBzaGFkb3dzLCBibG9jayBvdGhlciBvYmplY3RzLCBhbmQgb3RoZXJ3aXNlCiAgICAJCSAqIGFjdCBhcyByZWFsIGdlb21ldHJ5LiBUaGUgZGlzcGxhY2VtZW50IHRleHR1cmUgaXMgYW4gaW1hZ2Ugd2hlcmUgdGhlIHZhbHVlCiAgICAJCSAqIG9mIGVhY2ggcGl4ZWwgKHdoaXRlIGJlaW5nIHRoZSBoaWdoZXN0KSBpcyBtYXBwZWQgYWdhaW5zdCwgYW5kCiAgICAJCSAqIHJlcG9zaXRpb25zLCB0aGUgdmVydGljZXMgb2YgdGhlIG1lc2guCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyBtdWNoIHRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIG1lc2ggKHdoZXJlIGJsYWNrIGlzIG5vCiAgICAJCSAqIGRpc3BsYWNlbWVudCwgYW5kIHdoaXRlIGlzIG1heGltdW0gZGlzcGxhY2VtZW50KS4gV2l0aG91dCBhIGRpc3BsYWNlbWVudAogICAgCQkgKiBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgb2Zmc2V0IG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwJ3MgdmFsdWVzIG9uIHRoZSBtZXNoJ3MgdmVydGljZXMuCiAgICAJCSAqIFRoZSBiaWFzIGlzIGFkZGVkIHRvIHRoZSBzY2FsZWQgc2FtcGxlIG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwLgogICAgCQkgKiBXaXRob3V0IGEgZGlzcGxhY2VtZW50IG1hcCBzZXQsIHRoaXMgdmFsdWUgaXMgbm90IGFwcGxpZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgogICAgCQkvKioKICAgIAkJICogUmVuZGVycyB0aGUgZ2VvbWV0cnkgYXMgYSB3aXJlZnJhbWUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBDb250cm9scyB0aGUgdGhpY2tuZXNzIG9mIHRoZSB3aXJlZnJhbWUuCiAgICAJCSAqCiAgICAJCSAqIFdlYkdMIGFuZCBXZWJHUFUgaWdub3JlIHRoaXMgcHJvcGVydHkgYW5kIGFsd2F5cyByZW5kZXIKICAgIAkJICogMSBwaXhlbCB3aWRlIGxpbmVzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgogICAgCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKICAgIAkJdGhpcy5kZXB0aFBhY2tpbmcgPSBzb3VyY2UuZGVwdGhQYWNraW5nOwoKICAgIAkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKICAgIAkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCiAgICAJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgogICAgCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CiAgICAJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSBtYXRlcmlhbCB1c2VkIGludGVybmFsbHkgZm9yIGltcGxlbWVudGluZyBzaGFkb3cgbWFwcGluZyB3aXRoCiAgICAgKiBwb2ludCBsaWdodHMuCiAgICAgKgogICAgICogQ2FuIGFsc28gYmUgdXNlZCB0byBjdXN0b21pemUgdGhlIHNoYWRvdyBjYXN0aW5nIG9mIGFuIG9iamVjdCBieSBhc3NpZ25pbmcKICAgICAqIGFuIGluc3RhbmNlIG9mIGBNZXNoRGlzdGFuY2VNYXRlcmlhbGAgdG8ge0BsaW5rIE9iamVjdDNEI2N1c3RvbURpc3RhbmNlTWF0ZXJpYWx9LgogICAgICogVGhlIGZvbGxvd2luZyBleGFtcGxlcyBkZW1vbnN0cmF0ZXMgdGhpcyBhcHByb2FjaCBpbiBvcmRlciB0byBlbnN1cmUKICAgICAqIHRyYW5zcGFyZW50IHBhcnRzIG9mIG9iamVjdHMgZG8gbm8gY2FzdCBzaGFkb3dzLgogICAgICoKICAgICAqIEBhdWdtZW50cyBNYXRlcmlhbAogICAgICovCiAgICBjbGFzcyBNZXNoRGlzdGFuY2VNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBtZXNoIGRpc3RhbmNlIG1hdGVyaWFsLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3R9IFtwYXJhbWV0ZXJzXSAtIEFuIG9iamVjdCB3aXRoIG9uZSBvciBtb3JlIHByb3BlcnRpZXMKICAgIAkgKiBkZWZpbmluZyB0aGUgbWF0ZXJpYWwncyBhcHBlYXJhbmNlLiBBbnkgcHJvcGVydHkgb2YgdGhlIG1hdGVyaWFsCiAgICAJICogKGluY2x1ZGluZyBhbnkgcHJvcGVydHkgZnJvbSBpbmhlcml0ZWQgbWF0ZXJpYWxzKSBjYW4gYmUgcGFzc2VkCiAgICAJICogaW4gaGVyZS4gQ29sb3IgdmFsdWVzIGNhbiBiZSBwYXNzZWQgYW55IHR5cGUgb2YgdmFsdWUgYWNjZXB0ZWQKICAgIAkgKiBieSB7QGxpbmsgQ29sb3Ijc2V0fS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc01lc2hEaXN0YW5jZU1hdGVyaWFsID0gdHJ1ZTsKCiAgICAJCXRoaXMudHlwZSA9ICdNZXNoRGlzdGFuY2VNYXRlcmlhbCc7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNvbG9yIG1hcC4gTWF5IG9wdGlvbmFsbHkgaW5jbHVkZSBhbiBhbHBoYSBjaGFubmVsLCB0eXBpY2FsbHkgY29tYmluZWQKICAgIAkJICogd2l0aCB7QGxpbmsgTWF0ZXJpYWwjdHJhbnNwYXJlbnR9IG9yIHtAbGluayBNYXRlcmlhbCNhbHBoYVRlc3R9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMubWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgYWxwaGEgbWFwIGlzIGEgZ3JheXNjYWxlIHRleHR1cmUgdGhhdCBjb250cm9scyB0aGUgb3BhY2l0eSBhY3Jvc3MgdGhlCiAgICAJCSAqIHN1cmZhY2UgKGJsYWNrOiBmdWxseSB0cmFuc3BhcmVudDsgd2hpdGU6IGZ1bGx5IG9wYXF1ZSkuCiAgICAJCSAqCiAgICAJCSAqIE9ubHkgdGhlIGNvbG9yIG9mIHRoZSB0ZXh0dXJlIGlzIHVzZWQsIGlnbm9yaW5nIHRoZSBhbHBoYSBjaGFubmVsIGlmIG9uZQogICAgCQkgKiBleGlzdHMuIEZvciBSR0IgYW5kIFJHQkEgdGV4dHVyZXMsIHRoZSByZW5kZXJlciB3aWxsIHVzZSB0aGUgZ3JlZW4gY2hhbm5lbAogICAgCQkgKiB3aGVuIHNhbXBsaW5nIHRoaXMgdGV4dHVyZSBkdWUgdG8gdGhlIGV4dHJhIGJpdCBvZiBwcmVjaXNpb24gcHJvdmlkZWQgZm9yCiAgICAJCSAqIGdyZWVuIGluIERYVC1jb21wcmVzc2VkIGFuZCB1bmNvbXByZXNzZWQgUkdCIDU2NSBmb3JtYXRzLiBMdW1pbmFuY2Utb25seSBhbmQKICAgIAkJICogbHVtaW5hbmNlL2FscGhhIHRleHR1cmVzIHdpbGwgYWxzbyBzdGlsbCB3b3JrIGFzIGV4cGVjdGVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBtZXNoJ3MgdmVydGljZXMuIFVubGlrZQogICAgCQkgKiBvdGhlciBtYXBzIHdoaWNoIG9ubHkgYWZmZWN0IHRoZSBsaWdodCBhbmQgc2hhZGUgb2YgdGhlIG1hdGVyaWFsIHRoZQogICAgCQkgKiBkaXNwbGFjZWQgdmVydGljZXMgY2FuIGNhc3Qgc2hhZG93cywgYmxvY2sgb3RoZXIgb2JqZWN0cywgYW5kIG90aGVyd2lzZQogICAgCQkgKiBhY3QgYXMgcmVhbCBnZW9tZXRyeS4gVGhlIGRpc3BsYWNlbWVudCB0ZXh0dXJlIGlzIGFuIGltYWdlIHdoZXJlIHRoZSB2YWx1ZQogICAgCQkgKiBvZiBlYWNoIHBpeGVsICh3aGl0ZSBiZWluZyB0aGUgaGlnaGVzdCkgaXMgbWFwcGVkIGFnYWluc3QsIGFuZAogICAgCQkgKiByZXBvc2l0aW9ucywgdGhlIHZlcnRpY2VzIG9mIHRoZSBtZXNoLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgbXVjaCB0aGUgZGlzcGxhY2VtZW50IG1hcCBhZmZlY3RzIHRoZSBtZXNoICh3aGVyZSBibGFjayBpcyBubwogICAgCQkgKiBkaXNwbGFjZW1lbnQsIGFuZCB3aGl0ZSBpcyBtYXhpbXVtIGRpc3BsYWNlbWVudCkuIFdpdGhvdXQgYSBkaXNwbGFjZW1lbnQKICAgIAkJICogbWFwIHNldCwgdGhpcyB2YWx1ZSBpcyBub3QgYXBwbGllZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgogICAgCQkvKioKICAgIAkJICogVGhlIG9mZnNldCBvZiB0aGUgZGlzcGxhY2VtZW50IG1hcCdzIHZhbHVlcyBvbiB0aGUgbWVzaCdzIHZlcnRpY2VzLgogICAgCQkgKiBUaGUgYmlhcyBpcyBhZGRlZCB0byB0aGUgc2NhbGVkIHNhbXBsZSBvZiB0aGUgZGlzcGxhY2VtZW50IG1hcC4KICAgIAkJICogV2l0aG91dCBhIGRpc3BsYWNlbWVudCBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwoKICAgIAkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCiAgICAJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCiAgICAJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgogICAgCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CiAgICAJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBAY2xhc3MKICAgICAqIEBjbGFzc2Rlc2MgQSBzaW1wbGUgY2FjaGluZyBzeXN0ZW0sIHVzZWQgaW50ZXJuYWxseSBieSB7QGxpbmsgRmlsZUxvYWRlcn0uCiAgICAgKiBUbyBlbmFibGUgY2FjaGluZyBhY3Jvc3MgYWxsIGxvYWRlcnMgdGhhdCB1c2Uge0BsaW5rIEZpbGVMb2FkZXJ9LCBhZGQgYFRIUkVFLkNhY2hlLmVuYWJsZWQgPSB0cnVlLmAgb25jZSBpbiB5b3VyIGFwcC4KICAgICAqIEBoaWRlY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3QgQ2FjaGUgPSB7CgogICAgCS8qKgogICAgCSAqIFdoZXRoZXIgY2FjaGluZyBpcyBlbmFibGVkIG9yIG5vdC4KICAgIAkgKgogICAgCSAqIEBzdGF0aWMKICAgIAkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkgKiBAZGVmYXVsdCBmYWxzZQogICAgCSAqLwogICAgCWVuYWJsZWQ6IGZhbHNlLAoKICAgIAkvKioKICAgIAkgKiBBIGRpY3Rpb25hcnkgdGhhdCBob2xkcyBjYWNoZWQgZmlsZXMuCiAgICAJICoKICAgIAkgKiBAc3RhdGljCiAgICAJICogQHR5cGUge09iamVjdDxzdHJpbmcsT2JqZWN0Pn0KICAgIAkgKi8KICAgIAlmaWxlczoge30sCgogICAgCS8qKgogICAgCSAqIEFkZHMgYSBjYWNoZSBlbnRyeSB3aXRoIGEga2V5IHRvIHJlZmVyZW5jZSB0aGUgZmlsZS4gSWYgdGhpcyBrZXkgYWxyZWFkeQogICAgCSAqIGhvbGRzIGEgZmlsZSwgaXQgaXMgb3ZlcndyaXR0ZW4uCiAgICAJICoKICAgIAkgKiBAc3RhdGljCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZmlsZSAtICBUaGUgZmlsZSB0byBiZSBjYWNoZWQuCiAgICAJICovCiAgICAJYWRkOiBmdW5jdGlvbiAoIGtleSwgZmlsZSApIHsKCiAgICAJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCiAgICAJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQ2FjaGUnLCAnQWRkaW5nIGtleTonLCBrZXkgKTsKCiAgICAJCXRoaXMuZmlsZXNbIGtleSBdID0gZmlsZTsKCiAgICAJfSwKCiAgICAJLyoqCiAgICAJICogR2V0cyB0aGUgY2FjaGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4ga2V5LgogICAgCSAqCiAgICAJICogQHN0YXRpYwogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSBUaGUga2V5IHRvIHJlZmVyZW5jZSB0aGUgY2FjaGVkIGZpbGUuCiAgICAJICogQHJldHVybiB7T2JqZWN0fHVuZGVmaW5lZH0gVGhlIGNhY2hlZCBmaWxlLiBJZiB0aGUga2V5IGRvZXMgbm90IGV4aXN0IGB1bmRlZmluZWRgIGlzIHJldHVybmVkLgogICAgCSAqLwogICAgCWdldDogZnVuY3Rpb24gKCBrZXkgKSB7CgogICAgCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgKSByZXR1cm47CgogICAgCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLkNhY2hlJywgJ0NoZWNraW5nIGtleTonLCBrZXkgKTsKCiAgICAJCXJldHVybiB0aGlzLmZpbGVzWyBrZXkgXTsKCiAgICAJfSwKCiAgICAJLyoqCiAgICAJICogUmVtb3ZlcyB0aGUgY2FjaGVkIGZpbGUgYXNzb2NpYXRlZCB3aXRoIHRoZSBnaXZlbiBrZXkuCiAgICAJICoKICAgIAkgKiBAc3RhdGljCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KICAgIAkgKi8KICAgIAlyZW1vdmU6IGZ1bmN0aW9uICgga2V5ICkgewoKICAgIAkJZGVsZXRlIHRoaXMuZmlsZXNbIGtleSBdOwoKICAgIAl9LAoKICAgIAkvKioKICAgIAkgKiBSZW1vdmUgYWxsIHZhbHVlcyBmcm9tIHRoZSBjYWNoZS4KICAgIAkgKgogICAgCSAqIEBzdGF0aWMKICAgIAkgKi8KICAgIAljbGVhcjogZnVuY3Rpb24gKCkgewoKICAgIAkJdGhpcy5maWxlcyA9IHt9OwoKICAgIAl9CgogICAgfTsKCiAgICAvKioKICAgICAqIEhhbmRsZXMgYW5kIGtlZXBzIHRyYWNrIG9mIGxvYWRlZCBhbmQgcGVuZGluZyBkYXRhLiBBIGRlZmF1bHQgZ2xvYmFsCiAgICAgKiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzIGlzIGNyZWF0ZWQgYW5kIHVzZWQgYnkgbG9hZGVycyBpZiBub3Qgc3VwcGxpZWQKICAgICAqIG1hbnVhbGx5LgogICAgICoKICAgICAqIEluIGdlbmVyYWwgdGhhdCBzaG91bGQgYmUgc3VmZmljaWVudCwgaG93ZXZlciB0aGVyZSBhcmUgdGltZXMgd2hlbiBpdCBjYW4KICAgICAqIGJlIHVzZWZ1bCB0byBoYXZlIHNlcGFyYXRlIGxvYWRlcnMgLSBmb3IgZXhhbXBsZSBpZiB5b3Ugd2FudCB0byBzaG93CiAgICAgKiBzZXBhcmF0ZSBsb2FkaW5nIGJhcnMgZm9yIG9iamVjdHMgYW5kIHRleHR1cmVzLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBtYW5hZ2VyID0gbmV3IFRIUkVFLkxvYWRpbmdNYW5hZ2VyKCk7CiAgICAgKiBtYW5hZ2VyLm9uTG9hZCA9ICgpID0+IGNvbnNvbGUubG9nKCAnTG9hZGluZyBjb21wbGV0ZSEnICk7CiAgICAgKgogICAgICogY29uc3QgbG9hZGVyMSA9IG5ldyBPQkpMb2FkZXIoIG1hbmFnZXIgKTsKICAgICAqIGNvbnN0IGxvYWRlcjIgPSBuZXcgQ29sbGFkYUxvYWRlciggbWFuYWdlciApOwogICAgICogYGBgCiAgICAgKi8KICAgIGNsYXNzIExvYWRpbmdNYW5hZ2VyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBsb2FkaW5nIG1hbmFnZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Mb2FkXSAtIEV4ZWN1dGVzIHdoZW4gYWxsIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gW29uUHJvZ3Jlc3NdIC0gRXhlY3V0ZXMgd2hlbiBzaW5nbGUgaXRlbXMgaGF2ZSBiZWVuIGxvYWRlZC4KICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25FcnJvcl0gLSBFeGVjdXRlcyB3aGVuIGFuIGVycm9yIG9jY3Vycy4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3Rvciggb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKICAgIAkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKICAgIAkJbGV0IGlzTG9hZGluZyA9IGZhbHNlOwogICAgCQlsZXQgaXRlbXNMb2FkZWQgPSAwOwogICAgCQlsZXQgaXRlbXNUb3RhbCA9IDA7CiAgICAJCWxldCB1cmxNb2RpZmllciA9IHVuZGVmaW5lZDsKICAgIAkJY29uc3QgaGFuZGxlcnMgPSBbXTsKCiAgICAJCS8vIFJlZmVyIHRvICM1Njg5IGZvciB0aGUgcmVhc29uIHdoeSB3ZSBkb24ndCBzZXQgLm9uU3RhcnQKICAgIAkJLy8gaW4gdGhlIGNvbnN0cnVjdG9yCgogICAgCQkvKioKICAgIAkJICogRXhlY3V0ZXMgd2hlbiBhbiBpdGVtIHN0YXJ0cyBsb2FkaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMub25TdGFydCA9IHVuZGVmaW5lZDsKCiAgICAJCS8qKgogICAgCQkgKiBFeGVjdXRlcyB3aGVuIGFsbCBpdGVtcyBoYXZlIGJlZW4gbG9hZGVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMub25Mb2FkID0gb25Mb2FkOwoKICAgIAkJLyoqCiAgICAJCSAqIEV4ZWN1dGVzIHdoZW4gc2luZ2xlIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtGdW5jdGlvbnx1bmRlZmluZWR9CiAgICAJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAogICAgCQkgKi8KICAgIAkJdGhpcy5vblByb2dyZXNzID0gb25Qcm9ncmVzczsKCiAgICAJCS8qKgogICAgCQkgKiBFeGVjdXRlcyB3aGVuIGFuIGVycm9yIG9jY3Vycy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0Z1bmN0aW9ufHVuZGVmaW5lZH0KICAgIAkJICogQGRlZmF1bHQgdW5kZWZpbmVkCiAgICAJCSAqLwogICAgCQl0aGlzLm9uRXJyb3IgPSBvbkVycm9yOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBieSBhbnkgbG9hZGVyIHVzaW5nIHRoZSBtYW5hZ2VyIHdoZW4gdGhlIGxvYWRlcgogICAgCQkgKiBzdGFydHMgbG9hZGluZyBhbiBpdGVtLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBsb2FkLgogICAgCQkgKi8KICAgIAkJdGhpcy5pdGVtU3RhcnQgPSBmdW5jdGlvbiAoIHVybCApIHsKCiAgICAJCQlpdGVtc1RvdGFsICsrOwoKICAgIAkJCWlmICggaXNMb2FkaW5nID09PSBmYWxzZSApIHsKCiAgICAJCQkJaWYgKCBzY29wZS5vblN0YXJ0ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlzY29wZS5vblN0YXJ0KCB1cmwsIGl0ZW1zTG9hZGVkLCBpdGVtc1RvdGFsICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaXNMb2FkaW5nID0gdHJ1ZTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCiAgICAJCSAqIGVuZGVkIGxvYWRpbmcgYW4gaXRlbS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIGxvYWRlZCBpdGVtLgogICAgCQkgKi8KICAgIAkJdGhpcy5pdGVtRW5kID0gZnVuY3Rpb24gKCB1cmwgKSB7CgogICAgCQkJaXRlbXNMb2FkZWQgKys7CgogICAgCQkJaWYgKCBzY29wZS5vblByb2dyZXNzICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXNjb3BlLm9uUHJvZ3Jlc3MoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBpdGVtc0xvYWRlZCA9PT0gaXRlbXNUb3RhbCApIHsKCiAgICAJCQkJaXNMb2FkaW5nID0gZmFsc2U7CgogICAgCQkJCWlmICggc2NvcGUub25Mb2FkICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlzY29wZS5vbkxvYWQoKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCiAgICAJCSAqIGVuY291bnRlcnMgYW4gZXJyb3Igd2hlbiBsb2FkaW5nIGFuIGl0ZW0uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIG9mIHRoZSBpdGVtIHRoYXQgcHJvZHVjZXMgYW4gZXJyb3IuCiAgICAJCSAqLwogICAgCQl0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uICggdXJsICkgewoKICAgIAkJCWlmICggc2NvcGUub25FcnJvciAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlzY29wZS5vbkVycm9yKCB1cmwgKTsKCiAgICAJCQl9CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIEdpdmVuIGEgVVJMLCB1c2VzIHRoZSBVUkwgbW9kaWZpZXIgY2FsbGJhY2sgKGlmIGFueSkgYW5kIHJldHVybnMgYQogICAgCQkgKiByZXNvbHZlZCBVUkwuIElmIG5vIFVSTCBtb2RpZmllciBpcyBzZXQsIHJldHVybnMgdGhlIG9yaWdpbmFsIFVSTC4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgdG8gbG9hZC4KICAgIAkJICogQHJldHVybiB7c3RyaW5nfSBUaGUgcmVzb2x2ZWQgVVJMLgogICAgCQkgKi8KICAgIAkJdGhpcy5yZXNvbHZlVVJMID0gZnVuY3Rpb24gKCB1cmwgKSB7CgogICAgCQkJaWYgKCB1cmxNb2RpZmllciApIHsKCiAgICAJCQkJcmV0dXJuIHVybE1vZGlmaWVyKCB1cmwgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIHVybDsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogSWYgcHJvdmlkZWQsIHRoZSBjYWxsYmFjayB3aWxsIGJlIHBhc3NlZCBlYWNoIHJlc291cmNlIFVSTCBiZWZvcmUgYQogICAgCQkgKiByZXF1ZXN0IGlzIHNlbnQuIFRoZSBjYWxsYmFjayBtYXkgcmV0dXJuIHRoZSBvcmlnaW5hbCBVUkwsIG9yIGEgbmV3IFVSTCB0bwogICAgCQkgKiBvdmVycmlkZSBsb2FkaW5nIGJlaGF2aW9yLiBUaGlzIGJlaGF2aW9yIGNhbiBiZSB1c2VkIHRvIGxvYWQgYXNzZXRzIGZyb20KICAgIAkJICogLlpJUCBmaWxlcywgZHJhZy1hbmQtZHJvcCBBUElzLCBhbmQgRGF0YSBVUklzLgogICAgCQkgKgogICAgCQkgKiBgYGBqcwogICAgCQkgKiBjb25zdCBibG9icyA9IHsnZmlzaC5nbHRmJzogYmxvYjEsICdkaWZmdXNlLnBuZyc6IGJsb2IyLCAnbm9ybWFsLnBuZyc6IGJsb2IzfTsKICAgIAkJICoKICAgIAkJICogY29uc3QgbWFuYWdlciA9IG5ldyBUSFJFRS5Mb2FkaW5nTWFuYWdlcigpOwogICAgCQkgKgogICAgCQkgKiAvLyBJbml0aWFsaXplIGxvYWRpbmcgbWFuYWdlciB3aXRoIFVSTCBjYWxsYmFjay4KICAgIAkJICogY29uc3Qgb2JqZWN0VVJMcyA9IFtdOwogICAgCQkgKiBtYW5hZ2VyLnNldFVSTE1vZGlmaWVyKCAoIHVybCApID0+IHsKICAgIAkJICoKICAgIAkJICogCXVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoIGJsb2JzWyB1cmwgXSApOwogICAgCQkgKiAJb2JqZWN0VVJMcy5wdXNoKCB1cmwgKTsKICAgIAkJICogCXJldHVybiB1cmw7CiAgICAJCSAqCiAgICAJCSAqIH0gKTsKICAgIAkJICoKICAgIAkJICogLy8gTG9hZCBhcyB1c3VhbCwgdGhlbiByZXZva2UgdGhlIGJsb2IgVVJMcy4KICAgIAkJICogY29uc3QgbG9hZGVyID0gbmV3IEdMVEZMb2FkZXIoIG1hbmFnZXIgKTsKICAgIAkJICogbG9hZGVyLmxvYWQoICdmaXNoLmdsdGYnLCAoZ2x0ZikgPT4gewogICAgCQkgKgogICAgCQkgKiAJc2NlbmUuYWRkKCBnbHRmLnNjZW5lICk7CiAgICAJCSAqIAlvYmplY3RVUkxzLmZvckVhY2goICggdXJsICkgPT4gVVJMLnJldm9rZU9iamVjdFVSTCggdXJsICkgKTsKICAgIAkJICoKICAgIAkJICogfSApOwogICAgCQkgKiBgYGAKICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtmdW5jdGlvbihzdHJpbmcpOnN0cmluZ30gdHJhbnNmb3JtIC0gVVJMIG1vZGlmaWVyIGNhbGxiYWNrLiBDYWxsZWQgd2l0aCBhbiBVUkwgYW5kIG11c3QgcmV0dXJuIGEgcmVzb2x2ZWQgVVJMLgogICAgCQkgKiBAcmV0dXJuIHtMb2FkaW5nTWFuYWdlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBsb2FkaW5nIG1hbmFnZXIuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFVSTE1vZGlmaWVyID0gZnVuY3Rpb24gKCB0cmFuc2Zvcm0gKSB7CgogICAgCQkJdXJsTW9kaWZpZXIgPSB0cmFuc2Zvcm07CgogICAgCQkJcmV0dXJuIHRoaXM7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJlZ2lzdGVycyBhIGxvYWRlciB3aXRoIHRoZSBnaXZlbiByZWd1bGFyIGV4cHJlc3Npb24uIENhbiBiZSB1c2VkIHRvCiAgICAJCSAqIGRlZmluZSB3aGF0IGxvYWRlciBzaG91bGQgYmUgdXNlZCBpbiBvcmRlciB0byBsb2FkIHNwZWNpZmljIGZpbGVzLiBBCiAgICAJCSAqIHR5cGljYWwgdXNlIGNhc2UgaXMgdG8gb3ZlcndyaXRlIHRoZSBkZWZhdWx0IGxvYWRlciBmb3IgdGV4dHVyZXMuCiAgICAJCSAqCiAgICAJCSAqIGBgYGpzCiAgICAJCSAqIC8vIGFkZCBoYW5kbGVyIGZvciBUR0EgdGV4dHVyZXMKICAgIAkJICogbWFuYWdlci5hZGRIYW5kbGVyKCAvXC50Z2EkL2ksIG5ldyBUR0FMb2FkZXIoKSApOwogICAgCQkgKiBgYGAKICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtzdHJpbmd9IHJlZ2V4IC0gQSByZWd1bGFyIGV4cHJlc3Npb24uCiAgICAJCSAqIEBwYXJhbSB7TG9hZGVyfSBsb2FkZXIgLSBBIGxvYWRlciB0aGF0IHNob3VsZCBoYW5kbGUgbWF0Y2hlZCBjYXNlcy4KICAgIAkJICogQHJldHVybiB7TG9hZGluZ01hbmFnZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbG9hZGluZyBtYW5hZ2VyLgogICAgCQkgKi8KICAgIAkJdGhpcy5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCwgbG9hZGVyICkgewoKICAgIAkJCWhhbmRsZXJzLnB1c2goIHJlZ2V4LCBsb2FkZXIgKTsKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmVtb3ZlcyB0aGUgbG9hZGVyIGZvciB0aGUgZ2l2ZW4gcmVndWxhciBleHByZXNzaW9uLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge3N0cmluZ30gcmVnZXggLSBBIHJlZ3VsYXIgZXhwcmVzc2lvbi4KICAgIAkJICogQHJldHVybiB7TG9hZGluZ01hbmFnZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbG9hZGluZyBtYW5hZ2VyLgogICAgCQkgKi8KICAgIAkJdGhpcy5yZW1vdmVIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCApIHsKCiAgICAJCQljb25zdCBpbmRleCA9IGhhbmRsZXJzLmluZGV4T2YoIHJlZ2V4ICk7CgogICAgCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgogICAgCQkJCWhhbmRsZXJzLnNwbGljZSggaW5kZXgsIDIgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIHRoaXM7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIENhbiBiZSB1c2VkIHRvIHJldHJpZXZlIHRoZSByZWdpc3RlcmVkIGxvYWRlciBmb3IgdGhlIGdpdmVuIGZpbGUgcGF0aC4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtzdHJpbmd9IGZpbGUgLSBUaGUgZmlsZSBwYXRoLgogICAgCQkgKiBAcmV0dXJuIHs/TG9hZGVyfSBUaGUgcmVnaXN0ZXJlZCBsb2FkZXIuIFJldHVybnMgYG51bGxgIGlmIG5vIGxvYWRlciB3YXMgZm91bmQuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldEhhbmRsZXIgPSBmdW5jdGlvbiAoIGZpbGUgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyICkgewoKICAgIAkJCQljb25zdCByZWdleCA9IGhhbmRsZXJzWyBpIF07CiAgICAJCQkJY29uc3QgbG9hZGVyID0gaGFuZGxlcnNbIGkgKyAxIF07CgogICAgCQkJCWlmICggcmVnZXguZ2xvYmFsICkgcmVnZXgubGFzdEluZGV4ID0gMDsgLy8gc2VlICMxNzkyMAoKICAgIAkJCQlpZiAoIHJlZ2V4LnRlc3QoIGZpbGUgKSApIHsKCiAgICAJCQkJCXJldHVybiBsb2FkZXI7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9OwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhlIGdsb2JhbCBkZWZhdWx0IGxvYWRpbmcgbWFuYWdlci4KICAgICAqCiAgICAgKiBAY29uc3RhbnQKICAgICAqIEB0eXBlIHtMb2FkaW5nTWFuYWdlcn0KICAgICAqLwogICAgY29uc3QgRGVmYXVsdExvYWRpbmdNYW5hZ2VyID0gLypAX19QVVJFX18qLyBuZXcgTG9hZGluZ01hbmFnZXIoKTsKCiAgICAvKioKICAgICAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGxvYWRlcnMuCiAgICAgKgogICAgICogQGFic3RyYWN0CiAgICAgKi8KICAgIGNsYXNzIExvYWRlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgbG9hZGVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtMb2FkaW5nTWFuYWdlcn0gW21hbmFnZXJdIC0gVGhlIGxvYWRpbmcgbWFuYWdlci4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbG9hZGluZyBtYW5hZ2VyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TG9hZGluZ01hbmFnZXJ9CiAgICAJCSAqIEBkZWZhdWx0IERlZmF1bHRMb2FkaW5nTWFuYWdlcgogICAgCQkgKi8KICAgIAkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNyb3NzT3JpZ2luIHN0cmluZyB0byBpbXBsZW1lbnQgQ09SUyBmb3IgbG9hZGluZyB0aGUgdXJsIGZyb20gYQogICAgCQkgKiBkaWZmZXJlbnQgZG9tYWluIHRoYXQgYWxsb3dzIENPUlMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqIEBkZWZhdWx0ICdhbm9ueW1vdXMnCiAgICAJCSAqLwogICAgCQl0aGlzLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0aGUgWE1MSHR0cFJlcXVlc3QgdXNlcyBjcmVkZW50aWFscy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBiYXNlIHBhdGggZnJvbSB3aGljaCB0aGUgYXNzZXQgd2lsbCBiZSBsb2FkZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqLwogICAgCQl0aGlzLnBhdGggPSAnJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgYmFzZSBwYXRoIGZyb20gd2hpY2ggYWRkaXRpb25hbCByZXNvdXJjZXMgbGlrZSB0ZXh0dXJlcyB3aWxsIGJlIGxvYWRlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMucmVzb3VyY2VQYXRoID0gJyc7CgogICAgCQkvKioKICAgIAkJICogVGhlIFtyZXF1ZXN0IGhlYWRlcl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9HbG9zc2FyeS9SZXF1ZXN0X2hlYWRlcn0KICAgIAkJICogdXNlZCBpbiBIVFRQIHJlcXVlc3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLCBhbnk+fQogICAgCQkgKi8KICAgIAkJdGhpcy5yZXF1ZXN0SGVhZGVyID0ge307CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYWxsIGNvbmNyZXRlIGxvYWRlcnMuIEl0IGhvbGRzIHRoZQogICAgCSAqIGxvZ2ljIGZvciBsb2FkaW5nIGFzc2V0cyBmcm9tIHRoZSBiYWNrZW5kLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBwYXRoL1VSTCBvZiB0aGUgZmlsZSB0byBiZSBsb2FkZWQuCiAgICAJICogQHBhcmFtIHtGdW5jdGlvbn0gb25Mb2FkIC0gRXhlY3V0ZWQgd2hlbiB0aGUgbG9hZGluZyBwcm9jZXNzIGhhcyBiZWVuIGZpbmlzaGVkLgogICAgCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlZCB3aGlsZSB0aGUgbG9hZGluZyBpcyBpbiBwcm9ncmVzcy4KICAgIAkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gW29uRXJyb3JdIC0gRXhlY3V0ZWQgd2hlbiBlcnJvcnMgb2NjdXIuCiAgICAJICovCiAgICAJbG9hZCggLyogdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKi8gKSB7fQoKICAgIAkvKioKICAgIAkgKiBBIGFzeW5jIHZlcnNpb24gb2Yge0BsaW5rIExvYWRlciNsb2FkfS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLgogICAgCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlZCB3aGlsZSB0aGUgbG9hZGluZyBpcyBpbiBwcm9ncmVzcy4KICAgIAkgKiBAcmV0dXJuIHtQcm9taXNlfSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBhc3NldCBoYXMgYmVlbiBsb2FkZWQuCiAgICAJICovCiAgICAJbG9hZEFzeW5jKCB1cmwsIG9uUHJvZ3Jlc3MgKSB7CgogICAgCQljb25zdCBzY29wZSA9IHRoaXM7CgogICAgCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKICAgIAkJCXNjb3BlLmxvYWQoIHVybCwgcmVzb2x2ZSwgb25Qcm9ncmVzcywgcmVqZWN0ICk7CgogICAgCQl9ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYWxsIGNvbmNyZXRlIGxvYWRlcnMuIEl0IGhvbGRzIHRoZQogICAgCSAqIGxvZ2ljIGZvciBwYXJzaW5nIHRoZSBhc3NldCBpbnRvIHRocmVlLmpzIGVudGl0aWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHthbnl9IGRhdGEgLSBUaGUgZGF0YSB0byBwYXJzZS4KICAgIAkgKi8KICAgIAlwYXJzZSggLyogZGF0YSAqLyApIHt9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGBjcm9zc09yaWdpbmAgU3RyaW5nIHRvIGltcGxlbWVudCBDT1JTIGZvciBsb2FkaW5nIHRoZSBVUkwKICAgIAkgKiBmcm9tIGEgZGlmZmVyZW50IGRvbWFpbiB0aGF0IGFsbG93cyBDT1JTLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IGNyb3NzT3JpZ2luIC0gVGhlIGBjcm9zc09yaWdpbmAgdmFsdWUuCiAgICAJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldENyb3NzT3JpZ2luKCBjcm9zc09yaWdpbiApIHsKCiAgICAJCXRoaXMuY3Jvc3NPcmlnaW4gPSBjcm9zc09yaWdpbjsKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV2hldGhlciB0aGUgWE1MSHR0cFJlcXVlc3QgdXNlcyBjcmVkZW50aWFscyBzdWNoIGFzIGNvb2tpZXMsIGF1dGhvcml6YXRpb24KICAgIAkgKiBoZWFkZXJzIG9yIFRMUyBjbGllbnQgY2VydGlmaWNhdGVzLCBzZWUgW1hNTEh0dHBSZXF1ZXN0LndpdGhDcmVkZW50aWFsc117QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0L3dpdGhDcmVkZW50aWFsc30uCiAgICAJICoKICAgIAkgKiBOb3RlOiBUaGlzIHNldHRpbmcgaGFzIG5vIGVmZmVjdCBpZiB5b3UgYXJlIGxvYWRpbmcgZmlsZXMgbG9jYWxseSBvciBmcm9tIHRoZSBzYW1lIGRvbWFpbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUgLSBUaGUgYHdpdGhDcmVkZW50aWFsc2AgdmFsdWUuCiAgICAJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFdpdGhDcmVkZW50aWFscyggdmFsdWUgKSB7CgogICAgCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IHZhbHVlOwogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBiYXNlIHBhdGggZm9yIHRoZSBhc3NldC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIGJhc2UgcGF0aC4KICAgIAkgKiBAcmV0dXJuIHtMb2FkZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0UGF0aCggcGF0aCApIHsKCiAgICAJCXRoaXMucGF0aCA9IHBhdGg7CiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGJhc2UgcGF0aCBmb3IgZGVwZW5kZW50IHJlc291cmNlcyBsaWtlIHRleHR1cmVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHJlc291cmNlUGF0aCAtIFRoZSByZXNvdXJjZSBwYXRoLgogICAgCSAqIEByZXR1cm4ge0xvYWRlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRSZXNvdXJjZVBhdGgoIHJlc291cmNlUGF0aCApIHsKCiAgICAJCXRoaXMucmVzb3VyY2VQYXRoID0gcmVzb3VyY2VQYXRoOwogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiByZXF1ZXN0IGhlYWRlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0SGVhZGVyIC0gQSBbcmVxdWVzdCBoZWFkZXJde0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvR2xvc3NhcnkvUmVxdWVzdF9oZWFkZXJ9CiAgICAJICogZm9yIGNvbmZpZ3VyaW5nIHRoZSBIVFRQIHJlcXVlc3QuCiAgICAJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFJlcXVlc3RIZWFkZXIoIHJlcXVlc3RIZWFkZXIgKSB7CgogICAgCQl0aGlzLnJlcXVlc3RIZWFkZXIgPSByZXF1ZXN0SGVhZGVyOwogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENhbGxiYWNrIGZvciBvblByb2dyZXNzIGluIGxvYWRlcnMuCiAgICAgKgogICAgICogQGNhbGxiYWNrIG9uUHJvZ3Jlc3NDYWxsYmFjawogICAgICogQHBhcmFtIHtQcm9ncmVzc0V2ZW50fSBldmVudCAtIEFuIGluc3RhbmNlIG9mIGBQcm9ncmVzc0V2ZW50YCB0aGF0IHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgbG9hZGluZyBzdGF0dXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENhbGxiYWNrIGZvciBvbkVycm9yIGluIGxvYWRlcnMuCiAgICAgKgogICAgICogQGNhbGxiYWNrIG9uRXJyb3JDYWxsYmFjawogICAgICogQHBhcmFtIHtFcnJvcn0gZXJyb3IgLSBUaGUgZXJyb3Igd2hpY2ggb2NjdXJyZWQgZHVyaW5nIHRoZSBsb2FkaW5nIHByb2Nlc3MuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IG1hdGVyaWFsIG5hbWUgdGhhdCBpcyB1c2VkIGJ5IGxvYWRlcnMKICAgICAqIHdoZW4gY3JlYXRpbmcgbWF0ZXJpYWxzIGZvciBsb2FkZWQgM0Qgb2JqZWN0cy4KICAgICAqCiAgICAgKiBOb3RlOiBOb3QgYWxsIGxvYWRlcnMgbWlnaHQgaG9ub3IgdGhpcyBzZXR0aW5nLgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAZGVmYXVsdCAnX19ERUZBVUxUJwogICAgICovCiAgICBMb2FkZXIuREVGQVVMVF9NQVRFUklBTF9OQU1FID0gJ19fREVGQVVMVCc7CgogICAgY29uc3QgX2xvYWRpbmcgPSBuZXcgV2Vha01hcCgpOwoKICAgIC8qKgogICAgICogQSBsb2FkZXIgZm9yIGxvYWRpbmcgaW1hZ2VzLiBUaGUgY2xhc3MgbG9hZHMgaW1hZ2VzIHdpdGggdGhlIEhUTUwgYEltYWdlYCBBUEkuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5JbWFnZUxvYWRlcigpOwogICAgICogY29uc3QgaW1hZ2UgPSBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCAnaW1hZ2UucG5nJyApOwogICAgICogYGBgCiAgICAgKiBQbGVhc2Ugbm90ZSB0aGF0IGBJbWFnZUxvYWRlcmAgaGFzIGRyb3BwZWQgc3VwcG9ydCBmb3IgcHJvZ3Jlc3MKICAgICAqIGV2ZW50cyBpbiBgcjg0YC4gRm9yIGFuIGBJbWFnZUxvYWRlcmAgdGhhdCBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMsIHNlZQogICAgICogW3RoaXMgdGhyZWFkXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8xMDQzOSNpc3N1ZWNvbW1lbnQtMjc1Nzg1NjM5fS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgTG9hZGVyCiAgICAgKi8KICAgIGNsYXNzIEltYWdlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBpbWFnZSBsb2FkZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0xvYWRpbmdNYW5hZ2VyfSBbbWFuYWdlcl0gLSBUaGUgbG9hZGluZyBtYW5hZ2VyLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKICAgIAkJc3VwZXIoIG1hbmFnZXIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdGFydHMgbG9hZGluZyBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIHBhc3NlcyB0aGUgbG9hZGVkIGltYWdlCiAgICAJICogdG8gdGhlIGBvbkxvYWQoKWAgY2FsbGJhY2suIFRoZSBtZXRob2QgYWxzbyByZXR1cm5zIGEgbmV3IGBJbWFnZWAgb2JqZWN0IHdoaWNoIGNhbgogICAgCSAqIGRpcmVjdGx5IGJlIHVzZWQgZm9yIHRleHR1cmUgY3JlYXRpb24uIElmIHlvdSBkbyBpdCB0aGlzIHdheSwgdGhlIHRleHR1cmUKICAgIAkgKiBtYXkgcG9wIHVwIGluIHlvdXIgc2NlbmUgb25jZSB0aGUgcmVzcGVjdGl2ZSBsb2FkaW5nIHByb2Nlc3MgaXMgZmluaXNoZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIHBhdGgvVVJMIG9mIHRoZSBmaWxlIHRvIGJlIGxvYWRlZC4gVGhpcyBjYW4gYWxzbyBiZSBhIGRhdGEgVVJJLgogICAgCSAqIEBwYXJhbSB7ZnVuY3Rpb24oSW1hZ2UpfSBvbkxvYWQgLSBFeGVjdXRlZCB3aGVuIHRoZSBsb2FkaW5nIHByb2Nlc3MgaGFzIGJlZW4gZmluaXNoZWQuCiAgICAJICogQHBhcmFtIHtvblByb2dyZXNzQ2FsbGJhY2t9IG9uUHJvZ3Jlc3MgLSBVbnN1cHBvcnRlZCBpbiB0aGlzIGxvYWRlci4KICAgIAkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gb25FcnJvciAtIEV4ZWN1dGVkIHdoZW4gZXJyb3JzIG9jY3VyLgogICAgCSAqIEByZXR1cm4ge0ltYWdlfSBUaGUgaW1hZ2UuCiAgICAJICovCiAgICAJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgogICAgCQlpZiAoIHRoaXMucGF0aCAhPT0gdW5kZWZpbmVkICkgdXJsID0gdGhpcy5wYXRoICsgdXJsOwoKICAgIAkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKICAgIAkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKICAgIAkJY29uc3QgY2FjaGVkID0gQ2FjaGUuZ2V0KCBgaW1hZ2U6JHt1cmx9YCApOwoKICAgIAkJaWYgKCBjYWNoZWQgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlpZiAoIGNhY2hlZC5jb21wbGV0ZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKICAgIAkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgogICAgCQkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggY2FjaGVkICk7CgogICAgCQkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKICAgIAkJCQl9LCAwICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJbGV0IGFyciA9IF9sb2FkaW5nLmdldCggY2FjaGVkICk7CgogICAgCQkJCWlmICggYXJyID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlhcnIgPSBbXTsKICAgIAkJCQkJX2xvYWRpbmcuc2V0KCBjYWNoZWQsIGFyciApOwoKICAgIAkJCQl9CgogICAgCQkJCWFyci5wdXNoKCB7IG9uTG9hZCwgb25FcnJvciB9ICk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBjYWNoZWQ7CgogICAgCQl9CgogICAgCQljb25zdCBpbWFnZSA9IGNyZWF0ZUVsZW1lbnROUyggJ2ltZycgKTsKCiAgICAJCWZ1bmN0aW9uIG9uSW1hZ2VMb2FkKCkgewoKICAgIAkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgogICAgCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRoaXMgKTsKCiAgICAJCQkvLwoKICAgIAkJCWNvbnN0IGNhbGxiYWNrcyA9IF9sb2FkaW5nLmdldCggdGhpcyApIHx8IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CiAgICAJCQkJaWYgKCBjYWxsYmFjay5vbkxvYWQgKSBjYWxsYmFjay5vbkxvYWQoIHRoaXMgKTsKCiAgICAJCQl9CgogICAgCQkJX2xvYWRpbmcuZGVsZXRlKCB0aGlzICk7CgogICAgCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIG9uSW1hZ2VFcnJvciggZXZlbnQgKSB7CgogICAgCQkJcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKCiAgICAJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBldmVudCApOwoKICAgIAkJCUNhY2hlLnJlbW92ZSggYGltYWdlOiR7dXJsfWAgKTsKCiAgICAJCQkvLwoKICAgIAkJCWNvbnN0IGNhbGxiYWNrcyA9IF9sb2FkaW5nLmdldCggdGhpcyApIHx8IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CiAgICAJCQkJaWYgKCBjYWxsYmFjay5vbkVycm9yICkgY2FsbGJhY2sub25FcnJvciggZXZlbnQgKTsKCiAgICAJCQl9CgogICAgCQkJX2xvYWRpbmcuZGVsZXRlKCB0aGlzICk7CgoKICAgIAkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKICAgIAkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycygpIHsKCiAgICAJCQlpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnbG9hZCcsIG9uSW1hZ2VMb2FkLCBmYWxzZSApOwogICAgCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKICAgIAkJfQoKICAgIAkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKICAgIAkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKICAgIAkJaWYgKCB1cmwuc2xpY2UoIDAsIDUgKSAhPT0gJ2RhdGE6JyApIHsKCiAgICAJCQlpZiAoIHRoaXMuY3Jvc3NPcmlnaW4gIT09IHVuZGVmaW5lZCApIGltYWdlLmNyb3NzT3JpZ2luID0gdGhpcy5jcm9zc09yaWdpbjsKCiAgICAJCX0KCiAgICAJCUNhY2hlLmFkZCggYGltYWdlOiR7dXJsfWAsIGltYWdlICk7CiAgICAJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCiAgICAJCWltYWdlLnNyYyA9IHVybDsKCiAgICAJCXJldHVybiBpbWFnZTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENsYXNzIGZvciBsb2FkaW5nIHRleHR1cmVzLiBJbWFnZXMgYXJlIGludGVybmFsbHkKICAgICAqIGxvYWRlZCB2aWEge0BsaW5rIEltYWdlTG9hZGVyfS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKTsKICAgICAqIGNvbnN0IHRleHR1cmUgPSBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCAndGV4dHVyZXMvbGFuZF9vY2Vhbl9pY2VfY2xvdWRfMjA0OC5qcGcnICk7CiAgICAgKgogICAgICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgbWFwOnRleHR1cmUgfSApOwogICAgICogYGBgCiAgICAgKiBQbGVhc2Ugbm90ZSB0aGF0IGBUZXh0dXJlTG9hZGVyYCBoYXMgZHJvcHBlZCBzdXBwb3J0IGZvciBwcm9ncmVzcwogICAgICogZXZlbnRzIGluIGByODRgLiBGb3IgYSBgVGV4dHVyZUxvYWRlcmAgdGhhdCBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMsIHNlZQogICAgICogW3RoaXMgdGhyZWFkXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8xMDQzOSNpc3N1ZWNvbW1lbnQtMjkzMjYwMTQ1fS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgTG9hZGVyCiAgICAgKi8KICAgIGNsYXNzIFRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRleHR1cmUgbG9hZGVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtMb2FkaW5nTWFuYWdlcn0gW21hbmFnZXJdIC0gVGhlIGxvYWRpbmcgbWFuYWdlci4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCiAgICAJCXN1cGVyKCBtYW5hZ2VyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3RhcnRzIGxvYWRpbmcgZnJvbSB0aGUgZ2l2ZW4gVVJMIGFuZCBwYXNzIHRoZSBmdWxseSBsb2FkZWQgdGV4dHVyZQogICAgCSAqIHRvIHRoZSBgb25Mb2FkKClgIGNhbGxiYWNrLiBUaGUgbWV0aG9kIGFsc28gcmV0dXJucyBhIG5ldyB0ZXh0dXJlIG9iamVjdCB3aGljaCBjYW4KICAgIAkgKiBkaXJlY3RseSBiZSB1c2VkIGZvciBtYXRlcmlhbCBjcmVhdGlvbi4gSWYgeW91IGRvIGl0IHRoaXMgd2F5LCB0aGUgdGV4dHVyZQogICAgCSAqIG1heSBwb3AgdXAgaW4geW91ciBzY2VuZSBvbmNlIHRoZSByZXNwZWN0aXZlIGxvYWRpbmcgcHJvY2VzcyBpcyBmaW5pc2hlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLiBUaGlzIGNhbiBhbHNvIGJlIGEgZGF0YSBVUkkuCiAgICAJICogQHBhcmFtIHtmdW5jdGlvbihUZXh0dXJlKX0gb25Mb2FkIC0gRXhlY3V0ZWQgd2hlbiB0aGUgbG9hZGluZyBwcm9jZXNzIGhhcyBiZWVuIGZpbmlzaGVkLgogICAgCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBvblByb2dyZXNzIC0gVW5zdXBwb3J0ZWQgaW4gdGhpcyBsb2FkZXIuCiAgICAJICogQHBhcmFtIHtvbkVycm9yQ2FsbGJhY2t9IG9uRXJyb3IgLSBFeGVjdXRlZCB3aGVuIGVycm9ycyBvY2N1ci4KICAgIAkgKiBAcmV0dXJuIHtUZXh0dXJlfSBUaGUgdGV4dHVyZS4KICAgIAkgKi8KICAgIAlsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCiAgICAJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKICAgIAkJY29uc3QgbG9hZGVyID0gbmV3IEltYWdlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKICAgIAkJbG9hZGVyLnNldENyb3NzT3JpZ2luKCB0aGlzLmNyb3NzT3JpZ2luICk7CiAgICAJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCiAgICAJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggaW1hZ2UgKSB7CgogICAgCQkJdGV4dHVyZS5pbWFnZSA9IGltYWdlOwogICAgCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJb25Mb2FkKCB0ZXh0dXJlICk7CgogICAgCQkJfQoKICAgIAkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKICAgIAkJcmV0dXJuIHRleHR1cmU7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDYW1lcmEgdGhhdCB1c2VzIFtvcnRob2dyYXBoaWMgcHJvamVjdGlvbl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvT3J0aG9ncmFwaGljX3Byb2plY3Rpb259LgogICAgICoKICAgICAqIEluIHRoaXMgcHJvamVjdGlvbiBtb2RlLCBhbiBvYmplY3QncyBzaXplIGluIHRoZSByZW5kZXJlZCBpbWFnZSBzdGF5cwogICAgICogY29uc3RhbnQgcmVnYXJkbGVzcyBvZiBpdHMgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhLiBUaGlzIGNhbiBiZSB1c2VmdWwKICAgICAqIGZvciByZW5kZXJpbmcgMkQgc2NlbmVzIGFuZCBVSSBlbGVtZW50cywgYW1vbmdzdCBvdGhlciB0aGluZ3MuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGNhbWVyYSA9IG5ldyBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEoIHdpZHRoIC8gLSAyLCB3aWR0aCAvIDIsIGhlaWdodCAvIDIsIGhlaWdodCAvIC0gMiwgMSwgMTAwMCApOwogICAgICogc2NlbmUuYWRkKCBjYW1lcmEgKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBDYW1lcmEKICAgICAqLwogICAgY2xhc3MgT3J0aG9ncmFwaGljQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBvcnRob2dyYXBoaWMgY2FtZXJhLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtsZWZ0PS0xXSAtIFRoZSBsZWZ0IHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbcmlnaHQ9MV0gLSBUaGUgcmlnaHQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt0b3A9MV0gLSBUaGUgdG9wIHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbYm90dG9tPS0xXSAtIFRoZSBib3R0b20gcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuZWFyPTAuMV0gLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2Zhcj0yMDAwXSAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGxlZnQgPSAtMSwgcmlnaHQgPSAxLCB0b3AgPSAxLCBib3R0b20gPSAtMSwgbmVhciA9IDAuMSwgZmFyID0gMjAwMCApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnT3J0aG9ncmFwaGljQ2FtZXJhJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgem9vbSBmYWN0b3Igb2YgdGhlIGNhbWVyYS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy56b29tID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXByZXNlbnRzIHRoZSBmcnVzdHVtIHdpbmRvdyBzcGVjaWZpY2F0aW9uLiBUaGlzIHByb3BlcnR5IHNob3VsZCBub3QgYmUgZWRpdGVkCiAgICAJCSAqIGRpcmVjdGx5IGJ1dCB2aWEge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI3NldFZpZXdPZmZzZXR9IGFuZCB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjY2xlYXJWaWV3T2Zmc2V0fS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9PYmplY3R9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMudmlldyA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGxlZnQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IC0xCiAgICAJCSAqLwogICAgCQl0aGlzLmxlZnQgPSBsZWZ0OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSByaWdodCBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5yaWdodCA9IHJpZ2h0OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB0b3AgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMudG9wID0gdG9wOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBib3R0b20gcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IC0xCiAgICAJCSAqLwogICAgCQl0aGlzLmJvdHRvbSA9IGJvdHRvbTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4gVGhlIHZhbGlkIHJhbmdlIGlzIGdyZWF0ZXIgdGhhbiBgMGAKICAgIAkJICogYW5kIGxlc3MgdGhhbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhI2Zhcn0uCiAgICAJCSAqCiAgICAJCSAqIE5vdGUgdGhhdCwgdW5saWtlIGZvciB0aGUge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhfSwgYDBgIGlzIGEKICAgIAkJICogdmFsaWQgdmFsdWUgZm9yIGFuIG9ydGhvZ3JhcGhpYyBjYW1lcmEncyBuZWFyIHBsYW5lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwLjEKICAgIAkJICovCiAgICAJCXRoaXMubmVhciA9IG5lYXI7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4gTXVzdCBiZSBncmVhdGVyIHRoYW4gdGhlCiAgICAJCSAqIGN1cnJlbnQgdmFsdWUgb2Yge0BsaW5rIE9ydGhvZ3JhcGhpY0NhbWVyYSNuZWFyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMjAwMAogICAgCQkgKi8KICAgIAkJdGhpcy5mYXIgPSBmYXI7CgogICAgCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgogICAgCQl0aGlzLmxlZnQgPSBzb3VyY2UubGVmdDsKICAgIAkJdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDsKICAgIAkJdGhpcy50b3AgPSBzb3VyY2UudG9wOwogICAgCQl0aGlzLmJvdHRvbSA9IHNvdXJjZS5ib3R0b207CiAgICAJCXRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwogICAgCQl0aGlzLmZhciA9IHNvdXJjZS5mYXI7CgogICAgCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKICAgIAkJdGhpcy52aWV3ID0gc291cmNlLnZpZXcgPT09IG51bGwgPyBudWxsIDogT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS52aWV3ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIGFuIG9mZnNldCBpbiBhIGxhcmdlciBmcnVzdHVtLiBUaGlzIGlzIHVzZWZ1bCBmb3IgbXVsdGktd2luZG93IG9yCiAgICAJICogbXVsdGktbW9uaXRvci9tdWx0aS1tYWNoaW5lIHNldHVwcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsV2lkdGggLSBUaGUgZnVsbCB3aWR0aCBvZiBtdWx0aXZpZXcgc2V0dXAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxIZWlnaHQgLSBUaGUgZnVsbCBoZWlnaHQgb2YgbXVsdGl2aWV3IHNldHVwLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGhvcml6b250YWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHN1YmNhbWVyYS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiBzdWJjYW1lcmEuCiAgICAJICogQHNlZSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0KICAgIAkgKi8KICAgIAlzZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgogICAgCQlpZiAoIHRoaXMudmlldyA9PT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLnZpZXcgPSB7CiAgICAJCQkJZW5hYmxlZDogdHJ1ZSwKICAgIAkJCQlmdWxsV2lkdGg6IDEsCiAgICAJCQkJZnVsbEhlaWdodDogMSwKICAgIAkJCQlvZmZzZXRYOiAwLAogICAgCQkJCW9mZnNldFk6IDAsCiAgICAJCQkJd2lkdGg6IDEsCiAgICAJCQkJaGVpZ2h0OiAxCiAgICAJCQl9OwoKICAgIAkJfQoKICAgIAkJdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwogICAgCQl0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwogICAgCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CiAgICAJCXRoaXMudmlldy5vZmZzZXRYID0geDsKICAgIAkJdGhpcy52aWV3Lm9mZnNldFkgPSB5OwogICAgCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKICAgIAkJdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKCiAgICAJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlbW92ZXMgdGhlIHZpZXcgb2Zmc2V0IGZyb20gdGhlIHByb2plY3Rpb24gbWF0cml4LgogICAgCSAqLwogICAgCWNsZWFyVmlld09mZnNldCgpIHsKCiAgICAJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgogICAgCQl9CgogICAgCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBVcGRhdGVzIHRoZSBjYW1lcmEncyBwcm9qZWN0aW9uIG1hdHJpeC4gTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYW55IGNoYW5nZSBvZgogICAgCSAqIGNhbWVyYSBwcm9wZXJ0aWVzLgogICAgCSAqLwogICAgCXVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKSB7CgogICAgCQljb25zdCBkeCA9ICggdGhpcy5yaWdodCAtIHRoaXMubGVmdCApIC8gKCAyICogdGhpcy56b29tICk7CiAgICAJCWNvbnN0IGR5ID0gKCB0aGlzLnRvcCAtIHRoaXMuYm90dG9tICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKICAgIAkJY29uc3QgY3ggPSAoIHRoaXMucmlnaHQgKyB0aGlzLmxlZnQgKSAvIDI7CiAgICAJCWNvbnN0IGN5ID0gKCB0aGlzLnRvcCArIHRoaXMuYm90dG9tICkgLyAyOwoKICAgIAkJbGV0IGxlZnQgPSBjeCAtIGR4OwogICAgCQlsZXQgcmlnaHQgPSBjeCArIGR4OwogICAgCQlsZXQgdG9wID0gY3kgKyBkeTsKICAgIAkJbGV0IGJvdHRvbSA9IGN5IC0gZHk7CgogICAgCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCiAgICAJCQljb25zdCBzY2FsZVcgPSAoIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQgKSAvIHRoaXMudmlldy5mdWxsV2lkdGggLyB0aGlzLnpvb207CiAgICAJCQljb25zdCBzY2FsZUggPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvIHRoaXMudmlldy5mdWxsSGVpZ2h0IC8gdGhpcy56b29tOwoKICAgIAkJCWxlZnQgKz0gc2NhbGVXICogdGhpcy52aWV3Lm9mZnNldFg7CiAgICAJCQlyaWdodCA9IGxlZnQgKyBzY2FsZVcgKiB0aGlzLnZpZXcud2lkdGg7CiAgICAJCQl0b3AgLT0gc2NhbGVIICogdGhpcy52aWV3Lm9mZnNldFk7CiAgICAJCQlib3R0b20gPSB0b3AgLSBzY2FsZUggKiB0aGlzLnZpZXcuaGVpZ2h0OwoKICAgIAkJfQoKICAgIAkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VPcnRob2dyYXBoaWMoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgdGhpcy5uZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgogICAgCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKICAgIAl9CgogICAgCXRvSlNPTiggbWV0YSApIHsKCiAgICAJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCiAgICAJCWRhdGEub2JqZWN0Lnpvb20gPSB0aGlzLnpvb207CiAgICAJCWRhdGEub2JqZWN0LmxlZnQgPSB0aGlzLmxlZnQ7CiAgICAJCWRhdGEub2JqZWN0LnJpZ2h0ID0gdGhpcy5yaWdodDsKICAgIAkJZGF0YS5vYmplY3QudG9wID0gdGhpcy50b3A7CiAgICAJCWRhdGEub2JqZWN0LmJvdHRvbSA9IHRoaXMuYm90dG9tOwogICAgCQlkYXRhLm9iamVjdC5uZWFyID0gdGhpcy5uZWFyOwogICAgCQlkYXRhLm9iamVjdC5mYXIgPSB0aGlzLmZhcjsKCiAgICAJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgZGF0YS5vYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCB0aGlzLnZpZXcgKTsKCiAgICAJCXJldHVybiBkYXRhOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB0eXBlIG9mIGNhbWVyYSBjYW4gYmUgdXNlZCBpbiBvcmRlciB0byBlZmZpY2llbnRseSByZW5kZXIgYSBzY2VuZSB3aXRoIGEKICAgICAqIHByZWRlZmluZWQgc2V0IG9mIGNhbWVyYXMuIFRoaXMgaXMgYW4gaW1wb3J0YW50IHBlcmZvcm1hbmNlIGFzcGVjdCBmb3IKICAgICAqIHJlbmRlcmluZyBWUiBzY2VuZXMuCiAgICAgKgogICAgICogQW4gaW5zdGFuY2Ugb2YgYEFycmF5Q2FtZXJhYCBhbHdheXMgaGFzIGFuIGFycmF5IG9mIHN1YiBjYW1lcmFzLiBJdCdzIG1hbmRhdG9yeQogICAgICogdG8gZGVmaW5lIGZvciBlYWNoIHN1YiBjYW1lcmEgdGhlIGB2aWV3cG9ydGAgcHJvcGVydHkgd2hpY2ggZGV0ZXJtaW5lcyB0aGUKICAgICAqIHBhcnQgb2YgdGhlIHZpZXdwb3J0IHRoYXQgaXMgcmVuZGVyZWQgd2l0aCB0aGlzIGNhbWVyYS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgUGVyc3BlY3RpdmVDYW1lcmEKICAgICAqLwogICAgY2xhc3MgQXJyYXlDYW1lcmEgZXh0ZW5kcyBQZXJzcGVjdGl2ZUNhbWVyYSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgYXJyYXkgY2FtZXJhLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxQZXJzcGVjdGl2ZUNhbWVyYT59IFthcnJheT1bXV0gLSBBbiBhcnJheSBvZiBwZXJzcGVjdGl2ZSBzdWIgY2FtZXJhcy4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggYXJyYXkgPSBbXSApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0FycmF5Q2FtZXJhID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRoaXMgY2FtZXJhIGlzIHVzZWQgd2l0aCBtdWx0aXZpZXcgcmVuZGVyaW5nIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc011bHRpVmlld0NhbWVyYSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIEFuIGFycmF5IG9mIHBlcnNwZWN0aXZlIHN1YiBjYW1lcmFzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8UGVyc3BlY3RpdmVDYW1lcmE+fQogICAgCQkgKi8KICAgIAkJdGhpcy5jYW1lcmFzID0gYXJyYXk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBEZXRlcm1pbmVzIGhvdyBtYW55IGJ5dGVzIG11c3QgYmUgdXNlZCB0byByZXByZXNlbnQgdGhlIHRleHR1cmUuCiAgICAgKgogICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgogICAgICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHRleHR1cmUuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gZm9ybWF0IC0gVGhlIHRleHR1cmUncyBmb3JtYXQuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdHlwZSAtIFRoZSB0ZXh0dXJlJ3MgdHlwZS4KICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIGJ5dGUgbGVuZ3RoLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRCeXRlTGVuZ3RoKCB3aWR0aCwgaGVpZ2h0LCBmb3JtYXQsIHR5cGUgKSB7CgogICAgCWNvbnN0IHR5cGVCeXRlTGVuZ3RoID0gZ2V0VGV4dHVyZVR5cGVCeXRlTGVuZ3RoKCB0eXBlICk7CgogICAgCXN3aXRjaCAoIGZvcm1hdCApIHsKCiAgICAJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvT3BlbkdMLVJlZnBhZ2VzL2VzMy4wL2h0bWwvZ2xUZXhJbWFnZTJELnhodG1sCiAgICAJCWNhc2UgQWxwaGFGb3JtYXQ6CiAgICAJCQlyZXR1cm4gd2lkdGggKiBoZWlnaHQ7CiAgICAJCWNhc2UgUmVkRm9ybWF0OgogICAgCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKICAgIAkJY2FzZSBSZWRJbnRlZ2VyRm9ybWF0OgogICAgCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKICAgIAkJY2FzZSBSR0Zvcm1hdDoKICAgIAkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAyICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwogICAgCQljYXNlIFJHSW50ZWdlckZvcm1hdDoKICAgIAkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAyICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwogICAgCQljYXNlIFJHQkZvcm1hdDoKICAgIAkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAzICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwogICAgCQljYXNlIFJHQkFGb3JtYXQ6CiAgICAJCQlyZXR1cm4gKCAoIHdpZHRoICogaGVpZ2h0ICogNCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKICAgIAkJY2FzZSBSR0JBSW50ZWdlckZvcm1hdDoKICAgIAkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiA0ICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2IvCiAgICAJCWNhc2UgUkdCX1MzVENfRFhUMV9Gb3JtYXQ6CiAgICAJCWNhc2UgUkdCQV9TM1RDX0RYVDFfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDg7CiAgICAJCWNhc2UgUkdCQV9TM1RDX0RYVDNfRm9ybWF0OgogICAgCQljYXNlIFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMyApIC8gNCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAzICkgLyA0ICkgKiAxNjsKCiAgICAJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvd2ViZ2wvZXh0ZW5zaW9ucy9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMvCiAgICAJCWNhc2UgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQ6CiAgICAJCWNhc2UgUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0OgogICAgCQkJcmV0dXJuICggTWF0aC5tYXgoIHdpZHRoLCAxNiApICogTWF0aC5tYXgoIGhlaWdodCwgOCApICkgLyA0OwogICAgCQljYXNlIFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0OgogICAgCQljYXNlIFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdDoKICAgIAkJCXJldHVybiAoIE1hdGgubWF4KCB3aWR0aCwgOCApICogTWF0aC5tYXgoIGhlaWdodCwgOCApICkgLyAyOwoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMvCiAgICAJCWNhc2UgUkdCX0VUQzFfRm9ybWF0OgogICAgCQljYXNlIFJHQl9FVEMyX0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMyApIC8gNCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAzICkgLyA0ICkgKiA4OwogICAgCQljYXNlIFJHQkFfRVRDMl9FQUNfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjLwogICAgCQljYXNlIFJHQkFfQVNUQ180eDRfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ181eDRfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA0ICkgLyA1ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ181eDVfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA0ICkgLyA1ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ182eDVfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA1ICkgLyA2ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ182eDZfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA1ICkgLyA2ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ184eDVfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ184eDZfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ184eDhfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDcgKSAvIDggKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ18xMHg1X0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgOSApIC8gMTAgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNCApIC8gNSApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzEweDZfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA5ICkgLyAxMCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyA1ICkgLyA2ICkgKiAxNjsKICAgIAkJY2FzZSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDcgKSAvIDggKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDkgKSAvIDEwICkgKiAxNjsKICAgIAkJY2FzZSBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAxMSApIC8gMTIgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgOSApIC8gMTAgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDExICkgLyAxMiApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAxMSApIC8gMTIgKSAqIDE2OwoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL0VYVF90ZXh0dXJlX2NvbXByZXNzaW9uX2JwdGMvCiAgICAJCWNhc2UgUkdCQV9CUFRDX0Zvcm1hdDoKICAgIAkJY2FzZSBSR0JfQlBUQ19TSUdORURfRm9ybWF0OgogICAgCQljYXNlIFJHQl9CUFRDX1VOU0lHTkVEX0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmNlaWwoIHdpZHRoIC8gNCApICogTWF0aC5jZWlsKCBoZWlnaHQgLyA0ICkgKiAxNjsKCiAgICAJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvd2ViZ2wvZXh0ZW5zaW9ucy9FWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9yZ3RjLwogICAgCQljYXNlIFJFRF9SR1RDMV9Gb3JtYXQ6CiAgICAJCWNhc2UgU0lHTkVEX1JFRF9SR1RDMV9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5jZWlsKCB3aWR0aCAvIDQgKSAqIE1hdGguY2VpbCggaGVpZ2h0IC8gNCApICogODsKICAgIAkJY2FzZSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0OgogICAgCQljYXNlIFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguY2VpbCggd2lkdGggLyA0ICkgKiBNYXRoLmNlaWwoIGhlaWdodCAvIDQgKSAqIDE2OwoKICAgIAl9CgogICAgCXRocm93IG5ldyBFcnJvcigKICAgIAkJYFVuYWJsZSB0byBkZXRlcm1pbmUgdGV4dHVyZSBieXRlIGxlbmd0aCBmb3IgJHtmb3JtYXR9IGZvcm1hdC5gLAogICAgCSk7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRleHR1cmVUeXBlQnl0ZUxlbmd0aCggdHlwZSApIHsKCiAgICAJc3dpdGNoICggdHlwZSApIHsKCiAgICAJCWNhc2UgVW5zaWduZWRCeXRlVHlwZToKICAgIAkJY2FzZSBCeXRlVHlwZToKICAgIAkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDEsIGNvbXBvbmVudHM6IDEgfTsKICAgIAkJY2FzZSBVbnNpZ25lZFNob3J0VHlwZToKICAgIAkJY2FzZSBTaG9ydFR5cGU6CiAgICAJCWNhc2UgSGFsZkZsb2F0VHlwZToKICAgIAkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDIsIGNvbXBvbmVudHM6IDEgfTsKICAgIAkJY2FzZSBVbnNpZ25lZFNob3J0NDQ0NFR5cGU6CiAgICAJCWNhc2UgVW5zaWduZWRTaG9ydDU1NTFUeXBlOgogICAgCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogMiwgY29tcG9uZW50czogNCB9OwogICAgCQljYXNlIFVuc2lnbmVkSW50VHlwZToKICAgIAkJY2FzZSBJbnRUeXBlOgogICAgCQljYXNlIEZsb2F0VHlwZToKICAgIAkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDQsIGNvbXBvbmVudHM6IDEgfTsKICAgIAkJY2FzZSBVbnNpZ25lZEludDU5OTlUeXBlOgogICAgCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogNCwgY29tcG9uZW50czogMyB9OwoKICAgIAl9CgogICAgCXRocm93IG5ldyBFcnJvciggYFVua25vd24gdGV4dHVyZSB0eXBlICR7dHlwZX0uYCApOwoKICAgIH0KCiAgICBpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKICAgIAlfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudCggbmV3IEN1c3RvbUV2ZW50KCAncmVnaXN0ZXInLCB7IGRldGFpbDogewogICAgCQlyZXZpc2lvbjogUkVWSVNJT04sCiAgICAJfSB9ICkgKTsKCiAgICB9CgogICAgaWYgKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyApIHsKCiAgICAJaWYgKCB3aW5kb3cuX19USFJFRV9fICkgewoKICAgIAkJY29uc29sZS53YXJuKCAnV0FSTklORzogTXVsdGlwbGUgaW5zdGFuY2VzIG9mIFRocmVlLmpzIGJlaW5nIGltcG9ydGVkLicgKTsKCiAgICAJfSBlbHNlIHsKCiAgICAJCXdpbmRvdy5fX1RIUkVFX18gPSBSRVZJU0lPTjsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIEBsaWNlbnNlCiAgICAgKiBDb3B5cmlnaHQgMjAxMC0yMDI1IFRocmVlLmpzIEF1dGhvcnMKICAgICAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKICAgICAqLwoKICAgIGZ1bmN0aW9uIFdlYkdMQW5pbWF0aW9uKCkgewoKICAgIAlsZXQgY29udGV4dCA9IG51bGw7CiAgICAJbGV0IGlzQW5pbWF0aW5nID0gZmFsc2U7CiAgICAJbGV0IGFuaW1hdGlvbkxvb3AgPSBudWxsOwogICAgCWxldCByZXF1ZXN0SWQgPSBudWxsOwoKICAgIAlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lLCBmcmFtZSApIHsKCiAgICAJCWFuaW1hdGlvbkxvb3AoIHRpbWUsIGZyYW1lICk7CgogICAgCQlyZXF1ZXN0SWQgPSBjb250ZXh0LnJlcXVlc3RBbmltYXRpb25GcmFtZSggb25BbmltYXRpb25GcmFtZSApOwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQlzdGFydDogZnVuY3Rpb24gKCkgewoKICAgIAkJCWlmICggaXNBbmltYXRpbmcgPT09IHRydWUgKSByZXR1cm47CiAgICAJCQlpZiAoIGFuaW1hdGlvbkxvb3AgPT09IG51bGwgKSByZXR1cm47CgogICAgCQkJcmVxdWVzdElkID0gY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCiAgICAJCQlpc0FuaW1hdGluZyA9IHRydWU7CgogICAgCQl9LAoKICAgIAkJc3RvcDogZnVuY3Rpb24gKCkgewoKICAgIAkJCWNvbnRleHQuY2FuY2VsQW5pbWF0aW9uRnJhbWUoIHJlcXVlc3RJZCApOwoKICAgIAkJCWlzQW5pbWF0aW5nID0gZmFsc2U7CgogICAgCQl9LAoKICAgIAkJc2V0QW5pbWF0aW9uTG9vcDogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCiAgICAJCQlhbmltYXRpb25Mb29wID0gY2FsbGJhY2s7CgogICAgCQl9LAoKICAgIAkJc2V0Q29udGV4dDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCiAgICAJCQljb250ZXh0ID0gdmFsdWU7CgogICAgCQl9CgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMQXR0cmlidXRlcyggZ2wgKSB7CgogICAgCWNvbnN0IGJ1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlmdW5jdGlvbiBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApIHsKCiAgICAJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwogICAgCQljb25zdCB1c2FnZSA9IGF0dHJpYnV0ZS51c2FnZTsKICAgIAkJY29uc3Qgc2l6ZSA9IGFycmF5LmJ5dGVMZW5ndGg7CgogICAgCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCiAgICAJCWdsLmJpbmRCdWZmZXIoIGJ1ZmZlclR5cGUsIGJ1ZmZlciApOwogICAgCQlnbC5idWZmZXJEYXRhKCBidWZmZXJUeXBlLCBhcnJheSwgdXNhZ2UgKTsKCiAgICAJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgogICAgCQlsZXQgdHlwZTsKCiAgICAJCWlmICggYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgKSB7CgogICAgCQkJdHlwZSA9IGdsLkZMT0FUOwoKICAgIAkJfSBlbHNlIGlmICggdHlwZW9mIEZsb2F0MTZBcnJheSAhPT0gJ3VuZGVmaW5lZCcgJiYgYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDE2QXJyYXkgKSB7CgogICAgCQkJdHlwZSA9IGdsLkhBTEZfRkxPQVQ7CgogICAgCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5ICkgewoKICAgIAkJCWlmICggYXR0cmlidXRlLmlzRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQkJdHlwZSA9IGdsLkhBTEZfRkxPQVQ7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50MTZBcnJheSApIHsKCiAgICAJCQl0eXBlID0gZ2wuU0hPUlQ7CgogICAgCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQzMkFycmF5ICkgewoKICAgIAkJCXR5cGUgPSBnbC5VTlNJR05FRF9JTlQ7CgogICAgCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkgKSB7CgogICAgCQkJdHlwZSA9IGdsLklOVDsKCiAgICAJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50OEFycmF5ICkgewoKICAgIAkJCXR5cGUgPSBnbC5CWVRFOwoKICAgIAkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OEFycmF5ICkgewoKICAgIAkJCXR5cGUgPSBnbC5VTlNJR05FRF9CWVRFOwoKICAgIAkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSApIHsKCiAgICAJCQl0eXBlID0gZ2wuVU5TSUdORURfQllURTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVbnN1cHBvcnRlZCBidWZmZXIgZGF0YSBmb3JtYXQ6ICcgKyBhcnJheSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHsKICAgIAkJCWJ1ZmZlcjogYnVmZmVyLAogICAgCQkJdHlwZTogdHlwZSwKICAgIAkJCWJ5dGVzUGVyRWxlbWVudDogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCiAgICAJCQl2ZXJzaW9uOiBhdHRyaWJ1dGUudmVyc2lvbiwKICAgIAkJCXNpemU6IHNpemUKICAgIAkJfTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1cGRhdGVCdWZmZXIoIGJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKICAgIAkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CiAgICAJCWNvbnN0IHVwZGF0ZVJhbmdlcyA9IGF0dHJpYnV0ZS51cGRhdGVSYW5nZXM7CgogICAgCQlnbC5iaW5kQnVmZmVyKCBidWZmZXJUeXBlLCBidWZmZXIgKTsKCiAgICAJCWlmICggdXBkYXRlUmFuZ2VzLmxlbmd0aCA9PT0gMCApIHsKCiAgICAJCQkvLyBOb3QgdXNpbmcgdXBkYXRlIHJhbmdlcwogICAgCQkJZ2wuYnVmZmVyU3ViRGF0YSggYnVmZmVyVHlwZSwgMCwgYXJyYXkgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJLy8gQmVmb3JlIGFwcGx5aW5nIHVwZGF0ZSByYW5nZXMsIHdlIG1lcmdlIGFueSBhZGphY2VudCAvIG92ZXJsYXBwaW5nCiAgICAJCQkvLyByYW5nZXMgdG8gcmVkdWNlIGxvYWQgb24gYGdsLmJ1ZmZlclN1YkRhdGFgLiBFbXBpcmljYWxseSwgdGhpcyBoYXMgbGVkCiAgICAJCQkvLyB0byBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBtYWtlIGhlYXZ5IHVzZSBvZgogICAgCQkJLy8gdXBkYXRlIHJhbmdlcy4gTGlrZWx5IGR1ZSB0byBHUFUgY29tbWFuZCBvdmVyaGVhZC4KICAgIAkJCS8vCiAgICAJCQkvLyBOb3RlIHRoYXQgdG8gcmVkdWNlIGdhcmJhZ2UgY29sbGVjdGlvbiBiZXR3ZWVuIGZyYW1lcywgd2UgbWVyZ2UgdGhlCiAgICAJCQkvLyB1cGRhdGUgcmFuZ2VzIGluLXBsYWNlLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB0aGlzIG1ldGhvZCB3aWxsIGNsZWFyIHRoZQogICAgCQkJLy8gdXBkYXRlIHJhbmdlcyBvbmNlIHVwZGF0ZWQuCgogICAgCQkJdXBkYXRlUmFuZ2VzLnNvcnQoICggYSwgYiApID0+IGEuc3RhcnQgLSBiLnN0YXJ0ICk7CgogICAgCQkJLy8gVG8gbWVyZ2UgdGhlIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UsIHdlIHdvcmsgZnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZQogICAgCQkJLy8gZXhpc3RpbmcgdXBkYXRlUmFuZ2VzIGFycmF5LCBtZXJnaW5nIHJhbmdlcy4gVGhpcyBtYXkgcmVzdWx0IGluIGEgZmluYWwKICAgIAkJCS8vIGFycmF5IHdoaWNoIGlzIHNtYWxsZXIgdGhhbiB0aGUgb3JpZ2luYWwuIFRoaXMgaW5kZXggdHJhY2tzIHRoZSBsYXN0CiAgICAJCQkvLyBpbmRleCByZXByZXNlbnRpbmcgYSBtZXJnZWQgcmFuZ2UsIGFueSBkYXRhIGFmdGVyIHRoaXMgaW5kZXggY2FuIGJlCiAgICAJCQkvLyB0cmltbWVkIG9uY2UgdGhlIG1lcmdlIGFsZ29yaXRobSBpcyBjb21wbGV0ZWQuCiAgICAJCQlsZXQgbWVyZ2VJbmRleCA9IDA7CgogICAgCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgcHJldmlvdXNSYW5nZSA9IHVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdOwogICAgCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgogICAgCQkJCS8vIFdlIGFkZCBvbmUgaGVyZSB0byBtZXJnZSBhZGphY2VudCByYW5nZXMuIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHJhbmdlcwogICAgCQkJCS8vIG9wZXJhdGUgb3ZlciBwb3NpdGl2ZSBpbnRlZ2Vycy4KICAgIAkJCQlpZiAoIHJhbmdlLnN0YXJ0IDw9IHByZXZpb3VzUmFuZ2Uuc3RhcnQgKyBwcmV2aW91c1JhbmdlLmNvdW50ICsgMSApIHsKCiAgICAJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQgPSBNYXRoLm1heCgKICAgIAkJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQsCiAgICAJCQkJCQlyYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gcHJldmlvdXNSYW5nZS5zdGFydAogICAgCQkJCQkpOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJKysgbWVyZ2VJbmRleDsKICAgIAkJCQkJdXBkYXRlUmFuZ2VzWyBtZXJnZUluZGV4IF0gPSByYW5nZTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLyBUcmltIHRoZSBhcnJheSB0byBvbmx5IGNvbnRhaW4gdGhlIG1lcmdlZCByYW5nZXMuCiAgICAJCQl1cGRhdGVSYW5nZXMubGVuZ3RoID0gbWVyZ2VJbmRleCArIDE7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgogICAgCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHJhbmdlLnN0YXJ0ICogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCiAgICAJCQkJCWFycmF5LCByYW5nZS5zdGFydCwgcmFuZ2UuY291bnQgKTsKCiAgICAJCQl9CgogICAgCQkJYXR0cmlidXRlLmNsZWFyVXBkYXRlUmFuZ2VzKCk7CgogICAgCQl9CgogICAgCQlhdHRyaWJ1dGUub25VcGxvYWRDYWxsYmFjaygpOwoKICAgIAl9CgogICAgCS8vCgogICAgCWZ1bmN0aW9uIGdldCggYXR0cmlidXRlICkgewoKICAgIAkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwoKICAgIAkJcmV0dXJuIGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW1vdmUoIGF0dHJpYnV0ZSApIHsKCiAgICAJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCiAgICAJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgogICAgCQlpZiAoIGRhdGEgKSB7CgogICAgCQkJZ2wuZGVsZXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciApOwoKICAgIAkJCWJ1ZmZlcnMuZGVsZXRlKCBhdHRyaWJ1dGUgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1cGRhdGUoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApIHsKCiAgICAJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCiAgICAJCWlmICggYXR0cmlidXRlLmlzR0xCdWZmZXJBdHRyaWJ1dGUgKSB7CgogICAgCQkJY29uc3QgY2FjaGVkID0gYnVmZmVycy5nZXQoIGF0dHJpYnV0ZSApOwoKICAgIAkJCWlmICggISBjYWNoZWQgfHwgY2FjaGVkLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCiAgICAJCQkJYnVmZmVycy5zZXQoIGF0dHJpYnV0ZSwgewogICAgCQkJCQlidWZmZXI6IGF0dHJpYnV0ZS5idWZmZXIsCiAgICAJCQkJCXR5cGU6IGF0dHJpYnV0ZS50eXBlLAogICAgCQkJCQlieXRlc1BlckVsZW1lbnQ6IGF0dHJpYnV0ZS5lbGVtZW50U2l6ZSwKICAgIAkJCQkJdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KICAgIAkJCQl9ICk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgogICAgCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlidWZmZXJzLnNldCggYXR0cmlidXRlLCBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApICk7CgogICAgCQl9IGVsc2UgaWYgKCBkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCiAgICAJCQlpZiAoIGRhdGEuc2l6ZSAhPT0gYXR0cmlidXRlLmFycmF5LmJ5dGVMZW5ndGggKSB7CgogICAgCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMQXR0cmlidXRlczogVGhlIHNpemUgb2YgdGhlIGJ1ZmZlciBhdHRyaWJ1dGVcJ3MgYXJyYXkgYnVmZmVyIGRvZXMgbm90IG1hdGNoIHRoZSBvcmlnaW5hbCBzaXplLiBSZXNpemluZyBidWZmZXIgYXR0cmlidXRlcyBpcyBub3Qgc3VwcG9ydGVkLicgKTsKCiAgICAJCQl9CgogICAgCQkJdXBkYXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICk7CgogICAgCQkJZGF0YS52ZXJzaW9uID0gYXR0cmlidXRlLnZlcnNpb247CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCWdldDogZ2V0LAogICAgCQlyZW1vdmU6IHJlbW92ZSwKICAgIAkJdXBkYXRlOiB1cGRhdGUKCiAgICAJfTsKCiAgICB9CgogICAgdmFyIGFscGhhaGFzaF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2UG9zaXRpb24gKSApIGRpc2NhcmQ7XG4jZW5kaWYiOwoKICAgIHZhciBhbHBoYWhhc2hfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRjb25zdCBmbG9hdCBBTFBIQV9IQVNIX1NDQUxFID0gMC4wNTtcblx0ZmxvYXQgaGFzaDJEKCB2ZWMyIHZhbHVlICkge1xuXHRcdHJldHVybiBmcmFjdCggMS4wZTQgKiBzaW4oIDE3LjAgKiB2YWx1ZS54ICsgMC4xICogdmFsdWUueSApICogKCAwLjEgKyBhYnMoIHNpbiggMTMuMCAqIHZhbHVlLnkgKyB2YWx1ZS54ICkgKSApICk7XG5cdH1cblx0ZmxvYXQgaGFzaDNEKCB2ZWMzIHZhbHVlICkge1xuXHRcdHJldHVybiBoYXNoMkQoIHZlYzIoIGhhc2gyRCggdmFsdWUueHkgKSwgdmFsdWUueiApICk7XG5cdH1cblx0ZmxvYXQgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2ZWMzIHBvc2l0aW9uICkge1xuXHRcdGZsb2F0IG1heERlcml2ID0gbWF4KFxuXHRcdFx0bGVuZ3RoKCBkRmR4KCBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0bGVuZ3RoKCBkRmR5KCBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBwaXhTY2FsZSA9IDEuMCAvICggQUxQSEFfSEFTSF9TQ0FMRSAqIG1heERlcml2ICk7XG5cdFx0dmVjMiBwaXhTY2FsZXMgPSB2ZWMyKFxuXHRcdFx0ZXhwMiggZmxvb3IoIGxvZzIoIHBpeFNjYWxlICkgKSApLFxuXHRcdFx0ZXhwMiggY2VpbCggbG9nMiggcGl4U2NhbGUgKSApIClcblx0XHQpO1xuXHRcdHZlYzIgYWxwaGEgPSB2ZWMyKFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnggKiBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnkgKiBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBsZXJwRmFjdG9yID0gZnJhY3QoIGxvZzIoIHBpeFNjYWxlICkgKTtcblx0XHRmbG9hdCB4ID0gKCAxLjAgLSBsZXJwRmFjdG9yICkgKiBhbHBoYS54ICsgbGVycEZhY3RvciAqIGFscGhhLnk7XG5cdFx0ZmxvYXQgYSA9IG1pbiggbGVycEZhY3RvciwgMS4wIC0gbGVycEZhY3RvciApO1xuXHRcdHZlYzMgY2FzZXMgPSB2ZWMzKFxuXHRcdFx0eCAqIHggLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApLFxuXHRcdFx0KCB4IC0gMC41ICogYSApIC8gKCAxLjAgLSBhICksXG5cdFx0XHQxLjAgLSAoICggMS4wIC0geCApICogKCAxLjAgLSB4ICkgLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApIClcblx0XHQpO1xuXHRcdGZsb2F0IHRocmVzaG9sZCA9ICggeCA8ICggMS4wIC0gYSApIClcblx0XHRcdD8gKCAoIHggPCBhICkgPyBjYXNlcy54IDogY2FzZXMueSApXG5cdFx0XHQ6IGNhc2VzLno7XG5cdFx0cmV0dXJuIGNsYW1wKCB0aHJlc2hvbGQgLCAxLjBlLTYsIDEuMCApO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBhbHBoYW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG5cdGRpZmZ1c2VDb2xvci5hICo9IHRleHR1cmUyRCggYWxwaGFNYXAsIHZBbHBoYU1hcFV2ICkuZztcbiNlbmRpZiI7CgogICAgdmFyIGFscGhhbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgogICAgdmFyIGFscGhhdGVzdF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHQjaWZkZWYgQUxQSEFfVE9fQ09WRVJBR0Vcblx0ZGlmZnVzZUNvbG9yLmEgPSBzbW9vdGhzdGVwKCBhbHBoYVRlc3QsIGFscGhhVGVzdCArIGZ3aWR0aCggZGlmZnVzZUNvbG9yLmEgKSwgZGlmZnVzZUNvbG9yLmEgKTtcblx0aWYgKCBkaWZmdXNlQ29sb3IuYSA9PSAwLjAgKSBkaXNjYXJkO1xuXHQjZWxzZVxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgYWxwaGFUZXN0ICkgZGlzY2FyZDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBhbHBoYXRlc3RfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHR1bmlmb3JtIGZsb2F0IGFscGhhVGVzdDtcbiNlbmRpZiI7CgogICAgdmFyIGFvbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQU9NQVBcblx0ZmxvYXQgYW1iaWVudE9jY2x1c2lvbiA9ICggdGV4dHVyZTJEKCBhb01hcCwgdkFvTWFwVXYgKS5yIC0gMS4wICkgKiBhb01hcEludGVuc2l0eSArIDEuMDtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGFtYmllbnRPY2NsdXNpb247XG5cdCNpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUICkgXG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9TSEVFTiApIFxuXHRcdHNoZWVuU3BlY3VsYXJJbmRpcmVjdCAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBTVEFOREFSRCApXG5cdFx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyICkgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICo9IGNvbXB1dGVTcGVjdWxhck9jY2x1c2lvbiggZG90TlYsIGFtYmllbnRPY2NsdXNpb24sIG1hdGVyaWFsLnJvdWdobmVzcyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGFvbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhb01hcDtcblx0dW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7CgogICAgdmFyIGJhdGNoaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0I2lmICEgZGVmaW5lZCggR0xfQU5HTEVfbXVsdGlfZHJhdyApXG5cdCNkZWZpbmUgZ2xfRHJhd0lEIF9nbF9EcmF3SURcblx0dW5pZm9ybSBpbnQgX2dsX0RyYXdJRDtcblx0I2VuZGlmXG5cdHVuaWZvcm0gaGlnaHAgc2FtcGxlcjJEIGJhdGNoaW5nVGV4dHVyZTtcblx0dW5pZm9ybSBoaWdocCB1c2FtcGxlcjJEIGJhdGNoaW5nSWRUZXh0dXJlO1xuXHRtYXQ0IGdldEJhdGNoaW5nTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKTtcblx0XHR2ZWM0IHYyID0gdGV4ZWxGZXRjaCggYmF0Y2hpbmdUZXh0dXJlLCBpdmVjMiggeCArIDEsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjMgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJhdGNoaW5nVGV4dHVyZSwgaXZlYzIoIHggKyAzLCB5ICksIDAgKTtcblx0XHRyZXR1cm4gbWF0NCggdjEsIHYyLCB2MywgdjQgKTtcblx0fVxuXHRmbG9hdCBnZXRJbmRpcmVjdEluZGV4KCBjb25zdCBpbiBpbnQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBiYXRjaGluZ0lkVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IHggPSBpICUgc2l6ZTtcblx0XHRpbnQgeSA9IGkgLyBzaXplO1xuXHRcdHJldHVybiBmbG9hdCggdGV4ZWxGZXRjaCggYmF0Y2hpbmdJZFRleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKS5yICk7XG5cdH1cbiNlbmRpZlxuI2lmZGVmIFVTRV9CQVRDSElOR19DT0xPUlxuXHR1bmlmb3JtIHNhbXBsZXIyRCBiYXRjaGluZ0NvbG9yVGV4dHVyZTtcblx0dmVjMyBnZXRCYXRjaGluZ0NvbG9yKCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nQ29sb3JUZXh0dXJlLCAwICkueDtcblx0XHRpbnQgaiA9IGludCggaSApO1xuXHRcdGludCB4ID0gaiAlIHNpemU7XG5cdFx0aW50IHkgPSBqIC8gc2l6ZTtcblx0XHRyZXR1cm4gdGV4ZWxGZXRjaCggYmF0Y2hpbmdDb2xvclRleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKS5yZ2I7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIGJhdGNoaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0JBVENISU5HXG5cdG1hdDQgYmF0Y2hpbmdNYXRyaXggPSBnZXRCYXRjaGluZ01hdHJpeCggZ2V0SW5kaXJlY3RJbmRleCggZ2xfRHJhd0lEICkgKTtcbiNlbmRpZiI7CgogICAgdmFyIGJlZ2luX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkID0gdmVjMyggcG9zaXRpb24gKTtcbiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdHZQb3NpdGlvbiA9IHZlYzMoIHBvc2l0aW9uICk7XG4jZW5kaWYiOwoKICAgIHZhciBiZWdpbm5vcm1hbF92ZXJ0ZXggPSAidmVjMyBvYmplY3ROb3JtYWwgPSB2ZWMzKCBub3JtYWwgKTtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIG9iamVjdFRhbmdlbnQgPSB2ZWMzKCB0YW5nZW50Lnh5eiApO1xuI2VuZGlmIjsKCiAgICB2YXIgYnNkZnMgPSAiZmxvYXQgR19CbGlublBob25nX0ltcGxpY2l0KCApIHtcblx0cmV0dXJuIDAuMjU7XG59XG5mbG9hdCBEX0JsaW5uUGhvbmcoIGNvbnN0IGluIGZsb2F0IHNoaW5pbmVzcywgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogKCBzaGluaW5lc3MgKiAwLjUgKyAxLjAgKSAqIHBvdyggZG90TkgsIHNoaW5pbmVzcyApO1xufVxudmVjMyBCUkRGX0JsaW5uUGhvbmcoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzICkge1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggc3BlY3VsYXJDb2xvciwgMS4wLCBkb3RWSCApO1xuXHRmbG9hdCBHID0gR19CbGlublBob25nX0ltcGxpY2l0KCApO1xuXHRmbG9hdCBEID0gRF9CbGlublBob25nKCBzaGluaW5lc3MsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKICAgIHZhciBpcmlkZXNjZW5jZV9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdGNvbnN0IG1hdDMgWFlaX1RPX1JFQzcwOSA9IG1hdDMoXG5cdFx0IDMuMjQwNDU0MiwgLTAuOTY5MjY2MCwgIDAuMDU1NjQzNCxcblx0XHQtMS41MzcxMzg1LCAgMS44NzYwMTA4LCAtMC4yMDQwMjU5LFxuXHRcdC0wLjQ5ODUzMTQsICAwLjA0MTU1NjAsICAxLjA1NzIyNTJcblx0KTtcblx0dmVjMyBGcmVzbmVsMFRvSW9yKCB2ZWMzIGZyZXNuZWwwICkge1xuXHRcdHZlYzMgc3FydEYwID0gc3FydCggZnJlc25lbDAgKTtcblx0XHRyZXR1cm4gKCB2ZWMzKCAxLjAgKSArIHNxcnRGMCApIC8gKCB2ZWMzKCAxLjAgKSAtIHNxcnRGMCApO1xuXHR9XG5cdHZlYzMgSW9yVG9GcmVzbmVsMCggdmVjMyB0cmFuc21pdHRlZElvciwgZmxvYXQgaW5jaWRlbnRJb3IgKSB7XG5cdFx0cmV0dXJuIHBvdzIoICggdHJhbnNtaXR0ZWRJb3IgLSB2ZWMzKCBpbmNpZGVudElvciApICkgLyAoIHRyYW5zbWl0dGVkSW9yICsgdmVjMyggaW5jaWRlbnRJb3IgKSApICk7XG5cdH1cblx0ZmxvYXQgSW9yVG9GcmVzbmVsMCggZmxvYXQgdHJhbnNtaXR0ZWRJb3IsIGZsb2F0IGluY2lkZW50SW9yICkge1xuXHRcdHJldHVybiBwb3cyKCAoIHRyYW5zbWl0dGVkSW9yIC0gaW5jaWRlbnRJb3IgKSAvICggdHJhbnNtaXR0ZWRJb3IgKyBpbmNpZGVudElvciApKTtcblx0fVxuXHR2ZWMzIGV2YWxTZW5zaXRpdml0eSggZmxvYXQgT1BELCB2ZWMzIHNoaWZ0ICkge1xuXHRcdGZsb2F0IHBoYXNlID0gMi4wICogUEkgKiBPUEQgKiAxLjBlLTk7XG5cdFx0dmVjMyB2YWwgPSB2ZWMzKCA1LjQ4NTZlLTEzLCA0LjQyMDFlLTEzLCA1LjI0ODFlLTEzICk7XG5cdFx0dmVjMyBwb3MgPSB2ZWMzKCAxLjY4MTBlKzA2LCAxLjc5NTNlKzA2LCAyLjIwODRlKzA2ICk7XG5cdFx0dmVjMyB2YXIgPSB2ZWMzKCA0LjMyNzhlKzA5LCA5LjMwNDZlKzA5LCA2LjYxMjFlKzA5ICk7XG5cdFx0dmVjMyB4eXogPSB2YWwgKiBzcXJ0KCAyLjAgKiBQSSAqIHZhciApICogY29zKCBwb3MgKiBwaGFzZSArIHNoaWZ0ICkgKiBleHAoIC0gcG93MiggcGhhc2UgKSAqIHZhciApO1xuXHRcdHh5ei54ICs9IDkuNzQ3MGUtMTQgKiBzcXJ0KCAyLjAgKiBQSSAqIDQuNTI4MmUrMDkgKSAqIGNvcyggMi4yMzk5ZSswNiAqIHBoYXNlICsgc2hpZnRbIDAgXSApICogZXhwKCAtIDQuNTI4MmUrMDkgKiBwb3cyKCBwaGFzZSApICk7XG5cdFx0eHl6IC89IDEuMDY4NWUtNztcblx0XHR2ZWMzIHJnYiA9IFhZWl9UT19SRUM3MDkgKiB4eXo7XG5cdFx0cmV0dXJuIHJnYjtcblx0fVxuXHR2ZWMzIGV2YWxJcmlkZXNjZW5jZSggZmxvYXQgb3V0c2lkZUlPUiwgZmxvYXQgZXRhMiwgZmxvYXQgY29zVGhldGExLCBmbG9hdCB0aGluRmlsbVRoaWNrbmVzcywgdmVjMyBiYXNlRjAgKSB7XG5cdFx0dmVjMyBJO1xuXHRcdGZsb2F0IGlyaWRlc2NlbmNlSU9SID0gbWl4KCBvdXRzaWRlSU9SLCBldGEyLCBzbW9vdGhzdGVwKCAwLjAsIDAuMDMsIHRoaW5GaWxtVGhpY2tuZXNzICkgKTtcblx0XHRmbG9hdCBzaW5UaGV0YTJTcSA9IHBvdzIoIG91dHNpZGVJT1IgLyBpcmlkZXNjZW5jZUlPUiApICogKCAxLjAgLSBwb3cyKCBjb3NUaGV0YTEgKSApO1xuXHRcdGZsb2F0IGNvc1RoZXRhMlNxID0gMS4wIC0gc2luVGhldGEyU3E7XG5cdFx0aWYgKCBjb3NUaGV0YTJTcSA8IDAuMCApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9XG5cdFx0ZmxvYXQgY29zVGhldGEyID0gc3FydCggY29zVGhldGEyU3EgKTtcblx0XHRmbG9hdCBSMCA9IElvclRvRnJlc25lbDAoIGlyaWRlc2NlbmNlSU9SLCBvdXRzaWRlSU9SICk7XG5cdFx0ZmxvYXQgUjEyID0gRl9TY2hsaWNrKCBSMCwgMS4wLCBjb3NUaGV0YTEgKTtcblx0XHRmbG9hdCBUMTIxID0gMS4wIC0gUjEyO1xuXHRcdGZsb2F0IHBoaTEyID0gMC4wO1xuXHRcdGlmICggaXJpZGVzY2VuY2VJT1IgPCBvdXRzaWRlSU9SICkgcGhpMTIgPSBQSTtcblx0XHRmbG9hdCBwaGkyMSA9IFBJIC0gcGhpMTI7XG5cdFx0dmVjMyBiYXNlSU9SID0gRnJlc25lbDBUb0lvciggY2xhbXAoIGJhc2VGMCwgMC4wLCAwLjk5OTkgKSApO1x0XHR2ZWMzIFIxID0gSW9yVG9GcmVzbmVsMCggYmFzZUlPUiwgaXJpZGVzY2VuY2VJT1IgKTtcblx0XHR2ZWMzIFIyMyA9IEZfU2NobGljayggUjEsIDEuMCwgY29zVGhldGEyICk7XG5cdFx0dmVjMyBwaGkyMyA9IHZlYzMoIDAuMCApO1xuXHRcdGlmICggYmFzZUlPUlsgMCBdIDwgaXJpZGVzY2VuY2VJT1IgKSBwaGkyM1sgMCBdID0gUEk7XG5cdFx0aWYgKCBiYXNlSU9SWyAxIF0gPCBpcmlkZXNjZW5jZUlPUiApIHBoaTIzWyAxIF0gPSBQSTtcblx0XHRpZiAoIGJhc2VJT1JbIDIgXSA8IGlyaWRlc2NlbmNlSU9SICkgcGhpMjNbIDIgXSA9IFBJO1xuXHRcdGZsb2F0IE9QRCA9IDIuMCAqIGlyaWRlc2NlbmNlSU9SICogdGhpbkZpbG1UaGlja25lc3MgKiBjb3NUaGV0YTI7XG5cdFx0dmVjMyBwaGkgPSB2ZWMzKCBwaGkyMSApICsgcGhpMjM7XG5cdFx0dmVjMyBSMTIzID0gY2xhbXAoIFIxMiAqIFIyMywgMWUtNSwgMC45OTk5ICk7XG5cdFx0dmVjMyByMTIzID0gc3FydCggUjEyMyApO1xuXHRcdHZlYzMgUnMgPSBwb3cyKCBUMTIxICkgKiBSMjMgLyAoIHZlYzMoIDEuMCApIC0gUjEyMyApO1xuXHRcdHZlYzMgQzAgPSBSMTIgKyBScztcblx0XHRJID0gQzA7XG5cdFx0dmVjMyBDbSA9IFJzIC0gVDEyMTtcblx0XHRmb3IgKCBpbnQgbSA9IDE7IG0gPD0gMjsgKysgbSApIHtcblx0XHRcdENtICo9IHIxMjM7XG5cdFx0XHR2ZWMzIFNtID0gMi4wICogZXZhbFNlbnNpdGl2aXR5KCBmbG9hdCggbSApICogT1BELCBmbG9hdCggbSApICogcGhpICk7XG5cdFx0XHRJICs9IENtICogU207XG5cdFx0fVxuXHRcdHJldHVybiBtYXgoIEksIHZlYzMoIDAuMCApICk7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIGJ1bXBtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0JVTVBNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgYnVtcE1hcDtcblx0dW5pZm9ybSBmbG9hdCBidW1wU2NhbGU7XG5cdHZlYzIgZEhkeHlfZndkKCkge1xuXHRcdHZlYzIgZFNUZHggPSBkRmR4KCB2QnVtcE1hcFV2ICk7XG5cdFx0dmVjMiBkU1RkeSA9IGRGZHkoIHZCdW1wTWFwVXYgKTtcblx0XHRmbG9hdCBIbGwgPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKS54O1xuXHRcdGZsb2F0IGRCeCA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdkJ1bXBNYXBVdiArIGRTVGR4ICkueCAtIEhsbDtcblx0XHRmbG9hdCBkQnkgPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKyBkU1RkeSApLnggLSBIbGw7XG5cdFx0cmV0dXJuIHZlYzIoIGRCeCwgZEJ5ICk7XG5cdH1cblx0dmVjMyBwZXJ0dXJiTm9ybWFsQXJiKCB2ZWMzIHN1cmZfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiBkSGR4eSwgZmxvYXQgZmFjZURpcmVjdGlvbiApIHtcblx0XHR2ZWMzIHZTaWdtYVggPSBub3JtYWxpemUoIGRGZHgoIHN1cmZfcG9zLnh5eiApICk7XG5cdFx0dmVjMyB2U2lnbWFZID0gbm9ybWFsaXplKCBkRmR5KCBzdXJmX3Bvcy54eXogKSApO1xuXHRcdHZlYzMgdk4gPSBzdXJmX25vcm07XG5cdFx0dmVjMyBSMSA9IGNyb3NzKCB2U2lnbWFZLCB2TiApO1xuXHRcdHZlYzMgUjIgPSBjcm9zcyggdk4sIHZTaWdtYVggKTtcblx0XHRmbG9hdCBmRGV0ID0gZG90KCB2U2lnbWFYLCBSMSApICogZmFjZURpcmVjdGlvbjtcblx0XHR2ZWMzIHZHcmFkID0gc2lnbiggZkRldCApICogKCBkSGR4eS54ICogUjEgKyBkSGR4eS55ICogUjIgKTtcblx0XHRyZXR1cm4gbm9ybWFsaXplKCBhYnMoIGZEZXQgKSAqIHN1cmZfbm9ybSAtIHZHcmFkICk7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmVjNCBwbGFuZTtcblx0I2lmZGVmIEFMUEhBX1RPX0NPVkVSQUdFXG5cdFx0ZmxvYXQgZGlzdGFuY2VUb1BsYW5lLCBkaXN0YW5jZUdyYWRpZW50O1xuXHRcdGZsb2F0IGNsaXBPcGFjaXR5ID0gMS4wO1xuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBVTklPTl9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRkaXN0YW5jZVRvUGxhbmUgPSAtIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgKyBwbGFuZS53O1xuXHRcdFx0ZGlzdGFuY2VHcmFkaWVudCA9IGZ3aWR0aCggZGlzdGFuY2VUb1BsYW5lICkgLyAyLjA7XG5cdFx0XHRjbGlwT3BhY2l0eSAqPSBzbW9vdGhzdGVwKCAtIGRpc3RhbmNlR3JhZGllbnQsIGRpc3RhbmNlR3JhZGllbnQsIGRpc3RhbmNlVG9QbGFuZSApO1xuXHRcdFx0aWYgKCBjbGlwT3BhY2l0eSA9PSAwLjAgKSBkaXNjYXJkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0XHRmbG9hdCB1bmlvbkNsaXBPcGFjaXR5ID0gMS4wO1xuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRcdGRpc3RhbmNlVG9QbGFuZSA9IC0gZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSArIHBsYW5lLnc7XG5cdFx0XHRcdGRpc3RhbmNlR3JhZGllbnQgPSBmd2lkdGgoIGRpc3RhbmNlVG9QbGFuZSApIC8gMi4wO1xuXHRcdFx0XHR1bmlvbkNsaXBPcGFjaXR5ICo9IDEuMCAtIHNtb290aHN0ZXAoIC0gZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VUb1BsYW5lICk7XG5cdFx0XHR9XG5cdFx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdFx0Y2xpcE9wYWNpdHkgKj0gMS4wIC0gdW5pb25DbGlwT3BhY2l0eTtcblx0XHQjZW5kaWZcblx0XHRkaWZmdXNlQ29sb3IuYSAqPSBjbGlwT3BhY2l0eTtcblx0XHRpZiAoIGRpZmZ1c2VDb2xvci5hID09IDAuMCApIGRpc2NhcmQ7XG5cdCNlbHNlXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IFVOSU9OX0NMSVBQSU5HX1BMQU5FUzsgaSArKyApIHtcblx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdGlmICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSBkaXNjYXJkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0XHRib29sIGNsaXBwZWQgPSB0cnVlO1xuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRcdGNsaXBwZWQgPSAoIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgPiBwbGFuZS53ICkgJiYgY2xpcHBlZDtcblx0XHRcdH1cblx0XHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdFx0XHRpZiAoIGNsaXBwZWQgKSBkaXNjYXJkO1xuXHRcdCNlbmRpZlxuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2YXJ5aW5nIHZlYzMgdkNsaXBQb3NpdGlvbjtcblx0dW5pZm9ybSB2ZWM0IGNsaXBwaW5nUGxhbmVzWyBOVU1fQ0xJUFBJTkdfUExBTkVTIF07XG4jZW5kaWYiOwoKICAgIHZhciBjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZhcnlpbmcgdmVjMyB2Q2xpcFBvc2l0aW9uO1xuI2VuZGlmIjsKCiAgICB2YXIgY2xpcHBpbmdfcGxhbmVzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dkNsaXBQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWYiOwoKICAgIHZhciBjb2xvcl9mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0ZGlmZnVzZUNvbG9yICo9IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdGRpZmZ1c2VDb2xvci5yZ2IgKj0gdkNvbG9yO1xuI2VuZGlmIjsKCiAgICB2YXIgY29sb3JfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdHZhcnlpbmcgdmVjMyB2Q29sb3I7XG4jZW5kaWYiOwoKICAgIHZhciBjb2xvcl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0JBVENISU5HX0NPTE9SIClcblx0dmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7CgogICAgdmFyIGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dkNvbG9yID0gdmVjNCggMS4wICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKSB8fCBkZWZpbmVkKCBVU0VfSU5TVEFOQ0lOR19DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9CQVRDSElOR19DT0xPUiApXG5cdHZDb2xvciA9IHZlYzMoIDEuMCApO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NPTE9SXG5cdHZDb2xvciAqPSBjb2xvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JTlNUQU5DSU5HX0NPTE9SXG5cdHZDb2xvci54eXogKj0gaW5zdGFuY2VDb2xvci54eXo7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdfQ09MT1Jcblx0dmVjMyBiYXRjaGluZ0NvbG9yID0gZ2V0QmF0Y2hpbmdDb2xvciggZ2V0SW5kaXJlY3RJbmRleCggZ2xfRHJhd0lEICkgKTtcblx0dkNvbG9yLnh5eiAqPSBiYXRjaGluZ0NvbG9yLnh5ejtcbiNlbmRpZiI7CgogICAgdmFyIGNvbW1vbiA9ICIjZGVmaW5lIFBJIDMuMTQxNTkyNjUzNTg5NzkzXG4jZGVmaW5lIFBJMiA2LjI4MzE4NTMwNzE3OTU4NlxuI2RlZmluZSBQSV9IQUxGIDEuNTcwNzk2MzI2Nzk0ODk2NlxuI2RlZmluZSBSRUNJUFJPQ0FMX1BJIDAuMzE4MzA5ODg2MTgzNzkwN1xuI2RlZmluZSBSRUNJUFJPQ0FMX1BJMiAwLjE1OTE1NDk0MzA5MTg5NTM1XG4jZGVmaW5lIEVQU0lMT04gMWUtNlxuI2lmbmRlZiBzYXR1cmF0ZVxuI2RlZmluZSBzYXR1cmF0ZSggYSApIGNsYW1wKCBhLCAwLjAsIDEuMCApXG4jZW5kaWZcbiNkZWZpbmUgd2hpdGVDb21wbGVtZW50KCBhICkgKCAxLjAgLSBzYXR1cmF0ZSggYSApIClcbmZsb2F0IHBvdzIoIGNvbnN0IGluIGZsb2F0IHggKSB7IHJldHVybiB4Kng7IH1cbnZlYzMgcG93MiggY29uc3QgaW4gdmVjMyB4ICkgeyByZXR1cm4geCp4OyB9XG5mbG9hdCBwb3czKCBjb25zdCBpbiBmbG9hdCB4ICkgeyByZXR1cm4geCp4Kng7IH1cbmZsb2F0IHBvdzQoIGNvbnN0IGluIGZsb2F0IHggKSB7IGZsb2F0IHgyID0geCp4OyByZXR1cm4geDIqeDI7IH1cbmZsb2F0IG1heDMoIGNvbnN0IGluIHZlYzMgdiApIHsgcmV0dXJuIG1heCggbWF4KCB2LngsIHYueSApLCB2LnogKTsgfVxuZmxvYXQgYXZlcmFnZSggY29uc3QgaW4gdmVjMyB2ICkgeyByZXR1cm4gZG90KCB2LCB2ZWMzKCAwLjMzMzMzMzMgKSApOyB9XG5oaWdocCBmbG9hdCByYW5kKCBjb25zdCBpbiB2ZWMyIHV2ICkge1xuXHRjb25zdCBoaWdocCBmbG9hdCBhID0gMTIuOTg5OCwgYiA9IDc4LjIzMywgYyA9IDQzNzU4LjU0NTM7XG5cdGhpZ2hwIGZsb2F0IGR0ID0gZG90KCB1di54eSwgdmVjMiggYSxiICkgKSwgc24gPSBtb2QoIGR0LCBQSSApO1xuXHRyZXR1cm4gZnJhY3QoIHNpbiggc24gKSAqIGMgKTtcbn1cbiNpZmRlZiBISUdIX1BSRUNJU0lPTlxuXHRmbG9hdCBwcmVjaXNpb25TYWZlTGVuZ3RoKCB2ZWMzIHYgKSB7IHJldHVybiBsZW5ndGgoIHYgKTsgfVxuI2Vsc2Vcblx0ZmxvYXQgcHJlY2lzaW9uU2FmZUxlbmd0aCggdmVjMyB2ICkge1xuXHRcdGZsb2F0IG1heENvbXBvbmVudCA9IG1heDMoIGFicyggdiApICk7XG5cdFx0cmV0dXJuIGxlbmd0aCggdiAvIG1heENvbXBvbmVudCApICogbWF4Q29tcG9uZW50O1xuXHR9XG4jZW5kaWZcbnN0cnVjdCBJbmNpZGVudExpZ2h0IHtcblx0dmVjMyBjb2xvcjtcblx0dmVjMyBkaXJlY3Rpb247XG5cdGJvb2wgdmlzaWJsZTtcbn07XG5zdHJ1Y3QgUmVmbGVjdGVkTGlnaHQge1xuXHR2ZWMzIGRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgZGlyZWN0U3BlY3VsYXI7XG5cdHZlYzMgaW5kaXJlY3REaWZmdXNlO1xuXHR2ZWMzIGluZGlyZWN0U3BlY3VsYXI7XG59O1xuI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0dmFyeWluZyB2ZWMzIHZQb3NpdGlvbjtcbiNlbmRpZlxudmVjMyB0cmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7XG59XG52ZWMzIGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCB2ZWM0KCBkaXIsIDAuMCApICogbWF0cml4ICkueHl6ICk7XG59XG5tYXQzIHRyYW5zcG9zZU1hdDMoIGNvbnN0IGluIG1hdDMgbSApIHtcblx0bWF0MyB0bXA7XG5cdHRtcFsgMCBdID0gdmVjMyggbVsgMCBdLngsIG1bIDEgXS54LCBtWyAyIF0ueCApO1xuXHR0bXBbIDEgXSA9IHZlYzMoIG1bIDAgXS55LCBtWyAxIF0ueSwgbVsgMiBdLnkgKTtcblx0dG1wWyAyIF0gPSB2ZWMzKCBtWyAwIF0ueiwgbVsgMSBdLnosIG1bIDIgXS56ICk7XG5cdHJldHVybiB0bXA7XG59XG5ib29sIGlzUGVyc3BlY3RpdmVNYXRyaXgoIG1hdDQgbSApIHtcblx0cmV0dXJuIG1bIDIgXVsgMyBdID09IC0gMS4wO1xufVxudmVjMiBlcXVpcmVjdFV2KCBpbiB2ZWMzIGRpciApIHtcblx0ZmxvYXQgdSA9IGF0YW4oIGRpci56LCBkaXIueCApICogUkVDSVBST0NBTF9QSTIgKyAwLjU7XG5cdGZsb2F0IHYgPSBhc2luKCBjbGFtcCggZGlyLnksIC0gMS4wLCAxLjAgKSApICogUkVDSVBST0NBTF9QSSArIDAuNTtcblx0cmV0dXJuIHZlYzIoIHUsIHYgKTtcbn1cbnZlYzMgQlJERl9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvciApIHtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBkaWZmdXNlQ29sb3I7XG59XG52ZWMzIEZfU2NobGljayggY29uc3QgaW4gdmVjMyBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufVxuZmxvYXQgRl9TY2hsaWNrKCBjb25zdCBpbiBmbG9hdCBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKICAgIHZhciBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQgPSAiI2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0I2RlZmluZSBjdWJlVVZfbWluTWlwTGV2ZWwgNC4wXG5cdCNkZWZpbmUgY3ViZVVWX21pblRpbGVTaXplIDE2LjBcblx0ZmxvYXQgZ2V0RmFjZSggdmVjMyBkaXJlY3Rpb24gKSB7XG5cdFx0dmVjMyBhYnNEaXJlY3Rpb24gPSBhYnMoIGRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGZhY2UgPSAtIDEuMDtcblx0XHRpZiAoIGFic0RpcmVjdGlvbi54ID4gYWJzRGlyZWN0aW9uLnogKSB7XG5cdFx0XHRpZiAoIGFic0RpcmVjdGlvbi54ID4gYWJzRGlyZWN0aW9uLnkgKVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnggPiAwLjAgPyAwLjAgOiAzLjA7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKCBhYnNEaXJlY3Rpb24ueiA+IGFic0RpcmVjdGlvbi55IClcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi56ID4gMC4wID8gMi4wIDogNS4wO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnkgPiAwLjAgPyAxLjAgOiA0LjA7XG5cdFx0fVxuXHRcdHJldHVybiBmYWNlO1xuXHR9XG5cdHZlYzIgZ2V0VVYoIHZlYzMgZGlyZWN0aW9uLCBmbG9hdCBmYWNlICkge1xuXHRcdHZlYzIgdXY7XG5cdFx0aWYgKCBmYWNlID09IDAuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggZGlyZWN0aW9uLnosIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi54ICk7XG5cdFx0fSBlbHNlIGlmICggZmFjZSA9PSAxLjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIC0gZGlyZWN0aW9uLngsIC0gZGlyZWN0aW9uLnogKSAvIGFicyggZGlyZWN0aW9uLnkgKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDIuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnggKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDQuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnogKSAvIGFicyggZGlyZWN0aW9uLnkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dXYgPSB2ZWMyKCBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcblx0XHR9XG5cdFx0cmV0dXJuIDAuNSAqICggdXYgKyAxLjAgKTtcblx0fVxuXHR2ZWMzIGJpbGluZWFyQ3ViZVVWKCBzYW1wbGVyMkQgZW52TWFwLCB2ZWMzIGRpcmVjdGlvbiwgZmxvYXQgbWlwSW50ICkge1xuXHRcdGZsb2F0IGZhY2UgPSBnZXRGYWNlKCBkaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBmaWx0ZXJJbnQgPSBtYXgoIGN1YmVVVl9taW5NaXBMZXZlbCAtIG1pcEludCwgMC4wICk7XG5cdFx0bWlwSW50ID0gbWF4KCBtaXBJbnQsIGN1YmVVVl9taW5NaXBMZXZlbCApO1xuXHRcdGZsb2F0IGZhY2VTaXplID0gZXhwMiggbWlwSW50ICk7XG5cdFx0aGlnaHAgdmVjMiB1diA9IGdldFVWKCBkaXJlY3Rpb24sIGZhY2UgKSAqICggZmFjZVNpemUgLSAyLjAgKSArIDEuMDtcblx0XHRpZiAoIGZhY2UgPiAyLjAgKSB7XG5cdFx0XHR1di55ICs9IGZhY2VTaXplO1xuXHRcdFx0ZmFjZSAtPSAzLjA7XG5cdFx0fVxuXHRcdHV2LnggKz0gZmFjZSAqIGZhY2VTaXplO1xuXHRcdHV2LnggKz0gZmlsdGVySW50ICogMy4wICogY3ViZVVWX21pblRpbGVTaXplO1xuXHRcdHV2LnkgKz0gNC4wICogKCBleHAyKCBDVUJFVVZfTUFYX01JUCApIC0gZmFjZVNpemUgKTtcblx0XHR1di54ICo9IENVQkVVVl9URVhFTF9XSURUSDtcblx0XHR1di55ICo9IENVQkVVVl9URVhFTF9IRUlHSFQ7XG5cdFx0I2lmZGVmIHRleHR1cmUyREdyYWRFWFRcblx0XHRcdHJldHVybiB0ZXh0dXJlMkRHcmFkRVhUKCBlbnZNYXAsIHV2LCB2ZWMyKCAwLjAgKSwgdmVjMiggMC4wICkgKS5yZ2I7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdH1cblx0I2RlZmluZSBjdWJlVVZfcjAgMS4wXG5cdCNkZWZpbmUgY3ViZVVWX20wIC0gMi4wXG5cdCNkZWZpbmUgY3ViZVVWX3IxIDAuOFxuXHQjZGVmaW5lIGN1YmVVVl9tMSAtIDEuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNCAwLjRcblx0I2RlZmluZSBjdWJlVVZfbTQgMi4wXG5cdCNkZWZpbmUgY3ViZVVWX3I1IDAuMzA1XG5cdCNkZWZpbmUgY3ViZVVWX201IDMuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNiAwLjIxXG5cdCNkZWZpbmUgY3ViZVVWX202IDQuMFxuXHRmbG9hdCByb3VnaG5lc3NUb01pcCggZmxvYXQgcm91Z2huZXNzICkge1xuXHRcdGZsb2F0IG1pcCA9IDAuMDtcblx0XHRpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjEgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yMCAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTEgLSBjdWJlVVZfbTAgKSAvICggY3ViZVVWX3IwIC0gY3ViZVVWX3IxICkgKyBjdWJlVVZfbTA7XG5cdFx0fSBlbHNlIGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yNCApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3IxIC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tNCAtIGN1YmVVVl9tMSApIC8gKCBjdWJlVVZfcjEgLSBjdWJlVVZfcjQgKSArIGN1YmVVVl9tMTtcblx0XHR9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3I1ICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjQgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX201IC0gY3ViZVVWX200ICkgLyAoIGN1YmVVVl9yNCAtIGN1YmVVVl9yNSApICsgY3ViZVVWX200O1xuXHRcdH0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjYgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yNSAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTYgLSBjdWJlVVZfbTUgKSAvICggY3ViZVVWX3I1IC0gY3ViZVVWX3I2ICkgKyBjdWJlVVZfbTU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1pcCA9IC0gMi4wICogbG9nMiggMS4xNiAqIHJvdWdobmVzcyApO1x0XHR9XG5cdFx0cmV0dXJuIG1pcDtcblx0fVxuXHR2ZWM0IHRleHR1cmVDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgc2FtcGxlRGlyLCBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0ZmxvYXQgbWlwID0gY2xhbXAoIHJvdWdobmVzc1RvTWlwKCByb3VnaG5lc3MgKSwgY3ViZVVWX20wLCBDVUJFVVZfTUFYX01JUCApO1xuXHRcdGZsb2F0IG1pcEYgPSBmcmFjdCggbWlwICk7XG5cdFx0ZmxvYXQgbWlwSW50ID0gZmxvb3IoIG1pcCApO1xuXHRcdHZlYzMgY29sb3IwID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKTtcblx0XHRpZiAoIG1pcEYgPT0gMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzQoIGNvbG9yMCwgMS4wICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZlYzMgY29sb3IxID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKyAxLjAgKTtcblx0XHRcdHJldHVybiB2ZWM0KCBtaXgoIGNvbG9yMCwgY29sb3IxLCBtaXBGICksIDEuMCApO1xuXHRcdH1cblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgZGVmYXVsdG5vcm1hbF92ZXJ0ZXggPSAidmVjMyB0cmFuc2Zvcm1lZE5vcm1hbCA9IG9iamVjdE5vcm1hbDtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIHRyYW5zZm9ybWVkVGFuZ2VudCA9IG9iamVjdFRhbmdlbnQ7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0bWF0MyBibSA9IG1hdDMoIGJhdGNoaW5nTWF0cml4ICk7XG5cdHRyYW5zZm9ybWVkTm9ybWFsIC89IHZlYzMoIGRvdCggYm1bIDAgXSwgYm1bIDAgXSApLCBkb3QoIGJtWyAxIF0sIGJtWyAxIF0gKSwgZG90KCBibVsgMiBdLCBibVsgMiBdICkgKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgPSBibSAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSBibSAqIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuXHRtYXQzIGltID0gbWF0MyggaW5zdGFuY2VNYXRyaXggKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgLz0gdmVjMyggZG90KCBpbVsgMCBdLCBpbVsgMCBdICksIGRvdCggaW1bIDEgXSwgaW1bIDEgXSApLCBkb3QoIGltWyAyIF0sIGltWyAyIF0gKSApO1xuXHR0cmFuc2Zvcm1lZE5vcm1hbCA9IGltICogdHJhbnNmb3JtZWROb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHRyYW5zZm9ybWVkVGFuZ2VudCA9IGltICogdHJhbnNmb3JtZWRUYW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxudHJhbnNmb3JtZWROb3JtYWwgPSBub3JtYWxNYXRyaXggKiB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNpZmRlZiBGTElQX1NJREVEXG5cdHRyYW5zZm9ybWVkTm9ybWFsID0gLSB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHRyYW5zZm9ybWVkVGFuZ2VudCA9ICggbW9kZWxWaWV3TWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWRUYW5nZW50LCAwLjAgKSApLnh5ejtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSAtIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZGlzcGxhY2VtZW50TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudFNjYWxlO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudEJpYXM7XG4jZW5kaWYiOwoKICAgIHZhciBkaXNwbGFjZW1lbnRtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHRyYW5zZm9ybWVkICs9IG5vcm1hbGl6ZSggb2JqZWN0Tm9ybWFsICkgKiAoIHRleHR1cmUyRCggZGlzcGxhY2VtZW50TWFwLCB2RGlzcGxhY2VtZW50TWFwVXYgKS54ICogZGlzcGxhY2VtZW50U2NhbGUgKyBkaXNwbGFjZW1lbnRCaWFzICk7XG4jZW5kaWYiOwoKICAgIHZhciBlbWlzc2l2ZW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZlYzQgZW1pc3NpdmVDb2xvciA9IHRleHR1cmUyRCggZW1pc3NpdmVNYXAsIHZFbWlzc2l2ZU1hcFV2ICk7XG5cdCNpZmRlZiBERUNPREVfVklERU9fVEVYVFVSRV9FTUlTU0lWRVxuXHRcdGVtaXNzaXZlQ29sb3IgPSBzUkdCVHJhbnNmZXJFT1RGKCBlbWlzc2l2ZUNvbG9yICk7XG5cdCNlbmRpZlxuXHR0b3RhbEVtaXNzaXZlUmFkaWFuY2UgKj0gZW1pc3NpdmVDb2xvci5yZ2I7XG4jZW5kaWYiOwoKICAgIHZhciBlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZW1pc3NpdmVNYXA7XG4jZW5kaWYiOwoKICAgIHZhciBjb2xvcnNwYWNlX2ZyYWdtZW50ID0gImdsX0ZyYWdDb2xvciA9IGxpbmVhclRvT3V0cHV0VGV4ZWwoIGdsX0ZyYWdDb2xvciApOyI7CgogICAgdmFyIGNvbG9yc3BhY2VfcGFyc19mcmFnbWVudCA9ICJ2ZWM0IExpbmVhclRyYW5zZmVyT0VURiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZhbHVlO1xufVxudmVjNCBzUkdCVHJhbnNmZXJFT1RGKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiAqIDAuOTQ3ODY3Mjk4NiArIHZlYzMoIDAuMDUyMTMyNzAxNCApLCB2ZWMzKCAyLjQgKSApLCB2YWx1ZS5yZ2IgKiAwLjA3NzM5OTM4MDgsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wNDA0NSApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IHNSR0JUcmFuc2Zlck9FVEYoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCBtaXgoIHBvdyggdmFsdWUucmdiLCB2ZWMzKCAwLjQxNjY2ICkgKSAqIDEuMDU1IC0gdmVjMyggMC4wNTUgKSwgdmFsdWUucmdiICogMTIuOTIsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wMDMxMzA4ICkgKSApICksIHZhbHVlLmEgKTtcbn0iOwoKICAgIHZhciBlbnZtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdHZlYzMgY2FtZXJhVG9GcmFnO1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZlYzMoIC0gdmlld01hdHJpeFsgMCBdWyAyIF0sIC0gdmlld01hdHJpeFsgMSBdWyAyIF0sIC0gdmlld01hdHJpeFsgMiBdWyAyIF0gKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZXb3JsZFBvc2l0aW9uIC0gY2FtZXJhUG9zaXRpb24gKTtcblx0XHR9XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZnJhY3QoIGNhbWVyYVRvRnJhZywgd29ybGROb3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuXHRcdCNlbmRpZlxuXHQjZWxzZVxuXHRcdHZlYzMgcmVmbGVjdFZlYyA9IHZSZWZsZWN0O1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IGVudkNvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiB2ZWMzKCBmbGlwRW52TWFwICogcmVmbGVjdFZlYy54LCByZWZsZWN0VmVjLnl6ICkgKTtcblx0I2Vsc2Vcblx0XHR2ZWM0IGVudkNvbG9yID0gdmVjNCggMC4wICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZXG5cdFx0b3V0Z29pbmdMaWdodCA9IG1peCggb3V0Z29pbmdMaWdodCwgb3V0Z29pbmdMaWdodCAqIGVudkNvbG9yLnh5eiwgc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfTUlYIClcblx0XHRvdXRnb2luZ0xpZ2h0ID0gbWl4KCBvdXRnb2luZ0xpZ2h0LCBlbnZDb2xvci54eXosIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX0JMRU5ESU5HX0FERCApXG5cdFx0b3V0Z29pbmdMaWdodCArPSBlbnZDb2xvci54eXogKiBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IGVudk1hcEludGVuc2l0eTtcblx0dW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwO1xuXHR1bmlmb3JtIG1hdDMgZW52TWFwUm90YXRpb247XG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dW5pZm9ybSBzYW1wbGVyQ3ViZSBlbnZNYXA7XG5cdCNlbHNlXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgZW52TWFwO1xuXHQjZW5kaWZcblx0XG4jZW5kaWYiOwoKICAgIHZhciBlbnZtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IHJlZmxlY3Rpdml0eTtcblx0I2lmIGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFBIT05HICkgfHwgZGVmaW5lZCggTEFNQkVSVCApXG5cdFx0I2RlZmluZSBFTlZfV09STERQT1Ncblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbHNlXG5cdFx0dmFyeWluZyB2ZWMzIHZSZWZsZWN0O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGVudm1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggUEhPTkcgKSB8fCBkZWZpbmVkKCBMQU1CRVJUIClcblx0XHQjZGVmaW5lIEVOVl9XT1JMRFBPU1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdFxuXHRcdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcblx0I2Vsc2Vcblx0XHR2YXJ5aW5nIHZlYzMgdlJlZmxlY3Q7XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgZW52bWFwX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcblx0I2Vsc2Vcblx0XHR2ZWMzIGNhbWVyYVRvVmVydGV4O1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb1ZlcnRleCA9IG5vcm1hbGl6ZSggdmVjMyggLSB2aWV3TWF0cml4WyAwIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAxIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAyIF1bIDIgXSApICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB3b3JsZFBvc2l0aW9uLnh5eiAtIGNhbWVyYVBvc2l0aW9uICk7XG5cdFx0fVxuXHRcdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCB0cmFuc2Zvcm1lZE5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2UmVmbGVjdCA9IHJlZmxlY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCApO1xuXHRcdCNlbHNlXG5cdFx0XHR2UmVmbGVjdCA9IHJlZnJhY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCwgcmVmcmFjdGlvblJhdGlvICk7XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgZm9nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2Rm9nRGVwdGggPSAtIG12UG9zaXRpb24uejtcbiNlbmRpZiI7CgogICAgdmFyIGZvZ19wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcbiNlbmRpZiI7CgogICAgdmFyIGZvZ19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHQjaWZkZWYgRk9HX0VYUDJcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSAxLjAgLSBleHAoIC0gZm9nRGVuc2l0eSAqIGZvZ0RlbnNpdHkgKiB2Rm9nRGVwdGggKiB2Rm9nRGVwdGggKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSBzbW9vdGhzdGVwKCBmb2dOZWFyLCBmb2dGYXIsIHZGb2dEZXB0aCApO1xuXHQjZW5kaWZcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IG1peCggZ2xfRnJhZ0NvbG9yLnJnYiwgZm9nQ29sb3IsIGZvZ0ZhY3RvciApO1xuI2VuZGlmIjsKCiAgICB2YXIgZm9nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9GT0dcblx0dW5pZm9ybSB2ZWMzIGZvZ0NvbG9yO1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcblx0I2lmZGVmIEZPR19FWFAyXG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dEZW5zaXR5O1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gZmxvYXQgZm9nTmVhcjtcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ0Zhcjtcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfR1JBRElFTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZ3JhZGllbnRNYXA7XG4jZW5kaWZcbnZlYzMgZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCB2ZWMzIG5vcm1hbCwgdmVjMyBsaWdodERpcmVjdGlvbiApIHtcblx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgbGlnaHREaXJlY3Rpb24gKTtcblx0dmVjMiBjb29yZCA9IHZlYzIoIGRvdE5MICogMC41ICsgMC41LCAwLjAgKTtcblx0I2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuXHRcdHJldHVybiB2ZWMzKCB0ZXh0dXJlMkQoIGdyYWRpZW50TWFwLCBjb29yZCApLnIgKTtcblx0I2Vsc2Vcblx0XHR2ZWMyIGZ3ID0gZndpZHRoKCBjb29yZCApICogMC41O1xuXHRcdHJldHVybiBtaXgoIHZlYzMoIDAuNyApLCB2ZWMzKCAxLjAgKSwgc21vb3Roc3RlcCggMC43IC0gZncueCwgMC43ICsgZncueCwgY29vcmQueCApICk7XG5cdCNlbmRpZlxufSI7CgogICAgdmFyIGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBsaWdodE1hcDtcblx0dW5pZm9ybSBmbG9hdCBsaWdodE1hcEludGVuc2l0eTtcbiNlbmRpZiI7CgogICAgdmFyIGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50ID0gIkxhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwoKICAgIHZhciBsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50ID0gInZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuc3RydWN0IExhbWJlcnRNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xufTtcbnZvaWQgUkVfRGlyZWN0X0xhbWJlcnQoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfTGFtYmVydFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX0xhbWJlcnQiOwoKICAgIHZhciBsaWdodHNfcGFyc19iZWdpbiA9ICJ1bmlmb3JtIGJvb2wgcmVjZWl2ZVNoYWRvdztcbnVuaWZvcm0gdmVjMyBhbWJpZW50TGlnaHRDb2xvcjtcbiNpZiBkZWZpbmVkKCBVU0VfTElHSFRfUFJPQkVTIClcblx0dW5pZm9ybSB2ZWMzIGxpZ2h0UHJvYmVbIDkgXTtcbiNlbmRpZlxudmVjMyBzaEdldElycmFkaWFuY2VBdCggaW4gdmVjMyBub3JtYWwsIGluIHZlYzMgc2hDb2VmZmljaWVudHNbIDkgXSApIHtcblx0ZmxvYXQgeCA9IG5vcm1hbC54LCB5ID0gbm9ybWFsLnksIHogPSBub3JtYWwuejtcblx0dmVjMyByZXN1bHQgPSBzaENvZWZmaWNpZW50c1sgMCBdICogMC44ODYyMjc7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMSBdICogMi4wICogMC41MTE2NjQgKiB5O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDIgXSAqIDIuMCAqIDAuNTExNjY0ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyAzIF0gKiAyLjAgKiAwLjUxMTY2NCAqIHg7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNCBdICogMi4wICogMC40MjkwNDMgKiB4ICogeTtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA1IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHkgKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDYgXSAqICggMC43NDMxMjUgKiB6ICogeiAtIDAuMjQ3NzA4ICk7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNyBdICogMi4wICogMC40MjkwNDMgKiB4ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA4IF0gKiAwLjQyOTA0MyAqICggeCAqIHggLSB5ICogeSApO1xuXHRyZXR1cm4gcmVzdWx0O1xufVxudmVjMyBnZXRMaWdodFByb2JlSXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBsaWdodFByb2JlWyA5IF0sIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IHNoR2V0SXJyYWRpYW5jZUF0KCB3b3JsZE5vcm1hbCwgbGlnaHRQcm9iZSApO1xuXHRyZXR1cm4gaXJyYWRpYW5jZTtcbn1cbnZlYzMgZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBhbWJpZW50TGlnaHRDb2xvciApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gYW1iaWVudExpZ2h0Q29sb3I7XG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxuZmxvYXQgZ2V0RGlzdGFuY2VBdHRlbnVhdGlvbiggY29uc3QgaW4gZmxvYXQgbGlnaHREaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgY3V0b2ZmRGlzdGFuY2UsIGNvbnN0IGluIGZsb2F0IGRlY2F5RXhwb25lbnQgKSB7XG5cdGZsb2F0IGRpc3RhbmNlRmFsbG9mZiA9IDEuMCAvIG1heCggcG93KCBsaWdodERpc3RhbmNlLCBkZWNheUV4cG9uZW50ICksIDAuMDEgKTtcblx0aWYgKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCApIHtcblx0XHRkaXN0YW5jZUZhbGxvZmYgKj0gcG93Miggc2F0dXJhdGUoIDEuMCAtIHBvdzQoIGxpZ2h0RGlzdGFuY2UgLyBjdXRvZmZEaXN0YW5jZSApICkgKTtcblx0fVxuXHRyZXR1cm4gZGlzdGFuY2VGYWxsb2ZmO1xufVxuZmxvYXQgZ2V0U3BvdEF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCBjb25lQ29zaW5lLCBjb25zdCBpbiBmbG9hdCBwZW51bWJyYUNvc2luZSwgY29uc3QgaW4gZmxvYXQgYW5nbGVDb3NpbmUgKSB7XG5cdHJldHVybiBzbW9vdGhzdGVwKCBjb25lQ29zaW5lLCBwZW51bWJyYUNvc2luZSwgYW5nbGVDb3NpbmUgKTtcbn1cbiNpZiBOVU1fRElSX0xJR0hUUyA+IDBcblx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdH07XG5cdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0c1sgTlVNX0RJUl9MSUdIVFMgXTtcblx0dm9pZCBnZXREaXJlY3Rpb25hbExpZ2h0SW5mbyggY29uc3QgaW4gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0LCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHRsaWdodC5jb2xvciA9IGRpcmVjdGlvbmFsTGlnaHQuY29sb3I7XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gZGlyZWN0aW9uYWxMaWdodC5kaXJlY3Rpb247XG5cdFx0bGlnaHQudmlzaWJsZSA9IHRydWU7XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG5cdHN0cnVjdCBQb2ludExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdH07XG5cdHVuaWZvcm0gUG9pbnRMaWdodCBwb2ludExpZ2h0c1sgTlVNX1BPSU5UX0xJR0hUUyBdO1xuXHR2b2lkIGdldFBvaW50TGlnaHRJbmZvKCBjb25zdCBpbiBQb2ludExpZ2h0IHBvaW50TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgb3V0IEluY2lkZW50TGlnaHQgbGlnaHQgKSB7XG5cdFx0dmVjMyBsVmVjdG9yID0gcG9pbnRMaWdodC5wb3NpdGlvbiAtIGdlb21ldHJ5UG9zaXRpb247XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gbm9ybWFsaXplKCBsVmVjdG9yICk7XG5cdFx0ZmxvYXQgbGlnaHREaXN0YW5jZSA9IGxlbmd0aCggbFZlY3RvciApO1xuXHRcdGxpZ2h0LmNvbG9yID0gcG9pbnRMaWdodC5jb2xvcjtcblx0XHRsaWdodC5jb2xvciAqPSBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBsaWdodERpc3RhbmNlLCBwb2ludExpZ2h0LmRpc3RhbmNlLCBwb2ludExpZ2h0LmRlY2F5ICk7XG5cdFx0bGlnaHQudmlzaWJsZSA9ICggbGlnaHQuY29sb3IgIT0gdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRTID4gMFxuXHRzdHJ1Y3QgU3BvdExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdFx0ZmxvYXQgY29uZUNvcztcblx0XHRmbG9hdCBwZW51bWJyYUNvcztcblx0fTtcblx0dW5pZm9ybSBTcG90TGlnaHQgc3BvdExpZ2h0c1sgTlVNX1NQT1RfTElHSFRTIF07XG5cdHZvaWQgZ2V0U3BvdExpZ2h0SW5mbyggY29uc3QgaW4gU3BvdExpZ2h0IHNwb3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHR2ZWMzIGxWZWN0b3IgPSBzcG90TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdGxpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuXHRcdGZsb2F0IGFuZ2xlQ29zID0gZG90KCBsaWdodC5kaXJlY3Rpb24sIHNwb3RMaWdodC5kaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBzcG90QXR0ZW51YXRpb24gPSBnZXRTcG90QXR0ZW51YXRpb24oIHNwb3RMaWdodC5jb25lQ29zLCBzcG90TGlnaHQucGVudW1icmFDb3MsIGFuZ2xlQ29zICk7XG5cdFx0aWYgKCBzcG90QXR0ZW51YXRpb24gPiAwLjAgKSB7XG5cdFx0XHRmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG5cdFx0XHRsaWdodC5jb2xvciA9IHNwb3RMaWdodC5jb2xvciAqIHNwb3RBdHRlbnVhdGlvbjtcblx0XHRcdGxpZ2h0LmNvbG9yICo9IGdldERpc3RhbmNlQXR0ZW51YXRpb24oIGxpZ2h0RGlzdGFuY2UsIHNwb3RMaWdodC5kaXN0YW5jZSwgc3BvdExpZ2h0LmRlY2F5ICk7XG5cdFx0XHRsaWdodC52aXNpYmxlID0gKCBsaWdodC5jb2xvciAhPSB2ZWMzKCAwLjAgKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsaWdodC5jb2xvciA9IHZlYzMoIDAuMCApO1xuXHRcdFx0bGlnaHQudmlzaWJsZSA9IGZhbHNlO1xuXHRcdH1cblx0fVxuI2VuZGlmXG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBSZWN0QXJlYUxpZ2h0IHtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0O1xuXHR9O1xuXHR1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMTtcdHVuaWZvcm0gc2FtcGxlcjJEIGx0Y18yO1xuXHR1bmlmb3JtIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodHNbIE5VTV9SRUNUX0FSRUFfTElHSFRTIF07XG4jZW5kaWZcbiNpZiBOVU1fSEVNSV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBIZW1pc3BoZXJlTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgc2t5Q29sb3I7XG5cdFx0dmVjMyBncm91bmRDb2xvcjtcblx0fTtcblx0dW5pZm9ybSBIZW1pc3BoZXJlTGlnaHQgaGVtaXNwaGVyZUxpZ2h0c1sgTlVNX0hFTUlfTElHSFRTIF07XG5cdHZlYzMgZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gSGVtaXNwaGVyZUxpZ2h0IGhlbWlMaWdodCwgY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdFx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgaGVtaUxpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGhlbWlEaWZmdXNlV2VpZ2h0ID0gMC41ICogZG90TkwgKyAwLjU7XG5cdFx0dmVjMyBpcnJhZGlhbmNlID0gbWl4KCBoZW1pTGlnaHQuZ3JvdW5kQ29sb3IsIGhlbWlMaWdodC5za3lDb2xvciwgaGVtaURpZmZ1c2VXZWlnaHQgKTtcblx0XHRyZXR1cm4gaXJyYWRpYW5jZTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0dmVjMyBnZXRJQkxJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiB3b3JsZE5vcm1hbCwgMS4wICk7XG5cdFx0XHRyZXR1cm4gUEkgKiBlbnZNYXBDb2xvci5yZ2IgKiBlbnZNYXBJbnRlbnNpdHk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHQjZW5kaWZcblx0fVxuXHR2ZWMzIGdldElCTFJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZmxlY3QoIC0gdmlld0Rpciwgbm9ybWFsICk7XG5cdFx0XHRyZWZsZWN0VmVjID0gbm9ybWFsaXplKCBtaXgoIHJlZmxlY3RWZWMsIG5vcm1hbCwgcm91Z2huZXNzICogcm91Z2huZXNzKSApO1xuXHRcdFx0cmVmbGVjdFZlYyA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHJlZmxlY3RWZWMsIHZpZXdNYXRyaXggKTtcblx0XHRcdHZlYzQgZW52TWFwQ29sb3IgPSB0ZXh0dXJlQ3ViZVVWKCBlbnZNYXAsIGVudk1hcFJvdGF0aW9uICogcmVmbGVjdFZlYywgcm91Z2huZXNzICk7XG5cdFx0XHRyZXR1cm4gZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdmVjMyggMC4wICk7XG5cdFx0I2VuZGlmXG5cdH1cblx0I2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdFx0dmVjMyBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgY29uc3QgaW4gdmVjMyBiaXRhbmdlbnQsIGNvbnN0IGluIGZsb2F0IGFuaXNvdHJvcHkgKSB7XG5cdFx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0XHR2ZWMzIGJlbnROb3JtYWwgPSBjcm9zcyggYml0YW5nZW50LCB2aWV3RGlyICk7XG5cdFx0XHRcdGJlbnROb3JtYWwgPSBub3JtYWxpemUoIGNyb3NzKCBiZW50Tm9ybWFsLCBiaXRhbmdlbnQgKSApO1xuXHRcdFx0XHRiZW50Tm9ybWFsID0gbm9ybWFsaXplKCBtaXgoIGJlbnROb3JtYWwsIG5vcm1hbCwgcG93MiggcG93MiggMS4wIC0gYW5pc290cm9weSAqICggMS4wIC0gcm91Z2huZXNzICkgKSApICkgKTtcblx0XHRcdFx0cmV0dXJuIGdldElCTFJhZGlhbmNlKCB2aWV3RGlyLCBiZW50Tm9ybWFsLCByb3VnaG5lc3MgKTtcblx0XHRcdCNlbHNlXG5cdFx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHRcdCNlbmRpZlxuXHRcdH1cblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBsaWdodHNfdG9vbl9mcmFnbWVudCA9ICJUb29uTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiOyI7CgogICAgdmFyIGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5zdHJ1Y3QgVG9vbk1hdGVyaWFsIHtcblx0dmVjMyBkaWZmdXNlQ29sb3I7XG59O1xudm9pZCBSRV9EaXJlY3RfVG9vbiggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX1Rvb24oIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9Ub29uXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiI7CgogICAgdmFyIGxpZ2h0c19waG9uZ19mcmFnbWVudCA9ICJCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiO1xubWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IHNwZWN1bGFyO1xubWF0ZXJpYWwuc3BlY3VsYXJTaGluaW5lc3MgPSBzaGluaW5lc3M7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwoKICAgIHZhciBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBCbGlublBob25nTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0dmVjMyBzcGVjdWxhckNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclNoaW5pbmVzcztcblx0ZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbn07XG52b2lkIFJFX0RpcmVjdF9CbGlublBob25nKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogQlJERl9CbGlublBob25nKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzICkgKiBtYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZyggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X0JsaW5uUGhvbmdcbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9CbGlublBob25nIjsKCiAgICB2YXIgbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50ID0gIlBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiICogKCAxLjAgLSBtZXRhbG5lc3NGYWN0b3IgKTtcbnZlYzMgZHh5ID0gbWF4KCBhYnMoIGRGZHgoIG5vblBlcnR1cmJlZE5vcm1hbCApICksIGFicyggZEZkeSggbm9uUGVydHVyYmVkTm9ybWFsICkgKSApO1xuZmxvYXQgZ2VvbWV0cnlSb3VnaG5lc3MgPSBtYXgoIG1heCggZHh5LngsIGR4eS55ICksIGR4eS56ICk7XG5tYXRlcmlhbC5yb3VnaG5lc3MgPSBtYXgoIHJvdWdobmVzc0ZhY3RvciwgMC4wNTI1ICk7bWF0ZXJpYWwucm91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xubWF0ZXJpYWwucm91Z2huZXNzID0gbWluKCBtYXRlcmlhbC5yb3VnaG5lc3MsIDEuMCApO1xuI2lmZGVmIElPUlxuXHRtYXRlcmlhbC5pb3IgPSBpb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0XHRmbG9hdCBzcGVjdWxhckludGVuc2l0eUZhY3RvciA9IHNwZWN1bGFySW50ZW5zaXR5O1xuXHRcdHZlYzMgc3BlY3VsYXJDb2xvckZhY3RvciA9IHNwZWN1bGFyQ29sb3I7XG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdFx0c3BlY3VsYXJDb2xvckZhY3RvciAqPSB0ZXh0dXJlMkQoIHNwZWN1bGFyQ29sb3JNYXAsIHZTcGVjdWxhckNvbG9yTWFwVXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHRcdHNwZWN1bGFySW50ZW5zaXR5RmFjdG9yICo9IHRleHR1cmUyRCggc3BlY3VsYXJJbnRlbnNpdHlNYXAsIHZTcGVjdWxhckludGVuc2l0eU1hcFV2ICkuYTtcblx0XHQjZW5kaWZcblx0XHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IG1peCggc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIDEuMCwgbWV0YWxuZXNzRmFjdG9yICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IgPSAxLjA7XG5cdFx0dmVjMyBzcGVjdWxhckNvbG9yRmFjdG9yID0gdmVjMyggMS4wICk7XG5cdFx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCBtaW4oIHBvdzIoICggbWF0ZXJpYWwuaW9yIC0gMS4wICkgLyAoIG1hdGVyaWFsLmlvciArIDEuMCApICkgKiBzcGVjdWxhckNvbG9yRmFjdG9yLCB2ZWMzKCAxLjAgKSApICogc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuI2Vsc2Vcblx0bWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IG1peCggdmVjMyggMC4wNCApLCBkaWZmdXNlQ29sb3IucmdiLCBtZXRhbG5lc3NGYWN0b3IgKTtcblx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IGNsZWFyY29hdDtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gY2xlYXJjb2F0Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRGMCA9IHZlYzMoIDAuMDQgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0RjkwID0gMS4wO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdCAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE1hcCwgdkNsZWFyY29hdE1hcFV2ICkueDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdFJvdWdobmVzc01hcCwgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2ICkueTtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IHNhdHVyYXRlKCBtYXRlcmlhbC5jbGVhcmNvYXQgKTtcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IG1heCggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCAwLjA1MjUgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRElTUEVSU0lPTlxuXHRtYXRlcmlhbC5kaXNwZXJzaW9uID0gZGlzcGVyc2lvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IGlyaWRlc2NlbmNlO1xuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUiA9IGlyaWRlc2NlbmNlSU9SO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgKj0gdGV4dHVyZTJEKCBpcmlkZXNjZW5jZU1hcCwgdklyaWRlc2NlbmNlTWFwVXYgKS5yO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcyA9IChpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0gLSBpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0pICogdGV4dHVyZTJEKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcCwgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgKS5nICsgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHQjZWxzZVxuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID0gaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHRtYXRlcmlhbC5zaGVlbkNvbG9yID0gc2hlZW5Db2xvcjtcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdG1hdGVyaWFsLnNoZWVuQ29sb3IgKj0gdGV4dHVyZTJEKCBzaGVlbkNvbG9yTWFwLCB2U2hlZW5Db2xvck1hcFV2ICkucmdiO1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgPSBjbGFtcCggc2hlZW5Sb3VnaG5lc3MsIDAuMDcsIDEuMCApO1xuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzICo9IHRleHR1cmUyRCggc2hlZW5Sb3VnaG5lc3NNYXAsIHZTaGVlblJvdWdobmVzc01hcFV2ICkuYTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHRtYXQyIGFuaXNvdHJvcHlNYXQgPSBtYXQyKCBhbmlzb3Ryb3B5VmVjdG9yLngsIGFuaXNvdHJvcHlWZWN0b3IueSwgLSBhbmlzb3Ryb3B5VmVjdG9yLnksIGFuaXNvdHJvcHlWZWN0b3IueCApO1xuXHRcdHZlYzMgYW5pc290cm9weVBvbGFyID0gdGV4dHVyZTJEKCBhbmlzb3Ryb3B5TWFwLCB2QW5pc290cm9weU1hcFV2ICkucmdiO1xuXHRcdHZlYzIgYW5pc290cm9weVYgPSBhbmlzb3Ryb3B5TWF0ICogbm9ybWFsaXplKCAyLjAgKiBhbmlzb3Ryb3B5UG9sYXIucmcgLSB2ZWMyKCAxLjAgKSApICogYW5pc290cm9weVBvbGFyLmI7XG5cdCNlbHNlXG5cdFx0dmVjMiBhbmlzb3Ryb3B5ViA9IGFuaXNvdHJvcHlWZWN0b3I7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5hbmlzb3Ryb3B5ID0gbGVuZ3RoKCBhbmlzb3Ryb3B5ViApO1xuXHRpZiggbWF0ZXJpYWwuYW5pc290cm9weSA9PSAwLjAgKSB7XG5cdFx0YW5pc290cm9weVYgPSB2ZWMyKCAxLjAsIDAuMCApO1xuXHR9IGVsc2Uge1xuXHRcdGFuaXNvdHJvcHlWIC89IG1hdGVyaWFsLmFuaXNvdHJvcHk7XG5cdFx0bWF0ZXJpYWwuYW5pc290cm9weSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICk7XG5cdH1cblx0bWF0ZXJpYWwuYWxwaGFUID0gbWl4KCBwb3cyKCBtYXRlcmlhbC5yb3VnaG5lc3MgKSwgMS4wLCBwb3cyKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICkgKTtcblx0bWF0ZXJpYWwuYW5pc290cm9weVQgPSB0Ym5bIDAgXSAqIGFuaXNvdHJvcHlWLnggKyB0Ym5bIDEgXSAqIGFuaXNvdHJvcHlWLnk7XG5cdG1hdGVyaWFsLmFuaXNvdHJvcHlCID0gdGJuWyAxIF0gKiBhbmlzb3Ryb3B5Vi54IC0gdGJuWyAwIF0gKiBhbmlzb3Ryb3B5Vi55O1xuI2VuZGlmIjsKCiAgICB2YXIgbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAic3RydWN0IFBoeXNpY2FsTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0ZmxvYXQgcm91Z2huZXNzO1xuXHR2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdGZsb2F0IHNwZWN1bGFyRjkwO1xuXHRmbG9hdCBkaXNwZXJzaW9uO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGZsb2F0IGNsZWFyY29hdDtcblx0XHRmbG9hdCBjbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0dmVjMyBjbGVhcmNvYXRGMDtcblx0XHRmbG9hdCBjbGVhcmNvYXRGOTA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2U7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3M7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUZyZXNuZWw7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUYwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHZlYzMgc2hlZW5Db2xvcjtcblx0XHRmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2VuZGlmXG5cdCNpZmRlZiBJT1Jcblx0XHRmbG9hdCBpb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRcdGZsb2F0IHRyYW5zbWlzc2lvbjtcblx0XHRmbG9hdCB0cmFuc21pc3Npb25BbHBoYTtcblx0XHRmbG9hdCB0aGlja25lc3M7XG5cdFx0ZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHR2ZWMzIGF0dGVudWF0aW9uQ29sb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRmbG9hdCBhbmlzb3Ryb3B5O1xuXHRcdGZsb2F0IGFscGhhVDtcblx0XHR2ZWMzIGFuaXNvdHJvcHlUO1xuXHRcdHZlYzMgYW5pc290cm9weUI7XG5cdCNlbmRpZlxufTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXJEaXJlY3QgPSB2ZWMzKCAwLjAgKTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCA9IHZlYzMoIDAuMCApO1xudmVjMyBzaGVlblNwZWN1bGFyRGlyZWN0ID0gdmVjMyggMC4wICk7XG52ZWMzIHNoZWVuU3BlY3VsYXJJbmRpcmVjdCA9IHZlYzMoMC4wICk7XG52ZWMzIFNjaGxpY2tfdG9fRjAoIGNvbnN0IGluIHZlYzMgZiwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcbiAgICBmbG9hdCB4ID0gY2xhbXAoIDEuMCAtIGRvdFZILCAwLjAsIDEuMCApO1xuICAgIGZsb2F0IHgyID0geCAqIHg7XG4gICAgZmxvYXQgeDUgPSBjbGFtcCggeCAqIHgyICogeDIsIDAuMCwgMC45OTk5ICk7XG4gICAgcmV0dXJuICggZiAtIHZlYzMoIGY5MCApICogeDUgKSAvICggMS4wIC0geDUgKTtcbn1cbmZsb2F0IFZfR0dYX1NtaXRoQ29ycmVsYXRlZCggY29uc3QgaW4gZmxvYXQgYWxwaGEsIGNvbnN0IGluIGZsb2F0IGRvdE5MLCBjb25zdCBpbiBmbG9hdCBkb3ROViApIHtcblx0ZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuXHRmbG9hdCBndiA9IGRvdE5MICogc3FydCggYTIgKyAoIDEuMCAtIGEyICkgKiBwb3cyKCBkb3ROViApICk7XG5cdGZsb2F0IGdsID0gZG90TlYgKiBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5MICkgKTtcblx0cmV0dXJuIDAuNSAvIG1heCggZ3YgKyBnbCwgRVBTSUxPTiApO1xufVxuZmxvYXQgRF9HR1goIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROSCApIHtcblx0ZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuXHRmbG9hdCBkZW5vbSA9IHBvdzIoIGRvdE5IICkgKiAoIGEyIC0gMS4wICkgKyAxLjA7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogYTIgLyBwb3cyKCBkZW5vbSApO1xufVxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdGZsb2F0IFZfR0dYX1NtaXRoQ29ycmVsYXRlZF9Bbmlzb3Ryb3BpYyggY29uc3QgaW4gZmxvYXQgYWxwaGFULCBjb25zdCBpbiBmbG9hdCBhbHBoYUIsIGNvbnN0IGluIGZsb2F0IGRvdFRWLCBjb25zdCBpbiBmbG9hdCBkb3RCViwgY29uc3QgaW4gZmxvYXQgZG90VEwsIGNvbnN0IGluIGZsb2F0IGRvdEJMLCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgZG90TkwgKSB7XG5cdFx0ZmxvYXQgZ3YgPSBkb3ROTCAqIGxlbmd0aCggdmVjMyggYWxwaGFUICogZG90VFYsIGFscGhhQiAqIGRvdEJWLCBkb3ROViApICk7XG5cdFx0ZmxvYXQgZ2wgPSBkb3ROViAqIGxlbmd0aCggdmVjMyggYWxwaGFUICogZG90VEwsIGFscGhhQiAqIGRvdEJMLCBkb3ROTCApICk7XG5cdFx0ZmxvYXQgdiA9IDAuNSAvICggZ3YgKyBnbCApO1xuXHRcdHJldHVybiBzYXR1cmF0ZSh2KTtcblx0fVxuXHRmbG9hdCBEX0dHWF9Bbmlzb3Ryb3BpYyggY29uc3QgaW4gZmxvYXQgYWxwaGFULCBjb25zdCBpbiBmbG9hdCBhbHBoYUIsIGNvbnN0IGluIGZsb2F0IGRvdE5ILCBjb25zdCBpbiBmbG9hdCBkb3RUSCwgY29uc3QgaW4gZmxvYXQgZG90QkggKSB7XG5cdFx0ZmxvYXQgYTIgPSBhbHBoYVQgKiBhbHBoYUI7XG5cdFx0aGlnaHAgdmVjMyB2ID0gdmVjMyggYWxwaGFCICogZG90VEgsIGFscGhhVCAqIGRvdEJILCBhMiAqIGRvdE5IICk7XG5cdFx0aGlnaHAgZmxvYXQgdjIgPSBkb3QoIHYsIHYgKTtcblx0XHRmbG9hdCB3MiA9IGEyIC8gdjI7XG5cdFx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBhMiAqIHBvdzIgKCB3MiApO1xuXHR9XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHZlYzMgQlJERl9HR1hfQ2xlYXJjb2F0KCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsKSB7XG5cdFx0dmVjMyBmMCA9IG1hdGVyaWFsLmNsZWFyY29hdEYwO1xuXHRcdGZsb2F0IGY5MCA9IG1hdGVyaWFsLmNsZWFyY29hdEY5MDtcblx0XHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0XHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRcdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdFx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRcdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0XHRmbG9hdCBkb3RWSCA9IHNhdHVyYXRlKCBkb3QoIHZpZXdEaXIsIGhhbGZEaXIgKSApO1xuXHRcdHZlYzMgRiA9IEZfU2NobGljayggZjAsIGY5MCwgZG90VkggKTtcblx0XHRmbG9hdCBWID0gVl9HR1hfU21pdGhDb3JyZWxhdGVkKCBhbHBoYSwgZG90TkwsIGRvdE5WICk7XG5cdFx0ZmxvYXQgRCA9IERfR0dYKCBhbHBoYSwgZG90TkggKTtcblx0XHRyZXR1cm4gRiAqICggViAqIEQgKTtcblx0fVxuI2VuZGlmXG52ZWMzIEJSREZfR0dYKCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsICkge1xuXHR2ZWMzIGYwID0gbWF0ZXJpYWwuc3BlY3VsYXJDb2xvcjtcblx0ZmxvYXQgZjkwID0gbWF0ZXJpYWwuc3BlY3VsYXJGOTA7XG5cdGZsb2F0IHJvdWdobmVzcyA9IG1hdGVyaWFsLnJvdWdobmVzcztcblx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBsaWdodERpciArIHZpZXdEaXIgKTtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggZjAsIGY5MCwgZG90VkggKTtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRcdEYgPSBtaXgoIEYsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdGZsb2F0IGRvdFRMID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgbGlnaHREaXIgKTtcblx0XHRmbG9hdCBkb3RUViA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIHZpZXdEaXIgKTtcblx0XHRmbG9hdCBkb3RUSCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIGhhbGZEaXIgKTtcblx0XHRmbG9hdCBkb3RCTCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIGxpZ2h0RGlyICk7XG5cdFx0ZmxvYXQgZG90QlYgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCB2aWV3RGlyICk7XG5cdFx0ZmxvYXQgZG90QkggPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCBoYWxmRGlyICk7XG5cdFx0ZmxvYXQgViA9IFZfR0dYX1NtaXRoQ29ycmVsYXRlZF9Bbmlzb3Ryb3BpYyggbWF0ZXJpYWwuYWxwaGFULCBhbHBoYSwgZG90VFYsIGRvdEJWLCBkb3RUTCwgZG90QkwsIGRvdE5WLCBkb3ROTCApO1xuXHRcdGZsb2F0IEQgPSBEX0dHWF9Bbmlzb3Ryb3BpYyggbWF0ZXJpYWwuYWxwaGFULCBhbHBoYSwgZG90TkgsIGRvdFRILCBkb3RCSCApO1xuXHQjZWxzZVxuXHRcdGZsb2F0IFYgPSBWX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGFscGhhLCBkb3ROTCwgZG90TlYgKTtcblx0XHRmbG9hdCBEID0gRF9HR1goIGFscGhhLCBkb3ROSCApO1xuXHQjZW5kaWZcblx0cmV0dXJuIEYgKiAoIFYgKiBEICk7XG59XG52ZWMyIExUQ19VdiggY29uc3QgaW4gdmVjMyBOLCBjb25zdCBpbiB2ZWMzIFYsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0Y29uc3QgZmxvYXQgTFVUX1NJWkUgPSA2NC4wO1xuXHRjb25zdCBmbG9hdCBMVVRfU0NBTEUgPSAoIExVVF9TSVpFIC0gMS4wICkgLyBMVVRfU0laRTtcblx0Y29uc3QgZmxvYXQgTFVUX0JJQVMgPSAwLjUgLyBMVVRfU0laRTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBOLCBWICkgKTtcblx0dmVjMiB1diA9IHZlYzIoIHJvdWdobmVzcywgc3FydCggMS4wIC0gZG90TlYgKSApO1xuXHR1diA9IHV2ICogTFVUX1NDQUxFICsgTFVUX0JJQVM7XG5cdHJldHVybiB1djtcbn1cbmZsb2F0IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggY29uc3QgaW4gdmVjMyBmICkge1xuXHRmbG9hdCBsID0gbGVuZ3RoKCBmICk7XG5cdHJldHVybiBtYXgoICggbCAqIGwgKyBmLnogKSAvICggbCArIDEuMCApLCAwLjAgKTtcbn1cbnZlYzMgTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb25zdCBpbiB2ZWMzIHYxLCBjb25zdCBpbiB2ZWMzIHYyICkge1xuXHRmbG9hdCB4ID0gZG90KCB2MSwgdjIgKTtcblx0ZmxvYXQgeSA9IGFicyggeCApO1xuXHRmbG9hdCBhID0gMC44NTQzOTg1ICsgKCAwLjQ5NjUxNTUgKyAwLjAxNDUyMDYgKiB5ICkgKiB5O1xuXHRmbG9hdCBiID0gMy40MTc1OTQwICsgKCA0LjE2MTY3MjQgKyB5ICkgKiB5O1xuXHRmbG9hdCB2ID0gYSAvIGI7XG5cdGZsb2F0IHRoZXRhX3NpbnRoZXRhID0gKCB4ID4gMC4wICkgPyB2IDogMC41ICogaW52ZXJzZXNxcnQoIG1heCggMS4wIC0geCAqIHgsIDFlLTcgKSApIC0gdjtcblx0cmV0dXJuIGNyb3NzKCB2MSwgdjIgKSAqIHRoZXRhX3NpbnRoZXRhO1xufVxudmVjMyBMVENfRXZhbHVhdGUoIGNvbnN0IGluIHZlYzMgTiwgY29uc3QgaW4gdmVjMyBWLCBjb25zdCBpbiB2ZWMzIFAsIGNvbnN0IGluIG1hdDMgbUludiwgY29uc3QgaW4gdmVjMyByZWN0Q29vcmRzWyA0IF0gKSB7XG5cdHZlYzMgdjEgPSByZWN0Q29vcmRzWyAxIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgdjIgPSByZWN0Q29vcmRzWyAzIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgbGlnaHROb3JtYWwgPSBjcm9zcyggdjEsIHYyICk7XG5cdGlmKCBkb3QoIGxpZ2h0Tm9ybWFsLCBQIC0gcmVjdENvb3Jkc1sgMCBdICkgPCAwLjAgKSByZXR1cm4gdmVjMyggMC4wICk7XG5cdHZlYzMgVDEsIFQyO1xuXHRUMSA9IG5vcm1hbGl6ZSggViAtIE4gKiBkb3QoIFYsIE4gKSApO1xuXHRUMiA9IC0gY3Jvc3MoIE4sIFQxICk7XG5cdG1hdDMgbWF0ID0gbUludiAqIHRyYW5zcG9zZU1hdDMoIG1hdDMoIFQxLCBUMiwgTiApICk7XG5cdHZlYzMgY29vcmRzWyA0IF07XG5cdGNvb3Jkc1sgMCBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAwIF0gLSBQICk7XG5cdGNvb3Jkc1sgMSBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAxIF0gLSBQICk7XG5cdGNvb3Jkc1sgMiBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAyIF0gLSBQICk7XG5cdGNvb3Jkc1sgMyBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAzIF0gLSBQICk7XG5cdGNvb3Jkc1sgMCBdID0gbm9ybWFsaXplKCBjb29yZHNbIDAgXSApO1xuXHRjb29yZHNbIDEgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAxIF0gKTtcblx0Y29vcmRzWyAyIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMiBdICk7XG5cdGNvb3Jkc1sgMyBdID0gbm9ybWFsaXplKCBjb29yZHNbIDMgXSApO1xuXHR2ZWMzIHZlY3RvckZvcm1GYWN0b3IgPSB2ZWMzKCAwLjAgKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMCBdLCBjb29yZHNbIDEgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAxIF0sIGNvb3Jkc1sgMiBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDIgXSwgY29vcmRzWyAzIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMyBdLCBjb29yZHNbIDAgXSApO1xuXHRmbG9hdCByZXN1bHQgPSBMVENfQ2xpcHBlZFNwaGVyZUZvcm1GYWN0b3IoIHZlY3RvckZvcm1GYWN0b3IgKTtcblx0cmV0dXJuIHZlYzMoIHJlc3VsdCApO1xufVxuI2lmIGRlZmluZWQoIFVTRV9TSEVFTiApXG5mbG9hdCBEX0NoYXJsaWUoIGZsb2F0IHJvdWdobmVzcywgZmxvYXQgZG90TkggKSB7XG5cdGZsb2F0IGFscGhhID0gcG93Miggcm91Z2huZXNzICk7XG5cdGZsb2F0IGludkFscGhhID0gMS4wIC8gYWxwaGE7XG5cdGZsb2F0IGNvczJoID0gZG90TkggKiBkb3ROSDtcblx0ZmxvYXQgc2luMmggPSBtYXgoIDEuMCAtIGNvczJoLCAwLjAwNzgxMjUgKTtcblx0cmV0dXJuICggMi4wICsgaW52QWxwaGEgKSAqIHBvdyggc2luMmgsIGludkFscGhhICogMC41ICkgLyAoIDIuMCAqIFBJICk7XG59XG5mbG9hdCBWX05ldWJlbHQoIGZsb2F0IGRvdE5WLCBmbG9hdCBkb3ROTCApIHtcblx0cmV0dXJuIHNhdHVyYXRlKCAxLjAgLyAoIDQuMCAqICggZG90TkwgKyBkb3ROViAtIGRvdE5MICogZG90TlYgKSApICk7XG59XG52ZWMzIEJSREZfU2hlZW4oIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIHZlYzMgc2hlZW5Db2xvciwgY29uc3QgaW4gZmxvYXQgc2hlZW5Sb3VnaG5lc3MgKSB7XG5cdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRmbG9hdCBEID0gRF9DaGFybGllKCBzaGVlblJvdWdobmVzcywgZG90TkggKTtcblx0ZmxvYXQgViA9IFZfTmV1YmVsdCggZG90TlYsIGRvdE5MICk7XG5cdHJldHVybiBzaGVlbkNvbG9yICogKCBEICogViApO1xufVxuI2VuZGlmXG5mbG9hdCBJQkxTaGVlbkJSREYoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCByMiA9IHJvdWdobmVzcyAqIHJvdWdobmVzcztcblx0ZmxvYXQgYSA9IHJvdWdobmVzcyA8IDAuMjUgPyAtMzM5LjIgKiByMiArIDE2MS40ICogcm91Z2huZXNzIC0gMjUuOSA6IC04LjQ4ICogcjIgKyAxNC4zICogcm91Z2huZXNzIC0gOS45NTtcblx0ZmxvYXQgYiA9IHJvdWdobmVzcyA8IDAuMjUgPyA0NC4wICogcjIgLSAyMy43ICogcm91Z2huZXNzICsgMy4yNiA6IDEuOTcgKiByMiAtIDMuMjcgKiByb3VnaG5lc3MgKyAwLjcyO1xuXHRmbG9hdCBERyA9IGV4cCggYSAqIGRvdE5WICsgYiApICsgKCByb3VnaG5lc3MgPCAwLjI1ID8gMC4wIDogMC4xICogKCByb3VnaG5lc3MgLSAwLjI1ICkgKTtcblx0cmV0dXJuIHNhdHVyYXRlKCBERyAqIFJFQ0lQUk9DQUxfUEkgKTtcbn1cbnZlYzIgREZHQXBwcm94KCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0Y29uc3QgdmVjNCBjMCA9IHZlYzQoIC0gMSwgLSAwLjAyNzUsIC0gMC41NzIsIDAuMDIyICk7XG5cdGNvbnN0IHZlYzQgYzEgPSB2ZWM0KCAxLCAwLjA0MjUsIDEuMDQsIC0gMC4wNCApO1xuXHR2ZWM0IHIgPSByb3VnaG5lc3MgKiBjMCArIGMxO1xuXHRmbG9hdCBhMDA0ID0gbWluKCByLnggKiByLngsIGV4cDIoIC0gOS4yOCAqIGRvdE5WICkgKSAqIHIueCArIHIueTtcblx0dmVjMiBmYWIgPSB2ZWMyKCAtIDEuMDQsIDEuMDQgKSAqIGEwMDQgKyByLnp3O1xuXHRyZXR1cm4gZmFiO1xufVxudmVjMyBFbnZpcm9ubWVudEJSREYoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0dmVjMiBmYWIgPSBERkdBcHByb3goIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG5cdHJldHVybiBzcGVjdWxhckNvbG9yICogZmFiLnggKyBzcGVjdWxhckY5MCAqIGZhYi55O1xufVxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxudm9pZCBjb21wdXRlTXVsdGlzY2F0dGVyaW5nSXJpZGVzY2VuY2UoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IGlyaWRlc2NlbmNlLCBjb25zdCBpbiB2ZWMzIGlyaWRlc2NlbmNlRjAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgaW5vdXQgdmVjMyBzaW5nbGVTY2F0dGVyLCBpbm91dCB2ZWMzIG11bHRpU2NhdHRlciApIHtcbiNlbHNlXG52b2lkIGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmcoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgaW5vdXQgdmVjMyBzaW5nbGVTY2F0dGVyLCBpbm91dCB2ZWMzIG11bHRpU2NhdHRlciApIHtcbiNlbmRpZlxuXHR2ZWMyIGZhYiA9IERGR0FwcHJveCggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRcdHZlYzMgRnIgPSBtaXgoIHNwZWN1bGFyQ29sb3IsIGlyaWRlc2NlbmNlRjAsIGlyaWRlc2NlbmNlICk7XG5cdCNlbHNlXG5cdFx0dmVjMyBGciA9IHNwZWN1bGFyQ29sb3I7XG5cdCNlbmRpZlxuXHR2ZWMzIEZzc0VzcyA9IEZyICogZmFiLnggKyBzcGVjdWxhckY5MCAqIGZhYi55O1xuXHRmbG9hdCBFc3MgPSBmYWIueCArIGZhYi55O1xuXHRmbG9hdCBFbXMgPSAxLjAgLSBFc3M7XG5cdHZlYzMgRmF2ZyA9IEZyICsgKCAxLjAgLSBGciApICogMC4wNDc2MTk7XHR2ZWMzIEZtcyA9IEZzc0VzcyAqIEZhdmcgLyAoIDEuMCAtIEVtcyAqIEZhdmcgKTtcblx0c2luZ2xlU2NhdHRlciArPSBGc3NFc3M7XG5cdG11bHRpU2NhdHRlciArPSBGbXMgKiBFbXM7XG59XG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHZvaWQgUkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsKCBjb25zdCBpbiBSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRcdHZlYzMgbm9ybWFsID0gZ2VvbWV0cnlOb3JtYWw7XG5cdFx0dmVjMyB2aWV3RGlyID0gZ2VvbWV0cnlWaWV3RGlyO1xuXHRcdHZlYzMgcG9zaXRpb24gPSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdHZlYzMgbGlnaHRQb3MgPSByZWN0QXJlYUxpZ2h0LnBvc2l0aW9uO1xuXHRcdHZlYzMgaGFsZldpZHRoID0gcmVjdEFyZWFMaWdodC5oYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0ID0gcmVjdEFyZWFMaWdodC5oYWxmSGVpZ2h0O1xuXHRcdHZlYzMgbGlnaHRDb2xvciA9IHJlY3RBcmVhTGlnaHQuY29sb3I7XG5cdFx0ZmxvYXQgcm91Z2huZXNzID0gbWF0ZXJpYWwucm91Z2huZXNzO1xuXHRcdHZlYzMgcmVjdENvb3Jkc1sgNCBdO1xuXHRcdHJlY3RDb29yZHNbIDAgXSA9IGxpZ2h0UG9zICsgaGFsZldpZHRoIC0gaGFsZkhlaWdodDtcdFx0cmVjdENvb3Jkc1sgMSBdID0gbGlnaHRQb3MgLSBoYWxmV2lkdGggLSBoYWxmSGVpZ2h0O1xuXHRcdHJlY3RDb29yZHNbIDIgXSA9IGxpZ2h0UG9zIC0gaGFsZldpZHRoICsgaGFsZkhlaWdodDtcblx0XHRyZWN0Q29vcmRzWyAzIF0gPSBsaWdodFBvcyArIGhhbGZXaWR0aCArIGhhbGZIZWlnaHQ7XG5cdFx0dmVjMiB1diA9IExUQ19Vdiggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0XHR2ZWM0IHQxID0gdGV4dHVyZTJEKCBsdGNfMSwgdXYgKTtcblx0XHR2ZWM0IHQyID0gdGV4dHVyZTJEKCBsdGNfMiwgdXYgKTtcblx0XHRtYXQzIG1JbnYgPSBtYXQzKFxuXHRcdFx0dmVjMyggdDEueCwgMCwgdDEueSApLFxuXHRcdFx0dmVjMyggICAgMCwgMSwgICAgMCApLFxuXHRcdFx0dmVjMyggdDEueiwgMCwgdDEudyApXG5cdFx0KTtcblx0XHR2ZWMzIGZyZXNuZWwgPSAoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKiB0Mi54ICsgKCB2ZWMzKCAxLjAgKSAtIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKSAqIHQyLnkgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBsaWdodENvbG9yICogZnJlc25lbCAqIExUQ19FdmFsdWF0ZSggbm9ybWFsLCB2aWV3RGlyLCBwb3NpdGlvbiwgbUludiwgcmVjdENvb3JkcyApO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gbGlnaHRDb2xvciAqIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciAqIExUQ19FdmFsdWF0ZSggbm9ybWFsLCB2aWV3RGlyLCBwb3NpdGlvbiwgbWF0MyggMS4wICksIHJlY3RDb29yZHMgKTtcblx0fVxuI2VuZGlmXG52b2lkIFJFX0RpcmVjdF9QaHlzaWNhbCggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgZG90TkxjYyA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHRcdHZlYzMgY2NJcnJhZGlhbmNlID0gZG90TkxjYyAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRcdGNsZWFyY29hdFNwZWN1bGFyRGlyZWN0ICs9IGNjSXJyYWRpYW5jZSAqIEJSREZfR0dYX0NsZWFyY29hdCggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHNoZWVuU3BlY3VsYXJEaXJlY3QgKz0gaXJyYWRpYW5jZSAqIEJSREZfU2hlZW4oIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwuc2hlZW5Db2xvciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGlycmFkaWFuY2UgKiBCUkRGX0dHWCggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbCApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfUGh5c2ljYWwoIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbCggY29uc3QgaW4gdmVjMyByYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGNsZWFyY29hdFJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCkge1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKz0gY2xlYXJjb2F0UmFkaWFuY2UgKiBFbnZpcm9ubWVudEJSREYoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLmNsZWFyY29hdEYwLCBtYXRlcmlhbC5jbGVhcmNvYXRGOTAsIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHNoZWVuU3BlY3VsYXJJbmRpcmVjdCArPSBpcnJhZGlhbmNlICogbWF0ZXJpYWwuc2hlZW5Db2xvciAqIElCTFNoZWVuQlJERiggZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHZlYzMgc2luZ2xlU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIG11bHRpU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZSA9IGlycmFkaWFuY2UgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0Y29tcHV0ZU11bHRpc2NhdHRlcmluZ0lyaWRlc2NlbmNlKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2Vsc2Vcblx0XHRjb21wdXRlTXVsdGlzY2F0dGVyaW5nKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2VuZGlmXG5cdHZlYzMgdG90YWxTY2F0dGVyaW5nID0gc2luZ2xlU2NhdHRlcmluZyArIG11bHRpU2NhdHRlcmluZztcblx0dmVjMyBkaWZmdXNlID0gbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogKCAxLjAgLSBtYXgoIG1heCggdG90YWxTY2F0dGVyaW5nLnIsIHRvdGFsU2NhdHRlcmluZy5nICksIHRvdGFsU2NhdHRlcmluZy5iICkgKTtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSByYWRpYW5jZSAqIHNpbmdsZVNjYXR0ZXJpbmc7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gbXVsdGlTY2F0dGVyaW5nICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gZGlmZnVzZSAqIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfUGh5c2ljYWxcbiNkZWZpbmUgUkVfRGlyZWN0X1JlY3RBcmVhXHRcdFJFX0RpcmVjdF9SZWN0QXJlYV9QaHlzaWNhbFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0U3BlY3VsYXJcdFx0UkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbFxuZmxvYXQgY29tcHV0ZVNwZWN1bGFyT2NjbHVzaW9uKCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgYW1iaWVudE9jY2x1c2lvbiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHBvdyggZG90TlYgKyBhbWJpZW50T2NjbHVzaW9uLCBleHAyKCAtIDE2LjAgKiByb3VnaG5lc3MgLSAxLjAgKSApIC0gMS4wICsgYW1iaWVudE9jY2x1c2lvbiApO1xufSI7CgogICAgdmFyIGxpZ2h0c19mcmFnbWVudF9iZWdpbiA9ICJcbnZlYzMgZ2VvbWV0cnlQb3NpdGlvbiA9IC0gdlZpZXdQb3NpdGlvbjtcbnZlYzMgZ2VvbWV0cnlOb3JtYWwgPSBub3JtYWw7XG52ZWMzIGdlb21ldHJ5Vmlld0RpciA9ICggaXNPcnRob2dyYXBoaWMgKSA/IHZlYzMoIDAsIDAsIDEgKSA6IG5vcm1hbGl6ZSggdlZpZXdQb3NpdGlvbiApO1xudmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCA9IHZlYzMoIDAuMCApO1xuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0Z2VvbWV0cnlDbGVhcmNvYXROb3JtYWwgPSBjbGVhcmNvYXROb3JtYWw7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0ZmxvYXQgZG90TlZpID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID09IDAuMCApIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IDAuMDtcblx0fSBlbHNlIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSApO1xuXHR9XG5cdGlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPiAwLjAgKSB7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsID0gZXZhbElyaWRlc2NlbmNlKCAxLjAsIG1hdGVyaWFsLmlyaWRlc2NlbmNlSU9SLCBkb3ROVmksIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICk7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGMCA9IFNjaGxpY2tfdG9fRjAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgMS4wLCBkb3ROVmkgKTtcblx0fVxuI2VuZGlmXG5JbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0O1xuI2lmICggTlVNX1BPSU5UX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3QgKVxuXHRQb2ludExpZ2h0IHBvaW50TGlnaHQ7XG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUUzsgaSArKyApIHtcblx0XHRwb2ludExpZ2h0ID0gcG9pbnRMaWdodHNbIGkgXTtcblx0XHRnZXRQb2ludExpZ2h0SW5mbyggcG9pbnRMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIClcblx0XHRwb2ludExpZ2h0U2hhZG93ID0gcG9pbnRMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSAoIGRpcmVjdExpZ2h0LnZpc2libGUgJiYgcmVjZWl2ZVNoYWRvdyApID8gZ2V0UG9pbnRTaGFkb3coIHBvaW50U2hhZG93TWFwWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dJbnRlbnNpdHksIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93QmlhcywgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93Q2FtZXJhTmVhciwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFGYXIgKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1NQT1RfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFNwb3RMaWdodCBzcG90TGlnaHQ7XG5cdHZlYzQgc3BvdENvbG9yO1xuXHR2ZWMzIHNwb3RMaWdodENvb3JkO1xuXHRib29sIGluU3BvdExpZ2h0TWFwO1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3c7XG5cdCNlbmRpZlxuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUUzsgaSArKyApIHtcblx0XHRzcG90TGlnaHQgPSBzcG90TGlnaHRzWyBpIF07XG5cdFx0Z2V0U3BvdExpZ2h0SW5mbyggc3BvdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBkaXJlY3RMaWdodCApO1xuXHRcdCNpZiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBVTlJPTExFRF9MT09QX0lOREVYXG5cdFx0I2VsaWYgKCBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBOVU1fU1BPVF9MSUdIVF9NQVBTXG5cdFx0I2Vsc2Vcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYICggVU5ST0xMRURfTE9PUF9JTkRFWCAtIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgKyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2VuZGlmXG5cdFx0I2lmICggU1BPVF9MSUdIVF9NQVBfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9NQVBTIClcblx0XHRcdHNwb3RMaWdodENvb3JkID0gdlNwb3RMaWdodENvb3JkWyBpIF0ueHl6IC8gdlNwb3RMaWdodENvb3JkWyBpIF0udztcblx0XHRcdGluU3BvdExpZ2h0TWFwID0gYWxsKCBsZXNzVGhhbiggYWJzKCBzcG90TGlnaHRDb29yZCAqIDIuIC0gMS4gKSwgdmVjMyggMS4wICkgKSApO1xuXHRcdFx0c3BvdENvbG9yID0gdGV4dHVyZTJEKCBzcG90TGlnaHRNYXBbIFNQT1RfTElHSFRfTUFQX0lOREVYIF0sIHNwb3RMaWdodENvb3JkLnh5ICk7XG5cdFx0XHRkaXJlY3RMaWdodC5jb2xvciA9IGluU3BvdExpZ2h0TWFwID8gZGlyZWN0TGlnaHQuY29sb3IgKiBzcG90Q29sb3IucmdiIDogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0I2VuZGlmXG5cdFx0I3VuZGVmIFNQT1RfTElHSFRfTUFQX0lOREVYXG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRzcG90TGlnaHRTaGFkb3cgPSBzcG90TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0ludGVuc2l0eSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZTcG90TGlnaHRDb29yZFsgaSBdICkgOiAxLjA7XG5cdFx0I2VuZGlmXG5cdFx0UkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiAoIE5VTV9ESVJfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodDtcblx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG5cdFx0ZGlyZWN0aW9uYWxMaWdodCA9IGRpcmVjdGlvbmFsTGlnaHRzWyBpIF07XG5cdFx0Z2V0RGlyZWN0aW9uYWxMaWdodEluZm8oIGRpcmVjdGlvbmFsTGlnaHQsIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fRElSX0xJR0hUX1NIQURPV1MgKVxuXHRcdGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9ICggZGlyZWN0TGlnaHQudmlzaWJsZSAmJiByZWNlaXZlU2hhZG93ICkgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dJbnRlbnNpdHksIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93QmlhcywgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBpIF0gKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0X1JlY3RBcmVhIClcblx0UmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9SRUNUX0FSRUFfTElHSFRTOyBpICsrICkge1xuXHRcdHJlY3RBcmVhTGlnaHQgPSByZWN0QXJlYUxpZ2h0c1sgaSBdO1xuXHRcdFJFX0RpcmVjdF9SZWN0QXJlYSggcmVjdEFyZWFMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHR2ZWMzIGlibElycmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTtcblx0I2lmIGRlZmluZWQoIFVTRV9MSUdIVF9QUk9CRVMgKVxuXHRcdGlycmFkaWFuY2UgKz0gZ2V0TGlnaHRQcm9iZUlycmFkaWFuY2UoIGxpZ2h0UHJvYmUsIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuXHQjaWYgKCBOVU1fSEVNSV9MSUdIVFMgPiAwIClcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0hFTUlfTElHSFRTOyBpICsrICkge1xuXHRcdFx0aXJyYWRpYW5jZSArPSBnZXRIZW1pc3BoZXJlTGlnaHRJcnJhZGlhbmNlKCBoZW1pc3BoZXJlTGlnaHRzWyBpIF0sIGdlb21ldHJ5Tm9ybWFsICk7XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdHZlYzMgcmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcblx0dmVjMyBjbGVhcmNvYXRSYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuI2VuZGlmIjsKCiAgICB2YXIgbGlnaHRzX2ZyYWdtZW50X21hcHMgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdCNpZmRlZiBVU0VfTElHSFRNQVBcblx0XHR2ZWM0IGxpZ2h0TWFwVGV4ZWwgPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2TGlnaHRNYXBVdiApO1xuXHRcdHZlYzMgbGlnaHRNYXBJcnJhZGlhbmNlID0gbGlnaHRNYXBUZXhlbC5yZ2IgKiBsaWdodE1hcEludGVuc2l0eTtcblx0XHRpcnJhZGlhbmNlICs9IGxpZ2h0TWFwSXJyYWRpYW5jZTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKSAmJiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHRpYmxJcnJhZGlhbmNlICs9IGdldElCTElycmFkaWFuY2UoIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuYW5pc290cm9weUIsIG1hdGVyaWFsLmFuaXNvdHJvcHkgKTtcblx0I2Vsc2Vcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxSYWRpYW5jZSggZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwucm91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFJhZGlhbmNlICs9IGdldElCTFJhZGlhbmNlKCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBsaWdodHNfZnJhZ21lbnRfZW5kID0gIiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHRSRV9JbmRpcmVjdERpZmZ1c2UoIGlycmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHRSRV9JbmRpcmVjdFNwZWN1bGFyKCByYWRpYW5jZSwgaWJsSXJyYWRpYW5jZSwgY2xlYXJjb2F0UmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZiI7CgogICAgdmFyIGxvZ2RlcHRoYnVmX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKVxuXHRnbF9GcmFnRGVwdGggPSB2SXNQZXJzcGVjdGl2ZSA9PSAwLjAgPyBnbF9GcmFnQ29vcmQueiA6IGxvZzIoIHZGcmFnRGVwdGggKSAqIGxvZ0RlcHRoQnVmRkMgKiAwLjU7XG4jZW5kaWYiOwoKICAgIHZhciBsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKVxuXHR1bmlmb3JtIGZsb2F0IGxvZ0RlcHRoQnVmRkM7XG5cdHZhcnlpbmcgZmxvYXQgdkZyYWdEZXB0aDtcblx0dmFyeWluZyBmbG9hdCB2SXNQZXJzcGVjdGl2ZTtcbiNlbmRpZiI7CgogICAgdmFyIGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuXHR2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuI2VuZGlmIjsKCiAgICB2YXIgbG9nZGVwdGhidWZfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0dkZyYWdEZXB0aCA9IDEuMCArIGdsX1Bvc2l0aW9uLnc7XG5cdHZJc1BlcnNwZWN0aXZlID0gZmxvYXQoIGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSApO1xuI2VuZGlmIjsKCiAgICB2YXIgbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG5cdHZlYzQgc2FtcGxlZERpZmZ1c2VDb2xvciA9IHRleHR1cmUyRCggbWFwLCB2TWFwVXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0c2FtcGxlZERpZmZ1c2VDb2xvciA9IHNSR0JUcmFuc2ZlckVPVEYoIHNhbXBsZWREaWZmdXNlQ29sb3IgKTtcblx0I2VuZGlmXG5cdGRpZmZ1c2VDb2xvciAqPSBzYW1wbGVkRGlmZnVzZUNvbG9yO1xuI2VuZGlmIjsKCiAgICB2YXIgbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmIjsKCiAgICB2YXIgbWFwX3BhcnRpY2xlX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQIClcblx0I2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHRcdHZlYzIgdXYgPSB2VXY7XG5cdCNlbHNlXG5cdFx0dmVjMiB1diA9ICggdXZUcmFuc2Zvcm0gKiB2ZWMzKCBnbF9Qb2ludENvb3JkLngsIDEuMCAtIGdsX1BvaW50Q29vcmQueSwgMSApICkueHk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHRkaWZmdXNlQ29sb3IgKj0gdGV4dHVyZTJEKCBtYXAsIHV2ICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdXYgKS5nO1xuI2VuZGlmIjsKCiAgICB2YXIgbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2Vsc2Vcblx0I2lmIGRlZmluZWQoIFVTRV9NQVAgKSB8fCBkZWZpbmVkKCBVU0VfQUxQSEFNQVAgKVxuXHRcdHVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgogICAgdmFyIG1ldGFsbmVzc21hcF9mcmFnbWVudCA9ICJmbG9hdCBtZXRhbG5lc3NGYWN0b3IgPSBtZXRhbG5lc3M7XG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2ZWM0IHRleGVsTWV0YWxuZXNzID0gdGV4dHVyZTJEKCBtZXRhbG5lc3NNYXAsIHZNZXRhbG5lc3NNYXBVdiApO1xuXHRtZXRhbG5lc3NGYWN0b3IgKj0gdGV4ZWxNZXRhbG5lc3MuYjtcbiNlbmRpZiI7CgogICAgdmFyIG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1ldGFsbmVzc01hcDtcbiNlbmRpZiI7CgogICAgdmFyIG1vcnBoaW5zdGFuY2VfdmVydGV4ID0gIiNpZmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSFxuXHRmbG9hdCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIE1PUlBIVEFSR0VUU19DT1VOVCBdO1xuXHRmbG9hdCBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UgPSB0ZXhlbEZldGNoKCBtb3JwaFRleHR1cmUsIGl2ZWMyKCAwLCBnbF9JbnN0YW5jZUlEICksIDAgKS5yO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0bW9ycGhUYXJnZXRJbmZsdWVuY2VzW2ldID0gIHRleGVsRmV0Y2goIG1vcnBoVGV4dHVyZSwgaXZlYzIoIGkgKyAxLCBnbF9JbnN0YW5jZUlEICksIDAgKS5yO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBtb3JwaGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX01PUlBIQ09MT1JTIClcblx0dkNvbG9yICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTU9SUEhUQVJHRVRTX0NPVU5UOyBpICsrICkge1xuXHRcdCNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkucmdiICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdFx0I2VuZGlmXG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIG1vcnBobm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBITk9STUFMU1xuXHRvYmplY3ROb3JtYWwgKj0gbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSBvYmplY3ROb3JtYWwgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAxICkueHl6ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTXG5cdCNpZm5kZWYgVVNFX0lOU1RBTkNJTkdfTU9SUEhcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgTU9SUEhUQVJHRVRTX0NPVU5UIF07XG5cdCNlbmRpZlxuXHR1bmlmb3JtIHNhbXBsZXIyREFycmF5IG1vcnBoVGFyZ2V0c1RleHR1cmU7XG5cdHVuaWZvcm0gaXZlYzIgbW9ycGhUYXJnZXRzVGV4dHVyZVNpemU7XG5cdHZlYzQgZ2V0TW9ycGgoIGNvbnN0IGluIGludCB2ZXJ0ZXhJbmRleCwgY29uc3QgaW4gaW50IG1vcnBoVGFyZ2V0SW5kZXgsIGNvbnN0IGluIGludCBvZmZzZXQgKSB7XG5cdFx0aW50IHRleGVsSW5kZXggPSB2ZXJ0ZXhJbmRleCAqIE1PUlBIVEFSR0VUU19URVhUVVJFX1NUUklERSArIG9mZnNldDtcblx0XHRpbnQgeSA9IHRleGVsSW5kZXggLyBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdGludCB4ID0gdGV4ZWxJbmRleCAtIHkgKiBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdGl2ZWMzIG1vcnBoVVYgPSBpdmVjMyggeCwgeSwgbW9ycGhUYXJnZXRJbmRleCApO1xuXHRcdHJldHVybiB0ZXhlbEZldGNoKCBtb3JwaFRhcmdldHNUZXh0dXJlLCBtb3JwaFVWLCAwICk7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIG1vcnBodGFyZ2V0X3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuXHR0cmFuc2Zvcm1lZCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHRyYW5zZm9ybWVkICs9IGdldE1vcnBoKCBnbF9WZXJ0ZXhJRCwgaSwgMCApLnh5eiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBub3JtYWxfZnJhZ21lbnRfYmVnaW4gPSAiZmxvYXQgZmFjZURpcmVjdGlvbiA9IGdsX0Zyb250RmFjaW5nID8gMS4wIDogLSAxLjA7XG4jaWZkZWYgRkxBVF9TSEFERURcblx0dmVjMyBmZHggPSBkRmR4KCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgZmR5ID0gZEZkeSggdlZpZXdQb3NpdGlvbiApO1xuXHR2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGZkeCwgZmR5ICkgKTtcbiNlbHNlXG5cdHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7XG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibiA9IG1hdDMoIG5vcm1hbGl6ZSggdlRhbmdlbnQgKSwgbm9ybWFsaXplKCB2Qml0YW5nZW50ICksIG5vcm1hbCApO1xuXHQjZWxzZVxuXHRcdG1hdDMgdGJuID0gZ2V0VGFuZ2VudEZyYW1lKCAtIHZWaWV3UG9zaXRpb24sIG5vcm1hbCxcblx0XHQjaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApXG5cdFx0XHR2Tm9ybWFsTWFwVXZcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApXG5cdFx0XHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXZcblx0XHQjZWxzZVxuXHRcdFx0dlV2XG5cdFx0I2VuZGlmXG5cdFx0KTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym5bMF0gKj0gZmFjZURpcmVjdGlvbjtcblx0XHR0Ym5bMV0gKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibjIgPSBtYXQzKCBub3JtYWxpemUoIHZUYW5nZW50ICksIG5vcm1hbGl6ZSggdkJpdGFuZ2VudCApLCBub3JtYWwgKTtcblx0I2Vsc2Vcblx0XHRtYXQzIHRibjIgPSBnZXRUYW5nZW50RnJhbWUoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym4yWzBdICo9IGZhY2VEaXJlY3Rpb247XG5cdFx0dGJuMlsxXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcbiNlbmRpZlxudmVjMyBub25QZXJ0dXJiZWROb3JtYWwgPSBub3JtYWw7IjsKCiAgICB2YXIgbm9ybWFsX2ZyYWdtZW50X21hcHMgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0Vcblx0bm9ybWFsID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHRub3JtYWwgPSAtIG5vcm1hbDtcblx0I2VuZGlmXG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgPSBub3JtYWwgKiBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcblx0bm9ybWFsID0gbm9ybWFsaXplKCBub3JtYWxNYXRyaXggKiBub3JtYWwgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmVjMyBtYXBOID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0bWFwTi54eSAqPSBub3JtYWxTY2FsZTtcblx0bm9ybWFsID0gbm9ybWFsaXplKCB0Ym4gKiBtYXBOICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApXG5cdG5vcm1hbCA9IHBlcnR1cmJOb3JtYWxBcmIoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSwgZmFjZURpcmVjdGlvbiApO1xuI2VuZGlmIjsKCiAgICB2YXIgbm9ybWFsX3BhcnNfZnJhZ21lbnQgPSAiI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuXHRcdHZhcnlpbmcgdmVjMyB2Qml0YW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIG5vcm1hbF9wYXJzX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgbm9ybWFsX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZOb3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZUYW5nZW50ID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZFRhbmdlbnQgKTtcblx0XHR2Qml0YW5nZW50ID0gbm9ybWFsaXplKCBjcm9zcyggdk5vcm1hbCwgdlRhbmdlbnQgKSAqIHRhbmdlbnQudyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG5vcm1hbE1hcDtcblx0dW5pZm9ybSB2ZWMyIG5vcm1hbFNjYWxlO1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRVxuXHR1bmlmb3JtIG1hdDMgbm9ybWFsTWF0cml4O1xuI2VuZGlmXG4jaWYgISBkZWZpbmVkICggVVNFX1RBTkdFTlQgKSAmJiAoIGRlZmluZWQgKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQgKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZICkgKVxuXHRtYXQzIGdldFRhbmdlbnRGcmFtZSggdmVjMyBleWVfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiB1diApIHtcblx0XHR2ZWMzIHEwID0gZEZkeCggZXllX3Bvcy54eXogKTtcblx0XHR2ZWMzIHExID0gZEZkeSggZXllX3Bvcy54eXogKTtcblx0XHR2ZWMyIHN0MCA9IGRGZHgoIHV2LnN0ICk7XG5cdFx0dmVjMiBzdDEgPSBkRmR5KCB1di5zdCApO1xuXHRcdHZlYzMgTiA9IHN1cmZfbm9ybTtcblx0XHR2ZWMzIHExcGVycCA9IGNyb3NzKCBxMSwgTiApO1xuXHRcdHZlYzMgcTBwZXJwID0gY3Jvc3MoIE4sIHEwICk7XG5cdFx0dmVjMyBUID0gcTFwZXJwICogc3QwLnggKyBxMHBlcnAgKiBzdDEueDtcblx0XHR2ZWMzIEIgPSBxMXBlcnAgKiBzdDAueSArIHEwcGVycCAqIHN0MS55O1xuXHRcdGZsb2F0IGRldCA9IG1heCggZG90KCBULCBUICksIGRvdCggQiwgQiApICk7XG5cdFx0ZmxvYXQgc2NhbGUgPSAoIGRldCA9PSAwLjAgKSA/IDAuMCA6IGludmVyc2VzcXJ0KCBkZXQgKTtcblx0XHRyZXR1cm4gbWF0MyggVCAqIHNjYWxlLCBCICogc2NhbGUsIE4gKTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHR2ZWMzIGNsZWFyY29hdE5vcm1hbCA9IG5vblBlcnR1cmJlZE5vcm1hbDtcbiNlbmRpZiI7CgogICAgdmFyIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dmVjMyBjbGVhcmNvYXRNYXBOID0gdGV4dHVyZTJEKCBjbGVhcmNvYXROb3JtYWxNYXAsIHZDbGVhcmNvYXROb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0Y2xlYXJjb2F0TWFwTi54eSAqPSBjbGVhcmNvYXROb3JtYWxTY2FsZTtcblx0Y2xlYXJjb2F0Tm9ybWFsID0gbm9ybWFsaXplKCB0Ym4yICogY2xlYXJjb2F0TWFwTiApO1xuI2VuZGlmIjsKCiAgICB2YXIgY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0TWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0Tm9ybWFsTWFwO1xuXHR1bmlmb3JtIHZlYzIgY2xlYXJjb2F0Tm9ybWFsU2NhbGU7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXRSb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKICAgIHZhciBpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgaXJpZGVzY2VuY2VNYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwO1xuI2VuZGlmIjsKCiAgICB2YXIgb3BhcXVlX2ZyYWdtZW50ID0gIiNpZmRlZiBPUEFRVUVcbmRpZmZ1c2VDb2xvci5hID0gMS4wO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuZGlmZnVzZUNvbG9yLmEgKj0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGE7XG4jZW5kaWZcbmdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7IjsKCiAgICB2YXIgcGFja2luZyA9ICJ2ZWMzIHBhY2tOb3JtYWxUb1JHQiggY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdHJldHVybiBub3JtYWxpemUoIG5vcm1hbCApICogMC41ICsgMC41O1xufVxudmVjMyB1bnBhY2tSR0JUb05vcm1hbCggY29uc3QgaW4gdmVjMyByZ2IgKSB7XG5cdHJldHVybiAyLjAgKiByZ2IueHl6IC0gMS4wO1xufVxuY29uc3QgZmxvYXQgUGFja1Vwc2NhbGUgPSAyNTYuIC8gMjU1Ljtjb25zdCBmbG9hdCBVbnBhY2tEb3duc2NhbGUgPSAyNTUuIC8gMjU2Ljtjb25zdCBmbG9hdCBTaGlmdFJpZ2h0OCA9IDEuIC8gMjU2LjtcbmNvbnN0IGZsb2F0IEludjI1NSA9IDEuIC8gMjU1LjtcbmNvbnN0IHZlYzQgUGFja0ZhY3RvcnMgPSB2ZWM0KCAxLjAsIDI1Ni4wLCAyNTYuMCAqIDI1Ni4wLCAyNTYuMCAqIDI1Ni4wICogMjU2LjAgKTtcbmNvbnN0IHZlYzIgVW5wYWNrRmFjdG9yczIgPSB2ZWMyKCBVbnBhY2tEb3duc2NhbGUsIDEuMCAvIFBhY2tGYWN0b3JzLmcgKTtcbmNvbnN0IHZlYzMgVW5wYWNrRmFjdG9yczMgPSB2ZWMzKCBVbnBhY2tEb3duc2NhbGUgLyBQYWNrRmFjdG9ycy5yZywgMS4wIC8gUGFja0ZhY3RvcnMuYiApO1xuY29uc3QgdmVjNCBVbnBhY2tGYWN0b3JzNCA9IHZlYzQoIFVucGFja0Rvd25zY2FsZSAvIFBhY2tGYWN0b3JzLnJnYiwgMS4wIC8gUGFja0ZhY3RvcnMuYSApO1xudmVjNCBwYWNrRGVwdGhUb1JHQkEoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdGlmKCB2IDw9IDAuMCApXG5cdFx0cmV0dXJuIHZlYzQoIDAuLCAwLiwgMC4sIDAuICk7XG5cdGlmKCB2ID49IDEuMCApXG5cdFx0cmV0dXJuIHZlYzQoIDEuLCAxLiwgMS4sIDEuICk7XG5cdGZsb2F0IHZ1Zjtcblx0ZmxvYXQgYWYgPSBtb2RmKCB2ICogUGFja0ZhY3RvcnMuYSwgdnVmICk7XG5cdGZsb2F0IGJmID0gbW9kZiggdnVmICogU2hpZnRSaWdodDgsIHZ1ZiApO1xuXHRmbG9hdCBnZiA9IG1vZGYoIHZ1ZiAqIFNoaWZ0UmlnaHQ4LCB2dWYgKTtcblx0cmV0dXJuIHZlYzQoIHZ1ZiAqIEludjI1NSwgZ2YgKiBQYWNrVXBzY2FsZSwgYmYgKiBQYWNrVXBzY2FsZSwgYWYgKTtcbn1cbnZlYzMgcGFja0RlcHRoVG9SR0IoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdGlmKCB2IDw9IDAuMCApXG5cdFx0cmV0dXJuIHZlYzMoIDAuLCAwLiwgMC4gKTtcblx0aWYoIHYgPj0gMS4wIClcblx0XHRyZXR1cm4gdmVjMyggMS4sIDEuLCAxLiApO1xuXHRmbG9hdCB2dWY7XG5cdGZsb2F0IGJmID0gbW9kZiggdiAqIFBhY2tGYWN0b3JzLmIsIHZ1ZiApO1xuXHRmbG9hdCBnZiA9IG1vZGYoIHZ1ZiAqIFNoaWZ0UmlnaHQ4LCB2dWYgKTtcblx0cmV0dXJuIHZlYzMoIHZ1ZiAqIEludjI1NSwgZ2YgKiBQYWNrVXBzY2FsZSwgYmYgKTtcbn1cbnZlYzIgcGFja0RlcHRoVG9SRyggY29uc3QgaW4gZmxvYXQgdiApIHtcblx0aWYoIHYgPD0gMC4wIClcblx0XHRyZXR1cm4gdmVjMiggMC4sIDAuICk7XG5cdGlmKCB2ID49IDEuMCApXG5cdFx0cmV0dXJuIHZlYzIoIDEuLCAxLiApO1xuXHRmbG9hdCB2dWY7XG5cdGZsb2F0IGdmID0gbW9kZiggdiAqIDI1Ni4sIHZ1ZiApO1xuXHRyZXR1cm4gdmVjMiggdnVmICogSW52MjU1LCBnZiApO1xufVxuZmxvYXQgdW5wYWNrUkdCQVRvRGVwdGgoIGNvbnN0IGluIHZlYzQgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9yczQgKTtcbn1cbmZsb2F0IHVucGFja1JHQlRvRGVwdGgoIGNvbnN0IGluIHZlYzMgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9yczMgKTtcbn1cbmZsb2F0IHVucGFja1JHVG9EZXB0aCggY29uc3QgaW4gdmVjMiB2ICkge1xuXHRyZXR1cm4gdi5yICogVW5wYWNrRmFjdG9yczIuciArIHYuZyAqIFVucGFja0ZhY3RvcnMyLmc7XG59XG52ZWM0IHBhY2sySGFsZlRvUkdCQSggY29uc3QgaW4gdmVjMiB2ICkge1xuXHR2ZWM0IHIgPSB2ZWM0KCB2LngsIGZyYWN0KCB2LnggKiAyNTUuMCApLCB2LnksIGZyYWN0KCB2LnkgKiAyNTUuMCApICk7XG5cdHJldHVybiB2ZWM0KCByLnggLSByLnkgLyAyNTUuMCwgci55LCByLnogLSByLncgLyAyNTUuMCwgci53ICk7XG59XG52ZWMyIHVucGFja1JHQkFUbzJIYWxmKCBjb25zdCBpbiB2ZWM0IHYgKSB7XG5cdHJldHVybiB2ZWMyKCB2LnggKyAoIHYueSAvIDI1NS4wICksIHYueiArICggdi53IC8gMjU1LjAgKSApO1xufVxuZmxvYXQgdmlld1pUb09ydGhvZ3JhcGhpY0RlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCB2aWV3WiArIG5lYXIgKSAvICggbmVhciAtIGZhciApO1xufVxuZmxvYXQgb3J0aG9ncmFwaGljRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBkZXB0aCwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gZGVwdGggKiAoIG5lYXIgLSBmYXIgKSAtIG5lYXI7XG59XG5mbG9hdCB2aWV3WlRvUGVyc3BlY3RpdmVEZXB0aCggY29uc3QgaW4gZmxvYXQgdmlld1osIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggKCBuZWFyICsgdmlld1ogKSAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIHZpZXdaICk7XG59XG5mbG9hdCBwZXJzcGVjdGl2ZURlcHRoVG9WaWV3WiggY29uc3QgaW4gZmxvYXQgZGVwdGgsIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggbmVhciAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIGRlcHRoIC0gZmFyICk7XG59IjsKCiAgICB2YXIgcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCA9ICIjaWZkZWYgUFJFTVVMVElQTElFRF9BTFBIQVxuXHRnbF9GcmFnQ29sb3IucmdiICo9IGdsX0ZyYWdDb2xvci5hO1xuI2VuZGlmIjsKCiAgICB2YXIgcHJvamVjdF92ZXJ0ZXggPSAidmVjNCBtdlBvc2l0aW9uID0gdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuI2lmZGVmIFVTRV9CQVRDSElOR1xuXHRtdlBvc2l0aW9uID0gYmF0Y2hpbmdNYXRyaXggKiBtdlBvc2l0aW9uO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lOU1RBTkNJTkdcblx0bXZQb3NpdGlvbiA9IGluc3RhbmNlTWF0cml4ICogbXZQb3NpdGlvbjtcbiNlbmRpZlxubXZQb3NpdGlvbiA9IG1vZGVsVmlld01hdHJpeCAqIG12UG9zaXRpb247XG5nbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uOyI7CgogICAgdmFyIGRpdGhlcmluZ19mcmFnbWVudCA9ICIjaWZkZWYgRElUSEVSSU5HXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSBkaXRoZXJpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7CgogICAgdmFyIGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBESVRIRVJJTkdcblx0dmVjMyBkaXRoZXJpbmcoIHZlYzMgY29sb3IgKSB7XG5cdFx0ZmxvYXQgZ3JpZF9wb3NpdGlvbiA9IHJhbmQoIGdsX0ZyYWdDb29yZC54eSApO1xuXHRcdHZlYzMgZGl0aGVyX3NoaWZ0X1JHQiA9IHZlYzMoIDAuMjUgLyAyNTUuMCwgLTAuMjUgLyAyNTUuMCwgMC4yNSAvIDI1NS4wICk7XG5cdFx0ZGl0aGVyX3NoaWZ0X1JHQiA9IG1peCggMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgLTIuMCAqIGRpdGhlcl9zaGlmdF9SR0IsIGdyaWRfcG9zaXRpb24gKTtcblx0XHRyZXR1cm4gY29sb3IgKyBkaXRoZXJfc2hpZnRfUkdCO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciByb3VnaG5lc3NtYXBfZnJhZ21lbnQgPSAiZmxvYXQgcm91Z2huZXNzRmFjdG9yID0gcm91Z2huZXNzO1xuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dmVjNCB0ZXhlbFJvdWdobmVzcyA9IHRleHR1cmUyRCggcm91Z2huZXNzTWFwLCB2Um91Z2huZXNzTWFwVXYgKTtcblx0cm91Z2huZXNzRmFjdG9yICo9IHRleGVsUm91Z2huZXNzLmc7XG4jZW5kaWYiOwoKICAgIHZhciByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCByb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKICAgIHZhciBzaGFkb3dtYXBfcGFyc19mcmFnbWVudCA9ICIjaWYgTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMFxuXHR2YXJ5aW5nIHZlYzQgdlNwb3RMaWdodENvb3JkWyBOVU1fU1BPVF9MSUdIVF9DT09SRFMgXTtcbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUX01BUFMgPiAwXG5cdHVuaWZvcm0gc2FtcGxlcjJEIHNwb3RMaWdodE1hcFsgTlVNX1NQT1RfTElHSFRfTUFQUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwb3RTaGFkb3dNYXBbIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHBvaW50U2hhZG93TWFwWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2UG9pbnRTaGFkb3dDb29yZFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgUG9pbnRMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYU5lYXI7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFGYXI7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvd3NbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHRmbG9hdCB0ZXh0dXJlMkRDb21wYXJlKCBzYW1wbGVyMkQgZGVwdGhzLCB2ZWMyIHV2LCBmbG9hdCBjb21wYXJlICkge1xuXHRcdHJldHVybiBzdGVwKCBjb21wYXJlLCB1bnBhY2tSR0JBVG9EZXB0aCggdGV4dHVyZTJEKCBkZXB0aHMsIHV2ICkgKSApO1xuXHR9XG5cdHZlYzIgdGV4dHVyZTJERGlzdHJpYnV0aW9uKCBzYW1wbGVyMkQgc2hhZG93LCB2ZWMyIHV2ICkge1xuXHRcdHJldHVybiB1bnBhY2tSR0JBVG8ySGFsZiggdGV4dHVyZTJEKCBzaGFkb3csIHV2ICkgKTtcblx0fVxuXHRmbG9hdCBWU01TaGFkb3cgKHNhbXBsZXIyRCBzaGFkb3csIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKXtcblx0XHRmbG9hdCBvY2NsdXNpb24gPSAxLjA7XG5cdFx0dmVjMiBkaXN0cmlidXRpb24gPSB0ZXh0dXJlMkREaXN0cmlidXRpb24oIHNoYWRvdywgdXYgKTtcblx0XHRmbG9hdCBoYXJkX3NoYWRvdyA9IHN0ZXAoIGNvbXBhcmUgLCBkaXN0cmlidXRpb24ueCApO1xuXHRcdGlmIChoYXJkX3NoYWRvdyAhPSAxLjAgKSB7XG5cdFx0XHRmbG9hdCBkaXN0YW5jZSA9IGNvbXBhcmUgLSBkaXN0cmlidXRpb24ueCA7XG5cdFx0XHRmbG9hdCB2YXJpYW5jZSA9IG1heCggMC4wMDAwMCwgZGlzdHJpYnV0aW9uLnkgKiBkaXN0cmlidXRpb24ueSApO1xuXHRcdFx0ZmxvYXQgc29mdG5lc3NfcHJvYmFiaWxpdHkgPSB2YXJpYW5jZSAvICh2YXJpYW5jZSArIGRpc3RhbmNlICogZGlzdGFuY2UgKTtcdFx0XHRzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IGNsYW1wKCAoIHNvZnRuZXNzX3Byb2JhYmlsaXR5IC0gMC4zICkgLyAoIDAuOTUgLSAwLjMgKSwgMC4wLCAxLjAgKTtcdFx0XHRvY2NsdXNpb24gPSBjbGFtcCggbWF4KCBoYXJkX3NoYWRvdywgc29mdG5lc3NfcHJvYmFiaWxpdHkgKSwgMC4wLCAxLjAgKTtcblx0XHR9XG5cdFx0cmV0dXJuIG9jY2x1c2lvbjtcblx0fVxuXHRmbG9hdCBnZXRTaGFkb3coIHNhbXBsZXIyRCBzaGFkb3dNYXAsIHZlYzIgc2hhZG93TWFwU2l6ZSwgZmxvYXQgc2hhZG93SW50ZW5zaXR5LCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHNoYWRvd0Nvb3JkLnh5eiAvPSBzaGFkb3dDb29yZC53O1xuXHRcdHNoYWRvd0Nvb3JkLnogKz0gc2hhZG93Qmlhcztcblx0XHRib29sIGluRnJ1c3R1bSA9IHNoYWRvd0Nvb3JkLnggPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnggPD0gMS4wICYmIHNoYWRvd0Nvb3JkLnkgPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnkgPD0gMS4wO1xuXHRcdGJvb2wgZnJ1c3R1bVRlc3QgPSBpbkZydXN0dW0gJiYgc2hhZG93Q29vcmQueiA8PSAxLjA7XG5cdFx0aWYgKCBmcnVzdHVtVGVzdCApIHtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHgwID0gLSB0ZXhlbFNpemUueCAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR5MCA9IC0gdGV4ZWxTaXplLnkgKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeDEgPSArIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkxID0gKyB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MiA9IGR4MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MiA9IGR5MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR4MyA9IGR4MSAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MyA9IGR5MSAvIDIuMDtcblx0XHRcdHNoYWRvdyA9IChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkyICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCBkeTIgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIGR5MyApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTMgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gMTcuMCApO1xuXHRcdCNlbGlmIGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRl9TT0ZUIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHggPSB0ZXhlbFNpemUueDtcblx0XHRcdGZsb2F0IGR5ID0gdGV4ZWxTaXplLnk7XG5cdFx0XHR2ZWMyIHV2ID0gc2hhZG93Q29vcmQueHk7XG5cdFx0XHR2ZWMyIGYgPSBmcmFjdCggdXYgKiBzaGFkb3dNYXBTaXplICsgMC41ICk7XG5cdFx0XHR1diAtPSBmICogdGV4ZWxTaXplO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCBkeSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdGV4ZWxTaXplLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi54ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueCApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueSApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCBmLnkgKSArXG5cdFx0XHRcdG1peCggbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggLWR4LCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdFx0ICB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBmLnkgKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcblx0XHRcdHNoYWRvdyA9IFZTTVNoYWRvdyggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuXHRcdCNlbHNlXG5cdFx0XHRzaGFkb3cgPSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICk7XG5cdFx0I2VuZGlmXG5cdFx0fVxuXHRcdHJldHVybiBtaXgoIDEuMCwgc2hhZG93LCBzaGFkb3dJbnRlbnNpdHkgKTtcblx0fVxuXHR2ZWMyIGN1YmVUb1VWKCB2ZWMzIHYsIGZsb2F0IHRleGVsU2l6ZVkgKSB7XG5cdFx0dmVjMyBhYnNWID0gYWJzKCB2ICk7XG5cdFx0ZmxvYXQgc2NhbGVUb0N1YmUgPSAxLjAgLyBtYXgoIGFic1YueCwgbWF4KCBhYnNWLnksIGFic1YueiApICk7XG5cdFx0YWJzViAqPSBzY2FsZVRvQ3ViZTtcblx0XHR2ICo9IHNjYWxlVG9DdWJlICogKCAxLjAgLSAyLjAgKiB0ZXhlbFNpemVZICk7XG5cdFx0dmVjMiBwbGFuYXIgPSB2Lnh5O1xuXHRcdGZsb2F0IGFsbW9zdEFUZXhlbCA9IDEuNSAqIHRleGVsU2l6ZVk7XG5cdFx0ZmxvYXQgYWxtb3N0T25lID0gMS4wIC0gYWxtb3N0QVRleGVsO1xuXHRcdGlmICggYWJzVi56ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGlmICggdi56ID4gMC4wIClcblx0XHRcdFx0cGxhbmFyLnggPSA0LjAgLSB2Lng7XG5cdFx0fSBlbHNlIGlmICggYWJzVi54ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25YID0gc2lnbiggdi54ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueiAqIHNpZ25YICsgMi4wICogc2lnblg7XG5cdFx0fSBlbHNlIGlmICggYWJzVi55ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25ZID0gc2lnbiggdi55ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueCArIDIuMCAqIHNpZ25ZICsgMi4wO1xuXHRcdFx0cGxhbmFyLnkgPSB2LnogKiBzaWduWSAtIDIuMDtcblx0XHR9XG5cdFx0cmV0dXJuIHZlYzIoIDAuMTI1LCAwLjI1ICkgKiBwbGFuYXIgKyB2ZWMyKCAwLjM3NSwgMC43NSApO1xuXHR9XG5cdGZsb2F0IGdldFBvaW50U2hhZG93KCBzYW1wbGVyMkQgc2hhZG93TWFwLCB2ZWMyIHNoYWRvd01hcFNpemUsIGZsb2F0IHNoYWRvd0ludGVuc2l0eSwgZmxvYXQgc2hhZG93QmlhcywgZmxvYXQgc2hhZG93UmFkaXVzLCB2ZWM0IHNoYWRvd0Nvb3JkLCBmbG9hdCBzaGFkb3dDYW1lcmFOZWFyLCBmbG9hdCBzaGFkb3dDYW1lcmFGYXIgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHZlYzMgbGlnaHRUb1Bvc2l0aW9uID0gc2hhZG93Q29vcmQueHl6O1xuXHRcdFxuXHRcdGZsb2F0IGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCA9IGxlbmd0aCggbGlnaHRUb1Bvc2l0aW9uICk7XG5cdFx0aWYgKCBsaWdodFRvUG9zaXRpb25MZW5ndGggLSBzaGFkb3dDYW1lcmFGYXIgPD0gMC4wICYmIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYU5lYXIgPj0gMC4wICkge1xuXHRcdFx0ZmxvYXQgZHAgPSAoIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYU5lYXIgKSAvICggc2hhZG93Q2FtZXJhRmFyIC0gc2hhZG93Q2FtZXJhTmVhciApO1x0XHRcdGRwICs9IHNoYWRvd0JpYXM7XG5cdFx0XHR2ZWMzIGJkM0QgPSBub3JtYWxpemUoIGxpZ2h0VG9Qb3NpdGlvbiApO1xuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvICggc2hhZG93TWFwU2l6ZSAqIHZlYzIoIDQuMCwgMi4wICkgKTtcblx0XHRcdCNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCApIHx8IGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1ZTTSApXG5cdFx0XHRcdHZlYzIgb2Zmc2V0ID0gdmVjMiggLSAxLCAxICkgKiBzaGFkb3dSYWRpdXMgKiB0ZXhlbFNpemUueTtcblx0XHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHl5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXl4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eHksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eCwgdGV4ZWxTaXplLnkgKSwgZHAgKVxuXHRcdFx0XHQpICogKCAxLjAgLyA5LjAgKTtcblx0XHRcdCNlbHNlXG5cdFx0XHRcdHNoYWRvdyA9IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QsIHRleGVsU2l6ZS55ICksIGRwICk7XG5cdFx0XHQjZW5kaWZcblx0XHR9XG5cdFx0cmV0dXJuIG1peCggMS4wLCBzaGFkb3csIHNoYWRvd0ludGVuc2l0eSApO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBzaGFkb3dtYXBfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0dW5pZm9ybSBtYXQ0IHNwb3RMaWdodE1hdHJpeFsgTlVNX1NQT1RfTElHSFRfQ09PUkRTIF07XG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHR9O1xuXHRcdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBwb2ludFNoYWRvd01hdHJpeFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IFBvaW50TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93SW50ZW5zaXR5O1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhRmFyO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHRTaGFkb3dzWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIHNoYWRvd21hcF92ZXJ0ZXggPSAiI2lmICggZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMCB8fCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDAgKSApIHx8ICggTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMCApXG5cdHZlYzMgc2hhZG93V29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCB0cmFuc2Zvcm1lZE5vcm1hbCwgdmlld01hdHJpeCApO1xuXHR2ZWM0IHNoYWRvd1dvcmxkUG9zaXRpb247XG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQIClcblx0I2lmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24gKyB2ZWM0KCBzaGFkb3dXb3JsZE5vcm1hbCAqIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBpIF0uc2hhZG93Tm9ybWFsQmlhcywgMCApO1xuXHRcdFx0dkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSA9IGRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRcdHNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uICsgdmVjNCggc2hhZG93V29ybGROb3JtYWwgKiBwb2ludExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXMsIDAgKTtcblx0XHRcdHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0gPSBwb2ludFNoYWRvd01hdHJpeFsgaSBdICogc2hhZG93V29ybGRQb3NpdGlvbjtcblx0XHR9XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRfQ09PUkRTOyBpICsrICkge1xuXHRcdHNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uO1xuXHRcdCNpZiAoIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0XHRzaGFkb3dXb3JsZFBvc2l0aW9uLnh5eiArPSBzaGFkb3dXb3JsZE5vcm1hbCAqIHNwb3RMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzO1xuXHRcdCNlbmRpZlxuXHRcdHZTcG90TGlnaHRDb29yZFsgaSBdID0gc3BvdExpZ2h0TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWYiOwoKICAgIHZhciBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQgPSAiZmxvYXQgZ2V0U2hhZG93TWFzaygpIHtcblx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHQjaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHREaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdGRpcmVjdGlvbmFsTGlnaHQgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBkaXJlY3Rpb25hbFNoYWRvd01hcFsgaSBdLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd01hcFNpemUsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93SW50ZW5zaXR5LCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0c3BvdExpZ2h0ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodC5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHQuc2hhZG93SW50ZW5zaXR5LCBzcG90TGlnaHQuc2hhZG93Qmlhcywgc3BvdExpZ2h0LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0ludGVuc2l0eSwgcG9pbnRMaWdodC5zaGFkb3dCaWFzLCBwb2ludExpZ2h0LnNoYWRvd1JhZGl1cywgdlBvaW50U2hhZG93Q29vcmRbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dDYW1lcmFOZWFyLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYUZhciApIDogMS4wO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjZW5kaWZcblx0cmV0dXJuIHNoYWRvdztcbn0iOwoKICAgIHZhciBza2luYmFzZV92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHRtYXQ0IGJvbmVNYXRYID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnggKTtcblx0bWF0NCBib25lTWF0WSA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC55ICk7XG5cdG1hdDQgYm9uZU1hdFogPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueiApO1xuXHRtYXQ0IGJvbmVNYXRXID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LncgKTtcbiNlbmRpZiI7CgogICAgdmFyIHNraW5uaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBiaW5kTWF0cml4SW52ZXJzZTtcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYm9uZVRleHR1cmU7XG5cdG1hdDQgZ2V0Qm9uZU1hdHJpeCggY29uc3QgaW4gZmxvYXQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBib25lVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjIgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHggKyAxLCB5ICksIDAgKTtcblx0XHR2ZWM0IHYzID0gdGV4ZWxGZXRjaCggYm9uZVRleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJvbmVUZXh0dXJlLCBpdmVjMiggeCArIDMsIHkgKSwgMCApO1xuXHRcdHJldHVybiBtYXQ0KCB2MSwgdjIsIHYzLCB2NCApO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBza2lubmluZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHR2ZWM0IHNraW5WZXJ0ZXggPSBiaW5kTWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuXHR2ZWM0IHNraW5uZWQgPSB2ZWM0KCAwLjAgKTtcblx0c2tpbm5lZCArPSBib25lTWF0WCAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lng7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFkgKiBza2luVmVydGV4ICogc2tpbldlaWdodC55O1xuXHRza2lubmVkICs9IGJvbmVNYXRaICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQuejtcblx0c2tpbm5lZCArPSBib25lTWF0VyAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnc7XG5cdHRyYW5zZm9ybWVkID0gKCBiaW5kTWF0cml4SW52ZXJzZSAqIHNraW5uZWQgKS54eXo7XG4jZW5kaWYiOwoKICAgIHZhciBza2lubm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdG1hdDQgc2tpbk1hdHJpeCA9IG1hdDQoIDAuMCApO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueCAqIGJvbmVNYXRYO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueSAqIGJvbmVNYXRZO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueiAqIGJvbmVNYXRaO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQudyAqIGJvbmVNYXRXO1xuXHRza2luTWF0cml4ID0gYmluZE1hdHJpeEludmVyc2UgKiBza2luTWF0cml4ICogYmluZE1hdHJpeDtcblx0b2JqZWN0Tm9ybWFsID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdE5vcm1hbCwgMC4wICkgKS54eXo7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdG9iamVjdFRhbmdlbnQgPSB2ZWM0KCBza2luTWF0cml4ICogdmVjNCggb2JqZWN0VGFuZ2VudCwgMC4wICkgKS54eXo7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgc3BlY3VsYXJtYXBfZnJhZ21lbnQgPSAiZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dmVjNCB0ZXhlbFNwZWN1bGFyID0gdGV4dHVyZTJEKCBzcGVjdWxhck1hcCwgdlNwZWN1bGFyTWFwVXYgKTtcblx0c3BlY3VsYXJTdHJlbmd0aCA9IHRleGVsU3BlY3VsYXIucjtcbiNlbHNlXG5cdHNwZWN1bGFyU3RyZW5ndGggPSAxLjA7XG4jZW5kaWYiOwoKICAgIHZhciBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgc3BlY3VsYXJNYXA7XG4jZW5kaWYiOwoKICAgIHZhciB0b25lbWFwcGluZ19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVE9ORV9NQVBQSU5HIClcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IHRvbmVNYXBwaW5nKCBnbF9GcmFnQ29sb3IucmdiICk7XG4jZW5kaWYiOwoKICAgIHZhciB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZm5kZWYgc2F0dXJhdGVcbiNkZWZpbmUgc2F0dXJhdGUoIGEgKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG51bmlmb3JtIGZsb2F0IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG52ZWMzIExpbmVhclRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvciApO1xufVxudmVjMyBSZWluaGFyZFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRyZXR1cm4gc2F0dXJhdGUoIGNvbG9yIC8gKCB2ZWMzKCAxLjAgKSArIGNvbG9yICkgKTtcbn1cbnZlYzMgQ2luZW9uVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGNvbG9yID0gbWF4KCB2ZWMzKCAwLjAgKSwgY29sb3IgLSAwLjAwNCApO1xuXHRyZXR1cm4gcG93KCAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDAuNSApICkgLyAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDEuNyApICsgMC4wNiApLCB2ZWMzKCAyLjIgKSApO1xufVxudmVjMyBSUlRBbmRPRFRGaXQoIHZlYzMgdiApIHtcblx0dmVjMyBhID0gdiAqICggdiArIDAuMDI0NTc4NiApIC0gMC4wMDAwOTA1Mzc7XG5cdHZlYzMgYiA9IHYgKiAoIDAuOTgzNzI5ICogdiArIDAuNDMyOTUxMCApICsgMC4yMzgwODE7XG5cdHJldHVybiBhIC8gYjtcbn1cbnZlYzMgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBtYXQzIEFDRVNJbnB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggMC41OTcxOSwgMC4wNzYwMCwgMC4wMjg0MCApLFx0XHR2ZWMzKCAwLjM1NDU4LCAwLjkwODM0LCAwLjEzMzgzICksXG5cdFx0dmVjMyggMC4wNDgyMywgMC4wMTU2NiwgMC44Mzc3NyApXG5cdCk7XG5cdGNvbnN0IG1hdDMgQUNFU091dHB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggIDEuNjA0NzUsIC0wLjEwMjA4LCAtMC4wMDMyNyApLFx0XHR2ZWMzKCAtMC41MzEwOCwgIDEuMTA4MTMsIC0wLjA3Mjc2ICksXG5cdFx0dmVjMyggLTAuMDczNjcsIC0wLjAwNjA1LCAgMS4wNzYwMiApXG5cdCk7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmUgLyAwLjY7XG5cdGNvbG9yID0gQUNFU0lucHV0TWF0ICogY29sb3I7XG5cdGNvbG9yID0gUlJUQW5kT0RURml0KCBjb2xvciApO1xuXHRjb2xvciA9IEFDRVNPdXRwdXRNYXQgKiBjb2xvcjtcblx0cmV0dXJuIHNhdHVyYXRlKCBjb2xvciApO1xufVxuY29uc3QgbWF0MyBMSU5FQVJfUkVDMjAyMF9UT19MSU5FQVJfU1JHQiA9IG1hdDMoXG5cdHZlYzMoIDEuNjYwNSwgLSAwLjEyNDYsIC0gMC4wMTgyICksXG5cdHZlYzMoIC0gMC41ODc2LCAxLjEzMjksIC0gMC4xMDA2ICksXG5cdHZlYzMoIC0gMC4wNzI4LCAtIDAuMDA4MywgMS4xMTg3IClcbik7XG5jb25zdCBtYXQzIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9SRUMyMDIwID0gbWF0Myhcblx0dmVjMyggMC42Mjc0LCAwLjA2OTEsIDAuMDE2NCApLFxuXHR2ZWMzKCAwLjMyOTMsIDAuOTE5NSwgMC4wODgwICksXG5cdHZlYzMoIDAuMDQzMywgMC4wMTEzLCAwLjg5NTYgKVxuKTtcbnZlYzMgYWd4RGVmYXVsdENvbnRyYXN0QXBwcm94KCB2ZWMzIHggKSB7XG5cdHZlYzMgeDIgPSB4ICogeDtcblx0dmVjMyB4NCA9IHgyICogeDI7XG5cdHJldHVybiArIDE1LjUgKiB4NCAqIHgyXG5cdFx0LSA0MC4xNCAqIHg0ICogeFxuXHRcdCsgMzEuOTYgKiB4NFxuXHRcdC0gNi44NjggKiB4MiAqIHhcblx0XHQrIDAuNDI5OCAqIHgyXG5cdFx0KyAwLjExOTEgKiB4XG5cdFx0LSAwLjAwMjMyO1xufVxudmVjMyBBZ1hUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgbWF0MyBBZ1hJbnNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMC44NTY2MjcxNTMzMTU5ODMsIDAuMTM3MzE4OTcyOTI5ODQ3LCAwLjExMTg5ODIxMjk5OTk1ICksXG5cdFx0dmVjMyggMC4wOTUxMjEyNDA1MzgxNTg4LCAwLjc2MTI0MTk5MDYwMjU5MSwgMC4wNzY3OTk0MTg2MDMxOTAzICksXG5cdFx0dmVjMyggMC4wNDgyNTE2MDYxNDU4NTgzLCAwLjEwMTQzOTAzNjQ2NzU2MiwgMC44MTEzMDIzNjgzOTY4NTkgKVxuXHQpO1xuXHRjb25zdCBtYXQzIEFnWE91dHNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMS4xMjcxMDA1ODE4MTQ0MzY4LCAtIDAuMTQxMzI5NzYzNDk4NDM4MywgLSAwLjE0MTMyOTc2MzQ5ODQzODI2ICksXG5cdFx0dmVjMyggLSAwLjExMDYwNjY0MzA5NjYwMzIzLCAxLjE1NzgyMzcwMjIxNjI3MiwgLSAwLjExMDYwNjY0MzA5NjYwMjk0ICksXG5cdFx0dmVjMyggLSAwLjAxNjQ5MzkzODcxNzgzNDU3MywgLSAwLjAxNjQ5MzkzODcxNzgzNDI1NywgMS4yNTE5MzY0MDY1OTUwNDA1IClcblx0KTtcblx0Y29uc3QgZmxvYXQgQWd4TWluRXYgPSAtIDEyLjQ3MzkzO1x0Y29uc3QgZmxvYXQgQWd4TWF4RXYgPSA0LjAyNjA2OTtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0Y29sb3IgPSBMSU5FQVJfU1JHQl9UT19MSU5FQVJfUkVDMjAyMCAqIGNvbG9yO1xuXHRjb2xvciA9IEFnWEluc2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gbWF4KCBjb2xvciwgMWUtMTAgKTtcdGNvbG9yID0gbG9nMiggY29sb3IgKTtcblx0Y29sb3IgPSAoIGNvbG9yIC0gQWd4TWluRXYgKSAvICggQWd4TWF4RXYgLSBBZ3hNaW5FdiApO1xuXHRjb2xvciA9IGNsYW1wKCBjb2xvciwgMC4wLCAxLjAgKTtcblx0Y29sb3IgPSBhZ3hEZWZhdWx0Q29udHJhc3RBcHByb3goIGNvbG9yICk7XG5cdGNvbG9yID0gQWdYT3V0c2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gcG93KCBtYXgoIHZlYzMoIDAuMCApLCBjb2xvciApLCB2ZWMzKCAyLjIgKSApO1xuXHRjb2xvciA9IExJTkVBUl9SRUMyMDIwX1RPX0xJTkVBUl9TUkdCICogY29sb3I7XG5cdGNvbG9yID0gY2xhbXAoIGNvbG9yLCAwLjAsIDEuMCApO1xuXHRyZXR1cm4gY29sb3I7XG59XG52ZWMzIE5ldXRyYWxUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgZmxvYXQgU3RhcnRDb21wcmVzc2lvbiA9IDAuOCAtIDAuMDQ7XG5cdGNvbnN0IGZsb2F0IERlc2F0dXJhdGlvbiA9IDAuMTU7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGZsb2F0IHggPSBtaW4oIGNvbG9yLnIsIG1pbiggY29sb3IuZywgY29sb3IuYiApICk7XG5cdGZsb2F0IG9mZnNldCA9IHggPCAwLjA4ID8geCAtIDYuMjUgKiB4ICogeCA6IDAuMDQ7XG5cdGNvbG9yIC09IG9mZnNldDtcblx0ZmxvYXQgcGVhayA9IG1heCggY29sb3IuciwgbWF4KCBjb2xvci5nLCBjb2xvci5iICkgKTtcblx0aWYgKCBwZWFrIDwgU3RhcnRDb21wcmVzc2lvbiApIHJldHVybiBjb2xvcjtcblx0ZmxvYXQgZCA9IDEuIC0gU3RhcnRDb21wcmVzc2lvbjtcblx0ZmxvYXQgbmV3UGVhayA9IDEuIC0gZCAqIGQgLyAoIHBlYWsgKyBkIC0gU3RhcnRDb21wcmVzc2lvbiApO1xuXHRjb2xvciAqPSBuZXdQZWFrIC8gcGVhaztcblx0ZmxvYXQgZyA9IDEuIC0gMS4gLyAoIERlc2F0dXJhdGlvbiAqICggcGVhayAtIG5ld1BlYWsgKSArIDEuICk7XG5cdHJldHVybiBtaXgoIGNvbG9yLCB2ZWMzKCBuZXdQZWFrICksIGcgKTtcbn1cbnZlYzMgQ3VzdG9tVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7IHJldHVybiBjb2xvcjsgfSI7CgogICAgdmFyIHRyYW5zbWlzc2lvbl9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRtYXRlcmlhbC50cmFuc21pc3Npb24gPSB0cmFuc21pc3Npb247XG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhID0gMS4wO1xuXHRtYXRlcmlhbC50aGlja25lc3MgPSB0aGlja25lc3M7XG5cdG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2UgPSBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHRtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yID0gYXR0ZW51YXRpb25Db2xvcjtcblx0I2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0XHRtYXRlcmlhbC50cmFuc21pc3Npb24gKj0gdGV4dHVyZTJEKCB0cmFuc21pc3Npb25NYXAsIHZUcmFuc21pc3Npb25NYXBVdiApLnI7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHRcdG1hdGVyaWFsLnRoaWNrbmVzcyAqPSB0ZXh0dXJlMkQoIHRoaWNrbmVzc01hcCwgdlRoaWNrbmVzc01hcFV2ICkuZztcblx0I2VuZGlmXG5cdHZlYzMgcG9zID0gdldvcmxkUG9zaXRpb247XG5cdHZlYzMgdiA9IG5vcm1hbGl6ZSggY2FtZXJhUG9zaXRpb24gLSBwb3MgKTtcblx0dmVjMyBuID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzQgdHJhbnNtaXR0ZWQgPSBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKFxuXHRcdG4sIHYsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuZGlmZnVzZUNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCxcblx0XHRwb3MsIG1vZGVsTWF0cml4LCB2aWV3TWF0cml4LCBwcm9qZWN0aW9uTWF0cml4LCBtYXRlcmlhbC5kaXNwZXJzaW9uLCBtYXRlcmlhbC5pb3IsIG1hdGVyaWFsLnRoaWNrbmVzcyxcblx0XHRtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yLCBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlICk7XG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhID0gbWl4KCBtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYSwgdHJhbnNtaXR0ZWQuYSwgbWF0ZXJpYWwudHJhbnNtaXNzaW9uICk7XG5cdHRvdGFsRGlmZnVzZSA9IG1peCggdG90YWxEaWZmdXNlLCB0cmFuc21pdHRlZC5yZ2IsIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiApO1xuI2VuZGlmIjsKCiAgICB2YXIgdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dW5pZm9ybSBmbG9hdCB0cmFuc21pc3Npb247XG5cdHVuaWZvcm0gZmxvYXQgdGhpY2tuZXNzO1xuXHR1bmlmb3JtIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdHVuaWZvcm0gdmVjMyBhdHRlbnVhdGlvbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHRyYW5zbWlzc2lvbk1hcDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgdGhpY2tuZXNzTWFwO1xuXHQjZW5kaWZcblx0dW5pZm9ybSB2ZWMyIHRyYW5zbWlzc2lvblNhbXBsZXJTaXplO1xuXHR1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25TYW1wbGVyTWFwO1xuXHR1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4O1xuXHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdGZsb2F0IHcwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogKCBhICogKCAtIGEgKyAzLjAgKSAtIDMuMCApICsgMS4wICk7XG5cdH1cblx0ZmxvYXQgdzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiAgYSAqICggMy4wICogYSAtIDYuMCApICsgNC4wICk7XG5cdH1cblx0ZmxvYXQgdzIoIGZsb2F0IGEgKXtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqICggYSAqICggLSAzLjAgKiBhICsgMy4wICkgKyAzLjAgKSArIDEuMCApO1xuXHR9XG5cdGZsb2F0IHczKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogYSAqIGEgKTtcblx0fVxuXHRmbG9hdCBnMCggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gdzAoIGEgKSArIHcxKCBhICk7XG5cdH1cblx0ZmxvYXQgZzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIHcyKCBhICkgKyB3MyggYSApO1xuXHR9XG5cdGZsb2F0IGgwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAtIDEuMCArIHcxKCBhICkgLyAoIHcwKCBhICkgKyB3MSggYSApICk7XG5cdH1cblx0ZmxvYXQgaDEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIDEuMCArIHczKCBhICkgLyAoIHcyKCBhICkgKyB3MyggYSApICk7XG5cdH1cblx0dmVjNCBiaWN1YmljKCBzYW1wbGVyMkQgdGV4LCB2ZWMyIHV2LCB2ZWM0IHRleGVsU2l6ZSwgZmxvYXQgbG9kICkge1xuXHRcdHV2ID0gdXYgKiB0ZXhlbFNpemUuencgKyAwLjU7XG5cdFx0dmVjMiBpdXYgPSBmbG9vciggdXYgKTtcblx0XHR2ZWMyIGZ1diA9IGZyYWN0KCB1diApO1xuXHRcdGZsb2F0IGcweCA9IGcwKCBmdXYueCApO1xuXHRcdGZsb2F0IGcxeCA9IGcxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweCA9IGgwKCBmdXYueCApO1xuXHRcdGZsb2F0IGgxeCA9IGgxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweSA9IGgwKCBmdXYueSApO1xuXHRcdGZsb2F0IGgxeSA9IGgxKCBmdXYueSApO1xuXHRcdHZlYzIgcDAgPSAoIHZlYzIoIGl1di54ICsgaDB4LCBpdXYueSArIGgweSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0dmVjMiBwMSA9ICggdmVjMiggaXV2LnggKyBoMXgsIGl1di55ICsgaDB5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHR2ZWMyIHAyID0gKCB2ZWMyKCBpdXYueCArIGgweCwgaXV2LnkgKyBoMXkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHZlYzIgcDMgPSAoIHZlYzIoIGl1di54ICsgaDF4LCBpdXYueSArIGgxeSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0cmV0dXJuIGcwKCBmdXYueSApICogKCBnMHggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAwLCBsb2QgKSArIGcxeCAqIHRleHR1cmVMb2QoIHRleCwgcDEsIGxvZCApICkgK1xuXHRcdFx0ZzEoIGZ1di55ICkgKiAoIGcweCAqIHRleHR1cmVMb2QoIHRleCwgcDIsIGxvZCApICsgZzF4ICogdGV4dHVyZUxvZCggdGV4LCBwMywgbG9kICkgKTtcblx0fVxuXHR2ZWM0IHRleHR1cmVCaWN1YmljKCBzYW1wbGVyMkQgc2FtcGxlciwgdmVjMiB1diwgZmxvYXQgbG9kICkge1xuXHRcdHZlYzIgZkxvZFNpemUgPSB2ZWMyKCB0ZXh0dXJlU2l6ZSggc2FtcGxlciwgaW50KCBsb2QgKSApICk7XG5cdFx0dmVjMiBjTG9kU2l6ZSA9IHZlYzIoIHRleHR1cmVTaXplKCBzYW1wbGVyLCBpbnQoIGxvZCArIDEuMCApICkgKTtcblx0XHR2ZWMyIGZMb2RTaXplSW52ID0gMS4wIC8gZkxvZFNpemU7XG5cdFx0dmVjMiBjTG9kU2l6ZUludiA9IDEuMCAvIGNMb2RTaXplO1xuXHRcdHZlYzQgZlNhbXBsZSA9IGJpY3ViaWMoIHNhbXBsZXIsIHV2LCB2ZWM0KCBmTG9kU2l6ZUludiwgZkxvZFNpemUgKSwgZmxvb3IoIGxvZCApICk7XG5cdFx0dmVjNCBjU2FtcGxlID0gYmljdWJpYyggc2FtcGxlciwgdXYsIHZlYzQoIGNMb2RTaXplSW52LCBjTG9kU2l6ZSApLCBjZWlsKCBsb2QgKSApO1xuXHRcdHJldHVybiBtaXgoIGZTYW1wbGUsIGNTYW1wbGUsIGZyYWN0KCBsb2QgKSApO1xuXHR9XG5cdHZlYzMgZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgdGhpY2tuZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIG1hdDQgbW9kZWxNYXRyaXggKSB7XG5cdFx0dmVjMyByZWZyYWN0aW9uVmVjdG9yID0gcmVmcmFjdCggLSB2LCBub3JtYWxpemUoIG4gKSwgMS4wIC8gaW9yICk7XG5cdFx0dmVjMyBtb2RlbFNjYWxlO1xuXHRcdG1vZGVsU2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueSA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueiA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDIgXS54eXogKSApO1xuXHRcdHJldHVybiBub3JtYWxpemUoIHJlZnJhY3Rpb25WZWN0b3IgKSAqIHRoaWNrbmVzcyAqIG1vZGVsU2NhbGU7XG5cdH1cblx0ZmxvYXQgYXBwbHlJb3JUb1JvdWdobmVzcyggY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IgKSB7XG5cdFx0cmV0dXJuIHJvdWdobmVzcyAqIGNsYW1wKCBpb3IgKiAyLjAgLSAyLjAsIDAuMCwgMS4wICk7XG5cdH1cblx0dmVjNCBnZXRUcmFuc21pc3Npb25TYW1wbGUoIGNvbnN0IGluIHZlYzIgZnJhZ0Nvb3JkLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIGZsb2F0IGlvciApIHtcblx0XHRmbG9hdCBsb2QgPSBsb2cyKCB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZS54ICkgKiBhcHBseUlvclRvUm91Z2huZXNzKCByb3VnaG5lc3MsIGlvciApO1xuXHRcdHJldHVybiB0ZXh0dXJlQmljdWJpYyggdHJhbnNtaXNzaW9uU2FtcGxlck1hcCwgZnJhZ0Nvb3JkLnh5LCBsb2QgKTtcblx0fVxuXHR2ZWMzIHZvbHVtZUF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCB0cmFuc21pc3Npb25EaXN0YW5jZSwgY29uc3QgaW4gdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlICkge1xuXHRcdGlmICggaXNpbmYoIGF0dGVudWF0aW9uRGlzdGFuY2UgKSApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmVjMyBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ID0gLWxvZyggYXR0ZW51YXRpb25Db2xvciApIC8gYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHRcdHZlYzMgdHJhbnNtaXR0YW5jZSA9IGV4cCggLSBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ICogdHJhbnNtaXNzaW9uRGlzdGFuY2UgKTtcdFx0XHRyZXR1cm4gdHJhbnNtaXR0YW5jZTtcblx0XHR9XG5cdH1cblx0dmVjNCBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvcixcblx0XHRjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiB2ZWMzIHBvc2l0aW9uLCBjb25zdCBpbiBtYXQ0IG1vZGVsTWF0cml4LFxuXHRcdGNvbnN0IGluIG1hdDQgdmlld01hdHJpeCwgY29uc3QgaW4gbWF0NCBwcm9qTWF0cml4LCBjb25zdCBpbiBmbG9hdCBkaXNwZXJzaW9uLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIGZsb2F0IHRoaWNrbmVzcyxcblx0XHRjb25zdCBpbiB2ZWMzIGF0dGVudWF0aW9uQ29sb3IsIGNvbnN0IGluIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2UgKSB7XG5cdFx0dmVjNCB0cmFuc21pdHRlZExpZ2h0O1xuXHRcdHZlYzMgdHJhbnNtaXR0YW5jZTtcblx0XHQjaWZkZWYgVVNFX0RJU1BFUlNJT05cblx0XHRcdGZsb2F0IGhhbGZTcHJlYWQgPSAoIGlvciAtIDEuMCApICogMC4wMjUgKiBkaXNwZXJzaW9uO1xuXHRcdFx0dmVjMyBpb3JzID0gdmVjMyggaW9yIC0gaGFsZlNwcmVhZCwgaW9yLCBpb3IgKyBoYWxmU3ByZWFkICk7XG5cdFx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCAzOyBpICsrICkge1xuXHRcdFx0XHR2ZWMzIHRyYW5zbWlzc2lvblJheSA9IGdldFZvbHVtZVRyYW5zbWlzc2lvblJheSggbiwgdiwgdGhpY2tuZXNzLCBpb3JzWyBpIF0sIG1vZGVsTWF0cml4ICk7XG5cdFx0XHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdFx0XHR2ZWM0IG5kY1BvcyA9IHByb2pNYXRyaXggKiB2aWV3TWF0cml4ICogdmVjNCggcmVmcmFjdGVkUmF5RXhpdCwgMS4wICk7XG5cdFx0XHRcdHZlYzIgcmVmcmFjdGlvbkNvb3JkcyA9IG5kY1Bvcy54eSAvIG5kY1Bvcy53O1xuXHRcdFx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRcdFx0cmVmcmFjdGlvbkNvb3JkcyAvPSAyLjA7XG5cdFx0XHRcdHZlYzQgdHJhbnNtaXNzaW9uU2FtcGxlID0gZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKCByZWZyYWN0aW9uQ29vcmRzLCByb3VnaG5lc3MsIGlvcnNbIGkgXSApO1xuXHRcdFx0XHR0cmFuc21pdHRlZExpZ2h0WyBpIF0gPSB0cmFuc21pc3Npb25TYW1wbGVbIGkgXTtcblx0XHRcdFx0dHJhbnNtaXR0ZWRMaWdodC5hICs9IHRyYW5zbWlzc2lvblNhbXBsZS5hO1xuXHRcdFx0XHR0cmFuc21pdHRhbmNlWyBpIF0gPSBkaWZmdXNlQ29sb3JbIGkgXSAqIHZvbHVtZUF0dGVudWF0aW9uKCBsZW5ndGgoIHRyYW5zbWlzc2lvblJheSApLCBhdHRlbnVhdGlvbkNvbG9yLCBhdHRlbnVhdGlvbkRpc3RhbmNlIClbIGkgXTtcblx0XHRcdH1cblx0XHRcdHRyYW5zbWl0dGVkTGlnaHQuYSAvPSAzLjA7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgdHJhbnNtaXNzaW9uUmF5ID0gZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBuLCB2LCB0aGlja25lc3MsIGlvciwgbW9kZWxNYXRyaXggKTtcblx0XHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdFx0dmVjNCBuZGNQb3MgPSBwcm9qTWF0cml4ICogdmlld01hdHJpeCAqIHZlYzQoIHJlZnJhY3RlZFJheUV4aXQsIDEuMCApO1xuXHRcdFx0dmVjMiByZWZyYWN0aW9uQ29vcmRzID0gbmRjUG9zLnh5IC8gbmRjUG9zLnc7XG5cdFx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRcdHJlZnJhY3Rpb25Db29yZHMgLz0gMi4wO1xuXHRcdFx0dHJhbnNtaXR0ZWRMaWdodCA9IGdldFRyYW5zbWlzc2lvblNhbXBsZSggcmVmcmFjdGlvbkNvb3Jkcywgcm91Z2huZXNzLCBpb3IgKTtcblx0XHRcdHRyYW5zbWl0dGFuY2UgPSBkaWZmdXNlQ29sb3IgKiB2b2x1bWVBdHRlbnVhdGlvbiggbGVuZ3RoKCB0cmFuc21pc3Npb25SYXkgKSwgYXR0ZW51YXRpb25Db2xvciwgYXR0ZW51YXRpb25EaXN0YW5jZSApO1xuXHRcdCNlbmRpZlxuXHRcdHZlYzMgYXR0ZW51YXRlZENvbG9yID0gdHJhbnNtaXR0YW5jZSAqIHRyYW5zbWl0dGVkTGlnaHQucmdiO1xuXHRcdHZlYzMgRiA9IEVudmlyb25tZW50QlJERiggbiwgdiwgc3BlY3VsYXJDb2xvciwgc3BlY3VsYXJGOTAsIHJvdWdobmVzcyApO1xuXHRcdGZsb2F0IHRyYW5zbWl0dGFuY2VGYWN0b3IgPSAoIHRyYW5zbWl0dGFuY2UuciArIHRyYW5zbWl0dGFuY2UuZyArIHRyYW5zbWl0dGFuY2UuYiApIC8gMy4wO1xuXHRcdHJldHVybiB2ZWM0KCAoIDEuMCAtIEYgKSAqIGF0dGVudWF0ZWRDb2xvciwgMS4wIC0gKCAxLjAgLSB0cmFuc21pdHRlZExpZ2h0LmEgKSAqIHRyYW5zbWl0dGFuY2VGYWN0b3IgKTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgdXZfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkxpZ2h0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dmFyeWluZyB2ZWMyIHZBb01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dmFyeWluZyB2ZWMyIHZCdW1wTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHZhcnlpbmcgdmVjMiB2Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dmFyeWluZyB2ZWMyIHZFbWlzc2l2ZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1ldGFsbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdlJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dmFyeWluZyB2ZWMyIHZBbmlzb3Ryb3B5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZTaGVlblJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhckludGVuc2l0eU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHR1bmlmb3JtIG1hdDMgdHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRyYW5zbWlzc2lvbk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgdGhpY2tuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRoaWNrbmVzc01hcFV2O1xuI2VuZGlmIjsKCiAgICB2YXIgdXZfcGFyc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBtYXQzIG1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIG1hdDMgYWxwaGFNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIG1hdDMgbGlnaHRNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2TGlnaHRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIG1hdDMgYW9NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QW9NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHVuaWZvcm0gbWF0MyBidW1wTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkJ1bXBNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBtYXQzIG5vcm1hbE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZOb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBtYXQzIGRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZEaXNwbGFjZW1lbnRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR1bmlmb3JtIG1hdDMgZW1pc3NpdmVNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2RW1pc3NpdmVNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIG1ldGFsbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNZXRhbG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHJvdWdobmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdHVuaWZvcm0gbWF0MyBhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkFuaXNvdHJvcHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBtYXQzIGNsZWFyY29hdE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHVuaWZvcm0gbWF0MyBjbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzaGVlbkNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuUm91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBtYXQzIGlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhck1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdHVuaWZvcm0gbWF0MyB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VHJhbnNtaXNzaW9uTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyB0aGlja25lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VGhpY2tuZXNzTWFwVXY7XG4jZW5kaWYiOwoKICAgIHZhciB1dl92ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dlV2ID0gdmVjMyggdXYsIDEgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dk1hcFV2ID0gKCBtYXBUcmFuc2Zvcm0gKiB2ZWMzKCBNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZBbHBoYU1hcFV2ID0gKCBhbHBoYU1hcFRyYW5zZm9ybSAqIHZlYzMoIEFMUEhBTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2TGlnaHRNYXBVdiA9ICggbGlnaHRNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBMSUdIVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dkFvTWFwVXYgPSAoIGFvTWFwVHJhbnNmb3JtICogdmVjMyggQU9NQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dkJ1bXBNYXBVdiA9ICggYnVtcE1hcFRyYW5zZm9ybSAqIHZlYzMoIEJVTVBNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR2Tm9ybWFsTWFwVXYgPSAoIG5vcm1hbE1hcFRyYW5zZm9ybSAqIHZlYzMoIE5PUk1BTE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHZEaXNwbGFjZW1lbnRNYXBVdiA9ICggZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtICogdmVjMyggRElTUExBQ0VNRU5UTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR2RW1pc3NpdmVNYXBVdiA9ICggZW1pc3NpdmVNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBFTUlTU0lWRU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHZNZXRhbG5lc3NNYXBVdiA9ICggbWV0YWxuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggTUVUQUxORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dlJvdWdobmVzc01hcFV2ID0gKCByb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dkFuaXNvdHJvcHlNYXBVdiA9ICggYW5pc290cm9weU1hcFRyYW5zZm9ybSAqIHZlYzMoIEFOSVNPVFJPUFlNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR2Q2xlYXJjb2F0TWFwVXYgPSAoIGNsZWFyY29hdE1hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgPSAoIGNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVF9OT1JNQUxNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dkNsZWFyY29hdFJvdWdobmVzc01hcFV2ID0gKCBjbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBDTEVBUkNPQVRfUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2SXJpZGVzY2VuY2VNYXBVdiA9ICggaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBJUklERVNDRU5DRU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ID0gKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIElSSURFU0NFTkNFX1RISUNLTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0dlNoZWVuQ29sb3JNYXBVdiA9ICggc2hlZW5Db2xvck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNIRUVOX0NPTE9STUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dlNoZWVuUm91Z2huZXNzTWFwVXYgPSAoIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtICogdmVjMyggU0hFRU5fUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR2U3BlY3VsYXJNYXBVdiA9ICggc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTUEVDVUxBUk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0dlNwZWN1bGFyQ29sb3JNYXBVdiA9ICggc3BlY3VsYXJDb2xvck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNQRUNVTEFSX0NPTE9STUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dlNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPSAoIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtICogdmVjMyggU1BFQ1VMQVJfSU5URU5TSVRZTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0dlRyYW5zbWlzc2lvbk1hcFV2ID0gKCB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm0gKiB2ZWMzKCBUUkFOU01JU1NJT05NQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR2VGhpY2tuZXNzTWFwVXYgPSAoIHRoaWNrbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIFRISUNLTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWYiOwoKICAgIHZhciB3b3JsZHBvc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSB8fCBkZWZpbmVkKCBESVNUQU5DRSApIHx8IGRlZmluZWQgKCBVU0VfU0hBRE9XTUFQICkgfHwgZGVmaW5lZCAoIFVTRV9UUkFOU01JU1NJT04gKSB8fCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZlYzQgd29ybGRQb3NpdGlvbiA9IHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcblx0I2lmZGVmIFVTRV9CQVRDSElOR1xuXHRcdHdvcmxkUG9zaXRpb24gPSBiYXRjaGluZ01hdHJpeCAqIHdvcmxkUG9zaXRpb247XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lOU1RBTkNJTkdcblx0XHR3b3JsZFBvc2l0aW9uID0gaW5zdGFuY2VNYXRyaXggKiB3b3JsZFBvc2l0aW9uO1xuXHQjZW5kaWZcblx0d29ybGRQb3NpdGlvbiA9IG1vZGVsTWF0cml4ICogd29ybGRQb3NpdGlvbjtcbiNlbmRpZiI7CgogICAgY29uc3QgdmVydGV4JGggPSAidmFyeWluZyB2ZWMyIHZVdjtcbnVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbnZvaWQgbWFpbigpIHtcblx0dlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbi54eSwgMS4wLCAxLjAgKTtcbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JGggPSAidW5pZm9ybSBzYW1wbGVyMkQgdDJEO1xudW5pZm9ybSBmbG9hdCBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xudmFyeWluZyB2ZWMyIHZVdjtcbnZvaWQgbWFpbigpIHtcblx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmUyRCggdDJELCB2VXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0dGV4Q29sb3IgPSB2ZWM0KCBtaXgoIHBvdyggdGV4Q29sb3IucmdiICogMC45NDc4NjcyOTg2ICsgdmVjMyggMC4wNTIxMzI3MDE0ICksIHZlYzMoIDIuNCApICksIHRleENvbG9yLnJnYiAqIDAuMDc3Mzk5MzgwOCwgdmVjMyggbGVzc1RoYW5FcXVhbCggdGV4Q29sb3IucmdiLCB2ZWMzKCAwLjA0MDQ1ICkgKSApICksIHRleENvbG9yLncgKTtcblx0I2VuZGlmXG5cdHRleENvbG9yLnJnYiAqPSBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXhDb2xvcjtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCRnID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1Bvc2l0aW9uLnogPSBnbF9Qb3NpdGlvbi53O1xufSI7CgogICAgY29uc3QgZnJhZ21lbnQkZyA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcbiNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcbnVuaWZvcm0gZmxvYXQgYmFja2dyb3VuZEJsdXJyaW5lc3M7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG51bmlmb3JtIG1hdDMgYmFja2dyb3VuZFJvdGF0aW9uO1xudmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIGJhY2tncm91bmRSb3RhdGlvbiAqIHZlYzMoIGZsaXBFbnZNYXAgKiB2V29ybGREaXJlY3Rpb24ueCwgdldvcmxkRGlyZWN0aW9uLnl6ICkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX1RZUEVfQ1VCRV9VViApXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgYmFja2dyb3VuZFJvdGF0aW9uICogdldvcmxkRGlyZWN0aW9uLCBiYWNrZ3JvdW5kQmx1cnJpbmVzcyApO1xuXHQjZWxzZVxuXHRcdHZlYzQgdGV4Q29sb3IgPSB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTtcblx0I2VuZGlmXG5cdHRleENvbG9yLnJnYiAqPSBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXhDb2xvcjtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCRmID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1Bvc2l0aW9uLnogPSBnbF9Qb3NpdGlvbi53O1xufSI7CgogICAgY29uc3QgZnJhZ21lbnQkZiA9ICJ1bmlmb3JtIHNhbXBsZXJDdWJlIHRDdWJlO1xudW5pZm9ybSBmbG9hdCB0RmxpcDtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlQ3ViZSggdEN1YmUsIHZlYzMoIHRGbGlwICogdldvcmxkRGlyZWN0aW9uLngsIHZXb3JsZERpcmVjdGlvbi55eiApICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHRnbF9GcmFnQ29sb3IuYSAqPSBvcGFjaXR5O1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JGUgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4PlxudmFyeWluZyB2ZWMyIHZIaWdoUHJlY2lzaW9uWlc7XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZIaWdoUHJlY2lzaW9uWlcgPSBnbF9Qb3NpdGlvbi56dztcbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JGUgPSAiI2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHR1bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZhcnlpbmcgdmVjMiB2SGlnaFByZWNpc2lvblpXO1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdFx0ZGlmZnVzZUNvbG9yLmEgPSBvcGFjaXR5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdGZsb2F0IGZyYWdDb29yZFogPSAwLjUgKiB2SGlnaFByZWNpc2lvblpXWzBdIC8gdkhpZ2hQcmVjaXNpb25aV1sxXSArIDAuNTtcblx0I2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHZlYzMoIDEuMCAtIGZyYWdDb29yZFogKSwgb3BhY2l0eSApO1xuXHQjZWxpZiBERVBUSF9QQUNLSU5HID09IDMyMDFcblx0XHRnbF9GcmFnQ29sb3IgPSBwYWNrRGVwdGhUb1JHQkEoIGZyYWdDb29yZFogKTtcblx0I2VsaWYgREVQVEhfUEFDS0lORyA9PSAzMjAyXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja0RlcHRoVG9SR0IoIGZyYWdDb29yZFogKSwgMS4wICk7XG5cdCNlbGlmIERFUFRIX1BBQ0tJTkcgPT0gMzIwM1xuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tEZXB0aFRvUkcoIGZyYWdDb29yZFogKSwgMC4wLCAxLjAgKTtcblx0I2VuZGlmXG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkZCA9ICIjZGVmaW5lIERJU1RBTkNFXG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCRkID0gIiNkZWZpbmUgRElTVEFOQ0VcbnVuaWZvcm0gdmVjMyByZWZlcmVuY2VQb3NpdGlvbjtcbnVuaWZvcm0gZmxvYXQgbmVhckRpc3RhbmNlO1xudW5pZm9ybSBmbG9hdCBmYXJEaXN0YW5jZTtcbnZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4gKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdGZsb2F0IGRpc3QgPSBsZW5ndGgoIHZXb3JsZFBvc2l0aW9uIC0gcmVmZXJlbmNlUG9zaXRpb24gKTtcblx0ZGlzdCA9ICggZGlzdCAtIG5lYXJEaXN0YW5jZSApIC8gKCBmYXJEaXN0YW5jZSAtIG5lYXJEaXN0YW5jZSApO1xuXHRkaXN0ID0gc2F0dXJhdGUoIGRpc3QgKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFja0RlcHRoVG9SR0JBKCBkaXN0ICk7XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkYyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkYyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0RXF1aXJlY3Q7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dmVjMyBkaXJlY3Rpb24gPSBub3JtYWxpemUoIHZXb3JsZERpcmVjdGlvbiApO1xuXHR2ZWMyIHNhbXBsZVVWID0gZXF1aXJlY3RVdiggZGlyZWN0aW9uICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCggdEVxdWlyZWN0LCBzYW1wbGVVViApO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JGIgPSAidW5pZm9ybSBmbG9hdCBzY2FsZTtcbmF0dHJpYnV0ZSBmbG9hdCBsaW5lRGlzdGFuY2U7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdHZMaW5lRGlzdGFuY2UgPSBzY2FsZSAqIGxpbmVEaXN0YW5jZTtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkYiA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gZmxvYXQgZGFzaFNpemU7XG51bmlmb3JtIGZsb2F0IHRvdGFsU2l6ZTtcbnZhcnlpbmcgZmxvYXQgdkxpbmVEaXN0YW5jZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSwgdG90YWxTaXplICkgPiBkYXNoU2l6ZSApIHtcblx0XHRkaXNjYXJkO1xuXHR9XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JGEgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpZiBkZWZpbmVkICggVVNFX0VOVk1BUCApIHx8IGRlZmluZWQgKCBVU0VfU0tJTk5JTkcgKVxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCRhID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHkgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjZWxzZVxuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSB2ZWMzKCAxLjAgKTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkOSA9ICIjZGVmaW5lIExBTUJFUlRcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkOSA9ICIjZGVmaW5lIExBTUJFUlRcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCA9IFJlZmxlY3RlZExpZ2h0KCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSApO1xuXHR2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8c3BlY3VsYXJtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkOCA9ICIjZGVmaW5lIE1BVENBUFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JDggPSAiI2RlZmluZSBNQVRDQVBcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xudW5pZm9ybSBzYW1wbGVyMkQgbWF0Y2FwO1xudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHR2ZWMzIHZpZXdEaXIgPSBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTtcblx0dmVjMyB4ID0gbm9ybWFsaXplKCB2ZWMzKCB2aWV3RGlyLnosIDAuMCwgLSB2aWV3RGlyLnggKSApO1xuXHR2ZWMzIHkgPSBjcm9zcyggdmlld0RpciwgeCApO1xuXHR2ZWMyIHV2ID0gdmVjMiggZG90KCB4LCBub3JtYWwgKSwgZG90KCB5LCBub3JtYWwgKSApICogMC40OTUgKyAwLjU7XG5cdCNpZmRlZiBVU0VfTUFUQ0FQXG5cdFx0dmVjNCBtYXRjYXBDb2xvciA9IHRleHR1cmUyRCggbWF0Y2FwLCB1diApO1xuXHQjZWxzZVxuXHRcdHZlYzQgbWF0Y2FwQ29sb3IgPSB2ZWM0KCB2ZWMzKCBtaXgoIDAuMiwgMC44LCB1di55ICkgKSwgMS4wICk7XG5cdCNlbmRpZlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiICogbWF0Y2FwQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQ3ID0gIiNkZWZpbmUgTk9STUFMXG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKVxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbiNlbmRpZlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkNyA9ICIjZGVmaW5lIE5PUk1BTFxudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApXG5cdHZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tOb3JtYWxUb1JHQiggbm9ybWFsICksIGRpZmZ1c2VDb2xvci5hICk7XG5cdCNpZmRlZiBPUEFRVUVcblx0XHRnbF9GcmFnQ29sb3IuYSA9IDEuMDtcblx0I2VuZGlmXG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkNiA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGVudm1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JDYgPSAiI2RlZmluZSBQSE9OR1xudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIHZlYzMgc3BlY3VsYXI7XG51bmlmb3JtIGZsb2F0IHNoaW5pbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkNSA9ICIjZGVmaW5lIFNUQU5EQVJEXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JDUgPSAiI2RlZmluZSBTVEFOREFSRFxuI2lmZGVmIFBIWVNJQ0FMXG5cdCNkZWZpbmUgSU9SXG5cdCNkZWZpbmUgVVNFX1NQRUNVTEFSXG4jZW5kaWZcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCByb3VnaG5lc3M7XG51bmlmb3JtIGZsb2F0IG1ldGFsbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpZmRlZiBJT1Jcblx0dW5pZm9ybSBmbG9hdCBpb3I7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0dW5pZm9ybSBmbG9hdCBzcGVjdWxhckludGVuc2l0eTtcblx0dW5pZm9ybSB2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhckNvbG9yTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhckludGVuc2l0eU1hcDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHVuaWZvcm0gZmxvYXQgY2xlYXJjb2F0O1xuXHR1bmlmb3JtIGZsb2F0IGNsZWFyY29hdFJvdWdobmVzcztcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQRVJTSU9OXG5cdHVuaWZvcm0gZmxvYXQgZGlzcGVyc2lvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlSU9SO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bTtcblx0dW5pZm9ybSBmbG9hdCBpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5cblx0dW5pZm9ybSB2ZWMzIHNoZWVuQ29sb3I7XG5cdHVuaWZvcm0gZmxvYXQgc2hlZW5Sb3VnaG5lc3M7XG5cdCNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzaGVlbkNvbG9yTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzaGVlblJvdWdobmVzc01hcDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHR1bmlmb3JtIHZlYzIgYW5pc290cm9weVZlY3Rvcjtcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgYW5pc290cm9weU1hcDtcblx0I2VuZGlmXG4jZW5kaWZcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGlyaWRlc2NlbmNlX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsZWFyY29hdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGlyaWRlc2NlbmNlX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8cm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIHRvdGFsRGlmZnVzZSA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgdG90YWxTcGVjdWxhciA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhcjtcblx0I2luY2x1ZGUgPHRyYW5zbWlzc2lvbl9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdG90YWxEaWZmdXNlICsgdG90YWxTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdGZsb2F0IHNoZWVuRW5lcmd5Q29tcCA9IDEuMCAtIDAuMTU3ICogbWF4MyggbWF0ZXJpYWwuc2hlZW5Db2xvciApO1xuXHRcdG91dGdvaW5nTGlnaHQgPSBvdXRnb2luZ0xpZ2h0ICogc2hlZW5FbmVyZ3lDb21wICsgc2hlZW5TcGVjdWxhckRpcmVjdCArIHNoZWVuU3BlY3VsYXJJbmRpcmVjdDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgZG90TlZjYyA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRcdHZlYzMgRmNjID0gRl9TY2hsaWNrKCBtYXRlcmlhbC5jbGVhcmNvYXRGMCwgbWF0ZXJpYWwuY2xlYXJjb2F0RjkwLCBkb3ROVmNjICk7XG5cdFx0b3V0Z29pbmdMaWdodCA9IG91dGdvaW5nTGlnaHQgKiAoIDEuMCAtIG1hdGVyaWFsLmNsZWFyY29hdCAqIEZjYyApICsgKCBjbGVhcmNvYXRTcGVjdWxhckRpcmVjdCArIGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKSAqIG1hdGVyaWFsLmNsZWFyY29hdDtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JDQgPSAiI2RlZmluZSBUT09OXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCQ0ID0gIiNkZWZpbmUgVE9PTlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Z3JhZGllbnRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfdG9vbl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQzID0gInVuaWZvcm0gZmxvYXQgc2l6ZTtcbnVuaWZvcm0gZmxvYXQgc2NhbGU7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG4jaWZkZWYgVVNFX1BPSU5UU19VVlxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuXHR1bmlmb3JtIG1hdDMgdXZUcmFuc2Zvcm07XG4jZW5kaWZcbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIFVTRV9QT0lOVFNfVVZcblx0XHR2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0Z2xfUG9pbnRTaXplID0gc2l6ZTtcblx0I2lmZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgZ2xfUG9pbnRTaXplICo9ICggc2NhbGUgLyAtIG12UG9zaXRpb24ueiApO1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkMyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9wYXJ0aWNsZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkMiA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkMiA9ICJ1bmlmb3JtIHZlYzMgY29sb3I7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggY29sb3IsIG9wYWNpdHkgKiAoIDEuMCAtIGdldFNoYWRvd01hc2soKSApICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkMSA9ICJ1bmlmb3JtIGZsb2F0IHJvdGF0aW9uO1xudW5pZm9ybSB2ZWMyIGNlbnRlcjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0dmVjNCBtdlBvc2l0aW9uID0gbW9kZWxWaWV3TWF0cml4WyAzIF07XG5cdHZlYzIgc2NhbGUgPSB2ZWMyKCBsZW5ndGgoIG1vZGVsTWF0cml4WyAwIF0ueHl6ICksIGxlbmd0aCggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHQjaWZuZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgc2NhbGUgKj0gLSBtdlBvc2l0aW9uLno7XG5cdCNlbmRpZlxuXHR2ZWMyIGFsaWduZWRQb3NpdGlvbiA9ICggcG9zaXRpb24ueHkgLSAoIGNlbnRlciAtIHZlYzIoIDAuNSApICkgKSAqIHNjYWxlO1xuXHR2ZWMyIHJvdGF0ZWRQb3NpdGlvbjtcblx0cm90YXRlZFBvc2l0aW9uLnggPSBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueCAtIHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi55O1xuXHRyb3RhdGVkUG9zaXRpb24ueSA9IHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54ICsgY29zKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdG12UG9zaXRpb24ueHkgKz0gcm90YXRlZFBvc2l0aW9uO1xuXHRnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCQxID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCBTaGFkZXJDaHVuayA9IHsKICAgIAlhbHBoYWhhc2hfZnJhZ21lbnQ6IGFscGhhaGFzaF9mcmFnbWVudCwKICAgIAlhbHBoYWhhc2hfcGFyc19mcmFnbWVudDogYWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQsCiAgICAJYWxwaGFtYXBfZnJhZ21lbnQ6IGFscGhhbWFwX2ZyYWdtZW50LAogICAgCWFscGhhbWFwX3BhcnNfZnJhZ21lbnQ6IGFscGhhbWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJYWxwaGF0ZXN0X2ZyYWdtZW50OiBhbHBoYXRlc3RfZnJhZ21lbnQsCiAgICAJYWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ6IGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50LAogICAgCWFvbWFwX2ZyYWdtZW50OiBhb21hcF9mcmFnbWVudCwKICAgIAlhb21hcF9wYXJzX2ZyYWdtZW50OiBhb21hcF9wYXJzX2ZyYWdtZW50LAogICAgCWJhdGNoaW5nX3BhcnNfdmVydGV4OiBiYXRjaGluZ19wYXJzX3ZlcnRleCwKICAgIAliYXRjaGluZ192ZXJ0ZXg6IGJhdGNoaW5nX3ZlcnRleCwKICAgIAliZWdpbl92ZXJ0ZXg6IGJlZ2luX3ZlcnRleCwKICAgIAliZWdpbm5vcm1hbF92ZXJ0ZXg6IGJlZ2lubm9ybWFsX3ZlcnRleCwKICAgIAlic2RmczogYnNkZnMsCiAgICAJaXJpZGVzY2VuY2VfZnJhZ21lbnQ6IGlyaWRlc2NlbmNlX2ZyYWdtZW50LAogICAgCWJ1bXBtYXBfcGFyc19mcmFnbWVudDogYnVtcG1hcF9wYXJzX2ZyYWdtZW50LAogICAgCWNsaXBwaW5nX3BsYW5lc19mcmFnbWVudDogY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50LAogICAgCWNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCwKICAgIAljbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCwKICAgIAljbGlwcGluZ19wbGFuZXNfdmVydGV4OiBjbGlwcGluZ19wbGFuZXNfdmVydGV4LAogICAgCWNvbG9yX2ZyYWdtZW50OiBjb2xvcl9mcmFnbWVudCwKICAgIAljb2xvcl9wYXJzX2ZyYWdtZW50OiBjb2xvcl9wYXJzX2ZyYWdtZW50LAogICAgCWNvbG9yX3BhcnNfdmVydGV4OiBjb2xvcl9wYXJzX3ZlcnRleCwKICAgIAljb2xvcl92ZXJ0ZXg6IGNvbG9yX3ZlcnRleCwKICAgIAljb21tb246IGNvbW1vbiwKICAgIAljdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ6IGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCwKICAgIAlkZWZhdWx0bm9ybWFsX3ZlcnRleDogZGVmYXVsdG5vcm1hbF92ZXJ0ZXgsCiAgICAJZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXgsCiAgICAJZGlzcGxhY2VtZW50bWFwX3ZlcnRleDogZGlzcGxhY2VtZW50bWFwX3ZlcnRleCwKICAgIAllbWlzc2l2ZW1hcF9mcmFnbWVudDogZW1pc3NpdmVtYXBfZnJhZ21lbnQsCiAgICAJZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudDogZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudCwKICAgIAljb2xvcnNwYWNlX2ZyYWdtZW50OiBjb2xvcnNwYWNlX2ZyYWdtZW50LAogICAgCWNvbG9yc3BhY2VfcGFyc19mcmFnbWVudDogY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50LAogICAgCWVudm1hcF9mcmFnbWVudDogZW52bWFwX2ZyYWdtZW50LAogICAgCWVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudDogZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50LAogICAgCWVudm1hcF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGFyc19mcmFnbWVudCwKICAgIAllbnZtYXBfcGFyc192ZXJ0ZXg6IGVudm1hcF9wYXJzX3ZlcnRleCwKICAgIAllbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCiAgICAJZW52bWFwX3ZlcnRleDogZW52bWFwX3ZlcnRleCwKICAgIAlmb2dfdmVydGV4OiBmb2dfdmVydGV4LAogICAgCWZvZ19wYXJzX3ZlcnRleDogZm9nX3BhcnNfdmVydGV4LAogICAgCWZvZ19mcmFnbWVudDogZm9nX2ZyYWdtZW50LAogICAgCWZvZ19wYXJzX2ZyYWdtZW50OiBmb2dfcGFyc19mcmFnbWVudCwKICAgIAlncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50OiBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50LAogICAgCWxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50LAogICAgCWxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQsCiAgICAJbGlnaHRzX3BhcnNfYmVnaW46IGxpZ2h0c19wYXJzX2JlZ2luLAogICAgCWxpZ2h0c190b29uX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9mcmFnbWVudCwKICAgIAlsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50LAogICAgCWxpZ2h0c19waG9uZ19mcmFnbWVudDogbGlnaHRzX3Bob25nX2ZyYWdtZW50LAogICAgCWxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50OiBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCwKICAgIAlsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQ6IGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudCwKICAgIAlsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCiAgICAJbGlnaHRzX2ZyYWdtZW50X2JlZ2luOiBsaWdodHNfZnJhZ21lbnRfYmVnaW4sCiAgICAJbGlnaHRzX2ZyYWdtZW50X21hcHM6IGxpZ2h0c19mcmFnbWVudF9tYXBzLAogICAgCWxpZ2h0c19mcmFnbWVudF9lbmQ6IGxpZ2h0c19mcmFnbWVudF9lbmQsCiAgICAJbG9nZGVwdGhidWZfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX2ZyYWdtZW50LAogICAgCWxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQsCiAgICAJbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg6IGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4LAogICAgCWxvZ2RlcHRoYnVmX3ZlcnRleDogbG9nZGVwdGhidWZfdmVydGV4LAogICAgCW1hcF9mcmFnbWVudDogbWFwX2ZyYWdtZW50LAogICAgCW1hcF9wYXJzX2ZyYWdtZW50OiBtYXBfcGFyc19mcmFnbWVudCwKICAgIAltYXBfcGFydGljbGVfZnJhZ21lbnQ6IG1hcF9wYXJ0aWNsZV9mcmFnbWVudCwKICAgIAltYXBfcGFydGljbGVfcGFyc19mcmFnbWVudDogbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQsCiAgICAJbWV0YWxuZXNzbWFwX2ZyYWdtZW50OiBtZXRhbG5lc3NtYXBfZnJhZ21lbnQsCiAgICAJbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ6IG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50LAogICAgCW1vcnBoaW5zdGFuY2VfdmVydGV4OiBtb3JwaGluc3RhbmNlX3ZlcnRleCwKICAgIAltb3JwaGNvbG9yX3ZlcnRleDogbW9ycGhjb2xvcl92ZXJ0ZXgsCiAgICAJbW9ycGhub3JtYWxfdmVydGV4OiBtb3JwaG5vcm1hbF92ZXJ0ZXgsCiAgICAJbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg6IG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4LAogICAgCW1vcnBodGFyZ2V0X3ZlcnRleDogbW9ycGh0YXJnZXRfdmVydGV4LAogICAgCW5vcm1hbF9mcmFnbWVudF9iZWdpbjogbm9ybWFsX2ZyYWdtZW50X2JlZ2luLAogICAgCW5vcm1hbF9mcmFnbWVudF9tYXBzOiBub3JtYWxfZnJhZ21lbnRfbWFwcywKICAgIAlub3JtYWxfcGFyc19mcmFnbWVudDogbm9ybWFsX3BhcnNfZnJhZ21lbnQsCiAgICAJbm9ybWFsX3BhcnNfdmVydGV4OiBub3JtYWxfcGFyc192ZXJ0ZXgsCiAgICAJbm9ybWFsX3ZlcnRleDogbm9ybWFsX3ZlcnRleCwKICAgIAlub3JtYWxtYXBfcGFyc19mcmFnbWVudDogbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbjogY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiwKICAgIAljbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHM6IGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcywKICAgIAljbGVhcmNvYXRfcGFyc19mcmFnbWVudDogY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQsCiAgICAJaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudDogaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudCwKICAgIAlvcGFxdWVfZnJhZ21lbnQ6IG9wYXF1ZV9mcmFnbWVudCwKICAgIAlwYWNraW5nOiBwYWNraW5nLAogICAgCXByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ6IHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQsCiAgICAJcHJvamVjdF92ZXJ0ZXg6IHByb2plY3RfdmVydGV4LAogICAgCWRpdGhlcmluZ19mcmFnbWVudDogZGl0aGVyaW5nX2ZyYWdtZW50LAogICAgCWRpdGhlcmluZ19wYXJzX2ZyYWdtZW50OiBkaXRoZXJpbmdfcGFyc19mcmFnbWVudCwKICAgIAlyb3VnaG5lc3NtYXBfZnJhZ21lbnQ6IHJvdWdobmVzc21hcF9mcmFnbWVudCwKICAgIAlyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudDogcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50LAogICAgCXNoYWRvd21hcF9wYXJzX3ZlcnRleDogc2hhZG93bWFwX3BhcnNfdmVydGV4LAogICAgCXNoYWRvd21hcF92ZXJ0ZXg6IHNoYWRvd21hcF92ZXJ0ZXgsCiAgICAJc2hhZG93bWFza19wYXJzX2ZyYWdtZW50OiBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQsCiAgICAJc2tpbmJhc2VfdmVydGV4OiBza2luYmFzZV92ZXJ0ZXgsCiAgICAJc2tpbm5pbmdfcGFyc192ZXJ0ZXg6IHNraW5uaW5nX3BhcnNfdmVydGV4LAogICAgCXNraW5uaW5nX3ZlcnRleDogc2tpbm5pbmdfdmVydGV4LAogICAgCXNraW5ub3JtYWxfdmVydGV4OiBza2lubm9ybWFsX3ZlcnRleCwKICAgIAlzcGVjdWxhcm1hcF9mcmFnbWVudDogc3BlY3VsYXJtYXBfZnJhZ21lbnQsCiAgICAJc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudDogc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudCwKICAgIAl0b25lbWFwcGluZ19mcmFnbWVudDogdG9uZW1hcHBpbmdfZnJhZ21lbnQsCiAgICAJdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudDogdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCwKICAgIAl0cmFuc21pc3Npb25fZnJhZ21lbnQ6IHRyYW5zbWlzc2lvbl9mcmFnbWVudCwKICAgIAl0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudDogdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQsCiAgICAJdXZfcGFyc19mcmFnbWVudDogdXZfcGFyc19mcmFnbWVudCwKICAgIAl1dl9wYXJzX3ZlcnRleDogdXZfcGFyc192ZXJ0ZXgsCiAgICAJdXZfdmVydGV4OiB1dl92ZXJ0ZXgsCiAgICAJd29ybGRwb3NfdmVydGV4OiB3b3JsZHBvc192ZXJ0ZXgsCgogICAgCWJhY2tncm91bmRfdmVydDogdmVydGV4JGgsCiAgICAJYmFja2dyb3VuZF9mcmFnOiBmcmFnbWVudCRoLAogICAgCWJhY2tncm91bmRDdWJlX3ZlcnQ6IHZlcnRleCRnLAogICAgCWJhY2tncm91bmRDdWJlX2ZyYWc6IGZyYWdtZW50JGcsCiAgICAJY3ViZV92ZXJ0OiB2ZXJ0ZXgkZiwKICAgIAljdWJlX2ZyYWc6IGZyYWdtZW50JGYsCiAgICAJZGVwdGhfdmVydDogdmVydGV4JGUsCiAgICAJZGVwdGhfZnJhZzogZnJhZ21lbnQkZSwKICAgIAlkaXN0YW5jZVJHQkFfdmVydDogdmVydGV4JGQsCiAgICAJZGlzdGFuY2VSR0JBX2ZyYWc6IGZyYWdtZW50JGQsCiAgICAJZXF1aXJlY3RfdmVydDogdmVydGV4JGMsCiAgICAJZXF1aXJlY3RfZnJhZzogZnJhZ21lbnQkYywKICAgIAlsaW5lZGFzaGVkX3ZlcnQ6IHZlcnRleCRiLAogICAgCWxpbmVkYXNoZWRfZnJhZzogZnJhZ21lbnQkYiwKICAgIAltZXNoYmFzaWNfdmVydDogdmVydGV4JGEsCiAgICAJbWVzaGJhc2ljX2ZyYWc6IGZyYWdtZW50JGEsCiAgICAJbWVzaGxhbWJlcnRfdmVydDogdmVydGV4JDksCiAgICAJbWVzaGxhbWJlcnRfZnJhZzogZnJhZ21lbnQkOSwKICAgIAltZXNobWF0Y2FwX3ZlcnQ6IHZlcnRleCQ4LAogICAgCW1lc2htYXRjYXBfZnJhZzogZnJhZ21lbnQkOCwKICAgIAltZXNobm9ybWFsX3ZlcnQ6IHZlcnRleCQ3LAogICAgCW1lc2hub3JtYWxfZnJhZzogZnJhZ21lbnQkNywKICAgIAltZXNocGhvbmdfdmVydDogdmVydGV4JDYsCiAgICAJbWVzaHBob25nX2ZyYWc6IGZyYWdtZW50JDYsCiAgICAJbWVzaHBoeXNpY2FsX3ZlcnQ6IHZlcnRleCQ1LAogICAgCW1lc2hwaHlzaWNhbF9mcmFnOiBmcmFnbWVudCQ1LAogICAgCW1lc2h0b29uX3ZlcnQ6IHZlcnRleCQ0LAogICAgCW1lc2h0b29uX2ZyYWc6IGZyYWdtZW50JDQsCiAgICAJcG9pbnRzX3ZlcnQ6IHZlcnRleCQzLAogICAgCXBvaW50c19mcmFnOiBmcmFnbWVudCQzLAogICAgCXNoYWRvd192ZXJ0OiB2ZXJ0ZXgkMiwKICAgIAlzaGFkb3dfZnJhZzogZnJhZ21lbnQkMiwKICAgIAlzcHJpdGVfdmVydDogdmVydGV4JDEsCiAgICAJc3ByaXRlX2ZyYWc6IGZyYWdtZW50JDEKICAgIH07CgogICAgLy8gVW5pZm9ybXMgbGlicmFyeSBmb3Igc2hhcmVkIHdlYmdsIHNoYWRlcnMKICAgIGNvbnN0IFVuaWZvcm1zTGliID0gewoKICAgIAljb21tb246IHsKCiAgICAJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCiAgICAJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoKICAgIAkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCW1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgogICAgCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQlhbHBoYU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgogICAgCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKICAgIAl9LAoKICAgIAlzcGVjdWxhcm1hcDogewoKICAgIAkJc3BlY3VsYXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJc3BlY3VsYXJNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgogICAgCX0sCgogICAgCWVudm1hcDogewoKICAgIAkJZW52TWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWVudk1hcFJvdGF0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJZmxpcEVudk1hcDogeyB2YWx1ZTogLTEgfSwKICAgIAkJcmVmbGVjdGl2aXR5OiB7IHZhbHVlOiAxLjAgfSwgLy8gYmFzaWMsIGxhbWJlcnQsIHBob25nCiAgICAJCWlvcjogeyB2YWx1ZTogMS41IH0sIC8vIHBoeXNpY2FsCiAgICAJCXJlZnJhY3Rpb25SYXRpbzogeyB2YWx1ZTogMC45OCB9LCAvLyBiYXNpYywgbGFtYmVydCwgcGhvbmcKCiAgICAJfSwKCiAgICAJYW9tYXA6IHsKCiAgICAJCWFvTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWFvTWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCiAgICAJCWFvTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKICAgIAl9LAoKICAgIAlsaWdodG1hcDogewoKICAgIAkJbGlnaHRNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJbGlnaHRNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKICAgIAkJbGlnaHRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgogICAgCX0sCgogICAgCWJ1bXBtYXA6IHsKCiAgICAJCWJ1bXBNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJYnVtcE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCWJ1bXBTY2FsZTogeyB2YWx1ZTogMSB9CgogICAgCX0sCgogICAgCW5vcm1hbG1hcDogewoKICAgIAkJbm9ybWFsTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCW5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCW5vcm1hbFNjYWxlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCAxLCAxICkgfQoKICAgIAl9LAoKICAgIAlkaXNwbGFjZW1lbnRtYXA6IHsKCiAgICAJCWRpc3BsYWNlbWVudE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQlkaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQlkaXNwbGFjZW1lbnRTY2FsZTogeyB2YWx1ZTogMSB9LAogICAgCQlkaXNwbGFjZW1lbnRCaWFzOiB7IHZhbHVlOiAwIH0KCiAgICAJfSwKCiAgICAJZW1pc3NpdmVtYXA6IHsKCiAgICAJCWVtaXNzaXZlTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWVtaXNzaXZlTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKICAgIAl9LAoKICAgIAltZXRhbG5lc3NtYXA6IHsKCiAgICAJCW1ldGFsbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQltZXRhbG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgogICAgCX0sCgogICAgCXJvdWdobmVzc21hcDogewoKICAgIAkJcm91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCXJvdWdobmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCiAgICAJfSwKCiAgICAJZ3JhZGllbnRtYXA6IHsKCiAgICAJCWdyYWRpZW50TWFwOiB7IHZhbHVlOiBudWxsIH0KCiAgICAJfSwKCiAgICAJZm9nOiB7CgogICAgCQlmb2dEZW5zaXR5OiB7IHZhbHVlOiAwLjAwMDI1IH0sCiAgICAJCWZvZ05lYXI6IHsgdmFsdWU6IDEgfSwKICAgIAkJZm9nRmFyOiB7IHZhbHVlOiAyMDAwIH0sCiAgICAJCWZvZ0NvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9CgogICAgCX0sCgogICAgCWxpZ2h0czogewoKICAgIAkJYW1iaWVudExpZ2h0Q29sb3I6IHsgdmFsdWU6IFtdIH0sCgogICAgCQlsaWdodFByb2JlOiB7IHZhbHVlOiBbXSB9LAoKICAgIAkJZGlyZWN0aW9uYWxMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQlkaXJlY3Rpb246IHt9LAogICAgCQkJY29sb3I6IHt9CiAgICAJCX0gfSwKCiAgICAJCWRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewogICAgCQkJc2hhZG93SW50ZW5zaXR5OiAxLAogICAgCQkJc2hhZG93Qmlhczoge30sCiAgICAJCQlzaGFkb3dOb3JtYWxCaWFzOiB7fSwKICAgIAkJCXNoYWRvd1JhZGl1czoge30sCiAgICAJCQlzaGFkb3dNYXBTaXplOiB7fQogICAgCQl9IH0sCgogICAgCQlkaXJlY3Rpb25hbFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKICAgIAkJZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCgogICAgCQlzcG90TGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewogICAgCQkJY29sb3I6IHt9LAogICAgCQkJcG9zaXRpb246IHt9LAogICAgCQkJZGlyZWN0aW9uOiB7fSwKICAgIAkJCWRpc3RhbmNlOiB7fSwKICAgIAkJCWNvbmVDb3M6IHt9LAogICAgCQkJcGVudW1icmFDb3M6IHt9LAogICAgCQkJZGVjYXk6IHt9CiAgICAJCX0gfSwKCiAgICAJCXNwb3RMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCiAgICAJCQlzaGFkb3dCaWFzOiB7fSwKICAgIAkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAogICAgCQkJc2hhZG93UmFkaXVzOiB7fSwKICAgIAkJCXNoYWRvd01hcFNpemU6IHt9CiAgICAJCX0gfSwKCiAgICAJCXNwb3RMaWdodE1hcDogeyB2YWx1ZTogW10gfSwKICAgIAkJc3BvdFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKICAgIAkJc3BvdExpZ2h0TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKICAgIAkJcG9pbnRMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQljb2xvcjoge30sCiAgICAJCQlwb3NpdGlvbjoge30sCiAgICAJCQlkZWNheToge30sCiAgICAJCQlkaXN0YW5jZToge30KICAgIAkJfSB9LAoKICAgIAkJcG9pbnRMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCiAgICAJCQlzaGFkb3dCaWFzOiB7fSwKICAgIAkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAogICAgCQkJc2hhZG93UmFkaXVzOiB7fSwKICAgIAkJCXNoYWRvd01hcFNpemU6IHt9LAogICAgCQkJc2hhZG93Q2FtZXJhTmVhcjoge30sCiAgICAJCQlzaGFkb3dDYW1lcmFGYXI6IHt9CiAgICAJCX0gfSwKCiAgICAJCXBvaW50U2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAogICAgCQlwb2ludFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKCiAgICAJCWhlbWlzcGhlcmVMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQlkaXJlY3Rpb246IHt9LAogICAgCQkJc2t5Q29sb3I6IHt9LAogICAgCQkJZ3JvdW5kQ29sb3I6IHt9CiAgICAJCX0gfSwKCiAgICAJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBSZWN0QXJlYUxpZ2h0IEJSREYgZGF0YSBuZWVkcyB0byBiZSBtb3ZlZCBmcm9tIGV4YW1wbGUgdG8gbWFpbiBzcmMKICAgIAkJcmVjdEFyZWFMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQljb2xvcjoge30sCiAgICAJCQlwb3NpdGlvbjoge30sCiAgICAJCQl3aWR0aDoge30sCiAgICAJCQloZWlnaHQ6IHt9CiAgICAJCX0gfSwKCiAgICAJCWx0Y18xOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWx0Y18yOiB7IHZhbHVlOiBudWxsIH0KCiAgICAJfSwKCiAgICAJcG9pbnRzOiB7CgogICAgCQlkaWZmdXNlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9LAogICAgCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfSwKICAgIAkJc2l6ZTogeyB2YWx1ZTogMS4wIH0sCiAgICAJCXNjYWxlOiB7IHZhbHVlOiAxLjAgfSwKICAgIAkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWFscGhhTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJYWxwaGFUZXN0OiB7IHZhbHVlOiAwIH0sCiAgICAJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKICAgIAl9LAoKICAgIAlzcHJpdGU6IHsKCiAgICAJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCiAgICAJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAogICAgCQljZW50ZXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDAuNSwgMC41ICkgfSwKICAgIAkJcm90YXRpb246IHsgdmFsdWU6IDAuMCB9LAogICAgCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJbWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJYWxwaGFNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKICAgIAl9CgogICAgfTsKCiAgICBjb25zdCBTaGFkZXJMaWIgPSB7CgogICAgCWJhc2ljOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmVudm1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmFvbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5mb2cKICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNoYmFzaWNfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY19mcmFnCgogICAgCX0sCgogICAgCWxhbWJlcnQ6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZW52bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYW9tYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0cywKICAgIAkJCXsKICAgIAkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQogICAgCQkJfQogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobGFtYmVydF9mcmFnCgogICAgCX0sCgogICAgCXBob25nOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmVudm1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmFvbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5mb2csCiAgICAJCQlVbmlmb3Jtc0xpYi5saWdodHMsCiAgICAJCQl7CiAgICAJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCiAgICAJCQkJc3BlY3VsYXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDExMTExMSApIH0sCiAgICAJCQkJc2hpbmluZXNzOiB7IHZhbHVlOiAzMCB9CiAgICAJCQl9CiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBob25nX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfZnJhZwoKICAgIAl9LAoKICAgIAlzdGFuZGFyZDogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIuY29tbW9uLAogICAgCQkJVW5pZm9ybXNMaWIuZW52bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYW9tYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLnJvdWdobmVzc21hcCwKICAgIAkJCVVuaWZvcm1zTGliLm1ldGFsbmVzc21hcCwKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0cywKICAgIAkJCXsKICAgIAkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKICAgIAkJCQlyb3VnaG5lc3M6IHsgdmFsdWU6IDEuMCB9LAogICAgCQkJCW1ldGFsbmVzczogeyB2YWx1ZTogMC4wIH0sCiAgICAJCQkJZW52TWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0KICAgIAkJCX0KICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF9mcmFnCgogICAgCX0sCgogICAgCXRvb246IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLmFvbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5ncmFkaWVudG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0cywKICAgIAkJCXsKICAgIAkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQogICAgCQkJfQogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2h0b29uX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNodG9vbl9mcmFnCgogICAgCX0sCgogICAgCW1hdGNhcDogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIuY29tbW9uLAogICAgCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCXsKICAgIAkJCQltYXRjYXA6IHsgdmFsdWU6IG51bGwgfQogICAgCQkJfQogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfZnJhZwoKICAgIAl9LAoKICAgIAlwb2ludHM6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLnBvaW50cywKICAgIAkJCVVuaWZvcm1zTGliLmZvZwogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnBvaW50c192ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsucG9pbnRzX2ZyYWcKCiAgICAJfSwKCiAgICAJZGFzaGVkOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5mb2csCiAgICAJCQl7CiAgICAJCQkJc2NhbGU6IHsgdmFsdWU6IDEgfSwKICAgIAkJCQlkYXNoU2l6ZTogeyB2YWx1ZTogMSB9LAogICAgCQkJCXRvdGFsU2l6ZTogeyB2YWx1ZTogMiB9CiAgICAJCQl9CiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF9mcmFnCgogICAgCX0sCgogICAgCWRlcHRoOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAKICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfZnJhZwoKICAgIAl9LAoKICAgIAlub3JtYWw6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAJCQl7CiAgICAJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KICAgIAkJCX0KICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX2ZyYWcKCiAgICAJfSwKCiAgICAJc3ByaXRlOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5zcHJpdGUsCiAgICAJCQlVbmlmb3Jtc0xpYi5mb2cKICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zcHJpdGVfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV9mcmFnCgogICAgCX0sCgogICAgCWJhY2tncm91bmQ6IHsKCiAgICAJCXVuaWZvcm1zOiB7CiAgICAJCQl1dlRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQl0MkQ6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCWJhY2tncm91bmRJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfQogICAgCQl9LAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX2ZyYWcKCiAgICAJfSwKCiAgICAJYmFja2dyb3VuZEN1YmU6IHsKCiAgICAJCXVuaWZvcm1zOiB7CiAgICAJCQllbnZNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCWZsaXBFbnZNYXA6IHsgdmFsdWU6IC0xIH0sCiAgICAJCQliYWNrZ3JvdW5kQmx1cnJpbmVzczogeyB2YWx1ZTogMCB9LAogICAgCQkJYmFja2dyb3VuZEludGVuc2l0eTogeyB2YWx1ZTogMSB9LAogICAgCQkJYmFja2dyb3VuZFJvdGF0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQogICAgCQl9LAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kQ3ViZV92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuYmFja2dyb3VuZEN1YmVfZnJhZwoKICAgIAl9LAoKICAgIAljdWJlOiB7CgogICAgCQl1bmlmb3JtczogewogICAgCQkJdEN1YmU6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCXRGbGlwOiB7IHZhbHVlOiAtMSB9LAogICAgCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KICAgIAkJfSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV9mcmFnCgogICAgCX0sCgogICAgCWVxdWlyZWN0OiB7CgogICAgCQl1bmlmb3JtczogewogICAgCQkJdEVxdWlyZWN0OiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCX0sCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmVxdWlyZWN0X3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5lcXVpcmVjdF9mcmFnCgogICAgCX0sCgogICAgCWRpc3RhbmNlUkdCQTogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIuY29tbW9uLAogICAgCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAogICAgCQkJewogICAgCQkJCXJlZmVyZW5jZVBvc2l0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkgfSwKICAgIAkJCQluZWFyRGlzdGFuY2U6IHsgdmFsdWU6IDEgfSwKICAgIAkJCQlmYXJEaXN0YW5jZTogeyB2YWx1ZTogMTAwMCB9CiAgICAJCQl9CiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZGlzdGFuY2VSR0JBX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfZnJhZwoKICAgIAl9LAoKICAgIAlzaGFkb3c6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0cywKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCXsKICAgIAkJCQljb2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAgKSB9LAogICAgCQkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9CiAgICAJCQl9LAogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnNoYWRvd192ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X2ZyYWcKCiAgICAJfQoKICAgIH07CgogICAgU2hhZGVyTGliLnBoeXNpY2FsID0gewoKICAgIAl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCVNoYWRlckxpYi5zdGFuZGFyZC51bmlmb3JtcywKICAgIAkJewogICAgCQkJY2xlYXJjb2F0OiB7IHZhbHVlOiAwIH0sCiAgICAJCQljbGVhcmNvYXRNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCWNsZWFyY29hdE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQljbGVhcmNvYXROb3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCWNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQljbGVhcmNvYXROb3JtYWxTY2FsZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMSwgMSApIH0sCiAgICAJCQljbGVhcmNvYXRSb3VnaG5lc3M6IHsgdmFsdWU6IDAgfSwKICAgIAkJCWNsZWFyY29hdFJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCWRpc3BlcnNpb246IHsgdmFsdWU6IDAgfSwKICAgIAkJCWlyaWRlc2NlbmNlOiB7IHZhbHVlOiAwIH0sCiAgICAJCQlpcmlkZXNjZW5jZU1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJaXJpZGVzY2VuY2VJT1I6IHsgdmFsdWU6IDEuMyB9LAogICAgCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtOiB7IHZhbHVlOiAxMDAgfSwKICAgIAkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTogeyB2YWx1ZTogNDAwIH0sCiAgICAJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJc2hlZW46IHsgdmFsdWU6IDAgfSwKICAgIAkJCXNoZWVuQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCiAgICAJCQlzaGVlbkNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlzaGVlbkNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCXNoZWVuUm91Z2huZXNzOiB7IHZhbHVlOiAxIH0sCiAgICAJCQlzaGVlblJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJdHJhbnNtaXNzaW9uOiB7IHZhbHVlOiAwIH0sCiAgICAJCQl0cmFuc21pc3Npb25NYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCXRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQl0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCiAgICAJCQl0cmFuc21pc3Npb25TYW1wbGVyTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQl0aGlja25lc3M6IHsgdmFsdWU6IDAgfSwKICAgIAkJCXRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJdGhpY2tuZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCWF0dGVudWF0aW9uRGlzdGFuY2U6IHsgdmFsdWU6IDAgfSwKICAgIAkJCWF0dGVudWF0aW9uQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCiAgICAJCQlzcGVjdWxhckNvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMSwgMSwgMSApIH0sCiAgICAJCQlzcGVjdWxhckNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCXNwZWN1bGFySW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCiAgICAJCQlzcGVjdWxhckludGVuc2l0eU1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJYW5pc290cm9weVZlY3RvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCiAgICAJCQlhbmlzb3Ryb3B5TWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJfQogICAgCV0gKSwKCiAgICAJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKICAgIAlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX2ZyYWcKCiAgICB9OwoKICAgIGNvbnN0IF9yZ2IgPSB7IHI6IDAsIGI6IDAsIGc6IDAgfTsKICAgIGNvbnN0IF9lMSQxID0gLypAX19QVVJFX18qLyBuZXcgRXVsZXIoKTsKICAgIGNvbnN0IF9tMSQxID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKICAgIGZ1bmN0aW9uIFdlYkdMQmFja2dyb3VuZCggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBzdGF0ZSwgb2JqZWN0cywgYWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCiAgICAJY29uc3QgY2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKICAgIAlsZXQgY2xlYXJBbHBoYSA9IGFscGhhID09PSB0cnVlID8gMCA6IDE7CgogICAgCWxldCBwbGFuZU1lc2g7CiAgICAJbGV0IGJveE1lc2g7CgogICAgCWxldCBjdXJyZW50QmFja2dyb3VuZCA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IDA7CiAgICAJbGV0IGN1cnJlbnRUb25lbWFwcGluZyA9IG51bGw7CgogICAgCWZ1bmN0aW9uIGdldEJhY2tncm91bmQoIHNjZW5lICkgewoKICAgIAkJbGV0IGJhY2tncm91bmQgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUuYmFja2dyb3VuZCA6IG51bGw7CgogICAgCQlpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgogICAgCQkJY29uc3QgdXNlUE1SRU0gPSBzY2VuZS5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDA7IC8vIHVzZSBQTVJFTSBpZiB0aGUgdXNlciB3YW50cyB0byBibHVyIHRoZSBiYWNrZ3JvdW5kCiAgICAJCQliYWNrZ3JvdW5kID0gKCB1c2VQTVJFTSA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggYmFja2dyb3VuZCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGJhY2tncm91bmQ7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyKCBzY2VuZSApIHsKCiAgICAJCWxldCBmb3JjZUNsZWFyID0gZmFsc2U7CiAgICAJCWNvbnN0IGJhY2tncm91bmQgPSBnZXRCYWNrZ3JvdW5kKCBzY2VuZSApOwoKICAgIAkJaWYgKCBiYWNrZ3JvdW5kID09PSBudWxsICkgewoKICAgIAkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgogICAgCQl9IGVsc2UgaWYgKCBiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNDb2xvciApIHsKCiAgICAJCQlzZXRDbGVhciggYmFja2dyb3VuZCwgMSApOwogICAgCQkJZm9yY2VDbGVhciA9IHRydWU7CgogICAgCQl9CgogICAgCQljb25zdCBlbnZpcm9ubWVudEJsZW5kTW9kZSA9IHJlbmRlcmVyLnhyLmdldEVudmlyb25tZW50QmxlbmRNb2RlKCk7CgogICAgCQlpZiAoIGVudmlyb25tZW50QmxlbmRNb2RlID09PSAnYWRkaXRpdmUnICkgewoKICAgIAkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDAsIDAsIDAsIDEsIHByZW11bHRpcGxpZWRBbHBoYSApOwoKICAgIAkJfSBlbHNlIGlmICggZW52aXJvbm1lbnRCbGVuZE1vZGUgPT09ICdhbHBoYS1ibGVuZCcgKSB7CgogICAgCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMCwgMCwgMCwgMCwgcHJlbXVsdGlwbGllZEFscGhhICk7CgogICAgCQl9CgogICAgCQlpZiAoIHJlbmRlcmVyLmF1dG9DbGVhciB8fCBmb3JjZUNsZWFyICkgewoKICAgIAkJCS8vIGJ1ZmZlcnMgbWlnaHQgbm90IGJlIHdyaXRhYmxlIHdoaWNoIGlzIHJlcXVpcmVkIHRvIGVuc3VyZSBhIGNvcnJlY3QgY2xlYXIKCiAgICAJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKICAgIAkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0TWFzayggdHJ1ZSApOwogICAgCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRNYXNrKCB0cnVlICk7CgogICAgCQkJcmVuZGVyZXIuY2xlYXIoIHJlbmRlcmVyLmF1dG9DbGVhckNvbG9yLCByZW5kZXJlci5hdXRvQ2xlYXJEZXB0aCwgcmVuZGVyZXIuYXV0b0NsZWFyU3RlbmNpbCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGFkZFRvUmVuZGVyTGlzdCggcmVuZGVyTGlzdCwgc2NlbmUgKSB7CgogICAgCQljb25zdCBiYWNrZ3JvdW5kID0gZ2V0QmFja2dyb3VuZCggc2NlbmUgKTsKCiAgICAJCWlmICggYmFja2dyb3VuZCAmJiAoIGJhY2tncm91bmQuaXNDdWJlVGV4dHVyZSB8fCBiYWNrZ3JvdW5kLm1hcHBpbmcgPT09IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nICkgKSB7CgogICAgCQkJaWYgKCBib3hNZXNoID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWJveE1lc2ggPSBuZXcgTWVzaCgKICAgIAkJCQkJbmV3IEJveEdlb21ldHJ5KCAxLCAxLCAxICksCiAgICAJCQkJCW5ldyBTaGFkZXJNYXRlcmlhbCggewogICAgCQkJCQkJbmFtZTogJ0JhY2tncm91bmRDdWJlTWF0ZXJpYWwnLAogICAgCQkJCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS51bmlmb3JtcyApLAogICAgCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZEN1YmUudmVydGV4U2hhZGVyLAogICAgCQkJCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS5mcmFnbWVudFNoYWRlciwKICAgIAkJCQkJCXNpZGU6IEJhY2tTaWRlLAogICAgCQkJCQkJZGVwdGhUZXN0OiBmYWxzZSwKICAgIAkJCQkJCWRlcHRoV3JpdGU6IGZhbHNlLAogICAgCQkJCQkJZm9nOiBmYWxzZSwKICAgIAkJCQkJCWFsbG93T3ZlcnJpZGU6IGZhbHNlCiAgICAJCQkJCX0gKQogICAgCQkJCSk7CgogICAgCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbm9ybWFsJyApOwogICAgCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAndXYnICk7CgogICAgCQkJCWJveE1lc2gub25CZWZvcmVSZW5kZXIgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhICkgewoKICAgIAkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKICAgIAkJCQl9OwoKICAgIAkJCQkvLyBhZGQgImVudk1hcCIgbWF0ZXJpYWwgcHJvcGVydHkgc28gdGhlIHJlbmRlcmVyIGNhbiBldmFsdWF0ZSBpdCBsaWtlIGZvciBidWlsdC1pbiBtYXRlcmlhbHMKICAgIAkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIGJveE1lc2gubWF0ZXJpYWwsICdlbnZNYXAnLCB7CgogICAgCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5lbnZNYXAudmFsdWU7CgogICAgCQkJCQl9CgogICAgCQkJCX0gKTsKCiAgICAJCQkJb2JqZWN0cy51cGRhdGUoIGJveE1lc2ggKTsKCiAgICAJCQl9CgogICAgCQkJX2UxJDEuY29weSggc2NlbmUuYmFja2dyb3VuZFJvdGF0aW9uICk7CgogICAgCQkJLy8gYWNjb21tb2RhdGUgbGVmdC1oYW5kZWQgZnJhbWUKICAgIAkJCV9lMSQxLnggKj0gLTE7IF9lMSQxLnkgKj0gLTE7IF9lMSQxLnogKj0gLTE7CgogICAgCQkJaWYgKCBiYWNrZ3JvdW5kLmlzQ3ViZVRleHR1cmUgJiYgYmFja2dyb3VuZC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgewoKICAgIAkJCQkvLyBlbnZpcm9ubWVudCBtYXBzIHdoaWNoIGFyZSBub3QgY3ViZSByZW5kZXIgdGFyZ2V0cyBvciBQTVJFTXMgZm9sbG93IGEgZGlmZmVyZW50IGNvbnZlbnRpb24KICAgIAkJCQlfZTEkMS55ICo9IC0xOwogICAgCQkJCV9lMSQxLnogKj0gLTE7CgogICAgCQkJfQoKICAgIAkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZW52TWFwLnZhbHVlID0gYmFja2dyb3VuZDsKICAgIAkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlICYmIGJhY2tncm91bmQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLTEgOiAxOwogICAgCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcy52YWx1ZSA9IHNjZW5lLmJhY2tncm91bmRCbHVycmluZXNzOwogICAgCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKICAgIAkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuYmFja2dyb3VuZFJvdGF0aW9uLnZhbHVlLnNldEZyb21NYXRyaXg0KCBfbTEkMS5tYWtlUm90YXRpb25Gcm9tRXVsZXIoIF9lMSQxICkgKTsKICAgIAkJCWJveE1lc2gubWF0ZXJpYWwudG9uZU1hcHBlZCA9IENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggYmFja2dyb3VuZC5jb2xvclNwYWNlICkgIT09IFNSR0JUcmFuc2ZlcjsKCiAgICAJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CiAgICAJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKICAgIAkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKICAgIAkJCQlib3hNZXNoLm1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQkJY3VycmVudEJhY2tncm91bmQgPSBiYWNrZ3JvdW5kOwogICAgCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IGJhY2tncm91bmQudmVyc2lvbjsKICAgIAkJCQljdXJyZW50VG9uZW1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCiAgICAJCQl9CgogICAgCQkJYm94TWVzaC5sYXllcnMuZW5hYmxlQWxsKCk7CgogICAgCQkJLy8gcHVzaCB0byB0aGUgcHJlLXNvcnRlZCBvcGFxdWUgcmVuZGVyIGxpc3QKICAgIAkJCXJlbmRlckxpc3QudW5zaGlmdCggYm94TWVzaCwgYm94TWVzaC5nZW9tZXRyeSwgYm94TWVzaC5tYXRlcmlhbCwgMCwgMCwgbnVsbCApOwoKICAgIAkJfSBlbHNlIGlmICggYmFja2dyb3VuZCAmJiBiYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCiAgICAJCQlpZiAoIHBsYW5lTWVzaCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlwbGFuZU1lc2ggPSBuZXcgTWVzaCgKICAgIAkJCQkJbmV3IFBsYW5lR2VvbWV0cnkoIDIsIDIgKSwKICAgIAkJCQkJbmV3IFNoYWRlck1hdGVyaWFsKCB7CiAgICAJCQkJCQluYW1lOiAnQmFja2dyb3VuZE1hdGVyaWFsJywKICAgIAkJCQkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBTaGFkZXJMaWIuYmFja2dyb3VuZC51bmlmb3JtcyApLAogICAgCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC52ZXJ0ZXhTaGFkZXIsCiAgICAJCQkJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyTGliLmJhY2tncm91bmQuZnJhZ21lbnRTaGFkZXIsCiAgICAJCQkJCQlzaWRlOiBGcm9udFNpZGUsCiAgICAJCQkJCQlkZXB0aFRlc3Q6IGZhbHNlLAogICAgCQkJCQkJZGVwdGhXcml0ZTogZmFsc2UsCiAgICAJCQkJCQlmb2c6IGZhbHNlLAogICAgCQkJCQkJYWxsb3dPdmVycmlkZTogZmFsc2UKICAgIAkJCQkJfSApCiAgICAJCQkJKTsKCiAgICAJCQkJcGxhbmVNZXNoLmdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSggJ25vcm1hbCcgKTsKCiAgICAJCQkJLy8gYWRkICJtYXAiIG1hdGVyaWFsIHByb3BlcnR5IHNvIHRoZSByZW5kZXJlciBjYW4gZXZhbHVhdGUgaXQgbGlrZSBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzCiAgICAJCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBwbGFuZU1lc2gubWF0ZXJpYWwsICdtYXAnLCB7CgogICAgCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy50MkQudmFsdWU7CgogICAgCQkJCQl9CgogICAgCQkJCX0gKTsKCiAgICAJCQkJb2JqZWN0cy51cGRhdGUoIHBsYW5lTWVzaCApOwoKICAgIAkJCX0KCiAgICAJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudDJELnZhbHVlID0gYmFja2dyb3VuZDsKICAgIAkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKICAgIAkJCXBsYW5lTWVzaC5tYXRlcmlhbC50b25lTWFwcGVkID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBiYWNrZ3JvdW5kLmNvbG9yU3BhY2UgKSAhPT0gU1JHQlRyYW5zZmVyOwoKICAgIAkJCWlmICggYmFja2dyb3VuZC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKICAgIAkJCQliYWNrZ3JvdW5kLnVwZGF0ZU1hdHJpeCgpOwoKICAgIAkJCX0KCiAgICAJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudXZUcmFuc2Zvcm0udmFsdWUuY29weSggYmFja2dyb3VuZC5tYXRyaXggKTsKCiAgICAJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CiAgICAJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKICAgIAkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKICAgIAkJCQlwbGFuZU1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CiAgICAJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gYmFja2dyb3VuZC52ZXJzaW9uOwogICAgCQkJCWN1cnJlbnRUb25lbWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKICAgIAkJCX0KCiAgICAJCQlwbGFuZU1lc2gubGF5ZXJzLmVuYWJsZUFsbCgpOwoKICAgIAkJCS8vIHB1c2ggdG8gdGhlIHByZS1zb3J0ZWQgb3BhcXVlIHJlbmRlciBsaXN0CiAgICAJCQlyZW5kZXJMaXN0LnVuc2hpZnQoIHBsYW5lTWVzaCwgcGxhbmVNZXNoLmdlb21ldHJ5LCBwbGFuZU1lc2gubWF0ZXJpYWwsIDAsIDAsIG51bGwgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXRDbGVhciggY29sb3IsIGFscGhhICkgewoKICAgIAkJY29sb3IuZ2V0UkdCKCBfcmdiLCBnZXRVbmxpdFVuaWZvcm1Db2xvclNwYWNlKCByZW5kZXJlciApICk7CgogICAgCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCBfcmdiLnIsIF9yZ2IuZywgX3JnYi5iLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCWlmICggYm94TWVzaCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWJveE1lc2guZ2VvbWV0cnkuZGlzcG9zZSgpOwogICAgCQkJYm94TWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgogICAgCQkJYm94TWVzaCA9IHVuZGVmaW5lZDsKCiAgICAJCX0KCiAgICAJCWlmICggcGxhbmVNZXNoICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcGxhbmVNZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKICAgIAkJCXBsYW5lTWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgogICAgCQkJcGxhbmVNZXNoID0gdW5kZWZpbmVkOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQlnZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGNsZWFyQ29sb3I7CgogICAgCQl9LAogICAgCQlzZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoIGNvbG9yLCBhbHBoYSA9IDEgKSB7CgogICAgCQkJY2xlYXJDb2xvci5zZXQoIGNvbG9yICk7CiAgICAJCQljbGVhckFscGhhID0gYWxwaGE7CiAgICAJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKICAgIAkJfSwKICAgIAkJZ2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBjbGVhckFscGhhOwoKICAgIAkJfSwKICAgIAkJc2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCBhbHBoYSApIHsKCiAgICAJCQljbGVhckFscGhhID0gYWxwaGE7CiAgICAJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKICAgIAkJfSwKICAgIAkJcmVuZGVyOiByZW5kZXIsCiAgICAJCWFkZFRvUmVuZGVyTGlzdDogYWRkVG9SZW5kZXJMaXN0LAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMQmluZGluZ1N0YXRlcyggZ2wsIGF0dHJpYnV0ZXMgKSB7CgogICAgCWNvbnN0IG1heFZlcnRleEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwoKICAgIAljb25zdCBiaW5kaW5nU3RhdGVzID0ge307CgogICAgCWNvbnN0IGRlZmF1bHRTdGF0ZSA9IGNyZWF0ZUJpbmRpbmdTdGF0ZSggbnVsbCApOwogICAgCWxldCBjdXJyZW50U3RhdGUgPSBkZWZhdWx0U3RhdGU7CiAgICAJbGV0IGZvcmNlVXBkYXRlID0gZmFsc2U7CgogICAgCWZ1bmN0aW9uIHNldHVwKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSwgaW5kZXggKSB7CgogICAgCQlsZXQgdXBkYXRlQnVmZmVycyA9IGZhbHNlOwoKICAgIAkJY29uc3Qgc3RhdGUgPSBnZXRCaW5kaW5nU3RhdGUoIGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCApOwoKICAgIAkJaWYgKCBjdXJyZW50U3RhdGUgIT09IHN0YXRlICkgewoKICAgIAkJCWN1cnJlbnRTdGF0ZSA9IHN0YXRlOwogICAgCQkJYmluZFZlcnRleEFycmF5T2JqZWN0KCBjdXJyZW50U3RhdGUub2JqZWN0ICk7CgogICAgCQl9CgogICAgCQl1cGRhdGVCdWZmZXJzID0gbmVlZHNVcGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0sIGluZGV4ICk7CgogICAgCQlpZiAoIHVwZGF0ZUJ1ZmZlcnMgKSBzYXZlQ2FjaGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0sIGluZGV4ICk7CgogICAgCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCWF0dHJpYnV0ZXMudXBkYXRlKCBpbmRleCwgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIgKTsKCiAgICAJCX0KCiAgICAJCWlmICggdXBkYXRlQnVmZmVycyB8fCBmb3JjZVVwZGF0ZSApIHsKCiAgICAJCQlmb3JjZVVwZGF0ZSA9IGZhbHNlOwoKICAgIAkJCXNldHVwVmVydGV4QXR0cmlidXRlcyggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnkgKTsKCiAgICAJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCQlnbC5iaW5kQnVmZmVyKCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYXR0cmlidXRlcy5nZXQoIGluZGV4ICkuYnVmZmVyICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgewoKICAgIAkJcmV0dXJuIGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYmluZFZlcnRleEFycmF5T2JqZWN0KCB2YW8gKSB7CgogICAgCQlyZXR1cm4gZ2wuYmluZFZlcnRleEFycmF5KCB2YW8gKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCggdmFvICkgewoKICAgIAkJcmV0dXJuIGdsLmRlbGV0ZVZlcnRleEFycmF5KCB2YW8gKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRCaW5kaW5nU3RhdGUoIGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCApIHsKCiAgICAJCWNvbnN0IHdpcmVmcmFtZSA9ICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICk7CgogICAgCQlsZXQgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgogICAgCQlpZiAoIHByb2dyYW1NYXAgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlwcm9ncmFtTWFwID0ge307CiAgICAJCQliaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdID0gcHJvZ3JhbU1hcDsKCiAgICAJCX0KCiAgICAJCWxldCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCiAgICAJCWlmICggc3RhdGVNYXAgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlzdGF0ZU1hcCA9IHt9OwogICAgCQkJcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID0gc3RhdGVNYXA7CgogICAgCQl9CgogICAgCQlsZXQgc3RhdGUgPSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgogICAgCQlpZiAoIHN0YXRlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJc3RhdGUgPSBjcmVhdGVCaW5kaW5nU3RhdGUoIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgKTsKICAgIAkJCXN0YXRlTWFwWyB3aXJlZnJhbWUgXSA9IHN0YXRlOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHN0YXRlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdTdGF0ZSggdmFvICkgewoKICAgIAkJY29uc3QgbmV3QXR0cmlidXRlcyA9IFtdOwogICAgCQljb25zdCBlbmFibGVkQXR0cmlidXRlcyA9IFtdOwogICAgCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IFtdOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgbWF4VmVydGV4QXR0cmlidXRlczsgaSArKyApIHsKCiAgICAJCQluZXdBdHRyaWJ1dGVzWyBpIF0gPSAwOwogICAgCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSA9IDA7CiAgICAJCQlhdHRyaWJ1dGVEaXZpc29yc1sgaSBdID0gMDsKCiAgICAJCX0KCiAgICAJCXJldHVybiB7CgogICAgCQkJLy8gZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb24gbm9uLVZBTyBzdXBwb3J0IGJyb3dzZXIKICAgIAkJCWdlb21ldHJ5OiBudWxsLAogICAgCQkJcHJvZ3JhbTogbnVsbCwKICAgIAkJCXdpcmVmcmFtZTogZmFsc2UsCgogICAgCQkJbmV3QXR0cmlidXRlczogbmV3QXR0cmlidXRlcywKICAgIAkJCWVuYWJsZWRBdHRyaWJ1dGVzOiBlbmFibGVkQXR0cmlidXRlcywKICAgIAkJCWF0dHJpYnV0ZURpdmlzb3JzOiBhdHRyaWJ1dGVEaXZpc29ycywKICAgIAkJCW9iamVjdDogdmFvLAogICAgCQkJYXR0cmlidXRlczoge30sCiAgICAJCQlpbmRleDogbnVsbAoKICAgIAkJfTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBuZWVkc1VwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgogICAgCQljb25zdCBjYWNoZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmF0dHJpYnV0ZXM7CiAgICAJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgogICAgCQlsZXQgYXR0cmlidXRlc051bSA9IDA7CgogICAgCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBwcm9ncmFtQXR0cmlidXRlcyApIHsKCiAgICAJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gPj0gMCApIHsKCiAgICAJCQkJY29uc3QgY2FjaGVkQXR0cmlidXRlID0gY2FjaGVkQXR0cmlidXRlc1sgbmFtZSBdOwogICAgCQkJCWxldCBnZW9tZXRyeUF0dHJpYnV0ZSA9IGdlb21ldHJ5QXR0cmlidXRlc1sgbmFtZSBdOwoKICAgIAkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CiAgICAJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlQ29sb3InICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VDb2xvcjsKCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIGNhY2hlZEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIHRydWU7CgogICAgCQkJCWlmICggY2FjaGVkQXR0cmlidXRlLmF0dHJpYnV0ZSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUgKSByZXR1cm4gdHJ1ZTsKCiAgICAJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSAmJiBjYWNoZWRBdHRyaWJ1dGUuZGF0YSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YSApIHJldHVybiB0cnVlOwoKICAgIAkJCQlhdHRyaWJ1dGVzTnVtICsrOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggY3VycmVudFN0YXRlLmF0dHJpYnV0ZXNOdW0gIT09IGF0dHJpYnV0ZXNOdW0gKSByZXR1cm4gdHJ1ZTsKCiAgICAJCWlmICggY3VycmVudFN0YXRlLmluZGV4ICE9PSBpbmRleCApIHJldHVybiB0cnVlOwoKICAgIAkJcmV0dXJuIGZhbHNlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNhdmVDYWNoZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgogICAgCQljb25zdCBjYWNoZSA9IHt9OwogICAgCQljb25zdCBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKICAgIAkJbGV0IGF0dHJpYnV0ZXNOdW0gPSAwOwoKICAgIAkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gcHJvZ3JhbUF0dHJpYnV0ZXMgKSB7CgogICAgCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uID49IDAgKSB7CgogICAgCQkJCWxldCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCQkJCWlmICggYXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgYXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwogICAgCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKICAgIAkJCQl9CgogICAgCQkJCWNvbnN0IGRhdGEgPSB7fTsKICAgIAkJCQlkYXRhLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTsKCiAgICAJCQkJaWYgKCBhdHRyaWJ1dGUgJiYgYXR0cmlidXRlLmRhdGEgKSB7CgogICAgCQkJCQlkYXRhLmRhdGEgPSBhdHRyaWJ1dGUuZGF0YTsKCiAgICAJCQkJfQoKICAgIAkJCQljYWNoZVsgbmFtZSBdID0gZGF0YTsKCiAgICAJCQkJYXR0cmlidXRlc051bSArKzsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljdXJyZW50U3RhdGUuYXR0cmlidXRlcyA9IGNhY2hlOwogICAgCQljdXJyZW50U3RhdGUuYXR0cmlidXRlc051bSA9IGF0dHJpYnV0ZXNOdW07CgogICAgCQljdXJyZW50U3RhdGUuaW5kZXggPSBpbmRleDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBpbml0QXR0cmlidXRlcygpIHsKCiAgICAJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBuZXdBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCW5ld0F0dHJpYnV0ZXNbIGkgXSA9IDA7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZW5hYmxlQXR0cmlidXRlKCBhdHRyaWJ1dGUgKSB7CgogICAgCQllbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIDAgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKSB7CgogICAgCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CiAgICAJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwogICAgCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVEaXZpc29yczsKCiAgICAJCW5ld0F0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCiAgICAJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID09PSAwICkgewoKICAgIAkJCWdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KCBhdHRyaWJ1dGUgKTsKICAgIAkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBhdHRyaWJ1dGUgXSA9IDE7CgogICAgCQl9CgogICAgCQlpZiAoIGF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSAhPT0gbWVzaFBlckF0dHJpYnV0ZSApIHsKCiAgICAJCQlnbC52ZXJ0ZXhBdHRyaWJEaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKTsKICAgIAkJCWF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSA9IG1lc2hQZXJBdHRyaWJ1dGU7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKSB7CgogICAgCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CiAgICAJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGVuYWJsZWRBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSAhPT0gbmV3QXR0cmlidXRlc1sgaSBdICkgewoKICAgIAkJCQlnbC5kaXNhYmxlVmVydGV4QXR0cmliQXJyYXkoIGkgKTsKICAgIAkJCQllbmFibGVkQXR0cmlidXRlc1sgaSBdID0gMDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0LCBpbnRlZ2VyICkgewoKICAgIAkJaWYgKCBpbnRlZ2VyID09PSB0cnVlICkgewoKICAgIAkJCWdsLnZlcnRleEF0dHJpYklQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgc3RyaWRlLCBvZmZzZXQgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJZ2wudmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSApIHsKCiAgICAJCWluaXRBdHRyaWJ1dGVzKCk7CgogICAgCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKICAgIAkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCiAgICAJCWNvbnN0IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyA9IG1hdGVyaWFsLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXM7CgogICAgCQlmb3IgKCBjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGUgPSBwcm9ncmFtQXR0cmlidXRlc1sgbmFtZSBdOwoKICAgIAkJCWlmICggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiA+PSAwICkgewoKICAgIAkJCQlsZXQgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBnZW9tZXRyeUF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VNYXRyaXgnICYmIG9iamVjdC5pbnN0YW5jZU1hdHJpeCApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwogICAgCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlQ29sb3I7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJY29uc3Qgbm9ybWFsaXplZCA9IGdlb21ldHJ5QXR0cmlidXRlLm5vcm1hbGl6ZWQ7CiAgICAJCQkJCWNvbnN0IHNpemUgPSBnZW9tZXRyeUF0dHJpYnV0ZS5pdGVtU2l6ZTsKCiAgICAJCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeUF0dHJpYnV0ZSApOwoKICAgIAkJCQkJLy8gVE9ETyBBdHRyaWJ1dGUgbWF5IG5vdCBiZSBhdmFpbGFibGUgb24gY29udGV4dCByZXN0b3JlCgogICAgCQkJCQlpZiAoIGF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgY29udGludWU7CgogICAgCQkJCQljb25zdCBidWZmZXIgPSBhdHRyaWJ1dGUuYnVmZmVyOwogICAgCQkJCQljb25zdCB0eXBlID0gYXR0cmlidXRlLnR5cGU7CiAgICAJCQkJCWNvbnN0IGJ5dGVzUGVyRWxlbWVudCA9IGF0dHJpYnV0ZS5ieXRlc1BlckVsZW1lbnQ7CgogICAgCQkJCQkvLyBjaGVjayBmb3IgaW50ZWdlciBhdHRyaWJ1dGVzCgogICAgCQkJCQljb25zdCBpbnRlZ2VyID0gKCB0eXBlID09PSBnbC5JTlQgfHwgdHlwZSA9PT0gZ2wuVU5TSUdORURfSU5UIHx8IGdlb21ldHJ5QXR0cmlidXRlLmdwdVR5cGUgPT09IEludFR5cGUgKTsKCiAgICAJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQkJCQljb25zdCBkYXRhID0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YTsKICAgIAkJCQkJCWNvbnN0IHN0cmlkZSA9IGRhdGEuc3RyaWRlOwogICAgCQkJCQkJY29uc3Qgb2Zmc2V0ID0gZ2VvbWV0cnlBdHRyaWJ1dGUub2Zmc2V0OwoKICAgIAkJCQkJCWlmICggZGF0YS5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyICkgewoKICAgIAkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCiAgICAJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLCBkYXRhLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZGF0YS5tZXNoUGVyQXR0cmlidXRlICogZGF0YS5jb3VudDsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKICAgIAkJCQkJCQkJZW5hYmxlQXR0cmlidXRlKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCWdsLmJpbmRCdWZmZXIoIGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyICk7CgogICAgCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgogICAgCQkJCQkJCXZlcnRleEF0dHJpYlBvaW50ZXIoCiAgICAJCQkJCQkJCXByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLAogICAgCQkJCQkJCQlzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUsCiAgICAJCQkJCQkJCXR5cGUsCiAgICAJCQkJCQkJCW5vcm1hbGl6ZWQsCiAgICAJCQkJCQkJCXN0cmlkZSAqIGJ5dGVzUGVyRWxlbWVudCwKICAgIAkJCQkJCQkJKCBvZmZzZXQgKyAoIHNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSApICogaSApICogYnl0ZXNQZXJFbGVtZW50LAogICAgCQkJCQkJCQlpbnRlZ2VyCiAgICAJCQkJCQkJKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgogICAgCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKICAgIAkJCQkJCQkJZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksIGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZ2VvbWV0cnlBdHRyaWJ1dGUubWVzaFBlckF0dHJpYnV0ZSAqIGdlb21ldHJ5QXR0cmlidXRlLmNvdW50OwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgogICAgCQkJCQkJCQllbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9CgogICAgCQkJCQkJZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCBidWZmZXIgKTsKCiAgICAJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCiAgICAJCQkJCQkJdmVydGV4QXR0cmliUG9pbnRlcigKICAgIAkJCQkJCQkJcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksCiAgICAJCQkJCQkJCXNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSwKICAgIAkJCQkJCQkJdHlwZSwKICAgIAkJCQkJCQkJbm9ybWFsaXplZCwKICAgIAkJCQkJCQkJc2l6ZSAqIGJ5dGVzUGVyRWxlbWVudCwKICAgIAkJCQkJCQkJKCBzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUgKSAqIGkgKiBieXRlc1BlckVsZW1lbnQsCiAgICAJCQkJCQkJCWludGVnZXIKICAgIAkJCQkJCQkpOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQljb25zdCB2YWx1ZSA9IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlc1sgbmFtZSBdOwoKICAgIAkJCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCXN3aXRjaCAoIHZhbHVlLmxlbmd0aCApIHsKCiAgICAJCQkJCQkJY2FzZSAyOgogICAgCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWIyZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CiAgICAJCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCQljYXNlIDM6CiAgICAJCQkJCQkJCWdsLnZlcnRleEF0dHJpYjNmdiggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiwgdmFsdWUgKTsKICAgIAkJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJCWNhc2UgNDoKICAgIAkJCQkJCQkJZ2wudmVydGV4QXR0cmliNGZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwogICAgCQkJCQkJCQlicmVhazsKCiAgICAJCQkJCQkJZGVmYXVsdDoKICAgIAkJCQkJCQkJZ2wudmVydGV4QXR0cmliMWZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzKCk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCXJlc2V0KCk7CgogICAgCQlmb3IgKCBjb25zdCBnZW9tZXRyeUlkIGluIGJpbmRpbmdTdGF0ZXMgKSB7CgogICAgCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5SWQgXTsKCiAgICAJCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCiAgICAJCQkJY29uc3Qgc3RhdGVNYXAgPSBwcm9ncmFtTWFwWyBwcm9ncmFtSWQgXTsKCiAgICAJCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKICAgIAkJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCiAgICAJCQkJCWRlbGV0ZSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgogICAgCQkJCX0KCiAgICAJCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKICAgIAkJCX0KCiAgICAJCQlkZWxldGUgYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbGVhc2VTdGF0ZXNPZkdlb21ldHJ5KCBnZW9tZXRyeSApIHsKCiAgICAJCWlmICggYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgogICAgCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCiAgICAJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKICAgIAkJCWZvciAoIGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCApIHsKCiAgICAJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCiAgICAJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCiAgICAJCQl9CgogICAgCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKICAgIAkJfQoKICAgIAkJZGVsZXRlIGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggcHJvZ3JhbSApIHsKCiAgICAJCWZvciAoIGNvbnN0IGdlb21ldHJ5SWQgaW4gYmluZGluZ1N0YXRlcyApIHsKCiAgICAJCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKICAgIAkJCWlmICggcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCiAgICAJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCiAgICAJCQlmb3IgKCBjb25zdCB3aXJlZnJhbWUgaW4gc3RhdGVNYXAgKSB7CgogICAgCQkJCWRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCBzdGF0ZU1hcFsgd2lyZWZyYW1lIF0ub2JqZWN0ICk7CgogICAgCQkJCWRlbGV0ZSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgogICAgCQkJfQoKICAgIAkJCWRlbGV0ZSBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF07CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVzZXQoKSB7CgogICAgCQlyZXNldERlZmF1bHRTdGF0ZSgpOwogICAgCQlmb3JjZVVwZGF0ZSA9IHRydWU7CgogICAgCQlpZiAoIGN1cnJlbnRTdGF0ZSA9PT0gZGVmYXVsdFN0YXRlICkgcmV0dXJuOwoKICAgIAkJY3VycmVudFN0YXRlID0gZGVmYXVsdFN0YXRlOwogICAgCQliaW5kVmVydGV4QXJyYXlPYmplY3QoIGN1cnJlbnRTdGF0ZS5vYmplY3QgKTsKCiAgICAJfQoKICAgIAkvLyBmb3IgYmFja3dhcmQtY29tcGF0aWJpbGl0eQoKICAgIAlmdW5jdGlvbiByZXNldERlZmF1bHRTdGF0ZSgpIHsKCiAgICAJCWRlZmF1bHRTdGF0ZS5nZW9tZXRyeSA9IG51bGw7CiAgICAJCWRlZmF1bHRTdGF0ZS5wcm9ncmFtID0gbnVsbDsKICAgIAkJZGVmYXVsdFN0YXRlLndpcmVmcmFtZSA9IGZhbHNlOwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQlzZXR1cDogc2V0dXAsCiAgICAJCXJlc2V0OiByZXNldCwKICAgIAkJcmVzZXREZWZhdWx0U3RhdGU6IHJlc2V0RGVmYXVsdFN0YXRlLAogICAgCQlkaXNwb3NlOiBkaXNwb3NlLAogICAgCQlyZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeTogcmVsZWFzZVN0YXRlc09mR2VvbWV0cnksCiAgICAJCXJlbGVhc2VTdGF0ZXNPZlByb2dyYW06IHJlbGVhc2VTdGF0ZXNPZlByb2dyYW0sCgogICAgCQlpbml0QXR0cmlidXRlczogaW5pdEF0dHJpYnV0ZXMsCiAgICAJCWVuYWJsZUF0dHJpYnV0ZTogZW5hYmxlQXR0cmlidXRlLAogICAgCQlkaXNhYmxlVW51c2VkQXR0cmlidXRlczogZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMKCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xCdWZmZXJSZW5kZXJlciggZ2wsIGV4dGVuc2lvbnMsIGluZm8gKSB7CgogICAgCWxldCBtb2RlOwoKICAgIAlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCiAgICAJCW1vZGUgPSB2YWx1ZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXIoIHN0YXJ0LCBjb3VudCApIHsKCiAgICAJCWdsLmRyYXdBcnJheXMoIG1vZGUsIHN0YXJ0LCBjb3VudCApOwoKICAgIAkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCAxICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKCBzdGFydCwgY291bnQsIHByaW1jb3VudCApIHsKCiAgICAJCWlmICggcHJpbWNvdW50ID09PSAwICkgcmV0dXJuOwoKICAgIAkJZ2wuZHJhd0FycmF5c0luc3RhbmNlZCggbW9kZSwgc3RhcnQsIGNvdW50LCBwcmltY291bnQgKTsKCiAgICAJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3KCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50ICkgewoKICAgIAkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgogICAgCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CiAgICAJCWV4dGVuc2lvbi5tdWx0aURyYXdBcnJheXNXRUJHTCggbW9kZSwgc3RhcnRzLCAwLCBjb3VudHMsIDAsIGRyYXdDb3VudCApOwoKICAgIAkJbGV0IGVsZW1lbnRDb3VudCA9IDA7CiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCiAgICAJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF07CgogICAgCQl9CgogICAgCQlpbmZvLnVwZGF0ZSggZWxlbWVudENvdW50LCBtb2RlLCAxICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzKCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50LCBwcmltY291bnQgKSB7CgogICAgCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCiAgICAJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCiAgICAJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IHN0YXJ0cy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCXJlbmRlckluc3RhbmNlcyggc3RhcnRzWyBpIF0sIGNvdW50c1sgaSBdLCBwcmltY291bnRbIGkgXSApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0FycmF5c0luc3RhbmNlZFdFQkdMKCBtb2RlLCBzdGFydHMsIDAsIGNvdW50cywgMCwgcHJpbWNvdW50LCAwLCBkcmF3Q291bnQgKTsKCiAgICAJCQlsZXQgZWxlbWVudENvdW50ID0gMDsKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCiAgICAJCQkJZWxlbWVudENvdW50ICs9IGNvdW50c1sgaSBdICogcHJpbWNvdW50WyBpIF07CgogICAgCQkJfQoKICAgIAkJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvLwoKICAgIAl0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwogICAgCXRoaXMucmVuZGVyID0gcmVuZGVyOwogICAgCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwogICAgCXRoaXMucmVuZGVyTXVsdGlEcmF3ID0gcmVuZGVyTXVsdGlEcmF3OwogICAgCXRoaXMucmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzID0gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzOwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTENhcGFiaWxpdGllcyggZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHV0aWxzICkgewoKICAgIAlsZXQgbWF4QW5pc290cm9weTsKCiAgICAJZnVuY3Rpb24gZ2V0TWF4QW5pc290cm9weSgpIHsKCiAgICAJCWlmICggbWF4QW5pc290cm9weSAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIG1heEFuaXNvdHJvcHk7CgogICAgCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApID09PSB0cnVlICkgewoKICAgIAkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwoKICAgIAkJCW1heEFuaXNvdHJvcHkgPSBnbC5nZXRQYXJhbWV0ZXIoIGV4dGVuc2lvbi5NQVhfVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJbWF4QW5pc290cm9weSA9IDA7CgogICAgCQl9CgogICAgCQlyZXR1cm4gbWF4QW5pc290cm9weTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB0ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSB7CgogICAgCQlpZiAoIHRleHR1cmVGb3JtYXQgIT09IFJHQkFGb3JtYXQgJiYgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApICE9PSBnbC5nZXRQYXJhbWV0ZXIoIGdsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfRk9STUFUICkgKSB7CgogICAgCQkJcmV0dXJuIGZhbHNlOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRydWU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4dHVyZVR5cGVSZWFkYWJsZSggdGV4dHVyZVR5cGUgKSB7CgogICAgCQljb25zdCBoYWxmRmxvYXRTdXBwb3J0ZWRCeUV4dCA9ICggdGV4dHVyZVR5cGUgPT09IEhhbGZGbG9hdFR5cGUgKSAmJiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlVHlwZSAhPT0gVW5zaWduZWRCeXRlVHlwZSAmJiB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApICE9PSBnbC5nZXRQYXJhbWV0ZXIoIGdsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfVFlQRSApICYmIC8vIEVkZ2UgYW5kIENocm9tZSBNYWMgPCA1MiAoIzk1MTMpCiAgICAJCQl0ZXh0dXJlVHlwZSAhPT0gRmxvYXRUeXBlICYmICEgaGFsZkZsb2F0U3VwcG9ydGVkQnlFeHQgKSB7CgogICAgCQkJcmV0dXJuIGZhbHNlOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRydWU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0TWF4UHJlY2lzaW9uKCBwcmVjaXNpb24gKSB7CgogICAgCQlpZiAoIHByZWNpc2lvbiA9PT0gJ2hpZ2hwJyApIHsKCiAgICAJCQlpZiAoIGdsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCggZ2wuVkVSVEVYX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgJiYKICAgIAkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgogICAgCQkJCXJldHVybiAnaGlnaHAnOwoKICAgIAkJCX0KCiAgICAJCQlwcmVjaXNpb24gPSAnbWVkaXVtcCc7CgogICAgCQl9CgogICAgCQlpZiAoIHByZWNpc2lvbiA9PT0gJ21lZGl1bXAnICkgewoKICAgIAkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5WRVJURVhfU0hBREVSLCBnbC5NRURJVU1fRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCiAgICAJCQkJZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5GUkFHTUVOVF9TSEFERVIsIGdsLk1FRElVTV9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgogICAgCQkJCXJldHVybiAnbWVkaXVtcCc7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuICdsb3dwJzsKCiAgICAJfQoKICAgIAlsZXQgcHJlY2lzaW9uID0gcGFyYW1ldGVycy5wcmVjaXNpb24gIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucHJlY2lzaW9uIDogJ2hpZ2hwJzsKICAgIAljb25zdCBtYXhQcmVjaXNpb24gPSBnZXRNYXhQcmVjaXNpb24oIHByZWNpc2lvbiApOwoKICAgIAlpZiAoIG1heFByZWNpc2lvbiAhPT0gcHJlY2lzaW9uICkgewoKICAgIAkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjonLCBwcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIG1heFByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwogICAgCQlwcmVjaXNpb24gPSBtYXhQcmVjaXNpb247CgogICAgCX0KCiAgICAJY29uc3QgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9PT0gdHJ1ZTsKICAgIAljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSBwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA9PT0gdHJ1ZSAmJiBleHRlbnNpb25zLmhhcyggJ0VYVF9jbGlwX2NvbnRyb2wnICk7CgogICAgCWNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwogICAgCWNvbnN0IG1heFZlcnRleFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkVSVEVYX1RFWFRVUkVfSU1BR0VfVU5JVFMgKTsKICAgIAljb25zdCBtYXhUZXh0dXJlU2l6ZSA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1RFWFRVUkVfU0laRSApOwogICAgCWNvbnN0IG1heEN1YmVtYXBTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfQ1VCRV9NQVBfVEVYVFVSRV9TSVpFICk7CgogICAgCWNvbnN0IG1heEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwogICAgCWNvbnN0IG1heFZlcnRleFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkVSVEVYX1VOSUZPUk1fVkVDVE9SUyApOwogICAgCWNvbnN0IG1heFZhcnlpbmdzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkFSWUlOR19WRUNUT1JTICk7CiAgICAJY29uc3QgbWF4RnJhZ21lbnRVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX0ZSQUdNRU5UX1VOSUZPUk1fVkVDVE9SUyApOwoKICAgIAljb25zdCB2ZXJ0ZXhUZXh0dXJlcyA9IG1heFZlcnRleFRleHR1cmVzID4gMDsKCiAgICAJY29uc3QgbWF4U2FtcGxlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1NBTVBMRVMgKTsKCiAgICAJcmV0dXJuIHsKCiAgICAJCWlzV2ViR0wyOiB0cnVlLCAvLyBrZWVwaW5nIHRoaXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgogICAgCQlnZXRNYXhBbmlzb3Ryb3B5OiBnZXRNYXhBbmlzb3Ryb3B5LAogICAgCQlnZXRNYXhQcmVjaXNpb246IGdldE1heFByZWNpc2lvbiwKCiAgICAJCXRleHR1cmVGb3JtYXRSZWFkYWJsZTogdGV4dHVyZUZvcm1hdFJlYWRhYmxlLAogICAgCQl0ZXh0dXJlVHlwZVJlYWRhYmxlOiB0ZXh0dXJlVHlwZVJlYWRhYmxlLAoKICAgIAkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCiAgICAJCWxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIsCiAgICAJCXJldmVyc2VEZXB0aEJ1ZmZlcjogcmV2ZXJzZURlcHRoQnVmZmVyLAoKICAgIAkJbWF4VGV4dHVyZXM6IG1heFRleHR1cmVzLAogICAgCQltYXhWZXJ0ZXhUZXh0dXJlczogbWF4VmVydGV4VGV4dHVyZXMsCiAgICAJCW1heFRleHR1cmVTaXplOiBtYXhUZXh0dXJlU2l6ZSwKICAgIAkJbWF4Q3ViZW1hcFNpemU6IG1heEN1YmVtYXBTaXplLAoKICAgIAkJbWF4QXR0cmlidXRlczogbWF4QXR0cmlidXRlcywKICAgIAkJbWF4VmVydGV4VW5pZm9ybXM6IG1heFZlcnRleFVuaWZvcm1zLAogICAgCQltYXhWYXJ5aW5nczogbWF4VmFyeWluZ3MsCiAgICAJCW1heEZyYWdtZW50VW5pZm9ybXM6IG1heEZyYWdtZW50VW5pZm9ybXMsCgogICAgCQl2ZXJ0ZXhUZXh0dXJlczogdmVydGV4VGV4dHVyZXMsCgogICAgCQltYXhTYW1wbGVzOiBtYXhTYW1wbGVzCgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKSB7CgogICAgCWNvbnN0IHNjb3BlID0gdGhpczsKCiAgICAJbGV0IGdsb2JhbFN0YXRlID0gbnVsbCwKICAgIAkJbnVtR2xvYmFsUGxhbmVzID0gMCwKICAgIAkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZSwKICAgIAkJcmVuZGVyaW5nU2hhZG93cyA9IGZhbHNlOwoKICAgIAljb25zdCBwbGFuZSA9IG5ldyBQbGFuZSgpLAogICAgCQl2aWV3Tm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDMoKSwKCiAgICAJCXVuaWZvcm0gPSB7IHZhbHVlOiBudWxsLCBuZWVkc1VwZGF0ZTogZmFsc2UgfTsKCiAgICAJdGhpcy51bmlmb3JtID0gdW5pZm9ybTsKICAgIAl0aGlzLm51bVBsYW5lcyA9IDA7CiAgICAJdGhpcy5udW1JbnRlcnNlY3Rpb24gPSAwOwoKICAgIAl0aGlzLmluaXQgPSBmdW5jdGlvbiAoIHBsYW5lcywgZW5hYmxlTG9jYWxDbGlwcGluZyApIHsKCiAgICAJCWNvbnN0IGVuYWJsZWQgPQogICAgCQkJcGxhbmVzLmxlbmd0aCAhPT0gMCB8fAogICAgCQkJZW5hYmxlTG9jYWxDbGlwcGluZyB8fAogICAgCQkJLy8gZW5hYmxlIHN0YXRlIG9mIHByZXZpb3VzIGZyYW1lIC0gdGhlIGNsaXBwaW5nIGNvZGUgaGFzIHRvCiAgICAJCQkvLyBydW4gYW5vdGhlciBmcmFtZSBpbiBvcmRlciB0byByZXNldCB0aGUgc3RhdGU6CiAgICAJCQludW1HbG9iYWxQbGFuZXMgIT09IDAgfHwKICAgIAkJCWxvY2FsQ2xpcHBpbmdFbmFibGVkOwoKICAgIAkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBlbmFibGVMb2NhbENsaXBwaW5nOwoKICAgIAkJbnVtR2xvYmFsUGxhbmVzID0gcGxhbmVzLmxlbmd0aDsKCiAgICAJCXJldHVybiBlbmFibGVkOwoKICAgIAl9OwoKICAgIAl0aGlzLmJlZ2luU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCXJlbmRlcmluZ1NoYWRvd3MgPSB0cnVlOwogICAgCQlwcm9qZWN0UGxhbmVzKCBudWxsICk7CgogICAgCX07CgogICAgCXRoaXMuZW5kU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCXJlbmRlcmluZ1NoYWRvd3MgPSBmYWxzZTsKCiAgICAJfTsKCiAgICAJdGhpcy5zZXRHbG9iYWxTdGF0ZSA9IGZ1bmN0aW9uICggcGxhbmVzLCBjYW1lcmEgKSB7CgogICAgCQlnbG9iYWxTdGF0ZSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCAwICk7CgogICAgCX07CgogICAgCXRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsLCBjYW1lcmEsIHVzZUNhY2hlICkgewoKICAgIAkJY29uc3QgcGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXMsCiAgICAJCQljbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbiwKICAgIAkJCWNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CgogICAgCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCiAgICAJCWlmICggISBsb2NhbENsaXBwaW5nRW5hYmxlZCB8fCBwbGFuZXMgPT09IG51bGwgfHwgcGxhbmVzLmxlbmd0aCA9PT0gMCB8fCByZW5kZXJpbmdTaGFkb3dzICYmICEgY2xpcFNoYWRvd3MgKSB7CgogICAgCQkJLy8gdGhlcmUncyBubyBsb2NhbCBjbGlwcGluZwoKICAgIAkJCWlmICggcmVuZGVyaW5nU2hhZG93cyApIHsKCiAgICAJCQkJLy8gdGhlcmUncyBubyBnbG9iYWwgY2xpcHBpbmcKCiAgICAJCQkJcHJvamVjdFBsYW5lcyggbnVsbCApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXJlc2V0R2xvYmFsU3RhdGUoKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnN0IG5HbG9iYWwgPSByZW5kZXJpbmdTaGFkb3dzID8gMCA6IG51bUdsb2JhbFBsYW5lcywKICAgIAkJCQlsR2xvYmFsID0gbkdsb2JhbCAqIDQ7CgogICAgCQkJbGV0IGRzdEFycmF5ID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmNsaXBwaW5nU3RhdGUgfHwgbnVsbDsKCiAgICAJCQl1bmlmb3JtLnZhbHVlID0gZHN0QXJyYXk7IC8vIGVuc3VyZSB1bmlxdWUgc3RhdGUKCiAgICAJCQlkc3RBcnJheSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBsR2xvYmFsLCB1c2VDYWNoZSApOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbEdsb2JhbDsgKysgaSApIHsKCiAgICAJCQkJZHN0QXJyYXlbIGkgXSA9IGdsb2JhbFN0YXRlWyBpIF07CgogICAgCQkJfQoKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5jbGlwcGluZ1N0YXRlID0gZHN0QXJyYXk7CiAgICAJCQl0aGlzLm51bUludGVyc2VjdGlvbiA9IGNsaXBJbnRlcnNlY3Rpb24gPyB0aGlzLm51bVBsYW5lcyA6IDA7CiAgICAJCQl0aGlzLm51bVBsYW5lcyArPSBuR2xvYmFsOwoKICAgIAkJfQoKCiAgICAJfTsKCiAgICAJZnVuY3Rpb24gcmVzZXRHbG9iYWxTdGF0ZSgpIHsKCiAgICAJCWlmICggdW5pZm9ybS52YWx1ZSAhPT0gZ2xvYmFsU3RhdGUgKSB7CgogICAgCQkJdW5pZm9ybS52YWx1ZSA9IGdsb2JhbFN0YXRlOwogICAgCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IG51bUdsb2JhbFBsYW5lcyA+IDA7CgogICAgCQl9CgogICAgCQlzY29wZS5udW1QbGFuZXMgPSBudW1HbG9iYWxQbGFuZXM7CiAgICAJCXNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIGRzdE9mZnNldCwgc2tpcFRyYW5zZm9ybSApIHsKCiAgICAJCWNvbnN0IG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMDsKICAgIAkJbGV0IGRzdEFycmF5ID0gbnVsbDsKCiAgICAJCWlmICggblBsYW5lcyAhPT0gMCApIHsKCiAgICAJCQlkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CgogICAgCQkJaWYgKCBza2lwVHJhbnNmb3JtICE9PSB0cnVlIHx8IGRzdEFycmF5ID09PSBudWxsICkgewoKICAgIAkJCQljb25zdCBmbGF0U2l6ZSA9IGRzdE9mZnNldCArIG5QbGFuZXMgKiA0LAogICAgCQkJCQl2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCiAgICAJCQkJdmlld05vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIHZpZXdNYXRyaXggKTsKCiAgICAJCQkJaWYgKCBkc3RBcnJheSA9PT0gbnVsbCB8fCBkc3RBcnJheS5sZW5ndGggPCBmbGF0U2l6ZSApIHsKCiAgICAJCQkJCWRzdEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggZmxhdFNpemUgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGk0ID0gZHN0T2Zmc2V0OyBpICE9PSBuUGxhbmVzOyArKyBpLCBpNCArPSA0ICkgewoKICAgIAkJCQkJcGxhbmUuY29weSggcGxhbmVzWyBpIF0gKS5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXgsIHZpZXdOb3JtYWxNYXRyaXggKTsKCiAgICAJCQkJCXBsYW5lLm5vcm1hbC50b0FycmF5KCBkc3RBcnJheSwgaTQgKTsKICAgIAkJCQkJZHN0QXJyYXlbIGk0ICsgMyBdID0gcGxhbmUuY29uc3RhbnQ7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OwogICAgCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCQlzY29wZS5udW1QbGFuZXMgPSBuUGxhbmVzOwogICAgCQlzY29wZS5udW1JbnRlcnNlY3Rpb24gPSAwOwoKICAgIAkJcmV0dXJuIGRzdEFycmF5OwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMQ3ViZU1hcHMoIHJlbmRlcmVyICkgewoKICAgIAlsZXQgY3ViZW1hcHMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlmdW5jdGlvbiBtYXBUZXh0dXJlTWFwcGluZyggdGV4dHVyZSwgbWFwcGluZyApIHsKCiAgICAJCWlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgKSB7CgogICAgCQkJdGV4dHVyZS5tYXBwaW5nID0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOwoKICAgIAkJfSBlbHNlIGlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKSB7CgogICAgCQkJdGV4dHVyZS5tYXBwaW5nID0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRleHR1cmU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0KCB0ZXh0dXJlICkgewoKICAgIAkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKICAgIAkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgogICAgCQkJaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyB8fCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyApIHsKCiAgICAJCQkJaWYgKCBjdWJlbWFwcy5oYXMoIHRleHR1cmUgKSApIHsKCiAgICAJCQkJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKS50ZXh0dXJlOwogICAgCQkJCQlyZXR1cm4gbWFwVGV4dHVyZU1hcHBpbmcoIGN1YmVtYXAsIHRleHR1cmUubWFwcGluZyApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJY29uc3QgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKICAgIAkJCQkJaWYgKCBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgewoKICAgIAkJCQkJCWNvbnN0IHJlbmRlclRhcmdldCA9IG5ldyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQoIGltYWdlLmhlaWdodCApOwogICAgCQkJCQkJcmVuZGVyVGFyZ2V0LmZyb21FcXVpcmVjdGFuZ3VsYXJUZXh0dXJlKCByZW5kZXJlciwgdGV4dHVyZSApOwogICAgCQkJCQkJY3ViZW1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJCQl0ZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKICAgIAkJCQkJCXJldHVybiBtYXBUZXh0dXJlTWFwcGluZyggcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHRleHR1cmUubWFwcGluZyApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkvLyBpbWFnZSBub3QgeWV0IHJlYWR5LiB0cnkgdGhlIGNvbnZlcnNpb24gbmV4dCBmcmFtZQoKICAgIAkJCQkJCXJldHVybiBudWxsOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRleHR1cmU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCiAgICAJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCWlmICggY3ViZW1hcCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWN1YmVtYXBzLmRlbGV0ZSggdGV4dHVyZSApOwogICAgCQkJY3ViZW1hcC5kaXNwb3NlKCk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCWN1YmVtYXBzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gewogICAgCQlnZXQ6IGdldCwKICAgIAkJZGlzcG9zZTogZGlzcG9zZQogICAgCX07CgogICAgfQoKICAgIGNvbnN0IExPRF9NSU4gPSA0OwoKICAgIC8vIFRoZSBzdGFuZGFyZCBkZXZpYXRpb25zIChyYWRpYW5zKSBhc3NvY2lhdGVkIHdpdGggdGhlIGV4dHJhIG1pcHMuIFRoZXNlIGFyZQogICAgLy8gY2hvc2VuIHRvIGFwcHJveGltYXRlIGEgVHJvd2JyaWRnZS1SZWl0eiBkaXN0cmlidXRpb24gZnVuY3Rpb24gdGltZXMgdGhlCiAgICAvLyBnZW9tZXRyaWMgc2hhZG93aW5nIGZ1bmN0aW9uLiBUaGVzZSBzaWdtYSB2YWx1ZXMgc3F1YXJlZCBtdXN0IG1hdGNoIHRoZQogICAgLy8gdmFyaWFuY2UgI2RlZmluZXMgaW4gY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50Lmdsc2wuanMuCiAgICBjb25zdCBFWFRSQV9MT0RfU0lHTUEgPSBbIDAuMTI1LCAwLjIxNSwgMC4zNSwgMC40NDYsIDAuNTI2LCAwLjU4MiBdOwoKICAgIC8vIFRoZSBtYXhpbXVtIGxlbmd0aCBvZiB0aGUgYmx1ciBmb3IgbG9vcC4gU21hbGxlciBzaWdtYXMgd2lsbCB1c2UgZmV3ZXIKICAgIC8vIHNhbXBsZXMgYW5kIGV4aXQgZWFybHksIGJ1dCBub3QgcmVjb21waWxlIHRoZSBzaGFkZXIuCiAgICBjb25zdCBNQVhfU0FNUExFUyA9IDIwOwoKICAgIGNvbnN0IF9mbGF0Q2FtZXJhID0gLypAX19QVVJFX18qLyBuZXcgT3J0aG9ncmFwaGljQ2FtZXJhKCk7CiAgICBjb25zdCBfY2xlYXJDb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CiAgICBsZXQgX29sZFRhcmdldCA9IG51bGw7CiAgICBsZXQgX29sZEFjdGl2ZUN1YmVGYWNlID0gMDsKICAgIGxldCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwogICAgbGV0IF9vbGRYckVuYWJsZWQgPSBmYWxzZTsKCiAgICAvLyBHb2xkZW4gUmF0aW8KICAgIGNvbnN0IFBISSA9ICggMSArIE1hdGguc3FydCggNSApICkgLyAyOwogICAgY29uc3QgSU5WX1BISSA9IDEgLyBQSEk7CgogICAgLy8gVmVydGljZXMgb2YgYSBkb2RlY2FoZWRyb24gKGV4Y2VwdCB0aGUgb3Bwb3NpdGVzLCB3aGljaCByZXByZXNlbnQgdGhlCiAgICAvLyBzYW1lIGF4aXMpLCB1c2VkIGFzIGF4aXMgZGlyZWN0aW9ucyBldmVubHkgc3ByZWFkIG9uIGEgc3BoZXJlLgogICAgY29uc3QgX2F4aXNEaXJlY3Rpb25zID0gWwogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0gUEhJLCBJTlZfUEhJLCAwICksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggUEhJLCBJTlZfUEhJLCAwICksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSBJTlZfUEhJLCAwLCBQSEkgKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCBJTlZfUEhJLCAwLCBQSEkgKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCBQSEksIC0gSU5WX1BISSApLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIFBISSwgSU5WX1BISSApLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0xLCAxLCAtMSApLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIC0xICksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLTEsIDEsIDEgKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAxLCAxLCAxICkgXTsKCiAgICBjb25zdCBfb3JpZ2luID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIC8qKgogICAgICogVGhpcyBjbGFzcyBnZW5lcmF0ZXMgYSBQcmVmaWx0ZXJlZCwgTWlwbWFwcGVkIFJhZGlhbmNlIEVudmlyb25tZW50IE1hcAogICAgICogKFBNUkVNKSBmcm9tIGEgY3ViZU1hcCBlbnZpcm9ubWVudCB0ZXh0dXJlLiBUaGlzIGFsbG93cyBkaWZmZXJlbnQgbGV2ZWxzIG9mCiAgICAgKiBibHVyIHRvIGJlIHF1aWNrbHkgYWNjZXNzZWQgYmFzZWQgb24gbWF0ZXJpYWwgcm91Z2huZXNzLiBJdCBpcyBwYWNrZWQgaW50byBhCiAgICAgKiBzcGVjaWFsIEN1YmVVViBmb3JtYXQgdGhhdCBhbGxvd3MgdXMgdG8gcGVyZm9ybSBjdXN0b20gaW50ZXJwb2xhdGlvbiBzbyB0aGF0CiAgICAgKiB3ZSBjYW4gc3VwcG9ydCBub25saW5lYXIgZm9ybWF0cyBzdWNoIGFzIFJHQkUuIFVubGlrZSBhIHRyYWRpdGlvbmFsIG1pcG1hcAogICAgICogY2hhaW4sIGl0IG9ubHkgZ29lcyBkb3duIHRvIHRoZSBMT0RfTUlOIGxldmVsIChhYm92ZSksIGFuZCB0aGVuIGNyZWF0ZXMgZXh0cmEKICAgICAqIGV2ZW4gbW9yZSBmaWx0ZXJlZCAnbWlwcycgYXQgdGhlIHNhbWUgTE9EX01JTiByZXNvbHV0aW9uLCBhc3NvY2lhdGVkIHdpdGgKICAgICAqIGhpZ2hlciByb3VnaG5lc3MgbGV2ZWxzLiBJbiB0aGlzIHdheSB3ZSBtYWludGFpbiByZXNvbHV0aW9uIHRvIHNtb290aGx5CiAgICAgKiBpbnRlcnBvbGF0ZSBkaWZmdXNlIGxpZ2h0aW5nIHdoaWxlIGxpbWl0aW5nIHNhbXBsaW5nIGNvbXB1dGF0aW9uLgogICAgICoKICAgICAqIFBhcGVyOiBGYXN0LCBBY2N1cmF0ZSBJbWFnZS1CYXNlZCBMaWdodGluZzoKICAgICAqIHtAbGluayBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vZmlsZS9kLzE1eThyX1VwS2xVOVN2VjRJTGIwQzNxQ1BlY1M4cHZMei92aWV3fQogICAgKi8KICAgIGNsYXNzIFBNUkVNR2VuZXJhdG9yIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBQTVJFTSBnZW5lcmF0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCByZW5kZXJlciApIHsKCiAgICAJCXRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CiAgICAJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gbnVsbDsKCiAgICAJCXRoaXMuX2xvZE1heCA9IDA7CiAgICAJCXRoaXMuX2N1YmVTaXplID0gMDsKICAgIAkJdGhpcy5fbG9kUGxhbmVzID0gW107CiAgICAJCXRoaXMuX3NpemVMb2RzID0gW107CiAgICAJCXRoaXMuX3NpZ21hcyA9IFtdOwoKICAgIAkJdGhpcy5fYmx1ck1hdGVyaWFsID0gbnVsbDsKICAgIAkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gbnVsbDsKICAgIAkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IG51bGw7CgogICAgCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2JsdXJNYXRlcmlhbCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYSBzdXBwbGllZCBTY2VuZSwgd2hpY2ggY2FuIGJlIGZhc3RlciB0aGFuIHVzaW5nIGFuCiAgICAJICogaW1hZ2UgaWYgbmV0d29ya2luZyBiYW5kd2lkdGggaXMgbG93LiBPcHRpb25hbCBzaWdtYSBzcGVjaWZpZXMgYSBibHVyIHJhZGl1cwogICAgCSAqIGluIHJhZGlhbnMgdG8gYmUgYXBwbGllZCB0byB0aGUgc2NlbmUgYmVmb3JlIFBNUkVNIGdlbmVyYXRpb24uIE9wdGlvbmFsIG5lYXIKICAgIAkgKiBhbmQgZmFyIHBsYW5lcyBlbnN1cmUgdGhlIHNjZW5lIGlzIHJlbmRlcmVkIGluIGl0cyBlbnRpcmV0eS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U2NlbmV9IHNjZW5lIC0gVGhlIHNjZW5lIHRvIGJlIGNhcHR1cmVkLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbc2lnbWE9MF0gLSBUaGUgYmx1ciByYWRpdXMgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW25lYXI9MC4xXSAtIFRoZSBuZWFyIHBsYW5lIGRpc3RhbmNlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZmFyPTEwMF0gLSBUaGUgZmFyIHBsYW5lIGRpc3RhbmNlLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gLSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5zaXplPTI1Nl0gLSBUaGUgdGV4dHVyZSBzaXplIG9mIHRoZSBQTVJFTS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25zLnJlbmRlclRhcmdldD1vcmlnaW5dIC0gVGhlIHBvc2l0aW9uIG9mIHRoZSBpbnRlcm5hbCBjdWJlIGNhbWVyYSB0aGF0IHJlbmRlcnMgdGhlIHNjZW5lLgogICAgCSAqIEByZXR1cm4ge1dlYkdMUmVuZGVyVGFyZ2V0fSBUaGUgcmVzdWx0aW5nIFBNUkVNLgogICAgCSAqLwogICAgCWZyb21TY2VuZSggc2NlbmUsIHNpZ21hID0gMCwgbmVhciA9IDAuMSwgZmFyID0gMTAwLCBvcHRpb25zID0ge30gKSB7CgogICAgCQljb25zdCB7CiAgICAJCQlzaXplID0gMjU2LAogICAgCQkJcG9zaXRpb24gPSBfb3JpZ2luLAogICAgCQl9ID0gb3B0aW9uczsKCiAgICAJCV9vbGRUYXJnZXQgPSB0aGlzLl9yZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKICAgIAkJX29sZEFjdGl2ZUN1YmVGYWNlID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKICAgIAkJX29sZEFjdGl2ZU1pcG1hcExldmVsID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKICAgIAkJX29sZFhyRW5hYmxlZCA9IHRoaXMuX3JlbmRlcmVyLnhyLmVuYWJsZWQ7CgogICAgCQl0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkID0gZmFsc2U7CgogICAgCQl0aGlzLl9zZXRTaXplKCBzaXplICk7CgogICAgCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSB0aGlzLl9hbGxvY2F0ZVRhcmdldHMoKTsKICAgIAkJY3ViZVVWUmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyID0gdHJ1ZTsKCiAgICAJCXRoaXMuX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCwgcG9zaXRpb24gKTsKCiAgICAJCWlmICggc2lnbWEgPiAwICkgewoKICAgIAkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgc2lnbWEgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMuX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApOwogICAgCQl0aGlzLl9jbGVhbnVwKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCiAgICAJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhbiBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSwgd2hpY2ggY2FuIGJlIGVpdGhlciBMRFIKICAgIAkgKiBvciBIRFIuIFRoZSBpZGVhbCBpbnB1dCBpbWFnZSBzaXplIGlzIDFrICgxMDI0IHggNTEyKSwKICAgIAkgKiBhcyB0aGlzIG1hdGNoZXMgYmVzdCB3aXRoIHRoZSAyNTYgeCAyNTYgY3ViZW1hcCBvdXRwdXQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1RleHR1cmV9IGVxdWlyZWN0YW5ndWxhciAtIFRoZSBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSB0byBiZSBjb252ZXJ0ZWQuCiAgICAJICogQHBhcmFtIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFtyZW5kZXJUYXJnZXQ9bnVsbF0gLSBUaGUgcmVuZGVyIHRhcmdldCB0byB1c2UuCiAgICAJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCiAgICAJICovCiAgICAJZnJvbUVxdWlyZWN0YW5ndWxhciggZXF1aXJlY3Rhbmd1bGFyLCByZW5kZXJUYXJnZXQgPSBudWxsICkgewoKICAgIAkJcmV0dXJuIHRoaXMuX2Zyb21UZXh0dXJlKCBlcXVpcmVjdGFuZ3VsYXIsIHJlbmRlclRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYW4gY3ViZW1hcCB0ZXh0dXJlLCB3aGljaCBjYW4gYmUgZWl0aGVyIExEUgogICAgCSAqIG9yIEhEUi4gVGhlIGlkZWFsIGlucHV0IGN1YmUgc2l6ZSBpcyAyNTYgeCAyNTYsCiAgICAJICogYXMgdGhpcyBtYXRjaGVzIGJlc3Qgd2l0aCB0aGUgMjU2IHggMjU2IGN1YmVtYXAgb3V0cHV0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtUZXh0dXJlfSBjdWJlbWFwIC0gVGhlIGN1YmVtYXAgdGV4dHVyZSB0byBiZSBjb252ZXJ0ZWQuCiAgICAJICogQHBhcmFtIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFtyZW5kZXJUYXJnZXQ9bnVsbF0gLSBUaGUgcmVuZGVyIHRhcmdldCB0byB1c2UuCiAgICAJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCiAgICAJICovCiAgICAJZnJvbUN1YmVtYXAoIGN1YmVtYXAsIHJlbmRlclRhcmdldCA9IG51bGwgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fZnJvbVRleHR1cmUoIGN1YmVtYXAsIHJlbmRlclRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFByZS1jb21waWxlcyB0aGUgY3ViZW1hcCBzaGFkZXIuIFlvdSBjYW4gZ2V0IGZhc3RlciBzdGFydC11cCBieSBpbnZva2luZyB0aGlzIG1ldGhvZCBkdXJpbmcKICAgIAkgKiB5b3VyIHRleHR1cmUncyBuZXR3b3JrIGZldGNoIGZvciBpbmNyZWFzZWQgY29uY3VycmVuY3kuCiAgICAJICovCiAgICAJY29tcGlsZUN1YmVtYXBTaGFkZXIoKSB7CgogICAgCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPSBfZ2V0Q3ViZW1hcE1hdGVyaWFsKCk7CiAgICAJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFByZS1jb21waWxlcyB0aGUgZXF1aXJlY3Rhbmd1bGFyIHNoYWRlci4gWW91IGNhbiBnZXQgZmFzdGVyIHN0YXJ0LXVwIGJ5IGludm9raW5nIHRoaXMgbWV0aG9kIGR1cmluZwogICAgCSAqIHlvdXIgdGV4dHVyZSdzIG5ldHdvcmsgZmV0Y2ggZm9yIGluY3JlYXNlZCBjb25jdXJyZW5jeS4KICAgIAkgKi8KICAgIAljb21waWxlRXF1aXJlY3Rhbmd1bGFyU2hhZGVyKCkgewoKICAgIAkJaWYgKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID09PSBudWxsICkgewoKICAgIAkJCXRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPSBfZ2V0RXF1aXJlY3RNYXRlcmlhbCgpOwogICAgCQkJdGhpcy5fY29tcGlsZU1hdGVyaWFsKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGlzcG9zZXMgb2YgdGhlIFBNUkVNR2VuZXJhdG9yJ3MgaW50ZXJuYWwgbWVtb3J5LiBOb3RlIHRoYXQgUE1SRU1HZW5lcmF0b3IgaXMgYSBzdGF0aWMgY2xhc3MsCiAgICAJICogc28geW91IHNob3VsZCBub3QgbmVlZCBtb3JlIHRoYW4gb25lIFBNUkVNR2VuZXJhdG9yIG9iamVjdC4gSWYgeW91IGRvLCBjYWxsaW5nIGRpc3Bvc2UoKSBvbgogICAgCSAqIG9uZSBvZiB0aGVtIHdpbGwgY2F1c2UgYW55IG90aGVycyB0byBhbHNvIGJlY29tZSB1bnVzYWJsZS4KICAgIAkgKi8KICAgIAlkaXNwb3NlKCkgewoKICAgIAkJdGhpcy5fZGlzcG9zZSgpOwoKICAgIAkJaWYgKCB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwuZGlzcG9zZSgpOwogICAgCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsLmRpc3Bvc2UoKTsKCiAgICAJfQoKICAgIAkvLyBwcml2YXRlIGludGVyZmFjZQoKICAgIAlfc2V0U2l6ZSggY3ViZVNpemUgKSB7CgogICAgCQl0aGlzLl9sb2RNYXggPSBNYXRoLmZsb29yKCBNYXRoLmxvZzIoIGN1YmVTaXplICkgKTsKICAgIAkJdGhpcy5fY3ViZVNpemUgPSBNYXRoLnBvdyggMiwgdGhpcy5fbG9kTWF4ICk7CgogICAgCX0KCiAgICAJX2Rpc3Bvc2UoKSB7CgogICAgCQlpZiAoIHRoaXMuX2JsdXJNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMuX2JsdXJNYXRlcmlhbC5kaXNwb3NlKCk7CgogICAgCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQuZGlzcG9zZSgpOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fbG9kUGxhbmVzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQl0aGlzLl9sb2RQbGFuZXNbIGkgXS5kaXNwb3NlKCk7CgogICAgCQl9CgogICAgCX0KCiAgICAJX2NsZWFudXAoIG91dHB1dFRhcmdldCApIHsKCiAgICAJCXRoaXMuX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggX29sZFRhcmdldCwgX29sZEFjdGl2ZUN1YmVGYWNlLCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgKTsKICAgIAkJdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZCA9IF9vbGRYckVuYWJsZWQ7CgogICAgCQlvdXRwdXRUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsKICAgIAkJX3NldFZpZXdwb3J0KCBvdXRwdXRUYXJnZXQsIDAsIDAsIG91dHB1dFRhcmdldC53aWR0aCwgb3V0cHV0VGFyZ2V0LmhlaWdodCApOwoKICAgIAl9CgogICAgCV9mcm9tVGV4dHVyZSggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJaWYgKCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZsZWN0aW9uTWFwcGluZyB8fCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApIHsKCiAgICAJCQl0aGlzLl9zZXRTaXplKCB0ZXh0dXJlLmltYWdlLmxlbmd0aCA9PT0gMCA/IDE2IDogKCB0ZXh0dXJlLmltYWdlWyAwIF0ud2lkdGggfHwgdGV4dHVyZS5pbWFnZVsgMCBdLmltYWdlLndpZHRoICkgKTsKCiAgICAJCX0gZWxzZSB7IC8vIEVxdWlyZWN0YW5ndWxhcgoKICAgIAkJCXRoaXMuX3NldFNpemUoIHRleHR1cmUuaW1hZ2Uud2lkdGggLyA0ICk7CgogICAgCQl9CgogICAgCQlfb2xkVGFyZ2V0ID0gdGhpcy5fcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAJCV9vbGRBY3RpdmVDdWJlRmFjZSA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CiAgICAJCV9vbGRBY3RpdmVNaXBtYXBMZXZlbCA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CiAgICAJCV9vbGRYckVuYWJsZWQgPSB0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkOwoKICAgIAkJdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0IHx8IHRoaXMuX2FsbG9jYXRlVGFyZ2V0cygpOwogICAgCQl0aGlzLl90ZXh0dXJlVG9DdWJlVVYoIHRleHR1cmUsIGN1YmVVVlJlbmRlclRhcmdldCApOwogICAgCQl0aGlzLl9hcHBseVBNUkVNKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKICAgIAkJdGhpcy5fY2xlYW51cCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgogICAgCQlyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKICAgIAl9CgogICAgCV9hbGxvY2F0ZVRhcmdldHMoKSB7CgogICAgCQljb25zdCB3aWR0aCA9IDMgKiBNYXRoLm1heCggdGhpcy5fY3ViZVNpemUsIDE2ICogNyApOwogICAgCQljb25zdCBoZWlnaHQgPSA0ICogdGhpcy5fY3ViZVNpemU7CgogICAgCQljb25zdCBwYXJhbXMgPSB7CiAgICAJCQltYWdGaWx0ZXI6IExpbmVhckZpbHRlciwKICAgIAkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAogICAgCQkJZ2VuZXJhdGVNaXBtYXBzOiBmYWxzZSwKICAgIAkJCXR5cGU6IEhhbGZGbG9hdFR5cGUsCiAgICAJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCiAgICAJCQljb2xvclNwYWNlOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSwKICAgIAkJCWRlcHRoQnVmZmVyOiBmYWxzZQogICAgCQl9OwoKICAgIAkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgogICAgCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0LndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldC5oZWlnaHQgIT09IGhlaWdodCApIHsKCiAgICAJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgewoKICAgIAkJCQl0aGlzLl9kaXNwb3NlKCk7CgogICAgCQkJfQoKICAgIAkJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgogICAgCQkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwogICAgCQkJKCB7IHNpemVMb2RzOiB0aGlzLl9zaXplTG9kcywgbG9kUGxhbmVzOiB0aGlzLl9sb2RQbGFuZXMsIHNpZ21hczogdGhpcy5fc2lnbWFzIH0gPSBfY3JlYXRlUGxhbmVzKCBfbG9kTWF4ICkgKTsKCiAgICAJCQl0aGlzLl9ibHVyTWF0ZXJpYWwgPSBfZ2V0Qmx1clNoYWRlciggX2xvZE1heCwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCiAgICAJfQoKICAgIAlfY29tcGlsZU1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCiAgICAJCWNvbnN0IHRtcE1lc2ggPSBuZXcgTWVzaCggdGhpcy5fbG9kUGxhbmVzWyAwIF0sIG1hdGVyaWFsICk7CiAgICAJCXRoaXMuX3JlbmRlcmVyLmNvbXBpbGUoIHRtcE1lc2gsIF9mbGF0Q2FtZXJhICk7CgogICAgCX0KCiAgICAJX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCwgcG9zaXRpb24gKSB7CgogICAgCQljb25zdCBmb3YgPSA5MDsKICAgIAkJY29uc3QgYXNwZWN0ID0gMTsKICAgIAkJY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggZm92LCBhc3BlY3QsIG5lYXIsIGZhciApOwogICAgCQljb25zdCB1cFNpZ24gPSBbIDEsIC0xLCAxLCAxLCAxLCAxIF07CiAgICAJCWNvbnN0IGZvcndhcmRTaWduID0gWyAxLCAxLCAxLCAtMSwgLTEsIC0xIF07CiAgICAJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgogICAgCQljb25zdCBvcmlnaW5hbEF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKICAgIAkJY29uc3QgdG9uZU1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKICAgIAkJcmVuZGVyZXIuZ2V0Q2xlYXJDb2xvciggX2NsZWFyQ29sb3IgKTsKCiAgICAJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKICAgIAkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgogICAgCQljb25zdCBiYWNrZ3JvdW5kTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsKICAgIAkJCW5hbWU6ICdQTVJFTS5CYWNrZ3JvdW5kJywKICAgIAkJCXNpZGU6IEJhY2tTaWRlLAogICAgCQkJZGVwdGhXcml0ZTogZmFsc2UsCiAgICAJCQlkZXB0aFRlc3Q6IGZhbHNlLAogICAgCQl9ICk7CgogICAgCQljb25zdCBiYWNrZ3JvdW5kQm94ID0gbmV3IE1lc2goIG5ldyBCb3hHZW9tZXRyeSgpLCBiYWNrZ3JvdW5kTWF0ZXJpYWwgKTsKCiAgICAJCWxldCB1c2VTb2xpZENvbG9yID0gZmFsc2U7CiAgICAJCWNvbnN0IGJhY2tncm91bmQgPSBzY2VuZS5iYWNrZ3JvdW5kOwoKICAgIAkJaWYgKCBiYWNrZ3JvdW5kICkgewoKICAgIAkJCWlmICggYmFja2dyb3VuZC5pc0NvbG9yICkgewoKICAgIAkJCQliYWNrZ3JvdW5kTWF0ZXJpYWwuY29sb3IuY29weSggYmFja2dyb3VuZCApOwogICAgCQkJCXNjZW5lLmJhY2tncm91bmQgPSBudWxsOwogICAgCQkJCXVzZVNvbGlkQ29sb3IgPSB0cnVlOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJYmFja2dyb3VuZE1hdGVyaWFsLmNvbG9yLmNvcHkoIF9jbGVhckNvbG9yICk7CiAgICAJCQl1c2VTb2xpZENvbG9yID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJY29uc3QgY29sID0gaSAlIDM7CgogICAgCQkJaWYgKCBjb2wgPT09IDAgKSB7CgogICAgCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCB1cFNpZ25bIGkgXSwgMCApOwogICAgCQkJCWN1YmVDYW1lcmEucG9zaXRpb24uc2V0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CiAgICAJCQkJY3ViZUNhbWVyYS5sb29rQXQoIHBvc2l0aW9uLnggKyBmb3J3YXJkU2lnblsgaSBdLCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CgogICAgCQkJfSBlbHNlIGlmICggY29sID09PSAxICkgewoKICAgIAkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgMCwgdXBTaWduWyBpIF0gKTsKICAgIAkJCQljdWJlQ2FtZXJhLnBvc2l0aW9uLnNldCggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwogICAgCQkJCWN1YmVDYW1lcmEubG9va0F0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55ICsgZm9yd2FyZFNpZ25bIGkgXSwgcG9zaXRpb24ueiApOwoKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgdXBTaWduWyBpIF0sIDAgKTsKICAgIAkJCQljdWJlQ2FtZXJhLnBvc2l0aW9uLnNldCggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwogICAgCQkJCWN1YmVDYW1lcmEubG9va0F0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICsgZm9yd2FyZFNpZ25bIGkgXSApOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCBzaXplID0gdGhpcy5fY3ViZVNpemU7CgogICAgCQkJX3NldFZpZXdwb3J0KCBjdWJlVVZSZW5kZXJUYXJnZXQsIGNvbCAqIHNpemUsIGkgPiAyID8gc2l6ZSA6IDAsIHNpemUsIHNpemUgKTsKCiAgICAJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKICAgIAkJCWlmICggdXNlU29saWRDb2xvciApIHsKCiAgICAJCQkJcmVuZGVyZXIucmVuZGVyKCBiYWNrZ3JvdW5kQm94LCBjdWJlQ2FtZXJhICk7CgogICAgCQkJfQoKICAgIAkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGN1YmVDYW1lcmEgKTsKCiAgICAJCX0KCiAgICAJCWJhY2tncm91bmRCb3guZ2VvbWV0cnkuZGlzcG9zZSgpOwogICAgCQliYWNrZ3JvdW5kQm94Lm1hdGVyaWFsLmRpc3Bvc2UoKTsKCiAgICAJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gdG9uZU1hcHBpbmc7CiAgICAJCXJlbmRlcmVyLmF1dG9DbGVhciA9IG9yaWdpbmFsQXV0b0NsZWFyOwogICAgCQlzY2VuZS5iYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCiAgICAJfQoKICAgIAlfdGV4dHVyZVRvQ3ViZVVWKCB0ZXh0dXJlLCBjdWJlVVZSZW5kZXJUYXJnZXQgKSB7CgogICAgCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoKICAgIAkJY29uc3QgaXNDdWJlVGV4dHVyZSA9ICggdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgfHwgdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmcmFjdGlvbk1hcHBpbmcgKTsKCiAgICAJCWlmICggaXNDdWJlVGV4dHVyZSApIHsKCiAgICAJCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCiAgICAJCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gX2dldEN1YmVtYXBNYXRlcmlhbCgpOwoKICAgIAkJCX0KCiAgICAJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9PT0gbnVsbCApIHsKCiAgICAJCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IF9nZXRFcXVpcmVjdE1hdGVyaWFsKCk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJY29uc3QgbWF0ZXJpYWwgPSBpc0N1YmVUZXh0dXJlID8gdGhpcy5fY3ViZW1hcE1hdGVyaWFsIDogdGhpcy5fZXF1aXJlY3RNYXRlcmlhbDsKICAgIAkJY29uc3QgbWVzaCA9IG5ldyBNZXNoKCB0aGlzLl9sb2RQbGFuZXNbIDAgXSwgbWF0ZXJpYWwgKTsKCiAgICAJCWNvbnN0IHVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgogICAgCQl1bmlmb3Jtc1sgJ2Vudk1hcCcgXS52YWx1ZSA9IHRleHR1cmU7CgogICAgCQljb25zdCBzaXplID0gdGhpcy5fY3ViZVNpemU7CgogICAgCQlfc2V0Vmlld3BvcnQoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgMyAqIHNpemUsIDIgKiBzaXplICk7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwogICAgCQlyZW5kZXJlci5yZW5kZXIoIG1lc2gsIF9mbGF0Q2FtZXJhICk7CgogICAgCX0KCiAgICAJX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCiAgICAJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CiAgICAJCWNvbnN0IGF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKICAgIAkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CiAgICAJCWNvbnN0IG4gPSB0aGlzLl9sb2RQbGFuZXMubGVuZ3RoOwoKICAgIAkJZm9yICggbGV0IGkgPSAxOyBpIDwgbjsgaSArKyApIHsKCiAgICAJCQljb25zdCBzaWdtYSA9IE1hdGguc3FydCggdGhpcy5fc2lnbWFzWyBpIF0gKiB0aGlzLl9zaWdtYXNbIGkgXSAtIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSAqIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSApOwoKICAgIAkJCWNvbnN0IHBvbGVBeGlzID0gX2F4aXNEaXJlY3Rpb25zWyAoIG4gLSBpIC0gMSApICUgX2F4aXNEaXJlY3Rpb25zLmxlbmd0aCBdOwoKICAgIAkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgaSAtIDEsIGksIHNpZ21hLCBwb2xlQXhpcyApOwoKICAgIAkJfQoKICAgIAkJcmVuZGVyZXIuYXV0b0NsZWFyID0gYXV0b0NsZWFyOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoaXMgaXMgYSB0d28tcGFzcyBHYXVzc2lhbiBibHVyIGZvciBhIGN1YmVtYXAuIE5vcm1hbGx5IHRoaXMgaXMgZG9uZQogICAgCSAqIHZlcnRpY2FsbHkgYW5kIGhvcml6b250YWxseSwgYnV0IHRoaXMgYnJlYWtzIGRvd24gb24gYSBjdWJlLiBIZXJlIHdlIGFwcGx5CiAgICAJICogdGhlIGJsdXIgbGF0aXR1ZGluYWxseSAoYXJvdW5kIHRoZSBwb2xlcyksIGFuZCB0aGVuIGxvbmdpdHVkaW5hbGx5ICh0b3dhcmRzCiAgICAJICogdGhlIHBvbGVzKSB0byBhcHByb3hpbWF0ZSB0aGUgb3J0aG9nb25hbGx5LXNlcGFyYWJsZSBibHVyLiBJdCBpcyBsZWFzdAogICAgCSAqIGFjY3VyYXRlIGF0IHRoZSBwb2xlcywgYnV0IHN0aWxsIGRvZXMgYSBkZWNlbnQgam9iLgogICAgCSAqCiAgICAJICogQHByaXZhdGUKICAgIAkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyVGFyZ2V0fSBjdWJlVVZSZW5kZXJUYXJnZXQKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbG9kSW4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbG9kT3V0CiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNpZ21hCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbcG9sZUF4aXNdCiAgICAJICovCiAgICAJX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgbG9kSW4sIGxvZE91dCwgc2lnbWEsIHBvbGVBeGlzICkgewoKICAgIAkJY29uc3QgcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldDsKCiAgICAJCXRoaXMuX2hhbGZCbHVyKAogICAgCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LAogICAgCQkJcGluZ1BvbmdSZW5kZXJUYXJnZXQsCiAgICAJCQlsb2RJbiwKICAgIAkJCWxvZE91dCwKICAgIAkJCXNpZ21hLAogICAgCQkJJ2xhdGl0dWRpbmFsJywKICAgIAkJCXBvbGVBeGlzICk7CgogICAgCQl0aGlzLl9oYWxmQmx1cigKICAgIAkJCXBpbmdQb25nUmVuZGVyVGFyZ2V0LAogICAgCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LAogICAgCQkJbG9kT3V0LAogICAgCQkJbG9kT3V0LAogICAgCQkJc2lnbWEsCiAgICAJCQknbG9uZ2l0dWRpbmFsJywKICAgIAkJCXBvbGVBeGlzICk7CgogICAgCX0KCiAgICAJX2hhbGZCbHVyKCB0YXJnZXRJbiwgdGFyZ2V0T3V0LCBsb2RJbiwgbG9kT3V0LCBzaWdtYVJhZGlhbnMsIGRpcmVjdGlvbiwgcG9sZUF4aXMgKSB7CgogICAgCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwogICAgCQljb25zdCBibHVyTWF0ZXJpYWwgPSB0aGlzLl9ibHVyTWF0ZXJpYWw7CgogICAgCQlpZiAoIGRpcmVjdGlvbiAhPT0gJ2xhdGl0dWRpbmFsJyAmJiBkaXJlY3Rpb24gIT09ICdsb25naXR1ZGluYWwnICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoCiAgICAJCQkJJ2JsdXIgZGlyZWN0aW9uIG11c3QgYmUgZWl0aGVyIGxhdGl0dWRpbmFsIG9yIGxvbmdpdHVkaW5hbCEnICk7CgogICAgCQl9CgogICAgCQkvLyBOdW1iZXIgb2Ygc3RhbmRhcmQgZGV2aWF0aW9ucyBhdCB3aGljaCB0byBjdXQgb2ZmIHRoZSBkaXNjcmV0ZSBhcHByb3hpbWF0aW9uLgogICAgCQljb25zdCBTVEFOREFSRF9ERVZJQVRJT05TID0gMzsKCiAgICAJCWNvbnN0IGJsdXJNZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgbG9kT3V0IF0sIGJsdXJNYXRlcmlhbCApOwogICAgCQljb25zdCBibHVyVW5pZm9ybXMgPSBibHVyTWF0ZXJpYWwudW5pZm9ybXM7CgogICAgCQljb25zdCBwaXhlbHMgPSB0aGlzLl9zaXplTG9kc1sgbG9kSW4gXSAtIDE7CiAgICAJCWNvbnN0IHJhZGlhbnNQZXJQaXhlbCA9IGlzRmluaXRlKCBzaWdtYVJhZGlhbnMgKSA/IE1hdGguUEkgLyAoIDIgKiBwaXhlbHMgKSA6IDIgKiBNYXRoLlBJIC8gKCAyICogTUFYX1NBTVBMRVMgLSAxICk7CiAgICAJCWNvbnN0IHNpZ21hUGl4ZWxzID0gc2lnbWFSYWRpYW5zIC8gcmFkaWFuc1BlclBpeGVsOwogICAgCQljb25zdCBzYW1wbGVzID0gaXNGaW5pdGUoIHNpZ21hUmFkaWFucyApID8gMSArIE1hdGguZmxvb3IoIFNUQU5EQVJEX0RFVklBVElPTlMgKiBzaWdtYVBpeGVscyApIDogTUFYX1NBTVBMRVM7CgogICAgCQlpZiAoIHNhbXBsZXMgPiBNQVhfU0FNUExFUyApIHsKCiAgICAJCQljb25zb2xlLndhcm4oIGBzaWdtYVJhZGlhbnMsICR7CgkJCQlzaWdtYVJhZGlhbnN9LCBpcyB0b28gbGFyZ2UgYW5kIHdpbGwgY2xpcCwgYXMgaXQgcmVxdWVzdGVkICR7CgkJCQlzYW1wbGVzfSBzYW1wbGVzIHdoZW4gdGhlIG1heGltdW0gaXMgc2V0IHRvICR7TUFYX1NBTVBMRVN9YCApOwoKICAgIAkJfQoKICAgIAkJY29uc3Qgd2VpZ2h0cyA9IFtdOwogICAgCQlsZXQgc3VtID0gMDsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IE1BWF9TQU1QTEVTOyArKyBpICkgewoKICAgIAkJCWNvbnN0IHggPSBpIC8gc2lnbWFQaXhlbHM7CiAgICAJCQljb25zdCB3ZWlnaHQgPSBNYXRoLmV4cCggLSB4ICogeCAvIDIgKTsKICAgIAkJCXdlaWdodHMucHVzaCggd2VpZ2h0ICk7CgogICAgCQkJaWYgKCBpID09PSAwICkgewoKICAgIAkJCQlzdW0gKz0gd2VpZ2h0OwoKICAgIAkJCX0gZWxzZSBpZiAoIGkgPCBzYW1wbGVzICkgewoKICAgIAkJCQlzdW0gKz0gMiAqIHdlaWdodDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB3ZWlnaHRzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQl3ZWlnaHRzWyBpIF0gPSB3ZWlnaHRzWyBpIF0gLyBzdW07CgogICAgCQl9CgogICAgCQlibHVyVW5pZm9ybXNbICdlbnZNYXAnIF0udmFsdWUgPSB0YXJnZXRJbi50ZXh0dXJlOwogICAgCQlibHVyVW5pZm9ybXNbICdzYW1wbGVzJyBdLnZhbHVlID0gc2FtcGxlczsKICAgIAkJYmx1clVuaWZvcm1zWyAnd2VpZ2h0cycgXS52YWx1ZSA9IHdlaWdodHM7CiAgICAJCWJsdXJVbmlmb3Jtc1sgJ2xhdGl0dWRpbmFsJyBdLnZhbHVlID0gZGlyZWN0aW9uID09PSAnbGF0aXR1ZGluYWwnOwoKICAgIAkJaWYgKCBwb2xlQXhpcyApIHsKCiAgICAJCQlibHVyVW5pZm9ybXNbICdwb2xlQXhpcycgXS52YWx1ZSA9IHBvbGVBeGlzOwoKICAgIAkJfQoKICAgIAkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwogICAgCQlibHVyVW5pZm9ybXNbICdkVGhldGEnIF0udmFsdWUgPSByYWRpYW5zUGVyUGl4ZWw7CiAgICAJCWJsdXJVbmlmb3Jtc1sgJ21pcEludCcgXS52YWx1ZSA9IF9sb2RNYXggLSBsb2RJbjsKCiAgICAJCWNvbnN0IG91dHB1dFNpemUgPSB0aGlzLl9zaXplTG9kc1sgbG9kT3V0IF07CiAgICAJCWNvbnN0IHggPSAzICogb3V0cHV0U2l6ZSAqICggbG9kT3V0ID4gX2xvZE1heCAtIExPRF9NSU4gPyBsb2RPdXQgLSBfbG9kTWF4ICsgTE9EX01JTiA6IDAgKTsKICAgIAkJY29uc3QgeSA9IDQgKiAoIHRoaXMuX2N1YmVTaXplIC0gb3V0cHV0U2l6ZSApOwoKICAgIAkJX3NldFZpZXdwb3J0KCB0YXJnZXRPdXQsIHgsIHksIDMgKiBvdXRwdXRTaXplLCAyICogb3V0cHV0U2l6ZSApOwogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHRhcmdldE91dCApOwogICAgCQlyZW5kZXJlci5yZW5kZXIoIGJsdXJNZXNoLCBfZmxhdENhbWVyYSApOwoKICAgIAl9CgogICAgfQoKCgogICAgZnVuY3Rpb24gX2NyZWF0ZVBsYW5lcyggbG9kTWF4ICkgewoKICAgIAljb25zdCBsb2RQbGFuZXMgPSBbXTsKICAgIAljb25zdCBzaXplTG9kcyA9IFtdOwogICAgCWNvbnN0IHNpZ21hcyA9IFtdOwoKICAgIAlsZXQgbG9kID0gbG9kTWF4OwoKICAgIAljb25zdCB0b3RhbExvZHMgPSBsb2RNYXggLSBMT0RfTUlOICsgMSArIEVYVFJBX0xPRF9TSUdNQS5sZW5ndGg7CgogICAgCWZvciAoIGxldCBpID0gMDsgaSA8IHRvdGFsTG9kczsgaSArKyApIHsKCiAgICAJCWNvbnN0IHNpemVMb2QgPSBNYXRoLnBvdyggMiwgbG9kICk7CiAgICAJCXNpemVMb2RzLnB1c2goIHNpemVMb2QgKTsKICAgIAkJbGV0IHNpZ21hID0gMS4wIC8gc2l6ZUxvZDsKCiAgICAJCWlmICggaSA+IGxvZE1heCAtIExPRF9NSU4gKSB7CgogICAgCQkJc2lnbWEgPSBFWFRSQV9MT0RfU0lHTUFbIGkgLSBsb2RNYXggKyBMT0RfTUlOIC0gMSBdOwoKICAgIAkJfSBlbHNlIGlmICggaSA9PT0gMCApIHsKCiAgICAJCQlzaWdtYSA9IDA7CgogICAgCQl9CgogICAgCQlzaWdtYXMucHVzaCggc2lnbWEgKTsKCiAgICAJCWNvbnN0IHRleGVsU2l6ZSA9IDEuMCAvICggc2l6ZUxvZCAtIDIgKTsKICAgIAkJY29uc3QgbWluID0gLSB0ZXhlbFNpemU7CiAgICAJCWNvbnN0IG1heCA9IDEgKyB0ZXhlbFNpemU7CiAgICAJCWNvbnN0IHV2MSA9IFsgbWluLCBtaW4sIG1heCwgbWluLCBtYXgsIG1heCwgbWluLCBtaW4sIG1heCwgbWF4LCBtaW4sIG1heCBdOwoKICAgIAkJY29uc3QgY3ViZUZhY2VzID0gNjsKICAgIAkJY29uc3QgdmVydGljZXMgPSA2OwogICAgCQljb25zdCBwb3NpdGlvblNpemUgPSAzOwogICAgCQljb25zdCB1dlNpemUgPSAyOwogICAgCQljb25zdCBmYWNlSW5kZXhTaXplID0gMTsKCiAgICAJCWNvbnN0IHBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25TaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKICAgIAkJY29uc3QgdXYgPSBuZXcgRmxvYXQzMkFycmF5KCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGN1YmVGYWNlcyApOwogICAgCQljb25zdCBmYWNlSW5kZXggPSBuZXcgRmxvYXQzMkFycmF5KCBmYWNlSW5kZXhTaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCiAgICAJCWZvciAoIGxldCBmYWNlID0gMDsgZmFjZSA8IGN1YmVGYWNlczsgZmFjZSArKyApIHsKCiAgICAJCQljb25zdCB4ID0gKCBmYWNlICUgMyApICogMiAvIDMgLSAxOwogICAgCQkJY29uc3QgeSA9IGZhY2UgPiAyID8gMCA6IC0xOwogICAgCQkJY29uc3QgY29vcmRpbmF0ZXMgPSBbCiAgICAJCQkJeCwgeSwgMCwKICAgIAkJCQl4ICsgMiAvIDMsIHksIDAsCiAgICAJCQkJeCArIDIgLyAzLCB5ICsgMSwgMCwKICAgIAkJCQl4LCB5LCAwLAogICAgCQkJCXggKyAyIC8gMywgeSArIDEsIDAsCiAgICAJCQkJeCwgeSArIDEsIDAKICAgIAkJCV07CiAgICAJCQlwb3NpdGlvbi5zZXQoIGNvb3JkaW5hdGVzLCBwb3NpdGlvblNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKICAgIAkJCXV2LnNldCggdXYxLCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKICAgIAkJCWNvbnN0IGZpbGwgPSBbIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UgXTsKICAgIAkJCWZhY2VJbmRleC5zZXQoIGZpbGwsIGZhY2VJbmRleFNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHBsYW5lcyA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwogICAgCQlwbGFuZXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgcG9zaXRpb25TaXplICkgKTsKICAgIAkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdXYsIHV2U2l6ZSApICk7CiAgICAJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICdmYWNlSW5kZXgnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBmYWNlSW5kZXgsIGZhY2VJbmRleFNpemUgKSApOwogICAgCQlsb2RQbGFuZXMucHVzaCggcGxhbmVzICk7CgogICAgCQlpZiAoIGxvZCA+IExPRF9NSU4gKSB7CgogICAgCQkJbG9kIC0tOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiB7IGxvZFBsYW5lcywgc2l6ZUxvZHMsIHNpZ21hcyB9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKSB7CgogICAgCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CiAgICAJY3ViZVVWUmVuZGVyVGFyZ2V0LnRleHR1cmUubWFwcGluZyA9IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOwogICAgCWN1YmVVVlJlbmRlclRhcmdldC50ZXh0dXJlLm5hbWUgPSAnUE1SRU0uY3ViZVV2JzsKICAgIAljdWJlVVZSZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSB0cnVlOwogICAgCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXRWaWV3cG9ydCggdGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKICAgIAl0YXJnZXQudmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CiAgICAJdGFyZ2V0LnNjaXNzb3Iuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRCbHVyU2hhZGVyKCBsb2RNYXgsIHdpZHRoLCBoZWlnaHQgKSB7CgogICAgCWNvbnN0IHdlaWdodHMgPSBuZXcgRmxvYXQzMkFycmF5KCBNQVhfU0FNUExFUyApOwogICAgCWNvbnN0IHBvbGVBeGlzID0gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKICAgIAljb25zdCBzaGFkZXJNYXRlcmlhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoKICAgIAkJbmFtZTogJ1NwaGVyaWNhbEdhdXNzaWFuQmx1cicsCgogICAgCQlkZWZpbmVzOiB7CiAgICAJCQknbic6IE1BWF9TQU1QTEVTLAogICAgCQkJJ0NVQkVVVl9URVhFTF9XSURUSCc6IDEuMCAvIHdpZHRoLAogICAgCQkJJ0NVQkVVVl9URVhFTF9IRUlHSFQnOiAxLjAgLyBoZWlnaHQsCiAgICAJCQknQ1VCRVVWX01BWF9NSVAnOiBgJHtsb2RNYXh9LjBgLAogICAgCQl9LAoKICAgIAkJdW5pZm9ybXM6IHsKICAgIAkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQknc2FtcGxlcyc6IHsgdmFsdWU6IDEgfSwKICAgIAkJCSd3ZWlnaHRzJzogeyB2YWx1ZTogd2VpZ2h0cyB9LAogICAgCQkJJ2xhdGl0dWRpbmFsJzogeyB2YWx1ZTogZmFsc2UgfSwKICAgIAkJCSdkVGhldGEnOiB7IHZhbHVlOiAwIH0sCiAgICAJCQknbWlwSW50JzogeyB2YWx1ZTogMCB9LAogICAgCQkJJ3BvbGVBeGlzJzogeyB2YWx1ZTogcG9sZUF4aXMgfQogICAgCQl9LAoKICAgIAkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgogICAgCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDsKCQkJdW5pZm9ybSBpbnQgc2FtcGxlczsKCQkJdW5pZm9ybSBmbG9hdCB3ZWlnaHRzWyBuIF07CgkJCXVuaWZvcm0gYm9vbCBsYXRpdHVkaW5hbDsKCQkJdW5pZm9ybSBmbG9hdCBkVGhldGE7CgkJCXVuaWZvcm0gZmxvYXQgbWlwSW50OwoJCQl1bmlmb3JtIHZlYzMgcG9sZUF4aXM7CgoJCQkjZGVmaW5lIEVOVk1BUF9UWVBFX0NVQkVfVVYKCQkJI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD4KCgkJCXZlYzMgZ2V0U2FtcGxlKCBmbG9hdCB0aGV0YSwgdmVjMyBheGlzICkgewoKCQkJCWZsb2F0IGNvc1RoZXRhID0gY29zKCB0aGV0YSApOwoJCQkJLy8gUm9kcmlndWVzJyBheGlzLWFuZ2xlIHJvdGF0aW9uCgkJCQl2ZWMzIHNhbXBsZURpcmVjdGlvbiA9IHZPdXRwdXREaXJlY3Rpb24gKiBjb3NUaGV0YQoJCQkJCSsgY3Jvc3MoIGF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKSAqIHNpbiggdGhldGEgKQoJCQkJCSsgYXhpcyAqIGRvdCggYXhpcywgdk91dHB1dERpcmVjdGlvbiApICogKCAxLjAgLSBjb3NUaGV0YSApOwoKCQkJCXJldHVybiBiaWxpbmVhckN1YmVVViggZW52TWFwLCBzYW1wbGVEaXJlY3Rpb24sIG1pcEludCApOwoKCQkJfQoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgYXhpcyA9IGxhdGl0dWRpbmFsID8gcG9sZUF4aXMgOiBjcm9zcyggcG9sZUF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKTsKCgkJCQlpZiAoIGFsbCggZXF1YWwoIGF4aXMsIHZlYzMoIDAuMCApICkgKSApIHsKCgkJCQkJYXhpcyA9IHZlYzMoIHZPdXRwdXREaXJlY3Rpb24ueiwgMC4wLCAtIHZPdXRwdXREaXJlY3Rpb24ueCApOwoKCQkJCX0KCgkJCQlheGlzID0gbm9ybWFsaXplKCBheGlzICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggMC4wLCAwLjAsIDAuMCwgMS4wICk7CgkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIDAgXSAqIGdldFNhbXBsZSggMC4wLCBheGlzICk7CgoJCQkJZm9yICggaW50IGkgPSAxOyBpIDwgbjsgaSsrICkgewoKCQkJCQlpZiAoIGkgPj0gc2FtcGxlcyApIHsKCgkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJCWZsb2F0IHRoZXRhID0gZFRoZXRhICogZmxvYXQoIGkgKTsKCQkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIGkgXSAqIGdldFNhbXBsZSggLTEuMCAqIHRoZXRhLCBheGlzICk7CgkJCQkJZ2xfRnJhZ0NvbG9yLnJnYiArPSB3ZWlnaHRzWyBpIF0gKiBnZXRTYW1wbGUoIHRoZXRhLCBheGlzICk7CgoJCQkJfQoKCQkJfQoJCWAsCgogICAgCQlibGVuZGluZzogTm9CbGVuZGluZywKICAgIAkJZGVwdGhUZXN0OiBmYWxzZSwKICAgIAkJZGVwdGhXcml0ZTogZmFsc2UKCiAgICAJfSApOwoKICAgIAlyZXR1cm4gc2hhZGVyTWF0ZXJpYWw7CgogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRFcXVpcmVjdE1hdGVyaWFsKCkgewoKICAgIAlyZXR1cm4gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgogICAgCQluYW1lOiAnRXF1aXJlY3Rhbmd1bGFyVG9DdWJlVVYnLAoKICAgIAkJdW5pZm9ybXM6IHsKICAgIAkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0KICAgIAkJfSwKCiAgICAJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKICAgIAkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7CgoJCQkjaW5jbHVkZSA8Y29tbW9uPgoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgb3V0cHV0RGlyZWN0aW9uID0gbm9ybWFsaXplKCB2T3V0cHV0RGlyZWN0aW9uICk7CgkJCQl2ZWMyIHV2ID0gZXF1aXJlY3RVdiggb3V0cHV0RGlyZWN0aW9uICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggdGV4dHVyZTJEICggZW52TWFwLCB1diApLnJnYiwgMS4wICk7CgoJCQl9CgkJYCwKCiAgICAJCWJsZW5kaW5nOiBOb0JsZW5kaW5nLAogICAgCQlkZXB0aFRlc3Q6IGZhbHNlLAogICAgCQlkZXB0aFdyaXRlOiBmYWxzZQoKICAgIAl9ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIF9nZXRDdWJlbWFwTWF0ZXJpYWwoKSB7CgogICAgCXJldHVybiBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCiAgICAJCW5hbWU6ICdDdWJlbWFwVG9DdWJlVVYnLAoKICAgIAkJdW5pZm9ybXM6IHsKICAgIAkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQknZmxpcEVudk1hcCc6IHsgdmFsdWU6IC0xIH0KICAgIAkJfSwKCiAgICAJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKICAgIAkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwOwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDsKCgkJCXZvaWQgbWFpbigpIHsKCgkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlQ3ViZSggZW52TWFwLCB2ZWMzKCBmbGlwRW52TWFwICogdk91dHB1dERpcmVjdGlvbi54LCB2T3V0cHV0RGlyZWN0aW9uLnl6ICkgKTsKCgkJCX0KCQlgLAoKICAgIAkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCiAgICAJCWRlcHRoVGVzdDogZmFsc2UsCiAgICAJCWRlcHRoV3JpdGU6IGZhbHNlCgogICAgCX0gKTsKCiAgICB9CgogICAgZnVuY3Rpb24gX2dldENvbW1vblZlcnRleFNoYWRlcigpIHsKCiAgICAJcmV0dXJuIC8qIGdsc2wgKi9gCgoJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJYXR0cmlidXRlIGZsb2F0IGZhY2VJbmRleDsKCgkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCS8vIFJIIGNvb3JkaW5hdGUgc3lzdGVtOyBQTVJFTSBmYWNlLWluZGV4aW5nIGNvbnZlbnRpb24KCQl2ZWMzIGdldERpcmVjdGlvbiggdmVjMiB1diwgZmxvYXQgZmFjZSApIHsKCgkJCXV2ID0gMi4wICogdXYgLSAxLjA7CgoJCQl2ZWMzIGRpcmVjdGlvbiA9IHZlYzMoIHV2LCAxLjAgKTsKCgkJCWlmICggZmFjZSA9PSAwLjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnp5eDsgLy8gKCAxLCB2LCB1ICkgcG9zIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gMS4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHogKj0gLTEuMDsgLy8gKCAtdSwgMSwgLXYgKSBwb3MgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSAyLjAgKSB7CgoJCQkJZGlyZWN0aW9uLnggKj0gLTEuMDsgLy8gKCAtdSwgdiwgMSApIHBvcyB6CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24uenl4OwoJCQkJZGlyZWN0aW9uLnh6ICo9IC0xLjA7IC8vICggLTEsIHYsIC11ICkgbmVnIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHkgKj0gLTEuMDsgLy8gKCAtdSwgLTEsIHYgKSBuZWcgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSA1LjAgKSB7CgoJCQkJZGlyZWN0aW9uLnogKj0gLTEuMDsgLy8gKCB1LCB2LCAtMSApIG5lZyB6CgoJCQl9CgoJCQlyZXR1cm4gZGlyZWN0aW9uOwoKCQl9CgoJCXZvaWQgbWFpbigpIHsKCgkJCXZPdXRwdXREaXJlY3Rpb24gPSBnZXREaXJlY3Rpb24oIHV2LCBmYWNlSW5kZXggKTsKCQkJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7CgoJCX0KCWA7CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMQ3ViZVVWTWFwcyggcmVuZGVyZXIgKSB7CgogICAgCWxldCBjdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJbGV0IHBtcmVtR2VuZXJhdG9yID0gbnVsbDsKCiAgICAJZnVuY3Rpb24gZ2V0KCB0ZXh0dXJlICkgewoKICAgIAkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKICAgIAkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgogICAgCQkJY29uc3QgaXNFcXVpcmVjdE1hcCA9ICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgfHwgbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKTsKICAgIAkJCWNvbnN0IGlzQ3ViZU1hcCA9ICggbWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApOwoKICAgIAkJCS8vIGVxdWlyZWN0L2N1YmUgbWFwIHRvIGN1YmVVViBjb252ZXJzaW9uCgogICAgCQkJaWYgKCBpc0VxdWlyZWN0TWFwIHx8IGlzQ3ViZU1hcCApIHsKCiAgICAJCQkJbGV0IHJlbmRlclRhcmdldCA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgogICAgCQkJCWNvbnN0IGN1cnJlbnRQTVJFTVZlcnNpb24gPSByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCA/IHJlbmRlclRhcmdldC50ZXh0dXJlLnBtcmVtVmVyc2lvbiA6IDA7CgogICAgCQkJCWlmICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgJiYgdGV4dHVyZS5wbXJlbVZlcnNpb24gIT09IGN1cnJlbnRQTVJFTVZlcnNpb24gKSB7CgogICAgCQkJCQlpZiAoIHBtcmVtR2VuZXJhdG9yID09PSBudWxsICkgcG1yZW1HZW5lcmF0b3IgPSBuZXcgUE1SRU1HZW5lcmF0b3IoIHJlbmRlcmVyICk7CgogICAgCQkJCQlyZW5kZXJUYXJnZXQgPSBpc0VxdWlyZWN0TWFwID8gcG1yZW1HZW5lcmF0b3IuZnJvbUVxdWlyZWN0YW5ndWxhciggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgOiBwbXJlbUdlbmVyYXRvci5mcm9tQ3ViZW1hcCggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQkJCXJlbmRlclRhcmdldC50ZXh0dXJlLnBtcmVtVmVyc2lvbiA9IHRleHR1cmUucG1yZW1WZXJzaW9uOwoKICAgIAkJCQkJY3ViZVVWbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKICAgIAkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJaWYgKCByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKCiAgICAJCQkJCQlpZiAoICggaXNFcXVpcmVjdE1hcCAmJiBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgfHwgKCBpc0N1YmVNYXAgJiYgaW1hZ2UgJiYgaXNDdWJlVGV4dHVyZUNvbXBsZXRlKCBpbWFnZSApICkgKSB7CgogICAgCQkJCQkJCWlmICggcG1yZW1HZW5lcmF0b3IgPT09IG51bGwgKSBwbXJlbUdlbmVyYXRvciA9IG5ldyBQTVJFTUdlbmVyYXRvciggcmVuZGVyZXIgKTsKCiAgICAJCQkJCQkJcmVuZGVyVGFyZ2V0ID0gaXNFcXVpcmVjdE1hcCA/IHBtcmVtR2VuZXJhdG9yLmZyb21FcXVpcmVjdGFuZ3VsYXIoIHRleHR1cmUgKSA6IHBtcmVtR2VuZXJhdG9yLmZyb21DdWJlbWFwKCB0ZXh0dXJlICk7CiAgICAJCQkJCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUucG1yZW1WZXJzaW9uID0gdGV4dHVyZS5wbXJlbVZlcnNpb247CgogICAgCQkJCQkJCWN1YmVVVm1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJCQkJdGV4dHVyZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCiAgICAJCQkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCS8vIGltYWdlIG5vdCB5ZXQgcmVhZHkuIHRyeSB0aGUgY29udmVyc2lvbiBuZXh0IGZyYW1lCgogICAgCQkJCQkJCXJldHVybiBudWxsOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB0ZXh0dXJlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGlzQ3ViZVRleHR1cmVDb21wbGV0ZSggaW1hZ2UgKSB7CgogICAgCQlsZXQgY291bnQgPSAwOwogICAgCQljb25zdCBsZW5ndGggPSA2OwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKICAgIAkJCWlmICggaW1hZ2VbIGkgXSAhPT0gdW5kZWZpbmVkICkgY291bnQgKys7CgogICAgCQl9CgogICAgCQlyZXR1cm4gY291bnQgPT09IGxlbmd0aDsKCgogICAgCX0KCiAgICAJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCiAgICAJCWNvbnN0IGN1YmVtYXBVViA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgogICAgCQlpZiAoIGN1YmVtYXBVViAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWN1YmVVVm1hcHMuZGVsZXRlKCB0ZXh0dXJlICk7CiAgICAJCQljdWJlbWFwVVYuZGlzcG9zZSgpOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgogICAgCQljdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJCWlmICggcG1yZW1HZW5lcmF0b3IgIT09IG51bGwgKSB7CgogICAgCQkJcG1yZW1HZW5lcmF0b3IuZGlzcG9zZSgpOwogICAgCQkJcG1yZW1HZW5lcmF0b3IgPSBudWxsOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiB7CiAgICAJCWdldDogZ2V0LAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xFeHRlbnNpb25zKCBnbCApIHsKCiAgICAJY29uc3QgZXh0ZW5zaW9ucyA9IHt9OwoKICAgIAlmdW5jdGlvbiBnZXRFeHRlbnNpb24oIG5hbWUgKSB7CgogICAgCQlpZiAoIGV4dGVuc2lvbnNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXJldHVybiBleHRlbnNpb25zWyBuYW1lIF07CgogICAgCQl9CgogICAgCQlsZXQgZXh0ZW5zaW9uOwoKICAgIAkJc3dpdGNoICggbmFtZSApIHsKCiAgICAJCQljYXNlICdXRUJHTF9kZXB0aF90ZXh0dXJlJzoKICAgIAkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9kZXB0aF90ZXh0dXJlJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9XRUJHTF9kZXB0aF90ZXh0dXJlJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9kZXB0aF90ZXh0dXJlJyApOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyc6CiAgICAJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKTsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Yyc6CiAgICAJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnOgogICAgCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWRlZmF1bHQ6CiAgICAJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCBuYW1lICk7CgogICAgCQl9CgogICAgCQlleHRlbnNpb25zWyBuYW1lIF0gPSBleHRlbnNpb247CgogICAgCQlyZXR1cm4gZXh0ZW5zaW9uOwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQloYXM6IGZ1bmN0aW9uICggbmFtZSApIHsKCiAgICAJCQlyZXR1cm4gZ2V0RXh0ZW5zaW9uKCBuYW1lICkgIT09IG51bGw7CgogICAgCQl9LAoKICAgIAkJaW5pdDogZnVuY3Rpb24gKCkgewoKICAgIAkJCWdldEV4dGVuc2lvbiggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CiAgICAJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9jbGlwX2N1bGxfZGlzdGFuY2UnICk7CiAgICAJCQlnZXRFeHRlbnNpb24oICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICk7CiAgICAJCQlnZXRFeHRlbnNpb24oICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICk7CiAgICAJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICk7CiAgICAJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9yZW5kZXJfc2hhcmVkX2V4cG9uZW50JyApOwoKICAgIAkJfSwKCiAgICAJCWdldDogZnVuY3Rpb24gKCBuYW1lICkgewoKICAgIAkJCWNvbnN0IGV4dGVuc2lvbiA9IGdldEV4dGVuc2lvbiggbmFtZSApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKICAgIAkJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMUmVuZGVyZXI6ICcgKyBuYW1lICsgJyBleHRlbnNpb24gbm90IHN1cHBvcnRlZC4nICk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBleHRlbnNpb247CgogICAgCQl9CgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMR2VvbWV0cmllcyggZ2wsIGF0dHJpYnV0ZXMsIGluZm8sIGJpbmRpbmdTdGF0ZXMgKSB7CgogICAgCWNvbnN0IGdlb21ldHJpZXMgPSB7fTsKICAgIAljb25zdCB3aXJlZnJhbWVBdHRyaWJ1dGVzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJZnVuY3Rpb24gb25HZW9tZXRyeURpc3Bvc2UoIGV2ZW50ICkgewoKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSBldmVudC50YXJnZXQ7CgogICAgCQlpZiAoIGdlb21ldHJ5LmluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBnZW9tZXRyeS5pbmRleCApOwoKICAgIAkJfQoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBnZW9tZXRyeS5hdHRyaWJ1dGVzICkgewoKICAgIAkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBnZW9tZXRyeS5hdHRyaWJ1dGVzWyBuYW1lIF0gKTsKCiAgICAJCX0KCiAgICAJCWdlb21ldHJ5LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25HZW9tZXRyeURpc3Bvc2UgKTsKCiAgICAJCWRlbGV0ZSBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdOwoKICAgIAkJY29uc3QgYXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgogICAgCQlpZiAoIGF0dHJpYnV0ZSApIHsKCiAgICAJCQlhdHRyaWJ1dGVzLnJlbW92ZSggYXR0cmlidXRlICk7CiAgICAJCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCiAgICAJCX0KCiAgICAJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgogICAgCQlpZiAoIGdlb21ldHJ5LmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgPT09IHRydWUgKSB7CgogICAgCQkJZGVsZXRlIGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50OwoKICAgIAkJfQoKICAgIAkJLy8KCiAgICAJCWluZm8ubWVtb3J5Lmdlb21ldHJpZXMgLS07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICkgewoKICAgIAkJaWYgKCBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdID09PSB0cnVlICkgcmV0dXJuIGdlb21ldHJ5OwoKICAgIAkJZ2VvbWV0cnkuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkdlb21ldHJ5RGlzcG9zZSApOwoKICAgIAkJZ2VvbWV0cmllc1sgZ2VvbWV0cnkuaWQgXSA9IHRydWU7CgogICAgCQlpbmZvLm1lbW9yeS5nZW9tZXRyaWVzICsrOwoKICAgIAkJcmV0dXJuIGdlb21ldHJ5OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZSggZ2VvbWV0cnkgKSB7CgogICAgCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKICAgIAkJLy8gVXBkYXRpbmcgaW5kZXggYnVmZmVyIGluIFZBTyBub3cuIFNlZSBXZWJHTEJpbmRpbmdTdGF0ZXMuCgogICAgCQlmb3IgKCBjb25zdCBuYW1lIGluIGdlb21ldHJ5QXR0cmlidXRlcyApIHsKCiAgICAJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF0sIGdsLkFSUkFZX0JVRkZFUiApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgogICAgCQljb25zdCBpbmRpY2VzID0gW107CgogICAgCQljb25zdCBnZW9tZXRyeUluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CiAgICAJCWNvbnN0IGdlb21ldHJ5UG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgCQlsZXQgdmVyc2lvbiA9IDA7CgogICAgCQlpZiAoIGdlb21ldHJ5SW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeUluZGV4LmFycmF5OwogICAgCQkJdmVyc2lvbiA9IGdlb21ldHJ5SW5kZXgudmVyc2lvbjsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpICs9IDMgKSB7CgogICAgCQkJCWNvbnN0IGEgPSBhcnJheVsgaSArIDAgXTsKICAgIAkJCQljb25zdCBiID0gYXJyYXlbIGkgKyAxIF07CiAgICAJCQkJY29uc3QgYyA9IGFycmF5WyBpICsgMiBdOwoKICAgIAkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCBnZW9tZXRyeVBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeVBvc2l0aW9uLmFycmF5OwogICAgCQkJdmVyc2lvbiA9IGdlb21ldHJ5UG9zaXRpb24udmVyc2lvbjsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSAoIGFycmF5Lmxlbmd0aCAvIDMgKSAtIDE7IGkgPCBsOyBpICs9IDMgKSB7CgogICAgCQkJCWNvbnN0IGEgPSBpICsgMDsKICAgIAkJCQljb25zdCBiID0gaSArIDE7CiAgICAJCQkJY29uc3QgYyA9IGkgKyAyOwoKICAgIAkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGF0dHJpYnV0ZSA9IG5ldyAoIGFycmF5TmVlZHNVaW50MzIoIGluZGljZXMgKSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSApKCBpbmRpY2VzLCAxICk7CiAgICAJCWF0dHJpYnV0ZS52ZXJzaW9uID0gdmVyc2lvbjsKCiAgICAJCS8vIFVwZGF0aW5nIGluZGV4IGJ1ZmZlciBpbiBWQU8gbm93LiBTZWUgV2ViR0xCaW5kaW5nU3RhdGVzCgogICAgCQkvLwoKICAgIAkJY29uc3QgcHJldmlvdXNBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCiAgICAJCWlmICggcHJldmlvdXNBdHRyaWJ1dGUgKSBhdHRyaWJ1dGVzLnJlbW92ZSggcHJldmlvdXNBdHRyaWJ1dGUgKTsKCiAgICAJCS8vCgogICAgCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLnNldCggZ2VvbWV0cnksIGF0dHJpYnV0ZSApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgogICAgCQljb25zdCBjdXJyZW50QXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgogICAgCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUgKSB7CgogICAgCQkJY29uc3QgZ2VvbWV0cnlJbmRleCA9IGdlb21ldHJ5LmluZGV4OwoKICAgIAkJCWlmICggZ2VvbWV0cnlJbmRleCAhPT0gbnVsbCApIHsKCiAgICAJCQkJLy8gaWYgdGhlIGF0dHJpYnV0ZSBpcyBvYnNvbGV0ZSwgY3JlYXRlIGEgbmV3IG9uZQoKICAgIAkJCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUudmVyc2lvbiA8IGdlb21ldHJ5SW5kZXgudmVyc2lvbiApIHsKCiAgICAJCQkJCXVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdXBkYXRlV2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQlnZXQ6IGdldCwKICAgIAkJdXBkYXRlOiB1cGRhdGUsCgogICAgCQlnZXRXaXJlZnJhbWVBdHRyaWJ1dGU6IGdldFdpcmVmcmFtZUF0dHJpYnV0ZQoKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTEluZGV4ZWRCdWZmZXJSZW5kZXJlciggZ2wsIGV4dGVuc2lvbnMsIGluZm8gKSB7CgogICAgCWxldCBtb2RlOwoKICAgIAlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCiAgICAJCW1vZGUgPSB2YWx1ZTsKCiAgICAJfQoKICAgIAlsZXQgdHlwZSwgYnl0ZXNQZXJFbGVtZW50OwoKICAgIAlmdW5jdGlvbiBzZXRJbmRleCggdmFsdWUgKSB7CgogICAgCQl0eXBlID0gdmFsdWUudHlwZTsKICAgIAkJYnl0ZXNQZXJFbGVtZW50ID0gdmFsdWUuYnl0ZXNQZXJFbGVtZW50OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKICAgIAkJZ2wuZHJhd0VsZW1lbnRzKCBtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQgKTsKCiAgICAJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgMSApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyggc3RhcnQsIGNvdW50LCBwcmltY291bnQgKSB7CgogICAgCQlpZiAoIHByaW1jb3VudCA9PT0gMCApIHJldHVybjsKCiAgICAJCWdsLmRyYXdFbGVtZW50c0luc3RhbmNlZCggbW9kZSwgY291bnQsIHR5cGUsIHN0YXJ0ICogYnl0ZXNQZXJFbGVtZW50LCBwcmltY291bnQgKTsKCiAgICAJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3KCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50ICkgewoKICAgIAkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgogICAgCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CiAgICAJCWV4dGVuc2lvbi5tdWx0aURyYXdFbGVtZW50c1dFQkdMKCBtb2RlLCBjb3VudHMsIDAsIHR5cGUsIHN0YXJ0cywgMCwgZHJhd0NvdW50ICk7CgogICAgCQlsZXQgZWxlbWVudENvdW50ID0gMDsKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKICAgIAkJCWVsZW1lbnRDb3VudCArPSBjb3VudHNbIGkgXTsKCiAgICAJCX0KCiAgICAJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzKCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50LCBwcmltY291bnQgKSB7CgogICAgCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCiAgICAJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCiAgICAJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IHN0YXJ0cy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCXJlbmRlckluc3RhbmNlcyggc3RhcnRzWyBpIF0gLyBieXRlc1BlckVsZW1lbnQsIGNvdW50c1sgaSBdLCBwcmltY291bnRbIGkgXSApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0VsZW1lbnRzSW5zdGFuY2VkV0VCR0woIG1vZGUsIGNvdW50cywgMCwgdHlwZSwgc3RhcnRzLCAwLCBwcmltY291bnQsIDAsIGRyYXdDb3VudCApOwoKICAgIAkJCWxldCBlbGVtZW50Q291bnQgPSAwOwogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKICAgIAkJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF0gKiBwcmltY291bnRbIGkgXTsKCiAgICAJCQl9CgogICAgCQkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vCgogICAgCXRoaXMuc2V0TW9kZSA9IHNldE1vZGU7CiAgICAJdGhpcy5zZXRJbmRleCA9IHNldEluZGV4OwogICAgCXRoaXMucmVuZGVyID0gcmVuZGVyOwogICAgCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwogICAgCXRoaXMucmVuZGVyTXVsdGlEcmF3ID0gcmVuZGVyTXVsdGlEcmF3OwogICAgCXRoaXMucmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzID0gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzOwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTEluZm8oIGdsICkgewoKICAgIAljb25zdCBtZW1vcnkgPSB7CiAgICAJCWdlb21ldHJpZXM6IDAsCiAgICAJCXRleHR1cmVzOiAwCiAgICAJfTsKCiAgICAJY29uc3QgcmVuZGVyID0gewogICAgCQlmcmFtZTogMCwKICAgIAkJY2FsbHM6IDAsCiAgICAJCXRyaWFuZ2xlczogMCwKICAgIAkJcG9pbnRzOiAwLAogICAgCQlsaW5lczogMAogICAgCX07CgogICAgCWZ1bmN0aW9uIHVwZGF0ZSggY291bnQsIG1vZGUsIGluc3RhbmNlQ291bnQgKSB7CgogICAgCQlyZW5kZXIuY2FsbHMgKys7CgogICAgCQlzd2l0Y2ggKCBtb2RlICkgewoKICAgIAkJCWNhc2UgZ2wuVFJJQU5HTEVTOgogICAgCQkJCXJlbmRlci50cmlhbmdsZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLyAzICk7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSBnbC5MSU5FUzoKICAgIAkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLyAyICk7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSBnbC5MSU5FX1NUUklQOgogICAgCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAtIDEgKTsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlIGdsLkxJTkVfTE9PUDoKICAgIAkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgZ2wuUE9JTlRTOgogICAgCQkJCXJlbmRlci5wb2ludHMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWRlZmF1bHQ6CiAgICAJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMSW5mbzogVW5rbm93biBkcmF3IG1vZGU6JywgbW9kZSApOwogICAgCQkJCWJyZWFrOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlc2V0KCkgewoKICAgIAkJcmVuZGVyLmNhbGxzID0gMDsKICAgIAkJcmVuZGVyLnRyaWFuZ2xlcyA9IDA7CiAgICAJCXJlbmRlci5wb2ludHMgPSAwOwogICAgCQlyZW5kZXIubGluZXMgPSAwOwoKICAgIAl9CgogICAgCXJldHVybiB7CiAgICAJCW1lbW9yeTogbWVtb3J5LAogICAgCQlyZW5kZXI6IHJlbmRlciwKICAgIAkJcHJvZ3JhbXM6IG51bGwsCiAgICAJCWF1dG9SZXNldDogdHJ1ZSwKICAgIAkJcmVzZXQ6IHJlc2V0LAogICAgCQl1cGRhdGU6IHVwZGF0ZQogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMTW9ycGh0YXJnZXRzKCBnbCwgY2FwYWJpbGl0aWVzLCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgbW9ycGhUZXh0dXJlcyA9IG5ldyBXZWFrTWFwKCk7CiAgICAJY29uc3QgbW9ycGggPSBuZXcgVmVjdG9yNCgpOwoKICAgIAlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKSB7CgogICAgCQljb25zdCBvYmplY3RJbmZsdWVuY2VzID0gb2JqZWN0Lm1vcnBoVGFyZ2V0SW5mbHVlbmNlczsKCiAgICAJCS8vIHRoZSBmb2xsb3dpbmcgZW5jb2RlcyBtb3JwaCB0YXJnZXRzIGludG8gYW4gYXJyYXkgb2YgZGF0YSB0ZXh0dXJlcy4gRWFjaCBsYXllciByZXByZXNlbnRzIGEgc2luZ2xlIG1vcnBoIHRhcmdldC4KCiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwogICAgCQljb25zdCBtb3JwaFRhcmdldHNDb3VudCA9ICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApID8gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoIDogMDsKCiAgICAJCWxldCBlbnRyeSA9IG1vcnBoVGV4dHVyZXMuZ2V0KCBnZW9tZXRyeSApOwoKICAgIAkJaWYgKCBlbnRyeSA9PT0gdW5kZWZpbmVkIHx8IGVudHJ5LmNvdW50ICE9PSBtb3JwaFRhcmdldHNDb3VudCApIHsKCiAgICAJCQlpZiAoIGVudHJ5ICE9PSB1bmRlZmluZWQgKSBlbnRyeS50ZXh0dXJlLmRpc3Bvc2UoKTsKCiAgICAJCQljb25zdCBoYXNNb3JwaFBvc2l0aW9uID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQ7CiAgICAJCQljb25zdCBoYXNNb3JwaE5vcm1hbHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQ7CiAgICAJCQljb25zdCBoYXNNb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkOwoKICAgIAkJCWNvbnN0IG1vcnBoVGFyZ2V0cyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBbXTsKICAgIAkJCWNvbnN0IG1vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgW107CiAgICAJCQljb25zdCBtb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciB8fCBbXTsKCiAgICAJCQlsZXQgdmVydGV4RGF0YUNvdW50ID0gMDsKCiAgICAJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAxOwogICAgCQkJaWYgKCBoYXNNb3JwaE5vcm1hbHMgPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAyOwogICAgCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHZlcnRleERhdGFDb3VudCA9IDM7CgogICAgCQkJbGV0IHdpZHRoID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCAqIHZlcnRleERhdGFDb3VudDsKICAgIAkJCWxldCBoZWlnaHQgPSAxOwoKICAgIAkJCWlmICggd2lkdGggPiBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKSB7CgogICAgCQkJCWhlaWdodCA9IE1hdGguY2VpbCggd2lkdGggLyBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKICAgIAkJCQl3aWR0aCA9IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgYnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSggd2lkdGggKiBoZWlnaHQgKiA0ICogbW9ycGhUYXJnZXRzQ291bnQgKTsKCiAgICAJCQljb25zdCB0ZXh0dXJlID0gbmV3IERhdGFBcnJheVRleHR1cmUoIGJ1ZmZlciwgd2lkdGgsIGhlaWdodCwgbW9ycGhUYXJnZXRzQ291bnQgKTsKICAgIAkJCXRleHR1cmUudHlwZSA9IEZsb2F0VHlwZTsKICAgIAkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCS8vIGZpbGwgYnVmZmVyCgogICAgCQkJY29uc3QgdmVydGV4RGF0YVN0cmlkZSA9IHZlcnRleERhdGFDb3VudCAqIDQ7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbW9ycGhUYXJnZXRzQ291bnQ7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IG1vcnBoVGFyZ2V0ID0gbW9ycGhUYXJnZXRzWyBpIF07CiAgICAJCQkJY29uc3QgbW9ycGhOb3JtYWwgPSBtb3JwaE5vcm1hbHNbIGkgXTsKICAgIAkJCQljb25zdCBtb3JwaENvbG9yID0gbW9ycGhDb2xvcnNbIGkgXTsKCiAgICAJCQkJY29uc3Qgb2Zmc2V0ID0gd2lkdGggKiBoZWlnaHQgKiA0ICogaTsKCiAgICAJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbW9ycGhUYXJnZXQuY291bnQ7IGogKysgKSB7CgogICAgCQkJCQljb25zdCBzdHJpZGUgPSBqICogdmVydGV4RGF0YVN0cmlkZTsKCiAgICAJCQkJCWlmICggaGFzTW9ycGhQb3NpdGlvbiA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaFRhcmdldCwgaiApOwoKICAgIAkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMCBdID0gbW9ycGgueDsKICAgIAkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMSBdID0gbW9ycGgueTsKICAgIAkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMiBdID0gbW9ycGguejsKICAgIAkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMyBdID0gMDsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWlmICggaGFzTW9ycGhOb3JtYWxzID09PSB0cnVlICkgewoKICAgIAkJCQkJCW1vcnBoLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoTm9ybWFsLCBqICk7CgogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA0IF0gPSBtb3JwaC54OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA1IF0gPSBtb3JwaC55OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA2IF0gPSBtb3JwaC56OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA3IF0gPSAwOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaENvbG9yLCBqICk7CgogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA4IF0gPSBtb3JwaC54OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA5IF0gPSBtb3JwaC55OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAxMCBdID0gbW9ycGguejsKICAgIAkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMTEgXSA9ICggbW9ycGhDb2xvci5pdGVtU2l6ZSA9PT0gNCApID8gbW9ycGgudyA6IDE7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJZW50cnkgPSB7CiAgICAJCQkJY291bnQ6IG1vcnBoVGFyZ2V0c0NvdW50LAogICAgCQkJCXRleHR1cmU6IHRleHR1cmUsCiAgICAJCQkJc2l6ZTogbmV3IFZlY3RvcjIoIHdpZHRoLCBoZWlnaHQgKQogICAgCQkJfTsKCiAgICAJCQltb3JwaFRleHR1cmVzLnNldCggZ2VvbWV0cnksIGVudHJ5ICk7CgogICAgCQkJZnVuY3Rpb24gZGlzcG9zZVRleHR1cmUoKSB7CgogICAgCQkJCXRleHR1cmUuZGlzcG9zZSgpOwoKICAgIAkJCQltb3JwaFRleHR1cmVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCiAgICAJCQkJZ2VvbWV0cnkucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlVGV4dHVyZSApOwoKICAgIAkJCX0KCiAgICAJCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIGRpc3Bvc2VUZXh0dXJlICk7CgogICAgCQl9CgogICAgCQkvLwogICAgCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWUgJiYgb2JqZWN0Lm1vcnBoVGV4dHVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUZXh0dXJlJywgb2JqZWN0Lm1vcnBoVGV4dHVyZSwgdGV4dHVyZXMgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJbGV0IG1vcnBoSW5mbHVlbmNlc1N1bSA9IDA7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgb2JqZWN0SW5mbHVlbmNlcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCW1vcnBoSW5mbHVlbmNlc1N1bSArPSBvYmplY3RJbmZsdWVuY2VzWyBpIF07CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IG1vcnBoQmFzZUluZmx1ZW5jZSA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlID8gMSA6IDEgLSBtb3JwaEluZmx1ZW5jZXNTdW07CgoKICAgIAkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UnLCBtb3JwaEJhc2VJbmZsdWVuY2UgKTsKICAgIAkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnLCBvYmplY3RJbmZsdWVuY2VzICk7CgogICAgCQl9CgogICAgCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRzVGV4dHVyZScsIGVudHJ5LnRleHR1cmUsIHRleHR1cmVzICk7CiAgICAJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZScsIGVudHJ5LnNpemUgKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gewoKICAgIAkJdXBkYXRlOiB1cGRhdGUKCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xPYmplY3RzKCBnbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApIHsKCiAgICAJbGV0IHVwZGF0ZU1hcCA9IG5ldyBXZWFrTWFwKCk7CgogICAgCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0ICkgewoKICAgIAkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCiAgICAJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwogICAgCQljb25zdCBidWZmZXJnZW9tZXRyeSA9IGdlb21ldHJpZXMuZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICk7CgogICAgCQkvLyBVcGRhdGUgb25jZSBwZXIgZnJhbWUKCiAgICAJCWlmICggdXBkYXRlTWFwLmdldCggYnVmZmVyZ2VvbWV0cnkgKSAhPT0gZnJhbWUgKSB7CgogICAgCQkJZ2VvbWV0cmllcy51cGRhdGUoIGJ1ZmZlcmdlb21ldHJ5ICk7CgogICAgCQkJdXBkYXRlTWFwLnNldCggYnVmZmVyZ2VvbWV0cnksIGZyYW1lICk7CgogICAgCQl9CgogICAgCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggKSB7CgogICAgCQkJaWYgKCBvYmplY3QuaGFzRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICkgPT09IGZhbHNlICkgewoKICAgIAkJCQlvYmplY3QuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggdXBkYXRlTWFwLmdldCggb2JqZWN0ICkgIT09IGZyYW1lICkgewoKICAgIAkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggb2JqZWN0Lmluc3RhbmNlTWF0cml4LCBnbC5BUlJBWV9CVUZGRVIgKTsKCiAgICAJCQkJaWYgKCBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCApIHsKCiAgICAJCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBvYmplY3QuaW5zdGFuY2VDb2xvciwgZ2wuQVJSQVlfQlVGRkVSICk7CgogICAgCQkJCX0KCiAgICAJCQkJdXBkYXRlTWFwLnNldCggb2JqZWN0LCBmcmFtZSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgogICAgCQkJY29uc3Qgc2tlbGV0b24gPSBvYmplY3Quc2tlbGV0b247CgogICAgCQkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBza2VsZXRvbiApICE9PSBmcmFtZSApIHsKCiAgICAJCQkJc2tlbGV0b24udXBkYXRlKCk7CgogICAgCQkJCXVwZGF0ZU1hcC5zZXQoIHNrZWxldG9uLCBmcmFtZSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiBidWZmZXJnZW9tZXRyeTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJdXBkYXRlTWFwID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBvbkluc3RhbmNlZE1lc2hEaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IGluc3RhbmNlZE1lc2ggPSBldmVudC50YXJnZXQ7CgogICAgCQlpbnN0YW5jZWRNZXNoLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25JbnN0YW5jZWRNZXNoRGlzcG9zZSApOwoKICAgIAkJYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VNYXRyaXggKTsKCiAgICAJCWlmICggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VDb2xvciApOwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQl1cGRhdGU6IHVwZGF0ZSwKICAgIAkJZGlzcG9zZTogZGlzcG9zZQoKICAgIAl9OwoKICAgIH0KCiAgICAvKioKICAgICAqIFVuaWZvcm1zIG9mIGEgcHJvZ3JhbS4KICAgICAqIFRob3NlIGZvcm0gYSB0cmVlIHN0cnVjdHVyZSB3aXRoIGEgc3BlY2lhbCB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciB0aGUgcm9vdCwKICAgICAqIHdoaWNoIHlvdSBnZXQgYnkgY2FsbGluZyAnbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICknLgogICAgICoKICAgICAqCiAgICAgKiBQcm9wZXJ0aWVzIG9mIGlubmVyIG5vZGVzIGluY2x1ZGluZyB0aGUgdG9wLWxldmVsIGNvbnRhaW5lcjoKICAgICAqCiAgICAgKiAuc2VxIC0gYXJyYXkgb2YgbmVzdGVkIHVuaWZvcm1zCiAgICAgKiAubWFwIC0gbmVzdGVkIHVuaWZvcm1zIGJ5IG5hbWUKICAgICAqCiAgICAgKgogICAgICogTWV0aG9kcyBvZiBhbGwgbm9kZXMgZXhjZXB0IHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyOgogICAgICoKICAgICAqIC5zZXRWYWx1ZSggZ2wsIHZhbHVlLCBbdGV4dHVyZXNdICkKICAgICAqCiAgICAgKiAJCXVwbG9hZHMgYSB1bmlmb3JtIHZhbHVlKHMpCiAgICAgKiAgCXRoZSAndGV4dHVyZXMnIHBhcmFtZXRlciBpcyBuZWVkZWQgZm9yIHNhbXBsZXIgdW5pZm9ybXMKICAgICAqCiAgICAgKgogICAgICogU3RhdGljIG1ldGhvZHMgb2YgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgKHRleHR1cmVzIGZhY3Rvcml6YXRpb25zKToKICAgICAqCiAgICAgKiAudXBsb2FkKCBnbCwgc2VxLCB2YWx1ZXMsIHRleHR1cmVzICkKICAgICAqCiAgICAgKiAJCXNldHMgdW5pZm9ybXMgaW4gJ3NlcScgdG8gJ3ZhbHVlc1tpZF0udmFsdWUnCiAgICAgKgogICAgICogLnNlcVdpdGhWYWx1ZSggc2VxLCB2YWx1ZXMgKSA6IGZpbHRlcmVkU2VxCiAgICAgKgogICAgICogCQlmaWx0ZXJzICdzZXEnIGVudHJpZXMgd2l0aCBjb3JyZXNwb25kaW5nIGVudHJ5IGluIHZhbHVlcwogICAgICoKICAgICAqCiAgICAgKiBNZXRob2RzIG9mIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyICh0ZXh0dXJlcyBmYWN0b3JpemF0aW9ucyk6CiAgICAgKgogICAgICogLnNldFZhbHVlKCBnbCwgbmFtZSwgdmFsdWUsIHRleHR1cmVzICkKICAgICAqCiAgICAgKiAJCXNldHMgdW5pZm9ybSB3aXRoICBuYW1lICduYW1lJyB0byAndmFsdWUnCiAgICAgKgogICAgICogLnNldE9wdGlvbmFsKCBnbCwgb2JqLCBwcm9wICkKICAgICAqCiAgICAgKiAJCWxpa2UgLnNldCBmb3IgYW4gb3B0aW9uYWwgcHJvcGVydHkgb2YgdGhlIG9iamVjdAogICAgICoKICAgICAqLwoKCiAgICBjb25zdCBlbXB0eVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBUZXh0dXJlKCk7CgogICAgY29uc3QgZW1wdHlTaGFkb3dUZXh0dXJlID0gLypAX19QVVJFX18qLyBuZXcgRGVwdGhUZXh0dXJlKCAxLCAxICk7CgogICAgY29uc3QgZW1wdHlBcnJheVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEYXRhQXJyYXlUZXh0dXJlKCk7CiAgICBjb25zdCBlbXB0eTNkVGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IERhdGEzRFRleHR1cmUoKTsKICAgIGNvbnN0IGVtcHR5Q3ViZVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBDdWJlVGV4dHVyZSgpOwoKICAgIC8vIC0tLSBVdGlsaXRpZXMgLS0tCgogICAgLy8gQXJyYXkgQ2FjaGVzIChwcm92aWRlIHR5cGVkIGFycmF5cyBmb3IgdGVtcG9yYXJ5IGJ5IHNpemUpCgogICAgY29uc3QgYXJyYXlDYWNoZUYzMiA9IFtdOwogICAgY29uc3QgYXJyYXlDYWNoZUkzMiA9IFtdOwoKICAgIC8vIEZsb2F0MzJBcnJheSBjYWNoZXMgdXNlZCBmb3IgdXBsb2FkaW5nIE1hdHJpeCB1bmlmb3JtcwoKICAgIGNvbnN0IG1hdDRhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDE2ICk7CiAgICBjb25zdCBtYXQzYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA5ICk7CiAgICBjb25zdCBtYXQyYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA0ICk7CgogICAgLy8gRmxhdHRlbmluZyBmb3IgYXJyYXlzIG9mIHZlY3RvcnMgYW5kIG1hdHJpY2VzCgogICAgZnVuY3Rpb24gZmxhdHRlbiggYXJyYXksIG5CbG9ja3MsIGJsb2NrU2l6ZSApIHsKCiAgICAJY29uc3QgZmlyc3RFbGVtID0gYXJyYXlbIDAgXTsKCiAgICAJaWYgKCBmaXJzdEVsZW0gPD0gMCB8fCBmaXJzdEVsZW0gPiAwICkgcmV0dXJuIGFycmF5OwogICAgCS8vIHVub3B0aW1pemVkOiAhIGlzTmFOKCBmaXJzdEVsZW0gKQogICAgCS8vIHNlZSBodHRwOi8vamFja3NvbmR1bnN0YW4uY29tL2FydGljbGVzLzk4MwoKICAgIAljb25zdCBuID0gbkJsb2NrcyAqIGJsb2NrU2l6ZTsKICAgIAlsZXQgciA9IGFycmF5Q2FjaGVGMzJbIG4gXTsKCiAgICAJaWYgKCByID09PSB1bmRlZmluZWQgKSB7CgogICAgCQlyID0gbmV3IEZsb2F0MzJBcnJheSggbiApOwogICAgCQlhcnJheUNhY2hlRjMyWyBuIF0gPSByOwoKICAgIAl9CgogICAgCWlmICggbkJsb2NrcyAhPT0gMCApIHsKCiAgICAJCWZpcnN0RWxlbS50b0FycmF5KCByLCAwICk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDEsIG9mZnNldCA9IDA7IGkgIT09IG5CbG9ja3M7ICsrIGkgKSB7CgogICAgCQkJb2Zmc2V0ICs9IGJsb2NrU2l6ZTsKICAgIAkJCWFycmF5WyBpIF0udG9BcnJheSggciwgb2Zmc2V0ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHI7CgogICAgfQoKICAgIGZ1bmN0aW9uIGFycmF5c0VxdWFsKCBhLCBiICkgewoKICAgIAlpZiAoIGEubGVuZ3RoICE9PSBiLmxlbmd0aCApIHJldHVybiBmYWxzZTsKCiAgICAJZm9yICggbGV0IGkgPSAwLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJaWYgKCBhWyBpIF0gIT09IGJbIGkgXSApIHJldHVybiBmYWxzZTsKCiAgICAJfQoKICAgIAlyZXR1cm4gdHJ1ZTsKCiAgICB9CgogICAgZnVuY3Rpb24gY29weUFycmF5KCBhLCBiICkgewoKICAgIAlmb3IgKCBsZXQgaSA9IDAsIGwgPSBiLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQlhWyBpIF0gPSBiWyBpIF07CgogICAgCX0KCiAgICB9CgogICAgLy8gVGV4dHVyZSB1bml0IGFsbG9jYXRpb24KCiAgICBmdW5jdGlvbiBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApIHsKCiAgICAJbGV0IHIgPSBhcnJheUNhY2hlSTMyWyBuIF07CgogICAgCWlmICggciA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJciA9IG5ldyBJbnQzMkFycmF5KCBuICk7CiAgICAJCWFycmF5Q2FjaGVJMzJbIG4gXSA9IHI7CgogICAgCX0KCiAgICAJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJclsgaSBdID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwoKICAgIAl9CgogICAgCXJldHVybiByOwoKICAgIH0KCiAgICAvLyAtLS0gU2V0dGVycyAtLS0KCiAgICAvLyBOb3RlOiBEZWZpbmluZyB0aGVzZSBtZXRob2RzIGV4dGVybmFsbHksIGJlY2F1c2UgdGhleSBjb21lIGluIGEgYnVuY2gKICAgIC8vIGFuZCB0aGlzIHdheSB0aGVpciBuYW1lcyBtaW5pZnkuCgogICAgLy8gU2luZ2xlIHNjYWxhcgoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjFmKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgogICAgCWdsLnVuaWZvcm0xZiggdGhpcy5hZGRyLCB2ICk7CgogICAgCWNhY2hlWyAwIF0gPSB2OwoKICAgIH0KCiAgICAvLyBTaW5nbGUgZmxvYXQgdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYyZiggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCiAgICAJCQlnbC51bmlmb3JtMmYoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtMmZ2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYzZiggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgogICAgCQkJZ2wudW5pZm9ybTNmKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKICAgIAkJCWNhY2hlWyAyIF0gPSB2Lno7CgogICAgCQl9CgogICAgCX0gZWxzZSBpZiAoIHYuciAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnIgfHwgY2FjaGVbIDEgXSAhPT0gdi5nIHx8IGNhY2hlWyAyIF0gIT09IHYuYiApIHsKCiAgICAJCQlnbC51bmlmb3JtM2YoIHRoaXMuYWRkciwgdi5yLCB2LmcsIHYuYiApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2LnI7CiAgICAJCQljYWNoZVsgMSBdID0gdi5nOwogICAgCQkJY2FjaGVbIDIgXSA9IHYuYjsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtM2Z2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVY0ZiggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKICAgIAkJCWdsLnVuaWZvcm00ZiggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKICAgIAkJCWNhY2hlWyAyIF0gPSB2Lno7CiAgICAJCQljYWNoZVsgMyBdID0gdi53OwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm00ZnYoIHRoaXMuYWRkciwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9CgogICAgfQoKICAgIC8vIFNpbmdsZSBtYXRyaXggKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5NYXRyaXhOKQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlTTIoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKICAgIAlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKICAgIAkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgogICAgCQltYXQyYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKICAgIAkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0MmFycmF5ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlTTMoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKICAgIAlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKICAgIAkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgogICAgCQltYXQzYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKICAgIAkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0M2FycmF5ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlTTQoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKICAgIAlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKICAgIAkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgogICAgCQltYXQ0YXJyYXkuc2V0KCBlbGVtZW50cyApOwoKICAgIAkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0NGFycmF5ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKICAgIAl9CgogICAgfQoKICAgIC8vIFNpbmdsZSBpbnRlZ2VyIC8gYm9vbGVhbgoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjFpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgogICAgCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB2ICk7CgogICAgCWNhY2hlWyAwIF0gPSB2OwoKICAgIH0KCiAgICAvLyBTaW5nbGUgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYyaSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCiAgICAJCQlnbC51bmlmb3JtMmkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYzaSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgogICAgCQkJZ2wudW5pZm9ybTNpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKICAgIAkJCWNhY2hlWyAyIF0gPSB2Lno7CgogICAgCQl9CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKICAgIAkJZ2wudW5pZm9ybTNpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVWNGkoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56IHx8IGNhY2hlWyAzIF0gIT09IHYudyApIHsKCiAgICAJCQlnbC51bmlmb3JtNGkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgogICAgCQkJY2FjaGVbIDAgXSA9IHYueDsKICAgIAkJCWNhY2hlWyAxIF0gPSB2Lnk7CiAgICAJCQljYWNoZVsgMiBdID0gdi56OwogICAgCQkJY2FjaGVbIDMgXSA9IHYudzsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtNGl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCiAgICAvLyBTaW5nbGUgdW5zaWduZWQgaW50ZWdlcgoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjF1aSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCBjYWNoZVsgMCBdID09PSB2ICkgcmV0dXJuOwoKICAgIAlnbC51bmlmb3JtMXVpKCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJY2FjaGVbIDAgXSA9IHY7CgogICAgfQoKICAgIC8vIFNpbmdsZSB1bnNpZ25lZCBpbnRlZ2VyIHZlY3RvciAoZnJvbSBmbGF0IGFycmF5IG9yIFRIUkVFLlZlY3Rvck4pCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMnVpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55ICkgewoKICAgIAkJCWdsLnVuaWZvcm0ydWkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVWM3VpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCiAgICAJCQlnbC51bmlmb3JtM3VpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKICAgIAkJCWNhY2hlWyAyIF0gPSB2Lno7CgogICAgCQl9CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKICAgIAkJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjR1aSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKICAgIAkJCWdsLnVuaWZvcm00dWkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgogICAgCQkJY2FjaGVbIDAgXSA9IHYueDsKICAgIAkJCWNhY2hlWyAxIF0gPSB2Lnk7CiAgICAJCQljYWNoZVsgMiBdID0gdi56OwogICAgCQkJY2FjaGVbIDMgXSA9IHYudzsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtNHVpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0KCiAgICB9CgoKICAgIC8vIFNpbmdsZSB0ZXh0dXJlICgyRCAvIEN1YmUpCgogICAgZnVuY3Rpb24gc2V0VmFsdWVUMSggZ2wsIHYsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCiAgICAJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKICAgIAkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKICAgIAkJY2FjaGVbIDAgXSA9IHVuaXQ7CgogICAgCX0KCiAgICAJbGV0IGVtcHR5VGV4dHVyZTJEOwoKICAgIAlpZiAoIHRoaXMudHlwZSA9PT0gZ2wuU0FNUExFUl8yRF9TSEFET1cgKSB7CgogICAgCQllbXB0eVNoYWRvd1RleHR1cmUuY29tcGFyZUZ1bmN0aW9uID0gTGVzc0VxdWFsQ29tcGFyZTsgLy8gIzI4NjcwCiAgICAJCWVtcHR5VGV4dHVyZTJEID0gZW1wdHlTaGFkb3dUZXh0dXJlOwoKICAgIAl9IGVsc2UgewoKICAgIAkJZW1wdHlUZXh0dXJlMkQgPSBlbXB0eVRleHR1cmU7CgogICAgCX0KCiAgICAJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2IHx8IGVtcHR5VGV4dHVyZTJELCB1bml0ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVDNEMSggZ2wsIHYsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCiAgICAJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKICAgIAkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKICAgIAkJY2FjaGVbIDAgXSA9IHVuaXQ7CgogICAgCX0KCiAgICAJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB2IHx8IGVtcHR5M2RUZXh0dXJlLCB1bml0ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVDYoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgogICAgCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCiAgICAJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CiAgICAJCWNhY2hlWyAwIF0gPSB1bml0OwoKICAgIAl9CgogICAgCXRleHR1cmVzLnNldFRleHR1cmVDdWJlKCB2IHx8IGVtcHR5Q3ViZVRleHR1cmUsIHVuaXQgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheTEoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwogICAgCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgogICAgCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCiAgICAJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CiAgICAJCWNhY2hlWyAwIF0gPSB1bml0OwoKICAgIAl9CgogICAgCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB2IHx8IGVtcHR5QXJyYXlUZXh0dXJlLCB1bml0ICk7CgogICAgfQoKICAgIC8vIEhlbHBlciB0byBwaWNrIHRoZSByaWdodCBzZXR0ZXIgZm9yIHRoZSBzaW5ndWxhciBjYXNlCgogICAgZnVuY3Rpb24gZ2V0U2luZ3VsYXJTZXR0ZXIoIHR5cGUgKSB7CgogICAgCXN3aXRjaCAoIHR5cGUgKSB7CgogICAgCQljYXNlIDB4MTQwNjogcmV0dXJuIHNldFZhbHVlVjFmOyAvLyBGTE9BVAogICAgCQljYXNlIDB4OGI1MDogcmV0dXJuIHNldFZhbHVlVjJmOyAvLyBfVkVDMgogICAgCQljYXNlIDB4OGI1MTogcmV0dXJuIHNldFZhbHVlVjNmOyAvLyBfVkVDMwogICAgCQljYXNlIDB4OGI1MjogcmV0dXJuIHNldFZhbHVlVjRmOyAvLyBfVkVDNAoKICAgIAkJY2FzZSAweDhiNWE6IHJldHVybiBzZXRWYWx1ZU0yOyAvLyBfTUFUMgogICAgCQljYXNlIDB4OGI1YjogcmV0dXJuIHNldFZhbHVlTTM7IC8vIF9NQVQzCiAgICAJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNDsgLy8gX01BVDQKCiAgICAJCWNhc2UgMHgxNDA0OiBjYXNlIDB4OGI1NjogcmV0dXJuIHNldFZhbHVlVjFpOyAvLyBJTlQsIEJPT0wKICAgIAkJY2FzZSAweDhiNTM6IGNhc2UgMHg4YjU3OiByZXR1cm4gc2V0VmFsdWVWMmk7IC8vIF9WRUMyCiAgICAJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlVjNpOyAvLyBfVkVDMwogICAgCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZVY0aTsgLy8gX1ZFQzQKCiAgICAJCWNhc2UgMHgxNDA1OiByZXR1cm4gc2V0VmFsdWVWMXVpOyAvLyBVSU5UCiAgICAJCWNhc2UgMHg4ZGM2OiByZXR1cm4gc2V0VmFsdWVWMnVpOyAvLyBfVkVDMgogICAgCQljYXNlIDB4OGRjNzogcmV0dXJuIHNldFZhbHVlVjN1aTsgLy8gX1ZFQzMKICAgIAkJY2FzZSAweDhkYzg6IHJldHVybiBzZXRWYWx1ZVY0dWk7IC8vIF9WRUM0CgogICAgCQljYXNlIDB4OGI1ZTogLy8gU0FNUExFUl8yRAogICAgCQljYXNlIDB4OGQ2NjogLy8gU0FNUExFUl9FWFRFUk5BTF9PRVMKICAgIAkJY2FzZSAweDhkY2E6IC8vIElOVF9TQU1QTEVSXzJECiAgICAJCWNhc2UgMHg4ZGQyOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRAogICAgCQljYXNlIDB4OGI2MjogLy8gU0FNUExFUl8yRF9TSEFET1cKICAgIAkJCXJldHVybiBzZXRWYWx1ZVQxOwoKICAgIAkJY2FzZSAweDhiNWY6IC8vIFNBTVBMRVJfM0QKICAgIAkJY2FzZSAweDhkY2I6IC8vIElOVF9TQU1QTEVSXzNECiAgICAJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAogICAgCQkJcmV0dXJuIHNldFZhbHVlVDNEMTsKCiAgICAJCWNhc2UgMHg4YjYwOiAvLyBTQU1QTEVSX0NVQkUKICAgIAkJY2FzZSAweDhkY2M6IC8vIElOVF9TQU1QTEVSX0NVQkUKICAgIAkJY2FzZSAweDhkZDQ6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSX0NVQkUKICAgIAkJY2FzZSAweDhkYzU6IC8vIFNBTVBMRVJfQ1VCRV9TSEFET1cKICAgIAkJCXJldHVybiBzZXRWYWx1ZVQ2OwoKICAgIAkJY2FzZSAweDhkYzE6IC8vIFNBTVBMRVJfMkRfQVJSQVkKICAgIAkJY2FzZSAweDhkY2Y6IC8vIElOVF9TQU1QTEVSXzJEX0FSUkFZCiAgICAJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQogICAgCQljYXNlIDB4OGRjNDogLy8gU0FNUExFUl8yRF9BUlJBWV9TSEFET1cKICAgIAkJCXJldHVybiBzZXRWYWx1ZVQyREFycmF5MTsKCiAgICAJfQoKICAgIH0KCgogICAgLy8gQXJyYXkgb2Ygc2NhbGFycwoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjFmQXJyYXkoIGdsLCB2ICkgewoKICAgIAlnbC51bmlmb3JtMWZ2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgogICAgLy8gQXJyYXkgb2YgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLlZlY3Rvck4pCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMmZBcnJheSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDIgKTsKCiAgICAJZ2wudW5pZm9ybTJmdiggdGhpcy5hZGRyLCBkYXRhICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjNmQXJyYXkoIGdsLCB2ICkgewoKICAgIAljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAzICk7CgogICAgCWdsLnVuaWZvcm0zZnYoIHRoaXMuYWRkciwgZGF0YSApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVY0ZkFycmF5KCBnbCwgdiApIHsKCiAgICAJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgNCApOwoKICAgIAlnbC51bmlmb3JtNGZ2KCB0aGlzLmFkZHIsIGRhdGEgKTsKCiAgICB9CgogICAgLy8gQXJyYXkgb2YgbWF0cmljZXMgKGZyb20gZmxhdCBhcnJheSBvciBhcnJheSBvZiBUSFJFRS5NYXRyaXhOKQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlTTJBcnJheSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDQgKTsKCiAgICAJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZU0zQXJyYXkoIGdsLCB2ICkgewoKICAgIAljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA5ICk7CgogICAgCWdsLnVuaWZvcm1NYXRyaXgzZnYoIHRoaXMuYWRkciwgZmFsc2UsIGRhdGEgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVNNEFycmF5KCBnbCwgdiApIHsKCiAgICAJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgMTYgKTsKCiAgICAJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKICAgIH0KCiAgICAvLyBBcnJheSBvZiBpbnRlZ2VyIC8gYm9vbGVhbgoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjFpQXJyYXkoIGdsLCB2ICkgewoKICAgIAlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgogICAgLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjJpQXJyYXkoIGdsLCB2ICkgewoKICAgIAlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVWM2lBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm0zaXYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVY0aUFycmF5KCBnbCwgdiApIHsKCiAgICAJZ2wudW5pZm9ybTRpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgfQoKICAgIC8vIEFycmF5IG9mIHVuc2lnbmVkIGludGVnZXIKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYxdWlBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm0xdWl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgogICAgLy8gQXJyYXkgb2YgdW5zaWduZWQgaW50ZWdlciB2ZWN0b3JzIChmcm9tIGZsYXQgYXJyYXkpCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMnVpQXJyYXkoIGdsLCB2ICkgewoKICAgIAlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjN1aUFycmF5KCBnbCwgdiApIHsKCiAgICAJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVY0dWlBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm00dWl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgoKICAgIC8vIEFycmF5IG9mIHRleHR1cmVzICgyRCAvIDNEIC8gQ3ViZSAvIDJEQXJyYXkpCgogICAgZnVuY3Rpb24gc2V0VmFsdWVUMUFycmF5KCBnbCwgdiwgdGV4dHVyZXMgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJY29uc3QgbiA9IHYubGVuZ3RoOwoKICAgIAljb25zdCB1bml0cyA9IGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICk7CgogICAgCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgogICAgCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB1bml0cyApOwoKICAgIAl9CgogICAgCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCiAgICAJCXRleHR1cmVzLnNldFRleHR1cmUyRCggdlsgaSBdIHx8IGVtcHR5VGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVDNEQXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAljb25zdCBuID0gdi5sZW5ndGg7CgogICAgCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCiAgICAJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCiAgICAJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgogICAgCX0KCiAgICAJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB2WyBpIF0gfHwgZW1wdHkzZFRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVQ2QXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAljb25zdCBuID0gdi5sZW5ndGg7CgogICAgCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCiAgICAJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCiAgICAJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgogICAgCX0KCiAgICAJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHZbIGkgXSB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0c1sgaSBdICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheUFycmF5KCBnbCwgdiwgdGV4dHVyZXMgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJY29uc3QgbiA9IHYubGVuZ3RoOwoKICAgIAljb25zdCB1bml0cyA9IGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICk7CgogICAgCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgogICAgCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB1bml0cyApOwoKICAgIAl9CgogICAgCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCiAgICAJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB2WyBpIF0gfHwgZW1wdHlBcnJheVRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCiAgICAJfQoKICAgIH0KCgogICAgLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgYSBwdXJlIChib3R0b20tbGV2ZWwpIGFycmF5CgogICAgZnVuY3Rpb24gZ2V0UHVyZUFycmF5U2V0dGVyKCB0eXBlICkgewoKICAgIAlzd2l0Y2ggKCB0eXBlICkgewoKICAgIAkJY2FzZSAweDE0MDY6IHJldHVybiBzZXRWYWx1ZVYxZkFycmF5OyAvLyBGTE9BVAogICAgCQljYXNlIDB4OGI1MDogcmV0dXJuIHNldFZhbHVlVjJmQXJyYXk7IC8vIF9WRUMyCiAgICAJCWNhc2UgMHg4YjUxOiByZXR1cm4gc2V0VmFsdWVWM2ZBcnJheTsgLy8gX1ZFQzMKICAgIAkJY2FzZSAweDhiNTI6IHJldHVybiBzZXRWYWx1ZVY0ZkFycmF5OyAvLyBfVkVDNAoKICAgIAkJY2FzZSAweDhiNWE6IHJldHVybiBzZXRWYWx1ZU0yQXJyYXk7IC8vIF9NQVQyCiAgICAJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNM0FycmF5OyAvLyBfTUFUMwogICAgCQljYXNlIDB4OGI1YzogcmV0dXJuIHNldFZhbHVlTTRBcnJheTsgLy8gX01BVDQKCiAgICAJCWNhc2UgMHgxNDA0OiBjYXNlIDB4OGI1NjogcmV0dXJuIHNldFZhbHVlVjFpQXJyYXk7IC8vIElOVCwgQk9PTAogICAgCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZVYyaUFycmF5OyAvLyBfVkVDMgogICAgCQljYXNlIDB4OGI1NDogY2FzZSAweDhiNTg6IHJldHVybiBzZXRWYWx1ZVYzaUFycmF5OyAvLyBfVkVDMwogICAgCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZVY0aUFycmF5OyAvLyBfVkVDNAoKICAgIAkJY2FzZSAweDE0MDU6IHJldHVybiBzZXRWYWx1ZVYxdWlBcnJheTsgLy8gVUlOVAogICAgCQljYXNlIDB4OGRjNjogcmV0dXJuIHNldFZhbHVlVjJ1aUFycmF5OyAvLyBfVkVDMgogICAgCQljYXNlIDB4OGRjNzogcmV0dXJuIHNldFZhbHVlVjN1aUFycmF5OyAvLyBfVkVDMwogICAgCQljYXNlIDB4OGRjODogcmV0dXJuIHNldFZhbHVlVjR1aUFycmF5OyAvLyBfVkVDNAoKICAgIAkJY2FzZSAweDhiNWU6IC8vIFNBTVBMRVJfMkQKICAgIAkJY2FzZSAweDhkNjY6IC8vIFNBTVBMRVJfRVhURVJOQUxfT0VTCiAgICAJCWNhc2UgMHg4ZGNhOiAvLyBJTlRfU0FNUExFUl8yRAogICAgCQljYXNlIDB4OGRkMjogLy8gVU5TSUdORURfSU5UX1NBTVBMRVJfMkQKICAgIAkJY2FzZSAweDhiNjI6IC8vIFNBTVBMRVJfMkRfU0hBRE9XCiAgICAJCQlyZXR1cm4gc2V0VmFsdWVUMUFycmF5OwoKICAgIAkJY2FzZSAweDhiNWY6IC8vIFNBTVBMRVJfM0QKICAgIAkJY2FzZSAweDhkY2I6IC8vIElOVF9TQU1QTEVSXzNECiAgICAJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAogICAgCQkJcmV0dXJuIHNldFZhbHVlVDNEQXJyYXk7CgogICAgCQljYXNlIDB4OGI2MDogLy8gU0FNUExFUl9DVUJFCiAgICAJCWNhc2UgMHg4ZGNjOiAvLyBJTlRfU0FNUExFUl9DVUJFCiAgICAJCWNhc2UgMHg4ZGQ0OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl9DVUJFCiAgICAJCWNhc2UgMHg4ZGM1OiAvLyBTQU1QTEVSX0NVQkVfU0hBRE9XCiAgICAJCQlyZXR1cm4gc2V0VmFsdWVUNkFycmF5OwoKICAgIAkJY2FzZSAweDhkYzE6IC8vIFNBTVBMRVJfMkRfQVJSQVkKICAgIAkJY2FzZSAweDhkY2Y6IC8vIElOVF9TQU1QTEVSXzJEX0FSUkFZCiAgICAJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQogICAgCQljYXNlIDB4OGRjNDogLy8gU0FNUExFUl8yRF9BUlJBWV9TSEFET1cKICAgIAkJCXJldHVybiBzZXRWYWx1ZVQyREFycmF5QXJyYXk7CgogICAgCX0KCiAgICB9CgogICAgLy8gLS0tIFVuaWZvcm0gQ2xhc3NlcyAtLS0KCiAgICBjbGFzcyBTaW5nbGVVbmlmb3JtIHsKCiAgICAJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKICAgIAkJdGhpcy5pZCA9IGlkOwogICAgCQl0aGlzLmFkZHIgPSBhZGRyOwogICAgCQl0aGlzLmNhY2hlID0gW107CiAgICAJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKICAgIAkJdGhpcy5zZXRWYWx1ZSA9IGdldFNpbmd1bGFyU2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCiAgICAJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCiAgICAJfQoKICAgIH0KCiAgICBjbGFzcyBQdXJlQXJyYXlVbmlmb3JtIHsKCiAgICAJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKICAgIAkJdGhpcy5pZCA9IGlkOwogICAgCQl0aGlzLmFkZHIgPSBhZGRyOwogICAgCQl0aGlzLmNhY2hlID0gW107CiAgICAJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKICAgIAkJdGhpcy5zaXplID0gYWN0aXZlSW5mby5zaXplOwogICAgCQl0aGlzLnNldFZhbHVlID0gZ2V0UHVyZUFycmF5U2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCiAgICAJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCiAgICAJfQoKICAgIH0KCiAgICBjbGFzcyBTdHJ1Y3R1cmVkVW5pZm9ybSB7CgogICAgCWNvbnN0cnVjdG9yKCBpZCApIHsKCiAgICAJCXRoaXMuaWQgPSBpZDsKCiAgICAJCXRoaXMuc2VxID0gW107CiAgICAJCXRoaXMubWFwID0ge307CgogICAgCX0KCiAgICAJc2V0VmFsdWUoIGdsLCB2YWx1ZSwgdGV4dHVyZXMgKSB7CgogICAgCQljb25zdCBzZXEgPSB0aGlzLnNlcTsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgogICAgCQkJY29uc3QgdSA9IHNlcVsgaSBdOwogICAgCQkJdS5zZXRWYWx1ZSggZ2wsIHZhbHVlWyB1LmlkIF0sIHRleHR1cmVzICk7CgogICAgCQl9CgogICAgCX0KCiAgICB9CgogICAgLy8gLS0tIFRvcC1sZXZlbCAtLS0KCiAgICAvLyBQYXJzZXIgLSBidWlsZHMgdXAgdGhlIHByb3BlcnR5IHRyZWUgZnJvbSB0aGUgcGF0aCBzdHJpbmdzCgogICAgY29uc3QgUmVQYXRoUGFydCA9IC8oXHcrKShcXSk/KFxbfFwuKT8vZzsKCiAgICAvLyBleHRyYWN0cwogICAgLy8gCS0gdGhlIGlkZW50aWZpZXIgKG1lbWJlciBuYW1lIG9yIGFycmF5IGluZGV4KQogICAgLy8gIC0gZm9sbG93ZWQgYnkgYW4gb3B0aW9uYWwgcmlnaHQgYnJhY2tldCAoZm91bmQgd2hlbiBhcnJheSBpbmRleCkKICAgIC8vICAtIGZvbGxvd2VkIGJ5IGFuIG9wdGlvbmFsIGxlZnQgYnJhY2tldCBvciBkb3QgKHR5cGUgb2Ygc3Vic2NyaXB0KQogICAgLy8KICAgIC8vIE5vdGU6IFRoZXNlIHBvcnRpb25zIGNhbiBiZSByZWFkIGluIGEgbm9uLW92ZXJsYXBwaW5nIGZhc2hpb24gYW5kCiAgICAvLyBhbGxvdyBzdHJhaWdodGZvcndhcmQgcGFyc2luZyBvZiB0aGUgaGllcmFyY2h5IHRoYXQgV2ViR0wgZW5jb2RlcwogICAgLy8gaW4gdGhlIHVuaWZvcm0gbmFtZXMuCgogICAgZnVuY3Rpb24gYWRkVW5pZm9ybSggY29udGFpbmVyLCB1bmlmb3JtT2JqZWN0ICkgewoKICAgIAljb250YWluZXIuc2VxLnB1c2goIHVuaWZvcm1PYmplY3QgKTsKICAgIAljb250YWluZXIubWFwWyB1bmlmb3JtT2JqZWN0LmlkIF0gPSB1bmlmb3JtT2JqZWN0OwoKICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZVVuaWZvcm0oIGFjdGl2ZUluZm8sIGFkZHIsIGNvbnRhaW5lciApIHsKCiAgICAJY29uc3QgcGF0aCA9IGFjdGl2ZUluZm8ubmFtZSwKICAgIAkJcGF0aExlbmd0aCA9IHBhdGgubGVuZ3RoOwoKICAgIAkvLyByZXNldCBSZWdFeHAgb2JqZWN0LCBiZWNhdXNlIG9mIHRoZSBlYXJseSBleGl0IG9mIGEgcHJldmlvdXMgcnVuCiAgICAJUmVQYXRoUGFydC5sYXN0SW5kZXggPSAwOwoKICAgIAl3aGlsZSAoIHRydWUgKSB7CgogICAgCQljb25zdCBtYXRjaCA9IFJlUGF0aFBhcnQuZXhlYyggcGF0aCApLAogICAgCQkJbWF0Y2hFbmQgPSBSZVBhdGhQYXJ0Lmxhc3RJbmRleDsKCiAgICAJCWxldCBpZCA9IG1hdGNoWyAxIF07CiAgICAJCWNvbnN0IGlkSXNJbmRleCA9IG1hdGNoWyAyIF0gPT09ICddJywKICAgIAkJCXN1YnNjcmlwdCA9IG1hdGNoWyAzIF07CgogICAgCQlpZiAoIGlkSXNJbmRleCApIGlkID0gaWQgfCAwOyAvLyBjb252ZXJ0IHRvIGludGVnZXIKCiAgICAJCWlmICggc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgfHwgc3Vic2NyaXB0ID09PSAnWycgJiYgbWF0Y2hFbmQgKyAyID09PSBwYXRoTGVuZ3RoICkgewoKICAgIAkJCS8vIGJhcmUgbmFtZSBvciAicHVyZSIgYm90dG9tLWxldmVsIGFycmF5ICJbMF0iIHN1ZmZpeAoKICAgIAkJCWFkZFVuaWZvcm0oIGNvbnRhaW5lciwgc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgPwogICAgCQkJCW5ldyBTaW5nbGVVbmlmb3JtKCBpZCwgYWN0aXZlSW5mbywgYWRkciApIDoKICAgIAkJCQluZXcgUHVyZUFycmF5VW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSApOwoKICAgIAkJCWJyZWFrOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQkvLyBzdGVwIGludG8gaW5uZXIgbm9kZSAvIGNyZWF0ZSBpdCBpbiBjYXNlIGl0IGRvZXNuJ3QgZXhpc3QKCiAgICAJCQljb25zdCBtYXAgPSBjb250YWluZXIubWFwOwogICAgCQkJbGV0IG5leHQgPSBtYXBbIGlkIF07CgogICAgCQkJaWYgKCBuZXh0ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCW5leHQgPSBuZXcgU3RydWN0dXJlZFVuaWZvcm0oIGlkICk7CiAgICAJCQkJYWRkVW5pZm9ybSggY29udGFpbmVyLCBuZXh0ICk7CgogICAgCQkJfQoKICAgIAkJCWNvbnRhaW5lciA9IG5leHQ7CgogICAgCQl9CgogICAgCX0KCiAgICB9CgogICAgLy8gUm9vdCBDb250YWluZXIKCiAgICBjbGFzcyBXZWJHTFVuaWZvcm1zIHsKCiAgICAJY29uc3RydWN0b3IoIGdsLCBwcm9ncmFtICkgewoKICAgIAkJdGhpcy5zZXEgPSBbXTsKICAgIAkJdGhpcy5tYXAgPSB7fTsKCiAgICAJCWNvbnN0IG4gPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5BQ1RJVkVfVU5JRk9STVMgKTsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IG47ICsrIGkgKSB7CgogICAgCQkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZVVuaWZvcm0oIHByb2dyYW0sIGkgKSwKICAgIAkJCQlhZGRyID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKCBwcm9ncmFtLCBpbmZvLm5hbWUgKTsKCiAgICAJCQlwYXJzZVVuaWZvcm0oIGluZm8sIGFkZHIsIHRoaXMgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlzZXRWYWx1ZSggZ2wsIG5hbWUsIHZhbHVlLCB0ZXh0dXJlcyApIHsKCiAgICAJCWNvbnN0IHUgPSB0aGlzLm1hcFsgbmFtZSBdOwoKICAgIAkJaWYgKCB1ICE9PSB1bmRlZmluZWQgKSB1LnNldFZhbHVlKCBnbCwgdmFsdWUsIHRleHR1cmVzICk7CgogICAgCX0KCiAgICAJc2V0T3B0aW9uYWwoIGdsLCBvYmplY3QsIG5hbWUgKSB7CgogICAgCQljb25zdCB2ID0gb2JqZWN0WyBuYW1lIF07CgogICAgCQlpZiAoIHYgIT09IHVuZGVmaW5lZCApIHRoaXMuc2V0VmFsdWUoIGdsLCBuYW1lLCB2ICk7CgogICAgCX0KCiAgICAJc3RhdGljIHVwbG9hZCggZ2wsIHNlcSwgdmFsdWVzLCB0ZXh0dXJlcyApIHsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgogICAgCQkJY29uc3QgdSA9IHNlcVsgaSBdLAogICAgCQkJCXYgPSB2YWx1ZXNbIHUuaWQgXTsKCiAgICAJCQlpZiAoIHYubmVlZHNVcGRhdGUgIT09IGZhbHNlICkgewoKICAgIAkJCQkvLyBub3RlOiBhbHdheXMgdXBkYXRpbmcgd2hlbiAubmVlZHNVcGRhdGUgaXMgdW5kZWZpbmVkCiAgICAJCQkJdS5zZXRWYWx1ZSggZ2wsIHYudmFsdWUsIHRleHR1cmVzICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCXN0YXRpYyBzZXFXaXRoVmFsdWUoIHNlcSwgdmFsdWVzICkgewoKICAgIAkJY29uc3QgciA9IFtdOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCiAgICAJCQljb25zdCB1ID0gc2VxWyBpIF07CiAgICAJCQlpZiAoIHUuaWQgaW4gdmFsdWVzICkgci5wdXNoKCB1ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gcjsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTFNoYWRlciggZ2wsIHR5cGUsIHN0cmluZyApIHsKCiAgICAJY29uc3Qgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKCB0eXBlICk7CgogICAgCWdsLnNoYWRlclNvdXJjZSggc2hhZGVyLCBzdHJpbmcgKTsKICAgIAlnbC5jb21waWxlU2hhZGVyKCBzaGFkZXIgKTsKCiAgICAJcmV0dXJuIHNoYWRlcjsKCiAgICB9CgogICAgLy8gRnJvbSBodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9leHRlbnNpb25zL0tIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZS8KICAgIGNvbnN0IENPTVBMRVRJT05fU1RBVFVTX0tIUiA9IDB4OTFCMTsKCiAgICBsZXQgcHJvZ3JhbUlkQ291bnQgPSAwOwoKICAgIGZ1bmN0aW9uIGhhbmRsZVNvdXJjZSggc3RyaW5nLCBlcnJvckxpbmUgKSB7CgogICAgCWNvbnN0IGxpbmVzID0gc3RyaW5nLnNwbGl0KCAnXG4nICk7CiAgICAJY29uc3QgbGluZXMyID0gW107CgogICAgCWNvbnN0IGZyb20gPSBNYXRoLm1heCggZXJyb3JMaW5lIC0gNiwgMCApOwogICAgCWNvbnN0IHRvID0gTWF0aC5taW4oIGVycm9yTGluZSArIDYsIGxpbmVzLmxlbmd0aCApOwoKICAgIAlmb3IgKCBsZXQgaSA9IGZyb207IGkgPCB0bzsgaSArKyApIHsKCiAgICAJCWNvbnN0IGxpbmUgPSBpICsgMTsKICAgIAkJbGluZXMyLnB1c2goIGAke2xpbmUgPT09IGVycm9yTGluZSA/ICc+JyA6ICcgJ30gJHtsaW5lfTogJHtsaW5lc1sgaSBdfWAgKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gbGluZXMyLmpvaW4oICdcbicgKTsKCiAgICB9CgogICAgY29uc3QgX20wID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpOwoKICAgIGZ1bmN0aW9uIGdldEVuY29kaW5nQ29tcG9uZW50cyggY29sb3JTcGFjZSApIHsKCiAgICAJQ29sb3JNYW5hZ2VtZW50Ll9nZXRNYXRyaXgoIF9tMCwgQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlLCBjb2xvclNwYWNlICk7CgogICAgCWNvbnN0IGVuY29kaW5nTWF0cml4ID0gYG1hdDMoICR7IF9tMC5lbGVtZW50cy5tYXAoICggdiApID0+IHYudG9GaXhlZCggNCApICkgfSApYDsKCiAgICAJc3dpdGNoICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICkgKSB7CgogICAgCQljYXNlIExpbmVhclRyYW5zZmVyOgogICAgCQkJcmV0dXJuIFsgZW5jb2RpbmdNYXRyaXgsICdMaW5lYXJUcmFuc2Zlck9FVEYnIF07CgogICAgCQljYXNlIFNSR0JUcmFuc2ZlcjoKICAgIAkJCXJldHVybiBbIGVuY29kaW5nTWF0cml4LCAnc1JHQlRyYW5zZmVyT0VURicgXTsKCiAgICAJCWRlZmF1bHQ6CiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IFVuc3VwcG9ydGVkIGNvbG9yIHNwYWNlOiAnLCBjb2xvclNwYWNlICk7CiAgICAJCQlyZXR1cm4gWyBlbmNvZGluZ01hdHJpeCwgJ0xpbmVhclRyYW5zZmVyT0VURicgXTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRTaGFkZXJFcnJvcnMoIGdsLCBzaGFkZXIsIHR5cGUgKSB7CgogICAgCWNvbnN0IHN0YXR1cyA9IGdsLmdldFNoYWRlclBhcmFtZXRlciggc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUyApOwogICAgCWNvbnN0IGVycm9ycyA9IGdsLmdldFNoYWRlckluZm9Mb2coIHNoYWRlciApLnRyaW0oKTsKCiAgICAJaWYgKCBzdGF0dXMgJiYgZXJyb3JzID09PSAnJyApIHJldHVybiAnJzsKCiAgICAJY29uc3QgZXJyb3JNYXRjaGVzID0gL0VSUk9SOiAwOihcZCspLy5leGVjKCBlcnJvcnMgKTsKICAgIAlpZiAoIGVycm9yTWF0Y2hlcyApIHsKCiAgICAJCS8vIC0tZW5hYmxlLXByaXZpbGVnZWQtd2ViZ2wtZXh0ZW5zaW9uCiAgICAJCS8vIGNvbnNvbGUubG9nKCAnKionICsgdHlwZSArICcqKicsIGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlYnVnX3NoYWRlcnMnICkuZ2V0VHJhbnNsYXRlZFNoYWRlclNvdXJjZSggc2hhZGVyICkgKTsKCiAgICAJCWNvbnN0IGVycm9yTGluZSA9IHBhcnNlSW50KCBlcnJvck1hdGNoZXNbIDEgXSApOwogICAgCQlyZXR1cm4gdHlwZS50b1VwcGVyQ2FzZSgpICsgJ1xuXG4nICsgZXJyb3JzICsgJ1xuXG4nICsgaGFuZGxlU291cmNlKCBnbC5nZXRTaGFkZXJTb3VyY2UoIHNoYWRlciApLCBlcnJvckxpbmUgKTsKCiAgICAJfSBlbHNlIHsKCiAgICAJCXJldHVybiBlcnJvcnM7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGNvbG9yU3BhY2UgKSB7CgogICAgCWNvbnN0IGNvbXBvbmVudHMgPSBnZXRFbmNvZGluZ0NvbXBvbmVudHMoIGNvbG9yU3BhY2UgKTsKCiAgICAJcmV0dXJuIFsKCiAgICAJCWB2ZWM0ICR7ZnVuY3Rpb25OYW1lfSggdmVjNCB2YWx1ZSApIHtgLAoKICAgIAkJYAlyZXR1cm4gJHtjb21wb25lbnRzWyAxIF19KCB2ZWM0KCB2YWx1ZS5yZ2IgKiAke2NvbXBvbmVudHNbIDAgXX0sIHZhbHVlLmEgKSApO2AsCgogICAgCQknfScsCgogICAgCV0uam9pbiggJ1xuJyApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIHRvbmVNYXBwaW5nICkgewoKICAgIAlsZXQgdG9uZU1hcHBpbmdOYW1lOwoKICAgIAlzd2l0Y2ggKCB0b25lTWFwcGluZyApIHsKCiAgICAJCWNhc2UgTGluZWFyVG9uZU1hcHBpbmc6CiAgICAJCQl0b25lTWFwcGluZ05hbWUgPSAnTGluZWFyJzsKICAgIAkJCWJyZWFrOwoKICAgIAkJY2FzZSBSZWluaGFyZFRvbmVNYXBwaW5nOgogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ1JlaW5oYXJkJzsKICAgIAkJCWJyZWFrOwoKICAgIAkJY2FzZSBDaW5lb25Ub25lTWFwcGluZzoKICAgIAkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDaW5lb24nOwogICAgCQkJYnJlYWs7CgogICAgCQljYXNlIEFDRVNGaWxtaWNUb25lTWFwcGluZzoKICAgIAkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBQ0VTRmlsbWljJzsKICAgIAkJCWJyZWFrOwoKICAgIAkJY2FzZSBBZ1hUb25lTWFwcGluZzoKICAgIAkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBZ1gnOwogICAgCQkJYnJlYWs7CgogICAgCQljYXNlIE5ldXRyYWxUb25lTWFwcGluZzoKICAgIAkJCXRvbmVNYXBwaW5nTmFtZSA9ICdOZXV0cmFsJzsKICAgIAkJCWJyZWFrOwoKICAgIAkJY2FzZSBDdXN0b21Ub25lTWFwcGluZzoKICAgIAkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDdXN0b20nOwogICAgCQkJYnJlYWs7CgogICAgCQlkZWZhdWx0OgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xQcm9ncmFtOiBVbnN1cHBvcnRlZCB0b25lTWFwcGluZzonLCB0b25lTWFwcGluZyApOwogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0xpbmVhcic7CgogICAgCX0KCiAgICAJcmV0dXJuICd2ZWMzICcgKyBmdW5jdGlvbk5hbWUgKyAnKCB2ZWMzIGNvbG9yICkgeyByZXR1cm4gJyArIHRvbmVNYXBwaW5nTmFtZSArICdUb25lTWFwcGluZyggY29sb3IgKTsgfSc7CgogICAgfQoKICAgIGNvbnN0IF92MCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBmdW5jdGlvbiBnZXRMdW1pbmFuY2VGdW5jdGlvbigpIHsKCiAgICAJQ29sb3JNYW5hZ2VtZW50LmdldEx1bWluYW5jZUNvZWZmaWNpZW50cyggX3YwICk7CgogICAgCWNvbnN0IHIgPSBfdjAueC50b0ZpeGVkKCA0ICk7CiAgICAJY29uc3QgZyA9IF92MC55LnRvRml4ZWQoIDQgKTsKICAgIAljb25zdCBiID0gX3YwLnoudG9GaXhlZCggNCApOwoKICAgIAlyZXR1cm4gWwoKICAgIAkJJ2Zsb2F0IGx1bWluYW5jZSggY29uc3QgaW4gdmVjMyByZ2IgKSB7JywKCiAgICAJCWAJY29uc3QgdmVjMyB3ZWlnaHRzID0gdmVjMyggJHsgciB9LCAkeyBnIH0sICR7IGIgfSApO2AsCgogICAgCQknCXJldHVybiBkb3QoIHdlaWdodHMsIHJnYiApOycsCgogICAgCQknfScKCiAgICAJXS5qb2luKCAnXG4nICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlVmVydGV4RXh0ZW5zaW9ucyggcGFyYW1ldGVycyApIHsKCiAgICAJY29uc3QgY2h1bmtzID0gWwogICAgCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2UgPyAnI2V4dGVuc2lvbiBHTF9BTkdMRV9jbGlwX2N1bGxfZGlzdGFuY2UgOiByZXF1aXJlJyA6ICcnLAogICAgCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbk11bHRpRHJhdyA/ICcjZXh0ZW5zaW9uIEdMX0FOR0xFX211bHRpX2RyYXcgOiByZXF1aXJlJyA6ICcnLAogICAgCV07CgogICAgCXJldHVybiBjaHVua3MuZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApIHsKCiAgICAJY29uc3QgY2h1bmtzID0gW107CgogICAgCWZvciAoIGNvbnN0IG5hbWUgaW4gZGVmaW5lcyApIHsKCiAgICAJCWNvbnN0IHZhbHVlID0gZGVmaW5lc1sgbmFtZSBdOwoKICAgIAkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCiAgICAJCWNodW5rcy5wdXNoKCAnI2RlZmluZSAnICsgbmFtZSArICcgJyArIHZhbHVlICk7CgogICAgCX0KCiAgICAJcmV0dXJuIGNodW5rcy5qb2luKCAnXG4nICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApIHsKCiAgICAJY29uc3QgYXR0cmlidXRlcyA9IHt9OwoKICAgIAljb25zdCBuID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuQUNUSVZFX0FUVFJJQlVURVMgKTsKCiAgICAJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgaSArKyApIHsKCiAgICAJCWNvbnN0IGluZm8gPSBnbC5nZXRBY3RpdmVBdHRyaWIoIHByb2dyYW0sIGkgKTsKICAgIAkJY29uc3QgbmFtZSA9IGluZm8ubmFtZTsKCiAgICAJCWxldCBsb2NhdGlvblNpemUgPSAxOwogICAgCQlpZiAoIGluZm8udHlwZSA9PT0gZ2wuRkxPQVRfTUFUMiApIGxvY2F0aW9uU2l6ZSA9IDI7CiAgICAJCWlmICggaW5mby50eXBlID09PSBnbC5GTE9BVF9NQVQzICkgbG9jYXRpb25TaXplID0gMzsKICAgIAkJaWYgKCBpbmZvLnR5cGUgPT09IGdsLkZMT0FUX01BVDQgKSBsb2NhdGlvblNpemUgPSA0OwoKICAgIAkJLy8gY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFByb2dyYW06IEFDVElWRSBWRVJURVggQVRUUklCVVRFOicsIG5hbWUsIGkgKTsKCiAgICAJCWF0dHJpYnV0ZXNbIG5hbWUgXSA9IHsKICAgIAkJCXR5cGU6IGluZm8udHlwZSwKICAgIAkJCWxvY2F0aW9uOiBnbC5nZXRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgbmFtZSApLAogICAgCQkJbG9jYXRpb25TaXplOiBsb2NhdGlvblNpemUKICAgIAkJfTsKCiAgICAJfQoKICAgIAlyZXR1cm4gYXR0cmlidXRlczsKCiAgICB9CgogICAgZnVuY3Rpb24gZmlsdGVyRW1wdHlMaW5lKCBzdHJpbmcgKSB7CgogICAgCXJldHVybiBzdHJpbmcgIT09ICcnOwoKICAgIH0KCiAgICBmdW5jdGlvbiByZXBsYWNlTGlnaHROdW1zKCBzdHJpbmcsIHBhcmFtZXRlcnMgKSB7CgogICAgCWNvbnN0IG51bVNwb3RMaWdodENvb3JkcyA9IHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cyArIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0TWFwcyAtIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOwoKICAgIAlyZXR1cm4gc3RyaW5nCiAgICAJCS5yZXBsYWNlKCAvTlVNX0RJUl9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodHMgKQogICAgCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodHMgKQogICAgCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICkKICAgIAkJLnJlcGxhY2UoIC9OVU1fU1BPVF9MSUdIVF9DT09SRFMvZywgbnVtU3BvdExpZ2h0Q29vcmRzICkKICAgIAkJLnJlcGxhY2UoIC9OVU1fUkVDVF9BUkVBX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVJlY3RBcmVhTGlnaHRzICkKICAgIAkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodHMgKQogICAgCQkucmVwbGFjZSggL05VTV9IRU1JX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bUhlbWlMaWdodHMgKQogICAgCQkucmVwbGFjZSggL05VTV9ESVJfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0U2hhZG93cyApCiAgICAJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XU19XSVRIX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKQogICAgCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzICkKICAgIAkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRTaGFkb3dzICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggc3RyaW5nLCBwYXJhbWV0ZXJzICkgewoKICAgIAlyZXR1cm4gc3RyaW5nCiAgICAJCS5yZXBsYWNlKCAvTlVNX0NMSVBQSU5HX1BMQU5FUy9nLCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICkKICAgIAkJLnJlcGxhY2UoIC9VTklPTl9DTElQUElOR19QTEFORVMvZywgKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzIC0gcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uICkgKTsKCiAgICB9CgogICAgLy8gUmVzb2x2ZSBJbmNsdWRlcwoKICAgIGNvbnN0IGluY2x1ZGVQYXR0ZXJuID0gL15bIFx0XSojaW5jbHVkZSArPChbXHdcZC4vXSspPi9nbTsKCiAgICBmdW5jdGlvbiByZXNvbHZlSW5jbHVkZXMoIHN0cmluZyApIHsKCiAgICAJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCBpbmNsdWRlUGF0dGVybiwgaW5jbHVkZVJlcGxhY2VyICk7CgogICAgfQoKICAgIGNvbnN0IHNoYWRlckNodW5rTWFwID0gbmV3IE1hcCgpOwoKICAgIGZ1bmN0aW9uIGluY2x1ZGVSZXBsYWNlciggbWF0Y2gsIGluY2x1ZGUgKSB7CgogICAgCWxldCBzdHJpbmcgPSBTaGFkZXJDaHVua1sgaW5jbHVkZSBdOwoKICAgIAlpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJY29uc3QgbmV3SW5jbHVkZSA9IHNoYWRlckNodW5rTWFwLmdldCggaW5jbHVkZSApOwoKICAgIAkJaWYgKCBuZXdJbmNsdWRlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJc3RyaW5nID0gU2hhZGVyQ2h1bmtbIG5ld0luY2x1ZGUgXTsKICAgIAkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFNoYWRlciBjaHVuayAiJXMiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAiJXMiIGluc3RlYWQuJywgaW5jbHVkZSwgbmV3SW5jbHVkZSApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdDYW4gbm90IHJlc29sdmUgI2luY2x1ZGUgPCcgKyBpbmNsdWRlICsgJz4nICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHJlc29sdmVJbmNsdWRlcyggc3RyaW5nICk7CgogICAgfQoKICAgIC8vIFVucm9sbCBMb29wcwoKICAgIGNvbnN0IHVucm9sbExvb3BQYXR0ZXJuID0gLyNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRccytmb3JccypcKFxzKmludFxzK2lccyo9XHMqKFxkKylccyo7XHMqaVxzKjxccyooXGQrKVxzKjtccyppXHMqXCtcK1xzKlwpXHMqeyhbXHNcU10rPyl9XHMrI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmQvZzsKCiAgICBmdW5jdGlvbiB1bnJvbGxMb29wcyggc3RyaW5nICkgewoKICAgIAlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHVucm9sbExvb3BQYXR0ZXJuLCBsb29wUmVwbGFjZXIgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gbG9vcFJlcGxhY2VyKCBtYXRjaCwgc3RhcnQsIGVuZCwgc25pcHBldCApIHsKCiAgICAJbGV0IHN0cmluZyA9ICcnOwoKICAgIAlmb3IgKCBsZXQgaSA9IHBhcnNlSW50KCBzdGFydCApOyBpIDwgcGFyc2VJbnQoIGVuZCApOyBpICsrICkgewoKICAgIAkJc3RyaW5nICs9IHNuaXBwZXQKICAgIAkJCS5yZXBsYWNlKCAvXFtccyppXHMqXF0vZywgJ1sgJyArIGkgKyAnIF0nICkKICAgIAkJCS5yZXBsYWNlKCAvVU5ST0xMRURfTE9PUF9JTkRFWC9nLCBpICk7CgogICAgCX0KCiAgICAJcmV0dXJuIHN0cmluZzsKCiAgICB9CgogICAgLy8KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApIHsKCiAgICAJbGV0IHByZWNpc2lvbnN0cmluZyA9IGBwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gZmxvYXQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaW50OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIyRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyQ3ViZTsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyM0Q7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEQXJyYXk7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEU2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXJDdWJlU2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIyREFycmF5U2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IGlzYW1wbGVyMkQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBpc2FtcGxlckN1YmU7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIyREFycmF5OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHVzYW1wbGVyMkQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSB1c2FtcGxlckN1YmU7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIyREFycmF5OwoJYDsKCiAgICAJaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2hpZ2hwJyApIHsKCiAgICAJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIEhJR0hfUFJFQ0lTSU9OJzsKCiAgICAJfSBlbHNlIGlmICggcGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICdtZWRpdW1wJyApIHsKCiAgICAJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIE1FRElVTV9QUkVDSVNJT04nOwoKICAgIAl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2xvd3AnICkgewoKICAgIAkJcHJlY2lzaW9uc3RyaW5nICs9ICdcbiNkZWZpbmUgTE9XX1BSRUNJU0lPTic7CgogICAgCX0KCiAgICAJcmV0dXJuIHByZWNpc2lvbnN0cmluZzsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVTaGFkb3dNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKICAgIAlsZXQgc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9CQVNJQyc7CgogICAgCWlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBQQ0ZTaGFkb3dNYXAgKSB7CgogICAgCQlzaGFkb3dNYXBUeXBlRGVmaW5lID0gJ1NIQURPV01BUF9UWVBFX1BDRic7CgogICAgCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gUENGU29mdFNoYWRvd01hcCApIHsKCiAgICAJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQnOwoKICAgIAl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCiAgICAJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfVlNNJzsKCiAgICAJfQoKICAgIAlyZXR1cm4gc2hhZG93TWFwVHlwZURlZmluZTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVFbnZNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKICAgIAlsZXQgZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCiAgICAJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCiAgICAJCXN3aXRjaCAoIHBhcmFtZXRlcnMuZW52TWFwTW9kZSApIHsKCiAgICAJCQljYXNlIEN1YmVSZWZsZWN0aW9uTWFwcGluZzoKICAgIAkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgogICAgCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRSc7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzoKICAgIAkJCQllbnZNYXBUeXBlRGVmaW5lID0gJ0VOVk1BUF9UWVBFX0NVQkVfVVYnOwogICAgCQkJCWJyZWFrOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiBlbnZNYXBUeXBlRGVmaW5lOwoKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgogICAgCWxldCBlbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRkxFQ1RJT04nOwoKICAgIAlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKICAgIAkJc3dpdGNoICggcGFyYW1ldGVycy5lbnZNYXBNb2RlICkgewoKICAgIAkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoKICAgIAkJCQllbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRlJBQ1RJT04nOwogICAgCQkJCWJyZWFrOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiBlbnZNYXBNb2RlRGVmaW5lOwoKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKICAgIAlsZXQgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX05PTkUnOwoKICAgIAlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKICAgIAkJc3dpdGNoICggcGFyYW1ldGVycy5jb21iaW5lICkgewoKICAgIAkJCWNhc2UgTXVsdGlwbHlPcGVyYXRpb246CiAgICAJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZJzsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlIE1peE9wZXJhdGlvbjoKICAgIAkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTUlYJzsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlIEFkZE9wZXJhdGlvbjoKICAgIAkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfQUREJzsKICAgIAkJCQlicmVhazsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gZW52TWFwQmxlbmRpbmdEZWZpbmU7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApIHsKCiAgICAJY29uc3QgaW1hZ2VIZWlnaHQgPSBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVVkhlaWdodDsKCiAgICAJaWYgKCBpbWFnZUhlaWdodCA9PT0gbnVsbCApIHJldHVybiBudWxsOwoKICAgIAljb25zdCBtYXhNaXAgPSBNYXRoLmxvZzIoIGltYWdlSGVpZ2h0ICkgLSAyOwoKICAgIAljb25zdCB0ZXhlbEhlaWdodCA9IDEuMCAvIGltYWdlSGVpZ2h0OwoKICAgIAljb25zdCB0ZXhlbFdpZHRoID0gMS4wIC8gKCAzICogTWF0aC5tYXgoIE1hdGgucG93KCAyLCBtYXhNaXAgKSwgNyAqIDE2ICkgKTsKCiAgICAJcmV0dXJuIHsgdGV4ZWxXaWR0aCwgdGV4ZWxIZWlnaHQsIG1heE1pcCB9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTFByb2dyYW0oIHJlbmRlcmVyLCBjYWNoZUtleSwgcGFyYW1ldGVycywgYmluZGluZ1N0YXRlcyApIHsKCiAgICAJLy8gVE9ETyBTZW5kIHRoaXMgZXZlbnQgdG8gVGhyZWUuanMgRGV2VG9vbHMKICAgIAkvLyBjb25zb2xlLmxvZyggJ1dlYkdMUHJvZ3JhbScsIGNhY2hlS2V5ICk7CgogICAgCWNvbnN0IGdsID0gcmVuZGVyZXIuZ2V0Q29udGV4dCgpOwoKICAgIAljb25zdCBkZWZpbmVzID0gcGFyYW1ldGVycy5kZWZpbmVzOwoKICAgIAlsZXQgdmVydGV4U2hhZGVyID0gcGFyYW1ldGVycy52ZXJ0ZXhTaGFkZXI7CiAgICAJbGV0IGZyYWdtZW50U2hhZGVyID0gcGFyYW1ldGVycy5mcmFnbWVudFNoYWRlcjsKCiAgICAJY29uc3Qgc2hhZG93TWFwVHlwZURlZmluZSA9IGdlbmVyYXRlU2hhZG93TWFwVHlwZURlZmluZSggcGFyYW1ldGVycyApOwogICAgCWNvbnN0IGVudk1hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKICAgIAljb25zdCBlbnZNYXBNb2RlRGVmaW5lID0gZ2VuZXJhdGVFbnZNYXBNb2RlRGVmaW5lKCBwYXJhbWV0ZXJzICk7CiAgICAJY29uc3QgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICk7CiAgICAJY29uc3QgZW52TWFwQ3ViZVVWU2l6ZSA9IGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApOwoKICAgIAljb25zdCBjdXN0b21WZXJ0ZXhFeHRlbnNpb25zID0gZ2VuZXJhdGVWZXJ0ZXhFeHRlbnNpb25zKCBwYXJhbWV0ZXJzICk7CgogICAgCWNvbnN0IGN1c3RvbURlZmluZXMgPSBnZW5lcmF0ZURlZmluZXMoIGRlZmluZXMgKTsKCiAgICAJY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTsKCiAgICAJbGV0IHByZWZpeFZlcnRleCwgcHJlZml4RnJhZ21lbnQ7CiAgICAJbGV0IHZlcnNpb25TdHJpbmcgPSBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID8gJyN2ZXJzaW9uICcgKyBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uICsgJ1xuJyA6ICcnOwoKICAgIAlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCiAgICAJCXByZWZpeFZlcnRleCA9IFsKCiAgICAJCQknI2RlZmluZSBTSEFERVJfVFlQRSAnICsgcGFyYW1ldGVycy5zaGFkZXJUeXBlLAogICAgCQkJJyNkZWZpbmUgU0hBREVSX05BTUUgJyArIHBhcmFtZXRlcnMuc2hhZGVyTmFtZSwKCiAgICAJCQljdXN0b21EZWZpbmVzCgogICAgCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKICAgIAkJaWYgKCBwcmVmaXhWZXJ0ZXgubGVuZ3RoID4gMCApIHsKCiAgICAJCQlwcmVmaXhWZXJ0ZXggKz0gJ1xuJzsKCiAgICAJCX0KCiAgICAJCXByZWZpeEZyYWdtZW50ID0gWwoKICAgIAkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCiAgICAJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKICAgIAkJCWN1c3RvbURlZmluZXMKCiAgICAJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgogICAgCQlpZiAoIHByZWZpeEZyYWdtZW50Lmxlbmd0aCA+IDAgKSB7CgogICAgCQkJcHJlZml4RnJhZ21lbnQgKz0gJ1xuJzsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCXByZWZpeFZlcnRleCA9IFsKCiAgICAJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKICAgIAkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCiAgICAJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKICAgIAkJCWN1c3RvbURlZmluZXMsCgogICAgCQkJcGFyYW1ldGVycy5leHRlbnNpb25DbGlwQ3VsbERpc3RhbmNlID8gJyNkZWZpbmUgVVNFX0NMSVBfRElTVEFOQ0UnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmJhdGNoaW5nID8gJyNkZWZpbmUgVVNFX0JBVENISU5HJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yID8gJyNkZWZpbmUgVVNFX0JBVENISU5HX0NPTE9SJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nID8gJyNkZWZpbmUgVVNFX0lOU1RBTkNJTkcnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9JTlNUQU5DSU5HX0NPTE9SJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nTW9ycGggPyAnI2RlZmluZSBVU0VfSU5TVEFOQ0lOR19NT1JQSCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyA/ICcjZGVmaW5lIFVTRV9GT0cnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLm1hcCA/ICcjZGVmaW5lIFVTRV9NQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lIFVTRV9FTlZNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBNb2RlRGVmaW5lIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYnVtcE1hcCA/ICcjZGVmaW5lIFVTRV9CVU1QTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBPYmplY3RTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0UnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFRhbmdlbnRTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXAgPyAnI2RlZmluZSBVU0VfRElTUExBQ0VNRU5UTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5lbWlzc2l2ZU1hcCA/ICcjZGVmaW5lIFVTRV9FTUlTU0lWRU1BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcCA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0NPTE9STUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfUk9VR0hORVNTTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfTUVUQUxORVNTTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04nIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcCA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT05NQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9USElDS05FU1NNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX0NPTE9STUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgogICAgCQkJLy8KCiAgICAJCQlwYXJhbWV0ZXJzLm1hcFV2ID8gJyNkZWZpbmUgTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmFscGhhTWFwVXYgPyAnI2RlZmluZSBBTFBIQU1BUF9VViAnICsgcGFyYW1ldGVycy5hbHBoYU1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwVXYgPyAnI2RlZmluZSBMSUdIVE1BUF9VViAnICsgcGFyYW1ldGVycy5saWdodE1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmFvTWFwVXYgPyAnI2RlZmluZSBBT01BUF9VViAnICsgcGFyYW1ldGVycy5hb01hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgPyAnI2RlZmluZSBFTUlTU0lWRU1BUF9VViAnICsgcGFyYW1ldGVycy5lbWlzc2l2ZU1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmJ1bXBNYXBVdiA/ICcjZGVmaW5lIEJVTVBNQVBfVVYgJyArIHBhcmFtZXRlcnMuYnVtcE1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2ID8gJyNkZWZpbmUgTk9STUFMTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ID8gJyNkZWZpbmUgRElTUExBQ0VNRU5UTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2IDogJycsCgogICAgCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA/ICcjZGVmaW5lIE1FVEFMTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIFJPVUdITkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2ID8gJyNkZWZpbmUgQU5JU09UUk9QWU1BUF9VViAnICsgcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUX05PUk1BTE1BUF9VViAnICsgcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXBVdiA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIENMRUFSQ09BVF9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRU1BUF9VViAnICsgcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRV9USElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2ID8gJyNkZWZpbmUgU0hFRU5fQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgPyAnI2RlZmluZSBTSEVFTl9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXBVdiA/ICcjZGVmaW5lIFNQRUNVTEFSTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ID8gJyNkZWZpbmUgU1BFQ1VMQVJfQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPyAnI2RlZmluZSBTUEVDVUxBUl9JTlRFTlNJVFlNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgPyAnI2RlZmluZSBUUkFOU01JU1NJT05NQVBfVVYgJyArIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBUSElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgOiAnJywKCiAgICAJCQkvLwoKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzID8gJyNkZWZpbmUgVVNFX0NPTE9SJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAnI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPyAnI2RlZmluZSBVU0VfVVYxJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjJzID8gJyNkZWZpbmUgVVNFX1VWMicgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4VXYzcyA/ICcjZGVmaW5lIFVTRV9VVjMnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5wb2ludHNVdnMgPyAnI2RlZmluZSBVU0VfUE9JTlRTX1VWJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnNraW5uaW5nID8gJyNkZWZpbmUgVVNFX1NLSU5OSU5HJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMubW9ycGhUYXJnZXRzID8gJyNkZWZpbmUgVVNFX01PUlBIVEFSR0VUUycgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICYmIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPT09IGZhbHNlID8gJyNkZWZpbmUgVVNFX01PUlBITk9STUFMUycgOiAnJywKICAgIAkJCSggcGFyYW1ldGVycy5tb3JwaENvbG9ycyApID8gJyNkZWZpbmUgVVNFX01PUlBIQ09MT1JTJyA6ICcnLAogICAgCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX1RFWFRVUkVfU1RSSURFICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGV4dHVyZVN0cmlkZSA6ICcnLAogICAgCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX0NPVU5UICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc2l6ZUF0dGVudWF0aW9uID8gJyNkZWZpbmUgVVNFX1NJWkVBVFRFTlVBVElPTicgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5yZXZlcnNlRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfUkVWRVJTRURFUFRIQlVGJyA6ICcnLAoKICAgIAkJCSd1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7JywKICAgIAkJCSd1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OycsCiAgICAJCQkndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7JywKICAgIAkJCSd1bmlmb3JtIG1hdDQgdmlld01hdHJpeDsnLAogICAgCQkJJ3VuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7JywKICAgIAkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKICAgIAkJCSd1bmlmb3JtIGJvb2wgaXNPcnRob2dyYXBoaWM7JywKCiAgICAJCQknI2lmZGVmIFVTRV9JTlNUQU5DSU5HJywKCiAgICAJCQknCWF0dHJpYnV0ZSBtYXQ0IGluc3RhbmNlTWF0cml4OycsCgogICAgCQkJJyNlbmRpZicsCgogICAgCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19DT0xPUicsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjMyBpbnN0YW5jZUNvbG9yOycsCgogICAgCQkJJyNlbmRpZicsCgogICAgCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSCcsCgogICAgCQkJJwl1bmlmb3JtIHNhbXBsZXIyRCBtb3JwaFRleHR1cmU7JywKCiAgICAJCQknI2VuZGlmJywKCiAgICAJCQknYXR0cmlidXRlIHZlYzMgcG9zaXRpb247JywKICAgIAkJCSdhdHRyaWJ1dGUgdmVjMyBub3JtYWw7JywKICAgIAkJCSdhdHRyaWJ1dGUgdmVjMiB1djsnLAoKICAgIAkJCScjaWZkZWYgVVNFX1VWMScsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjMiB1djE7JywKCiAgICAJCQknI2VuZGlmJywKCiAgICAJCQknI2lmZGVmIFVTRV9VVjInLAoKICAgIAkJCScJYXR0cmlidXRlIHZlYzIgdXYyOycsCgogICAgCQkJJyNlbmRpZicsCgogICAgCQkJJyNpZmRlZiBVU0VfVVYzJywKCiAgICAJCQknCWF0dHJpYnV0ZSB2ZWMyIHV2MzsnLAoKICAgIAkJCScjZW5kaWYnLAoKICAgIAkJCScjaWZkZWYgVVNFX1RBTkdFTlQnLAoKICAgIAkJCScJYXR0cmlidXRlIHZlYzQgdGFuZ2VudDsnLAoKICAgIAkJCScjZW5kaWYnLAoKICAgIAkJCScjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBICknLAoKICAgIAkJCScJYXR0cmlidXRlIHZlYzQgY29sb3I7JywKCiAgICAJCQknI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICknLAoKICAgIAkJCScJYXR0cmlidXRlIHZlYzMgY29sb3I7JywKCiAgICAJCQknI2VuZGlmJywKCiAgICAJCQknI2lmZGVmIFVTRV9TS0lOTklORycsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luSW5kZXg7JywKICAgIAkJCScJYXR0cmlidXRlIHZlYzQgc2tpbldlaWdodDsnLAoKICAgIAkJCScjZW5kaWYnLAoKICAgIAkJCSdcbicKCiAgICAJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgogICAgCQlwcmVmaXhGcmFnbWVudCA9IFsKCiAgICAJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKICAgIAkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCiAgICAJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKICAgIAkJCWN1c3RvbURlZmluZXMsCgogICAgCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2cgPyAnI2RlZmluZSBVU0VfRk9HJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2dFeHAyID8gJyNkZWZpbmUgRk9HX0VYUDInIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5hbHBoYVRvQ292ZXJhZ2UgPyAnI2RlZmluZSBBTFBIQV9UT19DT1ZFUkFHRScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubWF0Y2FwID8gJyNkZWZpbmUgVVNFX01BVENBUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcFR5cGVEZWZpbmUgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcE1vZGVEZWZpbmUgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcEJsZW5kaW5nRGVmaW5lIDogJycsCiAgICAJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX1RFWEVMX1dJRFRIICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsV2lkdGggOiAnJywKICAgIAkJCWVudk1hcEN1YmVVVlNpemUgPyAnI2RlZmluZSBDVUJFVVZfVEVYRUxfSEVJR0hUICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsSGVpZ2h0IDogJycsCiAgICAJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX01BWF9NSVAgJyArIGVudk1hcEN1YmVVVlNpemUubWF4TWlwICsgJy4wJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5saWdodE1hcCA/ICcjZGVmaW5lIFVTRV9MSUdIVE1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYW9NYXAgPyAnI2RlZmluZSBVU0VfQU9NQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX09CSkVDVFNQQUNFJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5ID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFknIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXAgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWU1BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVQnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmRpc3BlcnNpb24gPyAnI2RlZmluZSBVU0VfRElTUEVSU0lPTicgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRU1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfQ09MT1JNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYWxwaGFUZXN0ID8gJyNkZWZpbmUgVVNFX0FMUEhBVEVTVCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnNoZWVuID8gJyNkZWZpbmUgVVNFX1NIRUVOJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX0NPTE9STUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb24gPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXAgPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy50aGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzIHx8IHBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yIHx8IHBhcmFtZXRlcnMuYmF0Y2hpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9DT0xPUicgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4QWxwaGFzID8gJyNkZWZpbmUgVVNFX0NPTE9SX0FMUEhBJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjFzID8gJyNkZWZpbmUgVVNFX1VWMScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA/ICcjZGVmaW5lIFVTRV9VVjInIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnZlcnRleFV2M3MgPyAnI2RlZmluZSBVU0VfVVYzJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMucG9pbnRzVXZzID8gJyNkZWZpbmUgVVNFX1BPSU5UU19VVicgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmdyYWRpZW50TWFwID8gJyNkZWZpbmUgVVNFX0dSQURJRU5UTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhID8gJyNkZWZpbmUgUFJFTVVMVElQTElFRF9BTFBIQScgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmUgPyAnI2RlZmluZSBERUNPREVfVklERU9fVEVYVFVSRScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlRW1pc3NpdmUgPyAnI2RlZmluZSBERUNPREVfVklERU9fVEVYVFVSRV9FTUlTU0lWRScgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUYnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA/ICcjZGVmaW5lIFVTRV9SRVZFUlNFREVQVEhCVUYnIDogJycsCgogICAgCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCiAgICAJCQkndW5pZm9ybSB2ZWMzIGNhbWVyYVBvc2l0aW9uOycsCiAgICAJCQkndW5pZm9ybSBib29sIGlzT3J0aG9ncmFwaGljOycsCgogICAgCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyAnI2RlZmluZSBUT05FX01BUFBJTkcnIDogJycsCiAgICAJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/IFNoYWRlckNodW5rWyAndG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCcgXSA6ICcnLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHRvbmVNYXBwaW5nKCkgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwogICAgCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCAndG9uZU1hcHBpbmcnLCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICkgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmRpdGhlcmluZyA/ICcjZGVmaW5lIERJVEhFUklORycgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMub3BhcXVlID8gJyNkZWZpbmUgT1BBUVVFJyA6ICcnLAoKICAgIAkJCVNoYWRlckNodW5rWyAnY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50JyBdLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHZhcmlvdXMgZW5jb2RpbmcvZGVjb2RpbmcgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwogICAgCQkJZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCAnbGluZWFyVG9PdXRwdXRUZXhlbCcsIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApLAogICAgCQkJZ2V0THVtaW5hbmNlRnVuY3Rpb24oKSwKCiAgICAJCQlwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyA/ICcjZGVmaW5lIERFUFRIX1BBQ0tJTkcgJyArIHBhcmFtZXRlcnMuZGVwdGhQYWNraW5nIDogJycsCgogICAgCQkJJ1xuJwoKICAgIAkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCiAgICAJfQoKICAgIAl2ZXJ0ZXhTaGFkZXIgPSByZXNvbHZlSW5jbHVkZXMoIHZlcnRleFNoYWRlciApOwogICAgCXZlcnRleFNoYWRlciA9IHJlcGxhY2VMaWdodE51bXMoIHZlcnRleFNoYWRlciwgcGFyYW1ldGVycyApOwogICAgCXZlcnRleFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggdmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzICk7CgogICAgCWZyYWdtZW50U2hhZGVyID0gcmVzb2x2ZUluY2x1ZGVzKCBmcmFnbWVudFNoYWRlciApOwogICAgCWZyYWdtZW50U2hhZGVyID0gcmVwbGFjZUxpZ2h0TnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKICAgIAlmcmFnbWVudFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCiAgICAJdmVydGV4U2hhZGVyID0gdW5yb2xsTG9vcHMoIHZlcnRleFNoYWRlciApOwogICAgCWZyYWdtZW50U2hhZGVyID0gdW5yb2xsTG9vcHMoIGZyYWdtZW50U2hhZGVyICk7CgogICAgCWlmICggcGFyYW1ldGVycy5pc1Jhd1NoYWRlck1hdGVyaWFsICE9PSB0cnVlICkgewoKICAgIAkJLy8gR0xTTCAzLjAgY29udmVyc2lvbiBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzIGFuZCBTaGFkZXJNYXRlcmlhbAoKICAgIAkJdmVyc2lvblN0cmluZyA9ICcjdmVyc2lvbiAzMDAgZXNcbic7CgogICAgCQlwcmVmaXhWZXJ0ZXggPSBbCiAgICAJCQljdXN0b21WZXJ0ZXhFeHRlbnNpb25zLAogICAgCQkJJyNkZWZpbmUgYXR0cmlidXRlIGluJywKICAgIAkJCScjZGVmaW5lIHZhcnlpbmcgb3V0JywKICAgIAkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJwogICAgCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhWZXJ0ZXg7CgogICAgCQlwcmVmaXhGcmFnbWVudCA9IFsKICAgIAkJCScjZGVmaW5lIHZhcnlpbmcgaW4nLAogICAgCQkJKCBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID09PSBHTFNMMyApID8gJycgOiAnbGF5b3V0KGxvY2F0aW9uID0gMCkgb3V0IGhpZ2hwIHZlYzQgcGNfZnJhZ0NvbG9yOycsCiAgICAJCQkoIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPT09IEdMU0wzICkgPyAnJyA6ICcjZGVmaW5lIGdsX0ZyYWdDb2xvciBwY19mcmFnQ29sb3InLAogICAgCQkJJyNkZWZpbmUgZ2xfRnJhZ0RlcHRoRVhUIGdsX0ZyYWdEZXB0aCcsCiAgICAJCQknI2RlZmluZSB0ZXh0dXJlMkQgdGV4dHVyZScsCiAgICAJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZSB0ZXh0dXJlJywKICAgIAkJCScjZGVmaW5lIHRleHR1cmUyRFByb2ogdGV4dHVyZVByb2onLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZTJETG9kRVhUIHRleHR1cmVMb2QnLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvakxvZEVYVCB0ZXh0dXJlUHJvakxvZCcsCiAgICAJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZUxvZEVYVCB0ZXh0dXJlTG9kJywKICAgIAkJCScjZGVmaW5lIHRleHR1cmUyREdyYWRFWFQgdGV4dHVyZUdyYWQnLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvakdyYWRFWFQgdGV4dHVyZVByb2pHcmFkJywKICAgIAkJCScjZGVmaW5lIHRleHR1cmVDdWJlR3JhZEVYVCB0ZXh0dXJlR3JhZCcKICAgIAkJXS5qb2luKCAnXG4nICkgKyAnXG4nICsgcHJlZml4RnJhZ21lbnQ7CgogICAgCX0KCiAgICAJY29uc3QgdmVydGV4R2xzbCA9IHZlcnNpb25TdHJpbmcgKyBwcmVmaXhWZXJ0ZXggKyB2ZXJ0ZXhTaGFkZXI7CiAgICAJY29uc3QgZnJhZ21lbnRHbHNsID0gdmVyc2lvblN0cmluZyArIHByZWZpeEZyYWdtZW50ICsgZnJhZ21lbnRTaGFkZXI7CgogICAgCS8vIGNvbnNvbGUubG9nKCAnKlZFUlRFWConLCB2ZXJ0ZXhHbHNsICk7CiAgICAJLy8gY29uc29sZS5sb2coICcqRlJBR01FTlQqJywgZnJhZ21lbnRHbHNsICk7CgogICAgCWNvbnN0IGdsVmVydGV4U2hhZGVyID0gV2ViR0xTaGFkZXIoIGdsLCBnbC5WRVJURVhfU0hBREVSLCB2ZXJ0ZXhHbHNsICk7CiAgICAJY29uc3QgZ2xGcmFnbWVudFNoYWRlciA9IFdlYkdMU2hhZGVyKCBnbCwgZ2wuRlJBR01FTlRfU0hBREVSLCBmcmFnbWVudEdsc2wgKTsKCiAgICAJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwogICAgCWdsLmF0dGFjaFNoYWRlciggcHJvZ3JhbSwgZ2xGcmFnbWVudFNoYWRlciApOwoKICAgIAkvLyBGb3JjZSBhIHBhcnRpY3VsYXIgYXR0cmlidXRlIHRvIGluZGV4IDAuCgogICAgCWlmICggcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQlnbC5iaW5kQXR0cmliTG9jYXRpb24oIHByb2dyYW0sIDAsIHBhcmFtZXRlcnMuaW5kZXgwQXR0cmlidXRlTmFtZSApOwoKICAgIAl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyA9PT0gdHJ1ZSApIHsKCiAgICAJCS8vIHByb2dyYW1zIHdpdGggbW9ycGhUYXJnZXRzIGRpc3BsYWNlIHBvc2l0aW9uIG91dCBvZiBhdHRyaWJ1dGUgMAogICAgCQlnbC5iaW5kQXR0cmliTG9jYXRpb24oIHByb2dyYW0sIDAsICdwb3NpdGlvbicgKTsKCiAgICAJfQoKICAgIAlnbC5saW5rUHJvZ3JhbSggcHJvZ3JhbSApOwoKICAgIAlmdW5jdGlvbiBvbkZpcnN0VXNlKCBzZWxmICkgewoKICAgIAkJLy8gY2hlY2sgZm9yIGxpbmsgZXJyb3JzCiAgICAJCWlmICggcmVuZGVyZXIuZGVidWcuY2hlY2tTaGFkZXJFcnJvcnMgKSB7CgogICAgCQkJY29uc3QgcHJvZ3JhbUxvZyA9IGdsLmdldFByb2dyYW1JbmZvTG9nKCBwcm9ncmFtICkudHJpbSgpOwogICAgCQkJY29uc3QgdmVydGV4TG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggZ2xWZXJ0ZXhTaGFkZXIgKS50cmltKCk7CiAgICAJCQljb25zdCBmcmFnbWVudExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsRnJhZ21lbnRTaGFkZXIgKS50cmltKCk7CgogICAgCQkJbGV0IHJ1bm5hYmxlID0gdHJ1ZTsKICAgIAkJCWxldCBoYXZlRGlhZ25vc3RpY3MgPSB0cnVlOwoKICAgIAkJCWlmICggZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCXJ1bm5hYmxlID0gZmFsc2U7CgogICAgCQkJCWlmICggdHlwZW9mIHJlbmRlcmVyLmRlYnVnLm9uU2hhZGVyRXJyb3IgPT09ICdmdW5jdGlvbicgKSB7CgogICAgCQkJCQlyZW5kZXJlci5kZWJ1Zy5vblNoYWRlckVycm9yKCBnbCwgcHJvZ3JhbSwgZ2xWZXJ0ZXhTaGFkZXIsIGdsRnJhZ21lbnRTaGFkZXIgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCS8vIGRlZmF1bHQgZXJyb3IgcmVwb3J0aW5nCgogICAgCQkJCQljb25zdCB2ZXJ0ZXhFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbFZlcnRleFNoYWRlciwgJ3ZlcnRleCcgKTsKICAgIAkJCQkJY29uc3QgZnJhZ21lbnRFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbEZyYWdtZW50U2hhZGVyLCAnZnJhZ21lbnQnICk7CgogICAgCQkJCQljb25zb2xlLmVycm9yKAogICAgCQkJCQkJJ1RIUkVFLldlYkdMUHJvZ3JhbTogU2hhZGVyIEVycm9yICcgKyBnbC5nZXRFcnJvcigpICsgJyAtICcgKwogICAgCQkJCQkJJ1ZBTElEQVRFX1NUQVRVUyAnICsgZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuVkFMSURBVEVfU1RBVFVTICkgKyAnXG5cbicgKwogICAgCQkJCQkJJ01hdGVyaWFsIE5hbWU6ICcgKyBzZWxmLm5hbWUgKyAnXG4nICsKICAgIAkJCQkJCSdNYXRlcmlhbCBUeXBlOiAnICsgc2VsZi50eXBlICsgJ1xuXG4nICsKICAgIAkJCQkJCSdQcm9ncmFtIEluZm8gTG9nOiAnICsgcHJvZ3JhbUxvZyArICdcbicgKwogICAgCQkJCQkJdmVydGV4RXJyb3JzICsgJ1xuJyArCiAgICAJCQkJCQlmcmFnbWVudEVycm9ycwogICAgCQkJCQkpOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggcHJvZ3JhbUxvZyAhPT0gJycgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogUHJvZ3JhbSBJbmZvIExvZzonLCBwcm9ncmFtTG9nICk7CgogICAgCQkJfSBlbHNlIGlmICggdmVydGV4TG9nID09PSAnJyB8fCBmcmFnbWVudExvZyA9PT0gJycgKSB7CgogICAgCQkJCWhhdmVEaWFnbm9zdGljcyA9IGZhbHNlOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGhhdmVEaWFnbm9zdGljcyApIHsKCiAgICAJCQkJc2VsZi5kaWFnbm9zdGljcyA9IHsKCiAgICAJCQkJCXJ1bm5hYmxlOiBydW5uYWJsZSwKCiAgICAJCQkJCXByb2dyYW1Mb2c6IHByb2dyYW1Mb2csCgogICAgCQkJCQl2ZXJ0ZXhTaGFkZXI6IHsKCiAgICAJCQkJCQlsb2c6IHZlcnRleExvZywKICAgIAkJCQkJCXByZWZpeDogcHJlZml4VmVydGV4CgogICAgCQkJCQl9LAoKICAgIAkJCQkJZnJhZ21lbnRTaGFkZXI6IHsKCiAgICAJCQkJCQlsb2c6IGZyYWdtZW50TG9nLAogICAgCQkJCQkJcHJlZml4OiBwcmVmaXhGcmFnbWVudAoKICAgIAkJCQkJfQoKICAgIAkJCQl9OwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIENsZWFuIHVwCgogICAgCQkvLyBDcmFzaGVzIGluIGlPUzkgYW5kIGlPUzEwLiAjMTg0MDIKICAgIAkJLy8gZ2wuZGV0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwogICAgCQkvLyBnbC5kZXRhY2hTaGFkZXIoIHByb2dyYW0sIGdsRnJhZ21lbnRTaGFkZXIgKTsKCiAgICAJCWdsLmRlbGV0ZVNoYWRlciggZ2xWZXJ0ZXhTaGFkZXIgKTsKICAgIAkJZ2wuZGVsZXRlU2hhZGVyKCBnbEZyYWdtZW50U2hhZGVyICk7CgogICAgCQljYWNoZWRVbmlmb3JtcyA9IG5ldyBXZWJHTFVuaWZvcm1zKCBnbCwgcHJvZ3JhbSApOwogICAgCQljYWNoZWRBdHRyaWJ1dGVzID0gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoIGdsLCBwcm9ncmFtICk7CgogICAgCX0KCiAgICAJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIHVuaWZvcm0gbG9jYXRpb25zCgogICAgCWxldCBjYWNoZWRVbmlmb3JtczsKCiAgICAJdGhpcy5nZXRVbmlmb3JtcyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCWlmICggY2FjaGVkVW5pZm9ybXMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkvLyBQb3B1bGF0ZXMgY2FjaGVkVW5pZm9ybXMgYW5kIGNhY2hlZEF0dHJpYnV0ZXMKICAgIAkJCW9uRmlyc3RVc2UoIHRoaXMgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBjYWNoZWRVbmlmb3JtczsKCiAgICAJfTsKCiAgICAJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIGF0dHJpYnV0ZSBsb2NhdGlvbnMKCiAgICAJbGV0IGNhY2hlZEF0dHJpYnV0ZXM7CgogICAgCXRoaXMuZ2V0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCWlmICggY2FjaGVkQXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCS8vIFBvcHVsYXRlcyBjYWNoZWRBdHRyaWJ1dGVzIGFuZCBjYWNoZWRVbmlmb3JtcwogICAgCQkJb25GaXJzdFVzZSggdGhpcyApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGNhY2hlZEF0dHJpYnV0ZXM7CgogICAgCX07CgogICAgCS8vIGluZGljYXRlIHdoZW4gdGhlIHByb2dyYW0gaXMgcmVhZHkgdG8gYmUgdXNlZC4gaWYgdGhlIEtIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZSBleHRlbnNpb24gaXNuJ3Qgc3VwcG9ydGVkLAogICAgCS8vIGZsYWcgdGhlIHByb2dyYW0gYXMgcmVhZHkgaW1tZWRpYXRlbHkuIEl0IG1heSBjYXVzZSBhIHN0YWxsIHdoZW4gaXQncyBmaXJzdCB1c2VkLgoKICAgIAlsZXQgcHJvZ3JhbVJlYWR5ID0gKCBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uUGFyYWxsZWxTaGFkZXJDb21waWxlID09PSBmYWxzZSApOwoKICAgIAl0aGlzLmlzUmVhZHkgPSBmdW5jdGlvbiAoKSB7CgogICAgCQlpZiAoIHByb2dyYW1SZWFkeSA9PT0gZmFsc2UgKSB7CgogICAgCQkJcHJvZ3JhbVJlYWR5ID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgQ09NUExFVElPTl9TVEFUVVNfS0hSICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gcHJvZ3JhbVJlYWR5OwoKICAgIAl9OwoKICAgIAkvLyBmcmVlIHJlc291cmNlCgogICAgCXRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggdGhpcyApOwoKICAgIAkJZ2wuZGVsZXRlUHJvZ3JhbSggcHJvZ3JhbSApOwogICAgCQl0aGlzLnByb2dyYW0gPSB1bmRlZmluZWQ7CgogICAgCX07CgogICAgCS8vCgogICAgCXRoaXMudHlwZSA9IHBhcmFtZXRlcnMuc2hhZGVyVHlwZTsKICAgIAl0aGlzLm5hbWUgPSBwYXJhbWV0ZXJzLnNoYWRlck5hbWU7CiAgICAJdGhpcy5pZCA9IHByb2dyYW1JZENvdW50ICsrOwogICAgCXRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsKICAgIAl0aGlzLnVzZWRUaW1lcyA9IDE7CiAgICAJdGhpcy5wcm9ncmFtID0gcHJvZ3JhbTsKICAgIAl0aGlzLnZlcnRleFNoYWRlciA9IGdsVmVydGV4U2hhZGVyOwogICAgCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBnbEZyYWdtZW50U2hhZGVyOwoKICAgIAlyZXR1cm4gdGhpczsKCiAgICB9CgogICAgbGV0IF9pZCA9IDA7CgogICAgY2xhc3MgV2ViR0xTaGFkZXJDYWNoZSB7CgogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJdGhpcy5zaGFkZXJDYWNoZSA9IG5ldyBNYXAoKTsKICAgIAkJdGhpcy5tYXRlcmlhbENhY2hlID0gbmV3IE1hcCgpOwoKICAgIAl9CgogICAgCXVwZGF0ZSggbWF0ZXJpYWwgKSB7CgogICAgCQljb25zdCB2ZXJ0ZXhTaGFkZXIgPSBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXI7CiAgICAJCWNvbnN0IGZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgogICAgCQljb25zdCB2ZXJ0ZXhTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCB2ZXJ0ZXhTaGFkZXIgKTsKICAgIAkJY29uc3QgZnJhZ21lbnRTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCBmcmFnbWVudFNoYWRlciApOwoKICAgIAkJY29uc3QgbWF0ZXJpYWxTaGFkZXJzID0gdGhpcy5fZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCiAgICAJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggdmVydGV4U2hhZGVyU3RhZ2UgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJbWF0ZXJpYWxTaGFkZXJzLmFkZCggdmVydGV4U2hhZGVyU3RhZ2UgKTsKICAgIAkJCXZlcnRleFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggZnJhZ21lbnRTaGFkZXJTdGFnZSApID09PSBmYWxzZSApIHsKCiAgICAJCQltYXRlcmlhbFNoYWRlcnMuYWRkKCBmcmFnbWVudFNoYWRlclN0YWdlICk7CiAgICAJCQlmcmFnbWVudFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCXJlbW92ZSggbWF0ZXJpYWwgKSB7CgogICAgCQljb25zdCBtYXRlcmlhbFNoYWRlcnMgPSB0aGlzLm1hdGVyaWFsQ2FjaGUuZ2V0KCBtYXRlcmlhbCApOwoKICAgIAkJZm9yICggY29uc3Qgc2hhZGVyU3RhZ2Ugb2YgbWF0ZXJpYWxTaGFkZXJzICkgewoKICAgIAkJCXNoYWRlclN0YWdlLnVzZWRUaW1lcyAtLTsKCiAgICAJCQlpZiAoIHNoYWRlclN0YWdlLnVzZWRUaW1lcyA9PT0gMCApIHRoaXMuc2hhZGVyQ2FjaGUuZGVsZXRlKCBzaGFkZXJTdGFnZS5jb2RlICk7CgogICAgCQl9CgogICAgCQl0aGlzLm1hdGVyaWFsQ2FjaGUuZGVsZXRlKCBtYXRlcmlhbCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICkgewoKICAgIAkJcmV0dXJuIHRoaXMuX2dldFNoYWRlclN0YWdlKCBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXIgKS5pZDsKCiAgICAJfQoKICAgIAlnZXRGcmFnbWVudFNoYWRlcklEKCBtYXRlcmlhbCApIHsKCiAgICAJCXJldHVybiB0aGlzLl9nZXRTaGFkZXJTdGFnZSggbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXIgKS5pZDsKCiAgICAJfQoKICAgIAlkaXNwb3NlKCkgewoKICAgIAkJdGhpcy5zaGFkZXJDYWNoZS5jbGVhcigpOwogICAgCQl0aGlzLm1hdGVyaWFsQ2FjaGUuY2xlYXIoKTsKCiAgICAJfQoKICAgIAlfZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgogICAgCQljb25zdCBjYWNoZSA9IHRoaXMubWF0ZXJpYWxDYWNoZTsKICAgIAkJbGV0IHNldCA9IGNhY2hlLmdldCggbWF0ZXJpYWwgKTsKCiAgICAJCWlmICggc2V0ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJc2V0ID0gbmV3IFNldCgpOwogICAgCQkJY2FjaGUuc2V0KCBtYXRlcmlhbCwgc2V0ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gc2V0OwoKICAgIAl9CgogICAgCV9nZXRTaGFkZXJTdGFnZSggY29kZSApIHsKCiAgICAJCWNvbnN0IGNhY2hlID0gdGhpcy5zaGFkZXJDYWNoZTsKICAgIAkJbGV0IHN0YWdlID0gY2FjaGUuZ2V0KCBjb2RlICk7CgogICAgCQlpZiAoIHN0YWdlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJc3RhZ2UgPSBuZXcgV2ViR0xTaGFkZXJTdGFnZSggY29kZSApOwogICAgCQkJY2FjaGUuc2V0KCBjb2RlLCBzdGFnZSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHN0YWdlOwoKICAgIAl9CgogICAgfQoKICAgIGNsYXNzIFdlYkdMU2hhZGVyU3RhZ2UgewoKICAgIAljb25zdHJ1Y3RvciggY29kZSApIHsKCiAgICAJCXRoaXMuaWQgPSBfaWQgKys7CgogICAgCQl0aGlzLmNvZGUgPSBjb2RlOwogICAgCQl0aGlzLnVzZWRUaW1lcyA9IDA7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xQcm9ncmFtcyggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIGJpbmRpbmdTdGF0ZXMsIGNsaXBwaW5nICkgewoKICAgIAljb25zdCBfcHJvZ3JhbUxheWVycyA9IG5ldyBMYXllcnMoKTsKICAgIAljb25zdCBfY3VzdG9tU2hhZGVycyA9IG5ldyBXZWJHTFNoYWRlckNhY2hlKCk7CiAgICAJY29uc3QgX2FjdGl2ZUNoYW5uZWxzID0gbmV3IFNldCgpOwogICAgCWNvbnN0IHByb2dyYW1zID0gW107CgogICAgCWNvbnN0IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPSBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjsKICAgIAljb25zdCBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMgPSBjYXBhYmlsaXRpZXMudmVydGV4VGV4dHVyZXM7CgogICAgCWxldCBwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMucHJlY2lzaW9uOwoKICAgIAljb25zdCBzaGFkZXJJRHMgPSB7CiAgICAJCU1lc2hEZXB0aE1hdGVyaWFsOiAnZGVwdGgnLAogICAgCQlNZXNoRGlzdGFuY2VNYXRlcmlhbDogJ2Rpc3RhbmNlUkdCQScsCiAgICAJCU1lc2hOb3JtYWxNYXRlcmlhbDogJ25vcm1hbCcsCiAgICAJCU1lc2hCYXNpY01hdGVyaWFsOiAnYmFzaWMnLAogICAgCQlNZXNoTGFtYmVydE1hdGVyaWFsOiAnbGFtYmVydCcsCiAgICAJCU1lc2hQaG9uZ01hdGVyaWFsOiAncGhvbmcnLAogICAgCQlNZXNoVG9vbk1hdGVyaWFsOiAndG9vbicsCiAgICAJCU1lc2hTdGFuZGFyZE1hdGVyaWFsOiAncGh5c2ljYWwnLAogICAgCQlNZXNoUGh5c2ljYWxNYXRlcmlhbDogJ3BoeXNpY2FsJywKICAgIAkJTWVzaE1hdGNhcE1hdGVyaWFsOiAnbWF0Y2FwJywKICAgIAkJTGluZUJhc2ljTWF0ZXJpYWw6ICdiYXNpYycsCiAgICAJCUxpbmVEYXNoZWRNYXRlcmlhbDogJ2Rhc2hlZCcsCiAgICAJCVBvaW50c01hdGVyaWFsOiAncG9pbnRzJywKICAgIAkJU2hhZG93TWF0ZXJpYWw6ICdzaGFkb3cnLAogICAgCQlTcHJpdGVNYXRlcmlhbDogJ3Nwcml0ZScKICAgIAl9OwoKICAgIAlmdW5jdGlvbiBnZXRDaGFubmVsKCB2YWx1ZSApIHsKCiAgICAJCV9hY3RpdmVDaGFubmVscy5hZGQoIHZhbHVlICk7CgogICAgCQlpZiAoIHZhbHVlID09PSAwICkgcmV0dXJuICd1dic7CgogICAgCQlyZXR1cm4gYHV2JHsgdmFsdWUgfWA7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0UGFyYW1ldGVycyggbWF0ZXJpYWwsIGxpZ2h0cywgc2hhZG93cywgc2NlbmUsIG9iamVjdCApIHsKCiAgICAJCWNvbnN0IGZvZyA9IHNjZW5lLmZvZzsKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CiAgICAJCWNvbnN0IGVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKCiAgICAJCWNvbnN0IGVudk1hcCA9ICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggbWF0ZXJpYWwuZW52TWFwIHx8IGVudmlyb25tZW50ICk7CiAgICAJCWNvbnN0IGVudk1hcEN1YmVVVkhlaWdodCA9ICggISEgZW52TWFwICkgJiYgKCBlbnZNYXAubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSA/IGVudk1hcC5pbWFnZS5oZWlnaHQgOiBudWxsOwoKICAgIAkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKCiAgICAJCS8vIGhldXJpc3RpY3MgdG8gY3JlYXRlIHNoYWRlciBwYXJhbWV0ZXJzIGFjY29yZGluZyB0byBsaWdodHMgaW4gdGhlIHNjZW5lCiAgICAJCS8vIChub3QgdG8gYmxvdyBvdmVyIG1heExpZ2h0cyBidWRnZXQpCgogICAgCQlpZiAoIG1hdGVyaWFsLnByZWNpc2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQlwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMuZ2V0TWF4UHJlY2lzaW9uKCBtYXRlcmlhbC5wcmVjaXNpb24gKTsKCiAgICAJCQlpZiAoIHByZWNpc2lvbiAhPT0gbWF0ZXJpYWwucHJlY2lzaW9uICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW0uZ2V0UGFyYW1ldGVyczonLCBtYXRlcmlhbC5wcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIHByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvcjsKICAgIAkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgogICAgCQlsZXQgbW9ycGhUZXh0dXJlU3RyaWRlID0gMDsKCiAgICAJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAxOwogICAgCQlpZiAoIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDI7CiAgICAJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAzOwoKICAgIAkJLy8KCiAgICAJCWxldCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyOwogICAgCQlsZXQgY3VzdG9tVmVydGV4U2hhZGVySUQsIGN1c3RvbUZyYWdtZW50U2hhZGVySUQ7CgogICAgCQlpZiAoIHNoYWRlcklEICkgewoKICAgIAkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKCiAgICAJCQl2ZXJ0ZXhTaGFkZXIgPSBzaGFkZXIudmVydGV4U2hhZGVyOwogICAgCQkJZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXI7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXZlcnRleFNoYWRlciA9IG1hdGVyaWFsLnZlcnRleFNoYWRlcjsKICAgIAkJCWZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgogICAgCQkJX2N1c3RvbVNoYWRlcnMudXBkYXRlKCBtYXRlcmlhbCApOwoKICAgIAkJCWN1c3RvbVZlcnRleFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICk7CiAgICAJCQljdXN0b21GcmFnbWVudFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0RnJhZ21lbnRTaGFkZXJJRCggbWF0ZXJpYWwgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKICAgIAkJY29uc3QgcmV2ZXJzZURlcHRoQnVmZmVyID0gcmVuZGVyZXIuc3RhdGUuYnVmZmVycy5kZXB0aC5nZXRSZXZlcnNlZCgpOwoKICAgIAkJY29uc3QgSVNfSU5TVEFOQ0VETUVTSCA9IG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWU7CiAgICAJCWNvbnN0IElTX0JBVENIRURNRVNIID0gb2JqZWN0LmlzQmF0Y2hlZE1lc2ggPT09IHRydWU7CgogICAgCQljb25zdCBIQVNfTUFQID0gISEgbWF0ZXJpYWwubWFwOwogICAgCQljb25zdCBIQVNfTUFUQ0FQID0gISEgbWF0ZXJpYWwubWF0Y2FwOwogICAgCQljb25zdCBIQVNfRU5WTUFQID0gISEgZW52TWFwOwogICAgCQljb25zdCBIQVNfQU9NQVAgPSAhISBtYXRlcmlhbC5hb01hcDsKICAgIAkJY29uc3QgSEFTX0xJR0hUTUFQID0gISEgbWF0ZXJpYWwubGlnaHRNYXA7CiAgICAJCWNvbnN0IEhBU19CVU1QTUFQID0gISEgbWF0ZXJpYWwuYnVtcE1hcDsKICAgIAkJY29uc3QgSEFTX05PUk1BTE1BUCA9ICEhIG1hdGVyaWFsLm5vcm1hbE1hcDsKICAgIAkJY29uc3QgSEFTX0RJU1BMQUNFTUVOVE1BUCA9ICEhIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKICAgIAkJY29uc3QgSEFTX0VNSVNTSVZFTUFQID0gISEgbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgogICAgCQljb25zdCBIQVNfTUVUQUxORVNTTUFQID0gISEgbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwogICAgCQljb25zdCBIQVNfUk9VR0hORVNTTUFQID0gISEgbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKICAgIAkJY29uc3QgSEFTX0FOSVNPVFJPUFkgPSBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMDsKICAgIAkJY29uc3QgSEFTX0NMRUFSQ09BVCA9IG1hdGVyaWFsLmNsZWFyY29hdCA+IDA7CiAgICAJCWNvbnN0IEhBU19ESVNQRVJTSU9OID0gbWF0ZXJpYWwuZGlzcGVyc2lvbiA+IDA7CiAgICAJCWNvbnN0IEhBU19JUklERVNDRU5DRSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMDsKICAgIAkJY29uc3QgSEFTX1NIRUVOID0gbWF0ZXJpYWwuc2hlZW4gPiAwOwogICAgCQljb25zdCBIQVNfVFJBTlNNSVNTSU9OID0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMDsKCiAgICAJCWNvbnN0IEhBU19BTklTT1RST1BZTUFQID0gSEFTX0FOSVNPVFJPUFkgJiYgISEgbWF0ZXJpYWwuYW5pc290cm9weU1hcDsKCiAgICAJCWNvbnN0IEhBU19DTEVBUkNPQVRNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdE1hcDsKICAgIAkJY29uc3QgSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKICAgIAkJY29uc3QgSEFTX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCiAgICAJCWNvbnN0IEhBU19JUklERVNDRU5DRU1BUCA9IEhBU19JUklERVNDRU5DRSAmJiAhISBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcDsKICAgIAkJY29uc3QgSEFTX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCA9IEhBU19JUklERVNDRU5DRSAmJiAhISBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcDsKCiAgICAJCWNvbnN0IEhBU19TSEVFTl9DT0xPUk1BUCA9IEhBU19TSEVFTiAmJiAhISBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwogICAgCQljb25zdCBIQVNfU0hFRU5fUk9VR0hORVNTTUFQID0gSEFTX1NIRUVOICYmICEhIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKICAgIAkJY29uc3QgSEFTX1NQRUNVTEFSTUFQID0gISEgbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CiAgICAJCWNvbnN0IEhBU19TUEVDVUxBUl9DT0xPUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXA7CiAgICAJCWNvbnN0IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAgPSAhISBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcDsKCiAgICAJCWNvbnN0IEhBU19UUkFOU01JU1NJT05NQVAgPSBIQVNfVFJBTlNNSVNTSU9OICYmICEhIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKICAgIAkJY29uc3QgSEFTX1RISUNLTkVTU01BUCA9IEhBU19UUkFOU01JU1NJT04gJiYgISEgbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKICAgIAkJY29uc3QgSEFTX0dSQURJRU5UTUFQID0gISEgbWF0ZXJpYWwuZ3JhZGllbnRNYXA7CgogICAgCQljb25zdCBIQVNfQUxQSEFNQVAgPSAhISBtYXRlcmlhbC5hbHBoYU1hcDsKCiAgICAJCWNvbnN0IEhBU19BTFBIQVRFU1QgPSBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwOwoKICAgIAkJY29uc3QgSEFTX0FMUEhBSEFTSCA9ICEhIG1hdGVyaWFsLmFscGhhSGFzaDsKCiAgICAJCWNvbnN0IEhBU19FWFRFTlNJT05TID0gISEgbWF0ZXJpYWwuZXh0ZW5zaW9uczsKCiAgICAJCWxldCB0b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgogICAgCQlpZiAoIG1hdGVyaWFsLnRvbmVNYXBwZWQgKSB7CgogICAgCQkJaWYgKCBjdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IGN1cnJlbnRSZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJdG9uZU1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljb25zdCBwYXJhbWV0ZXJzID0gewoKICAgIAkJCXNoYWRlcklEOiBzaGFkZXJJRCwKICAgIAkJCXNoYWRlclR5cGU6IG1hdGVyaWFsLnR5cGUsCiAgICAJCQlzaGFkZXJOYW1lOiBtYXRlcmlhbC5uYW1lLAoKICAgIAkJCXZlcnRleFNoYWRlcjogdmVydGV4U2hhZGVyLAogICAgCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50U2hhZGVyLAogICAgCQkJZGVmaW5lczogbWF0ZXJpYWwuZGVmaW5lcywKCiAgICAJCQljdXN0b21WZXJ0ZXhTaGFkZXJJRDogY3VzdG9tVmVydGV4U2hhZGVySUQsCiAgICAJCQljdXN0b21GcmFnbWVudFNoYWRlcklEOiBjdXN0b21GcmFnbWVudFNoYWRlcklELAoKICAgIAkJCWlzUmF3U2hhZGVyTWF0ZXJpYWw6IG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgPT09IHRydWUsCiAgICAJCQlnbHNsVmVyc2lvbjogbWF0ZXJpYWwuZ2xzbFZlcnNpb24sCgogICAgCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgogICAgCQkJYmF0Y2hpbmc6IElTX0JBVENIRURNRVNILAogICAgCQkJYmF0Y2hpbmdDb2xvcjogSVNfQkFUQ0hFRE1FU0ggJiYgb2JqZWN0Ll9jb2xvcnNUZXh0dXJlICE9PSBudWxsLAogICAgCQkJaW5zdGFuY2luZzogSVNfSU5TVEFOQ0VETUVTSCwKICAgIAkJCWluc3RhbmNpbmdDb2xvcjogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCwKICAgIAkJCWluc3RhbmNpbmdNb3JwaDogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QubW9ycGhUZXh0dXJlICE9PSBudWxsLAoKICAgIAkJCXN1cHBvcnRzVmVydGV4VGV4dHVyZXM6IFNVUFBPUlRTX1ZFUlRFWF9URVhUVVJFUywKICAgIAkJCW91dHB1dENvbG9yU3BhY2U6ICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApID8gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSA6ICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlID8gY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApLAogICAgCQkJYWxwaGFUb0NvdmVyYWdlOiAhISBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UsCgogICAgCQkJbWFwOiBIQVNfTUFQLAogICAgCQkJbWF0Y2FwOiBIQVNfTUFUQ0FQLAogICAgCQkJZW52TWFwOiBIQVNfRU5WTUFQLAogICAgCQkJZW52TWFwTW9kZTogSEFTX0VOVk1BUCAmJiBlbnZNYXAubWFwcGluZywKICAgIAkJCWVudk1hcEN1YmVVVkhlaWdodDogZW52TWFwQ3ViZVVWSGVpZ2h0LAogICAgCQkJYW9NYXA6IEhBU19BT01BUCwKICAgIAkJCWxpZ2h0TWFwOiBIQVNfTElHSFRNQVAsCiAgICAJCQlidW1wTWFwOiBIQVNfQlVNUE1BUCwKICAgIAkJCW5vcm1hbE1hcDogSEFTX05PUk1BTE1BUCwKICAgIAkJCWRpc3BsYWNlbWVudE1hcDogU1VQUE9SVFNfVkVSVEVYX1RFWFRVUkVTICYmIEhBU19ESVNQTEFDRU1FTlRNQVAsCiAgICAJCQllbWlzc2l2ZU1hcDogSEFTX0VNSVNTSVZFTUFQLAoKICAgIAkJCW5vcm1hbE1hcE9iamVjdFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IE9iamVjdFNwYWNlTm9ybWFsTWFwLAogICAgCQkJbm9ybWFsTWFwVGFuZ2VudFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCwKCiAgICAJCQltZXRhbG5lc3NNYXA6IEhBU19NRVRBTE5FU1NNQVAsCiAgICAJCQlyb3VnaG5lc3NNYXA6IEhBU19ST1VHSE5FU1NNQVAsCgogICAgCQkJYW5pc290cm9weTogSEFTX0FOSVNPVFJPUFksCiAgICAJCQlhbmlzb3Ryb3B5TWFwOiBIQVNfQU5JU09UUk9QWU1BUCwKCiAgICAJCQljbGVhcmNvYXQ6IEhBU19DTEVBUkNPQVQsCiAgICAJCQljbGVhcmNvYXRNYXA6IEhBU19DTEVBUkNPQVRNQVAsCiAgICAJCQljbGVhcmNvYXROb3JtYWxNYXA6IEhBU19DTEVBUkNPQVRfTk9STUFMTUFQLAogICAgCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwOiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCwKCiAgICAJCQlkaXNwZXJzaW9uOiBIQVNfRElTUEVSU0lPTiwKCiAgICAJCQlpcmlkZXNjZW5jZTogSEFTX0lSSURFU0NFTkNFLAogICAgCQkJaXJpZGVzY2VuY2VNYXA6IEhBU19JUklERVNDRU5DRU1BUCwKICAgIAkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQLAoKICAgIAkJCXNoZWVuOiBIQVNfU0hFRU4sCiAgICAJCQlzaGVlbkNvbG9yTWFwOiBIQVNfU0hFRU5fQ09MT1JNQVAsCiAgICAJCQlzaGVlblJvdWdobmVzc01hcDogSEFTX1NIRUVOX1JPVUdITkVTU01BUCwKCiAgICAJCQlzcGVjdWxhck1hcDogSEFTX1NQRUNVTEFSTUFQLAogICAgCQkJc3BlY3VsYXJDb2xvck1hcDogSEFTX1NQRUNVTEFSX0NPTE9STUFQLAogICAgCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXA6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAsCgogICAgCQkJdHJhbnNtaXNzaW9uOiBIQVNfVFJBTlNNSVNTSU9OLAogICAgCQkJdHJhbnNtaXNzaW9uTWFwOiBIQVNfVFJBTlNNSVNTSU9OTUFQLAogICAgCQkJdGhpY2tuZXNzTWFwOiBIQVNfVEhJQ0tORVNTTUFQLAoKICAgIAkJCWdyYWRpZW50TWFwOiBIQVNfR1JBRElFTlRNQVAsCgogICAgCQkJb3BhcXVlOiBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gZmFsc2UgJiYgbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gZmFsc2UsCgogICAgCQkJYWxwaGFNYXA6IEhBU19BTFBIQU1BUCwKICAgIAkJCWFscGhhVGVzdDogSEFTX0FMUEhBVEVTVCwKICAgIAkJCWFscGhhSGFzaDogSEFTX0FMUEhBSEFTSCwKCiAgICAJCQljb21iaW5lOiBtYXRlcmlhbC5jb21iaW5lLAoKICAgIAkJCS8vCgogICAgCQkJbWFwVXY6IEhBU19NQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubWFwLmNoYW5uZWwgKSwKICAgIAkJCWFvTWFwVXY6IEhBU19BT01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5hb01hcC5jaGFubmVsICksCiAgICAJCQlsaWdodE1hcFV2OiBIQVNfTElHSFRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubGlnaHRNYXAuY2hhbm5lbCApLAogICAgCQkJYnVtcE1hcFV2OiBIQVNfQlVNUE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5idW1wTWFwLmNoYW5uZWwgKSwKICAgIAkJCW5vcm1hbE1hcFV2OiBIQVNfTk9STUFMTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLm5vcm1hbE1hcC5jaGFubmVsICksCiAgICAJCQlkaXNwbGFjZW1lbnRNYXBVdjogSEFTX0RJU1BMQUNFTUVOVE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAuY2hhbm5lbCApLAogICAgCQkJZW1pc3NpdmVNYXBVdjogSEFTX0VNSVNTSVZFTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmNoYW5uZWwgKSwKCiAgICAJCQltZXRhbG5lc3NNYXBVdjogSEFTX01FVEFMTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAuY2hhbm5lbCApLAogICAgCQkJcm91Z2huZXNzTWFwVXY6IEhBU19ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwucm91Z2huZXNzTWFwLmNoYW5uZWwgKSwKCiAgICAJCQlhbmlzb3Ryb3B5TWFwVXY6IEhBU19BTklTT1RST1BZTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAuY2hhbm5lbCApLAoKICAgIAkJCWNsZWFyY29hdE1hcFV2OiBIQVNfQ0xFQVJDT0FUTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmNsZWFyY29hdE1hcC5jaGFubmVsICksCiAgICAJCQljbGVhcmNvYXROb3JtYWxNYXBVdjogSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwLmNoYW5uZWwgKSwKICAgIAkJCWNsZWFyY29hdFJvdWdobmVzc01hcFV2OiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKICAgIAkJCWlyaWRlc2NlbmNlTWFwVXY6IEhBU19JUklERVNDRU5DRU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcC5jaGFubmVsICksCiAgICAJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2OiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLmNoYW5uZWwgKSwKCiAgICAJCQlzaGVlbkNvbG9yTWFwVXY6IEhBU19TSEVFTl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwLmNoYW5uZWwgKSwKICAgIAkJCXNoZWVuUm91Z2huZXNzTWFwVXY6IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKICAgIAkJCXNwZWN1bGFyTWFwVXY6IEhBU19TUEVDVUxBUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhck1hcC5jaGFubmVsICksCiAgICAJCQlzcGVjdWxhckNvbG9yTWFwVXY6IEhBU19TUEVDVUxBUl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLmNoYW5uZWwgKSwKICAgIAkJCXNwZWN1bGFySW50ZW5zaXR5TWFwVXY6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAuY2hhbm5lbCApLAoKICAgIAkJCXRyYW5zbWlzc2lvbk1hcFV2OiBIQVNfVFJBTlNNSVNTSU9OTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcC5jaGFubmVsICksCiAgICAJCQl0aGlja25lc3NNYXBVdjogSEFTX1RISUNLTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC50aGlja25lc3NNYXAuY2hhbm5lbCApLAoKICAgIAkJCWFscGhhTWFwVXY6IEhBU19BTFBIQU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5hbHBoYU1hcC5jaGFubmVsICksCgogICAgCQkJLy8KCiAgICAJCQl2ZXJ0ZXhUYW5nZW50czogISEgZ2VvbWV0cnkuYXR0cmlidXRlcy50YW5nZW50ICYmICggSEFTX05PUk1BTE1BUCB8fCBIQVNfQU5JU09UUk9QWSApLAogICAgCQkJdmVydGV4Q29sb3JzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMsCiAgICAJCQl2ZXJ0ZXhBbHBoYXM6IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQsCgogICAgCQkJcG9pbnRzVXZzOiBvYmplY3QuaXNQb2ludHMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy51diAmJiAoIEhBU19NQVAgfHwgSEFTX0FMUEhBTUFQICksCgogICAgCQkJZm9nOiAhISBmb2csCiAgICAJCQl1c2VGb2c6IG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSwKICAgIAkJCWZvZ0V4cDI6ICggISEgZm9nICYmIGZvZy5pc0ZvZ0V4cDIgKSwKCiAgICAJCQlmbGF0U2hhZGluZzogKCBtYXRlcmlhbC5mbGF0U2hhZGluZyA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC53aXJlZnJhbWUgPT09IGZhbHNlICksCgogICAgCQkJc2l6ZUF0dGVudWF0aW9uOiBtYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPT09IHRydWUsCiAgICAJCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAogICAgCQkJcmV2ZXJzZURlcHRoQnVmZmVyOiByZXZlcnNlRGVwdGhCdWZmZXIsCgogICAgCQkJc2tpbm5pbmc6IG9iamVjdC5pc1NraW5uZWRNZXNoID09PSB0cnVlLAoKICAgIAkJCW1vcnBoVGFyZ2V0czogZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQsCiAgICAJCQltb3JwaE5vcm1hbHM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCwKICAgIAkJCW1vcnBoQ29sb3JzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCwKICAgIAkJCW1vcnBoVGFyZ2V0c0NvdW50OiBtb3JwaFRhcmdldHNDb3VudCwKICAgIAkJCW1vcnBoVGV4dHVyZVN0cmlkZTogbW9ycGhUZXh0dXJlU3RyaWRlLAoKICAgIAkJCW51bURpckxpZ2h0czogbGlnaHRzLmRpcmVjdGlvbmFsLmxlbmd0aCwKICAgIAkJCW51bVBvaW50TGlnaHRzOiBsaWdodHMucG9pbnQubGVuZ3RoLAogICAgCQkJbnVtU3BvdExpZ2h0czogbGlnaHRzLnNwb3QubGVuZ3RoLAogICAgCQkJbnVtU3BvdExpZ2h0TWFwczogbGlnaHRzLnNwb3RMaWdodE1hcC5sZW5ndGgsCiAgICAJCQludW1SZWN0QXJlYUxpZ2h0czogbGlnaHRzLnJlY3RBcmVhLmxlbmd0aCwKICAgIAkJCW51bUhlbWlMaWdodHM6IGxpZ2h0cy5oZW1pLmxlbmd0aCwKCiAgICAJCQludW1EaXJMaWdodFNoYWRvd3M6IGxpZ2h0cy5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGgsCiAgICAJCQludW1Qb2ludExpZ2h0U2hhZG93czogbGlnaHRzLnBvaW50U2hhZG93TWFwLmxlbmd0aCwKICAgIAkJCW51bVNwb3RMaWdodFNoYWRvd3M6IGxpZ2h0cy5zcG90U2hhZG93TWFwLmxlbmd0aCwKICAgIAkJCW51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwczogbGlnaHRzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcywKCiAgICAJCQludW1MaWdodFByb2JlczogbGlnaHRzLm51bUxpZ2h0UHJvYmVzLAoKICAgIAkJCW51bUNsaXBwaW5nUGxhbmVzOiBjbGlwcGluZy5udW1QbGFuZXMsCiAgICAJCQludW1DbGlwSW50ZXJzZWN0aW9uOiBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24sCgogICAgCQkJZGl0aGVyaW5nOiBtYXRlcmlhbC5kaXRoZXJpbmcsCgogICAgCQkJc2hhZG93TWFwRW5hYmxlZDogcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgJiYgc2hhZG93cy5sZW5ndGggPiAwLAogICAgCQkJc2hhZG93TWFwVHlwZTogcmVuZGVyZXIuc2hhZG93TWFwLnR5cGUsCgogICAgCQkJdG9uZU1hcHBpbmc6IHRvbmVNYXBwaW5nLAoKICAgIAkJCWRlY29kZVZpZGVvVGV4dHVyZTogSEFTX01BUCAmJiAoIG1hdGVyaWFsLm1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5tYXAuY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSwKICAgIAkJCWRlY29kZVZpZGVvVGV4dHVyZUVtaXNzaXZlOiBIQVNfRU1JU1NJVkVNQVAgJiYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcC5jb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApLAoKICAgIAkJCXByZW11bHRpcGxpZWRBbHBoYTogbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhLAoKICAgIAkJCWRvdWJsZVNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlLAogICAgCQkJZmxpcFNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSwKCiAgICAJCQl1c2VEZXB0aFBhY2tpbmc6IG1hdGVyaWFsLmRlcHRoUGFja2luZyA+PSAwLAogICAgCQkJZGVwdGhQYWNraW5nOiBtYXRlcmlhbC5kZXB0aFBhY2tpbmcgfHwgMCwKCiAgICAJCQlpbmRleDBBdHRyaWJ1dGVOYW1lOiBtYXRlcmlhbC5pbmRleDBBdHRyaWJ1dGVOYW1lLAoKICAgIAkJCWV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2U6IEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuY2xpcEN1bGxEaXN0YW5jZSA9PT0gdHJ1ZSAmJiBleHRlbnNpb25zLmhhcyggJ1dFQkdMX2NsaXBfY3VsbF9kaXN0YW5jZScgKSwKICAgIAkJCWV4dGVuc2lvbk11bHRpRHJhdzogKCBIQVNfRVhURU5TSU9OUyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLm11bHRpRHJhdyA9PT0gdHJ1ZSB8fCBJU19CQVRDSEVETUVTSCApICYmIGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlfZHJhdycgKSwKCiAgICAJCQlyZW5kZXJlckV4dGVuc2lvblBhcmFsbGVsU2hhZGVyQ29tcGlsZTogZXh0ZW5zaW9ucy5oYXMoICdLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUnICksCgogICAgCQkJY3VzdG9tUHJvZ3JhbUNhY2hlS2V5OiBtYXRlcmlhbC5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkoKQoKICAgIAkJfTsKCiAgICAJCS8vIHRoZSB1c2FnZSBvZiBnZXRDaGFubmVsKCkgZGV0ZXJtaW5lcyB0aGUgYWN0aXZlIHRleHR1cmUgY2hhbm5lbHMgZm9yIHRoaXMgc2hhZGVyCgogICAgCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPSBfYWN0aXZlQ2hhbm5lbHMuaGFzKCAxICk7CiAgICAJCXBhcmFtZXRlcnMudmVydGV4VXYycyA9IF9hY3RpdmVDaGFubmVscy5oYXMoIDIgKTsKICAgIAkJcGFyYW1ldGVycy52ZXJ0ZXhVdjNzID0gX2FjdGl2ZUNoYW5uZWxzLmhhcyggMyApOwoKICAgIAkJX2FjdGl2ZUNoYW5uZWxzLmNsZWFyKCk7CgogICAgCQlyZXR1cm4gcGFyYW1ldGVyczsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKSB7CgogICAgCQljb25zdCBhcnJheSA9IFtdOwoKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRlcklEICkgewoKICAgIAkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hhZGVySUQgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21WZXJ0ZXhTaGFkZXJJRCApOwogICAgCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21GcmFnbWVudFNoYWRlcklEICk7CgogICAgCQl9CgogICAgCQlpZiAoIHBhcmFtZXRlcnMuZGVmaW5lcyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWZvciAoIGNvbnN0IG5hbWUgaW4gcGFyYW1ldGVycy5kZWZpbmVzICkgewoKICAgIAkJCQlhcnJheS5wdXNoKCBuYW1lICk7CiAgICAJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZWZpbmVzWyBuYW1lIF0gKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gZmFsc2UgKSB7CgogICAgCQkJZ2V0UHJvZ3JhbUNhY2hlS2V5UGFyYW1ldGVycyggYXJyYXksIHBhcmFtZXRlcnMgKTsKICAgIAkJCWdldFByb2dyYW1DYWNoZUtleUJvb2xlYW5zKCBhcnJheSwgcGFyYW1ldGVycyApOwogICAgCQkJYXJyYXkucHVzaCggcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSApOwoKICAgIAkJfQoKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkgKTsKCiAgICAJCXJldHVybiBhcnJheS5qb2luKCk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0UHJvZ3JhbUNhY2hlS2V5UGFyYW1ldGVycyggYXJyYXksIHBhcmFtZXRlcnMgKSB7CgogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm91dHB1dENvbG9yU3BhY2UgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5lbnZNYXBNb2RlICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWSGVpZ2h0ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5hbHBoYU1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubGlnaHRNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmFvTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5idW1wTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5ub3JtYWxNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMucm91Z2huZXNzTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jbGVhcmNvYXRNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zcGVjdWxhck1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jb21iaW5lICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZm9nRXhwMiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNpemVBdHRlbnVhdGlvbiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubW9ycGhBdHRyaWJ1dGVDb3VudCApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0cyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0cyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodE1hcHMgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1IZW1pTGlnaHRzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtUmVjdEFyZWFMaWdodHMgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1EaXJMaWdodFNoYWRvd3MgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1MaWdodFByb2JlcyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy50b25lTWFwcGluZyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRlcHRoUGFja2luZyApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleUJvb2xlYW5zKCBhcnJheSwgcGFyYW1ldGVycyApIHsKCiAgICAJCV9wcm9ncmFtTGF5ZXJzLmRpc2FibGVBbGwoKTsKCiAgICAJCWlmICggcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdNb3JwaCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDMgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLm1hdGNhcCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDQgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLm5vcm1hbE1hcE9iamVjdFNwYWNlICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNiApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNyApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuY2xlYXJjb2F0ICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2UgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA5ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5hbHBoYVRlc3QgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4Q29sb3JzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTEgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleEFscGhhcyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEyICk7CiAgICAJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjFzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTMgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleFV2MnMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4VXYzcyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE1ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE2ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5hbmlzb3Ryb3B5ICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhSGFzaCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE4ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5iYXRjaGluZyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE5ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5kaXNwZXJzaW9uICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjAgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmJhdGNoaW5nQ29sb3IgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZ3JhZGllbnRNYXAgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMiApOwoKICAgIAkJYXJyYXkucHVzaCggX3Byb2dyYW1MYXllcnMubWFzayApOwogICAgCQlfcHJvZ3JhbUxheWVycy5kaXNhYmxlQWxsKCk7CgogICAgCQlpZiAoIHBhcmFtZXRlcnMuZm9nICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudXNlRm9nICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMyApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMucmV2ZXJzZURlcHRoQnVmZmVyICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuc2tpbm5pbmcgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA1ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA2ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5tb3JwaE5vcm1hbHMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5tb3JwaENvbG9ycyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDggKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDkgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZmxpcFNpZGVkICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTIgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEzICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5kaXRoZXJpbmcgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTUgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnNoZWVuICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTYgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLm9wYXF1ZSApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE3ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5wb2ludHNVdnMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTkgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmRlY29kZVZpZGVvVGV4dHVyZUVtaXNzaXZlICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjAgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhVG9Db3ZlcmFnZSApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIxICk7CgogICAgCQlhcnJheS5wdXNoKCBfcHJvZ3JhbUxheWVycy5tYXNrICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICkgewoKICAgIAkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKICAgIAkJbGV0IHVuaWZvcm1zOwoKICAgIAkJaWYgKCBzaGFkZXJJRCApIHsKCiAgICAJCQljb25zdCBzaGFkZXIgPSBTaGFkZXJMaWJbIHNoYWRlcklEIF07CiAgICAJCQl1bmlmb3JtcyA9IFVuaWZvcm1zVXRpbHMuY2xvbmUoIHNoYWRlci51bmlmb3JtcyApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl1bmlmb3JtcyA9IG1hdGVyaWFsLnVuaWZvcm1zOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHVuaWZvcm1zOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGFjcXVpcmVQcm9ncmFtKCBwYXJhbWV0ZXJzLCBjYWNoZUtleSApIHsKCiAgICAJCWxldCBwcm9ncmFtOwoKICAgIAkJLy8gQ2hlY2sgaWYgY29kZSBoYXMgYmVlbiBhbHJlYWR5IGNvbXBpbGVkCiAgICAJCWZvciAoIGxldCBwID0gMCwgcGwgPSBwcm9ncmFtcy5sZW5ndGg7IHAgPCBwbDsgcCArKyApIHsKCiAgICAJCQljb25zdCBwcmVleGlzdGluZ1Byb2dyYW0gPSBwcm9ncmFtc1sgcCBdOwoKICAgIAkJCWlmICggcHJlZXhpc3RpbmdQcm9ncmFtLmNhY2hlS2V5ID09PSBjYWNoZUtleSApIHsKCiAgICAJCQkJcHJvZ3JhbSA9IHByZWV4aXN0aW5nUHJvZ3JhbTsKICAgIAkJCQkrKyBwcm9ncmFtLnVzZWRUaW1lczsKCiAgICAJCQkJYnJlYWs7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBwcm9ncmFtID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcHJvZ3JhbSA9IG5ldyBXZWJHTFByb2dyYW0oIHJlbmRlcmVyLCBjYWNoZUtleSwgcGFyYW1ldGVycywgYmluZGluZ1N0YXRlcyApOwogICAgCQkJcHJvZ3JhbXMucHVzaCggcHJvZ3JhbSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHByb2dyYW07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVsZWFzZVByb2dyYW0oIHByb2dyYW0gKSB7CgogICAgCQlpZiAoIC0tIHByb2dyYW0udXNlZFRpbWVzID09PSAwICkgewoKICAgIAkJCS8vIFJlbW92ZSBmcm9tIHVub3JkZXJlZCBzZXQKICAgIAkJCWNvbnN0IGkgPSBwcm9ncmFtcy5pbmRleE9mKCBwcm9ncmFtICk7CiAgICAJCQlwcm9ncmFtc1sgaSBdID0gcHJvZ3JhbXNbIHByb2dyYW1zLmxlbmd0aCAtIDEgXTsKICAgIAkJCXByb2dyYW1zLnBvcCgpOwoKICAgIAkJCS8vIEZyZWUgV2ViR0wgcmVzb3VyY2VzCiAgICAJCQlwcm9ncmFtLmRlc3Ryb3koKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWxlYXNlU2hhZGVyQ2FjaGUoIG1hdGVyaWFsICkgewoKICAgIAkJX2N1c3RvbVNoYWRlcnMucmVtb3ZlKCBtYXRlcmlhbCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgogICAgCQlfY3VzdG9tU2hhZGVycy5kaXNwb3NlKCk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJZ2V0UGFyYW1ldGVyczogZ2V0UGFyYW1ldGVycywKICAgIAkJZ2V0UHJvZ3JhbUNhY2hlS2V5OiBnZXRQcm9ncmFtQ2FjaGVLZXksCiAgICAJCWdldFVuaWZvcm1zOiBnZXRVbmlmb3JtcywKICAgIAkJYWNxdWlyZVByb2dyYW06IGFjcXVpcmVQcm9ncmFtLAogICAgCQlyZWxlYXNlUHJvZ3JhbTogcmVsZWFzZVByb2dyYW0sCiAgICAJCXJlbGVhc2VTaGFkZXJDYWNoZTogcmVsZWFzZVNoYWRlckNhY2hlLAogICAgCQkvLyBFeHBvc2VkIGZvciByZXNvdXJjZSBtb25pdG9yaW5nICYgZXJyb3IgZmVlZGJhY2sgdmlhIHJlbmRlcmVyLmluZm86CiAgICAJCXByb2dyYW1zOiBwcm9ncmFtcywKICAgIAkJZGlzcG9zZTogZGlzcG9zZQogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMUHJvcGVydGllcygpIHsKCiAgICAJbGV0IHByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlmdW5jdGlvbiBoYXMoIG9iamVjdCApIHsKCiAgICAJCXJldHVybiBwcm9wZXJ0aWVzLmhhcyggb2JqZWN0ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0KCBvYmplY3QgKSB7CgogICAgCQlsZXQgbWFwID0gcHJvcGVydGllcy5nZXQoIG9iamVjdCApOwoKICAgIAkJaWYgKCBtYXAgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQltYXAgPSB7fTsKICAgIAkJCXByb3BlcnRpZXMuc2V0KCBvYmplY3QsIG1hcCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIG1hcDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW1vdmUoIG9iamVjdCApIHsKCiAgICAJCXByb3BlcnRpZXMuZGVsZXRlKCBvYmplY3QgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwga2V5LCB2YWx1ZSApIHsKCiAgICAJCXByb3BlcnRpZXMuZ2V0KCBvYmplY3QgKVsga2V5IF0gPSB2YWx1ZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJcHJvcGVydGllcyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJaGFzOiBoYXMsCiAgICAJCWdldDogZ2V0LAogICAgCQlyZW1vdmU6IHJlbW92ZSwKICAgIAkJdXBkYXRlOiB1cGRhdGUsCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBwYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCiAgICAJaWYgKCBhLmdyb3VwT3JkZXIgIT09IGIuZ3JvdXBPcmRlciApIHsKCiAgICAJCXJldHVybiBhLmdyb3VwT3JkZXIgLSBiLmdyb3VwT3JkZXI7CgogICAgCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgogICAgCQlyZXR1cm4gYS5yZW5kZXJPcmRlciAtIGIucmVuZGVyT3JkZXI7CgogICAgCX0gZWxzZSBpZiAoIGEubWF0ZXJpYWwuaWQgIT09IGIubWF0ZXJpYWwuaWQgKSB7CgogICAgCQlyZXR1cm4gYS5tYXRlcmlhbC5pZCAtIGIubWF0ZXJpYWwuaWQ7CgogICAgCX0gZWxzZSBpZiAoIGEueiAhPT0gYi56ICkgewoKICAgIAkJcmV0dXJuIGEueiAtIGIuejsKCiAgICAJfSBlbHNlIHsKCiAgICAJCXJldHVybiBhLmlkIC0gYi5pZDsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiByZXZlcnNlUGFpbnRlclNvcnRTdGFibGUoIGEsIGIgKSB7CgogICAgCWlmICggYS5ncm91cE9yZGVyICE9PSBiLmdyb3VwT3JkZXIgKSB7CgogICAgCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKICAgIAl9IGVsc2UgaWYgKCBhLnJlbmRlck9yZGVyICE9PSBiLnJlbmRlck9yZGVyICkgewoKICAgIAkJcmV0dXJuIGEucmVuZGVyT3JkZXIgLSBiLnJlbmRlck9yZGVyOwoKICAgIAl9IGVsc2UgaWYgKCBhLnogIT09IGIueiApIHsKCiAgICAJCXJldHVybiBiLnogLSBhLno7CgogICAgCX0gZWxzZSB7CgogICAgCQlyZXR1cm4gYS5pZCAtIGIuaWQ7CgogICAgCX0KCiAgICB9CgoKICAgIGZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdCgpIHsKCiAgICAJY29uc3QgcmVuZGVySXRlbXMgPSBbXTsKICAgIAlsZXQgcmVuZGVySXRlbXNJbmRleCA9IDA7CgogICAgCWNvbnN0IG9wYXF1ZSA9IFtdOwogICAgCWNvbnN0IHRyYW5zbWlzc2l2ZSA9IFtdOwogICAgCWNvbnN0IHRyYW5zcGFyZW50ID0gW107CgogICAgCWZ1bmN0aW9uIGluaXQoKSB7CgogICAgCQlyZW5kZXJJdGVtc0luZGV4ID0gMDsKCiAgICAJCW9wYXF1ZS5sZW5ndGggPSAwOwogICAgCQl0cmFuc21pc3NpdmUubGVuZ3RoID0gMDsKICAgIAkJdHJhbnNwYXJlbnQubGVuZ3RoID0gMDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKICAgIAkJbGV0IHJlbmRlckl0ZW0gPSByZW5kZXJJdGVtc1sgcmVuZGVySXRlbXNJbmRleCBdOwoKICAgIAkJaWYgKCByZW5kZXJJdGVtID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcmVuZGVySXRlbSA9IHsKICAgIAkJCQlpZDogb2JqZWN0LmlkLAogICAgCQkJCW9iamVjdDogb2JqZWN0LAogICAgCQkJCWdlb21ldHJ5OiBnZW9tZXRyeSwKICAgIAkJCQltYXRlcmlhbDogbWF0ZXJpYWwsCiAgICAJCQkJZ3JvdXBPcmRlcjogZ3JvdXBPcmRlciwKICAgIAkJCQlyZW5kZXJPcmRlcjogb2JqZWN0LnJlbmRlck9yZGVyLAogICAgCQkJCXo6IHosCiAgICAJCQkJZ3JvdXA6IGdyb3VwCiAgICAJCQl9OwoKICAgIAkJCXJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF0gPSByZW5kZXJJdGVtOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlyZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwogICAgCQkJcmVuZGVySXRlbS5vYmplY3QgPSBvYmplY3Q7CiAgICAJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CiAgICAJCQlyZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CiAgICAJCQlyZW5kZXJJdGVtLmdyb3VwT3JkZXIgPSBncm91cE9yZGVyOwogICAgCQkJcmVuZGVySXRlbS5yZW5kZXJPcmRlciA9IG9iamVjdC5yZW5kZXJPcmRlcjsKICAgIAkJCXJlbmRlckl0ZW0ueiA9IHo7CiAgICAJCQlyZW5kZXJJdGVtLmdyb3VwID0gZ3JvdXA7CgogICAgCQl9CgogICAgCQlyZW5kZXJJdGVtc0luZGV4ICsrOwoKICAgIAkJcmV0dXJuIHJlbmRlckl0ZW07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKICAgIAkJY29uc3QgcmVuZGVySXRlbSA9IGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKTsKCiAgICAJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKICAgIAkJCXRyYW5zbWlzc2l2ZS5wdXNoKCByZW5kZXJJdGVtICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIHsKCiAgICAJCQl0cmFuc3BhcmVudC5wdXNoKCByZW5kZXJJdGVtICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCW9wYXF1ZS5wdXNoKCByZW5kZXJJdGVtICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdW5zaGlmdCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKICAgIAkJY29uc3QgcmVuZGVySXRlbSA9IGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKTsKCiAgICAJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKICAgIAkJCXRyYW5zbWlzc2l2ZS51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIHsKCiAgICAJCQl0cmFuc3BhcmVudC51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCW9wYXF1ZS51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc29ydCggY3VzdG9tT3BhcXVlU29ydCwgY3VzdG9tVHJhbnNwYXJlbnRTb3J0ICkgewoKICAgIAkJaWYgKCBvcGFxdWUubGVuZ3RoID4gMSApIG9wYXF1ZS5zb3J0KCBjdXN0b21PcGFxdWVTb3J0IHx8IHBhaW50ZXJTb3J0U3RhYmxlICk7CiAgICAJCWlmICggdHJhbnNtaXNzaXZlLmxlbmd0aCA+IDEgKSB0cmFuc21pc3NpdmUuc29ydCggY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSApOwogICAgCQlpZiAoIHRyYW5zcGFyZW50Lmxlbmd0aCA+IDEgKSB0cmFuc3BhcmVudC5zb3J0KCBjdXN0b21UcmFuc3BhcmVudFNvcnQgfHwgcmV2ZXJzZVBhaW50ZXJTb3J0U3RhYmxlICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZmluaXNoKCkgewoKICAgIAkJLy8gQ2xlYXIgcmVmZXJlbmNlcyBmcm9tIGluYWN0aXZlIHJlbmRlckl0ZW1zIGluIHRoZSBsaXN0CgogICAgCQlmb3IgKCBsZXQgaSA9IHJlbmRlckl0ZW1zSW5kZXgsIGlsID0gcmVuZGVySXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckl0ZW1zWyBpIF07CgogICAgCQkJaWYgKCByZW5kZXJJdGVtLmlkID09PSBudWxsICkgYnJlYWs7CgogICAgCQkJcmVuZGVySXRlbS5pZCA9IG51bGw7CiAgICAJCQlyZW5kZXJJdGVtLm9iamVjdCA9IG51bGw7CiAgICAJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gbnVsbDsKICAgIAkJCXJlbmRlckl0ZW0ubWF0ZXJpYWwgPSBudWxsOwogICAgCQkJcmVuZGVySXRlbS5ncm91cCA9IG51bGw7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCW9wYXF1ZTogb3BhcXVlLAogICAgCQl0cmFuc21pc3NpdmU6IHRyYW5zbWlzc2l2ZSwKICAgIAkJdHJhbnNwYXJlbnQ6IHRyYW5zcGFyZW50LAoKICAgIAkJaW5pdDogaW5pdCwKICAgIAkJcHVzaDogcHVzaCwKICAgIAkJdW5zaGlmdDogdW5zaGlmdCwKICAgIAkJZmluaXNoOiBmaW5pc2gsCgogICAgCQlzb3J0OiBzb3J0CiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0cygpIHsKCiAgICAJbGV0IGxpc3RzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgcmVuZGVyQ2FsbERlcHRoICkgewoKICAgIAkJY29uc3QgbGlzdEFycmF5ID0gbGlzdHMuZ2V0KCBzY2VuZSApOwogICAgCQlsZXQgbGlzdDsKCiAgICAJCWlmICggbGlzdEFycmF5ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKICAgIAkJCWxpc3RzLnNldCggc2NlbmUsIFsgbGlzdCBdICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IGxpc3RBcnJheS5sZW5ndGggKSB7CgogICAgCQkJCWxpc3QgPSBuZXcgV2ViR0xSZW5kZXJMaXN0KCk7CiAgICAJCQkJbGlzdEFycmF5LnB1c2goIGxpc3QgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlsaXN0ID0gbGlzdEFycmF5WyByZW5kZXJDYWxsRGVwdGggXTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gbGlzdDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJbGlzdHMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAl9CgogICAgCXJldHVybiB7CiAgICAJCWdldDogZ2V0LAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gVW5pZm9ybXNDYWNoZSgpIHsKCiAgICAJY29uc3QgbGlnaHRzID0ge307CgogICAgCXJldHVybiB7CgogICAgCQlnZXQ6IGZ1bmN0aW9uICggbGlnaHQgKSB7CgogICAgCQkJaWYgKCBsaWdodHNbIGxpZ2h0LmlkIF0gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJcmV0dXJuIGxpZ2h0c1sgbGlnaHQuaWQgXTsKCiAgICAJCQl9CgogICAgCQkJbGV0IHVuaWZvcm1zOwoKICAgIAkJCXN3aXRjaCAoIGxpZ2h0LnR5cGUgKSB7CgogICAgCQkJCWNhc2UgJ0RpcmVjdGlvbmFsTGlnaHQnOgogICAgCQkJCQl1bmlmb3JtcyA9IHsKICAgIAkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKICAgIAkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKQogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSAnU3BvdExpZ2h0JzoKICAgIAkJCQkJdW5pZm9ybXMgPSB7CiAgICAJCQkJCQlwb3NpdGlvbjogbmV3IFZlY3RvcjMoKSwKICAgIAkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKICAgIAkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKICAgIAkJCQkJCWRpc3RhbmNlOiAwLAogICAgCQkJCQkJY29uZUNvczogMCwKICAgIAkJCQkJCXBlbnVtYnJhQ29zOiAwLAogICAgCQkJCQkJZGVjYXk6IDAKICAgIAkJCQkJfTsKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJCWNhc2UgJ1BvaW50TGlnaHQnOgogICAgCQkJCQl1bmlmb3JtcyA9IHsKICAgIAkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpLAogICAgCQkJCQkJZGlzdGFuY2U6IDAsCiAgICAJCQkJCQlkZWNheTogMAogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSAnSGVtaXNwaGVyZUxpZ2h0JzoKICAgIAkJCQkJdW5pZm9ybXMgPSB7CiAgICAJCQkJCQlkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCiAgICAJCQkJCQlza3lDb2xvcjogbmV3IENvbG9yKCksCiAgICAJCQkJCQlncm91bmRDb2xvcjogbmV3IENvbG9yKCkKICAgIAkJCQkJfTsKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJCWNhc2UgJ1JlY3RBcmVhTGlnaHQnOgogICAgCQkJCQl1bmlmb3JtcyA9IHsKICAgIAkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKICAgIAkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgCQkJCQkJaGFsZldpZHRoOiBuZXcgVmVjdG9yMygpLAogICAgCQkJCQkJaGFsZkhlaWdodDogbmV3IFZlY3RvcjMoKQogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQl9CgogICAgCQkJbGlnaHRzWyBsaWdodC5pZCBdID0gdW5pZm9ybXM7CgogICAgCQkJcmV0dXJuIHVuaWZvcm1zOwoKICAgIAkJfQoKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBTaGFkb3dVbmlmb3Jtc0NhY2hlKCkgewoKICAgIAljb25zdCBsaWdodHMgPSB7fTsKCiAgICAJcmV0dXJuIHsKCiAgICAJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCiAgICAJCQlpZiAoIGxpZ2h0c1sgbGlnaHQuaWQgXSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKICAgIAkJCX0KCiAgICAJCQlsZXQgdW5pZm9ybXM7CgogICAgCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCiAgICAJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CiAgICAJCQkJCXVuaWZvcm1zID0gewogICAgCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAogICAgCQkJCQkJc2hhZG93QmlhczogMCwKICAgIAkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCiAgICAJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCiAgICAJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCiAgICAJCQkJCX07CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlICdTcG90TGlnaHQnOgogICAgCQkJCQl1bmlmb3JtcyA9IHsKICAgIAkJCQkJCXNoYWRvd0ludGVuc2l0eTogMSwKICAgIAkJCQkJCXNoYWRvd0JpYXM6IDAsCiAgICAJCQkJCQlzaGFkb3dOb3JtYWxCaWFzOiAwLAogICAgCQkJCQkJc2hhZG93UmFkaXVzOiAxLAogICAgCQkJCQkJc2hhZG93TWFwU2l6ZTogbmV3IFZlY3RvcjIoKQogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSAnUG9pbnRMaWdodCc6CiAgICAJCQkJCXVuaWZvcm1zID0gewogICAgCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAogICAgCQkJCQkJc2hhZG93QmlhczogMCwKICAgIAkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCiAgICAJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCiAgICAJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAogICAgCQkJCQkJc2hhZG93Q2FtZXJhTmVhcjogMSwKICAgIAkJCQkJCXNoYWRvd0NhbWVyYUZhcjogMTAwMAogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IHNldCBSZWN0QXJlYUxpZ2h0IHNoYWRvdyB1bmlmb3JtcwoKICAgIAkJCX0KCiAgICAJCQlsaWdodHNbIGxpZ2h0LmlkIF0gPSB1bmlmb3JtczsKCiAgICAJCQlyZXR1cm4gdW5pZm9ybXM7CgogICAgCQl9CgogICAgCX07CgogICAgfQoKCgogICAgbGV0IG5leHRWZXJzaW9uID0gMDsKCiAgICBmdW5jdGlvbiBzaGFkb3dDYXN0aW5nQW5kVGV4dHVyaW5nTGlnaHRzRmlyc3QoIGxpZ2h0QSwgbGlnaHRCICkgewoKICAgIAlyZXR1cm4gKCBsaWdodEIuY2FzdFNoYWRvdyA/IDIgOiAwICkgLSAoIGxpZ2h0QS5jYXN0U2hhZG93ID8gMiA6IDAgKSArICggbGlnaHRCLm1hcCA/IDEgOiAwICkgLSAoIGxpZ2h0QS5tYXAgPyAxIDogMCApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTExpZ2h0cyggZXh0ZW5zaW9ucyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSBuZXcgVW5pZm9ybXNDYWNoZSgpOwoKICAgIAljb25zdCBzaGFkb3dDYWNoZSA9IFNoYWRvd1VuaWZvcm1zQ2FjaGUoKTsKCiAgICAJY29uc3Qgc3RhdGUgPSB7CgogICAgCQl2ZXJzaW9uOiAwLAoKICAgIAkJaGFzaDogewogICAgCQkJZGlyZWN0aW9uYWxMZW5ndGg6IC0xLAogICAgCQkJcG9pbnRMZW5ndGg6IC0xLAogICAgCQkJc3BvdExlbmd0aDogLTEsCiAgICAJCQlyZWN0QXJlYUxlbmd0aDogLTEsCiAgICAJCQloZW1pTGVuZ3RoOiAtMSwKCiAgICAJCQludW1EaXJlY3Rpb25hbFNoYWRvd3M6IC0xLAogICAgCQkJbnVtUG9pbnRTaGFkb3dzOiAtMSwKICAgIAkJCW51bVNwb3RTaGFkb3dzOiAtMSwKICAgIAkJCW51bVNwb3RNYXBzOiAtMSwKCiAgICAJCQludW1MaWdodFByb2JlczogLTEKICAgIAkJfSwKCiAgICAJCWFtYmllbnQ6IFsgMCwgMCwgMCBdLAogICAgCQlwcm9iZTogW10sCiAgICAJCWRpcmVjdGlvbmFsOiBbXSwKICAgIAkJZGlyZWN0aW9uYWxTaGFkb3c6IFtdLAogICAgCQlkaXJlY3Rpb25hbFNoYWRvd01hcDogW10sCiAgICAJCWRpcmVjdGlvbmFsU2hhZG93TWF0cml4OiBbXSwKICAgIAkJc3BvdDogW10sCiAgICAJCXNwb3RMaWdodE1hcDogW10sCiAgICAJCXNwb3RTaGFkb3c6IFtdLAogICAgCQlzcG90U2hhZG93TWFwOiBbXSwKICAgIAkJc3BvdExpZ2h0TWF0cml4OiBbXSwKICAgIAkJcmVjdEFyZWE6IFtdLAogICAgCQlyZWN0QXJlYUxUQzE6IG51bGwsCiAgICAJCXJlY3RBcmVhTFRDMjogbnVsbCwKICAgIAkJcG9pbnQ6IFtdLAogICAgCQlwb2ludFNoYWRvdzogW10sCiAgICAJCXBvaW50U2hhZG93TWFwOiBbXSwKICAgIAkJcG9pbnRTaGFkb3dNYXRyaXg6IFtdLAogICAgCQloZW1pOiBbXSwKICAgIAkJbnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOiAwLAogICAgCQludW1MaWdodFByb2JlczogMAoKICAgIAl9OwoKICAgIAlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgc3RhdGUucHJvYmUucHVzaCggbmV3IFZlY3RvcjMoKSApOwoKICAgIAljb25zdCB2ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKICAgIAljb25zdCBtYXRyaXg0ID0gbmV3IE1hdHJpeDQoKTsKICAgIAljb25zdCBtYXRyaXg0MiA9IG5ldyBNYXRyaXg0KCk7CgogICAgCWZ1bmN0aW9uIHNldHVwKCBsaWdodHMgKSB7CgogICAgCQlsZXQgciA9IDAsIGcgPSAwLCBiID0gMDsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSBzdGF0ZS5wcm9iZVsgaSBdLnNldCggMCwgMCwgMCApOwoKICAgIAkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKICAgIAkJbGV0IHBvaW50TGVuZ3RoID0gMDsKICAgIAkJbGV0IHNwb3RMZW5ndGggPSAwOwogICAgCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwogICAgCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgogICAgCQlsZXQgbnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gMDsKICAgIAkJbGV0IG51bVBvaW50U2hhZG93cyA9IDA7CiAgICAJCWxldCBudW1TcG90U2hhZG93cyA9IDA7CiAgICAJCWxldCBudW1TcG90TWFwcyA9IDA7CiAgICAJCWxldCBudW1TcG90U2hhZG93c1dpdGhNYXBzID0gMDsKCiAgICAJCWxldCBudW1MaWdodFByb2JlcyA9IDA7CgogICAgCQkvLyBvcmRlcmluZyA6IFtzaGFkb3cgY2FzdGluZyArIG1hcCB0ZXh0dXJpbmcsIG1hcCB0ZXh0dXJpbmcsIHNoYWRvdyBjYXN0aW5nLCBub25lIF0KICAgIAkJbGlnaHRzLnNvcnQoIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCApOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgbGlnaHQgPSBsaWdodHNbIGkgXTsKCiAgICAJCQljb25zdCBjb2xvciA9IGxpZ2h0LmNvbG9yOwogICAgCQkJY29uc3QgaW50ZW5zaXR5ID0gbGlnaHQuaW50ZW5zaXR5OwogICAgCQkJY29uc3QgZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCiAgICAJCQljb25zdCBzaGFkb3dNYXAgPSAoIGxpZ2h0LnNoYWRvdyAmJiBsaWdodC5zaGFkb3cubWFwICkgPyBsaWdodC5zaGFkb3cubWFwLnRleHR1cmUgOiBudWxsOwoKICAgIAkJCWlmICggbGlnaHQuaXNBbWJpZW50TGlnaHQgKSB7CgogICAgCQkJCXIgKz0gY29sb3IuciAqIGludGVuc2l0eTsKICAgIAkJCQlnICs9IGNvbG9yLmcgKiBpbnRlbnNpdHk7CiAgICAJCQkJYiArPSBjb2xvci5iICogaW50ZW5zaXR5OwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzTGlnaHRQcm9iZSApIHsKCiAgICAJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgOTsgaiArKyApIHsKCiAgICAJCQkJCXN0YXRlLnByb2JlWyBqIF0uYWRkU2NhbGVkVmVjdG9yKCBsaWdodC5zaC5jb2VmZmljaWVudHNbIGogXSwgaW50ZW5zaXR5ICk7CgogICAgCQkJCX0KCiAgICAJCQkJbnVtTGlnaHRQcm9iZXMgKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNEaXJlY3Rpb25hbExpZ2h0ICkgewoKICAgIAkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCiAgICAJCQkJdW5pZm9ybXMuY29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggbGlnaHQuaW50ZW5zaXR5ICk7CgogICAgCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCiAgICAJCQkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCiAgICAJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCiAgICAJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93WyBkaXJlY3Rpb25hbExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CiAgICAJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwWyBkaXJlY3Rpb25hbExlbmd0aCBdID0gc2hhZG93TWFwOwogICAgCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CgogICAgCQkJCQludW1EaXJlY3Rpb25hbFNoYWRvd3MgKys7CgogICAgCQkJCX0KCiAgICAJCQkJc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSB1bmlmb3JtczsKCiAgICAJCQkJZGlyZWN0aW9uYWxMZW5ndGggKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNTcG90TGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgogICAgCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwogICAgCQkJCXVuaWZvcm1zLmRpc3RhbmNlID0gZGlzdGFuY2U7CgogICAgCQkJCXVuaWZvcm1zLmNvbmVDb3MgPSBNYXRoLmNvcyggbGlnaHQuYW5nbGUgKTsKICAgIAkJCQl1bmlmb3Jtcy5wZW51bWJyYUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSAqICggMSAtIGxpZ2h0LnBlbnVtYnJhICkgKTsKICAgIAkJCQl1bmlmb3Jtcy5kZWNheSA9IGxpZ2h0LmRlY2F5OwoKICAgIAkJCQlzdGF0ZS5zcG90WyBzcG90TGVuZ3RoIF0gPSB1bmlmb3JtczsKCiAgICAJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKICAgIAkJCQlpZiAoIGxpZ2h0Lm1hcCApIHsKCiAgICAJCQkJCXN0YXRlLnNwb3RMaWdodE1hcFsgbnVtU3BvdE1hcHMgXSA9IGxpZ2h0Lm1hcDsKICAgIAkJCQkJbnVtU3BvdE1hcHMgKys7CgogICAgCQkJCQkvLyBtYWtlIHN1cmUgdGhlIGxpZ2h0TWF0cml4IGlzIHVwIHRvIGRhdGUKICAgIAkJCQkJLy8gVE9ETyA6IGRvIGl0IGlmIHJlcXVpcmVkIG9ubHkKICAgIAkJCQkJc2hhZG93LnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKICAgIAkJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgbnVtU3BvdFNoYWRvd3NXaXRoTWFwcyArKzsKCiAgICAJCQkJfQoKICAgIAkJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXhbIHNwb3RMZW5ndGggXSA9IHNoYWRvdy5tYXRyaXg7CgogICAgCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCiAgICAJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCiAgICAJCQkJCXN0YXRlLnNwb3RTaGFkb3dbIHNwb3RMZW5ndGggXSA9IHNoYWRvd1VuaWZvcm1zOwogICAgCQkJCQlzdGF0ZS5zcG90U2hhZG93TWFwWyBzcG90TGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgogICAgCQkJCQludW1TcG90U2hhZG93cyArKzsKCiAgICAJCQkJfQoKICAgIAkJCQlzcG90TGVuZ3RoICsrOwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgogICAgCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoKICAgIAkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKICAgIAkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKICAgIAkJCQlzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXSA9IHVuaWZvcm1zOwoKICAgIAkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCiAgICAJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKTsKICAgIAkJCQl1bmlmb3Jtcy5kaXN0YW5jZSA9IGxpZ2h0LmRpc3RhbmNlOwogICAgCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgogICAgCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCiAgICAJCQkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCiAgICAJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhTmVhciA9IHNoYWRvdy5jYW1lcmEubmVhcjsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhRmFyID0gc2hhZG93LmNhbWVyYS5mYXI7CgogICAgCQkJCQlzdGF0ZS5wb2ludFNoYWRvd1sgcG9pbnRMZW5ndGggXSA9IHNoYWRvd1VuaWZvcm1zOwogICAgCQkJCQlzdGF0ZS5wb2ludFNoYWRvd01hcFsgcG9pbnRMZW5ndGggXSA9IHNoYWRvd01hcDsKICAgIAkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXhbIHBvaW50TGVuZ3RoIF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwoKICAgIAkJCQkJbnVtUG9pbnRTaGFkb3dzICsrOwoKICAgIAkJCQl9CgogICAgCQkJCXN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdID0gdW5pZm9ybXM7CgogICAgCQkJCXBvaW50TGVuZ3RoICsrOwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzSGVtaXNwaGVyZUxpZ2h0ICkgewoKICAgIAkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCiAgICAJCQkJdW5pZm9ybXMuc2t5Q29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CiAgICAJCQkJdW5pZm9ybXMuZ3JvdW5kQ29sb3IuY29weSggbGlnaHQuZ3JvdW5kQ29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgogICAgCQkJCXN0YXRlLmhlbWlbIGhlbWlMZW5ndGggXSA9IHVuaWZvcm1zOwoKICAgIAkJCQloZW1pTGVuZ3RoICsrOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggcmVjdEFyZWFMZW5ndGggPiAwICkgewoKICAgIAkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IHRydWUgKSB7CgogICAgCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8xOwogICAgCQkJCXN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8yOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzE7CiAgICAJCQkJc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0hBTEZfMjsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlzdGF0ZS5hbWJpZW50WyAwIF0gPSByOwogICAgCQlzdGF0ZS5hbWJpZW50WyAxIF0gPSBnOwogICAgCQlzdGF0ZS5hbWJpZW50WyAyIF0gPSBiOwoKICAgIAkJY29uc3QgaGFzaCA9IHN0YXRlLmhhc2g7CgogICAgCQlpZiAoIGhhc2guZGlyZWN0aW9uYWxMZW5ndGggIT09IGRpcmVjdGlvbmFsTGVuZ3RoIHx8CiAgICAJCQloYXNoLnBvaW50TGVuZ3RoICE9PSBwb2ludExlbmd0aCB8fAogICAgCQkJaGFzaC5zcG90TGVuZ3RoICE9PSBzcG90TGVuZ3RoIHx8CiAgICAJCQloYXNoLnJlY3RBcmVhTGVuZ3RoICE9PSByZWN0QXJlYUxlbmd0aCB8fAogICAgCQkJaGFzaC5oZW1pTGVuZ3RoICE9PSBoZW1pTGVuZ3RoIHx8CiAgICAJCQloYXNoLm51bURpcmVjdGlvbmFsU2hhZG93cyAhPT0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzIHx8CiAgICAJCQloYXNoLm51bVBvaW50U2hhZG93cyAhPT0gbnVtUG9pbnRTaGFkb3dzIHx8CiAgICAJCQloYXNoLm51bVNwb3RTaGFkb3dzICE9PSBudW1TcG90U2hhZG93cyB8fAogICAgCQkJaGFzaC5udW1TcG90TWFwcyAhPT0gbnVtU3BvdE1hcHMgfHwKICAgIAkJCWhhc2gubnVtTGlnaHRQcm9iZXMgIT09IG51bUxpZ2h0UHJvYmVzICkgewoKICAgIAkJCXN0YXRlLmRpcmVjdGlvbmFsLmxlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwogICAgCQkJc3RhdGUuc3BvdC5sZW5ndGggPSBzcG90TGVuZ3RoOwogICAgCQkJc3RhdGUucmVjdEFyZWEubGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CiAgICAJCQlzdGF0ZS5wb2ludC5sZW5ndGggPSBwb2ludExlbmd0aDsKICAgIAkJCXN0YXRlLmhlbWkubGVuZ3RoID0gaGVtaUxlbmd0aDsKCiAgICAJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdy5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CiAgICAJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CiAgICAJCQlzdGF0ZS5wb2ludFNoYWRvdy5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CiAgICAJCQlzdGF0ZS5wb2ludFNoYWRvd01hcC5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CiAgICAJCQlzdGF0ZS5zcG90U2hhZG93Lmxlbmd0aCA9IG51bVNwb3RTaGFkb3dzOwogICAgCQkJc3RhdGUuc3BvdFNoYWRvd01hcC5sZW5ndGggPSBudW1TcG90U2hhZG93czsKICAgIAkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKICAgIAkJCXN0YXRlLnBvaW50U2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bVBvaW50U2hhZG93czsKICAgIAkJCXN0YXRlLnNwb3RMaWdodE1hdHJpeC5sZW5ndGggPSBudW1TcG90U2hhZG93cyArIG51bVNwb3RNYXBzIC0gbnVtU3BvdFNoYWRvd3NXaXRoTWFwczsKICAgIAkJCXN0YXRlLnNwb3RMaWdodE1hcC5sZW5ndGggPSBudW1TcG90TWFwczsKICAgIAkJCXN0YXRlLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcyA9IG51bVNwb3RTaGFkb3dzV2l0aE1hcHM7CiAgICAJCQlzdGF0ZS5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKICAgIAkJCWhhc2guZGlyZWN0aW9uYWxMZW5ndGggPSBkaXJlY3Rpb25hbExlbmd0aDsKICAgIAkJCWhhc2gucG9pbnRMZW5ndGggPSBwb2ludExlbmd0aDsKICAgIAkJCWhhc2guc3BvdExlbmd0aCA9IHNwb3RMZW5ndGg7CiAgICAJCQloYXNoLnJlY3RBcmVhTGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CiAgICAJCQloYXNoLmhlbWlMZW5ndGggPSBoZW1pTGVuZ3RoOwoKICAgIAkJCWhhc2gubnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzOwogICAgCQkJaGFzaC5udW1Qb2ludFNoYWRvd3MgPSBudW1Qb2ludFNoYWRvd3M7CiAgICAJCQloYXNoLm51bVNwb3RTaGFkb3dzID0gbnVtU3BvdFNoYWRvd3M7CiAgICAJCQloYXNoLm51bVNwb3RNYXBzID0gbnVtU3BvdE1hcHM7CgogICAgCQkJaGFzaC5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKICAgIAkJCXN0YXRlLnZlcnNpb24gPSBuZXh0VmVyc2lvbiArKzsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXR1cFZpZXcoIGxpZ2h0cywgY2FtZXJhICkgewoKICAgIAkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKICAgIAkJbGV0IHBvaW50TGVuZ3RoID0gMDsKICAgIAkJbGV0IHNwb3RMZW5ndGggPSAwOwogICAgCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwogICAgCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgogICAgCQljb25zdCB2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgogICAgCQkJaWYgKCBsaWdodC5pc0RpcmVjdGlvbmFsTGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF07CgogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zdWIoIHZlY3RvcjMgKTsKICAgIAkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCB2aWV3TWF0cml4ICk7CgogICAgCQkJCWRpcmVjdGlvbmFsTGVuZ3RoICsrOwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzU3BvdExpZ2h0ICkgewoKICAgIAkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnNwb3RbIHNwb3RMZW5ndGggXTsKCiAgICAJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKICAgIAkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC50YXJnZXQubWF0cml4V29ybGQgKTsKICAgIAkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKCB2ZWN0b3IzICk7CiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKICAgIAkJCQlzcG90TGVuZ3RoICsrOwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXTsKCiAgICAJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKICAgIAkJCQkvLyBleHRyYWN0IGxvY2FsIHJvdGF0aW9uIG9mIGxpZ2h0IHRvIGRlcml2ZSB3aWR0aC9oZWlnaHQgaGFsZiB2ZWN0b3JzCiAgICAJCQkJbWF0cml4NDIuaWRlbnRpdHkoKTsKICAgIAkJCQltYXRyaXg0LmNvcHkoIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJbWF0cml4NC5wcmVtdWx0aXBseSggdmlld01hdHJpeCApOwogICAgCQkJCW1hdHJpeDQyLmV4dHJhY3RSb3RhdGlvbiggbWF0cml4NCApOwoKICAgIAkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKICAgIAkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKICAgIAkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguYXBwbHlNYXRyaXg0KCBtYXRyaXg0MiApOwogICAgCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuYXBwbHlNYXRyaXg0KCBtYXRyaXg0MiApOwoKICAgIAkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCiAgICAJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUucG9pbnRbIHBvaW50TGVuZ3RoIF07CgogICAgCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKICAgIAkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCiAgICAJCQkJcG9pbnRMZW5ndGggKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuaGVtaVsgaGVtaUxlbmd0aCBdOwoKICAgIAkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCiAgICAJCQkJaGVtaUxlbmd0aCArKzsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJc2V0dXA6IHNldHVwLAogICAgCQlzZXR1cFZpZXc6IHNldHVwVmlldywKICAgIAkJc3RhdGU6IHN0YXRlCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZSggZXh0ZW5zaW9ucyApIHsKCiAgICAJY29uc3QgbGlnaHRzID0gbmV3IFdlYkdMTGlnaHRzKCBleHRlbnNpb25zICk7CgogICAgCWNvbnN0IGxpZ2h0c0FycmF5ID0gW107CiAgICAJY29uc3Qgc2hhZG93c0FycmF5ID0gW107CgogICAgCWZ1bmN0aW9uIGluaXQoIGNhbWVyYSApIHsKCiAgICAJCXN0YXRlLmNhbWVyYSA9IGNhbWVyYTsKCiAgICAJCWxpZ2h0c0FycmF5Lmxlbmd0aCA9IDA7CiAgICAJCXNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHB1c2hMaWdodCggbGlnaHQgKSB7CgogICAgCQlsaWdodHNBcnJheS5wdXNoKCBsaWdodCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHB1c2hTaGFkb3coIHNoYWRvd0xpZ2h0ICkgewoKICAgIAkJc2hhZG93c0FycmF5LnB1c2goIHNoYWRvd0xpZ2h0ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0dXBMaWdodHMoKSB7CgogICAgCQlsaWdodHMuc2V0dXAoIGxpZ2h0c0FycmF5ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKSB7CgogICAgCQlsaWdodHMuc2V0dXBWaWV3KCBsaWdodHNBcnJheSwgY2FtZXJhICk7CgogICAgCX0KCiAgICAJY29uc3Qgc3RhdGUgPSB7CiAgICAJCWxpZ2h0c0FycmF5OiBsaWdodHNBcnJheSwKICAgIAkJc2hhZG93c0FycmF5OiBzaGFkb3dzQXJyYXksCgogICAgCQljYW1lcmE6IG51bGwsCgogICAgCQlsaWdodHM6IGxpZ2h0cywKCiAgICAJCXRyYW5zbWlzc2lvblJlbmRlclRhcmdldDoge30KICAgIAl9OwoKICAgIAlyZXR1cm4gewogICAgCQlpbml0OiBpbml0LAogICAgCQlzdGF0ZTogc3RhdGUsCiAgICAJCXNldHVwTGlnaHRzOiBzZXR1cExpZ2h0cywKICAgIAkJc2V0dXBMaWdodHNWaWV3OiBzZXR1cExpZ2h0c1ZpZXcsCgogICAgCQlwdXNoTGlnaHQ6IHB1c2hMaWdodCwKICAgIAkJcHVzaFNoYWRvdzogcHVzaFNoYWRvdwogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMUmVuZGVyU3RhdGVzKCBleHRlbnNpb25zICkgewoKICAgIAlsZXQgcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgcmVuZGVyQ2FsbERlcHRoID0gMCApIHsKCiAgICAJCWNvbnN0IHJlbmRlclN0YXRlQXJyYXkgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSApOwogICAgCQlsZXQgcmVuZGVyU3RhdGU7CgogICAgCQlpZiAoIHJlbmRlclN0YXRlQXJyYXkgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlyZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICk7CiAgICAJCQlyZW5kZXJTdGF0ZXMuc2V0KCBzY2VuZSwgWyByZW5kZXJTdGF0ZSBdICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IHJlbmRlclN0YXRlQXJyYXkubGVuZ3RoICkgewoKICAgIAkJCQlyZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICk7CiAgICAJCQkJcmVuZGVyU3RhdGVBcnJheS5wdXNoKCByZW5kZXJTdGF0ZSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVBcnJheVsgcmVuZGVyQ2FsbERlcHRoIF07CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHJlbmRlclN0YXRlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgogICAgCQlyZW5kZXJTdGF0ZXMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAl9CgogICAgCXJldHVybiB7CiAgICAJCWdldDogZ2V0LAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCiAgICAJfTsKCiAgICB9CgogICAgY29uc3QgdmVydGV4ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCBzaGFkb3dfcGFzcztcbnVuaWZvcm0gdmVjMiByZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCByYWRpdXM7XG4jaW5jbHVkZSA8cGFja2luZz5cbnZvaWQgbWFpbigpIHtcblx0Y29uc3QgZmxvYXQgc2FtcGxlcyA9IGZsb2F0KCBWU01fU0FNUExFUyApO1xuXHRmbG9hdCBtZWFuID0gMC4wO1xuXHRmbG9hdCBzcXVhcmVkX21lYW4gPSAwLjA7XG5cdGZsb2F0IHV2U3RyaWRlID0gc2FtcGxlcyA8PSAxLjAgPyAwLjAgOiAyLjAgLyAoIHNhbXBsZXMgLSAxLjAgKTtcblx0ZmxvYXQgdXZTdGFydCA9IHNhbXBsZXMgPD0gMS4wID8gMC4wIDogLSAxLjA7XG5cdGZvciAoIGZsb2F0IGkgPSAwLjA7IGkgPCBzYW1wbGVzOyBpICsrICkge1xuXHRcdGZsb2F0IHV2T2Zmc2V0ID0gdXZTdGFydCArIGkgKiB1dlN0cmlkZTtcblx0XHQjaWZkZWYgSE9SSVpPTlRBTF9QQVNTXG5cdFx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIHV2T2Zmc2V0LCAwLjAgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRpc3RyaWJ1dGlvbi54O1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRpc3RyaWJ1dGlvbi55ICogZGlzdHJpYnV0aW9uLnkgKyBkaXN0cmlidXRpb24ueCAqIGRpc3RyaWJ1dGlvbi54O1xuXHRcdCNlbHNlXG5cdFx0XHRmbG9hdCBkZXB0aCA9IHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIDAuMCwgdXZPZmZzZXQgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRlcHRoO1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRlcHRoICogZGVwdGg7XG5cdFx0I2VuZGlmXG5cdH1cblx0bWVhbiA9IG1lYW4gLyBzYW1wbGVzO1xuXHRzcXVhcmVkX21lYW4gPSBzcXVhcmVkX21lYW4gLyBzYW1wbGVzO1xuXHRmbG9hdCBzdGRfZGV2ID0gc3FydCggc3F1YXJlZF9tZWFuIC0gbWVhbiAqIG1lYW4gKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFjazJIYWxmVG9SR0JBKCB2ZWMyKCBtZWFuLCBzdGRfZGV2ICkgKTtcbn0iOwoKICAgIGZ1bmN0aW9uIFdlYkdMU2hhZG93TWFwKCByZW5kZXJlciwgb2JqZWN0cywgY2FwYWJpbGl0aWVzICkgewoKICAgIAlsZXQgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKICAgIAljb25zdCBfc2hhZG93TWFwU2l6ZSA9IG5ldyBWZWN0b3IyKCksCiAgICAJCV92aWV3cG9ydFNpemUgPSBuZXcgVmVjdG9yMigpLAoKICAgIAkJX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKSwKCiAgICAJCV9kZXB0aE1hdGVyaWFsID0gbmV3IE1lc2hEZXB0aE1hdGVyaWFsKCB7IGRlcHRoUGFja2luZzogUkdCQURlcHRoUGFja2luZyB9ICksCiAgICAJCV9kaXN0YW5jZU1hdGVyaWFsID0gbmV3IE1lc2hEaXN0YW5jZU1hdGVyaWFsKCksCgogICAgCQlfbWF0ZXJpYWxDYWNoZSA9IHt9LAoKICAgIAkJX21heFRleHR1cmVTaXplID0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplOwoKICAgIAljb25zdCBzaGFkb3dTaWRlID0geyBbIEZyb250U2lkZSBdOiBCYWNrU2lkZSwgWyBCYWNrU2lkZSBdOiBGcm9udFNpZGUsIFsgRG91YmxlU2lkZSBdOiBEb3VibGVTaWRlIH07CgogICAgCWNvbnN0IHNoYWRvd01hdGVyaWFsVmVydGljYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKICAgIAkJZGVmaW5lczogewogICAgCQkJVlNNX1NBTVBMRVM6IDgKICAgIAkJfSwKICAgIAkJdW5pZm9ybXM6IHsKICAgIAkJCXNoYWRvd19wYXNzOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlyZXNvbHV0aW9uOiB7IHZhbHVlOiBuZXcgVmVjdG9yMigpIH0sCiAgICAJCQlyYWRpdXM6IHsgdmFsdWU6IDQuMCB9CiAgICAJCX0sCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IHZlcnRleCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50CgogICAgCX0gKTsKCiAgICAJY29uc3Qgc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsID0gc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5jbG9uZSgpOwogICAgCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5kZWZpbmVzLkhPUklaT05UQUxfUEFTUyA9IDE7CgogICAgCWNvbnN0IGZ1bGxTY3JlZW5UcmkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKICAgIAlmdWxsU2NyZWVuVHJpLnNldEF0dHJpYnV0ZSgKICAgIAkJJ3Bvc2l0aW9uJywKICAgIAkJbmV3IEJ1ZmZlckF0dHJpYnV0ZSgKICAgIAkJCW5ldyBGbG9hdDMyQXJyYXkoIFsgLTEsIC0xLCAwLjUsIDMsIC0xLCAwLjUsIC0xLCAzLCAwLjUgXSApLAogICAgCQkJMwogICAgCQkpCiAgICAJKTsKCiAgICAJY29uc3QgZnVsbFNjcmVlbk1lc2ggPSBuZXcgTWVzaCggZnVsbFNjcmVlblRyaSwgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCApOwoKICAgIAljb25zdCBzY29wZSA9IHRoaXM7CgogICAgCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKICAgIAl0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOwogICAgCXRoaXMubmVlZHNVcGRhdGUgPSBmYWxzZTsKCiAgICAJdGhpcy50eXBlID0gUENGU2hhZG93TWFwOwogICAgCWxldCBfcHJldmlvdXNUeXBlID0gdGhpcy50eXBlOwoKICAgIAl0aGlzLnJlbmRlciA9IGZ1bmN0aW9uICggbGlnaHRzLCBzY2VuZSwgY2FtZXJhICkgewoKICAgIAkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKICAgIAkJaWYgKCBzY29wZS5hdXRvVXBkYXRlID09PSBmYWxzZSAmJiBzY29wZS5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgogICAgCQlpZiAoIGxpZ2h0cy5sZW5ndGggPT09IDAgKSByZXR1cm47CgogICAgCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CiAgICAJCWNvbnN0IGFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKICAgIAkJY29uc3QgYWN0aXZlTWlwbWFwTGV2ZWwgPSByZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKICAgIAkJY29uc3QgX3N0YXRlID0gcmVuZGVyZXIuc3RhdGU7CgogICAgCQkvLyBTZXQgR0wgc3RhdGUgZm9yIGRlcHRoIG1hcC4KICAgIAkJX3N0YXRlLnNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICk7CiAgICAJCV9zdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCAxLCAxLCAxLCAxICk7CiAgICAJCV9zdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKICAgIAkJX3N0YXRlLnNldFNjaXNzb3JUZXN0KCBmYWxzZSApOwoKICAgIAkJLy8gY2hlY2sgZm9yIHNoYWRvdyBtYXAgdHlwZSBjaGFuZ2VzCgogICAgCQljb25zdCB0b1ZTTSA9ICggX3ByZXZpb3VzVHlwZSAhPT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwICk7CiAgICAJCWNvbnN0IGZyb21WU00gPSAoIF9wcmV2aW91c1R5cGUgPT09IFZTTVNoYWRvd01hcCAmJiB0aGlzLnR5cGUgIT09IFZTTVNoYWRvd01hcCApOwoKICAgIAkJLy8gcmVuZGVyIGRlcHRoIG1hcAoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQljb25zdCBsaWdodCA9IGxpZ2h0c1sgaSBdOwogICAgCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKICAgIAkJCWlmICggc2hhZG93ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMU2hhZG93TWFwOicsIGxpZ2h0LCAnaGFzIG5vIHNoYWRvdy4nICk7CiAgICAJCQkJY29udGludWU7CgogICAgCQkJfQoKICAgIAkJCWlmICggc2hhZG93LmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNoYWRvdy5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCiAgICAJCQlfc2hhZG93TWFwU2l6ZS5jb3B5KCBzaGFkb3cubWFwU2l6ZSApOwoKICAgIAkJCWNvbnN0IHNoYWRvd0ZyYW1lRXh0ZW50cyA9IHNoYWRvdy5nZXRGcmFtZUV4dGVudHMoKTsKCiAgICAJCQlfc2hhZG93TWFwU2l6ZS5tdWx0aXBseSggc2hhZG93RnJhbWVFeHRlbnRzICk7CgogICAgCQkJX3ZpZXdwb3J0U2l6ZS5jb3B5KCBzaGFkb3cubWFwU2l6ZSApOwoKICAgIAkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSB8fCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKICAgIAkJCQlpZiAoIF9zaGFkb3dNYXBTaXplLnggPiBfbWF4VGV4dHVyZVNpemUgKSB7CgogICAgCQkJCQlfdmlld3BvcnRTaXplLnggPSBNYXRoLmZsb29yKCBfbWF4VGV4dHVyZVNpemUgLyBzaGFkb3dGcmFtZUV4dGVudHMueCApOwogICAgCQkJCQlfc2hhZG93TWFwU2l6ZS54ID0gX3ZpZXdwb3J0U2l6ZS54ICogc2hhZG93RnJhbWVFeHRlbnRzLng7CiAgICAJCQkJCXNoYWRvdy5tYXBTaXplLnggPSBfdmlld3BvcnRTaXplLng7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKICAgIAkJCQkJX3ZpZXdwb3J0U2l6ZS55ID0gTWF0aC5mbG9vciggX21heFRleHR1cmVTaXplIC8gc2hhZG93RnJhbWVFeHRlbnRzLnkgKTsKICAgIAkJCQkJX3NoYWRvd01hcFNpemUueSA9IF92aWV3cG9ydFNpemUueSAqIHNoYWRvd0ZyYW1lRXh0ZW50cy55OwogICAgCQkJCQlzaGFkb3cubWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55OwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWlmICggc2hhZG93Lm1hcCA9PT0gbnVsbCB8fCB0b1ZTTSA9PT0gdHJ1ZSB8fCBmcm9tVlNNID09PSB0cnVlICkgewoKICAgIAkJCQljb25zdCBwYXJzID0gKCB0aGlzLnR5cGUgIT09IFZTTVNoYWRvd01hcCApID8geyBtaW5GaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsIG1hZ0ZpbHRlcjogTmVhcmVzdEZpbHRlciB9IDoge307CgogICAgCQkJCWlmICggc2hhZG93Lm1hcCAhPT0gbnVsbCApIHsKCiAgICAJCQkJCXNoYWRvdy5tYXAuZGlzcG9zZSgpOwoKICAgIAkJCQl9CgogICAgCQkJCXNoYWRvdy5tYXAgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIF9zaGFkb3dNYXBTaXplLngsIF9zaGFkb3dNYXBTaXplLnksIHBhcnMgKTsKICAgIAkJCQlzaGFkb3cubWFwLnRleHR1cmUubmFtZSA9IGxpZ2h0Lm5hbWUgKyAnLnNoYWRvd01hcCc7CgogICAgCQkJCXNoYWRvdy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAkJCX0KCiAgICAJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXAgKTsKICAgIAkJCXJlbmRlcmVyLmNsZWFyKCk7CgogICAgCQkJY29uc3Qgdmlld3BvcnRDb3VudCA9IHNoYWRvdy5nZXRWaWV3cG9ydENvdW50KCk7CgogICAgCQkJZm9yICggbGV0IHZwID0gMDsgdnAgPCB2aWV3cG9ydENvdW50OyB2cCArKyApIHsKCiAgICAJCQkJY29uc3Qgdmlld3BvcnQgPSBzaGFkb3cuZ2V0Vmlld3BvcnQoIHZwICk7CgogICAgCQkJCV92aWV3cG9ydC5zZXQoCiAgICAJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LngsCiAgICAJCQkJCV92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LnksCiAgICAJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LnosCiAgICAJCQkJCV92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LncKICAgIAkJCQkpOwoKICAgIAkJCQlfc3RhdGUudmlld3BvcnQoIF92aWV3cG9ydCApOwoKICAgIAkJCQlzaGFkb3cudXBkYXRlTWF0cmljZXMoIGxpZ2h0LCB2cCApOwoKICAgIAkJCQlfZnJ1c3R1bSA9IHNoYWRvdy5nZXRGcnVzdHVtKCk7CgogICAgCQkJCXJlbmRlck9iamVjdCggc2NlbmUsIGNhbWVyYSwgc2hhZG93LmNhbWVyYSwgbGlnaHQsIHRoaXMudHlwZSApOwoKICAgIAkJCX0KCiAgICAJCQkvLyBkbyBibHVyIHBhc3MgZm9yIFZTTQoKICAgIAkJCWlmICggc2hhZG93LmlzUG9pbnRMaWdodFNoYWRvdyAhPT0gdHJ1ZSAmJiB0aGlzLnR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCiAgICAJCQkJVlNNUGFzcyggc2hhZG93LCBjYW1lcmEgKTsKCiAgICAJCQl9CgogICAgCQkJc2hhZG93Lm5lZWRzVXBkYXRlID0gZmFsc2U7CgogICAgCQl9CgogICAgCQlfcHJldmlvdXNUeXBlID0gdGhpcy50eXBlOwoKICAgIAkJc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UsIGFjdGl2ZU1pcG1hcExldmVsICk7CgogICAgCX07CgogICAgCWZ1bmN0aW9uIFZTTVBhc3MoIHNoYWRvdywgY2FtZXJhICkgewoKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggZnVsbFNjcmVlbk1lc2ggKTsKCiAgICAJCWlmICggc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTICE9PSBzaGFkb3cuYmx1clNhbXBsZXMgKSB7CgogICAgCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTID0gc2hhZG93LmJsdXJTYW1wbGVzOwogICAgCQkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLmRlZmluZXMuVlNNX1NBTVBMRVMgPSBzaGFkb3cuYmx1clNhbXBsZXM7CgogICAgCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAJCQlzaGFkb3dNYXRlcmlhbEhvcml6b250YWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJaWYgKCBzaGFkb3cubWFwUGFzcyA9PT0gbnVsbCApIHsKCiAgICAJCQlzaGFkb3cubWFwUGFzcyA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggX3NoYWRvd01hcFNpemUueCwgX3NoYWRvd01hcFNpemUueSApOwoKICAgIAkJfQoKICAgIAkJLy8gdmVydGljYWwgcGFzcwoKICAgIAkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5zaGFkb3dfcGFzcy52YWx1ZSA9IHNoYWRvdy5tYXAudGV4dHVyZTsKICAgIAkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CiAgICAJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmFkaXVzLnZhbHVlID0gc2hhZG93LnJhZGl1czsKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwUGFzcyApOwogICAgCQlyZW5kZXJlci5jbGVhcigpOwogICAgCQlyZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsVmVydGljYWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgogICAgCQkvLyBob3Jpem9udGFsIHBhc3MKCiAgICAJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5zaGFkb3dfcGFzcy52YWx1ZSA9IHNoYWRvdy5tYXBQYXNzLnRleHR1cmU7CiAgICAJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CiAgICAJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yYWRpdXMudmFsdWUgPSBzaGFkb3cucmFkaXVzOwogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXAgKTsKICAgIAkJcmVuZGVyZXIuY2xlYXIoKTsKICAgIAkJcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgbGlnaHQsIHR5cGUgKSB7CgogICAgCQlsZXQgcmVzdWx0ID0gbnVsbDsKCiAgICAJCWNvbnN0IGN1c3RvbU1hdGVyaWFsID0gKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgKSA/IG9iamVjdC5jdXN0b21EaXN0YW5jZU1hdGVyaWFsIDogb2JqZWN0LmN1c3RvbURlcHRoTWF0ZXJpYWw7CgogICAgCQlpZiAoIGN1c3RvbU1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcmVzdWx0ID0gY3VzdG9tTWF0ZXJpYWw7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXJlc3VsdCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBfZGlzdGFuY2VNYXRlcmlhbCA6IF9kZXB0aE1hdGVyaWFsOwoKICAgIAkJCWlmICggKCByZW5kZXJlci5sb2NhbENsaXBwaW5nRW5hYmxlZCAmJiBtYXRlcmlhbC5jbGlwU2hhZG93cyA9PT0gdHJ1ZSAmJiBBcnJheS5pc0FycmF5KCBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcyApICYmIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzLmxlbmd0aCAhPT0gMCApIHx8CiAgICAJCQkJKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgJiYgbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGUgIT09IDAgKSB8fAogICAgCQkJCSggbWF0ZXJpYWwuYWxwaGFNYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHx8CiAgICAJCQkJKCBtYXRlcmlhbC5tYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHx8CiAgICAJCQkJKCBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSApIHsKCiAgICAJCQkJLy8gaW4gdGhpcyBjYXNlIHdlIG5lZWQgYSB1bmlxdWUgbWF0ZXJpYWwgaW5zdGFuY2UgcmVmbGVjdGluZyB0aGUKICAgIAkJCQkvLyBhcHByb3ByaWF0ZSBzdGF0ZQoKICAgIAkJCQljb25zdCBrZXlBID0gcmVzdWx0LnV1aWQsIGtleUIgPSBtYXRlcmlhbC51dWlkOwoKICAgIAkJCQlsZXQgbWF0ZXJpYWxzRm9yVmFyaWFudCA9IF9tYXRlcmlhbENhY2hlWyBrZXlBIF07CgogICAgCQkJCWlmICggbWF0ZXJpYWxzRm9yVmFyaWFudCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudCA9IHt9OwogICAgCQkJCQlfbWF0ZXJpYWxDYWNoZVsga2V5QSBdID0gbWF0ZXJpYWxzRm9yVmFyaWFudDsKCiAgICAJCQkJfQoKICAgIAkJCQlsZXQgY2FjaGVkTWF0ZXJpYWwgPSBtYXRlcmlhbHNGb3JWYXJpYW50WyBrZXlCIF07CgogICAgCQkJCWlmICggY2FjaGVkTWF0ZXJpYWwgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCWNhY2hlZE1hdGVyaWFsID0gcmVzdWx0LmNsb25lKCk7CiAgICAJCQkJCW1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXSA9IGNhY2hlZE1hdGVyaWFsOwogICAgCQkJCQltYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uTWF0ZXJpYWxEaXNwb3NlICk7CgogICAgCQkJCX0KCiAgICAJCQkJcmVzdWx0ID0gY2FjaGVkTWF0ZXJpYWw7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmVzdWx0LnZpc2libGUgPSBtYXRlcmlhbC52aXNpYmxlOwogICAgCQlyZXN1bHQud2lyZWZyYW1lID0gbWF0ZXJpYWwud2lyZWZyYW1lOwoKICAgIAkJaWYgKCB0eXBlID09PSBWU01TaGFkb3dNYXAgKSB7CgogICAgCQkJcmVzdWx0LnNpZGUgPSAoIG1hdGVyaWFsLnNoYWRvd1NpZGUgIT09IG51bGwgKSA/IG1hdGVyaWFsLnNoYWRvd1NpZGUgOiBtYXRlcmlhbC5zaWRlOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlyZXN1bHQuc2lkZSA9ICggbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCApID8gbWF0ZXJpYWwuc2hhZG93U2lkZSA6IHNoYWRvd1NpZGVbIG1hdGVyaWFsLnNpZGUgXTsKCiAgICAJCX0KCiAgICAJCXJlc3VsdC5hbHBoYU1hcCA9IG1hdGVyaWFsLmFscGhhTWFwOwogICAgCQlyZXN1bHQuYWxwaGFUZXN0ID0gKCBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSA/IDAuNSA6IG1hdGVyaWFsLmFscGhhVGVzdDsgLy8gYXBwcm94aW1hdGUgYWxwaGFUb0NvdmVyYWdlIGJ5IHVzaW5nIGEgZml4ZWQgYWxwaGFUZXN0IHZhbHVlCiAgICAJCXJlc3VsdC5tYXAgPSBtYXRlcmlhbC5tYXA7CgogICAgCQlyZXN1bHQuY2xpcFNoYWRvd3MgPSBtYXRlcmlhbC5jbGlwU2hhZG93czsKICAgIAkJcmVzdWx0LmNsaXBwaW5nUGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXM7CiAgICAJCXJlc3VsdC5jbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbjsKCiAgICAJCXJlc3VsdC5kaXNwbGFjZW1lbnRNYXAgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CiAgICAJCXJlc3VsdC5kaXNwbGFjZW1lbnRTY2FsZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwogICAgCQlyZXN1bHQuZGlzcGxhY2VtZW50QmlhcyA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgogICAgCQlyZXN1bHQud2lyZWZyYW1lTGluZXdpZHRoID0gbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoOwogICAgCQlyZXN1bHQubGluZXdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKICAgIAkJaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgJiYgcmVzdWx0LmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgPT09IHRydWUgKSB7CgogICAgCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHJlc3VsdCApOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0ID0gbGlnaHQ7CgogICAgCQl9CgogICAgCQlyZXR1cm4gcmVzdWx0OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKSB7CgogICAgCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCiAgICAJCWNvbnN0IHZpc2libGUgPSBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKTsKCiAgICAJCWlmICggdmlzaWJsZSAmJiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSApIHsKCiAgICAJCQlpZiAoICggb2JqZWN0LmNhc3RTaGFkb3cgfHwgKCBvYmplY3QucmVjZWl2ZVNoYWRvdyAmJiB0eXBlID09PSBWU01TaGFkb3dNYXAgKSApICYmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSApICkgewoKICAgIAkJCQlvYmplY3QubW9kZWxWaWV3TWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIHNoYWRvd0NhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKICAgIAkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKICAgIAkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCiAgICAJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKICAgIAkJCQkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKICAgIAkJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IGdyb3Vwcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCiAgICAJCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgayBdOwogICAgCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgogICAgCQkJCQkJaWYgKCBncm91cE1hdGVyaWFsICYmIGdyb3VwTWF0ZXJpYWwudmlzaWJsZSApIHsKCiAgICAJCQkJCQkJY29uc3QgZGVwdGhNYXRlcmlhbCA9IGdldERlcHRoTWF0ZXJpYWwoIG9iamVjdCwgZ3JvdXBNYXRlcmlhbCwgbGlnaHQsIHR5cGUgKTsKCiAgICAJCQkJCQkJb2JqZWN0Lm9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICk7CgogICAgCQkJCQkJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKICAgIAkJCQkJCQlvYmplY3Qub25BZnRlclNoYWRvdyggcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCiAgICAJCQkJCWNvbnN0IGRlcHRoTWF0ZXJpYWwgPSBnZXREZXB0aE1hdGVyaWFsKCBvYmplY3QsIG1hdGVyaWFsLCBsaWdodCwgdHlwZSApOwoKICAgIAkJCQkJb2JqZWN0Lm9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIG51bGwgKTsKCiAgICAJCQkJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBudWxsICk7CgogICAgCQkJCQlvYmplY3Qub25BZnRlclNoYWRvdyggcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBudWxsICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJcmVuZGVyT2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBvbk1hdGVyaWFsRGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQljb25zdCBtYXRlcmlhbCA9IGV2ZW50LnRhcmdldDsKCiAgICAJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCiAgICAJCS8vIG1ha2Ugc3VyZSB0byByZW1vdmUgdGhlIHVuaXF1ZSBkaXN0YW5jZS9kZXB0aCBtYXRlcmlhbHMgdXNlZCBmb3Igc2hhZG93IG1hcCByZW5kZXJpbmcKCiAgICAJCWZvciAoIGNvbnN0IGlkIGluIF9tYXRlcmlhbENhY2hlICkgewoKICAgIAkJCWNvbnN0IGNhY2hlID0gX21hdGVyaWFsQ2FjaGVbIGlkIF07CgogICAgCQkJY29uc3QgdXVpZCA9IGV2ZW50LnRhcmdldC51dWlkOwoKICAgIAkJCWlmICggdXVpZCBpbiBjYWNoZSApIHsKCiAgICAJCQkJY29uc3Qgc2hhZG93TWF0ZXJpYWwgPSBjYWNoZVsgdXVpZCBdOwogICAgCQkJCXNoYWRvd01hdGVyaWFsLmRpc3Bvc2UoKTsKICAgIAkJCQlkZWxldGUgY2FjaGVbIHV1aWQgXTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgcmV2ZXJzZWRGdW5jcyA9IHsKICAgIAlbIE5ldmVyRGVwdGggXTogQWx3YXlzRGVwdGgsCiAgICAJWyBMZXNzRGVwdGggXTogR3JlYXRlckRlcHRoLAogICAgCVsgRXF1YWxEZXB0aCBdOiBOb3RFcXVhbERlcHRoLAogICAgCVsgTGVzc0VxdWFsRGVwdGggXTogR3JlYXRlckVxdWFsRGVwdGgsCgogICAgCVsgQWx3YXlzRGVwdGggXTogTmV2ZXJEZXB0aCwKICAgIAlbIEdyZWF0ZXJEZXB0aCBdOiBMZXNzRGVwdGgsCiAgICAJWyBOb3RFcXVhbERlcHRoIF06IEVxdWFsRGVwdGgsCiAgICAJWyBHcmVhdGVyRXF1YWxEZXB0aCBdOiBMZXNzRXF1YWxEZXB0aCwKICAgIH07CgogICAgZnVuY3Rpb24gV2ViR0xTdGF0ZSggZ2wsIGV4dGVuc2lvbnMgKSB7CgogICAgCWZ1bmN0aW9uIENvbG9yQnVmZmVyKCkgewoKICAgIAkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKICAgIAkJY29uc3QgY29sb3IgPSBuZXcgVmVjdG9yNCgpOwogICAgCQlsZXQgY3VycmVudENvbG9yTWFzayA9IG51bGw7CiAgICAJCWNvbnN0IGN1cnJlbnRDb2xvckNsZWFyID0gbmV3IFZlY3RvcjQoIDAsIDAsIDAsIDAgKTsKCiAgICAJCXJldHVybiB7CgogICAgCQkJc2V0TWFzazogZnVuY3Rpb24gKCBjb2xvck1hc2sgKSB7CgogICAgCQkJCWlmICggY3VycmVudENvbG9yTWFzayAhPT0gY29sb3JNYXNrICYmICEgbG9ja2VkICkgewoKICAgIAkJCQkJZ2wuY29sb3JNYXNrKCBjb2xvck1hc2ssIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2sgKTsKICAgIAkJCQkJY3VycmVudENvbG9yTWFzayA9IGNvbG9yTWFzazsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgogICAgCQkJCWxvY2tlZCA9IGxvY2s7CgogICAgCQkJfSwKCiAgICAJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCByLCBnLCBiLCBhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKSB7CgogICAgCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgewoKICAgIAkJCQkJciAqPSBhOyBnICo9IGE7IGIgKj0gYTsKCiAgICAJCQkJfQoKICAgIAkJCQljb2xvci5zZXQoIHIsIGcsIGIsIGEgKTsKCiAgICAJCQkJaWYgKCBjdXJyZW50Q29sb3JDbGVhci5lcXVhbHMoIGNvbG9yICkgPT09IGZhbHNlICkgewoKICAgIAkJCQkJZ2wuY2xlYXJDb2xvciggciwgZywgYiwgYSApOwogICAgCQkJCQljdXJyZW50Q29sb3JDbGVhci5jb3B5KCBjb2xvciApOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKICAgIAkJCQlsb2NrZWQgPSBmYWxzZTsKCiAgICAJCQkJY3VycmVudENvbG9yTWFzayA9IG51bGw7CiAgICAJCQkJY3VycmVudENvbG9yQ2xlYXIuc2V0KCAtMSwgMCwgMCwgMCApOyAvLyBzZXQgdG8gaW52YWxpZCBzdGF0ZQoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gRGVwdGhCdWZmZXIoKSB7CgogICAgCQlsZXQgbG9ja2VkID0gZmFsc2U7CgogICAgCQlsZXQgY3VycmVudFJldmVyc2VkID0gZmFsc2U7CiAgICAJCWxldCBjdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKICAgIAkJbGV0IGN1cnJlbnREZXB0aEZ1bmMgPSBudWxsOwogICAgCQlsZXQgY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwoKICAgIAkJcmV0dXJuIHsKCiAgICAJCQlzZXRSZXZlcnNlZDogZnVuY3Rpb24gKCByZXZlcnNlZCApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50UmV2ZXJzZWQgIT09IHJldmVyc2VkICkgewoKICAgIAkJCQkJY29uc3QgZXh0ID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfY2xpcF9jb250cm9sJyApOwoKICAgIAkJCQkJaWYgKCByZXZlcnNlZCApIHsKCiAgICAJCQkJCQlleHQuY2xpcENvbnRyb2xFWFQoIGV4dC5MT1dFUl9MRUZUX0VYVCwgZXh0LlpFUk9fVE9fT05FX0VYVCApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlleHQuY2xpcENvbnRyb2xFWFQoIGV4dC5MT1dFUl9MRUZUX0VYVCwgZXh0Lk5FR0FUSVZFX09ORV9UT19PTkVfRVhUICk7CgogICAgCQkJCQl9CgogICAgCQkJCQljdXJyZW50UmV2ZXJzZWQgPSByZXZlcnNlZDsKCiAgICAJCQkJCWNvbnN0IG9sZERlcHRoID0gY3VycmVudERlcHRoQ2xlYXI7CiAgICAJCQkJCWN1cnJlbnREZXB0aENsZWFyID0gbnVsbDsKICAgIAkJCQkJdGhpcy5zZXRDbGVhciggb2xkRGVwdGggKTsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJZ2V0UmV2ZXJzZWQ6IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJcmV0dXJuIGN1cnJlbnRSZXZlcnNlZDsKCiAgICAJCQl9LAoKICAgIAkJCXNldFRlc3Q6IGZ1bmN0aW9uICggZGVwdGhUZXN0ICkgewoKICAgIAkJCQlpZiAoIGRlcHRoVGVzdCApIHsKCiAgICAJCQkJCWVuYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIGRlcHRoTWFzayApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50RGVwdGhNYXNrICE9PSBkZXB0aE1hc2sgJiYgISBsb2NrZWQgKSB7CgogICAgCQkJCQlnbC5kZXB0aE1hc2soIGRlcHRoTWFzayApOwogICAgCQkJCQljdXJyZW50RGVwdGhNYXNrID0gZGVwdGhNYXNrOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIGRlcHRoRnVuYyApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50UmV2ZXJzZWQgKSBkZXB0aEZ1bmMgPSByZXZlcnNlZEZ1bmNzWyBkZXB0aEZ1bmMgXTsKCiAgICAJCQkJaWYgKCBjdXJyZW50RGVwdGhGdW5jICE9PSBkZXB0aEZ1bmMgKSB7CgogICAgCQkJCQlzd2l0Y2ggKCBkZXB0aEZ1bmMgKSB7CgogICAgCQkJCQkJY2FzZSBOZXZlckRlcHRoOgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLk5FVkVSICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBBbHdheXNEZXB0aDoKCiAgICAJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5BTFdBWVMgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIExlc3NEZXB0aDoKCiAgICAJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVNTICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBMZXNzRXF1YWxEZXB0aDoKCiAgICAJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVFVQUwgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIEVxdWFsRGVwdGg6CgogICAgCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuRVFVQUwgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIEdyZWF0ZXJFcXVhbERlcHRoOgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdFUVVBTCApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgR3JlYXRlckRlcHRoOgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdSRUFURVIgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIE5vdEVxdWFsRGVwdGg6CgogICAgCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTk9URVFVQUwgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQlkZWZhdWx0OgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFUVVBTCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJY3VycmVudERlcHRoRnVuYyA9IGRlcHRoRnVuYzsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgogICAgCQkJCWxvY2tlZCA9IGxvY2s7CgogICAgCQkJfSwKCiAgICAJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBkZXB0aCApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50RGVwdGhDbGVhciAhPT0gZGVwdGggKSB7CgogICAgCQkJCQlpZiAoIGN1cnJlbnRSZXZlcnNlZCApIHsKCiAgICAJCQkJCQlkZXB0aCA9IDEgLSBkZXB0aDsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWdsLmNsZWFyRGVwdGgoIGRlcHRoICk7CiAgICAJCQkJCWN1cnJlbnREZXB0aENsZWFyID0gZGVwdGg7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgogICAgCQkJCWxvY2tlZCA9IGZhbHNlOwoKICAgIAkJCQljdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKICAgIAkJCQljdXJyZW50RGVwdGhGdW5jID0gbnVsbDsKICAgIAkJCQljdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CiAgICAJCQkJY3VycmVudFJldmVyc2VkID0gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBTdGVuY2lsQnVmZmVyKCkgewoKICAgIAkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKICAgIAkJbGV0IGN1cnJlbnRTdGVuY2lsTWFzayA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50U3RlbmNpbEZ1bmMgPSBudWxsOwogICAgCQlsZXQgY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwogICAgCQlsZXQgY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50U3RlbmNpbEZhaWwgPSBudWxsOwogICAgCQlsZXQgY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50U3RlbmNpbFpQYXNzID0gbnVsbDsKICAgIAkJbGV0IGN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBudWxsOwoKICAgIAkJcmV0dXJuIHsKCiAgICAJCQlzZXRUZXN0OiBmdW5jdGlvbiAoIHN0ZW5jaWxUZXN0ICkgewoKICAgIAkJCQlpZiAoICEgbG9ja2VkICkgewoKICAgIAkJCQkJaWYgKCBzdGVuY2lsVGVzdCApIHsKCiAgICAJCQkJCQllbmFibGUoIGdsLlNURU5DSUxfVEVTVCApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlkaXNhYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJc2V0TWFzazogZnVuY3Rpb24gKCBzdGVuY2lsTWFzayApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50U3RlbmNpbE1hc2sgIT09IHN0ZW5jaWxNYXNrICYmICEgbG9ja2VkICkgewoKICAgIAkJCQkJZ2wuc3RlbmNpbE1hc2soIHN0ZW5jaWxNYXNrICk7CiAgICAJCQkJCWN1cnJlbnRTdGVuY2lsTWFzayA9IHN0ZW5jaWxNYXNrOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIHN0ZW5jaWxGdW5jLCBzdGVuY2lsUmVmLCBzdGVuY2lsTWFzayApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZ1bmMgIT09IHN0ZW5jaWxGdW5jIHx8CiAgICAJCQkJICAgICBjdXJyZW50U3RlbmNpbFJlZiAhPT0gc3RlbmNpbFJlZiB8fAogICAgCQkJCSAgICAgY3VycmVudFN0ZW5jaWxGdW5jTWFzayAhPT0gc3RlbmNpbE1hc2sgKSB7CgogICAgCQkJCQlnbC5zdGVuY2lsRnVuYyggc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrICk7CgogICAgCQkJCQljdXJyZW50U3RlbmNpbEZ1bmMgPSBzdGVuY2lsRnVuYzsKICAgIAkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBzdGVuY2lsUmVmOwogICAgCQkJCQljdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gc3RlbmNpbE1hc2s7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXNldE9wOiBmdW5jdGlvbiAoIHN0ZW5jaWxGYWlsLCBzdGVuY2lsWkZhaWwsIHN0ZW5jaWxaUGFzcyApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZhaWwgIT09IHN0ZW5jaWxGYWlsIHx8CiAgICAJCQkJICAgICBjdXJyZW50U3RlbmNpbFpGYWlsICE9PSBzdGVuY2lsWkZhaWwgfHwKICAgIAkJCQkgICAgIGN1cnJlbnRTdGVuY2lsWlBhc3MgIT09IHN0ZW5jaWxaUGFzcyApIHsKCiAgICAJCQkJCWdsLnN0ZW5jaWxPcCggc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzICk7CgogICAgCQkJCQljdXJyZW50U3RlbmNpbEZhaWwgPSBzdGVuY2lsRmFpbDsKICAgIAkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IHN0ZW5jaWxaRmFpbDsKICAgIAkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IHN0ZW5jaWxaUGFzczsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgogICAgCQkJCWxvY2tlZCA9IGxvY2s7CgogICAgCQkJfSwKCiAgICAJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBzdGVuY2lsICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsQ2xlYXIgIT09IHN0ZW5jaWwgKSB7CgogICAgCQkJCQlnbC5jbGVhclN0ZW5jaWwoIHN0ZW5jaWwgKTsKICAgIAkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IHN0ZW5jaWw7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgogICAgCQkJCWxvY2tlZCA9IGZhbHNlOwoKICAgIAkJCQljdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwogICAgCQkJCWN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwogICAgCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwogICAgCQkJCWN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJfQoKICAgIAkvLwoKICAgIAljb25zdCBjb2xvckJ1ZmZlciA9IG5ldyBDb2xvckJ1ZmZlcigpOwogICAgCWNvbnN0IGRlcHRoQnVmZmVyID0gbmV3IERlcHRoQnVmZmVyKCk7CiAgICAJY29uc3Qgc3RlbmNpbEJ1ZmZlciA9IG5ldyBTdGVuY2lsQnVmZmVyKCk7CgogICAgCWNvbnN0IHVib0JpbmRpbmdzID0gbmV3IFdlYWtNYXAoKTsKICAgIAljb25zdCB1Ym9Qcm9ncmFtTWFwID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJbGV0IGVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKCiAgICAJbGV0IGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVycyA9IHt9OwogICAgCWxldCBjdXJyZW50RHJhd2J1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwogICAgCWxldCBkZWZhdWx0RHJhd2J1ZmZlcnMgPSBbXTsKCiAgICAJbGV0IGN1cnJlbnRQcm9ncmFtID0gbnVsbDsKCiAgICAJbGV0IGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKICAgIAlsZXQgY3VycmVudEJsZW5kaW5nID0gbnVsbDsKICAgIAlsZXQgY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwogICAgCWxldCBjdXJyZW50QmxlbmRTcmMgPSBudWxsOwogICAgCWxldCBjdXJyZW50QmxlbmREc3QgPSBudWxsOwogICAgCWxldCBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKICAgIAlsZXQgY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwogICAgCWxldCBjdXJyZW50QmxlbmREc3RBbHBoYSA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCbGVuZENvbG9yID0gbmV3IENvbG9yKCAwLCAwLCAwICk7CiAgICAJbGV0IGN1cnJlbnRCbGVuZEFscGhhID0gMDsKICAgIAlsZXQgY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gZmFsc2U7CgogICAgCWxldCBjdXJyZW50RmxpcFNpZGVkID0gbnVsbDsKICAgIAlsZXQgY3VycmVudEN1bGxGYWNlID0gbnVsbDsKCiAgICAJbGV0IGN1cnJlbnRMaW5lV2lkdGggPSBudWxsOwoKICAgIAlsZXQgY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBudWxsOwogICAgCWxldCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gbnVsbDsKCiAgICAJY29uc3QgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9DT01CSU5FRF9URVhUVVJFX0lNQUdFX1VOSVRTICk7CgogICAgCWxldCBsaW5lV2lkdGhBdmFpbGFibGUgPSBmYWxzZTsKICAgIAlsZXQgdmVyc2lvbiA9IDA7CiAgICAJY29uc3QgZ2xWZXJzaW9uID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5WRVJTSU9OICk7CgogICAgCWlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdXZWJHTCcgKSAhPT0gLTEgKSB7CgogICAgCQl2ZXJzaW9uID0gcGFyc2VGbG9hdCggL15XZWJHTCAoXGQpLy5leGVjKCBnbFZlcnNpb24gKVsgMSBdICk7CiAgICAJCWxpbmVXaWR0aEF2YWlsYWJsZSA9ICggdmVyc2lvbiA+PSAxLjAgKTsKCiAgICAJfSBlbHNlIGlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdPcGVuR0wgRVMnICkgIT09IC0xICkgewoKICAgIAkJdmVyc2lvbiA9IHBhcnNlRmxvYXQoIC9eT3BlbkdMIEVTIChcZCkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKICAgIAkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDIuMCApOwoKICAgIAl9CgogICAgCWxldCBjdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwogICAgCWxldCBjdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKICAgIAljb25zdCBzY2lzc29yUGFyYW0gPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLlNDSVNTT1JfQk9YICk7CiAgICAJY29uc3Qgdmlld3BvcnRQYXJhbSA9IGdsLmdldFBhcmFtZXRlciggZ2wuVklFV1BPUlQgKTsKCiAgICAJY29uc3QgY3VycmVudFNjaXNzb3IgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggc2Npc3NvclBhcmFtICk7CiAgICAJY29uc3QgY3VycmVudFZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKS5mcm9tQXJyYXkoIHZpZXdwb3J0UGFyYW0gKTsKCiAgICAJZnVuY3Rpb24gY3JlYXRlVGV4dHVyZSggdHlwZSwgdGFyZ2V0LCBjb3VudCwgZGltZW5zaW9ucyApIHsKCiAgICAJCWNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSggNCApOyAvLyA0IGlzIHJlcXVpcmVkIHRvIG1hdGNoIGRlZmF1bHQgdW5wYWNrIGFsaWdubWVudCBvZiA0LgogICAgCQljb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpOwoKICAgIAkJZ2wuYmluZFRleHR1cmUoIHR5cGUsIHRleHR1cmUgKTsKICAgIAkJZ2wudGV4UGFyYW1ldGVyaSggdHlwZSwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUICk7CiAgICAJCWdsLnRleFBhcmFtZXRlcmkoIHR5cGUsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVCApOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgogICAgCQkJaWYgKCB0eXBlID09PSBnbC5URVhUVVJFXzNEIHx8IHR5cGUgPT09IGdsLlRFWFRVUkVfMkRfQVJSQVkgKSB7CgogICAgCQkJCWdsLnRleEltYWdlM0QoIHRhcmdldCwgMCwgZ2wuUkdCQSwgMSwgMSwgZGltZW5zaW9ucywgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgZGF0YSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWdsLnRleEltYWdlMkQoIHRhcmdldCArIGksIDAsIGdsLlJHQkEsIDEsIDEsIDAsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIGRhdGEgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGV4dHVyZTsKCiAgICAJfQoKICAgIAljb25zdCBlbXB0eVRleHR1cmVzID0ge307CiAgICAJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV8yRCBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV8yRCwgMSApOwogICAgCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfQ1VCRV9NQVAgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCwgNiApOwogICAgCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfMkRfQVJSQVkgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfMkRfQVJSQVksIGdsLlRFWFRVUkVfMkRfQVJSQVksIDEsIDEgKTsKICAgIAllbXB0eVRleHR1cmVzWyBnbC5URVhUVVJFXzNEIF0gPSBjcmVhdGVUZXh0dXJlKCBnbC5URVhUVVJFXzNELCBnbC5URVhUVVJFXzNELCAxLCAxICk7CgogICAgCS8vIGluaXQKCiAgICAJY29sb3JCdWZmZXIuc2V0Q2xlYXIoIDAsIDAsIDAsIDEgKTsKICAgIAlkZXB0aEJ1ZmZlci5zZXRDbGVhciggMSApOwogICAgCXN0ZW5jaWxCdWZmZXIuc2V0Q2xlYXIoIDAgKTsKCiAgICAJZW5hYmxlKCBnbC5ERVBUSF9URVNUICk7CiAgICAJZGVwdGhCdWZmZXIuc2V0RnVuYyggTGVzc0VxdWFsRGVwdGggKTsKCiAgICAJc2V0RmxpcFNpZGVkKCBmYWxzZSApOwogICAgCXNldEN1bGxGYWNlKCBDdWxsRmFjZUJhY2sgKTsKICAgIAllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKICAgIAlzZXRCbGVuZGluZyggTm9CbGVuZGluZyApOwoKICAgIAkvLwoKICAgIAlmdW5jdGlvbiBlbmFibGUoIGlkICkgewoKICAgIAkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSB0cnVlICkgewoKICAgIAkJCWdsLmVuYWJsZSggaWQgKTsKICAgIAkJCWVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gPSB0cnVlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc2FibGUoIGlkICkgewoKICAgIAkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSBmYWxzZSApIHsKCiAgICAJCQlnbC5kaXNhYmxlKCBpZCApOwogICAgCQkJZW5hYmxlZENhcGFiaWxpdGllc1sgaWQgXSA9IGZhbHNlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGJpbmRGcmFtZWJ1ZmZlciggdGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCiAgICAJCWlmICggY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSAhPT0gZnJhbWVidWZmZXIgKSB7CgogICAgCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCB0YXJnZXQsIGZyYW1lYnVmZmVyICk7CgogICAgCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSA9IGZyYW1lYnVmZmVyOwoKICAgIAkJCS8vIGdsLkRSQVdfRlJBTUVCVUZGRVIgaXMgZXF1aXZhbGVudCB0byBnbC5GUkFNRUJVRkZFUgoKICAgIAkJCWlmICggdGFyZ2V0ID09PSBnbC5EUkFXX0ZSQU1FQlVGRkVSICkgewoKICAgIAkJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIGdsLkZSQU1FQlVGRkVSIF0gPSBmcmFtZWJ1ZmZlcjsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0YXJnZXQgPT09IGdsLkZSQU1FQlVGRkVSICkgewoKICAgIAkJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIGdsLkRSQVdfRlJBTUVCVUZGRVIgXSA9IGZyYW1lYnVmZmVyOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBmYWxzZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkcmF3QnVmZmVycyggcmVuZGVyVGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCiAgICAJCWxldCBkcmF3QnVmZmVycyA9IGRlZmF1bHREcmF3YnVmZmVyczsKCiAgICAJCWxldCBuZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQkJZHJhd0J1ZmZlcnMgPSBjdXJyZW50RHJhd2J1ZmZlcnMuZ2V0KCBmcmFtZWJ1ZmZlciApOwoKICAgIAkJCWlmICggZHJhd0J1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJZHJhd0J1ZmZlcnMgPSBbXTsKICAgIAkJCQljdXJyZW50RHJhd2J1ZmZlcnMuc2V0KCBmcmFtZWJ1ZmZlciwgZHJhd0J1ZmZlcnMgKTsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgogICAgCQkJaWYgKCBkcmF3QnVmZmVycy5sZW5ndGggIT09IHRleHR1cmVzLmxlbmd0aCB8fCBkcmF3QnVmZmVyc1sgMCBdICE9PSBnbC5DT0xPUl9BVFRBQ0hNRU5UMCApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJZHJhd0J1ZmZlcnNbIGkgXSA9IGdsLkNPTE9SX0FUVEFDSE1FTlQwICsgaTsKCiAgICAJCQkJfQoKICAgIAkJCQlkcmF3QnVmZmVycy5sZW5ndGggPSB0ZXh0dXJlcy5sZW5ndGg7CgogICAgCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggZHJhd0J1ZmZlcnNbIDAgXSAhPT0gZ2wuQkFDSyApIHsKCiAgICAJCQkJZHJhd0J1ZmZlcnNbIDAgXSA9IGdsLkJBQ0s7CgogICAgCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIG5lZWRzVXBkYXRlICkgewoKICAgIAkJCWdsLmRyYXdCdWZmZXJzKCBkcmF3QnVmZmVycyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVzZVByb2dyYW0oIHByb2dyYW0gKSB7CgogICAgCQlpZiAoIGN1cnJlbnRQcm9ncmFtICE9PSBwcm9ncmFtICkgewoKICAgIAkJCWdsLnVzZVByb2dyYW0oIHByb2dyYW0gKTsKCiAgICAJCQljdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CgogICAgCQkJcmV0dXJuIHRydWU7CgogICAgCQl9CgogICAgCQlyZXR1cm4gZmFsc2U7CgogICAgCX0KCiAgICAJY29uc3QgZXF1YXRpb25Ub0dMID0gewogICAgCQlbIEFkZEVxdWF0aW9uIF06IGdsLkZVTkNfQURELAogICAgCQlbIFN1YnRyYWN0RXF1YXRpb24gXTogZ2wuRlVOQ19TVUJUUkFDVCwKICAgIAkJWyBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiBdOiBnbC5GVU5DX1JFVkVSU0VfU1VCVFJBQ1QKICAgIAl9OwoKICAgIAllcXVhdGlvblRvR0xbIE1pbkVxdWF0aW9uIF0gPSBnbC5NSU47CiAgICAJZXF1YXRpb25Ub0dMWyBNYXhFcXVhdGlvbiBdID0gZ2wuTUFYOwoKICAgIAljb25zdCBmYWN0b3JUb0dMID0gewogICAgCQlbIFplcm9GYWN0b3IgXTogZ2wuWkVSTywKICAgIAkJWyBPbmVGYWN0b3IgXTogZ2wuT05FLAogICAgCQlbIFNyY0NvbG9yRmFjdG9yIF06IGdsLlNSQ19DT0xPUiwKICAgIAkJWyBTcmNBbHBoYUZhY3RvciBdOiBnbC5TUkNfQUxQSEEsCiAgICAJCVsgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciBdOiBnbC5TUkNfQUxQSEFfU0FUVVJBVEUsCiAgICAJCVsgRHN0Q29sb3JGYWN0b3IgXTogZ2wuRFNUX0NPTE9SLAogICAgCQlbIERzdEFscGhhRmFjdG9yIF06IGdsLkRTVF9BTFBIQSwKICAgIAkJWyBPbmVNaW51c1NyY0NvbG9yRmFjdG9yIF06IGdsLk9ORV9NSU5VU19TUkNfQ09MT1IsCiAgICAJCVsgT25lTWludXNTcmNBbHBoYUZhY3RvciBdOiBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLAogICAgCQlbIE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0RTVF9DT0xPUiwKICAgIAkJWyBPbmVNaW51c0RzdEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19EU1RfQUxQSEEsCiAgICAJCVsgQ29uc3RhbnRDb2xvckZhY3RvciBdOiBnbC5DT05TVEFOVF9DT0xPUiwKICAgIAkJWyBPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0NPTlNUQU5UX0NPTE9SLAogICAgCQlbIENvbnN0YW50QWxwaGFGYWN0b3IgXTogZ2wuQ09OU1RBTlRfQUxQSEEsCiAgICAJCVsgT25lTWludXNDb25zdGFudEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19DT05TVEFOVF9BTFBIQQogICAgCX07CgogICAgCWZ1bmN0aW9uIHNldEJsZW5kaW5nKCBibGVuZGluZywgYmxlbmRFcXVhdGlvbiwgYmxlbmRTcmMsIGJsZW5kRHN0LCBibGVuZEVxdWF0aW9uQWxwaGEsIGJsZW5kU3JjQWxwaGEsIGJsZW5kRHN0QWxwaGEsIGJsZW5kQ29sb3IsIGJsZW5kQWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCiAgICAJCWlmICggYmxlbmRpbmcgPT09IE5vQmxlbmRpbmcgKSB7CgogICAgCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSB0cnVlICkgewoKICAgIAkJCQlkaXNhYmxlKCBnbC5CTEVORCApOwogICAgCQkJCWN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSBmYWxzZSApIHsKCiAgICAJCQllbmFibGUoIGdsLkJMRU5EICk7CiAgICAJCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCWlmICggYmxlbmRpbmcgIT09IEN1c3RvbUJsZW5kaW5nICkgewoKICAgIAkJCWlmICggYmxlbmRpbmcgIT09IGN1cnJlbnRCbGVuZGluZyB8fCBwcmVtdWx0aXBsaWVkQWxwaGEgIT09IGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50QmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gfHwgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSAhPT0gQWRkRXF1YXRpb24gKSB7CgogICAgCQkJCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwoKICAgIAkJCQkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBBZGRFcXVhdGlvbjsKICAgIAkJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IEFkZEVxdWF0aW9uOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhICkgewoKICAgIAkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgogICAgCQkJCQkJY2FzZSBOb3JtYWxCbGVuZGluZzoKICAgIAkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIEFkZGl0aXZlQmxlbmRpbmc6CiAgICAJCQkJCQkJZ2wuYmxlbmRGdW5jKCBnbC5PTkUsIGdsLk9ORSApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgU3VidHJhY3RpdmVCbGVuZGluZzoKICAgIAkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwgZ2wuWkVSTywgZ2wuT05FICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBNdWx0aXBseUJsZW5kaW5nOgogICAgCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5EU1RfQ09MT1IsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLlpFUk8sIGdsLk9ORSApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWRlZmF1bHQ6CiAgICAJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6IEludmFsaWQgYmxlbmRpbmc6ICcsIGJsZW5kaW5nICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQl9CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlzd2l0Y2ggKCBibGVuZGluZyApIHsKCiAgICAJCQkJCQljYXNlIE5vcm1hbEJsZW5kaW5nOgogICAgCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5TUkNfQUxQSEEsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKICAgIAkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORSwgZ2wuT05FICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgogICAgCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBTdWJ0cmFjdGl2ZUJsZW5kaW5nIHJlcXVpcmVzIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUnICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBNdWx0aXBseUJsZW5kaW5nOgogICAgCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBNdWx0aXBseUJsZW5kaW5nIHJlcXVpcmVzIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUnICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJZGVmYXVsdDoKICAgIAkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTogSW52YWxpZCBibGVuZGluZzogJywgYmxlbmRpbmcgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCQljdXJyZW50QmxlbmRTcmMgPSBudWxsOwogICAgCQkJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CiAgICAJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwogICAgCQkJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKICAgIAkJCQljdXJyZW50QmxlbmRDb2xvci5zZXQoIDAsIDAsIDAgKTsKICAgIAkJCQljdXJyZW50QmxlbmRBbHBoYSA9IDA7CgogICAgCQkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwogICAgCQkJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IHByZW11bHRpcGxpZWRBbHBoYTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJLy8gY3VzdG9tIGJsZW5kaW5nCgogICAgCQlibGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGEgfHwgYmxlbmRFcXVhdGlvbjsKICAgIAkJYmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGEgfHwgYmxlbmRTcmM7CiAgICAJCWJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhIHx8IGJsZW5kRHN0OwoKICAgIAkJaWYgKCBibGVuZEVxdWF0aW9uICE9PSBjdXJyZW50QmxlbmRFcXVhdGlvbiB8fCBibGVuZEVxdWF0aW9uQWxwaGEgIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgKSB7CgogICAgCQkJZ2wuYmxlbmRFcXVhdGlvblNlcGFyYXRlKCBlcXVhdGlvblRvR0xbIGJsZW5kRXF1YXRpb24gXSwgZXF1YXRpb25Ub0dMWyBibGVuZEVxdWF0aW9uQWxwaGEgXSApOwoKICAgIAkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gYmxlbmRFcXVhdGlvbjsKICAgIAkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGE7CgogICAgCQl9CgogICAgCQlpZiAoIGJsZW5kU3JjICE9PSBjdXJyZW50QmxlbmRTcmMgfHwgYmxlbmREc3QgIT09IGN1cnJlbnRCbGVuZERzdCB8fCBibGVuZFNyY0FscGhhICE9PSBjdXJyZW50QmxlbmRTcmNBbHBoYSB8fCBibGVuZERzdEFscGhhICE9PSBjdXJyZW50QmxlbmREc3RBbHBoYSApIHsKCiAgICAJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZmFjdG9yVG9HTFsgYmxlbmRTcmMgXSwgZmFjdG9yVG9HTFsgYmxlbmREc3QgXSwgZmFjdG9yVG9HTFsgYmxlbmRTcmNBbHBoYSBdLCBmYWN0b3JUb0dMWyBibGVuZERzdEFscGhhIF0gKTsKCiAgICAJCQljdXJyZW50QmxlbmRTcmMgPSBibGVuZFNyYzsKICAgIAkJCWN1cnJlbnRCbGVuZERzdCA9IGJsZW5kRHN0OwogICAgCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBibGVuZFNyY0FscGhhOwogICAgCQkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhOwoKICAgIAkJfQoKICAgIAkJaWYgKCBibGVuZENvbG9yLmVxdWFscyggY3VycmVudEJsZW5kQ29sb3IgKSA9PT0gZmFsc2UgfHwgYmxlbmRBbHBoYSAhPT0gY3VycmVudEJsZW5kQWxwaGEgKSB7CgogICAgCQkJZ2wuYmxlbmRDb2xvciggYmxlbmRDb2xvci5yLCBibGVuZENvbG9yLmcsIGJsZW5kQ29sb3IuYiwgYmxlbmRBbHBoYSApOwoKICAgIAkJCWN1cnJlbnRCbGVuZENvbG9yLmNvcHkoIGJsZW5kQ29sb3IgKTsKICAgIAkJCWN1cnJlbnRCbGVuZEFscGhhID0gYmxlbmRBbHBoYTsKCiAgICAJCX0KCiAgICAJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwogICAgCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXRNYXRlcmlhbCggbWF0ZXJpYWwsIGZyb250RmFjZUNXICkgewoKICAgIAkJbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZQogICAgCQkJPyBkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKQogICAgCQkJOiBlbmFibGUoIGdsLkNVTExfRkFDRSApOwoKICAgIAkJbGV0IGZsaXBTaWRlZCA9ICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKTsKICAgIAkJaWYgKCBmcm9udEZhY2VDVyApIGZsaXBTaWRlZCA9ICEgZmxpcFNpZGVkOwoKICAgIAkJc2V0RmxpcFNpZGVkKCBmbGlwU2lkZWQgKTsKCiAgICAJCSggbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSBmYWxzZSApCiAgICAJCQk/IHNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICkKICAgIAkJCTogc2V0QmxlbmRpbmcoIG1hdGVyaWFsLmJsZW5kaW5nLCBtYXRlcmlhbC5ibGVuZEVxdWF0aW9uLCBtYXRlcmlhbC5ibGVuZFNyYywgbWF0ZXJpYWwuYmxlbmREc3QsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb25BbHBoYSwgbWF0ZXJpYWwuYmxlbmRTcmNBbHBoYSwgbWF0ZXJpYWwuYmxlbmREc3RBbHBoYSwgbWF0ZXJpYWwuYmxlbmRDb2xvciwgbWF0ZXJpYWwuYmxlbmRBbHBoYSwgbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhICk7CgogICAgCQlkZXB0aEJ1ZmZlci5zZXRGdW5jKCBtYXRlcmlhbC5kZXB0aEZ1bmMgKTsKICAgIAkJZGVwdGhCdWZmZXIuc2V0VGVzdCggbWF0ZXJpYWwuZGVwdGhUZXN0ICk7CiAgICAJCWRlcHRoQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLmRlcHRoV3JpdGUgKTsKICAgIAkJY29sb3JCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuY29sb3JXcml0ZSApOwoKICAgIAkJY29uc3Qgc3RlbmNpbFdyaXRlID0gbWF0ZXJpYWwuc3RlbmNpbFdyaXRlOwogICAgCQlzdGVuY2lsQnVmZmVyLnNldFRlc3QoIHN0ZW5jaWxXcml0ZSApOwogICAgCQlpZiAoIHN0ZW5jaWxXcml0ZSApIHsKCiAgICAJCQlzdGVuY2lsQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLnN0ZW5jaWxXcml0ZU1hc2sgKTsKICAgIAkJCXN0ZW5jaWxCdWZmZXIuc2V0RnVuYyggbWF0ZXJpYWwuc3RlbmNpbEZ1bmMsIG1hdGVyaWFsLnN0ZW5jaWxSZWYsIG1hdGVyaWFsLnN0ZW5jaWxGdW5jTWFzayApOwogICAgCQkJc3RlbmNpbEJ1ZmZlci5zZXRPcCggbWF0ZXJpYWwuc3RlbmNpbEZhaWwsIG1hdGVyaWFsLnN0ZW5jaWxaRmFpbCwgbWF0ZXJpYWwuc3RlbmNpbFpQYXNzICk7CgogICAgCQl9CgogICAgCQlzZXRQb2x5Z29uT2Zmc2V0KCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0LCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0RmFjdG9yLCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0VW5pdHMgKTsKCiAgICAJCW1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gdHJ1ZQogICAgCQkJPyBlbmFibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApCiAgICAJCQk6IGRpc2FibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApOwoKICAgIAl9CgogICAgCS8vCgogICAgCWZ1bmN0aW9uIHNldEZsaXBTaWRlZCggZmxpcFNpZGVkICkgewoKICAgIAkJaWYgKCBjdXJyZW50RmxpcFNpZGVkICE9PSBmbGlwU2lkZWQgKSB7CgogICAgCQkJaWYgKCBmbGlwU2lkZWQgKSB7CgogICAgCQkJCWdsLmZyb250RmFjZSggZ2wuQ1cgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKICAgIAkJCX0KCiAgICAJCQljdXJyZW50RmxpcFNpZGVkID0gZmxpcFNpZGVkOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldEN1bGxGYWNlKCBjdWxsRmFjZSApIHsKCiAgICAJCWlmICggY3VsbEZhY2UgIT09IEN1bGxGYWNlTm9uZSApIHsKCiAgICAJCQllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKICAgIAkJCWlmICggY3VsbEZhY2UgIT09IGN1cnJlbnRDdWxsRmFjZSApIHsKCiAgICAJCQkJaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VCYWNrICkgewoKICAgIAkJCQkJZ2wuY3VsbEZhY2UoIGdsLkJBQ0sgKTsKCiAgICAJCQkJfSBlbHNlIGlmICggY3VsbEZhY2UgPT09IEN1bGxGYWNlRnJvbnQgKSB7CgogICAgCQkJCQlnbC5jdWxsRmFjZSggZ2wuRlJPTlQgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWdsLmN1bGxGYWNlKCBnbC5GUk9OVF9BTkRfQkFDSyApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCiAgICAJCX0KCiAgICAJCWN1cnJlbnRDdWxsRmFjZSA9IGN1bGxGYWNlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldExpbmVXaWR0aCggd2lkdGggKSB7CgogICAgCQlpZiAoIHdpZHRoICE9PSBjdXJyZW50TGluZVdpZHRoICkgewoKICAgIAkJCWlmICggbGluZVdpZHRoQXZhaWxhYmxlICkgZ2wubGluZVdpZHRoKCB3aWR0aCApOwoKICAgIAkJCWN1cnJlbnRMaW5lV2lkdGggPSB3aWR0aDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXRQb2x5Z29uT2Zmc2V0KCBwb2x5Z29uT2Zmc2V0LCBmYWN0b3IsIHVuaXRzICkgewoKICAgIAkJaWYgKCBwb2x5Z29uT2Zmc2V0ICkgewoKICAgIAkJCWVuYWJsZSggZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCApOwoKICAgIAkJCWlmICggY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgIT09IGZhY3RvciB8fCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzICE9PSB1bml0cyApIHsKCiAgICAJCQkJZ2wucG9seWdvbk9mZnNldCggZmFjdG9yLCB1bml0cyApOwoKICAgIAkJCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IGZhY3RvcjsKICAgIAkJCQljdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gdW5pdHM7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlkaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0U2Npc3NvclRlc3QoIHNjaXNzb3JUZXN0ICkgewoKICAgIAkJaWYgKCBzY2lzc29yVGVzdCApIHsKCiAgICAJCQllbmFibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlkaXNhYmxlKCBnbC5TQ0lTU09SX1RFU1QgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvLyB0ZXh0dXJlCgogICAgCWZ1bmN0aW9uIGFjdGl2ZVRleHR1cmUoIHdlYmdsU2xvdCApIHsKCiAgICAJCWlmICggd2ViZ2xTbG90ID09PSB1bmRlZmluZWQgKSB3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCiAgICAJCWlmICggY3VycmVudFRleHR1cmVTbG90ICE9PSB3ZWJnbFNsb3QgKSB7CgogICAgCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CiAgICAJCQljdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYmluZFRleHR1cmUoIHdlYmdsVHlwZSwgd2ViZ2xUZXh0dXJlLCB3ZWJnbFNsb3QgKSB7CgogICAgCQlpZiAoIHdlYmdsU2xvdCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWlmICggY3VycmVudFRleHR1cmVTbG90ID09PSBudWxsICkgewoKICAgIAkJCQl3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl3ZWJnbFNsb3QgPSBjdXJyZW50VGV4dHVyZVNsb3Q7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJbGV0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzWyB3ZWJnbFNsb3QgXTsKCiAgICAJCWlmICggYm91bmRUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJYm91bmRUZXh0dXJlID0geyB0eXBlOiB1bmRlZmluZWQsIHRleHR1cmU6IHVuZGVmaW5lZCB9OwogICAgCQkJY3VycmVudEJvdW5kVGV4dHVyZXNbIHdlYmdsU2xvdCBdID0gYm91bmRUZXh0dXJlOwoKICAgIAkJfQoKICAgIAkJaWYgKCBib3VuZFRleHR1cmUudHlwZSAhPT0gd2ViZ2xUeXBlIHx8IGJvdW5kVGV4dHVyZS50ZXh0dXJlICE9PSB3ZWJnbFRleHR1cmUgKSB7CgogICAgCQkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCiAgICAJCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CiAgICAJCQkJY3VycmVudFRleHR1cmVTbG90ID0gd2ViZ2xTbG90OwoKICAgIAkJCX0KCiAgICAJCQlnbC5iaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUgfHwgZW1wdHlUZXh0dXJlc1sgd2ViZ2xUeXBlIF0gKTsKCiAgICAJCQlib3VuZFRleHR1cmUudHlwZSA9IHdlYmdsVHlwZTsKICAgIAkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gd2ViZ2xUZXh0dXJlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVuYmluZFRleHR1cmUoKSB7CgogICAgCQljb25zdCBib3VuZFRleHR1cmUgPSBjdXJyZW50Qm91bmRUZXh0dXJlc1sgY3VycmVudFRleHR1cmVTbG90IF07CgogICAgCQlpZiAoIGJvdW5kVGV4dHVyZSAhPT0gdW5kZWZpbmVkICYmIGJvdW5kVGV4dHVyZS50eXBlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJZ2wuYmluZFRleHR1cmUoIGJvdW5kVGV4dHVyZS50eXBlLCBudWxsICk7CgogICAgCQkJYm91bmRUZXh0dXJlLnR5cGUgPSB1bmRlZmluZWQ7CiAgICAJCQlib3VuZFRleHR1cmUudGV4dHVyZSA9IHVuZGVmaW5lZDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBjb21wcmVzc2VkVGV4SW1hZ2UyRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wuY29tcHJlc3NlZFRleEltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gY29tcHJlc3NlZFRleEltYWdlM0QoKSB7CgogICAgCQl0cnkgewoKICAgIAkJCWdsLmNvbXByZXNzZWRUZXhJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHRleFN1YkltYWdlMkQoKSB7CgogICAgCQl0cnkgewoKICAgIAkJCWdsLnRleFN1YkltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4U3ViSW1hZ2UzRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wudGV4U3ViSW1hZ2UzRCggLi4uYXJndW1lbnRzICk7CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gY29tcHJlc3NlZFRleFN1YkltYWdlM0QoKSB7CgogICAgCQl0cnkgewoKICAgIAkJCWdsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHRleFN0b3JhZ2UyRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wudGV4U3RvcmFnZTJEKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHRleFN0b3JhZ2UzRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wudGV4U3RvcmFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHRleEltYWdlMkQoKSB7CgogICAgCQl0cnkgewoKICAgIAkJCWdsLnRleEltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4SW1hZ2UzRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wudGV4SW1hZ2UzRCggLi4uYXJndW1lbnRzICk7CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvLwoKICAgIAlmdW5jdGlvbiBzY2lzc29yKCBzY2lzc29yICkgewoKICAgIAkJaWYgKCBjdXJyZW50U2Npc3Nvci5lcXVhbHMoIHNjaXNzb3IgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJZ2wuc2Npc3Nvciggc2Npc3Nvci54LCBzY2lzc29yLnksIHNjaXNzb3Iueiwgc2Npc3Nvci53ICk7CiAgICAJCQljdXJyZW50U2Npc3Nvci5jb3B5KCBzY2lzc29yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdmlld3BvcnQoIHZpZXdwb3J0ICkgewoKICAgIAkJaWYgKCBjdXJyZW50Vmlld3BvcnQuZXF1YWxzKCB2aWV3cG9ydCApID09PSBmYWxzZSApIHsKCiAgICAJCQlnbC52aWV3cG9ydCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQueiwgdmlld3BvcnQudyApOwogICAgCQkJY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlVUJPTWFwcGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCiAgICAJCWxldCBtYXBwaW5nID0gdWJvUHJvZ3JhbU1hcC5nZXQoIHByb2dyYW0gKTsKCiAgICAJCWlmICggbWFwcGluZyA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCW1hcHBpbmcgPSBuZXcgV2Vha01hcCgpOwoKICAgIAkJCXVib1Byb2dyYW1NYXAuc2V0KCBwcm9ncmFtLCBtYXBwaW5nICk7CgogICAgCQl9CgogICAgCQlsZXQgYmxvY2tJbmRleCA9IG1hcHBpbmcuZ2V0KCB1bmlmb3Jtc0dyb3VwICk7CgogICAgCQlpZiAoIGJsb2NrSW5kZXggPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlibG9ja0luZGV4ID0gZ2wuZ2V0VW5pZm9ybUJsb2NrSW5kZXgoIHByb2dyYW0sIHVuaWZvcm1zR3JvdXAubmFtZSApOwoKICAgIAkJCW1hcHBpbmcuc2V0KCB1bmlmb3Jtc0dyb3VwLCBibG9ja0luZGV4ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCiAgICAJCWNvbnN0IG1hcHBpbmcgPSB1Ym9Qcm9ncmFtTWFwLmdldCggcHJvZ3JhbSApOwogICAgCQljb25zdCBibG9ja0luZGV4ID0gbWFwcGluZy5nZXQoIHVuaWZvcm1zR3JvdXAgKTsKCiAgICAJCWlmICggdWJvQmluZGluZ3MuZ2V0KCBwcm9ncmFtICkgIT09IGJsb2NrSW5kZXggKSB7CgogICAgCQkJLy8gYmluZCBzaGFkZXIgc3BlY2lmaWMgYmxvY2sgaW5kZXggdG8gZ2xvYmFsIGJsb2NrIHBvaW50CiAgICAJCQlnbC51bmlmb3JtQmxvY2tCaW5kaW5nKCBwcm9ncmFtLCBibG9ja0luZGV4LCB1bmlmb3Jtc0dyb3VwLl9fYmluZGluZ1BvaW50SW5kZXggKTsKCiAgICAJCQl1Ym9CaW5kaW5ncy5zZXQoIHByb2dyYW0sIGJsb2NrSW5kZXggKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvLwoKICAgIAlmdW5jdGlvbiByZXNldCgpIHsKCiAgICAJCS8vIHJlc2V0IHN0YXRlCgogICAgCQlnbC5kaXNhYmxlKCBnbC5CTEVORCApOwogICAgCQlnbC5kaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKICAgIAkJZ2wuZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwogICAgCQlnbC5kaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CiAgICAJCWdsLmRpc2FibGUoIGdsLlNDSVNTT1JfVEVTVCApOwogICAgCQlnbC5kaXNhYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKICAgIAkJZ2wuZGlzYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICk7CgogICAgCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwogICAgCQlnbC5ibGVuZEZ1bmMoIGdsLk9ORSwgZ2wuWkVSTyApOwogICAgCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5aRVJPLCBnbC5PTkUsIGdsLlpFUk8gKTsKICAgIAkJZ2wuYmxlbmRDb2xvciggMCwgMCwgMCwgMCApOwoKICAgIAkJZ2wuY29sb3JNYXNrKCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlICk7CiAgICAJCWdsLmNsZWFyQ29sb3IoIDAsIDAsIDAsIDAgKTsKCiAgICAJCWdsLmRlcHRoTWFzayggdHJ1ZSApOwogICAgCQlnbC5kZXB0aEZ1bmMoIGdsLkxFU1MgKTsKCiAgICAJCWRlcHRoQnVmZmVyLnNldFJldmVyc2VkKCBmYWxzZSApOwoKICAgIAkJZ2wuY2xlYXJEZXB0aCggMSApOwoKICAgIAkJZ2wuc3RlbmNpbE1hc2soIDB4ZmZmZmZmZmYgKTsKICAgIAkJZ2wuc3RlbmNpbEZ1bmMoIGdsLkFMV0FZUywgMCwgMHhmZmZmZmZmZiApOwogICAgCQlnbC5zdGVuY2lsT3AoIGdsLktFRVAsIGdsLktFRVAsIGdsLktFRVAgKTsKICAgIAkJZ2wuY2xlYXJTdGVuY2lsKCAwICk7CgogICAgCQlnbC5jdWxsRmFjZSggZ2wuQkFDSyApOwogICAgCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKICAgIAkJZ2wucG9seWdvbk9mZnNldCggMCwgMCApOwoKICAgIAkJZ2wuYWN0aXZlVGV4dHVyZSggZ2wuVEVYVFVSRTAgKTsKCiAgICAJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKICAgIAkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CiAgICAJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoKICAgIAkJZ2wudXNlUHJvZ3JhbSggbnVsbCApOwoKICAgIAkJZ2wubGluZVdpZHRoKCAxICk7CgogICAgCQlnbC5zY2lzc29yKCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKICAgIAkJZ2wudmlld3BvcnQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoKICAgIAkJLy8gcmVzZXQgaW50ZXJuYWxzCgogICAgCQllbmFibGVkQ2FwYWJpbGl0aWVzID0ge307CgogICAgCQljdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwogICAgCQljdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKICAgIAkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzID0ge307CiAgICAJCWN1cnJlbnREcmF3YnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CiAgICAJCWRlZmF1bHREcmF3YnVmZmVycyA9IFtdOwoKICAgIAkJY3VycmVudFByb2dyYW0gPSBudWxsOwoKICAgIAkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgCQljdXJyZW50QmxlbmRpbmcgPSBudWxsOwogICAgCQljdXJyZW50QmxlbmRFcXVhdGlvbiA9IG51bGw7CiAgICAJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CiAgICAJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CiAgICAJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBudWxsOwogICAgCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CiAgICAJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKICAgIAkJY3VycmVudEJsZW5kQ29sb3IgPSBuZXcgQ29sb3IoIDAsIDAsIDAgKTsKICAgIAkJY3VycmVudEJsZW5kQWxwaGEgPSAwOwogICAgCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCiAgICAJCWN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwogICAgCQljdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKICAgIAkJY3VycmVudExpbmVXaWR0aCA9IG51bGw7CgogICAgCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IG51bGw7CiAgICAJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKICAgIAkJY3VycmVudFNjaXNzb3Iuc2V0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKICAgIAkJY3VycmVudFZpZXdwb3J0LnNldCggMCwgMCwgZ2wuY2FudmFzLndpZHRoLCBnbC5jYW52YXMuaGVpZ2h0ICk7CgogICAgCQljb2xvckJ1ZmZlci5yZXNldCgpOwogICAgCQlkZXB0aEJ1ZmZlci5yZXNldCgpOwogICAgCQlzdGVuY2lsQnVmZmVyLnJlc2V0KCk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCWJ1ZmZlcnM6IHsKICAgIAkJCWNvbG9yOiBjb2xvckJ1ZmZlciwKICAgIAkJCWRlcHRoOiBkZXB0aEJ1ZmZlciwKICAgIAkJCXN0ZW5jaWw6IHN0ZW5jaWxCdWZmZXIKICAgIAkJfSwKCiAgICAJCWVuYWJsZTogZW5hYmxlLAogICAgCQlkaXNhYmxlOiBkaXNhYmxlLAoKICAgIAkJYmluZEZyYW1lYnVmZmVyOiBiaW5kRnJhbWVidWZmZXIsCiAgICAJCWRyYXdCdWZmZXJzOiBkcmF3QnVmZmVycywKCiAgICAJCXVzZVByb2dyYW06IHVzZVByb2dyYW0sCgogICAgCQlzZXRCbGVuZGluZzogc2V0QmxlbmRpbmcsCiAgICAJCXNldE1hdGVyaWFsOiBzZXRNYXRlcmlhbCwKCiAgICAJCXNldEZsaXBTaWRlZDogc2V0RmxpcFNpZGVkLAogICAgCQlzZXRDdWxsRmFjZTogc2V0Q3VsbEZhY2UsCgogICAgCQlzZXRMaW5lV2lkdGg6IHNldExpbmVXaWR0aCwKICAgIAkJc2V0UG9seWdvbk9mZnNldDogc2V0UG9seWdvbk9mZnNldCwKCiAgICAJCXNldFNjaXNzb3JUZXN0OiBzZXRTY2lzc29yVGVzdCwKCiAgICAJCWFjdGl2ZVRleHR1cmU6IGFjdGl2ZVRleHR1cmUsCiAgICAJCWJpbmRUZXh0dXJlOiBiaW5kVGV4dHVyZSwKICAgIAkJdW5iaW5kVGV4dHVyZTogdW5iaW5kVGV4dHVyZSwKICAgIAkJY29tcHJlc3NlZFRleEltYWdlMkQ6IGNvbXByZXNzZWRUZXhJbWFnZTJELAogICAgCQljb21wcmVzc2VkVGV4SW1hZ2UzRDogY29tcHJlc3NlZFRleEltYWdlM0QsCiAgICAJCXRleEltYWdlMkQ6IHRleEltYWdlMkQsCiAgICAJCXRleEltYWdlM0Q6IHRleEltYWdlM0QsCgogICAgCQl1cGRhdGVVQk9NYXBwaW5nOiB1cGRhdGVVQk9NYXBwaW5nLAogICAgCQl1bmlmb3JtQmxvY2tCaW5kaW5nOiB1bmlmb3JtQmxvY2tCaW5kaW5nLAoKICAgIAkJdGV4U3RvcmFnZTJEOiB0ZXhTdG9yYWdlMkQsCiAgICAJCXRleFN0b3JhZ2UzRDogdGV4U3RvcmFnZTNELAogICAgCQl0ZXhTdWJJbWFnZTJEOiB0ZXhTdWJJbWFnZTJELAogICAgCQl0ZXhTdWJJbWFnZTNEOiB0ZXhTdWJJbWFnZTNELAogICAgCQljb21wcmVzc2VkVGV4U3ViSW1hZ2UyRDogY29tcHJlc3NlZFRleFN1YkltYWdlMkQsCiAgICAJCWNvbXByZXNzZWRUZXhTdWJJbWFnZTNEOiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCwKCiAgICAJCXNjaXNzb3I6IHNjaXNzb3IsCiAgICAJCXZpZXdwb3J0OiB2aWV3cG9ydCwKCiAgICAJCXJlc2V0OiByZXNldAoKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICkgewoKICAgIAljb25zdCBtdWx0aXNhbXBsZWRSVFRFeHQgPSBleHRlbnNpb25zLmhhcyggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA/IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApIDogbnVsbDsKICAgIAljb25zdCBzdXBwb3J0c0ludmFsaWRhdGVGcmFtZWJ1ZmZlciA9IHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnID8gZmFsc2UgOiAvT2N1bHVzQnJvd3Nlci9nLnRlc3QoIG5hdmlnYXRvci51c2VyQWdlbnQgKTsKCiAgICAJY29uc3QgX2ltYWdlRGltZW5zaW9ucyA9IG5ldyBWZWN0b3IyKCk7CiAgICAJY29uc3QgX3ZpZGVvVGV4dHVyZXMgPSBuZXcgV2Vha01hcCgpOwogICAgCWxldCBfY2FudmFzOwoKICAgIAljb25zdCBfc291cmNlcyA9IG5ldyBXZWFrTWFwKCk7IC8vIG1hcHMgV2ViZ2xUZXh0dXJlIG9iamVjdHMgdG8gaW5zdGFuY2VzIG9mIFNvdXJjZQoKICAgIAkvLyBjb3Jkb3ZhIGlPUyAoYXMgb2YgNS4wKSBzdGlsbCB1c2VzIFVJV2ViVmlldywgd2hpY2ggcHJvdmlkZXMgT2Zmc2NyZWVuQ2FudmFzLAogICAgCS8vIGFsc28gT2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIndlYmdsIiksIGJ1dCBub3QgT2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIjJkIikhCiAgICAJLy8gU29tZSBpbXBsZW1lbnRhdGlvbnMgbWF5IG9ubHkgaW1wbGVtZW50IE9mZnNjcmVlbkNhbnZhcyBwYXJ0aWFsbHkgKGUuZy4gbGFja2luZyAyZCkuCgogICAgCWxldCB1c2VPZmZzY3JlZW5DYW52YXMgPSBmYWxzZTsKCiAgICAJdHJ5IHsKCiAgICAJCXVzZU9mZnNjcmVlbkNhbnZhcyA9IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICd1bmRlZmluZWQnCiAgICAJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGF0L2NvbXBhdAogICAgCQkJJiYgKCBuZXcgT2Zmc2NyZWVuQ2FudmFzKCAxLCAxICkuZ2V0Q29udGV4dCggJzJkJyApICkgIT09IG51bGw7CgogICAgCX0gY2F0Y2ggKCBlcnIgKSB7CgogICAgCQkvLyBJZ25vcmUgYW55IGVycm9ycwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIHsKCiAgICAJCS8vIFVzZSBPZmZzY3JlZW5DYW52YXMgd2hlbiBhdmFpbGFibGUuIFNwZWNpYWxseSBuZWVkZWQgaW4gd2ViIHdvcmtlcnMKCiAgICAJCXJldHVybiB1c2VPZmZzY3JlZW5DYW52YXMgPwogICAgCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBhdC9jb21wYXQKICAgIAkJCW5ldyBPZmZzY3JlZW5DYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZXNpemVJbWFnZSggaW1hZ2UsIG5lZWRzTmV3Q2FudmFzLCBtYXhTaXplICkgewoKICAgIAkJbGV0IHNjYWxlID0gMTsKCiAgICAJCWNvbnN0IGRpbWVuc2lvbnMgPSBnZXREaW1lbnNpb25zKCBpbWFnZSApOwoKICAgIAkJLy8gaGFuZGxlIGNhc2UgaWYgdGV4dHVyZSBleGNlZWRzIG1heCBzaXplCgogICAgCQlpZiAoIGRpbWVuc2lvbnMud2lkdGggPiBtYXhTaXplIHx8IGRpbWVuc2lvbnMuaGVpZ2h0ID4gbWF4U2l6ZSApIHsKCiAgICAJCQlzY2FsZSA9IG1heFNpemUgLyBNYXRoLm1heCggZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCiAgICAJCX0KCiAgICAJCS8vIG9ubHkgcGVyZm9ybSByZXNpemUgaWYgbmVjZXNzYXJ5CgogICAgCQlpZiAoIHNjYWxlIDwgMSApIHsKCiAgICAJCQkvLyBvbmx5IHBlcmZvcm0gcmVzaXplIGZvciBjZXJ0YWluIGltYWdlIHR5cGVzCgogICAgCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAogICAgCQkJCSggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgfHwKICAgIAkJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApIHx8CiAgICAJCQkJKCB0eXBlb2YgVmlkZW9GcmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lICkgKSB7CgogICAgCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggc2NhbGUgKiBkaW1lbnNpb25zLndpZHRoICk7CiAgICAJCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5mbG9vciggc2NhbGUgKiBkaW1lbnNpb25zLmhlaWdodCApOwoKICAgIAkJCQlpZiAoIF9jYW52YXMgPT09IHVuZGVmaW5lZCApIF9jYW52YXMgPSBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCQkJLy8gY3ViZSB0ZXh0dXJlcyBjYW4ndCByZXVzZSB0aGUgc2FtZSBjYW52YXMKCiAgICAJCQkJY29uc3QgY2FudmFzID0gbmVlZHNOZXdDYW52YXMgPyBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IF9jYW52YXM7CgogICAgCQkJCWNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgCQkJCWNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CgogICAgCQkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwogICAgCQkJCWNvbnRleHQuZHJhd0ltYWdlKCBpbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGhhcyBiZWVuIHJlc2l6ZWQgZnJvbSAoJyArIGRpbWVuc2lvbnMud2lkdGggKyAneCcgKyBkaW1lbnNpb25zLmhlaWdodCArICcpIHRvICgnICsgd2lkdGggKyAneCcgKyBoZWlnaHQgKyAnKS4nICk7CgogICAgCQkJCXJldHVybiBjYW52YXM7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJaWYgKCAnZGF0YScgaW4gaW1hZ2UgKSB7CgogICAgCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBJbWFnZSBpbiBEYXRhVGV4dHVyZSBpcyB0b28gYmlnICgnICsgZGltZW5zaW9ucy53aWR0aCArICd4JyArIGRpbWVuc2lvbnMuaGVpZ2h0ICsgJykuJyApOwoKICAgIAkJCQl9CgogICAgCQkJCXJldHVybiBpbWFnZTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gaW1hZ2U7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgewoKICAgIAkJcmV0dXJuIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKSB7CgogICAgCQlfZ2wuZ2VuZXJhdGVNaXBtYXAoIHRhcmdldCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFRhcmdldFR5cGUoIHRleHR1cmUgKSB7CgogICAgCQlpZiAoIHRleHR1cmUuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgKSByZXR1cm4gX2dsLlRFWFRVUkVfQ1VCRV9NQVA7CiAgICAJCWlmICggdGV4dHVyZS5pc1dlYkdMM0RSZW5kZXJUYXJnZXQgKSByZXR1cm4gX2dsLlRFWFRVUkVfM0Q7CiAgICAJCWlmICggdGV4dHVyZS5pc1dlYkdMQXJyYXlSZW5kZXJUYXJnZXQgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSByZXR1cm4gX2dsLlRFWFRVUkVfMkRfQVJSQVk7CiAgICAJCXJldHVybiBfZ2wuVEVYVFVSRV8yRDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRJbnRlcm5hbEZvcm1hdCggaW50ZXJuYWxGb3JtYXROYW1lLCBnbEZvcm1hdCwgZ2xUeXBlLCBjb2xvclNwYWNlLCBmb3JjZUxpbmVhclRyYW5zZmVyID0gZmFsc2UgKSB7CgogICAgCQlpZiAoIGludGVybmFsRm9ybWF0TmFtZSAhPT0gbnVsbCApIHsKCiAgICAJCQlpZiAoIF9nbFsgaW50ZXJuYWxGb3JtYXROYW1lIF0gIT09IHVuZGVmaW5lZCApIHJldHVybiBfZ2xbIGludGVybmFsRm9ybWF0TmFtZSBdOwoKICAgIAkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gdXNlIG5vbi1leGlzdGluZyBXZWJHTCBpbnRlcm5hbCBmb3JtYXQgXCcnICsgaW50ZXJuYWxGb3JtYXROYW1lICsgJ1wnJyApOwoKICAgIAkJfQoKICAgIAkJbGV0IGludGVybmFsRm9ybWF0ID0gZ2xGb3JtYXQ7CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkVEICkgewoKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMzJGOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2RjsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4OwoKICAgIAkJfQoKICAgIAkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJFRF9JTlRFR0VSICkgewoKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4VUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2VUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMlVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjhJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIxNkk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMkk7CgogICAgCQl9CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkcgKSB7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJGOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkY7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzg7CgogICAgCQl9CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdfSU5URUdFUiApIHsKCiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzhVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzE2VUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHOEk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJJOwoKICAgIAkJfQoKICAgIAkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJHQl9JTlRFR0VSICkgewoKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjhVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IxNlVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IzMlVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOEk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCMTZJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IzMkk7CgogICAgCQl9CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCQV9JTlRFR0VSICkgewoKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkE4VUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTE2VUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMlVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQThJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkExNkk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMkk7CgogICAgCQl9CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCICkgewoKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfSU5UXzVfOV85XzlfUkVWICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOV9FNTsKCiAgICAJCX0KCiAgICAJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR0JBICkgewoKICAgIAkJCWNvbnN0IHRyYW5zZmVyID0gZm9yY2VMaW5lYXJUcmFuc2ZlciA/IExpbmVhclRyYW5zZmVyIDogQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMkY7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBMTZGOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IF9nbC5TUkdCOF9BTFBIQTggOiBfZ2wuUkdCQTg7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUXzRfNF80XzQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBNDsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjVfQTE7CgogICAgCQl9CgogICAgCQlpZiAoIGludGVybmFsRm9ybWF0ID09PSBfZ2wuUjE2RiB8fCBpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlIzMkYgfHwKICAgIAkJCWludGVybmFsRm9ybWF0ID09PSBfZ2wuUkcxNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SRzMyRiB8fAogICAgCQkJaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SR0JBMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUkdCQTMyRiApIHsKCiAgICAJCQlleHRlbnNpb25zLmdldCggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gaW50ZXJuYWxGb3JtYXQ7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0SW50ZXJuYWxEZXB0aEZvcm1hdCggdXNlU3RlbmNpbCwgZGVwdGhUeXBlICkgewoKICAgIAkJbGV0IGdsSW50ZXJuYWxGb3JtYXQ7CiAgICAJCWlmICggdXNlU3RlbmNpbCApIHsKCiAgICAJCQlpZiAoIGRlcHRoVHlwZSA9PT0gbnVsbCB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSDI0X1NURU5DSUw4OwoKICAgIAkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gRmxvYXRUeXBlICkgewoKICAgIAkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIMzJGX1NURU5DSUw4OwoKICAgIAkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSB7CgogICAgCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBfZ2wuREVQVEgyNF9TVEVOQ0lMODsKICAgIAkJCQljb25zb2xlLndhcm4oICdEZXB0aFRleHR1cmU6IDE2IGJpdCBkZXB0aCBhdHRhY2htZW50IGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCBzdGVuY2lsLiBVc2luZyAyNC1iaXQgYXR0YWNobWVudC4nICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlpZiAoIGRlcHRoVHlwZSA9PT0gbnVsbCB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQyNDsKCiAgICAJCQl9IGVsc2UgaWYgKCBkZXB0aFR5cGUgPT09IEZsb2F0VHlwZSApIHsKCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQzMkY7CgogICAgCQkJfSBlbHNlIGlmICggZGVwdGhUeXBlID09PSBVbnNpZ25lZFNob3J0VHlwZSApIHsKCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQxNjsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gZ2xJbnRlcm5hbEZvcm1hdDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRNaXBMZXZlbHMoIHRleHR1cmUsIGltYWdlICkgewoKICAgIAkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSA9PT0gdHJ1ZSB8fCAoIHRleHR1cmUuaXNGcmFtZWJ1ZmZlclRleHR1cmUgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlciApICkgewoKICAgIAkJCXJldHVybiBNYXRoLmxvZzIoIE1hdGgubWF4KCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICkgKSArIDE7CgogICAgCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLm1pcG1hcHMgIT09IHVuZGVmaW5lZCAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkvLyB1c2VyLWRlZmluZWQgbWlwbWFwcwoKICAgIAkJCXJldHVybiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOwoKICAgIAkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICYmIEFycmF5LmlzQXJyYXkoIHRleHR1cmUuaW1hZ2UgKSApIHsKCiAgICAJCQlyZXR1cm4gaW1hZ2UubWlwbWFwcy5sZW5ndGg7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCS8vIHRleHR1cmUgd2l0aG91dCBtaXBtYXBzIChvbmx5IGJhc2UgbGV2ZWwpCgogICAgCQkJcmV0dXJuIDE7CgogICAgCQl9CgogICAgCX0KCiAgICAJLy8KCiAgICAJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCiAgICAJCWRlYWxsb2NhdGVUZXh0dXJlKCB0ZXh0dXJlICk7CgogICAgCQlpZiAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKSB7CgogICAgCQkJX3ZpZGVvVGV4dHVyZXMuZGVsZXRlKCB0ZXh0dXJlICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gb25SZW5kZXJUYXJnZXREaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IHJlbmRlclRhcmdldCA9IGV2ZW50LnRhcmdldDsKCiAgICAJCXJlbmRlclRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSApOwoKICAgIAkJZGVhbGxvY2F0ZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLy8KCiAgICAJZnVuY3Rpb24gZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgogICAgCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgogICAgCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZW1vdmUgdGhlIFdlYkdMVGV4dHVyZSBvYmplY3QKCiAgICAJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwogICAgCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCiAgICAJCWlmICggd2ViZ2xUZXh0dXJlcyApIHsKCiAgICAJCQljb25zdCB3ZWJnbFRleHR1cmUgPSB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5IF07CiAgICAJCQl3ZWJnbFRleHR1cmUudXNlZFRpbWVzIC0tOwoKICAgIAkJCS8vIHRoZSBXZWJHTFRleHR1cmUgb2JqZWN0IGlzIG5vdCB1c2VkIGFueW1vcmUsIHJlbW92ZSBpdAoKICAgIAkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCiAgICAJCQkJZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApOwoKICAgIAkJCX0KCiAgICAJCQkvLyByZW1vdmUgdGhlIHdlYWsgbWFwIGVudHJ5IGlmIG5vIFdlYkdMVGV4dHVyZSB1c2VzIHRoZSBzb3VyY2UgYW55bW9yZQoKICAgIAkJCWlmICggT2JqZWN0LmtleXMoIHdlYmdsVGV4dHVyZXMgKS5sZW5ndGggPT09IDAgKSB7CgogICAgCQkJCV9zb3VyY2VzLmRlbGV0ZSggc291cmNlICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcHJvcGVydGllcy5yZW1vdmUoIHRleHR1cmUgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkZWxldGVUZXh0dXJlKCB0ZXh0dXJlICkgewoKICAgIAkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwogICAgCQlfZ2wuZGVsZXRlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCiAgICAJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwogICAgCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKICAgIAkJZGVsZXRlIHdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXTsKCiAgICAJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRlYWxsb2NhdGVSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKSB7CgogICAgCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5kaXNwb3NlKCk7CgogICAgCQkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKTsKCiAgICAJCX0KCiAgICAJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJCWlmICggQXJyYXkuaXNBcnJheSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApICkgewoKICAgIAkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdLmxlbmd0aDsgbGV2ZWwgKysgKSBfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF1bIGxldmVsIF0gKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgogICAgCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIubGVuZ3RoOyBsZXZlbCArKyApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0gKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApOwogICAgCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCiAgICAJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlci5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyICk7CgogICAgCQl9CgogICAgCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgogICAgCQkJaWYgKCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApIHsKCiAgICAJCQkJX2dsLmRlbGV0ZVRleHR1cmUoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgogICAgCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKICAgIAkJCX0KCiAgICAJCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZXNbIGkgXSApOwoKICAgIAkJfQoKICAgIAkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldCApOwoKICAgIAl9CgogICAgCS8vCgogICAgCWxldCB0ZXh0dXJlVW5pdHMgPSAwOwoKICAgIAlmdW5jdGlvbiByZXNldFRleHR1cmVVbml0cygpIHsKCiAgICAJCXRleHR1cmVVbml0cyA9IDA7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYWxsb2NhdGVUZXh0dXJlVW5pdCgpIHsKCiAgICAJCWNvbnN0IHRleHR1cmVVbml0ID0gdGV4dHVyZVVuaXRzOwoKICAgIAkJaWYgKCB0ZXh0dXJlVW5pdCA+PSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZXMgKSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVHJ5aW5nIHRvIHVzZSAnICsgdGV4dHVyZVVuaXQgKyAnIHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAnICsgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzICk7CgogICAgCQl9CgogICAgCQl0ZXh0dXJlVW5pdHMgKz0gMTsKCiAgICAJCXJldHVybiB0ZXh0dXJlVW5pdDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKSB7CgogICAgCQljb25zdCBhcnJheSA9IFtdOwoKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS53cmFwUyApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLndyYXBUICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUud3JhcFIgfHwgMCApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1hZ0ZpbHRlciApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1pbkZpbHRlciApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmFuaXNvdHJvcHkgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmZvcm1hdCApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnR5cGUgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUuZmxpcFkgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS5jb2xvclNwYWNlICk7CgogICAgCQlyZXR1cm4gYXJyYXkuam9pbigpOwoKICAgIAl9CgogICAgCS8vCgogICAgCWZ1bmN0aW9uIHNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCWlmICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApIHVwZGF0ZVZpZGVvVGV4dHVyZSggdGV4dHVyZSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgJiYgdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCiAgICAJCQljb25zdCBpbWFnZSA9IHRleHR1cmUuaW1hZ2U7CgogICAgCQkJaWYgKCBpbWFnZSA9PT0gbnVsbCApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgbm8gaW1hZ2UgZGF0YSBmb3VuZC4nICk7CgogICAgCQkJfSBlbHNlIGlmICggaW1hZ2UuY29tcGxldGUgPT09IGZhbHNlICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBpbWFnZSBpcyBpbmNvbXBsZXRlJyApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CiAgICAJCQkJcmV0dXJuOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXRUZXh0dXJlMkRBcnJheSggdGV4dHVyZSwgc2xvdCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCiAgICAJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldFRleHR1cmUzRCggdGV4dHVyZSwgc2xvdCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCiAgICAJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzNELCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldFRleHR1cmVDdWJlKCB0ZXh0dXJlLCBzbG90ICkgewoKICAgIAkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKICAgIAkJCXVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKICAgIAl9CgogICAgCWNvbnN0IHdyYXBwaW5nVG9HTCA9IHsKICAgIAkJWyBSZXBlYXRXcmFwcGluZyBdOiBfZ2wuUkVQRUFULAogICAgCQlbIENsYW1wVG9FZGdlV3JhcHBpbmcgXTogX2dsLkNMQU1QX1RPX0VER0UsCiAgICAJCVsgTWlycm9yZWRSZXBlYXRXcmFwcGluZyBdOiBfZ2wuTUlSUk9SRURfUkVQRUFUCiAgICAJfTsKCiAgICAJY29uc3QgZmlsdGVyVG9HTCA9IHsKICAgIAkJWyBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNULAogICAgCQlbIE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNUX01JUE1BUF9ORUFSRVNULAogICAgCQlbIE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgXTogX2dsLk5FQVJFU1RfTUlQTUFQX0xJTkVBUiwKCiAgICAJCVsgTGluZWFyRmlsdGVyIF06IF9nbC5MSU5FQVIsCiAgICAJCVsgTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9ORUFSRVNULAogICAgCQlbIExpbmVhck1pcG1hcExpbmVhckZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9MSU5FQVIKICAgIAl9OwoKICAgIAljb25zdCBjb21wYXJlVG9HTCA9IHsKICAgIAkJWyBOZXZlckNvbXBhcmUgXTogX2dsLk5FVkVSLAogICAgCQlbIEFsd2F5c0NvbXBhcmUgXTogX2dsLkFMV0FZUywKICAgIAkJWyBMZXNzQ29tcGFyZSBdOiBfZ2wuTEVTUywKICAgIAkJWyBMZXNzRXF1YWxDb21wYXJlIF06IF9nbC5MRVFVQUwsCiAgICAJCVsgRXF1YWxDb21wYXJlIF06IF9nbC5FUVVBTCwKICAgIAkJWyBHcmVhdGVyRXF1YWxDb21wYXJlIF06IF9nbC5HRVFVQUwsCiAgICAJCVsgR3JlYXRlckNvbXBhcmUgXTogX2dsLkdSRUFURVIsCiAgICAJCVsgTm90RXF1YWxDb21wYXJlIF06IF9nbC5OT1RFUVVBTAogICAgCX07CgogICAgCWZ1bmN0aW9uIHNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSApIHsKCiAgICAJCWlmICggdGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IGZhbHNlICYmCiAgICAJCQkoIHRleHR1cmUubWFnRmlsdGVyID09PSBMaW5lYXJGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciB8fAogICAgCQkJdGV4dHVyZS5taW5GaWx0ZXIgPT09IExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyICkgKSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5hYmxlIHRvIHVzZSBsaW5lYXIgZmlsdGVyaW5nIHdpdGggZmxvYXRpbmcgcG9pbnQgdGV4dHVyZXMuIE9FU190ZXh0dXJlX2Zsb2F0X2xpbmVhciBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlLicgKTsKCiAgICAJCX0KCiAgICAJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9TLCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFMgXSApOwogICAgCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfVCwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBUIF0gKTsKCiAgICAJCWlmICggdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUeXBlID09PSBfZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCiAgICAJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfUiwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBSIF0gKTsKCiAgICAJCX0KCiAgICAJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZmlsdGVyVG9HTFsgdGV4dHVyZS5tYWdGaWx0ZXIgXSApOwogICAgCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX01JTl9GSUxURVIsIGZpbHRlclRvR0xbIHRleHR1cmUubWluRmlsdGVyIF0gKTsKCiAgICAJCWlmICggdGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gKSB7CgogICAgCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9DT01QQVJFX01PREUsIF9nbC5DT01QQVJFX1JFRl9UT19URVhUVVJFICk7CiAgICAJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX0NPTVBBUkVfRlVOQywgY29tcGFyZVRvR0xbIHRleHR1cmUuY29tcGFyZUZ1bmN0aW9uIF0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgPT09IHRydWUgKSB7CgogICAgCQkJaWYgKCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTmVhcmVzdEZpbHRlciApIHJldHVybjsKICAgIAkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHJldHVybjsKICAgIAkJCWlmICggdGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IGZhbHNlICkgcmV0dXJuOyAvLyB2ZXJpZnkgZXh0ZW5zaW9uCgogICAgCQkJaWYgKCB0ZXh0dXJlLmFuaXNvdHJvcHkgPiAxIHx8IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSApIHsKCiAgICAJCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CiAgICAJCQkJX2dsLnRleFBhcmFtZXRlcmYoIHRleHR1cmVUeXBlLCBleHRlbnNpb24uVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIE1hdGgubWluKCB0ZXh0dXJlLmFuaXNvdHJvcHksIGNhcGFiaWxpdGllcy5nZXRNYXhBbmlzb3Ryb3B5KCkgKSApOwogICAgCQkJCXByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSA9IHRleHR1cmUuYW5pc290cm9weTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICkgewoKICAgIAkJbGV0IGZvcmNlVXBsb2FkID0gZmFsc2U7CgogICAgCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPSB0cnVlOwoKICAgIAkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgogICAgCQl9CgogICAgCQkvLyBjcmVhdGUgU291cmNlIDwtPiBXZWJHTFRleHR1cmVzIG1hcHBpbmcgaWYgbmVjZXNzYXJ5CgogICAgCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKICAgIAkJbGV0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwoKICAgIAkJaWYgKCB3ZWJnbFRleHR1cmVzID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJd2ViZ2xUZXh0dXJlcyA9IHt9OwogICAgCQkJX3NvdXJjZXMuc2V0KCBzb3VyY2UsIHdlYmdsVGV4dHVyZXMgKTsKCiAgICAJCX0KCiAgICAJCS8vIGNoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBXZWJHTFRleHR1cmUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gdGV4dHVyZSBwYXJhbWV0ZXJzCgogICAgCQljb25zdCB0ZXh0dXJlQ2FjaGVLZXkgPSBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKTsKCiAgICAJCWlmICggdGV4dHVyZUNhY2hlS2V5ICE9PSB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5ICkgewoKICAgIAkJCS8vIGlmIG5vdCwgY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIFdlYkdMVGV4dHVyZQoKICAgIAkJCWlmICggd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0gPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJLy8gY3JlYXRlIG5ldyBlbnRyeQoKICAgIAkJCQl3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXSA9IHsKICAgIAkJCQkJdGV4dHVyZTogX2dsLmNyZWF0ZVRleHR1cmUoKSwKICAgIAkJCQkJdXNlZFRpbWVzOiAwCiAgICAJCQkJfTsKCiAgICAJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgogICAgCQkJCS8vIHdoZW4gYSBuZXcgaW5zdGFuY2Ugb2YgV2ViR0xUZXh0dXJlIHdhcyBjcmVhdGVkLCBhIHRleHR1cmUgdXBsb2FkIGlzIHJlcXVpcmVkCiAgICAJCQkJLy8gZXZlbiBpZiB0aGUgaW1hZ2UgY29udGVudHMgYXJlIGlkZW50aWNhbAoKICAgIAkJCQlmb3JjZVVwbG9hZCA9IHRydWU7CgogICAgCQkJfQoKICAgIAkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnVzZWRUaW1lcyArKzsKCiAgICAJCQkvLyBldmVyeSB0aW1lIHRoZSB0ZXh0dXJlIGNhY2hlIGtleSBjaGFuZ2VzLCBpdCdzIG5lY2Vzc2FyeSB0byBjaGVjayBpZiBhbiBpbnN0YW5jZSBvZgogICAgCQkJLy8gV2ViR0xUZXh0dXJlIGNhbiBiZSBkZWxldGVkIGluIG9yZGVyIHRvIGF2b2lkIGEgbWVtb3J5IGxlYWsuCgogICAgCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoKICAgIAkJCWlmICggd2ViZ2xUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXS51c2VkVGltZXMgLS07CgogICAgCQkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCiAgICAJCQkJCWRlbGV0ZVRleHR1cmUoIHRleHR1cmUgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLyBzdG9yZSByZWZlcmVuY2VzIHRvIGNhY2hlIGtleSBhbmQgV2ViR0xUZXh0dXJlIG9iamVjdAoKICAgIAkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgPSB0ZXh0dXJlQ2FjaGVLZXk7CiAgICAJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnRleHR1cmU7CgogICAgCQl9CgogICAgCQlyZXR1cm4gZm9yY2VVcGxvYWQ7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0Um93KCBpbmRleCwgcm93TGVuZ3RoLCBjb21wb25lbnRTdHJpZGUgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5mbG9vciggTWF0aC5mbG9vciggaW5kZXggLyBjb21wb25lbnRTdHJpZGUgKSAvIHJvd0xlbmd0aCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZVRleHR1cmUoIHRleHR1cmUsIGltYWdlLCBnbEZvcm1hdCwgZ2xUeXBlICkgewoKICAgIAkJY29uc3QgY29tcG9uZW50U3RyaWRlID0gNDsgLy8gb25seSBSR0JBIHN1cHBvcnRlZAoKICAgIAkJY29uc3QgdXBkYXRlUmFuZ2VzID0gdGV4dHVyZS51cGRhdGVSYW5nZXM7CgogICAgCQlpZiAoIHVwZGF0ZVJhbmdlcy5sZW5ndGggPT09IDAgKSB7CgogICAgCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJLy8gQmVmb3JlIGFwcGx5aW5nIHVwZGF0ZSByYW5nZXMsIHdlIG1lcmdlIGFueSBhZGphY2VudCAvIG92ZXJsYXBwaW5nCiAgICAJCQkvLyByYW5nZXMgdG8gcmVkdWNlIGxvYWQgb24gYGdsLnRleFN1YkltYWdlMkRgLiBFbXBpcmljYWxseSwgdGhpcyBoYXMgbGVkCiAgICAJCQkvLyB0byBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBtYWtlIGhlYXZ5IHVzZSBvZgogICAgCQkJLy8gdXBkYXRlIHJhbmdlcy4gTGlrZWx5IGR1ZSB0byBHUFUgY29tbWFuZCBvdmVyaGVhZC4KICAgIAkJCS8vCiAgICAJCQkvLyBOb3RlIHRoYXQgdG8gcmVkdWNlIGdhcmJhZ2UgY29sbGVjdGlvbiBiZXR3ZWVuIGZyYW1lcywgd2UgbWVyZ2UgdGhlCiAgICAJCQkvLyB1cGRhdGUgcmFuZ2VzIGluLXBsYWNlLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB0aGlzIG1ldGhvZCB3aWxsIGNsZWFyIHRoZQogICAgCQkJLy8gdXBkYXRlIHJhbmdlcyBvbmNlIHVwZGF0ZWQuCgogICAgCQkJdXBkYXRlUmFuZ2VzLnNvcnQoICggYSwgYiApID0+IGEuc3RhcnQgLSBiLnN0YXJ0ICk7CgogICAgCQkJLy8gVG8gbWVyZ2UgdGhlIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UsIHdlIHdvcmsgZnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZQogICAgCQkJLy8gZXhpc3RpbmcgdXBkYXRlUmFuZ2VzIGFycmF5LCBtZXJnaW5nIHJhbmdlcy4gVGhpcyBtYXkgcmVzdWx0IGluIGEgZmluYWwKICAgIAkJCS8vIGFycmF5IHdoaWNoIGlzIHNtYWxsZXIgdGhhbiB0aGUgb3JpZ2luYWwuIFRoaXMgaW5kZXggdHJhY2tzIHRoZSBsYXN0CiAgICAJCQkvLyBpbmRleCByZXByZXNlbnRpbmcgYSBtZXJnZWQgcmFuZ2UsIGFueSBkYXRhIGFmdGVyIHRoaXMgaW5kZXggY2FuIGJlCiAgICAJCQkvLyB0cmltbWVkIG9uY2UgdGhlIG1lcmdlIGFsZ29yaXRobSBpcyBjb21wbGV0ZWQuCiAgICAJCQlsZXQgbWVyZ2VJbmRleCA9IDA7CgogICAgCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgcHJldmlvdXNSYW5nZSA9IHVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdOwogICAgCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgogICAgCQkJCS8vIE9ubHkgbWVyZ2UgaWYgaW4gdGhlIHNhbWUgcm93IGFuZCBvdmVybGFwcGluZy9hZGphY2VudAogICAgCQkJCWNvbnN0IHByZXZpb3VzRW5kID0gcHJldmlvdXNSYW5nZS5zdGFydCArIHByZXZpb3VzUmFuZ2UuY291bnQ7CiAgICAJCQkJY29uc3QgY3VycmVudFJvdyA9IGdldFJvdyggcmFuZ2Uuc3RhcnQsIGltYWdlLndpZHRoLCBjb21wb25lbnRTdHJpZGUgKTsKICAgIAkJCQljb25zdCBwcmV2aW91c1JvdyA9IGdldFJvdyggcHJldmlvdXNSYW5nZS5zdGFydCwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApOwoKICAgIAkJCQkvLyBXZSBhZGQgb25lIGhlcmUgdG8gbWVyZ2UgYWRqYWNlbnQgcmFuZ2VzLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSByYW5nZXMKICAgIAkJCQkvLyBvcGVyYXRlIG92ZXIgcG9zaXRpdmUgaW50ZWdlcnMuCiAgICAJCQkJaWYgKAogICAgCQkJCQlyYW5nZS5zdGFydCA8PSBwcmV2aW91c0VuZCArIDEgJiYKICAgIAkJCQkJY3VycmVudFJvdyA9PT0gcHJldmlvdXNSb3cgJiYKICAgIAkJCQkJZ2V0Um93KCByYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gMSwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApID09PSBjdXJyZW50Um93IC8vIGVuc3VyZSByYW5nZSBkb2Vzbid0IHNwaWxsCiAgICAJCQkJKSB7CgogICAgCQkJCQlwcmV2aW91c1JhbmdlLmNvdW50ID0gTWF0aC5tYXgoCiAgICAJCQkJCQlwcmV2aW91c1JhbmdlLmNvdW50LAogICAgCQkJCQkJcmFuZ2Uuc3RhcnQgKyByYW5nZS5jb3VudCAtIHByZXZpb3VzUmFuZ2Uuc3RhcnQKICAgIAkJCQkJKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCSsrIG1lcmdlSW5kZXg7CiAgICAJCQkJCXVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdID0gcmFuZ2U7CgogICAgCQkJCX0KCgogICAgCQkJfQoKICAgIAkJCS8vIFRyaW0gdGhlIGFycmF5IHRvIG9ubHkgY29udGFpbiB0aGUgbWVyZ2VkIHJhbmdlcy4KICAgIAkJCXVwZGF0ZVJhbmdlcy5sZW5ndGggPSBtZXJnZUluZGV4ICsgMTsKCiAgICAJCQljb25zdCBjdXJyZW50VW5wYWNrUm93TGVuID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19ST1dfTEVOR1RIICk7CiAgICAJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CgogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGltYWdlLndpZHRoICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgogICAgCQkJCWNvbnN0IHBpeGVsU3RhcnQgPSBNYXRoLmZsb29yKCByYW5nZS5zdGFydCAvIGNvbXBvbmVudFN0cmlkZSApOwogICAgCQkJCWNvbnN0IHBpeGVsQ291bnQgPSBNYXRoLmNlaWwoIHJhbmdlLmNvdW50IC8gY29tcG9uZW50U3RyaWRlICk7CgogICAgCQkJCWNvbnN0IHggPSBwaXhlbFN0YXJ0ICUgaW1hZ2Uud2lkdGg7CiAgICAJCQkJY29uc3QgeSA9IE1hdGguZmxvb3IoIHBpeGVsU3RhcnQgLyBpbWFnZS53aWR0aCApOwoKICAgIAkJCQkvLyBBc3N1bWVzIHVwZGF0ZSByYW5nZXMgcmVmZXIgdG8gY29udGlndW91cyBtZW1vcnkKICAgIAkJCQljb25zdCB3aWR0aCA9IHBpeGVsQ291bnQ7CiAgICAJCQkJY29uc3QgaGVpZ2h0ID0gMTsKCiAgICAJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCB4ICk7CiAgICAJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUk9XUywgeSApOwoKICAgIAkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCX0KCiAgICAJCQl0ZXh0dXJlLmNsZWFyVXBkYXRlUmFuZ2VzKCk7CgogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGN1cnJlbnRVbnBhY2tSb3dMZW4gKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgY3VycmVudFVucGFja1NraXBQaXhlbHMgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIGN1cnJlbnRVbnBhY2tTa2lwUm93cyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICkgewoKICAgIAkJbGV0IHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfMkQ7CgogICAgCQlpZiAoIHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlIHx8IHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKICAgIAkJaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfM0Q7CgogICAgCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwogICAgCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCiAgICAJCXN0YXRlLmJpbmRUZXh0dXJlKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCiAgICAJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgogICAgCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCiAgICAJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgogICAgCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwogICAgCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwogICAgCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgogICAgCQkJbGV0IGltYWdlID0gcmVzaXplSW1hZ2UoIHRleHR1cmUuaW1hZ2UsIGZhbHNlLCBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKICAgIAkJCWltYWdlID0gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgaW1hZ2UgKTsKCiAgICAJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCiAgICAJCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKICAgIAkJCWxldCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApOwoKICAgIAkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSApOwoKICAgIAkJCWxldCBtaXBtYXA7CiAgICAJCQljb25zdCBtaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKICAgIAkJCWNvbnN0IHVzZVRleFN0b3JhZ2UgPSAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgIT09IHRydWUgKTsKICAgIAkJCWNvbnN0IGFsbG9jYXRlTWVtb3J5ID0gKCBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9PT0gdW5kZWZpbmVkICkgfHwgKCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApOwogICAgCQkJY29uc3QgZGF0YVJlYWR5ID0gc291cmNlLmRhdGFSZWFkeTsKICAgIAkJCWNvbnN0IGxldmVscyA9IGdldE1pcExldmVscyggdGV4dHVyZSwgaW1hZ2UgKTsKCiAgICAJCQlpZiAoIHRleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgogICAgCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbERlcHRoRm9ybWF0KCB0ZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0LCB0ZXh0dXJlLnR5cGUgKTsKCiAgICAJCQkJLy8KCiAgICAJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCAxLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUgKSB7CgogICAgCQkJCS8vIHVzZSBtYW51YWxseSBjcmVhdGVkIG1pcG1hcHMgaWYgYXZhaWxhYmxlCiAgICAJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCiAgICAJCQkJLy8gc2V0IDAgbGV2ZWwgbWlwbWFwIGFuZCB0aGVuIHVzZSBHTCB0byBnZW5lcmF0ZSBvdGhlciBtaXBtYXAgbGV2ZWxzCgogICAgCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgogICAgCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQl1cGRhdGVUZXh0dXJlKCB0ZXh0dXJlLCBpbWFnZSwgZ2xGb3JtYXQsIGdsVHlwZSApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCiAgICAJCQkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCiAgICAJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKICAgIAkJCQkJCQlpZiAoIGdsRm9ybWF0ICE9PSBudWxsICkgewoKICAgIAkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJCQlpZiAoIHRleHR1cmUubGF5ZXJVcGRhdGVzLnNpemUgPiAwICkgewoKICAgIAkJCQkJCQkJCQkJY29uc3QgbGF5ZXJCeXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aCggbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS50eXBlICk7CgogICAgCQkJCQkJCQkJCQlmb3IgKCBjb25zdCBsYXllckluZGV4IG9mIHRleHR1cmUubGF5ZXJVcGRhdGVzICkgewoKICAgIAkJCQkJCQkJCQkJCWNvbnN0IGxheWVyRGF0YSA9IG1pcG1hcC5kYXRhLnN1YmFycmF5KAogICAgCQkJCQkJCQkJCQkJCWxheWVySW5kZXggKiBsYXllckJ5dGVMZW5ndGggLyBtaXBtYXAuZGF0YS5CWVRFU19QRVJfRUxFTUVOVCwKICAgIAkJCQkJCQkJCQkJCQkoIGxheWVySW5kZXggKyAxICkgKiBsYXllckJ5dGVMZW5ndGggLyBtaXBtYXAuZGF0YS5CWVRFU19QRVJfRUxFTUVOVAogICAgCQkJCQkJCQkJCQkJKTsKICAgIAkJCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgMCwgMCwgbGF5ZXJJbmRleCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAxLCBnbEZvcm1hdCwgbGF5ZXJEYXRhICk7CgogICAgCQkJCQkJCQkJCQl9CgogICAgCQkJCQkJCQkJCQl0ZXh0dXJlLmNsZWFyTGF5ZXJVcGRhdGVzKCk7CgogICAgCQkJCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIDAsIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQkJCQl9CgogICAgCQkJCQkJCQkJfQoKICAgIAkJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIG1pcG1hcC5kYXRhLCAwLCAwICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAudXBsb2FkVGV4dHVyZSgpJyApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIDAsIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQkJbWlwbWFwID0gbWlwbWFwc1sgaSBdOwoKICAgIAkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgKSB7CgogICAgCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgogICAgCQkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJCQl9CgogICAgCQkJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQkJfQoKICAgIAkJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnVwbG9hZFRleHR1cmUoKScgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgKSB7CgogICAgCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQkJc3RhdGUudGV4U3RvcmFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJaWYgKCB0ZXh0dXJlLmxheWVyVXBkYXRlcy5zaXplID4gMCApIHsKCiAgICAJCQkJCQkJY29uc3QgbGF5ZXJCeXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aCggaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUudHlwZSApOwoKICAgIAkJCQkJCQlmb3IgKCBjb25zdCBsYXllckluZGV4IG9mIHRleHR1cmUubGF5ZXJVcGRhdGVzICkgewoKICAgIAkJCQkJCQkJY29uc3QgbGF5ZXJEYXRhID0gaW1hZ2UuZGF0YS5zdWJhcnJheSgKICAgIAkJCQkJCQkJCWxheWVySW5kZXggKiBsYXllckJ5dGVMZW5ndGggLyBpbWFnZS5kYXRhLkJZVEVTX1BFUl9FTEVNRU5ULAogICAgCQkJCQkJCQkJKCBsYXllckluZGV4ICsgMSApICogbGF5ZXJCeXRlTGVuZ3RoIC8gaW1hZ2UuZGF0YS5CWVRFU19QRVJfRUxFTUVOVAogICAgCQkJCQkJCQkpOwogICAgCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgMCwgMCwgbGF5ZXJJbmRleCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgMSwgZ2xGb3JtYXQsIGdsVHlwZSwgbGF5ZXJEYXRhICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQkJdGV4dHVyZS5jbGVhckxheWVyVXBkYXRlcygpOwoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCAwLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgogICAgCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQkJc3RhdGUudGV4U3RvcmFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNGcmFtZWJ1ZmZlclRleHR1cmUgKSB7CgogICAgCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWxldCB3aWR0aCA9IGltYWdlLndpZHRoLCBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgogICAgCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGV2ZWxzOyBpICsrICkgewoKICAgIAkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbnVsbCApOwoKICAgIAkJCQkJCQl3aWR0aCA+Pj0gMTsKICAgIAkJCQkJCQloZWlnaHQgPj49IDE7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJLy8gcmVndWxhciBUZXh0dXJlIChpbWFnZSwgdmlkZW8sIGNhbnZhcykKCiAgICAJCQkJLy8gdXNlIG1hbnVhbGx5IGNyZWF0ZWQgbWlwbWFwcyBpZiBhdmFpbGFibGUKICAgIAkJCQkvLyBpZiB0aGVyZSBhcmUgbm8gbWFudWFsIG1pcG1hcHMKICAgIAkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCiAgICAJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIG1pcG1hcHNbIDAgXSApOwoKICAgIAkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCiAgICAJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGltYWdlICk7CgogICAgCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCiAgICAJCQkJZ2VuZXJhdGVNaXBtYXAoIHRleHR1cmVUeXBlICk7CgogICAgCQkJfQoKICAgIAkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgogICAgCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKICAgIAkJfQoKICAgIAkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApIHsKCiAgICAJCWlmICggdGV4dHVyZS5pbWFnZS5sZW5ndGggIT09IDYgKSByZXR1cm47CgogICAgCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwogICAgCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCiAgICAJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCiAgICAJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgogICAgCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCiAgICAJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgogICAgCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwogICAgCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwogICAgCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgogICAgCQkJY29uc3QgaXNDb21wcmVzc2VkID0gKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgfHwgdGV4dHVyZS5pbWFnZVsgMCBdLmlzQ29tcHJlc3NlZFRleHR1cmUgKTsKICAgIAkJCWNvbnN0IGlzRGF0YVRleHR1cmUgPSAoIHRleHR1cmUuaW1hZ2VbIDAgXSAmJiB0ZXh0dXJlLmltYWdlWyAwIF0uaXNEYXRhVGV4dHVyZSApOwoKICAgIAkJCWNvbnN0IGN1YmVJbWFnZSA9IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJCWlmICggISBpc0NvbXByZXNzZWQgJiYgISBpc0RhdGFUZXh0dXJlICkgewoKICAgIAkJCQkJY3ViZUltYWdlWyBpIF0gPSByZXNpemVJbWFnZSggdGV4dHVyZS5pbWFnZVsgaSBdLCB0cnVlLCBjYXBhYmlsaXRpZXMubWF4Q3ViZW1hcFNpemUgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWN1YmVJbWFnZVsgaSBdID0gaXNEYXRhVGV4dHVyZSA/IHRleHR1cmUuaW1hZ2VbIGkgXS5pbWFnZSA6IHRleHR1cmUuaW1hZ2VbIGkgXTsKCiAgICAJCQkJfQoKICAgIAkJCQljdWJlSW1hZ2VbIGkgXSA9IHZlcmlmeUNvbG9yU3BhY2UoIHRleHR1cmUsIGN1YmVJbWFnZVsgaSBdICk7CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IGltYWdlID0gY3ViZUltYWdlWyAwIF0sCiAgICAJCQkJZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICksCiAgICAJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCiAgICAJCQljb25zdCB1c2VUZXhTdG9yYWdlID0gKCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICE9PSB0cnVlICk7CiAgICAJCQljb25zdCBhbGxvY2F0ZU1lbW9yeSA9ICggc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPT09IHVuZGVmaW5lZCApIHx8ICggZm9yY2VVcGxvYWQgPT09IHRydWUgKTsKICAgIAkJCWNvbnN0IGRhdGFSZWFkeSA9IHNvdXJjZS5kYXRhUmVhZHk7CiAgICAJCQlsZXQgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSApOwoKICAgIAkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZSApOwoKICAgIAkJCWxldCBtaXBtYXBzOwoKICAgIAkJCWlmICggaXNDb21wcmVzc2VkICkgewoKICAgIAkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCQkJbWlwbWFwcyA9IGN1YmVJbWFnZVsgaSBdLm1pcG1hcHM7CgogICAgCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaiArKyApIHsKCiAgICAJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgogICAgCQkJCQkJaWYgKCB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCApIHsKCiAgICAJCQkJCQkJaWYgKCBnbEZvcm1hdCAhPT0gbnVsbCApIHsKCiAgICAJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQkJCX0KCiAgICAJCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAuc2V0VGV4dHVyZUN1YmUoKScgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJbWlwbWFwcyA9IHRleHR1cmUubWlwbWFwczsKCiAgICAJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJLy8gVE9ETzogVW5pZm9ybWx5IGhhbmRsZSBtaXBtYXAgZGVmaW5pdGlvbnMKICAgIAkJCQkJLy8gTm9ybWFsIHRleHR1cmVzIGFuZCBjb21wcmVzc2VkIGN1YmUgdGV4dHVyZXMgZGVmaW5lIGJhc2UgbGV2ZWwgKyBtaXBzIHdpdGggdGhlaXIgbWlwbWFwIGFycmF5CiAgICAJCQkJCS8vIFVuY29tcHJlc3NlZCBjdWJlIHRleHR1cmVzIHVzZSB0aGVpciBtaXBtYXAgYXJyYXkgb25seSBmb3IgbWlwcyAobm8gYmFzZSBsZXZlbCkKCiAgICAJCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgbGV2ZWxzICsrOwoKICAgIAkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGN1YmVJbWFnZVsgMCBdICk7CgogICAgCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGRpbWVuc2lvbnMud2lkdGgsIGRpbWVuc2lvbnMuaGVpZ2h0ICk7CgogICAgCQkJCX0KCiAgICAJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCiAgICAJCQkJCWlmICggaXNEYXRhVGV4dHVyZSApIHsKCiAgICAJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIDAsIDAsIGN1YmVJbWFnZVsgaSBdLndpZHRoLCBjdWJlSW1hZ2VbIGkgXS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdLmRhdGEgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCBnbEludGVybmFsRm9ybWF0LCBjdWJlSW1hZ2VbIGkgXS53aWR0aCwgY3ViZUltYWdlWyBpIF0uaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXS5kYXRhICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKICAgIAkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CiAgICAJCQkJCQkJY29uc3QgbWlwbWFwSW1hZ2UgPSBtaXBtYXAuaW1hZ2VbIGkgXS5pbWFnZTsKCiAgICAJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCAwLCAwLCBtaXBtYXBJbWFnZS53aWR0aCwgbWlwbWFwSW1hZ2UuaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXBJbWFnZS5kYXRhICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKICAgIAkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgogICAgCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgMCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSApICkgewoKICAgIAkJCQkvLyBXZSBhc3N1bWUgaW1hZ2VzIGZvciBjdWJlIG1hcCBoYXZlIHRoZSBzYW1lIHNpemUuCiAgICAJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFX0NVQkVfTUFQICk7CgogICAgCQkJfQoKICAgIAkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgogICAgCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKICAgIAkJfQoKICAgIAkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKICAgIAl9CgogICAgCS8vIFJlbmRlciB0YXJnZXRzCgogICAgCS8vIFNldHVwIHN0b3JhZ2UgZm9yIHRhcmdldCB0ZXh0dXJlIGFuZCBiaW5kIGl0IHRvIGNvcnJlY3QgZnJhbWVidWZmZXIKICAgIAlmdW5jdGlvbiBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgbGV2ZWwgKSB7CgogICAgCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKICAgIAkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICk7CiAgICAJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CiAgICAJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCXRleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoKICAgIAkJaWYgKCAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKICAgIAkJCWNvbnN0IHdpZHRoID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC53aWR0aCA+PiBsZXZlbCApOwogICAgCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC5oZWlnaHQgPj4gbGV2ZWwgKTsKCiAgICAJCQlpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKICAgIAkJCQlzdGF0ZS50ZXhJbWFnZTNEKCB0ZXh0dXJlVGFyZ2V0LCBsZXZlbCwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgcmVuZGVyVGFyZ2V0LmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJc3RhdGUudGV4SW1hZ2UyRCggdGV4dHVyZVRhcmdldCwgbGV2ZWwsIGdsSW50ZXJuYWxGb3JtYXQsIHdpZHRoLCBoZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCiAgICAJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCiAgICAJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBhdHRhY2htZW50LCB0ZXh0dXJlVGFyZ2V0LCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgMCwgZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICkgKTsKCiAgICAJCX0gZWxzZSBpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEIHx8ICggdGV4dHVyZVRhcmdldCA+PSBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICYmIHRleHR1cmVUYXJnZXQgPD0gX2dsLlRFWFRVUkVfQ1VCRV9NQVBfTkVHQVRJVkVfWiApICkgeyAvLyBzZWUgIzI0NzUzCgogICAgCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIGF0dGFjaG1lbnQsIHRleHR1cmVUYXJnZXQsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBsZXZlbCApOwoKICAgIAkJfQoKICAgIAkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCiAgICAJfQoKICAgIAkvLyBTZXR1cCBzdG9yYWdlIGZvciBpbnRlcm5hbCBkZXB0aC9zdGVuY2lsIGJ1ZmZlcnMgYW5kIGJpbmQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgogICAgCWZ1bmN0aW9uIHNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIGlzTXVsdGlzYW1wbGUgKSB7CgogICAgCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgogICAgCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCiAgICAJCQkvLyByZXRyaWV2ZSB0aGUgZGVwdGggYXR0YWNobWVudCB0eXBlcwogICAgCQkJY29uc3QgZGVwdGhUZXh0dXJlID0gcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZTsKICAgIAkJCWNvbnN0IGRlcHRoVHlwZSA9IGRlcHRoVGV4dHVyZSAmJiBkZXB0aFRleHR1cmUuaXNEZXB0aFRleHR1cmUgPyBkZXB0aFRleHR1cmUudHlwZSA6IG51bGw7CiAgICAJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxEZXB0aEZvcm1hdCggcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIsIGRlcHRoVHlwZSApOwogICAgCQkJY29uc3QgZ2xBdHRhY2htZW50VHlwZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwoKICAgIAkJCS8vIHNldCB1cCB0aGUgYXR0YWNobWVudAogICAgCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwogICAgCQkJY29uc3QgaXNVc2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApOwogICAgCQkJaWYgKCBpc1VzZU11bHRpc2FtcGxlZFJUVCApIHsKCiAgICAJCQkJbXVsdGlzYW1wbGVkUlRURXh0LnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZUVYVCggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgogICAgCQkJfSBlbHNlIGlmICggaXNNdWx0aXNhbXBsZSApIHsKCiAgICAJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKICAgIAkJCX0KCiAgICAJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZ2xBdHRhY2htZW50VHlwZSwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgogICAgCQkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwogICAgCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwogICAgCQkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CiAgICAJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKICAgIAkJCQlpZiAoIGlzTXVsdGlzYW1wbGUgJiYgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCiAgICAJCQkJfSBlbHNlIGlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCiAgICAJCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGVFWFQoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCiAgICAJfQoKICAgIAkvLyBTZXR1cCByZXNvdXJjZXMgZm9yIGEgRGVwdGggVGV4dHVyZSBmb3IgYSBGQk8gKG5lZWRzIGFuIGV4dGVuc2lvbikKICAgIAlmdW5jdGlvbiBzZXR1cERlcHRoVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCApIHsKCiAgICAJCWNvbnN0IGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApOwogICAgCQlpZiAoIGlzQ3ViZSApIHRocm93IG5ldyBFcnJvciggJ0RlcHRoIFRleHR1cmUgd2l0aCBjdWJlIHJlbmRlciB0YXJnZXRzIGlzIG5vdCBzdXBwb3J0ZWQnICk7CgogICAgCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCiAgICAJCWlmICggISAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApICkgewoKICAgIAkJCXRocm93IG5ldyBFcnJvciggJ3JlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBUSFJFRS5EZXB0aFRleHR1cmUnICk7CgogICAgCQl9CgogICAgCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICk7CiAgICAJCXRleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoKICAgIAkJLy8gdXBsb2FkIGFuIGVtcHR5IGRlcHRoIHRleHR1cmUgd2l0aCBmcmFtZWJ1ZmZlciBzaXplCiAgICAJCWlmICggISB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSB8fAogICAgCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggIT09IHJlbmRlclRhcmdldC53aWR0aCB8fAogICAgCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ICE9PSByZW5kZXJUYXJnZXQuaGVpZ2h0ICkgewoKICAgIAkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggPSByZW5kZXJUYXJnZXQud2lkdGg7CiAgICAJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CiAgICAJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCXNldFRleHR1cmUyRCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSwgMCApOwoKICAgIAkJY29uc3Qgd2ViZ2xEZXB0aFRleHR1cmUgPSB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZTsKICAgIAkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKICAgIAkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhGb3JtYXQgKSB7CgogICAgCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKICAgIAkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwLCBzYW1wbGVzICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgewoKICAgIAkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCiAgICAJCQkJbXVsdGlzYW1wbGVkUlRURXh0LmZyYW1lYnVmZmVyVGV4dHVyZTJETXVsdGlzYW1wbGVFWFQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwLCBzYW1wbGVzICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnVW5rbm93biBkZXB0aFRleHR1cmUgZm9ybWF0JyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vIFNldHVwIEdMIHJlc291cmNlcyBmb3IgYSBub24tdGV4dHVyZSBkZXB0aCBidWZmZXIKICAgIAlmdW5jdGlvbiBzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwogICAgCQljb25zdCBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwoKICAgIAkJLy8gaWYgdGhlIGJvdW5kIGRlcHRoIHRleHR1cmUgaGFzIGNoYW5nZWQKICAgIAkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmUgIT09IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKSB7CgogICAgCQkJLy8gZmlyZSB0aGUgZGlzcG9zZSBldmVudCB0byBnZXQgcmlkIG9mIHN0b3JlZCBzdGF0ZSBhc3NvY2lhdGVkIHdpdGggdGhlIHByZXZpb3VzbHkgYm91bmQgZGVwdGggYnVmZmVyCiAgICAJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwogICAgCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fZGVwdGhEaXNwb3NlQ2FsbGJhY2sgKSB7CgogICAgCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19kZXB0aERpc3Bvc2VDYWxsYmFjaygpOwoKICAgIAkJCX0KCiAgICAJCQkvLyBzZXQgdXAgZGlzcG9zZSBsaXN0ZW5lcnMgdG8gdHJhY2sgd2hlbiB0aGUgY3VycmVudGx5IGF0dGFjaGVkIGJ1ZmZlciBpcyBpbXBsaWNpdGx5IHVuYm91bmQKICAgIAkJCWlmICggZGVwdGhUZXh0dXJlICkgewoKICAgIAkJCQljb25zdCBkaXNwb3NlRXZlbnQgPSAoKSA9PiB7CgogICAgCQkJCQlkZWxldGUgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2JvdW5kRGVwdGhUZXh0dXJlOwogICAgCQkJCQlkZWxldGUgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrOwogICAgCQkJCQlkZXB0aFRleHR1cmUucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlRXZlbnQgKTsKCiAgICAJCQkJfTsKCiAgICAJCQkJZGVwdGhUZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgZGlzcG9zZUV2ZW50ICk7CiAgICAJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrID0gZGlzcG9zZUV2ZW50OwoKICAgIAkJCX0KCiAgICAJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmUgPSBkZXB0aFRleHR1cmU7CgogICAgCQl9CgogICAgCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgISByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYXV0b0FsbG9jYXRlRGVwdGhCdWZmZXIgKSB7CgogICAgCQkJaWYgKCBpc0N1YmUgKSB0aHJvdyBuZXcgRXJyb3IoICd0YXJnZXQuZGVwdGhUZXh0dXJlIG5vdCBzdXBwb3J0ZWQgaW4gQ3ViZSByZW5kZXIgdGFyZ2V0cycgKTsKCiAgICAJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCiAgICAJCQlpZiAoIG1pcG1hcHMgJiYgbWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQlzZXR1cERlcHRoVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSwgcmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJc2V0dXBEZXB0aFRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggaXNDdWJlICkgewoKICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9IFtdOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gKTsKCiAgICAJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAJCQkJCQlzZXR1cFJlbmRlckJ1ZmZlclN0b3JhZ2UoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJLy8gYXR0YWNoIGJ1ZmZlciBpZiBpdCdzIGJlZW4gY3JlYXRlZCBhbHJlYWR5CiAgICAJCQkJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CiAgICAJCQkJCQljb25zdCByZW5kZXJidWZmZXIgPSByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdOwogICAgCQkJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGdsQXR0YWNobWVudFR5cGUsIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY29uc3QgbWlwbWFwcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlLm1pcG1hcHM7CgogICAgCQkJCWlmICggbWlwbWFwcyAmJiBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAJCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIsIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCS8vIGF0dGFjaCBidWZmZXIgaWYgaXQncyBiZWVuIGNyZWF0ZWQgYWxyZWFkeQogICAgCQkJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CiAgICAJCQkJCWNvbnN0IHJlbmRlcmJ1ZmZlciA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyOwogICAgCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CiAgICAJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBnbEF0dGFjaG1lbnRUeXBlLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgogICAgCX0KCiAgICAJLy8gcmViaW5kIGZyYW1lYnVmZmVyIHdpdGggZXh0ZXJuYWwgdGV4dHVyZXMKICAgIAlmdW5jdGlvbiByZWJpbmRUZXh0dXJlcyggcmVuZGVyVGFyZ2V0LCBjb2xvclRleHR1cmUsIGRlcHRoVGV4dHVyZSApIHsKCiAgICAJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQlpZiAoIGNvbG9yVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCByZW5kZXJUYXJnZXQudGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBkZXB0aFRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvLyBTZXQgdXAgR0wgcmVzb3VyY2VzIGZvciB0aGUgcmVuZGVyIHRhcmdldAogICAgCWZ1bmN0aW9uIHNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgogICAgCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwogICAgCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgogICAgCQlyZW5kZXJUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblJlbmRlclRhcmdldERpc3Bvc2UgKTsKCiAgICAJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKICAgIAkJY29uc3QgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKICAgIAkJY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSAoIHRleHR1cmVzLmxlbmd0aCA+IDEgKTsKCiAgICAJCWlmICggISBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCiAgICAJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKCiAgICAJCQl9CgogICAgCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwogICAgCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgogICAgCQl9CgogICAgCQkvLyBTZXR1cCBmcmFtZWJ1ZmZlcgoKICAgIAkJaWYgKCBpc0N1YmUgKSB7CgogICAgCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gPSBbXTsKCiAgICAJCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsgbGV2ZWwgKysgKSB7CgogICAgCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCiAgICAJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCiAgICAJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBsZXZlbCBdID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgogICAgCQkJCQlpZiAoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkJYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKICAgIAkJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzICsrOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWlmICggKCByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCiAgICAJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlciA9IFtdOwoKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CiAgICAJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgogICAgCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKICAgIAkJCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICk7CiAgICAJCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwogICAgCQkJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgcmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKICAgIAkJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwogICAgCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCiAgICAJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgogICAgCQkJCX0KCiAgICAJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCiAgICAJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgogICAgCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgIAkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0cnVlICk7CgogICAgCQkJCX0KCiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLyBTZXR1cCBjb2xvciBidWZmZXIKCiAgICAJCWlmICggaXNDdWJlICkgewoKICAgIAkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKICAgIAkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZSApOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJCWlmICggdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCiAgICAJCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBsZXZlbCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgogICAgCQkJCWdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCApOwoKICAgIAkJCX0KCiAgICAJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgogICAgCQl9IGVsc2UgaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGF0dGFjaG1lbnQgPSB0ZXh0dXJlc1sgaSBdOwogICAgCQkJCWNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGF0dGFjaG1lbnQgKTsKCiAgICAJCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJELCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwogICAgCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV8yRCwgYXR0YWNobWVudCApOwogICAgCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBhdHRhY2htZW50LCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKICAgIAkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggYXR0YWNobWVudCApICkgewoKICAgIAkJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFXzJEICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlsZXQgZ2xUZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzJEOwoKICAgIAkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCB8fCByZW5kZXJUYXJnZXQuaXNXZWJHTEFycmF5UmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJCQlnbFRleHR1cmVUeXBlID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCA/IF9nbC5URVhUVVJFXzNEIDogX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgogICAgCQkJfQoKICAgIAkJCXN0YXRlLmJpbmRUZXh0dXJlKCBnbFRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwogICAgCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIGdsVGV4dHVyZVR5cGUsIHRleHR1cmUgKTsKCiAgICAJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCiAgICAJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsVGV4dHVyZVR5cGUsIGxldmVsICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbFRleHR1cmVUeXBlLCAwICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgogICAgCQkJCWdlbmVyYXRlTWlwbWFwKCBnbFRleHR1cmVUeXBlICk7CgogICAgCQkJfQoKICAgIAkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCiAgICAJCX0KCiAgICAJCS8vIFNldHVwIGRlcHRoIGFuZCBzdGVuY2lsIGJ1ZmZlcnMKCiAgICAJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKICAgIAkJCXNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggcmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgogICAgCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCiAgICAJCQkJY29uc3QgdGFyZ2V0VHlwZSA9IGdldFRhcmdldFR5cGUoIHJlbmRlclRhcmdldCApOwogICAgCQkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX193ZWJnbFRleHR1cmU7CgogICAgCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCB0YXJnZXRUeXBlLCB3ZWJnbFRleHR1cmUgKTsKICAgIAkJCQlnZW5lcmF0ZU1pcG1hcCggdGFyZ2V0VHlwZSApOwogICAgCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJY29uc3QgaW52YWxpZGF0aW9uQXJyYXlSZWFkID0gW107CiAgICAJY29uc3QgaW52YWxpZGF0aW9uQXJyYXlEcmF3ID0gW107CgogICAgCWZ1bmN0aW9uIHVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQlpZiAoIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApIHsKCiAgICAJCQlpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKICAgIAkJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKICAgIAkJCQljb25zdCB3aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKICAgIAkJCQljb25zdCBoZWlnaHQgPSByZW5kZXJUYXJnZXQuaGVpZ2h0OwogICAgCQkJCWxldCBtYXNrID0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CiAgICAJCQkJY29uc3QgZGVwdGhTdHlsZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwogICAgCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQkJY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSAoIHRleHR1cmVzLmxlbmd0aCA+IDEgKTsKCiAgICAJCQkJLy8gSWYgTVJUIHdlIG5lZWQgdG8gcmVtb3ZlIEZCTyBhdHRhY2htZW50cwogICAgCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgogICAgCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlJFTkRFUkJVRkZFUiwgbnVsbCApOwoKICAgIAkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIG51bGwsIDAgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKICAgIAkJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCiAgICAJCQkJaWYgKCBtaXBtYXBzICYmIG1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyAwIF0gKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgogICAgCQkJCX0KCiAgICAJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQkJaWYgKCByZW5kZXJUYXJnZXQucmVzb2x2ZURlcHRoQnVmZmVyICkgewoKICAgIAkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgbWFzayB8PSBfZ2wuREVQVEhfQlVGRkVSX0JJVDsKCiAgICAJCQkJCQkvLyByZXNvbHZpbmcgc3RlbmNpbCBpcyBzbG93IHdpdGggYSBEM0QgYmFja2VuZC4gZGlzYWJsZSBpdCBmb3IgYWxsIHRyYW5zbWlzc2lvbiByZW5kZXIgdGFyZ2V0cyAoc2VlICMyNzc5OSkKCiAgICAJCQkJCQlpZiAoIHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyICYmIHJlbmRlclRhcmdldC5yZXNvbHZlU3RlbmNpbEJ1ZmZlciApIG1hc2sgfD0gX2dsLlNURU5DSUxfQlVGRkVSX0JJVDsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgogICAgCQkJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmVzWyBpIF0gKS5fX3dlYmdsVGV4dHVyZTsKICAgIAkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJX2dsLmJsaXRGcmFtZWJ1ZmZlciggMCwgMCwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCwgbWFzaywgX2dsLk5FQVJFU1QgKTsKCiAgICAJCQkJCWlmICggc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgPT09IHRydWUgKSB7CgogICAgCQkJCQkJaW52YWxpZGF0aW9uQXJyYXlSZWFkLmxlbmd0aCA9IDA7CiAgICAJCQkJCQlpbnZhbGlkYXRpb25BcnJheURyYXcubGVuZ3RoID0gMDsKCiAgICAJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQucHVzaCggX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSApOwoKICAgIAkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICYmIHJlbmRlclRhcmdldC5yZXNvbHZlRGVwdGhCdWZmZXIgPT09IGZhbHNlICkgewoKICAgIAkJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQucHVzaCggZGVwdGhTdHlsZSApOwogICAgCQkJCQkJCWludmFsaWRhdGlvbkFycmF5RHJhdy5wdXNoKCBkZXB0aFN0eWxlICk7CgogICAgCQkJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBpbnZhbGlkYXRpb25BcnJheURyYXcgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJX2dsLmludmFsaWRhdGVGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIGludmFsaWRhdGlvbkFycmF5UmVhZCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwgKTsKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgogICAgCQkJCS8vIElmIE1SVCBzaW5jZSBwcmUtYmxpdCB3ZSByZW1vdmVkIHRoZSBGQk8gd2UgbmVlZCB0byByZWNvbnN0cnVjdCB0aGUgYXR0YWNobWVudHMKICAgIAkJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKICAgIAkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCiAgICAJCQkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApLl9fd2ViZ2xUZXh0dXJlOwoKICAgIAkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgJiYgc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgKSB7CgogICAgCQkJCQljb25zdCBkZXB0aFN0eWxlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgogICAgCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgWyBkZXB0aFN0eWxlIF0gKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5taW4oIGNhcGFiaWxpdGllcy5tYXhTYW1wbGVzLCByZW5kZXJUYXJnZXQuc2FtcGxlcyApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCXJldHVybiByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgJiYgZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IHRydWUgJiYgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZVJlbmRlclRvVGV4dHVyZSAhPT0gZmFsc2U7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlVmlkZW9UZXh0dXJlKCB0ZXh0dXJlICkgewoKICAgIAkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCiAgICAJCS8vIENoZWNrIHRoZSBsYXN0IGZyYW1lIHdlIHVwZGF0ZWQgdGhlIFZpZGVvVGV4dHVyZQoKICAgIAkJaWYgKCBfdmlkZW9UZXh0dXJlcy5nZXQoIHRleHR1cmUgKSAhPT0gZnJhbWUgKSB7CgogICAgCQkJX3ZpZGVvVGV4dHVyZXMuc2V0KCB0ZXh0dXJlLCBmcmFtZSApOwogICAgCQkJdGV4dHVyZS51cGRhdGUoKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB2ZXJpZnlDb2xvclNwYWNlKCB0ZXh0dXJlLCBpbWFnZSApIHsKCiAgICAJCWNvbnN0IGNvbG9yU3BhY2UgPSB0ZXh0dXJlLmNvbG9yU3BhY2U7CiAgICAJCWNvbnN0IGZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwogICAgCQljb25zdCB0eXBlID0gdGV4dHVyZS50eXBlOwoKICAgIAkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgPT09IHRydWUgfHwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApIHJldHVybiBpbWFnZTsKCiAgICAJCWlmICggY29sb3JTcGFjZSAhPT0gTGluZWFyU1JHQkNvbG9yU3BhY2UgJiYgY29sb3JTcGFjZSAhPT0gTm9Db2xvclNwYWNlICkgewoKICAgIAkJCS8vIHNSR0IKCiAgICAJCQlpZiAoIENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSB7CgogICAgCQkJCS8vIGluIFdlYkdMIDIgdW5jb21wcmVzc2VkIHRleHR1cmVzIGNhbiBvbmx5IGJlIHNSR0IgZW5jb2RlZCBpZiB0aGV5IGhhdmUgdGhlIFJHQkE4IGZvcm1hdAoKICAgIAkJCQlpZiAoIGZvcm1hdCAhPT0gUkdCQUZvcm1hdCB8fCB0eXBlICE9PSBVbnNpZ25lZEJ5dGVUeXBlICkgewoKICAgIAkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogc1JHQiBlbmNvZGVkIHRleHR1cmVzIGhhdmUgdG8gdXNlIFJHQkFGb3JtYXQgYW5kIFVuc2lnbmVkQnl0ZVR5cGUuJyApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMVGV4dHVyZXM6IFVuc3VwcG9ydGVkIHRleHR1cmUgY29sb3Igc3BhY2U6JywgY29sb3JTcGFjZSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiBpbWFnZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXREaW1lbnNpb25zKCBpbWFnZSApIHsKCiAgICAJCWlmICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHsKCiAgICAJCQkvLyBpZiBpbnRyaW5zaWMgZGF0YSBhcmUgbm90IGF2YWlsYWJsZSwgZmFsbGJhY2sgdG8gd2lkdGgvaGVpZ2h0CgogICAgCQkJX2ltYWdlRGltZW5zaW9ucy53aWR0aCA9IGltYWdlLm5hdHVyYWxXaWR0aCB8fCBpbWFnZS53aWR0aDsKICAgIAkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UubmF0dXJhbEhlaWdodCB8fCBpbWFnZS5oZWlnaHQ7CgogICAgCQl9IGVsc2UgaWYgKCB0eXBlb2YgVmlkZW9GcmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lICkgewoKICAgIAkJCV9pbWFnZURpbWVuc2lvbnMud2lkdGggPSBpbWFnZS5kaXNwbGF5V2lkdGg7CiAgICAJCQlfaW1hZ2VEaW1lbnNpb25zLmhlaWdodCA9IGltYWdlLmRpc3BsYXlIZWlnaHQ7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCV9pbWFnZURpbWVuc2lvbnMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgIAkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIF9pbWFnZURpbWVuc2lvbnM7CgogICAgCX0KCiAgICAJLy8KCiAgICAJdGhpcy5hbGxvY2F0ZVRleHR1cmVVbml0ID0gYWxsb2NhdGVUZXh0dXJlVW5pdDsKICAgIAl0aGlzLnJlc2V0VGV4dHVyZVVuaXRzID0gcmVzZXRUZXh0dXJlVW5pdHM7CgogICAgCXRoaXMuc2V0VGV4dHVyZTJEID0gc2V0VGV4dHVyZTJEOwogICAgCXRoaXMuc2V0VGV4dHVyZTJEQXJyYXkgPSBzZXRUZXh0dXJlMkRBcnJheTsKICAgIAl0aGlzLnNldFRleHR1cmUzRCA9IHNldFRleHR1cmUzRDsKICAgIAl0aGlzLnNldFRleHR1cmVDdWJlID0gc2V0VGV4dHVyZUN1YmU7CiAgICAJdGhpcy5yZWJpbmRUZXh0dXJlcyA9IHJlYmluZFRleHR1cmVzOwogICAgCXRoaXMuc2V0dXBSZW5kZXJUYXJnZXQgPSBzZXR1cFJlbmRlclRhcmdldDsKICAgIAl0aGlzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCA9IHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcDsKICAgIAl0aGlzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ7CiAgICAJdGhpcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyID0gc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlcjsKICAgIAl0aGlzLnNldHVwRnJhbWVCdWZmZXJUZXh0dXJlID0gc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmU7CiAgICAJdGhpcy51c2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQ7CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMVXRpbHMoIGdsLCBleHRlbnNpb25zICkgewoKICAgIAlmdW5jdGlvbiBjb252ZXJ0KCBwLCBjb2xvclNwYWNlID0gTm9Db2xvclNwYWNlICkgewoKICAgIAkJbGV0IGV4dGVuc2lvbjsKCiAgICAJCWNvbnN0IHRyYW5zZmVyID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgogICAgCQlpZiAoIHAgPT09IFVuc2lnbmVkQnl0ZVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfQllURTsKICAgIAkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NDQ0NFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNF80XzRfNDsKICAgIAkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMTsKICAgIAkJaWYgKCBwID09PSBVbnNpZ25lZEludDU5OTlUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVF81XzlfOV85X1JFVjsKCiAgICAJCWlmICggcCA9PT0gQnl0ZVR5cGUgKSByZXR1cm4gZ2wuQllURTsKICAgIAkJaWYgKCBwID09PSBTaG9ydFR5cGUgKSByZXR1cm4gZ2wuU0hPUlQ7CiAgICAJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlQ7CiAgICAJCWlmICggcCA9PT0gSW50VHlwZSApIHJldHVybiBnbC5JTlQ7CiAgICAJCWlmICggcCA9PT0gVW5zaWduZWRJbnRUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVDsKICAgIAkJaWYgKCBwID09PSBGbG9hdFR5cGUgKSByZXR1cm4gZ2wuRkxPQVQ7CiAgICAJCWlmICggcCA9PT0gSGFsZkZsb2F0VHlwZSApIHJldHVybiBnbC5IQUxGX0ZMT0FUOwoKICAgIAkJaWYgKCBwID09PSBBbHBoYUZvcm1hdCApIHJldHVybiBnbC5BTFBIQTsKICAgIAkJaWYgKCBwID09PSBSR0JGb3JtYXQgKSByZXR1cm4gZ2wuUkdCOwogICAgCQlpZiAoIHAgPT09IFJHQkFGb3JtYXQgKSByZXR1cm4gZ2wuUkdCQTsKICAgIAkJaWYgKCBwID09PSBEZXB0aEZvcm1hdCApIHJldHVybiBnbC5ERVBUSF9DT01QT05FTlQ7CiAgICAJCWlmICggcCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgcmV0dXJuIGdsLkRFUFRIX1NURU5DSUw7CgogICAgCQkvLyBXZWJHTDIgZm9ybWF0cy4KCiAgICAJCWlmICggcCA9PT0gUmVkRm9ybWF0ICkgcmV0dXJuIGdsLlJFRDsKICAgIAkJaWYgKCBwID09PSBSZWRJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJFRF9JTlRFR0VSOwogICAgCQlpZiAoIHAgPT09IFJHRm9ybWF0ICkgcmV0dXJuIGdsLlJHOwogICAgCQlpZiAoIHAgPT09IFJHSW50ZWdlckZvcm1hdCApIHJldHVybiBnbC5SR19JTlRFR0VSOwogICAgCQlpZiAoIHAgPT09IFJHQkFJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJHQkFfSU5URUdFUjsKCiAgICAJCS8vIFMzVEMKCiAgICAJCWlmICggcCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSB7CgogICAgCQkJaWYgKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKICAgIAkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2InICk7CgogICAgCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX1MzVENfRFhUMV9FWFQ7CiAgICAJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfQUxQSEFfUzNUQ19EWFQxX0VYVDsKICAgIAkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUM19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9TM1RDX0RYVDNfRVhUOwogICAgCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX1MzVENfRFhUNV9FWFQ7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlyZXR1cm4gbnVsbDsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICk7CgogICAgCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUzNUQ19EWFQxX0VYVDsKICAgIAkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDFfRVhUOwogICAgCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUM19FWFQ7CiAgICAJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQ1X0VYVDsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXJldHVybiBudWxsOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gUFZSVEMKCiAgICAJCWlmICggcCA9PT0gUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHsKCiAgICAJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKTsKCiAgICAJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQkJaWYgKCBwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUFZSVENfNEJQUFYxX0lNRzsKICAgIAkJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ18yQlBQVjFfSU1HOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfNEJQUFYxX0lNRzsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1BWUlRDXzJCUFBWMV9JTUc7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gRVRDCgogICAgCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCB8fCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSB7CgogICAgCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfZXRjJyApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCB8fCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9FVEMyIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCOF9FVEMyOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfRVRDMl9FQUMgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBOF9FVEMyX0VBQzsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlyZXR1cm4gbnVsbDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLyBBU1RDCgogICAgCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ181eDRfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ181eDVfRm9ybWF0IHx8CiAgICAJCQlwID09PSBSR0JBX0FTVENfNng1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCB8fAogICAgCQkJcCA9PT0gUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDVfRm9ybWF0IHx8CiAgICAJCQlwID09PSBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgfHwKICAgIAkJCXAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHsKCiAgICAJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjJyApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNHg0X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ180eDRfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ181eDRfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzV4NF9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNXg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzV4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNXg1X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ182eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNng1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ182eDVfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ182eDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzZ4Nl9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzh4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfOHg1X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ184eDZfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfOHg2X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ184eDZfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ184eDhfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzh4OF9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHg1X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDZfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4OF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4OF9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4MTBfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDEwX0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMngxMF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTJ4MTBfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEyeDEyX0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMngxMl9LSFI7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gQlBUQwoKICAgIAkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0IHx8IHAgPT09IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgfHwgcCA9PT0gUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ICkgewoKICAgIAkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fYnB0YycgKTsKCiAgICAJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9CUFRDX1VOT1JNX0VYVCA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQlBUQ19VTk9STV9FWFQ7CiAgICAJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19TSUdORURfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9CUFRDX1NJR05FRF9GTE9BVF9FWFQ7CiAgICAJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0JQVENfVU5TSUdORURfRkxPQVRfRVhUOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXJldHVybiBudWxsOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIFJHVEMKCiAgICAJCWlmICggcCA9PT0gUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0IHx8IHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgewoKICAgIAkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fcmd0YycgKTsKCiAgICAJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JFRF9SR1RDMV9FWFQ7CiAgICAJCQkJaWYgKCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TSUdORURfUkVEX1JHVEMxX0VYVDsKICAgIAkJCQlpZiAoIHAgPT09IFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkVEX0dSRUVOX1JHVEMyX0VYVDsKICAgIAkJCQlpZiAoIHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NJR05FRF9SRURfR1JFRU5fUkdUQzJfRVhUOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXJldHVybiBudWxsOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9JTlRfMjRfODsKCiAgICAJCS8vIGlmICJwIiBjYW4ndCBiZSByZXNvbHZlZCwgYXNzdW1lIHRoZSB1c2VyIGRlZmluZXMgYSBXZWJHTCBjb25zdGFudCBhcyBhIHN0cmluZyAoZmFsbGJhY2svd29ya2Fyb3VuZCBmb3IgcGFja2VkIFJHQiBmb3JtYXRzKQoKICAgIAkJcmV0dXJuICggZ2xbIHAgXSAhPT0gdW5kZWZpbmVkICkgPyBnbFsgcCBdIDogbnVsbDsKCiAgICAJfQoKICAgIAlyZXR1cm4geyBjb252ZXJ0OiBjb252ZXJ0IH07CgogICAgfQoKICAgIGNvbnN0IF9vY2NsdXNpb25fdmVydGV4ID0gYAp2b2lkIG1haW4oKSB7CgoJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7Cgp9YDsKCiAgICBjb25zdCBfb2NjbHVzaW9uX2ZyYWdtZW50ID0gYAp1bmlmb3JtIHNhbXBsZXIyREFycmF5IGRlcHRoQ29sb3I7CnVuaWZvcm0gZmxvYXQgZGVwdGhXaWR0aDsKdW5pZm9ybSBmbG9hdCBkZXB0aEhlaWdodDsKCnZvaWQgbWFpbigpIHsKCgl2ZWMyIGNvb3JkID0gdmVjMiggZ2xfRnJhZ0Nvb3JkLnggLyBkZXB0aFdpZHRoLCBnbF9GcmFnQ29vcmQueSAvIGRlcHRoSGVpZ2h0ICk7CgoJaWYgKCBjb29yZC54ID49IDEuMCApIHsKCgkJZ2xfRnJhZ0RlcHRoID0gdGV4dHVyZSggZGVwdGhDb2xvciwgdmVjMyggY29vcmQueCAtIDEuMCwgY29vcmQueSwgMSApICkucjsKCgl9IGVsc2UgewoKCQlnbF9GcmFnRGVwdGggPSB0ZXh0dXJlKCBkZXB0aENvbG9yLCB2ZWMzKCBjb29yZC54LCBjb29yZC55LCAwICkgKS5yOwoKCX0KCn1gOwoKICAgIC8qKgogICAgICogQSBYUiBtb2R1bGUgdGhhdCBtYW5hZ2VzIHRoZSBhY2Nlc3MgdG8gdGhlIERlcHRoIFNlbnNpbmcgQVBJLgogICAgICovCiAgICBjbGFzcyBXZWJYUkRlcHRoU2Vuc2luZyB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgZGVwdGggc2Vuc2luZyBtb2R1bGUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQkvKioKICAgIAkJICogQSB0ZXh0dXJlIHJlcHJlc2VudGluZyB0aGUgZGVwdGggb2YgdGhlIHVzZXIncyBlbnZpcm9ubWVudC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKi8KICAgIAkJdGhpcy50ZXh0dXJlID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBBIHBsYW5lIG1lc2ggZm9yIHZpc3VhbGl6aW5nIHRoZSBkZXB0aCB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P01lc2h9CiAgICAJCSAqLwogICAgCQl0aGlzLm1lc2ggPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkZXB0aCBuZWFyIHZhbHVlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aE5lYXIgPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkZXB0aCBuZWFyIGZhci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMuZGVwdGhGYXIgPSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEluaXRzIHRoZSBkZXB0aCBzZW5zaW5nIG1vZHVsZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge1hSV2ViR0xEZXB0aEluZm9ybWF0aW9ufSBkZXB0aERhdGEgLSBUaGUgWFIgZGVwdGggZGF0YS4KICAgIAkgKiBAcGFyYW0ge1hSUmVuZGVyU3RhdGV9IHJlbmRlclN0YXRlIC0gVGhlIFhSIHJlbmRlciBzdGF0ZS4KICAgIAkgKi8KICAgIAlpbml0KCByZW5kZXJlciwgZGVwdGhEYXRhLCByZW5kZXJTdGF0ZSApIHsKCiAgICAJCWlmICggdGhpcy50ZXh0dXJlID09PSBudWxsICkgewoKICAgIAkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKICAgIAkJCWNvbnN0IHRleFByb3BzID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKICAgIAkJCXRleFByb3BzLl9fd2ViZ2xUZXh0dXJlID0gZGVwdGhEYXRhLnRleHR1cmU7CgogICAgCQkJaWYgKCAoIGRlcHRoRGF0YS5kZXB0aE5lYXIgIT09IHJlbmRlclN0YXRlLmRlcHRoTmVhciApIHx8ICggZGVwdGhEYXRhLmRlcHRoRmFyICE9PSByZW5kZXJTdGF0ZS5kZXB0aEZhciApICkgewoKICAgIAkJCQl0aGlzLmRlcHRoTmVhciA9IGRlcHRoRGF0YS5kZXB0aE5lYXI7CiAgICAJCQkJdGhpcy5kZXB0aEZhciA9IGRlcHRoRGF0YS5kZXB0aEZhcjsKCiAgICAJCQl9CgogICAgCQkJdGhpcy50ZXh0dXJlID0gdGV4dHVyZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgcGxhbmUgbWVzaCB0aGF0IHZpc3VhbGl6ZXMgdGhlIGRlcHRoIHRleHR1cmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5Q2FtZXJhfSBjYW1lcmFYUiAtIFRoZSBYUiBjYW1lcmEuCiAgICAJICogQHJldHVybiB7P01lc2h9IFRoZSBwbGFuZSBtZXNoLgogICAgCSAqLwogICAgCWdldE1lc2goIGNhbWVyYVhSICkgewoKICAgIAkJaWYgKCB0aGlzLnRleHR1cmUgIT09IG51bGwgKSB7CgogICAgCQkJaWYgKCB0aGlzLm1lc2ggPT09IG51bGwgKSB7CgogICAgCQkJCWNvbnN0IHZpZXdwb3J0ID0gY2FtZXJhWFIuY2FtZXJhc1sgMCBdLnZpZXdwb3J0OwogICAgCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IFNoYWRlck1hdGVyaWFsKCB7CiAgICAJCQkJCXZlcnRleFNoYWRlcjogX29jY2x1c2lvbl92ZXJ0ZXgsCiAgICAJCQkJCWZyYWdtZW50U2hhZGVyOiBfb2NjbHVzaW9uX2ZyYWdtZW50LAogICAgCQkJCQl1bmlmb3JtczogewogICAgCQkJCQkJZGVwdGhDb2xvcjogeyB2YWx1ZTogdGhpcy50ZXh0dXJlIH0sCiAgICAJCQkJCQlkZXB0aFdpZHRoOiB7IHZhbHVlOiB2aWV3cG9ydC56IH0sCiAgICAJCQkJCQlkZXB0aEhlaWdodDogeyB2YWx1ZTogdmlld3BvcnQudyB9CiAgICAJCQkJCX0KICAgIAkJCQl9ICk7CgogICAgCQkJCXRoaXMubWVzaCA9IG5ldyBNZXNoKCBuZXcgUGxhbmVHZW9tZXRyeSggMjAsIDIwICksIG1hdGVyaWFsICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXMubWVzaDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXNldHMgdGhlIG1vZHVsZQogICAgCSAqLwogICAgCXJlc2V0KCkgewoKICAgIAkJdGhpcy50ZXh0dXJlID0gbnVsbDsKICAgIAkJdGhpcy5tZXNoID0gbnVsbDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgdGV4dHVyZSByZXByZXNlbnRpbmcgdGhlIGRlcHRoIG9mIHRoZSB1c2VyJ3MgZW52aXJvbm1lbnQuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHs/VGV4dHVyZX0gVGhlIGRlcHRoIHRleHR1cmUuCiAgICAJICovCiAgICAJZ2V0RGVwdGhUZXh0dXJlKCkgewoKICAgIAkJcmV0dXJuIHRoaXMudGV4dHVyZTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyBhbiBhYnN0cmFjdGlvbiBvZiB0aGUgV2ViWFIgRGV2aWNlIEFQSSBhbmQgaXMKICAgICAqIGludGVybmFsbHkgdXNlZCBieSB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uIGBXZWJYUk1hbmFnZXJgIGFsc28gcHJvdmlkZXMgYSBwdWJsaWMKICAgICAqIGludGVyZmFjZSB0aGF0IGFsbG93cyB1c2VycyB0byBlbmFibGUvZGlzYWJsZSBYUiBhbmQgcGVyZm9ybSBYUiByZWxhdGVkCiAgICAgKiB0YXNrcyBsaWtlIGZvciBpbnN0YW5jZSByZXRyaWV2aW5nIGNvbnRyb2xsZXJzLgogICAgICoKICAgICAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKICAgICAqIEBoaWRlY29uc3RydWN0b3IKICAgICAqLwogICAgY2xhc3MgV2ViWFJNYW5hZ2VyIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBXZWJHTCByZW5kZXJlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtXZWJHTDJSZW5kZXJpbmdDb250ZXh0fSBnbCAtIFRoZSByZW5kZXJpbmcgY29udGV4dC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggcmVuZGVyZXIsIGdsICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCWNvbnN0IHNjb3BlID0gdGhpczsKCiAgICAJCWxldCBzZXNzaW9uID0gbnVsbDsKCiAgICAJCWxldCBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gMS4wOwoKICAgIAkJbGV0IHJlZmVyZW5jZVNwYWNlID0gbnVsbDsKICAgIAkJbGV0IHJlZmVyZW5jZVNwYWNlVHlwZSA9ICdsb2NhbC1mbG9vcic7CiAgICAJCS8vIFNldCBkZWZhdWx0IGZvdmVhdGlvbiB0byBtYXhpbXVtLgogICAgCQlsZXQgZm92ZWF0aW9uID0gMS4wOwogICAgCQlsZXQgY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwoKICAgIAkJbGV0IHBvc2UgPSBudWxsOwogICAgCQlsZXQgZ2xCaW5kaW5nID0gbnVsbDsKICAgIAkJbGV0IGdsUHJvakxheWVyID0gbnVsbDsKICAgIAkJbGV0IGdsQmFzZUxheWVyID0gbnVsbDsKICAgIAkJbGV0IHhyRnJhbWUgPSBudWxsOwoKICAgIAkJY29uc3QgZGVwdGhTZW5zaW5nID0gbmV3IFdlYlhSRGVwdGhTZW5zaW5nKCk7CiAgICAJCWNvbnN0IGF0dHJpYnV0ZXMgPSBnbC5nZXRDb250ZXh0QXR0cmlidXRlcygpOwoKICAgIAkJbGV0IGluaXRpYWxSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgCQlsZXQgbmV3UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCiAgICAJCWNvbnN0IGNvbnRyb2xsZXJzID0gW107CiAgICAJCWNvbnN0IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMgPSBbXTsKCiAgICAJCWNvbnN0IGN1cnJlbnRTaXplID0gbmV3IFZlY3RvcjIoKTsKICAgIAkJbGV0IGN1cnJlbnRQaXhlbFJhdGlvID0gbnVsbDsKCiAgICAJCS8vCgogICAgCQljb25zdCBjYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CiAgICAJCWNhbWVyYUwudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKICAgIAkJY29uc3QgY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwogICAgCQljYW1lcmFSLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKCiAgICAJCWNvbnN0IGNhbWVyYXMgPSBbIGNhbWVyYUwsIGNhbWVyYVIgXTsKCiAgICAJCWNvbnN0IGNhbWVyYVhSID0gbmV3IEFycmF5Q2FtZXJhKCk7CgogICAgCQlsZXQgX2N1cnJlbnREZXB0aE5lYXIgPSBudWxsOwogICAgCQlsZXQgX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CgogICAgCQkvLwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdGhlIG1hbmFnZXIncyBYUiBjYW1lcmEgc2hvdWxkIGJlIGF1dG9tYXRpY2FsbHkgdXBkYXRlZCBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmNhbWVyYUF1dG9VcGRhdGUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBub3RpZmllcyB0aGUgcmVuZGVyZXIgdG8gYmUgcmVhZHkgZm9yIFhSIHJlbmRlcmluZy4gU2V0IGl0IHRvIGB0cnVlYAogICAgCQkgKiBpZiB5b3UgYXJlIGdvaW5nIHRvIHVzZSBYUiBpbiB5b3VyIGFwcC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIFhSIHByZXNlbnRhdGlvbiBpcyBhY3RpdmUgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGB0YXJnZXQgcmF5YCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkJICogVXNlIHRoaXMgc3BhY2UgZm9yIHZpc3VhbGl6aW5nIDNEIG9iamVjdHMgdGhhdCBzdXBwb3J0IHRoZSB1c2VyIGluIHBvaW50aW5nCiAgICAJCSAqIHRhc2tzIGxpa2UgVUkgaW50ZXJhY3Rpb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgY29udHJvbGxlci4KICAgIAkJICogQHJldHVybiB7R3JvdXB9IEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgdGFyZ2V0IHJheWAgc3BhY2UuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKICAgIAkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgogICAgCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CiAgICAJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gY29udHJvbGxlci5nZXRUYXJnZXRSYXlTcGFjZSgpOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgZ3JpcGAgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJCSAqIFVzZSB0aGlzIHNwYWNlIGZvciB2aXN1YWxpemluZyAzRCBvYmplY3RzIHRoYXQgc3VwcG9ydCB0aGUgdXNlciBpbiBwb2ludGluZwogICAgCQkgKiB0YXNrcyBsaWtlIFVJIGludGVyYWN0aW9uLgogICAgCQkgKgogICAgCQkgKiBOb3RlOiBJZiB5b3Ugd2FudCB0byBzaG93IHNvbWV0aGluZyBpbiB0aGUgdXNlcidzIGhhbmQgQU5EIG9mZmVyIGEKICAgIAkJICogcG9pbnRpbmcgcmF5IGF0IHRoZSBzYW1lIHRpbWUsIHlvdSdsbCB3YW50IHRvIGF0dGFjaGVkIHRoZSBoYW5kaGVsZCBvYmplY3QKICAgIAkJICogdG8gdGhlIGdyb3VwIHJldHVybmVkIGJ5IGBnZXRDb250cm9sbGVyR3JpcCgpYCBhbmQgdGhlIHJheSB0byB0aGUKICAgIAkJICogZ3JvdXAgcmV0dXJuZWQgYnkgYGdldENvbnRyb2xsZXIoKWAuIFRoZSBpZGVhIGlzIHRvIGhhdmUgdHdvCiAgICAJCSAqIGRpZmZlcmVudCBncm91cHMgaW4gdHdvIGRpZmZlcmVudCBjb29yZGluYXRlIHNwYWNlcyBmb3IgdGhlIHNhbWUgV2ViWFIKICAgIAkJICogY29udHJvbGxlci4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgogICAgCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBncmlwYCBzcGFjZS4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0Q29udHJvbGxlckdyaXAgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKICAgIAkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgogICAgCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CiAgICAJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gY29udHJvbGxlci5nZXRHcmlwU3BhY2UoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgYGhhbmRgIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCQkgKiBVc2UgdGhpcyBzcGFjZSBmb3IgdmlzdWFsaXppbmcgM0Qgb2JqZWN0cyB0aGF0IHN1cHBvcnQgdGhlIHVzZXIgaW4gcG9pbnRpbmcKICAgIAkJICogdGFza3MgbGlrZSBVSSBpbnRlcmFjdGlvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgogICAgCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBoYW5kYCBzcGFjZS4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0SGFuZCA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgogICAgCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCiAgICAJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKICAgIAkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBjb250cm9sbGVyLmdldEhhbmRTcGFjZSgpOwoKICAgIAkJfTsKCiAgICAJCS8vCgogICAgCQlmdW5jdGlvbiBvblNlc3Npb25FdmVudCggZXZlbnQgKSB7CgogICAgCQkJY29uc3QgY29udHJvbGxlckluZGV4ID0gY29udHJvbGxlcklucHV0U291cmNlcy5pbmRleE9mKCBldmVudC5pbnB1dFNvdXJjZSApOwoKICAgIAkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtMSApIHsKCiAgICAJCQkJcmV0dXJuOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGNvbnRyb2xsZXJJbmRleCBdOwoKICAgIAkJCWlmICggY29udHJvbGxlciAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljb250cm9sbGVyLnVwZGF0ZSggZXZlbnQuaW5wdXRTb3VyY2UsIGV2ZW50LmZyYW1lLCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwogICAgCQkJCWNvbnRyb2xsZXIuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiBldmVudC50eXBlLCBkYXRhOiBldmVudC5pbnB1dFNvdXJjZSB9ICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gb25TZXNzaW9uRW5kKCkgewoKICAgIAkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RlbmQnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZScsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzcXVlZXplc3RhcnQnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZWVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdlbmQnLCBvblNlc3Npb25FbmQgKTsKICAgIAkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIG9uSW5wdXRTb3VyY2VzQ2hhbmdlICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXTsKCiAgICAJCQkJaWYgKCBpbnB1dFNvdXJjZSA9PT0gbnVsbCApIGNvbnRpbnVlOwoKICAgIAkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBudWxsOwoKICAgIAkJCQljb250cm9sbGVyc1sgaSBdLmRpc2Nvbm5lY3QoIGlucHV0U291cmNlICk7CgogICAgCQkJfQoKICAgIAkJCV9jdXJyZW50RGVwdGhOZWFyID0gbnVsbDsKICAgIAkJCV9jdXJyZW50RGVwdGhGYXIgPSBudWxsOwoKICAgIAkJCWRlcHRoU2Vuc2luZy5yZXNldCgpOwoKICAgIAkJCS8vIHJlc3RvcmUgZnJhbWVidWZmZXIvcmVuZGVyaW5nIHN0YXRlCgogICAgCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBpbml0aWFsUmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJZ2xCYXNlTGF5ZXIgPSBudWxsOwogICAgCQkJZ2xQcm9qTGF5ZXIgPSBudWxsOwogICAgCQkJZ2xCaW5kaW5nID0gbnVsbDsKICAgIAkJCXNlc3Npb24gPSBudWxsOwogICAgCQkJbmV3UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCiAgICAJCQkvLwoKICAgIAkJCWFuaW1hdGlvbi5zdG9wKCk7CgogICAgCQkJc2NvcGUuaXNQcmVzZW50aW5nID0gZmFsc2U7CgogICAgCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggY3VycmVudFBpeGVsUmF0aW8gKTsKICAgIAkJCXJlbmRlcmVyLnNldFNpemUoIGN1cnJlbnRTaXplLndpZHRoLCBjdXJyZW50U2l6ZS5oZWlnaHQsIGZhbHNlICk7CgogICAgCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc2Vzc2lvbmVuZCcgfSApOwoKICAgIAkJfQoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIGZyYW1lYnVmZmVyIHNjYWxlIGZhY3Rvci4KICAgIAkJICoKICAgIAkJICogVGhpcyBtZXRob2QgY2FuIG5vdCBiZSB1c2VkIGR1cmluZyBhIFhSIHNlc3Npb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSBmcmFtZWJ1ZmZlciBzY2FsZSBmYWN0b3IuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldEZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKICAgIAkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSB2YWx1ZTsKCiAgICAJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIGZyYW1lYnVmZmVyIHNjYWxlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgcmVmZXJlbmNlIHNwYWNlIHR5cGUuIENhbiBiZSB1c2VkIHRvIGNvbmZpZ3VyZSBhIHNwYXRpYWwgcmVsYXRpb25zaGlwIHdpdGggdGhlIHVzZXIncyBwaHlzaWNhbAogICAgCQkgKiBlbnZpcm9ubWVudC4gRGVwZW5kaW5nIG9uIGhvdyB0aGUgdXNlciBtb3ZlcyBpbiAzRCBzcGFjZSwgc2V0dGluZyBhbiBhcHByb3ByaWF0ZSByZWZlcmVuY2Ugc3BhY2UgY2FuCiAgICAJCSAqIGltcHJvdmUgdHJhY2tpbmcuIERlZmF1bHQgaXMgYGxvY2FsLWZsb29yYC4gVmFsaWQgdmFsdWVzIGNhbiBiZSBmb3VuZCBoZXJlCiAgICAJCSAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9YUlJlZmVyZW5jZVNwYWNlI3JlZmVyZW5jZV9zcGFjZV90eXBlcy4KICAgIAkJICoKICAgIAkJICogVGhpcyBtZXRob2QgY2FuIG5vdCBiZSB1c2VkIGR1cmluZyBhIFhSIHNlc3Npb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSByZWZlcmVuY2Ugc3BhY2UgdHlwZS4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2VUeXBlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCiAgICAJCQlyZWZlcmVuY2VTcGFjZVR5cGUgPSB2YWx1ZTsKCiAgICAJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIHJlZmVyZW5jZSBzcGFjZSB0eXBlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgWFIgcmVmZXJlbmNlIHNwYWNlLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHtYUlJlZmVyZW5jZVNwYWNlfSBUaGUgWFIgcmVmZXJlbmNlIHNwYWNlLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRSZWZlcmVuY2VTcGFjZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2U7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgYSBjdXN0b20gWFIgcmVmZXJlbmNlIHNwYWNlLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge1hSUmVmZXJlbmNlU3BhY2V9IHNwYWNlIC0gVGhlIFhSIHJlZmVyZW5jZSBzcGFjZS4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2UgPSBmdW5jdGlvbiAoIHNwYWNlICkgewoKICAgIAkJCWN1c3RvbVJlZmVyZW5jZVNwYWNlID0gc3BhY2U7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgYmFzZSBsYXllci4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7PyhYUldlYkdMTGF5ZXJ8WFJQcm9qZWN0aW9uTGF5ZXIpfSBUaGUgWFIgYmFzZSBsYXllci4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0QmFzZUxheWVyID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBnbFByb2pMYXllciAhPT0gbnVsbCA/IGdsUHJvakxheWVyIDogZ2xCYXNlTGF5ZXI7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgWFIgYmluZGluZy4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7P1hSV2ViR0xCaW5kaW5nfSBUaGUgWFIgYmluZGluZy4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0QmluZGluZyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gZ2xCaW5kaW5nOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IFhSIGZyYW1lLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHs/WFJGcmFtZX0gVGhlIFhSIGZyYW1lLiBSZXR1cm5zIGBudWxsYCB3aGVuIHVzZWQgb3V0c2lkZSBhIFhSIHNlc3Npb24uCiAgICAJCSAqLwogICAgCQl0aGlzLmdldEZyYW1lID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiB4ckZyYW1lOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IFhSIHNlc3Npb24uCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4gez9YUlNlc3Npb259IFRoZSBYUiBzZXNzaW9uLiBSZXR1cm5zIGBudWxsYCB3aGVuIHVzZWQgb3V0c2lkZSBhIFhSIHNlc3Npb24uCiAgICAJCSAqLwogICAgCQl0aGlzLmdldFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIHNlc3Npb247CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIEFmdGVyIGEgWFIgc2Vzc2lvbiBoYXMgYmVlbiByZXF1ZXN0ZWQgdXN1YWxseSB3aXRoIG9uZSBvZiB0aGUgYCpCdXR0b25gIG1vZHVsZXMsIGl0CiAgICAJCSAqIGlzIGluamVjdGVkIGludG8gdGhlIHJlbmRlcmVyIHdpdGggdGhpcyBtZXRob2QuIFRoaXMgbWV0aG9kIHRyaWdnZXJzIHRoZSBzdGFydCBvZgogICAgCQkgKiB0aGUgYWN0dWFsIFhSIHJlbmRlcmluZy4KICAgIAkJICoKICAgIAkJICogQGFzeW5jCiAgICAJCSAqIEBwYXJhbSB7WFJTZXNzaW9ufSB2YWx1ZSAtIFRoZSBYUiBzZXNzaW9uIHRvIHNldC4KICAgIAkJICogQHJldHVybiB7UHJvbWlzZX0gQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgc2Vzc2lvbiBoYXMgYmVlbiBzZXQuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFNlc3Npb24gPSBhc3luYyBmdW5jdGlvbiAoIHZhbHVlICkgewoKICAgIAkJCXNlc3Npb24gPSB2YWx1ZTsKCiAgICAJCQlpZiAoIHNlc3Npb24gIT09IG51bGwgKSB7CgogICAgCQkJCWluaXRpYWxSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCiAgICAJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0Jywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0ZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplJywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplc3RhcnQnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVlbmQnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZCApOwogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIG9uSW5wdXRTb3VyY2VzQ2hhbmdlICk7CgogICAgCQkJCWlmICggYXR0cmlidXRlcy54ckNvbXBhdGlibGUgIT09IHRydWUgKSB7CgogICAgCQkJCQlhd2FpdCBnbC5tYWtlWFJDb21wYXRpYmxlKCk7CgogICAgCQkJCX0KCiAgICAJCQkJY3VycmVudFBpeGVsUmF0aW8gPSByZW5kZXJlci5nZXRQaXhlbFJhdGlvKCk7CiAgICAJCQkJcmVuZGVyZXIuZ2V0U2l6ZSggY3VycmVudFNpemUgKTsKCiAgICAJCQkJLy8gQ2hlY2sgdGhhdCB0aGUgYnJvd3NlciBpbXBsZW1lbnRzIHRoZSBuZWNlc3NhcnkgQVBJcyB0byB1c2UgYW4KICAgIAkJCQkvLyBYUlByb2plY3Rpb25MYXllciByYXRoZXIgdGhhbiBhbiBYUldlYkdMTGF5ZXIKICAgIAkJCQljb25zdCB1c2VMYXllcnMgPSB0eXBlb2YgWFJXZWJHTEJpbmRpbmcgIT09ICd1bmRlZmluZWQnICYmICdjcmVhdGVQcm9qZWN0aW9uTGF5ZXInIGluIFhSV2ViR0xCaW5kaW5nLnByb3RvdHlwZTsKCiAgICAJCQkJaWYgKCAhIHVzZUxheWVycyApIHsKCiAgICAJCQkJCWNvbnN0IGxheWVySW5pdCA9IHsKICAgIAkJCQkJCWFudGlhbGlhczogYXR0cmlidXRlcy5hbnRpYWxpYXMsCiAgICAJCQkJCQlhbHBoYTogdHJ1ZSwKICAgIAkJCQkJCWRlcHRoOiBhdHRyaWJ1dGVzLmRlcHRoLAogICAgCQkJCQkJc3RlbmNpbDogYXR0cmlidXRlcy5zdGVuY2lsLAogICAgCQkJCQkJZnJhbWVidWZmZXJTY2FsZUZhY3RvcjogZnJhbWVidWZmZXJTY2FsZUZhY3RvcgogICAgCQkJCQl9OwoKICAgIAkJCQkJZ2xCYXNlTGF5ZXIgPSBuZXcgWFJXZWJHTExheWVyKCBzZXNzaW9uLCBnbCwgbGF5ZXJJbml0ICk7CgogICAgCQkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7IGJhc2VMYXllcjogZ2xCYXNlTGF5ZXIgfSApOwoKICAgIAkJCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggMSApOwogICAgCQkJCQlyZW5kZXJlci5zZXRTaXplKCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlcldpZHRoLCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwgZmFsc2UgKTsKCiAgICAJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKICAgIAkJCQkJCWdsQmFzZUxheWVyLmZyYW1lYnVmZmVyV2lkdGgsCiAgICAJCQkJCQlnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwKICAgIAkJCQkJCXsKICAgIAkJCQkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCiAgICAJCQkJCQkJdHlwZTogVW5zaWduZWRCeXRlVHlwZSwKICAgIAkJCQkJCQljb2xvclNwYWNlOiByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlLAogICAgCQkJCQkJCXN0ZW5jaWxCdWZmZXI6IGF0dHJpYnV0ZXMuc3RlbmNpbCwKICAgIAkJCQkJCQlyZXNvbHZlRGVwdGhCdWZmZXI6ICggZ2xCYXNlTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICksCiAgICAJCQkJCQkJcmVzb2x2ZVN0ZW5jaWxCdWZmZXI6ICggZ2xCYXNlTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICkKCiAgICAJCQkJCQl9CiAgICAJCQkJCSk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlsZXQgZGVwdGhGb3JtYXQgPSBudWxsOwogICAgCQkJCQlsZXQgZGVwdGhUeXBlID0gbnVsbDsKICAgIAkJCQkJbGV0IGdsRGVwdGhGb3JtYXQgPSBudWxsOwoKICAgIAkJCQkJaWYgKCBhdHRyaWJ1dGVzLmRlcHRoICkgewoKICAgIAkJCQkJCWdsRGVwdGhGb3JtYXQgPSBhdHRyaWJ1dGVzLnN0ZW5jaWwgPyBnbC5ERVBUSDI0X1NURU5DSUw4IDogZ2wuREVQVEhfQ09NUE9ORU5UMjQ7CiAgICAJCQkJCQlkZXB0aEZvcm1hdCA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IERlcHRoU3RlbmNpbEZvcm1hdCA6IERlcHRoRm9ybWF0OwogICAgCQkJCQkJZGVwdGhUeXBlID0gYXR0cmlidXRlcy5zdGVuY2lsID8gVW5zaWduZWRJbnQyNDhUeXBlIDogVW5zaWduZWRJbnRUeXBlOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJY29uc3QgcHJvamVjdGlvbmxheWVySW5pdCA9IHsKICAgIAkJCQkJCWNvbG9yRm9ybWF0OiBnbC5SR0JBOCwKICAgIAkJCQkJCWRlcHRoRm9ybWF0OiBnbERlcHRoRm9ybWF0LAogICAgCQkJCQkJc2NhbGVGYWN0b3I6IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IKICAgIAkJCQkJfTsKCiAgICAJCQkJCWdsQmluZGluZyA9IG5ldyBYUldlYkdMQmluZGluZyggc2Vzc2lvbiwgZ2wgKTsKCiAgICAJCQkJCWdsUHJvakxheWVyID0gZ2xCaW5kaW5nLmNyZWF0ZVByb2plY3Rpb25MYXllciggcHJvamVjdGlvbmxheWVySW5pdCApOwoKICAgIAkJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggeyBsYXllcnM6IFsgZ2xQcm9qTGF5ZXIgXSB9ICk7CgogICAgCQkJCQlyZW5kZXJlci5zZXRQaXhlbFJhdGlvKCAxICk7CiAgICAJCQkJCXJlbmRlcmVyLnNldFNpemUoIGdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwgZ2xQcm9qTGF5ZXIudGV4dHVyZUhlaWdodCwgZmFsc2UgKTsKCiAgICAJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKICAgIAkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwKICAgIAkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsCiAgICAJCQkJCQl7CiAgICAJCQkJCQkJZm9ybWF0OiBSR0JBRm9ybWF0LAogICAgCQkJCQkJCXR5cGU6IFVuc2lnbmVkQnl0ZVR5cGUsCiAgICAJCQkJCQkJZGVwdGhUZXh0dXJlOiBuZXcgRGVwdGhUZXh0dXJlKCBnbFByb2pMYXllci50ZXh0dXJlV2lkdGgsIGdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsIGRlcHRoVHlwZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGVwdGhGb3JtYXQgKSwKICAgIAkJCQkJCQlzdGVuY2lsQnVmZmVyOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCiAgICAJCQkJCQkJY29sb3JTcGFjZTogcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSwKICAgIAkJCQkJCQlzYW1wbGVzOiBhdHRyaWJ1dGVzLmFudGlhbGlhcyA/IDQgOiAwLAogICAgCQkJCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogKCBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKSwKICAgIAkJCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogKCBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKQogICAgCQkJCQkJfSApOwoKICAgIAkJCQl9CgogICAgCQkJCW5ld1JlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsgLy8gVE9ETyBSZW1vdmUgdGhpcyB3aGVuIHBvc3NpYmxlLCBzZWUgIzIzMjc4CgogICAgCQkJCXRoaXMuc2V0Rm92ZWF0aW9uKCBmb3ZlYXRpb24gKTsKCiAgICAJCQkJY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwogICAgCQkJCXJlZmVyZW5jZVNwYWNlID0gYXdhaXQgc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UoIHJlZmVyZW5jZVNwYWNlVHlwZSApOwoKICAgIAkJCQlhbmltYXRpb24uc2V0Q29udGV4dCggc2Vzc2lvbiApOwogICAgCQkJCWFuaW1hdGlvbi5zdGFydCgpOwoKICAgIAkJCQlzY29wZS5pc1ByZXNlbnRpbmcgPSB0cnVlOwoKICAgIAkJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZXNzaW9uc3RhcnQnIH0gKTsKCiAgICAJCQl9CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGVudmlyb25tZW50IGJsZW5kIG1vZGUgZnJvbSB0aGUgY3VycmVudCBYUiBzZXNzaW9uLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHsnb3BhcXVlJ3wnYWRkaXRpdmUnfCdhbHBoYS1ibGVuZCd8dW5kZWZpbmVkfSBUaGUgZW52aXJvbm1lbnQgYmxlbmQgbW9kZS4gUmV0dXJucyBgdW5kZWZpbmVkYCB3aGVuIHVzZWQgb3V0c2lkZSBvZiBhIFhSIHNlc3Npb24uCiAgICAJCSAqLwogICAgCQl0aGlzLmdldEVudmlyb25tZW50QmxlbmRNb2RlID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCWlmICggc2Vzc2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQkJcmV0dXJuIHNlc3Npb24uZW52aXJvbm1lbnRCbGVuZE1vZGU7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGRlcHRoIHRleHR1cmUgY29tcHV0ZWQgdmlhIGRlcHRoIHNlbnNpbmcuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4gez9UZXh0dXJlfSBUaGUgZGVwdGggdGV4dHVyZS4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0RGVwdGhUZXh0dXJlID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBkZXB0aFNlbnNpbmcuZ2V0RGVwdGhUZXh0dXJlKCk7CgogICAgCQl9OwoKICAgIAkJZnVuY3Rpb24gb25JbnB1dFNvdXJjZXNDaGFuZ2UoIGV2ZW50ICkgewoKICAgIAkJCS8vIE5vdGlmeSBkaXNjb25uZWN0ZWQKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5yZW1vdmVkLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBldmVudC5yZW1vdmVkWyBpIF07CiAgICAJCQkJY29uc3QgaW5kZXggPSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmluZGV4T2YoIGlucHV0U291cmNlICk7CgogICAgCQkJCWlmICggaW5kZXggPj0gMCApIHsKCiAgICAJCQkJCWNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGluZGV4IF0gPSBudWxsOwogICAgCQkJCQljb250cm9sbGVyc1sgaW5kZXggXS5kaXNjb25uZWN0KCBpbnB1dFNvdXJjZSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIE5vdGlmeSBjb25uZWN0ZWQKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5hZGRlZC5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGlucHV0U291cmNlID0gZXZlbnQuYWRkZWRbIGkgXTsKCiAgICAJCQkJbGV0IGNvbnRyb2xsZXJJbmRleCA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMuaW5kZXhPZiggaW5wdXRTb3VyY2UgKTsKCiAgICAJCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0xICkgewoKICAgIAkJCQkJLy8gQXNzaWduIGlucHV0IHNvdXJjZSBhIGNvbnRyb2xsZXIgdGhhdCBjdXJyZW50bHkgaGFzIG5vIGlucHV0IHNvdXJjZQoKICAgIAkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQkJCWlmICggaSA+PSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmxlbmd0aCApIHsKCiAgICAJCQkJCQkJY29udHJvbGxlcklucHV0U291cmNlcy5wdXNoKCBpbnB1dFNvdXJjZSApOwogICAgCQkJCQkJCWNvbnRyb2xsZXJJbmRleCA9IGk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJfSBlbHNlIGlmICggY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdID09PSBudWxsICkgewoKICAgIAkJCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBpbnB1dFNvdXJjZTsKICAgIAkJCQkJCQljb250cm9sbGVySW5kZXggPSBpOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJCS8vIElmIGFsbCBjb250cm9sbGVycyBkbyBjdXJyZW50bHkgcmVjZWl2ZSBpbnB1dCB3ZSBpZ25vcmUgbmV3IG9uZXMKCiAgICAJCQkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtMSApIGJyZWFrOwoKICAgIAkJCQl9CgogICAgCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgY29udHJvbGxlckluZGV4IF07CgogICAgCQkJCWlmICggY29udHJvbGxlciApIHsKCiAgICAJCQkJCWNvbnRyb2xsZXIuY29ubmVjdCggaW5wdXRTb3VyY2UgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQljb25zdCBjYW1lcmFMUG9zID0gbmV3IFZlY3RvcjMoKTsKICAgIAkJY29uc3QgY2FtZXJhUlBvcyA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQkvKioKICAgIAkJICogQXNzdW1lcyAyIGNhbWVyYXMgdGhhdCBhcmUgcGFyYWxsZWwgYW5kIHNoYXJlIGFuIFgtYXhpcywgYW5kIHRoYXQKICAgIAkJICogdGhlIGNhbWVyYXMnIHByb2plY3Rpb24gYW5kIHdvcmxkIG1hdHJpY2VzIGhhdmUgYWxyZWFkeSBiZWVuIHNldC4KICAgIAkJICogQW5kIHRoYXQgbmVhciBhbmQgZmFyIHBsYW5lcyBhcmUgaWRlbnRpY2FsIGZvciBib3RoIGNhbWVyYXMuCiAgICAJCSAqIFZpc3VhbGl6YXRpb24gb2YgdGhpcyB0ZWNobmlxdWU6IGh0dHBzOi8vY29tcHV0ZXJncmFwaGljcy5zdGFja2V4Y2hhbmdlLmNvbS9hLzQ3NjUKICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtBcnJheUNhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0byB1cGRhdGUuCiAgICAJCSAqIEBwYXJhbSB7UGVyc3BlY3RpdmVDYW1lcmF9IGNhbWVyYUwgLSBUaGUgbGVmdCBjYW1lcmEuCiAgICAJCSAqIEBwYXJhbSB7UGVyc3BlY3RpdmVDYW1lcmF9IGNhbWVyYVIgLSBUaGUgcmlnaHQgY2FtZXJhLgogICAgCQkgKi8KICAgIAkJZnVuY3Rpb24gc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhLCBjYW1lcmFMLCBjYW1lcmFSICkgewoKICAgIAkJCWNhbWVyYUxQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmFMLm1hdHJpeFdvcmxkICk7CiAgICAJCQljYW1lcmFSUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhUi5tYXRyaXhXb3JsZCApOwoKICAgIAkJCWNvbnN0IGlwZCA9IGNhbWVyYUxQb3MuZGlzdGFuY2VUbyggY2FtZXJhUlBvcyApOwoKICAgIAkJCWNvbnN0IHByb2pMID0gY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwogICAgCQkJY29uc3QgcHJvalIgPSBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgogICAgCQkJLy8gVlIgc3lzdGVtcyB3aWxsIGhhdmUgaWRlbnRpY2FsIGZhciBhbmQgbmVhciBwbGFuZXMsIGFuZAogICAgCQkJLy8gbW9zdCBsaWtlbHkgaWRlbnRpY2FsIHRvcCBhbmQgYm90dG9tIGZydXN0dW0gZXh0ZW50cy4KICAgIAkJCS8vIFVzZSB0aGUgbGVmdCBjYW1lcmEgZm9yIHRoZXNlIHZhbHVlcy4KICAgIAkJCWNvbnN0IG5lYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gLSAxICk7CiAgICAJCQljb25zdCBmYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gKyAxICk7CiAgICAJCQljb25zdCB0b3BGb3YgPSAoIHByb2pMWyA5IF0gKyAxICkgLyBwcm9qTFsgNSBdOwogICAgCQkJY29uc3QgYm90dG9tRm92ID0gKCBwcm9qTFsgOSBdIC0gMSApIC8gcHJvakxbIDUgXTsKCiAgICAJCQljb25zdCBsZWZ0Rm92ID0gKCBwcm9qTFsgOCBdIC0gMSApIC8gcHJvakxbIDAgXTsKICAgIAkJCWNvbnN0IHJpZ2h0Rm92ID0gKCBwcm9qUlsgOCBdICsgMSApIC8gcHJvalJbIDAgXTsKICAgIAkJCWNvbnN0IGxlZnQgPSBuZWFyICogbGVmdEZvdjsKICAgIAkJCWNvbnN0IHJpZ2h0ID0gbmVhciAqIHJpZ2h0Rm92OwoKICAgIAkJCS8vIENhbGN1bGF0ZSB0aGUgbmV3IGNhbWVyYSdzIHBvc2l0aW9uIG9mZnNldCBmcm9tIHRoZQogICAgCQkJLy8gbGVmdCBjYW1lcmEuIHhPZmZzZXQgc2hvdWxkIGJlIHJvdWdobHkgaGFsZiBgaXBkYC4KICAgIAkJCWNvbnN0IHpPZmZzZXQgPSBpcGQgLyAoIC0gbGVmdEZvdiArIHJpZ2h0Rm92ICk7CiAgICAJCQljb25zdCB4T2Zmc2V0ID0gek9mZnNldCAqIC0gbGVmdEZvdjsKCiAgICAJCQkvLyBUT0RPOiBCZXR0ZXIgd2F5IHRvIGFwcGx5IHRoaXMgb2Zmc2V0PwogICAgCQkJY2FtZXJhTC5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwogICAgCQkJY2FtZXJhLnRyYW5zbGF0ZVgoIHhPZmZzZXQgKTsKICAgIAkJCWNhbWVyYS50cmFuc2xhdGVaKCB6T2Zmc2V0ICk7CiAgICAJCQljYW1lcmEubWF0cml4V29ybGQuY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CiAgICAJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKICAgIAkJCS8vIENoZWNrIGlmIHRoZSBwcm9qZWN0aW9uIHVzZXMgYW4gaW5maW5pdGUgZmFyIHBsYW5lLgogICAgCQkJaWYgKCBwcm9qTFsgMTAgXSA9PT0gLTEgKSB7CgogICAgCQkJCS8vIFVzZSB0aGUgcHJvamVjdGlvbiBtYXRyaXggZnJvbSB0aGUgbGVmdCBleWUuCiAgICAJCQkJLy8gVGhlIGNhbWVyYSBvZmZzZXQgaXMgc3VmZmljaWVudCB0byBpbmNsdWRlIHRoZSB2aWV3IHZvbHVtZXMKICAgIAkJCQkvLyBvZiBib3RoIGV5ZXMgKGFzc3VtaW5nIHN5bW1ldHJpYyBwcm9qZWN0aW9ucykuCiAgICAJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CiAgICAJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQkvLyBGaW5kIHRoZSB1bmlvbiBvZiB0aGUgZnJ1c3R1bSB2YWx1ZXMgb2YgdGhlIGNhbWVyYXMgYW5kIHNjYWxlCiAgICAJCQkJLy8gdGhlIHZhbHVlcyBzbyB0aGF0IHRoZSBuZWFyIHBsYW5lJ3MgcG9zaXRpb24gZG9lcyBub3QgY2hhbmdlIGluIHdvcmxkIHNwYWNlLAogICAgCQkJCS8vIGFsdGhvdWdoIG11c3Qgbm93IGJlIHJlbGF0aXZlIHRvIHRoZSBuZXcgdW5pb24gY2FtZXJhLgogICAgCQkJCWNvbnN0IG5lYXIyID0gbmVhciArIHpPZmZzZXQ7CiAgICAJCQkJY29uc3QgZmFyMiA9IGZhciArIHpPZmZzZXQ7CiAgICAJCQkJY29uc3QgbGVmdDIgPSBsZWZ0IC0geE9mZnNldDsKICAgIAkJCQljb25zdCByaWdodDIgPSByaWdodCArICggaXBkIC0geE9mZnNldCApOwogICAgCQkJCWNvbnN0IHRvcDIgPSB0b3BGb3YgKiBmYXIgLyBmYXIyICogbmVhcjI7CiAgICAJCQkJY29uc3QgYm90dG9tMiA9IGJvdHRvbUZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKCiAgICAJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0MiwgcmlnaHQyLCB0b3AyLCBib3R0b20yLCBuZWFyMiwgZmFyMiApOwogICAgCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIHVwZGF0ZUNhbWVyYSggY2FtZXJhLCBwYXJlbnQgKSB7CgogICAgCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgogICAgCQkJCWNhbWVyYS5tYXRyaXhXb3JsZC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHBhcmVudC5tYXRyaXhXb3JsZCwgY2FtZXJhLm1hdHJpeCApOwoKICAgIAkJCX0KCiAgICAJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKICAgIAkJfQoKICAgIAkJLyoqCiAgICAJCSAqIFVwZGF0ZXMgdGhlIHN0YXRlIG9mIHRoZSBYUiBjYW1lcmEuIFVzZSB0aGlzIG1ldGhvZCBvbiBhcHAgbGV2ZWwgaWYgeW91CiAgICAJCSAqIHNldCBjYW1lcmFBdXRvVXBkYXRlYCB0byBgZmFsc2VgLiBUaGUgbWV0aG9kIHJlcXVpcmVzIHRoZSBub24tWFIKICAgIAkJICogY2FtZXJhIG9mIHRoZSBzY2VuZSBhcyBhIHBhcmFtZXRlci4gVGhlIHBhc3NlZCBpbiBjYW1lcmEncyB0cmFuc2Zvcm1hdGlvbgogICAgCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFkanVzdGVkIHRvIHRoZSBwb3NpdGlvbiBvZiB0aGUgWFIgY2FtZXJhIHdoZW4gY2FsbGluZwogICAgCQkgKiB0aGlzIG1ldGhvZC4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEuCiAgICAJCSAqLwogICAgCQl0aGlzLnVwZGF0ZUNhbWVyYSA9IGZ1bmN0aW9uICggY2FtZXJhICkgewoKICAgIAkJCWlmICggc2Vzc2lvbiA9PT0gbnVsbCApIHJldHVybjsKCiAgICAJCQlsZXQgZGVwdGhOZWFyID0gY2FtZXJhLm5lYXI7CiAgICAJCQlsZXQgZGVwdGhGYXIgPSBjYW1lcmEuZmFyOwoKICAgIAkJCWlmICggZGVwdGhTZW5zaW5nLnRleHR1cmUgIT09IG51bGwgKSB7CgogICAgCQkJCWlmICggZGVwdGhTZW5zaW5nLmRlcHRoTmVhciA+IDAgKSBkZXB0aE5lYXIgPSBkZXB0aFNlbnNpbmcuZGVwdGhOZWFyOwogICAgCQkJCWlmICggZGVwdGhTZW5zaW5nLmRlcHRoRmFyID4gMCApIGRlcHRoRmFyID0gZGVwdGhTZW5zaW5nLmRlcHRoRmFyOwoKICAgIAkJCX0KCiAgICAJCQljYW1lcmFYUi5uZWFyID0gY2FtZXJhUi5uZWFyID0gY2FtZXJhTC5uZWFyID0gZGVwdGhOZWFyOwogICAgCQkJY2FtZXJhWFIuZmFyID0gY2FtZXJhUi5mYXIgPSBjYW1lcmFMLmZhciA9IGRlcHRoRmFyOwoKICAgIAkJCWlmICggX2N1cnJlbnREZXB0aE5lYXIgIT09IGNhbWVyYVhSLm5lYXIgfHwgX2N1cnJlbnREZXB0aEZhciAhPT0gY2FtZXJhWFIuZmFyICkgewoKICAgIAkJCQkvLyBOb3RlIHRoYXQgdGhlIG5ldyByZW5kZXJTdGF0ZSB3b24ndCBhcHBseSB1bnRpbCB0aGUgbmV4dCBmcmFtZS4gU2VlICMxODMyMAoKICAgIAkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7CiAgICAJCQkJCWRlcHRoTmVhcjogY2FtZXJhWFIubmVhciwKICAgIAkJCQkJZGVwdGhGYXI6IGNhbWVyYVhSLmZhcgogICAgCQkJCX0gKTsKCiAgICAJCQkJX2N1cnJlbnREZXB0aE5lYXIgPSBjYW1lcmFYUi5uZWFyOwogICAgCQkJCV9jdXJyZW50RGVwdGhGYXIgPSBjYW1lcmFYUi5mYXI7CgogICAgCQkJfQoKICAgIAkJCWNhbWVyYUwubGF5ZXJzLm1hc2sgPSBjYW1lcmEubGF5ZXJzLm1hc2sgfCAwYjAxMDsKICAgIAkJCWNhbWVyYVIubGF5ZXJzLm1hc2sgPSBjYW1lcmEubGF5ZXJzLm1hc2sgfCAwYjEwMDsKICAgIAkJCWNhbWVyYVhSLmxheWVycy5tYXNrID0gY2FtZXJhTC5sYXllcnMubWFzayB8IGNhbWVyYVIubGF5ZXJzLm1hc2s7CgogICAgCQkJY29uc3QgcGFyZW50ID0gY2FtZXJhLnBhcmVudDsKICAgIAkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmFYUi5jYW1lcmFzOwoKICAgIAkJCXVwZGF0ZUNhbWVyYSggY2FtZXJhWFIsIHBhcmVudCApOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbWVyYXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQl1cGRhdGVDYW1lcmEoIGNhbWVyYXNbIGkgXSwgcGFyZW50ICk7CgogICAgCQkJfQoKICAgIAkJCS8vIHVwZGF0ZSBwcm9qZWN0aW9uIG1hdHJpeCBmb3IgcHJvcGVyIHZpZXcgZnJ1c3R1bSBjdWxsaW5nCgogICAgCQkJaWYgKCBjYW1lcmFzLmxlbmd0aCA9PT0gMiApIHsKCiAgICAJCQkJc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhWFIsIGNhbWVyYUwsIGNhbWVyYVIgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQkvLyBhc3N1bWUgc2luZ2xlIGNhbWVyYSBzZXR1cCAoQVIpCgogICAgCQkJCWNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CgogICAgCQkJfQoKICAgIAkJCS8vIHVwZGF0ZSB1c2VyIGNhbWVyYSBhbmQgaXRzIGNoaWxkcmVuCgogICAgCQkJdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICk7CgogICAgCQl9OwoKICAgIAkJZnVuY3Rpb24gdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICkgewoKICAgIAkJCWlmICggcGFyZW50ID09PSBudWxsICkgewoKICAgIAkJCQljYW1lcmEubWF0cml4LmNvcHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY2FtZXJhLm1hdHJpeC5jb3B5KCBwYXJlbnQubWF0cml4V29ybGQgKTsKICAgIAkJCQljYW1lcmEubWF0cml4LmludmVydCgpOwogICAgCQkJCWNhbWVyYS5tYXRyaXgubXVsdGlwbHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgogICAgCQkJfQoKICAgIAkJCWNhbWVyYS5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUgKTsKICAgIAkJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKICAgIAkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXggKTsKICAgIAkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmFYUi5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKICAgIAkJCWlmICggY2FtZXJhLmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgogICAgCQkJCWNhbWVyYS5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggMSAvIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyA1IF0gKTsKICAgIAkJCQljYW1lcmEuem9vbSA9IDE7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIEFycmF5Q2FtZXJhfSB3aGljaCByZXByZXNlbnRzIHRoZSBYUiBjYW1lcmEKICAgIAkJICogb2YgdGhlIGFjdGl2ZSBYUiBzZXNzaW9uLiBGb3IgZWFjaCB2aWV3IGl0IGhvbGRzIGEgc2VwYXJhdGUgY2FtZXJhIG9iamVjdC4KICAgIAkJICoKICAgIAkJICogVGhlIGNhbWVyYSdzIGBmb3ZgIGlzIGN1cnJlbnRseSBub3QgdXNlZCBhbmQgZG9lcyBub3QgcmVmbGVjdCB0aGUgZm92IG9mCiAgICAJCSAqIHRoZSBYUiBjYW1lcmEuIElmIHlvdSBuZWVkIHRoZSBmb3Ygb24gYXBwIGxldmVsLCB5b3UgaGF2ZSB0byBjb21wdXRlIGluCiAgICAJCSAqIG1hbnVhbGx5IGZyb20gdGhlIFhSIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cmljZXMuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge0FycmF5Q2FtZXJhfSBUaGUgWFIgY2FtZXJhLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDYW1lcmEgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGNhbWVyYVhSOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBhbW91bnQgb2YgZm92ZWF0aW9uIHVzZWQgYnkgdGhlIFhSIGNvbXBvc2l0b3IgZm9yIHRoZSBwcm9qZWN0aW9uIGxheWVyLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbW91bnQgb2YgZm92ZWF0aW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRGb3ZlYXRpb24gPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJaWYgKCBnbFByb2pMYXllciA9PT0gbnVsbCAmJiBnbEJhc2VMYXllciA9PT0gbnVsbCApIHsKCiAgICAJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGZvdmVhdGlvbjsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgZm92ZWF0aW9uIHZhbHVlLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBBIG51bWJlciBpbiB0aGUgcmFuZ2UgYFswLDFdYCB3aGVyZSBgMGAgbWVhbnMgbm8gZm92ZWF0aW9uIChmdWxsIHJlc29sdXRpb24pCiAgICAJCSAqIGFuZCBgMWAgbWVhbnMgbWF4aW11bSBmb3ZlYXRpb24gKHRoZSBlZGdlcyByZW5kZXIgYXQgbG93ZXIgcmVzb2x1dGlvbikuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldEZvdmVhdGlvbiA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgogICAgCQkJLy8gMCA9IG5vIGZvdmVhdGlvbiA9IGZ1bGwgcmVzb2x1dGlvbgogICAgCQkJLy8gMSA9IG1heGltdW0gZm92ZWF0aW9uID0gdGhlIGVkZ2VzIHJlbmRlciBhdCBsb3dlciByZXNvbHV0aW9uCgogICAgCQkJZm92ZWF0aW9uID0gdmFsdWU7CgogICAgCQkJaWYgKCBnbFByb2pMYXllciAhPT0gbnVsbCApIHsKCiAgICAJCQkJZ2xQcm9qTGF5ZXIuZml4ZWRGb3ZlYXRpb24gPSB2YWx1ZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBnbEJhc2VMYXllciAhPT0gbnVsbCAmJiBnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiA9IHZhbHVlOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyBgdHJ1ZWAgaWYgZGVwdGggc2Vuc2luZyBpcyBzdXBwb3J0ZWQuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgZGVwdGggc2Vuc2luZyBpcyBzdXBwb3J0ZWQgb3Igbm90LgogICAgCQkgKi8KICAgIAkJdGhpcy5oYXNEZXB0aFNlbnNpbmcgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy50ZXh0dXJlICE9PSBudWxsOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBkZXB0aCBzZW5zaW5nIG1lc2guCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge01lc2h9IFRoZSBkZXB0aCBzZW5zaW5nIG1lc2guCiAgICAJCSAqLwogICAgCQl0aGlzLmdldERlcHRoU2Vuc2luZ01lc2ggPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy5nZXRNZXNoKCBjYW1lcmFYUiApOwoKICAgIAkJfTsKCiAgICAJCS8vIEFuaW1hdGlvbiBMb29wCgogICAgCQlsZXQgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gbnVsbDsKCiAgICAJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKICAgIAkJCXBvc2UgPSBmcmFtZS5nZXRWaWV3ZXJQb3NlKCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwogICAgCQkJeHJGcmFtZSA9IGZyYW1lOwoKICAgIAkJCWlmICggcG9zZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJY29uc3Qgdmlld3MgPSBwb3NlLnZpZXdzOwoKICAgIAkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKICAgIAkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0RnJhbWVidWZmZXIoIG5ld1JlbmRlclRhcmdldCwgZ2xCYXNlTGF5ZXIuZnJhbWVidWZmZXIgKTsKICAgIAkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBuZXdSZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlsZXQgY2FtZXJhWFJOZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAkJCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZWJ1aWxkIGNhbWVyYVhSJ3MgY2FtZXJhIGxpc3QKCiAgICAJCQkJaWYgKCB2aWV3cy5sZW5ndGggIT09IGNhbWVyYVhSLmNhbWVyYXMubGVuZ3RoICkgewoKICAgIAkJCQkJY2FtZXJhWFIuY2FtZXJhcy5sZW5ndGggPSAwOwogICAgCQkJCQljYW1lcmFYUk5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQkJfQoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB2aWV3cy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCB2aWV3ID0gdmlld3NbIGkgXTsKCiAgICAJCQkJCWxldCB2aWV3cG9ydCA9IG51bGw7CgogICAgCQkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKICAgIAkJCQkJCXZpZXdwb3J0ID0gZ2xCYXNlTGF5ZXIuZ2V0Vmlld3BvcnQoIHZpZXcgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJY29uc3QgZ2xTdWJJbWFnZSA9IGdsQmluZGluZy5nZXRWaWV3U3ViSW1hZ2UoIGdsUHJvakxheWVyLCB2aWV3ICk7CiAgICAJCQkJCQl2aWV3cG9ydCA9IGdsU3ViSW1hZ2Uudmlld3BvcnQ7CgogICAgCQkJCQkJLy8gRm9yIHNpZGUtYnktc2lkZSBwcm9qZWN0aW9uLCB3ZSBvbmx5IHByb2R1Y2UgYSBzaW5nbGUgdGV4dHVyZSBmb3IgYm90aCBleWVzLgogICAgCQkJCQkJaWYgKCBpID09PSAwICkgewoKICAgIAkJCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXRUZXh0dXJlcygKICAgIAkJCQkJCQkJbmV3UmVuZGVyVGFyZ2V0LAogICAgCQkJCQkJCQlnbFN1YkltYWdlLmNvbG9yVGV4dHVyZSwKICAgIAkJCQkJCQkJZ2xTdWJJbWFnZS5kZXB0aFN0ZW5jaWxUZXh0dXJlICk7CgogICAgCQkJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggbmV3UmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQkJbGV0IGNhbWVyYSA9IGNhbWVyYXNbIGkgXTsKCiAgICAJCQkJCWlmICggY2FtZXJhID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkJY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CiAgICAJCQkJCQljYW1lcmEubGF5ZXJzLmVuYWJsZSggaSApOwogICAgCQkJCQkJY2FtZXJhLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKICAgIAkJCQkJCWNhbWVyYXNbIGkgXSA9IGNhbWVyYTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWNhbWVyYS5tYXRyaXguZnJvbUFycmF5KCB2aWV3LnRyYW5zZm9ybS5tYXRyaXggKTsKICAgIAkJCQkJY2FtZXJhLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwogICAgCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5mcm9tQXJyYXkoIHZpZXcucHJvamVjdGlvbk1hdHJpeCApOwogICAgCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKS5pbnZlcnQoKTsKICAgIAkJCQkJY2FtZXJhLnZpZXdwb3J0LnNldCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQud2lkdGgsIHZpZXdwb3J0LmhlaWdodCApOwoKICAgIAkJCQkJaWYgKCBpID09PSAwICkgewoKICAgIAkJCQkJCWNhbWVyYVhSLm1hdHJpeC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CiAgICAJCQkJCQljYW1lcmFYUi5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmFYUi5wb3NpdGlvbiwgY2FtZXJhWFIucXVhdGVybmlvbiwgY2FtZXJhWFIuc2NhbGUgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWlmICggY2FtZXJhWFJOZWVkc1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCQljYW1lcmFYUi5jYW1lcmFzLnB1c2goIGNhbWVyYSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCS8vCgogICAgCQkJCWNvbnN0IGVuYWJsZWRGZWF0dXJlcyA9IHNlc3Npb24uZW5hYmxlZEZlYXR1cmVzOwogICAgCQkJCWNvbnN0IGdwdURlcHRoU2Vuc2luZ0VuYWJsZWQgPSBlbmFibGVkRmVhdHVyZXMgJiYKICAgIAkJCQkJZW5hYmxlZEZlYXR1cmVzLmluY2x1ZGVzKCAnZGVwdGgtc2Vuc2luZycgKSAmJgogICAgCQkJCQlzZXNzaW9uLmRlcHRoVXNhZ2UgPT0gJ2dwdS1vcHRpbWl6ZWQnOwoKICAgIAkJCQlpZiAoIGdwdURlcHRoU2Vuc2luZ0VuYWJsZWQgJiYgZ2xCaW5kaW5nICkgewoKICAgIAkJCQkJY29uc3QgZGVwdGhEYXRhID0gZ2xCaW5kaW5nLmdldERlcHRoSW5mb3JtYXRpb24oIHZpZXdzWyAwIF0gKTsKCiAgICAJCQkJCWlmICggZGVwdGhEYXRhICYmIGRlcHRoRGF0YS5pc1ZhbGlkICYmIGRlcHRoRGF0YS50ZXh0dXJlICkgewoKICAgIAkJCQkJCWRlcHRoU2Vuc2luZy5pbml0KCByZW5kZXJlciwgZGVwdGhEYXRhLCBzZXNzaW9uLnJlbmRlclN0YXRlICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJLy8KCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGlucHV0U291cmNlID0gY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdOwogICAgCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaSBdOwoKICAgIAkJCQlpZiAoIGlucHV0U291cmNlICE9PSBudWxsICYmIGNvbnRyb2xsZXIgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCWNvbnRyb2xsZXIudXBkYXRlKCBpbnB1dFNvdXJjZSwgZnJhbWUsIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUsIGZyYW1lICk7CgogICAgCQkJaWYgKCBmcmFtZS5kZXRlY3RlZFBsYW5lcyApIHsKCiAgICAJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAncGxhbmVzZGV0ZWN0ZWQnLCBkYXRhOiBmcmFtZSB9ICk7CgogICAgCQkJfQoKICAgIAkJCXhyRnJhbWUgPSBudWxsOwoKICAgIAkJfQoKICAgIAkJY29uc3QgYW5pbWF0aW9uID0gbmV3IFdlYkdMQW5pbWF0aW9uKCk7CgogICAgCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKICAgIAkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCiAgICAJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICAJCX07CgogICAgCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7fTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfZTEgPSAvKkBfX1BVUkVfXyovIG5ldyBFdWxlcigpOwogICAgY29uc3QgX20xID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKICAgIGZ1bmN0aW9uIFdlYkdMTWF0ZXJpYWxzKCByZW5kZXJlciwgcHJvcGVydGllcyApIHsKCiAgICAJZnVuY3Rpb24gcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hcCwgdW5pZm9ybSApIHsKCiAgICAJCWlmICggbWFwLm1hdHJpeEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgogICAgCQkJbWFwLnVwZGF0ZU1hdHJpeCgpOwoKICAgIAkJfQoKICAgIAkJdW5pZm9ybS52YWx1ZS5jb3B5KCBtYXAubWF0cml4ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaEZvZ1VuaWZvcm1zKCB1bmlmb3JtcywgZm9nICkgewoKICAgIAkJZm9nLmNvbG9yLmdldFJHQiggdW5pZm9ybXMuZm9nQ29sb3IudmFsdWUsIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgKTsKCiAgICAJCWlmICggZm9nLmlzRm9nICkgewoKICAgIAkJCXVuaWZvcm1zLmZvZ05lYXIudmFsdWUgPSBmb2cubmVhcjsKICAgIAkJCXVuaWZvcm1zLmZvZ0Zhci52YWx1ZSA9IGZvZy5mYXI7CgogICAgCQl9IGVsc2UgaWYgKCBmb2cuaXNGb2dFeHAyICkgewoKICAgIAkJCXVuaWZvcm1zLmZvZ0RlbnNpdHkudmFsdWUgPSBmb2cuZGVuc2l0eTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCiAgICAJCWlmICggbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTGFtYmVydE1hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwogICAgCQkJcmVmcmVzaFVuaWZvcm1zUGhvbmcoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwogICAgCQkJcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNNZXNoUGh5c2ljYWxNYXRlcmlhbCApIHsKCiAgICAJCQkJcmVmcmVzaFVuaWZvcm1zUGh5c2ljYWwoIHVuaWZvcm1zLCBtYXRlcmlhbCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTWF0Y2FwTWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEZXB0aE1hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEaXN0YW5jZU1hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CiAgICAJCQlyZWZyZXNoVW5pZm9ybXNEaXN0YW5jZSggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hOb3JtYWxNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNMaW5lQmFzaWNNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNMaW5lKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLmlzTGluZURhc2hlZE1hdGVyaWFsICkgewoKICAgIAkJCQlyZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1BvaW50c01hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc1BvaW50cyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQgKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU3ByaXRlTWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1NoYWRvd01hdGVyaWFsICkgewoKICAgIAkJCXVuaWZvcm1zLmNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CiAgICAJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgogICAgCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7IC8vICMxNTU4MQoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgogICAgCQlpZiAoIG1hdGVyaWFsLmNvbG9yICkgewoKICAgIAkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuZW1pc3NpdmUgKSB7CgogICAgCQkJdW5pZm9ybXMuZW1pc3NpdmUudmFsdWUuY29weSggbWF0ZXJpYWwuZW1pc3NpdmUgKS5tdWx0aXBseVNjYWxhciggbWF0ZXJpYWwuZW1pc3NpdmVJbnRlbnNpdHkgKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwubWFwICkgewoKICAgIAkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmJ1bXBNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmJ1bXBNYXAsIHVuaWZvcm1zLmJ1bXBNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgPSBtYXRlcmlhbC5idW1wU2NhbGU7CgogICAgCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCiAgICAJCQkJdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlICo9IC0xOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwubm9ybWFsTWFwICkgewoKICAgIAkJCXVuaWZvcm1zLm5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLm5vcm1hbE1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubm9ybWFsTWFwLCB1bmlmb3Jtcy5ub3JtYWxNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5ub3JtYWxTY2FsZSApOwoKICAgIAkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgogICAgCQkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKICAgIAkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwLCB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwogICAgCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmVtaXNzaXZlTWFwICkgewoKICAgIAkJCXVuaWZvcm1zLmVtaXNzaXZlTWFwLnZhbHVlID0gbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmVtaXNzaXZlTWFwLCB1bmlmb3Jtcy5lbWlzc2l2ZU1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhck1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5zcGVjdWxhck1hcC52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFyTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhck1hcCwgdW5pZm9ybXMuc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHsKCiAgICAJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgogICAgCQl9CgogICAgCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCiAgICAJCWNvbnN0IGVudk1hcCA9IG1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXA7CiAgICAJCWNvbnN0IGVudk1hcFJvdGF0aW9uID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcFJvdGF0aW9uOwoKICAgIAkJaWYgKCBlbnZNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKICAgIAkJCV9lMS5jb3B5KCBlbnZNYXBSb3RhdGlvbiApOwoKICAgIAkJCS8vIGFjY29tbW9kYXRlIGxlZnQtaGFuZGVkIGZyYW1lCiAgICAJCQlfZTEueCAqPSAtMTsgX2UxLnkgKj0gLTE7IF9lMS56ICo9IC0xOwoKICAgIAkJCWlmICggZW52TWFwLmlzQ3ViZVRleHR1cmUgJiYgZW52TWFwLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCS8vIGVudmlyb25tZW50IG1hcHMgd2hpY2ggYXJlIG5vdCBjdWJlIHJlbmRlciB0YXJnZXRzIG9yIFBNUkVNcyBmb2xsb3cgYSBkaWZmZXJlbnQgY29udmVudGlvbgogICAgCQkJCV9lMS55ICo9IC0xOwogICAgCQkJCV9lMS56ICo9IC0xOwoKICAgIAkJCX0KCiAgICAJCQl1bmlmb3Jtcy5lbnZNYXBSb3RhdGlvbi52YWx1ZS5zZXRGcm9tTWF0cml4NCggX20xLm1ha2VSb3RhdGlvbkZyb21FdWxlciggX2UxICkgKTsKCiAgICAJCQl1bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBlbnZNYXAuaXNDdWJlVGV4dHVyZSAmJiBlbnZNYXAuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLTEgOiAxOwoKICAgIAkJCXVuaWZvcm1zLnJlZmxlY3Rpdml0eS52YWx1ZSA9IG1hdGVyaWFsLnJlZmxlY3Rpdml0eTsKICAgIAkJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsKICAgIAkJCXVuaWZvcm1zLnJlZnJhY3Rpb25SYXRpby52YWx1ZSA9IG1hdGVyaWFsLnJlZnJhY3Rpb25SYXRpbzsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwubGlnaHRNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMubGlnaHRNYXAudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcDsKICAgIAkJCXVuaWZvcm1zLmxpZ2h0TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHk7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmxpZ2h0TWFwLCB1bmlmb3Jtcy5saWdodE1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5hb01hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5hb01hcC52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwOwogICAgCQkJdW5pZm9ybXMuYW9NYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5hb01hcEludGVuc2l0eTsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW9NYXAsIHVuaWZvcm1zLmFvTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTGluZSggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwogICAgCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCiAgICAJCWlmICggbWF0ZXJpYWwubWFwICkgewoKICAgIAkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQl1bmlmb3Jtcy5kYXNoU2l6ZS52YWx1ZSA9IG1hdGVyaWFsLmRhc2hTaXplOwogICAgCQl1bmlmb3Jtcy50b3RhbFNpemUudmFsdWUgPSBtYXRlcmlhbC5kYXNoU2l6ZSArIG1hdGVyaWFsLmdhcFNpemU7CiAgICAJCXVuaWZvcm1zLnNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuc2NhbGU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUG9pbnRzKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCApIHsKCiAgICAJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKICAgIAkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CiAgICAJCXVuaWZvcm1zLnNpemUudmFsdWUgPSBtYXRlcmlhbC5zaXplICogcGl4ZWxSYXRpbzsKICAgIAkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBoZWlnaHQgKiAwLjU7CgogICAgCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMudXZUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuYWxwaGFUZXN0LnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFUZXN0OwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Nwcml0ZXMoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCiAgICAJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKICAgIAkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CiAgICAJCXVuaWZvcm1zLnJvdGF0aW9uLnZhbHVlID0gbWF0ZXJpYWwucm90YXRpb247CgogICAgCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMubWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKICAgIAkJCXVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFscGhhTWFwLCB1bmlmb3Jtcy5hbHBoYU1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgewoKICAgIAkJCXVuaWZvcm1zLmFscGhhVGVzdC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhVGVzdDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNQaG9uZyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJdW5pZm9ybXMuc3BlY3VsYXIudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXIgKTsKICAgIAkJdW5pZm9ybXMuc2hpbmluZXNzLnZhbHVlID0gTWF0aC5tYXgoIG1hdGVyaWFsLnNoaW5pbmVzcywgMWUtNCApOyAvLyB0byBwcmV2ZW50IHBvdyggMC4wLCAwLjAgKQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCiAgICAJCWlmICggbWF0ZXJpYWwuZ3JhZGllbnRNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuZ3JhZGllbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJdW5pZm9ybXMubWV0YWxuZXNzLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzOwoKICAgIAkJaWYgKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMubWV0YWxuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAsIHVuaWZvcm1zLm1ldGFsbmVzc01hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJdW5pZm9ybXMucm91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzOwoKICAgIAkJaWYgKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMucm91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnJvdWdobmVzc01hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5lbnZNYXAgKSB7CgogICAgCQkJLy91bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXA7IC8vIHBhcnQgb2YgdW5pZm9ybXMgY29tbW9uCgogICAgCQkJdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwSW50ZW5zaXR5OwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BoeXNpY2FsKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCiAgICAJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsgLy8gYWxzbyBwYXJ0IG9mIHVuaWZvcm1zIGNvbW1vbgoKICAgIAkJaWYgKCBtYXRlcmlhbC5zaGVlbiA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuc2hlZW5Db2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zaGVlbkNvbG9yICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLnNoZWVuICk7CgogICAgCQkJdW5pZm9ybXMuc2hlZW5Sb3VnaG5lc3MudmFsdWUgPSBtYXRlcmlhbC5zaGVlblJvdWdobmVzczsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLnNoZWVuQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Db2xvck1hcCwgdW5pZm9ybXMuc2hlZW5Db2xvck1hcFRyYW5zZm9ybSApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwICkgewoKICAgIAkJCQl1bmlmb3Jtcy5zaGVlblJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXQgPiAwICkgewoKICAgIAkJCXVuaWZvcm1zLmNsZWFyY29hdC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdDsKICAgIAkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzczsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLmNsZWFyY29hdE1hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMuY2xlYXJjb2F0TWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXRNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCiAgICAJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcCwgdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwICkgewoKICAgIAkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAsIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSApOwoKICAgIAkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKICAgIAkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKICAgIAkJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmRpc3BlcnNpb24gPiAwICkgewoKICAgIAkJCXVuaWZvcm1zLmRpc3BlcnNpb24udmFsdWUgPSBtYXRlcmlhbC5kaXNwZXJzaW9uOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2UudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZTsKICAgIAkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlSU9SLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1I7CiAgICAJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAwIF07CiAgICAJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAxIF07CgogICAgCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VNYXAudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcDsKCiAgICAJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwLCB1bmlmb3Jtcy5pcmlkZXNjZW5jZU1hcFRyYW5zZm9ybSApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICkgewoKICAgIAkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAsIHVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwICkgewoKICAgIAkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbi52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbjsKICAgIAkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJNYXAudmFsdWUgPSB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQudGV4dHVyZTsKICAgIAkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJTaXplLnZhbHVlLnNldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LndpZHRoLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgogICAgCQkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb25NYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbk1hcC52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKCiAgICAJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCwgdW5pZm9ybXMudHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJCXVuaWZvcm1zLnRoaWNrbmVzcy52YWx1ZSA9IG1hdGVyaWFsLnRoaWNrbmVzczsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnRoaWNrbmVzc01hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMudGhpY2tuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwudGhpY2tuZXNzTWFwLCB1bmlmb3Jtcy50aGlja25lc3NNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl9CgogICAgCQkJdW5pZm9ybXMuYXR0ZW51YXRpb25EaXN0YW5jZS52YWx1ZSA9IG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2U7CiAgICAJCQl1bmlmb3Jtcy5hdHRlbnVhdGlvbkNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IgKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYW5pc290cm9weSA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuYW5pc290cm9weVZlY3Rvci52YWx1ZS5zZXQoIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLmNvcyggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICksIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLnNpbiggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICkgKTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLmFuaXNvdHJvcHlNYXAudmFsdWUgPSBtYXRlcmlhbC5hbmlzb3Ryb3B5TWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW5pc290cm9weU1hcCwgdW5pZm9ybXMuYW5pc290cm9weU1hcFRyYW5zZm9ybSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHk7CiAgICAJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApOwoKICAgIAkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwICkgewoKICAgIAkJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLCB1bmlmb3Jtcy5zcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwICkgewoKICAgIAkJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5TWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwLCB1bmlmb3Jtcy5zcGVjdWxhckludGVuc2l0eU1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJaWYgKCBtYXRlcmlhbC5tYXRjYXAgKSB7CgogICAgCQkJdW5pZm9ybXMubWF0Y2FwLnZhbHVlID0gbWF0ZXJpYWwubWF0Y2FwOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQljb25zdCBsaWdodCA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmxpZ2h0OwoKICAgIAkJdW5pZm9ybXMucmVmZXJlbmNlUG9zaXRpb24udmFsdWUuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwogICAgCQl1bmlmb3Jtcy5uZWFyRGlzdGFuY2UudmFsdWUgPSBsaWdodC5zaGFkb3cuY2FtZXJhLm5lYXI7CiAgICAJCXVuaWZvcm1zLmZhckRpc3RhbmNlLnZhbHVlID0gbGlnaHQuc2hhZG93LmNhbWVyYS5mYXI7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJcmVmcmVzaEZvZ1VuaWZvcm1zOiByZWZyZXNoRm9nVW5pZm9ybXMsCiAgICAJCXJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zOiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcwogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMVW5pZm9ybXNHcm91cHMoIGdsLCBpbmZvLCBjYXBhYmlsaXRpZXMsIHN0YXRlICkgewoKICAgIAlsZXQgYnVmZmVycyA9IHt9OwogICAgCWxldCB1cGRhdGVMaXN0ID0ge307CiAgICAJbGV0IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMgPSBbXTsKCiAgICAJY29uc3QgbWF4QmluZGluZ1BvaW50cyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1VOSUZPUk1fQlVGRkVSX0JJTkRJTkdTICk7IC8vIGJpbmRpbmcgcG9pbnRzIGFyZSBnbG9iYWwgd2hlcmVhcyBibG9jayBpbmRpY2VzIGFyZSBwZXIgc2hhZGVyIHByb2dyYW0KCiAgICAJZnVuY3Rpb24gYmluZCggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCiAgICAJCWNvbnN0IHdlYmdsUHJvZ3JhbSA9IHByb2dyYW0ucHJvZ3JhbTsKICAgIAkJc3RhdGUudW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgd2ViZ2xQcm9ncmFtICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKICAgIAkJbGV0IGJ1ZmZlciA9IGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXTsKCiAgICAJCWlmICggYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKTsKCiAgICAJCQlidWZmZXIgPSBjcmVhdGVCdWZmZXIoIHVuaWZvcm1zR3JvdXAgKTsKICAgIAkJCWJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXSA9IGJ1ZmZlcjsKCiAgICAJCQl1bmlmb3Jtc0dyb3VwLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25Vbmlmb3Jtc0dyb3Vwc0Rpc3Bvc2UgKTsKCiAgICAJCX0KCiAgICAJCS8vIGVuc3VyZSB0byB1cGRhdGUgdGhlIGJpbmRpbmcgcG9pbnRzL2Jsb2NrIGluZGljZXMgbWFwcGluZyBmb3IgdGhpcyBwcm9ncmFtCgogICAgCQljb25zdCB3ZWJnbFByb2dyYW0gPSBwcm9ncmFtLnByb2dyYW07CiAgICAJCXN0YXRlLnVwZGF0ZVVCT01hcHBpbmcoIHVuaWZvcm1zR3JvdXAsIHdlYmdsUHJvZ3JhbSApOwoKICAgIAkJLy8gdXBkYXRlIFVCTyBvbmNlIHBlciBmcmFtZQoKICAgIAkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCiAgICAJCWlmICggdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdICE9PSBmcmFtZSApIHsKCiAgICAJCQl1cGRhdGVCdWZmZXJEYXRhKCB1bmlmb3Jtc0dyb3VwICk7CgogICAgCQkJdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdID0gZnJhbWU7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gY3JlYXRlQnVmZmVyKCB1bmlmb3Jtc0dyb3VwICkgewoKICAgIAkJLy8gdGhlIHNldHVwIG9mIGFuIFVCTyBpcyBpbmRlcGVuZGVudCBvZiBhIHBhcnRpY3VsYXIgc2hhZGVyIHByb2dyYW0gYnV0IGdsb2JhbAoKICAgIAkJY29uc3QgYmluZGluZ1BvaW50SW5kZXggPSBhbGxvY2F0ZUJpbmRpbmdQb2ludEluZGV4KCk7CiAgICAJCXVuaWZvcm1zR3JvdXAuX19iaW5kaW5nUG9pbnRJbmRleCA9IGJpbmRpbmdQb2ludEluZGV4OwoKICAgIAkJY29uc3QgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAJCWNvbnN0IHNpemUgPSB1bmlmb3Jtc0dyb3VwLl9fc2l6ZTsKICAgIAkJY29uc3QgdXNhZ2UgPSB1bmlmb3Jtc0dyb3VwLnVzYWdlOwoKICAgIAkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIGJ1ZmZlciApOwogICAgCQlnbC5idWZmZXJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgc2l6ZSwgdXNhZ2UgKTsKICAgIAkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKICAgIAkJZ2wuYmluZEJ1ZmZlckJhc2UoIGdsLlVOSUZPUk1fQlVGRkVSLCBiaW5kaW5nUG9pbnRJbmRleCwgYnVmZmVyICk7CgogICAgCQlyZXR1cm4gYnVmZmVyOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGFsbG9jYXRlQmluZGluZ1BvaW50SW5kZXgoKSB7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXhCaW5kaW5nUG9pbnRzOyBpICsrICkgewoKICAgIAkJCWlmICggYWxsb2NhdGVkQmluZGluZ1BvaW50cy5pbmRleE9mKCBpICkgPT09IC0xICkgewoKICAgIAkJCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLnB1c2goIGkgKTsKICAgIAkJCQlyZXR1cm4gaTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogTWF4aW11bSBudW1iZXIgb2Ygc2ltdWx0YW5lb3VzbHkgdXNhYmxlIHVuaWZvcm1zIGdyb3VwcyByZWFjaGVkLicgKTsKCiAgICAJCXJldHVybiAwOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlckRhdGEoIHVuaWZvcm1zR3JvdXAgKSB7CgogICAgCQljb25zdCBidWZmZXIgPSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CiAgICAJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKICAgIAkJY29uc3QgY2FjaGUgPSB1bmlmb3Jtc0dyb3VwLl9fY2FjaGU7CgogICAgCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgYnVmZmVyICk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdW5pZm9ybXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgdW5pZm9ybUFycmF5ID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybXNbIGkgXSApID8gdW5pZm9ybXNbIGkgXSA6IFsgdW5pZm9ybXNbIGkgXSBdOwoKICAgIAkJCWZvciAoIGxldCBqID0gMCwgamwgPSB1bmlmb3JtQXJyYXkubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm0gPSB1bmlmb3JtQXJyYXlbIGogXTsKCiAgICAJCQkJaWYgKCBoYXNVbmlmb3JtQ2hhbmdlZCggdW5pZm9ybSwgaSwgaiwgY2FjaGUgKSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCWNvbnN0IG9mZnNldCA9IHVuaWZvcm0uX19vZmZzZXQ7CgogICAgCQkJCQljb25zdCB2YWx1ZXMgPSBBcnJheS5pc0FycmF5KCB1bmlmb3JtLnZhbHVlICkgPyB1bmlmb3JtLnZhbHVlIDogWyB1bmlmb3JtLnZhbHVlIF07CgogICAgCQkJCQlsZXQgYXJyYXlPZmZzZXQgPSAwOwoKICAgIAkJCQkJZm9yICggbGV0IGsgPSAwOyBrIDwgdmFsdWVzLmxlbmd0aDsgayArKyApIHsKCiAgICAJCQkJCQljb25zdCB2YWx1ZSA9IHZhbHVlc1sgayBdOwoKICAgIAkJCQkJCWNvbnN0IGluZm8gPSBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKTsKCiAgICAJCQkJCQkvLyBUT0RPIGFkZCBpbnRlZ2VyIGFuZCBzdHJ1Y3Qgc3VwcG9ydAogICAgCQkJCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKICAgIAkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMCBdID0gdmFsdWU7CiAgICAJCQkJCQkJZ2wuYnVmZmVyU3ViRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIG9mZnNldCArIGFycmF5T2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKICAgIAkJCQkJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4MyApIHsKCiAgICAJCQkJCQkJLy8gbWFudWFsbHkgY29udmVydGluZyAzeDMgdG8gM3g0CgogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZS5lbGVtZW50c1sgMCBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxIF0gPSB2YWx1ZS5lbGVtZW50c1sgMSBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAyIF0gPSB2YWx1ZS5lbGVtZW50c1sgMiBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAzIF0gPSAwOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA0IF0gPSB2YWx1ZS5lbGVtZW50c1sgMyBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA1IF0gPSB2YWx1ZS5lbGVtZW50c1sgNCBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA2IF0gPSB2YWx1ZS5lbGVtZW50c1sgNSBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA3IF0gPSAwOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA4IF0gPSB2YWx1ZS5lbGVtZW50c1sgNiBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA5IF0gPSB2YWx1ZS5lbGVtZW50c1sgNyBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxMCBdID0gdmFsdWUuZWxlbWVudHNbIDggXTsKICAgIAkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMTEgXSA9IDA7CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJdmFsdWUudG9BcnJheSggdW5pZm9ybS5fX2RhdGEsIGFycmF5T2Zmc2V0ICk7CgogICAgCQkJCQkJCWFycmF5T2Zmc2V0ICs9IGluZm8uc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCQlnbC5idWZmZXJTdWJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgb2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBoYXNVbmlmb3JtQ2hhbmdlZCggdW5pZm9ybSwgaW5kZXgsIGluZGV4QXJyYXksIGNhY2hlICkgewoKICAgIAkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwogICAgCQljb25zdCBpbmRleFN0cmluZyA9IGluZGV4ICsgJ18nICsgaW5kZXhBcnJheTsKCiAgICAJCWlmICggY2FjaGVbIGluZGV4U3RyaW5nIF0gPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkvLyBjYWNoZSBlbnRyeSBkb2VzIG5vdCBleGlzdCBzbyBmYXIKCiAgICAJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgogICAgCQkJCWNhY2hlWyBpbmRleFN0cmluZyBdID0gdmFsdWU7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY2FjaGVbIGluZGV4U3RyaW5nIF0gPSB2YWx1ZS5jbG9uZSgpOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdHJ1ZTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc3QgY2FjaGVkT2JqZWN0ID0gY2FjaGVbIGluZGV4U3RyaW5nIF07CgogICAgCQkJLy8gY29tcGFyZSBjdXJyZW50IHZhbHVlIHdpdGggY2FjaGVkIGVudHJ5CgogICAgCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKICAgIAkJCQlpZiAoIGNhY2hlZE9iamVjdCAhPT0gdmFsdWUgKSB7CgogICAgCQkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlOwogICAgCQkJCQlyZXR1cm4gdHJ1ZTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWlmICggY2FjaGVkT2JqZWN0LmVxdWFscyggdmFsdWUgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCQljYWNoZWRPYmplY3QuY29weSggdmFsdWUgKTsKICAgIAkJCQkJcmV0dXJuIHRydWU7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gZmFsc2U7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKSB7CgogICAgCQkvLyBkZXRlcm1pbmUgdG90YWwgYnVmZmVyIHNpemUgYWNjb3JkaW5nIHRvIHRoZSBTVEQxNDAgbGF5b3V0CiAgICAJCS8vIEhpbnQ6IFNURDE0MCBpcyB0aGUgb25seSBzdXBwb3J0ZWQgbGF5b3V0IGluIFdlYkdMIDIKCiAgICAJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCiAgICAJCWxldCBvZmZzZXQgPSAwOyAvLyBnbG9iYWwgYnVmZmVyIG9mZnNldCBpbiBieXRlcwogICAgCQljb25zdCBjaHVua1NpemUgPSAxNjsgLy8gc2l6ZSBvZiBhIGNodW5rIGluIGJ5dGVzCgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1bmlmb3Jtcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IHVuaWZvcm1BcnJheSA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm1zWyBpIF0gKSA/IHVuaWZvcm1zWyBpIF0gOiBbIHVuaWZvcm1zWyBpIF0gXTsKCiAgICAJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gdW5pZm9ybUFycmF5Lmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKICAgIAkJCQljb25zdCB1bmlmb3JtID0gdW5pZm9ybUFycmF5WyBqIF07CgogICAgCQkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm0udmFsdWUgKSA/IHVuaWZvcm0udmFsdWUgOiBbIHVuaWZvcm0udmFsdWUgXTsKCiAgICAJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IHZhbHVlcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCiAgICAJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBrIF07CgogICAgCQkJCQljb25zdCBpbmZvID0gZ2V0VW5pZm9ybVNpemUoIHZhbHVlICk7CgogICAgCQkJCQljb25zdCBjaHVua09mZnNldCA9IG9mZnNldCAlIGNodW5rU2l6ZTsgLy8gb2Zmc2V0IGluIHRoZSBjdXJyZW50IGNodW5rCiAgICAJCQkJCWNvbnN0IGNodW5rUGFkZGluZyA9IGNodW5rT2Zmc2V0ICUgaW5mby5ib3VuZGFyeTsgLy8gcmVxdWlyZWQgcGFkZGluZyB0byBtYXRjaCBib3VuZGFyeQogICAgCQkJCQljb25zdCBjaHVua1N0YXJ0ID0gY2h1bmtPZmZzZXQgKyBjaHVua1BhZGRpbmc7IC8vIHRoZSBzdGFydCBwb3NpdGlvbiBpbiB0aGUgY3VycmVudCBjaHVuayBmb3IgdGhlIGRhdGEKCiAgICAJCQkJCW9mZnNldCArPSBjaHVua1BhZGRpbmc7CgogICAgCQkJCQkvLyBDaGVjayBmb3IgY2h1bmsgb3ZlcmZsb3cKICAgIAkJCQkJaWYgKCBjaHVua1N0YXJ0ICE9PSAwICYmICggY2h1bmtTaXplIC0gY2h1bmtTdGFydCApIDwgaW5mby5zdG9yYWdlICkgewoKICAgIAkJCQkJCS8vIEFkZCBwYWRkaW5nIGFuZCBhZGp1c3Qgb2Zmc2V0CiAgICAJCQkJCQlvZmZzZXQgKz0gKCBjaHVua1NpemUgLSBjaHVua1N0YXJ0ICk7CgogICAgCQkJCQl9CgogICAgCQkJCQkvLyB0aGUgZm9sbG93aW5nIHR3byBwcm9wZXJ0aWVzIHdpbGwgYmUgdXNlZCBmb3IgcGFydGlhbCBidWZmZXIgdXBkYXRlcwogICAgCQkJCQl1bmlmb3JtLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoIGluZm8uc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCApOwogICAgCQkJCQl1bmlmb3JtLl9fb2Zmc2V0ID0gb2Zmc2V0OwoKICAgIAkJCQkJLy8gVXBkYXRlIHRoZSBnbG9iYWwgb2Zmc2V0CiAgICAJCQkJCW9mZnNldCArPSBpbmZvLnN0b3JhZ2U7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLyBlbnN1cmUgY29ycmVjdCBmaW5hbCBwYWRkaW5nCgogICAgCQljb25zdCBjaHVua09mZnNldCA9IG9mZnNldCAlIGNodW5rU2l6ZTsKCiAgICAJCWlmICggY2h1bmtPZmZzZXQgPiAwICkgb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXQgKTsKCiAgICAJCS8vCgogICAgCQl1bmlmb3Jtc0dyb3VwLl9fc2l6ZSA9IG9mZnNldDsKICAgIAkJdW5pZm9ybXNHcm91cC5fX2NhY2hlID0ge307CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKSB7CgogICAgCQljb25zdCBpbmZvID0gewogICAgCQkJYm91bmRhcnk6IDAsIC8vIGJ5dGVzCiAgICAJCQlzdG9yYWdlOiAwIC8vIGJ5dGVzCiAgICAJCX07CgogICAgCQkvLyBkZXRlcm1pbmUgc2l6ZXMgYWNjb3JkaW5nIHRvIFNURDE0MAoKICAgIAkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKICAgIAkJCS8vIGZsb2F0L2ludC9ib29sCgogICAgCQkJaW5mby5ib3VuZGFyeSA9IDQ7CiAgICAJCQlpbmZvLnN0b3JhZ2UgPSA0OwoKICAgIAkJfSBlbHNlIGlmICggdmFsdWUuaXNWZWN0b3IyICkgewoKICAgIAkJCS8vIHZlYzIKCiAgICAJCQlpbmZvLmJvdW5kYXJ5ID0gODsKICAgIAkJCWluZm8uc3RvcmFnZSA9IDg7CgogICAgCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1ZlY3RvcjMgfHwgdmFsdWUuaXNDb2xvciApIHsKCiAgICAJCQkvLyB2ZWMzCgogICAgCQkJaW5mby5ib3VuZGFyeSA9IDE2OwogICAgCQkJaW5mby5zdG9yYWdlID0gMTI7IC8vIGV2aWw6IHZlYzMgbXVzdCBzdGFydCBvbiBhIDE2LWJ5dGUgYm91bmRhcnkgYnV0IGl0IG9ubHkgY29uc3VtZXMgMTIgYnl0ZXMKCiAgICAJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVmVjdG9yNCApIHsKCiAgICAJCQkvLyB2ZWM0CgogICAgCQkJaW5mby5ib3VuZGFyeSA9IDE2OwogICAgCQkJaW5mby5zdG9yYWdlID0gMTY7CgogICAgCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDMgKSB7CgogICAgCQkJLy8gbWF0MyAoaW4gU1REMTQwIGEgM3gzIG1hdHJpeCBpcyByZXByZXNlbnRlZCBhcyAzeDQpCgogICAgCQkJaW5mby5ib3VuZGFyeSA9IDQ4OwogICAgCQkJaW5mby5zdG9yYWdlID0gNDg7CgogICAgCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDQgKSB7CgogICAgCQkJLy8gbWF0NAoKICAgIAkJCWluZm8uYm91bmRhcnkgPSA2NDsKICAgIAkJCWluZm8uc3RvcmFnZSA9IDY0OwoKICAgIAkJfSBlbHNlIGlmICggdmFsdWUuaXNUZXh0dXJlICkgewoKICAgIAkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgc2FtcGxlcnMgY2FuIG5vdCBiZSBwYXJ0IG9mIGFuIHVuaWZvcm1zIGdyb3VwLicgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5zdXBwb3J0ZWQgdW5pZm9ybSB2YWx1ZSB0eXBlLicsIHZhbHVlICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gaW5mbzsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQljb25zdCB1bmlmb3Jtc0dyb3VwID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJdW5pZm9ybXNHcm91cC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVW5pZm9ybXNHcm91cHNEaXNwb3NlICk7CgogICAgCQljb25zdCBpbmRleCA9IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMuaW5kZXhPZiggdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ICk7CiAgICAJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMuc3BsaWNlKCBpbmRleCwgMSApOwoKICAgIAkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF0gKTsKCiAgICAJCWRlbGV0ZSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CiAgICAJCWRlbGV0ZSB1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCWZvciAoIGNvbnN0IGlkIGluIGJ1ZmZlcnMgKSB7CgogICAgCQkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyBpZCBdICk7CgogICAgCQl9CgogICAgCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzID0gW107CiAgICAJCWJ1ZmZlcnMgPSB7fTsKICAgIAkJdXBkYXRlTGlzdCA9IHt9OwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQliaW5kOiBiaW5kLAogICAgCQl1cGRhdGU6IHVwZGF0ZSwKCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UKCiAgICAJfTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIHJlbmRlcmVyIHVzZXMgV2ViR0wgMiB0byBkaXNwbGF5IHNjZW5lcy4KICAgICAqCiAgICAgKiBXZWJHTCAxIGlzIG5vdCBzdXBwb3J0ZWQgc2luY2UgYHIxNjNgLgogICAgICovCiAgICBjbGFzcyBXZWJHTFJlbmRlcmVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBXZWJHTCByZW5kZXJlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn5PcHRpb25zfSBbcGFyYW1ldGVyc10gLSBUaGUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgPSB7fSApIHsKCiAgICAJCWNvbnN0IHsKICAgIAkJCWNhbnZhcyA9IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKSwKICAgIAkJCWNvbnRleHQgPSBudWxsLAogICAgCQkJZGVwdGggPSB0cnVlLAogICAgCQkJc3RlbmNpbCA9IGZhbHNlLAogICAgCQkJYWxwaGEgPSBmYWxzZSwKICAgIAkJCWFudGlhbGlhcyA9IGZhbHNlLAogICAgCQkJcHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZSwKICAgIAkJCXByZXNlcnZlRHJhd2luZ0J1ZmZlciA9IGZhbHNlLAogICAgCQkJcG93ZXJQcmVmZXJlbmNlID0gJ2RlZmF1bHQnLAogICAgCQkJZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCA9IGZhbHNlLAogICAgCQkJcmV2ZXJzZURlcHRoQnVmZmVyID0gZmFsc2UsCiAgICAJCX0gPSBwYXJhbWV0ZXJzOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNXZWJHTFJlbmRlcmVyID0gdHJ1ZTsKCiAgICAJCWxldCBfYWxwaGE7CgogICAgCQlpZiAoIGNvbnRleHQgIT09IG51bGwgKSB7CgogICAgCQkJaWYgKCB0eXBlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICE9PSAndW5kZWZpbmVkJyAmJiBjb250ZXh0IGluc3RhbmNlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICkgewoKICAgIAkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBXZWJHTCAxIGlzIG5vdCBzdXBwb3J0ZWQgc2luY2UgcjE2My4nICk7CgogICAgCQkJfQoKICAgIAkJCV9hbHBoYSA9IGNvbnRleHQuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKS5hbHBoYTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJX2FscGhhID0gYWxwaGE7CgogICAgCQl9CgogICAgCQljb25zdCB1aW50Q2xlYXJDb2xvciA9IG5ldyBVaW50MzJBcnJheSggNCApOwogICAgCQljb25zdCBpbnRDbGVhckNvbG9yID0gbmV3IEludDMyQXJyYXkoIDQgKTsKCiAgICAJCWxldCBjdXJyZW50UmVuZGVyTGlzdCA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKICAgIAkJLy8gcmVuZGVyKCkgY2FuIGJlIGNhbGxlZCBmcm9tIHdpdGhpbiBhIGNhbGxiYWNrIHRyaWdnZXJlZCBieSBhbm90aGVyIHJlbmRlci4KICAgIAkJLy8gV2UgdHJhY2sgdGhpcyBzbyB0aGF0IHRoZSBuZXN0ZWQgcmVuZGVyIGNhbGwgZ2V0cyBpdHMgbGlzdCBhbmQgc3RhdGUgaXNvbGF0ZWQgZnJvbSB0aGUgcGFyZW50IHJlbmRlciBjYWxsLgoKICAgIAkJY29uc3QgcmVuZGVyTGlzdFN0YWNrID0gW107CiAgICAJCWNvbnN0IHJlbmRlclN0YXRlU3RhY2sgPSBbXTsKCiAgICAJCS8vIHB1YmxpYyBwcm9wZXJ0aWVzCgogICAgCQkvKioKICAgIAkJICogQSBjYW52YXMgd2hlcmUgdGhlIHJlbmRlcmVyIGRyYXdzIGl0cyBvdXRwdXQuVGhpcyBpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgYnkgdGhlIHJlbmRlcmVyCiAgICAJCSAqIGluIHRoZSBjb25zdHJ1Y3RvciAoaWYgbm90IHByb3ZpZGVkIGFscmVhZHkpOyB5b3UganVzdCBuZWVkIHRvIGFkZCBpdCB0byB5b3VyIHBhZ2UgbGlrZSBzbzoKICAgIAkJICogYGBganMKICAgIAkJICogZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggcmVuZGVyZXIuZG9tRWxlbWVudCApOwogICAgCQkgKiBgYGAKICAgIAkJICoKICAgIAkJICogQHR5cGUge0RPTUVsZW1lbnR9CiAgICAJCSAqLwogICAgCQl0aGlzLmRvbUVsZW1lbnQgPSBjYW52YXM7CgogICAgCQkvKioKICAgIAkJICogQSBvYmplY3Qgd2l0aCBkZWJ1ZyBjb25maWd1cmF0aW9uIHNldHRpbmdzLgogICAgCQkgKgogICAgCQkgKiAtIGBjaGVja1NoYWRlckVycm9yc2A6IElmIGl0IGlzIGB0cnVlYCwgZGVmaW5lcyB3aGV0aGVyIG1hdGVyaWFsIHNoYWRlciBwcm9ncmFtcyBhcmUKICAgIAkJICogY2hlY2tlZCBmb3IgZXJyb3JzIGR1cmluZyBjb21waWxhdGlvbiBhbmQgbGlua2FnZSBwcm9jZXNzLiBJdCBtYXkgYmUgdXNlZnVsIHRvIGRpc2FibGUKICAgIAkJICogdGhpcyBjaGVjayBpbiBwcm9kdWN0aW9uIGZvciBwZXJmb3JtYW5jZSBnYWluLiBJdCBpcyBzdHJvbmdseSByZWNvbW1lbmRlZCB0byBrZWVwIHRoZXNlCiAgICAJCSAqIGNoZWNrcyBlbmFibGVkIGR1cmluZyBkZXZlbG9wbWVudC4gSWYgdGhlIHNoYWRlciBkb2VzIG5vdCBjb21waWxlIGFuZCBsaW5rIC0gaXQgd2lsbCBub3QKICAgIAkJICogd29yayBhbmQgYXNzb2NpYXRlZCBtYXRlcmlhbCB3aWxsIG5vdCByZW5kZXIuCiAgICAJCSAqIC0gYG9uU2hhZGVyRXJyb3IoZ2wsIHByb2dyYW0sIGdsVmVydGV4U2hhZGVyLGdsRnJhZ21lbnRTaGFkZXIpYDogQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0CiAgICAJCSAqIGNhbiBiZSB1c2VkIGZvciBjdXN0b20gZXJyb3IgcmVwb3J0aW5nLiBUaGUgY2FsbGJhY2sgcmVjZWl2ZXMgdGhlIFdlYkdMIGNvbnRleHQsIGFuIGluc3RhbmNlCiAgICAJCSAqIG9mIFdlYkdMUHJvZ3JhbSBhcyB3ZWxsIHR3byBpbnN0YW5jZXMgb2YgV2ViR0xTaGFkZXIgcmVwcmVzZW50aW5nIHRoZSB2ZXJ0ZXggYW5kIGZyYWdtZW50IHNoYWRlci4KICAgIAkJICogQXNzaWduaW5nIGEgY3VzdG9tIGZ1bmN0aW9uIGRpc2FibGVzIHRoZSBkZWZhdWx0IGVycm9yIHJlcG9ydGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdH0KICAgIAkJICovCiAgICAJCXRoaXMuZGVidWcgPSB7CgogICAgCQkJLyoqCiAgICAJCQkgKiBFbmFibGVzIGVycm9yIGNoZWNraW5nIGFuZCByZXBvcnRpbmcgd2hlbiBzaGFkZXIgcHJvZ3JhbXMgYXJlIGJlaW5nIGNvbXBpbGVkLgogICAgCQkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCQkgKi8KICAgIAkJCWNoZWNrU2hhZGVyRXJyb3JzOiB0cnVlLAogICAgCQkJLyoqCiAgICAJCQkgKiBDYWxsYmFjayBmb3IgY3VzdG9tIGVycm9yIHJlcG9ydGluZy4KICAgIAkJCSAqIEB0eXBlIHs/RnVuY3Rpb259CiAgICAJCQkgKi8KICAgIAkJCW9uU2hhZGVyRXJyb3I6IG51bGwKICAgIAkJfTsKCiAgICAJCS8vIGNsZWFyaW5nCgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGF1dG9tYXRpY2FsbHkgY2xlYXIgaXRzIG91dHB1dCBiZWZvcmUgcmVuZGVyaW5nIGEgZnJhbWUgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5hdXRvQ2xlYXIgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIElmIHtAbGluayBXZWJHTFJlbmRlcmVyI2F1dG9DbGVhcn0gc2V0IHRvIGB0cnVlYCwgd2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGNsZWFyCiAgICAJCSAqIHRoZSBjb2xvciBidWZmZXIgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5hdXRvQ2xlYXJDb2xvciA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogSWYge0BsaW5rIFdlYkdMUmVuZGVyZXIjYXV0b0NsZWFyfSBzZXQgdG8gYHRydWVgLCB3aGV0aGVyIHRoZSByZW5kZXJlciBzaG91bGQgY2xlYXIKICAgIAkJICogdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmF1dG9DbGVhckRlcHRoID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNhdXRvQ2xlYXJ9IHNldCB0byBgdHJ1ZWAsIHdoZXRoZXIgdGhlIHJlbmRlcmVyIHNob3VsZCBjbGVhcgogICAgCQkgKiB0aGUgc3RlbmNpbCBidWZmZXIgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5hdXRvQ2xlYXJTdGVuY2lsID0gdHJ1ZTsKCiAgICAJCS8vIHNjZW5lIGdyYXBoCgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIHNvcnQgb2JqZWN0cyBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIE5vdGU6IFNvcnRpbmcgaXMgdXNlZCB0byBhdHRlbXB0IHRvIHByb3Blcmx5IHJlbmRlciBvYmplY3RzIHRoYXQgaGF2ZSBzb21lCiAgICAJCSAqIGRlZ3JlZSBvZiB0cmFuc3BhcmVuY3kuIEJ5IGRlZmluaXRpb24sIHNvcnRpbmcgb2JqZWN0cyBtYXkgbm90IHdvcmsgaW4gYWxsCiAgICAJCSAqIGNhc2VzLiBEZXBlbmRpbmcgb24gdGhlIG5lZWRzIG9mIGFwcGxpY2F0aW9uLCBpdCBtYXkgYmUgbmVjZXNzYXJ5IHRvIHR1cm4KICAgIAkJICogb2ZmIHNvcnRpbmcgYW5kIHVzZSBvdGhlciBtZXRob2RzIHRvIGRlYWwgd2l0aCB0cmFuc3BhcmVuY3kgcmVuZGVyaW5nIGUuZy4KICAgIAkJICogbWFudWFsbHkgZGV0ZXJtaW5pbmcgZWFjaCBvYmplY3QncyByZW5kZXJpbmcgb3JkZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLnNvcnRPYmplY3RzID0gdHJ1ZTsKCiAgICAJCS8vIHVzZXItZGVmaW5lZCBjbGlwcGluZwoKICAgIAkJLyoqCiAgICAJCSAqIFVzZXItZGVmaW5lZCBjbGlwcGluZyBwbGFuZXMgc3BlY2lmaWVkIGluIHdvcmxkIHNwYWNlLiBUaGVzZSBwbGFuZXMgYXBwbHkgZ2xvYmFsbHkuCiAgICAJCSAqIFBvaW50cyBpbiBzcGFjZSB3aG9zZSBkb3QgcHJvZHVjdCB3aXRoIHRoZSBwbGFuZSBpcyBuZWdhdGl2ZSBhcmUgY3V0IGF3YXkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxQbGFuZT59CiAgICAJCSAqLwogICAgCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gW107CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgcmVzcGVjdHMgb2JqZWN0LWxldmVsIGNsaXBwaW5nIHBsYW5lcyBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJLy8gdG9uZSBtYXBwaW5nCgogICAgCQkvKioKICAgIAkJICogVGhlIHRvbmUgbWFwcGluZyB0ZWNobmlxdWUgb2YgdGhlIHJlbmRlcmVyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5vVG9uZU1hcHBpbmd8TGluZWFyVG9uZU1hcHBpbmd8UmVpbmhhcmRUb25lTWFwcGluZ3xDaW5lb25Ub25lTWFwcGluZ3xBQ0VTRmlsbWljVG9uZU1hcHBpbmd8Q3VzdG9tVG9uZU1hcHBpbmd8QWdYVG9uZU1hcHBpbmd8TmV1dHJhbFRvbmVNYXBwaW5nKX0KICAgIAkJICogQGRlZmF1bHQgTm9Ub25lTWFwcGluZwogICAgCQkgKi8KICAgIAkJdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgogICAgCQkvKioKICAgIAkJICogRXhwb3N1cmUgbGV2ZWwgb2YgdG9uZSBtYXBwaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnRvbmVNYXBwaW5nRXhwb3N1cmUgPSAxLjA7CgogICAgCQkvLyB0cmFuc21pc3Npb24KCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbm9ybWFsaXplZCByZXNvbHV0aW9uIHNjYWxlIGZvciB0aGUgdHJhbnNtaXNzaW9uIHJlbmRlciB0YXJnZXQsIG1lYXN1cmVkIGluIHBlcmNlbnRhZ2UKICAgIAkJICogb2Ygdmlld3BvcnQgZGltZW5zaW9ucy4gTG93ZXJpbmcgdGhpcyB2YWx1ZSBjYW4gcmVzdWx0IGluIHNpZ25pZmljYW50IHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cwogICAgCQkgKiB3aGVuIHVzaW5nIHtAbGluayBNZXNoUGh5c2ljYWxNYXRlcmlhbCN0cmFuc21pc3Npb259LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnRyYW5zbWlzc2lvblJlc29sdXRpb25TY2FsZSA9IDEuMDsKCiAgICAJCS8vIGludGVybmFsIHByb3BlcnRpZXMKCiAgICAJCWNvbnN0IF90aGlzID0gdGhpczsKCiAgICAJCWxldCBfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKICAgIAkJLy8gaW50ZXJuYWwgc3RhdGUgY2FjaGUKCiAgICAJCXRoaXMuX291dHB1dENvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZTsKCiAgICAJCWxldCBfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gMDsKICAgIAkJbGV0IF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwogICAgCQlsZXQgX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwogICAgCQlsZXQgX2N1cnJlbnRNYXRlcmlhbElkID0gLTE7CgogICAgCQlsZXQgX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKICAgIAkJY29uc3QgX2N1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CiAgICAJCWNvbnN0IF9jdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCk7CiAgICAJCWxldCBfY3VycmVudFNjaXNzb3JUZXN0ID0gbnVsbDsKCiAgICAJCWNvbnN0IF9jdXJyZW50Q2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKICAgIAkJbGV0IF9jdXJyZW50Q2xlYXJBbHBoYSA9IDA7CgogICAgCQkvLwoKICAgIAkJbGV0IF93aWR0aCA9IGNhbnZhcy53aWR0aDsKICAgIAkJbGV0IF9oZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwoKICAgIAkJbGV0IF9waXhlbFJhdGlvID0gMTsKICAgIAkJbGV0IF9vcGFxdWVTb3J0ID0gbnVsbDsKICAgIAkJbGV0IF90cmFuc3BhcmVudFNvcnQgPSBudWxsOwoKICAgIAkJY29uc3QgX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoIDAsIDAsIF93aWR0aCwgX2hlaWdodCApOwogICAgCQljb25zdCBfc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCBfd2lkdGgsIF9oZWlnaHQgKTsKICAgIAkJbGV0IF9zY2lzc29yVGVzdCA9IGZhbHNlOwoKICAgIAkJLy8gZnJ1c3R1bQoKICAgIAkJY29uc3QgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKICAgIAkJLy8gY2xpcHBpbmcKCiAgICAJCWxldCBfY2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CiAgICAJCWxldCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZTsKCiAgICAJCS8vIGNhbWVyYSBtYXRyaWNlcyBjYWNoZQoKICAgIAkJY29uc3QgX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKICAgIAkJY29uc3QgX3Byb2pTY3JlZW5NYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKICAgIAkJY29uc3QgX3ZlY3RvcjMgPSBuZXcgVmVjdG9yMygpOwoKICAgIAkJY29uc3QgX3ZlY3RvcjQgPSBuZXcgVmVjdG9yNCgpOwoKICAgIAkJY29uc3QgX2VtcHR5U2NlbmUgPSB7IGJhY2tncm91bmQ6IG51bGwsIGZvZzogbnVsbCwgZW52aXJvbm1lbnQ6IG51bGwsIG92ZXJyaWRlTWF0ZXJpYWw6IG51bGwsIGlzU2NlbmU6IHRydWUgfTsKCiAgICAJCWxldCBfcmVuZGVyQmFja2dyb3VuZCA9IGZhbHNlOwoKICAgIAkJZnVuY3Rpb24gZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpIHsKCiAgICAJCQlyZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfcGl4ZWxSYXRpbyA6IDE7CgogICAgCQl9CgogICAgCQkvLyBpbml0aWFsaXplCgogICAgCQlsZXQgX2dsID0gY29udGV4dDsKCiAgICAJCWZ1bmN0aW9uIGdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApIHsKCiAgICAJCQlyZXR1cm4gY2FudmFzLmdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApOwoKICAgIAkJfQoKICAgIAkJdHJ5IHsKCiAgICAJCQljb25zdCBjb250ZXh0QXR0cmlidXRlcyA9IHsKICAgIAkJCQlhbHBoYTogdHJ1ZSwKICAgIAkJCQlkZXB0aCwKICAgIAkJCQlzdGVuY2lsLAogICAgCQkJCWFudGlhbGlhcywKICAgIAkJCQlwcmVtdWx0aXBsaWVkQWxwaGEsCiAgICAJCQkJcHJlc2VydmVEcmF3aW5nQnVmZmVyLAogICAgCQkJCXBvd2VyUHJlZmVyZW5jZSwKICAgIAkJCQlmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0LAogICAgCQkJfTsKCiAgICAJCQkvLyBPZmZzY3JlZW5DYW52YXMgZG9lcyBub3QgaGF2ZSBzZXRBdHRyaWJ1dGUsIHNlZSAjMjI4MTEKICAgIAkJCWlmICggJ3NldEF0dHJpYnV0ZScgaW4gY2FudmFzICkgY2FudmFzLnNldEF0dHJpYnV0ZSggJ2RhdGEtZW5naW5lJywgYHRocmVlLmpzIHIke1JFVklTSU9OfWAgKTsKCiAgICAJCQkvLyBldmVudCBsaXN0ZW5lcnMgbXVzdCBiZSByZWdpc3RlcmVkIGJlZm9yZSBXZWJHTCBjb250ZXh0IGlzIGNyZWF0ZWQsIHNlZSAjMTI3NTMKICAgIAkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0bG9zdCcsIG9uQ29udGV4dExvc3QsIGZhbHNlICk7CiAgICAJCQljYW52YXMuYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKICAgIAkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0Y3JlYXRpb25lcnJvcicsIG9uQ29udGV4dENyZWF0aW9uRXJyb3IsIGZhbHNlICk7CgogICAgCQkJaWYgKCBfZ2wgPT09IG51bGwgKSB7CgogICAgCQkJCWNvbnN0IGNvbnRleHROYW1lID0gJ3dlYmdsMic7CgogICAgCQkJCV9nbCA9IGdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApOwoKICAgIAkJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCiAgICAJCQkJCWlmICggZ2V0Q29udGV4dCggY29udGV4dE5hbWUgKSApIHsKCiAgICAJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0IHdpdGggeW91ciBzZWxlY3RlZCBhdHRyaWJ1dGVzLicgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4nICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6ICcgKyBlcnJvci5tZXNzYWdlICk7CiAgICAJCQl0aHJvdyBlcnJvcjsKCiAgICAJCX0KCiAgICAJCWxldCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIHN0YXRlLCBpbmZvOwogICAgCQlsZXQgcHJvcGVydGllcywgdGV4dHVyZXMsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBhdHRyaWJ1dGVzLCBnZW9tZXRyaWVzLCBvYmplY3RzOwogICAgCQlsZXQgcHJvZ3JhbUNhY2hlLCBtYXRlcmlhbHMsIHJlbmRlckxpc3RzLCByZW5kZXJTdGF0ZXMsIGNsaXBwaW5nLCBzaGFkb3dNYXA7CgogICAgCQlsZXQgYmFja2dyb3VuZCwgbW9ycGh0YXJnZXRzLCBidWZmZXJSZW5kZXJlciwgaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwoKICAgIAkJbGV0IHV0aWxzLCBiaW5kaW5nU3RhdGVzLCB1bmlmb3Jtc0dyb3VwczsKCiAgICAJCWZ1bmN0aW9uIGluaXRHTENvbnRleHQoKSB7CgogICAgCQkJZXh0ZW5zaW9ucyA9IG5ldyBXZWJHTEV4dGVuc2lvbnMoIF9nbCApOwogICAgCQkJZXh0ZW5zaW9ucy5pbml0KCk7CgogICAgCQkJdXRpbHMgPSBuZXcgV2ViR0xVdGlscyggX2dsLCBleHRlbnNpb25zICk7CgogICAgCQkJY2FwYWJpbGl0aWVzID0gbmV3IFdlYkdMQ2FwYWJpbGl0aWVzKCBfZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHV0aWxzICk7CgogICAgCQkJc3RhdGUgPSBuZXcgV2ViR0xTdGF0ZSggX2dsLCBleHRlbnNpb25zICk7CgogICAgCQkJaWYgKCBjYXBhYmlsaXRpZXMucmV2ZXJzZURlcHRoQnVmZmVyICYmIHJldmVyc2VEZXB0aEJ1ZmZlciApIHsKCiAgICAJCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRSZXZlcnNlZCggdHJ1ZSApOwoKICAgIAkJCX0KCiAgICAJCQlpbmZvID0gbmV3IFdlYkdMSW5mbyggX2dsICk7CiAgICAJCQlwcm9wZXJ0aWVzID0gbmV3IFdlYkdMUHJvcGVydGllcygpOwogICAgCQkJdGV4dHVyZXMgPSBuZXcgV2ViR0xUZXh0dXJlcyggX2dsLCBleHRlbnNpb25zLCBzdGF0ZSwgcHJvcGVydGllcywgY2FwYWJpbGl0aWVzLCB1dGlscywgaW5mbyApOwogICAgCQkJY3ViZW1hcHMgPSBuZXcgV2ViR0xDdWJlTWFwcyggX3RoaXMgKTsKICAgIAkJCWN1YmV1dm1hcHMgPSBuZXcgV2ViR0xDdWJlVVZNYXBzKCBfdGhpcyApOwogICAgCQkJYXR0cmlidXRlcyA9IG5ldyBXZWJHTEF0dHJpYnV0ZXMoIF9nbCApOwogICAgCQkJYmluZGluZ1N0YXRlcyA9IG5ldyBXZWJHTEJpbmRpbmdTdGF0ZXMoIF9nbCwgYXR0cmlidXRlcyApOwogICAgCQkJZ2VvbWV0cmllcyA9IG5ldyBXZWJHTEdlb21ldHJpZXMoIF9nbCwgYXR0cmlidXRlcywgaW5mbywgYmluZGluZ1N0YXRlcyApOwogICAgCQkJb2JqZWN0cyA9IG5ldyBXZWJHTE9iamVjdHMoIF9nbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApOwogICAgCQkJbW9ycGh0YXJnZXRzID0gbmV3IFdlYkdMTW9ycGh0YXJnZXRzKCBfZ2wsIGNhcGFiaWxpdGllcywgdGV4dHVyZXMgKTsKICAgIAkJCWNsaXBwaW5nID0gbmV3IFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKTsKICAgIAkJCXByb2dyYW1DYWNoZSA9IG5ldyBXZWJHTFByb2dyYW1zKCBfdGhpcywgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcgKTsKICAgIAkJCW1hdGVyaWFscyA9IG5ldyBXZWJHTE1hdGVyaWFscyggX3RoaXMsIHByb3BlcnRpZXMgKTsKICAgIAkJCXJlbmRlckxpc3RzID0gbmV3IFdlYkdMUmVuZGVyTGlzdHMoKTsKICAgIAkJCXJlbmRlclN0YXRlcyA9IG5ldyBXZWJHTFJlbmRlclN0YXRlcyggZXh0ZW5zaW9ucyApOwogICAgCQkJYmFja2dyb3VuZCA9IG5ldyBXZWJHTEJhY2tncm91bmQoIF90aGlzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgc3RhdGUsIG9iamVjdHMsIF9hbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CiAgICAJCQlzaGFkb3dNYXAgPSBuZXcgV2ViR0xTaGFkb3dNYXAoIF90aGlzLCBvYmplY3RzLCBjYXBhYmlsaXRpZXMgKTsKICAgIAkJCXVuaWZvcm1zR3JvdXBzID0gbmV3IFdlYkdMVW5pZm9ybXNHcm91cHMoIF9nbCwgaW5mbywgY2FwYWJpbGl0aWVzLCBzdGF0ZSApOwoKICAgIAkJCWJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMQnVmZmVyUmVuZGVyZXIoIF9nbCwgZXh0ZW5zaW9ucywgaW5mbyApOwogICAgCQkJaW5kZXhlZEJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKCBfZ2wsIGV4dGVuc2lvbnMsIGluZm8gKTsKCiAgICAJCQlpbmZvLnByb2dyYW1zID0gcHJvZ3JhbUNhY2hlLnByb2dyYW1zOwoKICAgIAkJCS8qKgogICAgCQkJICogSG9sZHMgZGV0YWlscyBhYm91dCB0aGUgY2FwYWJpbGl0aWVzIG9mIHRoZSBjdXJyZW50IHJlbmRlcmluZyBjb250ZXh0LgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjY2FwYWJpbGl0aWVzCiAgICAJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5DYXBhYmlsaXRpZXN9CiAgICAJCQkgKi8KICAgIAkJCV90aGlzLmNhcGFiaWxpdGllcyA9IGNhcGFiaWxpdGllczsKCiAgICAJCQkvKioKICAgIAkJCSAqIFByb3ZpZGVzIG1ldGhvZHMgZm9yIHJldHJpZXZpbmcgYW5kIHRlc3RpbmcgV2ViR0wgZXh0ZW5zaW9ucy4KICAgIAkJCSAqCiAgICAJCQkgKiAtIGBnZXQoZXh0ZW5zaW9uTmFtZTpzdHJpbmcpYDogVXNlZCB0byBjaGVjayB3aGV0aGVyIGEgV2ViR0wgZXh0ZW5zaW9uIGlzIHN1cHBvcnRlZAogICAgCQkJICogYW5kIHJldHVybiB0aGUgZXh0ZW5zaW9uIG9iamVjdCBpZiBhdmFpbGFibGUuCiAgICAJCQkgKiAtIGBoYXMoZXh0ZW5zaW9uTmFtZTpzdHJpbmcpYDogcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGV4dGVuc2lvbiBpcyBzdXBwb3J0ZWQuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNleHRlbnNpb25zCiAgICAJCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkJICovCiAgICAJCQlfdGhpcy5leHRlbnNpb25zID0gZXh0ZW5zaW9uczsKCiAgICAJCQkvKioKICAgIAkJCSAqIFVzZWQgdG8gdHJhY2sgcHJvcGVydGllcyBvZiBvdGhlciBvYmplY3RzIGxpa2UgbmF0aXZlIFdlYkdMIG9iamVjdHMuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNwcm9wZXJ0aWVzCiAgICAJCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkJICovCiAgICAJCQlfdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKCiAgICAJCQkvKioKICAgIAkJCSAqIE1hbmFnZXMgdGhlIHJlbmRlciBsaXN0cyBvZiB0aGUgcmVuZGVyZXIuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNyZW5kZXJMaXN0cwogICAgCQkJICogQHR5cGUge09iamVjdH0KICAgIAkJCSAqLwogICAgCQkJX3RoaXMucmVuZGVyTGlzdHMgPSByZW5kZXJMaXN0czsKCgoKICAgIAkJCS8qKgogICAgCQkJICogSW50ZXJmYWNlIGZvciBtYW5hZ2luZyBzaGFkb3dzLgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjc2hhZG93TWFwCiAgICAJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5TaGFkb3dNYXB9CiAgICAJCQkgKi8KICAgIAkJCV90aGlzLnNoYWRvd01hcCA9IHNoYWRvd01hcDsKCiAgICAJCQkvKioKICAgIAkJCSAqIEludGVyZmFjZSBmb3IgbWFuYWdpbmcgdGhlIFdlYkdMIHN0YXRlLgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjc3RhdGUKICAgIAkJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCQkgKi8KICAgIAkJCV90aGlzLnN0YXRlID0gc3RhdGU7CgogICAgCQkJLyoqCiAgICAJCQkgKiBIb2xkcyBhIHNlcmllcyBvZiBzdGF0aXN0aWNhbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgR1BVIG1lbW9yeQogICAgCQkJICogYW5kIHRoZSByZW5kZXJpbmcgcHJvY2Vzcy4gVXNlZnVsIGZvciBkZWJ1Z2dpbmcgYW5kIG1vbml0b3JpbmcuCiAgICAJCQkgKgogICAgCQkJICogQnkgZGVmYXVsdCB0aGVzZSBkYXRhIGFyZSByZXNldCBhdCBlYWNoIHJlbmRlciBjYWxsIGJ1dCB3aGVuIGhhdmluZwogICAgCQkJICogbXVsdGlwbGUgcmVuZGVyIHBhc3NlcyBwZXIgZnJhbWUgKGUuZy4gd2hlbiB1c2luZyBwb3N0IHByb2Nlc3NpbmcpIGl0IGNhbgogICAgCQkJICogYmUgcHJlZmVycmVkIHRvIHJlc2V0IHdpdGggYSBjdXN0b20gcGF0dGVybi4gRmlyc3QsIHNldCBgYXV0b1Jlc2V0YCB0bwogICAgCQkJICogYGZhbHNlYC4KICAgIAkJCSAqIGBgYGpzCiAgICAJCQkgKiByZW5kZXJlci5pbmZvLmF1dG9SZXNldCA9IGZhbHNlOwogICAgCQkJICogYGBgCiAgICAJCQkgKiBDYWxsIGByZXNldCgpYCB3aGVuZXZlciB5b3UgaGF2ZSBmaW5pc2hlZCB0byByZW5kZXIgYSBzaW5nbGUgZnJhbWUuCiAgICAJCQkgKiBgYGBqcwogICAgCQkJICogcmVuZGVyZXIuaW5mby5yZXNldCgpOwogICAgCQkJICogYGBgCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNpbmZvCiAgICAJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5JbmZvfQogICAgCQkJICovCiAgICAJCQlfdGhpcy5pbmZvID0gaW5mbzsKCiAgICAJCX0KCiAgICAJCWluaXRHTENvbnRleHQoKTsKCiAgICAJCS8vIHhyCgogICAgCQljb25zdCB4ciA9IG5ldyBXZWJYUk1hbmFnZXIoIF90aGlzLCBfZ2wgKTsKCiAgICAJCS8qKgogICAgCQkgKiBBIHJlZmVyZW5jZSB0byB0aGUgWFIgbWFuYWdlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1dlYlhSTWFuYWdlcn0KICAgIAkJICovCiAgICAJCXRoaXMueHIgPSB4cjsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSByZW5kZXJpbmcgY29udGV4dC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7V2ViR0wyUmVuZGVyaW5nQ29udGV4dH0gVGhlIHJlbmRlcmluZyBjb250ZXh0LgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDb250ZXh0ID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBfZ2w7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIHJlbmRlcmluZyBjb250ZXh0IGF0dHJpYnV0ZXMuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge1dlYkdMQ29udGV4dEF0dHJpYnV0ZXN9IFRoZSByZW5kZXJpbmcgY29udGV4dCBhdHRyaWJ1dGVzLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDb250ZXh0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gX2dsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNpbXVsYXRlcyBhIGxvc3Mgb2YgdGhlIFdlYkdMIGNvbnRleHQuIFRoaXMgcmVxdWlyZXMgc3VwcG9ydCBmb3IgdGhlIGBXRUJHTF9sb3NlX2NvbnRleHRgIGV4dGVuc2lvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZm9yY2VDb250ZXh0TG9zcyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKICAgIAkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLmxvc2VDb250ZXh0KCk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNpbXVsYXRlcyBhIHJlc3RvcmUgb2YgdGhlIFdlYkdMIGNvbnRleHQuIFRoaXMgcmVxdWlyZXMgc3VwcG9ydCBmb3IgdGhlIGBXRUJHTF9sb3NlX2NvbnRleHRgIGV4dGVuc2lvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZm9yY2VDb250ZXh0UmVzdG9yZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKICAgIAkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLnJlc3RvcmVDb250ZXh0KCk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIHBpeGVsIHJhdGlvLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBwaXhlbCByYXRpby4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gX3BpeGVsUmF0aW87CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIGdpdmVuIHBpeGVsIHJhdGlvIGFuZCByZXNpemVzIHRoZSBjYW52YXMgaWYgbmVjZXNzYXJ5LgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgcGl4ZWwgcmF0aW8uCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKICAgIAkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCiAgICAJCQlfcGl4ZWxSYXRpbyA9IHZhbHVlOwoKICAgIAkJCXRoaXMuc2V0U2l6ZSggX3dpZHRoLCBfaGVpZ2h0LCBmYWxzZSApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSByZW5kZXJlcidzIHNpemUgaW4gbG9naWNhbCBwaXhlbHMuIFRoaXMgbWV0aG9kIGRvZXMgbm90IGhvbm9yIHRoZSBwaXhlbCByYXRpby4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KICAgIAkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIHJlbmRlcmVyJ3Mgc2l6ZSBpbiBsb2dpY2FsIHBpeGVscy4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0U2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKICAgIAkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGgsIF9oZWlnaHQgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmVzaXplcyB0aGUgb3V0cHV0IGNhbnZhcyB0byAod2lkdGgsIGhlaWdodCkgd2l0aCBkZXZpY2UgcGl4ZWwgcmF0aW8gdGFrZW4KICAgIAkJICogaW50byBhY2NvdW50LCBhbmQgYWxzbyBzZXRzIHRoZSB2aWV3cG9ydCB0byBmaXQgdGhhdCBzaXplLCBzdGFydGluZyBpbiAoMCwKICAgIAkJICogMCkuIFNldHRpbmcgYHVwZGF0ZVN0eWxlYCB0byBmYWxzZSBwcmV2ZW50cyBhbnkgc3R5bGUgY2hhbmdlcyB0byB0aGUgb3V0cHV0IGNhbnZhcy4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIGluIGxvZ2ljYWwgcGl4ZWxzLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBpbiBsb2dpY2FsIHBpeGVscy4KICAgIAkJICogQHBhcmFtIHtib29sZWFufSBbdXBkYXRlU3R5bGU9dHJ1ZV0gLSBXaGV0aGVyIHRvIHVwZGF0ZSB0aGUgYHN0eWxlYCBhdHRyaWJ1dGUgb2YgdGhlIGNhbnZhcyBvciBub3QuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQsIHVwZGF0ZVN0eWxlID0gdHJ1ZSApIHsKCiAgICAJCQlpZiAoIHhyLmlzUHJlc2VudGluZyApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ2FuXCd0IGNoYW5nZSBzaXplIHdoaWxlIFZSIGRldmljZSBpcyBwcmVzZW50aW5nLicgKTsKICAgIAkJCQlyZXR1cm47CgogICAgCQkJfQoKICAgIAkJCV93aWR0aCA9IHdpZHRoOwogICAgCQkJX2hlaWdodCA9IGhlaWdodDsKCiAgICAJCQljYW52YXMud2lkdGggPSBNYXRoLmZsb29yKCB3aWR0aCAqIF9waXhlbFJhdGlvICk7CiAgICAJCQljYW52YXMuaGVpZ2h0ID0gTWF0aC5mbG9vciggaGVpZ2h0ICogX3BpeGVsUmF0aW8gKTsKCiAgICAJCQlpZiAoIHVwZGF0ZVN0eWxlID09PSB0cnVlICkgewoKICAgIAkJCQljYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7CiAgICAJCQkJY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CgogICAgCQkJfQoKICAgIAkJCXRoaXMuc2V0Vmlld3BvcnQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgZHJhd2luZyBidWZmZXIgc2l6ZSBpbiBwaHlzaWNhbCBwaXhlbHMuIFRoaXMgbWV0aG9kIGhvbm9ycyB0aGUgcGl4ZWwgcmF0aW8uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCiAgICAJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IFRoZSBkcmF3aW5nIGJ1ZmZlciBzaXplLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKICAgIAkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGggKiBfcGl4ZWxSYXRpbywgX2hlaWdodCAqIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogVGhpcyBtZXRob2QgYWxsb3dzIHRvIGRlZmluZSB0aGUgZHJhd2luZyBidWZmZXIgc2l6ZSBieSBzcGVjaWZ5aW5nCiAgICAJCSAqIHdpZHRoLCBoZWlnaHQgYW5kIHBpeGVsIHJhdGlvIGFsbCBhdCBvbmNlLiBUaGUgc2l6ZSBvZiB0aGUgZHJhd2luZwogICAgCQkgKiBidWZmZXIgaXMgY29tcHV0ZWQgd2l0aCB0aGlzIGZvcm11bGE6CiAgICAJCSAqIGBgYGpzCiAgICAJCSAqIHNpemUueCA9IHdpZHRoICogcGl4ZWxSYXRpbzsKICAgIAkJICogc2l6ZS55ID0gaGVpZ2h0ICogcGl4ZWxSYXRpbzsKICAgIAkJICogYGBgCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBpbiBsb2dpY2FsIHBpeGVscy4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgaW4gbG9naWNhbCBwaXhlbHMuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBwaXhlbFJhdGlvIC0gVGhlIHBpeGVsIHJhdGlvLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgcGl4ZWxSYXRpbyApIHsKCiAgICAJCQlfd2lkdGggPSB3aWR0aDsKICAgIAkJCV9oZWlnaHQgPSBoZWlnaHQ7CgogICAgCQkJX3BpeGVsUmF0aW8gPSBwaXhlbFJhdGlvOwoKICAgIAkJCWNhbnZhcy53aWR0aCA9IE1hdGguZmxvb3IoIHdpZHRoICogcGl4ZWxSYXRpbyApOwogICAgCQkJY2FudmFzLmhlaWdodCA9IE1hdGguZmxvb3IoIGhlaWdodCAqIHBpeGVsUmF0aW8gKTsKCiAgICAJCQl0aGlzLnNldFZpZXdwb3J0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmlld3BvcnQgZGVmaW5pdGlvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KICAgIAkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIGN1cnJlbnQgdmlld3BvcnQgZGVmaW5pdGlvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0Q3VycmVudFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfY3VycmVudFZpZXdwb3J0ICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIHZpZXdwb3J0IGRlZmluaXRpb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCiAgICAJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IFRoZSB2aWV3cG9ydCBkZWZpbml0aW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggX3ZpZXdwb3J0ICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIHZpZXdwb3J0IHRvIHJlbmRlciBmcm9tIGAoeCwgeSlgIHRvIGAoeCArIHdpZHRoLCB5ICsgaGVpZ2h0KWAuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyIHwgVmVjdG9yNH0geCAtIFRoZSBob3Jpem9udGFsIGNvb3JkaW5hdGUgZm9yIHRoZSBsb3dlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlld3BvcnQgb3JpZ2luIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KICAgIAkJICogT3IgYWx0ZXJuYXRpdmVseSBhIGZvdXItY29tcG9uZW50IHZlY3RvciBzcGVjaWZ5aW5nIGFsbCB0aGUgcGFyYW1ldGVycyBvZiB0aGUgdmlld3BvcnQuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZlcnRpY2FsIGNvb3JkaW5hdGUgZm9yIHRoZSBsb3dlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlld3BvcnQgb3JpZ2luICBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdmlld3BvcnQgaW4gbG9naWNhbCBwaXhlbCB1bml0LgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdmlld3BvcnQgaW4gbG9naWNhbCBwaXhlbCB1bml0LgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCiAgICAJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKICAgIAkJCQlfdmlld3BvcnQuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfdmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCQkJfQoKICAgIAkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLnJvdW5kKCkgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgc2Npc3NvciByZWdpb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCiAgICAJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IFRoZSBzY2lzc29yIHJlZ2lvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0U2Npc3NvciA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggX3NjaXNzb3IgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgc2Npc3NvciByZWdpb24gdG8gcmVuZGVyIGZyb20gYCh4LCB5KWAgdG8gYCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQpYC4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXIgfCBWZWN0b3I0fSB4IC0gVGhlIGhvcml6b250YWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBvcmlnaW4gaW4gbG9naWNhbCBwaXhlbCB1bml0LgogICAgCQkgKiBPciBhbHRlcm5hdGl2ZWx5IGEgZm91ci1jb21wb25lbnQgdmVjdG9yIHNwZWNpZnlpbmcgYWxsIHRoZSBwYXJhbWV0ZXJzIG9mIHRoZSBzY2lzc29yIHJlZ2lvbi4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBvcmlnaW4gIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFNjaXNzb3IgPSBmdW5jdGlvbiAoIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgogICAgCQkJaWYgKCB4LmlzVmVjdG9yNCApIHsKCiAgICAJCQkJX3NjaXNzb3Iuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfc2Npc3Nvci5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCQl9CgogICAgCQkJc3RhdGUuc2Npc3NvciggX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkucm91bmQoKSApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc2Npc3NvciB0ZXN0IGlzIGVuYWJsZWQuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBpcyBlbmFibGVkIG9yIG5vdC4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0U2Npc3NvclRlc3QgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIF9zY2lzc29yVGVzdDsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHNjaXNzb3IgdGVzdC4gV2hlbiB0aGlzIGlzIGVuYWJsZWQsIG9ubHkgdGhlIHBpeGVscwogICAgCQkgKiB3aXRoaW4gdGhlIGRlZmluZWQgc2Npc3NvciBhcmVhIHdpbGwgYmUgYWZmZWN0ZWQgYnkgZnVydGhlciByZW5kZXJlcgogICAgCQkgKiBhY3Rpb25zLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge2Jvb2xlYW59IGJvb2xlYW4gLSBXaGV0aGVyIHRoZSBzY2lzc29yIHRlc3QgaXMgZW5hYmxlZCBvciBub3QuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCBib29sZWFuICkgewoKICAgIAkJCXN0YXRlLnNldFNjaXNzb3JUZXN0KCBfc2Npc3NvclRlc3QgPSBib29sZWFuICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgYSBjdXN0b20gb3BhcXVlIHNvcnQgZnVuY3Rpb24gZm9yIHRoZSByZW5kZXIgbGlzdHMuIFBhc3MgYG51bGxgCiAgICAJCSAqIHRvIHVzZSB0aGUgZGVmYXVsdCBgcGFpbnRlclNvcnRTdGFibGVgIGZ1bmN0aW9uLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0gez9GdW5jdGlvbn0gbWV0aG9kIC0gVGhlIG9wYXF1ZSBzb3J0IGZ1bmN0aW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRPcGFxdWVTb3J0ID0gZnVuY3Rpb24gKCBtZXRob2QgKSB7CgogICAgCQkJX29wYXF1ZVNvcnQgPSBtZXRob2Q7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgYSBjdXN0b20gdHJhbnNwYXJlbnQgc29ydCBmdW5jdGlvbiBmb3IgdGhlIHJlbmRlciBsaXN0cy4gUGFzcyBgbnVsbGAKICAgIAkJICogdG8gdXNlIHRoZSBkZWZhdWx0IGByZXZlcnNlUGFpbnRlclNvcnRTdGFibGVgIGZ1bmN0aW9uLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0gez9GdW5jdGlvbn0gbWV0aG9kIC0gVGhlIG9wYXF1ZSBzb3J0IGZ1bmN0aW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRUcmFuc3BhcmVudFNvcnQgPSBmdW5jdGlvbiAoIG1ldGhvZCApIHsKCiAgICAJCQlfdHJhbnNwYXJlbnRTb3J0ID0gbWV0aG9kOwoKICAgIAkJfTsKCiAgICAJCS8vIENsZWFyaW5nCgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgY2xlYXIgY29sb3IuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7Q29sb3J9IHRhcmdldCAtIFRoZSBtZXRob2Qgd3JpdGVzIHRoZSByZXN1bHQgaW4gdGhpcyB0YXJnZXQgb2JqZWN0LgogICAgCQkgKiBAcmV0dXJuIHtDb2xvcn0gVGhlIGNsZWFyIGNvbG9yLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKSApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSBjbGVhciBjb2xvciBhbmQgYWxwaGEuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNsZWFyIGNvbG9yLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gW2FscGhhPTFdIC0gVGhlIGNsZWFyIGFscGhhLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCWJhY2tncm91bmQuc2V0Q2xlYXJDb2xvciggLi4uYXJndW1lbnRzICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGNsZWFyIGFscGhhLiBSYW5nZXMgd2l0aGluIGBbMCwxXWAuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNsZWFyIGFscGhhLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDbGVhckFscGhhID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgY2xlYXIgYWxwaGEuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBjbGVhciBhbHBoYS4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0Q2xlYXJBbHBoYSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQliYWNrZ3JvdW5kLnNldENsZWFyQWxwaGEoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBUZWxscyB0aGUgcmVuZGVyZXIgdG8gY2xlYXIgaXRzIGNvbG9yLCBkZXB0aCBvciBzdGVuY2lsIGRyYXdpbmcgYnVmZmVyKHMpLgogICAgCQkgKiBUaGlzIG1ldGhvZCBpbml0aWFsaXplcyB0aGUgYnVmZmVycyB0byB0aGUgY3VycmVudCBjbGVhciBjb2xvciB2YWx1ZXMuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NvbG9yPXRydWVdIC0gV2hldGhlciB0aGUgY29sb3IgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KICAgIAkJICogQHBhcmFtIHtib29sZWFufSBbZGVwdGg9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBkZXB0aCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgogICAgCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtzdGVuY2lsPXRydWVdIC0gV2hldGhlciB0aGUgc3RlbmNpbCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgogICAgCQkgKi8KICAgIAkJdGhpcy5jbGVhciA9IGZ1bmN0aW9uICggY29sb3IgPSB0cnVlLCBkZXB0aCA9IHRydWUsIHN0ZW5jaWwgPSB0cnVlICkgewoKICAgIAkJCWxldCBiaXRzID0gMDsKCiAgICAJCQlpZiAoIGNvbG9yICkgewoKICAgIAkJCQkvLyBjaGVjayBpZiB3ZSdyZSB0cnlpbmcgdG8gY2xlYXIgYW4gaW50ZWdlciB0YXJnZXQKICAgIAkJCQlsZXQgaXNJbnRlZ2VyRm9ybWF0ID0gZmFsc2U7CiAgICAJCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApIHsKCiAgICAJCQkJCWNvbnN0IHRhcmdldEZvcm1hdCA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuZm9ybWF0OwogICAgCQkJCQlpc0ludGVnZXJGb3JtYXQgPSB0YXJnZXRGb3JtYXQgPT09IFJHQkFJbnRlZ2VyRm9ybWF0IHx8CiAgICAJCQkJCQl0YXJnZXRGb3JtYXQgPT09IFJHSW50ZWdlckZvcm1hdCB8fAogICAgCQkJCQkJdGFyZ2V0Rm9ybWF0ID09PSBSZWRJbnRlZ2VyRm9ybWF0OwoKICAgIAkJCQl9CgogICAgCQkJCS8vIHVzZSB0aGUgYXBwcm9wcmlhdGUgY2xlYXIgZnVuY3Rpb25zIHRvIGNsZWFyIHRoZSB0YXJnZXQgaWYgaXQncyBhIHNpZ25lZAogICAgCQkJCS8vIG9yIHVuc2lnbmVkIGludGVnZXIgdGFyZ2V0CiAgICAJCQkJaWYgKCBpc0ludGVnZXJGb3JtYXQgKSB7CgogICAgCQkJCQljb25zdCB0YXJnZXRUeXBlID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS50eXBlOwogICAgCQkJCQljb25zdCBpc1Vuc2lnbmVkVHlwZSA9IHRhcmdldFR5cGUgPT09IFVuc2lnbmVkQnl0ZVR5cGUgfHwKICAgIAkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fAogICAgCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgfHwKICAgIAkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSB8fAogICAgCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlIHx8CiAgICAJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGU7CgogICAgCQkJCQljb25zdCBjbGVhckNvbG9yID0gYmFja2dyb3VuZC5nZXRDbGVhckNvbG9yKCk7CiAgICAJCQkJCWNvbnN0IGEgPSBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKICAgIAkJCQkJY29uc3QgciA9IGNsZWFyQ29sb3IucjsKICAgIAkJCQkJY29uc3QgZyA9IGNsZWFyQ29sb3IuZzsKICAgIAkJCQkJY29uc3QgYiA9IGNsZWFyQ29sb3IuYjsKCiAgICAJCQkJCWlmICggaXNVbnNpZ25lZFR5cGUgKSB7CgogICAgCQkJCQkJdWludENsZWFyQ29sb3JbIDAgXSA9IHI7CiAgICAJCQkJCQl1aW50Q2xlYXJDb2xvclsgMSBdID0gZzsKICAgIAkJCQkJCXVpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwogICAgCQkJCQkJdWludENsZWFyQ29sb3JbIDMgXSA9IGE7CiAgICAJCQkJCQlfZ2wuY2xlYXJCdWZmZXJ1aXYoIF9nbC5DT0xPUiwgMCwgdWludENsZWFyQ29sb3IgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJaW50Q2xlYXJDb2xvclsgMCBdID0gcjsKICAgIAkJCQkJCWludENsZWFyQ29sb3JbIDEgXSA9IGc7CiAgICAJCQkJCQlpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwogICAgCQkJCQkJaW50Q2xlYXJDb2xvclsgMyBdID0gYTsKICAgIAkJCQkJCV9nbC5jbGVhckJ1ZmZlcml2KCBfZ2wuQ09MT1IsIDAsIGludENsZWFyQ29sb3IgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWJpdHMgfD0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCBkZXB0aCApIHsKCiAgICAJCQkJYml0cyB8PSBfZ2wuREVQVEhfQlVGRkVSX0JJVDsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBzdGVuY2lsICkgewoKICAgIAkJCQliaXRzIHw9IF9nbC5TVEVOQ0lMX0JVRkZFUl9CSVQ7CiAgICAJCQkJdGhpcy5zdGF0ZS5idWZmZXJzLnN0ZW5jaWwuc2V0TWFzayggMHhmZmZmZmZmZiApOwoKICAgIAkJCX0KCiAgICAJCQlfZ2wuY2xlYXIoIGJpdHMgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQ2xlYXJzIHRoZSBjb2xvciBidWZmZXIuIEVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVuZGVyZXIuY2xlYXIoIHRydWUsIGZhbHNlLCBmYWxzZSApYC4KICAgIAkJICovCiAgICAJCXRoaXMuY2xlYXJDb2xvciA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQl0aGlzLmNsZWFyKCB0cnVlLCBmYWxzZSwgZmFsc2UgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQ2xlYXJzIHRoZSBkZXB0aCBidWZmZXIuIEVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVuZGVyZXIuY2xlYXIoIGZhbHNlLCB0cnVlLCBmYWxzZSApYC4KICAgIAkJICovCiAgICAJCXRoaXMuY2xlYXJEZXB0aCA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQl0aGlzLmNsZWFyKCBmYWxzZSwgdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQ2xlYXJzIHRoZSBzdGVuY2lsIGJ1ZmZlci4gRXF1aXZhbGVudCB0byBjYWxsaW5nIGByZW5kZXJlci5jbGVhciggZmFsc2UsIGZhbHNlLCB0cnVlIClgLgogICAgCQkgKi8KICAgIAkJdGhpcy5jbGVhclN0ZW5jaWwgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJdGhpcy5jbGVhciggZmFsc2UsIGZhbHNlLCB0cnVlICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwogICAgCQkgKiBtZXRob2Qgd2hlbmV2ZXIgdGhpcyBpbnN0YW5jZSBpcyBubyBsb25nZXIgdXNlZCBpbiB5b3VyIGFwcC4KICAgIAkJICovCiAgICAJCXRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGxvc3QnLCBvbkNvbnRleHRMb3N0LCBmYWxzZSApOwogICAgCQkJY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRyZXN0b3JlZCcsIG9uQ29udGV4dFJlc3RvcmUsIGZhbHNlICk7CiAgICAJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGNyZWF0aW9uZXJyb3InLCBvbkNvbnRleHRDcmVhdGlvbkVycm9yLCBmYWxzZSApOwoKICAgIAkJCWJhY2tncm91bmQuZGlzcG9zZSgpOwogICAgCQkJcmVuZGVyTGlzdHMuZGlzcG9zZSgpOwogICAgCQkJcmVuZGVyU3RhdGVzLmRpc3Bvc2UoKTsKICAgIAkJCXByb3BlcnRpZXMuZGlzcG9zZSgpOwogICAgCQkJY3ViZW1hcHMuZGlzcG9zZSgpOwogICAgCQkJY3ViZXV2bWFwcy5kaXNwb3NlKCk7CiAgICAJCQlvYmplY3RzLmRpc3Bvc2UoKTsKICAgIAkJCWJpbmRpbmdTdGF0ZXMuZGlzcG9zZSgpOwogICAgCQkJdW5pZm9ybXNHcm91cHMuZGlzcG9zZSgpOwogICAgCQkJcHJvZ3JhbUNhY2hlLmRpc3Bvc2UoKTsKCiAgICAJCQl4ci5kaXNwb3NlKCk7CgogICAgCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKICAgIAkJCXhyLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCiAgICAJCQlhbmltYXRpb24uc3RvcCgpOwoKICAgIAkJfTsKCiAgICAJCS8vIEV2ZW50cwoKICAgIAkJZnVuY3Rpb24gb25Db250ZXh0TG9zdCggZXZlbnQgKSB7CgogICAgCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCiAgICAJCQljb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IENvbnRleHQgTG9zdC4nICk7CgogICAgCQkJX2lzQ29udGV4dExvc3QgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gb25Db250ZXh0UmVzdG9yZSggLyogZXZlbnQgKi8gKSB7CgogICAgCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IFJlc3RvcmVkLicgKTsKCiAgICAJCQlfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKICAgIAkJCWNvbnN0IGluZm9BdXRvUmVzZXQgPSBpbmZvLmF1dG9SZXNldDsKICAgIAkJCWNvbnN0IHNoYWRvd01hcEVuYWJsZWQgPSBzaGFkb3dNYXAuZW5hYmxlZDsKICAgIAkJCWNvbnN0IHNoYWRvd01hcEF1dG9VcGRhdGUgPSBzaGFkb3dNYXAuYXV0b1VwZGF0ZTsKICAgIAkJCWNvbnN0IHNoYWRvd01hcE5lZWRzVXBkYXRlID0gc2hhZG93TWFwLm5lZWRzVXBkYXRlOwogICAgCQkJY29uc3Qgc2hhZG93TWFwVHlwZSA9IHNoYWRvd01hcC50eXBlOwoKICAgIAkJCWluaXRHTENvbnRleHQoKTsKCiAgICAJCQlpbmZvLmF1dG9SZXNldCA9IGluZm9BdXRvUmVzZXQ7CiAgICAJCQlzaGFkb3dNYXAuZW5hYmxlZCA9IHNoYWRvd01hcEVuYWJsZWQ7CiAgICAJCQlzaGFkb3dNYXAuYXV0b1VwZGF0ZSA9IHNoYWRvd01hcEF1dG9VcGRhdGU7CiAgICAJCQlzaGFkb3dNYXAubmVlZHNVcGRhdGUgPSBzaGFkb3dNYXBOZWVkc1VwZGF0ZTsKICAgIAkJCXNoYWRvd01hcC50eXBlID0gc2hhZG93TWFwVHlwZTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIG9uQ29udGV4dENyZWF0aW9uRXJyb3IoIGV2ZW50ICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBIFdlYkdMIGNvbnRleHQgY291bGQgbm90IGJlIGNyZWF0ZWQuIFJlYXNvbjogJywgZXZlbnQuc3RhdHVzTWVzc2FnZSApOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gb25NYXRlcmlhbERpc3Bvc2UoIGV2ZW50ICkgewoKICAgIAkJCWNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCiAgICAJCQlkZWFsbG9jYXRlTWF0ZXJpYWwoIG1hdGVyaWFsICk7CgogICAgCQl9CgogICAgCQkvLyBCdWZmZXIgZGVhbGxvY2F0aW9uCgogICAgCQlmdW5jdGlvbiBkZWFsbG9jYXRlTWF0ZXJpYWwoIG1hdGVyaWFsICkgewoKICAgIAkJCXJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApOwoKICAgIAkJCXByb3BlcnRpZXMucmVtb3ZlKCBtYXRlcmlhbCApOwoKICAgIAkJfQoKCiAgICAJCWZ1bmN0aW9uIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApIHsKCiAgICAJCQljb25zdCBwcm9ncmFtcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLnByb2dyYW1zOwoKICAgIAkJCWlmICggcHJvZ3JhbXMgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJcHJvZ3JhbXMuZm9yRWFjaCggZnVuY3Rpb24gKCBwcm9ncmFtICkgewoKICAgIAkJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VQcm9ncmFtKCBwcm9ncmFtICk7CgogICAgCQkJCX0gKTsKCiAgICAJCQkJaWYgKCBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICkgewoKICAgIAkJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VTaGFkZXJDYWNoZSggbWF0ZXJpYWwgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIEJ1ZmZlciByZW5kZXJpbmcKCiAgICAJCXRoaXMucmVuZGVyQnVmZmVyRGlyZWN0ID0gZnVuY3Rpb24gKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKSB7CgogICAgCQkJaWYgKCBzY2VuZSA9PT0gbnVsbCApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHJlbmRlckJ1ZmZlckRpcmVjdCBzZWNvbmQgcGFyYW1ldGVyIHVzZWQgdG8gYmUgZm9nIChjb3VsZCBiZSBudWxsKQoKICAgIAkJCWNvbnN0IGZyb250RmFjZUNXID0gKCBvYmplY3QuaXNNZXNoICYmIG9iamVjdC5tYXRyaXhXb3JsZC5kZXRlcm1pbmFudCgpIDwgMCApOwoKICAgIAkJCWNvbnN0IHByb2dyYW0gPSBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApOwoKICAgIAkJCXN0YXRlLnNldE1hdGVyaWFsKCBtYXRlcmlhbCwgZnJvbnRGYWNlQ1cgKTsKCiAgICAJCQkvLwoKICAgIAkJCWxldCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwogICAgCQkJbGV0IHJhbmdlRmFjdG9yID0gMTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJaW5kZXggPSBnZW9tZXRyaWVzLmdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCiAgICAJCQkJaWYgKCBpbmRleCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJCQlyYW5nZUZhY3RvciA9IDI7CgogICAgCQkJfQoKICAgIAkJCS8vCgogICAgCQkJY29uc3QgZHJhd1JhbmdlID0gZ2VvbWV0cnkuZHJhd1JhbmdlOwogICAgCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKICAgIAkJCWxldCBkcmF3U3RhcnQgPSBkcmF3UmFuZ2Uuc3RhcnQgKiByYW5nZUZhY3RvcjsKICAgIAkJCWxldCBkcmF3RW5kID0gKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSAqIHJhbmdlRmFjdG9yOwoKICAgIAkJCWlmICggZ3JvdXAgIT09IG51bGwgKSB7CgogICAgCQkJCWRyYXdTdGFydCA9IE1hdGgubWF4KCBkcmF3U3RhcnQsIGdyb3VwLnN0YXJ0ICogcmFuZ2VGYWN0b3IgKTsKICAgIAkJCQlkcmF3RW5kID0gTWF0aC5taW4oIGRyYXdFbmQsICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApICogcmFuZ2VGYWN0b3IgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCiAgICAJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgMCApOwogICAgCQkJCWRyYXdFbmQgPSBNYXRoLm1pbiggZHJhd0VuZCwgaW5kZXguY291bnQgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICYmIHBvc2l0aW9uICE9PSBudWxsICkgewoKICAgIAkJCQlkcmF3U3RhcnQgPSBNYXRoLm1heCggZHJhd1N0YXJ0LCAwICk7CiAgICAJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCBwb3NpdGlvbi5jb3VudCApOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCBkcmF3Q291bnQgPSBkcmF3RW5kIC0gZHJhd1N0YXJ0OwoKICAgIAkJCWlmICggZHJhd0NvdW50IDwgMCB8fCBkcmF3Q291bnQgPT09IEluZmluaXR5ICkgcmV0dXJuOwoKICAgIAkJCS8vCgogICAgCQkJYmluZGluZ1N0YXRlcy5zZXR1cCggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnksIGluZGV4ICk7CgogICAgCQkJbGV0IGF0dHJpYnV0ZTsKICAgIAkJCWxldCByZW5kZXJlciA9IGJ1ZmZlclJlbmRlcmVyOwoKICAgIAkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJCWF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApOwoKICAgIAkJCQlyZW5kZXJlciA9IGluZGV4ZWRCdWZmZXJSZW5kZXJlcjsKICAgIAkJCQlyZW5kZXJlci5zZXRJbmRleCggYXR0cmlidXRlICk7CgogICAgCQkJfQoKICAgIAkJCS8vCgogICAgCQkJaWYgKCBvYmplY3QuaXNNZXNoICkgewoKICAgIAkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CiAgICAJCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5MSU5FUyApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlRSSUFOR0xFUyApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZSApIHsKCiAgICAJCQkJbGV0IGxpbmVXaWR0aCA9IG1hdGVyaWFsLmxpbmV3aWR0aDsKCiAgICAJCQkJaWYgKCBsaW5lV2lkdGggPT09IHVuZGVmaW5lZCApIGxpbmVXaWR0aCA9IDE7IC8vIE5vdCB1c2luZyBMaW5lKk1hdGVyaWFsCgogICAgCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbGluZVdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgogICAgCQkJCWlmICggb2JqZWN0LmlzTGluZVNlZ21lbnRzICkgewoKICAgIAkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVTICk7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpbmVMb29wICkgewoKICAgIAkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfTE9PUCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfU1RSSVAgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1BvaW50cyApIHsKCiAgICAJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlBPSU5UUyApOwoKICAgIAkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1Nwcml0ZSApIHsKCiAgICAJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlRSSUFOR0xFUyApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICkgewoKICAgIAkJCQlpZiAoIG9iamVjdC5fbXVsdGlEcmF3SW5zdGFuY2VzICE9PSBudWxsICkgewoKICAgIAkJCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNzQKICAgIAkJCQkJd2Fybk9uY2UoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMgaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHIxODQuIEFwcGVuZCB0byByZW5kZXJNdWx0aURyYXcgYXJndW1lbnRzIGFuZCB1c2UgaW5kaXJlY3Rpb24uJyApOwogICAgCQkJCQlyZW5kZXJlci5yZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMoIG9iamVjdC5fbXVsdGlEcmF3U3RhcnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudCwgb2JqZWN0Ll9tdWx0aURyYXdJbnN0YW5jZXMgKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWlmICggISBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICkgKSB7CgogICAgCQkJCQkJY29uc3Qgc3RhcnRzID0gb2JqZWN0Ll9tdWx0aURyYXdTdGFydHM7CiAgICAJCQkJCQljb25zdCBjb3VudHMgPSBvYmplY3QuX211bHRpRHJhd0NvdW50czsKICAgIAkJCQkJCWNvbnN0IGRyYXdDb3VudCA9IG9iamVjdC5fbXVsdGlEcmF3Q291bnQ7CiAgICAJCQkJCQljb25zdCBieXRlc1BlckVsZW1lbnQgPSBpbmRleCA/IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApLmJ5dGVzUGVyRWxlbWVudCA6IDE7CiAgICAJCQkJCQljb25zdCB1bmlmb3JtcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmN1cnJlbnRQcm9ncmFtLmdldFVuaWZvcm1zKCk7CiAgICAJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgogICAgCQkJCQkJCXVuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdfZ2xfRHJhd0lEJywgaSApOwogICAgCQkJCQkJCXJlbmRlcmVyLnJlbmRlciggc3RhcnRzWyBpIF0gLyBieXRlc1BlckVsZW1lbnQsIGNvdW50c1sgaSBdICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlyZW5kZXJlci5yZW5kZXJNdWx0aURyYXcoIG9iamVjdC5fbXVsdGlEcmF3U3RhcnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCApIHsKCiAgICAJCQkJcmVuZGVyZXIucmVuZGVySW5zdGFuY2VzKCBkcmF3U3RhcnQsIGRyYXdDb3VudCwgb2JqZWN0LmNvdW50ICk7CgogICAgCQkJfSBlbHNlIGlmICggZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSApIHsKCiAgICAJCQkJY29uc3QgbWF4SW5zdGFuY2VDb3VudCA9IGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ICE9PSB1bmRlZmluZWQgPyBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA6IEluZmluaXR5OwogICAgCQkJCWNvbnN0IGluc3RhbmNlQ291bnQgPSBNYXRoLm1pbiggZ2VvbWV0cnkuaW5zdGFuY2VDb3VudCwgbWF4SW5zdGFuY2VDb3VudCApOwoKICAgIAkJCQlyZW5kZXJlci5yZW5kZXJJbnN0YW5jZXMoIGRyYXdTdGFydCwgZHJhd0NvdW50LCBpbnN0YW5jZUNvdW50ICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmVuZGVyZXIucmVuZGVyKCBkcmF3U3RhcnQsIGRyYXdDb3VudCApOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvLyBDb21waWxlCgogICAgCQlmdW5jdGlvbiBwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICkgewoKICAgIAkJCWlmICggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IHRydWUgJiYgbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSAmJiBtYXRlcmlhbC5mb3JjZVNpbmdsZVBhc3MgPT09IGZhbHNlICkgewoKICAgIAkJCQltYXRlcmlhbC5zaWRlID0gQmFja1NpZGU7CiAgICAJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgogICAgCQkJCW1hdGVyaWFsLnNpZGUgPSBGcm9udFNpZGU7CiAgICAJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgogICAgCQkJCW1hdGVyaWFsLnNpZGUgPSBEb3VibGVTaWRlOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLyoqCiAgICAJCSAqIENvbXBpbGVzIGFsbCBtYXRlcmlhbHMgaW4gdGhlIHNjZW5lIHdpdGggdGhlIGNhbWVyYS4gVGhpcyBpcyB1c2VmdWwgdG8gcHJlY29tcGlsZSBzaGFkZXJzCiAgICAJCSAqIGJlZm9yZSB0aGUgZmlyc3QgcmVuZGVyaW5nLiBJZiB5b3Ugd2FudCB0byBhZGQgYSAzRCBvYmplY3QgdG8gYW4gZXhpc3Rpbmcgc2NlbmUsIHVzZSB0aGUgdGhpcmQKICAgIAkJICogb3B0aW9uYWwgcGFyYW1ldGVyIGZvciBhcHBseWluZyB0aGUgdGFyZ2V0IHNjZW5lLgogICAgCQkgKgogICAgCQkgKiBOb3RlIHRoYXQgdGhlICh0YXJnZXQpIHNjZW5lJ3MgbGlnaHRpbmcgYW5kIGVudmlyb25tZW50IG11c3QgYmUgY29uZmlndXJlZCBiZWZvcmUgY2FsbGluZyB0aGlzIG1ldGhvZC4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgb3IgYW5vdGhlciB0eXBlIG9mIDNEIG9iamVjdCB0byBwcmVjb21waWxlLgogICAgCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KICAgIAkJICogQHBhcmFtIHs/U2NlbmV9IFt0YXJnZXRTY2VuZT1udWxsXSAtIFRoZSB0YXJnZXQgc2NlbmUuCiAgICAJCSAqIEByZXR1cm4ge1NldDxNYXRlcmlhbD59IFRoZSBwcmVjb21waWxlZCBtYXRlcmlhbHMuCiAgICAJCSAqLwogICAgCQl0aGlzLmNvbXBpbGUgPSBmdW5jdGlvbiAoIHNjZW5lLCBjYW1lcmEsIHRhcmdldFNjZW5lID0gbnVsbCApIHsKCiAgICAJCQlpZiAoIHRhcmdldFNjZW5lID09PSBudWxsICkgdGFyZ2V0U2NlbmUgPSBzY2VuZTsKCiAgICAJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCB0YXJnZXRTY2VuZSApOwogICAgCQkJY3VycmVudFJlbmRlclN0YXRlLmluaXQoIGNhbWVyYSApOwoKICAgIAkJCXJlbmRlclN0YXRlU3RhY2sucHVzaCggY3VycmVudFJlbmRlclN0YXRlICk7CgogICAgCQkJLy8gZ2F0aGVyIGxpZ2h0cyBmcm9tIGJvdGggdGhlIHRhcmdldCBzY2VuZSBhbmQgdGhlIG5ldyBvYmplY3QgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBzY2VuZS4KCiAgICAJCQl0YXJnZXRTY2VuZS50cmF2ZXJzZVZpc2libGUoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKICAgIAkJCQlpZiAoIG9iamVjdC5pc0xpZ2h0ICYmIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKICAgIAkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgogICAgCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKICAgIAkJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoU2hhZG93KCBvYmplY3QgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0gKTsKCiAgICAJCQlpZiAoIHNjZW5lICE9PSB0YXJnZXRTY2VuZSApIHsKCiAgICAJCQkJc2NlbmUudHJhdmVyc2VWaXNpYmxlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCiAgICAJCQkJCWlmICggb2JqZWN0LmlzTGlnaHQgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgogICAgCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgogICAgCQkJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyApIHsKCiAgICAJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfSApOwoKICAgIAkJCX0KCiAgICAJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoKTsKCiAgICAJCQkvLyBPbmx5IGluaXRpYWxpemUgbWF0ZXJpYWxzIGluIHRoZSBuZXcgc2NlbmUsIG5vdCB0aGUgdGFyZ2V0U2NlbmUuCgogICAgCQkJY29uc3QgbWF0ZXJpYWxzID0gbmV3IFNldCgpOwoKICAgIAkJCXNjZW5lLnRyYXZlcnNlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCiAgICAJCQkJaWYgKCAhICggb2JqZWN0LmlzTWVzaCB8fCBvYmplY3QuaXNQb2ludHMgfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNTcHJpdGUgKSApIHsKCiAgICAJCQkJCXJldHVybjsKCiAgICAJCQkJfQoKICAgIAkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCiAgICAJCQkJaWYgKCBtYXRlcmlhbCApIHsKCiAgICAJCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCiAgICAJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXRlcmlhbC5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQkJCWNvbnN0IG1hdGVyaWFsMiA9IG1hdGVyaWFsWyBpIF07CgogICAgCQkJCQkJCXByZXBhcmVNYXRlcmlhbCggbWF0ZXJpYWwyLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CiAgICAJCQkJCQkJbWF0ZXJpYWxzLmFkZCggbWF0ZXJpYWwyICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CiAgICAJCQkJCQltYXRlcmlhbHMuYWRkKCBtYXRlcmlhbCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSApOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2sucG9wKCk7CgogICAgCQkJcmV0dXJuIG1hdGVyaWFsczsKCiAgICAJCX07CgogICAgCQkvLyBjb21waWxlQXN5bmMKCiAgICAJCS8qKgogICAgCQkgKiBBc3luY2hyb25vdXMgdmVyc2lvbiBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNjb21waWxlfS4KICAgIAkJICoKICAgIAkJICogVGhpcyBtZXRob2QgbWFrZXMgdXNlIG9mIHRoZSBgS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlYCBXZWJHTCBleHRlbnNpb24uIEhlbmNlLAogICAgCQkgKiBpdCBpcyByZWNvbW1lbmRlZCB0byB1c2UgdGhpcyB2ZXJzaW9uIG9mIGBjb21waWxlKClgIHdoZW5ldmVyIHBvc3NpYmxlLgogICAgCQkgKgogICAgCQkgKiBAYXN5bmMKICAgIAkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgb3IgYW5vdGhlciB0eXBlIG9mIDNEIG9iamVjdCB0byBwcmVjb21waWxlLgogICAgCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KICAgIAkJICogQHBhcmFtIHs/U2NlbmV9IFt0YXJnZXRTY2VuZT1udWxsXSAtIFRoZSB0YXJnZXQgc2NlbmUuCiAgICAJCSAqIEByZXR1cm4ge1Byb21pc2V9IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGdpdmVuIHNjZW5lIGNhbiBiZSByZW5kZXJlZCB3aXRob3V0IHVubmVjZXNzYXJ5IHN0YWxsaW5nIGR1ZSB0byBzaGFkZXIgY29tcGlsYXRpb24uCiAgICAJCSAqLwogICAgCQl0aGlzLmNvbXBpbGVBc3luYyA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgPSBudWxsICkgewoKICAgIAkJCWNvbnN0IG1hdGVyaWFscyA9IHRoaXMuY29tcGlsZSggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgKTsKCiAgICAJCQkvLyBXYWl0IGZvciBhbGwgdGhlIG1hdGVyaWFscyBpbiB0aGUgbmV3IG9iamVjdCB0byBpbmRpY2F0ZSB0aGF0IHRoZXkncmUKICAgIAkJCS8vIHJlYWR5IHRvIGJlIHVzZWQgYmVmb3JlIHJlc29sdmluZyB0aGUgcHJvbWlzZS4KCiAgICAJCQlyZXR1cm4gbmV3IFByb21pc2UoICggcmVzb2x2ZSApID0+IHsKCiAgICAJCQkJZnVuY3Rpb24gY2hlY2tNYXRlcmlhbHNSZWFkeSgpIHsKCiAgICAJCQkJCW1hdGVyaWFscy5mb3JFYWNoKCBmdW5jdGlvbiAoIG1hdGVyaWFsICkgewoKICAgIAkJCQkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwogICAgCQkJCQkJY29uc3QgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCiAgICAJCQkJCQlpZiAoIHByb2dyYW0uaXNSZWFkeSgpICkgewoKICAgIAkJCQkJCQkvLyByZW1vdmUgYW55IHByb2dyYW1zIHRoYXQgcmVwb3J0IHRoZXkncmUgcmVhZHkgdG8gdXNlIGZyb20gdGhlIGxpc3QKICAgIAkJCQkJCQltYXRlcmlhbHMuZGVsZXRlKCBtYXRlcmlhbCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0gKTsKCiAgICAJCQkJCS8vIG9uY2UgdGhlIGxpc3Qgb2YgY29tcGlsaW5nIG1hdGVyaWFscyBpcyBlbXB0eSwgY2FsbCB0aGUgY2FsbGJhY2sKCiAgICAJCQkJCWlmICggbWF0ZXJpYWxzLnNpemUgPT09IDAgKSB7CgogICAgCQkJCQkJcmVzb2x2ZSggc2NlbmUgKTsKICAgIAkJCQkJCXJldHVybjsKCiAgICAJCQkJCX0KCiAgICAJCQkJCS8vIGlmIHNvbWUgbWF0ZXJpYWxzIGFyZSBzdGlsbCBub3QgcmVhZHksIHdhaXQgYSBiaXQgYW5kIGNoZWNrIGFnYWluCgogICAgCQkJCQlzZXRUaW1lb3V0KCBjaGVja01hdGVyaWFsc1JlYWR5LCAxMCApOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggZXh0ZW5zaW9ucy5nZXQoICdLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUnICkgIT09IG51bGwgKSB7CgogICAgCQkJCQkvLyBJZiB3ZSBjYW4gY2hlY2sgdGhlIGNvbXBpbGF0aW9uIHN0YXR1cyBvZiB0aGUgbWF0ZXJpYWxzIHdpdGhvdXQKICAgIAkJCQkJLy8gYmxvY2tpbmcgdGhlbiBkbyBzbyByaWdodCBhd2F5LgoKICAgIAkJCQkJY2hlY2tNYXRlcmlhbHNSZWFkeSgpOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gT3RoZXJ3aXNlIHN0YXJ0IGJ5IHdhaXRpbmcgYSBiaXQgdG8gZ2l2ZSB0aGUgbWF0ZXJpYWxzIHdlIGp1c3QKICAgIAkJCQkJLy8gaW5pdGlhbGl6ZWQgYSBjaGFuY2UgdG8gZmluaXNoLgoKICAgIAkJCQkJc2V0VGltZW91dCggY2hlY2tNYXRlcmlhbHNSZWFkeSwgMTAgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gKTsKCiAgICAJCX07CgogICAgCQkvLyBBbmltYXRpb24gTG9vcAoKICAgIAkJbGV0IG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IG51bGw7CgogICAgCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lICkgewoKICAgIAkJCWlmICggb25BbmltYXRpb25GcmFtZUNhbGxiYWNrICkgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKCB0aW1lICk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBvblhSU2Vzc2lvblN0YXJ0KCkgewoKICAgIAkJCWFuaW1hdGlvbi5zdG9wKCk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBvblhSU2Vzc2lvbkVuZCgpIHsKCiAgICAJCQlhbmltYXRpb24uc3RhcnQoKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwogICAgCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKICAgIAkJaWYgKCB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgKSBhbmltYXRpb24uc2V0Q29udGV4dCggc2VsZiApOwoKICAgIAkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCiAgICAJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKICAgIAkJCXhyLnNldEFuaW1hdGlvbkxvb3AoIGNhbGxiYWNrICk7CgogICAgCQkJKCBjYWxsYmFjayA9PT0gbnVsbCApID8gYW5pbWF0aW9uLnN0b3AoKSA6IGFuaW1hdGlvbi5zdGFydCgpOwoKICAgIAkJfTsKCiAgICAJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uc3RhcnQnLCBvblhSU2Vzc2lvblN0YXJ0ICk7CiAgICAJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCiAgICAJCS8vIFJlbmRlcmluZwoKICAgIAkJLyoqCiAgICAJCSAqIFJlbmRlcnMgdGhlIGdpdmVuIHNjZW5lIChvciBvdGhlciB0eXBlIG9mIDNEIG9iamVjdCkgdXNpbmcgdGhlIGdpdmVuIGNhbWVyYS4KICAgIAkJICoKICAgIAkJICogVGhlIHJlbmRlciBpcyBkb25lIHRvIGEgcHJldmlvdXNseSBzcGVjaWZpZWQgcmVuZGVyIHRhcmdldCBzZXQgYnkgY2FsbGluZyB7QGxpbmsgV2ViR0xSZW5kZXJlciNzZXRSZW5kZXJUYXJnZXR9CiAgICAJCSAqIG9yIHRvIHRoZSBjYW52YXMgYXMgdXN1YWwuCiAgICAJCSAqCiAgICAJCSAqIEJ5IGRlZmF1bHQgcmVuZGVyIGJ1ZmZlcnMgYXJlIGNsZWFyZWQgYmVmb3JlIHJlbmRlcmluZyBidXQgeW91IGNhbiBwcmV2ZW50CiAgICAJCSAqIHRoaXMgYnkgc2V0dGluZyB0aGUgcHJvcGVydHkgYGF1dG9DbGVhcmAgdG8gYGZhbHNlYC4gSWYgeW91IHdhbnQgdG8gcHJldmVudAogICAgCQkgKiBvbmx5IGNlcnRhaW4gYnVmZmVycyBiZWluZyBjbGVhcmVkIHlvdSBjYW4gYGF1dG9DbGVhckNvbG9yYCwgYGF1dG9DbGVhckRlcHRoYAogICAgCQkgKiBvciBgYXV0b0NsZWFyU3RlbmNpbGAgdG8gYGZhbHNlYC4gVG8gZm9yY2UgYSBjbGVhciwgdXNlIHtAbGluayBXZWJHTFJlbmRlcmVyI2NsZWFyfS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgdG8gcmVuZGVyLgogICAgCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KICAgIAkJICovCiAgICAJCXRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhICkgewoKICAgIAkJCWlmICggY2FtZXJhICE9PSB1bmRlZmluZWQgJiYgY2FtZXJhLmlzQ2FtZXJhICE9PSB0cnVlICkgewoKICAgIAkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZW5kZXI6IGNhbWVyYSBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuQ2FtZXJhLicgKTsKICAgIAkJCQlyZXR1cm47CgogICAgCQkJfQoKICAgIAkJCWlmICggX2lzQ29udGV4dExvc3QgPT09IHRydWUgKSByZXR1cm47CgogICAgCQkJLy8gdXBkYXRlIHNjZW5lIGdyYXBoCgogICAgCQkJaWYgKCBzY2VuZS5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKICAgIAkJCS8vIHVwZGF0ZSBjYW1lcmEgbWF0cmljZXMgYW5kIGZydXN0dW0KCiAgICAJCQlpZiAoIGNhbWVyYS5wYXJlbnQgPT09IG51bGwgJiYgY2FtZXJhLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKICAgIAkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgogICAgCQkJCWlmICggeHIuY2FtZXJhQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHhyLnVwZGF0ZUNhbWVyYSggY2FtZXJhICk7CgogICAgCQkJCWNhbWVyYSA9IHhyLmdldENhbWVyYSgpOyAvLyB1c2UgWFIgY2FtZXJhIGZvciByZW5kZXJpbmcKCiAgICAJCQl9CgogICAgCQkJLy8KICAgIAkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCiAgICAJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggKTsKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5pbml0KCBjYW1lcmEgKTsKCiAgICAJCQlyZW5kZXJTdGF0ZVN0YWNrLnB1c2goIGN1cnJlbnRSZW5kZXJTdGF0ZSApOwoKICAgIAkJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CiAgICAJCQlfZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCiAgICAJCQlfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSB0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkOwogICAgCQkJX2NsaXBwaW5nRW5hYmxlZCA9IGNsaXBwaW5nLmluaXQoIHRoaXMuY2xpcHBpbmdQbGFuZXMsIF9sb2NhbENsaXBwaW5nRW5hYmxlZCApOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJMaXN0ID0gcmVuZGVyTGlzdHMuZ2V0KCBzY2VuZSwgcmVuZGVyTGlzdFN0YWNrLmxlbmd0aCApOwogICAgCQkJY3VycmVudFJlbmRlckxpc3QuaW5pdCgpOwoKICAgIAkJCXJlbmRlckxpc3RTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyTGlzdCApOwoKICAgIAkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgogICAgCQkJCWNvbnN0IGRlcHRoU2Vuc2luZ01lc2ggPSBfdGhpcy54ci5nZXREZXB0aFNlbnNpbmdNZXNoKCk7CgogICAgCQkJCWlmICggZGVwdGhTZW5zaW5nTWVzaCAhPT0gbnVsbCApIHsKCiAgICAJCQkJCXByb2plY3RPYmplY3QoIGRlcHRoU2Vuc2luZ01lc2gsIGNhbWVyYSwgLSBJbmZpbml0eSwgX3RoaXMuc29ydE9iamVjdHMgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlwcm9qZWN0T2JqZWN0KCBzY2VuZSwgY2FtZXJhLCAwLCBfdGhpcy5zb3J0T2JqZWN0cyApOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJMaXN0LmZpbmlzaCgpOwoKICAgIAkJCWlmICggX3RoaXMuc29ydE9iamVjdHMgPT09IHRydWUgKSB7CgogICAgCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnNvcnQoIF9vcGFxdWVTb3J0LCBfdHJhbnNwYXJlbnRTb3J0ICk7CgogICAgCQkJfQoKICAgIAkJCV9yZW5kZXJCYWNrZ3JvdW5kID0geHIuZW5hYmxlZCA9PT0gZmFsc2UgfHwgeHIuaXNQcmVzZW50aW5nID09PSBmYWxzZSB8fCB4ci5oYXNEZXB0aFNlbnNpbmcoKSA9PT0gZmFsc2U7CiAgICAJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgewoKICAgIAkJCQliYWNrZ3JvdW5kLmFkZFRvUmVuZGVyTGlzdCggY3VycmVudFJlbmRlckxpc3QsIHNjZW5lICk7CgogICAgCQkJfQoKICAgIAkJCS8vCgogICAgCQkJdGhpcy5pbmZvLnJlbmRlci5mcmFtZSArKzsKCiAgICAJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5iZWdpblNoYWRvd3MoKTsKCiAgICAJCQljb25zdCBzaGFkb3dzQXJyYXkgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUuc2hhZG93c0FycmF5OwoKICAgIAkJCXNoYWRvd01hcC5yZW5kZXIoIHNoYWRvd3NBcnJheSwgc2NlbmUsIGNhbWVyYSApOwoKICAgIAkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLmVuZFNoYWRvd3MoKTsKCiAgICAJCQkvLwoKICAgIAkJCWlmICggdGhpcy5pbmZvLmF1dG9SZXNldCA9PT0gdHJ1ZSApIHRoaXMuaW5mby5yZXNldCgpOwoKICAgIAkJCS8vIHJlbmRlciBzY2VuZQoKICAgIAkJCWNvbnN0IG9wYXF1ZU9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC5vcGFxdWU7CiAgICAJCQljb25zdCB0cmFuc21pc3NpdmVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNtaXNzaXZlOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cygpOwoKICAgIAkJCWlmICggY2FtZXJhLmlzQXJyYXlDYW1lcmEgKSB7CgogICAgCQkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmEuY2FtZXJhczsKCiAgICAJCQkJaWYgKCB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjYW1lcmFzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCiAgICAJCQkJCQlyZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhMiApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCWlmICggX3JlbmRlckJhY2tncm91bmQgKSBiYWNrZ3JvdW5kLnJlbmRlciggc2NlbmUgKTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2FtZXJhcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCiAgICAJCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYTIsIGNhbWVyYTIudmlld3BvcnQgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyVHJhbnNtaXNzaW9uUGFzcyggb3BhcXVlT2JqZWN0cywgdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKICAgIAkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgYmFja2dyb3VuZC5yZW5kZXIoIHNjZW5lICk7CgogICAgCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApOwoKICAgIAkJCX0KCiAgICAJCQkvLwoKICAgIAkJCWlmICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgIT09IG51bGwgJiYgX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9PT0gMCApIHsKCiAgICAJCQkJLy8gcmVzb2x2ZSBtdWx0aXNhbXBsZSByZW5kZXJidWZmZXJzIHRvIGEgc2luZ2xlLXNhbXBsZSB0ZXh0dXJlIGlmIG5lY2Vzc2FyeQoKICAgIAkJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJLy8gR2VuZXJhdGUgbWlwbWFwIGlmIHdlJ3JlIHVzaW5nIGFueSBraW5kIG9mIG1pcG1hcCBmaWx0ZXJpbmcKCiAgICAJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKICAgIAkJCX0KCiAgICAJCQkvLwoKICAgIAkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhICk7CgogICAgCQkJLy8gX2dsLmZpbmlzaCgpOwoKICAgIAkJCWJpbmRpbmdTdGF0ZXMucmVzZXREZWZhdWx0U3RhdGUoKTsKICAgIAkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0xOwogICAgCQkJX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKICAgIAkJCXJlbmRlclN0YXRlU3RhY2sucG9wKCk7CgogICAgCQkJaWYgKCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2tbIHJlbmRlclN0YXRlU3RhY2subGVuZ3RoIC0gMSBdOwoKICAgIAkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5zZXRHbG9iYWxTdGF0ZSggX3RoaXMuY2xpcHBpbmdQbGFuZXMsIGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5jYW1lcmEgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKICAgIAkJCX0KCiAgICAJCQlyZW5kZXJMaXN0U3RhY2sucG9wKCk7CgogICAgCQkJaWYgKCByZW5kZXJMaXN0U3RhY2subGVuZ3RoID4gMCApIHsKCiAgICAJCQkJY3VycmVudFJlbmRlckxpc3QgPSByZW5kZXJMaXN0U3RhY2tbIHJlbmRlckxpc3RTdGFjay5sZW5ndGggLSAxIF07CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQlmdW5jdGlvbiBwcm9qZWN0T2JqZWN0KCBvYmplY3QsIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMgKSB7CgogICAgCQkJaWYgKCBvYmplY3QudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgogICAgCQkJY29uc3QgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKICAgIAkJCWlmICggdmlzaWJsZSApIHsKCiAgICAJCQkJaWYgKCBvYmplY3QuaXNHcm91cCApIHsKCiAgICAJCQkJCWdyb3VwT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xPRCApIHsKCiAgICAJCQkJCWlmICggb2JqZWN0LmF1dG9VcGRhdGUgPT09IHRydWUgKSBvYmplY3QudXBkYXRlKCBjYW1lcmEgKTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGlnaHQgKSB7CgogICAgCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KCBvYmplY3QgKTsKCiAgICAJCQkJCWlmICggb2JqZWN0LmNhc3RTaGFkb3cgKSB7CgogICAgCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTcHJpdGUgKSB7CgogICAgCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c1Nwcml0ZSggb2JqZWN0ICkgKSB7CgogICAgCQkJCQkJaWYgKCBzb3J0T2JqZWN0cyApIHsKCiAgICAJCQkJCQkJX3ZlY3RvcjQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBvYmplY3QubWF0cml4V29ybGQgKQogICAgCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKICAgIAkJCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKICAgIAkJCQkJCWlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCiAgICAJCQkJCQkJY3VycmVudFJlbmRlckxpc3QucHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3I0LnosIG51bGwgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSB7CgogICAgCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c09iamVjdCggb2JqZWN0ICkgKSB7CgogICAgCQkJCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CiAgICAJCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCiAgICAJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKICAgIAkJCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBvYmplY3QuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CiAgICAJCQkJCQkJCV92ZWN0b3I0LmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKICAgIAkJCQkJCQkJX3ZlY3RvcjQuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUuY2VudGVyICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQkJX3ZlY3RvcjQKICAgIAkJCQkJCQkJLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICkKICAgIAkJCQkJCQkJLmFwcGx5TWF0cml4NCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKICAgIAkJCQkJCQljb25zdCBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgogICAgCQkJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKICAgIAkJCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgogICAgCQkJCQkJCQlpZiAoIGdyb3VwTWF0ZXJpYWwgJiYgZ3JvdXBNYXRlcmlhbC52aXNpYmxlICkgewoKICAgIAkJCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIGdyb3VwTWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3I0LnosIGdyb3VwICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKICAgIAkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjQueiwgbnVsbCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQlwcm9qZWN0T2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIGdyb3VwT3JkZXIsIHNvcnRPYmplY3RzICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhLCB2aWV3cG9ydCApIHsKCiAgICAJCQljb25zdCBvcGFxdWVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3Qub3BhcXVlOwogICAgCQkJY29uc3QgdHJhbnNtaXNzaXZlT2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zbWlzc2l2ZTsKICAgIAkJCWNvbnN0IHRyYW5zcGFyZW50T2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zcGFyZW50OwoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApOwoKICAgIAkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLnNldEdsb2JhbFN0YXRlKCBfdGhpcy5jbGlwcGluZ1BsYW5lcywgY2FtZXJhICk7CgogICAgCQkJaWYgKCB2aWV3cG9ydCApIHN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICkgKTsKCiAgICAJCQlpZiAoIG9wYXF1ZU9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKICAgIAkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyT2JqZWN0cyggdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwogICAgCQkJaWYgKCB0cmFuc3BhcmVudE9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIHRyYW5zcGFyZW50T2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKICAgIAkJCS8vIEVuc3VyZSBkZXB0aCBidWZmZXIgd3JpdGluZyBpcyBlbmFibGVkIHNvIGl0IGNhbiBiZSBjbGVhcmVkIG9uIG5leHQgcmVuZGVyCgogICAgCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRUZXN0KCB0cnVlICk7CiAgICAJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldE1hc2soIHRydWUgKTsKICAgIAkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0TWFzayggdHJ1ZSApOwoKICAgIAkJCXN0YXRlLnNldFBvbHlnb25PZmZzZXQoIGZhbHNlICk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiByZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICkgewoKICAgIAkJCWNvbnN0IG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA6IG51bGw7CgogICAgCQkJaWYgKCBvdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgewoKICAgIAkJCQlyZXR1cm47CgogICAgCQkJfQoKICAgIAkJCWlmICggY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIDEsIDEsIHsKICAgIAkJCQkJZ2VuZXJhdGVNaXBtYXBzOiB0cnVlLAogICAgCQkJCQl0eXBlOiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApID8gSGFsZkZsb2F0VHlwZSA6IFVuc2lnbmVkQnl0ZVR5cGUsCiAgICAJCQkJCW1pbkZpbHRlcjogTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyLAogICAgCQkJCQlzYW1wbGVzOiA0LAogICAgCQkJCQlzdGVuY2lsQnVmZmVyOiBzdGVuY2lsLAogICAgCQkJCQlyZXNvbHZlRGVwdGhCdWZmZXI6IGZhbHNlLAogICAgCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogZmFsc2UsCiAgICAJCQkJCWNvbG9yU3BhY2U6IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSwKICAgIAkJCQl9ICk7CgogICAgCQkJCS8vIGRlYnVnCgogICAgCQkJCS8qCiAgICAJCQkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeSgpOwogICAgCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IG1hcDogX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldC50ZXh0dXJlIH0gKTsKCiAgICAJCQkJY29uc3QgbWVzaCA9IG5ldyBNZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKICAgIAkJCQlzY2VuZS5hZGQoIG1lc2ggKTsKICAgIAkJCQkqLwoKICAgIAkJCX0KCiAgICAJCQljb25zdCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUudHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0WyBjYW1lcmEuaWQgXTsKCiAgICAJCQljb25zdCBhY3RpdmVWaWV3cG9ydCA9IGNhbWVyYS52aWV3cG9ydCB8fCBfY3VycmVudFZpZXdwb3J0OwogICAgCQkJdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnNldFNpemUoIGFjdGl2ZVZpZXdwb3J0LnogKiBfdGhpcy50cmFuc21pc3Npb25SZXNvbHV0aW9uU2NhbGUsIGFjdGl2ZVZpZXdwb3J0LncgKiBfdGhpcy50cmFuc21pc3Npb25SZXNvbHV0aW9uU2NhbGUgKTsKCiAgICAJCQkvLwoKICAgIAkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSBfdGhpcy5nZXRSZW5kZXJUYXJnZXQoKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IF90aGlzLmdldEFjdGl2ZUN1YmVGYWNlKCk7CiAgICAJCQljb25zdCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSBfdGhpcy5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKICAgIAkJCV90aGlzLnNldFJlbmRlclRhcmdldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJX3RoaXMuZ2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yICk7CiAgICAJCQlfY3VycmVudENsZWFyQWxwaGEgPSBfdGhpcy5nZXRDbGVhckFscGhhKCk7CiAgICAJCQlpZiAoIF9jdXJyZW50Q2xlYXJBbHBoYSA8IDEgKSBfdGhpcy5zZXRDbGVhckNvbG9yKCAweGZmZmZmZiwgMC41ICk7CgogICAgCQkJX3RoaXMuY2xlYXIoKTsKCiAgICAJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgYmFja2dyb3VuZC5yZW5kZXIoIHNjZW5lICk7CgogICAgCQkJLy8gVHVybiBvZmYgdGhlIGZlYXR1cmVzIHdoaWNoIGNhbiBhZmZlY3QgdGhlIGZyYWcgY29sb3IgZm9yIG9wYXF1ZSBvYmplY3RzIHBhc3MuCiAgICAJCQkvLyBPdGhlcndpc2UgdGhleSBhcmUgYXBwbGllZCB0d2ljZSBpbiBvcGFxdWUgb2JqZWN0cyBwYXNzIGFuZCB0cmFuc21pc3Npb24gb2JqZWN0cyBwYXNzLgogICAgCQkJY29uc3QgY3VycmVudFRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CiAgICAJCQlfdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgogICAgCQkJLy8gUmVtb3ZlIHZpZXdwb3J0IGZyb20gY2FtZXJhIHRvIGF2b2lkIG5lc3RlZCByZW5kZXIgY2FsbHMgcmVzZXR0aW5nIHZpZXdwb3J0IHRvIGl0IChlLmcgUmVmbGVjdG9yKS4KICAgIAkJCS8vIFRyYW5zbWlzc2lvbiByZW5kZXIgcGFzcyByZXF1aXJlcyB2aWV3cG9ydCB0byBtYXRjaCB0aGUgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LgogICAgCQkJY29uc3QgY3VycmVudENhbWVyYVZpZXdwb3J0ID0gY2FtZXJhLnZpZXdwb3J0OwogICAgCQkJaWYgKCBjYW1lcmEudmlld3BvcnQgIT09IHVuZGVmaW5lZCApIGNhbWVyYS52aWV3cG9ydCA9IHVuZGVmaW5lZDsKCiAgICAJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKTsKCiAgICAJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5zZXRHbG9iYWxTdGF0ZSggX3RoaXMuY2xpcHBpbmdQbGFuZXMsIGNhbWVyYSApOwoKICAgIAkJCXJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCiAgICAJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CiAgICAJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IGZhbHNlICkgeyAvLyBzZWUgIzI4MTMxCgogICAgCQkJCWxldCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCByZW5kZXJJdGVtID0gdHJhbnNtaXNzaXZlT2JqZWN0c1sgaSBdOwoKICAgIAkJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CiAgICAJCQkJCWNvbnN0IGdlb21ldHJ5ID0gcmVuZGVySXRlbS5nZW9tZXRyeTsKICAgIAkJCQkJY29uc3QgbWF0ZXJpYWwgPSByZW5kZXJJdGVtLm1hdGVyaWFsOwogICAgCQkJCQljb25zdCBncm91cCA9IHJlbmRlckl0ZW0uZ3JvdXA7CgogICAgCQkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgogICAgCQkJCQkJY29uc3QgY3VycmVudFNpZGUgPSBtYXRlcmlhbC5zaWRlOwoKICAgIAkJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKICAgIAkJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQkJCQlyZW5kZXJPYmplY3QoIG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKICAgIAkJCQkJCW1hdGVyaWFsLnNpZGUgPSBjdXJyZW50U2lkZTsKICAgIAkJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQkJCQlyZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKICAgIAkJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlfdGhpcy5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQsIGN1cnJlbnRBY3RpdmVDdWJlRmFjZSwgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsICk7CgogICAgCQkJX3RoaXMuc2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yLCBfY3VycmVudENsZWFyQWxwaGEgKTsKCiAgICAJCQlpZiAoIGN1cnJlbnRDYW1lcmFWaWV3cG9ydCAhPT0gdW5kZWZpbmVkICkgY2FtZXJhLnZpZXdwb3J0ID0gY3VycmVudENhbWVyYVZpZXdwb3J0OwoKICAgIAkJCV90aGlzLnRvbmVNYXBwaW5nID0gY3VycmVudFRvbmVNYXBwaW5nOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0cyggcmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApIHsKCiAgICAJCQljb25zdCBvdmVycmlkZU1hdGVyaWFsID0gc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSA/IHNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgOiBudWxsOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IHJlbmRlckxpc3QubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckxpc3RbIGkgXTsKCiAgICAJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CiAgICAJCQkJY29uc3QgZ2VvbWV0cnkgPSByZW5kZXJJdGVtLmdlb21ldHJ5OwogICAgCQkJCWNvbnN0IGdyb3VwID0gcmVuZGVySXRlbS5ncm91cDsKICAgIAkJCQlsZXQgbWF0ZXJpYWwgPSByZW5kZXJJdGVtLm1hdGVyaWFsOwoKICAgIAkJCQlpZiAoIG1hdGVyaWFsLmFsbG93T3ZlcnJpZGUgPT09IHRydWUgJiYgb3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCApIHsKCiAgICAJCQkJCW1hdGVyaWFsID0gb3ZlcnJpZGVNYXRlcmlhbDsKCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKICAgIAkJCQkJcmVuZGVyT2JqZWN0KCBvYmplY3QsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICkgewoKICAgIAkJCW9iamVjdC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCiAgICAJCQlvYmplY3QubW9kZWxWaWV3TWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIG9iamVjdC5tYXRyaXhXb3JsZCApOwogICAgCQkJb2JqZWN0Lm5vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIG9iamVjdC5tb2RlbFZpZXdNYXRyaXggKTsKCiAgICAJCQltYXRlcmlhbC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICk7CgogICAgCQkJaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlICYmIG1hdGVyaWFsLmZvcmNlU2luZ2xlUGFzcyA9PT0gZmFsc2UgKSB7CgogICAgCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKICAgIAkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCiAgICAJCQkJbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKICAgIAkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCiAgICAJCQkJbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCiAgICAJCQl9CgogICAgCQkJb2JqZWN0Lm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApIHsKCiAgICAJCQlpZiAoIHNjZW5lLmlzU2NlbmUgIT09IHRydWUgKSBzY2VuZSA9IF9lbXB0eVNjZW5lOyAvLyBzY2VuZSBjb3VsZCBiZSBhIE1lc2gsIExpbmUsIFBvaW50cywgLi4uCgogICAgCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgogICAgCQkJY29uc3QgbGlnaHRzID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLmxpZ2h0czsKICAgIAkJCWNvbnN0IHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgogICAgCQkJY29uc3QgbGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzLnN0YXRlLnZlcnNpb247CgogICAgCQkJY29uc3QgcGFyYW1ldGVycyA9IHByb2dyYW1DYWNoZS5nZXRQYXJhbWV0ZXJzKCBtYXRlcmlhbCwgbGlnaHRzLnN0YXRlLCBzaGFkb3dzQXJyYXksIHNjZW5lLCBvYmplY3QgKTsKICAgIAkJCWNvbnN0IHByb2dyYW1DYWNoZUtleSA9IHByb2dyYW1DYWNoZS5nZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKTsKCiAgICAJCQlsZXQgcHJvZ3JhbXMgPSBtYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbXM7CgogICAgCQkJLy8gYWx3YXlzIHVwZGF0ZSBlbnZpcm9ubWVudCBhbmQgZm9nIC0gY2hhbmdpbmcgdGhlc2UgdHJpZ2dlciBhbiBnZXRQcm9ncmFtIGNhbGwsIGJ1dCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHByb2dyYW0gZG9lc24ndCBjaGFuZ2UKCiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyA9IHNjZW5lLmZvZzsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBtYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgKTsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXBSb3RhdGlvbiA9ICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudmlyb25tZW50ICE9PSBudWxsICYmIG1hdGVyaWFsLmVudk1hcCA9PT0gbnVsbCApID8gc2NlbmUuZW52aXJvbm1lbnRSb3RhdGlvbiA6IG1hdGVyaWFsLmVudk1hcFJvdGF0aW9uOwoKICAgIAkJCWlmICggcHJvZ3JhbXMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJLy8gbmV3IG1hdGVyaWFsCgogICAgCQkJCW1hdGVyaWFsLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCiAgICAJCQkJcHJvZ3JhbXMgPSBuZXcgTWFwKCk7CiAgICAJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW1zID0gcHJvZ3JhbXM7CgogICAgCQkJfQoKICAgIAkJCWxldCBwcm9ncmFtID0gcHJvZ3JhbXMuZ2V0KCBwcm9ncmFtQ2FjaGVLZXkgKTsKCiAgICAJCQlpZiAoIHByb2dyYW0gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJLy8gZWFybHkgb3V0IGlmIHByb2dyYW0gYW5kIGxpZ2h0IHN0YXRlIGlzIGlkZW50aWNhbAoKICAgIAkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9PT0gcHJvZ3JhbSAmJiBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID09PSBsaWdodHNTdGF0ZVZlcnNpb24gKSB7CgogICAgCQkJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgogICAgCQkJCQlyZXR1cm4gcHJvZ3JhbTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXBhcmFtZXRlcnMudW5pZm9ybXMgPSBwcm9ncmFtQ2FjaGUuZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICk7CgogICAgCQkJCW1hdGVyaWFsLm9uQmVmb3JlQ29tcGlsZSggcGFyYW1ldGVycywgX3RoaXMgKTsKCiAgICAJCQkJcHJvZ3JhbSA9IHByb2dyYW1DYWNoZS5hY3F1aXJlUHJvZ3JhbSggcGFyYW1ldGVycywgcHJvZ3JhbUNhY2hlS2V5ICk7CiAgICAJCQkJcHJvZ3JhbXMuc2V0KCBwcm9ncmFtQ2FjaGVLZXksIHByb2dyYW0gKTsKCiAgICAJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zID0gcGFyYW1ldGVycy51bmlmb3JtczsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgogICAgCQkJaWYgKCAoICEgbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiAhIG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgKSB8fCBtYXRlcmlhbC5jbGlwcGluZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJdW5pZm9ybXMuY2xpcHBpbmdQbGFuZXMgPSBjbGlwcGluZy51bmlmb3JtOwoKICAgIAkJCX0KCiAgICAJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgogICAgCQkJLy8gc3RvcmUgdGhlIGxpZ2h0IHNldHVwIGl0IHdhcyBjcmVhdGVkIGZvcgoKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyA9IG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICk7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzU3RhdGVWZXJzaW9uOwoKICAgIAkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICkgewoKICAgIAkJCQkvLyB3aXJlIHVwIHRoZSBtYXRlcmlhbCB0byB0aGlzIHJlbmRlcmVyJ3MgbGlnaHRpbmcgc3RhdGUKCiAgICAJCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IudmFsdWUgPSBsaWdodHMuc3RhdGUuYW1iaWVudDsKICAgIAkJCQl1bmlmb3Jtcy5saWdodFByb2JlLnZhbHVlID0gbGlnaHRzLnN0YXRlLnByb2JlOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93OwogICAgCQkJCXVuaWZvcm1zLnNwb3RMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdDsKICAgIAkJCQl1bmlmb3Jtcy5zcG90TGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RTaGFkb3c7CiAgICAJCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWE7CiAgICAJCQkJdW5pZm9ybXMubHRjXzEudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWFMVEMxOwogICAgCQkJCXVuaWZvcm1zLmx0Y18yLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhTFRDMjsKICAgIAkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludDsKICAgIAkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvdzsKICAgIAkJCQl1bmlmb3Jtcy5oZW1pc3BoZXJlTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmhlbWk7CgogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWFwLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4OwogICAgCQkJCXVuaWZvcm1zLnNwb3RTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvd01hcDsKICAgIAkJCQl1bmlmb3Jtcy5zcG90TGlnaHRNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdExpZ2h0TWF0cml4OwogICAgCQkJCXVuaWZvcm1zLnNwb3RMaWdodE1hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90TGlnaHRNYXA7CiAgICAJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXA7CiAgICAJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXRyaXg7CiAgICAJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IGFkZCBhcmVhIGxpZ2h0cyBzaGFkb3cgaW5mbyB0byB1bmlmb3JtcwoKICAgIAkJCX0KCiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW0gPSBwcm9ncmFtOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9IG51bGw7CgogICAgCQkJcmV0dXJuIHByb2dyYW07CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICkgewoKICAgIAkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9PT0gbnVsbCApIHsKCiAgICAJCQkJY29uc3QgcHJvZ1VuaWZvcm1zID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtLmdldFVuaWZvcm1zKCk7CiAgICAJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9IFdlYkdMVW5pZm9ybXMuc2VxV2l0aFZhbHVlKCBwcm9nVW5pZm9ybXMuc2VxLCBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXMgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3Q7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiB1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICkgewoKICAgIAkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlID0gcGFyYW1ldGVycy5vdXRwdXRDb2xvclNwYWNlOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID0gcGFyYW1ldGVycy5iYXRjaGluZzsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZ0NvbG9yID0gcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmc7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ0NvbG9yID0gcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3I7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ01vcnBoID0gcGFyYW1ldGVycy5pbnN0YW5jaW5nTW9ycGg7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPSBwYXJhbWV0ZXJzLnNraW5uaW5nOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0cyA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoTm9ybWFscyA9IHBhcmFtZXRlcnMubW9ycGhOb3JtYWxzOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoQ29sb3JzID0gcGFyYW1ldGVycy5tb3JwaENvbG9yczsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQ7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgPSBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUludGVyc2VjdGlvbiA9IHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbjsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgPSBwYXJhbWV0ZXJzLnZlcnRleEFscGhhczsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyA9IHBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHM7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMudG9uZU1hcHBpbmcgPSBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gc2V0UHJvZ3JhbSggY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QgKSB7CgogICAgCQkJaWYgKCBzY2VuZS5pc1NjZW5lICE9PSB0cnVlICkgc2NlbmUgPSBfZW1wdHlTY2VuZTsgLy8gc2NlbmUgY291bGQgYmUgYSBNZXNoLCBMaW5lLCBQb2ludHMsIC4uLgoKICAgIAkJCXRleHR1cmVzLnJlc2V0VGV4dHVyZVVuaXRzKCk7CgogICAgCQkJY29uc3QgZm9nID0gc2NlbmUuZm9nOwogICAgCQkJY29uc3QgZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwogICAgCQkJY29uc3QgY29sb3JTcGFjZSA9ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgKSA/IF90aGlzLm91dHB1dENvbG9yU3BhY2UgOiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApOwogICAgCQkJY29uc3QgZW52TWFwID0gKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQgKTsKICAgIAkJCWNvbnN0IHZlcnRleEFscGhhcyA9IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQ7CiAgICAJCQljb25zdCB2ZXJ0ZXhUYW5nZW50cyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudGFuZ2VudCAmJiAoICEhIG1hdGVyaWFsLm5vcm1hbE1hcCB8fCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApOwogICAgCQkJY29uc3QgbW9ycGhUYXJnZXRzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgCQkJY29uc3QgbW9ycGhOb3JtYWxzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbDsKICAgIAkJCWNvbnN0IG1vcnBoQ29sb3JzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoKICAgIAkJCWxldCB0b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgogICAgCQkJaWYgKCBtYXRlcmlhbC50b25lTWFwcGVkICkgewoKICAgIAkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKSB7CgogICAgCQkJCQl0b25lTWFwcGluZyA9IF90aGlzLnRvbmVNYXBwaW5nOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwogICAgCQkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgogICAgCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CiAgICAJCQljb25zdCBsaWdodHMgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUubGlnaHRzOwoKICAgIAkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJaWYgKCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgfHwgY2FtZXJhICE9PSBfY3VycmVudENhbWVyYSApIHsKCiAgICAJCQkJCWNvbnN0IHVzZUNhY2hlID0KICAgIAkJCQkJCWNhbWVyYSA9PT0gX2N1cnJlbnRDYW1lcmEgJiYKICAgIAkJCQkJCW1hdGVyaWFsLmlkID09PSBfY3VycmVudE1hdGVyaWFsSWQ7CgogICAgCQkJCQkvLyB3ZSBtaWdodCB3YW50IHRvIGNhbGwgdGhpcyBmdW5jdGlvbiB3aXRoIHNvbWUgQ2xpcHBpbmdHcm91cAogICAgCQkJCQkvLyBvYmplY3QgaW5zdGVhZCBvZiB0aGUgbWF0ZXJpYWwsIG9uY2UgaXQgYmVjb21lcyBmZWFzaWJsZQogICAgCQkJCQkvLyAoIzg0NjUsICM4Mzc5KQogICAgCQkJCQljbGlwcGluZy5zZXRTdGF0ZSggbWF0ZXJpYWwsIGNhbWVyYSwgdXNlQ2FjaGUgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLwoKICAgIAkJCWxldCBuZWVkc1Byb2dyYW1DaGFuZ2UgPSBmYWxzZTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnZlcnNpb24gPT09IG1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gKSB7CgogICAgCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICYmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiAhPT0gbGlnaHRzLnN0YXRlLnZlcnNpb24gKSApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlICE9PSBjb2xvclNwYWNlICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID09PSBmYWxzZSApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoICEgb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID09PSB0cnVlICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nQ29sb3IgPT09IHRydWUgJiYgb2JqZWN0LmNvbG9yVGV4dHVyZSA9PT0gbnVsbCApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZ0NvbG9yID09PSBmYWxzZSAmJiBvYmplY3QuY29sb3JUZXh0dXJlICE9PSBudWxsICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gZmFsc2UgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCAhIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPT09IHRydWUgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IGZhbHNlICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IHRydWUgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IHRydWUgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgPT09IG51bGwgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IGZhbHNlICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ01vcnBoID09PSB0cnVlICYmIG9iamVjdC5tb3JwaFRleHR1cmUgPT09IG51bGwgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nTW9ycGggPT09IGZhbHNlICYmIG9iamVjdC5tb3JwaFRleHR1cmUgIT09IG51bGwgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMuZW52TWFwICE9PSBlbnZNYXAgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5mb2cgPT09IHRydWUgJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyAhPT0gZm9nICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUNsaXBwaW5nUGxhbmVzICE9PSB1bmRlZmluZWQgJiYKICAgIAkJCQkJKCBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IGNsaXBwaW5nLm51bVBsYW5lcyB8fAogICAgCQkJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtSW50ZXJzZWN0aW9uICE9PSBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24gKSApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgIT09IHZlcnRleEFscGhhcyApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyAhPT0gdmVydGV4VGFuZ2VudHMgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhUYXJnZXRzICE9PSBtb3JwaFRhcmdldHMgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzICE9PSBtb3JwaE5vcm1hbHMgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhDb2xvcnMgIT09IG1vcnBoQ29sb3JzICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnRvbmVNYXBwaW5nICE9PSB0b25lTWFwcGluZyApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCAhPT0gbW9ycGhUYXJnZXRzQ291bnQgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKICAgIAkJCQltYXRlcmlhbFByb3BlcnRpZXMuX192ZXJzaW9uID0gbWF0ZXJpYWwudmVyc2lvbjsKCiAgICAJCQl9CgogICAgCQkJLy8KCiAgICAJCQlsZXQgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCiAgICAJCQlpZiAoIG5lZWRzUHJvZ3JhbUNoYW5nZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJcHJvZ3JhbSA9IGdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgogICAgCQkJfQoKICAgIAkJCWxldCByZWZyZXNoUHJvZ3JhbSA9IGZhbHNlOwogICAgCQkJbGV0IHJlZnJlc2hNYXRlcmlhbCA9IGZhbHNlOwogICAgCQkJbGV0IHJlZnJlc2hMaWdodHMgPSBmYWxzZTsKCiAgICAJCQljb25zdCBwX3VuaWZvcm1zID0gcHJvZ3JhbS5nZXRVbmlmb3JtcygpLAogICAgCQkJCW1fdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgogICAgCQkJaWYgKCBzdGF0ZS51c2VQcm9ncmFtKCBwcm9ncmFtLnByb2dyYW0gKSApIHsKCiAgICAJCQkJcmVmcmVzaFByb2dyYW0gPSB0cnVlOwogICAgCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CiAgICAJCQkJcmVmcmVzaExpZ2h0cyA9IHRydWU7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuaWQgIT09IF9jdXJyZW50TWF0ZXJpYWxJZCApIHsKCiAgICAJCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gbWF0ZXJpYWwuaWQ7CgogICAgCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgogICAgCQkJfQoKICAgIAkJCWlmICggcmVmcmVzaFByb2dyYW0gfHwgX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCiAgICAJCQkJLy8gY29tbW9uIGNhbWVyYSB1bmlmb3JtcwoKICAgIAkJCQljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSBzdGF0ZS5idWZmZXJzLmRlcHRoLmdldFJldmVyc2VkKCk7CgogICAgCQkJCWlmICggcmV2ZXJzZURlcHRoQnVmZmVyICkgewoKICAgIAkJCQkJX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgogICAgCQkJCQl0b05vcm1hbGl6ZWRQcm9qZWN0aW9uTWF0cml4KCBfY3VycmVudFByb2plY3Rpb25NYXRyaXggKTsKICAgIAkJCQkJdG9SZXZlcnNlZFByb2plY3Rpb25NYXRyaXgoIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwoKICAgIAkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncHJvamVjdGlvbk1hdHJpeCcsIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncHJvamVjdGlvbk1hdHJpeCcsIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgogICAgCQkJCX0KCiAgICAJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAndmlld01hdHJpeCcsIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCiAgICAJCQkJY29uc3QgdUNhbVBvcyA9IHBfdW5pZm9ybXMubWFwLmNhbWVyYVBvc2l0aW9uOwoKICAgIAkJCQlpZiAoIHVDYW1Qb3MgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCXVDYW1Qb3Muc2V0VmFsdWUoIF9nbCwgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKSApOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggY2FwYWJpbGl0aWVzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgKSB7CgogICAgCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdsb2dEZXB0aEJ1ZkZDJywKICAgIAkJCQkJCTIuMCAvICggTWF0aC5sb2coIGNhbWVyYS5mYXIgKyAxLjAgKSAvIE1hdGguTE4yICkgKTsKCiAgICAJCQkJfQoKICAgIAkJCQkvLyBjb25zaWRlciBtb3ZpbmcgaXNPcnRob2dyYXBoaWMgdG8gVW5pZm9ybUxpYiBhbmQgV2ViR0xNYXRlcmlhbHMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjY0NjcjaXNzdWVjb21tZW50LTE2NDUxODUwNjcKCiAgICAJCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsIHx8CiAgICAJCQkJCW1hdGVyaWFsLmlzTWVzaFRvb25NYXRlcmlhbCB8fAogICAgCQkJCQltYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwKICAgIAkJCQkJbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCB8fAogICAgCQkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8CiAgICAJCQkJCW1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgogICAgCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdpc09ydGhvZ3JhcGhpYycsIGNhbWVyYS5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9PT0gdHJ1ZSApOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCiAgICAJCQkJCV9jdXJyZW50Q2FtZXJhID0gY2FtZXJhOwoKICAgIAkJCQkJLy8gbGlnaHRpbmcgdW5pZm9ybXMgZGVwZW5kIG9uIHRoZSBjYW1lcmEgc28gZW5mb3JjZSBhbiB1cGRhdGUKICAgIAkJCQkJLy8gbm93LCBpbiBjYXNlIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgbGlnaHRzIC0gb3IgbGF0ZXIsIHdoZW4KICAgIAkJCQkJLy8gdGhlIG5leHQgbWF0ZXJpYWwgdGhhdCBkb2VzIGdldHMgYWN0aXZhdGVkOgoKICAgIAkJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsJCS8vIHNldCB0byB0cnVlIG9uIG1hdGVyaWFsIGNoYW5nZQogICAgCQkJCQlyZWZyZXNoTGlnaHRzID0gdHJ1ZTsJCS8vIHJlbWFpbnMgc2V0IHVudGlsIHVwZGF0ZSBkb25lCgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJLy8gc2tpbm5pbmcgYW5kIG1vcnBoIHRhcmdldCB1bmlmb3JtcyBtdXN0IGJlIHNldCBldmVuIGlmIG1hdGVyaWFsIGRpZG4ndCBjaGFuZ2UKICAgIAkJCS8vIGF1dG8tc2V0dGluZyBvZiB0ZXh0dXJlIHVuaXQgZm9yIGJvbmUgYW5kIG1vcnBoIHRleHR1cmUgbXVzdCBnbyBiZWZvcmUgb3RoZXIgdGV4dHVyZXMKICAgIAkJCS8vIG90aGVyd2lzZSB0ZXh0dXJlcyB1c2VkIGZvciBza2lubmluZyBhbmQgbW9ycGhpbmcgY2FuIHRha2Ugb3ZlciB0ZXh0dXJlIHVuaXRzIHJlc2VydmVkIGZvciBvdGhlciBtYXRlcmlhbCB0ZXh0dXJlcwoKICAgIAkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgogICAgCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeCcgKTsKICAgIAkJCQlwX3VuaWZvcm1zLnNldE9wdGlvbmFsKCBfZ2wsIG9iamVjdCwgJ2JpbmRNYXRyaXhJbnZlcnNlJyApOwoKICAgIAkJCQljb25zdCBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCiAgICAJCQkJaWYgKCBza2VsZXRvbiApIHsKCiAgICAJCQkJCWlmICggc2tlbGV0b24uYm9uZVRleHR1cmUgPT09IG51bGwgKSBza2VsZXRvbi5jb21wdXRlQm9uZVRleHR1cmUoKTsKCiAgICAJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JvbmVUZXh0dXJlJywgc2tlbGV0b24uYm9uZVRleHR1cmUsIHRleHR1cmVzICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCBvYmplY3QuaXNCYXRjaGVkTWVzaCApIHsKCiAgICAJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ1RleHR1cmUnICk7CiAgICAJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdUZXh0dXJlJywgb2JqZWN0Ll9tYXRyaWNlc1RleHR1cmUsIHRleHR1cmVzICk7CgogICAgCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmF0Y2hpbmdJZFRleHR1cmUnICk7CiAgICAJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdJZFRleHR1cmUnLCBvYmplY3QuX2luZGlyZWN0VGV4dHVyZSwgdGV4dHVyZXMgKTsKCiAgICAJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ0NvbG9yVGV4dHVyZScgKTsKICAgIAkJCQlpZiAoIG9iamVjdC5fY29sb3JzVGV4dHVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JhdGNoaW5nQ29sb3JUZXh0dXJlJywgb2JqZWN0Ll9jb2xvcnNUZXh0dXJlLCB0ZXh0dXJlcyApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCiAgICAJCQlpZiAoIG1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkIHx8IG1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCB8fCAoIG1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgKSB7CgogICAgCQkJCW1vcnBodGFyZ2V0cy51cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCByZWZyZXNoTWF0ZXJpYWwgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgIT09IG9iamVjdC5yZWNlaXZlU2hhZG93ICkgewoKICAgIAkJCQltYXRlcmlhbFByb3BlcnRpZXMucmVjZWl2ZVNoYWRvdyA9IG9iamVjdC5yZWNlaXZlU2hhZG93OwogICAgCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3JlY2VpdmVTaGFkb3cnLCBvYmplY3QucmVjZWl2ZVNoYWRvdyApOwoKICAgIAkJCX0KCiAgICAJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjQ0NjcjaXNzdWVjb21tZW50LTEyMDkwMzE1MTIKCiAgICAJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaEdvdXJhdWRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgIT09IG51bGwgKSB7CgogICAgCQkJCW1fdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKICAgIAkJCQltX3VuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSAoIGVudk1hcC5pc0N1YmVUZXh0dXJlICYmIGVudk1hcC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgPT09IG51bGwgJiYgc2NlbmUuZW52aXJvbm1lbnQgIT09IG51bGwgKSB7CgogICAgCQkJCW1fdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuZW52aXJvbm1lbnRJbnRlbnNpdHk7CgogICAgCQkJfQoKICAgIAkJCWlmICggcmVmcmVzaE1hdGVyaWFsICkgewoKICAgIAkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICd0b25lTWFwcGluZ0V4cG9zdXJlJywgX3RoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSApOwoKICAgIAkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyApIHsKCiAgICAJCQkJCS8vIHRoZSBjdXJyZW50IG1hdGVyaWFsIHJlcXVpcmVzIGxpZ2h0aW5nIGluZm8KCiAgICAJCQkJCS8vIG5vdGU6IGFsbCBsaWdodGluZyB1bmlmb3JtcyBhcmUgYWx3YXlzIHNldCBjb3JyZWN0bHkKICAgIAkJCQkJLy8gdGhleSBzaW1wbHkgcmVmZXJlbmNlIHRoZSByZW5kZXJlcidzIHN0YXRlIGZvciB0aGVpcgogICAgCQkJCQkvLyB2YWx1ZXMKICAgIAkJCQkJLy8KICAgIAkJCQkJLy8gdXNlIHRoZSBjdXJyZW50IG1hdGVyaWFsJ3MgLm5lZWRzVXBkYXRlIGZsYWdzIHRvIHNldAogICAgCQkJCQkvLyB0aGUgR0wgc3RhdGUgd2hlbiByZXF1aXJlZAoKICAgIAkJCQkJbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUoIG1fdW5pZm9ybXMsIHJlZnJlc2hMaWdodHMgKTsKCiAgICAJCQkJfQoKICAgIAkJCQkvLyByZWZyZXNoIHVuaWZvcm1zIGNvbW1vbiB0byBzZXZlcmFsIG1hdGVyaWFscwoKICAgIAkJCQlpZiAoIGZvZyAmJiBtYXRlcmlhbC5mb2cgPT09IHRydWUgKSB7CgogICAgCQkJCQltYXRlcmlhbHMucmVmcmVzaEZvZ1VuaWZvcm1zKCBtX3VuaWZvcm1zLCBmb2cgKTsKCiAgICAJCQkJfQoKICAgIAkJCQltYXRlcmlhbHMucmVmcmVzaE1hdGVyaWFsVW5pZm9ybXMoIG1fdW5pZm9ybXMsIG1hdGVyaWFsLCBfcGl4ZWxSYXRpbywgX2hlaWdodCwgY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gKTsKCiAgICAJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgZ2V0VW5pZm9ybUxpc3QoIG1hdGVyaWFsUHJvcGVydGllcyApLCBtX3VuaWZvcm1zLCB0ZXh0dXJlcyApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID09PSB0cnVlICkgewoKICAgIAkJCQlXZWJHTFVuaWZvcm1zLnVwbG9hZCggX2dsLCBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICksIG1fdW5pZm9ybXMsIHRleHR1cmVzICk7CiAgICAJCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNTcHJpdGVNYXRlcmlhbCApIHsKCiAgICAJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnY2VudGVyJywgb2JqZWN0LmNlbnRlciApOwoKICAgIAkJCX0KCiAgICAJCQkvLyBjb21tb24gbWF0cmljZXMKCiAgICAJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbFZpZXdNYXRyaXgnLCBvYmplY3QubW9kZWxWaWV3TWF0cml4ICk7CiAgICAJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdub3JtYWxNYXRyaXgnLCBvYmplY3Qubm9ybWFsTWF0cml4ICk7CiAgICAJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbE1hdHJpeCcsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKICAgIAkJCS8vIFVCT3MKCiAgICAJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCiAgICAJCQkJY29uc3QgZ3JvdXBzID0gbWF0ZXJpYWwudW5pZm9ybXNHcm91cHM7CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCiAgICAJCQkJCXVuaWZvcm1zR3JvdXBzLnVwZGF0ZSggZ3JvdXAsIHByb2dyYW0gKTsKICAgIAkJCQkJdW5pZm9ybXNHcm91cHMuYmluZCggZ3JvdXAsIHByb2dyYW0gKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gcHJvZ3JhbTsKCiAgICAJCX0KCiAgICAJCS8vIElmIHVuaWZvcm1zIGFyZSBtYXJrZWQgYXMgY2xlYW4sIHRoZXkgZG9uJ3QgbmVlZCB0byBiZSBsb2FkZWQgdG8gdGhlIEdQVS4KCiAgICAJCWZ1bmN0aW9uIG1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKCB1bmlmb3JtcywgdmFsdWUgKSB7CgogICAgCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgIAkJCXVuaWZvcm1zLmxpZ2h0UHJvYmUubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCiAgICAJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodFNoYWRvd3MubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgIAkJCXVuaWZvcm1zLnBvaW50TGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMuc3BvdExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMuc3BvdExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgIAkJCXVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICkgewoKICAgIAkJCXJldHVybiBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKICAgIAkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgfHwKICAgIAkJCQkoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwubGlnaHRzID09PSB0cnVlICk7CgogICAgCQl9CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgYWN0aXZlIGN1YmUgZmFjZS4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgYWN0aXZlIGN1YmUgZmFjZS4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0QWN0aXZlQ3ViZUZhY2UgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIF9jdXJyZW50QWN0aXZlQ3ViZUZhY2U7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGFjdGl2ZSBtaXBtYXAgbGV2ZWwuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFjdGl2ZSBtaXBtYXAgbGV2ZWwuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldEFjdGl2ZU1pcG1hcExldmVsID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBhY3RpdmUgcmVuZGVyIHRhcmdldC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7P1dlYkdMUmVuZGVyVGFyZ2V0fSBUaGUgYWN0aXZlIHJlbmRlciB0YXJnZXQuIFJldHVybnMgYG51bGxgIGlmIG5vIHJlbmRlciB0YXJnZXQKICAgIAkJICogaXMgY3VycmVudGx5IHNldC4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBfY3VycmVudFJlbmRlclRhcmdldDsKCiAgICAJCX07CgogICAgCQl0aGlzLnNldFJlbmRlclRhcmdldFRleHR1cmVzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGNvbG9yVGV4dHVyZSwgZGVwdGhUZXh0dXJlICkgewoKICAgIAkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2F1dG9BbGxvY2F0ZURlcHRoQnVmZmVyID0gcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2U7CiAgICAJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgKSB7CgogICAgCQkJCS8vIFRoZSBtdWx0aXNhbXBsZV9yZW5kZXJfdG9fdGV4dHVyZSBleHRlbnNpb24gZG9lc24ndCB3b3JrIHByb3Blcmx5IGlmIHRoZXJlCiAgICAJCQkJLy8gYXJlIG1pZGZyYW1lIGZsdXNoZXMgYW5kIGFuIGV4dGVybmFsIGRlcHRoIGJ1ZmZlci4gRGlzYWJsZSB1c2Ugb2YgdGhlIGV4dGVuc2lvbi4KICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlUmVuZGVyVG9UZXh0dXJlID0gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJCXByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlID0gY29sb3JUZXh0dXJlOwogICAgCQkJcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA/IHVuZGVmaW5lZCA6IGRlcHRoVGV4dHVyZTsKCiAgICAJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faGFzRXh0ZXJuYWxUZXh0dXJlcyA9IHRydWU7CgogICAgCQl9OwoKICAgIAkJdGhpcy5zZXRSZW5kZXJUYXJnZXRGcmFtZWJ1ZmZlciA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBkZWZhdWx0RnJhbWVidWZmZXIgKSB7CgogICAgCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKICAgIAkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gZGVmYXVsdEZyYW1lYnVmZmVyOwogICAgCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciA9IGRlZmF1bHRGcmFtZWJ1ZmZlciA9PT0gdW5kZWZpbmVkOwoKICAgIAkJfTsKCiAgICAJCWNvbnN0IF9zY3JhdGNoRnJhbWVCdWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSBhY3RpdmUgcmVuZGVydGFyZ2V0LgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0gez9XZWJHTFJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG8gc2V0LiBXaGVuIGBudWxsYCBpcyBnaXZlbiwKICAgIAkJICogdGhlIGNhbnZhcyBpcyBzZXQgYXMgdGhlIGFjdGl2ZSByZW5kZXIgdGFyZ2V0IGluc3RlYWQuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWN0aXZlQ3ViZUZhY2U9MF0gLSBUaGUgYWN0aXZlIGN1YmUgZmFjZSB3aGVuIHVzaW5nIGEgY3ViZSByZW5kZXIgdGFyZ2V0LgogICAgCQkgKiBJbmRpY2F0ZXMgdGhlIHogbGF5ZXIgdG8gcmVuZGVyIGluIHRvIHdoZW4gdXNpbmcgM0Qgb3IgYXJyYXkgcmVuZGVyIHRhcmdldHMuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWN0aXZlTWlwbWFwTGV2ZWw9MF0gLSBUaGUgYWN0aXZlIG1pcG1hcCBsZXZlbC4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGFjdGl2ZUN1YmVGYWNlID0gMCwgYWN0aXZlTWlwbWFwTGV2ZWwgPSAwICkgewoKICAgIAkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwogICAgCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IGFjdGl2ZUN1YmVGYWNlOwogICAgCQkJX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IGFjdGl2ZU1pcG1hcExldmVsOwoKICAgIAkJCWxldCB1c2VEZWZhdWx0RnJhbWVidWZmZXIgPSB0cnVlOwogICAgCQkJbGV0IGZyYW1lYnVmZmVyID0gbnVsbDsKICAgIAkJCWxldCBpc0N1YmUgPSBmYWxzZTsKICAgIAkJCWxldCBpc1JlbmRlclRhcmdldDNEID0gZmFsc2U7CgogICAgCQkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJLy8gV2UgbmVlZCB0byBtYWtlIHN1cmUgdG8gcmViaW5kIHRoZSBmcmFtZWJ1ZmZlci4KICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKICAgIAkJCQkJdXNlRGVmYXVsdEZyYW1lYnVmZmVyID0gZmFsc2U7CgogICAgCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQl0ZXh0dXJlcy5zZXR1cFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKICAgIAkJCQkJLy8gQ29sb3IgYW5kIGRlcHRoIHRleHR1cmUgbXVzdCBiZSByZWJvdW5kIGluIG9yZGVyIGZvciB0aGUgc3dhcGNoYWluIHRvIHVwZGF0ZS4KICAgIAkJCQkJdGV4dHVyZXMucmViaW5kVGV4dHVyZXMoIHJlbmRlclRhcmdldCwgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkuX193ZWJnbFRleHR1cmUgKTsKCiAgICAJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKICAgIAkJCQkJLy8gY2hlY2sgaWYgdGhlIGRlcHRoIHRleHR1cmUgaXMgYWxyZWFkeSBib3VuZCB0byB0aGUgZnJhbWUgYnVmZmVyIGFuZCB0aGF0IGl0J3MgYmVlbiBpbml0aWFsaXplZAogICAgCQkJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwogICAgCQkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19ib3VuZERlcHRoVGV4dHVyZSAhPT0gZGVwdGhUZXh0dXJlICkgewoKICAgIAkJCQkJCS8vIGNoZWNrIGlmIHRoZSBkZXB0aCB0ZXh0dXJlIGlzIGNvbXBhdGlibGUKICAgIAkJCQkJCWlmICgKICAgIAkJCQkJCQlkZXB0aFRleHR1cmUgIT09IG51bGwgJiYKICAgIAkJCQkJCQlwcm9wZXJ0aWVzLmhhcyggZGVwdGhUZXh0dXJlICkgJiYKICAgIAkJCQkJCQkoIHJlbmRlclRhcmdldC53aWR0aCAhPT0gZGVwdGhUZXh0dXJlLmltYWdlLndpZHRoIHx8IHJlbmRlclRhcmdldC5oZWlnaHQgIT09IGRlcHRoVGV4dHVyZS5pbWFnZS5oZWlnaHQgKQogICAgCQkJCQkJKSB7CgogICAgCQkJCQkJCXRocm93IG5ldyBFcnJvciggJ1dlYkdMUmVuZGVyVGFyZ2V0OiBBdHRhY2hlZCBEZXB0aFRleHR1cmUgaXMgaW5pdGlhbGl6ZWQgdG8gdGhlIGluY29ycmVjdCBzaXplLicgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJLy8gU3dhcCB0aGUgZGVwdGggYnVmZmVyIHRvIHRoZSBjdXJyZW50bHkgYXR0YWNoZWQgb25lCiAgICAJCQkJCQl0ZXh0dXJlcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgogICAgCQkJCWlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgfHwgdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgogICAgCQkJCQlpc1JlbmRlclRhcmdldDNEID0gdHJ1ZTsKCiAgICAJCQkJfQoKICAgIAkJCQljb25zdCBfX3dlYmdsRnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKICAgIAkJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApIHsKCiAgICAJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdICkgKSB7CgogICAgCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF1bIGFjdGl2ZU1pcG1hcExldmVsIF07CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaXNDdWJlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggKCByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB0ZXh0dXJlcy51c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCiAgICAJCQkJCWZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlcjsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgogICAgCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZU1pcG1hcExldmVsIF07CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCV9jdXJyZW50Vmlld3BvcnQuY29weSggcmVuZGVyVGFyZ2V0LnZpZXdwb3J0ICk7CiAgICAJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIHJlbmRlclRhcmdldC5zY2lzc29yICk7CiAgICAJCQkJX2N1cnJlbnRTY2lzc29yVGVzdCA9IHJlbmRlclRhcmdldC5zY2lzc29yVGVzdDsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLmZsb29yKCk7CiAgICAJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKICAgIAkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gX3NjaXNzb3JUZXN0OwoKICAgIAkJCX0KCiAgICAJCQkvLyBVc2UgYSBzY3JhdGNoIGZyYW1lIGJ1ZmZlciBpZiByZW5kZXJpbmcgdG8gYSBtaXAgbGV2ZWwgdG8gYXZvaWQgZGVwdGggYnVmZmVycwogICAgCQkJLy8gYmVpbmcgYm91bmQgdGhhdCBhcmUgZGlmZmVyZW50IHNpemVzLgogICAgCQkJaWYgKCBhY3RpdmVNaXBtYXBMZXZlbCAhPT0gMCApIHsKCiAgICAJCQkJZnJhbWVidWZmZXIgPSBfc2NyYXRjaEZyYW1lQnVmZmVyOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCBmcmFtZWJ1ZmZlckJvdW5kID0gc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgogICAgCQkJaWYgKCBmcmFtZWJ1ZmZlckJvdW5kICYmIHVzZURlZmF1bHRGcmFtZWJ1ZmZlciApIHsKCiAgICAJCQkJc3RhdGUuZHJhd0J1ZmZlcnMoIHJlbmRlclRhcmdldCwgZnJhbWVidWZmZXIgKTsKCiAgICAJCQl9CgogICAgCQkJc3RhdGUudmlld3BvcnQoIF9jdXJyZW50Vmlld3BvcnQgKTsKICAgIAkJCXN0YXRlLnNjaXNzb3IoIF9jdXJyZW50U2Npc3NvciApOwogICAgCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9jdXJyZW50U2Npc3NvclRlc3QgKTsKCiAgICAJCQlpZiAoIGlzQ3ViZSApIHsKCiAgICAJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKICAgIAkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgYWN0aXZlQ3ViZUZhY2UsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBhY3RpdmVNaXBtYXBMZXZlbCApOwoKICAgIAkJCX0gZWxzZSBpZiAoIGlzUmVuZGVyVGFyZ2V0M0QgKSB7CgogICAgCQkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CiAgICAJCQkJY29uc3QgbGF5ZXIgPSBhY3RpdmVDdWJlRmFjZTsKICAgIAkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgYWN0aXZlTWlwbWFwTGV2ZWwsIGxheWVyICk7CgogICAgCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0ICE9PSBudWxsICYmIGFjdGl2ZU1pcG1hcExldmVsICE9PSAwICkgewoKICAgIAkJCQkvLyBPbmx5IGJpbmQgdGhlIGZyYW1lIGJ1ZmZlciBpZiB3ZSBhcmUgdXNpbmcgYSBzY3JhdGNoIGZyYW1lIGJ1ZmZlciB0byByZW5kZXIgdG8gYSBtaXBtYXAuCiAgICAJCQkJLy8gSWYgd2UgcmViaW5kIHRoZSB0ZXh0dXJlIHdoZW4gdXNpbmcgYSBtdWx0aSBzYW1wbGUgYnVmZmVyIHRoZW4gYW4gZXJyb3IgYWJvdXQgaW5jb25zaXN0ZW50IHNhbXBsZXMgd2lsbCBiZSB0aHJvd24uCiAgICAJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKICAgIAkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcG1hcExldmVsICk7CgogICAgCQkJfQoKICAgIAkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0xOyAvLyByZXNldCBjdXJyZW50IG1hdGVyaWFsIHRvIGVuc3VyZSBjb3JyZWN0IHVuaWZvcm0gYmluZGluZ3MKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmVhZHMgdGhlIHBpeGVsIGRhdGEgZnJvbSB0aGUgZ2l2ZW4gcmVuZGVyIHRhcmdldCBpbnRvIHRoZSBnaXZlbiBidWZmZXIuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHJlYWQgZnJvbS4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYHhgIGNvb3JkaW5hdGUgb2YgdGhlIGNvcHkgcmVnaW9uJ3Mgb3JpZ2luLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBgeWAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgY29weSByZWdpb24uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjb3B5IHJlZ2lvbi4KICAgIAkJICogQHBhcmFtIHtUeXBlZEFycmF5fSBidWZmZXIgLSBUaGUgcmVzdWx0IGJ1ZmZlci4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZUluZGV4XSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIGluZGV4LgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gW3RleHR1cmVJbmRleD0wXSAtIFRoZSB0ZXh0dXJlIGluZGV4IG9mIGFuIE1SVCByZW5kZXIgdGFyZ2V0LgogICAgCQkgKi8KICAgIAkJdGhpcy5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGJ1ZmZlciwgYWN0aXZlQ3ViZUZhY2VJbmRleCwgdGV4dHVyZUluZGV4ID0gMCApIHsKCiAgICAJCQlpZiAoICEgKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXQgKSApIHsKCiAgICAJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CiAgICAJCQkJcmV0dXJuOwoKICAgIAkJCX0KCiAgICAJCQlsZXQgZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKICAgIAkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICYmIGFjdGl2ZUN1YmVGYWNlSW5kZXggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJZnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2VJbmRleCBdOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGZyYW1lYnVmZmVyICkgewoKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCiAgICAJCQkJdHJ5IHsKCiAgICAJCQkJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZXNbIHRleHR1cmVJbmRleCBdOwogICAgCQkJCQljb25zdCB0ZXh0dXJlRm9ybWF0ID0gdGV4dHVyZS5mb3JtYXQ7CiAgICAJCQkJCWNvbnN0IHRleHR1cmVUeXBlID0gdGV4dHVyZS50eXBlOwoKICAgIAkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSApIHsKCiAgICAJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IGluIFJHQkEgb3IgaW1wbGVtZW50YXRpb24gZGVmaW5lZCBmb3JtYXQuJyApOwogICAgCQkJCQkJcmV0dXJuOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlVHlwZVJlYWRhYmxlKCB0ZXh0dXJlVHlwZSApICkgewoKICAgIAkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwogICAgCQkJCQkJcmV0dXJuOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQoKICAgIAkJCQkJaWYgKCAoIHggPj0gMCAmJiB4IDw9ICggcmVuZGVyVGFyZ2V0LndpZHRoIC0gd2lkdGggKSApICYmICggeSA+PSAwICYmIHkgPD0gKCByZW5kZXJUYXJnZXQuaGVpZ2h0IC0gaGVpZ2h0ICkgKSApIHsKCiAgICAJCQkJCQkvLyB3aGVuIHVzaW5nIE1SVCwgc2VsZWN0IHRoZSBjb3JyZWN0IGNvbG9yIGJ1ZmZlciBmb3IgdGhlIHN1YnNlcXVlbnQgcmVhZCBjb21tYW5kCgogICAgCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQudGV4dHVyZXMubGVuZ3RoID4gMSApIF9nbC5yZWFkQnVmZmVyKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyB0ZXh0dXJlSW5kZXggKTsKCiAgICAJCQkJCQlfZ2wucmVhZFBpeGVscyggeCwgeSwgd2lkdGgsIGhlaWdodCwgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApLCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApLCBidWZmZXIgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBmaW5hbGx5IHsKCiAgICAJCQkJCS8vIHJlc3RvcmUgZnJhbWVidWZmZXIgb2YgY3VycmVudCByZW5kZXIgdGFyZ2V0IGlmIG5lY2Vzc2FyeQoKICAgIAkJCQkJY29uc3QgZnJhbWVidWZmZXIgPSAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgPyBwcm9wZXJ0aWVzLmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgOiBudWxsOwogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQXN5bmNocm9ub3VzLCBub24tYmxvY2tpbmcgdmVyc2lvbiBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNyZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzfS4KICAgIAkJICoKICAgIAkJICogSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoaXMgdmVyc2lvbiBvZiBgcmVhZFJlbmRlclRhcmdldFBpeGVscygpYCB3aGVuZXZlciBwb3NzaWJsZS4KICAgIAkJICoKICAgIAkJICogQGFzeW5jCiAgICAJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHJlYWQgZnJvbS4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYHhgIGNvb3JkaW5hdGUgb2YgdGhlIGNvcHkgcmVnaW9uJ3Mgb3JpZ2luLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBgeWAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgY29weSByZWdpb24uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjb3B5IHJlZ2lvbi4KICAgIAkJICogQHBhcmFtIHtUeXBlZEFycmF5fSBidWZmZXIgLSBUaGUgcmVzdWx0IGJ1ZmZlci4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZUluZGV4XSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIGluZGV4LgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gW3RleHR1cmVJbmRleD0wXSAtIFRoZSB0ZXh0dXJlIGluZGV4IG9mIGFuIE1SVCByZW5kZXIgdGFyZ2V0LgogICAgCQkgKiBAcmV0dXJuIHtQcm9taXNlPFR5cGVkQXJyYXk+fSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSByZWFkIGhhcyBiZWVuIGZpbmlzaGVkLiBUaGUgcmVzb2x2ZSBwcm92aWRlcyB0aGUgcmVhZCBkYXRhIGFzIGEgdHlwZWQgYXJyYXkuCiAgICAJCSAqLwogICAgCQl0aGlzLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHNBc3luYyA9IGFzeW5jIGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBidWZmZXIsIGFjdGl2ZUN1YmVGYWNlSW5kZXgsIHRleHR1cmVJbmRleCA9IDAgKSB7CgogICAgCQkJaWYgKCAhICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0ICkgKSB7CgogICAgCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CgogICAgCQkJfQoKICAgIAkJCWxldCBmcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CiAgICAJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCAmJiBhY3RpdmVDdWJlRmFjZUluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlSW5kZXggXTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBmcmFtZWJ1ZmZlciApIHsKCiAgICAJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQogICAgCQkJCWlmICggKCB4ID49IDAgJiYgeCA8PSAoIHJlbmRlclRhcmdldC53aWR0aCAtIHdpZHRoICkgKSAmJiAoIHkgPj0gMCAmJiB5IDw9ICggcmVuZGVyVGFyZ2V0LmhlaWdodCAtIGhlaWdodCApICkgKSB7CgogICAgCQkJCQkvLyBzZXQgdGhlIGFjdGl2ZSBmcmFtZSBidWZmZXIgdG8gdGhlIG9uZSB3ZSB3YW50IHRvIHJlYWQKICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgogICAgCQkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzWyB0ZXh0dXJlSW5kZXggXTsKICAgIAkJCQkJY29uc3QgdGV4dHVyZUZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwogICAgCQkJCQljb25zdCB0ZXh0dXJlVHlwZSA9IHRleHR1cmUudHlwZTsKCiAgICAJCQkJCWlmICggISBjYXBhYmlsaXRpZXMudGV4dHVyZUZvcm1hdFJlYWRhYmxlKCB0ZXh0dXJlRm9ybWF0ICkgKSB7CgogICAgCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gUkdCQSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIGZvcm1hdC4nICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoICEgY2FwYWJpbGl0aWVzLnRleHR1cmVUeXBlUmVhZGFibGUoIHRleHR1cmVUeXBlICkgKSB7CgogICAgCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJY29uc3QgZ2xCdWZmZXIgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAJCQkJCV9nbC5iaW5kQnVmZmVyKCBfZ2wuUElYRUxfUEFDS19CVUZGRVIsIGdsQnVmZmVyICk7CiAgICAJCQkJCV9nbC5idWZmZXJEYXRhKCBfZ2wuUElYRUxfUEFDS19CVUZGRVIsIGJ1ZmZlci5ieXRlTGVuZ3RoLCBfZ2wuU1RSRUFNX1JFQUQgKTsKCiAgICAJCQkJCS8vIHdoZW4gdXNpbmcgTVJULCBzZWxlY3QgdGhlIGNvcmVjdCBjb2xvciBidWZmZXIgZm9yIHRoZSBzdWJzZXF1ZW50IHJlYWQgY29tbWFuZAoKICAgIAkJCQkJaWYgKCByZW5kZXJUYXJnZXQudGV4dHVyZXMubGVuZ3RoID4gMSApIF9nbC5yZWFkQnVmZmVyKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyB0ZXh0dXJlSW5kZXggKTsKCiAgICAJCQkJCV9nbC5yZWFkUGl4ZWxzKCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICksIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICksIDAgKTsKCiAgICAJCQkJCS8vIHJlc2V0IHRoZSBmcmFtZSBidWZmZXIgdG8gdGhlIGN1cnJlbnRseSBzZXQgYnVmZmVyIGJlZm9yZSB3YWl0aW5nCiAgICAJCQkJCWNvbnN0IGN1cnJGcmFtZWJ1ZmZlciA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsID8gcHJvcGVydGllcy5nZXQoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyIDogbnVsbDsKICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGN1cnJGcmFtZWJ1ZmZlciApOwoKICAgIAkJCQkJLy8gY2hlY2sgaWYgdGhlIGNvbW1hbmRzIGhhdmUgZmluaXNoZWQgZXZlcnkgOCBtcwogICAgCQkJCQljb25zdCBzeW5jID0gX2dsLmZlbmNlU3luYyggX2dsLlNZTkNfR1BVX0NPTU1BTkRTX0NPTVBMRVRFLCAwICk7CgogICAgCQkJCQlfZ2wuZmx1c2goKTsKCiAgICAJCQkJCWF3YWl0IHByb2JlQXN5bmMoIF9nbCwgc3luYywgNCApOwoKICAgIAkJCQkJLy8gcmVhZCB0aGUgZGF0YSBhbmQgZGVsZXRlIHRoZSBidWZmZXIKICAgIAkJCQkJX2dsLmJpbmRCdWZmZXIoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgZ2xCdWZmZXIgKTsKICAgIAkJCQkJX2dsLmdldEJ1ZmZlclN1YkRhdGEoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgMCwgYnVmZmVyICk7CiAgICAJCQkJCV9nbC5kZWxldGVCdWZmZXIoIGdsQnVmZmVyICk7CiAgICAJCQkJCV9nbC5kZWxldGVTeW5jKCBzeW5jICk7CgogICAgCQkJCQlyZXR1cm4gYnVmZmVyOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlcXVlc3RlZCByZWFkIGJvdW5kcyBhcmUgb3V0IG9mIHJhbmdlLicgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQ29waWVzIHBpeGVscyBmcm9tIHRoZSBjdXJyZW50IGJvdW5kIGZyYW1lYnVmZmVyIGludG8gdGhlIGdpdmVuIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7RnJhbWVidWZmZXJUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIHRleHR1cmUuCiAgICAJCSAqIEBwYXJhbSB7P1ZlY3RvcjJ9IFtwb3NpdGlvbj1udWxsXSAtIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgY29weSBvcGVyYXRpb24uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbGV2ZWw9MF0gLSBUaGUgbWlwIGxldmVsLiBUaGUgZGVmYXVsdCByZXByZXNlbnRzIHRoZSBiYXNlIG1pcC4KICAgIAkJICovCiAgICAJCXRoaXMuY29weUZyYW1lYnVmZmVyVG9UZXh0dXJlID0gZnVuY3Rpb24gKCB0ZXh0dXJlLCBwb3NpdGlvbiA9IG51bGwsIGxldmVsID0gMCApIHsKCiAgICAJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gbGV2ZWwgKTsKICAgIAkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggdGV4dHVyZS5pbWFnZS53aWR0aCAqIGxldmVsU2NhbGUgKTsKICAgIAkJCWNvbnN0IGhlaWdodCA9IE1hdGguZmxvb3IoIHRleHR1cmUuaW1hZ2UuaGVpZ2h0ICogbGV2ZWxTY2FsZSApOwoKICAgIAkJCWNvbnN0IHggPSBwb3NpdGlvbiAhPT0gbnVsbCA/IHBvc2l0aW9uLnggOiAwOwogICAgCQkJY29uc3QgeSA9IHBvc2l0aW9uICE9PSBudWxsID8gcG9zaXRpb24ueSA6IDA7CgogICAgCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgogICAgCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWwsIDAsIDAsIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgogICAgCQl9OwoKICAgIAkJY29uc3QgX3NyY0ZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CiAgICAJCWNvbnN0IF9kc3RGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIENvcGllcyBkYXRhIG9mIHRoZSBnaXZlbiBzb3VyY2UgdGV4dHVyZSBpbnRvIGEgZGVzdGluYXRpb24gdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogV2hlbiB1c2luZyByZW5kZXIgdGFyZ2V0IHRleHR1cmVzIGFzIGBzcmNUZXh0dXJlYCBhbmQgYGRzdFRleHR1cmVgLCB5b3UgbXVzdCBtYWtlIHN1cmUgYm90aCByZW5kZXIgdGFyZ2V0cyBhcmUgaW5pdGlhbGl6ZWQKICAgIAkJICoge0BsaW5rIFdlYkdMUmVuZGVyZXIjaW5pdFJlbmRlclRhcmdldH0uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7VGV4dHVyZX0gc3JjVGV4dHVyZSAtIFRoZSBzb3VyY2UgdGV4dHVyZS4KICAgIAkJICogQHBhcmFtIHtUZXh0dXJlfSBkc3RUZXh0dXJlIC0gVGhlIGRlc3RpbmF0aW9uIHRleHR1cmUuCiAgICAJCSAqIEBwYXJhbSB7PyhCb3gyfEJveDMpfSBbc3JjUmVnaW9uPW51bGxdIC0gQSBib3VuZGluZyBib3ggd2hpY2ggZGVzY3JpYmVzIHRoZSBzb3VyY2UgcmVnaW9uLiBDYW4gYmUgdHdvIG9yIHRocmVlLWRpbWVuc2lvbmFsLgogICAgCQkgKiBAcGFyYW0gez8oVmVjdG9yMnxWZWN0b3IzKX0gW2RzdFBvc2l0aW9uPW51bGxdIC0gQSB2ZWN0b3IgdGhhdCByZXByZXNlbnRzIHRoZSBvcmlnaW4gb2YgdGhlIGRlc3RpbmF0aW9uIHJlZ2lvbi4gQ2FuIGJlIHR3byBvciB0aHJlZS1kaW1lbnNpb25hbC4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IFtzcmNMZXZlbD0wXSAtIFRoZSBzb3VyY2UgbWlwbWFwIGxldmVsIHRvIGNvcHkuCiAgICAJCSAqIEBwYXJhbSB7P251bWJlcn0gW2RzdExldmVsPW51bGxdIC0gVGhlIGRlc3RpbmF0aW9uIG1pcG1hcCBsZXZlbC4KICAgIAkJICovCiAgICAJCXRoaXMuY29weVRleHR1cmVUb1RleHR1cmUgPSBmdW5jdGlvbiAoIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIHNyY1JlZ2lvbiA9IG51bGwsIGRzdFBvc2l0aW9uID0gbnVsbCwgc3JjTGV2ZWwgPSAwLCBkc3RMZXZlbCA9IG51bGwgKSB7CgogICAgCQkJLy8gc3VwcG9ydCB0aGUgcHJldmlvdXMgc2lnbmF0dXJlIHdpdGgganVzdCBhIHNpbmdsZSBkc3QgbWlwbWFwIGxldmVsCiAgICAJCQlpZiAoIGRzdExldmVsID09PSBudWxsICkgewoKICAgIAkJCQlpZiAoIHNyY0xldmVsICE9PSAwICkgewoKICAgIAkJCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNzEKICAgIAkJCQkJd2Fybk9uY2UoICdXZWJHTFJlbmRlcmVyOiBjb3B5VGV4dHVyZVRvVGV4dHVyZSBmdW5jdGlvbiBzaWduYXR1cmUgaGFzIGNoYW5nZWQgdG8gc3VwcG9ydCBzcmMgYW5kIGRzdCBtaXBtYXAgbGV2ZWxzLicgKTsKICAgIAkJCQkJZHN0TGV2ZWwgPSBzcmNMZXZlbDsKICAgIAkJCQkJc3JjTGV2ZWwgPSAwOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJZHN0TGV2ZWwgPSAwOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIGdhdGhlciB0aGUgbmVjZXNzYXJ5IGRpbWVuc2lvbnMgdG8gY29weQogICAgCQkJbGV0IHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBtaW5YLCBtaW5ZLCBtaW5aOwogICAgCQkJbGV0IGRzdFgsIGRzdFksIGRzdFo7CiAgICAJCQljb25zdCBpbWFnZSA9IHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSA/IHNyY1RleHR1cmUubWlwbWFwc1sgZHN0TGV2ZWwgXSA6IHNyY1RleHR1cmUuaW1hZ2U7CiAgICAJCQlpZiAoIHNyY1JlZ2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQkJd2lkdGggPSBzcmNSZWdpb24ubWF4LnggLSBzcmNSZWdpb24ubWluLng7CiAgICAJCQkJaGVpZ2h0ID0gc3JjUmVnaW9uLm1heC55IC0gc3JjUmVnaW9uLm1pbi55OwogICAgCQkJCWRlcHRoID0gc3JjUmVnaW9uLmlzQm94MyA/IHNyY1JlZ2lvbi5tYXgueiAtIHNyY1JlZ2lvbi5taW4ueiA6IDE7CiAgICAJCQkJbWluWCA9IHNyY1JlZ2lvbi5taW4ueDsKICAgIAkJCQltaW5ZID0gc3JjUmVnaW9uLm1pbi55OwogICAgCQkJCW1pblogPSBzcmNSZWdpb24uaXNCb3gzID8gc3JjUmVnaW9uLm1pbi56IDogMDsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gc3JjTGV2ZWwgKTsKICAgIAkJCQl3aWR0aCA9IE1hdGguZmxvb3IoIGltYWdlLndpZHRoICogbGV2ZWxTY2FsZSApOwogICAgCQkJCWhlaWdodCA9IE1hdGguZmxvb3IoIGltYWdlLmhlaWdodCAqIGxldmVsU2NhbGUgKTsKICAgIAkJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlICkgewoKICAgIAkJCQkJZGVwdGggPSBpbWFnZS5kZXB0aDsKCiAgICAJCQkJfSBlbHNlIGlmICggc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgogICAgCQkJCQlkZXB0aCA9IE1hdGguZmxvb3IoIGltYWdlLmRlcHRoICogbGV2ZWxTY2FsZSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJZGVwdGggPSAxOwoKICAgIAkJCQl9CgogICAgCQkJCW1pblggPSAwOwogICAgCQkJCW1pblkgPSAwOwogICAgCQkJCW1pblogPSAwOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGRzdFBvc2l0aW9uICE9PSBudWxsICkgewoKICAgIAkJCQlkc3RYID0gZHN0UG9zaXRpb24ueDsKICAgIAkJCQlkc3RZID0gZHN0UG9zaXRpb24ueTsKICAgIAkJCQlkc3RaID0gZHN0UG9zaXRpb24uejsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlkc3RYID0gMDsKICAgIAkJCQlkc3RZID0gMDsKICAgIAkJCQlkc3RaID0gMDsKCiAgICAJCQl9CgogICAgCQkJLy8gU2V0IHVwIHRoZSBkZXN0aW5hdGlvbiB0YXJnZXQKICAgIAkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS5mb3JtYXQgKTsKICAgIAkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIGRzdFRleHR1cmUudHlwZSApOwogICAgCQkJbGV0IGdsVGFyZ2V0OwoKICAgIAkJCWlmICggZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgogICAgCQkJCXRleHR1cmVzLnNldFRleHR1cmUzRCggZHN0VGV4dHVyZSwgMCApOwogICAgCQkJCWdsVGFyZ2V0ID0gX2dsLlRFWFRVUkVfM0Q7CgogICAgCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgZHN0VGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgogICAgCQkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCBkc3RUZXh0dXJlLCAwICk7CiAgICAJCQkJZ2xUYXJnZXQgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIGRzdFRleHR1cmUsIDAgKTsKICAgIAkJCQlnbFRhcmdldCA9IF9nbC5URVhUVVJFXzJEOwoKICAgIAkJCX0KCiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBkc3RUZXh0dXJlLmZsaXBZICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGRzdFRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgZHN0VGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCiAgICAJCQkvLyB1c2VkIGZvciBjb3B5aW5nIGRhdGEgZnJvbSBjcHUKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tSb3dMZW4gPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEggKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tJbWFnZUhlaWdodCA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfSU1BR0VfSEVJR0hUICk7CiAgICAJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CiAgICAJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcEltYWdlcyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMgKTsKCiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgaW1hZ2Uud2lkdGggKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQsIGltYWdlLmhlaWdodCApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCBtaW5YICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTLCBtaW5ZICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIG1pblogKTsKCiAgICAJCQkvLyBzZXQgdXAgdGhlIHNyYyB0ZXh0dXJlCiAgICAJCQljb25zdCBpc1NyYzNEID0gc3JjVGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmU7CiAgICAJCQljb25zdCBpc0RzdDNEID0gZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmU7CiAgICAJCQlpZiAoIHNyY1RleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgogICAgCQkJCWNvbnN0IHNyY1RleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHNyY1RleHR1cmUgKTsKICAgIAkJCQljb25zdCBkc3RUZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBkc3RUZXh0dXJlICk7CiAgICAJCQkJY29uc3Qgc3JjUmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlUHJvcGVydGllcy5fX3JlbmRlclRhcmdldCApOwogICAgCQkJCWNvbnN0IGRzdFJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZVByb3BlcnRpZXMuX19yZW5kZXJUYXJnZXQgKTsKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBzcmNSZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIGRzdFJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgogICAgCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRlcHRoOyBpICsrICkgewoKICAgIAkJCQkJLy8gaWYgdGhlIHNvdXJjZSBvciBkZXN0aW5hdGlvbiBhcmUgYSAzZCB0YXJnZXQgdGhlbiBhIGxheWVyIG5lZWRzIHRvIGJlIGJvdW5kCiAgICAJCQkJCWlmICggaXNTcmMzRCApIHsKCiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIHNyY0xldmVsLCBtaW5aICsgaSApOwogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlLCBkc3RMZXZlbCwgZHN0WiArIGkgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCV9nbC5ibGl0RnJhbWVidWZmZXIoIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIF9nbC5ERVBUSF9CVUZGRVJfQklULCBfZ2wuTkVBUkVTVCApOwoKICAgIAkJCQl9CgogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwgKTsKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgogICAgCQkJfSBlbHNlIGlmICggc3JjTGV2ZWwgIT09IDAgfHwgc3JjVGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgfHwgcHJvcGVydGllcy5oYXMoIHNyY1RleHR1cmUgKSApIHsKCiAgICAJCQkJLy8gZ2V0IHRoZSBhcHByb3ByaWF0ZSBmcmFtZSBidWZmZXJzCiAgICAJCQkJY29uc3Qgc3JjVGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc3JjVGV4dHVyZSApOwogICAgCQkJCWNvbnN0IGRzdFRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGRzdFRleHR1cmUgKTsKCiAgICAJCQkJLy8gYmluZCB0aGUgZnJhbWUgYnVmZmVyIHRhcmdldHMKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfc3JjRnJhbWVidWZmZXIgKTsKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZHN0RnJhbWVidWZmZXIgKTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGVwdGg7IGkgKysgKSB7CgogICAgCQkJCQkvLyBhc3NpZ24gdGhlIGNvcnJlY3QgbGF5ZXJzIGFuZCBtaXAgbWFwcyB0byB0aGUgZnJhbWUgYnVmZmVycwogICAgCQkJCQlpZiAoIGlzU3JjM0QgKSB7CgogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBzcmNUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgc3JjTGV2ZWwsIG1pblogKyBpICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLlJFQURfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHNyY1RleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBzcmNMZXZlbCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBpc0RzdDNEICkgewoKICAgIAkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmVMYXllciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZHN0VGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGRzdExldmVsLCBkc3RaICsgaSApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFXzJELCBkc3RUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgZHN0TGV2ZWwgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCS8vIGNvcHkgdGhlIGRhdGEgdXNpbmcgdGhlIGZhc3Rlc3QgZnVuY3Rpb24gdGhhdCBjYW4gYWNoaWV2ZSB0aGUgY29weQogICAgCQkJCQlpZiAoIHNyY0xldmVsICE9PSAwICkgewoKICAgIAkJCQkJCV9nbC5ibGl0RnJhbWVidWZmZXIoIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIF9nbC5DT0xPUl9CVUZGRVJfQklULCBfZ2wuTkVBUkVTVCApOwoKICAgIAkJCQkJfSBlbHNlIGlmICggaXNEc3QzRCApIHsKCiAgICAJCQkJCQlfZ2wuY29weVRleFN1YkltYWdlM0QoIGdsVGFyZ2V0LCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgZHN0WiArIGksIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCQkvLyB1bmJpbmQgcmVhZCwgZHJhdyBidWZmZXJzCiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlpZiAoIGlzRHN0M0QgKSB7CgogICAgCQkJCQkvLyBjb3B5IGRhdGEgaW50byB0aGUgM2QgdGV4dHVyZQogICAgCQkJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhVGV4dHVyZSB8fCBzcmNUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCiAgICAJCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgogICAgCQkJCQkJX2dsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIGRzdFosIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBnbEZvcm1hdCwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCS8vIGNvcHkgZGF0YSBpbnRvIHRoZSAyZCB0ZXh0dXJlCiAgICAJCQkJCWlmICggc3JjVGV4dHVyZS5pc0RhdGFUZXh0dXJlICkgewoKICAgIAkJCQkJCV9nbC50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCiAgICAJCQkJCX0gZWxzZSBpZiAoIHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCiAgICAJCQkJCQlfZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgZ2xGb3JtYXQsIGltYWdlLmRhdGEgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJX2dsLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLyByZXNldCB2YWx1ZXMKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19ST1dfTEVOR1RILCBjdXJyZW50VW5wYWNrUm93TGVuICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfSU1BR0VfSEVJR0hULCBjdXJyZW50VW5wYWNrSW1hZ2VIZWlnaHQgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgY3VycmVudFVucGFja1NraXBQaXhlbHMgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIGN1cnJlbnRVbnBhY2tTa2lwUm93cyApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfSU1BR0VTLCBjdXJyZW50VW5wYWNrU2tpcEltYWdlcyApOwoKICAgIAkJCS8vIEdlbmVyYXRlIG1pcG1hcHMgb25seSB3aGVuIGNvcHlpbmcgbGV2ZWwgMAogICAgCQkJaWYgKCBkc3RMZXZlbCA9PT0gMCAmJiBkc3RUZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyApIHsKCiAgICAJCQkJX2dsLmdlbmVyYXRlTWlwbWFwKCBnbFRhcmdldCApOwoKICAgIAkJCX0KCiAgICAJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgogICAgCQl9OwoKICAgIAkJdGhpcy5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEID0gZnVuY3Rpb24gKCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBzcmNSZWdpb24gPSBudWxsLCBkc3RQb3NpdGlvbiA9IG51bGwsIGxldmVsID0gMCApIHsKCiAgICAJCQkvLyBAZGVwcmVjYXRlZCwgcjE3MAogICAgCQkJd2Fybk9uY2UoICdXZWJHTFJlbmRlcmVyOiBjb3B5VGV4dHVyZVRvVGV4dHVyZTNEIGZ1bmN0aW9uIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAiY29weVRleHR1cmVUb1RleHR1cmUiIGluc3RlYWQuJyApOwoKICAgIAkJCXJldHVybiB0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlKCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBzcmNSZWdpb24sIGRzdFBvc2l0aW9uLCBsZXZlbCApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBJbml0aWFsaXplcyB0aGUgZ2l2ZW4gV2ViR0xSZW5kZXJUYXJnZXQgbWVtb3J5LiBVc2VmdWwgZm9yIGluaXRpYWxpemluZyBhIHJlbmRlciB0YXJnZXQgc28gZGF0YQogICAgCQkgKiBjYW4gYmUgY29waWVkIGludG8gaXQgdXNpbmcge0BsaW5rIFdlYkdMUmVuZGVyZXIjY29weVRleHR1cmVUb1RleHR1cmV9IGJlZm9yZSBpdCBoYXMgYmVlbgogICAgCQkgKiByZW5kZXJlZCB0by4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtXZWJHTFJlbmRlclRhcmdldH0gdGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqLwogICAgCQl0aGlzLmluaXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCiAgICAJCQlpZiAoIHByb3BlcnRpZXMuZ2V0KCB0YXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0dXBSZW5kZXJUYXJnZXQoIHRhcmdldCApOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogSW5pdGlhbGl6ZXMgdGhlIGdpdmVuIHRleHR1cmUuIFVzZWZ1bCBmb3IgcHJlbG9hZGluZyBhIHRleHR1cmUgcmF0aGVyIHRoYW4gd2FpdGluZyB1bnRpbCBmaXJzdAogICAgCQkgKiByZW5kZXIgKHdoaWNoIGNhbiBjYXVzZSBub3RpY2VhYmxlIGxhZ3MgZHVlIHRvIGRlY29kZSBhbmQgR1BVIHVwbG9hZCBvdmVyaGVhZCkuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7VGV4dHVyZX0gdGV4dHVyZSAtIFRoZSB0ZXh0dXJlLgogICAgCQkgKi8KICAgIAkJdGhpcy5pbml0VGV4dHVyZSA9IGZ1bmN0aW9uICggdGV4dHVyZSApIHsKCiAgICAJCQlpZiAoIHRleHR1cmUuaXNDdWJlVGV4dHVyZSApIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIDAgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB0ZXh0dXJlLCAwICk7CgogICAgCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgogICAgCQkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB0ZXh0dXJlLCAwICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgogICAgCQkJfQoKICAgIAkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQ2FuIGJlIHVzZWQgdG8gcmVzZXQgdGhlIGludGVybmFsIFdlYkdMIHN0YXRlLiBUaGlzIG1ldGhvZCBpcyBtb3N0bHkKICAgIAkJICogcmVsZXZhbnQgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBzaGFyZSBhIHNpbmdsZSBXZWJHTCBjb250ZXh0IGFjcm9zcwogICAgCQkgKiBtdWx0aXBsZSBXZWJHTCBsaWJyYXJpZXMuCiAgICAJCSAqLwogICAgCQl0aGlzLnJlc2V0U3RhdGUgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IDA7CiAgICAJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKICAgIAkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCiAgICAJCQlzdGF0ZS5yZXNldCgpOwogICAgCQkJYmluZGluZ1N0YXRlcy5yZXNldCgpOwoKICAgIAkJfTsKCiAgICAJCWlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgogICAgCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEZWZpbmVzIHRoZSBjb29yZGluYXRlIHN5c3RlbSBvZiB0aGUgcmVuZGVyZXIuCiAgICAJICoKICAgIAkgKiBJbiBgV2ViR0xSZW5kZXJlcmAsIHRoZSB2YWx1ZSBpcyBhbHdheXMgYFdlYkdMQ29vcmRpbmF0ZVN5c3RlbWAuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7V2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW19CiAgICAJICogQGRlZmF1bHQgV2ViR0xDb29yZGluYXRlU3lzdGVtCiAgICAJICogQHJlYWRvbmx5CiAgICAJICovCiAgICAJZ2V0IGNvb3JkaW5hdGVTeXN0ZW0oKSB7CgogICAgCQlyZXR1cm4gV2ViR0xDb29yZGluYXRlU3lzdGVtOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERlZmluZXMgdGhlIG91dHB1dCBjb2xvciBzcGFjZSBvZiB0aGUgcmVuZGVyZXIuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7U1JHQkNvbG9yU3BhY2V8TGluZWFyU1JHQkNvbG9yU3BhY2V9CiAgICAJICogQGRlZmF1bHQgU1JHQkNvbG9yU3BhY2UKICAgIAkgKi8KICAgIAlnZXQgb3V0cHV0Q29sb3JTcGFjZSgpIHsKCiAgICAJCXJldHVybiB0aGlzLl9vdXRwdXRDb2xvclNwYWNlOwoKICAgIAl9CgogICAgCXNldCBvdXRwdXRDb2xvclNwYWNlKCBjb2xvclNwYWNlICkgewoKICAgIAkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgogICAgCQljb25zdCBnbCA9IHRoaXMuZ2V0Q29udGV4dCgpOwogICAgCQlnbC5kcmF3aW5nQnVmZmVyQ29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC5fZ2V0RHJhd2luZ0J1ZmZlckNvbG9yU3BhY2UoIGNvbG9yU3BhY2UgKTsKICAgIAkJZ2wudW5wYWNrQ29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC5fZ2V0VW5wYWNrQ29sb3JTcGFjZSgpOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSB1dGlsaXR5IGNsYXNzIGZvciBjcmVhdGluZyBhIGJ1dHRvbiB0aGF0IGFsbG93cyB0byBpbml0aWF0ZQogICAgICogaW1tZXJzaXZlIFZSIHNlc3Npb25zIGJhc2VkIG9uIFdlYlhSLiBUaGUgYnV0dG9uIGNhbiBiZSBjcmVhdGVkCiAgICAgKiB3aXRoIGEgZmFjdG9yeSBtZXRob2QgYW5kIHRoZW4gYXBwZW5kZWQgb3QgdGhlIHdlYnNpdGUncyBET00uCiAgICAgKgogICAgICogYGBganMKICAgICAqIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIFZSQnV0dG9uLmNyZWF0ZUJ1dHRvbiggcmVuZGVyZXIgKSApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGhpZGVjb25zdHJ1Y3RvcgogICAgICogQHRocmVlX2ltcG9ydCBpbXBvcnQgeyBWUkJ1dHRvbiB9IGZyb20gJ3RocmVlL2FkZG9ucy93ZWJ4ci9WUkJ1dHRvbi5qcyc7CiAgICAgKi8KICAgIGNsYXNzIFZSQnV0dG9uIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBWUiBidXR0b24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ8V2ViR1BVUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7WFJTZXNzaW9uSW5pdH0gW3Nlc3Npb25Jbml0XSAtIFRoZSBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciB0aGUgQVIgc2Vzc2lvbi4KICAgIAkgKiBAcmV0dXJuIHtIVE1MRWxlbWVudH0gVGhlIGJ1dHRvbiBvciBhbiBlcnJvciBtZXNzYWdlIGlmIGBpbW1lcnNpdmUtYXJgIGlzbid0IHN1cHBvcnRlZC4KICAgIAkgKi8KICAgIAlzdGF0aWMgY3JlYXRlQnV0dG9uKCByZW5kZXJlciwgc2Vzc2lvbkluaXQgPSB7fSApIHsKCiAgICAJCWNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdidXR0b24nICk7CgogICAgCQlmdW5jdGlvbiBzaG93RW50ZXJWUiggLypkZXZpY2UqLyApIHsKCiAgICAJCQlsZXQgY3VycmVudFNlc3Npb24gPSBudWxsOwoKICAgIAkJCWFzeW5jIGZ1bmN0aW9uIG9uU2Vzc2lvblN0YXJ0ZWQoIHNlc3Npb24gKSB7CgogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZGVkICk7CgogICAgCQkJCWF3YWl0IHJlbmRlcmVyLnhyLnNldFNlc3Npb24oIHNlc3Npb24gKTsKICAgIAkJCQlidXR0b24udGV4dENvbnRlbnQgPSAnRVhJVCBWUic7CgogICAgCQkJCWN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvbjsKCiAgICAJCQl9CgogICAgCQkJZnVuY3Rpb24gb25TZXNzaW9uRW5kZWQoIC8qZXZlbnQqLyApIHsKCiAgICAJCQkJY3VycmVudFNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZGVkICk7CgogICAgCQkJCWJ1dHRvbi50ZXh0Q29udGVudCA9ICdFTlRFUiBWUic7CgogICAgCQkJCWN1cnJlbnRTZXNzaW9uID0gbnVsbDsKCiAgICAJCQl9CgogICAgCQkJLy8KCiAgICAJCQlidXR0b24uc3R5bGUuZGlzcGxheSA9ICcnOwoKICAgIAkJCWJ1dHRvbi5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAJCQlidXR0b24uc3R5bGUubGVmdCA9ICdjYWxjKDUwJSAtIDUwcHgpJzsKICAgIAkJCWJ1dHRvbi5zdHlsZS53aWR0aCA9ICcxMDBweCc7CgogICAgCQkJYnV0dG9uLnRleHRDb250ZW50ID0gJ0VOVEVSIFZSJzsKCiAgICAJCQkvLyBXZWJYUidzIHJlcXVlc3RSZWZlcmVuY2VTcGFjZSBvbmx5IHdvcmtzIGlmIHRoZSBjb3JyZXNwb25kaW5nIGZlYXR1cmUKICAgIAkJCS8vIHdhcyByZXF1ZXN0ZWQgYXQgc2Vzc2lvbiBjcmVhdGlvbiB0aW1lLiBGb3Igc2ltcGxpY2l0eSwganVzdCBhc2sgZm9yCiAgICAJCQkvLyB0aGUgaW50ZXJlc3Rpbmcgb25lcyBhcyBvcHRpb25hbCBmZWF0dXJlcywgYnV0IGJlIGF3YXJlIHRoYXQgdGhlCiAgICAJCQkvLyByZXF1ZXN0UmVmZXJlbmNlU3BhY2UgY2FsbCB3aWxsIGZhaWwgaWYgaXQgdHVybnMgb3V0IHRvIGJlIHVuYXZhaWxhYmxlLgogICAgCQkJLy8gKCdsb2NhbCcgaXMgYWx3YXlzIGF2YWlsYWJsZSBmb3IgaW1tZXJzaXZlIHNlc3Npb25zIGFuZCBkb2Vzbid0IG5lZWQgdG8KICAgIAkJCS8vIGJlIHJlcXVlc3RlZCBzZXBhcmF0ZWx5LikKCiAgICAJCQljb25zdCBzZXNzaW9uT3B0aW9ucyA9IHsKICAgIAkJCQkuLi5zZXNzaW9uSW5pdCwKICAgIAkJCQlvcHRpb25hbEZlYXR1cmVzOiBbCiAgICAJCQkJCSdsb2NhbC1mbG9vcicsCiAgICAJCQkJCSdib3VuZGVkLWZsb29yJywKICAgIAkJCQkJJ2xheWVycycsCiAgICAJCQkJCS4uLiggc2Vzc2lvbkluaXQub3B0aW9uYWxGZWF0dXJlcyB8fCBbXSApCiAgICAJCQkJXSwKICAgIAkJCX07CgogICAgCQkJYnV0dG9uLm9ubW91c2VlbnRlciA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJYnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMS4wJzsKCiAgICAJCQl9OwoKICAgIAkJCWJ1dHRvbi5vbm1vdXNlbGVhdmUgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJCWJ1dHRvbi5zdHlsZS5vcGFjaXR5ID0gJzAuNSc7CgogICAgCQkJfTsKCiAgICAJCQlidXR0b24ub25jbGljayA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50U2Vzc2lvbiA9PT0gbnVsbCApIHsKCiAgICAJCQkJCW5hdmlnYXRvci54ci5yZXF1ZXN0U2Vzc2lvbiggJ2ltbWVyc2l2ZS12cicsIHNlc3Npb25PcHRpb25zICkudGhlbiggb25TZXNzaW9uU3RhcnRlZCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJY3VycmVudFNlc3Npb24uZW5kKCk7CgogICAgCQkJCQlpZiAoIG5hdmlnYXRvci54ci5vZmZlclNlc3Npb24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCQluYXZpZ2F0b3IueHIub2ZmZXJTZXNzaW9uKCAnaW1tZXJzaXZlLXZyJywgc2Vzc2lvbk9wdGlvbnMgKQogICAgCQkJCQkJCS50aGVuKCBvblNlc3Npb25TdGFydGVkICkKICAgIAkJCQkJCQkuY2F0Y2goICggZXJyICkgPT4gewoKICAgIAkJCQkJCQkJY29uc29sZS53YXJuKCBlcnIgKTsKCiAgICAJCQkJCQkJfSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfTsKCiAgICAJCQlpZiAoIG5hdmlnYXRvci54ci5vZmZlclNlc3Npb24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJbmF2aWdhdG9yLnhyLm9mZmVyU2Vzc2lvbiggJ2ltbWVyc2l2ZS12cicsIHNlc3Npb25PcHRpb25zICkKICAgIAkJCQkJLnRoZW4oIG9uU2Vzc2lvblN0YXJ0ZWQgKQogICAgCQkJCQkuY2F0Y2goICggZXJyICkgPT4gewoKICAgIAkJCQkJCWNvbnNvbGUud2FybiggZXJyICk7CgogICAgCQkJCQl9ICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gZGlzYWJsZUJ1dHRvbigpIHsKCiAgICAJCQlidXR0b24uc3R5bGUuZGlzcGxheSA9ICcnOwoKICAgIAkJCWJ1dHRvbi5zdHlsZS5jdXJzb3IgPSAnYXV0byc7CiAgICAJCQlidXR0b24uc3R5bGUubGVmdCA9ICdjYWxjKDUwJSAtIDc1cHgpJzsKICAgIAkJCWJ1dHRvbi5zdHlsZS53aWR0aCA9ICcxNTBweCc7CgogICAgCQkJYnV0dG9uLm9ubW91c2VlbnRlciA9IG51bGw7CiAgICAJCQlidXR0b24ub25tb3VzZWxlYXZlID0gbnVsbDsKCiAgICAJCQlidXR0b24ub25jbGljayA9IG51bGw7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBzaG93V2ViWFJOb3RGb3VuZCgpIHsKCiAgICAJCQlkaXNhYmxlQnV0dG9uKCk7CgogICAgCQkJYnV0dG9uLnRleHRDb250ZW50ID0gJ1ZSIE5PVCBTVVBQT1JURUQnOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gc2hvd1ZSTm90QWxsb3dlZCggZXhjZXB0aW9uICkgewoKICAgIAkJCWRpc2FibGVCdXR0b24oKTsKCiAgICAJCQljb25zb2xlLndhcm4oICdFeGNlcHRpb24gd2hlbiB0cnlpbmcgdG8gY2FsbCB4ci5pc1Nlc3Npb25TdXBwb3J0ZWQnLCBleGNlcHRpb24gKTsKCiAgICAJCQlidXR0b24udGV4dENvbnRlbnQgPSAnVlIgTk9UIEFMTE9XRUQnOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gc3R5bGl6ZUVsZW1lbnQoIGVsZW1lbnQgKSB7CgogICAgCQkJZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAJCQllbGVtZW50LnN0eWxlLmJvdHRvbSA9ICcyMHB4JzsKICAgIAkJCWVsZW1lbnQuc3R5bGUucGFkZGluZyA9ICcxMnB4IDZweCc7CiAgICAJCQllbGVtZW50LnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgI2ZmZic7CiAgICAJCQllbGVtZW50LnN0eWxlLmJvcmRlclJhZGl1cyA9ICc0cHgnOwogICAgCQkJZWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kID0gJ3JnYmEoMCwwLDAsMC4xKSc7CiAgICAJCQllbGVtZW50LnN0eWxlLmNvbG9yID0gJyNmZmYnOwogICAgCQkJZWxlbWVudC5zdHlsZS5mb250ID0gJ25vcm1hbCAxM3B4IHNhbnMtc2VyaWYnOwogICAgCQkJZWxlbWVudC5zdHlsZS50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgIAkJCWVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICcwLjUnOwogICAgCQkJZWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ25vbmUnOwogICAgCQkJZWxlbWVudC5zdHlsZS56SW5kZXggPSAnOTk5JzsKCiAgICAJCX0KCiAgICAJCWlmICggJ3hyJyBpbiBuYXZpZ2F0b3IgKSB7CgogICAgCQkJYnV0dG9uLmlkID0gJ1ZSQnV0dG9uJzsKICAgIAkJCWJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKICAgIAkJCXN0eWxpemVFbGVtZW50KCBidXR0b24gKTsKCiAgICAJCQluYXZpZ2F0b3IueHIuaXNTZXNzaW9uU3VwcG9ydGVkKCAnaW1tZXJzaXZlLXZyJyApLnRoZW4oIGZ1bmN0aW9uICggc3VwcG9ydGVkICkgewoKICAgIAkJCQlzdXBwb3J0ZWQgPyBzaG93RW50ZXJWUigpIDogc2hvd1dlYlhSTm90Rm91bmQoKTsKCiAgICAJCQkJaWYgKCBzdXBwb3J0ZWQgJiYgVlJCdXR0b24ueHJTZXNzaW9uSXNHcmFudGVkICkgewoKICAgIAkJCQkJYnV0dG9uLmNsaWNrKCk7CgogICAgCQkJCX0KCiAgICAJCQl9ICkuY2F0Y2goIHNob3dWUk5vdEFsbG93ZWQgKTsKCiAgICAJCQlyZXR1cm4gYnV0dG9uOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zdCBtZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2EnICk7CgogICAgCQkJaWYgKCB3aW5kb3cuaXNTZWN1cmVDb250ZXh0ID09PSBmYWxzZSApIHsKCiAgICAJCQkJbWVzc2FnZS5ocmVmID0gZG9jdW1lbnQubG9jYXRpb24uaHJlZi5yZXBsYWNlKCAvXmh0dHA6LywgJ2h0dHBzOicgKTsKICAgIAkJCQltZXNzYWdlLmlubmVySFRNTCA9ICdXRUJYUiBORUVEUyBIVFRQUyc7IC8vIFRPRE8gSW1wcm92ZSBtZXNzYWdlCgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJbWVzc2FnZS5ocmVmID0gJ2h0dHBzOi8vaW1tZXJzaXZld2ViLmRldi8nOwogICAgCQkJCW1lc3NhZ2UuaW5uZXJIVE1MID0gJ1dFQlhSIE5PVCBBVkFJTEFCTEUnOwoKICAgIAkJCX0KCiAgICAJCQltZXNzYWdlLnN0eWxlLmxlZnQgPSAnY2FsYyg1MCUgLSA5MHB4KSc7CiAgICAJCQltZXNzYWdlLnN0eWxlLndpZHRoID0gJzE4MHB4JzsKICAgIAkJCW1lc3NhZ2Uuc3R5bGUudGV4dERlY29yYXRpb24gPSAnbm9uZSc7CgogICAgCQkJc3R5bGl6ZUVsZW1lbnQoIG1lc3NhZ2UgKTsKCiAgICAJCQlyZXR1cm4gbWVzc2FnZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZWdpc3RlcnMgYSBgc2Vzc2lvbmdyYW50ZWRgIGV2ZW50IGxpc3RlbmVyLiBXaGVuIGEgc2Vzc2lvbiBpcyBncmFudGVkLCB0aGUge0BsaW5rIFZSQnV0dG9uI3hyU2Vzc2lvbklzR3JhbnRlZH0KICAgIAkgKiBmbGFnIHdpbGwgZXZhbHVhdGUgdG8gYHRydWVgLiBUaGlzIG1ldGhvZCBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCBieSB0aGUgbW9kdWxlIGl0c2VsZiBzbyB0aGVyZQogICAgCSAqIHNob3VsZCBiZSBubyBuZWVkIHRvIHVzZSBpdCBvbiBhcHAgbGV2ZWwuCiAgICAJICovCiAgICAJc3RhdGljIHJlZ2lzdGVyU2Vzc2lvbkdyYW50ZWRMaXN0ZW5lcigpIHsKCiAgICAJCWlmICggdHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgJ3hyJyBpbiBuYXZpZ2F0b3IgKSB7CgogICAgCQkJLy8gV2ViWFJWaWV3ZXIgKGJhc2VkIG9uIEZpcmVmb3gpIGhhcyBhIGJ1ZyB3aGVyZSBhZGRFdmVudExpc3RlbmVyCiAgICAJCQkvLyB0aHJvd3MgYSBzaWxlbnQgZXhjZXB0aW9uIGFuZCBhYm9ydHMgZXhlY3V0aW9uIGVudGlyZWx5LgogICAgCQkJaWYgKCAvV2ViWFJWaWV3ZXJcLy9pLnRlc3QoIG5hdmlnYXRvci51c2VyQWdlbnQgKSApIHJldHVybjsKCiAgICAJCQluYXZpZ2F0b3IueHIuYWRkRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25ncmFudGVkJywgKCkgPT4gewoKICAgIAkJCQlWUkJ1dHRvbi54clNlc3Npb25Jc0dyYW50ZWQgPSB0cnVlOwoKICAgIAkJCX0gKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgYSBYUiBzZXNzaW9uIGhhcyBiZWVuIGdyYW50ZWQgb3Igbm90LgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwogICAgVlJCdXR0b24ueHJTZXNzaW9uSXNHcmFudGVkID0gZmFsc2U7CiAgICBWUkJ1dHRvbi5yZWdpc3RlclNlc3Npb25HcmFudGVkTGlzdGVuZXIoKTsKCiAgICAvKioKICAgICAqIEBsaWNlbnNlCiAgICAgKiB3ZWJ4ci1wb2x5ZmlsbAogICAgICogQ29weXJpZ2h0IChjKSAyMDE3IEdvb2dsZQogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICAgICAqCiAgICAgKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAqCiAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAqLwoKICAgIC8qKgogICAgICogQGxpY2Vuc2UKICAgICAqIGNhcmRib2FyZC12ci1kaXNwbGF5CiAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKICAgICAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwogICAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogICAgICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgKgogICAgICogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgICAgKgogICAgICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQogICAgICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICAgICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogICAgICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBsaWNlbnNlCiAgICAgKiB3ZWJ2ci1wb2x5ZmlsbC1kcGRiIAogICAgICogQ29weXJpZ2h0IChjKSAyMDE3IEdvb2dsZQogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICAgICAqCiAgICAgKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAqCiAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAqLwoKICAgIC8qKgogICAgICogQGxpY2Vuc2UKICAgICAqIHdnbHUtcHJlc2VydmUtc3RhdGUKICAgICAqIENvcHlyaWdodCAoYykgMjAxNiwgQnJhbmRvbiBKb25lcy4KICAgICAqCiAgICAgKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5CiAgICAgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAogICAgICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwogICAgICogdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogICAgICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiAgICAgKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgogICAgICoKICAgICAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCiAgICAgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KICAgICAqCiAgICAgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgogICAgICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCiAgICAgKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICAgICAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKICAgICAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCiAgICAgKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOCiAgICAgKiBUSEUgU09GVFdBUkUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBsaWNlbnNlCiAgICAgKiBub3NsZWVwLmpzCiAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTcsIFJpY2ggVGliYmV0dAogICAgICoKICAgICAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICAgICAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAgICAgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAgICAgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAgICAgKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICAgICAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiAgICAgKgogICAgICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICAgICAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgogICAgICoKICAgICAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAgICAgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICAgICAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogICAgICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogICAgICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICAgICAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KICAgICAqIFRIRSBTT0ZUV0FSRS4KICAgICAqLwoKICAgIGNvbnN0IF9nbG9iYWwgPSB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbCA6CiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6CiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB7fTsKCiAgICBjb25zdCBQUklWQVRFID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL0V2ZW50VGFyZ2V0Jyk7CiAgICBjbGFzcyBFdmVudFRhcmdldCB7CiAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXNbUFJJVkFURV0gPSB7CiAgICAgICAgICBsaXN0ZW5lcnM6IG5ldyBNYXAoKSwKICAgICAgICB9OwogICAgICB9CiAgICAgIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICBpZiAodHlwZW9mIHR5cGUgIT09ICdzdHJpbmcnKSB7IHRocm93IG5ldyBFcnJvcignYHR5cGVgIG11c3QgYmUgYSBzdHJpbmcnKTsgfQogICAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpIHsgdGhyb3cgbmV3IEVycm9yKCdgbGlzdGVuZXJgIG11c3QgYmUgYSBmdW5jdGlvbicpOyB9CiAgICAgICAgY29uc3QgdHlwZWRMaXN0ZW5lcnMgPSB0aGlzW1BSSVZBVEVdLmxpc3RlbmVycy5nZXQodHlwZSkgfHwgW107CiAgICAgICAgdHlwZWRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7CiAgICAgICAgdGhpc1tQUklWQVRFXS5saXN0ZW5lcnMuc2V0KHR5cGUsIHR5cGVkTGlzdGVuZXJzKTsKICAgICAgfQogICAgICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgICAgaWYgKHR5cGVvZiB0eXBlICE9PSAnc3RyaW5nJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2B0eXBlYCBtdXN0IGJlIGEgc3RyaW5nJyk7IH0KICAgICAgICBpZiAodHlwZW9mIGxpc3RlbmVyICE9PSAnZnVuY3Rpb24nKSB7IHRocm93IG5ldyBFcnJvcignYGxpc3RlbmVyYCBtdXN0IGJlIGEgZnVuY3Rpb24nKTsgfQogICAgICAgIGNvbnN0IHR5cGVkTGlzdGVuZXJzID0gdGhpc1tQUklWQVRFXS5saXN0ZW5lcnMuZ2V0KHR5cGUpIHx8IFtdOwogICAgICAgIGZvciAobGV0IGkgPSB0eXBlZExpc3RlbmVycy5sZW5ndGg7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICBpZiAodHlwZWRMaXN0ZW5lcnNbaV0gPT09IGxpc3RlbmVyKSB7CiAgICAgICAgICAgIHR5cGVkTGlzdGVuZXJzLnBvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBkaXNwYXRjaEV2ZW50KHR5cGUsIGV2ZW50KSB7CiAgICAgICAgY29uc3QgdHlwZWRMaXN0ZW5lcnMgPSB0aGlzW1BSSVZBVEVdLmxpc3RlbmVycy5nZXQodHlwZSkgfHwgW107CiAgICAgICAgY29uc3QgcXVldWUgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHR5cGVkTGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWV1ZVtpXSA9IHR5cGVkTGlzdGVuZXJzW2ldOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBsaXN0ZW5lciBvZiBxdWV1ZSkgewogICAgICAgICAgbGlzdGVuZXIoZXZlbnQpOwogICAgICAgIH0KICAgICAgICBpZiAodHlwZW9mIHRoaXNbYG9uJHt0eXBlfWBdID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICB0aGlzW2BvbiR7dHlwZX1gXShldmVudCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgY29uc3QgRVBTSUxPTiA9IDAuMDAwMDAxOwogICAgbGV0IEFSUkFZX1RZUEUgPSAodHlwZW9mIEZsb2F0MzJBcnJheSAhPT0gJ3VuZGVmaW5lZCcpID8gRmxvYXQzMkFycmF5IDogQXJyYXk7CgogICAgZnVuY3Rpb24gY3JlYXRlKCkgewogICAgICBsZXQgb3V0ID0gbmV3IEFSUkFZX1RZUEUoMTYpOwogICAgICBpZihBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICBvdXRbM10gPSAwOwogICAgICAgIG91dFs0XSA9IDA7CiAgICAgICAgb3V0WzZdID0gMDsKICAgICAgICBvdXRbN10gPSAwOwogICAgICAgIG91dFs4XSA9IDA7CiAgICAgICAgb3V0WzldID0gMDsKICAgICAgICBvdXRbMTFdID0gMDsKICAgICAgICBvdXRbMTJdID0gMDsKICAgICAgICBvdXRbMTNdID0gMDsKICAgICAgICBvdXRbMTRdID0gMDsKICAgICAgfQogICAgICBvdXRbMF0gPSAxOwogICAgICBvdXRbNV0gPSAxOwogICAgICBvdXRbMTBdID0gMTsKICAgICAgb3V0WzE1XSA9IDE7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gY29weShvdXQsIGEpIHsKICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgb3V0WzNdID0gYVszXTsKICAgICAgb3V0WzRdID0gYVs0XTsKICAgICAgb3V0WzVdID0gYVs1XTsKICAgICAgb3V0WzZdID0gYVs2XTsKICAgICAgb3V0WzddID0gYVs3XTsKICAgICAgb3V0WzhdID0gYVs4XTsKICAgICAgb3V0WzldID0gYVs5XTsKICAgICAgb3V0WzEwXSA9IGFbMTBdOwogICAgICBvdXRbMTFdID0gYVsxMV07CiAgICAgIG91dFsxMl0gPSBhWzEyXTsKICAgICAgb3V0WzEzXSA9IGFbMTNdOwogICAgICBvdXRbMTRdID0gYVsxNF07CiAgICAgIG91dFsxNV0gPSBhWzE1XTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCgogICAgZnVuY3Rpb24gaWRlbnRpdHkob3V0KSB7CiAgICAgIG91dFswXSA9IDE7CiAgICAgIG91dFsxXSA9IDA7CiAgICAgIG91dFsyXSA9IDA7CiAgICAgIG91dFszXSA9IDA7CiAgICAgIG91dFs0XSA9IDA7CiAgICAgIG91dFs1XSA9IDE7CiAgICAgIG91dFs2XSA9IDA7CiAgICAgIG91dFs3XSA9IDA7CiAgICAgIG91dFs4XSA9IDA7CiAgICAgIG91dFs5XSA9IDA7CiAgICAgIG91dFsxMF0gPSAxOwogICAgICBvdXRbMTFdID0gMDsKICAgICAgb3V0WzEyXSA9IDA7CiAgICAgIG91dFsxM10gPSAwOwogICAgICBvdXRbMTRdID0gMDsKICAgICAgb3V0WzE1XSA9IDE7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW52ZXJ0KG91dCwgYSkgewogICAgICBsZXQgYTAwID0gYVswXSwgYTAxID0gYVsxXSwgYTAyID0gYVsyXSwgYTAzID0gYVszXTsKICAgICAgbGV0IGExMCA9IGFbNF0sIGExMSA9IGFbNV0sIGExMiA9IGFbNl0sIGExMyA9IGFbN107CiAgICAgIGxldCBhMjAgPSBhWzhdLCBhMjEgPSBhWzldLCBhMjIgPSBhWzEwXSwgYTIzID0gYVsxMV07CiAgICAgIGxldCBhMzAgPSBhWzEyXSwgYTMxID0gYVsxM10sIGEzMiA9IGFbMTRdLCBhMzMgPSBhWzE1XTsKICAgICAgbGV0IGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMDsKICAgICAgbGV0IGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMDsKICAgICAgbGV0IGIwMiA9IGEwMCAqIGExMyAtIGEwMyAqIGExMDsKICAgICAgbGV0IGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMTsKICAgICAgbGV0IGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMTsKICAgICAgbGV0IGIwNSA9IGEwMiAqIGExMyAtIGEwMyAqIGExMjsKICAgICAgbGV0IGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMDsKICAgICAgbGV0IGIwNyA9IGEyMCAqIGEzMiAtIGEyMiAqIGEzMDsKICAgICAgbGV0IGIwOCA9IGEyMCAqIGEzMyAtIGEyMyAqIGEzMDsKICAgICAgbGV0IGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMTsKICAgICAgbGV0IGIxMCA9IGEyMSAqIGEzMyAtIGEyMyAqIGEzMTsKICAgICAgbGV0IGIxMSA9IGEyMiAqIGEzMyAtIGEyMyAqIGEzMjsKICAgICAgbGV0IGRldCA9IGIwMCAqIGIxMSAtIGIwMSAqIGIxMCArIGIwMiAqIGIwOSArIGIwMyAqIGIwOCAtIGIwNCAqIGIwNyArIGIwNSAqIGIwNjsKICAgICAgaWYgKCFkZXQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBkZXQgPSAxLjAgLyBkZXQ7CiAgICAgIG91dFswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0OwogICAgICBvdXRbMV0gPSAoYTAyICogYjEwIC0gYTAxICogYjExIC0gYTAzICogYjA5KSAqIGRldDsKICAgICAgb3V0WzJdID0gKGEzMSAqIGIwNSAtIGEzMiAqIGIwNCArIGEzMyAqIGIwMykgKiBkZXQ7CiAgICAgIG91dFszXSA9IChhMjIgKiBiMDQgLSBhMjEgKiBiMDUgLSBhMjMgKiBiMDMpICogZGV0OwogICAgICBvdXRbNF0gPSAoYTEyICogYjA4IC0gYTEwICogYjExIC0gYTEzICogYjA3KSAqIGRldDsKICAgICAgb3V0WzVdID0gKGEwMCAqIGIxMSAtIGEwMiAqIGIwOCArIGEwMyAqIGIwNykgKiBkZXQ7CiAgICAgIG91dFs2XSA9IChhMzIgKiBiMDIgLSBhMzAgKiBiMDUgLSBhMzMgKiBiMDEpICogZGV0OwogICAgICBvdXRbN10gPSAoYTIwICogYjA1IC0gYTIyICogYjAyICsgYTIzICogYjAxKSAqIGRldDsKICAgICAgb3V0WzhdID0gKGExMCAqIGIxMCAtIGExMSAqIGIwOCArIGExMyAqIGIwNikgKiBkZXQ7CiAgICAgIG91dFs5XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0OwogICAgICBvdXRbMTBdID0gKGEzMCAqIGIwNCAtIGEzMSAqIGIwMiArIGEzMyAqIGIwMCkgKiBkZXQ7CiAgICAgIG91dFsxMV0gPSAoYTIxICogYjAyIC0gYTIwICogYjA0IC0gYTIzICogYjAwKSAqIGRldDsKICAgICAgb3V0WzEyXSA9IChhMTEgKiBiMDcgLSBhMTAgKiBiMDkgLSBhMTIgKiBiMDYpICogZGV0OwogICAgICBvdXRbMTNdID0gKGEwMCAqIGIwOSAtIGEwMSAqIGIwNyArIGEwMiAqIGIwNikgKiBkZXQ7CiAgICAgIG91dFsxNF0gPSAoYTMxICogYjAxIC0gYTMwICogYjAzIC0gYTMyICogYjAwKSAqIGRldDsKICAgICAgb3V0WzE1XSA9IChhMjAgKiBiMDMgLSBhMjEgKiBiMDEgKyBhMjIgKiBiMDApICogZGV0OwogICAgICByZXR1cm4gb3V0OwogICAgfQoKCiAgICBmdW5jdGlvbiBtdWx0aXBseShvdXQsIGEsIGIpIHsKICAgICAgbGV0IGEwMCA9IGFbMF0sIGEwMSA9IGFbMV0sIGEwMiA9IGFbMl0sIGEwMyA9IGFbM107CiAgICAgIGxldCBhMTAgPSBhWzRdLCBhMTEgPSBhWzVdLCBhMTIgPSBhWzZdLCBhMTMgPSBhWzddOwogICAgICBsZXQgYTIwID0gYVs4XSwgYTIxID0gYVs5XSwgYTIyID0gYVsxMF0sIGEyMyA9IGFbMTFdOwogICAgICBsZXQgYTMwID0gYVsxMl0sIGEzMSA9IGFbMTNdLCBhMzIgPSBhWzE0XSwgYTMzID0gYVsxNV07CiAgICAgIGxldCBiMCAgPSBiWzBdLCBiMSA9IGJbMV0sIGIyID0gYlsyXSwgYjMgPSBiWzNdOwogICAgICBvdXRbMF0gPSBiMCphMDAgKyBiMSphMTAgKyBiMiphMjAgKyBiMyphMzA7CiAgICAgIG91dFsxXSA9IGIwKmEwMSArIGIxKmExMSArIGIyKmEyMSArIGIzKmEzMTsKICAgICAgb3V0WzJdID0gYjAqYTAyICsgYjEqYTEyICsgYjIqYTIyICsgYjMqYTMyOwogICAgICBvdXRbM10gPSBiMCphMDMgKyBiMSphMTMgKyBiMiphMjMgKyBiMyphMzM7CiAgICAgIGIwID0gYls0XTsgYjEgPSBiWzVdOyBiMiA9IGJbNl07IGIzID0gYls3XTsKICAgICAgb3V0WzRdID0gYjAqYTAwICsgYjEqYTEwICsgYjIqYTIwICsgYjMqYTMwOwogICAgICBvdXRbNV0gPSBiMCphMDEgKyBiMSphMTEgKyBiMiphMjEgKyBiMyphMzE7CiAgICAgIG91dFs2XSA9IGIwKmEwMiArIGIxKmExMiArIGIyKmEyMiArIGIzKmEzMjsKICAgICAgb3V0WzddID0gYjAqYTAzICsgYjEqYTEzICsgYjIqYTIzICsgYjMqYTMzOwogICAgICBiMCA9IGJbOF07IGIxID0gYls5XTsgYjIgPSBiWzEwXTsgYjMgPSBiWzExXTsKICAgICAgb3V0WzhdID0gYjAqYTAwICsgYjEqYTEwICsgYjIqYTIwICsgYjMqYTMwOwogICAgICBvdXRbOV0gPSBiMCphMDEgKyBiMSphMTEgKyBiMiphMjEgKyBiMyphMzE7CiAgICAgIG91dFsxMF0gPSBiMCphMDIgKyBiMSphMTIgKyBiMiphMjIgKyBiMyphMzI7CiAgICAgIG91dFsxMV0gPSBiMCphMDMgKyBiMSphMTMgKyBiMiphMjMgKyBiMyphMzM7CiAgICAgIGIwID0gYlsxMl07IGIxID0gYlsxM107IGIyID0gYlsxNF07IGIzID0gYlsxNV07CiAgICAgIG91dFsxMl0gPSBiMCphMDAgKyBiMSphMTAgKyBiMiphMjAgKyBiMyphMzA7CiAgICAgIG91dFsxM10gPSBiMCphMDEgKyBiMSphMTEgKyBiMiphMjEgKyBiMyphMzE7CiAgICAgIG91dFsxNF0gPSBiMCphMDIgKyBiMSphMTIgKyBiMiphMjIgKyBiMyphMzI7CiAgICAgIG91dFsxNV0gPSBiMCphMDMgKyBiMSphMTMgKyBiMiphMjMgKyBiMyphMzM7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCgoKCgoKCgoKCiAgICBmdW5jdGlvbiBmcm9tUm90YXRpb25UcmFuc2xhdGlvbihvdXQsIHEsIHYpIHsKICAgICAgbGV0IHggPSBxWzBdLCB5ID0gcVsxXSwgeiA9IHFbMl0sIHcgPSBxWzNdOwogICAgICBsZXQgeDIgPSB4ICsgeDsKICAgICAgbGV0IHkyID0geSArIHk7CiAgICAgIGxldCB6MiA9IHogKyB6OwogICAgICBsZXQgeHggPSB4ICogeDI7CiAgICAgIGxldCB4eSA9IHggKiB5MjsKICAgICAgbGV0IHh6ID0geCAqIHoyOwogICAgICBsZXQgeXkgPSB5ICogeTI7CiAgICAgIGxldCB5eiA9IHkgKiB6MjsKICAgICAgbGV0IHp6ID0geiAqIHoyOwogICAgICBsZXQgd3ggPSB3ICogeDI7CiAgICAgIGxldCB3eSA9IHcgKiB5MjsKICAgICAgbGV0IHd6ID0gdyAqIHoyOwogICAgICBvdXRbMF0gPSAxIC0gKHl5ICsgenopOwogICAgICBvdXRbMV0gPSB4eSArIHd6OwogICAgICBvdXRbMl0gPSB4eiAtIHd5OwogICAgICBvdXRbM10gPSAwOwogICAgICBvdXRbNF0gPSB4eSAtIHd6OwogICAgICBvdXRbNV0gPSAxIC0gKHh4ICsgenopOwogICAgICBvdXRbNl0gPSB5eiArIHd4OwogICAgICBvdXRbN10gPSAwOwogICAgICBvdXRbOF0gPSB4eiArIHd5OwogICAgICBvdXRbOV0gPSB5eiAtIHd4OwogICAgICBvdXRbMTBdID0gMSAtICh4eCArIHl5KTsKICAgICAgb3V0WzExXSA9IDA7CiAgICAgIG91dFsxMl0gPSB2WzBdOwogICAgICBvdXRbMTNdID0gdlsxXTsKICAgICAgb3V0WzE0XSA9IHZbMl07CiAgICAgIG91dFsxNV0gPSAxOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRyYW5zbGF0aW9uKG91dCwgbWF0KSB7CiAgICAgIG91dFswXSA9IG1hdFsxMl07CiAgICAgIG91dFsxXSA9IG1hdFsxM107CiAgICAgIG91dFsyXSA9IG1hdFsxNF07CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0Um90YXRpb24ob3V0LCBtYXQpIHsKICAgICAgbGV0IHRyYWNlID0gbWF0WzBdICsgbWF0WzVdICsgbWF0WzEwXTsKICAgICAgbGV0IFMgPSAwOwogICAgICBpZiAodHJhY2UgPiAwKSB7CiAgICAgICAgUyA9IE1hdGguc3FydCh0cmFjZSArIDEuMCkgKiAyOwogICAgICAgIG91dFszXSA9IDAuMjUgKiBTOwogICAgICAgIG91dFswXSA9IChtYXRbNl0gLSBtYXRbOV0pIC8gUzsKICAgICAgICBvdXRbMV0gPSAobWF0WzhdIC0gbWF0WzJdKSAvIFM7CiAgICAgICAgb3V0WzJdID0gKG1hdFsxXSAtIG1hdFs0XSkgLyBTOwogICAgICB9IGVsc2UgaWYgKChtYXRbMF0gPiBtYXRbNV0pICYmIChtYXRbMF0gPiBtYXRbMTBdKSkgewogICAgICAgIFMgPSBNYXRoLnNxcnQoMS4wICsgbWF0WzBdIC0gbWF0WzVdIC0gbWF0WzEwXSkgKiAyOwogICAgICAgIG91dFszXSA9IChtYXRbNl0gLSBtYXRbOV0pIC8gUzsKICAgICAgICBvdXRbMF0gPSAwLjI1ICogUzsKICAgICAgICBvdXRbMV0gPSAobWF0WzFdICsgbWF0WzRdKSAvIFM7CiAgICAgICAgb3V0WzJdID0gKG1hdFs4XSArIG1hdFsyXSkgLyBTOwogICAgICB9IGVsc2UgaWYgKG1hdFs1XSA+IG1hdFsxMF0pIHsKICAgICAgICBTID0gTWF0aC5zcXJ0KDEuMCArIG1hdFs1XSAtIG1hdFswXSAtIG1hdFsxMF0pICogMjsKICAgICAgICBvdXRbM10gPSAobWF0WzhdIC0gbWF0WzJdKSAvIFM7CiAgICAgICAgb3V0WzBdID0gKG1hdFsxXSArIG1hdFs0XSkgLyBTOwogICAgICAgIG91dFsxXSA9IDAuMjUgKiBTOwogICAgICAgIG91dFsyXSA9IChtYXRbNl0gKyBtYXRbOV0pIC8gUzsKICAgICAgfSBlbHNlIHsKICAgICAgICBTID0gTWF0aC5zcXJ0KDEuMCArIG1hdFsxMF0gLSBtYXRbMF0gLSBtYXRbNV0pICogMjsKICAgICAgICBvdXRbM10gPSAobWF0WzFdIC0gbWF0WzRdKSAvIFM7CiAgICAgICAgb3V0WzBdID0gKG1hdFs4XSArIG1hdFsyXSkgLyBTOwogICAgICAgIG91dFsxXSA9IChtYXRbNl0gKyBtYXRbOV0pIC8gUzsKICAgICAgICBvdXRbMl0gPSAwLjI1ICogUzsKICAgICAgfQogICAgICByZXR1cm4gb3V0OwogICAgfQoKCgoKICAgIGZ1bmN0aW9uIHBlcnNwZWN0aXZlKG91dCwgZm92eSwgYXNwZWN0LCBuZWFyLCBmYXIpIHsKICAgICAgbGV0IGYgPSAxLjAgLyBNYXRoLnRhbihmb3Z5IC8gMiksIG5mOwogICAgICBvdXRbMF0gPSBmIC8gYXNwZWN0OwogICAgICBvdXRbMV0gPSAwOwogICAgICBvdXRbMl0gPSAwOwogICAgICBvdXRbM10gPSAwOwogICAgICBvdXRbNF0gPSAwOwogICAgICBvdXRbNV0gPSBmOwogICAgICBvdXRbNl0gPSAwOwogICAgICBvdXRbN10gPSAwOwogICAgICBvdXRbOF0gPSAwOwogICAgICBvdXRbOV0gPSAwOwogICAgICBvdXRbMTFdID0gLTE7CiAgICAgIG91dFsxMl0gPSAwOwogICAgICBvdXRbMTNdID0gMDsKICAgICAgb3V0WzE1XSA9IDA7CiAgICAgIGlmIChmYXIgIT0gbnVsbCAmJiBmYXIgIT09IEluZmluaXR5KSB7CiAgICAgICAgbmYgPSAxIC8gKG5lYXIgLSBmYXIpOwogICAgICAgIG91dFsxMF0gPSAoZmFyICsgbmVhcikgKiBuZjsKICAgICAgICBvdXRbMTRdID0gKDIgKiBmYXIgKiBuZWFyKSAqIG5mOwogICAgICB9IGVsc2UgewogICAgICAgIG91dFsxMF0gPSAtMTsKICAgICAgICBvdXRbMTRdID0gLTIgKiBuZWFyOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlJDEoKSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSgzKTsKICAgICAgaWYoQVJSQVlfVFlQRSAhPSBGbG9hdDMyQXJyYXkpIHsKICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgb3V0WzJdID0gMDsKICAgICAgfQogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgZnVuY3Rpb24gY2xvbmUkMShhKSB7CiAgICAgIHZhciBvdXQgPSBuZXcgQVJSQVlfVFlQRSgzKTsKICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGxlbmd0aChhKSB7CiAgICAgIGxldCB4ID0gYVswXTsKICAgICAgbGV0IHkgPSBhWzFdOwogICAgICBsZXQgeiA9IGFbMl07CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCp4ICsgeSp5ICsgeip6KTsKICAgIH0KICAgIGZ1bmN0aW9uIGZyb21WYWx1ZXMkMSh4LCB5LCB6KSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSgzKTsKICAgICAgb3V0WzBdID0geDsKICAgICAgb3V0WzFdID0geTsKICAgICAgb3V0WzJdID0gejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGNvcHkkMShvdXQsIGEpIHsKICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBhZGQkMShvdXQsIGEsIGIpIHsKICAgICAgb3V0WzBdID0gYVswXSArIGJbMF07CiAgICAgIG91dFsxXSA9IGFbMV0gKyBiWzFdOwogICAgICBvdXRbMl0gPSBhWzJdICsgYlsyXTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCgoKCgoKCgogICAgZnVuY3Rpb24gc2NhbGUkMShvdXQsIGEsIGIpIHsKICAgICAgb3V0WzBdID0gYVswXSAqIGI7CiAgICAgIG91dFsxXSA9IGFbMV0gKiBiOwogICAgICBvdXRbMl0gPSBhWzJdICogYjsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCgoKCgoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZShvdXQsIGEpIHsKICAgICAgbGV0IHggPSBhWzBdOwogICAgICBsZXQgeSA9IGFbMV07CiAgICAgIGxldCB6ID0gYVsyXTsKICAgICAgbGV0IGxlbiA9IHgqeCArIHkqeSArIHoqejsKICAgICAgaWYgKGxlbiA+IDApIHsKICAgICAgICBsZW4gPSAxIC8gTWF0aC5zcXJ0KGxlbik7CiAgICAgICAgb3V0WzBdID0gYVswXSAqIGxlbjsKICAgICAgICBvdXRbMV0gPSBhWzFdICogbGVuOwogICAgICAgIG91dFsyXSA9IGFbMl0gKiBsZW47CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGRvdChhLCBiKSB7CiAgICAgIHJldHVybiBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdICsgYVsyXSAqIGJbMl07CiAgICB9CiAgICBmdW5jdGlvbiBjcm9zcyhvdXQsIGEsIGIpIHsKICAgICAgbGV0IGF4ID0gYVswXSwgYXkgPSBhWzFdLCBheiA9IGFbMl07CiAgICAgIGxldCBieCA9IGJbMF0sIGJ5ID0gYlsxXSwgYnogPSBiWzJdOwogICAgICBvdXRbMF0gPSBheSAqIGJ6IC0gYXogKiBieTsKICAgICAgb3V0WzFdID0gYXogKiBieCAtIGF4ICogYno7CiAgICAgIG91dFsyXSA9IGF4ICogYnkgLSBheSAqIGJ4OwogICAgICByZXR1cm4gb3V0OwogICAgfQoKCgoKCgogICAgZnVuY3Rpb24gdHJhbnNmb3JtUXVhdChvdXQsIGEsIHEpIHsKICAgICAgICBsZXQgcXggPSBxWzBdLCBxeSA9IHFbMV0sIHF6ID0gcVsyXSwgcXcgPSBxWzNdOwogICAgICAgIGxldCB4ID0gYVswXSwgeSA9IGFbMV0sIHogPSBhWzJdOwogICAgICAgIGxldCB1dnggPSBxeSAqIHogLSBxeiAqIHksCiAgICAgICAgICAgIHV2eSA9IHF6ICogeCAtIHF4ICogeiwKICAgICAgICAgICAgdXZ6ID0gcXggKiB5IC0gcXkgKiB4OwogICAgICAgIGxldCB1dXZ4ID0gcXkgKiB1dnogLSBxeiAqIHV2eSwKICAgICAgICAgICAgdXV2eSA9IHF6ICogdXZ4IC0gcXggKiB1dnosCiAgICAgICAgICAgIHV1dnogPSBxeCAqIHV2eSAtIHF5ICogdXZ4OwogICAgICAgIGxldCB3MiA9IHF3ICogMjsKICAgICAgICB1dnggKj0gdzI7CiAgICAgICAgdXZ5ICo9IHcyOwogICAgICAgIHV2eiAqPSB3MjsKICAgICAgICB1dXZ4ICo9IDI7CiAgICAgICAgdXV2eSAqPSAyOwogICAgICAgIHV1dnogKj0gMjsKICAgICAgICBvdXRbMF0gPSB4ICsgdXZ4ICsgdXV2eDsKICAgICAgICBvdXRbMV0gPSB5ICsgdXZ5ICsgdXV2eTsKICAgICAgICBvdXRbMl0gPSB6ICsgdXZ6ICsgdXV2ejsKICAgICAgICByZXR1cm4gb3V0OwogICAgfQoKCgogICAgZnVuY3Rpb24gYW5nbGUoYSwgYikgewogICAgICBsZXQgdGVtcEEgPSBmcm9tVmFsdWVzJDEoYVswXSwgYVsxXSwgYVsyXSk7CiAgICAgIGxldCB0ZW1wQiA9IGZyb21WYWx1ZXMkMShiWzBdLCBiWzFdLCBiWzJdKTsKICAgICAgbm9ybWFsaXplKHRlbXBBLCB0ZW1wQSk7CiAgICAgIG5vcm1hbGl6ZSh0ZW1wQiwgdGVtcEIpOwogICAgICBsZXQgY29zaW5lID0gZG90KHRlbXBBLCB0ZW1wQik7CiAgICAgIGlmKGNvc2luZSA+IDEuMCkgewogICAgICAgIHJldHVybiAwOwogICAgICB9CiAgICAgIGVsc2UgaWYoY29zaW5lIDwgLTEpIHsKICAgICAgICByZXR1cm4gTWF0aC5QSTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gTWF0aC5hY29zKGNvc2luZSk7CiAgICAgIH0KICAgIH0KCgoKCgoKCgogICAgY29uc3QgbGVuID0gbGVuZ3RoOwoKICAgICgoZnVuY3Rpb24oKSB7CiAgICAgIGxldCB2ZWMgPSBjcmVhdGUkMSgpOwogICAgICByZXR1cm4gZnVuY3Rpb24oYSwgc3RyaWRlLCBvZmZzZXQsIGNvdW50LCBmbiwgYXJnKSB7CiAgICAgICAgbGV0IGksIGw7CiAgICAgICAgaWYoIXN0cmlkZSkgewogICAgICAgICAgc3RyaWRlID0gMzsKICAgICAgICB9CiAgICAgICAgaWYoIW9mZnNldCkgewogICAgICAgICAgb2Zmc2V0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYoY291bnQpIHsKICAgICAgICAgIGwgPSBNYXRoLm1pbigoY291bnQgKiBzdHJpZGUpICsgb2Zmc2V0LCBhLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGwgPSBhLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZm9yKGkgPSBvZmZzZXQ7IGkgPCBsOyBpICs9IHN0cmlkZSkgewogICAgICAgICAgdmVjWzBdID0gYVtpXTsgdmVjWzFdID0gYVtpKzFdOyB2ZWNbMl0gPSBhW2krMl07CiAgICAgICAgICBmbih2ZWMsIHZlYywgYXJnKTsKICAgICAgICAgIGFbaV0gPSB2ZWNbMF07IGFbaSsxXSA9IHZlY1sxXTsgYVtpKzJdID0gdmVjWzJdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYTsKICAgICAgfTsKICAgIH0pKSgpOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZSQyKCkgewogICAgICBsZXQgb3V0ID0gbmV3IEFSUkFZX1RZUEUoOSk7CiAgICAgIGlmKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgb3V0WzVdID0gMDsKICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgIG91dFs3XSA9IDA7CiAgICAgIH0KICAgICAgb3V0WzBdID0gMTsKICAgICAgb3V0WzRdID0gMTsKICAgICAgb3V0WzhdID0gMTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGUkMygpIHsKICAgICAgbGV0IG91dCA9IG5ldyBBUlJBWV9UWVBFKDQpOwogICAgICBpZihBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgIG91dFszXSA9IDA7CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGNsb25lJDMoYSkgewogICAgICBsZXQgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNCk7CiAgICAgIG91dFswXSA9IGFbMF07CiAgICAgIG91dFsxXSA9IGFbMV07CiAgICAgIG91dFsyXSA9IGFbMl07CiAgICAgIG91dFszXSA9IGFbM107CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBmcm9tVmFsdWVzJDMoeCwgeSwgeiwgdykgewogICAgICBsZXQgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNCk7CiAgICAgIG91dFswXSA9IHg7CiAgICAgIG91dFsxXSA9IHk7CiAgICAgIG91dFsyXSA9IHo7CiAgICAgIG91dFszXSA9IHc7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBjb3B5JDMob3V0LCBhKSB7CiAgICAgIG91dFswXSA9IGFbMF07CiAgICAgIG91dFsxXSA9IGFbMV07CiAgICAgIG91dFsyXSA9IGFbMl07CiAgICAgIG91dFszXSA9IGFbM107CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCgoKCgoKCgoKCgoKCgoKCiAgICBmdW5jdGlvbiBub3JtYWxpemUkMShvdXQsIGEpIHsKICAgICAgbGV0IHggPSBhWzBdOwogICAgICBsZXQgeSA9IGFbMV07CiAgICAgIGxldCB6ID0gYVsyXTsKICAgICAgbGV0IHcgPSBhWzNdOwogICAgICBsZXQgbGVuID0geCp4ICsgeSp5ICsgeip6ICsgdyp3OwogICAgICBpZiAobGVuID4gMCkgewogICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICBvdXRbMF0gPSB4ICogbGVuOwogICAgICAgIG91dFsxXSA9IHkgKiBsZW47CiAgICAgICAgb3V0WzJdID0geiAqIGxlbjsKICAgICAgICBvdXRbM10gPSB3ICogbGVuOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCgoKCgoKCgoKCgoKCiAgICAoKGZ1bmN0aW9uKCkgewogICAgICBsZXQgdmVjID0gY3JlYXRlJDMoKTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKGEsIHN0cmlkZSwgb2Zmc2V0LCBjb3VudCwgZm4sIGFyZykgewogICAgICAgIGxldCBpLCBsOwogICAgICAgIGlmKCFzdHJpZGUpIHsKICAgICAgICAgIHN0cmlkZSA9IDQ7CiAgICAgICAgfQogICAgICAgIGlmKCFvZmZzZXQpIHsKICAgICAgICAgIG9mZnNldCA9IDA7CiAgICAgICAgfQogICAgICAgIGlmKGNvdW50KSB7CiAgICAgICAgICBsID0gTWF0aC5taW4oKGNvdW50ICogc3RyaWRlKSArIG9mZnNldCwgYS5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsID0gYS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIGZvcihpID0gb2Zmc2V0OyBpIDwgbDsgaSArPSBzdHJpZGUpIHsKICAgICAgICAgIHZlY1swXSA9IGFbaV07IHZlY1sxXSA9IGFbaSsxXTsgdmVjWzJdID0gYVtpKzJdOyB2ZWNbM10gPSBhW2krM107CiAgICAgICAgICBmbih2ZWMsIHZlYywgYXJnKTsKICAgICAgICAgIGFbaV0gPSB2ZWNbMF07IGFbaSsxXSA9IHZlY1sxXTsgYVtpKzJdID0gdmVjWzJdOyBhW2krM10gPSB2ZWNbM107CiAgICAgICAgfQogICAgICAgIHJldHVybiBhOwogICAgICB9OwogICAgfSkpKCk7CgogICAgZnVuY3Rpb24gY3JlYXRlJDQoKSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgaWYoQVJSQVlfVFlQRSAhPSBGbG9hdDMyQXJyYXkpIHsKICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgIG91dFsxXSA9IDA7CiAgICAgICAgb3V0WzJdID0gMDsKICAgICAgfQogICAgICBvdXRbM10gPSAxOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKICAgIGZ1bmN0aW9uIHNldEF4aXNBbmdsZShvdXQsIGF4aXMsIHJhZCkgewogICAgICByYWQgPSByYWQgKiAwLjU7CiAgICAgIGxldCBzID0gTWF0aC5zaW4ocmFkKTsKICAgICAgb3V0WzBdID0gcyAqIGF4aXNbMF07CiAgICAgIG91dFsxXSA9IHMgKiBheGlzWzFdOwogICAgICBvdXRbMl0gPSBzICogYXhpc1syXTsKICAgICAgb3V0WzNdID0gTWF0aC5jb3MocmFkKTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBtdWx0aXBseSQ0KG91dCwgYSwgYikgewogICAgICBsZXQgYXggPSBhWzBdLCBheSA9IGFbMV0sIGF6ID0gYVsyXSwgYXcgPSBhWzNdOwogICAgICBsZXQgYnggPSBiWzBdLCBieSA9IGJbMV0sIGJ6ID0gYlsyXSwgYncgPSBiWzNdOwogICAgICBvdXRbMF0gPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICBvdXRbMV0gPSBheSAqIGJ3ICsgYXcgKiBieSArIGF6ICogYnggLSBheCAqIGJ6OwogICAgICBvdXRbMl0gPSBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4OwogICAgICBvdXRbM10gPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gb3V0OwogICAgfQoKCgoKICAgIGZ1bmN0aW9uIHNsZXJwKG91dCwgYSwgYiwgdCkgewogICAgICBsZXQgYXggPSBhWzBdLCBheSA9IGFbMV0sIGF6ID0gYVsyXSwgYXcgPSBhWzNdOwogICAgICBsZXQgYnggPSBiWzBdLCBieSA9IGJbMV0sIGJ6ID0gYlsyXSwgYncgPSBiWzNdOwogICAgICBsZXQgb21lZ2EsIGNvc29tLCBzaW5vbSwgc2NhbGUwLCBzY2FsZTE7CiAgICAgIGNvc29tID0gYXggKiBieCArIGF5ICogYnkgKyBheiAqIGJ6ICsgYXcgKiBidzsKICAgICAgaWYgKCBjb3NvbSA8IDAuMCApIHsKICAgICAgICBjb3NvbSA9IC1jb3NvbTsKICAgICAgICBieCA9IC0gYng7CiAgICAgICAgYnkgPSAtIGJ5OwogICAgICAgIGJ6ID0gLSBiejsKICAgICAgICBidyA9IC0gYnc7CiAgICAgIH0KICAgICAgaWYgKCAoMS4wIC0gY29zb20pID4gRVBTSUxPTiApIHsKICAgICAgICBvbWVnYSAgPSBNYXRoLmFjb3MoY29zb20pOwogICAgICAgIHNpbm9tICA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2NhbGUwID0gMS4wIC0gdDsKICAgICAgICBzY2FsZTEgPSB0OwogICAgICB9CiAgICAgIG91dFswXSA9IHNjYWxlMCAqIGF4ICsgc2NhbGUxICogYng7CiAgICAgIG91dFsxXSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIG91dFsyXSA9IHNjYWxlMCAqIGF6ICsgc2NhbGUxICogYno7CiAgICAgIG91dFszXSA9IHNjYWxlMCAqIGF3ICsgc2NhbGUxICogYnc7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW52ZXJ0JDIob3V0LCBhKSB7CiAgICAgIGxldCBhMCA9IGFbMF0sIGExID0gYVsxXSwgYTIgPSBhWzJdLCBhMyA9IGFbM107CiAgICAgIGxldCBkb3QkJDEgPSBhMCphMCArIGExKmExICsgYTIqYTIgKyBhMyphMzsKICAgICAgbGV0IGludkRvdCA9IGRvdCQkMSA/IDEuMC9kb3QkJDEgOiAwOwogICAgICBvdXRbMF0gPSAtYTAqaW52RG90OwogICAgICBvdXRbMV0gPSAtYTEqaW52RG90OwogICAgICBvdXRbMl0gPSAtYTIqaW52RG90OwogICAgICBvdXRbM10gPSBhMyppbnZEb3Q7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZnJvbU1hdDMob3V0LCBtKSB7CiAgICAgIGxldCBmVHJhY2UgPSBtWzBdICsgbVs0XSArIG1bOF07CiAgICAgIGxldCBmUm9vdDsKICAgICAgaWYgKCBmVHJhY2UgPiAwLjAgKSB7CiAgICAgICAgZlJvb3QgPSBNYXRoLnNxcnQoZlRyYWNlICsgMS4wKTsKICAgICAgICBvdXRbM10gPSAwLjUgKiBmUm9vdDsKICAgICAgICBmUm9vdCA9IDAuNS9mUm9vdDsKICAgICAgICBvdXRbMF0gPSAobVs1XS1tWzddKSpmUm9vdDsKICAgICAgICBvdXRbMV0gPSAobVs2XS1tWzJdKSpmUm9vdDsKICAgICAgICBvdXRbMl0gPSAobVsxXS1tWzNdKSpmUm9vdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBsZXQgaSA9IDA7CiAgICAgICAgaWYgKCBtWzRdID4gbVswXSApCiAgICAgICAgICBpID0gMTsKICAgICAgICBpZiAoIG1bOF0gPiBtW2kqMytpXSApCiAgICAgICAgICBpID0gMjsKICAgICAgICBsZXQgaiA9IChpKzEpJTM7CiAgICAgICAgbGV0IGsgPSAoaSsyKSUzOwogICAgICAgIGZSb290ID0gTWF0aC5zcXJ0KG1baSozK2ldLW1baiozK2pdLW1bayozK2tdICsgMS4wKTsKICAgICAgICBvdXRbaV0gPSAwLjUgKiBmUm9vdDsKICAgICAgICBmUm9vdCA9IDAuNSAvIGZSb290OwogICAgICAgIG91dFszXSA9IChtW2oqMytrXSAtIG1bayozK2pdKSAqIGZSb290OwogICAgICAgIG91dFtqXSA9IChtW2oqMytpXSArIG1baSozK2pdKSAqIGZSb290OwogICAgICAgIG91dFtrXSA9IChtW2sqMytpXSArIG1baSozK2tdKSAqIGZSb290OwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBmcm9tRXVsZXIob3V0LCB4LCB5LCB6KSB7CiAgICAgICAgbGV0IGhhbGZUb1JhZCA9IDAuNSAqIE1hdGguUEkgLyAxODAuMDsKICAgICAgICB4ICo9IGhhbGZUb1JhZDsKICAgICAgICB5ICo9IGhhbGZUb1JhZDsKICAgICAgICB6ICo9IGhhbGZUb1JhZDsKICAgICAgICBsZXQgc3ggPSBNYXRoLnNpbih4KTsKICAgICAgICBsZXQgY3ggPSBNYXRoLmNvcyh4KTsKICAgICAgICBsZXQgc3kgPSBNYXRoLnNpbih5KTsKICAgICAgICBsZXQgY3kgPSBNYXRoLmNvcyh5KTsKICAgICAgICBsZXQgc3ogPSBNYXRoLnNpbih6KTsKICAgICAgICBsZXQgY3ogPSBNYXRoLmNvcyh6KTsKICAgICAgICBvdXRbMF0gPSBzeCAqIGN5ICogY3ogLSBjeCAqIHN5ICogc3o7CiAgICAgICAgb3V0WzFdID0gY3ggKiBzeSAqIGN6ICsgc3ggKiBjeSAqIHN6OwogICAgICAgIG91dFsyXSA9IGN4ICogY3kgKiBzeiAtIHN4ICogc3kgKiBjejsKICAgICAgICBvdXRbM10gPSBjeCAqIGN5ICogY3ogKyBzeCAqIHN5ICogc3o7CiAgICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBjb25zdCBjbG9uZSQ0ID0gY2xvbmUkMzsKICAgIGNvbnN0IGZyb21WYWx1ZXMkNCA9IGZyb21WYWx1ZXMkMzsKICAgIGNvbnN0IGNvcHkkNCA9IGNvcHkkMzsKCgoKCgoKCgoKCiAgICBjb25zdCBub3JtYWxpemUkMiA9IG5vcm1hbGl6ZSQxOwoKCiAgICAoKGZ1bmN0aW9uKCkgewogICAgICBsZXQgdG1wdmVjMyA9IGNyZWF0ZSQxKCk7CiAgICAgIGxldCB4VW5pdFZlYzMgPSBmcm9tVmFsdWVzJDEoMSwwLDApOwogICAgICBsZXQgeVVuaXRWZWMzID0gZnJvbVZhbHVlcyQxKDAsMSwwKTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uKG91dCwgYSwgYikgewogICAgICAgIGxldCBkb3QkJDEgPSBkb3QoYSwgYik7CiAgICAgICAgaWYgKGRvdCQkMSA8IC0wLjk5OTk5OSkgewogICAgICAgICAgY3Jvc3ModG1wdmVjMywgeFVuaXRWZWMzLCBhKTsKICAgICAgICAgIGlmIChsZW4odG1wdmVjMykgPCAwLjAwMDAwMSkKICAgICAgICAgICAgY3Jvc3ModG1wdmVjMywgeVVuaXRWZWMzLCBhKTsKICAgICAgICAgIG5vcm1hbGl6ZSh0bXB2ZWMzLCB0bXB2ZWMzKTsKICAgICAgICAgIHNldEF4aXNBbmdsZShvdXQsIHRtcHZlYzMsIE1hdGguUEkpOwogICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICB9IGVsc2UgaWYgKGRvdCQkMSA+IDAuOTk5OTk5KSB7CiAgICAgICAgICBvdXRbMF0gPSAwOwogICAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgICBvdXRbM10gPSAxOwogICAgICAgICAgcmV0dXJuIG91dDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3Jvc3ModG1wdmVjMywgYSwgYik7CiAgICAgICAgICBvdXRbMF0gPSB0bXB2ZWMzWzBdOwogICAgICAgICAgb3V0WzFdID0gdG1wdmVjM1sxXTsKICAgICAgICAgIG91dFsyXSA9IHRtcHZlYzNbMl07CiAgICAgICAgICBvdXRbM10gPSAxICsgZG90JCQxOwogICAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZSQyKG91dCwgb3V0KTsKICAgICAgICB9CiAgICAgIH07CiAgICB9KSkoKTsKICAgICgoZnVuY3Rpb24gKCkgewogICAgICBsZXQgdGVtcDEgPSBjcmVhdGUkNCgpOwogICAgICBsZXQgdGVtcDIgPSBjcmVhdGUkNCgpOwogICAgICByZXR1cm4gZnVuY3Rpb24gKG91dCwgYSwgYiwgYywgZCwgdCkgewogICAgICAgIHNsZXJwKHRlbXAxLCBhLCBkLCB0KTsKICAgICAgICBzbGVycCh0ZW1wMiwgYiwgYywgdCk7CiAgICAgICAgc2xlcnAob3V0LCB0ZW1wMSwgdGVtcDIsIDIgKiB0ICogKDEgLSB0KSk7CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfTsKICAgIH0pKCkpOwogICAgKChmdW5jdGlvbigpIHsKICAgICAgbGV0IG1hdHIgPSBjcmVhdGUkMigpOwogICAgICByZXR1cm4gZnVuY3Rpb24ob3V0LCB2aWV3LCByaWdodCwgdXApIHsKICAgICAgICBtYXRyWzBdID0gcmlnaHRbMF07CiAgICAgICAgbWF0clszXSA9IHJpZ2h0WzFdOwogICAgICAgIG1hdHJbNl0gPSByaWdodFsyXTsKICAgICAgICBtYXRyWzFdID0gdXBbMF07CiAgICAgICAgbWF0cls0XSA9IHVwWzFdOwogICAgICAgIG1hdHJbN10gPSB1cFsyXTsKICAgICAgICBtYXRyWzJdID0gLXZpZXdbMF07CiAgICAgICAgbWF0cls1XSA9IC12aWV3WzFdOwogICAgICAgIG1hdHJbOF0gPSAtdmlld1syXTsKICAgICAgICByZXR1cm4gbm9ybWFsaXplJDIob3V0LCBmcm9tTWF0MyhvdXQsIG1hdHIpKTsKICAgICAgfTsKICAgIH0pKSgpOwoKICAgIGNvbnN0IFBSSVZBVEUkMSA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlJpZ2lkVHJhbnNmb3JtJyk7CiAgICBjbGFzcyBYUlJpZ2lkVHJhbnNmb3JtJDEgewogICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzW1BSSVZBVEUkMV0gPSB7CiAgICAgICAgICBtYXRyaXg6IG51bGwsCiAgICAgICAgICBwb3NpdGlvbjogbnVsbCwKICAgICAgICAgIG9yaWVudGF0aW9uOiBudWxsLAogICAgICAgICAgaW52ZXJzZTogbnVsbCwKICAgICAgICB9OwogICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ubWF0cml4ID0gaWRlbnRpdHkobmV3IEZsb2F0MzJBcnJheSgxNikpOwogICAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgaWYgKGFyZ3VtZW50c1swXSBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSkgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ubWF0cml4ID0gYXJndW1lbnRzWzBdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLnBvc2l0aW9uID0gdGhpcy5fZ2V0UG9pbnQoYXJndW1lbnRzWzBdKTsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm9yaWVudGF0aW9uID0gRE9NUG9pbnRSZWFkT25seS5mcm9tUG9pbnQoewogICAgICAgICAgICAgICAgeDogMCwgeTogMCwgejogMCwgdzogMQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5wb3NpdGlvbiA9IHRoaXMuX2dldFBvaW50KGFyZ3VtZW50c1swXSk7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb24gPSB0aGlzLl9nZXRQb2ludChhcmd1bWVudHNbMV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlRvbyBtYW55IGFyZ3VtZW50cyEiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxXS5tYXRyaXgpIHsKICAgICAgICAgICAgbGV0IHBvc2l0aW9uID0gY3JlYXRlJDEoKTsKICAgICAgICAgICAgZ2V0VHJhbnNsYXRpb24ocG9zaXRpb24sIHRoaXNbUFJJVkFURSQxXS5tYXRyaXgpOwogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ucG9zaXRpb24gPSBET01Qb2ludFJlYWRPbmx5LmZyb21Qb2ludCh7CiAgICAgICAgICAgICAgICB4OiBwb3NpdGlvblswXSwKICAgICAgICAgICAgICAgIHk6IHBvc2l0aW9uWzFdLAogICAgICAgICAgICAgICAgejogcG9zaXRpb25bMl0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGxldCBvcmllbnRhdGlvbiA9IGNyZWF0ZSQ0KCk7CiAgICAgICAgICAgIGdldFJvdGF0aW9uKG9yaWVudGF0aW9uLCB0aGlzW1BSSVZBVEUkMV0ubWF0cml4KTsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm9yaWVudGF0aW9uID0gRE9NUG9pbnRSZWFkT25seS5mcm9tUG9pbnQoewogICAgICAgICAgICAgIHg6IG9yaWVudGF0aW9uWzBdLAogICAgICAgICAgICAgIHk6IG9yaWVudGF0aW9uWzFdLAogICAgICAgICAgICAgIHo6IG9yaWVudGF0aW9uWzJdLAogICAgICAgICAgICAgIHc6IG9yaWVudGF0aW9uWzNdCiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5tYXRyaXggPSBpZGVudGl0eShuZXcgRmxvYXQzMkFycmF5KDE2KSk7CiAgICAgICAgICAgIGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uKAogICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5tYXRyaXgsCiAgICAgICAgICAgICAgZnJvbVZhbHVlcyQ0KAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm9yaWVudGF0aW9uLngsCiAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb24ueSwKICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5vcmllbnRhdGlvbi56LAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm9yaWVudGF0aW9uLncpLAogICAgICAgICAgICAgIGZyb21WYWx1ZXMkMSgKICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5wb3NpdGlvbi54LAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLnBvc2l0aW9uLnksCiAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ucG9zaXRpb24ueikKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgX2dldFBvaW50KGFyZykgewogICAgICAgIGlmIChhcmcgaW5zdGFuY2VvZiBET01Qb2ludFJlYWRPbmx5KSB7CiAgICAgICAgICByZXR1cm4gYXJnOwogICAgICAgIH0KICAgICAgICByZXR1cm4gRE9NUG9pbnRSZWFkT25seS5mcm9tUG9pbnQoYXJnKTsKICAgICAgfQogICAgICBnZXQgbWF0cml4KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDFdLm1hdHJpeDsgfQogICAgICBnZXQgcG9zaXRpb24oKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMV0ucG9zaXRpb247IH0KICAgICAgZ2V0IG9yaWVudGF0aW9uKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDFdLm9yaWVudGF0aW9uOyB9CiAgICAgIGdldCBpbnZlcnNlKCkgewogICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMV0uaW52ZXJzZSA9PT0gbnVsbCkgewogICAgICAgICAgbGV0IGludk1hdHJpeCA9IGlkZW50aXR5KG5ldyBGbG9hdDMyQXJyYXkoMTYpKTsKICAgICAgICAgIGludmVydChpbnZNYXRyaXgsIHRoaXNbUFJJVkFURSQxXS5tYXRyaXgpOwogICAgICAgICAgdGhpc1tQUklWQVRFJDFdLmludmVyc2UgPSBuZXcgWFJSaWdpZFRyYW5zZm9ybSQxKGludk1hdHJpeCk7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0uaW52ZXJzZVtQUklWQVRFJDFdLmludmVyc2UgPSB0aGlzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDFdLmludmVyc2U7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDIgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJTcGFjZScpOwoKICAgIGNsYXNzIFhSU3BhY2UgewogICAgICBjb25zdHJ1Y3RvcihzcGVjaWFsVHlwZSA9IG51bGwsIGlucHV0U291cmNlID0gbnVsbCkgewogICAgICAgIHRoaXNbUFJJVkFURSQyXSA9IHsKICAgICAgICAgIHNwZWNpYWxUeXBlLAogICAgICAgICAgaW5wdXRTb3VyY2UsCiAgICAgICAgICBiYXNlTWF0cml4OiBudWxsLAogICAgICAgICAgaW52ZXJzZUJhc2VNYXRyaXg6IG51bGwsCiAgICAgICAgICBsYXN0RnJhbWVJZDogLTEKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCBfc3BlY2lhbFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQyXS5zcGVjaWFsVHlwZTsKICAgICAgfQogICAgICBnZXQgX2lucHV0U291cmNlKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMl0uaW5wdXRTb3VyY2U7CiAgICAgIH0KICAgICAgX2Vuc3VyZVBvc2VVcGRhdGVkKGRldmljZSwgZnJhbWVJZCkgewogICAgICAgIGlmIChmcmFtZUlkID09IHRoaXNbUFJJVkFURSQyXS5sYXN0RnJhbWVJZCkgcmV0dXJuOwogICAgICAgIHRoaXNbUFJJVkFURSQyXS5sYXN0RnJhbWVJZCA9IGZyYW1lSWQ7CiAgICAgICAgdGhpcy5fb25Qb3NlVXBkYXRlKGRldmljZSk7CiAgICAgIH0KICAgICAgX29uUG9zZVVwZGF0ZShkZXZpY2UpIHsKICAgICAgICBpZiAodGhpc1tQUklWQVRFJDJdLnNwZWNpYWxUeXBlID09ICd2aWV3ZXInKSB7CiAgICAgICAgICB0aGlzLl9iYXNlTWF0cml4ID0gZGV2aWNlLmdldEJhc2VQb3NlTWF0cml4KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHNldCBfYmFzZU1hdHJpeChtYXRyaXgpIHsKICAgICAgICB0aGlzW1BSSVZBVEUkMl0uYmFzZU1hdHJpeCA9IG1hdHJpeDsKICAgICAgICB0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXggPSBudWxsOwogICAgICB9CiAgICAgIGdldCBfYmFzZU1hdHJpeCgpIHsKICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4KSB7CiAgICAgICAgICBpZiAodGhpc1tQUklWQVRFJDJdLmludmVyc2VCYXNlTWF0cml4KSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgICAgIGludmVydCh0aGlzW1BSSVZBVEUkMl0uYmFzZU1hdHJpeCwgdGhpc1tQUklWQVRFJDJdLmludmVyc2VCYXNlTWF0cml4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4OwogICAgICB9CiAgICAgIHNldCBfaW52ZXJzZUJhc2VNYXRyaXgobWF0cml4KSB7CiAgICAgICAgdGhpc1tQUklWQVRFJDJdLmludmVyc2VCYXNlTWF0cml4ID0gbWF0cml4OwogICAgICAgIHRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4ID0gbnVsbDsKICAgICAgfQogICAgICBnZXQgX2ludmVyc2VCYXNlTWF0cml4KCkgewogICAgICAgIGlmICghdGhpc1tQUklWQVRFJDJdLmludmVyc2VCYXNlTWF0cml4KSB7CiAgICAgICAgICBpZiAodGhpc1tQUklWQVRFJDJdLmJhc2VNYXRyaXgpIHsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDJdLmludmVyc2VCYXNlTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgICAgIGludmVydCh0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXgsIHRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQyXS5pbnZlcnNlQmFzZU1hdHJpeDsKICAgICAgfQogICAgICBfZ2V0U3BhY2VSZWxhdGl2ZVRyYW5zZm9ybShzcGFjZSkgewogICAgICAgIGlmICghdGhpcy5faW52ZXJzZUJhc2VNYXRyaXggfHwgIXNwYWNlLl9iYXNlTWF0cml4KSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgbGV0IG91dCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICAgIG11bHRpcGx5KG91dCwgdGhpcy5faW52ZXJzZUJhc2VNYXRyaXgsIHNwYWNlLl9iYXNlTWF0cml4KTsKICAgICAgICByZXR1cm4gbmV3IFhSUmlnaWRUcmFuc2Zvcm0kMShvdXQpOwogICAgICB9CiAgICB9CgogICAgY29uc3QgREVGQVVMVF9FTVVMQVRJT05fSEVJR0hUID0gMS42OwogICAgY29uc3QgUFJJVkFURSQzID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSUmVmZXJlbmNlU3BhY2UnKTsKICAgIGNvbnN0IFhSUmVmZXJlbmNlU3BhY2VUeXBlcyA9IFsKICAgICAgJ3ZpZXdlcicsCiAgICAgICdsb2NhbCcsCiAgICAgICdsb2NhbC1mbG9vcicsCiAgICAgICdib3VuZGVkLWZsb29yJywKICAgICAgJ3VuYm91bmRlZCcKICAgIF07CiAgICBmdW5jdGlvbiBpc0Zsb29yKHR5cGUpIHsKICAgICAgcmV0dXJuIHR5cGUgPT09ICdib3VuZGVkLWZsb29yJyB8fCB0eXBlID09PSAnbG9jYWwtZmxvb3InOwogICAgfQogICAgY2xhc3MgWFJSZWZlcmVuY2VTcGFjZSBleHRlbmRzIFhSU3BhY2UgewogICAgICBjb25zdHJ1Y3Rvcih0eXBlLCB0cmFuc2Zvcm0gPSBudWxsKSB7CiAgICAgICAgaWYgKCFYUlJlZmVyZW5jZVNwYWNlVHlwZXMuaW5jbHVkZXModHlwZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgWFJSZWZlcmVuY2VTcGFjZVR5cGUgbXVzdCBiZSBvbmUgb2YgJHtYUlJlZmVyZW5jZVNwYWNlVHlwZXN9YCk7CiAgICAgICAgfQogICAgICAgIHN1cGVyKHR5cGUpOwogICAgICAgIGlmICh0eXBlID09PSAnYm91bmRlZC1mbG9vcicgJiYgIXRyYW5zZm9ybSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBYUlJlZmVyZW5jZVNwYWNlIGNhbm5vdCB1c2UgJ2JvdW5kZWQtZmxvb3InIHR5cGUgaWYgdGhlIHBsYXRmb3JtIGRvZXMgbm90IHByb3ZpZGUgdGhlIGZsb29yIGxldmVsYCk7CiAgICAgICAgfQogICAgICAgIGlmIChpc0Zsb29yKHR5cGUpICYmICF0cmFuc2Zvcm0pIHsKICAgICAgICAgIHRyYW5zZm9ybSA9IGlkZW50aXR5KG5ldyBGbG9hdDMyQXJyYXkoMTYpKTsKICAgICAgICAgIHRyYW5zZm9ybVsxM10gPSBERUZBVUxUX0VNVUxBVElPTl9IRUlHSFQ7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2ludmVyc2VCYXNlTWF0cml4ID0gdHJhbnNmb3JtIHx8IGlkZW50aXR5KG5ldyBGbG9hdDMyQXJyYXkoMTYpKTsKICAgICAgICB0aGlzW1BSSVZBVEUkM10gPSB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgdHJhbnNmb3JtLAogICAgICAgICAgb3JpZ2luT2Zmc2V0IDogaWRlbnRpdHkobmV3IEZsb2F0MzJBcnJheSgxNikpLAogICAgICAgIH07CiAgICAgIH0KICAgICAgX3RyYW5zZm9ybUJhc2VQb3NlTWF0cml4KG91dCwgcG9zZSkgewogICAgICAgIG11bHRpcGx5KG91dCwgdGhpcy5faW52ZXJzZUJhc2VNYXRyaXgsIHBvc2UpOwogICAgICB9CiAgICAgIF9vcmlnaW5PZmZzZXRNYXRyaXgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQzXS5vcmlnaW5PZmZzZXQ7CiAgICAgIH0KICAgICAgX2FkanVzdEZvck9yaWdpbk9mZnNldCh0cmFuc2Zvcm1NYXRyaXgpIHsKICAgICAgICBsZXQgaW52ZXJzZU9yaWdpbk9mZnNldE1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICAgIGludmVydChpbnZlcnNlT3JpZ2luT2Zmc2V0TWF0cml4LCB0aGlzW1BSSVZBVEUkM10ub3JpZ2luT2Zmc2V0KTsKICAgICAgICBtdWx0aXBseSh0cmFuc2Zvcm1NYXRyaXgsIGludmVyc2VPcmlnaW5PZmZzZXRNYXRyaXgsIHRyYW5zZm9ybU1hdHJpeCk7CiAgICAgIH0KICAgICAgX2dldFNwYWNlUmVsYXRpdmVUcmFuc2Zvcm0oc3BhY2UpIHsKICAgICAgICBsZXQgdHJhbnNmb3JtID0gc3VwZXIuX2dldFNwYWNlUmVsYXRpdmVUcmFuc2Zvcm0oc3BhY2UpOwogICAgICAgIHRoaXMuX2FkanVzdEZvck9yaWdpbk9mZnNldCh0cmFuc2Zvcm0ubWF0cml4KTsKICAgICAgICByZXR1cm4gbmV3IFhSUmlnaWRUcmFuc2Zvcm0odHJhbnNmb3JtLm1hdHJpeCk7CiAgICAgIH0KICAgICAgZ2V0T2Zmc2V0UmVmZXJlbmNlU3BhY2UoYWRkaXRpb25hbE9mZnNldCkgewogICAgICAgIGxldCBuZXdTcGFjZSA9IG5ldyBYUlJlZmVyZW5jZVNwYWNlKAogICAgICAgICAgdGhpc1tQUklWQVRFJDNdLnR5cGUsCiAgICAgICAgICB0aGlzW1BSSVZBVEUkM10udHJhbnNmb3JtLAogICAgICAgICAgdGhpc1tQUklWQVRFJDNdLmJvdW5kcyk7CiAgICAgICAgbXVsdGlwbHkobmV3U3BhY2VbUFJJVkFURSQzXS5vcmlnaW5PZmZzZXQsIHRoaXNbUFJJVkFURSQzXS5vcmlnaW5PZmZzZXQsIGFkZGl0aW9uYWxPZmZzZXQubWF0cml4KTsKICAgICAgICByZXR1cm4gbmV3U3BhY2U7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDQgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFInKTsKICAgIGNvbnN0IFhSU2Vzc2lvbk1vZGVzID0gWydpbmxpbmUnLCAnaW1tZXJzaXZlLXZyJywgJ2ltbWVyc2l2ZS1hciddOwogICAgY29uc3QgREVGQVVMVF9TRVNTSU9OX09QVElPTlMgPSB7CiAgICAgICdpbmxpbmUnOiB7CiAgICAgICAgcmVxdWlyZWRGZWF0dXJlczogWyd2aWV3ZXInXSwKICAgICAgICBvcHRpb25hbEZlYXR1cmVzOiBbXSwKICAgICAgfSwKICAgICAgJ2ltbWVyc2l2ZS12cic6IHsKICAgICAgICByZXF1aXJlZEZlYXR1cmVzOiBbJ3ZpZXdlcicsICdsb2NhbCddLAogICAgICAgIG9wdGlvbmFsRmVhdHVyZXM6IFtdLAogICAgICB9LAogICAgICAnaW1tZXJzaXZlLWFyJzogewogICAgICAgIHJlcXVpcmVkRmVhdHVyZXM6IFsndmlld2VyJywgJ2xvY2FsJ10sCiAgICAgICAgb3B0aW9uYWxGZWF0dXJlczogW10sCiAgICAgIH0KICAgIH07CiAgICBjb25zdCBQT0xZRklMTF9SRVFVRVNUX1NFU1NJT05fRVJST1IgPQpgUG9seWZpbGwgRXJyb3I6IE11c3QgY2FsbCBuYXZpZ2F0b3IueHIuaXNTZXNzaW9uU3VwcG9ydGVkKCkgd2l0aCBhbnkgWFJTZXNzaW9uTW9kZQpvciBuYXZpZ2F0b3IueHIucmVxdWVzdFNlc3Npb24oJ2lubGluZScpIHByaW9yIHRvIHJlcXVlc3RpbmcgYW4gaW1tZXJzaXZlCnNlc3Npb24uIFRoaXMgaXMgYSBsaW1pdGF0aW9uIHNwZWNpZmljIHRvIHRoZSBXZWJYUiBQb2x5ZmlsbCBhbmQgZG9lcyBub3QgYXBwbHkKdG8gbmF0aXZlIGltcGxlbWVudGF0aW9ucyBvZiB0aGUgQVBJLmAgICAgOwogICAgY2xhc3MgWFJTeXN0ZW0gZXh0ZW5kcyBFdmVudFRhcmdldCB7CiAgICAgIGNvbnN0cnVjdG9yKGRldmljZVByb21pc2UpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIHRoaXNbUFJJVkFURSQ0XSA9IHsKICAgICAgICAgIGRldmljZTogbnVsbCwKICAgICAgICAgIGRldmljZVByb21pc2UsCiAgICAgICAgICBpbW1lcnNpdmVTZXNzaW9uOiBudWxsLAogICAgICAgICAgaW5saW5lU2Vzc2lvbnM6IG5ldyBTZXQoKSwKICAgICAgICB9OwogICAgICAgIGRldmljZVByb21pc2UudGhlbigoZGV2aWNlKSA9PiB7IHRoaXNbUFJJVkFURSQ0XS5kZXZpY2UgPSBkZXZpY2U7IH0pOwogICAgICB9CiAgICAgIGFzeW5jIGlzU2Vzc2lvblN1cHBvcnRlZChtb2RlKSB7CiAgICAgICAgaWYgKCF0aGlzW1BSSVZBVEUkNF0uZGV2aWNlKSB7CiAgICAgICAgICBhd2FpdCB0aGlzW1BSSVZBVEUkNF0uZGV2aWNlUHJvbWlzZTsKICAgICAgICB9CiAgICAgICAgaWYgKG1vZGUgIT0gJ2lubGluZScpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpc1tQUklWQVRFJDRdLmRldmljZS5pc1Nlc3Npb25TdXBwb3J0ZWQobW9kZSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpOwogICAgICB9CiAgICAgIGFzeW5jIHJlcXVlc3RTZXNzaW9uKG1vZGUsIG9wdGlvbnMpIHsKICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQ0XS5kZXZpY2UpIHsKICAgICAgICAgIGlmIChtb2RlICE9ICdpbmxpbmUnKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihQT0xZRklMTF9SRVFVRVNUX1NFU1NJT05fRVJST1IpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXdhaXQgdGhpc1tQUklWQVRFJDRdLmRldmljZVByb21pc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghWFJTZXNzaW9uTW9kZXMuaW5jbHVkZXMobW9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoCiAgICAgICAgICAgICAgYFRoZSBwcm92aWRlZCB2YWx1ZSAnJHttb2RlfScgaXMgbm90IGEgdmFsaWQgZW51bSB2YWx1ZSBvZiB0eXBlIFhSU2Vzc2lvbk1vZGVgKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGVmYXVsdE9wdGlvbnMgPSBERUZBVUxUX1NFU1NJT05fT1BUSU9OU1ttb2RlXTsKICAgICAgICBjb25zdCByZXF1aXJlZEZlYXR1cmVzID0gZGVmYXVsdE9wdGlvbnMucmVxdWlyZWRGZWF0dXJlcy5jb25jYXQoCiAgICAgICAgICAgIG9wdGlvbnMgJiYgb3B0aW9ucy5yZXF1aXJlZEZlYXR1cmVzID8gb3B0aW9ucy5yZXF1aXJlZEZlYXR1cmVzIDogW10pOwogICAgICAgIGNvbnN0IG9wdGlvbmFsRmVhdHVyZXMgPSBkZWZhdWx0T3B0aW9ucy5vcHRpb25hbEZlYXR1cmVzLmNvbmNhdCgKICAgICAgICAgICAgb3B0aW9ucyAmJiBvcHRpb25zLm9wdGlvbmFsRmVhdHVyZXMgPyBvcHRpb25zLm9wdGlvbmFsRmVhdHVyZXMgOiBbXSk7CiAgICAgICAgY29uc3QgZW5hYmxlZEZlYXR1cmVzID0gbmV3IFNldCgpOwogICAgICAgIGxldCByZXF1aXJlbWVudHNGYWlsZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKGxldCBmZWF0dXJlIG9mIHJlcXVpcmVkRmVhdHVyZXMpIHsKICAgICAgICAgIGlmICghdGhpc1tQUklWQVRFJDRdLmRldmljZS5pc0ZlYXR1cmVTdXBwb3J0ZWQoZmVhdHVyZSkpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihgVGhlIHJlcXVpcmVkIGZlYXR1cmUgJyR7ZmVhdHVyZX0nIGlzIG5vdCBzdXBwb3J0ZWRgKTsKICAgICAgICAgICAgcmVxdWlyZW1lbnRzRmFpbGVkID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVuYWJsZWRGZWF0dXJlcy5hZGQoZmVhdHVyZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChyZXF1aXJlbWVudHNGYWlsZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oJ1Nlc3Npb24gZG9lcyBub3Qgc3VwcG9ydCBzb21lIHJlcXVpcmVkIGZlYXR1cmVzJywgJ05vdFN1cHBvcnRlZEVycm9yJyk7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGZlYXR1cmUgb2Ygb3B0aW9uYWxGZWF0dXJlcykgewogICAgICAgICAgaWYgKCF0aGlzW1BSSVZBVEUkNF0uZGV2aWNlLmlzRmVhdHVyZVN1cHBvcnRlZChmZWF0dXJlKSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhgVGhlIG9wdGlvbmFsIGZlYXR1cmUgJyR7ZmVhdHVyZX0nIGlzIG5vdCBzdXBwb3J0ZWRgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVuYWJsZWRGZWF0dXJlcy5hZGQoZmVhdHVyZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IGF3YWl0IHRoaXNbUFJJVkFURSQ0XS5kZXZpY2UucmVxdWVzdFNlc3Npb24obW9kZSwgZW5hYmxlZEZlYXR1cmVzKTsKICAgICAgICBjb25zdCBzZXNzaW9uID0gbmV3IFhSU2Vzc2lvbih0aGlzW1BSSVZBVEUkNF0uZGV2aWNlLCBtb2RlLCBzZXNzaW9uSWQpOwogICAgICAgIGlmIChtb2RlID09ICdpbmxpbmUnKSB7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkNF0uaW5saW5lU2Vzc2lvbnMuYWRkKHNlc3Npb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkNF0uaW1tZXJzaXZlU2Vzc2lvbiA9IHNlc3Npb247CiAgICAgICAgfQogICAgICAgIGNvbnN0IG9uU2Vzc2lvbkVuZCA9ICgpID0+IHsKICAgICAgICAgIGlmIChtb2RlID09ICdpbmxpbmUnKSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQ0XS5pbmxpbmVTZXNzaW9ucy5kZWxldGUoc2Vzc2lvbik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkNF0uaW1tZXJzaXZlU2Vzc2lvbiA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2VuZCcsIG9uU2Vzc2lvbkVuZCk7CiAgICAgICAgfTsKICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZCcsIG9uU2Vzc2lvbkVuZCk7CiAgICAgICAgcmV0dXJuIHNlc3Npb247CiAgICAgIH0KICAgIH0KCiAgICBsZXQgbm93OwogICAgaWYgKCdwZXJmb3JtYW5jZScgaW4gX2dsb2JhbCA9PT0gZmFsc2UpIHsKICAgICAgbGV0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7CiAgICAgIG5vdyA9ICgpID0+IERhdGUubm93KCkgLSBzdGFydFRpbWU7CiAgICB9IGVsc2UgewogICAgICBub3cgPSAoKSA9PiBwZXJmb3JtYW5jZS5ub3coKTsKICAgIH0KICAgIHZhciBub3ckMSA9IG5vdzsKCiAgICBjb25zdCBQUklWQVRFJDUgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJQb3NlJyk7CiAgICBjbGFzcyBYUlBvc2UkMSB7CiAgICAgIGNvbnN0cnVjdG9yKHRyYW5zZm9ybSwgZW11bGF0ZWRQb3NpdGlvbikgewogICAgICAgIHRoaXNbUFJJVkFURSQ1XSA9IHsKICAgICAgICAgIHRyYW5zZm9ybSwKICAgICAgICAgIGVtdWxhdGVkUG9zaXRpb24sCiAgICAgICAgfTsKICAgICAgfQogICAgICBnZXQgdHJhbnNmb3JtKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDVdLnRyYW5zZm9ybTsgfQogICAgICBnZXQgZW11bGF0ZWRQb3NpdGlvbigpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ1XS5lbXVsYXRlZFBvc2l0aW9uOyB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQ2ID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSVmlld2VyUG9zZScpOwogICAgY2xhc3MgWFJWaWV3ZXJQb3NlIGV4dGVuZHMgWFJQb3NlJDEgewogICAgICBjb25zdHJ1Y3Rvcih0cmFuc2Zvcm0sIHZpZXdzLCBlbXVsYXRlZFBvc2l0aW9uID0gZmFsc2UpIHsKICAgICAgICBzdXBlcih0cmFuc2Zvcm0sIGVtdWxhdGVkUG9zaXRpb24pOwogICAgICAgIHRoaXNbUFJJVkFURSQ2XSA9IHsKICAgICAgICAgIHZpZXdzCiAgICAgICAgfTsKICAgICAgfQogICAgICBnZXQgdmlld3MoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQ2XS52aWV3czsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkNyA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlZpZXdwb3J0Jyk7CiAgICBjbGFzcyBYUlZpZXdwb3J0IHsKICAgICAgY29uc3RydWN0b3IodGFyZ2V0KSB7CiAgICAgICAgdGhpc1tQUklWQVRFJDddID0geyB0YXJnZXQgfTsKICAgICAgfQogICAgICBnZXQgeCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ3XS50YXJnZXQueDsgfQogICAgICBnZXQgeSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ3XS50YXJnZXQueTsgfQogICAgICBnZXQgd2lkdGgoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkN10udGFyZ2V0LndpZHRoOyB9CiAgICAgIGdldCBoZWlnaHQoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkN10udGFyZ2V0LmhlaWdodDsgfQogICAgfQoKICAgIGNvbnN0IFhSRXllcyA9IFsnbGVmdCcsICdyaWdodCcsICdub25lJ107CiAgICBjb25zdCBQUklWQVRFJDggPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJWaWV3Jyk7CiAgICBjbGFzcyBYUlZpZXcgewogICAgICBjb25zdHJ1Y3RvcihkZXZpY2UsIHRyYW5zZm9ybSwgZXllLCBzZXNzaW9uSWQpIHsKICAgICAgICBpZiAoIVhSRXllcy5pbmNsdWRlcyhleWUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFhSRXllIG11c3QgYmUgb25lIG9mOiAke1hSRXllc31gKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdGVtcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgY29uc3Qgdmlld3BvcnQgPSBuZXcgWFJWaWV3cG9ydCh0ZW1wKTsKICAgICAgICB0aGlzW1BSSVZBVEUkOF0gPSB7CiAgICAgICAgICBkZXZpY2UsCiAgICAgICAgICBleWUsCiAgICAgICAgICB2aWV3cG9ydCwKICAgICAgICAgIHRlbXAsCiAgICAgICAgICBzZXNzaW9uSWQsCiAgICAgICAgICB0cmFuc2Zvcm0sCiAgICAgICAgfTsKICAgICAgfQogICAgICBnZXQgZXllKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDhdLmV5ZTsgfQogICAgICBnZXQgcHJvamVjdGlvbk1hdHJpeCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ4XS5kZXZpY2UuZ2V0UHJvamVjdGlvbk1hdHJpeCh0aGlzLmV5ZSk7IH0KICAgICAgZ2V0IHRyYW5zZm9ybSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ4XS50cmFuc2Zvcm07IH0KICAgICAgX2dldFZpZXdwb3J0KGxheWVyKSB7CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQ4XS5kZXZpY2UuZ2V0Vmlld3BvcnQodGhpc1tQUklWQVRFJDhdLnNlc3Npb25JZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV5ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXllciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkOF0udGVtcCkpIHsKICAgICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkOF0udmlld3BvcnQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDkgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJGcmFtZScpOwogICAgY29uc3QgTk9OX0FDVElWRV9NU0cgPSAiWFJGcmFtZSBhY2Nlc3Mgb3V0c2lkZSB0aGUgY2FsbGJhY2sgdGhhdCBwcm9kdWNlZCBpdCBpcyBpbnZhbGlkLiI7CiAgICBjb25zdCBOT05fQU5JTUZSQU1FX01TRyA9ICJnZXRWaWV3ZXJQb3NlIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiBYUkZyYW1lIG9iamVjdHMgcGFzc2VkIHRvIFhSU2Vzc2lvbi5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgY2FsbGJhY2tzLiI7CiAgICBsZXQgTkVYVF9GUkFNRV9JRCA9IDA7CiAgICBjbGFzcyBYUkZyYW1lIHsKICAgICAgY29uc3RydWN0b3IoZGV2aWNlLCBzZXNzaW9uLCBzZXNzaW9uSWQpIHsKICAgICAgICB0aGlzW1BSSVZBVEUkOV0gPSB7CiAgICAgICAgICBpZDogKytORVhUX0ZSQU1FX0lELAogICAgICAgICAgYWN0aXZlOiBmYWxzZSwKICAgICAgICAgIGFuaW1hdGlvbkZyYW1lOiBmYWxzZSwKICAgICAgICAgIGRldmljZSwKICAgICAgICAgIHNlc3Npb24sCiAgICAgICAgICBzZXNzaW9uSWQKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCBzZXNzaW9uKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDldLnNlc3Npb247IH0KICAgICAgZ2V0Vmlld2VyUG9zZShyZWZlcmVuY2VTcGFjZSkgewogICAgICAgIGlmICghdGhpc1tQUklWQVRFJDldLmFuaW1hdGlvbkZyYW1lKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKE5PTl9BTklNRlJBTUVfTVNHLCAnSW52YWxpZFN0YXRlRXJyb3InKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzW1BSSVZBVEUkOV0uYWN0aXZlKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKE5PTl9BQ1RJVkVfTVNHLCAnSW52YWxpZFN0YXRlRXJyb3InKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpc1tQUklWQVRFJDldLmRldmljZTsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpc1tQUklWQVRFJDldLnNlc3Npb247CiAgICAgICAgc2Vzc2lvbltQUklWQVRFJDE1XS52aWV3ZXJTcGFjZS5fZW5zdXJlUG9zZVVwZGF0ZWQoZGV2aWNlLCB0aGlzW1BSSVZBVEUkOV0uaWQpOwogICAgICAgIHJlZmVyZW5jZVNwYWNlLl9lbnN1cmVQb3NlVXBkYXRlZChkZXZpY2UsIHRoaXNbUFJJVkFURSQ5XS5pZCk7CiAgICAgICAgbGV0IHZpZXdlclRyYW5zZm9ybSA9IHJlZmVyZW5jZVNwYWNlLl9nZXRTcGFjZVJlbGF0aXZlVHJhbnNmb3JtKHNlc3Npb25bUFJJVkFURSQxNV0udmlld2VyU3BhY2UpOwogICAgICAgIGNvbnN0IHZpZXdzID0gW107CiAgICAgICAgZm9yIChsZXQgdmlld1NwYWNlIG9mIHNlc3Npb25bUFJJVkFURSQxNV0udmlld1NwYWNlcykgewogICAgICAgICAgdmlld1NwYWNlLl9lbnN1cmVQb3NlVXBkYXRlZChkZXZpY2UsIHRoaXNbUFJJVkFURSQ5XS5pZCk7CiAgICAgICAgICBsZXQgdmlld1RyYW5zZm9ybSA9IHJlZmVyZW5jZVNwYWNlLl9nZXRTcGFjZVJlbGF0aXZlVHJhbnNmb3JtKHZpZXdTcGFjZSk7CiAgICAgICAgICBsZXQgdmlldyA9IG5ldyBYUlZpZXcoZGV2aWNlLCB2aWV3VHJhbnNmb3JtLCB2aWV3U3BhY2UuZXllLCB0aGlzW1BSSVZBVEUkOV0uc2Vzc2lvbklkKTsKICAgICAgICAgIHZpZXdzLnB1c2godmlldyk7CiAgICAgICAgfQogICAgICAgIGxldCB2aWV3ZXJQb3NlID0gbmV3IFhSVmlld2VyUG9zZSh2aWV3ZXJUcmFuc2Zvcm0sIHZpZXdzLCBmYWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICByZXR1cm4gdmlld2VyUG9zZTsKICAgICAgfQogICAgICBnZXRQb3NlKHNwYWNlLCBiYXNlU3BhY2UpIHsKICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQ5XS5hY3RpdmUpIHsKICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oTk9OX0FDVElWRV9NU0csICdJbnZhbGlkU3RhdGVFcnJvcicpOwogICAgICAgIH0KICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzW1BSSVZBVEUkOV0uZGV2aWNlOwogICAgICAgIGlmIChzcGFjZS5fc3BlY2lhbFR5cGUgPT09ICJ0YXJnZXQtcmF5IiB8fCBzcGFjZS5fc3BlY2lhbFR5cGUgPT09ICJncmlwIikgewogICAgICAgICAgcmV0dXJuIGRldmljZS5nZXRJbnB1dFBvc2UoCiAgICAgICAgICAgIHNwYWNlLl9pbnB1dFNvdXJjZSwgYmFzZVNwYWNlLCBzcGFjZS5fc3BlY2lhbFR5cGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzcGFjZS5fZW5zdXJlUG9zZVVwZGF0ZWQoZGV2aWNlLCB0aGlzW1BSSVZBVEUkOV0uaWQpOwogICAgICAgICAgYmFzZVNwYWNlLl9lbnN1cmVQb3NlVXBkYXRlZChkZXZpY2UsIHRoaXNbUFJJVkFURSQ5XS5pZCk7CiAgICAgICAgICBsZXQgdHJhbnNmb3JtID0gYmFzZVNwYWNlLl9nZXRTcGFjZVJlbGF0aXZlVHJhbnNmb3JtKHNwYWNlKTsKICAgICAgICAgIGlmICghdHJhbnNmb3JtKSB7IHJldHVybiBudWxsOyB9CiAgICAgICAgICByZXR1cm4gbmV3IFhSUG9zZSh0cmFuc2Zvcm0sIGZhbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkMTAgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJSZW5kZXJTdGF0ZScpOwogICAgY29uc3QgWFJSZW5kZXJTdGF0ZUluaXQgPSBPYmplY3QuZnJlZXplKHsKICAgICAgZGVwdGhOZWFyOiAwLjEsCiAgICAgIGRlcHRoRmFyOiAxMDAwLjAsCiAgICAgIGlubGluZVZlcnRpY2FsRmllbGRPZlZpZXc6IG51bGwsCiAgICAgIGJhc2VMYXllcjogbnVsbAogICAgfSk7CiAgICBjbGFzcyBYUlJlbmRlclN0YXRlIHsKICAgICAgY29uc3RydWN0b3Ioc3RhdGVJbml0ID0ge30pIHsKICAgICAgICBjb25zdCBjb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBYUlJlbmRlclN0YXRlSW5pdCwgc3RhdGVJbml0KTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTBdID0geyBjb25maWcgfTsKICAgICAgfQogICAgICBnZXQgZGVwdGhOZWFyKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDEwXS5jb25maWcuZGVwdGhOZWFyOyB9CiAgICAgIGdldCBkZXB0aEZhcigpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxMF0uY29uZmlnLmRlcHRoRmFyOyB9CiAgICAgIGdldCBpbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDEwXS5jb25maWcuaW5saW5lVmVydGljYWxGaWVsZE9mVmlldzsgfQogICAgICBnZXQgYmFzZUxheWVyKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDEwXS5jb25maWcuYmFzZUxheWVyOyB9CiAgICB9CgogICAgY29uc3QgUE9MWUZJTExFRF9YUl9DT01QQVRJQkxFID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL3BvbHlmaWxsZWQteHItY29tcGF0aWJsZScpOwogICAgY29uc3QgWFJfQ09NUEFUSUJMRSA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC94ci1jb21wYXRpYmxlJyk7CgogICAgY29uc3QgUFJJVkFURSQxMSA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUldlYkdMTGF5ZXInKTsKICAgIGNvbnN0IFhSV2ViR0xMYXllckluaXQgPSBPYmplY3QuZnJlZXplKHsKICAgICAgYW50aWFsaWFzOiB0cnVlLAogICAgICBkZXB0aDogZmFsc2UsCiAgICAgIHN0ZW5jaWw6IGZhbHNlLAogICAgICBhbHBoYTogdHJ1ZSwKICAgICAgbXVsdGl2aWV3OiBmYWxzZSwKICAgICAgaWdub3JlRGVwdGhWYWx1ZXM6IGZhbHNlLAogICAgICBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yOiAxLjAsCiAgICB9KTsKICAgIGxldCBYUldlYkdMTGF5ZXIkMSA9IGNsYXNzIFhSV2ViR0xMYXllciB7CiAgICAgIGNvbnN0cnVjdG9yKHNlc3Npb24sIGNvbnRleHQsIGxheWVySW5pdD17fSkgewogICAgICAgIGNvbnN0IGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIFhSV2ViR0xMYXllckluaXQsIGxheWVySW5pdCk7CiAgICAgICAgaWYgKCEoc2Vzc2lvbiBpbnN0YW5jZW9mIFhSU2Vzc2lvbiQxKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXNzaW9uIG11c3QgYmUgYSBYUlNlc3Npb24nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb24uZW5kZWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZFN0YXRlRXJyb3JgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvbnRleHRbUE9MWUZJTExFRF9YUl9DT01QQVRJQkxFXSkgewogICAgICAgICAgaWYgKGNvbnRleHRbWFJfQ09NUEFUSUJMRV0gIT09IHRydWUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkU3RhdGVFcnJvcmApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBmcmFtZWJ1ZmZlciA9IGNvbnRleHQuZ2V0UGFyYW1ldGVyKGNvbnRleHQuRlJBTUVCVUZGRVJfQklORElORyk7CiAgICAgICAgdGhpc1tQUklWQVRFJDExXSA9IHsKICAgICAgICAgIGNvbnRleHQsCiAgICAgICAgICBjb25maWcsCiAgICAgICAgICBmcmFtZWJ1ZmZlciwKICAgICAgICAgIHNlc3Npb24sCiAgICAgICAgfTsKICAgICAgfQogICAgICBnZXQgY29udGV4dCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxMV0uY29udGV4dDsgfQogICAgICBnZXQgYW50aWFsaWFzKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDExXS5jb25maWcuYW50aWFsaWFzOyB9CiAgICAgIGdldCBpZ25vcmVEZXB0aFZhbHVlcygpIHsgcmV0dXJuIHRydWU7IH0KICAgICAgZ2V0IGZyYW1lYnVmZmVyKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDExXS5mcmFtZWJ1ZmZlcjsgfQogICAgICBnZXQgZnJhbWVidWZmZXJXaWR0aCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxMV0uY29udGV4dC5kcmF3aW5nQnVmZmVyV2lkdGg7IH0KICAgICAgZ2V0IGZyYW1lYnVmZmVySGVpZ2h0KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDExXS5jb250ZXh0LmRyYXdpbmdCdWZmZXJIZWlnaHQ7IH0KICAgICAgZ2V0IF9zZXNzaW9uKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDExXS5zZXNzaW9uOyB9CiAgICAgIGdldFZpZXdwb3J0KHZpZXcpIHsKICAgICAgICByZXR1cm4gdmlldy5fZ2V0Vmlld3BvcnQodGhpcyk7CiAgICAgIH0KICAgICAgc3RhdGljIGdldE5hdGl2ZUZyYW1lYnVmZmVyU2NhbGVGYWN0b3Ioc2Vzc2lvbikgewogICAgICAgIGlmICghc2Vzc2lvbikgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignZ2V0TmF0aXZlRnJhbWVidWZmZXJTY2FsZUZhY3RvciBtdXN0IGJlIHBhc3NlZCBhIHNlc3Npb24uJykKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb25bUFJJVkFURSQxNV0uZW5kZWQpIHsgcmV0dXJuIDAuMDsgfQogICAgICAgIHJldHVybiAxLjA7CiAgICAgIH0KICAgIH07CgogICAgY29uc3QgUFJJVkFURSQxMiA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUklucHV0U291cmNlRXZlbnQnKTsKICAgIGNsYXNzIFhSSW5wdXRTb3VyY2VFdmVudCBleHRlbmRzIEV2ZW50IHsKICAgICAgY29uc3RydWN0b3IodHlwZSwgZXZlbnRJbml0RGljdCkgewogICAgICAgIHN1cGVyKHR5cGUsIGV2ZW50SW5pdERpY3QpOwogICAgICAgIHRoaXNbUFJJVkFURSQxMl0gPSB7CiAgICAgICAgICBmcmFtZTogZXZlbnRJbml0RGljdC5mcmFtZSwKICAgICAgICAgIGlucHV0U291cmNlOiBldmVudEluaXREaWN0LmlucHV0U291cmNlCiAgICAgICAgfTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgWFJJbnB1dFNvdXJjZUV2ZW50LnByb3RvdHlwZSk7CiAgICAgIH0KICAgICAgZ2V0IGZyYW1lKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDEyXS5mcmFtZTsgfQogICAgICBnZXQgaW5wdXRTb3VyY2UoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTJdLmlucHV0U291cmNlOyB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxMyA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlNlc3Npb25FdmVudCcpOwogICAgY2xhc3MgWFJTZXNzaW9uRXZlbnQgZXh0ZW5kcyBFdmVudCB7CiAgICAgIGNvbnN0cnVjdG9yKHR5cGUsIGV2ZW50SW5pdERpY3QpIHsKICAgICAgICBzdXBlcih0eXBlLCBldmVudEluaXREaWN0KTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTNdID0gewogICAgICAgICAgc2Vzc2lvbjogZXZlbnRJbml0RGljdC5zZXNzaW9uCiAgICAgICAgfTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgWFJTZXNzaW9uRXZlbnQucHJvdG90eXBlKTsKICAgICAgfQogICAgICBnZXQgc2Vzc2lvbigpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxM10uc2Vzc2lvbjsgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkMTQgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJJbnB1dFNvdXJjZXNDaGFuZ2VFdmVudCcpOwogICAgY2xhc3MgWFJJbnB1dFNvdXJjZXNDaGFuZ2VFdmVudCBleHRlbmRzIEV2ZW50IHsKICAgICAgY29uc3RydWN0b3IodHlwZSwgZXZlbnRJbml0RGljdCkgewogICAgICAgIHN1cGVyKHR5cGUsIGV2ZW50SW5pdERpY3QpOwogICAgICAgIHRoaXNbUFJJVkFURSQxNF0gPSB7CiAgICAgICAgICBzZXNzaW9uOiBldmVudEluaXREaWN0LnNlc3Npb24sCiAgICAgICAgICBhZGRlZDogZXZlbnRJbml0RGljdC5hZGRlZCwKICAgICAgICAgIHJlbW92ZWQ6IGV2ZW50SW5pdERpY3QucmVtb3ZlZAogICAgICAgIH07CiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIFhSSW5wdXRTb3VyY2VzQ2hhbmdlRXZlbnQucHJvdG90eXBlKTsKICAgICAgfQogICAgICBnZXQgc2Vzc2lvbigpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxNF0uc2Vzc2lvbjsgfQogICAgICBnZXQgYWRkZWQoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTRdLmFkZGVkOyB9CiAgICAgIGdldCByZW1vdmVkKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE0XS5yZW1vdmVkOyB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxNSA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlNlc3Npb24nKTsKICAgIGNsYXNzIFhSVmlld1NwYWNlIGV4dGVuZHMgWFJTcGFjZSB7CiAgICAgIGNvbnN0cnVjdG9yKGV5ZSkgewogICAgICAgIHN1cGVyKGV5ZSk7CiAgICAgIH0KICAgICAgZ2V0IGV5ZSgpIHsKICAgICAgICByZXR1cm4gdGhpcy5fc3BlY2lhbFR5cGU7CiAgICAgIH0KICAgICAgX29uUG9zZVVwZGF0ZShkZXZpY2UpIHsKICAgICAgICB0aGlzLl9pbnZlcnNlQmFzZU1hdHJpeCA9IGRldmljZS5nZXRCYXNlVmlld01hdHJpeCh0aGlzLl9zcGVjaWFsVHlwZSk7CiAgICAgIH0KICAgIH0KICAgIGNsYXNzIFhSU2Vzc2lvbiQxIGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgICBjb25zdHJ1Y3RvcihkZXZpY2UsIG1vZGUsIGlkKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICBsZXQgaW1tZXJzaXZlID0gbW9kZSAhPSAnaW5saW5lJzsKICAgICAgICBsZXQgaW5pdGlhbFJlbmRlclN0YXRlID0gbmV3IFhSUmVuZGVyU3RhdGUoewogICAgICAgICAgaW5saW5lVmVydGljYWxGaWVsZE9mVmlldzogaW1tZXJzaXZlID8gbnVsbCA6IE1hdGguUEkgKiAwLjUKICAgICAgICB9KTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdID0gewogICAgICAgICAgZGV2aWNlLAogICAgICAgICAgbW9kZSwKICAgICAgICAgIGltbWVyc2l2ZSwKICAgICAgICAgIGVuZGVkOiBmYWxzZSwKICAgICAgICAgIHN1c3BlbmRlZDogZmFsc2UsCiAgICAgICAgICBmcmFtZUNhbGxiYWNrczogW10sCiAgICAgICAgICBjdXJyZW50RnJhbWVDYWxsYmFja3M6IG51bGwsCiAgICAgICAgICBmcmFtZUhhbmRsZTogMCwKICAgICAgICAgIGRldmljZUZyYW1lSGFuZGxlOiBudWxsLAogICAgICAgICAgaWQsCiAgICAgICAgICBhY3RpdmVSZW5kZXJTdGF0ZTogaW5pdGlhbFJlbmRlclN0YXRlLAogICAgICAgICAgcGVuZGluZ1JlbmRlclN0YXRlOiBudWxsLAogICAgICAgICAgdmlld2VyU3BhY2U6IG5ldyBYUlJlZmVyZW5jZVNwYWNlKCJ2aWV3ZXIiKSwKICAgICAgICAgIHZpZXdTcGFjZXM6IFtdLAogICAgICAgICAgY3VycmVudElucHV0U291cmNlczogW10KICAgICAgICB9OwogICAgICAgIGlmIChpbW1lcnNpdmUpIHsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0udmlld1NwYWNlcy5wdXNoKG5ldyBYUlZpZXdTcGFjZSgnbGVmdCcpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFhSVmlld1NwYWNlKCdyaWdodCcpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS52aWV3U3BhY2VzLnB1c2gobmV3IFhSVmlld1NwYWNlKCdub25lJykpOwogICAgICAgIH0KICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uRGV2aWNlRnJhbWUgPSAoKSA9PiB7CiAgICAgICAgICBpZiAodGhpc1tQUklWQVRFJDE1XS5lbmRlZCB8fCB0aGlzW1BSSVZBVEUkMTVdLnN1c3BlbmRlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZUZyYW1lSGFuZGxlID0gbnVsbDsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3RhcnREZXZpY2VGcmFtZUxvb3AoKTsKICAgICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLnBlbmRpbmdSZW5kZXJTdGF0ZSAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmFjdGl2ZVJlbmRlclN0YXRlID0gbmV3IFhSUmVuZGVyU3RhdGUodGhpc1tQUklWQVRFJDE1XS5wZW5kaW5nUmVuZGVyU3RhdGUpOwogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnBlbmRpbmdSZW5kZXJTdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLmFjdGl2ZVJlbmRlclN0YXRlLmJhc2VMYXllcikgewogICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLm9uQmFzZUxheWVyU2V0KAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5pZCwKICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uYWN0aXZlUmVuZGVyU3RhdGUuYmFzZUxheWVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uYWN0aXZlUmVuZGVyU3RhdGUuYmFzZUxheWVyID09PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGZyYW1lID0gbmV3IFhSRnJhbWUoZGV2aWNlLCB0aGlzLCB0aGlzW1BSSVZBVEUkMTVdLmlkKTsKICAgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXNbUFJJVkFURSQxNV0uY3VycmVudEZyYW1lQ2FsbGJhY2tzID0gdGhpc1tQUklWQVRFJDE1XS5mcmFtZUNhbGxiYWNrczsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZnJhbWVDYWxsYmFja3MgPSBbXTsKICAgICAgICAgIGZyYW1lW1BSSVZBVEUkOV0uYWN0aXZlID0gdHJ1ZTsKICAgICAgICAgIGZyYW1lW1BSSVZBVEUkOV0uYW5pbWF0aW9uRnJhbWUgPSB0cnVlOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kZXZpY2Uub25GcmFtZVN0YXJ0KHRoaXNbUFJJVkFURSQxNV0uaWQsIHRoaXNbUFJJVkFURSQxNV0uYWN0aXZlUmVuZGVyU3RhdGUpOwogICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFNvdXJjZXNDaGFuZ2UoKTsKICAgICAgICAgIGNvbnN0IHJpZ2h0Tm93ID0gbm93JDEoKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgaWYgKCFjYWxsYmFja3NbaV0uY2FuY2VsbGVkICYmIHR5cGVvZiBjYWxsYmFja3NbaV0uY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrc1tpXS5jYWxsYmFjayhyaWdodE5vdywgZnJhbWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaChlcnIpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uY3VycmVudEZyYW1lQ2FsbGJhY2tzID0gbnVsbDsKICAgICAgICAgIGZyYW1lW1BSSVZBVEUkOV0uYWN0aXZlID0gZmFsc2U7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5vbkZyYW1lRW5kKHRoaXNbUFJJVkFURSQxNV0uaWQpOwogICAgICAgIH07CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5zdGFydERldmljZUZyYW1lTG9vcCA9ICgpID0+IHsKICAgICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLmRldmljZUZyYW1lSGFuZGxlID09PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlRnJhbWVIYW5kbGUgPSB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoCiAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5vbkRldmljZUZyYW1lCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnN0b3BEZXZpY2VGcmFtZUxvb3AgPSAoKSA9PiB7CiAgICAgICAgICBjb25zdCBoYW5kbGUgPSB0aGlzW1BSSVZBVEUkMTVdLmRldmljZUZyYW1lSGFuZGxlOwogICAgICAgICAgaWYgKGhhbmRsZSAhPT0gbnVsbCkgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5jYW5jZWxBbmltYXRpb25GcmFtZShoYW5kbGUpOwogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZUZyYW1lSGFuZGxlID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25FbmQgPSBzZXNzaW9uSWQgPT4gewogICAgICAgICAgaWYgKHNlc3Npb25JZCAhPT0gdGhpc1tQUklWQVRFJDE1XS5pZCkgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnN1c3BlbmRlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnN0YXJ0RGV2aWNlRnJhbWVMb29wKCk7CiAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnZm9jdXMnLCB7IHNlc3Npb246IHRoaXMgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZW5kZWQgPSB0cnVlOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5zdG9wRGV2aWNlRnJhbWVMb29wKCk7CiAgICAgICAgICBkZXZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC92ci1wcmVzZW50LWVuZCcsIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25FbmQpOwogICAgICAgICAgZGV2aWNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvdnItcHJlc2VudC1zdGFydCcsIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25TdGFydCk7CiAgICAgICAgICBkZXZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3Qtc3RhcnQnLCB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0U3RhcnQpOwogICAgICAgICAgZGV2aWNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc2VsZWN0LWVuZCcsIHRoaXNbUFJJVkFURSQxNV0ub25TZWxlY3RFbmQpOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdlbmQnLCBuZXcgWFJTZXNzaW9uRXZlbnQoJ2VuZCcsIHsgc2Vzc2lvbjogdGhpcyB9KSk7CiAgICAgICAgfTsKICAgICAgICBkZXZpY2UuYWRkRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC92ci1wcmVzZW50LWVuZCcsIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25FbmQpOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25TdGFydCA9IHNlc3Npb25JZCA9PiB7CiAgICAgICAgICBpZiAoc2Vzc2lvbklkID09PSB0aGlzW1BSSVZBVEUkMTVdLmlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3VzcGVuZGVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3RvcERldmljZUZyYW1lTG9vcCgpOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdibHVyJywgeyBzZXNzaW9uOiB0aGlzIH0pOwogICAgICAgIH07CiAgICAgICAgZGV2aWNlLmFkZEV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvdnItcHJlc2VudC1zdGFydCcsIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25TdGFydCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5vblNlbGVjdFN0YXJ0ID0gZXZ0ID0+IHsKICAgICAgICAgIGlmIChldnQuc2Vzc2lvbklkICE9PSB0aGlzW1BSSVZBVEUkMTVdLmlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGlzcGF0Y2hJbnB1dFNvdXJjZUV2ZW50KCdzZWxlY3RzdGFydCcsICBldnQuaW5wdXRTb3VyY2UpOwogICAgICAgIH07CiAgICAgICAgZGV2aWNlLmFkZEV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc2VsZWN0LXN0YXJ0JywgdGhpc1tQUklWQVRFJDE1XS5vblNlbGVjdFN0YXJ0KTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0RW5kID0gZXZ0ID0+IHsKICAgICAgICAgIGlmIChldnQuc2Vzc2lvbklkICE9PSB0aGlzW1BSSVZBVEUkMTVdLmlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGlzcGF0Y2hJbnB1dFNvdXJjZUV2ZW50KCdzZWxlY3RlbmQnLCAgZXZ0LmlucHV0U291cmNlKTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGlzcGF0Y2hJbnB1dFNvdXJjZUV2ZW50KCdzZWxlY3QnLCAgZXZ0LmlucHV0U291cmNlKTsKICAgICAgICB9OwogICAgICAgIGRldmljZS5hZGRFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNlbGVjdC1lbmQnLCB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0RW5kKTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uU3F1ZWV6ZVN0YXJ0ID0gZXZ0ID0+IHsKICAgICAgICAgIGlmIChldnQuc2Vzc2lvbklkICE9PSB0aGlzW1BSSVZBVEUkMTVdLmlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGlzcGF0Y2hJbnB1dFNvdXJjZUV2ZW50KCdzcXVlZXplc3RhcnQnLCAgZXZ0LmlucHV0U291cmNlKTsKICAgICAgICB9OwogICAgICAgIGRldmljZS5hZGRFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNxdWVlemUtc3RhcnQnLCB0aGlzW1BSSVZBVEUkMTVdLm9uU3F1ZWV6ZVN0YXJ0KTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uU3F1ZWV6ZUVuZCA9IGV2dCA9PiB7CiAgICAgICAgICBpZiAoZXZ0LnNlc3Npb25JZCAhPT0gdGhpc1tQUklWQVRFJDE1XS5pZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRpc3BhdGNoSW5wdXRTb3VyY2VFdmVudCgnc3F1ZWV6ZWVuZCcsICBldnQuaW5wdXRTb3VyY2UpOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kaXNwYXRjaElucHV0U291cmNlRXZlbnQoJ3NxdWVlemUnLCAgZXZ0LmlucHV0U291cmNlKTsKICAgICAgICB9OwogICAgICAgIGRldmljZS5hZGRFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNxdWVlemUtZW5kJywgdGhpc1tQUklWQVRFJDE1XS5vblNxdWVlemVFbmQpOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGlzcGF0Y2hJbnB1dFNvdXJjZUV2ZW50ID0gKHR5cGUsIGlucHV0U291cmNlKSA9PiB7CiAgICAgICAgICBjb25zdCBmcmFtZSA9IG5ldyBYUkZyYW1lKGRldmljZSwgdGhpcywgdGhpc1tQUklWQVRFJDE1XS5pZCk7CiAgICAgICAgICBjb25zdCBldmVudCA9IG5ldyBYUklucHV0U291cmNlRXZlbnQodHlwZSwgeyBmcmFtZSwgaW5wdXRTb3VyY2UgfSk7CiAgICAgICAgICBmcmFtZVtQUklWQVRFJDldLmFjdGl2ZSA9IHRydWU7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodHlwZSwgZXZlbnQpOwogICAgICAgICAgZnJhbWVbUFJJVkFURSQ5XS5hY3RpdmUgPSBmYWxzZTsKICAgICAgICB9OwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3RhcnREZXZpY2VGcmFtZUxvb3AoKTsKICAgICAgICB0aGlzLm9uYmx1ciA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm9uZm9jdXMgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5vbnJlc2V0cG9zZSA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm9uZW5kID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMub25zZWxlY3QgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5vbnNlbGVjdHN0YXJ0ID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMub25zZWxlY3RlbmQgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZ2V0IHJlbmRlclN0YXRlKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE1XS5hY3RpdmVSZW5kZXJTdGF0ZTsgfQogICAgICBnZXQgZW52aXJvbm1lbnRCbGVuZE1vZGUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLmVudmlyb25tZW50QmxlbmRNb2RlIHx8ICdvcGFxdWUnOwogICAgICB9CiAgICAgIGFzeW5jIHJlcXVlc3RSZWZlcmVuY2VTcGFjZSh0eXBlKSB7CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uZW5kZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKCFYUlJlZmVyZW5jZVNwYWNlVHlwZXMuaW5jbHVkZXModHlwZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFhSUmVmZXJlbmNlU3BhY2VUeXBlIG11c3QgYmUgb25lIG9mICR7WFJSZWZlcmVuY2VTcGFjZVR5cGVzfWApOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLmRvZXNTZXNzaW9uU3VwcG9ydFJlZmVyZW5jZVNwYWNlKHRoaXNbUFJJVkFURSQxNV0uaWQsIHR5cGUpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKGBUaGUgJHt0eXBlfSByZWZlcmVuY2Ugc3BhY2UgaXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIHNlc3Npb24uYCwgJ05vdFN1cHBvcnRlZEVycm9yJyk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlID09PSAndmlld2VyJykgewogICAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxNV0udmlld2VyU3BhY2U7CiAgICAgICAgfQogICAgICAgIGxldCB0cmFuc2Zvcm0gPSBhd2FpdCB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5yZXF1ZXN0RnJhbWVPZlJlZmVyZW5jZVRyYW5zZm9ybSh0eXBlKTsKICAgICAgICBpZiAodHlwZSA9PT0gJ2JvdW5kZWQtZmxvb3InKSB7CiAgICAgICAgICBpZiAoIXRyYW5zZm9ybSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKGAke3R5cGV9IFhSUmVmZXJlbmNlU3BhY2Ugbm90IHN1cHBvcnRlZCBieSB0aGlzIGRldmljZS5gLCAnTm90U3VwcG9ydGVkRXJyb3InKTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBib3VuZHMgPSB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5yZXF1ZXN0U3RhZ2VCb3VuZHMoKTsKICAgICAgICAgIGlmICghYm91bmRzKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oYCR7dHlwZX0gWFJSZWZlcmVuY2VTcGFjZSBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgZGV2aWNlLmAsICdOb3RTdXBwb3J0ZWRFcnJvcicpOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihgVGhlIFdlYlhSIHBvbHlmaWxsIGRvZXMgbm90IHN1cHBvcnQgdGhlICR7dHlwZX0gcmVmZXJlbmNlIHNwYWNlIHlldC5gLCAnTm90U3VwcG9ydGVkRXJyb3InKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBYUlJlZmVyZW5jZVNwYWNlKHR5cGUsIHRyYW5zZm9ybSk7CiAgICAgIH0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrKSB7CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uZW5kZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3QgaGFuZGxlID0gKyt0aGlzW1BSSVZBVEUkMTVdLmZyYW1lSGFuZGxlOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZnJhbWVDYWxsYmFja3MucHVzaCh7CiAgICAgICAgICBoYW5kbGUsCiAgICAgICAgICBjYWxsYmFjaywKICAgICAgICAgIGNhbmNlbGxlZDogZmFsc2UKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gaGFuZGxlOwogICAgICB9CiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZSkgewogICAgICAgIGxldCBjYWxsYmFja3MgPSB0aGlzW1BSSVZBVEUkMTVdLmZyYW1lQ2FsbGJhY2tzOwogICAgICAgIGxldCBpbmRleCA9IGNhbGxiYWNrcy5maW5kSW5kZXgoZCA9PiBkICYmIGQuaGFuZGxlID09PSBoYW5kbGUpOwogICAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgICBjYWxsYmFja3NbaW5kZXhdLmNhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICB9CiAgICAgICAgY2FsbGJhY2tzID0gdGhpc1tQUklWQVRFJDE1XS5jdXJyZW50RnJhbWVDYWxsYmFja3M7CiAgICAgICAgaWYgKGNhbGxiYWNrcykgewogICAgICAgICAgaW5kZXggPSBjYWxsYmFja3MuZmluZEluZGV4KGQgPT4gZCAmJiBkLmhhbmRsZSA9PT0gaGFuZGxlKTsKICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgICAgICAgIGNhbGxiYWNrc1tpbmRleF0uY2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZ2V0IGlucHV0U291cmNlcygpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE1XS5kZXZpY2UuZ2V0SW5wdXRTb3VyY2VzKCk7CiAgICAgIH0KICAgICAgYXN5bmMgZW5kKCkgewogICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLmVuZGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLmltbWVyc2l2ZSkgewogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5lbmRlZCA9IHRydWU7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5yZW1vdmVFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL3ZyLXByZXNlbnQtc3RhcnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25TdGFydCk7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5yZW1vdmVFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL3ZyLXByZXNlbnQtZW5kJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uUHJlc2VudGF0aW9uRW5kKTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc2VsZWN0LXN0YXJ0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0U3RhcnQpOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kZXZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3QtZW5kJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0RW5kKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnZW5kJywgbmV3IFhSU2Vzc2lvbkV2ZW50KCdlbmQnLCB7IHNlc3Npb246IHRoaXMgfSkpOwogICAgICAgIH0KICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnN0b3BEZXZpY2VGcmFtZUxvb3AoKTsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE1XS5kZXZpY2UuZW5kU2Vzc2lvbih0aGlzW1BSSVZBVEUkMTVdLmlkKTsKICAgICAgfQogICAgICB1cGRhdGVSZW5kZXJTdGF0ZShuZXdTdGF0ZSkgewogICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLmVuZGVkKSB7CiAgICAgICAgICBjb25zdCBtZXNzYWdlID0gIkNhbid0IGNhbGwgdXBkYXRlUmVuZGVyU3RhdGUgb24gYW4gWFJTZXNzaW9uICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICJ0aGF0IGhhcyBhbHJlYWR5IGVuZGVkLiI7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgfQogICAgICAgIGlmIChuZXdTdGF0ZS5iYXNlTGF5ZXIgJiYgKG5ld1N0YXRlLmJhc2VMYXllci5fc2Vzc2lvbiAhPT0gdGhpcykpIHsKICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAiQ2FsbGVkIHVwZGF0ZVJlbmRlclN0YXRlIHdpdGggYSBiYXNlIGxheWVyIHRoYXQgd2FzICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICJjcmVhdGVkIGJ5IGEgZGlmZmVyZW50IHNlc3Npb24uIjsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZm92U2V0ID0gKG5ld1N0YXRlLmlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcgIT09IG51bGwpICYmCiAgICAgICAgICAgICAgICAgICAgICAgKG5ld1N0YXRlLmlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcgIT09IHVuZGVmaW5lZCk7CiAgICAgICAgaWYgKGZvdlNldCkgewogICAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uaW1tZXJzaXZlKSB7CiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAiaW5saW5lVmVydGljYWxGaWVsZE9mVmlldyBtdXN0IG5vdCBiZSBzZXQgZm9yIGFuICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlhSUmVuZGVyU3RhdGUgcGFzc2VkIHRvIHVwZGF0ZVJlbmRlclN0YXRlIGZvciBhbiAiICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJpbW1lcnNpdmUgc2Vzc2lvbi4iOwogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXdTdGF0ZS5pbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3ID0gTWF0aC5taW4oCiAgICAgICAgICAgICAgMy4xMywgTWF0aC5tYXgoMC4wMSwgbmV3U3RhdGUuaW5saW5lVmVydGljYWxGaWVsZE9mVmlldykpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpc1tQUklWQVRFJDE1XS5wZW5kaW5nUmVuZGVyU3RhdGUgPT09IG51bGwpIHsKICAgICAgICAgIGNvbnN0IGFjdGl2ZVJlbmRlclN0YXRlID0gdGhpc1tQUklWQVRFJDE1XS5hY3RpdmVSZW5kZXJTdGF0ZTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0ucGVuZGluZ1JlbmRlclN0YXRlID0gewogICAgICAgICAgICBkZXB0aE5lYXI6IGFjdGl2ZVJlbmRlclN0YXRlLmRlcHRoTmVhciwKICAgICAgICAgICAgZGVwdGhGYXI6IGFjdGl2ZVJlbmRlclN0YXRlLmRlcHRoRmFyLAogICAgICAgICAgICBpbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3OiBhY3RpdmVSZW5kZXJTdGF0ZS5pbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3LAogICAgICAgICAgICBiYXNlTGF5ZXI6IGFjdGl2ZVJlbmRlclN0YXRlLmJhc2VMYXllcgogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzW1BSSVZBVEUkMTVdLnBlbmRpbmdSZW5kZXJTdGF0ZSwgbmV3U3RhdGUpOwogICAgICB9CiAgICAgIF9jaGVja0lucHV0U291cmNlc0NoYW5nZSgpIHsKICAgICAgICBjb25zdCBhZGRlZCA9IFtdOwogICAgICAgIGNvbnN0IHJlbW92ZWQgPSBbXTsKICAgICAgICBjb25zdCBuZXdJbnB1dFNvdXJjZXMgPSB0aGlzLmlucHV0U291cmNlczsKICAgICAgICBjb25zdCBvbGRJbnB1dFNvdXJjZXMgPSB0aGlzW1BSSVZBVEUkMTVdLmN1cnJlbnRJbnB1dFNvdXJjZXM7CiAgICAgICAgZm9yIChjb25zdCBuZXdJbnB1dFNvdXJjZSBvZiBuZXdJbnB1dFNvdXJjZXMpIHsKICAgICAgICAgIGlmICghb2xkSW5wdXRTb3VyY2VzLmluY2x1ZGVzKG5ld0lucHV0U291cmNlKSkgewogICAgICAgICAgICBhZGRlZC5wdXNoKG5ld0lucHV0U291cmNlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBvbGRJbnB1dFNvdXJjZSBvZiBvbGRJbnB1dFNvdXJjZXMpIHsKICAgICAgICAgIGlmICghbmV3SW5wdXRTb3VyY2VzLmluY2x1ZGVzKG9sZElucHV0U291cmNlKSkgewogICAgICAgICAgICByZW1vdmVkLnB1c2gob2xkSW5wdXRTb3VyY2UpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoYWRkZWQubGVuZ3RoID4gMCB8fCByZW1vdmVkLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnaW5wdXRzb3VyY2VzY2hhbmdlJywgbmV3IFhSSW5wdXRTb3VyY2VzQ2hhbmdlRXZlbnQoJ2lucHV0c291cmNlc2NoYW5nZScsIHsKICAgICAgICAgICAgc2Vzc2lvbjogdGhpcywKICAgICAgICAgICAgYWRkZWQ6IGFkZGVkLAogICAgICAgICAgICByZW1vdmVkOiByZW1vdmVkCiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICAgIHRoaXNbUFJJVkFURSQxNV0uY3VycmVudElucHV0U291cmNlcy5sZW5ndGggPSAwOwogICAgICAgIGZvciAoY29uc3QgbmV3SW5wdXRTb3VyY2Ugb2YgbmV3SW5wdXRTb3VyY2VzKSB7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmN1cnJlbnRJbnB1dFNvdXJjZXMucHVzaChuZXdJbnB1dFNvdXJjZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxNiA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUklucHV0U291cmNlJyk7CiAgICBjbGFzcyBYUklucHV0U291cmNlIHsKICAgICAgY29uc3RydWN0b3IoaW1wbCkgewogICAgICAgIHRoaXNbUFJJVkFURSQxNl0gPSB7CiAgICAgICAgICBpbXBsLAogICAgICAgICAgZ3JpcFNwYWNlOiBuZXcgWFJTcGFjZSgiZ3JpcCIsIHRoaXMpLAogICAgICAgICAgdGFyZ2V0UmF5U3BhY2U6IG5ldyBYUlNwYWNlKCJ0YXJnZXQtcmF5IiwgdGhpcykKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCBoYW5kZWRuZXNzKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE2XS5pbXBsLmhhbmRlZG5lc3M7IH0KICAgICAgZ2V0IHRhcmdldFJheU1vZGUoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTZdLmltcGwudGFyZ2V0UmF5TW9kZTsgfQogICAgICBnZXQgZ3JpcFNwYWNlKCkgewogICAgICAgIGxldCBtb2RlID0gdGhpc1tQUklWQVRFJDE2XS5pbXBsLnRhcmdldFJheU1vZGU7CiAgICAgICAgaWYgKG1vZGUgPT09ICJnYXplIiB8fCBtb2RlID09PSAic2NyZWVuIikgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMTZdLmdyaXBTcGFjZTsKICAgICAgfQogICAgICBnZXQgdGFyZ2V0UmF5U3BhY2UoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTZdLnRhcmdldFJheVNwYWNlOyB9CiAgICAgIGdldCBwcm9maWxlcygpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxNl0uaW1wbC5wcm9maWxlczsgfQogICAgICBnZXQgZ2FtZXBhZCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxNl0uaW1wbC5nYW1lcGFkOyB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxNyA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlJlZmVyZW5jZVNwYWNlRXZlbnQnKTsKICAgIGNsYXNzIFhSUmVmZXJlbmNlU3BhY2VFdmVudCBleHRlbmRzIEV2ZW50IHsKICAgICAgY29uc3RydWN0b3IodHlwZSwgZXZlbnRJbml0RGljdCkgewogICAgICAgIHN1cGVyKHR5cGUsIGV2ZW50SW5pdERpY3QpOwogICAgICAgIHRoaXNbUFJJVkFURSQxN10gPSB7CiAgICAgICAgICByZWZlcmVuY2VTcGFjZTogZXZlbnRJbml0RGljdC5yZWZlcmVuY2VTcGFjZSwKICAgICAgICAgIHRyYW5zZm9ybTogZXZlbnRJbml0RGljdC50cmFuc2Zvcm0gfHwgbnVsbAogICAgICAgIH07CiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIFhSUmVmZXJlbmNlU3BhY2VFdmVudC5wcm90b3R5cGUpOwogICAgICB9CiAgICAgIGdldCByZWZlcmVuY2VTcGFjZSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxN10ucmVmZXJlbmNlU3BhY2U7IH0KICAgICAgZ2V0IHRyYW5zZm9ybSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxN10udHJhbnNmb3JtOyB9CiAgICB9CgogICAgdmFyIEFQSSA9IHsKICAgICAgWFJTeXN0ZW0sCiAgICAgIFhSU2Vzc2lvbjogWFJTZXNzaW9uJDEsCiAgICAgIFhSU2Vzc2lvbkV2ZW50LAogICAgICBYUkZyYW1lLAogICAgICBYUlZpZXcsCiAgICAgIFhSVmlld3BvcnQsCiAgICAgIFhSVmlld2VyUG9zZSwKICAgICAgWFJXZWJHTExheWVyOiBYUldlYkdMTGF5ZXIkMSwKICAgICAgWFJTcGFjZSwKICAgICAgWFJSZWZlcmVuY2VTcGFjZSwKICAgICAgWFJSZWZlcmVuY2VTcGFjZUV2ZW50LAogICAgICBYUklucHV0U291cmNlLAogICAgICBYUklucHV0U291cmNlRXZlbnQsCiAgICAgIFhSSW5wdXRTb3VyY2VzQ2hhbmdlRXZlbnQsCiAgICAgIFhSUmVuZGVyU3RhdGUsCiAgICAgIFhSUmlnaWRUcmFuc2Zvcm06IFhSUmlnaWRUcmFuc2Zvcm0kMSwKICAgICAgWFJQb3NlOiBYUlBvc2UkMSwKICAgIH07CgogICAgY29uc3QgcG9seWZpbGxNYWtlWFJDb21wYXRpYmxlID0gQ29udGV4dCA9PiB7CiAgICAgIGlmICh0eXBlb2YgQ29udGV4dC5wcm90b3R5cGUubWFrZVhSQ29tcGF0aWJsZSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBDb250ZXh0LnByb3RvdHlwZS5tYWtlWFJDb21wYXRpYmxlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXNbWFJfQ09NUEFUSUJMRV0gPSB0cnVlOwogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgfTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgY29uc3QgcG9seWZpbGxHZXRDb250ZXh0ID0gKENhbnZhcykgPT4gewogICAgICBjb25zdCBnZXRDb250ZXh0ID0gQ2FudmFzLnByb3RvdHlwZS5nZXRDb250ZXh0OwogICAgICBDYW52YXMucHJvdG90eXBlLmdldENvbnRleHQgPSBmdW5jdGlvbiAoY29udGV4dFR5cGUsIGdsQXR0cmlicykgewogICAgICAgIGNvbnN0IGN0eCA9IGdldENvbnRleHQuY2FsbCh0aGlzLCBjb250ZXh0VHlwZSwgZ2xBdHRyaWJzKTsKICAgICAgICBpZiAoY3R4KSB7CiAgICAgICAgICBjdHhbUE9MWUZJTExFRF9YUl9DT01QQVRJQkxFXSA9IHRydWU7CiAgICAgICAgICBpZiAoZ2xBdHRyaWJzICYmICgneHJDb21wYXRpYmxlJyBpbiBnbEF0dHJpYnMpKSB7CiAgICAgICAgICAgIGN0eFtYUl9DT01QQVRJQkxFXSA9IGdsQXR0cmlicy54ckNvbXBhdGlibGU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdHg7CiAgICAgIH07CiAgICB9OwoKICAgIGNvbnN0IGlzSW1hZ2VCaXRtYXBTdXBwb3J0ZWQgPSBnbG9iYWwgPT4KICAgICAgISEoZ2xvYmFsLkltYWdlQml0bWFwUmVuZGVyaW5nQ29udGV4dCAmJgogICAgICAgICBnbG9iYWwuY3JlYXRlSW1hZ2VCaXRtYXApOwogICAgY29uc3QgaXNNb2JpbGUgPSBnbG9iYWwgPT4gewogICAgICB2YXIgY2hlY2sgPSBmYWxzZTsKICAgICAgKGZ1bmN0aW9uKGEpe2lmKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSl8fC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLDQpKSljaGVjayA9IHRydWU7fSkoZ2xvYmFsLm5hdmlnYXRvci51c2VyQWdlbnR8fGdsb2JhbC5uYXZpZ2F0b3IudmVuZG9yfHxnbG9iYWwub3BlcmEpOwogICAgICByZXR1cm4gY2hlY2s7CiAgICB9OwogICAgY29uc3QgYXBwbHlDYW52YXNTdHlsZXNGb3JNaW5pbWFsUmVuZGVyaW5nID0gY2FudmFzID0+IHsKICAgICAgY2FudmFzLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICBjYW52YXMuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICBjYW52YXMuc3R5bGUud2lkdGggPSBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gJzFweCc7CiAgICAgIGNhbnZhcy5zdHlsZS50b3AgPSBjYW52YXMuc3R5bGUubGVmdCA9ICcwcHgnOwogICAgfTsKCiAgICB2YXIgY29tbW9uanNHbG9iYWwgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCgogICAgZnVuY3Rpb24gdW53cmFwRXhwb3J0cyAoeCkgewogICAgCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUoZm4sIG1vZHVsZSkgewogICAgCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKICAgIH0KCiAgICB2YXIgY2FyZGJvYXJkVnJEaXNwbGF5ID0gY3JlYXRlQ29tbW9uanNNb2R1bGUoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICAgIAltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsKICAgIH0oY29tbW9uanNHbG9iYWwsIChmdW5jdGlvbiAoKSB7IHZhciBjbGFzc0NhbGxDaGVjayA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgICAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKICAgICAgfQogICAgfTsKICAgIHZhciBjcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKICAgICAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgICAgIGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7CiAgICAgICAgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICAgICAgcmV0dXJuIENvbnN0cnVjdG9yOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIHNsaWNlZFRvQXJyYXkgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIHNsaWNlSXRlcmF0b3IoYXJyLCBpKSB7CiAgICAgICAgdmFyIF9hcnIgPSBbXTsKICAgICAgICB2YXIgX24gPSB0cnVlOwogICAgICAgIHZhciBfZCA9IGZhbHNlOwogICAgICAgIHZhciBfZSA9IHVuZGVmaW5lZDsKICAgICAgICB0cnkgewogICAgICAgICAgZm9yICh2YXIgX2kgPSBhcnJbU3ltYm9sLml0ZXJhdG9yXSgpLCBfczsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkgewogICAgICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwogICAgICAgICAgICBpZiAoaSAmJiBfYXJyLmxlbmd0aCA9PT0gaSkgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICBfZCA9IHRydWU7CiAgICAgICAgICBfZSA9IGVycjsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKCFfbiAmJiBfaVsicmV0dXJuIl0pIF9pWyJyZXR1cm4iXSgpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKF9kKSB0aHJvdyBfZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIF9hcnI7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcnIsIGkpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7CiAgICAgICAgICByZXR1cm4gYXJyOwogICAgICAgIH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7CiAgICAgICAgICByZXR1cm4gc2xpY2VJdGVyYXRvcihhcnIsIGkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7CiAgICAgICAgfQogICAgICB9OwogICAgfSgpOwogICAgdmFyIE1JTl9USU1FU1RFUCA9IDAuMDAxOwogICAgdmFyIE1BWF9USU1FU1RFUCA9IDE7CiAgICB2YXIgZGF0YVVyaSA9IGZ1bmN0aW9uIGRhdGFVcmkobWltZVR5cGUsIHN2ZykgewogICAgICByZXR1cm4gJ2RhdGE6JyArIG1pbWVUeXBlICsgJywnICsgZW5jb2RlVVJJQ29tcG9uZW50KHN2Zyk7CiAgICB9OwogICAgdmFyIGxlcnAgPSBmdW5jdGlvbiBsZXJwKGEsIGIsIHQpIHsKICAgICAgcmV0dXJuIGEgKyAoYiAtIGEpICogdDsKICAgIH07CiAgICB2YXIgaXNJT1MgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpc0lPUyA9IC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KG5hdmlnYXRvci5wbGF0Zm9ybSk7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGlzSU9TOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGlzV2ViVmlld0FuZHJvaWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpc1dlYlZpZXdBbmRyb2lkID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdWZXJzaW9uJykgIT09IC0xICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQW5kcm9pZCcpICE9PSAtMSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0Nocm9tZScpICE9PSAtMTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaXNXZWJWaWV3QW5kcm9pZDsKICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBpc1NhZmFyaSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzU2FmYXJpID0gL14oKD8hY2hyb21lfGFuZHJvaWQpLikqc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaXNTYWZhcmk7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgaXNGaXJlZm94QW5kcm9pZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzRmlyZWZveEFuZHJvaWQgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0ZpcmVmb3gnKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdBbmRyb2lkJykgIT09IC0xOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBpc0ZpcmVmb3hBbmRyb2lkOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGdldENocm9tZVZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBtYXRjaCA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLy4qQ2hyb21lXC8oWzAtOV0rKS8pOwogICAgICB2YXIgdmFsdWUgPSBtYXRjaCA/IHBhcnNlSW50KG1hdGNoWzFdLCAxMCkgOiBudWxsOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBpc1NhZmFyaVdpdGhvdXREZXZpY2VNb3Rpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2YWx1ZSA9IGZhbHNlOwogICAgICB2YWx1ZSA9IGlzSU9TKCkgJiYgaXNTYWZhcmkoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJzEzXzQnKSAhPT0gLTE7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGlzQ2hyb21lV2l0aG91dERldmljZU1vdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHZhbHVlID0gZmFsc2U7CiAgICAgIGlmIChnZXRDaHJvbWVWZXJzaW9uKCkgPT09IDY1KSB7CiAgICAgICAgdmFyIG1hdGNoID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvLipDaHJvbWVcLyhbMC05XC5dKikvKTsKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIHZhciBfbWF0Y2gkMSRzcGxpdCA9IG1hdGNoWzFdLnNwbGl0KCcuJyksCiAgICAgICAgICAgICAgX21hdGNoJDEkc3BsaXQyID0gc2xpY2VkVG9BcnJheShfbWF0Y2gkMSRzcGxpdCwgNCk7CiAgICAgICAgICAgICAgX21hdGNoJDEkc3BsaXQyWzBdOwogICAgICAgICAgICAgIF9tYXRjaCQxJHNwbGl0MlsxXTsKICAgICAgICAgICAgICB2YXIgYnJhbmNoID0gX21hdGNoJDEkc3BsaXQyWzJdLAogICAgICAgICAgICAgIGJ1aWxkID0gX21hdGNoJDEkc3BsaXQyWzNdOwogICAgICAgICAgdmFsdWUgPSBwYXJzZUludChicmFuY2gsIDEwKSA9PT0gMzMyNSAmJiBwYXJzZUludChidWlsZCwgMTApIDwgMTQ4OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBpc1I3ID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXNSNyA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignUjcgQnVpbGQnKSAhPT0gLTE7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGlzUjc7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgaXNMYW5kc2NhcGVNb2RlID0gZnVuY3Rpb24gaXNMYW5kc2NhcGVNb2RlKCkgewogICAgICB2YXIgcnRuID0gd2luZG93Lm9yaWVudGF0aW9uID09IDkwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PSAtOTA7CiAgICAgIHJldHVybiBpc1I3KCkgPyAhcnRuIDogcnRuOwogICAgfTsKICAgIHZhciBpc1RpbWVzdGFtcERlbHRhVmFsaWQgPSBmdW5jdGlvbiBpc1RpbWVzdGFtcERlbHRhVmFsaWQodGltZXN0YW1wRGVsdGFTKSB7CiAgICAgIGlmIChpc05hTih0aW1lc3RhbXBEZWx0YVMpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICh0aW1lc3RhbXBEZWx0YVMgPD0gTUlOX1RJTUVTVEVQKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICh0aW1lc3RhbXBEZWx0YVMgPiBNQVhfVElNRVNURVApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgdmFyIGdldFNjcmVlbldpZHRoID0gZnVuY3Rpb24gZ2V0U2NyZWVuV2lkdGgoKSB7CiAgICAgIHJldHVybiBNYXRoLm1heCh3aW5kb3cuc2NyZWVuLndpZHRoLCB3aW5kb3cuc2NyZWVuLmhlaWdodCkgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKICAgIH07CiAgICB2YXIgZ2V0U2NyZWVuSGVpZ2h0ID0gZnVuY3Rpb24gZ2V0U2NyZWVuSGVpZ2h0KCkgewogICAgICByZXR1cm4gTWF0aC5taW4od2luZG93LnNjcmVlbi53aWR0aCwgd2luZG93LnNjcmVlbi5oZWlnaHQpICogd2luZG93LmRldmljZVBpeGVsUmF0aW87CiAgICB9OwogICAgdmFyIHJlcXVlc3RGdWxsc2NyZWVuID0gZnVuY3Rpb24gcmVxdWVzdEZ1bGxzY3JlZW4oZWxlbWVudCkgewogICAgICBpZiAoaXNXZWJWaWV3QW5kcm9pZCgpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChlbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKSB7CiAgICAgICAgZWxlbWVudC5yZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICB9IGVsc2UgaWYgKGVsZW1lbnQud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgICAgICBlbGVtZW50LndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC5tb3pSZXF1ZXN0RnVsbFNjcmVlbikgewogICAgICAgIGVsZW1lbnQubW96UmVxdWVzdEZ1bGxTY3JlZW4oKTsKICAgICAgfSBlbHNlIGlmIChlbGVtZW50Lm1zUmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgICAgICBlbGVtZW50Lm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgdmFyIGV4aXRGdWxsc2NyZWVuID0gZnVuY3Rpb24gZXhpdEZ1bGxzY3JlZW4oKSB7CiAgICAgIGlmIChkb2N1bWVudC5leGl0RnVsbHNjcmVlbikgewogICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4pIHsKICAgICAgICBkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbigpOwogICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHsKICAgICAgICBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7CiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbikgewogICAgICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9OwogICAgdmFyIGdldEZ1bGxzY3JlZW5FbGVtZW50ID0gZnVuY3Rpb24gZ2V0RnVsbHNjcmVlbkVsZW1lbnQoKSB7CiAgICAgIHJldHVybiBkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tb3pGdWxsU2NyZWVuRWxlbWVudCB8fCBkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbGVtZW50OwogICAgfTsKICAgIHZhciBsaW5rUHJvZ3JhbSA9IGZ1bmN0aW9uIGxpbmtQcm9ncmFtKGdsLCB2ZXJ0ZXhTb3VyY2UsIGZyYWdtZW50U291cmNlLCBhdHRyaWJMb2NhdGlvbk1hcCkgewogICAgICB2YXIgdmVydGV4U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLlZFUlRFWF9TSEFERVIpOwogICAgICBnbC5zaGFkZXJTb3VyY2UodmVydGV4U2hhZGVyLCB2ZXJ0ZXhTb3VyY2UpOwogICAgICBnbC5jb21waWxlU2hhZGVyKHZlcnRleFNoYWRlcik7CiAgICAgIHZhciBmcmFnbWVudFNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlcihnbC5GUkFHTUVOVF9TSEFERVIpOwogICAgICBnbC5zaGFkZXJTb3VyY2UoZnJhZ21lbnRTaGFkZXIsIGZyYWdtZW50U291cmNlKTsKICAgICAgZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CiAgICAgIHZhciBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpOwogICAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgdmVydGV4U2hhZGVyKTsKICAgICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKICAgICAgZm9yICh2YXIgYXR0cmliTmFtZSBpbiBhdHRyaWJMb2NhdGlvbk1hcCkgewogICAgICAgIGdsLmJpbmRBdHRyaWJMb2NhdGlvbihwcm9ncmFtLCBhdHRyaWJMb2NhdGlvbk1hcFthdHRyaWJOYW1lXSwgYXR0cmliTmFtZSk7CiAgICAgIH1nbC5saW5rUHJvZ3JhbShwcm9ncmFtKTsKICAgICAgZ2wuZGVsZXRlU2hhZGVyKHZlcnRleFNoYWRlcik7CiAgICAgIGdsLmRlbGV0ZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CiAgICAgIHJldHVybiBwcm9ncmFtOwogICAgfTsKICAgIHZhciBnZXRQcm9ncmFtVW5pZm9ybXMgPSBmdW5jdGlvbiBnZXRQcm9ncmFtVW5pZm9ybXMoZ2wsIHByb2dyYW0pIHsKICAgICAgdmFyIHVuaWZvcm1zID0ge307CiAgICAgIHZhciB1bmlmb3JtQ291bnQgPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIGdsLkFDVElWRV9VTklGT1JNUyk7CiAgICAgIHZhciB1bmlmb3JtTmFtZSA9ICcnOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaWZvcm1Db3VudDsgaSsrKSB7CiAgICAgICAgdmFyIHVuaWZvcm1JbmZvID0gZ2wuZ2V0QWN0aXZlVW5pZm9ybShwcm9ncmFtLCBpKTsKICAgICAgICB1bmlmb3JtTmFtZSA9IHVuaWZvcm1JbmZvLm5hbWUucmVwbGFjZSgnWzBdJywgJycpOwogICAgICAgIHVuaWZvcm1zW3VuaWZvcm1OYW1lXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCB1bmlmb3JtTmFtZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHVuaWZvcm1zOwogICAgfTsKICAgIHZhciBvcnRob01hdHJpeCA9IGZ1bmN0aW9uIG9ydGhvTWF0cml4KG91dCwgbGVmdCwgcmlnaHQsIGJvdHRvbSwgdG9wLCBuZWFyLCBmYXIpIHsKICAgICAgdmFyIGxyID0gMSAvIChsZWZ0IC0gcmlnaHQpLAogICAgICAgICAgYnQgPSAxIC8gKGJvdHRvbSAtIHRvcCksCiAgICAgICAgICBuZiA9IDEgLyAobmVhciAtIGZhcik7CiAgICAgIG91dFswXSA9IC0yICogbHI7CiAgICAgIG91dFsxXSA9IDA7CiAgICAgIG91dFsyXSA9IDA7CiAgICAgIG91dFszXSA9IDA7CiAgICAgIG91dFs0XSA9IDA7CiAgICAgIG91dFs1XSA9IC0yICogYnQ7CiAgICAgIG91dFs2XSA9IDA7CiAgICAgIG91dFs3XSA9IDA7CiAgICAgIG91dFs4XSA9IDA7CiAgICAgIG91dFs5XSA9IDA7CiAgICAgIG91dFsxMF0gPSAyICogbmY7CiAgICAgIG91dFsxMV0gPSAwOwogICAgICBvdXRbMTJdID0gKGxlZnQgKyByaWdodCkgKiBscjsKICAgICAgb3V0WzEzXSA9ICh0b3AgKyBib3R0b20pICogYnQ7CiAgICAgIG91dFsxNF0gPSAoZmFyICsgbmVhcikgKiBuZjsKICAgICAgb3V0WzE1XSA9IDE7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9OwogICAgdmFyIGlzTW9iaWxlID0gZnVuY3Rpb24gaXNNb2JpbGUoKSB7CiAgICAgIHZhciBjaGVjayA9IGZhbHNlOwogICAgICAoZnVuY3Rpb24gKGEpIHsKICAgICAgICBpZiAoLyhhbmRyb2lkfGJiXGQrfG1lZWdvKS4rbW9iaWxlfGF2YW50Z298YmFkYVwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFwuKGJyb3dzZXJ8bGluayl8dm9kYWZvbmV8d2FwfHdpbmRvd3MgY2V8eGRhfHhpaW5vL2kudGVzdChhKSB8fCAvMTIwN3w2MzEwfDY1OTB8M2dzb3w0dGhwfDUwWzEtNl1pfDc3MHN8ODAyc3xhIHdhfGFiYWN8YWMoZXJ8b298c1wtKXxhaShrb3xybil8YWwoYXZ8Y2F8Y28pfGFtb2l8YW4oZXh8bnl8eXcpfGFwdHV8YXIoY2h8Z28pfGFzKHRlfHVzKXxhdHR3fGF1KGRpfFwtbXxyIHxzICl8YXZhbnxiZShja3xsbHxucSl8YmkobGJ8cmQpfGJsKGFjfGF6KXxicihlfHYpd3xidW1ifGJ3XC0obnx1KXxjNTVcL3xjYXBpfGNjd2F8Y2RtXC18Y2VsbHxjaHRtfGNsZGN8Y21kXC18Y28obXB8bmQpfGNyYXd8ZGEoaXR8bGx8bmcpfGRidGV8ZGNcLXN8ZGV2aXxkaWNhfGRtb2J8ZG8oY3xwKW98ZHMoMTJ8XC1kKXxlbCg0OXxhaSl8ZW0obDJ8dWwpfGVyKGljfGswKXxlc2w4fGV6KFs0LTddMHxvc3x3YXx6ZSl8ZmV0Y3xmbHkoXC18Xyl8ZzEgdXxnNTYwfGdlbmV8Z2ZcLTV8Z1wtbW98Z28oXC53fG9kKXxncihhZHx1bil8aGFpZXxoY2l0fGhkXC0obXxwfHQpfGhlaVwtfGhpKHB0fHRhKXxocCggaXxpcCl8aHNcLWN8aHQoYyhcLXwgfF98YXxnfHB8c3x0KXx0cCl8aHUoYXd8dGMpfGlcLSgyMHxnb3xtYSl8aTIzMHxpYWMoIHxcLXxcLyl8aWJyb3xpZGVhfGlnMDF8aWtvbXxpbTFrfGlubm98aXBhcXxpcmlzfGphKHR8dilhfGpicm98amVtdXxqaWdzfGtkZGl8a2VqaXxrZ3QoIHxcLyl8a2xvbnxrcHQgfGt3Y1wtfGt5byhjfGspfGxlKG5vfHhpKXxsZyggZ3xcLyhrfGx8dSl8NTB8NTR8XC1bYS13XSl8bGlid3xseW54fG0xXC13fG0zZ2F8bTUwXC98bWEodGV8dWl8eG8pfG1jKDAxfDIxfGNhKXxtXC1jcnxtZShyY3xyaSl8bWkobzh8b2F8dHMpfG1tZWZ8bW8oMDF8MDJ8Yml8ZGV8ZG98dChcLXwgfG98dil8enopfG10KDUwfHAxfHYgKXxtd2JwfG15d2F8bjEwWzAtMl18bjIwWzItM118bjMwKDB8Mil8bjUwKDB8Mnw1KXxuNygwKDB8MSl8MTApfG5lKChjfG0pXC18b258dGZ8d2Z8d2d8d3QpfG5vayg2fGkpfG56cGh8bzJpbXxvcCh0aXx3dil8b3Jhbnxvd2cxfHA4MDB8cGFuKGF8ZHx0KXxwZHhnfHBnKDEzfFwtKFsxLThdfGMpKXxwaGlsfHBpcmV8cGwoYXl8dWMpfHBuXC0yfHBvKGNrfHJ0fHNlKXxwcm94fHBzaW98cHRcLWd8cWFcLWF8cWMoMDd8MTJ8MjF8MzJ8NjB8XC1bMi03XXxpXC0pfHF0ZWt8cjM4MHxyNjAwfHJha3N8cmltOXxybyh2ZXx6byl8czU1XC98c2EoZ2V8bWF8bW18bXN8bnl8dmEpfHNjKDAxfGhcLXxvb3xwXC0pfHNka1wvfHNlKGMoXC18MHwxKXw0N3xtY3xuZHxyaSl8c2doXC18c2hhcnxzaWUoXC18bSl8c2tcLTB8c2woNDV8aWQpfHNtKGFsfGFyfGIzfGl0fHQ1KXxzbyhmdHxueSl8c3AoMDF8aFwtfHZcLXx2ICl8c3koMDF8bWIpfHQyKDE4fDUwKXx0NigwMHwxMHwxOCl8dGEoZ3R8bGspfHRjbFwtfHRkZ1wtfHRlbChpfG0pfHRpbVwtfHRcLW1vfHRvKHBsfHNoKXx0cyg3MHxtXC18bTN8bTUpfHR4XC05fHVwKFwuYnxnMXxzaSl8dXRzdHx2NDAwfHY3NTB8dmVyaXx2aShyZ3x0ZSl8dmsoNDB8NVswLTNdfFwtdil8dm00MHx2b2RhfHZ1bGN8dngoNTJ8NTN8NjB8NjF8NzB8ODB8ODF8ODN8ODV8OTgpfHczYyhcLXwgKXx3ZWJjfHdoaXR8d2koZyB8bmN8bncpfHdtbGJ8d29udXx4NzAwfHlhc1wtfHlvdXJ8emV0b3x6dGVcLS9pLnRlc3QoYS5zdWJzdHIoMCwgNCkpKSBjaGVjayA9IHRydWU7CiAgICAgIH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpOwogICAgICByZXR1cm4gY2hlY2s7CiAgICB9OwogICAgdmFyIGV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZChkZXN0LCBzcmMpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHNyYykgewogICAgICAgIGlmIChzcmMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgZGVzdFtrZXldID0gc3JjW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBkZXN0OwogICAgfTsKICAgIHZhciBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZCA9IGZ1bmN0aW9uIHNhZmFyaUNzc1NpemVXb3JrYXJvdW5kKGNhbnZhcykgewogICAgICBpZiAoaXNJT1MoKSkgewogICAgICAgIHZhciB3aWR0aCA9IGNhbnZhcy5zdHlsZS53aWR0aDsKICAgICAgICB2YXIgaGVpZ2h0ID0gY2FudmFzLnN0eWxlLmhlaWdodDsKICAgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSBwYXJzZUludCh3aWR0aCkgKyAxICsgJ3B4JzsKICAgICAgICBjYW52YXMuc3R5bGUuaGVpZ2h0ID0gcGFyc2VJbnQoaGVpZ2h0KSArICdweCc7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aDsKICAgICAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgfSwgMTAwKTsKICAgICAgfQogICAgICB3aW5kb3cuY2FudmFzID0gY2FudmFzOwogICAgfTsKICAgIHZhciBmcmFtZURhdGFGcm9tUG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHBpT3ZlcjE4MCA9IE1hdGguUEkgLyAxODAuMDsKICAgICAgdmFyIHJhZDQ1ID0gTWF0aC5QSSAqIDAuMjU7CiAgICAgIGZ1bmN0aW9uIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcob3V0LCBmb3YsIG5lYXIsIGZhcikgewogICAgICAgIHZhciB1cFRhbiA9IE1hdGgudGFuKGZvdiA/IGZvdi51cERlZ3JlZXMgKiBwaU92ZXIxODAgOiByYWQ0NSksCiAgICAgICAgICAgIGRvd25UYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YuZG93bkRlZ3JlZXMgKiBwaU92ZXIxODAgOiByYWQ0NSksCiAgICAgICAgICAgIGxlZnRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YubGVmdERlZ3JlZXMgKiBwaU92ZXIxODAgOiByYWQ0NSksCiAgICAgICAgICAgIHJpZ2h0VGFuID0gTWF0aC50YW4oZm92ID8gZm92LnJpZ2h0RGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKICAgICAgICAgICAgeFNjYWxlID0gMi4wIC8gKGxlZnRUYW4gKyByaWdodFRhbiksCiAgICAgICAgICAgIHlTY2FsZSA9IDIuMCAvICh1cFRhbiArIGRvd25UYW4pOwogICAgICAgIG91dFswXSA9IHhTY2FsZTsKICAgICAgICBvdXRbMV0gPSAwLjA7CiAgICAgICAgb3V0WzJdID0gMC4wOwogICAgICAgIG91dFszXSA9IDAuMDsKICAgICAgICBvdXRbNF0gPSAwLjA7CiAgICAgICAgb3V0WzVdID0geVNjYWxlOwogICAgICAgIG91dFs2XSA9IDAuMDsKICAgICAgICBvdXRbN10gPSAwLjA7CiAgICAgICAgb3V0WzhdID0gLSgobGVmdFRhbiAtIHJpZ2h0VGFuKSAqIHhTY2FsZSAqIDAuNSk7CiAgICAgICAgb3V0WzldID0gKHVwVGFuIC0gZG93blRhbikgKiB5U2NhbGUgKiAwLjU7CiAgICAgICAgb3V0WzEwXSA9IGZhciAvIChuZWFyIC0gZmFyKTsKICAgICAgICBvdXRbMTFdID0gLTE7CiAgICAgICAgb3V0WzEyXSA9IDAuMDsKICAgICAgICBvdXRbMTNdID0gMC4wOwogICAgICAgIG91dFsxNF0gPSBmYXIgKiBuZWFyIC8gKG5lYXIgLSBmYXIpOwogICAgICAgIG91dFsxNV0gPSAwLjA7CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgICBmdW5jdGlvbiBtYXQ0X2Zyb21Sb3RhdGlvblRyYW5zbGF0aW9uKG91dCwgcSwgdikgewogICAgICAgIHZhciB4ID0gcVswXSwKICAgICAgICAgICAgeSA9IHFbMV0sCiAgICAgICAgICAgIHogPSBxWzJdLAogICAgICAgICAgICB3ID0gcVszXSwKICAgICAgICAgICAgeDIgPSB4ICsgeCwKICAgICAgICAgICAgeTIgPSB5ICsgeSwKICAgICAgICAgICAgejIgPSB6ICsgeiwKICAgICAgICAgICAgeHggPSB4ICogeDIsCiAgICAgICAgICAgIHh5ID0geCAqIHkyLAogICAgICAgICAgICB4eiA9IHggKiB6MiwKICAgICAgICAgICAgeXkgPSB5ICogeTIsCiAgICAgICAgICAgIHl6ID0geSAqIHoyLAogICAgICAgICAgICB6eiA9IHogKiB6MiwKICAgICAgICAgICAgd3ggPSB3ICogeDIsCiAgICAgICAgICAgIHd5ID0gdyAqIHkyLAogICAgICAgICAgICB3eiA9IHcgKiB6MjsKICAgICAgICBvdXRbMF0gPSAxIC0gKHl5ICsgenopOwogICAgICAgIG91dFsxXSA9IHh5ICsgd3o7CiAgICAgICAgb3V0WzJdID0geHogLSB3eTsKICAgICAgICBvdXRbM10gPSAwOwogICAgICAgIG91dFs0XSA9IHh5IC0gd3o7CiAgICAgICAgb3V0WzVdID0gMSAtICh4eCArIHp6KTsKICAgICAgICBvdXRbNl0gPSB5eiArIHd4OwogICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgb3V0WzhdID0geHogKyB3eTsKICAgICAgICBvdXRbOV0gPSB5eiAtIHd4OwogICAgICAgIG91dFsxMF0gPSAxIC0gKHh4ICsgeXkpOwogICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgIG91dFsxMl0gPSB2WzBdOwogICAgICAgIG91dFsxM10gPSB2WzFdOwogICAgICAgIG91dFsxNF0gPSB2WzJdOwogICAgICAgIG91dFsxNV0gPSAxOwogICAgICAgIHJldHVybiBvdXQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbWF0NF90cmFuc2xhdGUob3V0LCBhLCB2KSB7CiAgICAgICAgdmFyIHggPSB2WzBdLAogICAgICAgICAgICB5ID0gdlsxXSwKICAgICAgICAgICAgeiA9IHZbMl0sCiAgICAgICAgICAgIGEwMCwKICAgICAgICAgICAgYTAxLAogICAgICAgICAgICBhMDIsCiAgICAgICAgICAgIGEwMywKICAgICAgICAgICAgYTEwLAogICAgICAgICAgICBhMTEsCiAgICAgICAgICAgIGExMiwKICAgICAgICAgICAgYTEzLAogICAgICAgICAgICBhMjAsCiAgICAgICAgICAgIGEyMSwKICAgICAgICAgICAgYTIyLAogICAgICAgICAgICBhMjM7CiAgICAgICAgaWYgKGEgPT09IG91dCkgewogICAgICAgICAgb3V0WzEyXSA9IGFbMF0gKiB4ICsgYVs0XSAqIHkgKyBhWzhdICogeiArIGFbMTJdOwogICAgICAgICAgb3V0WzEzXSA9IGFbMV0gKiB4ICsgYVs1XSAqIHkgKyBhWzldICogeiArIGFbMTNdOwogICAgICAgICAgb3V0WzE0XSA9IGFbMl0gKiB4ICsgYVs2XSAqIHkgKyBhWzEwXSAqIHogKyBhWzE0XTsKICAgICAgICAgIG91dFsxNV0gPSBhWzNdICogeCArIGFbN10gKiB5ICsgYVsxMV0gKiB6ICsgYVsxNV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGEwMCA9IGFbMF07YTAxID0gYVsxXTthMDIgPSBhWzJdO2EwMyA9IGFbM107CiAgICAgICAgICBhMTAgPSBhWzRdO2ExMSA9IGFbNV07YTEyID0gYVs2XTthMTMgPSBhWzddOwogICAgICAgICAgYTIwID0gYVs4XTthMjEgPSBhWzldO2EyMiA9IGFbMTBdO2EyMyA9IGFbMTFdOwogICAgICAgICAgb3V0WzBdID0gYTAwO291dFsxXSA9IGEwMTtvdXRbMl0gPSBhMDI7b3V0WzNdID0gYTAzOwogICAgICAgICAgb3V0WzRdID0gYTEwO291dFs1XSA9IGExMTtvdXRbNl0gPSBhMTI7b3V0WzddID0gYTEzOwogICAgICAgICAgb3V0WzhdID0gYTIwO291dFs5XSA9IGEyMTtvdXRbMTBdID0gYTIyO291dFsxMV0gPSBhMjM7CiAgICAgICAgICBvdXRbMTJdID0gYTAwICogeCArIGExMCAqIHkgKyBhMjAgKiB6ICsgYVsxMl07CiAgICAgICAgICBvdXRbMTNdID0gYTAxICogeCArIGExMSAqIHkgKyBhMjEgKiB6ICsgYVsxM107CiAgICAgICAgICBvdXRbMTRdID0gYTAyICogeCArIGExMiAqIHkgKyBhMjIgKiB6ICsgYVsxNF07CiAgICAgICAgICBvdXRbMTVdID0gYTAzICogeCArIGExMyAqIHkgKyBhMjMgKiB6ICsgYVsxNV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBvdXQ7CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbWF0NF9pbnZlcnQob3V0LCBhKSB7CiAgICAgICAgdmFyIGEwMCA9IGFbMF0sCiAgICAgICAgICAgIGEwMSA9IGFbMV0sCiAgICAgICAgICAgIGEwMiA9IGFbMl0sCiAgICAgICAgICAgIGEwMyA9IGFbM10sCiAgICAgICAgICAgIGExMCA9IGFbNF0sCiAgICAgICAgICAgIGExMSA9IGFbNV0sCiAgICAgICAgICAgIGExMiA9IGFbNl0sCiAgICAgICAgICAgIGExMyA9IGFbN10sCiAgICAgICAgICAgIGEyMCA9IGFbOF0sCiAgICAgICAgICAgIGEyMSA9IGFbOV0sCiAgICAgICAgICAgIGEyMiA9IGFbMTBdLAogICAgICAgICAgICBhMjMgPSBhWzExXSwKICAgICAgICAgICAgYTMwID0gYVsxMl0sCiAgICAgICAgICAgIGEzMSA9IGFbMTNdLAogICAgICAgICAgICBhMzIgPSBhWzE0XSwKICAgICAgICAgICAgYTMzID0gYVsxNV0sCiAgICAgICAgICAgIGIwMCA9IGEwMCAqIGExMSAtIGEwMSAqIGExMCwKICAgICAgICAgICAgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwLAogICAgICAgICAgICBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTAsCiAgICAgICAgICAgIGIwMyA9IGEwMSAqIGExMiAtIGEwMiAqIGExMSwKICAgICAgICAgICAgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExLAogICAgICAgICAgICBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTIsCiAgICAgICAgICAgIGIwNiA9IGEyMCAqIGEzMSAtIGEyMSAqIGEzMCwKICAgICAgICAgICAgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwLAogICAgICAgICAgICBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzAsCiAgICAgICAgICAgIGIwOSA9IGEyMSAqIGEzMiAtIGEyMiAqIGEzMSwKICAgICAgICAgICAgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxLAogICAgICAgICAgICBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzIsCiAgICAgICAgZGV0ID0gYjAwICogYjExIC0gYjAxICogYjEwICsgYjAyICogYjA5ICsgYjAzICogYjA4IC0gYjA0ICogYjA3ICsgYjA1ICogYjA2OwogICAgICAgIGlmICghZGV0KSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgZGV0ID0gMS4wIC8gZGV0OwogICAgICAgIG91dFswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0OwogICAgICAgIG91dFsxXSA9IChhMDIgKiBiMTAgLSBhMDEgKiBiMTEgLSBhMDMgKiBiMDkpICogZGV0OwogICAgICAgIG91dFsyXSA9IChhMzEgKiBiMDUgLSBhMzIgKiBiMDQgKyBhMzMgKiBiMDMpICogZGV0OwogICAgICAgIG91dFszXSA9IChhMjIgKiBiMDQgLSBhMjEgKiBiMDUgLSBhMjMgKiBiMDMpICogZGV0OwogICAgICAgIG91dFs0XSA9IChhMTIgKiBiMDggLSBhMTAgKiBiMTEgLSBhMTMgKiBiMDcpICogZGV0OwogICAgICAgIG91dFs1XSA9IChhMDAgKiBiMTEgLSBhMDIgKiBiMDggKyBhMDMgKiBiMDcpICogZGV0OwogICAgICAgIG91dFs2XSA9IChhMzIgKiBiMDIgLSBhMzAgKiBiMDUgLSBhMzMgKiBiMDEpICogZGV0OwogICAgICAgIG91dFs3XSA9IChhMjAgKiBiMDUgLSBhMjIgKiBiMDIgKyBhMjMgKiBiMDEpICogZGV0OwogICAgICAgIG91dFs4XSA9IChhMTAgKiBiMTAgLSBhMTEgKiBiMDggKyBhMTMgKiBiMDYpICogZGV0OwogICAgICAgIG91dFs5XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0OwogICAgICAgIG91dFsxMF0gPSAoYTMwICogYjA0IC0gYTMxICogYjAyICsgYTMzICogYjAwKSAqIGRldDsKICAgICAgICBvdXRbMTFdID0gKGEyMSAqIGIwMiAtIGEyMCAqIGIwNCAtIGEyMyAqIGIwMCkgKiBkZXQ7CiAgICAgICAgb3V0WzEyXSA9IChhMTEgKiBiMDcgLSBhMTAgKiBiMDkgLSBhMTIgKiBiMDYpICogZGV0OwogICAgICAgIG91dFsxM10gPSAoYTAwICogYjA5IC0gYTAxICogYjA3ICsgYTAyICogYjA2KSAqIGRldDsKICAgICAgICBvdXRbMTRdID0gKGEzMSAqIGIwMSAtIGEzMCAqIGIwMyAtIGEzMiAqIGIwMCkgKiBkZXQ7CiAgICAgICAgb3V0WzE1XSA9IChhMjAgKiBiMDMgLSBhMjEgKiBiMDEgKyBhMjIgKiBiMDApICogZGV0OwogICAgICAgIHJldHVybiBvdXQ7CiAgICAgIH0KICAgICAgdmFyIGRlZmF1bHRPcmllbnRhdGlvbiA9IG5ldyBGbG9hdDMyQXJyYXkoWzAsIDAsIDAsIDFdKTsKICAgICAgdmFyIGRlZmF1bHRQb3NpdGlvbiA9IG5ldyBGbG9hdDMyQXJyYXkoWzAsIDAsIDBdKTsKICAgICAgZnVuY3Rpb24gdXBkYXRlRXllTWF0cmljZXMocHJvamVjdGlvbiwgdmlldywgcG9zZSwgZm92LCBvZmZzZXQsIHZyRGlzcGxheSkgewogICAgICAgIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcocHJvamVjdGlvbiwgZm92IHx8IG51bGwsIHZyRGlzcGxheS5kZXB0aE5lYXIsIHZyRGlzcGxheS5kZXB0aEZhcik7CiAgICAgICAgdmFyIG9yaWVudGF0aW9uID0gcG9zZS5vcmllbnRhdGlvbiB8fCBkZWZhdWx0T3JpZW50YXRpb247CiAgICAgICAgdmFyIHBvc2l0aW9uID0gcG9zZS5wb3NpdGlvbiB8fCBkZWZhdWx0UG9zaXRpb247CiAgICAgICAgbWF0NF9mcm9tUm90YXRpb25UcmFuc2xhdGlvbih2aWV3LCBvcmllbnRhdGlvbiwgcG9zaXRpb24pOwogICAgICAgIGlmIChvZmZzZXQpIG1hdDRfdHJhbnNsYXRlKHZpZXcsIHZpZXcsIG9mZnNldCk7CiAgICAgICAgbWF0NF9pbnZlcnQodmlldywgdmlldyk7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIChmcmFtZURhdGEsIHBvc2UsIHZyRGlzcGxheSkgewogICAgICAgIGlmICghZnJhbWVEYXRhIHx8ICFwb3NlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgZnJhbWVEYXRhLnBvc2UgPSBwb3NlOwogICAgICAgIGZyYW1lRGF0YS50aW1lc3RhbXAgPSBwb3NlLnRpbWVzdGFtcDsKICAgICAgICB1cGRhdGVFeWVNYXRyaWNlcyhmcmFtZURhdGEubGVmdFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5sZWZ0Vmlld01hdHJpeCwgcG9zZSwgdnJEaXNwbGF5Ll9nZXRGaWVsZE9mVmlldygibGVmdCIpLCB2ckRpc3BsYXkuX2dldEV5ZU9mZnNldCgibGVmdCIpLCB2ckRpc3BsYXkpOwogICAgICAgIHVwZGF0ZUV5ZU1hdHJpY2VzKGZyYW1lRGF0YS5yaWdodFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgsIHBvc2UsIHZyRGlzcGxheS5fZ2V0RmllbGRPZlZpZXcoInJpZ2h0IiksIHZyRGlzcGxheS5fZ2V0RXllT2Zmc2V0KCJyaWdodCIpLCB2ckRpc3BsYXkpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGlzSW5zaWRlQ3Jvc3NPcmlnaW5JRnJhbWUgPSBmdW5jdGlvbiBpc0luc2lkZUNyb3NzT3JpZ2luSUZyYW1lKCkgewogICAgICB2YXIgaXNGcmFtZWQgPSB3aW5kb3cuc2VsZiAhPT0gd2luZG93LnRvcDsKICAgICAgdmFyIHJlZk9yaWdpbiA9IGdldE9yaWdpbkZyb21VcmwoZG9jdW1lbnQucmVmZXJyZXIpOwogICAgICB2YXIgdGhpc09yaWdpbiA9IGdldE9yaWdpbkZyb21Vcmwod2luZG93LmxvY2F0aW9uLmhyZWYpOwogICAgICByZXR1cm4gaXNGcmFtZWQgJiYgcmVmT3JpZ2luICE9PSB0aGlzT3JpZ2luOwogICAgfTsKICAgIHZhciBnZXRPcmlnaW5Gcm9tVXJsID0gZnVuY3Rpb24gZ2V0T3JpZ2luRnJvbVVybCh1cmwpIHsKICAgICAgdmFyIGRvbWFpbklkeDsKICAgICAgdmFyIHByb3RvU2VwSWR4ID0gdXJsLmluZGV4T2YoIjovLyIpOwogICAgICBpZiAocHJvdG9TZXBJZHggIT09IC0xKSB7CiAgICAgICAgZG9tYWluSWR4ID0gcHJvdG9TZXBJZHggKyAzOwogICAgICB9IGVsc2UgewogICAgICAgIGRvbWFpbklkeCA9IDA7CiAgICAgIH0KICAgICAgdmFyIGRvbWFpbkVuZElkeCA9IHVybC5pbmRleE9mKCcvJywgZG9tYWluSWR4KTsKICAgICAgaWYgKGRvbWFpbkVuZElkeCA9PT0gLTEpIHsKICAgICAgICBkb21haW5FbmRJZHggPSB1cmwubGVuZ3RoOwogICAgICB9CiAgICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKDAsIGRvbWFpbkVuZElkeCk7CiAgICB9OwogICAgdmFyIGdldFF1YXRlcm5pb25BbmdsZSA9IGZ1bmN0aW9uIGdldFF1YXRlcm5pb25BbmdsZShxdWF0KSB7CiAgICAgIGlmIChxdWF0LncgPiAxKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdnZXRRdWF0ZXJuaW9uQW5nbGU6IHcgPiAxJyk7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgdmFyIGFuZ2xlID0gMiAqIE1hdGguYWNvcyhxdWF0LncpOwogICAgICByZXR1cm4gYW5nbGU7CiAgICB9OwogICAgdmFyIHdhcm5PbmNlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgb2JzZXJ2ZWRXYXJuaW5ncyA9IHt9OwogICAgICByZXR1cm4gZnVuY3Rpb24gKGtleSwgbWVzc2FnZSkgewogICAgICAgIGlmIChvYnNlcnZlZFdhcm5pbmdzW2tleV0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgY29uc29sZS53YXJuKCd3ZWJ2ci1wb2x5ZmlsbDogJyArIG1lc3NhZ2UpOwogICAgICAgICAgb2JzZXJ2ZWRXYXJuaW5nc1trZXldID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgZGVwcmVjYXRlV2FybmluZyA9IGZ1bmN0aW9uIGRlcHJlY2F0ZVdhcm5pbmcoZGVwcmVjYXRlZCwgc3VnZ2VzdGVkKSB7CiAgICAgIHZhciBhbHRlcm5hdGl2ZSA9IHN1Z2dlc3RlZCA/ICdQbGVhc2UgdXNlICcgKyBzdWdnZXN0ZWQgKyAnIGluc3RlYWQuJyA6ICcnOwogICAgICB3YXJuT25jZShkZXByZWNhdGVkLCBkZXByZWNhdGVkICsgJyBoYXMgYmVlbiBkZXByZWNhdGVkLiAnICsgJ1RoaXMgbWF5IG5vdCB3b3JrIG9uIG5hdGl2ZSBXZWJWUiBkaXNwbGF5cy4gJyArIGFsdGVybmF0aXZlKTsKICAgIH07CiAgICBmdW5jdGlvbiBXR0xVUHJlc2VydmVHTFN0YXRlKGdsLCBiaW5kaW5ncywgY2FsbGJhY2spIHsKICAgICAgaWYgKCFiaW5kaW5ncykgewogICAgICAgIGNhbGxiYWNrKGdsKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGJvdW5kVmFsdWVzID0gW107CiAgICAgIHZhciBhY3RpdmVUZXh0dXJlID0gbnVsbDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW5kaW5ncy5sZW5ndGg7ICsraSkgewogICAgICAgIHZhciBiaW5kaW5nID0gYmluZGluZ3NbaV07CiAgICAgICAgc3dpdGNoIChiaW5kaW5nKSB7CiAgICAgICAgICBjYXNlIGdsLlRFWFRVUkVfQklORElOR18yRDoKICAgICAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HX0NVQkVfTUFQOgogICAgICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwogICAgICAgICAgICBpZiAodGV4dHVyZVVuaXQgPCBnbC5URVhUVVJFMCB8fCB0ZXh0dXJlVW5pdCA+IGdsLlRFWFRVUkUzMSkgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlRFWFRVUkVfQklORElOR18yRCBvciBURVhUVVJFX0JJTkRJTkdfQ1VCRV9NQVAgbXVzdCBiZSBmb2xsb3dlZCBieSBhIHZhbGlkIHRleHR1cmUgdW5pdCIpOwogICAgICAgICAgICAgIGJvdW5kVmFsdWVzLnB1c2gobnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFhY3RpdmVUZXh0dXJlKSB7CiAgICAgICAgICAgICAgYWN0aXZlVGV4dHVyZSA9IGdsLmdldFBhcmFtZXRlcihnbC5BQ1RJVkVfVEVYVFVSRSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CiAgICAgICAgICAgIGJvdW5kVmFsdWVzLnB1c2goZ2wuZ2V0UGFyYW1ldGVyKGJpbmRpbmcpLCBudWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkFDVElWRV9URVhUVVJFOgogICAgICAgICAgICBhY3RpdmVUZXh0dXJlID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkFDVElWRV9URVhUVVJFKTsKICAgICAgICAgICAgYm91bmRWYWx1ZXMucHVzaChudWxsKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBib3VuZFZhbHVlcy5wdXNoKGdsLmdldFBhcmFtZXRlcihiaW5kaW5nKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBjYWxsYmFjayhnbCk7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYmluZGluZ3MubGVuZ3RoOyArK2kpIHsKICAgICAgICB2YXIgYmluZGluZyA9IGJpbmRpbmdzW2ldOwogICAgICAgIHZhciBib3VuZFZhbHVlID0gYm91bmRWYWx1ZXNbaV07CiAgICAgICAgc3dpdGNoIChiaW5kaW5nKSB7CiAgICAgICAgICBjYXNlIGdsLkFDVElWRV9URVhUVVJFOgogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkc6CiAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBib3VuZFZhbHVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkNPTE9SX0NMRUFSX1ZBTFVFOgogICAgICAgICAgICBnbC5jbGVhckNvbG9yKGJvdW5kVmFsdWVbMF0sIGJvdW5kVmFsdWVbMV0sIGJvdW5kVmFsdWVbMl0sIGJvdW5kVmFsdWVbM10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuQ09MT1JfV1JJVEVNQVNLOgogICAgICAgICAgICBnbC5jb2xvck1hc2soYm91bmRWYWx1ZVswXSwgYm91bmRWYWx1ZVsxXSwgYm91bmRWYWx1ZVsyXSwgYm91bmRWYWx1ZVszXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5DVVJSRU5UX1BST0dSQU06CiAgICAgICAgICAgIGdsLnVzZVByb2dyYW0oYm91bmRWYWx1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUl9CSU5ESU5HOgogICAgICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBib3VuZFZhbHVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkZSQU1FQlVGRkVSX0JJTkRJTkc6CiAgICAgICAgICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgYm91bmRWYWx1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5SRU5ERVJCVUZGRVJfQklORElORzoKICAgICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIGJvdW5kVmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HXzJEOgogICAgICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwogICAgICAgICAgICBpZiAodGV4dHVyZVVuaXQgPCBnbC5URVhUVVJFMCB8fCB0ZXh0dXJlVW5pdCA+IGdsLlRFWFRVUkUzMSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CiAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIGJvdW5kVmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HX0NVQkVfTUFQOgogICAgICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwogICAgICAgICAgICBpZiAodGV4dHVyZVVuaXQgPCBnbC5URVhUVVJFMCB8fCB0ZXh0dXJlVW5pdCA+IGdsLlRFWFRVUkUzMSkKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CiAgICAgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGJvdW5kVmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuVklFV1BPUlQ6CiAgICAgICAgICAgIGdsLnZpZXdwb3J0KGJvdW5kVmFsdWVbMF0sIGJvdW5kVmFsdWVbMV0sIGJvdW5kVmFsdWVbMl0sIGJvdW5kVmFsdWVbM10pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuQkxFTkQ6CiAgICAgICAgICBjYXNlIGdsLkNVTExfRkFDRToKICAgICAgICAgIGNhc2UgZ2wuREVQVEhfVEVTVDoKICAgICAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgogICAgICAgICAgY2FzZSBnbC5TVEVOQ0lMX1RFU1Q6CiAgICAgICAgICAgIGlmIChib3VuZFZhbHVlKSB7CiAgICAgICAgICAgICAgZ2wuZW5hYmxlKGJpbmRpbmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGdsLmRpc2FibGUoYmluZGluZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBjb25zb2xlLmxvZygiTm8gR0wgcmVzdG9yZSBiZWhhdmlvciBmb3IgMHgiICsgYmluZGluZy50b1N0cmluZygxNikpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKGFjdGl2ZVRleHR1cmUpIHsKICAgICAgICAgIGdsLmFjdGl2ZVRleHR1cmUoYWN0aXZlVGV4dHVyZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB2YXIgZ2xQcmVzZXJ2ZVN0YXRlID0gV0dMVVByZXNlcnZlR0xTdGF0ZTsKICAgIHZhciBkaXN0b3J0aW9uVlMgPSBbJ2F0dHJpYnV0ZSB2ZWMyIHBvc2l0aW9uOycsICdhdHRyaWJ1dGUgdmVjMyB0ZXhDb29yZDsnLCAndmFyeWluZyB2ZWMyIHZUZXhDb29yZDsnLCAndW5pZm9ybSB2ZWM0IHZpZXdwb3J0T2Zmc2V0U2NhbGVbMl07JywgJ3ZvaWQgbWFpbigpIHsnLCAnICB2ZWM0IHZpZXdwb3J0ID0gdmlld3BvcnRPZmZzZXRTY2FsZVtpbnQodGV4Q29vcmQueildOycsICcgIHZUZXhDb29yZCA9ICh0ZXhDb29yZC54eSAqIHZpZXdwb3J0Lnp3KSArIHZpZXdwb3J0Lnh5OycsICcgIGdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24sIDEuMCwgMS4wICk7JywgJ30nXS5qb2luKCdcbicpOwogICAgdmFyIGRpc3RvcnRpb25GUyA9IFsncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7JywgJ3VuaWZvcm0gc2FtcGxlcjJEIGRpZmZ1c2U7JywgJ3ZhcnlpbmcgdmVjMiB2VGV4Q29vcmQ7JywgJ3ZvaWQgbWFpbigpIHsnLCAnICBnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoZGlmZnVzZSwgdlRleENvb3JkKTsnLCAnfSddLmpvaW4oJ1xuJyk7CiAgICBmdW5jdGlvbiBDYXJkYm9hcmREaXN0b3J0ZXIoZ2wsIGNhcmRib2FyZFVJLCBidWZmZXJTY2FsZSwgZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzKSB7CiAgICAgIHRoaXMuZ2wgPSBnbDsKICAgICAgdGhpcy5jYXJkYm9hcmRVSSA9IGNhcmRib2FyZFVJOwogICAgICB0aGlzLmJ1ZmZlclNjYWxlID0gYnVmZmVyU2NhbGU7CiAgICAgIHRoaXMuZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzID0gZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzOwogICAgICB0aGlzLmN0eEF0dHJpYnMgPSBnbC5nZXRDb250ZXh0QXR0cmlidXRlcygpOwogICAgICB0aGlzLmluc3RhbmNlRXh0ID0gZ2wuZ2V0RXh0ZW5zaW9uKCdBTkdMRV9pbnN0YW5jZWRfYXJyYXlzJyk7CiAgICAgIHRoaXMubWVzaFdpZHRoID0gMjA7CiAgICAgIHRoaXMubWVzaEhlaWdodCA9IDIwOwogICAgICB0aGlzLmJ1ZmZlcldpZHRoID0gZ2wuZHJhd2luZ0J1ZmZlcldpZHRoOwogICAgICB0aGlzLmJ1ZmZlckhlaWdodCA9IGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQ7CiAgICAgIHRoaXMucmVhbEJpbmRGcmFtZWJ1ZmZlciA9IGdsLmJpbmRGcmFtZWJ1ZmZlcjsKICAgICAgdGhpcy5yZWFsRW5hYmxlID0gZ2wuZW5hYmxlOwogICAgICB0aGlzLnJlYWxEaXNhYmxlID0gZ2wuZGlzYWJsZTsKICAgICAgdGhpcy5yZWFsQ29sb3JNYXNrID0gZ2wuY29sb3JNYXNrOwogICAgICB0aGlzLnJlYWxDbGVhckNvbG9yID0gZ2wuY2xlYXJDb2xvcjsKICAgICAgdGhpcy5yZWFsVmlld3BvcnQgPSBnbC52aWV3cG9ydDsKICAgICAgaWYgKCFpc0lPUygpKSB7CiAgICAgICAgdGhpcy5yZWFsQ2FudmFzV2lkdGggPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGdsLmNhbnZhcy5fX3Byb3RvX18sICd3aWR0aCcpOwogICAgICAgIHRoaXMucmVhbENhbnZhc0hlaWdodCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZ2wuY2FudmFzLl9fcHJvdG9fXywgJ2hlaWdodCcpOwogICAgICB9CiAgICAgIHRoaXMuaXNQYXRjaGVkID0gZmFsc2U7CiAgICAgIHRoaXMubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBudWxsOwogICAgICB0aGlzLmN1bGxGYWNlID0gZmFsc2U7CiAgICAgIHRoaXMuZGVwdGhUZXN0ID0gZmFsc2U7CiAgICAgIHRoaXMuYmxlbmQgPSBmYWxzZTsKICAgICAgdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwogICAgICB0aGlzLnN0ZW5jaWxUZXN0ID0gZmFsc2U7CiAgICAgIHRoaXMudmlld3BvcnQgPSBbMCwgMCwgMCwgMF07CiAgICAgIHRoaXMuY29sb3JNYXNrID0gW3RydWUsIHRydWUsIHRydWUsIHRydWVdOwogICAgICB0aGlzLmNsZWFyQ29sb3IgPSBbMCwgMCwgMCwgMF07CiAgICAgIHRoaXMuYXR0cmlicyA9IHsKICAgICAgICBwb3NpdGlvbjogMCwKICAgICAgICB0ZXhDb29yZDogMQogICAgICB9OwogICAgICB0aGlzLnByb2dyYW0gPSBsaW5rUHJvZ3JhbShnbCwgZGlzdG9ydGlvblZTLCBkaXN0b3J0aW9uRlMsIHRoaXMuYXR0cmlicyk7CiAgICAgIHRoaXMudW5pZm9ybXMgPSBnZXRQcm9ncmFtVW5pZm9ybXMoZ2wsIHRoaXMucHJvZ3JhbSk7CiAgICAgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZSA9IG5ldyBGbG9hdDMyQXJyYXkoOCk7CiAgICAgIHRoaXMuc2V0VGV4dHVyZUJvdW5kcygpOwogICAgICB0aGlzLnZlcnRleEJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwogICAgICB0aGlzLmluZGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIHRoaXMuaW5kZXhDb3VudCA9IDA7CiAgICAgIHRoaXMucmVuZGVyVGFyZ2V0ID0gZ2wuY3JlYXRlVGV4dHVyZSgpOwogICAgICB0aGlzLmZyYW1lYnVmZmVyID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgICAgdGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIgPSBudWxsOwogICAgICB0aGlzLmRlcHRoQnVmZmVyID0gbnVsbDsKICAgICAgdGhpcy5zdGVuY2lsQnVmZmVyID0gbnVsbDsKICAgICAgaWYgKHRoaXMuY3R4QXR0cmlicy5kZXB0aCAmJiB0aGlzLmN0eEF0dHJpYnMuc3RlbmNpbCkgewogICAgICAgIHRoaXMuZGVwdGhTdGVuY2lsQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jdHhBdHRyaWJzLmRlcHRoKSB7CiAgICAgICAgdGhpcy5kZXB0aEJ1ZmZlciA9IGdsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY3R4QXR0cmlicy5zdGVuY2lsKSB7CiAgICAgICAgdGhpcy5zdGVuY2lsQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgIH0KICAgICAgdGhpcy5wYXRjaCgpOwogICAgICB0aGlzLm9uUmVzaXplKCk7CiAgICB9CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBnbCA9IHRoaXMuZ2w7CiAgICAgIHRoaXMudW5wYXRjaCgpOwogICAgICBnbC5kZWxldGVQcm9ncmFtKHRoaXMucHJvZ3JhbSk7CiAgICAgIGdsLmRlbGV0ZUJ1ZmZlcih0aGlzLnZlcnRleEJ1ZmZlcik7CiAgICAgIGdsLmRlbGV0ZUJ1ZmZlcih0aGlzLmluZGV4QnVmZmVyKTsKICAgICAgZ2wuZGVsZXRlVGV4dHVyZSh0aGlzLnJlbmRlclRhcmdldCk7CiAgICAgIGdsLmRlbGV0ZUZyYW1lYnVmZmVyKHRoaXMuZnJhbWVidWZmZXIpOwogICAgICBpZiAodGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIpIHsKICAgICAgICBnbC5kZWxldGVSZW5kZXJidWZmZXIodGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmRlcHRoQnVmZmVyKSB7CiAgICAgICAgZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHRoaXMuZGVwdGhCdWZmZXIpOwogICAgICB9CiAgICAgIGlmICh0aGlzLnN0ZW5jaWxCdWZmZXIpIHsKICAgICAgICBnbC5kZWxldGVSZW5kZXJidWZmZXIodGhpcy5zdGVuY2lsQnVmZmVyKTsKICAgICAgfQogICAgICBpZiAodGhpcy5jYXJkYm9hcmRVSSkgewogICAgICAgIHRoaXMuY2FyZGJvYXJkVUkuZGVzdHJveSgpOwogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZ2xTdGF0ZSA9IFtnbC5SRU5ERVJCVUZGRVJfQklORElORywgZ2wuVEVYVFVSRV9CSU5ESU5HXzJELCBnbC5URVhUVVJFMF07CiAgICAgIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CiAgICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgICAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewogICAgICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TQ0lTU09SX1RFU1QpOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxDb2xvck1hc2suY2FsbChnbCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKICAgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIDAsIDAsIDAsIDEpOwogICAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpOwogICAgICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5mcmFtZWJ1ZmZlcik7CiAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgc2VsZi5yZW5kZXJUYXJnZXQpOwogICAgICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgc2VsZi5jdHhBdHRyaWJzLmFscGhhID8gZ2wuUkdCQSA6IGdsLlJHQiwgc2VsZi5idWZmZXJXaWR0aCwgc2VsZi5idWZmZXJIZWlnaHQsIDAsIHNlbGYuY3R4QXR0cmlicy5hbHBoYSA/IGdsLlJHQkEgOiBnbC5SR0IsIGdsLlVOU0lHTkVEX0JZVEUsIG51bGwpOwogICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpOwogICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5MSU5FQVIpOwogICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1MsIGdsLkNMQU1QX1RPX0VER0UpOwogICAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpOwogICAgICAgIGdsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKGdsLkZSQU1FQlVGRkVSLCBnbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2wuVEVYVFVSRV8yRCwgc2VsZi5yZW5kZXJUYXJnZXQsIDApOwogICAgICAgIGlmIChzZWxmLmN0eEF0dHJpYnMuZGVwdGggJiYgc2VsZi5jdHhBdHRyaWJzLnN0ZW5jaWwpIHsKICAgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoU3RlbmNpbEJ1ZmZlcik7CiAgICAgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuREVQVEhfU1RFTkNJTCwgc2VsZi5idWZmZXJXaWR0aCwgc2VsZi5idWZmZXJIZWlnaHQpOwogICAgICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoU3RlbmNpbEJ1ZmZlcik7CiAgICAgICAgfSBlbHNlIGlmIChzZWxmLmN0eEF0dHJpYnMuZGVwdGgpIHsKICAgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoQnVmZmVyKTsKICAgICAgICAgIGdsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoZ2wuUkVOREVSQlVGRkVSLCBnbC5ERVBUSF9DT01QT05FTlQxNiwgc2VsZi5idWZmZXJXaWR0aCwgc2VsZi5idWZmZXJIZWlnaHQpOwogICAgICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5kZXB0aEJ1ZmZlcik7CiAgICAgICAgfSBlbHNlIGlmIChzZWxmLmN0eEF0dHJpYnMuc3RlbmNpbCkgewogICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIHNlbGYuc3RlbmNpbEJ1ZmZlcik7CiAgICAgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuU1RFTkNJTF9JTkRFWDgsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0KTsKICAgICAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5TVEVOQ0lMX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5zdGVuY2lsQnVmZmVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFnbC5jaGVja0ZyYW1lYnVmZmVyU3RhdHVzKGdsLkZSQU1FQlVGRkVSKSA9PT0gZ2wuRlJBTUVCVUZGRVJfQ09NUExFVEUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZyYW1lYnVmZmVyIGluY29tcGxldGUhJyk7CiAgICAgICAgfQogICAgICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CiAgICAgICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKICAgICAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5TQ0lTU09SX1RFU1QpOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxDb2xvck1hc2suYXBwbHkoZ2wsIHNlbGYuY29sb3JNYXNrKTsKICAgICAgICBzZWxmLnJlYWxWaWV3cG9ydC5hcHBseShnbCwgc2VsZi52aWV3cG9ydCk7CiAgICAgICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5hcHBseShnbCwgc2VsZi5jbGVhckNvbG9yKTsKICAgICAgfSk7CiAgICAgIGlmICh0aGlzLmNhcmRib2FyZFVJKSB7CiAgICAgICAgdGhpcy5jYXJkYm9hcmRVSS5vblJlc2l6ZSgpOwogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5wYXRjaCA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMuaXNQYXRjaGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuZ2wuY2FudmFzOwogICAgICB2YXIgZ2wgPSB0aGlzLmdsOwogICAgICBpZiAoIWlzSU9TKCkpIHsKICAgICAgICBjYW52YXMud2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpICogdGhpcy5idWZmZXJTY2FsZTsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCkgKiB0aGlzLmJ1ZmZlclNjYWxlOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICd3aWR0aCcsIHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuYnVmZmVyV2lkdGg7CiAgICAgICAgICB9LAogICAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKICAgICAgICAgICAgc2VsZi5idWZmZXJXaWR0aCA9IHZhbHVlOwogICAgICAgICAgICBzZWxmLnJlYWxDYW52YXNXaWR0aC5zZXQuY2FsbChjYW52YXMsIHZhbHVlKTsKICAgICAgICAgICAgc2VsZi5vblJlc2l6ZSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICdoZWlnaHQnLCB7CiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIHJldHVybiBzZWxmLmJ1ZmZlckhlaWdodDsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewogICAgICAgICAgICBzZWxmLmJ1ZmZlckhlaWdodCA9IHZhbHVlOwogICAgICAgICAgICBzZWxmLnJlYWxDYW52YXNIZWlnaHQuc2V0LmNhbGwoY2FudmFzLCB2YWx1ZSk7CiAgICAgICAgICAgIHNlbGYub25SZXNpemUoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkZSQU1FQlVGRkVSX0JJTkRJTkcpOwogICAgICBpZiAodGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9PSBudWxsKSB7CiAgICAgICAgdGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IHRoaXMuZnJhbWVidWZmZXI7CiAgICAgICAgdGhpcy5nbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIHRoaXMuZnJhbWVidWZmZXIpOwogICAgICB9CiAgICAgIHRoaXMuZ2wuYmluZEZyYW1lYnVmZmVyID0gZnVuY3Rpb24gKHRhcmdldCwgZnJhbWVidWZmZXIpIHsKICAgICAgICBzZWxmLmxhc3RCb3VuZEZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXIgPyBmcmFtZWJ1ZmZlciA6IHNlbGYuZnJhbWVidWZmZXI7CiAgICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIHRhcmdldCwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CiAgICAgIH07CiAgICAgIHRoaXMuY3VsbEZhY2UgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQ1VMTF9GQUNFKTsKICAgICAgdGhpcy5kZXB0aFRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuREVQVEhfVEVTVCk7CiAgICAgIHRoaXMuYmxlbmQgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQkxFTkQpOwogICAgICB0aGlzLnNjaXNzb3JUZXN0ID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLlNDSVNTT1JfVEVTVCk7CiAgICAgIHRoaXMuc3RlbmNpbFRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuU1RFTkNJTF9URVNUKTsKICAgICAgZ2wuZW5hYmxlID0gZnVuY3Rpb24gKHBuYW1lKSB7CiAgICAgICAgc3dpdGNoIChwbmFtZSkgewogICAgICAgICAgY2FzZSBnbC5DVUxMX0ZBQ0U6CiAgICAgICAgICAgIHNlbGYuY3VsbEZhY2UgPSB0cnVlO2JyZWFrOwogICAgICAgICAgY2FzZSBnbC5ERVBUSF9URVNUOgogICAgICAgICAgICBzZWxmLmRlcHRoVGVzdCA9IHRydWU7YnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkJMRU5EOgogICAgICAgICAgICBzZWxmLmJsZW5kID0gdHJ1ZTticmVhazsKICAgICAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgogICAgICAgICAgICBzZWxmLnNjaXNzb3JUZXN0ID0gdHJ1ZTticmVhazsKICAgICAgICAgIGNhc2UgZ2wuU1RFTkNJTF9URVNUOgogICAgICAgICAgICBzZWxmLnN0ZW5jaWxUZXN0ID0gdHJ1ZTticmVhazsKICAgICAgICB9CiAgICAgICAgc2VsZi5yZWFsRW5hYmxlLmNhbGwoZ2wsIHBuYW1lKTsKICAgICAgfTsKICAgICAgZ2wuZGlzYWJsZSA9IGZ1bmN0aW9uIChwbmFtZSkgewogICAgICAgIHN3aXRjaCAocG5hbWUpIHsKICAgICAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgogICAgICAgICAgICBzZWxmLmN1bGxGYWNlID0gZmFsc2U7YnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkRFUFRIX1RFU1Q6CiAgICAgICAgICAgIHNlbGYuZGVwdGhUZXN0ID0gZmFsc2U7YnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkJMRU5EOgogICAgICAgICAgICBzZWxmLmJsZW5kID0gZmFsc2U7YnJlYWs7CiAgICAgICAgICBjYXNlIGdsLlNDSVNTT1JfVEVTVDoKICAgICAgICAgICAgc2VsZi5zY2lzc29yVGVzdCA9IGZhbHNlO2JyZWFrOwogICAgICAgICAgY2FzZSBnbC5TVEVOQ0lMX1RFU1Q6CiAgICAgICAgICAgIHNlbGYuc3RlbmNpbFRlc3QgPSBmYWxzZTticmVhazsKICAgICAgICB9CiAgICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBwbmFtZSk7CiAgICAgIH07CiAgICAgIHRoaXMuY29sb3JNYXNrID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNPTE9SX1dSSVRFTUFTSyk7CiAgICAgIGdsLmNvbG9yTWFzayA9IGZ1bmN0aW9uIChyLCBnLCBiLCBhKSB7CiAgICAgICAgc2VsZi5jb2xvck1hc2tbMF0gPSByOwogICAgICAgIHNlbGYuY29sb3JNYXNrWzFdID0gZzsKICAgICAgICBzZWxmLmNvbG9yTWFza1syXSA9IGI7CiAgICAgICAgc2VsZi5jb2xvck1hc2tbM10gPSBhOwogICAgICAgIHNlbGYucmVhbENvbG9yTWFzay5jYWxsKGdsLCByLCBnLCBiLCBhKTsKICAgICAgfTsKICAgICAgdGhpcy5jbGVhckNvbG9yID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNPTE9SX0NMRUFSX1ZBTFVFKTsKICAgICAgZ2wuY2xlYXJDb2xvciA9IGZ1bmN0aW9uIChyLCBnLCBiLCBhKSB7CiAgICAgICAgc2VsZi5jbGVhckNvbG9yWzBdID0gcjsKICAgICAgICBzZWxmLmNsZWFyQ29sb3JbMV0gPSBnOwogICAgICAgIHNlbGYuY2xlYXJDb2xvclsyXSA9IGI7CiAgICAgICAgc2VsZi5jbGVhckNvbG9yWzNdID0gYTsKICAgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIHIsIGcsIGIsIGEpOwogICAgICB9OwogICAgICB0aGlzLnZpZXdwb3J0ID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLlZJRVdQT1JUKTsKICAgICAgZ2wudmlld3BvcnQgPSBmdW5jdGlvbiAoeCwgeSwgdywgaCkgewogICAgICAgIHNlbGYudmlld3BvcnRbMF0gPSB4OwogICAgICAgIHNlbGYudmlld3BvcnRbMV0gPSB5OwogICAgICAgIHNlbGYudmlld3BvcnRbMl0gPSB3OwogICAgICAgIHNlbGYudmlld3BvcnRbM10gPSBoOwogICAgICAgIHNlbGYucmVhbFZpZXdwb3J0LmNhbGwoZ2wsIHgsIHksIHcsIGgpOwogICAgICB9OwogICAgICB0aGlzLmlzUGF0Y2hlZCA9IHRydWU7CiAgICAgIHNhZmFyaUNzc1NpemVXb3JrYXJvdW5kKGNhbnZhcyk7CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS51bnBhdGNoID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMuaXNQYXRjaGVkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBnbCA9IHRoaXMuZ2w7CiAgICAgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKICAgICAgaWYgKCFpc0lPUygpKSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ3dpZHRoJywgdGhpcy5yZWFsQ2FudmFzV2lkdGgpOwogICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICdoZWlnaHQnLCB0aGlzLnJlYWxDYW52YXNIZWlnaHQpOwogICAgICB9CiAgICAgIGNhbnZhcy53aWR0aCA9IHRoaXMuYnVmZmVyV2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLmJ1ZmZlckhlaWdodDsKICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyID0gdGhpcy5yZWFsQmluZEZyYW1lYnVmZmVyOwogICAgICBnbC5lbmFibGUgPSB0aGlzLnJlYWxFbmFibGU7CiAgICAgIGdsLmRpc2FibGUgPSB0aGlzLnJlYWxEaXNhYmxlOwogICAgICBnbC5jb2xvck1hc2sgPSB0aGlzLnJlYWxDb2xvck1hc2s7CiAgICAgIGdsLmNsZWFyQ29sb3IgPSB0aGlzLnJlYWxDbGVhckNvbG9yOwogICAgICBnbC52aWV3cG9ydCA9IHRoaXMucmVhbFZpZXdwb3J0OwogICAgICBpZiAodGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9PSB0aGlzLmZyYW1lYnVmZmVyKSB7CiAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgICAgfQogICAgICB0aGlzLmlzUGF0Y2hlZCA9IGZhbHNlOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpOwogICAgICB9LCAxKTsKICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnNldFRleHR1cmVCb3VuZHMgPSBmdW5jdGlvbiAobGVmdEJvdW5kcywgcmlnaHRCb3VuZHMpIHsKICAgICAgaWYgKCFsZWZ0Qm91bmRzKSB7CiAgICAgICAgbGVmdEJvdW5kcyA9IFswLCAwLCAwLjUsIDFdOwogICAgICB9CiAgICAgIGlmICghcmlnaHRCb3VuZHMpIHsKICAgICAgICByaWdodEJvdW5kcyA9IFswLjUsIDAsIDAuNSwgMV07CiAgICAgIH0KICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzBdID0gbGVmdEJvdW5kc1swXTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzFdID0gbGVmdEJvdW5kc1sxXTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzJdID0gbGVmdEJvdW5kc1syXTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzNdID0gbGVmdEJvdW5kc1szXTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzRdID0gcmlnaHRCb3VuZHNbMF07CiAgICAgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs1XSA9IHJpZ2h0Qm91bmRzWzFdOwogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbNl0gPSByaWdodEJvdW5kc1syXTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzddID0gcmlnaHRCb3VuZHNbM107CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5zdWJtaXRGcmFtZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZ2xTdGF0ZSA9IFtdOwogICAgICBpZiAoIXRoaXMuZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzKSB7CiAgICAgICAgZ2xTdGF0ZS5wdXNoKGdsLkNVUlJFTlRfUFJPR1JBTSwgZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLlRFWFRVUkVfQklORElOR18yRCwgZ2wuVEVYVFVSRTApOwogICAgICB9CiAgICAgIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CiAgICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKICAgICAgICB2YXIgcG9zaXRpb25EaXZpc29yID0gMDsKICAgICAgICB2YXIgdGV4Q29vcmREaXZpc29yID0gMDsKICAgICAgICBpZiAoc2VsZi5pbnN0YW5jZUV4dCkgewogICAgICAgICAgcG9zaXRpb25EaXZpc29yID0gZ2wuZ2V0VmVydGV4QXR0cmliKHNlbGYuYXR0cmlicy5wb3NpdGlvbiwgc2VsZi5pbnN0YW5jZUV4dC5WRVJURVhfQVRUUklCX0FSUkFZX0RJVklTT1JfQU5HTEUpOwogICAgICAgICAgdGV4Q29vcmREaXZpc29yID0gZ2wuZ2V0VmVydGV4QXR0cmliKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgc2VsZi5pbnN0YW5jZUV4dC5WRVJURVhfQVRUUklCX0FSUkFZX0RJVklTT1JfQU5HTEUpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5jdWxsRmFjZSkgewogICAgICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5DVUxMX0ZBQ0UpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5kZXB0aFRlc3QpIHsKICAgICAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuREVQVEhfVEVTVCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLmJsZW5kKSB7CiAgICAgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLkJMRU5EKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKICAgICAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuU0NJU1NPUl9URVNUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuc3RlbmNpbFRlc3QpIHsKICAgICAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuU1RFTkNJTF9URVNUKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHRydWUsIHRydWUsIHRydWUsIHRydWUpOwogICAgICAgIHNlbGYucmVhbFZpZXdwb3J0LmNhbGwoZ2wsIDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CiAgICAgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5hbHBoYSB8fCBpc0lPUygpKSB7CiAgICAgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIDAsIDAsIDAsIDEpOwogICAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CiAgICAgICAgfQogICAgICAgIGdsLnVzZVByb2dyYW0oc2VsZi5wcm9ncmFtKTsKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBzZWxmLmluZGV4QnVmZmVyKTsKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgc2VsZi52ZXJ0ZXhCdWZmZXIpOwogICAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNlbGYuYXR0cmlicy5wb3NpdGlvbik7CiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoc2VsZi5hdHRyaWJzLnRleENvb3JkKTsKICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHNlbGYuYXR0cmlicy5wb3NpdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAyMCwgMCk7CiAgICAgICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihzZWxmLmF0dHJpYnMudGV4Q29vcmQsIDMsIGdsLkZMT0FULCBmYWxzZSwgMjAsIDgpOwogICAgICAgIGlmIChzZWxmLmluc3RhbmNlRXh0KSB7CiAgICAgICAgICBpZiAocG9zaXRpb25EaXZpc29yICE9IDApIHsKICAgICAgICAgICAgc2VsZi5pbnN0YW5jZUV4dC52ZXJ0ZXhBdHRyaWJEaXZpc29yQU5HTEUoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCAwKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0ZXhDb29yZERpdmlzb3IgIT0gMCkgewogICAgICAgICAgICBzZWxmLmluc3RhbmNlRXh0LnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShzZWxmLmF0dHJpYnMudGV4Q29vcmQsIDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTsKICAgICAgICBnbC51bmlmb3JtMWkoc2VsZi51bmlmb3Jtcy5kaWZmdXNlLCAwKTsKICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCk7CiAgICAgICAgZ2wudW5pZm9ybTRmdihzZWxmLnVuaWZvcm1zLnZpZXdwb3J0T2Zmc2V0U2NhbGUsIHNlbGYudmlld3BvcnRPZmZzZXRTY2FsZSk7CiAgICAgICAgZ2wuZHJhd0VsZW1lbnRzKGdsLlRSSUFOR0xFUywgc2VsZi5pbmRleENvdW50LCBnbC5VTlNJR05FRF9TSE9SVCwgMCk7CiAgICAgICAgaWYgKHNlbGYuY2FyZGJvYXJkVUkpIHsKICAgICAgICAgIHNlbGYuY2FyZGJvYXJkVUkucmVuZGVyTm9TdGF0ZSgpOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChzZWxmLmdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5mcmFtZWJ1ZmZlcik7CiAgICAgICAgaWYgKCFzZWxmLmN0eEF0dHJpYnMucHJlc2VydmVEcmF3aW5nQnVmZmVyKSB7CiAgICAgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIDAsIDAsIDAsIDApOwogICAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CiAgICAgICAgfQogICAgICAgIGlmICghc2VsZi5kaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MpIHsKICAgICAgICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLmN1bGxGYWNlKSB7CiAgICAgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuQ1VMTF9GQUNFKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuZGVwdGhUZXN0KSB7CiAgICAgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuREVQVEhfVEVTVCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLmJsZW5kKSB7CiAgICAgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuQkxFTkQpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewogICAgICAgICAgc2VsZi5yZWFsRW5hYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLnN0ZW5jaWxUZXN0KSB7CiAgICAgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU1RFTkNJTF9URVNUKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmFwcGx5KGdsLCBzZWxmLmNvbG9yTWFzayk7CiAgICAgICAgc2VsZi5yZWFsVmlld3BvcnQuYXBwbHkoZ2wsIHNlbGYudmlld3BvcnQpOwogICAgICAgIGlmIChzZWxmLmN0eEF0dHJpYnMuYWxwaGEgfHwgIXNlbGYuY3R4QXR0cmlicy5wcmVzZXJ2ZURyYXdpbmdCdWZmZXIpIHsKICAgICAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuYXBwbHkoZ2wsIHNlbGYuY2xlYXJDb2xvcik7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLmluc3RhbmNlRXh0KSB7CiAgICAgICAgICBpZiAocG9zaXRpb25EaXZpc29yICE9IDApIHsKICAgICAgICAgICAgc2VsZi5pbnN0YW5jZUV4dC52ZXJ0ZXhBdHRyaWJEaXZpc29yQU5HTEUoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCBwb3NpdGlvbkRpdmlzb3IpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRleENvb3JkRGl2aXNvciAhPSAwKSB7CiAgICAgICAgICAgIHNlbGYuaW5zdGFuY2VFeHQudmVydGV4QXR0cmliRGl2aXNvckFOR0xFKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgdGV4Q29vcmREaXZpc29yKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICBpZiAoaXNJT1MoKSkgewogICAgICAgIHZhciBjYW52YXMgPSBnbC5jYW52YXM7CiAgICAgICAgaWYgKGNhbnZhcy53aWR0aCAhPSBzZWxmLmJ1ZmZlcldpZHRoIHx8IGNhbnZhcy5oZWlnaHQgIT0gc2VsZi5idWZmZXJIZWlnaHQpIHsKICAgICAgICAgIHNlbGYuYnVmZmVyV2lkdGggPSBjYW52YXMud2lkdGg7CiAgICAgICAgICBzZWxmLmJ1ZmZlckhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7CiAgICAgICAgICBzZWxmLm9uUmVzaXplKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS51cGRhdGVEZXZpY2VJbmZvID0gZnVuY3Rpb24gKGRldmljZUluZm8pIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZ2xTdGF0ZSA9IFtnbC5BUlJBWV9CVUZGRVJfQklORElORywgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVJfQklORElOR107CiAgICAgIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CiAgICAgICAgdmFyIHZlcnRpY2VzID0gc2VsZi5jb21wdXRlTWVzaFZlcnRpY2VzXyhzZWxmLm1lc2hXaWR0aCwgc2VsZi5tZXNoSGVpZ2h0LCBkZXZpY2VJbmZvKTsKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgc2VsZi52ZXJ0ZXhCdWZmZXIpOwogICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0aWNlcywgZ2wuU1RBVElDX0RSQVcpOwogICAgICAgIGlmICghc2VsZi5pbmRleENvdW50KSB7CiAgICAgICAgICB2YXIgaW5kaWNlcyA9IHNlbGYuY29tcHV0ZU1lc2hJbmRpY2VzXyhzZWxmLm1lc2hXaWR0aCwgc2VsZi5tZXNoSGVpZ2h0KTsKICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIHNlbGYuaW5kZXhCdWZmZXIpOwogICAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaW5kaWNlcywgZ2wuU1RBVElDX0RSQVcpOwogICAgICAgICAgc2VsZi5pbmRleENvdW50ID0gaW5kaWNlcy5sZW5ndGg7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLmNvbXB1dGVNZXNoVmVydGljZXNfID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIGRldmljZUluZm8pIHsKICAgICAgdmFyIHZlcnRpY2VzID0gbmV3IEZsb2F0MzJBcnJheSgyICogd2lkdGggKiBoZWlnaHQgKiA1KTsKICAgICAgdmFyIGxlbnNGcnVzdHVtID0gZGV2aWNlSW5mby5nZXRMZWZ0RXllVmlzaWJsZVRhbkFuZ2xlcygpOwogICAgICB2YXIgbm9MZW5zRnJ1c3R1bSA9IGRldmljZUluZm8uZ2V0TGVmdEV5ZU5vTGVuc1RhbkFuZ2xlcygpOwogICAgICB2YXIgdmlld3BvcnQgPSBkZXZpY2VJbmZvLmdldExlZnRFeWVWaXNpYmxlU2NyZWVuUmVjdChub0xlbnNGcnVzdHVtKTsKICAgICAgdmFyIHZpZHggPSAwOwogICAgICBmb3IgKHZhciBlID0gMDsgZSA8IDI7IGUrKykgewogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGVpZ2h0OyBqKyspIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2lkdGg7IGkrKywgdmlkeCsrKSB7CiAgICAgICAgICAgIHZhciB1ID0gaSAvICh3aWR0aCAtIDEpOwogICAgICAgICAgICB2YXIgdiA9IGogLyAoaGVpZ2h0IC0gMSk7CiAgICAgICAgICAgIHZhciBzID0gdTsKICAgICAgICAgICAgdmFyIHQgPSB2OwogICAgICAgICAgICB2YXIgeCA9IGxlcnAobGVuc0ZydXN0dW1bMF0sIGxlbnNGcnVzdHVtWzJdLCB1KTsKICAgICAgICAgICAgdmFyIHkgPSBsZXJwKGxlbnNGcnVzdHVtWzNdLCBsZW5zRnJ1c3R1bVsxXSwgdik7CiAgICAgICAgICAgIHZhciBkID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpOwogICAgICAgICAgICB2YXIgciA9IGRldmljZUluZm8uZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShkKTsKICAgICAgICAgICAgdmFyIHAgPSB4ICogciAvIGQ7CiAgICAgICAgICAgIHZhciBxID0geSAqIHIgLyBkOwogICAgICAgICAgICB1ID0gKHAgLSBub0xlbnNGcnVzdHVtWzBdKSAvIChub0xlbnNGcnVzdHVtWzJdIC0gbm9MZW5zRnJ1c3R1bVswXSk7CiAgICAgICAgICAgIHYgPSAocSAtIG5vTGVuc0ZydXN0dW1bM10pIC8gKG5vTGVuc0ZydXN0dW1bMV0gLSBub0xlbnNGcnVzdHVtWzNdKTsKICAgICAgICAgICAgdSA9ICh2aWV3cG9ydC54ICsgdSAqIHZpZXdwb3J0LndpZHRoIC0gMC41KSAqIDIuMDsKICAgICAgICAgICAgdiA9ICh2aWV3cG9ydC55ICsgdiAqIHZpZXdwb3J0LmhlaWdodCAtIDAuNSkgKiAyLjA7CiAgICAgICAgICAgIHZlcnRpY2VzW3ZpZHggKiA1ICsgMF0gPSB1OwogICAgICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDFdID0gdjsKICAgICAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAyXSA9IHM7CiAgICAgICAgICAgIHZlcnRpY2VzW3ZpZHggKiA1ICsgM10gPSB0OwogICAgICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDRdID0gZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHcgPSBsZW5zRnJ1c3R1bVsyXSAtIGxlbnNGcnVzdHVtWzBdOwogICAgICAgIGxlbnNGcnVzdHVtWzBdID0gLSh3ICsgbGVuc0ZydXN0dW1bMF0pOwogICAgICAgIGxlbnNGcnVzdHVtWzJdID0gdyAtIGxlbnNGcnVzdHVtWzJdOwogICAgICAgIHcgPSBub0xlbnNGcnVzdHVtWzJdIC0gbm9MZW5zRnJ1c3R1bVswXTsKICAgICAgICBub0xlbnNGcnVzdHVtWzBdID0gLSh3ICsgbm9MZW5zRnJ1c3R1bVswXSk7CiAgICAgICAgbm9MZW5zRnJ1c3R1bVsyXSA9IHcgLSBub0xlbnNGcnVzdHVtWzJdOwogICAgICAgIHZpZXdwb3J0LnggPSAxIC0gKHZpZXdwb3J0LnggKyB2aWV3cG9ydC53aWR0aCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHZlcnRpY2VzOwogICAgfTsKICAgIENhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuY29tcHV0ZU1lc2hJbmRpY2VzXyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7CiAgICAgIHZhciBpbmRpY2VzID0gbmV3IFVpbnQxNkFycmF5KDIgKiAod2lkdGggLSAxKSAqIChoZWlnaHQgLSAxKSAqIDYpOwogICAgICB2YXIgaGFsZndpZHRoID0gd2lkdGggLyAyOwogICAgICB2YXIgaGFsZmhlaWdodCA9IGhlaWdodCAvIDI7CiAgICAgIHZhciB2aWR4ID0gMDsKICAgICAgdmFyIGlpZHggPSAwOwogICAgICBmb3IgKHZhciBlID0gMDsgZSA8IDI7IGUrKykgewogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGVpZ2h0OyBqKyspIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2lkdGg7IGkrKywgdmlkeCsrKSB7CiAgICAgICAgICAgIGlmIChpID09IDAgfHwgaiA9PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgaWYgKGkgPD0gaGFsZndpZHRoID09IGogPD0gaGFsZmhlaWdodCkgewogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHg7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGg7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gMTsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGggLSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBpbmRpY2VzOwogICAgfTsKICAgIENhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yXyA9IGZ1bmN0aW9uIChwcm90bywgYXR0ck5hbWUpIHsKICAgICAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHByb3RvLCBhdHRyTmFtZSk7CiAgICAgIGlmIChkZXNjcmlwdG9yLmdldCA9PT0gdW5kZWZpbmVkIHx8IGRlc2NyaXB0b3Iuc2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CiAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gdHJ1ZTsKICAgICAgICBkZXNjcmlwdG9yLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZShhdHRyTmFtZSk7CiAgICAgICAgfTsKICAgICAgICBkZXNjcmlwdG9yLnNldCA9IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCB2YWwpOwogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgICB9OwogICAgdmFyIHVpVlMgPSBbJ2F0dHJpYnV0ZSB2ZWMyIHBvc2l0aW9uOycsICd1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdDsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdCAqIHZlYzQoIHBvc2l0aW9uLCAtMS4wLCAxLjAgKTsnLCAnfSddLmpvaW4oJ1xuJyk7CiAgICB2YXIgdWlGUyA9IFsncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7JywgJ3VuaWZvcm0gdmVjNCBjb2xvcjsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX0ZyYWdDb2xvciA9IGNvbG9yOycsICd9J10uam9pbignXG4nKTsKICAgIHZhciBERUcyUkFEID0gTWF0aC5QSSAvIDE4MC4wOwogICAgdmFyIGtBbmdsZVBlckdlYXJTZWN0aW9uID0gNjA7CiAgICB2YXIga091dGVyUmltRW5kQW5nbGUgPSAxMjsKICAgIHZhciBrSW5uZXJSaW1CZWdpbkFuZ2xlID0gMjA7CiAgICB2YXIga091dGVyUmFkaXVzID0gMTsKICAgIHZhciBrTWlkZGxlUmFkaXVzID0gMC43NTsKICAgIHZhciBrSW5uZXJSYWRpdXMgPSAwLjMxMjU7CiAgICB2YXIga0NlbnRlckxpbmVUaGlja25lc3NEcCA9IDQ7CiAgICB2YXIga0J1dHRvbldpZHRoRHAgPSAyODsKICAgIHZhciBrVG91Y2hTbG9wRmFjdG9yID0gMS41OwogICAgZnVuY3Rpb24gQ2FyZGJvYXJkVUkoZ2wpIHsKICAgICAgdGhpcy5nbCA9IGdsOwogICAgICB0aGlzLmF0dHJpYnMgPSB7CiAgICAgICAgcG9zaXRpb246IDAKICAgICAgfTsKICAgICAgdGhpcy5wcm9ncmFtID0gbGlua1Byb2dyYW0oZ2wsIHVpVlMsIHVpRlMsIHRoaXMuYXR0cmlicyk7CiAgICAgIHRoaXMudW5pZm9ybXMgPSBnZXRQcm9ncmFtVW5pZm9ybXMoZ2wsIHRoaXMucHJvZ3JhbSk7CiAgICAgIHRoaXMudmVydGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIHRoaXMuZ2Vhck9mZnNldCA9IDA7CiAgICAgIHRoaXMuZ2VhclZlcnRleENvdW50ID0gMDsKICAgICAgdGhpcy5hcnJvd09mZnNldCA9IDA7CiAgICAgIHRoaXMuYXJyb3dWZXJ0ZXhDb3VudCA9IDA7CiAgICAgIHRoaXMucHJvak1hdCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICB0aGlzLmxpc3RlbmVyID0gbnVsbDsKICAgICAgdGhpcy5vblJlc2l6ZSgpOwogICAgfQogICAgQ2FyZGJvYXJkVUkucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBnbCA9IHRoaXMuZ2w7CiAgICAgIGlmICh0aGlzLmxpc3RlbmVyKSB7CiAgICAgICAgZ2wuY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5saXN0ZW5lciwgZmFsc2UpOwogICAgICB9CiAgICAgIGdsLmRlbGV0ZVByb2dyYW0odGhpcy5wcm9ncmFtKTsKICAgICAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMudmVydGV4QnVmZmVyKTsKICAgIH07CiAgICBDYXJkYm9hcmRVSS5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24gKG9wdGlvbnNDYWxsYmFjaywgYmFja0NhbGxiYWNrKSB7CiAgICAgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKICAgICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIHZhciBtaWRsaW5lID0gY2FudmFzLmNsaWVudFdpZHRoIC8gMjsKICAgICAgICB2YXIgYnV0dG9uU2l6ZSA9IGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvcjsKICAgICAgICBpZiAoZXZlbnQuY2xpZW50WCA+IG1pZGxpbmUgLSBidXR0b25TaXplICYmIGV2ZW50LmNsaWVudFggPCBtaWRsaW5lICsgYnV0dG9uU2l6ZSAmJiBldmVudC5jbGllbnRZID4gY2FudmFzLmNsaWVudEhlaWdodCAtIGJ1dHRvblNpemUpIHsKICAgICAgICAgIG9wdGlvbnNDYWxsYmFjayhldmVudCk7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGV2ZW50LmNsaWVudFggPCBidXR0b25TaXplICYmIGV2ZW50LmNsaWVudFkgPCBidXR0b25TaXplKSB7CiAgICAgICAgICAgIGJhY2tDYWxsYmFjayhldmVudCk7CiAgICAgICAgICB9CiAgICAgIH07CiAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMubGlzdGVuZXIsIGZhbHNlKTsKICAgIH07CiAgICBDYXJkYm9hcmRVSS5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBnbCA9IHRoaXMuZ2w7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGdsU3RhdGUgPSBbZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkddOwogICAgICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewogICAgICAgIHZhciB2ZXJ0aWNlcyA9IFtdOwogICAgICAgIHZhciBtaWRsaW5lID0gZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gMjsKICAgICAgICB2YXIgcGh5c2ljYWxQaXhlbHMgPSBNYXRoLm1heChzY3JlZW4ud2lkdGgsIHNjcmVlbi5oZWlnaHQpICogd2luZG93LmRldmljZVBpeGVsUmF0aW87CiAgICAgICAgdmFyIHNjYWxpbmdSYXRpbyA9IGdsLmRyYXdpbmdCdWZmZXJXaWR0aCAvIHBoeXNpY2FsUGl4ZWxzOwogICAgICAgIHZhciBkcHMgPSBzY2FsaW5nUmF0aW8gKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICB2YXIgbGluZVdpZHRoID0ga0NlbnRlckxpbmVUaGlja25lc3NEcCAqIGRwcyAvIDI7CiAgICAgICAgdmFyIGJ1dHRvblNpemUgPSBrQnV0dG9uV2lkdGhEcCAqIGtUb3VjaFNsb3BGYWN0b3IgKiBkcHM7CiAgICAgICAgdmFyIGJ1dHRvblNjYWxlID0ga0J1dHRvbldpZHRoRHAgKiBkcHMgLyAyOwogICAgICAgIHZhciBidXR0b25Cb3JkZXIgPSAoa0J1dHRvbldpZHRoRHAgKiBrVG91Y2hTbG9wRmFjdG9yIC0ga0J1dHRvbldpZHRoRHApICogZHBzOwogICAgICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSAtIGxpbmVXaWR0aCwgYnV0dG9uU2l6ZSk7CiAgICAgICAgdmVydGljZXMucHVzaChtaWRsaW5lIC0gbGluZVdpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKICAgICAgICB2ZXJ0aWNlcy5wdXNoKG1pZGxpbmUgKyBsaW5lV2lkdGgsIGJ1dHRvblNpemUpOwogICAgICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSArIGxpbmVXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CiAgICAgICAgc2VsZi5nZWFyT2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMjsKICAgICAgICBmdW5jdGlvbiBhZGRHZWFyU2VnbWVudCh0aGV0YSwgcikgewogICAgICAgICAgdmFyIGFuZ2xlID0gKDkwIC0gdGhldGEpICogREVHMlJBRDsKICAgICAgICAgIHZhciB4ID0gTWF0aC5jb3MoYW5nbGUpOwogICAgICAgICAgdmFyIHkgPSBNYXRoLnNpbihhbmdsZSk7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKGtJbm5lclJhZGl1cyAqIHggKiBidXR0b25TY2FsZSArIG1pZGxpbmUsIGtJbm5lclJhZGl1cyAqIHkgKiBidXR0b25TY2FsZSArIGJ1dHRvblNjYWxlKTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2gociAqIHggKiBidXR0b25TY2FsZSArIG1pZGxpbmUsIHIgKiB5ICogYnV0dG9uU2NhbGUgKyBidXR0b25TY2FsZSk7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDY7IGkrKykgewogICAgICAgICAgdmFyIHNlZ21lbnRUaGV0YSA9IGkgKiBrQW5nbGVQZXJHZWFyU2VjdGlvbjsKICAgICAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSwga091dGVyUmFkaXVzKTsKICAgICAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIGtPdXRlclJpbUVuZEFuZ2xlLCBrT3V0ZXJSYWRpdXMpOwogICAgICAgICAgYWRkR2VhclNlZ21lbnQoc2VnbWVudFRoZXRhICsga0lubmVyUmltQmVnaW5BbmdsZSwga01pZGRsZVJhZGl1cyk7CiAgICAgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyAoa0FuZ2xlUGVyR2VhclNlY3Rpb24gLSBrSW5uZXJSaW1CZWdpbkFuZ2xlKSwga01pZGRsZVJhZGl1cyk7CiAgICAgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyAoa0FuZ2xlUGVyR2VhclNlY3Rpb24gLSBrT3V0ZXJSaW1FbmRBbmdsZSksIGtPdXRlclJhZGl1cyk7CiAgICAgICAgfQogICAgICAgIHNlbGYuZ2VhclZlcnRleENvdW50ID0gdmVydGljZXMubGVuZ3RoIC8gMiAtIHNlbGYuZ2Vhck9mZnNldDsKICAgICAgICBzZWxmLmFycm93T2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMjsKICAgICAgICBmdW5jdGlvbiBhZGRBcnJvd1ZlcnRleCh4LCB5KSB7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKGJ1dHRvbkJvcmRlciArIHgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQgLSBidXR0b25Cb3JkZXIgLSB5KTsKICAgICAgICB9CiAgICAgICAgdmFyIGFuZ2xlZExpbmVXaWR0aCA9IGxpbmVXaWR0aCAvIE1hdGguc2luKDQ1ICogREVHMlJBRCk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoMCwgYnV0dG9uU2NhbGUpOwogICAgICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlLCAwKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChidXR0b25TY2FsZSArIGFuZ2xlZExpbmVXaWR0aCwgYW5nbGVkTGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlICsgYW5nbGVkTGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlIC0gYW5nbGVkTGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleCgwLCBidXR0b25TY2FsZSk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUsIGJ1dHRvblNjYWxlICogMik7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUgKyBhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlICogMiAtIGFuZ2xlZExpbmVXaWR0aCk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSAtIGFuZ2xlZExpbmVXaWR0aCk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoMCwgYnV0dG9uU2NhbGUpOwogICAgICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgLSBsaW5lV2lkdGgpOwogICAgICAgIGFkZEFycm93VmVydGV4KGtCdXR0b25XaWR0aERwICogZHBzLCBidXR0b25TY2FsZSAtIGxpbmVXaWR0aCk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSArIGxpbmVXaWR0aCk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoa0J1dHRvbldpZHRoRHAgKiBkcHMsIGJ1dHRvblNjYWxlICsgbGluZVdpZHRoKTsKICAgICAgICBzZWxmLmFycm93VmVydGV4Q291bnQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyIC0gc2VsZi5hcnJvd09mZnNldDsKICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgc2VsZi52ZXJ0ZXhCdWZmZXIpOwogICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKSwgZ2wuU1RBVElDX0RSQVcpOwogICAgICB9KTsKICAgIH07CiAgICBDYXJkYm9hcmRVSS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZ2wgPSB0aGlzLmdsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBnbFN0YXRlID0gW2dsLkNVTExfRkFDRSwgZ2wuREVQVEhfVEVTVCwgZ2wuQkxFTkQsIGdsLlNDSVNTT1JfVEVTVCwgZ2wuU1RFTkNJTF9URVNULCBnbC5DT0xPUl9XUklURU1BU0ssIGdsLlZJRVdQT1JULCBnbC5DVVJSRU5UX1BST0dSQU0sIGdsLkFSUkFZX0JVRkZFUl9CSU5ESU5HXTsKICAgICAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKICAgICAgICBnbC5kaXNhYmxlKGdsLkNVTExfRkFDRSk7CiAgICAgICAgZ2wuZGlzYWJsZShnbC5ERVBUSF9URVNUKTsKICAgICAgICBnbC5kaXNhYmxlKGdsLkJMRU5EKTsKICAgICAgICBnbC5kaXNhYmxlKGdsLlNDSVNTT1JfVEVTVCk7CiAgICAgICAgZ2wuZGlzYWJsZShnbC5TVEVOQ0lMX1RFU1QpOwogICAgICAgIGdsLmNvbG9yTWFzayh0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTsKICAgICAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwogICAgICAgIHNlbGYucmVuZGVyTm9TdGF0ZSgpOwogICAgICB9KTsKICAgIH07CiAgICBDYXJkYm9hcmRVSS5wcm90b3R5cGUucmVuZGVyTm9TdGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgZ2wudXNlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwogICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy52ZXJ0ZXhCdWZmZXIpOwogICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheSh0aGlzLmF0dHJpYnMucG9zaXRpb24pOwogICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHRoaXMuYXR0cmlicy5wb3NpdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCA4LCAwKTsKICAgICAgZ2wudW5pZm9ybTRmKHRoaXMudW5pZm9ybXMuY29sb3IsIDEuMCwgMS4wLCAxLjAsIDEuMCk7CiAgICAgIG9ydGhvTWF0cml4KHRoaXMucHJvak1hdCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCAwLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0LCAwLjEsIDEwMjQuMCk7CiAgICAgIGdsLnVuaWZvcm1NYXRyaXg0ZnYodGhpcy51bmlmb3Jtcy5wcm9qZWN0aW9uTWF0LCBmYWxzZSwgdGhpcy5wcm9qTWF0KTsKICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgMCwgNCk7CiAgICAgIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVfU1RSSVAsIHRoaXMuZ2Vhck9mZnNldCwgdGhpcy5nZWFyVmVydGV4Q291bnQpOwogICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCB0aGlzLmFycm93T2Zmc2V0LCB0aGlzLmFycm93VmVydGV4Q291bnQpOwogICAgfTsKICAgIGZ1bmN0aW9uIERpc3RvcnRpb24oY29lZmZpY2llbnRzKSB7CiAgICAgIHRoaXMuY29lZmZpY2llbnRzID0gY29lZmZpY2llbnRzOwogICAgfQogICAgRGlzdG9ydGlvbi5wcm90b3R5cGUuZGlzdG9ydEludmVyc2UgPSBmdW5jdGlvbiAocmFkaXVzKSB7CiAgICAgIHZhciByMCA9IDA7CiAgICAgIHZhciByMSA9IDE7CiAgICAgIHZhciBkcjAgPSByYWRpdXMgLSB0aGlzLmRpc3RvcnQocjApOwogICAgICB3aGlsZSAoTWF0aC5hYnMocjEgLSByMCkgPiAwLjAwMDEgICAgICAgICAgICAgKSB7CiAgICAgICAgdmFyIGRyMSA9IHJhZGl1cyAtIHRoaXMuZGlzdG9ydChyMSk7CiAgICAgICAgdmFyIHIyID0gcjEgLSBkcjEgKiAoKHIxIC0gcjApIC8gKGRyMSAtIGRyMCkpOwogICAgICAgIHIwID0gcjE7CiAgICAgICAgcjEgPSByMjsKICAgICAgICBkcjAgPSBkcjE7CiAgICAgIH0KICAgICAgcmV0dXJuIHIxOwogICAgfTsKICAgIERpc3RvcnRpb24ucHJvdG90eXBlLmRpc3RvcnQgPSBmdW5jdGlvbiAocmFkaXVzKSB7CiAgICAgIHZhciByMiA9IHJhZGl1cyAqIHJhZGl1czsKICAgICAgdmFyIHJldCA9IDA7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jb2VmZmljaWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICByZXQgPSByMiAqIChyZXQgKyB0aGlzLmNvZWZmaWNpZW50c1tpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIChyZXQgKyAxKSAqIHJhZGl1czsKICAgIH07CiAgICB2YXIgZGVnVG9SYWQgPSBNYXRoLlBJIC8gMTgwOwogICAgdmFyIHJhZFRvRGVnID0gMTgwIC8gTWF0aC5QSTsKICAgIHZhciBWZWN0b3IzID0gZnVuY3Rpb24gVmVjdG9yMyh4LCB5LCB6KSB7CiAgICAgIHRoaXMueCA9IHggfHwgMDsKICAgICAgdGhpcy55ID0geSB8fCAwOwogICAgICB0aGlzLnogPSB6IHx8IDA7CiAgICB9OwogICAgVmVjdG9yMy5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBWZWN0b3IzLAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh4LCB5LCB6KSB7CiAgICAgICAgdGhpcy54ID0geDsKICAgICAgICB0aGlzLnkgPSB5OwogICAgICAgIHRoaXMueiA9IHo7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGNvcHk6IGZ1bmN0aW9uIGNvcHkodikgewogICAgICAgIHRoaXMueCA9IHYueDsKICAgICAgICB0aGlzLnkgPSB2Lnk7CiAgICAgICAgdGhpcy56ID0gdi56OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBsZW5ndGg6IGZ1bmN0aW9uIGxlbmd0aCgpIHsKICAgICAgICByZXR1cm4gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueik7CiAgICAgIH0sCiAgICAgIG5vcm1hbGl6ZTogZnVuY3Rpb24gbm9ybWFsaXplKCkgewogICAgICAgIHZhciBzY2FsYXIgPSB0aGlzLmxlbmd0aCgpOwogICAgICAgIGlmIChzY2FsYXIgIT09IDApIHsKICAgICAgICAgIHZhciBpbnZTY2FsYXIgPSAxIC8gc2NhbGFyOwogICAgICAgICAgdGhpcy5tdWx0aXBseVNjYWxhcihpbnZTY2FsYXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnggPSAwOwogICAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICAgIHRoaXMueiA9IDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBtdWx0aXBseVNjYWxhcjogZnVuY3Rpb24gbXVsdGlwbHlTY2FsYXIoc2NhbGFyKSB7CiAgICAgICAgdGhpcy54ICo9IHNjYWxhcjsKICAgICAgICB0aGlzLnkgKj0gc2NhbGFyOwogICAgICAgIHRoaXMueiAqPSBzY2FsYXI7CiAgICAgIH0sCiAgICAgIGFwcGx5UXVhdGVybmlvbjogZnVuY3Rpb24gYXBwbHlRdWF0ZXJuaW9uKHEpIHsKICAgICAgICB2YXIgeCA9IHRoaXMueDsKICAgICAgICB2YXIgeSA9IHRoaXMueTsKICAgICAgICB2YXIgeiA9IHRoaXMuejsKICAgICAgICB2YXIgcXggPSBxLng7CiAgICAgICAgdmFyIHF5ID0gcS55OwogICAgICAgIHZhciBxeiA9IHEuejsKICAgICAgICB2YXIgcXcgPSBxLnc7CiAgICAgICAgdmFyIGl4ID0gcXcgKiB4ICsgcXkgKiB6IC0gcXogKiB5OwogICAgICAgIHZhciBpeSA9IHF3ICogeSArIHF6ICogeCAtIHF4ICogejsKICAgICAgICB2YXIgaXogPSBxdyAqIHogKyBxeCAqIHkgLSBxeSAqIHg7CiAgICAgICAgdmFyIGl3ID0gLXF4ICogeCAtIHF5ICogeSAtIHF6ICogejsKICAgICAgICB0aGlzLnggPSBpeCAqIHF3ICsgaXcgKiAtcXggKyBpeSAqIC1xeiAtIGl6ICogLXF5OwogICAgICAgIHRoaXMueSA9IGl5ICogcXcgKyBpdyAqIC1xeSArIGl6ICogLXF4IC0gaXggKiAtcXo7CiAgICAgICAgdGhpcy56ID0gaXogKiBxdyArIGl3ICogLXF6ICsgaXggKiAtcXkgLSBpeSAqIC1xeDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgZG90OiBmdW5jdGlvbiBkb3QodikgewogICAgICAgIHJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2Lno7CiAgICAgIH0sCiAgICAgIGNyb3NzVmVjdG9yczogZnVuY3Rpb24gY3Jvc3NWZWN0b3JzKGEsIGIpIHsKICAgICAgICB2YXIgYXggPSBhLngsCiAgICAgICAgICAgIGF5ID0gYS55LAogICAgICAgICAgICBheiA9IGEuejsKICAgICAgICB2YXIgYnggPSBiLngsCiAgICAgICAgICAgIGJ5ID0gYi55LAogICAgICAgICAgICBieiA9IGIuejsKICAgICAgICB0aGlzLnggPSBheSAqIGJ6IC0gYXogKiBieTsKICAgICAgICB0aGlzLnkgPSBheiAqIGJ4IC0gYXggKiBiejsKICAgICAgICB0aGlzLnogPSBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIHZhciBRdWF0ZXJuaW9uID0gZnVuY3Rpb24gUXVhdGVybmlvbih4LCB5LCB6LCB3KSB7CiAgICAgIHRoaXMueCA9IHggfHwgMDsKICAgICAgdGhpcy55ID0geSB8fCAwOwogICAgICB0aGlzLnogPSB6IHx8IDA7CiAgICAgIHRoaXMudyA9IHcgIT09IHVuZGVmaW5lZCA/IHcgOiAxOwogICAgfTsKICAgIFF1YXRlcm5pb24ucHJvdG90eXBlID0gewogICAgICBjb25zdHJ1Y3RvcjogUXVhdGVybmlvbiwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQoeCwgeSwgeiwgdykgewogICAgICAgIHRoaXMueCA9IHg7CiAgICAgICAgdGhpcy55ID0geTsKICAgICAgICB0aGlzLnogPSB6OwogICAgICAgIHRoaXMudyA9IHc7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGNvcHk6IGZ1bmN0aW9uIGNvcHkocXVhdGVybmlvbikgewogICAgICAgIHRoaXMueCA9IHF1YXRlcm5pb24ueDsKICAgICAgICB0aGlzLnkgPSBxdWF0ZXJuaW9uLnk7CiAgICAgICAgdGhpcy56ID0gcXVhdGVybmlvbi56OwogICAgICAgIHRoaXMudyA9IHF1YXRlcm5pb24udzsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgc2V0RnJvbUV1bGVyWFlaOiBmdW5jdGlvbiBzZXRGcm9tRXVsZXJYWVooeCwgeSwgeikgewogICAgICAgIHZhciBjMSA9IE1hdGguY29zKHggLyAyKTsKICAgICAgICB2YXIgYzIgPSBNYXRoLmNvcyh5IC8gMik7CiAgICAgICAgdmFyIGMzID0gTWF0aC5jb3MoeiAvIDIpOwogICAgICAgIHZhciBzMSA9IE1hdGguc2luKHggLyAyKTsKICAgICAgICB2YXIgczIgPSBNYXRoLnNpbih5IC8gMik7CiAgICAgICAgdmFyIHMzID0gTWF0aC5zaW4oeiAvIDIpOwogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgc2V0RnJvbUV1bGVyWVhaOiBmdW5jdGlvbiBzZXRGcm9tRXVsZXJZWFooeCwgeSwgeikgewogICAgICAgIHZhciBjMSA9IE1hdGguY29zKHggLyAyKTsKICAgICAgICB2YXIgYzIgPSBNYXRoLmNvcyh5IC8gMik7CiAgICAgICAgdmFyIGMzID0gTWF0aC5jb3MoeiAvIDIpOwogICAgICAgIHZhciBzMSA9IE1hdGguc2luKHggLyAyKTsKICAgICAgICB2YXIgczIgPSBNYXRoLnNpbih5IC8gMik7CiAgICAgICAgdmFyIHMzID0gTWF0aC5zaW4oeiAvIDIpOwogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgc2V0RnJvbUF4aXNBbmdsZTogZnVuY3Rpb24gc2V0RnJvbUF4aXNBbmdsZShheGlzLCBhbmdsZSkgewogICAgICAgIHZhciBoYWxmQW5nbGUgPSBhbmdsZSAvIDIsCiAgICAgICAgICAgIHMgPSBNYXRoLnNpbihoYWxmQW5nbGUpOwogICAgICAgIHRoaXMueCA9IGF4aXMueCAqIHM7CiAgICAgICAgdGhpcy55ID0gYXhpcy55ICogczsKICAgICAgICB0aGlzLnogPSBheGlzLnogKiBzOwogICAgICAgIHRoaXMudyA9IE1hdGguY29zKGhhbGZBbmdsZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIG11bHRpcGx5OiBmdW5jdGlvbiBtdWx0aXBseShxKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyh0aGlzLCBxKTsKICAgICAgfSwKICAgICAgbXVsdGlwbHlRdWF0ZXJuaW9uczogZnVuY3Rpb24gbXVsdGlwbHlRdWF0ZXJuaW9ucyhhLCBiKSB7CiAgICAgICAgdmFyIHFheCA9IGEueCwKICAgICAgICAgICAgcWF5ID0gYS55LAogICAgICAgICAgICBxYXogPSBhLnosCiAgICAgICAgICAgIHFhdyA9IGEudzsKICAgICAgICB2YXIgcWJ4ID0gYi54LAogICAgICAgICAgICBxYnkgPSBiLnksCiAgICAgICAgICAgIHFieiA9IGIueiwKICAgICAgICAgICAgcWJ3ID0gYi53OwogICAgICAgIHRoaXMueCA9IHFheCAqIHFidyArIHFhdyAqIHFieCArIHFheSAqIHFieiAtIHFheiAqIHFieTsKICAgICAgICB0aGlzLnkgPSBxYXkgKiBxYncgKyBxYXcgKiBxYnkgKyBxYXogKiBxYnggLSBxYXggKiBxYno7CiAgICAgICAgdGhpcy56ID0gcWF6ICogcWJ3ICsgcWF3ICogcWJ6ICsgcWF4ICogcWJ5IC0gcWF5ICogcWJ4OwogICAgICAgIHRoaXMudyA9IHFhdyAqIHFidyAtIHFheCAqIHFieCAtIHFheSAqIHFieSAtIHFheiAqIHFiejsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgaW52ZXJzZTogZnVuY3Rpb24gaW52ZXJzZSgpIHsKICAgICAgICB0aGlzLnggKj0gLTE7CiAgICAgICAgdGhpcy55ICo9IC0xOwogICAgICAgIHRoaXMueiAqPSAtMTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBub3JtYWxpemU6IGZ1bmN0aW9uIG5vcm1hbGl6ZSgpIHsKICAgICAgICB2YXIgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwogICAgICAgIGlmIChsID09PSAwKSB7CiAgICAgICAgICB0aGlzLnggPSAwOwogICAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICAgIHRoaXMueiA9IDA7CiAgICAgICAgICB0aGlzLncgPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsID0gMSAvIGw7CiAgICAgICAgICB0aGlzLnggPSB0aGlzLnggKiBsOwogICAgICAgICAgdGhpcy55ID0gdGhpcy55ICogbDsKICAgICAgICAgIHRoaXMueiA9IHRoaXMueiAqIGw7CiAgICAgICAgICB0aGlzLncgPSB0aGlzLncgKiBsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgc2xlcnA6IGZ1bmN0aW9uIHNsZXJwKHFiLCB0KSB7CiAgICAgICAgaWYgKHQgPT09IDApIHJldHVybiB0aGlzOwogICAgICAgIGlmICh0ID09PSAxKSByZXR1cm4gdGhpcy5jb3B5KHFiKTsKICAgICAgICB2YXIgeCA9IHRoaXMueCwKICAgICAgICAgICAgeSA9IHRoaXMueSwKICAgICAgICAgICAgeiA9IHRoaXMueiwKICAgICAgICAgICAgdyA9IHRoaXMudzsKICAgICAgICB2YXIgY29zSGFsZlRoZXRhID0gdyAqIHFiLncgKyB4ICogcWIueCArIHkgKiBxYi55ICsgeiAqIHFiLno7CiAgICAgICAgaWYgKGNvc0hhbGZUaGV0YSA8IDApIHsKICAgICAgICAgIHRoaXMudyA9IC1xYi53OwogICAgICAgICAgdGhpcy54ID0gLXFiLng7CiAgICAgICAgICB0aGlzLnkgPSAtcWIueTsKICAgICAgICAgIHRoaXMueiA9IC1xYi56OwogICAgICAgICAgY29zSGFsZlRoZXRhID0gLWNvc0hhbGZUaGV0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jb3B5KHFiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNvc0hhbGZUaGV0YSA+PSAxLjApIHsKICAgICAgICAgIHRoaXMudyA9IHc7CiAgICAgICAgICB0aGlzLnggPSB4OwogICAgICAgICAgdGhpcy55ID0geTsKICAgICAgICAgIHRoaXMueiA9IHo7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgdmFyIGhhbGZUaGV0YSA9IE1hdGguYWNvcyhjb3NIYWxmVGhldGEpOwogICAgICAgIHZhciBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoMS4wIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhKTsKICAgICAgICBpZiAoTWF0aC5hYnMoc2luSGFsZlRoZXRhKSA8IDAuMDAxKSB7CiAgICAgICAgICB0aGlzLncgPSAwLjUgKiAodyArIHRoaXMudyk7CiAgICAgICAgICB0aGlzLnggPSAwLjUgKiAoeCArIHRoaXMueCk7CiAgICAgICAgICB0aGlzLnkgPSAwLjUgKiAoeSArIHRoaXMueSk7CiAgICAgICAgICB0aGlzLnogPSAwLjUgKiAoeiArIHRoaXMueik7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgdmFyIHJhdGlvQSA9IE1hdGguc2luKCgxIC0gdCkgKiBoYWxmVGhldGEpIC8gc2luSGFsZlRoZXRhLAogICAgICAgICAgICByYXRpb0IgPSBNYXRoLnNpbih0ICogaGFsZlRoZXRhKSAvIHNpbkhhbGZUaGV0YTsKICAgICAgICB0aGlzLncgPSB3ICogcmF0aW9BICsgdGhpcy53ICogcmF0aW9COwogICAgICAgIHRoaXMueCA9IHggKiByYXRpb0EgKyB0aGlzLnggKiByYXRpb0I7CiAgICAgICAgdGhpcy55ID0geSAqIHJhdGlvQSArIHRoaXMueSAqIHJhdGlvQjsKICAgICAgICB0aGlzLnogPSB6ICogcmF0aW9BICsgdGhpcy56ICogcmF0aW9COwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBzZXRGcm9tVW5pdFZlY3RvcnM6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgdjEsIHI7CiAgICAgICAgdmFyIEVQUyA9IDAuMDAwMDAxOwogICAgICAgIHJldHVybiBmdW5jdGlvbiAodkZyb20sIHZUbykgewogICAgICAgICAgaWYgKHYxID09PSB1bmRlZmluZWQpIHYxID0gbmV3IFZlY3RvcjMoKTsKICAgICAgICAgIHIgPSB2RnJvbS5kb3QodlRvKSArIDE7CiAgICAgICAgICBpZiAociA8IEVQUykgewogICAgICAgICAgICByID0gMDsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKHZGcm9tLngpID4gTWF0aC5hYnModkZyb20ueikpIHsKICAgICAgICAgICAgICB2MS5zZXQoLXZGcm9tLnksIHZGcm9tLngsIDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHYxLnNldCgwLCAtdkZyb20ueiwgdkZyb20ueSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHYxLmNyb3NzVmVjdG9ycyh2RnJvbSwgdlRvKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMueCA9IHYxLng7CiAgICAgICAgICB0aGlzLnkgPSB2MS55OwogICAgICAgICAgdGhpcy56ID0gdjEuejsKICAgICAgICAgIHRoaXMudyA9IHI7CiAgICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfTsKICAgICAgfSgpCiAgICB9OwogICAgZnVuY3Rpb24gRGV2aWNlKHBhcmFtcykgewogICAgICB0aGlzLndpZHRoID0gcGFyYW1zLndpZHRoIHx8IGdldFNjcmVlbldpZHRoKCk7CiAgICAgIHRoaXMuaGVpZ2h0ID0gcGFyYW1zLmhlaWdodCB8fCBnZXRTY3JlZW5IZWlnaHQoKTsKICAgICAgdGhpcy53aWR0aE1ldGVycyA9IHBhcmFtcy53aWR0aE1ldGVyczsKICAgICAgdGhpcy5oZWlnaHRNZXRlcnMgPSBwYXJhbXMuaGVpZ2h0TWV0ZXJzOwogICAgICB0aGlzLmJldmVsTWV0ZXJzID0gcGFyYW1zLmJldmVsTWV0ZXJzOwogICAgfQogICAgdmFyIERFRkFVTFRfQU5EUk9JRCA9IG5ldyBEZXZpY2UoewogICAgICB3aWR0aE1ldGVyczogMC4xMTAsCiAgICAgIGhlaWdodE1ldGVyczogMC4wNjIsCiAgICAgIGJldmVsTWV0ZXJzOiAwLjAwNAogICAgfSk7CiAgICB2YXIgREVGQVVMVF9JT1MgPSBuZXcgRGV2aWNlKHsKICAgICAgd2lkdGhNZXRlcnM6IDAuMTAzOCwKICAgICAgaGVpZ2h0TWV0ZXJzOiAwLjA1ODQsCiAgICAgIGJldmVsTWV0ZXJzOiAwLjAwNAogICAgfSk7CiAgICB2YXIgVmlld2VycyA9IHsKICAgICAgQ2FyZGJvYXJkVjE6IG5ldyBDYXJkYm9hcmRWaWV3ZXIoewogICAgICAgIGlkOiAnQ2FyZGJvYXJkVjEnLAogICAgICAgIGxhYmVsOiAnQ2FyZGJvYXJkIEkvTyAyMDE0JywKICAgICAgICBmb3Y6IDQwLAogICAgICAgIGludGVyTGVuc0Rpc3RhbmNlOiAwLjA2MCwKICAgICAgICBiYXNlbGluZUxlbnNEaXN0YW5jZTogMC4wMzUsCiAgICAgICAgc2NyZWVuTGVuc0Rpc3RhbmNlOiAwLjA0MiwKICAgICAgICBkaXN0b3J0aW9uQ29lZmZpY2llbnRzOiBbMC40NDEsIDAuMTU2XSwKICAgICAgICBpbnZlcnNlQ29lZmZpY2llbnRzOiBbLTAuNDQxMDAzNSwgMC40Mjc1NjE1NSwgLTAuNDgwNDQzOSwgMC41NDYwMTM5LCAtMC41ODgyMTE4MywgMC41NzMzOTM4LCAtMC40ODMwMzIwMiwgMC4zMzI5OTA4MywgLTAuMTc1NzM4NDEsIDAuMDY1MTc3MiwgLTAuMDE0ODg5NjMsIDAuMDAxNTU5ODM0XQogICAgICB9KSwKICAgICAgQ2FyZGJvYXJkVjI6IG5ldyBDYXJkYm9hcmRWaWV3ZXIoewogICAgICAgIGlkOiAnQ2FyZGJvYXJkVjInLAogICAgICAgIGxhYmVsOiAnQ2FyZGJvYXJkIEkvTyAyMDE1JywKICAgICAgICBmb3Y6IDYwLAogICAgICAgIGludGVyTGVuc0Rpc3RhbmNlOiAwLjA2NCwKICAgICAgICBiYXNlbGluZUxlbnNEaXN0YW5jZTogMC4wMzUsCiAgICAgICAgc2NyZWVuTGVuc0Rpc3RhbmNlOiAwLjAzOSwKICAgICAgICBkaXN0b3J0aW9uQ29lZmZpY2llbnRzOiBbMC4zNCwgMC41NV0sCiAgICAgICAgaW52ZXJzZUNvZWZmaWNpZW50czogWy0wLjMzODM2NzA0LCAtMC4xODE2MjE4NSwgMC44NjI2NTUsIC0xLjI0NjIwNTEsIDEuMDU2MDYwMiwgLTAuNTgyMDgzMTcsIDAuMjE2MDkwNzgsIC0wLjA1NDQ0ODIzLCAwLjAwOTE3Nzk1NiwgLTk5MDQxNjllLTEwLCA2LjE4MzUzNUUtNSwgLTE2OTgxODAzZS0xM10KICAgICAgfSkKICAgIH07CiAgICBmdW5jdGlvbiBEZXZpY2VJbmZvKGRldmljZVBhcmFtcywgYWRkaXRpb25hbFZpZXdlcnMpIHsKICAgICAgdGhpcy52aWV3ZXIgPSBWaWV3ZXJzLkNhcmRib2FyZFYyOwogICAgICB0aGlzLnVwZGF0ZURldmljZVBhcmFtcyhkZXZpY2VQYXJhbXMpOwogICAgICB0aGlzLmRpc3RvcnRpb24gPSBuZXcgRGlzdG9ydGlvbih0aGlzLnZpZXdlci5kaXN0b3J0aW9uQ29lZmZpY2llbnRzKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZGRpdGlvbmFsVmlld2Vycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB2aWV3ZXIgPSBhZGRpdGlvbmFsVmlld2Vyc1tpXTsKICAgICAgICBWaWV3ZXJzW3ZpZXdlci5pZF0gPSBuZXcgQ2FyZGJvYXJkVmlld2VyKHZpZXdlcik7CiAgICAgIH0KICAgIH0KICAgIERldmljZUluZm8ucHJvdG90eXBlLnVwZGF0ZURldmljZVBhcmFtcyA9IGZ1bmN0aW9uIChkZXZpY2VQYXJhbXMpIHsKICAgICAgdGhpcy5kZXZpY2UgPSB0aGlzLmRldGVybWluZURldmljZV8oZGV2aWNlUGFyYW1zKSB8fCB0aGlzLmRldmljZTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXREZXZpY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmRldmljZTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5zZXRWaWV3ZXIgPSBmdW5jdGlvbiAodmlld2VyKSB7CiAgICAgIHRoaXMudmlld2VyID0gdmlld2VyOwogICAgICB0aGlzLmRpc3RvcnRpb24gPSBuZXcgRGlzdG9ydGlvbih0aGlzLnZpZXdlci5kaXN0b3J0aW9uQ29lZmZpY2llbnRzKTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5kZXRlcm1pbmVEZXZpY2VfID0gZnVuY3Rpb24gKGRldmljZVBhcmFtcykgewogICAgICBpZiAoIWRldmljZVBhcmFtcykgewogICAgICAgIGlmIChpc0lPUygpKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGZhbGxiYWNrIGlPUyBkZXZpY2UgbWVhc3VyZW1lbnRzLicpOwogICAgICAgICAgcmV0dXJuIERFRkFVTFRfSU9TOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGZhbGxiYWNrIEFuZHJvaWQgZGV2aWNlIG1lYXN1cmVtZW50cy4nKTsKICAgICAgICAgIHJldHVybiBERUZBVUxUX0FORFJPSUQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBNRVRFUlNfUEVSX0lOQ0ggPSAwLjAyNTQ7CiAgICAgIHZhciBtZXRlcnNQZXJQaXhlbFggPSBNRVRFUlNfUEVSX0lOQ0ggLyBkZXZpY2VQYXJhbXMueGRwaTsKICAgICAgdmFyIG1ldGVyc1BlclBpeGVsWSA9IE1FVEVSU19QRVJfSU5DSCAvIGRldmljZVBhcmFtcy55ZHBpOwogICAgICB2YXIgd2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpOwogICAgICB2YXIgaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCk7CiAgICAgIHJldHVybiBuZXcgRGV2aWNlKHsKICAgICAgICB3aWR0aE1ldGVyczogbWV0ZXJzUGVyUGl4ZWxYICogd2lkdGgsCiAgICAgICAgaGVpZ2h0TWV0ZXJzOiBtZXRlcnNQZXJQaXhlbFkgKiBoZWlnaHQsCiAgICAgICAgYmV2ZWxNZXRlcnM6IGRldmljZVBhcmFtcy5iZXZlbE1tICogMC4wMDEKICAgICAgfSk7CiAgICB9OwogICAgRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RGlzdG9ydGVkRmllbGRPZlZpZXdMZWZ0RXllID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CiAgICAgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKICAgICAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CiAgICAgIHZhciBleWVUb1NjcmVlbkRpc3RhbmNlID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICAgICAgdmFyIG91dGVyRGlzdCA9IChkZXZpY2Uud2lkdGhNZXRlcnMgLSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UpIC8gMjsKICAgICAgdmFyIGlubmVyRGlzdCA9IHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSAvIDI7CiAgICAgIHZhciBib3R0b21EaXN0ID0gdmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzOwogICAgICB2YXIgdG9wRGlzdCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLSBib3R0b21EaXN0OwogICAgICB2YXIgb3V0ZXJBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydChvdXRlckRpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CiAgICAgIHZhciBpbm5lckFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KGlubmVyRGlzdCAvIGV5ZVRvU2NyZWVuRGlzdGFuY2UpKTsKICAgICAgdmFyIGJvdHRvbUFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KGJvdHRvbURpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CiAgICAgIHZhciB0b3BBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydCh0b3BEaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwogICAgICByZXR1cm4gewogICAgICAgIGxlZnREZWdyZWVzOiBNYXRoLm1pbihvdXRlckFuZ2xlLCB2aWV3ZXIuZm92KSwKICAgICAgICByaWdodERlZ3JlZXM6IE1hdGgubWluKGlubmVyQW5nbGUsIHZpZXdlci5mb3YpLAogICAgICAgIGRvd25EZWdyZWVzOiBNYXRoLm1pbihib3R0b21BbmdsZSwgdmlld2VyLmZvdiksCiAgICAgICAgdXBEZWdyZWVzOiBNYXRoLm1pbih0b3BBbmdsZSwgdmlld2VyLmZvdikKICAgICAgfTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRMZWZ0RXllVmlzaWJsZVRhbkFuZ2xlcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwogICAgICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CiAgICAgIHZhciBkaXN0b3J0aW9uID0gdGhpcy5kaXN0b3J0aW9uOwogICAgICB2YXIgZm92TGVmdCA9IE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpOwogICAgICB2YXIgZm92VG9wID0gTWF0aC50YW4oZGVnVG9SYWQgKiB2aWV3ZXIuZm92KTsKICAgICAgdmFyIGZvdlJpZ2h0ID0gTWF0aC50YW4oZGVnVG9SYWQgKiB2aWV3ZXIuZm92KTsKICAgICAgdmFyIGZvdkJvdHRvbSA9IE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpOwogICAgICB2YXIgaGFsZldpZHRoID0gZGV2aWNlLndpZHRoTWV0ZXJzIC8gNDsKICAgICAgdmFyIGhhbGZIZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gMjsKICAgICAgdmFyIHZlcnRpY2FsTGVuc09mZnNldCA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVycyAtIGhhbGZIZWlnaHQ7CiAgICAgIHZhciBjZW50ZXJYID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMiAtIGhhbGZXaWR0aDsKICAgICAgdmFyIGNlbnRlclkgPSAtdmVydGljYWxMZW5zT2Zmc2V0OwogICAgICB2YXIgY2VudGVyWiA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgICAgIHZhciBzY3JlZW5MZWZ0ID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJYIC0gaGFsZldpZHRoKSAvIGNlbnRlclopOwogICAgICB2YXIgc2NyZWVuVG9wID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJZICsgaGFsZkhlaWdodCkgLyBjZW50ZXJaKTsKICAgICAgdmFyIHNjcmVlblJpZ2h0ID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJYICsgaGFsZldpZHRoKSAvIGNlbnRlclopOwogICAgICB2YXIgc2NyZWVuQm90dG9tID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJZIC0gaGFsZkhlaWdodCkgLyBjZW50ZXJaKTsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CiAgICAgIHJlc3VsdFswXSA9IE1hdGgubWF4KGZvdkxlZnQsIHNjcmVlbkxlZnQpOwogICAgICByZXN1bHRbMV0gPSBNYXRoLm1pbihmb3ZUb3AsIHNjcmVlblRvcCk7CiAgICAgIHJlc3VsdFsyXSA9IE1hdGgubWluKGZvdlJpZ2h0LCBzY3JlZW5SaWdodCk7CiAgICAgIHJlc3VsdFszXSA9IE1hdGgubWF4KGZvdkJvdHRvbSwgc2NyZWVuQm90dG9tKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRMZWZ0RXllTm9MZW5zVGFuQW5nbGVzID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CiAgICAgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKICAgICAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CiAgICAgIHZhciByZXN1bHQgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogICAgICB2YXIgZm92TGVmdCA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogICAgICB2YXIgZm92VG9wID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKICAgICAgdmFyIGZvdlJpZ2h0ID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKICAgICAgdmFyIGZvdkJvdHRvbSA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogICAgICB2YXIgaGFsZldpZHRoID0gZGV2aWNlLndpZHRoTWV0ZXJzIC8gNDsKICAgICAgdmFyIGhhbGZIZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gMjsKICAgICAgdmFyIHZlcnRpY2FsTGVuc09mZnNldCA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVycyAtIGhhbGZIZWlnaHQ7CiAgICAgIHZhciBjZW50ZXJYID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMiAtIGhhbGZXaWR0aDsKICAgICAgdmFyIGNlbnRlclkgPSAtdmVydGljYWxMZW5zT2Zmc2V0OwogICAgICB2YXIgY2VudGVyWiA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgICAgIHZhciBzY3JlZW5MZWZ0ID0gKGNlbnRlclggLSBoYWxmV2lkdGgpIC8gY2VudGVyWjsKICAgICAgdmFyIHNjcmVlblRvcCA9IChjZW50ZXJZICsgaGFsZkhlaWdodCkgLyBjZW50ZXJaOwogICAgICB2YXIgc2NyZWVuUmlnaHQgPSAoY2VudGVyWCArIGhhbGZXaWR0aCkgLyBjZW50ZXJaOwogICAgICB2YXIgc2NyZWVuQm90dG9tID0gKGNlbnRlclkgLSBoYWxmSGVpZ2h0KSAvIGNlbnRlclo7CiAgICAgIHJlc3VsdFswXSA9IE1hdGgubWF4KGZvdkxlZnQsIHNjcmVlbkxlZnQpOwogICAgICByZXN1bHRbMV0gPSBNYXRoLm1pbihmb3ZUb3AsIHNjcmVlblRvcCk7CiAgICAgIHJlc3VsdFsyXSA9IE1hdGgubWluKGZvdlJpZ2h0LCBzY3JlZW5SaWdodCk7CiAgICAgIHJlc3VsdFszXSA9IE1hdGgubWF4KGZvdkJvdHRvbSwgc2NyZWVuQm90dG9tKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRMZWZ0RXllVmlzaWJsZVNjcmVlblJlY3QgPSBmdW5jdGlvbiAodW5kaXN0b3J0ZWRGcnVzdHVtKSB7CiAgICAgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICAgICAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogICAgICB2YXIgZGlzdCA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgICAgIHZhciBleWVYID0gKGRldmljZS53aWR0aE1ldGVycyAtIHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSkgLyAyOwogICAgICB2YXIgZXllWSA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVyczsKICAgICAgdmFyIGxlZnQgPSAodW5kaXN0b3J0ZWRGcnVzdHVtWzBdICogZGlzdCArIGV5ZVgpIC8gZGV2aWNlLndpZHRoTWV0ZXJzOwogICAgICB2YXIgdG9wID0gKHVuZGlzdG9ydGVkRnJ1c3R1bVsxXSAqIGRpc3QgKyBleWVZKSAvIGRldmljZS5oZWlnaHRNZXRlcnM7CiAgICAgIHZhciByaWdodCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMl0gKiBkaXN0ICsgZXllWCkgLyBkZXZpY2Uud2lkdGhNZXRlcnM7CiAgICAgIHZhciBib3R0b20gPSAodW5kaXN0b3J0ZWRGcnVzdHVtWzNdICogZGlzdCArIGV5ZVkpIC8gZGV2aWNlLmhlaWdodE1ldGVyczsKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiBsZWZ0LAogICAgICAgIHk6IGJvdHRvbSwKICAgICAgICB3aWR0aDogcmlnaHQgLSBsZWZ0LAogICAgICAgIGhlaWdodDogdG9wIC0gYm90dG9tCiAgICAgIH07CiAgICB9OwogICAgRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RmllbGRPZlZpZXdMZWZ0RXllID0gZnVuY3Rpb24gKG9wdF9pc1VuZGlzdG9ydGVkKSB7CiAgICAgIHJldHVybiBvcHRfaXNVbmRpc3RvcnRlZCA/IHRoaXMuZ2V0VW5kaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUoKSA6IHRoaXMuZ2V0RGlzdG9ydGVkRmllbGRPZlZpZXdMZWZ0RXllKCk7CiAgICB9OwogICAgRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RmllbGRPZlZpZXdSaWdodEV5ZSA9IGZ1bmN0aW9uIChvcHRfaXNVbmRpc3RvcnRlZCkgewogICAgICB2YXIgZm92ID0gdGhpcy5nZXRGaWVsZE9mVmlld0xlZnRFeWUob3B0X2lzVW5kaXN0b3J0ZWQpOwogICAgICByZXR1cm4gewogICAgICAgIGxlZnREZWdyZWVzOiBmb3YucmlnaHREZWdyZWVzLAogICAgICAgIHJpZ2h0RGVncmVlczogZm92LmxlZnREZWdyZWVzLAogICAgICAgIHVwRGVncmVlczogZm92LnVwRGVncmVlcywKICAgICAgICBkb3duRGVncmVlczogZm92LmRvd25EZWdyZWVzCiAgICAgIH07CiAgICB9OwogICAgRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0VW5kaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwID0gdGhpcy5nZXRVbmRpc3RvcnRlZFBhcmFtc18oKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBsZWZ0RGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC5vdXRlckRpc3QpLAogICAgICAgIHJpZ2h0RGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC5pbm5lckRpc3QpLAogICAgICAgIGRvd25EZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLmJvdHRvbURpc3QpLAogICAgICAgIHVwRGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC50b3BEaXN0KQogICAgICB9OwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmdldFVuZGlzdG9ydGVkVmlld3BvcnRMZWZ0RXllID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgcCA9IHRoaXMuZ2V0VW5kaXN0b3J0ZWRQYXJhbXNfKCk7CiAgICAgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICAgICAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogICAgICB2YXIgZXllVG9TY3JlZW5EaXN0YW5jZSA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgICAgIHZhciBzY3JlZW5XaWR0aCA9IGRldmljZS53aWR0aE1ldGVycyAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKICAgICAgdmFyIHhQeFBlclRhbkFuZ2xlID0gZGV2aWNlLndpZHRoIC8gc2NyZWVuV2lkdGg7CiAgICAgIHZhciB5UHhQZXJUYW5BbmdsZSA9IGRldmljZS5oZWlnaHQgLyBzY3JlZW5IZWlnaHQ7CiAgICAgIHZhciB4ID0gTWF0aC5yb3VuZCgocC5leWVQb3NYIC0gcC5vdXRlckRpc3QpICogeFB4UGVyVGFuQW5nbGUpOwogICAgICB2YXIgeSA9IE1hdGgucm91bmQoKHAuZXllUG9zWSAtIHAuYm90dG9tRGlzdCkgKiB5UHhQZXJUYW5BbmdsZSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgeDogeCwKICAgICAgICB5OiB5LAogICAgICAgIHdpZHRoOiBNYXRoLnJvdW5kKChwLmV5ZVBvc1ggKyBwLmlubmVyRGlzdCkgKiB4UHhQZXJUYW5BbmdsZSkgLSB4LAogICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCgocC5leWVQb3NZICsgcC50b3BEaXN0KSAqIHlQeFBlclRhbkFuZ2xlKSAtIHkKICAgICAgfTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRVbmRpc3RvcnRlZFBhcmFtc18gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICAgICAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogICAgICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKICAgICAgdmFyIGV5ZVRvU2NyZWVuRGlzdGFuY2UgPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwogICAgICB2YXIgaGFsZkxlbnNEaXN0YW5jZSA9IHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSAvIDIgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwogICAgICB2YXIgc2NyZWVuV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwogICAgICB2YXIgc2NyZWVuSGVpZ2h0ID0gZGV2aWNlLmhlaWdodE1ldGVycyAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgICAgIHZhciBleWVQb3NYID0gc2NyZWVuV2lkdGggLyAyIC0gaGFsZkxlbnNEaXN0YW5jZTsKICAgICAgdmFyIGV5ZVBvc1kgPSAodmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzKSAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgICAgIHZhciBtYXhGb3YgPSB2aWV3ZXIuZm92OwogICAgICB2YXIgdmlld2VyTWF4ID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbihkZWdUb1JhZCAqIG1heEZvdikpOwogICAgICB2YXIgb3V0ZXJEaXN0ID0gTWF0aC5taW4oZXllUG9zWCwgdmlld2VyTWF4KTsKICAgICAgdmFyIGlubmVyRGlzdCA9IE1hdGgubWluKGhhbGZMZW5zRGlzdGFuY2UsIHZpZXdlck1heCk7CiAgICAgIHZhciBib3R0b21EaXN0ID0gTWF0aC5taW4oZXllUG9zWSwgdmlld2VyTWF4KTsKICAgICAgdmFyIHRvcERpc3QgPSBNYXRoLm1pbihzY3JlZW5IZWlnaHQgLSBleWVQb3NZLCB2aWV3ZXJNYXgpOwogICAgICByZXR1cm4gewogICAgICAgIG91dGVyRGlzdDogb3V0ZXJEaXN0LAogICAgICAgIGlubmVyRGlzdDogaW5uZXJEaXN0LAogICAgICAgIHRvcERpc3Q6IHRvcERpc3QsCiAgICAgICAgYm90dG9tRGlzdDogYm90dG9tRGlzdCwKICAgICAgICBleWVQb3NYOiBleWVQb3NYLAogICAgICAgIGV5ZVBvc1k6IGV5ZVBvc1kKICAgICAgfTsKICAgIH07CiAgICBmdW5jdGlvbiBDYXJkYm9hcmRWaWV3ZXIocGFyYW1zKSB7CiAgICAgIHRoaXMuaWQgPSBwYXJhbXMuaWQ7CiAgICAgIHRoaXMubGFiZWwgPSBwYXJhbXMubGFiZWw7CiAgICAgIHRoaXMuZm92ID0gcGFyYW1zLmZvdjsKICAgICAgdGhpcy5pbnRlckxlbnNEaXN0YW5jZSA9IHBhcmFtcy5pbnRlckxlbnNEaXN0YW5jZTsKICAgICAgdGhpcy5iYXNlbGluZUxlbnNEaXN0YW5jZSA9IHBhcmFtcy5iYXNlbGluZUxlbnNEaXN0YW5jZTsKICAgICAgdGhpcy5zY3JlZW5MZW5zRGlzdGFuY2UgPSBwYXJhbXMuc2NyZWVuTGVuc0Rpc3RhbmNlOwogICAgICB0aGlzLmRpc3RvcnRpb25Db2VmZmljaWVudHMgPSBwYXJhbXMuZGlzdG9ydGlvbkNvZWZmaWNpZW50czsKICAgICAgdGhpcy5pbnZlcnNlQ29lZmZpY2llbnRzID0gcGFyYW1zLmludmVyc2VDb2VmZmljaWVudHM7CiAgICB9CiAgICBEZXZpY2VJbmZvLlZpZXdlcnMgPSBWaWV3ZXJzOwogICAgdmFyIGZvcm1hdCA9IDE7CiAgICB2YXIgbGFzdF91cGRhdGVkID0gIjIwMTktMTEtMDlUMTc6MzY6MTRaIjsKICAgIHZhciBkZXZpY2VzID0gW3sidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9OZXh1cyA3LyoifSx7InVhIjoiTmV4dXMgNyJ9XSwiZHBpIjpbMzIwLjgsMzIzXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9BU1VTX1gwMFBELyoifSx7InVhIjoiQVNVU19YMDBQRCJ9XSwiZHBpIjoyNDUsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJhc3VzLyovQVNVU19YMDA4RC8qIn0seyJ1YSI6IkFTVVNfWDAwOEQifV0sImRwaSI6MjgyLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiYXN1cy8qL0FTVVNfWjAwQUQvKiJ9LHsidWEiOiJBU1VTX1owMEFEIn1dLCJkcGkiOls0MDMsNDA0LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIDIgWEwvKiJ9LHsidWEiOiJQaXhlbCAyIFhMIn1dLCJkcGkiOjUzNy45LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIDMgWEwvKiJ9LHsidWEiOiJQaXhlbCAzIFhMIn1dLCJkcGkiOls1NTguNSw1NTMuOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgWEwvKiJ9LHsidWEiOiJQaXhlbCBYTCJ9XSwiZHBpIjpbNTM3LjksNTMzXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAzLyoifSx7InVhIjoiUGl4ZWwgMyJ9XSwiZHBpIjo0NDIuNCwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAyLyoifSx7InVhIjoiUGl4ZWwgMiJ9XSwiZHBpIjo0NDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbC8qIn0seyJ1YSI6IlBpeGVsIn1dLCJkcGkiOls0MzIuNiw0MzYuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDNjQzNUxWVy8qIn0seyJ1YSI6IkhUQzY0MzVMVlcifV0sImRwaSI6WzQ0OS43LDQ0My4zXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEMgT25lIFhMLyoifSx7InVhIjoiSFRDIE9uZSBYTCJ9XSwiZHBpIjpbMzE1LjMsMzE0LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Imh0Yy8qL05leHVzIDkvKiJ9LHsidWEiOiJOZXh1cyA5In1dLCJkcGkiOjI4OSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQyBPbmUgTTkvKiJ9LHsidWEiOiJIVEMgT25lIE05In1dLCJkcGkiOls0NDIuNSw0NDMuM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEMgT25lX004LyoifSx7InVhIjoiSFRDIE9uZV9NOCJ9XSwiZHBpIjpbNDQ5LjcsNDQ3LjRdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZS8qIn0seyJ1YSI6IkhUQyBPbmUifV0sImRwaSI6NDcyLjgsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSHVhd2VpLyovTmV4dXMgNlAvKiJ9LHsidWEiOiJOZXh1cyA2UCJ9XSwiZHBpIjpbNTE1LjEsNTE4XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9CTE4tTDI0LyoifSx7InVhIjoiSE9OT1JCTE4tTDI0In1dLCJkcGkiOjQ4MCwiYnciOjQsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikh1YXdlaS8qL0JLTC1MMDkvKiJ9LHsidWEiOiJCS0wtTDA5In1dLCJkcGkiOjQwMywiYnciOjMuNDcsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxFTk9WTy8qL0xlbm92byBQQjItNjkwWS8qIn0seyJ1YSI6Ikxlbm92byBQQjItNjkwWSJ9XSwiZHBpIjpbNDU3LjIsNDU0LjcxM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9OZXh1cyA1WC8qIn0seyJ1YSI6Ik5leHVzIDVYIn1dLCJkcGkiOls0MjIsNDE5LjldLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHTVMzNDUvKiJ9LHsidWEiOiJMR01TMzQ1In1dLCJkcGkiOlsyMjEuNywyMTkuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MRy1EODAwLyoifSx7InVhIjoiTEctRDgwMCJ9XSwiZHBpIjpbNDIyLDQyNC4xXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHLUQ4NTAvKiJ9LHsidWEiOiJMRy1EODUwIn1dLCJkcGkiOls1MzcuOSw1NDEuOV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9WUzk4NSA0Ry8qIn0seyJ1YSI6IlZTOTg1IDRHIn1dLCJkcGkiOls1MzcuOSw1MzUuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTmV4dXMgNS8qIn0seyJ1YSI6Ik5leHVzIDUgQiJ9XSwiZHBpIjpbNDQyLjQsNDQ0LjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL05leHVzIDQvKiJ9LHsidWEiOiJOZXh1cyA0In1dLCJkcGkiOlszMTkuOCwzMTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEctUDc2OS8qIn0seyJ1YSI6IkxHLVA3NjkifV0sImRwaSI6WzI0MC42LDI0Ny41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR01TMzIzLyoifSx7InVhIjoiTEdNUzMyMyJ9XSwiZHBpIjpbMjA2LjYsMjA0LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHTFM5OTYvKiJ9LHsidWEiOiJMR0xTOTk2In1dLCJkcGkiOls0MDMuNCw0MDEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTWljcm9tYXgvKi80NTYwTU1YLyoifSx7InVhIjoiNDU2ME1NWCJ9XSwiZHBpIjpbMjQwLDIxOS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJNaWNyb21heC8qL0EyNTAvKiJ9LHsidWEiOiJNaWNyb21heCBBMjUwIn1dLCJkcGkiOls0ODAsNDQ2LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik1pY3JvbWF4LyovTWljcm9tYXggQVE0NTAxLyoifSx7InVhIjoiTWljcm9tYXggQVE0NTAxIn1dLCJkcGkiOjI0MCwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovRzUvKiJ9LHsidWEiOiJNb3RvIEcgKDUpIFBsdXMifV0sImRwaSI6WzQwMy40LDQwM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9EUk9JRCBSQVpSLyoifSx7InVhIjoiRFJPSUQgUkFaUiJ9XSwiZHBpIjpbMzY4LjEsMjU2LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQ4MzBDLyoifSx7InVhIjoiWFQ4MzBDIn1dLCJkcGkiOlsyNTQsMjU1LjldLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDIxLyoifSx7InVhIjoiWFQxMDIxIn1dLCJkcGkiOlsyNTQsMjU2LjddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwMjMvKiJ9LHsidWEiOiJYVDEwMjMifV0sImRwaSI6WzI1NCwyNTYuN10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAyOC8qIn0seyJ1YSI6IlhUMTAyOCJ9XSwiZHBpIjpbMzI2LjYsMzI3LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDM0LyoifSx7InVhIjoiWFQxMDM0In1dLCJkcGkiOlszMjYuNiwzMjguNF0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA1My8qIn0seyJ1YSI6IlhUMTA1MyJ9XSwiZHBpIjpbMzE1LjMsMzE2LjFdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxNTYyLyoifSx7InVhIjoiWFQxNTYyIn1dLCJkcGkiOls0MDMuNCw0MDIuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9OZXh1cyA2LyoifSx7InVhIjoiTmV4dXMgNiBCIn1dLCJkcGkiOls0OTQuMyw0ODkuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwNjMvKiJ9LHsidWEiOiJYVDEwNjMifV0sImRwaSI6WzI5NSwyOTYuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwNjQvKiJ9LHsidWEiOiJYVDEwNjQifV0sImRwaSI6WzI5NSwyOTUuNl0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA5Mi8qIn0seyJ1YSI6IlhUMTA5MiJ9XSwiZHBpIjpbNDIyLDQyNC4xXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDk1LyoifSx7InVhIjoiWFQxMDk1In1dLCJkcGkiOls0MjIsNDIzLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovRzQvKiJ9LHsidWEiOiJNb3RvIEcgKDQpIn1dLCJkcGkiOjQwMSwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovQTAwMDEvKiJ9LHsidWEiOiJBMDAwMSJ9XSwiZHBpIjpbNDAzLjQsNDAxXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEUxMDAxLyoifSx7InVhIjoiT05FIEUxMDAxIn1dLCJkcGkiOls0NDIuNCw0NDEuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBFMTAwMy8qIn0seyJ1YSI6Ik9ORSBFMTAwMyJ9XSwiZHBpIjpbNDQyLjQsNDQxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgRTEwMDUvKiJ9LHsidWEiOiJPTkUgRTEwMDUifV0sImRwaSI6WzQ0Mi40LDQ0MS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEEyMDAxLyoifSx7InVhIjoiT05FIEEyMDAxIn1dLCJkcGkiOlszOTEuOSw0MDUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBBMjAwMy8qIn0seyJ1YSI6Ik9ORSBBMjAwMyJ9XSwiZHBpIjpbMzkxLjksNDA1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTIwMDUvKiJ9LHsidWEiOiJPTkUgQTIwMDUifV0sImRwaSI6WzM5MS45LDQwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBMzAwMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTMwMDAifV0sImRwaSI6NDAxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTMwMDMvKiJ9LHsidWEiOiJPTkVQTFVTIEEzMDAzIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEEzMDEwLyoifSx7InVhIjoiT05FUExVUyBBMzAxMCJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNTAwMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTUwMDAgIn1dLCJkcGkiOls0MDMuNDExLDM5OS43MzddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTUwMTAvKiJ9LHsidWEiOiJPTkVQTFVTIEE1MDEwIn1dLCJkcGkiOls0MDMsNDAwXSwiYnciOjIsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNjAwMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTYwMDAifV0sImRwaSI6NDAxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTYwMDMvKiJ9LHsidWEiOiJPTkVQTFVTIEE2MDAzIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEE2MDEwLyoifSx7InVhIjoiT05FUExVUyBBNjAxMCJ9XSwiZHBpIjo0MDEsImJ3IjoyLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNjAxMy8qIn0seyJ1YSI6Ik9ORVBMVVMgQTYwMTMifV0sImRwaSI6NDAxLCJidyI6MiwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT1BQTy8qL1g5MDkvKiJ9LHsidWEiOiJYOTA5In1dLCJkcGkiOls0NDIuNCw0NDQuMV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MDgyLyoifSx7InVhIjoiR1QtSTkwODIifV0sImRwaSI6WzE4NC43LDE4NS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzM2MFAvKiJ9LHsidWEiOiJTTS1HMzYwUCJ9XSwiZHBpIjpbMTk2LjcsMjA1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9OZXh1cyBTLyoifSx7InVhIjoiTmV4dXMgUyJ9XSwiZHBpIjpbMjM0LjUsMjI5LjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTMwMC8qIn0seyJ1YSI6IkdULUk5MzAwIn1dLCJkcGkiOlszMDQuOCwzMDMuOV0sImJ3Ijo1LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tVDIzME5VLyoifSx7InVhIjoiU00tVDIzME5VIn1dLCJkcGkiOjIxNiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TR0gtVDM5OS8qIn0seyJ1YSI6IlNHSC1UMzk5In1dLCJkcGkiOlsyMTcuNywyMzEuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NHSC1NOTE5LyoifSx7InVhIjoiU0dILU05MTkifV0sImRwaSI6WzQ0MC44LDQzNy43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkwMDUvKiJ9LHsidWEiOiJTTS1OOTAwNSJ9XSwiZHBpIjpbMzg2LjQsMzg3XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TQU1TVU5HLVNNLU45MDBBLyoifSx7InVhIjoiU0FNU1VORy1TTS1OOTAwQSJ9XSwiZHBpIjpbMzg2LjQsMzg3LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTUwMC8qIn0seyJ1YSI6IkdULUk5NTAwIn1dLCJkcGkiOls0NDIuNSw0NDMuM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTk1MDUvKiJ9LHsidWEiOiJHVC1JOTUwNSJ9XSwiZHBpIjo0MzkuNCwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkwMEYvKiJ9LHsidWEiOiJTTS1HOTAwRiJ9XSwiZHBpIjpbNDE1LjYsNDMxLjZdLCJidyI6NSwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTAwTS8qIn0seyJ1YSI6IlNNLUc5MDBNIn1dLCJkcGkiOls0MTUuNiw0MzEuNl0sImJ3Ijo1LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc4MDBGLyoifSx7InVhIjoiU00tRzgwMEYifV0sImRwaSI6MzI2LjgsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MDZTLyoifSx7InVhIjoiU00tRzkwNlMifV0sImRwaSI6WzU2Mi43LDU3Mi40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkzMDAvKiJ9LHsidWEiOiJHVC1JOTMwMCJ9XSwiZHBpIjpbMzA2LjcsMzA0LjhdLCJidyI6NSwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1UNTM1LyoifSx7InVhIjoiU00tVDUzNSJ9XSwiZHBpIjpbMTQyLjYsMTM2LjRdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MjBDLyoifSx7InVhIjoiU00tTjkyMEMifV0sImRwaSI6WzUxNS4xLDUxOC40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkyMFAvKiJ9LHsidWEiOiJTTS1OOTIwUCJ9XSwiZHBpIjpbMzg2LjM2NTUsMzkwLjE0NF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MjBXOC8qIn0seyJ1YSI6IlNNLU45MjBXOCJ9XSwiZHBpIjpbNTE1LjEsNTE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTMwMEkvKiJ9LHsidWEiOiJHVC1JOTMwMEkifV0sImRwaSI6WzMwNC44LDMwNS44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkxOTUvKiJ9LHsidWEiOiJHVC1JOTE5NSJ9XSwiZHBpIjpbMjQ5LjQsMjU2LjddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NQSC1MNTIwLyoifSx7InVhIjoiU1BILUw1MjAifV0sImRwaSI6WzI0OS40LDI1NS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0FNU1VORy1TR0gtSTcxNy8qIn0seyJ1YSI6IlNBTVNVTkctU0dILUk3MTcifV0sImRwaSI6Mjg1LjgsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NQSC1ENzEwLyoifSx7InVhIjoiU1BILUQ3MTAifV0sImRwaSI6WzIxNy43LDIwNC4yXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtTjcxMDAvKiJ9LHsidWEiOiJHVC1ONzEwMCJ9XSwiZHBpIjoyNjUuMSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0NILUk2MDUvKiJ9LHsidWEiOiJTQ0gtSTYwNSJ9XSwiZHBpIjoyNjUuMSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR2FsYXh5IE5leHVzLyoifSx7InVhIjoiR2FsYXh5IE5leHVzIn1dLCJkcGkiOlszMTUuMywzMTQuMl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MTBILyoifSx7InVhIjoiU00tTjkxMEgifV0sImRwaSI6WzUxNS4xLDUxOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MTBDLyoifSx7InVhIjoiU00tTjkxMEMifV0sImRwaSI6WzUxNS4yLDUyMC4yXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HMTMwTS8qIn0seyJ1YSI6IlNNLUcxMzBNIn1dLCJkcGkiOlsxNjUuOSwxNjQuOF0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyOEkvKiJ9LHsidWEiOiJTTS1HOTI4SSJ9XSwiZHBpIjpbNTE1LjEsNTE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTIwRi8qIn0seyJ1YSI6IlNNLUc5MjBGIn1dLCJkcGkiOjU4MC42LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjBQLyoifSx7InVhIjoiU00tRzkyMFAifV0sImRwaSI6WzUyMi41LDU3N10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjVGLyoifSx7InVhIjoiU00tRzkyNUYifV0sImRwaSI6NTgwLjYsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyNVYvKiJ9LHsidWEiOiJTTS1HOTI1ViJ9XSwiZHBpIjpbNTIyLjUsNTc2LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTMwRi8qIn0seyJ1YSI6IlNNLUc5MzBGIn1dLCJkcGkiOjU3Ni42LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTM1Ri8qIn0seyJ1YSI6IlNNLUc5MzVGIn1dLCJkcGkiOjUzMywiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTUwRi8qIn0seyJ1YSI6IlNNLUc5NTBGIn1dLCJkcGkiOls1NjIuNzA3LDU2NS4yOTNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NTVVLyoifSx7InVhIjoiU00tRzk1NVUifV0sImRwaSI6WzUyMi41MTQsNTI1Ljc2Ml0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk1NUYvKiJ9LHsidWEiOiJTTS1HOTU1RiJ9XSwiZHBpIjpbNTIyLjUxNCw1MjUuNzYyXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwRi8qIn0seyJ1YSI6IlNNLUc5NjBGIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MDAvKiJ9LHsidWEiOiJTTS1HOTYwMCJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBULyoifSx7InVhIjoiU00tRzk2MFQifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwTi8qIn0seyJ1YSI6IlNNLUc5NjBOIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MFUvKiJ9LHsidWEiOiJTTS1HOTYwVSJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjA4LyoifSx7InVhIjoiU00tRzk2MDgifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwRkQvKiJ9LHsidWEiOiJTTS1HOTYwRkQifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwVy8qIn0seyJ1YSI6IlNNLUc5NjBXIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2NUYvKiJ9LHsidWEiOiJTTS1HOTY1RiJ9XSwiZHBpIjo1MjksImJ3IjoyLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0M2OTAzLyoifSx7InVhIjoiQzY5MDMifV0sImRwaSI6WzQ0Mi41LDQ0My4zXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9ENjY1My8qIn0seyJ1YSI6IkQ2NjUzIn1dLCJkcGkiOls0MjguNiw0MjcuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0U2NjUzLyoifSx7InVhIjoiRTY2NTMifV0sImRwaSI6WzQyOC42LDQyNS43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovRTY4NTMvKiJ9LHsidWEiOiJFNjg1MyJ9XSwiZHBpIjpbNDAzLjQsNDAxLjldLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9TR1AzMjEvKiJ9LHsidWEiOiJTR1AzMjEifV0sImRwaSI6WzIyNC43LDIyNC4xXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlRDVC8qL0FMQ0FURUwgT05FIFRPVUNIIEZpZXJjZS8qIn0seyJ1YSI6IkFMQ0FURUwgT05FIFRPVUNIIEZpZXJjZSJ9XSwiZHBpIjpbMjQwLDI0Ny41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJUSEwvKi90aGwgNTAwMC8qIn0seyJ1YSI6InRobCA1MDAwIn1dLCJkcGkiOls0ODAsNDQzLjNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkZseS8qL0lRNDQxMi8qIn0seyJ1YSI6IklRNDQxMiJ9XSwiZHBpIjozMDcuOSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJaVEUvKi9aVEUgQmxhZGUgTDIvKiJ9LHsidWEiOiJaVEUgQmxhZGUgTDIifV0sImRwaSI6MjQwLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiQkVORVZFLyovVlI1MTgvKiJ9LHsidWEiOiJWUjUxOCJ9XSwiZHBpIjo0ODAsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbNjQwLDk2MF19XSwiZHBpIjpbMzI1LjEsMzI4LjRdLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls2NDAsMTEzNl19XSwiZHBpIjpbMzE3LjEsMzIwLjJdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls3NTAsMTMzNF19XSwiZHBpIjozMjYuNCwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbMTI0MiwyMjA4XX1dLCJkcGkiOls0NTMuNiw0NTguNF0sImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzExMjUsMjAwMV19XSwiZHBpIjpbNDEwLjksNDE1LjRdLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMTI1LDI0MzZdfV0sImRwaSI6NDU4LCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikh1YXdlaS8qL0VNTC1MMjkvKiJ9LHsidWEiOiJFTUwtTDI5In1dLCJkcGkiOjQyOCwiYnciOjMuNDUsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik5va2lhLyovTm9raWEgNy4xLyoifSx7InVhIjoiTm9raWEgNy4xIn1dLCJkcGkiOls0MzIsNDMxLjldLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzEyNDIsMjY4OF19XSwiZHBpIjo0NTgsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc1NzBNLyoifSx7InVhIjoiU00tRzU3ME0ifV0sImRwaSI6MzIwLCJidyI6My42ODQsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk3MEYvKiJ9LHsidWEiOiJTTS1HOTcwRiJ9XSwiZHBpIjo0MzgsImJ3IjoyLjI4MSwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NzNGLyoifSx7InVhIjoiU00tRzk3M0YifV0sImRwaSI6NTUwLCJidyI6Mi4wMDIsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTc1Ri8qIn0seyJ1YSI6IlNNLUc5NzVGIn1dLCJkcGkiOjUyMiwiYnciOjIuMDU0LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk3N0YvKiJ9LHsidWEiOiJTTS1HOTc3RiJ9XSwiZHBpIjo1MDUsImJ3IjoyLjMzNCwiYWMiOjUwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzgyOCwxNzkyXX1dLCJkcGkiOjMyNiwiYnciOjUsImFjIjo1MDB9XTsKICAgIHZhciBEUERCX0NBQ0hFID0gewogICAgCWZvcm1hdDogZm9ybWF0LAogICAgCWxhc3RfdXBkYXRlZDogbGFzdF91cGRhdGVkLAogICAgCWRldmljZXM6IGRldmljZXMKICAgIH07CiAgICBmdW5jdGlvbiBEcGRiKHVybCwgb25EZXZpY2VQYXJhbXNVcGRhdGVkKSB7CiAgICAgIHRoaXMuZHBkYiA9IERQREJfQ0FDSEU7CiAgICAgIHRoaXMucmVjYWxjdWxhdGVEZXZpY2VQYXJhbXNfKCk7CiAgICAgIGlmICh1cmwpIHsKICAgICAgICB0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCA9IG9uRGV2aWNlUGFyYW1zVXBkYXRlZDsKICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgdmFyIG9iaiA9IHRoaXM7CiAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CiAgICAgICAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBvYmoubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPD0gMjk5KSB7CiAgICAgICAgICAgIG9iai5kcGRiID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UpOwogICAgICAgICAgICBvYmoucmVjYWxjdWxhdGVEZXZpY2VQYXJhbXNfKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIG9ubGluZSBEUERCIScpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHhoci5zZW5kKCk7CiAgICAgIH0KICAgIH0KICAgIERwZGIucHJvdG90eXBlLmdldERldmljZVBhcmFtcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGV2aWNlUGFyYW1zOwogICAgfTsKICAgIERwZGIucHJvdG90eXBlLnJlY2FsY3VsYXRlRGV2aWNlUGFyYW1zXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG5ld0RldmljZVBhcmFtcyA9IHRoaXMuY2FsY0RldmljZVBhcmFtc18oKTsKICAgICAgaWYgKG5ld0RldmljZVBhcmFtcykgewogICAgICAgIHRoaXMuZGV2aWNlUGFyYW1zID0gbmV3RGV2aWNlUGFyYW1zOwogICAgICAgIGlmICh0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCkgewogICAgICAgICAgdGhpcy5vbkRldmljZVBhcmFtc1VwZGF0ZWQodGhpcy5kZXZpY2VQYXJhbXMpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcmVjYWxjdWxhdGUgZGV2aWNlIHBhcmFtZXRlcnMuJyk7CiAgICAgIH0KICAgIH07CiAgICBEcGRiLnByb3RvdHlwZS5jYWxjRGV2aWNlUGFyYW1zXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGRiID0gdGhpcy5kcGRiOwogICAgICBpZiAoIWRiKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRFBEQiBub3QgYXZhaWxhYmxlLicpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGlmIChkYi5mb3JtYXQgIT0gMSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RQREIgaGFzIHVuZXhwZWN0ZWQgZm9ybWF0IHZlcnNpb24uJyk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKCFkYi5kZXZpY2VzIHx8ICFkYi5kZXZpY2VzLmxlbmd0aCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RQREIgZG9lcyBub3QgaGF2ZSBhIGRldmljZXMgc2VjdGlvbi4nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICB2YXIgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYTsKICAgICAgdmFyIHdpZHRoID0gZ2V0U2NyZWVuV2lkdGgoKTsKICAgICAgdmFyIGhlaWdodCA9IGdldFNjcmVlbkhlaWdodCgpOwogICAgICBpZiAoIWRiLmRldmljZXMpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdEUERCIGhhcyBubyBkZXZpY2VzIHNlY3Rpb24uJyk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYi5kZXZpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGRldmljZSA9IGRiLmRldmljZXNbaV07CiAgICAgICAgaWYgKCFkZXZpY2UucnVsZXMpIHsKICAgICAgICAgIGNvbnNvbGUud2FybignRGV2aWNlWycgKyBpICsgJ10gaGFzIG5vIHJ1bGVzIHNlY3Rpb24uJyk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGRldmljZS50eXBlICE9ICdpb3MnICYmIGRldmljZS50eXBlICE9ICdhbmRyb2lkJykgewogICAgICAgICAgY29uc29sZS53YXJuKCdEZXZpY2VbJyArIGkgKyAnXSBoYXMgaW52YWxpZCB0eXBlLicpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmIChpc0lPUygpICE9IChkZXZpY2UudHlwZSA9PSAnaW9zJykpIGNvbnRpbnVlOwogICAgICAgIHZhciBtYXRjaGVkID0gZmFsc2U7CiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkZXZpY2UucnVsZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIHZhciBydWxlID0gZGV2aWNlLnJ1bGVzW2pdOwogICAgICAgICAgaWYgKHRoaXMucnVsZU1hdGNoZXNfKHJ1bGUsIHVzZXJBZ2VudCwgd2lkdGgsIGhlaWdodCkpIHsKICAgICAgICAgICAgbWF0Y2hlZCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIW1hdGNoZWQpIGNvbnRpbnVlOwogICAgICAgIHZhciB4ZHBpID0gZGV2aWNlLmRwaVswXSB8fCBkZXZpY2UuZHBpOwogICAgICAgIHZhciB5ZHBpID0gZGV2aWNlLmRwaVsxXSB8fCBkZXZpY2UuZHBpOwogICAgICAgIHJldHVybiBuZXcgRGV2aWNlUGFyYW1zKHsgeGRwaTogeGRwaSwgeWRwaTogeWRwaSwgYmV2ZWxNbTogZGV2aWNlLmJ3IH0pOwogICAgICB9CiAgICAgIGNvbnNvbGUud2FybignTm8gRFBEQiBkZXZpY2UgbWF0Y2guJyk7CiAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIERwZGIucHJvdG90eXBlLnJ1bGVNYXRjaGVzXyA9IGZ1bmN0aW9uIChydWxlLCB1YSwgc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgewogICAgICBpZiAoIXJ1bGUudWEgJiYgIXJ1bGUucmVzKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmIChydWxlLnVhICYmIHJ1bGUudWEuc3Vic3RyaW5nKDAsIDIpID09PSAnU00nKSBydWxlLnVhID0gcnVsZS51YS5zdWJzdHJpbmcoMCwgNyk7CiAgICAgIGlmIChydWxlLnVhICYmIHVhLmluZGV4T2YocnVsZS51YSkgPCAwKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmIChydWxlLnJlcykgewogICAgICAgIGlmICghcnVsZS5yZXNbMF0gfHwgIXJ1bGUucmVzWzFdKSByZXR1cm4gZmFsc2U7CiAgICAgICAgdmFyIHJlc1ggPSBydWxlLnJlc1swXTsKICAgICAgICB2YXIgcmVzWSA9IHJ1bGUucmVzWzFdOwogICAgICAgIGlmIChNYXRoLm1pbihzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KSAhPSBNYXRoLm1pbihyZXNYLCByZXNZKSB8fCBNYXRoLm1heChzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KSAhPSBNYXRoLm1heChyZXNYLCByZXNZKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICBmdW5jdGlvbiBEZXZpY2VQYXJhbXMocGFyYW1zKSB7CiAgICAgIHRoaXMueGRwaSA9IHBhcmFtcy54ZHBpOwogICAgICB0aGlzLnlkcGkgPSBwYXJhbXMueWRwaTsKICAgICAgdGhpcy5iZXZlbE1tID0gcGFyYW1zLmJldmVsTW07CiAgICB9CiAgICBmdW5jdGlvbiBTZW5zb3JTYW1wbGUoc2FtcGxlLCB0aW1lc3RhbXBTKSB7CiAgICAgIHRoaXMuc2V0KHNhbXBsZSwgdGltZXN0YW1wUyk7CiAgICB9CiAgICBTZW5zb3JTYW1wbGUucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChzYW1wbGUsIHRpbWVzdGFtcFMpIHsKICAgICAgdGhpcy5zYW1wbGUgPSBzYW1wbGU7CiAgICAgIHRoaXMudGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICB9OwogICAgU2Vuc29yU2FtcGxlLnByb3RvdHlwZS5jb3B5ID0gZnVuY3Rpb24gKHNlbnNvclNhbXBsZSkgewogICAgICB0aGlzLnNldChzZW5zb3JTYW1wbGUuc2FtcGxlLCBzZW5zb3JTYW1wbGUudGltZXN0YW1wUyk7CiAgICB9OwogICAgZnVuY3Rpb24gQ29tcGxlbWVudGFyeUZpbHRlcihrRmlsdGVyLCBpc0RlYnVnKSB7CiAgICAgIHRoaXMua0ZpbHRlciA9IGtGaWx0ZXI7CiAgICAgIHRoaXMuaXNEZWJ1ZyA9IGlzRGVidWc7CiAgICAgIHRoaXMuY3VycmVudEFjY2VsTWVhc3VyZW1lbnQgPSBuZXcgU2Vuc29yU2FtcGxlKCk7CiAgICAgIHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudCA9IG5ldyBTZW5zb3JTYW1wbGUoKTsKICAgICAgdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudCA9IG5ldyBTZW5zb3JTYW1wbGUoKTsKICAgICAgaWYgKGlzSU9TKCkpIHsKICAgICAgICB0aGlzLmZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigtMSwgMCwgMCwgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maWx0ZXJRID0gbmV3IFF1YXRlcm5pb24oMSwgMCwgMCwgMSk7CiAgICAgIH0KICAgICAgdGhpcy5wcmV2aW91c0ZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLnByZXZpb3VzRmlsdGVyUS5jb3B5KHRoaXMuZmlsdGVyUSk7CiAgICAgIHRoaXMuYWNjZWxRID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pc09yaWVudGF0aW9uSW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgICAgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5ID0gbmV3IFZlY3RvcjMoKTsKICAgICAgdGhpcy5tZWFzdXJlZEdyYXZpdHkgPSBuZXcgVmVjdG9yMygpOwogICAgICB0aGlzLmd5cm9JbnRlZ3JhbFEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgfQogICAgQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuYWRkQWNjZWxNZWFzdXJlbWVudCA9IGZ1bmN0aW9uICh2ZWN0b3IsIHRpbWVzdGFtcFMpIHsKICAgICAgdGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudC5zZXQodmVjdG9yLCB0aW1lc3RhbXBTKTsKICAgIH07CiAgICBDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5hZGRHeXJvTWVhc3VyZW1lbnQgPSBmdW5jdGlvbiAodmVjdG9yLCB0aW1lc3RhbXBTKSB7CiAgICAgIHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudC5zZXQodmVjdG9yLCB0aW1lc3RhbXBTKTsKICAgICAgdmFyIGRlbHRhVCA9IHRpbWVzdGFtcFMgLSB0aGlzLnByZXZpb3VzR3lyb01lYXN1cmVtZW50LnRpbWVzdGFtcFM7CiAgICAgIGlmIChpc1RpbWVzdGFtcERlbHRhVmFsaWQoZGVsdGFUKSkgewogICAgICAgIHRoaXMucnVuXygpOwogICAgICB9CiAgICAgIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQuY29weSh0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQpOwogICAgfTsKICAgIENvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLnJ1bl8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5pc09yaWVudGF0aW9uSW5pdGlhbGl6ZWQpIHsKICAgICAgICB0aGlzLmFjY2VsUSA9IHRoaXMuYWNjZWxUb1F1YXRlcm5pb25fKHRoaXMuY3VycmVudEFjY2VsTWVhc3VyZW1lbnQuc2FtcGxlKTsKICAgICAgICB0aGlzLnByZXZpb3VzRmlsdGVyUS5jb3B5KHRoaXMuYWNjZWxRKTsKICAgICAgICB0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBkZWx0YVQgPSB0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUyAtIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUzsKICAgICAgdmFyIGd5cm9EZWx0YVEgPSB0aGlzLmd5cm9Ub1F1YXRlcm5pb25EZWx0YV8odGhpcy5jdXJyZW50R3lyb01lYXN1cmVtZW50LnNhbXBsZSwgZGVsdGFUKTsKICAgICAgdGhpcy5neXJvSW50ZWdyYWxRLm11bHRpcGx5KGd5cm9EZWx0YVEpOwogICAgICB0aGlzLmZpbHRlclEuY29weSh0aGlzLnByZXZpb3VzRmlsdGVyUSk7CiAgICAgIHRoaXMuZmlsdGVyUS5tdWx0aXBseShneXJvRGVsdGFRKTsKICAgICAgdmFyIGludkZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBpbnZGaWx0ZXJRLmNvcHkodGhpcy5maWx0ZXJRKTsKICAgICAgaW52RmlsdGVyUS5pbnZlcnNlKCk7CiAgICAgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5zZXQoMCwgMCwgLTEpOwogICAgICB0aGlzLmVzdGltYXRlZEdyYXZpdHkuYXBwbHlRdWF0ZXJuaW9uKGludkZpbHRlclEpOwogICAgICB0aGlzLmVzdGltYXRlZEdyYXZpdHkubm9ybWFsaXplKCk7CiAgICAgIHRoaXMubWVhc3VyZWRHcmF2aXR5LmNvcHkodGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudC5zYW1wbGUpOwogICAgICB0aGlzLm1lYXN1cmVkR3Jhdml0eS5ub3JtYWxpemUoKTsKICAgICAgdmFyIGRlbHRhUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIGRlbHRhUS5zZXRGcm9tVW5pdFZlY3RvcnModGhpcy5lc3RpbWF0ZWRHcmF2aXR5LCB0aGlzLm1lYXN1cmVkR3Jhdml0eSk7CiAgICAgIGRlbHRhUS5pbnZlcnNlKCk7CiAgICAgIGlmICh0aGlzLmlzRGVidWcpIHsKICAgICAgICBjb25zb2xlLmxvZygnRGVsdGE6ICVkIGRlZywgR19lc3Q6ICglcywgJXMsICVzKSwgR19tZWFzOiAoJXMsICVzLCAlcyknLCByYWRUb0RlZyAqIGdldFF1YXRlcm5pb25BbmdsZShkZWx0YVEpLCB0aGlzLmVzdGltYXRlZEdyYXZpdHkueC50b0ZpeGVkKDEpLCB0aGlzLmVzdGltYXRlZEdyYXZpdHkueS50b0ZpeGVkKDEpLCB0aGlzLmVzdGltYXRlZEdyYXZpdHkuei50b0ZpeGVkKDEpLCB0aGlzLm1lYXN1cmVkR3Jhdml0eS54LnRvRml4ZWQoMSksIHRoaXMubWVhc3VyZWRHcmF2aXR5LnkudG9GaXhlZCgxKSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkuei50b0ZpeGVkKDEpKTsKICAgICAgfQogICAgICB2YXIgdGFyZ2V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRhcmdldFEuY29weSh0aGlzLmZpbHRlclEpOwogICAgICB0YXJnZXRRLm11bHRpcGx5KGRlbHRhUSk7CiAgICAgIHRoaXMuZmlsdGVyUS5zbGVycCh0YXJnZXRRLCAxIC0gdGhpcy5rRmlsdGVyKTsKICAgICAgdGhpcy5wcmV2aW91c0ZpbHRlclEuY29weSh0aGlzLmZpbHRlclEpOwogICAgfTsKICAgIENvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLmdldE9yaWVudGF0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5maWx0ZXJROwogICAgfTsKICAgIENvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLmFjY2VsVG9RdWF0ZXJuaW9uXyA9IGZ1bmN0aW9uIChhY2NlbCkgewogICAgICB2YXIgbm9ybUFjY2VsID0gbmV3IFZlY3RvcjMoKTsKICAgICAgbm9ybUFjY2VsLmNvcHkoYWNjZWwpOwogICAgICBub3JtQWNjZWwubm9ybWFsaXplKCk7CiAgICAgIHZhciBxdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcXVhdC5zZXRGcm9tVW5pdFZlY3RvcnMobmV3IFZlY3RvcjMoMCwgMCwgLTEpLCBub3JtQWNjZWwpOwogICAgICBxdWF0LmludmVyc2UoKTsKICAgICAgcmV0dXJuIHF1YXQ7CiAgICB9OwogICAgQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuZ3lyb1RvUXVhdGVybmlvbkRlbHRhXyA9IGZ1bmN0aW9uIChneXJvLCBkdCkgewogICAgICB2YXIgcXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHZhciBheGlzID0gbmV3IFZlY3RvcjMoKTsKICAgICAgYXhpcy5jb3B5KGd5cm8pOwogICAgICBheGlzLm5vcm1hbGl6ZSgpOwogICAgICBxdWF0LnNldEZyb21BeGlzQW5nbGUoYXhpcywgZ3lyby5sZW5ndGgoKSAqIGR0KTsKICAgICAgcmV0dXJuIHF1YXQ7CiAgICB9OwogICAgZnVuY3Rpb24gUG9zZVByZWRpY3RvcihwcmVkaWN0aW9uVGltZVMsIGlzRGVidWcpIHsKICAgICAgdGhpcy5wcmVkaWN0aW9uVGltZVMgPSBwcmVkaWN0aW9uVGltZVM7CiAgICAgIHRoaXMuaXNEZWJ1ZyA9IGlzRGVidWc7CiAgICAgIHRoaXMucHJldmlvdXNRID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSBudWxsOwogICAgICB0aGlzLmRlbHRhUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMub3V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICB9CiAgICBQb3NlUHJlZGljdG9yLnByb3RvdHlwZS5nZXRQcmVkaWN0aW9uID0gZnVuY3Rpb24gKGN1cnJlbnRRLCBneXJvLCB0aW1lc3RhbXBTKSB7CiAgICAgIGlmICghdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMpIHsKICAgICAgICB0aGlzLnByZXZpb3VzUS5jb3B5KGN1cnJlbnRRKTsKICAgICAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICAgICAgcmV0dXJuIGN1cnJlbnRROwogICAgICB9CiAgICAgIHZhciBheGlzID0gbmV3IFZlY3RvcjMoKTsKICAgICAgYXhpcy5jb3B5KGd5cm8pOwogICAgICBheGlzLm5vcm1hbGl6ZSgpOwogICAgICB2YXIgYW5ndWxhclNwZWVkID0gZ3lyby5sZW5ndGgoKTsKICAgICAgaWYgKGFuZ3VsYXJTcGVlZCA8IGRlZ1RvUmFkICogMjApIHsKICAgICAgICBpZiAodGhpcy5pc0RlYnVnKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnTW92aW5nIHNsb3dseSwgYXQgJXMgZGVnL3M6IG5vIHByZWRpY3Rpb24nLCAocmFkVG9EZWcgKiBhbmd1bGFyU3BlZWQpLnRvRml4ZWQoMSkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm91dFEuY29weShjdXJyZW50USk7CiAgICAgICAgdGhpcy5wcmV2aW91c1EuY29weShjdXJyZW50USk7CiAgICAgICAgcmV0dXJuIHRoaXMub3V0UTsKICAgICAgfQogICAgICB2YXIgcHJlZGljdEFuZ2xlID0gYW5ndWxhclNwZWVkICogdGhpcy5wcmVkaWN0aW9uVGltZVM7CiAgICAgIHRoaXMuZGVsdGFRLnNldEZyb21BeGlzQW5nbGUoYXhpcywgcHJlZGljdEFuZ2xlKTsKICAgICAgdGhpcy5vdXRRLmNvcHkodGhpcy5wcmV2aW91c1EpOwogICAgICB0aGlzLm91dFEubXVsdGlwbHkodGhpcy5kZWx0YVEpOwogICAgICB0aGlzLnByZXZpb3VzUS5jb3B5KGN1cnJlbnRRKTsKICAgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwogICAgICByZXR1cm4gdGhpcy5vdXRROwogICAgfTsKICAgIGZ1bmN0aW9uIEZ1c2lvblBvc2VTZW5zb3Ioa0ZpbHRlciwgcHJlZGljdGlvblRpbWUsIHlhd09ubHksIGlzRGVidWcpIHsKICAgICAgdGhpcy55YXdPbmx5ID0geWF3T25seTsKICAgICAgdGhpcy5hY2NlbGVyb21ldGVyID0gbmV3IFZlY3RvcjMoKTsKICAgICAgdGhpcy5neXJvc2NvcGUgPSBuZXcgVmVjdG9yMygpOwogICAgICB0aGlzLmZpbHRlciA9IG5ldyBDb21wbGVtZW50YXJ5RmlsdGVyKGtGaWx0ZXIsIGlzRGVidWcpOwogICAgICB0aGlzLnBvc2VQcmVkaWN0b3IgPSBuZXcgUG9zZVByZWRpY3RvcihwcmVkaWN0aW9uVGltZSwgaXNEZWJ1Zyk7CiAgICAgIHRoaXMuaXNGaXJlZm94QW5kcm9pZCA9IGlzRmlyZWZveEFuZHJvaWQoKTsKICAgICAgdGhpcy5pc0lPUyA9IGlzSU9TKCk7CiAgICAgIHZhciBjaHJvbWVWZXJzaW9uID0gZ2V0Q2hyb21lVmVyc2lvbigpOwogICAgICB0aGlzLmlzRGV2aWNlTW90aW9uSW5SYWRpYW5zID0gIXRoaXMuaXNJT1MgJiYgY2hyb21lVmVyc2lvbiAmJiBjaHJvbWVWZXJzaW9uIDwgNjY7CiAgICAgIHRoaXMuaXNXaXRob3V0RGV2aWNlTW90aW9uID0gaXNDaHJvbWVXaXRob3V0RGV2aWNlTW90aW9uKCkgfHwgaXNTYWZhcmlXaXRob3V0RGV2aWNlTW90aW9uKCk7CiAgICAgIHRoaXMuZmlsdGVyVG9Xb3JsZFEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBpZiAoaXNJT1MoKSkgewogICAgICAgIHRoaXMuZmlsdGVyVG9Xb3JsZFEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygxLCAwLCAwKSwgTWF0aC5QSSAvIDIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsdGVyVG9Xb3JsZFEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygxLCAwLCAwKSwgLU1hdGguUEkgLyAyKTsKICAgICAgfQogICAgICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMud29ybGRUb1NjcmVlblEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLm9yaWdpbmFsUG9zZUFkanVzdFEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLm9yaWdpbmFsUG9zZUFkanVzdFEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgLXdpbmRvdy5vcmllbnRhdGlvbiAqIE1hdGguUEkgLyAxODApOwogICAgICB0aGlzLnNldFNjcmVlblRyYW5zZm9ybV8oKTsKICAgICAgaWYgKGlzTGFuZHNjYXBlTW9kZSgpKSB7CiAgICAgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5tdWx0aXBseSh0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSk7CiAgICAgIH0KICAgICAgdGhpcy5yZXNldFEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLm9yaWVudGF0aW9uT3V0XyA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CiAgICAgIHRoaXMuc3RhcnQoKTsKICAgIH0KICAgIEZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLmdldFBvc2l0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5nZXRPcmllbnRhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG9yaWVudGF0aW9uID0gdm9pZCAwOwogICAgICBpZiAodGhpcy5pc1dpdGhvdXREZXZpY2VNb3Rpb24gJiYgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25RKSB7CiAgICAgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpeFEgPSB0aGlzLmRldmljZU9yaWVudGF0aW9uRml4USB8fCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgeiA9IG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAtMSksIDApOwogICAgICAgICAgdmFyIHkgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICAgICAgaWYgKHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gLTkwKSB7CiAgICAgICAgICAgIHkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAxLCAwKSwgTWF0aC5QSSAvIC0yKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAxLCAwKSwgTWF0aC5QSSAvIDIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHoubXVsdGlwbHkoeSk7CiAgICAgICAgfSgpOwogICAgICAgIHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaWx0ZXJUb1dvcmxkUSA9IHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaWx0ZXJUb1dvcmxkUSB8fCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgICAgICBxLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMSwgMCwgMCksIC1NYXRoLlBJIC8gMik7CiAgICAgICAgICByZXR1cm4gcTsKICAgICAgICB9KCk7CiAgICAgICAgb3JpZW50YXRpb24gPSB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblE7CiAgICAgICAgdmFyIG91dCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgICAgb3V0LmNvcHkob3JpZW50YXRpb24pOwogICAgICAgIG91dC5tdWx0aXBseSh0aGlzLmRldmljZU9yaWVudGF0aW9uRmlsdGVyVG9Xb3JsZFEpOwogICAgICAgIG91dC5tdWx0aXBseSh0aGlzLnJlc2V0USk7CiAgICAgICAgb3V0Lm11bHRpcGx5KHRoaXMud29ybGRUb1NjcmVlblEpOwogICAgICAgIG91dC5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaXhRLCBvdXQpOwogICAgICAgIGlmICh0aGlzLnlhd09ubHkpIHsKICAgICAgICAgIG91dC54ID0gMDsKICAgICAgICAgIG91dC56ID0gMDsKICAgICAgICAgIG91dC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMF0gPSBvdXQueDsKICAgICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1sxXSA9IG91dC55OwogICAgICAgIHRoaXMub3JpZW50YXRpb25PdXRfWzJdID0gb3V0Lno7CiAgICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bM10gPSBvdXQudzsKICAgICAgICByZXR1cm4gdGhpcy5vcmllbnRhdGlvbk91dF87CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZpbHRlck9yaWVudGF0aW9uID0gdGhpcy5maWx0ZXIuZ2V0T3JpZW50YXRpb24oKTsKICAgICAgICBvcmllbnRhdGlvbiA9IHRoaXMucG9zZVByZWRpY3Rvci5nZXRQcmVkaWN0aW9uKGZpbHRlck9yaWVudGF0aW9uLCB0aGlzLmd5cm9zY29wZSwgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMpOwogICAgICB9CiAgICAgIHZhciBvdXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBvdXQuY29weSh0aGlzLmZpbHRlclRvV29ybGRRKTsKICAgICAgb3V0Lm11bHRpcGx5KHRoaXMucmVzZXRRKTsKICAgICAgb3V0Lm11bHRpcGx5KG9yaWVudGF0aW9uKTsKICAgICAgb3V0Lm11bHRpcGx5KHRoaXMud29ybGRUb1NjcmVlblEpOwogICAgICBpZiAodGhpcy55YXdPbmx5KSB7CiAgICAgICAgb3V0LnggPSAwOwogICAgICAgIG91dC56ID0gMDsKICAgICAgICBvdXQubm9ybWFsaXplKCk7CiAgICAgIH0KICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMF0gPSBvdXQueDsKICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMV0gPSBvdXQueTsKICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMl0gPSBvdXQuejsKICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bM10gPSBvdXQudzsKICAgICAgcmV0dXJuIHRoaXMub3JpZW50YXRpb25PdXRfOwogICAgfTsKICAgIEZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnJlc2V0UG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5yZXNldFEuY29weSh0aGlzLmZpbHRlci5nZXRPcmllbnRhdGlvbigpKTsKICAgICAgdGhpcy5yZXNldFEueCA9IDA7CiAgICAgIHRoaXMucmVzZXRRLnkgPSAwOwogICAgICB0aGlzLnJlc2V0US56ICo9IC0xOwogICAgICB0aGlzLnJlc2V0US5ub3JtYWxpemUoKTsKICAgICAgaWYgKGlzTGFuZHNjYXBlTW9kZSgpKSB7CiAgICAgICAgdGhpcy5yZXNldFEubXVsdGlwbHkodGhpcy5pbnZlcnNlV29ybGRUb1NjcmVlblEpOwogICAgICB9CiAgICAgIHRoaXMucmVzZXRRLm11bHRpcGx5KHRoaXMub3JpZ2luYWxQb3NlQWRqdXN0USk7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25EZXZpY2VPcmllbnRhdGlvbl8gPSBmdW5jdGlvbiAoZSkgewogICAgICB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblEgPSB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblEgfHwgbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdmFyIGFscGhhID0gZS5hbHBoYSwKICAgICAgICAgIGJldGEgPSBlLmJldGEsCiAgICAgICAgICBnYW1tYSA9IGUuZ2FtbWE7CiAgICAgIGFscGhhID0gKGFscGhhIHx8IDApICogTWF0aC5QSSAvIDE4MDsKICAgICAgYmV0YSA9IChiZXRhIHx8IDApICogTWF0aC5QSSAvIDE4MDsKICAgICAgZ2FtbWEgPSAoZ2FtbWEgfHwgMCkgKiBNYXRoLlBJIC8gMTgwOwogICAgICB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblEuc2V0RnJvbUV1bGVyWVhaKGJldGEsIGFscGhhLCAtZ2FtbWEpOwogICAgfTsKICAgIEZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLm9uRGV2aWNlTW90aW9uXyA9IGZ1bmN0aW9uIChkZXZpY2VNb3Rpb24pIHsKICAgICAgdGhpcy51cGRhdGVEZXZpY2VNb3Rpb25fKGRldmljZU1vdGlvbik7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUudXBkYXRlRGV2aWNlTW90aW9uXyA9IGZ1bmN0aW9uIChkZXZpY2VNb3Rpb24pIHsKICAgICAgdmFyIGFjY0dyYXZpdHkgPSBkZXZpY2VNb3Rpb24uYWNjZWxlcmF0aW9uSW5jbHVkaW5nR3Jhdml0eTsKICAgICAgdmFyIHJvdFJhdGUgPSBkZXZpY2VNb3Rpb24ucm90YXRpb25SYXRlOwogICAgICB2YXIgdGltZXN0YW1wUyA9IGRldmljZU1vdGlvbi50aW1lU3RhbXAgLyAxMDAwOwogICAgICB2YXIgZGVsdGFTID0gdGltZXN0YW1wUyAtIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTOwogICAgICBpZiAoZGVsdGFTIDwgMCkgewogICAgICAgIHdhcm5PbmNlKCdmdXNpb24tcG9zZS1zZW5zb3I6aW52YWxpZDpub24tbW9ub3RvbmljJywgJ0ludmFsaWQgdGltZXN0YW1wcyBkZXRlY3RlZDogbm9uLW1vbm90b25pYyB0aW1lc3RhbXAgZnJvbSBkZXZpY2Vtb3Rpb24nKTsKICAgICAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhUyA8PSBNSU5fVElNRVNURVAgfHwgZGVsdGFTID4gTUFYX1RJTUVTVEVQKSB7CiAgICAgICAgd2Fybk9uY2UoJ2Z1c2lvbi1wb3NlLXNlbnNvcjppbnZhbGlkOm91dHNpZGUtdGhyZXNob2xkJywgJ0ludmFsaWQgdGltZXN0YW1wcyBkZXRlY3RlZDogVGltZXN0YW1wIGZyb20gZGV2aWNlbW90aW9uIG91dHNpZGUgZXhwZWN0ZWQgcmFuZ2UuJyk7CiAgICAgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmFjY2VsZXJvbWV0ZXIuc2V0KC1hY2NHcmF2aXR5LngsIC1hY2NHcmF2aXR5LnksIC1hY2NHcmF2aXR5LnopOwogICAgICBpZiAocm90UmF0ZSkgewogICAgICAgIGlmIChpc1I3KCkpIHsKICAgICAgICAgIHRoaXMuZ3lyb3Njb3BlLnNldCgtcm90UmF0ZS5iZXRhLCByb3RSYXRlLmFscGhhLCByb3RSYXRlLmdhbW1hKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5neXJvc2NvcGUuc2V0KHJvdFJhdGUuYWxwaGEsIHJvdFJhdGUuYmV0YSwgcm90UmF0ZS5nYW1tYSk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5pc0RldmljZU1vdGlvbkluUmFkaWFucykgewogICAgICAgICAgdGhpcy5neXJvc2NvcGUubXVsdGlwbHlTY2FsYXIoTWF0aC5QSSAvIDE4MCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZmlsdGVyLmFkZEd5cm9NZWFzdXJlbWVudCh0aGlzLmd5cm9zY29wZSwgdGltZXN0YW1wUyk7CiAgICAgIH0KICAgICAgdGhpcy5maWx0ZXIuYWRkQWNjZWxNZWFzdXJlbWVudCh0aGlzLmFjY2VsZXJvbWV0ZXIsIHRpbWVzdGFtcFMpOwogICAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25PcmllbnRhdGlvbkNoYW5nZV8gPSBmdW5jdGlvbiAoc2NyZWVuT3JpZW50YXRpb24pIHsKICAgICAgdGhpcy5zZXRTY3JlZW5UcmFuc2Zvcm1fKCk7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25NZXNzYWdlXyA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICB2YXIgbWVzc2FnZSA9IGV2ZW50LmRhdGE7CiAgICAgIGlmICghbWVzc2FnZSB8fCAhbWVzc2FnZS50eXBlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciB0eXBlID0gbWVzc2FnZS50eXBlLnRvTG93ZXJDYXNlKCk7CiAgICAgIGlmICh0eXBlICE9PSAnZGV2aWNlbW90aW9uJykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLnVwZGF0ZURldmljZU1vdGlvbl8obWVzc2FnZS5kZXZpY2VNb3Rpb25FdmVudCk7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuc2V0U2NyZWVuVHJhbnNmb3JtXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy53b3JsZFRvU2NyZWVuUS5zZXQoMCwgMCwgMCwgMSk7CiAgICAgIHN3aXRjaCAod2luZG93Lm9yaWVudGF0aW9uKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA5MDoKICAgICAgICAgIHRoaXMud29ybGRUb1NjcmVlblEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgLU1hdGguUEkgLyAyKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgLTkwOgogICAgICAgICAgdGhpcy53b3JsZFRvU2NyZWVuUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIDEpLCBNYXRoLlBJIC8gMik7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUS5jb3B5KHRoaXMud29ybGRUb1NjcmVlblEpOwogICAgICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUS5pbnZlcnNlKCk7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMub25EZXZpY2VNb3Rpb25DYWxsYmFja18gPSB0aGlzLm9uRGV2aWNlTW90aW9uXy5iaW5kKHRoaXMpOwogICAgICB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VDYWxsYmFja18gPSB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VfLmJpbmQodGhpcyk7CiAgICAgIHRoaXMub25NZXNzYWdlQ2FsbGJhY2tfID0gdGhpcy5vbk1lc3NhZ2VfLmJpbmQodGhpcyk7CiAgICAgIHRoaXMub25EZXZpY2VPcmllbnRhdGlvbkNhbGxiYWNrXyA9IHRoaXMub25EZXZpY2VPcmllbnRhdGlvbl8uYmluZCh0aGlzKTsKICAgICAgaWYgKGlzSU9TKCkgJiYgaXNJbnNpZGVDcm9zc09yaWdpbklGcmFtZSgpKSB7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZUNhbGxiYWNrXyk7CiAgICAgIH0KICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vbk9yaWVudGF0aW9uQ2hhbmdlQ2FsbGJhY2tfKTsKICAgICAgaWYgKHRoaXMuaXNXaXRob3V0RGV2aWNlTW90aW9uKSB7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyk7CiAgICAgIH0KICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkgewogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyk7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdkZXZpY2VvcmllbnRhdGlvbicsIHRoaXMub25EZXZpY2VPcmllbnRhdGlvbkNhbGxiYWNrXyk7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMub25PcmllbnRhdGlvbkNoYW5nZUNhbGxiYWNrXyk7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbk1lc3NhZ2VDYWxsYmFja18pOwogICAgfTsKICAgIHZhciBTRU5TT1JfRlJFUVVFTkNZID0gNjA7CiAgICB2YXIgWF9BWElTID0gbmV3IFZlY3RvcjMoMSwgMCwgMCk7CiAgICB2YXIgWl9BWElTID0gbmV3IFZlY3RvcjMoMCwgMCwgMSk7CiAgICB2YXIgU0VOU09SX1RPX1ZSID0gbmV3IFF1YXRlcm5pb24oKTsKICAgIFNFTlNPUl9UT19WUi5zZXRGcm9tQXhpc0FuZ2xlKFhfQVhJUywgLU1hdGguUEkgLyAyKTsKICAgIFNFTlNPUl9UT19WUi5tdWx0aXBseShuZXcgUXVhdGVybmlvbigpLnNldEZyb21BeGlzQW5nbGUoWl9BWElTLCBNYXRoLlBJIC8gMikpOwogICAgdmFyIFBvc2VTZW5zb3IgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGZ1bmN0aW9uIFBvc2VTZW5zb3IoY29uZmlnKSB7CiAgICAgICAgY2xhc3NDYWxsQ2hlY2sodGhpcywgUG9zZVNlbnNvcik7CiAgICAgICAgdGhpcy5jb25maWcgPSBjb25maWc7CiAgICAgICAgdGhpcy5zZW5zb3IgPSBudWxsOwogICAgICAgIHRoaXMuZnVzaW9uU2Vuc29yID0gbnVsbDsKICAgICAgICB0aGlzLl9vdXQgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwogICAgICAgIHRoaXMuYXBpID0gbnVsbDsKICAgICAgICB0aGlzLmVycm9ycyA9IFtdOwogICAgICAgIHRoaXMuX3NlbnNvclEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICAgIHRoaXMuX291dFEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICAgIHRoaXMuX29uU2Vuc29yUmVhZCA9IHRoaXMuX29uU2Vuc29yUmVhZC5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMuX29uU2Vuc29yRXJyb3IgPSB0aGlzLl9vblNlbnNvckVycm9yLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5pbml0KCk7CiAgICAgIH0KICAgICAgY3JlYXRlQ2xhc3MoUG9zZVNlbnNvciwgW3sKICAgICAgICBrZXk6ICdpbml0JywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgIHZhciBzZW5zb3IgPSBudWxsOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc2Vuc29yID0gbmV3IFJlbGF0aXZlT3JpZW50YXRpb25TZW5zb3IoewogICAgICAgICAgICAgIGZyZXF1ZW5jeTogU0VOU09SX0ZSRVFVRU5DWSwKICAgICAgICAgICAgICByZWZlcmVuY2VGcmFtZTogJ3NjcmVlbicKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHNlbnNvci5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMuX29uU2Vuc29yRXJyb3IpOwogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgdGhpcy5lcnJvcnMucHVzaChlcnJvcik7CiAgICAgICAgICAgIGlmIChlcnJvci5uYW1lID09PSAnU2VjdXJpdHlFcnJvcicpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDYW5ub3QgY29uc3RydWN0IHNlbnNvcnMgZHVlIHRvIHRoZSBGZWF0dXJlIFBvbGljeScpOwogICAgICAgICAgICAgIGNvbnNvbGUud2FybignQXR0ZW1wdGluZyB0byBmYWxsIGJhY2sgdXNpbmcgImRldmljZW1vdGlvbiI7IGhvd2V2ZXIgdGhpcyB3aWxsICcgKyAnZmFpbCBpbiB0aGUgZnV0dXJlIHdpdGhvdXQgY29ycmVjdCBwZXJtaXNzaW9ucy4nKTsKICAgICAgICAgICAgICB0aGlzLnVzZURldmljZU1vdGlvbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLm5hbWUgPT09ICdSZWZlcmVuY2VFcnJvcicpIHsKICAgICAgICAgICAgICB0aGlzLnVzZURldmljZU1vdGlvbigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2Vuc29yKSB7CiAgICAgICAgICAgIHRoaXMuYXBpID0gJ3NlbnNvcic7CiAgICAgICAgICAgIHRoaXMuc2Vuc29yID0gc2Vuc29yOwogICAgICAgICAgICB0aGlzLnNlbnNvci5hZGRFdmVudExpc3RlbmVyKCdyZWFkaW5nJywgdGhpcy5fb25TZW5zb3JSZWFkKTsKICAgICAgICAgICAgdGhpcy5zZW5zb3Iuc3RhcnQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICd1c2VEZXZpY2VNb3Rpb24nLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiB1c2VEZXZpY2VNb3Rpb24oKSB7CiAgICAgICAgICB0aGlzLmFwaSA9ICdkZXZpY2Vtb3Rpb24nOwogICAgICAgICAgdGhpcy5mdXNpb25TZW5zb3IgPSBuZXcgRnVzaW9uUG9zZVNlbnNvcih0aGlzLmNvbmZpZy5LX0ZJTFRFUiwgdGhpcy5jb25maWcuUFJFRElDVElPTl9USU1FX1MsIHRoaXMuY29uZmlnLllBV19PTkxZLCB0aGlzLmNvbmZpZy5ERUJVRyk7CiAgICAgICAgICBpZiAodGhpcy5zZW5zb3IpIHsKICAgICAgICAgICAgdGhpcy5zZW5zb3IucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVhZGluZycsIHRoaXMuX29uU2Vuc29yUmVhZCk7CiAgICAgICAgICAgIHRoaXMuc2Vuc29yLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgdGhpcy5fb25TZW5zb3JFcnJvcik7CiAgICAgICAgICAgIHRoaXMuc2Vuc29yID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICdnZXRPcmllbnRhdGlvbicsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGdldE9yaWVudGF0aW9uKCkgewogICAgICAgICAgaWYgKHRoaXMuZnVzaW9uU2Vuc29yKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZ1c2lvblNlbnNvci5nZXRPcmllbnRhdGlvbigpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCF0aGlzLnNlbnNvciB8fCAhdGhpcy5zZW5zb3IucXVhdGVybmlvbikgewogICAgICAgICAgICB0aGlzLl9vdXRbMF0gPSB0aGlzLl9vdXRbMV0gPSB0aGlzLl9vdXRbMl0gPSAwOwogICAgICAgICAgICB0aGlzLl9vdXRbM10gPSAxOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fb3V0OwogICAgICAgICAgfQogICAgICAgICAgdmFyIHEgPSB0aGlzLnNlbnNvci5xdWF0ZXJuaW9uOwogICAgICAgICAgdGhpcy5fc2Vuc29yUS5zZXQocVswXSwgcVsxXSwgcVsyXSwgcVszXSk7CiAgICAgICAgICB2YXIgb3V0ID0gdGhpcy5fb3V0UTsKICAgICAgICAgIG91dC5jb3B5KFNFTlNPUl9UT19WUik7CiAgICAgICAgICBvdXQubXVsdGlwbHkodGhpcy5fc2Vuc29yUSk7CiAgICAgICAgICBpZiAodGhpcy5jb25maWcuWUFXX09OTFkpIHsKICAgICAgICAgICAgb3V0LnggPSBvdXQueiA9IDA7CiAgICAgICAgICAgIG91dC5ub3JtYWxpemUoKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX291dFswXSA9IG91dC54OwogICAgICAgICAgdGhpcy5fb3V0WzFdID0gb3V0Lnk7CiAgICAgICAgICB0aGlzLl9vdXRbMl0gPSBvdXQuejsKICAgICAgICAgIHRoaXMuX291dFszXSA9IG91dC53OwogICAgICAgICAgcmV0dXJuIHRoaXMuX291dDsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICdfb25TZW5zb3JFcnJvcicsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9vblNlbnNvckVycm9yKGV2ZW50KSB7CiAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGV2ZW50LmVycm9yKTsKICAgICAgICAgIGlmIChldmVudC5lcnJvci5uYW1lID09PSAnTm90QWxsb3dlZEVycm9yJykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdQZXJtaXNzaW9uIHRvIGFjY2VzcyBzZW5zb3Igd2FzIGRlbmllZCcpOwogICAgICAgICAgfSBlbHNlIGlmIChldmVudC5lcnJvci5uYW1lID09PSAnTm90UmVhZGFibGVFcnJvcicpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignU2Vuc29yIGNvdWxkIG5vdCBiZSByZWFkJyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGV2ZW50LmVycm9yKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMudXNlRGV2aWNlTW90aW9uKCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAnX29uU2Vuc29yUmVhZCcsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9vblNlbnNvclJlYWQoKSB7fQogICAgICB9XSk7CiAgICAgIHJldHVybiBQb3NlU2Vuc29yOwogICAgfSgpOwogICAgdmFyIHJvdGF0ZUluc3RydWN0aW9uc0Fzc2V0ID0gIjxzdmcgd2lkdGg9JzE5OCcgaGVpZ2h0PScyNDAnIHZpZXdCb3g9JzAgMCAxOTggMjQwJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnPjxnIGZpbGw9J25vbmUnIGZpbGwtcnVsZT0nZXZlbm9kZCc+PHBhdGggZD0nTTE0OS42MjUgMTA5LjUyN2w2LjczNyAzLjg5MXYuODg2YzAgLjE3Ny4wMTMuMzYuMDM4LjU0OS4wMS4wODEuMDIuMTYyLjAyNy4yNDIuMTQgMS40MTUuOTc0IDIuOTk4IDIuMTA1IDMuOTk5bDUuNzIgNS4wNjIuMDgxLS4wOXM0LjM4Mi0yLjUzIDUuMjM1LTMuMDI0bDI1Ljk3IDE0Ljk5M3Y1NC4wMDFjMCAuNzcxLS4zODYgMS4yMTctLjk0OCAxLjIxNy0uMjMzIDAtLjQ5NS0uMDc2LS43NzItLjIzNmwtMjMuOTY3LTEzLjgzOC0uMDE0LjAyNC0yNy4zMjIgMTUuNzc1LS44NS0xLjMyM2MtNC43MzEtMS41MjktOS43NDgtMi43NC0xNC45NTEtMy42MWEuMjcuMjcgMCAwIDAtLjAwNy4wMjRsLTUuMDY3IDE2Ljk2MS03Ljg5MSA0LjU1Ni0uMDM3LS4wNjN2MjcuNTljMCAuNzcyLS4zODYgMS4yMTctLjk0OCAxLjIxNy0uMjMyIDAtLjQ5NS0uMDc2LS43NzItLjIzNmwtNDIuNDczLTI0LjUyMmMtLjk1LS41NDktMS43Mi0xLjg3Ny0xLjcyLTIuOTY3di0xLjAzNWwtLjAyMS4wNDdhNS4xMTEgNS4xMTEgMCAwIDAtMS44MTYtLjM5OSA1LjY4MiA1LjY4MiAwIDAgMC0uNTQ2LjAwMSAxMy43MjQgMTMuNzI0IDAgMCAxLTEuOTE4LS4wNDFjLTEuNjU1LS4xNTMtMy4yLS42LTQuNDA0LTEuMjk2bC00Ni41NzYtMjYuODkuMDA1LjAxMi0xMC4yNzgtMTguNzVjLTEuMDAxLTEuODI3LS4yNDEtNC4yMTYgMS42OTgtNS4zMzZsNTYuMDExLTMyLjM0NWE0LjE5NCA0LjE5NCAwIDAgMSAyLjA5OS0uNTcyYzEuMzI2IDAgMi41NzIuNjU5IDMuMjI3IDEuODUzbC4wMDUtLjAwMy4yMjcuNDEzLS4wMDYuMDA0YTkuNjMgOS42MyAwIDAgMCAxLjQ3NyAyLjAxOGwuMjc3LjI3YzEuOTE0IDEuODUgNC40NjggMi44MDEgNy4xMTMgMi44MDEgMS45NDkgMCAzLjk0OC0uNTE3IDUuNzc1LTEuNTcyLjAxMyAwIDcuMzE5LTQuMjE5IDcuMzE5LTQuMjE5YTQuMTk0IDQuMTk0IDAgMCAxIDIuMDk5LS41NzJjMS4zMjYgMCAyLjU3Mi42NTggMy4yMjYgMS44NTNsMy4yNSA1LjkyOC4wMjItLjAxOCA2Ljc4NSAzLjkxNy0uMTA1LS4xODIgNDYuODgxLTI2Ljk2NW0wLTEuNjM1Yy0uMjgyIDAtLjU2My4wNzMtLjgxNS4yMThsLTQ2LjE2OSAyNi41NTYtNS40MS0zLjEyNC0zLjAwNS01LjQ4MWMtLjkxMy0xLjY2Ny0yLjY5OS0yLjcwMi00LjY2LTIuNzAzLTEuMDExIDAtMi4wMi4yNzQtMi45MTcuNzkyYTM4MjUgMzgyNSAwIDAgMS03LjI3NSA0LjE5NWwtLjA0NC4wMjRhOS45MzcgOS45MzcgMCAwIDEtNC45NTcgMS4zNTNjLTIuMjkyIDAtNC40MTQtLjgzMi01Ljk3Ni0yLjM0MmwtLjI1Mi0uMjQ1YTcuOTkyIDcuOTkyIDAgMCAxLTEuMTM5LTEuNTM0IDEuMzc5IDEuMzc5IDAgMCAwLS4wNi0uMTIybC0uMjI3LS40MTRhMS43MTggMS43MTggMCAwIDAtLjA5NS0uMTU0Yy0uOTM4LTEuNTc0LTIuNjczLTIuNTQ1LTQuNTcxLTIuNTQ1LTEuMDExIDAtMi4wMi4yNzQtMi45MTcuNzkyTDMuMTI1IDE1NS41MDJjLTIuNjk5IDEuNTU5LTMuNzM4IDQuOTQtMi4zMTQgNy41MzhsMTAuMjc4IDE4Ljc1Yy4xNzcuMzIzLjQ0OC41NjMuNzYxLjcwNGw0Ni40MjYgMjYuODA0YzEuNDAzLjgxIDMuMTU3IDEuMzMyIDUuMDcyIDEuNTA4YTE1LjY2MSAxNS42NjEgMCAwIDAgMi4xNDYuMDQ2IDQuNzY2IDQuNzY2IDAgMCAxIC4zOTYgMGMuMDk2LjAwNC4xOS4wMTEuMjgzLjAyMi4xMDkgMS41OTMgMS4xNTkgMy4zMjMgMi41MjkgNC4xMTRsNDIuNDcyIDI0LjUyMmMuNTI0LjMwMiAxLjA1OC40NTUgMS41OS40NTUgMS40OTcgMCAyLjU4My0xLjIgMi41ODMtMi44NTJ2LTI2LjU2Mmw3LjExMS00LjEwNWExLjY0IDEuNjQgMCAwIDAgLjc0OS0uOTQ4bDQuNjU4LTE1LjU5M2M0LjQxNC43OTcgOC42OTIgMS44NDggMTIuNzQyIDMuMTI4bC41MzMuODI5YTEuNjM0IDEuNjM0IDAgMCAwIDIuMTkzLjUzMWwyNi41MzItMTUuMzE3TDE5MyAxOTIuNDMzYy41MjMuMzAyIDEuMDU4LjQ1NSAxLjU5LjQ1NSAxLjQ5NyAwIDIuNTgzLTEuMTk5IDIuNTgzLTIuODUydi01NC4wMDFjMC0uNTg0LS4zMTItMS4xMjQtLjgxOC0xLjQxNmwtMjUuOTctMTQuOTkzYTEuNjMzIDEuNjMzIDAgMCAwLTEuNjM2LjAwMWMtLjYwNi4zNTEtMi45OTMgMS43My00LjMyNSAyLjQ5OGwtNC44MDktNC4yNTVjLS44MTktLjcyNS0xLjQ2MS0xLjkzMy0xLjU2MS0yLjkzNmE3Ljc3NiA3Ljc3NiAwIDAgMC0uMDMzLS4yOTQgMi40ODcgMi40ODcgMCAwIDEtLjAyMy0uMzM2di0uODg2YzAtLjU4NC0uMzEyLTEuMTIzLS44MTctMS40MTZsLTYuNzM5LTMuODkxYTEuNjMzIDEuNjMzIDAgMCAwLS44MTctLjIxOScgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J005Ni4wMjcgMTMyLjYzNmw0Ni41NzYgMjYuODkxYzEuMjA0LjY5NSAxLjk3OSAxLjU4NyAyLjI0MiAyLjU0MWwtLjAxLjAwNy04MS4zNzQgNDYuOTgyaC0uMDAxYy0xLjY1NC0uMTUyLTMuMTk5LS42LTQuNDAzLTEuMjk1bC00Ni41NzYtMjYuODkxIDgzLjU0Ni00OC4yMzUnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNNjMuNDYxIDIwOS4xNzRjLS4wMDggMC0uMDE1IDAtLjAyMi0uMDAyLTEuNjkzLS4xNTYtMy4yMjgtLjYwOS00LjQ0MS0xLjMwOWwtNDYuNTc2LTI2Ljg5YS4xMTguMTE4IDAgMCAxIDAtLjIwM2w4My41NDYtNDguMjM1YS4xMTcuMTE3IDAgMCAxIC4xMTcgMGw0Ni41NzYgMjYuODkxYzEuMjI3LjcwOCAyLjAyMSAxLjYxMiAyLjI5NiAyLjYxMWEuMTE2LjExNiAwIDAgMS0uMDQyLjEyNGwtLjAyMS4wMTYtODEuMzc1IDQ2Ljk4MWEuMTEuMTEgMCAwIDEtLjA1OC4wMTZ6bS01MC43NDctMjguMzAzbDQ2LjQwMSAyNi43OWMxLjE3OC42OCAyLjY3MSAxLjEyMSA0LjMyIDEuMjc2bDgxLjI3Mi00Ni45MjJjLS4yNzktLjkwNy0xLjAyNS0xLjczLTIuMTYzLTIuMzg3bC00Ni41MTctMjYuODU3LTgzLjMxMyA0OC4xeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDguMzI3IDE2NS40NzFhNS44NSA1Ljg1IDAgMCAxLS41NDYuMDAxYy0xLjg5NC0uMDgzLTMuMzAyLTEuMDM4LTMuMTQ1LTIuMTMyYTIuNjkzIDIuNjkzIDAgMCAwLS4wNzItMS4xMDVsLTgxLjEwMyA0Ni44MjJjLjYyOC4wNTggMS4yNzIuMDczIDEuOTE4LjA0Mi4xODItLjAwOS4zNjQtLjAwOS41NDYtLjAwMSAxLjg5NC4wODMgMy4zMDIgMS4wMzggMy4xNDUgMi4xMzJsNzkuMjU3LTQ1Ljc1OScgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OS4wNyAyMTEuMzQ3YS4xMTguMTE4IDAgMCAxLS4xMTUtLjEzNGMuMDQ1LS4zMTctLjA1Ny0uNjM3LS4yOTctLjkyNS0uNTA1LS42MS0xLjU1NS0xLjAyMi0yLjczOC0xLjA3NGE1Ljk2NiA1Ljk2NiAwIDAgMC0uNTM1LjAwMSAxNC4wMyAxNC4wMyAwIDAgMS0xLjkzNS0uMDQxLjExNy4xMTcgMCAwIDEtLjEwMy0uMDkyLjExNi4xMTYgMCAwIDEgLjA1NS0uMTI2bDgxLjEwNC00Ni44MjJhLjExNy4xMTcgMCAwIDEgLjE3MS4wN2MuMTA0LjM4MS4xMjkuNzY4LjA3NCAxLjE1My0uMDQ1LjMxNi4wNTcuNjM3LjI5Ni45MjUuNTA2LjYxIDEuNTU1IDEuMDIxIDIuNzM5IDEuMDczLjE3OC4wMDguMzU3LjAwOC41MzUtLjAwMWEuMTE3LjExNyAwIDAgMSAuMDY0LjIxOGwtNzkuMjU2IDQ1Ljc1OWEuMTE0LjExNCAwIDAgMS0uMDU5LjAxNnptLTMuNDA1LTIuMzcyYy4wODkgMCAuMTc3LjAwMi4yNjUuMDA2IDEuMjY2LjA1NiAyLjM1My40ODggMi45MDggMS4xNTguMjI3LjI3NC4zNS41NzUuMzYuODgybDc4LjY4NS00NS40MjljLS4wMzYgMC0uMDcyLS4wMDEtLjEwNy0uMDAzLTEuMjY3LS4wNTYtMi4zNTQtLjQ4OS0yLjkwOS0xLjE1OC0uMjgyLS4zNC0uNDAyLS43MjQtLjM0Ny0xLjEwN2EyLjYwNCAyLjYwNCAwIDAgMC0uMDMyLS45MUw2My44NDYgMjA4Ljk3YTEzLjkxIDEzLjkxIDAgMCAwIDEuNTI4LjAxMmMuMDk3LS4wMDUuMTk0LS4wMDcuMjkxLS4wMDd6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTIuMjA4IDE2Mi4xMzRjLTEuMDAxLTEuODI3LS4yNDEtNC4yMTcgMS42OTgtNS4zMzdsNTYuMDExLTMyLjM0NGMxLjkzOS0xLjEyIDQuMzI0LS41NDYgNS4zMjYgMS4yODFsLjIzMi40MWE5LjM0NCA5LjM0NCAwIDAgMCAxLjQ3IDIuMDIxbC4yNzguMjdjMy4zMjUgMy4yMTQgOC41ODMgMy43MTYgMTIuODg4IDEuMjNsNy4zMTktNC4yMmMxLjk0LTEuMTE5IDQuMzI0LS41NDYgNS4zMjUgMS4yODJsMy4yNSA1LjkyOC04My41MTkgNDguMjI5LTEwLjI3OC0xOC43NXonIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTIuNDg2IDE4MS4wMDFhLjExMi4xMTIgMCAwIDEtLjAzMS0uMDA1LjExNC4xMTQgMCAwIDEtLjA3MS0uMDU2TDIuMTA2IDE2Mi4xOWMtMS4wMzEtMS44OC0uMjQ5LTQuMzQ1IDEuNzQyLTUuNDk0bDU2LjAxLTMyLjM0NGE0LjMyOCA0LjMyOCAwIDAgMSAyLjE1OC0uNTg4YzEuNDE1IDAgMi42NS43MDIgMy4zMTEgMS44ODIuMDEuMDA4LjAxOC4wMTcuMDI0LjAyOGwuMjI3LjQxNGEuMTIyLjEyMiAwIDAgMSAuMDEzLjAzOCA5LjUwOCA5LjUwOCAwIDAgMCAxLjQzOSAxLjk1OWwuMjc1LjI2NmMxLjg0NiAxLjc4NiA0LjM0NCAyLjc2OSA3LjAzMSAyLjc2OSAxLjk3NyAwIDMuOTU0LS41MzggNS43MTctMS41NTdhLjE0OC4xNDggMCAwIDEgLjAzNS0uMDEzbDcuMjg0LTQuMjA2YTQuMzIxIDQuMzIxIDAgMCAxIDIuMTU3LS41ODhjMS40MjcgMCAyLjY3Mi43MTYgMy4zMjkgMS45MTRsMy4yNDkgNS45MjlhLjExNi4xMTYgMCAwIDEtLjA0NC4xNTdsLTgzLjUxOCA0OC4yMjlhLjExNi4xMTYgMCAwIDEtLjA1OS4wMTZ6bTQ5LjUzLTU3LjAwNGMtLjcwNCAwLTEuNDEuMTkzLTIuMDQxLjU1N2wtNTYuMDEgMzIuMzQ1Yy0xLjg4MiAxLjA4Ni0yLjYyNCAzLjQwOS0xLjY1NSA1LjE3OWwxMC4yMjEgMTguNjQ1IDgzLjMxNy00OC4xMTItMy4xOTUtNS44MjljLS42MTUtMS4xMjItMS43ODMtMS43OTItMy4xMjQtMS43OTJhNC4wOCA0LjA4IDAgMCAwLTIuMDQuNTU3bC03LjMxNyA0LjIyNWEuMTQ4LjE0OCAwIDAgMS0uMDM1LjAxMyAxMS43IDExLjcgMCAwIDEtNS44MDEgMS41NjljLTIuNzQ4IDAtNS4zMDMtMS4wMDctNy4xOTQtMi44MzVsLS4yNzgtLjI3YTkuNzE2IDkuNzE2IDAgMCAxLTEuNDk3LTIuMDQ2LjA5Ni4wOTYgMCAwIDEtLjAxMy0uMDM3bC0uMTkxLS4zNDdhLjExLjExIDAgMCAxLS4wMjMtLjAyOWMtLjYxNS0xLjEyMy0xLjc4My0xLjc5My0zLjEyNC0xLjc5M3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNDIuNDM0IDE1NS44MDhjLTIuNTEtLjAwMS00LjY5Ny0xLjI1OC01Ljg1Mi0zLjM2NS0xLjgxMS0zLjMwNC0uNDM4LTcuNjM0IDMuMDU5LTkuNjU0bDEyLjI5MS03LjA5OGE3LjU5OSA3LjU5OSAwIDAgMSAzLjc4OS0xLjAzM2MyLjUxIDAgNC42OTcgMS4yNTggNS44NTIgMy4zNjUgMS44MTEgMy4zMDQuNDM5IDcuNjM0LTMuMDU5IDkuNjU0bC0xMi4yOTEgNy4wOThhNy42MDYgNy42MDYgMCAwIDEtMy43ODkgMS4wMzN6bTEzLjI4Ny0yMC42ODNhNy4xMjggNy4xMjggMCAwIDAtMy41NTUuOTcxbC0xMi4yOTEgNy4wOThjLTMuMjc5IDEuODkzLTQuNTczIDUuOTQyLTIuODgzIDkuMDI0IDEuMDcxIDEuOTU1IDMuMTA2IDMuMTIyIDUuNDQyIDMuMTIyYTcuMTMgNy4xMyAwIDAgMCAzLjU1Ni0uOTdsMTIuMjkxLTcuMDk4YzMuMjc5LTEuODkzIDQuNTcyLTUuOTQyIDIuODgzLTkuMDI0LTEuMDcyLTEuOTU1LTMuMTA2LTMuMTIzLTUuNDQzLTMuMTIzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDkuNTg4IDEwOS40MDdsNi43MzcgMy44OXYuODg3YzAgLjE3Ni4wMTMuMzYuMDM3LjU0OS4wMTEuMDgxLjAyLjE2MS4wMjguMjQyLjE0IDEuNDE1Ljk3MyAyLjk5OCAyLjEwNSAzLjk5OWw3LjM5NiA2LjU0NWMuMTc3LjE1Ni4zNTguMjk1LjU0MS40MTUgMS41NzkgMS4wNCAyLjk1LjQ2NiAzLjA2Mi0xLjI4Mi4wNDktLjc4NC4wNTctMS41OTUuMDIzLTIuNDI5bC0uMDAzLS4xNnYtMS4xNTFsMjUuOTg3IDE1LjAwM3Y1NGMwIDEuMDktLjc3IDEuNTMtMS43Mi45ODJsLTQyLjQ3My0yNC41MjNjLS45NS0uNTQ4LTEuNzItMS44NzctMS43Mi0yLjk2NnYtMzQuMDMzJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE5NC41NTMgMTkxLjI1Yy0uMjU3IDAtLjU0LS4wODUtLjgzMS0uMjUzbC00Mi40NzItMjQuNTIxYy0uOTgxLS41NjctMS43NzktMS45NDMtMS43NzktMy4wNjh2LTM0LjAzM2guMjM0djM0LjAzM2MwIDEuMDUxLjc0NSAyLjMzNiAxLjY2MSAyLjg2Nmw0Mi40NzMgMjQuNTIxYy40MjQuMjQ1LjgxNi4yODggMS4xMDMuMTIyLjI4NS0uMTY0LjQ0Mi0uNTIuNDQyLTEuMDAydi01My45MzNsLTI1Ljc1My0xNC44NjguMDAzIDEuMTA2Yy4wMzQuODMyLjAyNiAxLjY1NC0uMDI0IDIuNDM5LS4wNTQuODQ0LS4zOTYgMS40NjQtLjk2MyAxLjc0Ni0uNjE5LjMwOS0xLjQ1LjE3My0yLjI4LS4zNzNhNS4wMjMgNS4wMjMgMCAwIDEtLjU1My0uNDI2bC03LjM5Ny02LjU0NGMtMS4xNTgtMS4wMjYtMS45OTktMi42MjUtMi4xNDMtNC4wNzZhOS42MjQgOS42MjQgMCAwIDAtLjAyNy0uMjM4IDQuMjQxIDQuMjQxIDAgMCAxLS4wMzgtLjU2NHYtLjgybC02LjY4LTMuODU2LjExNy0uMjAyIDYuNzM4IDMuODkuMDU4LjAzNHYuOTU0YzAgLjE3MS4wMTIuMzUxLjAzNi41MzMuMDExLjA4My4wMjEuMTY1LjAyOS4yNDYuMTM4IDEuMzk1Ljk0OCAyLjkzNSAyLjA2NSAzLjkyM2w3LjM5NyA2LjU0NWMuMTczLjE1My4zNS4yODkuNTI3LjQwNi43NTguNDk5IDEuNTA0LjYzIDIuMDQ3LjM1OS40OS0uMjQzLjc4Ni0uNzk1LjgzNC0xLjU1MS4wNS0uNzc4LjA1Ny0xLjU5MS4wMjQtMi40MTdsLS4wMDQtLjE2M3YtMS4zNTVsLjE3NS4xIDI1Ljk4NyAxNS4wMDQuMDU5LjAzM3Y1NC4wNjhjMCAuNTY5LS4xOTguOTk2LS41NTkgMS4yMDRhMS4wMDIgMS4wMDIgMCAwIDEtLjUwNi4xMzEnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ1LjY4NSAxNjMuMTYxbDI0LjExNSAxMy45MjItMjUuOTc4IDE0Ljk5OC0xLjQ2Mi0uMzA3Yy02LjUzNC0yLjE3LTEzLjYyOC0zLjcyOC0yMS4wMTktNC42MTYtNC4zNjUtLjUyNC04LjY2MyAxLjA5Ni05LjU5OCAzLjYyYTIuNzQ2IDIuNzQ2IDAgMCAwLS4wMTEgMS45MjhjMS41MzggNC4yNjcgNC4yMzYgOC4zNjMgNy45OTUgMTIuMTM1bC41MzIuODQ1LTI1Ljk3NyAxNC45OTctMjQuMTE1LTEzLjkyMiA3NS41MTgtNDMuNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J005NC4yODIgMjIwLjgxOGwtLjA1OS0uMDMzLTI0LjI5LTE0LjAyNC4xNzUtLjEwMSA3NS41NzctNDMuNjM0LjA1OC4wMzMgMjQuMjkgMTQuMDI0LTI2LjE5MSAxNS4xMjItLjA0NS0uMDEtMS40NjEtLjMwN2MtNi41NDktMi4xNzQtMTMuNjEzLTMuNzI1LTIxLjAwOS00LjYxNGExMy43NDQgMTMuNzQ0IDAgMCAwLTEuNjM4LS4wOTdjLTMuNzU4IDAtNy4wNTQgMS41MzEtNy44MzcgMy42NDJhMi42MiAyLjYyIDAgMCAwLS4wMSAxLjg0OGMxLjUzNSA0LjI1OCA0LjIxNiA4LjMyNiA3Ljk2OCAxMi4wOTFsLjAxNi4wMjEuNTI2LjgzNS4wMDYuMDEuMDY0LjEwMi0uMTA1LjA2MS0yNS45NzcgMTQuOTk4LS4wNTguMDMzem0tMjMuODgxLTE0LjA1N2wyMy44ODEgMTMuNzg4IDI0LjgwMi0xNC4zMmMuNTQ2LS4zMTUuODQ2LS40ODkgMS4wMTctLjU3NWwtLjQ2Ni0uNzRjLTMuNzcxLTMuNzg3LTYuNDY3LTcuODgxLTguMDEzLTEyLjE2OGEyLjg1MSAyLjg1MSAwIDAgMSAuMDExLTIuMDA4Yy44MTUtMi4xOTkgNC4yMDMtMy43OTUgOC4wNTYtMy43OTUuNTU3IDAgMS4xMTcuMDMzIDEuNjY2LjA5OSA3LjQxMi44OTEgMTQuNDkxIDIuNDQ1IDIxLjA0MSA0LjYyMS44MzYuMTc1IDEuMjE1LjI1NCAxLjM5LjMwNGwyNS43OC0xNC44ODQtMjMuODgxLTEzLjc4OC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjcuMjMgMTI1Ljk3OXY1MC44NzFsLTI3LjMyMSAxNS43NzMtNi40NjEtMTQuMTY3Yy0uOTEtMS45OTYtMy40MjgtMS43MzgtNS42MjQuNTc0YTEwLjIzOCAxMC4yMzggMCAwIDAtMi4zMyA0LjAxOGwtNi40NiAyMS42MjgtMjcuMzIyIDE1Ljc3NHYtNTAuODcxbDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTkxLjcxMiAyMjAuNTY3YS4xMjcuMTI3IDAgMCAxLS4wNTktLjAxNi4xMTguMTE4IDAgMCAxLS4wNTgtLjEwMXYtNTAuODcxYzAtLjA0Mi4wMjMtLjA4LjA1OC0uMTAxbDc1LjUxOS00My42YS4xMTcuMTE3IDAgMCAxIC4xNzUuMTAxdjUwLjg3MWMwIC4wNDEtLjAyMy4wOC0uMDU5LjFsLTI3LjMyMSAxNS43NzVhLjExOC4xMTggMCAwIDEtLjA5NC4wMS4xMi4xMiAwIDAgMS0uMDcxLS4wNjNsLTYuNDYtMTQuMTY4Yy0uMzc1LS44MjItMS4wNjItMS4yNzUtMS45MzQtMS4yNzUtMS4wODkgMC0yLjM2NC42ODYtMy41IDEuODgxYTEwLjIwNiAxMC4yMDYgMCAwIDAtMi4zMDIgMy45NzJsLTYuNDYgMjEuNjI3YS4xMTguMTE4IDAgMCAxLS4wNTQuMDY4TDkxLjc3IDIyMC41NTFhLjEyLjEyIDAgMCAxLS4wNTguMDE2em0uMTE3LTUwLjkydjUwLjYwMWwyNy4xMDYtMTUuNjUgNi40NDctMjEuNTgzYTEwLjI4NiAxMC4yODYgMCAwIDEgMi4zNTctNC4wNjVjMS4xOC0xLjI0MiAyLjUxNy0xLjk1NCAzLjY2OS0xLjk1NC45NjkgMCAxLjczMS41MDEgMi4xNDYgMS40MTFsNi40MDcgMTQuMDUxIDI3LjE1Mi0xNS42NzZ2LTUwLjYwMWwtNzUuMjg0IDQzLjQ2NnonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTY4LjU0MyAxMjYuMjEzdjUwLjg3bC0yNy4zMjIgMTUuNzc0LTYuNDYtMTQuMTY4Yy0uOTEtMS45OTUtMy40MjgtMS43MzgtNS42MjQuNTc0YTEwLjI0OCAxMC4yNDggMCAwIDAtMi4zMyA0LjAxOWwtNi40NjEgMjEuNjI3LTI3LjMyMSAxNS43NzR2LTUwLjg3bDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTkzLjAyNSAyMjAuOGEuMTIzLjEyMyAwIDAgMS0uMDU5LS4wMTUuMTIuMTIgMCAwIDEtLjA1OC0uMTAxdi01MC44NzFjMC0uMDQyLjAyMy0uMDguMDU4LS4xMDFsNzUuNTE4LTQzLjZhLjExMi4xMTIgMCAwIDEgLjExNyAwYy4wMzYuMDIuMDU5LjA1OS4wNTkuMXY1MC44NzFhLjExNi4xMTYgMCAwIDEtLjA1OS4xMDFsLTI3LjMyMSAxNS43NzRhLjExMS4xMTEgMCAwIDEtLjA5NC4wMS4xMTUuMTE1IDAgMCAxLS4wNzEtLjA2MmwtNi40Ni0xNC4xNjhjLS4zNzUtLjgyMy0xLjA2Mi0xLjI3NS0xLjkzNS0xLjI3NS0xLjA4OCAwLTIuMzYzLjY4NS0zLjQ5OSAxLjg4MWExMC4xOSAxMC4xOSAwIDAgMC0yLjMwMiAzLjk3MWwtNi40NjEgMjEuNjI4YS4xMDguMTA4IDAgMCAxLS4wNTMuMDY3bC0yNy4zMjIgMTUuNzc1YS4xMi4xMiAwIDAgMS0uMDU4LjAxNXptLjExNy01MC45MTl2NTAuNmwyNy4xMDYtMTUuNjQ5IDYuNDQ3LTIxLjU4NGExMC4yOTMgMTAuMjkzIDAgMCAxIDIuMzU3LTQuMDY1YzEuMTc5LTEuMjQxIDIuNTE2LTEuOTU0IDMuNjY4LTEuOTU0Ljk2OSAwIDEuNzMyLjUwMiAyLjE0NyAxLjQxMmw2LjQwNyAxNC4wNTEgMjcuMTUyLTE1LjY3NnYtNTAuNjAxbC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjkuOCAxNzcuMDgzbC0yNy4zMjIgMTUuNzc0LTYuNDYtMTQuMTY4Yy0uOTEtMS45OTUtMy40MjgtMS43MzgtNS42MjUuNTc0YTEwLjI0NiAxMC4yNDYgMCAwIDAtMi4zMjkgNC4wMTlsLTYuNDYxIDIxLjYyNy0yNy4zMjEgMTUuNzc0di01MC44N2w3NS41MTgtNDMuNnY1MC44N3onIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNOTQuMjgyIDIyMC45MTdhLjIzNC4yMzQgMCAwIDEtLjIzNC0uMjMzdi01MC44NzFjMC0uMDgzLjA0NS0uMTYxLjExNy0uMjAybDc1LjUxOC00My42MDFhLjIzNC4yMzQgMCAxIDEgLjM1LjIwMnY1MC44NzFhLjIzMy4yMzMgMCAwIDEtLjExNi4yMDJsLTI3LjMyMiAxNS43NzVhLjIzMi4yMzIgMCAwIDEtLjMyOS0uMTA2bC02LjQ2MS0xNC4xNjhjLS4zNi0uNzg5LS45OTItMS4yMDYtMS44MjgtMS4yMDYtMS4wNTYgMC0yLjMwMS42NzItMy40MTUgMS44NDRhMTAuMDk5IDEwLjA5OSAwIDAgMC0yLjI3NSAzLjkyNGwtNi40NiAyMS42MjhhLjIzNS4yMzUgMCAwIDEtLjEwNy4xMzZsLTI3LjMyMiAxNS43NzRhLjIzLjIzIDAgMCAxLS4xMTYuMDMxem0uMjMzLTUwLjk2OXY1MC4zMzFsMjYuODkxLTE1LjUyNSA2LjQzNC0yMS41MzlhMTAuNDEgMTAuNDEgMCAwIDEgMi4zODQtNC4xMTJjMS4yMDEtMS4yNjUgMi41NjktMS45OTEgMy43NTMtMS45OTEgMS4wMTggMCAxLjgxOC41MjYgMi4yNTMgMS40OGw2LjM1NCAxMy45MzQgMjYuOTgyLTE1LjU3OHYtNTAuMzMxbC03NS4wNTEgNDMuMzMxeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMDkuODk0IDE5OS45NDNjLTEuNzc0IDAtMy4yNDEtLjcyNS00LjI0NC0yLjEyYS4yMjQuMjI0IDAgMCAxIC4wMjMtLjI5NC4yMzMuMjMzIDAgMCAxIC4zMDEtLjAyM2MuNzguNTQ3IDEuNzA1LjgyNyAyLjc1LjgyNyAxLjMyMyAwIDIuNzU0LS40MzkgNC4yNTYtMS4zMDYgNS4zMTEtMy4wNjcgOS42MzEtMTAuNTE4IDkuNjMxLTE2LjYxMSAwLTEuOTI3LS40NDItMy41Ni0xLjI3OC00LjcyNGEuMjMyLjIzMiAwIDAgMSAuMzIzLS4zMjdjMS42NzEgMS4xNzIgMi41OTEgMy4zODEgMi41OTEgNi4yMTkgMCA2LjI0Mi00LjQyNiAxMy44NjMtOS44NjUgMTcuMDAzLTEuNTc0LjkwOC0zLjA4NCAxLjM1Ni00LjQ4OCAxLjM1NnptLTIuOTY5LTEuNTQyYy44MTMuNjUxIDEuODIuODc3IDIuOTY4Ljg3N2guMDAxYzEuMzIxIDAgMi43NTMtLjMyNyA0LjI1NC0xLjE5NCA1LjMxMS0zLjA2NyA5LjYzMi0xMC40NjMgOS42MzItMTYuNTU2IDAtMS45NzktLjQ2My0zLjU5OS0xLjMyNi00Ljc2MS40MTEgMS4wMzUuNjI1IDIuMjc1LjYyNSAzLjYzNSAwIDYuMjQzLTQuNDI2IDEzLjg4My05Ljg2NSAxNy4wMjMtMS41NzQuOTA5LTMuMDg0IDEuMzE3LTQuNDkgMS4zMTctLjY0MSAwLTEuMjQzLS4xNDktMS43OTktLjM0MXonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTEzLjA5NyAxOTcuMjNjNS4zODQtMy4xMDggOS43NDgtMTAuNjM2IDkuNzQ4LTE2LjgxNCAwLTIuMDUxLS40ODMtMy42OTItMS4zMjMtNC44Ni0xLjc4NC0xLjI1Mi00LjM3NC0xLjE5NC03LjI1Ny40Ny01LjM4NCAzLjEwOC05Ljc0OCAxMC42MzYtOS43NDggMTYuODE0IDAgMi4wNTEuNDgzIDMuNjkyIDEuMzIzIDQuODYgMS43ODQgMS4yNTIgNC4zNzQgMS4xOTQgNy4yNTctLjQ3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTEwOC43MjQgMTk4LjYxNGMtMS4xNDIgMC0yLjE1OC0uMjEzLTMuMDE5LS44MTctLjAyMS0uMDE0LS4wNC4wMTQtLjA1NS0uMDA3LS44OTQtMS4yNDQtMS4zNjctMi45NDgtMS4zNjctNC45NzMgMC02LjI0MiA0LjQyNi0xMy44NjQgOS44NjUtMTcuMDA1IDEuNTc0LS45MDggMy4wODQtMS4zNjMgNC40OS0xLjM2MyAxLjE0MiAwIDIuMTU4LjMwOSAzLjAxOC45MTNhLjIzLjIzIDAgMCAxIC4wNTYuMDU2Yy44OTQgMS4yNDQgMS4zNjcgMi45NzIgMS4zNjcgNC45OTcgMCA2LjI0My00LjQyNiAxMy43ODMtOS44NjUgMTYuOTIzLTEuNTc0LjkwOS0zLjA4NCAxLjI3Ni00LjQ5IDEuMjc2em0tMi43MTgtMS4xMDljLjc3NC41MzIgMS42ODguNzc2IDIuNzE4Ljc3NiAxLjMyMyAwIDIuNzU0LS40MTMgNC4yNTYtMS4yOCA1LjMxMS0zLjA2NiA5LjYzMS0xMC41MDUgOS42MzEtMTYuNTk4IDAtMS45MDktLjQzNC0zLjUyMy0xLjI1NS00LjY4NS0uNzc0LS41MzMtMS42ODgtLjc5OS0yLjcxOC0uNzk5LTEuMzIzIDAtMi43NTUuNDQxLTQuMjU2IDEuMzA4LTUuMzExIDMuMDY2LTkuNjMxIDEwLjUwNi05LjYzMSAxNi41OTkgMCAxLjkwOS40MzQgMy41MTcgMS4yNTUgNC42Nzl6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OS4zMTggMTE0LjI2MmwtOS45ODQgOC44NzggMTUuODkzIDExLjAzMSA1LjU4OS02LjExMi0xMS40OTgtMTMuNzk3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE2OS42NzYgMTIwLjg0bC05Ljc0OCA1LjYyN2MtMy42NDIgMi4xMDMtOS41MjggMi4xMTMtMTMuMTQ3LjAyNC0zLjYyLTIuMDg5LTMuNjAxLTUuNDg4LjA0MS03LjU5MWw5LjQ5NS01LjYwOC02LjcyOS0zLjg4NS04MS44MzYgNDcuMDcxIDQ1LjkyMyAyNi41MTQgMy4wODEtMS43NzljLjYzMS0uMzY1Ljg2OS0uODk4LjYxOC0xLjM5LTIuMzU3LTQuNjMyLTIuNTkzLTkuNTQ2LS42ODMtMTQuMjYyIDUuNjM4LTEzLjkyIDI0LjUwOS0yNC44MTUgNDguNjE4LTI4LjA3IDguMTY5LTEuMTAzIDE2LjY4LS45NjcgMjQuNzA0LjM5NC44NTIuMTQ1IDEuNzc2LjAwOCAyLjQwNy0uMzU3bDMuMDgxLTEuNzc4LTI1LjgyNS0xNC45MScgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xMTMuNjc1IDE4My40NTlhLjQ3LjQ3IDAgMCAxLS4yMzMtLjA2MmwtNDUuOTI0LTI2LjUxNWEuNDY4LjQ2OCAwIDAgMSAuMDAxLS44MDlsODEuODM2LTQ3LjA3MWEuNDY3LjQ2NyAwIDAgMSAuNDY2IDBsNi43MjkgMy44ODVhLjQ2Ny40NjcgMCAwIDEtLjQ2Ny44MDlsLTYuNDk2LTMuNzUtODAuOSA0Ni41MzMgNDQuOTg4IDI1Ljk3MyAyLjg0OC0xLjY0NGMuMTkyLS4xMTEuNjItLjQwOS40MzUtLjc3My0yLjQxNi00Ljc0OC0yLjY1OC05LjgxNC0uNy0xNC42NSAyLjgwNi02LjkyNyA4Ljg4NS0xMy4yNDIgMTcuNTgyLTE4LjI2MyA4LjY1Ny00Ljk5OCAxOS41MTgtOC40ODkgMzEuNDA3LTEwLjA5NCA4LjE5OC0xLjEwNyAxNi43OS0uOTcgMjQuODQ0LjM5Ny43MzkuMTI1IDEuNTYxLjAwNyAyLjA5NS0uMzAxbDIuMzgxLTEuMzc0LTI1LjEyNS0xNC41MDZhLjQ2Ny40NjcgMCAwIDEgLjQ2Ny0uODA5bDI1LjgyNSAxNC45MWEuNDY3LjQ2NyAwIDAgMSAwIC44MDlsLTMuMDgxIDEuNzc5Yy0uNzIxLjQxNy0xLjc2My41NzUtMi43MTguNDEzLTcuOTYzLTEuMzUxLTE2LjQ1Ny0xLjQ4Ni0yNC41NjMtLjM5Mi0xMS43NyAxLjU4OS0yMi41MTIgNS4wMzktMzEuMDY1IDkuOTc3LTguNTE0IDQuOTE2LTE0LjQ1NiAxMS4wNzMtMTcuMTgzIDE3LjgwNS0xLjg1NCA0LjU3OC0xLjYyMyA5LjM3Ni42NjYgMTMuODc1LjM3LjcyNS4wNTUgMS41MTMtLjggMi4wMDZsLTMuMDgxIDEuNzhhLjQ3Ni40NzYgMCAwIDEtLjIzNC4wNjInIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNMTUzLjMxNiAxMjguMjc5Yy0yLjQxMyAwLTQuODIxLS41MjgtNi42NTItMS41ODYtMS44MTgtMS4wNDktMi44Mi0yLjQ2MS0yLjgyLTMuOTc1IDAtMS41MjcgMS4wMTYtMi45NTUgMi44NjEtNC4wMmw5LjQ5My01LjYwN2EuMjMzLjIzMyAwIDEgMSAuMjM4LjQwMmwtOS40OTYgNS42MDljLTEuNjk2Ljk3OS0yLjYyOCAyLjI2My0yLjYyOCAzLjYxNiAwIDEuMzQuOTE4IDIuNjA4IDIuNTg1IDMuNTcxIDMuNTQ5IDIuMDQ5IDkuMzQzIDIuMDM4IDEyLjkxNC0uMDI0bDkuNzQ4LTUuNjI4YS4yMzQuMjM0IDAgMCAxIC4yMzQuNDA1bC05Ljc0OCA1LjYyOGMtMS44NTggMS4wNzItNC4yOTYgMS42MDktNi43MjkgMS42MDknIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTEzLjY3NSAxODIuOTkybC00NS45MTMtMjYuNTA4TTExMy42NzUgMTgzLjM0MmEuMzQ2LjM0NiAwIDAgMS0uMTc1LS4wNDdsLTQ1LjkxMy0yNi41MDhhLjM1LjM1IDAgMSAxIC4zNS0uNjA3bDQ1LjkxMyAyNi41MDhhLjM1LjM1IDAgMCAxLS4xNzUuNjU0JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTY3Ljc2MiAxNTYuNDg0djU0LjAwMWMwIDEuMDkuNzcgMi40MTggMS43MiAyLjk2N2w0Mi40NzMgMjQuNTIxYy45NS41NDkgMS43Mi4xMSAxLjcyLS45OHYtNTQuMDAxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTExMi43MjcgMjM4LjU2MWMtLjI5NyAwLS42Mi0uMDk1LS45NDctLjI4NWwtNDIuNDczLTI0LjUyMWMtMS4wNjMtLjYxMy0xLjg5NS0yLjA1LTEuODk1LTMuMjd2LTU0LjAwMWEuMzUuMzUgMCAxIDEgLjcwMSAwdjU0LjAwMWMwIC45Ni43MDcgMi4xOCAxLjU0NCAyLjY2M2w0Mi40NzMgMjQuNTIyYy4zNDQuMTk4LjY2MS4yNDMuODcuMTIyLjIwNi0uMTE5LjMyNS0uNDExLjMyNS0uNzk5di01NC4wMDFhLjM1LjM1IDAgMSAxIC43IDB2NTQuMDAxYzAgLjY1NS0uMjM5IDEuMTU0LS42NzUgMS40MDZhMS4yMzUgMS4yMzUgMCAwIDEtLjYyMy4xNjInIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNMTEyLjg2IDE0Ny41MTJoLS4wMDFjLTIuMzE4IDAtNC40OTktLjUyMi02LjE0Mi0xLjQ3MS0xLjcwNS0uOTg0LTIuNjQzLTIuMzE1LTIuNjQzLTMuNzQ5IDAtMS40NDUuOTUyLTIuNzkxIDIuNjgtMy43ODhsMTIuMDQxLTYuOTUzYzEuNjY4LS45NjIgMy44NzQtMS40OTMgNi4yMTItMS40OTMgMi4zMTggMCA0LjQ5OS41MjMgNi4xNDMgMS40NzIgMS43MDQuOTg0IDIuNjQzIDIuMzE1IDIuNjQzIDMuNzQ4IDAgMS40NDYtLjk1MiAyLjc5MS0yLjY4IDMuNzg5bC0xMi4wNDIgNi45NTJjLTEuNjY4Ljk2My0zLjg3NCAxLjQ5My02LjIxMSAxLjQ5M3ptMTIuMTQ3LTE2Ljc1M2MtMi4yMTcgMC00LjI5OC40OTctNS44NjEgMS4zOTlsLTEyLjA0MiA2Ljk1MmMtMS41MDIuODY4LTIuMzMgMS45OTgtMi4zMyAzLjE4MiAwIDEuMTczLjgxNSAyLjI4OSAyLjI5MyAzLjE0MiAxLjUzOC44ODkgMy41OTYgMS4zNzggNS43OTIgMS4zNzhoLjAwMWMyLjIxNiAwIDQuMjk4LS40OTcgNS44NjEtMS4zOTlsMTIuMDQxLTYuOTUzYzEuNTAyLS44NjcgMi4zMy0xLjk5NyAyLjMzLTMuMTgyIDAtMS4xNzItLjgxNC0yLjI4OC0yLjI5Mi0zLjE0Mi0xLjUzOS0uODg4LTMuNTk2LTEuMzc3LTUuNzkzLTEuMzc3eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjUuNjMgMTIzLjIxOWwtNS43MzQgMy4zMTFjLTMuMTY3IDEuODI4LTguMjg2IDEuODM3LTExLjQzMy4wMi0zLjE0Ny0xLjgxNy0zLjEzMS00Ljc3Mi4wMzYtNi42MDFsNS43MzQtMy4zMSAxMS4zOTcgNi41OCcgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xNTQuMjMzIDExNy40NDhsOS45OTUgNS43NzEtNC42ODIgMi43MDRjLTEuNDM0LjgyNy0zLjM1MiAxLjI4My01LjM5OSAxLjI4My0yLjAyOSAwLTMuOTIzLS40NDktNS4zMzMtMS4yNjMtMS4yOS0uNzQ0LTItMS42OTQtMi0yLjY3NCAwLS45OTEuNzIzLTEuOTU1IDIuMDM2LTIuNzEzbDUuMzgzLTMuMTA4bTAtLjgwOWwtNS43MzQgMy4zMWMtMy4xNjcgMS44MjktMy4xODMgNC43ODQtLjAzNiA2LjYwMSAxLjU2OC45MDUgMy42MjMgMS4zNTcgNS42ODQgMS4zNTcgMi4wNzcgMCA0LjE1OS0uNDYgNS43NDktMS4zNzdsNS43MzQtMy4zMTEtMTEuMzk3LTYuNThNMTQ1LjQ0NSAxNzkuNjY3Yy0xLjc3MyAwLTMuMjQxLS44NS00LjI0My0yLjI0NS0uMDY3LS4wOTItLjA1Ny0uMjc1LjAyMy0uMzU2LjA4LS4wODEuMjA3LS4xMi4zLS4wNTUuNzgxLjU0OCAxLjcwNi44MTIgMi43NTEuODExIDEuMzIyIDAgMi43NTQtLjQ0NiA0LjI1Ni0xLjMxMyA1LjMxLTMuMDY2IDkuNjMxLTEwLjUyMiA5LjYzMS0xNi42MTUgMC0xLjkyNy0uNDQyLTMuNTYyLTEuMjc5LTQuNzI2YS4yMzUuMjM1IDAgMCAxIC4wMjQtLjMwMS4yMzIuMjMyIDAgMCAxIC4zLS4wMjdjMS42NyAxLjE3MiAyLjU5IDMuMzggMi41OSA2LjIxOSAwIDYuMjQyLTQuNDI1IDEzLjk4Ny05Ljg2NSAxNy4xMjctMS41NzMuOTA4LTMuMDgzIDEuNDgxLTQuNDg4IDEuNDgxek0xNDIuNDc2IDE3OGMuODE0LjY1MSAxLjgyIDEuMDAyIDIuOTY5IDEuMDAyIDEuMzIyIDAgMi43NTMtLjQ1MiA0LjI1NS0xLjMyIDUuMzEtMy4wNjUgOS42MzEtMTAuNTIzIDkuNjMxLTE2LjYxNyAwLTEuOTgtLjQ2My0zLjYzLTEuMzI1LTQuNzkzLjQxMSAxLjAzNS42MjQgMi4yNi42MjQgMy42MiAwIDYuMjQyLTQuNDI1IDEzLjg3NS05Ljg2NSAxNy4wMTUtMS41NzMuOTA5LTMuMDg0IDEuMzc2LTQuNDg5IDEuMzc2YTUuNDkgNS40OSAwIDAgMS0xLjgtLjI4M3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ4LjY0OCAxNzYuNzA0YzUuMzg0LTMuMTA4IDkuNzQ4LTEwLjYzNiA5Ljc0OC0xNi44MTMgMC0yLjA1Mi0uNDgzLTMuNjkzLTEuMzIyLTQuODYxLTEuNzg1LTEuMjUyLTQuMzc1LTEuMTk0LTcuMjU4LjQ3MS01LjM4MyAzLjEwOC05Ljc0OCAxMC42MzYtOS43NDggMTYuODEzIDAgMi4wNTEuNDg0IDMuNjkyIDEuMzIzIDQuODYgMS43ODUgMS4yNTMgNC4zNzQgMS4xOTUgNy4yNTctLjQ3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE0NC4yNzYgMTc4LjI3NmMtMS4xNDMgMC0yLjE1OC0uMzA3LTMuMDE5LS45MTFhLjIxNy4yMTcgMCAwIDEtLjA1NS0uMDU0Yy0uODk1LTEuMjQ0LTEuMzY3LTIuOTcyLTEuMzY3LTQuOTk3IDAtNi4yNDEgNC40MjUtMTMuODc1IDkuODY1LTE3LjAxNiAxLjU3My0uOTA4IDMuMDg0LTEuMzY5IDQuNDg5LTEuMzY5IDEuMTQzIDAgMi4xNTguMzA3IDMuMDE5LjkxYS4yNC4yNCAwIDAgMSAuMDU1LjA1NWMuODk0IDEuMjQ0IDEuMzY3IDIuOTcxIDEuMzY3IDQuOTk3IDAgNi4yNDEtNC40MjUgMTMuODc1LTkuODY1IDE3LjAxNi0xLjU3My45MDgtMy4wODQgMS4zNjktNC40ODkgMS4zNjl6bS0yLjcxOC0xLjE3MmMuNzczLjUzMyAxLjY4Ny45MDEgMi43MTguOTAxIDEuMzIyIDAgMi43NTQtLjUzOCA0LjI1Ni0xLjQwNSA1LjMxLTMuMDY2IDkuNjMxLTEwLjU2NyA5LjYzMS0xNi42NjEgMC0xLjkwOC0uNDM0LTMuNTU0LTEuMjU2LTQuNzE2LS43NzQtLjUzMi0xLjY4OC0uODE0LTIuNzE4LS44MTQtMS4zMjIgMC0yLjc1NC40MzMtNC4yNTYgMS4zLTUuMzEgMy4wNjYtOS42MzEgMTAuNTY0LTkuNjMxIDE2LjY1NyAwIDEuOTEuNDM0IDMuNTc2IDEuMjU2IDQuNzM4eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNTAuNzIgMTcyLjM2MWwtLjM2My0uMjk1YTI0LjEwNSAyNC4xMDUgMCAwIDAgMi4xNDgtMy4xMjggMjQuMDUgMjQuMDUgMCAwIDAgMS45NzctNC4zNzVsLjQ0My4xNDlhMjQuNTQgMjQuNTQgMCAwIDEtMi4wMTUgNC40NiAyNC42MSAyNC42MSAwIDAgMS0yLjE5IDMuMTg5TTExNS45MTcgMTkxLjUxNGwtLjM2My0uMjk0YTI0LjE3NCAyNC4xNzQgMCAwIDAgMi4xNDgtMy4xMjggMjQuMDM4IDI0LjAzOCAwIDAgMCAxLjk3Ni00LjM3NWwuNDQzLjE0OGEyNC40OCAyNC40OCAwIDAgMS0yLjAxNSA0LjQ2MSAyNC42NjIgMjQuNjYyIDAgMCAxLTIuMTg5IDMuMTg4TTExNCAyMzcuNDc2VjE4Mi41ODQgMjM3LjQ3NicgZmlsbD0nIzYwN0Q4QicvPjxnPjxwYXRoIGQ9J004MS44MjIgMzcuNDc0Yy4wMTctLjEzNS0uMDc1LS4yOC0uMjY3LS4zOTItLjMyNy0uMTg4LS44MjYtLjIxLTEuMTA5LS4wNDVsLTYuMDEyIDMuNDcxYy0uMTMxLjA3Ni0uMTk0LjE3OC0uMTkxLjI4NS4wMDIuMTMyLjAwMi40NjEuMDAyLjU3OHYuMDQzbC0uMDA3LjEyOC02LjU5MSAzLjc3OWMtLjAwMSAwLTIuMDc3IDEuMDQ2LTIuNzg3IDUuMTkyIDAgMC0uOTEyIDYuOTYxLS44OTggMTkuNzQ1LjAxNSAxMi41Ny42MDYgMTcuMDcgMS4xNjcgMjEuMzUxLjIyIDEuNjg0IDMuMDAxIDIuMTI1IDMuMDAxIDIuMTI1LjMzMS4wNC42OTgtLjAyNyAxLjA4LS4yNDhsNzUuMjczLTQzLjU1MWMxLjgwOC0xLjA2OSAyLjY2Ny0zLjcxOSAzLjA1Ni02LjI4NCAxLjIxMy03Ljk5IDEuNjc1LTMyLjk3OC0uMjc1LTM5Ljg3OC0uMTk2LS42OTMtLjUxLTEuMDgzLS44NjgtMS4yODJsLTIuMDg2LS43OWMtLjcyNy4wMjgtMS40MTYuNDY3LTEuNTM0LjUzNUw4Mi4wMzIgMzcuMDcybC0uMjEuNDAyJyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTE0NC4zMTEgMS43MDFsMi4wODUuNzljLjM1OC4xOTkuNjcyLjU4OS44NjggMS4yODIgMS45NDkgNi45IDEuNDg3IDMxLjg4Ny4yNzUgMzkuODc4LS4zOSAyLjU2NS0xLjI0OSA1LjIxNS0zLjA1NiA2LjI4NEw2OS4yMSA5My40ODZhMS43OCAxLjc4IDAgMCAxLS44OTYuMjU4bC0uMTgzLS4wMTFjMCAuMDAxLTIuNzgyLS40NC0zLjAwMy0yLjEyNC0uNTYtNC4yODItMS4xNTEtOC43ODEtMS4xNjUtMjEuMzUxLS4wMTUtMTIuNzg0Ljg5Ny0xOS43NDUuODk3LTE5Ljc0NS43MS00LjE0NiAyLjc4Ny01LjE5MiAyLjc4Ny01LjE5Mmw2LjU5MS0zLjc3OS4wMDctLjEyOHYtLjA0M2MwLS4xMTcgMC0uNDQ2LS4wMDItLjU3OC0uMDAzLS4xMDcuMDU5LS4yMS4xOTEtLjI4NWw2LjAxMi0zLjQ3MmEuOTguOTggMCAwIDEgLjQ4MS0uMTFjLjIxOCAwIC40NDkuMDUzLjYyNy4xNTYuMTkzLjExMi4yODUuMjU4LjI2OC4zOTJsLjIxMS0uNDAyIDYwLjc0NC0zNC44MzZjLjExNy0uMDY4LjgwNi0uNTA3IDEuNTM0LS41MzVtMC0uOTk3bC0uMDM5LjAwMWMtLjYxOC4wMjMtMS4yODMuMjQ0LTEuOTc0LjY1NmwtLjAyMS4wMTItNjAuNTE5IDM0LjcwNmEyLjM1OCAyLjM1OCAwIDAgMC0uODMxLS4xNWMtLjM2NSAwLS43MDQuMDg0LS45OC4yNDRsLTYuMDEyIDMuNDcxYy0uNDQyLjI1NS0uNjk5LjY5LS42ODkgMS4xNjZsLjAwMS4xNS02LjA4IDMuNDg3Yy0uMzczLjE5OS0yLjU0MiAxLjUzMS0zLjI5IDUuODk4bC0uMDA2LjAzOWMtLjAwOS4wNy0uOTIgNy4xNzMtLjkwNiAxOS44NzUuMDE0IDEyLjYyLjYwMyAxNy4xMTYgMS4xNzIgMjEuNDY1bC4wMDIuMDE1Yy4zMDggMi4zNTUgMy40NzUgMi45MjMgMy44MzYgMi45OGwuMDM0LjAwNGMuMTAxLjAxMy4yMDQuMDE5LjMwNS4wMTlhMi43NyAyLjc3IDAgMCAwIDEuMzk2LS4zOTJsNzUuMjczLTQzLjU1MmMxLjgxMS0xLjA3MSAyLjk5OS0zLjQyMyAzLjU0Mi02Ljk5NyAxLjE4Ni03LjgxNCAxLjczNC0zMy4wOTYtLjMwMS00MC4yOTktLjI1My0uODkzLS43MDQtMS41MjctMS4zNDMtMS44ODJsLS4xMzItLjA2Mi0yLjA4NS0uNzg5YS45NzMuOTczIDAgMCAwLS4zNTMtLjA2NScgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xMjguMjY3IDExLjU2NWwxLjQ5NS40MzQtNTYuMzM5IDMyLjMyNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J003NC4yMDIgOTAuNTQ1YS41LjUgMCAwIDEtLjI1LS45MzFsMTguNDM3LTEwLjY0NWEuNDk5LjQ5OSAwIDEgMSAuNDk5Ljg2NEw3NC40NTEgOTAuNDc4bC0uMjQ5LjA2N003NS43NjQgNDIuNjU0bC0uMTA4LS4wNjIuMDQ2LS4xNzEgNS4xMzUtMi45NjQuMTcuMDQ1LS4wNDUuMTcxLTUuMTM1IDIuOTY0LS4wNjMuMDE3TTcwLjUyIDkwLjM3NVY0Ni40MjFsLjA2My0uMDM2TDEzNy44NCA3LjU1NHY0My45NTRsLS4wNjIuMDM2TDcwLjUyIDkwLjM3NXptLjI1LTQzLjgxMXY0My4zOGw2Ni44MjEtMzguNTc5VjcuOTg1TDcwLjc3IDQ2LjU2NHonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNODYuOTg2IDgzLjE4MmMtLjIzLjE0OS0uNjEyLjM4NC0uODQ5LjUyM2wtMTEuNTA1IDYuNzAxYy0uMjM3LjEzOS0uMjA2LjI1Mi4wNjguMjUyaC41NjVjLjI3NSAwIC42OTMtLjExMy45My0uMjUyTDg3LjcgODMuNzA1Yy4yMzctLjEzOS40MjgtLjI1My40MjUtLjI1NmExMS4yOSAxMS4yOSAwIDAgMS0uMDA2LS41MDNjMC0uMjc0LS4xODgtLjM3Ny0uNDE4LS4yMjdsLS43MTUuNDYzJyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTc1LjI2NiA5MC43ODJINzQuN2MtLjIgMC0uMzE2LS4wNTYtLjM0Ni0uMTY2LS4wMy0uMTEuMDQzLS4yMTcuMjE1LS4zMTdsMTEuNTA1LTYuNzAyYy4yMzYtLjEzOC42MTUtLjM3MS44NDQtLjUxOWwuNzE1LS40NjRhLjQ4OC40ODggMCAwIDEgLjI2Ni0uMDg5Yy4xNzIgMCAuMzQ1LjEzLjM0NS40MjEgMCAuMjE0LjAwMS4zNjMuMDAzLjQzN2wuMDA2LjAwNC0uMDA0LjA2OWMtLjAwMy4wNzUtLjAwMy4wNzUtLjQ4Ni4zNTZsLTExLjUwNSA2LjcwMmEyLjI4MiAyLjI4MiAwIDAgMS0uOTkyLjI2OHptLS42LS4yNWwuMDM0LjAwMWguNTY2Yy4yNTIgMCAuNjQ5LS4xMDguODY2LS4yMzRsMTEuNTA1LTYuNzAyYy4xNjgtLjA5OC4yOTQtLjE3My4zNjEtLjIxNC0uMDA0LS4wODQtLjAwNC0uMjE4LS4wMDQtLjQzN2wtLjA5NS0uMTcxLS4xMzEuMDQ5LS43MTQuNDYzYy0uMjMyLjE1LS42MTYuMzg2LS44NTQuNTI1bC0xMS41MDUgNi43MDItLjAyOS4wMTh6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTc1LjI2NiA4OS44NzFINzQuN2MtLjIgMC0uMzE2LS4wNTYtLjM0Ni0uMTY2LS4wMy0uMTEuMDQzLS4yMTcuMjE1LS4zMTdsMTEuNTA1LTYuNzAyYy4yNTgtLjE1MS42OTQtLjI2OC45OTMtLjI2OGguNTY1Yy4yIDAgLjMxNi4wNTYuMzQ2LjE2Ni4wMy4xMS0uMDQzLjIxNy0uMjE1LjMxN2wtMTEuNTA1IDYuNzAyYTIuMjgyIDIuMjgyIDAgMCAxLS45OTIuMjY4em0tLjYtLjI1bC4wMzQuMDAxaC41NjZjLjI1MiAwIC42NDktLjEwNy44NjYtLjIzNGwxMS41MDUtNi43MDIuMDMtLjAxOC0uMDM1LS4wMDFoLS41NjVjLS4yNTIgMC0uNjQ5LjEwOC0uODY3LjIzNGwtMTEuNTA1IDYuNzAyLS4wMjkuMDE4ek03NC4zNyA5MC44MDF2LTEuMjQ3IDEuMjQ3JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTY4LjEzIDkzLjkwMWMtLjc1MS0uMDkzLTEuMzE0LS43MzctMS40MzktMS4zNzYtLjgzMS00LjIzOC0xLjE1MS04Ljc4Mi0xLjE2NS0yMS4zNTItLjAxNS0xMi43ODQuODk3LTE5Ljc0NS44OTctMTkuNzQ1LjcxMS00LjE0NiAyLjc4Ny01LjE5MiAyLjc4Ny01LjE5Mmw3NC44NTktNDMuMjE5Yy4yMjMtLjEyOSAyLjQ4Ny0xLjU4NCAzLjE5NS45MjMgMS45NSA2LjkgMS40ODggMzEuODg3LjI3NSAzOS44NzgtLjM4OSAyLjU2NS0xLjI0OCA1LjIxNS0zLjA1NiA2LjI4M0w2OS4yMSA5My42NTNjLS4zODIuMjIxLS43NDkuMjg4LTEuMDguMjQ4IDAgMC0yLjc4MS0uNDQxLTMuMDAxLTIuMTI1LS41NjEtNC4yODEtMS4xNTItOC43ODEtMS4xNjctMjEuMzUxLS4wMTQtMTIuNzg0Ljg5OC0xOS43NDUuODk4LTE5Ljc0NS43MS00LjE0NiAyLjc4Ny01LjE5MSAyLjc4Ny01LjE5MWw2LjU5OC0zLjgxLjg3MS0uMTE5IDYuNTk5LTMuODMuMDQ2LS40NjFMNjguMTMgOTMuOTAxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTY4LjMxNyA5NC4xNjFsLS4yMTUtLjAxM2gtLjAwMWwtLjI0NC0uMDQ3Yy0uNzE5LS4xNTYtMi43NzItLjczNi0yLjk3Ni0yLjI5Mi0uNTY4LTQuMzQtMS4xNTQtOC44MTMtMS4xNjgtMjEuMzg0LS4wMTQtMTIuNjU0Ljg5MS0xOS43MDcuOS0xOS43NzcuNzI1LTQuMjMxIDIuODMyLTUuMzM4IDIuOTIyLTUuMzgybDYuNjI4LTMuODI3Ljg3LS4xMTkgNi40NDYtMy43NDIuMDM0LS4zMzRhLjI0OC4yNDggMCAwIDEgLjI3My0uMjIzLjI0OC4yNDggMCAwIDEgLjIyMy4yNzJsLS4wNTkuNTg5LTYuNzUyIDMuOTE5LS44Ny4xMTgtNi41NTYgMy43ODVjLS4wMzEuMDE2LTEuOTkgMS4wNjgtMi42NjYgNS4wMTgtLjAwNy4wNi0uOTA4IDcuMDg2LS44OTQgMTkuNzAyLjAxNCAxMi41MzkuNTk3IDE2Ljk5NiAxLjE2MSAyMS4zMDUuMDkxLjY5MS42ODkgMS4xNTQgMS4zMDkgMS40NTJhMS45NSAxLjk1IDAgMCAxLS4yMzYtLjYwOWMtLjc4MS0zLjk4NC0xLjE1NS04LjIwMi0xLjE3LTIxLjM5OS0uMDE0LTEyLjY1My44OTEtMTkuNzA3LjktMTkuNzc3LjcyNS00LjIzMSAyLjgzMi01LjMzNyAyLjkyMi01LjM4Mi0uMDA0LjAwMSA3NC40NDQtNDIuOTggNzQuODQ2LTQzLjIxMmwuMDI4LS4wMTdjLjkwNC0uNTM4IDEuNzItLjY4OCAyLjM2LS40MzMuNTU1LjIyMS45NDkuNzMzIDEuMTcyIDEuNTIgMi4wMTQgNy4xMjggMS40NiAzMi4yMTkuMjgxIDM5Ljk4My0uNTA3IDMuMzQxLTEuNTc1IDUuNTE1LTMuMTc1IDYuNDYyTDY5LjMzNSA5My44NjlhMi4wMjMgMi4wMjMgMCAwIDEtMS4wMTguMjkyem0tLjE0Ny0uNTA3Yy4yOTMuMDM2LjYwNC0uMDM3LjkxNS0uMjE3bDc1LjI3My00My41NTFjMS44MjMtMS4wNzggMi42MDItMy45MTUgMi45MzQtNi4xMDYgMS4xNzQtNy43MzEgMS43MzEtMzIuNjk1LS4yNjgtMzkuNzcyLS4xNzgtLjYzMS0uNDczLTEuMDMyLS44NzYtMS4xOTItLjQ4NC0uMTkzLTEuMTY2LS4wNTItMS45MjEuMzk3bC0uMDM0LjAyMS03NC44NTggNDMuMjE4Yy0uMDMxLjAxNy0xLjk4OSAxLjA2OS0yLjY2NiA1LjAxOS0uMDA3LjA1OS0uOTA4IDcuMDg1LS44OTQgMTkuNzAyLjAxNSAxMy4xNTUuMzg2IDE3LjM1MSAxLjE2MSAyMS4zMDMuMDkuNDYxLjQ3Ni45ODMgMS4wMzcgMS4xMzkuMTE0LjAyNS4xODUuMDM3LjE5Ni4wMzloLjAwMXonIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNjkuMzE3IDY4Ljk4MmMuNDg5LS4yODEuODg1LS4wNTYuODg1LjUwNSAwIC41Ni0uMzk2IDEuMjQzLS44ODUgMS41MjUtLjQ4OC4yODItLjg4NC4wNTctLjg4NC0uNTA0IDAtLjU2LjM5Ni0xLjI0My44ODQtMS41MjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNNjguOTIgNzEuMTMzYy0uMjg5IDAtLjQ4Ny0uMjI4LS40ODctLjYyNSAwLS41Ni4zOTYtMS4yNDMuODg0LTEuNTI2YS44MTIuODEyIDAgMCAxIC4zOTctLjEyMWMuMjg5IDAgLjQ4OC4yMjkuNDg4LjYyNiAwIC41Ni0uMzk2IDEuMjQzLS44ODUgMS41MjVhLjgxMi44MTIgMCAwIDEtLjM5Ny4xMjFtLjc5NC0yLjQ1OWEuOTc2Ljk3NiAwIDAgMC0uNDkuMTQ3Yy0uNTQ4LjMxNy0uOTc4IDEuMDU4LS45NzggMS42ODcgMCAuNDg2LjI3MS44MTIuNjc0LjgxMmEuOTg1Ljk4NSAwIDAgMCAuNDkxLS4xNDZjLjU0OC0uMzE3Ljk3OC0xLjA1Ny45NzgtMS42ODcgMC0uNDg2LS4yNzItLjgxMy0uNjc1LS44MTMnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNNjguOTIgNzAuOTQ3Yy0uMjcxIDAtLjI5OS0uMzA3LS4yOTktLjQzOSAwLS40OTEuMzYxLTEuMTE2Ljc5LTEuMzYzYS42MzIuNjMyIDAgMCAxIC4zMDMtLjA5NmMuMjcyIDAgLjMwMS4zMDYuMzAxLjQzOCAwIC40OTEtLjM2MyAxLjExNi0uNzkxIDEuMzY0YS42MjkuNjI5IDAgMCAxLS4zMDQuMDk2bS43OTQtMi4wODZhLjgxMi44MTIgMCAwIDAtLjM5Ny4xMjFjLS40ODguMjgzLS44ODQuOTY2LS44ODQgMS41MjYgMCAuMzk3LjE5OC42MjUuNDg3LjYyNWEuODEyLjgxMiAwIDAgMCAuMzk3LS4xMjFjLjQ4OS0uMjgyLjg4NS0uOTY1Ljg4NS0xLjUyNSAwLS4zOTctLjE5OS0uNjI2LS40ODgtLjYyNicgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OS40NDQgODUuMzVjLjI2NC0uMTUyLjQ3Ny0uMDMxLjQ3Ny4yNzIgMCAuMzAzLS4yMTMuNjctLjQ3Ny44MjItLjI2My4xNTMtLjQ3Ny4wMzEtLjQ3Ny0uMjcxIDAtLjMwMi4yMTQtLjY3MS40NzctLjgyMycgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OS4yMyA4Ni41MWMtLjE1NiAwLS4yNjMtLjEyMy0uMjYzLS4zMzcgMC0uMzAyLjIxNC0uNjcxLjQ3Ny0uODIzYS40MzEuNDMxIDAgMCAxIC4yMTQtLjA2NmMuMTU2IDAgLjI2My4xMjQuMjYzLjMzOCAwIC4zMDMtLjIxMy42Ny0uNDc3LjgyMmEuNDMxLjQzMSAwIDAgMS0uMjE0LjA2Nm0uNDI4LTEuNDEyYy0uMSAwLS4yMDMuMDI5LS4zMDcuMDktLjMyLjE4NS0uNTcuNjE4LS41Ny45ODUgMCAuMzA5LjE4NS41MjQuNDQ5LjUyNGEuNjMuNjMgMCAwIDAgLjMwOC0uMDljLjMyLS4xODUuNTctLjYxOC41Ny0uOTg1IDAtLjMwOS0uMTg1LS41MjQtLjQ1LS41MjQnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNNjkuMjMgODYuMzIybC0uMDc2LS4xNDljMC0uMjM1LjE3OS0uNTQ0LjM4NC0uNjYxbC4xMi0uMDQxLjA3Ni4xNTFjMCAuMjM0LS4xNzkuNTQyLS4zODMuNjZsLS4xMjEuMDRtLjQyOC0xLjAzOGEuNDMxLjQzMSAwIDAgMC0uMjE0LjA2NmMtLjI2My4xNTItLjQ3Ny41MjEtLjQ3Ny44MjMgMCAuMjE0LjEwNy4zMzcuMjYzLjMzN2EuNDMxLjQzMSAwIDAgMCAuMjE0LS4wNjZjLjI2NC0uMTUyLjQ3Ny0uNTE5LjQ3Ny0uODIyIDAtLjIxNC0uMTA3LS4zMzgtLjI2My0uMzM4JyBmaWxsPScjODA5N0EyJy8+PHBhdGggZD0nTTEzOS4yNzggNy43Njl2NDMuNjY3TDcyLjIwOCA5MC4xNlY0Ni40OTNsNjcuMDctMzguNzI0JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTcyLjA4MyA5MC4zNzVWNDYuNDIxbC4wNjMtLjAzNiA2Ny4yNTctMzguODMxdjQzLjk1NGwtLjA2Mi4wMzYtNjcuMjU4IDM4LjgzMXptLjI1LTQzLjgxMXY0My4zOGw2Ni44MjEtMzguNTc5VjcuOTg1TDcyLjMzMyA0Ni41NjR6JyBmaWxsPScjNjA3RDhCJy8+PC9nPjxwYXRoIGQ9J00xMjUuNzM3IDg4LjY0N2wtNy42MzkgMy4zMzRWODRsLTExLjQ1OSA0LjcxM3Y4LjI2OUw5OSAxMDAuMzE1bDEzLjM2OSAzLjY0NiAxMy4zNjgtMTUuMzE0JyBmaWxsPScjNDU1QTY0Jy8+PC9nPjwvc3ZnPiI7CiAgICBmdW5jdGlvbiBSb3RhdGVJbnN0cnVjdGlvbnMoKSB7CiAgICAgIHRoaXMubG9hZEljb25fKCk7CiAgICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHZhciBzID0gb3ZlcmxheS5zdHlsZTsKICAgICAgcy5wb3NpdGlvbiA9ICdmaXhlZCc7CiAgICAgIHMudG9wID0gMDsKICAgICAgcy5yaWdodCA9IDA7CiAgICAgIHMuYm90dG9tID0gMDsKICAgICAgcy5sZWZ0ID0gMDsKICAgICAgcy5iYWNrZ3JvdW5kQ29sb3IgPSAnZ3JheSc7CiAgICAgIHMuZm9udEZhbWlseSA9ICdzYW5zLXNlcmlmJzsKICAgICAgcy56SW5kZXggPSAxMDAwMDAwOwogICAgICB2YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7CiAgICAgIGltZy5zcmMgPSB0aGlzLmljb247CiAgICAgIHZhciBzID0gaW1nLnN0eWxlOwogICAgICBzLm1hcmdpbkxlZnQgPSAnMjUlJzsKICAgICAgcy5tYXJnaW5Ub3AgPSAnMjUlJzsKICAgICAgcy53aWR0aCA9ICc1MCUnOwogICAgICBvdmVybGF5LmFwcGVuZENoaWxkKGltZyk7CiAgICAgIHZhciB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHZhciBzID0gdGV4dC5zdHlsZTsKICAgICAgcy50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgcy5mb250U2l6ZSA9ICcxNnB4JzsKICAgICAgcy5saW5lSGVpZ2h0ID0gJzI0cHgnOwogICAgICBzLm1hcmdpbiA9ICcyNHB4IDI1JSc7CiAgICAgIHMud2lkdGggPSAnNTAlJzsKICAgICAgdGV4dC5pbm5lckhUTUwgPSAnUGxhY2UgeW91ciBwaG9uZSBpbnRvIHlvdXIgQ2FyZGJvYXJkIHZpZXdlci4nOwogICAgICBvdmVybGF5LmFwcGVuZENoaWxkKHRleHQpOwogICAgICB2YXIgc25hY2tiYXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdmFyIHMgPSBzbmFja2Jhci5zdHlsZTsKICAgICAgcy5iYWNrZ3JvdW5kQ29sb3IgPSAnI0NGRDhEQyc7CiAgICAgIHMucG9zaXRpb24gPSAnZml4ZWQnOwogICAgICBzLmJvdHRvbSA9IDA7CiAgICAgIHMud2lkdGggPSAnMTAwJSc7CiAgICAgIHMuaGVpZ2h0ID0gJzQ4cHgnOwogICAgICBzLnBhZGRpbmcgPSAnMTRweCAyNHB4JzsKICAgICAgcy5ib3hTaXppbmcgPSAnYm9yZGVyLWJveCc7CiAgICAgIHMuY29sb3IgPSAnIzY1NkE2Qic7CiAgICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoc25hY2tiYXIpOwogICAgICB2YXIgc25hY2tiYXJUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHNuYWNrYmFyVGV4dC5zdHlsZS5mbG9hdCA9ICdsZWZ0JzsKICAgICAgc25hY2tiYXJUZXh0LmlubmVySFRNTCA9ICdObyBDYXJkYm9hcmQgdmlld2VyPyc7CiAgICAgIHZhciBzbmFja2JhckJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgc25hY2tiYXJCdXR0b24uaHJlZiA9ICdodHRwczovL3d3dy5nb29nbGUuY29tL2dldC9jYXJkYm9hcmQvZ2V0LWNhcmRib2FyZC8nOwogICAgICBzbmFja2JhckJ1dHRvbi5pbm5lckhUTUwgPSAnZ2V0IG9uZSc7CiAgICAgIHNuYWNrYmFyQnV0dG9uLnRhcmdldCA9ICdfYmxhbmsnOwogICAgICB2YXIgcyA9IHNuYWNrYmFyQnV0dG9uLnN0eWxlOwogICAgICBzLmZsb2F0ID0gJ3JpZ2h0JzsKICAgICAgcy5mb250V2VpZ2h0ID0gNjAwOwogICAgICBzLnRleHRUcmFuc2Zvcm0gPSAndXBwZXJjYXNlJzsKICAgICAgcy5ib3JkZXJMZWZ0ID0gJzFweCBzb2xpZCBncmF5JzsKICAgICAgcy5wYWRkaW5nTGVmdCA9ICcyNHB4JzsKICAgICAgcy50ZXh0RGVjb3JhdGlvbiA9ICdub25lJzsKICAgICAgcy5jb2xvciA9ICcjNjU2QTZCJzsKICAgICAgc25hY2tiYXIuYXBwZW5kQ2hpbGQoc25hY2tiYXJUZXh0KTsKICAgICAgc25hY2tiYXIuYXBwZW5kQ2hpbGQoc25hY2tiYXJCdXR0b24pOwogICAgICB0aGlzLm92ZXJsYXkgPSBvdmVybGF5OwogICAgICB0aGlzLnRleHQgPSB0ZXh0OwogICAgICB0aGlzLmhpZGUoKTsKICAgIH0KICAgIFJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIChwYXJlbnQpIHsKICAgICAgaWYgKCFwYXJlbnQgJiYgIXRoaXMub3ZlcmxheS5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm92ZXJsYXkpOwogICAgICB9IGVsc2UgaWYgKHBhcmVudCkgewogICAgICAgIGlmICh0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudCAmJiB0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudCAhPSBwYXJlbnQpIHRoaXMub3ZlcmxheS5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMub3ZlcmxheSk7CiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMub3ZlcmxheSk7CiAgICAgIH0KICAgICAgdGhpcy5vdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICB2YXIgaW1nID0gdGhpcy5vdmVybGF5LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpOwogICAgICB2YXIgcyA9IGltZy5zdHlsZTsKICAgICAgaWYgKGlzTGFuZHNjYXBlTW9kZSgpKSB7CiAgICAgICAgcy53aWR0aCA9ICcyMCUnOwogICAgICAgIHMubWFyZ2luTGVmdCA9ICc0MCUnOwogICAgICAgIHMubWFyZ2luVG9wID0gJzMlJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBzLndpZHRoID0gJzUwJSc7CiAgICAgICAgcy5tYXJnaW5MZWZ0ID0gJzI1JSc7CiAgICAgICAgcy5tYXJnaW5Ub3AgPSAnMjUlJzsKICAgICAgfQogICAgfTsKICAgIFJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5vdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICB9OwogICAgUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5zaG93VGVtcG9yYXJpbHkgPSBmdW5jdGlvbiAobXMsIHBhcmVudCkgewogICAgICB0aGlzLnNob3cocGFyZW50KTsKICAgICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQodGhpcy5oaWRlLmJpbmQodGhpcyksIG1zKTsKICAgIH07CiAgICBSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLmRpc2FibGVTaG93VGVtcG9yYXJpbHkgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTsKICAgIH07CiAgICBSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5kaXNhYmxlU2hvd1RlbXBvcmFyaWx5KCk7CiAgICAgIGlmICghaXNMYW5kc2NhcGVNb2RlKCkgJiYgaXNNb2JpbGUoKSkgewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaGlkZSgpOwogICAgICB9CiAgICB9OwogICAgUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5sb2FkSWNvbl8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuaWNvbiA9IGRhdGFVcmkoJ2ltYWdlL3N2Zyt4bWwnLCByb3RhdGVJbnN0cnVjdGlvbnNBc3NldCk7CiAgICB9OwogICAgdmFyIERFRkFVTFRfVklFV0VSID0gJ0NhcmRib2FyZFYxJzsKICAgIHZhciBWSUVXRVJfS0VZID0gJ1dFQlZSX0NBUkRCT0FSRF9WSUVXRVInOwogICAgdmFyIENMQVNTX05BTUUgPSAnd2VidnItcG9seWZpbGwtdmlld2VyLXNlbGVjdG9yJzsKICAgIGZ1bmN0aW9uIFZpZXdlclNlbGVjdG9yKGRlZmF1bHRWaWV3ZXIpIHsKICAgICAgdHJ5IHsKICAgICAgICB0aGlzLnNlbGVjdGVkS2V5ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oVklFV0VSX0tFWSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgdmlld2VyIHByb2ZpbGU6ICVzJywgZXJyb3IpOwogICAgICB9CiAgICAgIGlmICghdGhpcy5zZWxlY3RlZEtleSkgewogICAgICAgIHRoaXMuc2VsZWN0ZWRLZXkgPSBkZWZhdWx0Vmlld2VyIHx8IERFRkFVTFRfVklFV0VSOwogICAgICB9CiAgICAgIHRoaXMuZGlhbG9nID0gdGhpcy5jcmVhdGVEaWFsb2dfKERldmljZUluZm8uVmlld2Vycyk7CiAgICAgIHRoaXMucm9vdCA9IG51bGw7CiAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFja3NfID0gW107CiAgICB9CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uIChyb290KSB7CiAgICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICAgIHJvb3QuYXBwZW5kQ2hpbGQodGhpcy5kaWFsb2cpOwogICAgICB2YXIgc2VsZWN0ZWQgPSB0aGlzLmRpYWxvZy5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMuc2VsZWN0ZWRLZXkpOwogICAgICBzZWxlY3RlZC5jaGVja2VkID0gdHJ1ZTsKICAgICAgdGhpcy5kaWFsb2cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICB9OwogICAgVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnJvb3QgJiYgdGhpcy5yb290LmNvbnRhaW5zKHRoaXMuZGlhbG9nKSkgewogICAgICAgIHRoaXMucm9vdC5yZW1vdmVDaGlsZCh0aGlzLmRpYWxvZyk7CiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuZ2V0Q3VycmVudFZpZXdlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIERldmljZUluZm8uVmlld2Vyc1t0aGlzLnNlbGVjdGVkS2V5XTsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuZ2V0U2VsZWN0ZWRLZXlfID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgaW5wdXQgPSB0aGlzLmRpYWxvZy5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPWZpZWxkXTpjaGVja2VkJyk7CiAgICAgIGlmIChpbnB1dCkgewogICAgICAgIHJldHVybiBpbnB1dC5pZDsKICAgICAgfQogICAgICByZXR1cm4gbnVsbDsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUub25DaGFuZ2UgPSBmdW5jdGlvbiAoY2IpIHsKICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrc18ucHVzaChjYik7CiAgICB9OwogICAgVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmZpcmVPbkNoYW5nZV8gPSBmdW5jdGlvbiAodmlld2VyKSB7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5vbkNoYW5nZUNhbGxiYWNrc18ubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzX1tpXSh2aWV3ZXIpOwogICAgICB9CiAgICB9OwogICAgVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLm9uU2F2ZV8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRLZXkgPSB0aGlzLmdldFNlbGVjdGVkS2V5XygpOwogICAgICBpZiAoIXRoaXMuc2VsZWN0ZWRLZXkgfHwgIURldmljZUluZm8uVmlld2Vyc1t0aGlzLnNlbGVjdGVkS2V5XSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1ZpZXdlclNlbGVjdG9yLm9uU2F2ZV86IHRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlbiEnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5maXJlT25DaGFuZ2VfKERldmljZUluZm8uVmlld2Vyc1t0aGlzLnNlbGVjdGVkS2V5XSk7CiAgICAgIHRyeSB7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVklFV0VSX0tFWSwgdGhpcy5zZWxlY3RlZEtleSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgdmlld2VyIHByb2ZpbGU6ICVzJywgZXJyb3IpOwogICAgICB9CiAgICAgIHRoaXMuaGlkZSgpOwogICAgfTsKICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVEaWFsb2dfID0gZnVuY3Rpb24gKG9wdGlvbnMpIHsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChDTEFTU19OQU1FKTsKICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIHZhciBzID0gb3ZlcmxheS5zdHlsZTsKICAgICAgcy5wb3NpdGlvbiA9ICdmaXhlZCc7CiAgICAgIHMubGVmdCA9IDA7CiAgICAgIHMudG9wID0gMDsKICAgICAgcy53aWR0aCA9ICcxMDAlJzsKICAgICAgcy5oZWlnaHQgPSAnMTAwJSc7CiAgICAgIHMuYmFja2dyb3VuZCA9ICdyZ2JhKDAsIDAsIDAsIDAuMyknOwogICAgICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oaWRlLmJpbmQodGhpcykpOwogICAgICB2YXIgd2lkdGggPSAyODA7CiAgICAgIHZhciBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdmFyIHMgPSBkaWFsb2cuc3R5bGU7CiAgICAgIHMuYm94U2l6aW5nID0gJ2JvcmRlci1ib3gnOwogICAgICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKICAgICAgcy50b3AgPSAnMjRweCc7CiAgICAgIHMubGVmdCA9ICc1MCUnOwogICAgICBzLm1hcmdpbkxlZnQgPSAtd2lkdGggLyAyICsgJ3B4JzsKICAgICAgcy53aWR0aCA9IHdpZHRoICsgJ3B4JzsKICAgICAgcy5wYWRkaW5nID0gJzI0cHgnOwogICAgICBzLm92ZXJmbG93ID0gJ2hpZGRlbic7CiAgICAgIHMuYmFja2dyb3VuZCA9ICcjZmFmYWZhJzsKICAgICAgcy5mb250RmFtaWx5ID0gIidSb2JvdG8nLCBzYW5zLXNlcmlmIjsKICAgICAgcy5ib3hTaGFkb3cgPSAnMHB4IDVweCAyMHB4ICM2NjYnOwogICAgICBkaWFsb2cuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVIMV8oJ1NlbGVjdCB5b3VyIHZpZXdlcicpKTsKICAgICAgZm9yICh2YXIgaWQgaW4gb3B0aW9ucykgewogICAgICAgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUNob2ljZV8oaWQsIG9wdGlvbnNbaWRdLmxhYmVsKSk7CiAgICAgIH0KICAgICAgZGlhbG9nLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlQnV0dG9uXygnU2F2ZScsIHRoaXMub25TYXZlXy5iaW5kKHRoaXMpKSk7CiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChvdmVybGF5KTsKICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpYWxvZyk7CiAgICAgIHJldHVybiBjb250YWluZXI7CiAgICB9OwogICAgVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmNyZWF0ZUgxXyA9IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHZhciBoMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7CiAgICAgIHZhciBzID0gaDEuc3R5bGU7CiAgICAgIHMuY29sb3IgPSAnYmxhY2snOwogICAgICBzLmZvbnRTaXplID0gJzIwcHgnOwogICAgICBzLmZvbnRXZWlnaHQgPSAnYm9sZCc7CiAgICAgIHMubWFyZ2luVG9wID0gMDsKICAgICAgcy5tYXJnaW5Cb3R0b20gPSAnMjRweCc7CiAgICAgIGgxLmlubmVySFRNTCA9IG5hbWU7CiAgICAgIHJldHVybiBoMTsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlQ2hvaWNlXyA9IGZ1bmN0aW9uIChpZCwgbmFtZSkgewogICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRpdi5zdHlsZS5tYXJnaW5Ub3AgPSAnOHB4JzsKICAgICAgZGl2LnN0eWxlLmNvbG9yID0gJ2JsYWNrJzsKICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgaW5wdXQuc3R5bGUuZm9udFNpemUgPSAnMzBweCc7CiAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBpZCk7CiAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdyYWRpbycpOwogICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgaWQpOwogICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZmllbGQnKTsKICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTsKICAgICAgbGFiZWwuc3R5bGUubWFyZ2luTGVmdCA9ICc0cHgnOwogICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGlkKTsKICAgICAgbGFiZWwuaW5uZXJIVE1MID0gbmFtZTsKICAgICAgZGl2LmFwcGVuZENoaWxkKGlucHV0KTsKICAgICAgZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKICAgICAgcmV0dXJuIGRpdjsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlQnV0dG9uXyA9IGZ1bmN0aW9uIChsYWJlbCwgb25jbGljaykgewogICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSBsYWJlbDsKICAgICAgdmFyIHMgPSBidXR0b24uc3R5bGU7CiAgICAgIHMuZmxvYXQgPSAncmlnaHQnOwogICAgICBzLnRleHRUcmFuc2Zvcm0gPSAndXBwZXJjYXNlJzsKICAgICAgcy5jb2xvciA9ICcjMTA5NGY3JzsKICAgICAgcy5mb250U2l6ZSA9ICcxNHB4JzsKICAgICAgcy5sZXR0ZXJTcGFjaW5nID0gMDsKICAgICAgcy5ib3JkZXIgPSAwOwogICAgICBzLmJhY2tncm91bmQgPSAnbm9uZSc7CiAgICAgIHMubWFyZ2luVG9wID0gJzE2cHgnOwogICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbmNsaWNrKTsKICAgICAgcmV0dXJuIGJ1dHRvbjsKICAgIH07CiAgICB2YXIgY29tbW9uanNHbG9iYWwkJDEgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBjb21tb25qc0dsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBjb21tb25qc0dsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB7fTsKICAgIGZ1bmN0aW9uIHVud3JhcEV4cG9ydHMkJDEgKHgpIHsKICAgIAlyZXR1cm4geCAmJiB4Ll9fZXNNb2R1bGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHgsICdkZWZhdWx0JykgPyB4WydkZWZhdWx0J10gOiB4OwogICAgfQogICAgZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUkJDEoZm4sIG1vZHVsZSkgewogICAgCXJldHVybiBtb2R1bGUgPSB7IGV4cG9ydHM6IHt9IH0sIGZuKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMpLCBtb2R1bGUuZXhwb3J0czsKICAgIH0KICAgIHZhciBOb1NsZWVwID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkJDEoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewogICAgKGZ1bmN0aW9uIHdlYnBhY2tVbml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uKHJvb3QsIGZhY3RvcnkpIHsKICAgIAltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsKICAgIH0pKGNvbW1vbmpzR2xvYmFsJCQxLCBmdW5jdGlvbigpIHsKICAgIHJldHVybiAgICAgICAgICAoZnVuY3Rpb24obW9kdWxlcykgewogICAgICAgICAgICAgCXZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307CiAgICAgICAgICAgICAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgICAgICAgICAgCQlpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkgewogICAgICAgICAgICAgCQkJcmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7CiAgICAgICAgICAgICAJCX0KICAgICAgICAgICAgIAkJdmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0gewogICAgICAgICAgICAgCQkJaTogbW9kdWxlSWQsCiAgICAgICAgICAgICAJCQlsOiBmYWxzZSwKICAgICAgICAgICAgIAkJCWV4cG9ydHM6IHt9CiAgICAgICAgICAgICAJCX07CiAgICAgICAgICAgICAJCW1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOwogICAgICAgICAgICAgCQltb2R1bGUubCA9IHRydWU7CiAgICAgICAgICAgICAJCXJldHVybiBtb2R1bGUuZXhwb3J0czsKICAgICAgICAgICAgIAl9CiAgICAgICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlczsKICAgICAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzOwogICAgICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewogICAgICAgICAgICAgCQlpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7CiAgICAgICAgICAgICAJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgewogICAgICAgICAgICAgCQkJCWNvbmZpZ3VyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAJCQkJZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgIAkJCQlnZXQ6IGdldHRlcgogICAgICAgICAgICAgCQkJfSk7CiAgICAgICAgICAgICAJCX0KICAgICAgICAgICAgIAl9OwogICAgICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgewogICAgICAgICAgICAgCQl2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID8KICAgICAgICAgICAgIAkJCWZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6CiAgICAgICAgICAgICAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9OwogICAgICAgICAgICAgCQlfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7CiAgICAgICAgICAgICAJCXJldHVybiBnZXR0ZXI7CiAgICAgICAgICAgICAJfTsKICAgICAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07CiAgICAgICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gIiI7CiAgICAgICAgICAgICAJcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7CiAgICAgICAgICAgICB9KQogICAgICAgICAgICAgKFsKICAgICAgICAgIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKICAgIHZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSgpOwogICAgZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CiAgICB2YXIgbWVkaWFGaWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKICAgIHZhciBvbGRJT1MgPSB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiBwYXJzZUZsb2F0KCgnJyArICgvQ1BVLipPUyAoWzAtOV9dezMsNH0pWzAtOV9dezAsMX18KENQVSBsaWtlKS4qQXBwbGVXZWJLaXQuKk1vYmlsZS9pLmV4ZWMobmF2aWdhdG9yLnVzZXJBZ2VudCkgfHwgWzAsICcnXSlbMV0pLnJlcGxhY2UoJ3VuZGVmaW5lZCcsICczXzInKS5yZXBsYWNlKCdfJywgJy4nKS5yZXBsYWNlKCdfJywgJycpKSA8IDEwICYmICF3aW5kb3cuTVNTdHJlYW07CiAgICB2YXIgTm9TbGVlcCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gTm9TbGVlcCgpIHsKICAgICAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgTm9TbGVlcCk7CiAgICAgICAgaWYgKG9sZElPUykgewogICAgICAgICAgdGhpcy5ub1NsZWVwVGltZXIgPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLm5vU2xlZXBWaWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7CiAgICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5zZXRBdHRyaWJ1dGUoJ3BsYXlzaW5saW5lJywgJycpOwogICAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uc2V0QXR0cmlidXRlKCdzcmMnLCBtZWRpYUZpbGUpOwogICAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm5vU2xlZXBWaWRlby5jdXJyZW50VGltZSA+IDAuNSkgewogICAgICAgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvLmN1cnJlbnRUaW1lID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgX2NyZWF0ZUNsYXNzKE5vU2xlZXAsIFt7CiAgICAgICAga2V5OiAnZW5hYmxlJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZW5hYmxlKCkgewogICAgICAgICAgaWYgKG9sZElPUykgewogICAgICAgICAgICB0aGlzLmRpc2FibGUoKTsKICAgICAgICAgICAgdGhpcy5ub1NsZWVwVGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy8nOwogICAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KHdpbmRvdy5zdG9wLCAwKTsKICAgICAgICAgICAgfSwgMTUwMDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8ucGxheSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogJ2Rpc2FibGUnLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICAgICAgaWYgKG9sZElPUykgewogICAgICAgICAgICBpZiAodGhpcy5ub1NsZWVwVGltZXIpIHsKICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLm5vU2xlZXBUaW1lcik7CiAgICAgICAgICAgICAgdGhpcy5ub1NsZWVwVGltZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5wYXVzZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfV0pOwogICAgICByZXR1cm4gTm9TbGVlcDsKICAgIH0oKTsKICAgIG1vZHVsZS5leHBvcnRzID0gTm9TbGVlcDsKICAgICAgICAgIH0pLAogICAgICAgICAgKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgbW9kdWxlLmV4cG9ydHMgPSAnZGF0YTp2aWRlby9tcDQ7YmFzZTY0LEFBQUFJR1owZVhCdGNEUXlBQUFDQUdsemIyMXBjMjh5WVhaak1XMXdOREVBQUFBSVpuSmxaUUFBQ0tCdFpHRjBBQUFDOHdZRi8vL3YzRVhwdmViWlNMZVdMTmdnMlNQdTczZ3lOalFnTFNCamIzSmxJREUwTWlCeU1qUTNPU0JrWkRjNVlUWXhJQzBnU0M0eU5qUXZUVkJGUnkwMElFRldReUJqYjJSbFl5QXRJRU52Y0hsc1pXWjBJREl3TURNdE1qQXhOQ0F0SUdoMGRIQTZMeTkzZDNjdWRtbGtaVzlzWVc0dWIzSm5MM2d5TmpRdWFIUnRiQ0F0SUc5d2RHbHZibk02SUdOaFltRmpQVEVnY21WbVBURWdaR1ZpYkc5amF6MHhPakE2TUNCaGJtRnNlWE5sUFRCNE1Ub3dlREV4TVNCdFpUMW9aWGdnYzNWaWJXVTlNaUJ3YzNrOU1TQndjM2xmY21ROU1TNHdNRG93TGpBd0lHMXBlR1ZrWDNKbFpqMHdJRzFsWDNKaGJtZGxQVEUySUdOb2NtOXRZVjl0WlQweElIUnlaV3hzYVhNOU1DQTRlRGhrWTNROU1DQmpjVzA5TUNCa1pXRmtlbTl1WlQweU1Td3hNU0JtWVhOMFgzQnphMmx3UFRFZ1kyaHliMjFoWDNGd1gyOW1abk5sZEQwd0lIUm9jbVZoWkhNOU5pQnNiMjlyWVdobFlXUmZkR2h5WldGa2N6MHhJSE5zYVdObFpGOTBhSEpsWVdSelBUQWdibkk5TUNCa1pXTnBiV0YwWlQweElHbHVkR1Z5YkdGalpXUTlNQ0JpYkhWeVlYbGZZMjl0Y0dGMFBUQWdZMjl1YzNSeVlXbHVaV1JmYVc1MGNtRTlNQ0JpWm5KaGJXVnpQVE1nWWw5d2VYSmhiV2xrUFRJZ1lsOWhaR0Z3ZEQweElHSmZZbWxoY3owd0lHUnBjbVZqZEQweElIZGxhV2RvZEdJOU1TQnZjR1Z1WDJkdmNEMHdJSGRsYVdkb2RIQTlNU0JyWlhscGJuUTlNekF3SUd0bGVXbHVkRjl0YVc0OU16QWdjMk5sYm1WamRYUTlOREFnYVc1MGNtRmZjbVZtY21WemFEMHdJSEpqWDJ4dmIydGhhR1ZoWkQweE1DQnlZejFqY21ZZ2JXSjBjbVZsUFRFZ1kzSm1QVEl3TGpBZ2NXTnZiWEE5TUM0Mk1DQnhjRzFwYmowd0lIRndiV0Y0UFRZNUlIRndjM1JsY0QwMElIWmlkbDl0WVhoeVlYUmxQVEl3TURBd0lIWmlkbDlpZFdaemFYcGxQVEkxTURBd0lHTnlabDl0WVhnOU1DNHdJRzVoYkY5b2NtUTlibTl1WlNCbWFXeHNaWEk5TUNCcGNGOXlZWFJwYnoweExqUXdJR0Z4UFRFNk1TNHdNQUNBQUFBQU9XV0loQUEzLy9wK0M3djh0RERTVGpmOTd3NTVpM1NiUlBPNFpZK2hrakQ1aGJrQWtMM3pwSjZoL0xSMUNBQUJ6Z0Ixa3FxelVvcmxoUUFBQUF4Qm1pUVlobi8rcVpZQURMZ0FBQUFKUVo1Q1FoWC9BQWo1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdlWVVRbi93QUxLQ0VBQTBCb0hBQUFBQWtCbm1ORUovOEFDeWtoQUFOQWFCd2hBQU5BYUJ3QUFBQU5RWnBvTkV4RFAvNnBsZ0FNdVNFQUEwQm9IQUFBQUF0Qm5vWkZFU3dyL3dBSStTRUFBMEJvSENFQUEwQm9IQUFBQUFrQm5xVkVKLzhBQ3lraEFBTkFhQndBQUFBSkFaNm5SQ2YvQUFzb0lRQURRR2djSVFBRFFHZ2NBQUFBRFVHYXJEUk1Rei8rcVpZQURMZ2hBQU5BYUJ3QUFBQUxRWjdLUlJVc0svOEFDUGtoQUFOQWFCd0FBQUFKQVo3cFJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdlNjBRbi93QUxLQ0VBQTBCb0hBQUFBQTFCbXZBMFRFTS8vcW1XQUF5NUlRQURRR2djSVFBRFFHZ2NBQUFBQzBHZkRrVVZMQ3YvQUFqNUlRQURRR2djQUFBQUNRR2ZMVVFuL3dBTEtTRUFBMEJvSENFQUEwQm9IQUFBQUFrQm55OUVKLzhBQ3lnaEFBTkFhQndBQUFBTlFaczBORXhEUC82cGxnQU11Q0VBQTBCb0hBQUFBQXRCbjFKRkZTd3Ivd0FJK1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbjNGRUovOEFDeWdoQUFOQWFCd0FBQUFKQVo5elJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFEVUdiZURSTVF6LytxWllBRExraEFBTkFhQndBQUFBTFFaK1dSUlVzSy84QUNQZ2hBQU5BYUJ3aEFBTkFhQndBQUFBSkFaKzFSQ2YvQUFzcElRQURRR2djQUFBQUNRR2Z0MFFuL3dBTEtTRUFBMEJvSENFQUEwQm9IQUFBQUExQm03dzBURU0vL3FtV0FBeTRJUUFEUUdnY0FBQUFDMEdmMmtVVkxDdi9BQWo1SVFBRFFHZ2NBQUFBQ1FHZitVUW4vd0FMS0NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbi90RUovOEFDeWtoQUFOQWFCd0FBQUFOUVp2Z05FeERQLzZwbGdBTXVTRUFBMEJvSENFQUEwQm9IQUFBQUF0Qm5oNUZGU3dyL3dBSStDRUFBMEJvSEFBQUFBa0JuajFFSi84QUN5Z2hBQU5BYUJ3aEFBTkFhQndBQUFBSkFaNC9SQ2YvQUFzcElRQURRR2djQUFBQURVR2FKRFJNUXovK3FaWUFETGdoQUFOQWFCd0FBQUFMUVo1Q1JSVXNLLzhBQ1BraEFBTkFhQndoQUFOQWFCd0FBQUFKQVo1aFJDZi9BQXNvSVFBRFFHZ2NBQUFBQ1FHZVkwUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQTFCbW1nMFRFTS8vcW1XQUF5NUlRQURRR2djQUFBQUMwR2Voa1VWTEN2L0FBajVJUUFEUUdnY0lRQURRR2djQUFBQUNRR2VwVVFuL3dBTEtTRUFBMEJvSEFBQUFBa0JucWRFSi84QUN5Z2hBQU5BYUJ3QUFBQU5RWnFzTkV4RFAvNnBsZ0FNdUNFQUEwQm9IQ0VBQTBCb0hBQUFBQXRCbnNwRkZTd3Ivd0FJK1NFQUEwQm9IQUFBQUFrQm51bEVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVo3clJDZi9BQXNvSVFBRFFHZ2NBQUFBRFVHYThEUk1Rei8rcVpZQURMa2hBQU5BYUJ3aEFBTkFhQndBQUFBTFFaOE9SUlVzSy84QUNQa2hBQU5BYUJ3QUFBQUpBWjh0UkNmL0FBc3BJUUFEUUdnY0lRQURRR2djQUFBQUNRR2ZMMFFuL3dBTEtDRUFBMEJvSEFBQUFBMUJtelEwVEVNLy9xbVdBQXk0SVFBRFFHZ2NBQUFBQzBHZlVrVVZMQ3YvQUFqNUlRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZmNVUW4vd0FMS0NFQUEwQm9IQUFBQUFrQm4zTkVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFOUVp0NE5FeEMvLzZwbGdBTXVTRUFBMEJvSEFBQUFBdEJuNVpGRlN3ci93QUkrQ0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuN1ZFSi84QUN5a2hBQU5BYUJ3QUFBQUpBWiszUkNmL0FBc3BJUUFEUUdnY0FBQUFEVUdidXpSTVFuLytuaEFBWXNBaEFBTkFhQndoQUFOQWFCd0FBQUFKUVovYVFoUC9BQXNwSVFBRFFHZ2NBQUFBQ1FHZitVUW4vd0FMS0NFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSEFBQUNpRnRiMjkyQUFBQWJHMTJhR1FBQUFBQTFZQ0NYOVdBZ2w4QUFBUG9BQUFIL0FBQkFBQUJBQUFBQUFBQUFBQUFBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFEQUFBQUdHbHZaSE1BQUFBQUVJQ0FnQWNBVC8vLy92Ny9BQUFGK1hSeVlXc0FBQUJjZEd0b1pBQUFBQVBWZ0lKZjFZQ0NYd0FBQUFFQUFBQUFBQUFIMEFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFFQUFBQUFBeWdBQUFNb0FBQUFBQUNSbFpIUnpBQUFBSEdWc2MzUUFBQUFBQUFBQUFRQUFCOUFBQUJkd0FBRUFBQUFBQlhGdFpHbGhBQUFBSUcxa2FHUUFBQUFBMVlDQ1g5V0FnbDhBQVYrUUFBSy9JRlhFQUFBQUFBQXRhR1JzY2dBQUFBQUFBQUFBZG1sa1pRQUFBQUFBQUFBQUFBQUFBRlpwWkdWdlNHRnVaR3hsY2dBQUFBVWNiV2x1WmdBQUFCUjJiV2hrQUFBQUFRQUFBQUFBQUFBQUFBQUFKR1JwYm1ZQUFBQWNaSEpsWmdBQUFBQUFBQUFCQUFBQURIVnliQ0FBQUFBQkFBQUUzSE4wWW13QUFBQ1ljM1J6WkFBQUFBQUFBQUFCQUFBQWlHRjJZekVBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBQUF5Z0RLQUVnQUFBQklBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBWS8vOEFBQUF5WVhaalF3Rk5RQ2ovNFFBYlowMUFLT3lobzN5U1RVQkFRRkFBQUFNQUVBQXI4Z0R4Z3hsZ0FRQUVhTytHOGdBQUFCaHpkSFJ6QUFBQUFBQUFBQUVBQUFBOEFBQUx1QUFBQUJSemRITnpBQUFBQUFBQUFBRUFBQUFCQUFBQjhHTjBkSE1BQUFBQUFBQUFQQUFBQUFFQUFCZHdBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBRHFZQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUFFQUFBdTRBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQUM3Z0FBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFCeHpkSE5qQUFBQUFBQUFBQUVBQUFBQkFBQUFBUUFBQUFFQUFBRUVjM1J6ZWdBQUFBQUFBQUFBQUFBQVBBQUFBelFBQUFBUUFBQUFEUUFBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQVBBQUFBRFFBQUFBMEFBQUFSQUFBQUR3QUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQU5BQUFBRFFBQUFRQnpkR052QUFBQUFBQUFBRHdBQUFBd0FBQURaQUFBQTNRQUFBT05BQUFEb0FBQUE3a0FBQVBRQUFBRDZ3QUFBLzRBQUFRWEFBQUVMZ0FBQkVNQUFBUmNBQUFFYndBQUJJd0FBQVNoQUFBRXVnQUFCTTBBQUFUa0FBQUUvd0FBQlJJQUFBVXJBQUFGUWdBQUJWMEFBQVZ3QUFBRmlRQUFCYUFBQUFXMUFBQUZ6Z0FBQmVFQUFBWCtBQUFHRXdBQUJpd0FBQVkvQUFBR1ZnQUFCbkVBQUFhRUFBQUduUUFBQnJRQUFBYlBBQUFHNGdBQUJ2VUFBQWNTQUFBSEp3QUFCMEFBQUFkVEFBQUhjQUFBQjRVQUFBZWVBQUFIc1FBQUI4Z0FBQWZqQUFBSDlnQUFDQThBQUFnbUFBQUlRUUFBQ0ZRQUFBaG5BQUFJaEFBQUNKY0FBQU1zZEhKaGF3QUFBRngwYTJoa0FBQUFBOVdBZ2wvVmdJSmZBQUFBQWdBQUFBQUFBQWY4QUFBQUFBQUFBQUFBQUFBQkFRQUFBQUFCQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQVFBQUFBQUFBQUFBQUFBQUFBQUFDc20xa2FXRUFBQUFnYldSb1pBQUFBQURWZ0lKZjFZQ0NYd0FBckVRQUFXQUFWY1FBQUFBQUFDZG9aR3h5QUFBQUFBQUFBQUJ6YjNWdUFBQUFBQUFBQUFBQUFBQUFVM1JsY21WdkFBQUFBbU50YVc1bUFBQUFFSE50YUdRQUFBQUFBQUFBQUFBQUFDUmthVzVtQUFBQUhHUnlaV1lBQUFBQUFBQUFBUUFBQUF4MWNtd2dBQUFBQVFBQUFpZHpkR0pzQUFBQVozTjBjMlFBQUFBQUFBQUFBUUFBQUZkdGNEUmhBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUNBQkFBQUFBQXJFUUFBQUFBQURObGMyUnpBQUFBQUFPQWdJQWlBQUlBQklDQWdCUkFGUUFBQUFBRERVQUFBQUFBQllDQWdBSVNFQWFBZ0lBQkFnQUFBQmh6ZEhSekFBQUFBQUFBQUFFQUFBQllBQUFFQUFBQUFCeHpkSE5qQUFBQUFBQUFBQUVBQUFBQkFBQUFBUUFBQUFFQUFBQVVjM1J6ZWdBQUFBQUFBQUFHQUFBQVdBQUFBWEJ6ZEdOdkFBQUFBQUFBQUZnQUFBT0JBQUFEaHdBQUE1b0FBQU90QUFBRHN3QUFBOG9BQUFQZkFBQUQ1UUFBQS9nQUFBUUxBQUFFRVFBQUJDZ0FBQVE5QUFBRVVBQUFCRllBQUFScEFBQUVnQUFBQklZQUFBU2JBQUFFcmdBQUJMUUFBQVRIQUFBRTNnQUFCUE1BQUFUNUFBQUZEQUFBQlI4QUFBVWxBQUFGUEFBQUJWRUFBQVZYQUFBRmFnQUFCWDBBQUFXREFBQUZtZ0FBQmE4QUFBWENBQUFGeUFBQUJkc0FBQVh5QUFBRitBQUFCZzBBQUFZZ0FBQUdKZ0FBQmprQUFBWlFBQUFHWlFBQUJtc0FBQVorQUFBR2tRQUFCcGNBQUFhdUFBQUd3d0FBQnNrQUFBYmNBQUFHN3dBQUJ3WUFBQWNNQUFBSElRQUFCelFBQUFjNkFBQUhUUUFBQjJRQUFBZHFBQUFIZndBQUI1SUFBQWVZQUFBSHF3QUFCOElBQUFmWEFBQUgzUUFBQi9BQUFBZ0RBQUFJQ1FBQUNDQUFBQWcxQUFBSU93QUFDRTRBQUFoaEFBQUllQUFBQ0g0QUFBaVJBQUFJcEFBQUNLb0FBQWl3QUFBSXRnQUFDTHdBQUFqQ0FBQUFGblZrZEdFQUFBQU9ibUZ0WlZOMFpYSmxid0FBQUhCMVpIUmhBQUFBYUcxbGRHRUFBQUFBQUFBQUlXaGtiSElBQUFBQUFBQUFBRzFrYVhKaGNIQnNBQUFBQUFBQUFBQUFBQUFBTzJsc2MzUUFBQUF6cVhSdmJ3QUFBQ3RrWVhSaEFBQUFBUUFBQUFCSVlXNWtRbkpoYTJVZ01DNHhNQzR5SURJd01UVXdOakV4TURBPSc7CiAgICAgICAgICB9KQogICAgICAgICAgICAgXSk7CiAgICB9KTsKICAgIH0pOwogICAgdmFyIE5vU2xlZXAkMSA9IHVud3JhcEV4cG9ydHMkJDEoTm9TbGVlcCk7CiAgICB2YXIgbmV4dERpc3BsYXlJZCA9IDEwMDA7CiAgICB2YXIgZGVmYXVsdExlZnRCb3VuZHMgPSBbMCwgMCwgMC41LCAxXTsKICAgIHZhciBkZWZhdWx0UmlnaHRCb3VuZHMgPSBbMC41LCAwLCAwLjUsIDFdOwogICAgdmFyIHJhZiA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7CiAgICB2YXIgY2FmID0gd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lOwogICAgZnVuY3Rpb24gVlJGcmFtZURhdGEoKSB7CiAgICAgIHRoaXMubGVmdFByb2plY3Rpb25NYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICAgICAgdGhpcy5sZWZ0Vmlld01hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICB0aGlzLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICB0aGlzLnJpZ2h0Vmlld01hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICB0aGlzLnBvc2UgPSBudWxsOwogICAgfQogICAgZnVuY3Rpb24gVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKGNvbmZpZykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7CiAgICAgICAgaGFzUG9zaXRpb246IHsKICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5oYXNQb3NpdGlvbgogICAgICAgIH0sCiAgICAgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiB7CiAgICAgICAgICB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiBjb25maWcuaGFzRXh0ZXJuYWxEaXNwbGF5CiAgICAgICAgfSwKICAgICAgICBjYW5QcmVzZW50OiB7CiAgICAgICAgICB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiBjb25maWcuY2FuUHJlc2VudAogICAgICAgIH0sCiAgICAgICAgbWF4TGF5ZXJzOiB7CiAgICAgICAgICB3cml0YWJsZTogZmFsc2UsIGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiBjb25maWcubWF4TGF5ZXJzCiAgICAgICAgfSwKICAgICAgICBoYXNPcmllbnRhdGlvbjogewogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheUNhcGFiaWxpdGllcy5wcm90b3R5cGUuaGFzT3JpZW50YXRpb24nLCAnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEnKTsKICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5oYXNPcmllbnRhdGlvbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gVlJEaXNwbGF5KGNvbmZpZykgewogICAgICBjb25maWcgPSBjb25maWcgfHwge307CiAgICAgIHZhciBVU0VfV0FLRUxPQ0sgPSAnd2FrZWxvY2snIGluIGNvbmZpZyA/IGNvbmZpZy53YWtlbG9jayA6IHRydWU7CiAgICAgIHRoaXMuaXNQb2x5ZmlsbGVkID0gdHJ1ZTsKICAgICAgdGhpcy5kaXNwbGF5SWQgPSBuZXh0RGlzcGxheUlkKys7CiAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSAnJzsKICAgICAgdGhpcy5kZXB0aE5lYXIgPSAwLjAxOwogICAgICB0aGlzLmRlcHRoRmFyID0gMTAwMDAuMDsKICAgICAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdpc0Nvbm5lY3RlZCcsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUuaXNDb25uZWN0ZWQnLCAnVlJEaXNwbGF5Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5oYXNFeHRlcm5hbERpc3BsYXknKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLmNhcGFiaWxpdGllcyA9IG5ldyBWUkRpc3BsYXlDYXBhYmlsaXRpZXMoewogICAgICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKICAgICAgICBoYXNPcmllbnRhdGlvbjogZmFsc2UsCiAgICAgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiBmYWxzZSwKICAgICAgICBjYW5QcmVzZW50OiBmYWxzZSwKICAgICAgICBtYXhMYXllcnM6IDEKICAgICAgfSk7CiAgICAgIHRoaXMuc3RhZ2VQYXJhbWV0ZXJzID0gbnVsbDsKICAgICAgdGhpcy53YWl0aW5nRm9yUHJlc2VudF8gPSBmYWxzZTsKICAgICAgdGhpcy5sYXllcl8gPSBudWxsOwogICAgICB0aGlzLm9yaWdpbmFsUGFyZW50XyA9IG51bGw7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfID0gbnVsbDsKICAgICAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfID0gbnVsbDsKICAgICAgdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfID0gbnVsbDsKICAgICAgdGhpcy5mdWxsc2NyZWVuQ2hhbmdlSGFuZGxlcl8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKICAgICAgaWYgKFVTRV9XQUtFTE9DSyAmJiBpc01vYmlsZSgpKSB7CiAgICAgICAgdGhpcy53YWtlbG9ja18gPSBuZXcgTm9TbGVlcCQxKCk7CiAgICAgIH0KICAgIH0KICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhID0gZnVuY3Rpb24gKGZyYW1lRGF0YSkgewogICAgICByZXR1cm4gZnJhbWVEYXRhRnJvbVBvc2UoZnJhbWVEYXRhLCB0aGlzLl9nZXRQb3NlKCksIHRoaXMpOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZ2V0UG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRQb3NlJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CiAgICAgIHJldHVybiB0aGlzLl9nZXRQb3NlKCk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5yZXNldFBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUucmVzZXRQb3NlJyk7CiAgICAgIHJldHVybiB0aGlzLl9yZXNldFBvc2UoKTsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmdldEltbWVkaWF0ZVBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0SW1tZWRpYXRlUG9zZScsICdWUkRpc3BsYXkucHJvdG90eXBlLmdldEZyYW1lRGF0YScpOwogICAgICByZXR1cm4gdGhpcy5fZ2V0UG9zZSgpOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgIHJldHVybiByYWYoY2FsbGJhY2spOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiAoaWQpIHsKICAgICAgcmV0dXJuIGNhZihpZCk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS53cmFwRm9yRnVsbHNjcmVlbiA9IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgIGlmIChpc0lPUygpKSB7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXykgewogICAgICAgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgdmFyIGNzc1Byb3BlcnRpZXMgPSBbJ2hlaWdodDogJyArIE1hdGgubWluKHNjcmVlbi5oZWlnaHQsIHNjcmVlbi53aWR0aCkgKyAncHggIWltcG9ydGFudCcsICd0b3A6IDAgIWltcG9ydGFudCcsICdsZWZ0OiAwICFpbXBvcnRhbnQnLCAncmlnaHQ6IDAgIWltcG9ydGFudCcsICdib3JkZXI6IDAnLCAnbWFyZ2luOiAwJywgJ3BhZGRpbmc6IDAnLCAnei1pbmRleDogOTk5OTk5ICFpbXBvcnRhbnQnLCAncG9zaXRpb246IGZpeGVkJ107CiAgICAgICAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8uc2V0QXR0cmlidXRlKCdzdHlsZScsIGNzc1Byb3BlcnRpZXMuam9pbignOyAnKSArICc7Jyk7CiAgICAgICAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8uY2xhc3NMaXN0LmFkZCgnd2VidnItcG9seWZpbGwtZnVsbHNjcmVlbi13cmFwcGVyJyk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfID09IGVsZW1lbnQpIHsKICAgICAgICByZXR1cm4gdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl87CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKSB7CiAgICAgICAgaWYgKHRoaXMub3JpZ2luYWxQYXJlbnRfKSB7CiAgICAgICAgICB0aGlzLm9yaWdpbmFsUGFyZW50Xy5hcHBlbmRDaGlsZCh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Xyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XyA9IGVsZW1lbnQ7CiAgICAgIHRoaXMub3JpZ2luYWxQYXJlbnRfID0gZWxlbWVudC5wYXJlbnRFbGVtZW50OwogICAgICBpZiAoIXRoaXMub3JpZ2luYWxQYXJlbnRfKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgfQogICAgICBpZiAoIXRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnBhcmVudEVsZW1lbnQpIHsKICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8ucGFyZW50RWxlbWVudDsKICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLCB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Xyk7CiAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKTsKICAgICAgfQogICAgICB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXy5pbnNlcnRCZWZvcmUodGhpcy5mdWxsc2NyZWVuRWxlbWVudF8sIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLmZpcnN0Q2hpbGQpOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfID0gdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8uZ2V0QXR0cmlidXRlKCdzdHlsZScpOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIGZ1bmN0aW9uIGFwcGx5RnVsbHNjcmVlbkVsZW1lbnRTdHlsZSgpIHsKICAgICAgICBpZiAoIXNlbGYuZnVsbHNjcmVlbkVsZW1lbnRfKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBjc3NQcm9wZXJ0aWVzID0gWydwb3NpdGlvbjogYWJzb2x1dGUnLCAndG9wOiAwJywgJ2xlZnQ6IDAnLCAnd2lkdGg6ICcgKyBNYXRoLm1heChzY3JlZW4ud2lkdGgsIHNjcmVlbi5oZWlnaHQpICsgJ3B4JywgJ2hlaWdodDogJyArIE1hdGgubWluKHNjcmVlbi5oZWlnaHQsIHNjcmVlbi53aWR0aCkgKyAncHgnLCAnYm9yZGVyOiAwJywgJ21hcmdpbjogMCcsICdwYWRkaW5nOiAwJ107CiAgICAgICAgc2VsZi5mdWxsc2NyZWVuRWxlbWVudF8uc2V0QXR0cmlidXRlKCdzdHlsZScsIGNzc1Byb3BlcnRpZXMuam9pbignOyAnKSArICc7Jyk7CiAgICAgIH0KICAgICAgYXBwbHlGdWxsc2NyZWVuRWxlbWVudFN0eWxlKCk7CiAgICAgIHJldHVybiB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXzsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5mdWxsc2NyZWVuRWxlbWVudF87CiAgICAgIGlmICh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfKSB7CiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgIH0KICAgICAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfID0gbnVsbDsKICAgICAgdmFyIHBhcmVudCA9IHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnBhcmVudEVsZW1lbnQ7CiAgICAgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnJlbW92ZUNoaWxkKGVsZW1lbnQpOwogICAgICBpZiAodGhpcy5vcmlnaW5hbFBhcmVudF8gPT09IHBhcmVudCkgewogICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZWxlbWVudCwgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8pOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHRoaXMub3JpZ2luYWxQYXJlbnRfKSB7CiAgICAgICAgICB0aGlzLm9yaWdpbmFsUGFyZW50Xy5hcHBlbmRDaGlsZChlbGVtZW50KTsKICAgICAgICB9CiAgICAgIHBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXyk7CiAgICAgIHJldHVybiBlbGVtZW50OwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUucmVxdWVzdFByZXNlbnQgPSBmdW5jdGlvbiAobGF5ZXJzKSB7CiAgICAgIHZhciB3YXNQcmVzZW50aW5nID0gdGhpcy5pc1ByZXNlbnRpbmc7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgaWYgKCEobGF5ZXJzIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0UHJlc2VudCB3aXRoIG5vbi1hcnJheSBhcmd1bWVudCcsICdhbiBhcnJheSBvZiBWUkxheWVycyBhcyB0aGUgZmlyc3QgYXJndW1lbnQnKTsKICAgICAgICBsYXllcnMgPSBbbGF5ZXJzXTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmICghc2VsZi5jYXBhYmlsaXRpZXMuY2FuUHJlc2VudCkgewogICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignVlJEaXNwbGF5IGlzIG5vdCBjYXBhYmxlIG9mIHByZXNlbnRpbmcuJykpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAobGF5ZXJzLmxlbmd0aCA9PSAwIHx8IGxheWVycy5sZW5ndGggPiBzZWxmLmNhcGFiaWxpdGllcy5tYXhMYXllcnMpIHsKICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0ludmFsaWQgbnVtYmVyIG9mIGxheWVycy4nKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHZhciBpbmNvbWluZ0xheWVyID0gbGF5ZXJzWzBdOwogICAgICAgIGlmICghaW5jb21pbmdMYXllci5zb3VyY2UpIHsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGxlZnRCb3VuZHMgPSBpbmNvbWluZ0xheWVyLmxlZnRCb3VuZHMgfHwgZGVmYXVsdExlZnRCb3VuZHM7CiAgICAgICAgdmFyIHJpZ2h0Qm91bmRzID0gaW5jb21pbmdMYXllci5yaWdodEJvdW5kcyB8fCBkZWZhdWx0UmlnaHRCb3VuZHM7CiAgICAgICAgaWYgKHdhc1ByZXNlbnRpbmcpIHsKICAgICAgICAgIHZhciBsYXllciA9IHNlbGYubGF5ZXJfOwogICAgICAgICAgaWYgKGxheWVyLnNvdXJjZSAhPT0gaW5jb21pbmdMYXllci5zb3VyY2UpIHsKICAgICAgICAgICAgbGF5ZXIuc291cmNlID0gaW5jb21pbmdMYXllci5zb3VyY2U7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgewogICAgICAgICAgICBsYXllci5sZWZ0Qm91bmRzW2ldID0gbGVmdEJvdW5kc1tpXTsKICAgICAgICAgICAgbGF5ZXIucmlnaHRCb3VuZHNbaV0gPSByaWdodEJvdW5kc1tpXTsKICAgICAgICAgIH0KICAgICAgICAgIHNlbGYud3JhcEZvckZ1bGxzY3JlZW4oc2VsZi5sYXllcl8uc291cmNlKTsKICAgICAgICAgIHNlbGYudXBkYXRlUHJlc2VudF8oKTsKICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgc2VsZi5sYXllcl8gPSB7CiAgICAgICAgICBwcmVkaXN0b3J0ZWQ6IGluY29taW5nTGF5ZXIucHJlZGlzdG9ydGVkLAogICAgICAgICAgc291cmNlOiBpbmNvbWluZ0xheWVyLnNvdXJjZSwKICAgICAgICAgIGxlZnRCb3VuZHM6IGxlZnRCb3VuZHMuc2xpY2UoMCksCiAgICAgICAgICByaWdodEJvdW5kczogcmlnaHRCb3VuZHMuc2xpY2UoMCkKICAgICAgICB9OwogICAgICAgIHNlbGYud2FpdGluZ0ZvclByZXNlbnRfID0gZmFsc2U7CiAgICAgICAgaWYgKHNlbGYubGF5ZXJfICYmIHNlbGYubGF5ZXJfLnNvdXJjZSkgewogICAgICAgICAgdmFyIGZ1bGxzY3JlZW5FbGVtZW50ID0gc2VsZi53cmFwRm9yRnVsbHNjcmVlbihzZWxmLmxheWVyXy5zb3VyY2UpOwogICAgICAgICAgdmFyIG9uRnVsbHNjcmVlbkNoYW5nZSA9IGZ1bmN0aW9uIG9uRnVsbHNjcmVlbkNoYW5nZSgpIHsKICAgICAgICAgICAgdmFyIGFjdHVhbEZ1bGxzY3JlZW5FbGVtZW50ID0gZ2V0RnVsbHNjcmVlbkVsZW1lbnQoKTsKICAgICAgICAgICAgc2VsZi5pc1ByZXNlbnRpbmcgPSBmdWxsc2NyZWVuRWxlbWVudCA9PT0gYWN0dWFsRnVsbHNjcmVlbkVsZW1lbnQ7CiAgICAgICAgICAgIGlmIChzZWxmLmlzUHJlc2VudGluZykgewogICAgICAgICAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLmxvY2spIHsKICAgICAgICAgICAgICAgIHNjcmVlbi5vcmllbnRhdGlvbi5sb2NrKCdsYW5kc2NhcGUtcHJpbWFyeScpLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzY3JlZW4ub3JpZW50YXRpb24ubG9jaygpIGZhaWxlZCBkdWUgdG8nLCBlcnJvci5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwogICAgICAgICAgICAgIHNlbGYuYmVnaW5QcmVzZW50XygpOwogICAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpZiAoc2NyZWVuLm9yaWVudGF0aW9uICYmIHNjcmVlbi5vcmllbnRhdGlvbi51bmxvY2spIHsKICAgICAgICAgICAgICAgIHNjcmVlbi5vcmllbnRhdGlvbi51bmxvY2soKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwogICAgICAgICAgICAgIHNlbGYuZGlzYWJsZVdha2VMb2NrKCk7CiAgICAgICAgICAgICAgc2VsZi5lbmRQcmVzZW50XygpOwogICAgICAgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZWxmLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXygpOwogICAgICAgICAgfTsKICAgICAgICAgIHZhciBvbkZ1bGxzY3JlZW5FcnJvciA9IGZ1bmN0aW9uIG9uRnVsbHNjcmVlbkVycm9yKCkgewogICAgICAgICAgICBpZiAoIXNlbGYud2FpdGluZ0ZvclByZXNlbnRfKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbldyYXBwZXIoKTsKICAgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwogICAgICAgICAgICBzZWxmLmRpc2FibGVXYWtlTG9jaygpOwogICAgICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwogICAgICAgICAgICBzZWxmLmlzUHJlc2VudGluZyA9IGZhbHNlOwogICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdVbmFibGUgdG8gcHJlc2VudC4nKSk7CiAgICAgICAgICB9OwogICAgICAgICAgc2VsZi5hZGRGdWxsc2NyZWVuTGlzdGVuZXJzXyhmdWxsc2NyZWVuRWxlbWVudCwgb25GdWxsc2NyZWVuQ2hhbmdlLCBvbkZ1bGxzY3JlZW5FcnJvcik7CiAgICAgICAgICBpZiAocmVxdWVzdEZ1bGxzY3JlZW4oZnVsbHNjcmVlbkVsZW1lbnQpKSB7CiAgICAgICAgICAgIHNlbGYuZW5hYmxlV2FrZUxvY2soKTsKICAgICAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChpc0lPUygpIHx8IGlzV2ViVmlld0FuZHJvaWQoKSkgewogICAgICAgICAgICBzZWxmLmVuYWJsZVdha2VMb2NrKCk7CiAgICAgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gdHJ1ZTsKICAgICAgICAgICAgc2VsZi5iZWdpblByZXNlbnRfKCk7CiAgICAgICAgICAgIHNlbGYuZmlyZVZSRGlzcGxheVByZXNlbnRDaGFuZ2VfKCk7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFzZWxmLndhaXRpbmdGb3JQcmVzZW50XyAmJiAhaXNJT1MoKSkgewogICAgICAgICAgZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1VuYWJsZSB0byBwcmVzZW50LicpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZXhpdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB3YXNQcmVzZW50aW5nID0gdGhpcy5pc1ByZXNlbnRpbmc7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5sYXllcl8gPSBudWxsOwogICAgICB0aGlzLmRpc2FibGVXYWtlTG9jaygpOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIGlmICh3YXNQcmVzZW50aW5nKSB7CiAgICAgICAgICBpZiAoIWV4aXRGdWxsc2NyZWVuKCkgJiYgaXNJT1MoKSkgewogICAgICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CiAgICAgICAgICAgIHNlbGYuZmlyZVZSRGlzcGxheVByZXNlbnRDaGFuZ2VfKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXNXZWJWaWV3QW5kcm9pZCgpKSB7CiAgICAgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbldyYXBwZXIoKTsKICAgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwogICAgICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CiAgICAgICAgICAgIHNlbGYuZmlyZVZSRGlzcGxheVByZXNlbnRDaGFuZ2VfKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1dhcyBub3QgcHJlc2VudGluZyB0byBWUkRpc3BsYXkuJykpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRMYXllcnMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLmxheWVyXykgewogICAgICAgIHJldHVybiBbdGhpcy5sYXllcl9dOwogICAgICB9CiAgICAgIHJldHVybiBbXTsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgeyBkZXRhaWw6IHsgZGlzcGxheTogdGhpcyB9IH0pOwogICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5maXJlVlJEaXNwbGF5Q29ubmVjdF8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBldmVudCA9IG5ldyBDdXN0b21FdmVudCgndnJkaXNwbGF5Y29ubmVjdCcsIHsgZGV0YWlsOiB7IGRpc3BsYXk6IHRoaXMgfSB9KTsKICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuYWRkRnVsbHNjcmVlbkxpc3RlbmVyc18gPSBmdW5jdGlvbiAoZWxlbWVudCwgY2hhbmdlSGFuZGxlciwgZXJyb3JIYW5kbGVyKSB7CiAgICAgIHRoaXMucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKICAgICAgdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfID0gZWxlbWVudDsKICAgICAgdGhpcy5mdWxsc2NyZWVuQ2hhbmdlSGFuZGxlcl8gPSBjaGFuZ2VIYW5kbGVyOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gZXJyb3JIYW5kbGVyOwogICAgICBpZiAoY2hhbmdlSGFuZGxlcikgewogICAgICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQud2Via2l0RnVsbHNjcmVlbkVuYWJsZWQpIHsKICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0ZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbmFibGVkKSB7CiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChlcnJvckhhbmRsZXIpIHsKICAgICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVuYWJsZWQpIHsKICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbmFibGVkKSB7CiAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVuYWJsZWQpIHsKICAgICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbXNmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAoIXRoaXMuZnVsbHNjcmVlbkV2ZW50VGFyZ2V0XykgcmV0dXJuOwogICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZnVsbHNjcmVlbkV2ZW50VGFyZ2V0XzsKICAgICAgaWYgKHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfKSB7CiAgICAgICAgdmFyIGNoYW5nZUhhbmRsZXIgPSB0aGlzLmZ1bGxzY3JlZW5DaGFuZ2VIYW5kbGVyXzsKICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZnVsbHNjcmVlbkVycm9ySGFuZGxlcl8pIHsKICAgICAgICB2YXIgZXJyb3JIYW5kbGVyID0gdGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXzsKICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignd2Via2l0ZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgICB9CiAgICAgIHRoaXMuZnVsbHNjcmVlbkV2ZW50VGFyZ2V0XyA9IG51bGw7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gbnVsbDsKICAgICAgdGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXyA9IG51bGw7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5lbmFibGVXYWtlTG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMud2FrZWxvY2tfKSB7CiAgICAgICAgdGhpcy53YWtlbG9ja18uZW5hYmxlKCk7CiAgICAgIH0KICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmRpc2FibGVXYWtlTG9jayA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMud2FrZWxvY2tfKSB7CiAgICAgICAgdGhpcy53YWtlbG9ja18uZGlzYWJsZSgpOwogICAgICB9CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5iZWdpblByZXNlbnRfID0gZnVuY3Rpb24gKCkgewogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZW5kUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5zdWJtaXRGcmFtZSA9IGZ1bmN0aW9uIChwb3NlKSB7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRFeWVQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKHdoaWNoRXllKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIHZhciBjb25maWcgPSB7CiAgICAgIEFERElUSU9OQUxfVklFV0VSUzogW10sCiAgICAgIERFRkFVTFRfVklFV0VSOiAnJywKICAgICAgTU9CSUxFX1dBS0VfTE9DSzogdHJ1ZSwKICAgICAgREVCVUc6IGZhbHNlLAogICAgICBEUERCX1VSTDogJ2h0dHBzOi8vZHBkYi53ZWJ2ci5yb2Nrcy9kcGRiLmpzb24nLAogICAgICBLX0ZJTFRFUjogMC45OCwKICAgICAgUFJFRElDVElPTl9USU1FX1M6IDAuMDQwLAogICAgICBDQVJEQk9BUkRfVUlfRElTQUJMRUQ6IGZhbHNlLAogICAgICBST1RBVEVfSU5TVFJVQ1RJT05TX0RJU0FCTEVEOiBmYWxzZSwKICAgICAgWUFXX09OTFk6IGZhbHNlLAogICAgICBCVUZGRVJfU0NBTEU6IDAuNSwKICAgICAgRElSVFlfU1VCTUlUX0ZSQU1FX0JJTkRJTkdTOiBmYWxzZQogICAgfTsKICAgIHZhciBFeWUgPSB7CiAgICAgIExFRlQ6ICdsZWZ0JywKICAgICAgUklHSFQ6ICdyaWdodCcKICAgIH07CiAgICBmdW5jdGlvbiBDYXJkYm9hcmRWUkRpc3BsYXkoY29uZmlnJCQxKSB7CiAgICAgIHZhciBkZWZhdWx0cyA9IGV4dGVuZCh7fSwgY29uZmlnKTsKICAgICAgY29uZmlnJCQxID0gZXh0ZW5kKGRlZmF1bHRzLCBjb25maWckJDEgfHwge30pOwogICAgICBWUkRpc3BsYXkuY2FsbCh0aGlzLCB7CiAgICAgICAgd2FrZWxvY2s6IGNvbmZpZyQkMS5NT0JJTEVfV0FLRV9MT0NLCiAgICAgIH0pOwogICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZyQkMTsKICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9ICdDYXJkYm9hcmQgVlJEaXNwbGF5JzsKICAgICAgdGhpcy5jYXBhYmlsaXRpZXMgPSBuZXcgVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKHsKICAgICAgICBoYXNQb3NpdGlvbjogZmFsc2UsCiAgICAgICAgaGFzT3JpZW50YXRpb246IHRydWUsCiAgICAgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiBmYWxzZSwKICAgICAgICBjYW5QcmVzZW50OiB0cnVlLAogICAgICAgIG1heExheWVyczogMQogICAgICB9KTsKICAgICAgdGhpcy5zdGFnZVBhcmFtZXRlcnMgPSBudWxsOwogICAgICB0aGlzLmJ1ZmZlclNjYWxlXyA9IHRoaXMuY29uZmlnLkJVRkZFUl9TQ0FMRTsKICAgICAgdGhpcy5wb3NlU2Vuc29yXyA9IG5ldyBQb3NlU2Vuc29yKHRoaXMuY29uZmlnKTsKICAgICAgdGhpcy5kaXN0b3J0ZXJfID0gbnVsbDsKICAgICAgdGhpcy5jYXJkYm9hcmRVSV8gPSBudWxsOwogICAgICB0aGlzLmRwZGJfID0gbmV3IERwZGIodGhpcy5jb25maWcuRFBEQl9VUkwsIHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkXy5iaW5kKHRoaXMpKTsKICAgICAgdGhpcy5kZXZpY2VJbmZvXyA9IG5ldyBEZXZpY2VJbmZvKHRoaXMuZHBkYl8uZ2V0RGV2aWNlUGFyYW1zKCksIGNvbmZpZyQkMS5BRERJVElPTkFMX1ZJRVdFUlMpOwogICAgICB0aGlzLnZpZXdlclNlbGVjdG9yXyA9IG5ldyBWaWV3ZXJTZWxlY3Rvcihjb25maWckJDEuREVGQVVMVF9WSUVXRVIpOwogICAgICB0aGlzLnZpZXdlclNlbGVjdG9yXy5vbkNoYW5nZSh0aGlzLm9uVmlld2VyQ2hhbmdlZF8uYmluZCh0aGlzKSk7CiAgICAgIHRoaXMuZGV2aWNlSW5mb18uc2V0Vmlld2VyKHRoaXMudmlld2VyU2VsZWN0b3JfLmdldEN1cnJlbnRWaWV3ZXIoKSk7CiAgICAgIGlmICghdGhpcy5jb25maWcuUk9UQVRFX0lOU1RSVUNUSU9OU19ESVNBQkxFRCkgewogICAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXyA9IG5ldyBSb3RhdGVJbnN0cnVjdGlvbnMoKTsKICAgICAgfQogICAgICBpZiAoaXNJT1MoKSkgewogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplXy5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgfQogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVlJEaXNwbGF5LnByb3RvdHlwZSk7CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLl9nZXRQb3NlID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gewogICAgICAgIHBvc2l0aW9uOiBudWxsLAogICAgICAgIG9yaWVudGF0aW9uOiB0aGlzLnBvc2VTZW5zb3JfLmdldE9yaWVudGF0aW9uKCksCiAgICAgICAgbGluZWFyVmVsb2NpdHk6IG51bGwsCiAgICAgICAgbGluZWFyQWNjZWxlcmF0aW9uOiBudWxsLAogICAgICAgIGFuZ3VsYXJWZWxvY2l0eTogbnVsbCwKICAgICAgICBhbmd1bGFyQWNjZWxlcmF0aW9uOiBudWxsCiAgICAgIH07CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5fcmVzZXRQb3NlID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5wb3NlU2Vuc29yXy5yZXNldFBvc2UpIHsKICAgICAgICB0aGlzLnBvc2VTZW5zb3JfLnJlc2V0UG9zZSgpOwogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5fZ2V0RmllbGRPZlZpZXcgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKICAgICAgdmFyIGZpZWxkT2ZWaWV3OwogICAgICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKICAgICAgICBmaWVsZE9mVmlldyA9IHRoaXMuZGV2aWNlSW5mb18uZ2V0RmllbGRPZlZpZXdMZWZ0RXllKCk7CiAgICAgIH0gZWxzZSBpZiAod2hpY2hFeWUgPT0gRXllLlJJR0hUKSB7CiAgICAgICAgZmllbGRPZlZpZXcgPSB0aGlzLmRldmljZUluZm9fLmdldEZpZWxkT2ZWaWV3UmlnaHRFeWUoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGV5ZSBwcm92aWRlZDogJXMnLCB3aGljaEV5ZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIGZpZWxkT2ZWaWV3OwogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX2dldEV5ZU9mZnNldCA9IGZ1bmN0aW9uICh3aGljaEV5ZSkgewogICAgICB2YXIgb2Zmc2V0OwogICAgICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKICAgICAgICBvZmZzZXQgPSBbLXRoaXMuZGV2aWNlSW5mb18udmlld2VyLmludGVyTGVuc0Rpc3RhbmNlICogMC41LCAwLjAsIDAuMF07CiAgICAgIH0gZWxzZSBpZiAod2hpY2hFeWUgPT0gRXllLlJJR0hUKSB7CiAgICAgICAgb2Zmc2V0ID0gW3RoaXMuZGV2aWNlSW5mb18udmlld2VyLmludGVyTGVuc0Rpc3RhbmNlICogMC41LCAwLjAsIDAuMF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBleWUgcHJvdmlkZWQ6ICVzJywgd2hpY2hFeWUpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiBvZmZzZXQ7CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRFeWVQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKHdoaWNoRXllKSB7CiAgICAgIHZhciBvZmZzZXQgPSB0aGlzLl9nZXRFeWVPZmZzZXQod2hpY2hFeWUpOwogICAgICB2YXIgZmllbGRPZlZpZXcgPSB0aGlzLl9nZXRGaWVsZE9mVmlldyh3aGljaEV5ZSk7CiAgICAgIHZhciBleWVQYXJhbXMgPSB7CiAgICAgICAgb2Zmc2V0OiBvZmZzZXQsCiAgICAgICAgcmVuZGVyV2lkdGg6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLndpZHRoICogMC41ICogdGhpcy5idWZmZXJTY2FsZV8sCiAgICAgICAgcmVuZGVySGVpZ2h0OiB0aGlzLmRldmljZUluZm9fLmRldmljZS5oZWlnaHQgKiB0aGlzLmJ1ZmZlclNjYWxlXwogICAgICB9OwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXllUGFyYW1zLCAnZmllbGRPZlZpZXcnLCB7CiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRmllbGRPZlZpZXcnLCAnVlJGcmFtZURhdGFcJ3MgcHJvamVjdGlvbiBtYXRyaWNlcycpOwogICAgICAgICAgcmV0dXJuIGZpZWxkT2ZWaWV3OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBleWVQYXJhbXM7CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbkRldmljZVBhcmFtc1VwZGF0ZWRfID0gZnVuY3Rpb24gKG5ld1BhcmFtcykgewogICAgICBpZiAodGhpcy5jb25maWcuREVCVUcpIHsKICAgICAgICBjb25zb2xlLmxvZygnRFBEQiByZXBvcnRlZCB0aGF0IGRldmljZSBwYXJhbXMgd2VyZSB1cGRhdGVkLicpOwogICAgICB9CiAgICAgIHRoaXMuZGV2aWNlSW5mb18udXBkYXRlRGV2aWNlUGFyYW1zKG5ld1BhcmFtcyk7CiAgICAgIGlmICh0aGlzLmRpc3RvcnRlcl8pIHsKICAgICAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKICAgICAgfQogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUudXBkYXRlQm91bmRzXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMubGF5ZXJfICYmIHRoaXMuZGlzdG9ydGVyXyAmJiAodGhpcy5sYXllcl8ubGVmdEJvdW5kcyB8fCB0aGlzLmxheWVyXy5yaWdodEJvdW5kcykpIHsKICAgICAgICB0aGlzLmRpc3RvcnRlcl8uc2V0VGV4dHVyZUJvdW5kcyh0aGlzLmxheWVyXy5sZWZ0Qm91bmRzLCB0aGlzLmxheWVyXy5yaWdodEJvdW5kcyk7CiAgICAgIH0KICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmJlZ2luUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbCcpOwogICAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKICAgICAgaWYgKCFnbCkgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnd2ViZ2wyJyk7CiAgICAgIGlmICghZ2wpIHJldHVybjsKICAgICAgaWYgKHRoaXMubGF5ZXJfLnByZWRpc3RvcnRlZCkgewogICAgICAgIGlmICghdGhpcy5jb25maWcuQ0FSREJPQVJEX1VJX0RJU0FCTEVEKSB7CiAgICAgICAgICBnbC5jYW52YXMud2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpICogdGhpcy5idWZmZXJTY2FsZV87CiAgICAgICAgICBnbC5jYW52YXMuaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCkgKiB0aGlzLmJ1ZmZlclNjYWxlXzsKICAgICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfID0gbmV3IENhcmRib2FyZFVJKGdsKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5DQVJEQk9BUkRfVUlfRElTQUJMRUQpIHsKICAgICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfID0gbmV3IENhcmRib2FyZFVJKGdsKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5kaXN0b3J0ZXJfID0gbmV3IENhcmRib2FyZERpc3RvcnRlcihnbCwgdGhpcy5jYXJkYm9hcmRVSV8sIHRoaXMuY29uZmlnLkJVRkZFUl9TQ0FMRSwgdGhpcy5jb25maWcuRElSVFlfU1VCTUlUX0ZSQU1FX0JJTkRJTkdTKTsKICAgICAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKICAgICAgfQogICAgICBpZiAodGhpcy5jYXJkYm9hcmRVSV8pIHsKICAgICAgICB0aGlzLmNhcmRib2FyZFVJXy5saXN0ZW4oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHRoaXMudmlld2VyU2VsZWN0b3JfLnNob3codGhpcy5sYXllcl8uc291cmNlLnBhcmVudEVsZW1lbnQpOwogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICB9LmJpbmQodGhpcyksIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICB0aGlzLmV4aXRQcmVzZW50KCk7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0uYmluZCh0aGlzKSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXykgewogICAgICAgIGlmIChpc0xhbmRzY2FwZU1vZGUoKSAmJiBpc01vYmlsZSgpKSB7CiAgICAgICAgICB0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18uc2hvd1RlbXBvcmFyaWx5KDMwMDAsIHRoaXMubGF5ZXJfLnNvdXJjZS5wYXJlbnRFbGVtZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfLnVwZGF0ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLm9yaWVudGF0aW9uSGFuZGxlciA9IHRoaXMub25PcmllbnRhdGlvbkNoYW5nZV8uYmluZCh0aGlzKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIpOwogICAgICB0aGlzLnZyZGlzcGxheXByZXNlbnRjaGFuZ2VIYW5kbGVyID0gdGhpcy51cGRhdGVCb3VuZHNfLmJpbmQodGhpcyk7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgdGhpcy52cmRpc3BsYXlwcmVzZW50Y2hhbmdlSGFuZGxlcik7CiAgICAgIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmVuZFByZXNlbnRfID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CiAgICAgICAgdGhpcy5kaXN0b3J0ZXJfLmRlc3Ryb3koKTsKICAgICAgICB0aGlzLmRpc3RvcnRlcl8gPSBudWxsOwogICAgICB9CiAgICAgIGlmICh0aGlzLmNhcmRib2FyZFVJXykgewogICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfLmRlc3Ryb3koKTsKICAgICAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXykgewogICAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy5oaWRlKCk7CiAgICAgIH0KICAgICAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uaGlkZSgpOwogICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9yaWVudGF0aW9uSGFuZGxlcik7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgdGhpcy52cmRpc3BsYXlwcmVzZW50Y2hhbmdlSGFuZGxlcik7CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS51cGRhdGVQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5lbmRQcmVzZW50XygpOwogICAgICB0aGlzLmJlZ2luUHJlc2VudF8oKTsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKHBvc2UpIHsKICAgICAgaWYgKHRoaXMuZGlzdG9ydGVyXykgewogICAgICAgIHRoaXMudXBkYXRlQm91bmRzXygpOwogICAgICAgIHRoaXMuZGlzdG9ydGVyXy5zdWJtaXRGcmFtZSgpOwogICAgICB9IGVsc2UgaWYgKHRoaXMuY2FyZGJvYXJkVUlfICYmIHRoaXMubGF5ZXJfKSB7CiAgICAgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CiAgICAgICAgaWYgKCFnbCkgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnZXhwZXJpbWVudGFsLXdlYmdsJyk7CiAgICAgICAgaWYgKCFnbCkgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnd2ViZ2wyJyk7CiAgICAgICAgdmFyIGNhbnZhcyA9IGdsLmNhbnZhczsKICAgICAgICBpZiAoY2FudmFzLndpZHRoICE9IHRoaXMubGFzdFdpZHRoIHx8IGNhbnZhcy5oZWlnaHQgIT0gdGhpcy5sYXN0SGVpZ2h0KSB7CiAgICAgICAgICB0aGlzLmNhcmRib2FyZFVJXy5vblJlc2l6ZSgpOwogICAgICAgIH0KICAgICAgICB0aGlzLmxhc3RXaWR0aCA9IGNhbnZhcy53aWR0aDsKICAgICAgICB0aGlzLmxhc3RIZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwogICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfLnJlbmRlcigpOwogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbk9yaWVudGF0aW9uQ2hhbmdlXyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMudmlld2VyU2VsZWN0b3JfLmhpZGUoKTsKICAgICAgaWYgKHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXykgewogICAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKICAgICAgfQogICAgICB0aGlzLm9uUmVzaXplXygpOwogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUub25SZXNpemVfID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKHRoaXMubGF5ZXJfKSB7CiAgICAgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CiAgICAgICAgaWYgKCFnbCkgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnZXhwZXJpbWVudGFsLXdlYmdsJyk7CiAgICAgICAgaWYgKCFnbCkgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnd2ViZ2wyJyk7CiAgICAgICAgdmFyIGNzc1Byb3BlcnRpZXMgPSBbJ3Bvc2l0aW9uOiBhYnNvbHV0ZScsICd0b3A6IDAnLCAnbGVmdDogMCcsCiAgICAgICAgJ3dpZHRoOiAxMDB2dycsICdoZWlnaHQ6IDEwMHZoJywgJ2JvcmRlcjogMCcsICdtYXJnaW46IDAnLAogICAgICAgICdwYWRkaW5nOiAwcHgnLCAnYm94LXNpemluZzogY29udGVudC1ib3gnXTsKICAgICAgICBnbC5jYW52YXMuc2V0QXR0cmlidXRlKCdzdHlsZScsIGNzc1Byb3BlcnRpZXMuam9pbignOyAnKSArICc7Jyk7CiAgICAgICAgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQoZ2wuY2FudmFzKTsKICAgICAgfQogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUub25WaWV3ZXJDaGFuZ2VkXyA9IGZ1bmN0aW9uICh2aWV3ZXIpIHsKICAgICAgdGhpcy5kZXZpY2VJbmZvXy5zZXRWaWV3ZXIodmlld2VyKTsKICAgICAgaWYgKHRoaXMuZGlzdG9ydGVyXykgewogICAgICAgIHRoaXMuZGlzdG9ydGVyXy51cGRhdGVEZXZpY2VJbmZvKHRoaXMuZGV2aWNlSW5mb18pOwogICAgICB9CiAgICAgIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlEZXZpY2VQYXJhbXNDaGFuZ2VfID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheWRldmljZXBhcmFtc2NoYW5nZScsIHsKICAgICAgICBkZXRhaWw6IHsKICAgICAgICAgIHZyZGlzcGxheTogdGhpcywKICAgICAgICAgIGRldmljZUluZm86IHRoaXMuZGV2aWNlSW5mb18KICAgICAgICB9CiAgICAgIH0pOwogICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRnJhbWVEYXRhID0gVlJGcmFtZURhdGE7CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkuVlJEaXNwbGF5ID0gVlJEaXNwbGF5OwogICAgcmV0dXJuIENhcmRib2FyZFZSRGlzcGxheTsKICAgIH0pKSk7CiAgICB9KTsKICAgIHZhciBDYXJkYm9hcmRWUkRpc3BsYXkgPSB1bndyYXBFeHBvcnRzKGNhcmRib2FyZFZyRGlzcGxheSk7CgogICAgY2xhc3MgWFJEZXZpY2UgZXh0ZW5kcyBFdmVudFRhcmdldCB7CiAgICAgIGNvbnN0cnVjdG9yKGdsb2JhbCkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpcy5nbG9iYWwgPSBnbG9iYWw7CiAgICAgICAgdGhpcy5vbldpbmRvd1Jlc2l6ZSA9IHRoaXMub25XaW5kb3dSZXNpemUuYmluZCh0aGlzKTsKICAgICAgICB0aGlzLmdsb2JhbC53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZSk7CiAgICAgICAgdGhpcy5lbnZpcm9ubWVudEJsZW5kTW9kZSA9ICdvcGFxdWUnOwogICAgICB9CiAgICAgIG9uQmFzZUxheWVyU2V0KHNlc3Npb25JZCwgbGF5ZXIpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBpc1Nlc3Npb25TdXBwb3J0ZWQobW9kZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGlzRmVhdHVyZVN1cHBvcnRlZChmZWF0dXJlRGVzY3JpcHRvcikgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGFzeW5jIHJlcXVlc3RTZXNzaW9uKG1vZGUsIGVuYWJsZWRGZWF0dXJlcykgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjaykgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIG9uRnJhbWVTdGFydChzZXNzaW9uSWQpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBvbkZyYW1lRW5kKHNlc3Npb25JZCkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGRvZXNTZXNzaW9uU3VwcG9ydFJlZmVyZW5jZVNwYWNlKHNlc3Npb25JZCwgdHlwZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIHJlcXVlc3RTdGFnZUJvdW5kcygpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBhc3luYyByZXF1ZXN0RnJhbWVPZlJlZmVyZW5jZVRyYW5zZm9ybSh0eXBlLCBvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQogICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShoYW5kbGUpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBlbmRTZXNzaW9uKHNlc3Npb25JZCkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGdldFZpZXdwb3J0KHNlc3Npb25JZCwgZXllLCBsYXllciwgdGFyZ2V0KSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgZ2V0UHJvamVjdGlvbk1hdHJpeChleWUpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBnZXRCYXNlUG9zZU1hdHJpeCgpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBnZXRCYXNlVmlld01hdHJpeChleWUpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBnZXRJbnB1dFNvdXJjZXMoKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgZ2V0SW5wdXRQb3NlKGlucHV0U291cmNlLCBjb29yZGluYXRlU3lzdGVtLCBwb3NlVHlwZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIG9uV2luZG93UmVzaXplKCkgewogICAgICAgIHRoaXMub25XaW5kb3dSZXNpemUoKTsKICAgICAgfQogICAgfQoKICAgIGxldCBkYXlkcmVhbSA9IHsKICAgICAgbWFwcGluZzogJycsCiAgICAgIHByb2ZpbGVzOiBbJ2dvb2dsZS1kYXlkcmVhbScsICdnZW5lcmljLXRyaWdnZXItdG91Y2hwYWQnXSwKICAgICAgYnV0dG9uczogewogICAgICAgIGxlbmd0aDogMywKICAgICAgICAwOiBudWxsLAogICAgICAgIDE6IG51bGwsCiAgICAgICAgMjogMAogICAgICB9LAogICAgfTsKICAgIGxldCB2aXZlRm9jdXMgPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIHByb2ZpbGVzOiBbJ2h0Yy12aXZlLWZvY3VzJywgJ2dlbmVyaWMtdHJpZ2dlci10b3VjaHBhZCddLAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiAzLAogICAgICAgIDA6IDEsCiAgICAgICAgMTogbnVsbCwKICAgICAgICAyOiAwCiAgICAgIH0sCiAgICB9OwogICAgbGV0IG9jdWx1c0dvID0gewogICAgICBtYXBwaW5nOiAneHItc3RhbmRhcmQnLAogICAgICBwcm9maWxlczogWydvY3VsdXMtZ28nLCAnZ2VuZXJpYy10cmlnZ2VyLXRvdWNocGFkJ10sCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICBsZW5ndGg6IDMsCiAgICAgICAgMDogMSwKICAgICAgICAxOiBudWxsLAogICAgICAgIDI6IDAKICAgICAgfSwKICAgICAgZ3JpcFRyYW5zZm9ybTogewogICAgICAgIG9yaWVudGF0aW9uOiBbTWF0aC5QSSAqIDAuMTEsIDAsIDAsIDFdCiAgICAgIH0KICAgIH07CiAgICBsZXQgb2N1bHVzVG91Y2ggPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIGRpc3BsYXlQcm9maWxlczogewogICAgICAgICdPY3VsdXMgUXVlc3QnOiBbJ29jdWx1cy10b3VjaC12MicsICdvY3VsdXMtdG91Y2gnLCAnZ2VuZXJpYy10cmlnZ2VyLXNxdWVlemUtdGh1bWJzdGljayddCiAgICAgIH0sCiAgICAgIHByb2ZpbGVzOiBbJ29jdWx1cy10b3VjaCcsICdnZW5lcmljLXRyaWdnZXItc3F1ZWV6ZS10aHVtYnN0aWNrJ10sCiAgICAgIGF4ZXM6IHsKICAgICAgICBsZW5ndGg6IDQsCiAgICAgICAgMDogbnVsbCwKICAgICAgICAxOiBudWxsLAogICAgICAgIDI6IDAsCiAgICAgICAgMzogMQogICAgICB9LAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiA3LAogICAgICAgIDA6IDEsCiAgICAgICAgMTogMiwKICAgICAgICAyOiBudWxsLAogICAgICAgIDM6IDAsCiAgICAgICAgNDogMywKICAgICAgICA1OiA0LAogICAgICAgIDY6IG51bGwKICAgICAgfSwKICAgICAgZ3JpcFRyYW5zZm9ybTogewogICAgICAgIHBvc2l0aW9uOiBbMCwgLTAuMDIsIDAuMDQsIDFdLAogICAgICAgIG9yaWVudGF0aW9uOiBbTWF0aC5QSSAqIDAuMTEsIDAsIDAsIDFdCiAgICAgIH0KICAgIH07CiAgICBsZXQgb3BlblZyID0gewogICAgICBtYXBwaW5nOiAneHItc3RhbmRhcmQnLAogICAgICBwcm9maWxlczogWydodGMtdml2ZScsICdnZW5lcmljLXRyaWdnZXItc3F1ZWV6ZS10b3VjaHBhZCddLAogICAgICBkaXNwbGF5UHJvZmlsZXM6IHsKICAgICAgICAnSFRDIFZpdmUnOiBbJ2h0Yy12aXZlJywgJ2dlbmVyaWMtdHJpZ2dlci1zcXVlZXplLXRvdWNocGFkJ10sCiAgICAgICAgJ0hUQyBWaXZlIERWVCc6IFsnaHRjLXZpdmUnLCAnZ2VuZXJpYy10cmlnZ2VyLXNxdWVlemUtdG91Y2hwYWQnXSwKICAgICAgICAnVmFsdmUgSW5kZXgnOiBbJ3ZhbHZlLWluZGV4JywgJ2dlbmVyaWMtdHJpZ2dlci1zcXVlZXplLXRvdWNocGFkLXRodW1ic3RpY2snXQogICAgICB9LAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiAzLAogICAgICAgIDA6IDEsCiAgICAgICAgMTogMiwKICAgICAgICAyOiAwCiAgICAgIH0sCiAgICAgIGdyaXBUcmFuc2Zvcm06IHsKICAgICAgICBwb3NpdGlvbjogWzAsIDAsIDAuMDUsIDFdLAogICAgICB9LAogICAgICB0YXJnZXRSYXlUcmFuc2Zvcm06IHsKICAgICAgICBvcmllbnRhdGlvbjogW01hdGguUEkgKiAtMC4wOCwgMCwgMCwgMV0KICAgICAgfSwKICAgICAgdXNlckFnZW50T3ZlcnJpZGVzOiB7CiAgICAgICAgIkZpcmVmb3giOiB7CiAgICAgICAgICBheGVzOiB7CiAgICAgICAgICAgIGludmVydDogWzEsIDNdCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgbGV0IHNhbXN1bmdHZWFyVlIgPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIHByb2ZpbGVzOiBbJ3NhbXN1bmctZ2VhcnZyJywgJ2dlbmVyaWMtdHJpZ2dlci10b3VjaHBhZCddLAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiAzLAogICAgICAgIDA6IDEsCiAgICAgICAgMTogbnVsbCwKICAgICAgICAyOiAwCiAgICAgIH0sCiAgICAgIGdyaXBUcmFuc2Zvcm06IHsKICAgICAgICBvcmllbnRhdGlvbjogW01hdGguUEkgKiAwLjExLCAwLCAwLCAxXQogICAgICB9CiAgICB9OwogICAgbGV0IHNhbXN1bmdPZHlzc2V5ID0gewogICAgICBtYXBwaW5nOiAneHItc3RhbmRhcmQnLAogICAgICBwcm9maWxlczogWydzYW1zdW5nLW9keXNzZXknLCAnbWljcm9zb2Z0LW1peGVkLXJlYWxpdHknLCAnZ2VuZXJpYy10cmlnZ2VyLXNxdWVlemUtdG91Y2hwYWQtdGh1bWJzdGljayddLAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiA0LAogICAgICAgIDA6IDEsCiAgICAgICAgMTogMCwKICAgICAgICAyOiAyLAogICAgICAgIDM6IDQsCiAgICAgIH0sCiAgICAgIGdyaXBUcmFuc2Zvcm06IHsKICAgICAgICBwb3NpdGlvbjogWzAsIC0wLjAyLCAwLjA0LCAxXSwKICAgICAgICBvcmllbnRhdGlvbjogW01hdGguUEkgKiAwLjExLCAwLCAwLCAxXQogICAgICB9CiAgICB9OwogICAgbGV0IHdpbmRvd3NNaXhlZFJlYWxpdHkgPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIHByb2ZpbGVzOiBbJ21pY3Jvc29mdC1taXhlZC1yZWFsaXR5JywgJ2dlbmVyaWMtdHJpZ2dlci1zcXVlZXplLXRvdWNocGFkLXRodW1ic3RpY2snXSwKICAgICAgYnV0dG9uczogewogICAgICAgIGxlbmd0aDogNCwKICAgICAgICAwOiAxLAogICAgICAgIDE6IDAsCiAgICAgICAgMjogMiwKICAgICAgICAzOiA0LAogICAgICB9LAogICAgICBncmlwVHJhbnNmb3JtOiB7CiAgICAgICAgcG9zaXRpb246IFswLCAtMC4wMiwgMC4wNCwgMV0sCiAgICAgICAgb3JpZW50YXRpb246IFtNYXRoLlBJICogMC4xMSwgMCwgMCwgMV0KICAgICAgfQogICAgfTsKICAgIGxldCBHYW1lcGFkTWFwcGluZ3MgPSB7CiAgICAgICdEYXlkcmVhbSBDb250cm9sbGVyJzogZGF5ZHJlYW0sCiAgICAgICdHZWFyIFZSIENvbnRyb2xsZXInOiBzYW1zdW5nR2VhclZSLAogICAgICAnSFRDIFZpdmUgRm9jdXMgQ29udHJvbGxlcic6IHZpdmVGb2N1cywKICAgICAgJ09jdWx1cyBHbyBDb250cm9sbGVyJzogb2N1bHVzR28sCiAgICAgICdPY3VsdXMgVG91Y2ggKFJpZ2h0KSc6IG9jdWx1c1RvdWNoLAogICAgICAnT2N1bHVzIFRvdWNoIChMZWZ0KSc6IG9jdWx1c1RvdWNoLAogICAgICAnT3BlblZSIEdhbWVwYWQnOiBvcGVuVnIsCiAgICAgICdTcGF0aWFsIENvbnRyb2xsZXIgKFNwYXRpYWwgSW50ZXJhY3Rpb24gU291cmNlKSAwNDVFLTA2NUEnOiB3aW5kb3dzTWl4ZWRSZWFsaXR5LAogICAgICAnU3BhdGlhbCBDb250cm9sbGVyIChTcGF0aWFsIEludGVyYWN0aW9uIFNvdXJjZSkgMDQ1RS0wNjVEJzogc2Ftc3VuZ09keXNzZXksCiAgICAgICdXaW5kb3dzIE1peGVkIFJlYWxpdHkgKFJpZ2h0KSc6IHdpbmRvd3NNaXhlZFJlYWxpdHksCiAgICAgICdXaW5kb3dzIE1peGVkIFJlYWxpdHkgKExlZnQpJzogd2luZG93c01peGVkUmVhbGl0eSwKICAgIH07CgogICAgY29uc3QgSEVBRF9FTEJPV19PRkZTRVRfUklHSFRIQU5ERUQgPSBmcm9tVmFsdWVzJDEoMC4xNTUsIC0wLjQ2NSwgLTAuMTUpOwogICAgY29uc3QgSEVBRF9FTEJPV19PRkZTRVRfTEVGVEhBTkRFRCA9IGZyb21WYWx1ZXMkMSgtMC4xNTUsIC0wLjQ2NSwgLTAuMTUpOwogICAgY29uc3QgRUxCT1dfV1JJU1RfT0ZGU0VUID0gZnJvbVZhbHVlcyQxKDAsIDAsIC0wLjI1KTsKICAgIGNvbnN0IFdSSVNUX0NPTlRST0xMRVJfT0ZGU0VUID0gZnJvbVZhbHVlcyQxKDAsIDAsIDAuMDUpOwogICAgY29uc3QgQVJNX0VYVEVOU0lPTl9PRkZTRVQgPSBmcm9tVmFsdWVzJDEoLTAuMDgsIDAuMTQsIDAuMDgpOwogICAgY29uc3QgRUxCT1dfQkVORF9SQVRJTyA9IDAuNDsKICAgIGNvbnN0IEVYVEVOU0lPTl9SQVRJT19XRUlHSFQgPSAwLjQ7CiAgICBjb25zdCBNSU5fQU5HVUxBUl9TUEVFRCA9IDAuNjE7CiAgICBjb25zdCBNSU5fQU5HTEVfREVMVEEgPSAwLjE3NTsKICAgIGNvbnN0IE1JTl9FWFRFTlNJT05fQ09TID0gMC4xMjsKICAgIGNvbnN0IE1BWF9FWFRFTlNJT05fQ09TID0gMC44NzsKICAgIGNvbnN0IFJBRF9UT19ERUcgPSAxODAgLyBNYXRoLlBJOwogICAgZnVuY3Rpb24gZXVsZXJGcm9tUXVhdGVybmlvbihvdXQsIHEsIG9yZGVyKSB7CiAgICAgIGZ1bmN0aW9uIGNsYW1wKHZhbHVlLCBtaW4kJDEsIG1heCQkMSkgewogICAgICAgIHJldHVybiAodmFsdWUgPCBtaW4kJDEgPyBtaW4kJDEgOiAodmFsdWUgPiBtYXgkJDEgPyBtYXgkJDEgOiB2YWx1ZSkpOwogICAgICB9CiAgICAgIHZhciBzcXggPSBxWzBdICogcVswXTsKICAgICAgdmFyIHNxeSA9IHFbMV0gKiBxWzFdOwogICAgICB2YXIgc3F6ID0gcVsyXSAqIHFbMl07CiAgICAgIHZhciBzcXcgPSBxWzNdICogcVszXTsKICAgICAgewogICAgICAgIG91dFswXSA9IE1hdGguYXNpbiggIGNsYW1wKCAyICogKCBxWzBdICogcVszXSAtIHFbMV0gKiBxWzJdICksIC0xLCAxICkgKTsKICAgICAgICBvdXRbMV0gPSBNYXRoLmF0YW4yKCAyICogKCBxWzBdICogcVsyXSArIHFbMV0gKiBxWzNdICksICggc3F3IC0gc3F4IC0gc3F5ICsgc3F6ICkgKTsKICAgICAgICBvdXRbMl0gPSBNYXRoLmF0YW4yKCAyICogKCBxWzBdICogcVsxXSArIHFbMl0gKiBxWzNdICksICggc3F3IC0gc3F4ICsgc3F5IC0gc3F6ICkgKTsKICAgICAgfQogICAgfQogICAgY2xhc3MgT3JpZW50YXRpb25Bcm1Nb2RlbCB7CiAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXMuaGFuZCA9ICdyaWdodCc7CiAgICAgICAgdGhpcy5oZWFkRWxib3dPZmZzZXQgPSBIRUFEX0VMQk9XX09GRlNFVF9SSUdIVEhBTkRFRDsKICAgICAgICB0aGlzLmNvbnRyb2xsZXJRID0gY3JlYXRlJDQoKTsKICAgICAgICB0aGlzLmxhc3RDb250cm9sbGVyUSA9IGNyZWF0ZSQ0KCk7CiAgICAgICAgdGhpcy5oZWFkUSA9IGNyZWF0ZSQ0KCk7CiAgICAgICAgdGhpcy5oZWFkUG9zID0gY3JlYXRlJDEoKTsKICAgICAgICB0aGlzLmVsYm93UG9zID0gY3JlYXRlJDEoKTsKICAgICAgICB0aGlzLndyaXN0UG9zID0gY3JlYXRlJDEoKTsKICAgICAgICB0aGlzLnRpbWUgPSBudWxsOwogICAgICAgIHRoaXMubGFzdFRpbWUgPSBudWxsOwogICAgICAgIHRoaXMucm9vdFEgPSBjcmVhdGUkNCgpOwogICAgICAgIHRoaXMucG9zaXRpb24gPSBjcmVhdGUkMSgpOwogICAgICB9CiAgICAgIHNldEhhbmRlZG5lc3MoaGFuZCkgewogICAgICAgIGlmICh0aGlzLmhhbmQgIT0gaGFuZCkgewogICAgICAgICAgdGhpcy5oYW5kID0gaGFuZDsKICAgICAgICAgIGlmICh0aGlzLmhhbmQgPT0gJ2xlZnQnKSB7CiAgICAgICAgICAgIHRoaXMuaGVhZEVsYm93T2Zmc2V0ID0gSEVBRF9FTEJPV19PRkZTRVRfTEVGVEhBTkRFRDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuaGVhZEVsYm93T2Zmc2V0ID0gSEVBRF9FTEJPV19PRkZTRVRfUklHSFRIQU5ERUQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHVwZGF0ZShjb250cm9sbGVyT3JpZW50YXRpb24sIGhlYWRQb3NlTWF0cml4KSB7CiAgICAgICAgdGhpcy50aW1lID0gbm93JDEoKTsKICAgICAgICBpZiAoY29udHJvbGxlck9yaWVudGF0aW9uKSB7CiAgICAgICAgICBjb3B5JDQodGhpcy5sYXN0Q29udHJvbGxlclEsIHRoaXMuY29udHJvbGxlclEpOwogICAgICAgICAgY29weSQ0KHRoaXMuY29udHJvbGxlclEsIGNvbnRyb2xsZXJPcmllbnRhdGlvbik7CiAgICAgICAgfQogICAgICAgIGlmIChoZWFkUG9zZU1hdHJpeCkgewogICAgICAgICAgZ2V0VHJhbnNsYXRpb24odGhpcy5oZWFkUG9zLCBoZWFkUG9zZU1hdHJpeCk7CiAgICAgICAgICBnZXRSb3RhdGlvbih0aGlzLmhlYWRRLCBoZWFkUG9zZU1hdHJpeCk7CiAgICAgICAgfQogICAgICAgIGxldCBoZWFkWWF3USA9IHRoaXMuZ2V0SGVhZFlhd09yaWVudGF0aW9uXygpOwogICAgICAgIGxldCBhbmdsZURlbHRhID0gdGhpcy5xdWF0QW5nbGVfKHRoaXMubGFzdENvbnRyb2xsZXJRLCB0aGlzLmNvbnRyb2xsZXJRKTsKICAgICAgICBsZXQgdGltZURlbHRhID0gKHRoaXMudGltZSAtIHRoaXMubGFzdFRpbWUpIC8gMTAwMDsKICAgICAgICBsZXQgY29udHJvbGxlckFuZ3VsYXJTcGVlZCA9IGFuZ2xlRGVsdGEgLyB0aW1lRGVsdGE7CiAgICAgICAgaWYgKGNvbnRyb2xsZXJBbmd1bGFyU3BlZWQgPiBNSU5fQU5HVUxBUl9TUEVFRCkgewogICAgICAgICAgc2xlcnAodGhpcy5yb290USwgdGhpcy5yb290USwgaGVhZFlhd1EsCiAgICAgICAgICAgICAgICAgICAgIE1hdGgubWluKGFuZ2xlRGVsdGEgLyBNSU5fQU5HTEVfREVMVEEsIDEuMCkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb3B5JDQodGhpcy5yb290USwgaGVhZFlhd1EpOwogICAgICAgIH0KICAgICAgICBsZXQgY29udHJvbGxlckZvcndhcmQgPSBmcm9tVmFsdWVzJDEoMCwgMCwgLTEpOwogICAgICAgIHRyYW5zZm9ybVF1YXQoY29udHJvbGxlckZvcndhcmQsIGNvbnRyb2xsZXJGb3J3YXJkLCB0aGlzLmNvbnRyb2xsZXJRKTsKICAgICAgICBsZXQgY29udHJvbGxlckRvdFkgPSBkb3QoY29udHJvbGxlckZvcndhcmQsIFswLCAxLCAwXSk7CiAgICAgICAgbGV0IGV4dGVuc2lvblJhdGlvID0gdGhpcy5jbGFtcF8oCiAgICAgICAgICAgIChjb250cm9sbGVyRG90WSAtIE1JTl9FWFRFTlNJT05fQ09TKSAvIE1BWF9FWFRFTlNJT05fQ09TLCAwLjAsIDEuMCk7CiAgICAgICAgbGV0IGNvbnRyb2xsZXJDYW1lcmFRID0gY2xvbmUkNCh0aGlzLnJvb3RRKTsKICAgICAgICBpbnZlcnQkMihjb250cm9sbGVyQ2FtZXJhUSwgY29udHJvbGxlckNhbWVyYVEpOwogICAgICAgIG11bHRpcGx5JDQoY29udHJvbGxlckNhbWVyYVEsIGNvbnRyb2xsZXJDYW1lcmFRLCB0aGlzLmNvbnRyb2xsZXJRKTsKICAgICAgICBsZXQgZWxib3dQb3MgPSB0aGlzLmVsYm93UG9zOwogICAgICAgIGNvcHkkMShlbGJvd1BvcywgdGhpcy5oZWFkUG9zKTsKICAgICAgICBhZGQkMShlbGJvd1BvcywgZWxib3dQb3MsIHRoaXMuaGVhZEVsYm93T2Zmc2V0KTsKICAgICAgICBsZXQgZWxib3dPZmZzZXQgPSBjbG9uZSQxKEFSTV9FWFRFTlNJT05fT0ZGU0VUKTsKICAgICAgICBzY2FsZSQxKGVsYm93T2Zmc2V0LCBlbGJvd09mZnNldCwgZXh0ZW5zaW9uUmF0aW8pOwogICAgICAgIGFkZCQxKGVsYm93UG9zLCBlbGJvd1BvcywgZWxib3dPZmZzZXQpOwogICAgICAgIGxldCB0b3RhbEFuZ2xlID0gdGhpcy5xdWF0QW5nbGVfKGNvbnRyb2xsZXJDYW1lcmFRLCBjcmVhdGUkNCgpKTsKICAgICAgICBsZXQgdG90YWxBbmdsZURlZyA9IHRvdGFsQW5nbGUgKiBSQURfVE9fREVHOwogICAgICAgIGxldCBsZXJwU3VwcHJlc3Npb24gPSAxIC0gTWF0aC5wb3codG90YWxBbmdsZURlZyAvIDE4MCwgNCk7bGV0IGVsYm93UmF0aW8gPSBFTEJPV19CRU5EX1JBVElPOwogICAgICAgIGxldCB3cmlzdFJhdGlvID0gMSAtIEVMQk9XX0JFTkRfUkFUSU87CiAgICAgICAgbGV0IGxlcnBWYWx1ZSA9IGxlcnBTdXBwcmVzc2lvbiAqCiAgICAgICAgICAgIChlbGJvd1JhdGlvICsgd3Jpc3RSYXRpbyAqIGV4dGVuc2lvblJhdGlvICogRVhURU5TSU9OX1JBVElPX1dFSUdIVCk7CiAgICAgICAgbGV0IHdyaXN0USA9IGNyZWF0ZSQ0KCk7CiAgICAgICAgc2xlcnAod3Jpc3RRLCB3cmlzdFEsIGNvbnRyb2xsZXJDYW1lcmFRLCBsZXJwVmFsdWUpOwogICAgICAgIGxldCBpbnZXcmlzdFEgPSBpbnZlcnQkMihjcmVhdGUkNCgpLCB3cmlzdFEpOwogICAgICAgIGxldCBlbGJvd1EgPSBjbG9uZSQ0KGNvbnRyb2xsZXJDYW1lcmFRKTsKICAgICAgICBtdWx0aXBseSQ0KGVsYm93USwgZWxib3dRLCBpbnZXcmlzdFEpOwogICAgICAgIGxldCB3cmlzdFBvcyA9IHRoaXMud3Jpc3RQb3M7CiAgICAgICAgY29weSQxKHdyaXN0UG9zLCBXUklTVF9DT05UUk9MTEVSX09GRlNFVCk7CiAgICAgICAgdHJhbnNmb3JtUXVhdCh3cmlzdFBvcywgd3Jpc3RQb3MsIHdyaXN0USk7CiAgICAgICAgYWRkJDEod3Jpc3RQb3MsIHdyaXN0UG9zLCBFTEJPV19XUklTVF9PRkZTRVQpOwogICAgICAgIHRyYW5zZm9ybVF1YXQod3Jpc3RQb3MsIHdyaXN0UG9zLCBlbGJvd1EpOwogICAgICAgIGFkZCQxKHdyaXN0UG9zLCB3cmlzdFBvcywgZWxib3dQb3MpOwogICAgICAgIGxldCBvZmZzZXQgPSBjbG9uZSQxKEFSTV9FWFRFTlNJT05fT0ZGU0VUKTsKICAgICAgICBzY2FsZSQxKG9mZnNldCwgb2Zmc2V0LCBleHRlbnNpb25SYXRpbyk7CiAgICAgICAgYWRkJDEodGhpcy5wb3NpdGlvbiwgdGhpcy53cmlzdFBvcywgb2Zmc2V0KTsKICAgICAgICB0cmFuc2Zvcm1RdWF0KHRoaXMucG9zaXRpb24sIHRoaXMucG9zaXRpb24sIHRoaXMucm9vdFEpOwogICAgICAgIHRoaXMubGFzdFRpbWUgPSB0aGlzLnRpbWU7CiAgICAgIH0KICAgICAgZ2V0UG9zaXRpb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb247CiAgICAgIH0KICAgICAgZ2V0SGVhZFlhd09yaWVudGF0aW9uXygpIHsKICAgICAgICBsZXQgaGVhZEV1bGVyID0gY3JlYXRlJDEoKTsKICAgICAgICBldWxlckZyb21RdWF0ZXJuaW9uKGhlYWRFdWxlciwgdGhpcy5oZWFkUSk7CiAgICAgICAgbGV0IGRlc3RpbmF0aW9uUSA9IGZyb21FdWxlcihjcmVhdGUkNCgpLCAwLCBoZWFkRXVsZXJbMV0gKiBSQURfVE9fREVHLCAwKTsKICAgICAgICByZXR1cm4gZGVzdGluYXRpb25ROwogICAgICB9CiAgICAgIGNsYW1wXyh2YWx1ZSwgbWluJCQxLCBtYXgkJDEpIHsKICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgodmFsdWUsIG1pbiQkMSksIG1heCQkMSk7CiAgICAgIH0KICAgICAgcXVhdEFuZ2xlXyhxMSwgcTIpIHsKICAgICAgICBsZXQgdmVjMSA9IFswLCAwLCAtMV07CiAgICAgICAgbGV0IHZlYzIgPSBbMCwgMCwgLTFdOwogICAgICAgIHRyYW5zZm9ybVF1YXQodmVjMSwgdmVjMSwgcTEpOwogICAgICAgIHRyYW5zZm9ybVF1YXQodmVjMiwgdmVjMiwgcTIpOwogICAgICAgIHJldHVybiBhbmdsZSh2ZWMxLCB2ZWMyKTsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkMTggPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJSZW1hcHBlZEdhbWVwYWQnKTsKICAgIGNvbnN0IFBMQUNFSE9MREVSX0JVVFRPTiA9IHsgcHJlc3NlZDogZmFsc2UsIHRvdWNoZWQ6IGZhbHNlLCB2YWx1ZTogMC4wIH07CiAgICBPYmplY3QuZnJlZXplKFBMQUNFSE9MREVSX0JVVFRPTik7CiAgICBjbGFzcyBYUlJlbWFwcGVkR2FtZXBhZCB7CiAgICAgIGNvbnN0cnVjdG9yKGdhbWVwYWQsIGRpc3BsYXksIG1hcCkgewogICAgICAgIGlmICghbWFwKSB7CiAgICAgICAgICBtYXAgPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKG1hcC51c2VyQWdlbnRPdmVycmlkZXMpIHsKICAgICAgICAgIGZvciAobGV0IGFnZW50IGluIG1hcC51c2VyQWdlbnRPdmVycmlkZXMpIHsKICAgICAgICAgICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoYWdlbnQpKSB7CiAgICAgICAgICAgICAgbGV0IG92ZXJyaWRlID0gbWFwLnVzZXJBZ2VudE92ZXJyaWRlc1thZ2VudF07CiAgICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG92ZXJyaWRlKSB7CiAgICAgICAgICAgICAgICBpZiAoa2V5IGluIG1hcCkgewogICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG1hcFtrZXldLCBvdmVycmlkZVtrZXldKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG1hcFtrZXldID0gb3ZlcnJpZGVba2V5XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGV0IGF4ZXMgPSBuZXcgQXJyYXkobWFwLmF4ZXMgJiYgbWFwLmF4ZXMubGVuZ3RoID8gbWFwLmF4ZXMubGVuZ3RoIDogZ2FtZXBhZC5heGVzLmxlbmd0aCk7CiAgICAgICAgbGV0IGJ1dHRvbnMgPSBuZXcgQXJyYXkobWFwLmJ1dHRvbnMgJiYgbWFwLmJ1dHRvbnMubGVuZ3RoID8gbWFwLmJ1dHRvbnMubGVuZ3RoIDogZ2FtZXBhZC5idXR0b25zLmxlbmd0aCk7CiAgICAgICAgbGV0IGdyaXBUcmFuc2Zvcm0gPSBudWxsOwogICAgICAgIGlmIChtYXAuZ3JpcFRyYW5zZm9ybSkgewogICAgICAgICAgbGV0IG9yaWVudGF0aW9uID0gbWFwLmdyaXBUcmFuc2Zvcm0ub3JpZW50YXRpb24gfHwgWzAsIDAsIDAsIDFdOwogICAgICAgICAgZ3JpcFRyYW5zZm9ybSA9IGNyZWF0ZSgpOwogICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24oCiAgICAgICAgICAgIGdyaXBUcmFuc2Zvcm0sCiAgICAgICAgICAgIG5vcm1hbGl6ZSQyKG9yaWVudGF0aW9uLCBvcmllbnRhdGlvbiksCiAgICAgICAgICAgIG1hcC5ncmlwVHJhbnNmb3JtLnBvc2l0aW9uIHx8IFswLCAwLCAwXQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbGV0IHRhcmdldFJheVRyYW5zZm9ybSA9IG51bGw7CiAgICAgICAgaWYgKG1hcC50YXJnZXRSYXlUcmFuc2Zvcm0pIHsKICAgICAgICAgIGxldCBvcmllbnRhdGlvbiA9ICBtYXAudGFyZ2V0UmF5VHJhbnNmb3JtLm9yaWVudGF0aW9uIHx8IFswLCAwLCAwLCAxXTsKICAgICAgICAgIHRhcmdldFJheVRyYW5zZm9ybSA9IGNyZWF0ZSgpOwogICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24oCiAgICAgICAgICAgIHRhcmdldFJheVRyYW5zZm9ybSwKICAgICAgICAgICAgbm9ybWFsaXplJDIob3JpZW50YXRpb24sIG9yaWVudGF0aW9uKSwKICAgICAgICAgICAgbWFwLnRhcmdldFJheVRyYW5zZm9ybS5wb3NpdGlvbiB8fCBbMCwgMCwgMF0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGxldCBwcm9maWxlcyA9IG1hcC5wcm9maWxlczsKICAgICAgICBpZiAobWFwLmRpc3BsYXlQcm9maWxlcykgewogICAgICAgICAgaWYgKGRpc3BsYXkuZGlzcGxheU5hbWUgaW4gbWFwLmRpc3BsYXlQcm9maWxlcykgewogICAgICAgICAgICBwcm9maWxlcyA9IG1hcC5kaXNwbGF5UHJvZmlsZXNbZGlzcGxheS5kaXNwbGF5TmFtZV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXNbUFJJVkFURSQxOF0gPSB7CiAgICAgICAgICBnYW1lcGFkLAogICAgICAgICAgbWFwLAogICAgICAgICAgcHJvZmlsZXM6IHByb2ZpbGVzIHx8IFtnYW1lcGFkLmlkXSwKICAgICAgICAgIG1hcHBpbmc6IG1hcC5tYXBwaW5nIHx8IGdhbWVwYWQubWFwcGluZywKICAgICAgICAgIGF4ZXMsCiAgICAgICAgICBidXR0b25zLAogICAgICAgICAgZ3JpcFRyYW5zZm9ybSwKICAgICAgICAgIHRhcmdldFJheVRyYW5zZm9ybSwKICAgICAgICB9OwogICAgICAgIHRoaXMuX3VwZGF0ZSgpOwogICAgICB9CiAgICAgIF91cGRhdGUoKSB7CiAgICAgICAgbGV0IGdhbWVwYWQgPSB0aGlzW1BSSVZBVEUkMThdLmdhbWVwYWQ7CiAgICAgICAgbGV0IG1hcCA9IHRoaXNbUFJJVkFURSQxOF0ubWFwOwogICAgICAgIGxldCBheGVzID0gdGhpc1tQUklWQVRFJDE4XS5heGVzOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhlcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKG1hcC5heGVzICYmIGkgaW4gbWFwLmF4ZXMpIHsKICAgICAgICAgICAgaWYgKG1hcC5heGVzW2ldID09PSBudWxsKSB7CiAgICAgICAgICAgICAgYXhlc1tpXSA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgYXhlc1tpXSA9IGdhbWVwYWQuYXhlc1ttYXAuYXhlc1tpXV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGF4ZXNbaV0gPSBnYW1lcGFkLmF4ZXNbaV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChtYXAuYXhlcyAmJiBtYXAuYXhlcy5pbnZlcnQpIHsKICAgICAgICAgIGZvciAobGV0IGF4aXMgb2YgbWFwLmF4ZXMuaW52ZXJ0KSB7CiAgICAgICAgICAgIGlmIChheGlzIDwgYXhlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICBheGVzW2F4aXNdICo9IC0xOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxldCBidXR0b25zID0gdGhpc1tQUklWQVRFJDE4XS5idXR0b25zOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnV0dG9ucy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKG1hcC5idXR0b25zICYmIGkgaW4gbWFwLmJ1dHRvbnMpIHsKICAgICAgICAgICAgaWYgKG1hcC5idXR0b25zW2ldID09PSBudWxsKSB7CiAgICAgICAgICAgICAgYnV0dG9uc1tpXSA9IFBMQUNFSE9MREVSX0JVVFRPTjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBidXR0b25zW2ldID0gZ2FtZXBhZC5idXR0b25zW21hcC5idXR0b25zW2ldXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnV0dG9uc1tpXSA9IGdhbWVwYWQuYnV0dG9uc1tpXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZ2V0IGlkKCkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgICBnZXQgX3Byb2ZpbGVzKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMThdLnByb2ZpbGVzOwogICAgICB9CiAgICAgIGdldCBpbmRleCgpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgZ2V0IGNvbm5lY3RlZCgpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE4XS5nYW1lcGFkLmNvbm5lY3RlZDsKICAgICAgfQogICAgICBnZXQgdGltZXN0YW1wKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMThdLmdhbWVwYWQudGltZXN0YW1wOwogICAgICB9CiAgICAgIGdldCBtYXBwaW5nKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMThdLm1hcHBpbmc7CiAgICAgIH0KICAgICAgZ2V0IGF4ZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxOF0uYXhlczsKICAgICAgfQogICAgICBnZXQgYnV0dG9ucygpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE4XS5idXR0b25zOwogICAgICB9CiAgICAgIGdldCBoYXB0aWNBY3R1YXRvcnMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxOF0uZ2FtZXBhZC5oYXB0aWNBY3R1YXRvcnM7CiAgICAgIH0KICAgIH0KICAgIGNsYXNzIEdhbWVwYWRYUklucHV0U291cmNlIHsKICAgICAgY29uc3RydWN0b3IocG9seWZpbGwsIGRpc3BsYXksIHByaW1hcnlCdXR0b25JbmRleCA9IDAsIHByaW1hcnlTcXVlZXplQnV0dG9uSW5kZXggPSAtMSkgewogICAgICAgIHRoaXMucG9seWZpbGwgPSBwb2x5ZmlsbDsKICAgICAgICB0aGlzLmRpc3BsYXkgPSBkaXNwbGF5OwogICAgICAgIHRoaXMubmF0aXZlR2FtZXBhZCA9IG51bGw7CiAgICAgICAgdGhpcy5nYW1lcGFkID0gbnVsbDsKICAgICAgICB0aGlzLmlucHV0U291cmNlID0gbmV3IFhSSW5wdXRTb3VyY2UodGhpcyk7CiAgICAgICAgdGhpcy5sYXN0UG9zaXRpb24gPSBjcmVhdGUkMSgpOwogICAgICAgIHRoaXMuZW11bGF0ZWRQb3NpdGlvbiA9IGZhbHNlOwogICAgICAgIHRoaXMuYmFzZVBvc2VNYXRyaXggPSBjcmVhdGUoKTsKICAgICAgICB0aGlzLm91dHB1dE1hdHJpeCA9IGNyZWF0ZSgpOwogICAgICAgIHRoaXMucHJpbWFyeUJ1dHRvbkluZGV4ID0gcHJpbWFyeUJ1dHRvbkluZGV4OwogICAgICAgIHRoaXMucHJpbWFyeUFjdGlvblByZXNzZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLnByaW1hcnlTcXVlZXplQnV0dG9uSW5kZXggPSBwcmltYXJ5U3F1ZWV6ZUJ1dHRvbkluZGV4OwogICAgICAgIHRoaXMucHJpbWFyeVNxdWVlemVBY3Rpb25QcmVzc2VkID0gZmFsc2U7CiAgICAgICAgdGhpcy5oYW5kZWRuZXNzID0gJyc7CiAgICAgICAgdGhpcy50YXJnZXRSYXlNb2RlID0gJ2dhemUnOwogICAgICAgIHRoaXMuYXJtTW9kZWwgPSBudWxsOwogICAgICB9CiAgICAgIGdldCBwcm9maWxlcygpIHsKICAgICAgICByZXR1cm4gdGhpcy5nYW1lcGFkID8gdGhpcy5nYW1lcGFkLl9wcm9maWxlcyA6IFtdOwogICAgICB9CiAgICAgIHVwZGF0ZUZyb21HYW1lcGFkKGdhbWVwYWQpIHsKICAgICAgICBpZiAodGhpcy5uYXRpdmVHYW1lcGFkICE9PSBnYW1lcGFkKSB7CiAgICAgICAgICB0aGlzLm5hdGl2ZUdhbWVwYWQgPSBnYW1lcGFkOwogICAgICAgICAgaWYgKGdhbWVwYWQpIHsKICAgICAgICAgICAgdGhpcy5nYW1lcGFkID0gbmV3IFhSUmVtYXBwZWRHYW1lcGFkKGdhbWVwYWQsIHRoaXMuZGlzcGxheSwgR2FtZXBhZE1hcHBpbmdzW2dhbWVwYWQuaWRdKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZ2FtZXBhZCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuaGFuZGVkbmVzcyA9IGdhbWVwYWQuaGFuZCA9PT0gJycgPyAnbm9uZScgOiBnYW1lcGFkLmhhbmQ7CiAgICAgICAgaWYgKHRoaXMuZ2FtZXBhZCkgewogICAgICAgICAgdGhpcy5nYW1lcGFkLl91cGRhdGUoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGdhbWVwYWQucG9zZSkgewogICAgICAgICAgdGhpcy50YXJnZXRSYXlNb2RlID0gJ3RyYWNrZWQtcG9pbnRlcic7CiAgICAgICAgICB0aGlzLmVtdWxhdGVkUG9zaXRpb24gPSAhZ2FtZXBhZC5wb3NlLmhhc1Bvc2l0aW9uOwogICAgICAgIH0gZWxzZSBpZiAoZ2FtZXBhZC5oYW5kID09PSAnJykgewogICAgICAgICAgdGhpcy50YXJnZXRSYXlNb2RlID0gJ2dhemUnOwogICAgICAgICAgdGhpcy5lbXVsYXRlZFBvc2l0aW9uID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHVwZGF0ZUJhc2VQb3NlTWF0cml4KCkgewogICAgICAgIGlmICh0aGlzLm5hdGl2ZUdhbWVwYWQgJiYgdGhpcy5uYXRpdmVHYW1lcGFkLnBvc2UpIHsKICAgICAgICAgIGxldCBwb3NlID0gdGhpcy5uYXRpdmVHYW1lcGFkLnBvc2U7CiAgICAgICAgICBsZXQgcG9zaXRpb24gPSBwb3NlLnBvc2l0aW9uOwogICAgICAgICAgbGV0IG9yaWVudGF0aW9uID0gcG9zZS5vcmllbnRhdGlvbjsKICAgICAgICAgIGlmICghcG9zaXRpb24gJiYgIW9yaWVudGF0aW9uKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghcG9zaXRpb24pIHsKICAgICAgICAgICAgaWYgKCFwb3NlLmhhc1Bvc2l0aW9uKSB7CiAgICAgICAgICAgICAgaWYgKCF0aGlzLmFybU1vZGVsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFybU1vZGVsID0gbmV3IE9yaWVudGF0aW9uQXJtTW9kZWwoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5hcm1Nb2RlbC5zZXRIYW5kZWRuZXNzKHRoaXMubmF0aXZlR2FtZXBhZC5oYW5kKTsKICAgICAgICAgICAgICB0aGlzLmFybU1vZGVsLnVwZGF0ZShvcmllbnRhdGlvbiwgdGhpcy5wb2x5ZmlsbC5nZXRCYXNlUG9zZU1hdHJpeCgpKTsKICAgICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMuYXJtTW9kZWwuZ2V0UG9zaXRpb24oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMubGFzdFBvc2l0aW9uOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmxhc3RQb3NpdGlvblswXSA9IHBvc2l0aW9uWzBdOwogICAgICAgICAgICB0aGlzLmxhc3RQb3NpdGlvblsxXSA9IHBvc2l0aW9uWzFdOwogICAgICAgICAgICB0aGlzLmxhc3RQb3NpdGlvblsyXSA9IHBvc2l0aW9uWzJdOwogICAgICAgICAgfQogICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24odGhpcy5iYXNlUG9zZU1hdHJpeCwgb3JpZW50YXRpb24sIHBvc2l0aW9uKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29weSh0aGlzLmJhc2VQb3NlTWF0cml4LCB0aGlzLnBvbHlmaWxsLmdldEJhc2VQb3NlTWF0cml4KCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5iYXNlUG9zZU1hdHJpeDsKICAgICAgfQogICAgICBnZXRYUlBvc2UoY29vcmRpbmF0ZVN5c3RlbSwgcG9zZVR5cGUpIHsKICAgICAgICB0aGlzLnVwZGF0ZUJhc2VQb3NlTWF0cml4KCk7CiAgICAgICAgc3dpdGNoKHBvc2VUeXBlKSB7CiAgICAgICAgICBjYXNlICJ0YXJnZXQtcmF5IjoKICAgICAgICAgICAgY29vcmRpbmF0ZVN5c3RlbS5fdHJhbnNmb3JtQmFzZVBvc2VNYXRyaXgodGhpcy5vdXRwdXRNYXRyaXgsIHRoaXMuYmFzZVBvc2VNYXRyaXgpOwogICAgICAgICAgICBpZiAodGhpcy5nYW1lcGFkICYmIHRoaXMuZ2FtZXBhZFtQUklWQVRFJDE4XS50YXJnZXRSYXlUcmFuc2Zvcm0pIHsKICAgICAgICAgICAgICBtdWx0aXBseSh0aGlzLm91dHB1dE1hdHJpeCwgdGhpcy5vdXRwdXRNYXRyaXgsIHRoaXMuZ2FtZXBhZFtQUklWQVRFJDE4XS50YXJnZXRSYXlUcmFuc2Zvcm0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiZ3JpcCI6CiAgICAgICAgICAgIGlmICghdGhpcy5uYXRpdmVHYW1lcGFkIHx8ICF0aGlzLm5hdGl2ZUdhbWVwYWQucG9zZSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvb3JkaW5hdGVTeXN0ZW0uX3RyYW5zZm9ybUJhc2VQb3NlTWF0cml4KHRoaXMub3V0cHV0TWF0cml4LCB0aGlzLmJhc2VQb3NlTWF0cml4KTsKICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZXBhZCAmJiB0aGlzLmdhbWVwYWRbUFJJVkFURSQxOF0uZ3JpcFRyYW5zZm9ybSkgewogICAgICAgICAgICAgIG11bHRpcGx5KHRoaXMub3V0cHV0TWF0cml4LCB0aGlzLm91dHB1dE1hdHJpeCwgdGhpcy5nYW1lcGFkW1BSSVZBVEUkMThdLmdyaXBUcmFuc2Zvcm0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGNvb3JkaW5hdGVTeXN0ZW0uX2FkanVzdEZvck9yaWdpbk9mZnNldCh0aGlzLm91dHB1dE1hdHJpeCk7CiAgICAgICAgcmV0dXJuIG5ldyBYUlBvc2UobmV3IFhSUmlnaWRUcmFuc2Zvcm0odGhpcy5vdXRwdXRNYXRyaXgpLCB0aGlzLmVtdWxhdGVkUG9zaXRpb24pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBFWFRSQV9QUkVTRU5UQVRJT05fQVRUUklCVVRFUyA9IHsKICAgICAgaGlnaFJlZnJlc2hSYXRlOiB0cnVlLAogICAgfTsKICAgIGNvbnN0IFBSSU1BUllfQlVUVE9OX01BUCA9IHsKICAgICAgb2N1bHVzOiAxLAogICAgICBvcGVudnI6IDEsCiAgICAgICdzcGF0aWFsIGNvbnRyb2xsZXIgKHNwYXRpYWwgaW50ZXJhY3Rpb24gc291cmNlKSc6IDEKICAgIH07CiAgICBsZXQgU0VTU0lPTl9JRCA9IDA7CiAgICBjbGFzcyBTZXNzaW9uIHsKICAgICAgY29uc3RydWN0b3IobW9kZSwgZW5hYmxlZEZlYXR1cmVzLCBwb2x5ZmlsbE9wdGlvbnM9e30pIHsKICAgICAgICB0aGlzLm1vZGUgPSBtb2RlOwogICAgICAgIHRoaXMuZW5hYmxlZEZlYXR1cmVzID0gZW5hYmxlZEZlYXR1cmVzOwogICAgICAgIHRoaXMub3V0cHV0Q29udGV4dCA9IG51bGw7CiAgICAgICAgdGhpcy5pbW1lcnNpdmUgPSBtb2RlID09ICdpbW1lcnNpdmUtdnInIHx8IG1vZGUgPT0gJ2ltbWVyc2l2ZS1hcic7CiAgICAgICAgdGhpcy5lbmRlZCA9IG51bGw7CiAgICAgICAgdGhpcy5iYXNlTGF5ZXIgPSBudWxsOwogICAgICAgIHRoaXMuaWQgPSArK1NFU1NJT05fSUQ7CiAgICAgICAgdGhpcy5tb2RpZmllZENhbnZhc0xheWVyID0gZmFsc2U7CiAgICAgICAgaWYgKHRoaXMub3V0cHV0Q29udGV4dCAmJiB0cnVlKSB7CiAgICAgICAgICBjb25zdCByZW5kZXJDb250ZXh0VHlwZSA9IHBvbHlmaWxsT3B0aW9ucy5yZW5kZXJDb250ZXh0VHlwZSB8fCAnMmQnOwogICAgICAgICAgdGhpcy5yZW5kZXJDb250ZXh0ID0gdGhpcy5vdXRwdXRDb250ZXh0LmNhbnZhcy5nZXRDb250ZXh0KHJlbmRlckNvbnRleHRUeXBlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNsYXNzIFdlYlZSRGV2aWNlIGV4dGVuZHMgWFJEZXZpY2UgewogICAgICBjb25zdHJ1Y3RvcihnbG9iYWwsIGRpc3BsYXkpIHsKICAgICAgICBjb25zdCB7IGNhblByZXNlbnQgfSA9IGRpc3BsYXkuY2FwYWJpbGl0aWVzOwogICAgICAgIHN1cGVyKGdsb2JhbCk7CiAgICAgICAgdGhpcy5kaXNwbGF5ID0gZGlzcGxheTsKICAgICAgICB0aGlzLmZyYW1lID0gbmV3IGdsb2JhbC5WUkZyYW1lRGF0YSgpOwogICAgICAgIHRoaXMuc2Vzc2lvbnMgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5pbW1lcnNpdmVTZXNzaW9uID0gbnVsbDsKICAgICAgICB0aGlzLmNhblByZXNlbnQgPSBjYW5QcmVzZW50OwogICAgICAgIHRoaXMuYmFzZU1vZGVsTWF0cml4ID0gY3JlYXRlKCk7CiAgICAgICAgdGhpcy5nYW1lcGFkSW5wdXRTb3VyY2VzID0ge307CiAgICAgICAgdGhpcy50ZW1wVmVjMyA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgICAgICAgdGhpcy5vblZSRGlzcGxheVByZXNlbnRDaGFuZ2UgPSB0aGlzLm9uVlJEaXNwbGF5UHJlc2VudENoYW5nZS5iaW5kKHRoaXMpOwogICAgICAgIGdsb2JhbC53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIHRoaXMub25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlKTsKICAgICAgICB0aGlzLkNBTl9VU0VfR0FNRVBBRCA9IGdsb2JhbC5uYXZpZ2F0b3IgJiYgKCdnZXRHYW1lcGFkcycgaW4gZ2xvYmFsLm5hdmlnYXRvcik7CiAgICAgICAgdGhpcy5IQVNfQklUTUFQX1NVUFBPUlQgPSBpc0ltYWdlQml0bWFwU3VwcG9ydGVkKGdsb2JhbCk7CiAgICAgIH0KICAgICAgZ2V0IGRlcHRoTmVhcigpIHsgcmV0dXJuIHRoaXMuZGlzcGxheS5kZXB0aE5lYXI7IH0KICAgICAgc2V0IGRlcHRoTmVhcih2YWwpIHsgdGhpcy5kaXNwbGF5LmRlcHRoTmVhciA9IHZhbDsgfQogICAgICBnZXQgZGVwdGhGYXIoKSB7IHJldHVybiB0aGlzLmRpc3BsYXkuZGVwdGhGYXI7IH0KICAgICAgc2V0IGRlcHRoRmFyKHZhbCkgeyB0aGlzLmRpc3BsYXkuZGVwdGhGYXIgPSB2YWw7IH0KICAgICAgb25CYXNlTGF5ZXJTZXQoc2Vzc2lvbklkLCBsYXllcikgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGNvbnN0IGNhbnZhcyA9IGxheWVyLmNvbnRleHQuY2FudmFzOwogICAgICAgIGlmIChzZXNzaW9uLmltbWVyc2l2ZSkgewogICAgICAgICAgY29uc3QgbGVmdCA9IHRoaXMuZGlzcGxheS5nZXRFeWVQYXJhbWV0ZXJzKCdsZWZ0Jyk7CiAgICAgICAgICBjb25zdCByaWdodCA9IHRoaXMuZGlzcGxheS5nZXRFeWVQYXJhbWV0ZXJzKCdyaWdodCcpOwogICAgICAgICAgY2FudmFzLndpZHRoID0gTWF0aC5tYXgobGVmdC5yZW5kZXJXaWR0aCwgcmlnaHQucmVuZGVyV2lkdGgpICogMjsKICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBNYXRoLm1heChsZWZ0LnJlbmRlckhlaWdodCwgcmlnaHQucmVuZGVySGVpZ2h0KTsKICAgICAgICAgIHRoaXMuZGlzcGxheS5yZXF1ZXN0UHJlc2VudChbewogICAgICAgICAgICAgIHNvdXJjZTogY2FudmFzLCBhdHRyaWJ1dGVzOiBFWFRSQV9QUkVTRU5UQVRJT05fQVRUUklCVVRFUwogICAgICAgICAgICB9XSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgIGlmICghdGhpcy5nbG9iYWwuZG9jdW1lbnQuYm9keS5jb250YWlucyhjYW52YXMpKSB7CiAgICAgICAgICAgICAgc2Vzc2lvbi5tb2RpZmllZENhbnZhc0xheWVyID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLmdsb2JhbC5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7CiAgICAgICAgICAgICAgYXBwbHlDYW52YXNTdHlsZXNGb3JNaW5pbWFsUmVuZGVyaW5nKGNhbnZhcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2Vzc2lvbi5iYXNlTGF5ZXIgPSBsYXllcjsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHNlc3Npb24uYmFzZUxheWVyID0gbGF5ZXI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlzU2Vzc2lvblN1cHBvcnRlZChtb2RlKSB7CiAgICAgICAgaWYgKG1vZGUgPT0gJ2ltbWVyc2l2ZS1hcicpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKG1vZGUgPT0gJ2ltbWVyc2l2ZS12cicgJiYgdGhpcy5jYW5QcmVzZW50ID09PSBmYWxzZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpc0ZlYXR1cmVTdXBwb3J0ZWQoZmVhdHVyZURlc2NyaXB0b3IpIHsKICAgICAgICBzd2l0Y2goZmVhdHVyZURlc2NyaXB0b3IpIHsKICAgICAgICAgIGNhc2UgJ3ZpZXdlcic6IHJldHVybiB0cnVlOwogICAgICAgICAgY2FzZSAnbG9jYWwnOiByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGNhc2UgJ2xvY2FsLWZsb29yJzogcmV0dXJuIHRydWU7CiAgICAgICAgICBjYXNlICdib3VuZGVkJzogcmV0dXJuIGZhbHNlOwogICAgICAgICAgY2FzZSAndW5ib3VuZGVkJzogcmV0dXJuIGZhbHNlOwogICAgICAgICAgZGVmYXVsdDogcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBhc3luYyByZXF1ZXN0U2Vzc2lvbihtb2RlLCBlbmFibGVkRmVhdHVyZXMpIHsKICAgICAgICBpZiAoIXRoaXMuaXNTZXNzaW9uU3VwcG9ydGVkKG1vZGUpKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoKTsKICAgICAgICB9CiAgICAgICAgbGV0IGltbWVyc2l2ZSA9IG1vZGUgPT0gJ2ltbWVyc2l2ZS12cic7CiAgICAgICAgaWYgKGltbWVyc2l2ZSkgewogICAgICAgICAgY29uc3QgY2FudmFzID0gdGhpcy5nbG9iYWwuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICB7CiAgICAgICAgICAgIGNhbnZhcy5nZXRDb250ZXh0KCd3ZWJnbCcpOwogICAgICAgICAgfQogICAgICAgICAgYXdhaXQgdGhpcy5kaXNwbGF5LnJlcXVlc3RQcmVzZW50KFt7CiAgICAgICAgICAgICAgc291cmNlOiBjYW52YXMsIGF0dHJpYnV0ZXM6IEVYVFJBX1BSRVNFTlRBVElPTl9BVFRSSUJVVEVTIH1dKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG5ldyBTZXNzaW9uKG1vZGUsIGVuYWJsZWRGZWF0dXJlcywgewogICAgICAgICAgcmVuZGVyQ29udGV4dFR5cGU6IHRoaXMuSEFTX0JJVE1BUF9TVVBQT1JUID8gJ2JpdG1hcHJlbmRlcmVyJyA6ICcyZCcKICAgICAgICB9KTsKICAgICAgICB0aGlzLnNlc3Npb25zLnNldChzZXNzaW9uLmlkLCBzZXNzaW9uKTsKICAgICAgICBpZiAoaW1tZXJzaXZlKSB7CiAgICAgICAgICB0aGlzLmltbWVyc2l2ZVNlc3Npb24gPSBzZXNzaW9uOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdAQHdlYnhyLXBvbHlmaWxsL3ZyLXByZXNlbnQtc3RhcnQnLCBzZXNzaW9uLmlkKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzZXNzaW9uLmlkKTsKICAgICAgfQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spIHsKICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5LnJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7CiAgICAgIH0KICAgICAgZ2V0UHJpbWFyeUJ1dHRvbkluZGV4KGdhbWVwYWQpIHsKICAgICAgICBsZXQgcHJpbWFyeUJ1dHRvbiA9IDA7CiAgICAgICAgbGV0IG5hbWUgPSBnYW1lcGFkLmlkLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgZm9yIChsZXQga2V5IGluIFBSSU1BUllfQlVUVE9OX01BUCkgewogICAgICAgICAgaWYgKG5hbWUuaW5jbHVkZXMoa2V5KSkgewogICAgICAgICAgICBwcmltYXJ5QnV0dG9uID0gUFJJTUFSWV9CVVRUT05fTUFQW2tleV07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gTWF0aC5taW4ocHJpbWFyeUJ1dHRvbiwgZ2FtZXBhZC5idXR0b25zLmxlbmd0aCAtIDEpOwogICAgICB9CiAgICAgIG9uRnJhbWVTdGFydChzZXNzaW9uSWQsIHJlbmRlclN0YXRlKSB7CiAgICAgICAgdGhpcy5kaXNwbGF5LmRlcHRoTmVhciA9IHJlbmRlclN0YXRlLmRlcHRoTmVhcjsKICAgICAgICB0aGlzLmRpc3BsYXkuZGVwdGhGYXIgPSByZW5kZXJTdGF0ZS5kZXB0aEZhcjsKICAgICAgICB0aGlzLmRpc3BsYXkuZ2V0RnJhbWVEYXRhKHRoaXMuZnJhbWUpOwogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGlmIChzZXNzaW9uLmltbWVyc2l2ZSAmJiB0aGlzLkNBTl9VU0VfR0FNRVBBRCkgewogICAgICAgICAgbGV0IHByZXZJbnB1dFNvdXJjZXMgPSB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXM7CiAgICAgICAgICB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXMgPSB7fTsKICAgICAgICAgIGxldCBnYW1lcGFkcyA9IHRoaXMuZ2xvYmFsLm5hdmlnYXRvci5nZXRHYW1lcGFkcygpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnYW1lcGFkcy5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBsZXQgZ2FtZXBhZCA9IGdhbWVwYWRzW2ldOwogICAgICAgICAgICBpZiAoZ2FtZXBhZCAmJiBnYW1lcGFkLmRpc3BsYXlJZCA+IDApIHsKICAgICAgICAgICAgICBsZXQgaW5wdXRTb3VyY2VJbXBsID0gcHJldklucHV0U291cmNlc1tpXTsKICAgICAgICAgICAgICBpZiAoIWlucHV0U291cmNlSW1wbCkgewogICAgICAgICAgICAgICAgaW5wdXRTb3VyY2VJbXBsID0gbmV3IEdhbWVwYWRYUklucHV0U291cmNlKHRoaXMsIHRoaXMuZGlzcGxheSwgdGhpcy5nZXRQcmltYXJ5QnV0dG9uSW5kZXgoZ2FtZXBhZCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpbnB1dFNvdXJjZUltcGwudXBkYXRlRnJvbUdhbWVwYWQoZ2FtZXBhZCk7CiAgICAgICAgICAgICAgdGhpcy5nYW1lcGFkSW5wdXRTb3VyY2VzW2ldID0gaW5wdXRTb3VyY2VJbXBsOwogICAgICAgICAgICAgIGlmIChpbnB1dFNvdXJjZUltcGwucHJpbWFyeUJ1dHRvbkluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICBsZXQgcHJpbWFyeUFjdGlvblByZXNzZWQgPSBnYW1lcGFkLmJ1dHRvbnNbaW5wdXRTb3VyY2VJbXBsLnByaW1hcnlCdXR0b25JbmRleF0ucHJlc3NlZDsKICAgICAgICAgICAgICAgIGlmIChwcmltYXJ5QWN0aW9uUHJlc3NlZCAmJiAhaW5wdXRTb3VyY2VJbXBsLnByaW1hcnlBY3Rpb25QcmVzc2VkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3Qtc3RhcnQnLCB7IHNlc3Npb25JZDogc2Vzc2lvbi5pZCwgaW5wdXRTb3VyY2U6IGlucHV0U291cmNlSW1wbC5pbnB1dFNvdXJjZSB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXByaW1hcnlBY3Rpb25QcmVzc2VkICYmIGlucHV0U291cmNlSW1wbC5wcmltYXJ5QWN0aW9uUHJlc3NlZCkgewogICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc2VsZWN0LWVuZCcsIHsgc2Vzc2lvbklkOiBzZXNzaW9uLmlkLCBpbnB1dFNvdXJjZTogaW5wdXRTb3VyY2VJbXBsLmlucHV0U291cmNlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5wdXRTb3VyY2VJbXBsLnByaW1hcnlBY3Rpb25QcmVzc2VkID0gcHJpbWFyeUFjdGlvblByZXNzZWQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChpbnB1dFNvdXJjZUltcGwucHJpbWFyeVNxdWVlemVCdXR0b25JbmRleCAhPSAtMSkgewogICAgICAgICAgICAgICAgbGV0IHByaW1hcnlTcXVlZXplQWN0aW9uUHJlc3NlZCA9IGdhbWVwYWQuYnV0dG9uc1tpbnB1dFNvdXJjZUltcGwucHJpbWFyeVNxdWVlemVCdXR0b25JbmRleF0ucHJlc3NlZDsKICAgICAgICAgICAgICAgIGlmIChwcmltYXJ5U3F1ZWV6ZUFjdGlvblByZXNzZWQgJiYgIWlucHV0U291cmNlSW1wbC5wcmltYXJ5U3F1ZWV6ZUFjdGlvblByZXNzZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNxdWVlemUtc3RhcnQnLCB7IHNlc3Npb25JZDogc2Vzc2lvbi5pZCwgaW5wdXRTb3VyY2U6IGlucHV0U291cmNlSW1wbC5pbnB1dFNvdXJjZSB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXByaW1hcnlTcXVlZXplQWN0aW9uUHJlc3NlZCAmJiBpbnB1dFNvdXJjZUltcGwucHJpbWFyeVNxdWVlemVBY3Rpb25QcmVzc2VkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zcXVlZXplLWVuZCcsIHsgc2Vzc2lvbklkOiBzZXNzaW9uLmlkLCBpbnB1dFNvdXJjZTogaW5wdXRTb3VyY2VJbXBsLmlucHV0U291cmNlIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5wdXRTb3VyY2VJbXBsLnByaW1hcnlTcXVlZXplQWN0aW9uUHJlc3NlZCA9IHByaW1hcnlTcXVlZXplQWN0aW9uUHJlc3NlZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFzZXNzaW9uLmltbWVyc2l2ZSAmJiBzZXNzaW9uLmJhc2VMYXllcikgewogICAgICAgICAgY29uc3QgY2FudmFzID0gc2Vzc2lvbi5iYXNlTGF5ZXIuY29udGV4dC5jYW52YXM7CiAgICAgICAgICBwZXJzcGVjdGl2ZSh0aGlzLmZyYW1lLmxlZnRQcm9qZWN0aW9uTWF0cml4LCByZW5kZXJTdGF0ZS5pbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3LAogICAgICAgICAgICAgIGNhbnZhcy53aWR0aC9jYW52YXMuaGVpZ2h0LCByZW5kZXJTdGF0ZS5kZXB0aE5lYXIsIHJlbmRlclN0YXRlLmRlcHRoRmFyKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgb25GcmFtZUVuZChzZXNzaW9uSWQpIHsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTsKICAgICAgICBpZiAoc2Vzc2lvbi5lbmRlZCB8fCAhc2Vzc2lvbi5iYXNlTGF5ZXIpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb24ub3V0cHV0Q29udGV4dCAmJgogICAgICAgICAgICAhKHNlc3Npb24uaW1tZXJzaXZlICYmICF0aGlzLmRpc3BsYXkuY2FwYWJpbGl0aWVzLmhhc0V4dGVybmFsRGlzcGxheSkpIHsKICAgICAgICAgIGNvbnN0IG1pcnJvcmluZyA9CiAgICAgICAgICAgIHNlc3Npb24uaW1tZXJzaXZlICYmIHRoaXMuZGlzcGxheS5jYXBhYmlsaXRpZXMuaGFzRXh0ZXJuYWxEaXNwbGF5OwogICAgICAgICAgY29uc3QgaUNhbnZhcyA9IHNlc3Npb24uYmFzZUxheWVyLmNvbnRleHQuY2FudmFzOwogICAgICAgICAgY29uc3QgaVdpZHRoID0gbWlycm9yaW5nID8gaUNhbnZhcy53aWR0aCAvIDIgOiBpQ2FudmFzLndpZHRoOwogICAgICAgICAgY29uc3QgaUhlaWdodCA9IGlDYW52YXMuaGVpZ2h0OwogICAgICAgICAgewogICAgICAgICAgICBjb25zdCBvQ2FudmFzID0gc2Vzc2lvbi5vdXRwdXRDb250ZXh0LmNhbnZhczsKICAgICAgICAgICAgY29uc3Qgb1dpZHRoID0gb0NhbnZhcy53aWR0aDsKICAgICAgICAgICAgY29uc3Qgb0hlaWdodCA9IG9DYW52YXMuaGVpZ2h0OwogICAgICAgICAgICBjb25zdCByZW5kZXJDb250ZXh0ID0gc2Vzc2lvbi5yZW5kZXJDb250ZXh0OwogICAgICAgICAgICBpZiAodGhpcy5IQVNfQklUTUFQX1NVUFBPUlQpIHsKICAgICAgICAgICAgICBpZiAoaUNhbnZhcy50cmFuc2ZlclRvSW1hZ2VCaXRtYXApIHsKICAgICAgICAgICAgICAgIHJlbmRlckNvbnRleHQudHJhbnNmZXJGcm9tSW1hZ2VCaXRtYXAoaUNhbnZhcy50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuY3JlYXRlSW1hZ2VCaXRtYXAoaUNhbnZhcywgMCwgMCwgaVdpZHRoLCBpSGVpZ2h0LCB7CiAgICAgICAgICAgICAgICAgIHJlc2l6ZVdpZHRoOiBvV2lkdGgsCiAgICAgICAgICAgICAgICAgIHJlc2l6ZUhlaWdodDogb0hlaWdodCwKICAgICAgICAgICAgICAgIH0pLnRoZW4oYml0bWFwID0+IHJlbmRlckNvbnRleHQudHJhbnNmZXJGcm9tSW1hZ2VCaXRtYXAoYml0bWFwKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlbmRlckNvbnRleHQuZHJhd0ltYWdlKGlDYW52YXMsIDAsIDAsIGlXaWR0aCwgaUhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCAwLCBvV2lkdGgsIG9IZWlnaHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChzZXNzaW9uLmltbWVyc2l2ZSAmJiBzZXNzaW9uLmJhc2VMYXllcikgewogICAgICAgICAgdGhpcy5kaXNwbGF5LnN1Ym1pdEZyYW1lKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZSkgewogICAgICAgIHRoaXMuZGlzcGxheS5jYW5jZWxBbmltYXRpb25GcmFtZShoYW5kbGUpOwogICAgICB9CiAgICAgIGFzeW5jIGVuZFNlc3Npb24oc2Vzc2lvbklkKSB7CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7CiAgICAgICAgaWYgKHNlc3Npb24uZW5kZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb24uaW1tZXJzaXZlKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5LmV4aXRQcmVzZW50KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNlc3Npb24uZW5kZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBkb2VzU2Vzc2lvblN1cHBvcnRSZWZlcmVuY2VTcGFjZShzZXNzaW9uSWQsIHR5cGUpIHsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTsKICAgICAgICBpZiAoc2Vzc2lvbi5lbmRlZCkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2Vzc2lvbi5lbmFibGVkRmVhdHVyZXMuaGFzKHR5cGUpOwogICAgICB9CiAgICAgIHJlcXVlc3RTdGFnZUJvdW5kcygpIHsKICAgICAgICBpZiAodGhpcy5kaXNwbGF5LnN0YWdlUGFyYW1ldGVycykgewogICAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLmRpc3BsYXkuc3RhZ2VQYXJhbWV0ZXJzLnNpemVYOwogICAgICAgICAgY29uc3QgZGVwdGggPSB0aGlzLmRpc3BsYXkuc3RhZ2VQYXJhbWV0ZXJzLnNpemVaOwogICAgICAgICAgY29uc3QgZGF0YSA9IFtdOwogICAgICAgICAgZGF0YS5wdXNoKC13aWR0aCAvIDIpOwogICAgICAgICAgZGF0YS5wdXNoKC1kZXB0aCAvIDIpOwogICAgICAgICAgZGF0YS5wdXNoKHdpZHRoIC8gMik7CiAgICAgICAgICBkYXRhLnB1c2goLWRlcHRoIC8gMik7CiAgICAgICAgICBkYXRhLnB1c2god2lkdGggLyAyKTsKICAgICAgICAgIGRhdGEucHVzaChkZXB0aCAvIDIpOwogICAgICAgICAgZGF0YS5wdXNoKC13aWR0aCAvIDIpOwogICAgICAgICAgZGF0YS5wdXNoKGRlcHRoIC8gMik7CiAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgYXN5bmMgcmVxdWVzdEZyYW1lT2ZSZWZlcmVuY2VUcmFuc2Zvcm0odHlwZSwgb3B0aW9ucykgewogICAgICAgIGlmICgodHlwZSA9PT0gJ2xvY2FsLWZsb29yJyB8fCB0eXBlID09PSAnYm91bmRlZC1mbG9vcicpICYmCiAgICAgICAgICAgIHRoaXMuZGlzcGxheS5zdGFnZVBhcmFtZXRlcnMgJiYKICAgICAgICAgICAgdGhpcy5kaXNwbGF5LnN0YWdlUGFyYW1ldGVycy5zaXR0aW5nVG9TdGFuZGluZ1RyYW5zZm9ybSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZGlzcGxheS5zdGFnZVBhcmFtZXRlcnMuc2l0dGluZ1RvU3RhbmRpbmdUcmFuc2Zvcm07CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGdldFByb2plY3Rpb25NYXRyaXgoZXllKSB7CiAgICAgICAgaWYgKGV5ZSA9PT0gJ2xlZnQnKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5mcmFtZS5sZWZ0UHJvamVjdGlvbk1hdHJpeDsKICAgICAgICB9IGVsc2UgaWYgKGV5ZSA9PT0gJ3JpZ2h0JykgewogICAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWUucmlnaHRQcm9qZWN0aW9uTWF0cml4OwogICAgICAgIH0gZWxzZSBpZiAoZXllID09PSAnbm9uZScpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmZyYW1lLmxlZnRQcm9qZWN0aW9uTWF0cml4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGV5ZSBtdXN0IGJlIG9mIHR5cGUgJ2xlZnQnIG9yICdyaWdodCdgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZ2V0Vmlld3BvcnQoc2Vzc2lvbklkLCBleWUsIGxheWVyLCB0YXJnZXQpIHsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTsKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGxheWVyLmNvbnRleHQuY2FudmFzOwogICAgICAgIGlmICghc2Vzc2lvbi5pbW1lcnNpdmUpIHsKICAgICAgICAgIHRhcmdldC54ID0gdGFyZ2V0LnkgPSAwOwogICAgICAgICAgdGFyZ2V0LndpZHRoID0gd2lkdGg7CiAgICAgICAgICB0YXJnZXQuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChleWUgPT09ICdsZWZ0JyB8fCBleWUgPT09ICdub25lJykgewogICAgICAgICAgdGFyZ2V0LnggPSAwOwogICAgICAgIH0gZWxzZSBpZiAoZXllID09PSAncmlnaHQnKSB7CiAgICAgICAgICB0YXJnZXQueCA9IHdpZHRoIC8gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICB0YXJnZXQueSA9IDA7CiAgICAgICAgdGFyZ2V0LndpZHRoID0gd2lkdGggLyAyOwogICAgICAgIHRhcmdldC5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgZ2V0QmFzZVBvc2VNYXRyaXgoKSB7CiAgICAgICAgbGV0IHsgcG9zaXRpb24sIG9yaWVudGF0aW9uIH0gPSB0aGlzLmZyYW1lLnBvc2U7CiAgICAgICAgaWYgKCFwb3NpdGlvbiAmJiAhb3JpZW50YXRpb24pIHsKICAgICAgICAgIHJldHVybiB0aGlzLmJhc2VNb2RlbE1hdHJpeDsKICAgICAgICB9CiAgICAgICAgaWYgKCFwb3NpdGlvbikgewogICAgICAgICAgcG9zaXRpb24gPSB0aGlzLnRlbXBWZWMzOwogICAgICAgICAgcG9zaXRpb25bMF0gPSBwb3NpdGlvblsxXSA9IHBvc2l0aW9uWzJdID0gMDsKICAgICAgICB9CiAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24odGhpcy5iYXNlTW9kZWxNYXRyaXgsIG9yaWVudGF0aW9uLCBwb3NpdGlvbik7CiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZU1vZGVsTWF0cml4OwogICAgICB9CiAgICAgIGdldEJhc2VWaWV3TWF0cml4KGV5ZSkgewogICAgICAgIGlmIChleWUgPT09ICdsZWZ0JyB8fCBleWUgPT09ICdub25lJykgewogICAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWUubGVmdFZpZXdNYXRyaXg7CiAgICAgICAgfSBlbHNlIGlmIChleWUgPT09ICdyaWdodCcpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmZyYW1lLnJpZ2h0Vmlld01hdHJpeDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBleWUgbXVzdCBiZSBvZiB0eXBlICdsZWZ0JyBvciAncmlnaHQnYCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGdldElucHV0U291cmNlcygpIHsKICAgICAgICBsZXQgaW5wdXRTb3VyY2VzID0gW107CiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXMpIHsKICAgICAgICAgIGlucHV0U291cmNlcy5wdXNoKHRoaXMuZ2FtZXBhZElucHV0U291cmNlc1tpXS5pbnB1dFNvdXJjZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnB1dFNvdXJjZXM7CiAgICAgIH0KICAgICAgZ2V0SW5wdXRQb3NlKGlucHV0U291cmNlLCBjb29yZGluYXRlU3lzdGVtLCBwb3NlVHlwZSkgewogICAgICAgIGlmICghY29vcmRpbmF0ZVN5c3RlbSkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy5nYW1lcGFkSW5wdXRTb3VyY2VzKSB7CiAgICAgICAgICBsZXQgaW5wdXRTb3VyY2VJbXBsID0gdGhpcy5nYW1lcGFkSW5wdXRTb3VyY2VzW2ldOwogICAgICAgICAgaWYgKGlucHV0U291cmNlSW1wbC5pbnB1dFNvdXJjZSA9PT0gaW5wdXRTb3VyY2UpIHsKICAgICAgICAgICAgcmV0dXJuIGlucHV0U291cmNlSW1wbC5nZXRYUlBvc2UoY29vcmRpbmF0ZVN5c3RlbSwgcG9zZVR5cGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBvbldpbmRvd1Jlc2l6ZSgpIHsKICAgICAgfQogICAgICBvblZSRGlzcGxheVByZXNlbnRDaGFuZ2UoZSkgewogICAgICAgIGlmICghdGhpcy5kaXNwbGF5LmlzUHJlc2VudGluZykgewogICAgICAgICAgdGhpcy5zZXNzaW9ucy5mb3JFYWNoKHNlc3Npb24gPT4gewogICAgICAgICAgICBpZiAoc2Vzc2lvbi5pbW1lcnNpdmUgJiYgIXNlc3Npb24uZW5kZWQpIHsKICAgICAgICAgICAgICBpZiAoc2Vzc2lvbi5tb2RpZmllZENhbnZhc0xheWVyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjYW52YXMgPSBzZXNzaW9uLmJhc2VMYXllci5jb250ZXh0LmNhbnZhczsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoY2FudmFzKTsKICAgICAgICAgICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJycpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAodGhpcy5pbW1lcnNpdmVTZXNzaW9uID09PSBzZXNzaW9uKSB7CiAgICAgICAgICAgICAgICB0aGlzLmltbWVyc2l2ZVNlc3Npb24gPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ0BAd2VieHItcG9seWZpbGwvdnItcHJlc2VudC1lbmQnLCBzZXNzaW9uLmlkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgY2xhc3MgQ2FyZGJvYXJkWFJEZXZpY2UgZXh0ZW5kcyBXZWJWUkRldmljZSB7CiAgICAgIGNvbnN0cnVjdG9yKGdsb2JhbCwgY2FyZGJvYXJkQ29uZmlnKSB7CiAgICAgICAgY29uc3QgZGlzcGxheSA9IG5ldyBDYXJkYm9hcmRWUkRpc3BsYXkoY2FyZGJvYXJkQ29uZmlnIHx8IHt9KTsKICAgICAgICBzdXBlcihnbG9iYWwsIGRpc3BsYXkpOwogICAgICAgIHRoaXMuZGlzcGxheSA9IGRpc3BsYXk7CiAgICAgICAgdGhpcy5mcmFtZSA9IHsKICAgICAgICAgIHJpZ2h0Vmlld01hdHJpeDogbmV3IEZsb2F0MzJBcnJheSgxNiksCiAgICAgICAgICBsZWZ0Vmlld01hdHJpeDogbmV3IEZsb2F0MzJBcnJheSgxNiksCiAgICAgICAgICByaWdodFByb2plY3Rpb25NYXRyaXg6IG5ldyBGbG9hdDMyQXJyYXkoMTYpLAogICAgICAgICAgbGVmdFByb2plY3Rpb25NYXRyaXg6IG5ldyBGbG9hdDMyQXJyYXkoMTYpLAogICAgICAgICAgcG9zZTogbnVsbCwKICAgICAgICAgIHRpbWVzdGFtcDogbnVsbCwKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBsZXQgU0VTU0lPTl9JRCQxID0gMDsKICAgIGNsYXNzIFNlc3Npb24kMSB7CiAgICAgIGNvbnN0cnVjdG9yKG1vZGUsIGVuYWJsZWRGZWF0dXJlcykgewogICAgICAgIHRoaXMubW9kZSA9IG1vZGU7CiAgICAgICAgdGhpcy5lbmFibGVkRmVhdHVyZXMgPSBlbmFibGVkRmVhdHVyZXM7CiAgICAgICAgdGhpcy5lbmRlZCA9IG51bGw7CiAgICAgICAgdGhpcy5iYXNlTGF5ZXIgPSBudWxsOwogICAgICAgIHRoaXMuaWQgPSArK1NFU1NJT05fSUQkMTsKICAgICAgfQogICAgfQogICAgY2xhc3MgSW5saW5lRGV2aWNlIGV4dGVuZHMgWFJEZXZpY2UgewogICAgICBjb25zdHJ1Y3RvcihnbG9iYWwpIHsKICAgICAgICBzdXBlcihnbG9iYWwpOwogICAgICAgIHRoaXMuc2Vzc2lvbnMgPSBuZXcgTWFwKCk7CiAgICAgICAgdGhpcy5wcm9qZWN0aW9uTWF0cml4ID0gY3JlYXRlKCk7CiAgICAgICAgdGhpcy5pZGVudGl0eU1hdHJpeCA9IGNyZWF0ZSgpOwogICAgICB9CiAgICAgIG9uQmFzZUxheWVyU2V0KHNlc3Npb25JZCwgbGF5ZXIpIHsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTsKICAgICAgICBzZXNzaW9uLmJhc2VMYXllciA9IGxheWVyOwogICAgICB9CiAgICAgIGlzU2Vzc2lvblN1cHBvcnRlZChtb2RlKSB7CiAgICAgICAgcmV0dXJuIG1vZGUgPT0gJ2lubGluZSc7CiAgICAgIH0KICAgICAgaXNGZWF0dXJlU3VwcG9ydGVkKGZlYXR1cmVEZXNjcmlwdG9yKSB7CiAgICAgICAgc3dpdGNoKGZlYXR1cmVEZXNjcmlwdG9yKSB7CiAgICAgICAgICBjYXNlICd2aWV3ZXInOiByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgYXN5bmMgcmVxdWVzdFNlc3Npb24obW9kZSwgZW5hYmxlZEZlYXR1cmVzKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzU2Vzc2lvblN1cHBvcnRlZChtb2RlKSkgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHNlc3Npb24gPSBuZXcgU2Vzc2lvbiQxKG1vZGUsIGVuYWJsZWRGZWF0dXJlcyk7CiAgICAgICAgdGhpcy5zZXNzaW9ucy5zZXQoc2Vzc2lvbi5pZCwgc2Vzc2lvbik7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzZXNzaW9uLmlkKTsKICAgICAgfQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spIHsKICAgICAgICByZXR1cm4gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7CiAgICAgIH0KICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoaGFuZGxlKSB7CiAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZSk7CiAgICAgIH0KICAgICAgb25GcmFtZVN0YXJ0KHNlc3Npb25JZCwgcmVuZGVyU3RhdGUpIHsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTsKICAgICAgICBpZiAoc2Vzc2lvbi5iYXNlTGF5ZXIpIHsKICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IHNlc3Npb24uYmFzZUxheWVyLmNvbnRleHQuY2FudmFzOwogICAgICAgICAgcGVyc3BlY3RpdmUodGhpcy5wcm9qZWN0aW9uTWF0cml4LCByZW5kZXJTdGF0ZS5pbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3LAogICAgICAgICAgICAgIGNhbnZhcy53aWR0aC9jYW52YXMuaGVpZ2h0LCByZW5kZXJTdGF0ZS5kZXB0aE5lYXIsIHJlbmRlclN0YXRlLmRlcHRoRmFyKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgb25GcmFtZUVuZChzZXNzaW9uSWQpIHsKICAgICAgfQogICAgICBhc3luYyBlbmRTZXNzaW9uKHNlc3Npb25JZCkgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIHNlc3Npb24uZW5kZWQgPSB0cnVlOwogICAgICB9CiAgICAgIGRvZXNTZXNzaW9uU3VwcG9ydFJlZmVyZW5jZVNwYWNlKHNlc3Npb25JZCwgdHlwZSkgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGlmIChzZXNzaW9uLmVuZGVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXNzaW9uLmVuYWJsZWRGZWF0dXJlcy5oYXModHlwZSk7CiAgICAgIH0KICAgICAgcmVxdWVzdFN0YWdlQm91bmRzKCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGFzeW5jIHJlcXVlc3RGcmFtZU9mUmVmZXJlbmNlVHJhbnNmb3JtKHR5cGUsIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBnZXRQcm9qZWN0aW9uTWF0cml4KGV5ZSkgewogICAgICAgIHJldHVybiB0aGlzLnByb2plY3Rpb25NYXRyaXg7CiAgICAgIH0KICAgICAgZ2V0Vmlld3BvcnQoc2Vzc2lvbklkLCBleWUsIGxheWVyLCB0YXJnZXQpIHsKICAgICAgICB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gbGF5ZXIuY29udGV4dC5jYW52YXM7CiAgICAgICAgdGFyZ2V0LnggPSB0YXJnZXQueSA9IDA7CiAgICAgICAgdGFyZ2V0LndpZHRoID0gd2lkdGg7CiAgICAgICAgdGFyZ2V0LmhlaWdodCA9IGhlaWdodDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBnZXRCYXNlUG9zZU1hdHJpeCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5pZGVudGl0eU1hdHJpeDsKICAgICAgfQogICAgICBnZXRCYXNlVmlld01hdHJpeChleWUpIHsKICAgICAgICByZXR1cm4gdGhpcy5pZGVudGl0eU1hdHJpeDsKICAgICAgfQogICAgICBnZXRJbnB1dFNvdXJjZXMoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGdldElucHV0UG9zZShpbnB1dFNvdXJjZSwgY29vcmRpbmF0ZVN5c3RlbSwgcG9zZVR5cGUpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBvbldpbmRvd1Jlc2l6ZSgpIHsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IGdldFdlYlZSRGV2aWNlID0gYXN5bmMgZnVuY3Rpb24gKGdsb2JhbCkgewogICAgICBsZXQgZGV2aWNlID0gbnVsbDsKICAgICAgaWYgKCdnZXRWUkRpc3BsYXlzJyBpbiBnbG9iYWwubmF2aWdhdG9yKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGRpc3BsYXlzID0gYXdhaXQgZ2xvYmFsLm5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKCk7CiAgICAgICAgICBpZiAoZGlzcGxheXMgJiYgZGlzcGxheXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGRldmljZSA9IG5ldyBXZWJWUkRldmljZShnbG9iYWwsIGRpc3BsYXlzWzBdKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICB9CiAgICAgIHJldHVybiBkZXZpY2U7CiAgICB9OwogICAgY29uc3QgcmVxdWVzdFhSRGV2aWNlID0gYXN5bmMgZnVuY3Rpb24gKGdsb2JhbCwgY29uZmlnKSB7CiAgICAgIGlmIChjb25maWcud2VidnIpIHsKICAgICAgICBsZXQgeHIgPSBhd2FpdCBnZXRXZWJWUkRldmljZShnbG9iYWwpOwogICAgICAgIGlmICh4cikgewogICAgICAgICAgcmV0dXJuIHhyOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQgbW9iaWxlID0gaXNNb2JpbGUoZ2xvYmFsKTsKICAgICAgaWYgKChtb2JpbGUgJiYgY29uZmlnLmNhcmRib2FyZCkgfHwKICAgICAgICAgICghbW9iaWxlICYmIGNvbmZpZy5hbGxvd0NhcmRib2FyZE9uRGVza3RvcCkpIHsKICAgICAgICBpZiAoIWdsb2JhbC5WUkZyYW1lRGF0YSkgewogICAgICAgICAgZ2xvYmFsLlZSRnJhbWVEYXRhID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLnJpZ2h0Vmlld01hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICAgICAgICB0aGlzLmxlZnRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgICAgIHRoaXMucmlnaHRQcm9qZWN0aW9uTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgICAgIHRoaXMubGVmdFByb2plY3Rpb25NYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICAgICAgICAgICAgdGhpcy5wb3NlID0gbnVsbDsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgQ2FyZGJvYXJkWFJEZXZpY2UoZ2xvYmFsLCBjb25maWcuY2FyZGJvYXJkQ29uZmlnKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IElubGluZURldmljZShnbG9iYWwpOwogICAgfTsKCiAgICBjb25zdCBDT05GSUdfREVGQVVMVFMgPSB7CiAgICAgIGdsb2JhbDogX2dsb2JhbCwKICAgICAgd2VidnI6IHRydWUsCiAgICAgIGNhcmRib2FyZDogdHJ1ZSwKICAgICAgY2FyZGJvYXJkQ29uZmlnOiBudWxsLAogICAgICBhbGxvd0NhcmRib2FyZE9uRGVza3RvcDogZmFsc2UsCiAgICB9OwogICAgY29uc3QgcGFydGlhbHMgPSBbJ25hdmlnYXRvcicsICdIVE1MQ2FudmFzRWxlbWVudCcsICdXZWJHTFJlbmRlcmluZ0NvbnRleHQnXTsKICAgIGNsYXNzIFdlYlhSUG9seWZpbGwgewogICAgICBjb25zdHJ1Y3Rvcihjb25maWc9e30pIHsKICAgICAgICB0aGlzLmNvbmZpZyA9IE9iamVjdC5mcmVlemUoT2JqZWN0LmFzc2lnbih7fSwgQ09ORklHX0RFRkFVTFRTLCBjb25maWcpKTsKICAgICAgICB0aGlzLmdsb2JhbCA9IHRoaXMuY29uZmlnLmdsb2JhbDsKICAgICAgICB0aGlzLm5hdGl2ZVdlYlhSID0gJ3hyJyBpbiB0aGlzLmdsb2JhbC5uYXZpZ2F0b3I7CiAgICAgICAgdGhpcy5pbmplY3RlZCA9IGZhbHNlOwogICAgICAgIGlmICghdGhpcy5uYXRpdmVXZWJYUikgewogICAgICAgICAgdGhpcy5faW5qZWN0UG9seWZpbGwodGhpcy5nbG9iYWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLl9pbmplY3RDb21wYXRpYmlsaXR5U2hpbXModGhpcy5nbG9iYWwpOwogICAgICAgIH0KICAgICAgfQogICAgICBfaW5qZWN0UG9seWZpbGwoZ2xvYmFsKSB7CiAgICAgICAgaWYgKCFwYXJ0aWFscy5ldmVyeShpZmFjZSA9PiAhIWdsb2JhbFtpZmFjZV0pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEdsb2JhbCBtdXN0IGhhdmUgdGhlIGZvbGxvd2luZyBhdHRyaWJ1dGVzIDogJHtwYXJ0aWFsc31gKTsKICAgICAgICB9CiAgICAgICAgZm9yIChjb25zdCBjbGFzc05hbWUgb2YgT2JqZWN0LmtleXMoQVBJKSkgewogICAgICAgICAgaWYgKGdsb2JhbFtjbGFzc05hbWVdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGAke2NsYXNzTmFtZX0gYWxyZWFkeSBkZWZpbmVkIG9uIGdsb2JhbC5gKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGdsb2JhbFtjbGFzc05hbWVdID0gQVBJW2NsYXNzTmFtZV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHBvbHlmaWxsZWRDdHggPSBwb2x5ZmlsbE1ha2VYUkNvbXBhdGlibGUoZ2xvYmFsLldlYkdMUmVuZGVyaW5nQ29udGV4dCk7CiAgICAgICAgICBpZiAocG9seWZpbGxlZEN0eCkgewogICAgICAgICAgICBwb2x5ZmlsbEdldENvbnRleHQoZ2xvYmFsLkhUTUxDYW52YXNFbGVtZW50KTsKICAgICAgICAgICAgaWYgKGdsb2JhbC5PZmZzY3JlZW5DYW52YXMpIHsKICAgICAgICAgICAgICBwb2x5ZmlsbEdldENvbnRleHQoZ2xvYmFsLk9mZnNjcmVlbkNhbnZhcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGdsb2JhbC5XZWJHTDJSZW5kZXJpbmdDb250ZXh0KXsKICAgICAgICAgICAgICBwb2x5ZmlsbE1ha2VYUkNvbXBhdGlibGUoZ2xvYmFsLldlYkdMMlJlbmRlcmluZ0NvbnRleHQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghd2luZG93LmlzU2VjdXJlQ29udGV4dCkgewogICAgICAgICAgICAgIGNvbnNvbGUud2FybihgV2ViWFIgUG9seWZpbGwgV2FybmluZzoKVGhpcyBwYWdlIGlzIG5vdCBydW5uaW5nIGluIGEgc2VjdXJlIGNvbnRleHQgKGh0dHBzOi8vIG9yIGxvY2FsaG9zdCkhClRoaXMgbWVhbnMgdGhhdCBhbHRob3VnaCB0aGUgcGFnZSBtYXkgYmUgYWJsZSB0byB1c2UgdGhlIFdlYlhSIFBvbHlmaWxsIGl0IHdpbGwKbm90IGJlIGFibGUgdG8gdXNlIG5hdGl2ZSBXZWJYUiBpbXBsZW1lbnRhdGlvbnMsIGFuZCBhcyBzdWNoIHdpbGwgbm90IGJlIGFibGUgdG8KYWNjZXNzIGRlZGljYXRlZCBWUiBvciBBUiBoYXJkd2FyZSwgYW5kIHdpbGwgbm90IGJlIGFibGUgdG8gdGFrZSBhZHZhbnRhZ2Ugb2YKYW55IHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cyBhIG5hdGl2ZSBXZWJYUiBpbXBsZW1lbnRhdGlvbiBtYXkgb2ZmZXIuIFBsZWFzZQpob3N0IHRoaXMgY29udGVudCBvbiBhIHNlY3VyZSBvcmlnaW4gZm9yIHRoZSBiZXN0IHVzZXIgZXhwZXJpZW5jZS4KYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5pbmplY3RlZCA9IHRydWU7CiAgICAgICAgdGhpcy5fcGF0Y2hOYXZpZ2F0b3JYUigpOwogICAgICB9CiAgICAgIF9wYXRjaE5hdmlnYXRvclhSKCkgewogICAgICAgIGxldCBkZXZpY2VQcm9taXNlID0gcmVxdWVzdFhSRGV2aWNlKHRoaXMuZ2xvYmFsLCB0aGlzLmNvbmZpZyk7CiAgICAgICAgdGhpcy54ciA9IG5ldyBBUEkuWFJTeXN0ZW0oZGV2aWNlUHJvbWlzZSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuZ2xvYmFsLm5hdmlnYXRvciwgJ3hyJywgewogICAgICAgICAgdmFsdWU6IHRoaXMueHIsCiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgX2luamVjdENvbXBhdGliaWxpdHlTaGltcyhnbG9iYWwpIHsKICAgICAgICBpZiAoIXBhcnRpYWxzLmV2ZXJ5KGlmYWNlID0+ICEhZ2xvYmFsW2lmYWNlXSkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgR2xvYmFsIG11c3QgaGF2ZSB0aGUgZm9sbG93aW5nIGF0dHJpYnV0ZXMgOiAke3BhcnRpYWxzfWApOwogICAgICAgIH0KICAgICAgICBpZiAoZ2xvYmFsLm5hdmlnYXRvci54ciAmJgogICAgICAgICAgICAnc3VwcG9ydHNTZXNzaW9uJyBpbiBnbG9iYWwubmF2aWdhdG9yLnhyICYmCiAgICAgICAgICAgICEoJ2lzU2Vzc2lvblN1cHBvcnRlZCcgaW4gZ2xvYmFsLm5hdmlnYXRvci54cikpIHsKICAgICAgICAgIGxldCBvcmlnaW5hbFN1cHBvcnRzU2Vzc2lvbiA9IGdsb2JhbC5uYXZpZ2F0b3IueHIuc3VwcG9ydHNTZXNzaW9uOwogICAgICAgICAgZ2xvYmFsLm5hdmlnYXRvci54ci5pc1Nlc3Npb25TdXBwb3J0ZWQgPSBmdW5jdGlvbihtb2RlKSB7CiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFN1cHBvcnRzU2Vzc2lvbi5jYWxsKHRoaXMsIG1vZGUpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CiAgICAgICAgICBnbG9iYWwubmF2aWdhdG9yLnhyLnN1cHBvcnRzU2Vzc2lvbiA9IGZ1bmN0aW9uKG1vZGUpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJuYXZpZ2F0b3IueHIuc3VwcG9ydHNTZXNzaW9uKCkgaXMgZGVwcmVjYXRlZC4gUGxlYXNlICIgKwogICAgICAgICAgICAiY2FsbCBuYXZpZ2F0b3IueHIuaXNTZXNzaW9uU3VwcG9ydGVkKCkgaW5zdGVhZCBhbmQgY2hlY2sgdGhlIGJvb2xlYW4gIiArCiAgICAgICAgICAgICJ2YWx1ZSByZXR1cm5lZCB3aGVuIHRoZSBwcm9taXNlIHJlc29sdmVzLiIpOwogICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxTdXBwb3J0c1Nlc3Npb24uY2FsbCh0aGlzLCBtb2RlKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInZpZGVvIilbMF07CgogICAgdmFyIHBvbHlmaWxsID0gbnVsbDsKCiAgICBsZXQgY2FtZXJhLCBzY2VuZSwgcmVuZGVyZXI7CiAgICBsZXQgdmlkZW9QbGFuZSwgdmlkZW9UZXh0dXJlOwogICAgbGV0IHByb2dyZXNzQmFyLCBiYXJNYXRlcmlhbDsKCiAgICBpZighdmlkZW8pewogICAgICAgIGNvbnNvbGUubG9nKGluaXQpOwogICAgICAgIGNvbnNvbGUubG9nKGFuaW1hdGUpOwogICAgICAgIGxvZygiTm8gdmlkZW8sIHNraXBwaW5nIGluamVjdGlvbi4iKTsKICAgIH1lbHNlIHsKCiAgICAgICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gc3R5bGVzOwogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOwogICAgICAgIGxvZygiSW5qZWN0ZWQgc3R5bGVzIiwgbnVsbCwgc3R5bGUpOwoKICAgICAgICBwb2x5ZmlsbCA9IG5ldyBXZWJYUlBvbHlmaWxsKHdpbmRvdy5WUl9DT05GSUcpOwoKICAgICAgICBsb2coIldlYlhSUG9seWZpbGwgaW5zdGFudGlhdGVkLiIgLCAicHJlLWluaXQiLCBwb2x5ZmlsbCk7CiAgICAgICAgbG9nKCJWaWRlbyBmb3VuZDogIiwgbnVsbCwgdmlkZW8pOwoKICAgICAgICBpbml0KCk7CiAgICAgICAgYW5pbWF0ZSgpOwogICAgfQoKCiAgICAvLyBIZWxsbwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgbG9nKCJTdGFydGluZyIsICJpbml0Iik7CgogICAgICAgIC8vIFN0YXJ0IHZpZGVvCiAgICAgICAgdmlkZW8ucGxheSgpOwogICAgICAgIHZpZGVvVGV4dHVyZSA9IG5ldyBWaWRlb1RleHR1cmUodmlkZW8pOwoKICAgICAgICAvLyBTZXR1cCBzY2VuZQogICAgICAgIHNjZW5lID0gbmV3IFNjZW5lKCk7CiAgICAgICAgY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKDcwLCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMC4xLCAxMDAwKTsKICAgICAgICBjYW1lcmEucG9zaXRpb24ueiA9IDE7CgogICAgICAgIC8vIENyZWF0ZSByZW5kZXJlcgogICAgICAgIHJlbmRlcmVyID0gbmV3IFdlYkdMUmVuZGVyZXIoeyBhbnRpYWxpYXM6IHRydWUgfSk7CiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKICAgICAgICByZW5kZXJlci54ci5lbmFibGVkID0gdHJ1ZTsKICAgICAgICByZW5kZXJlci5kb21FbGVtZW50LmNsYXNzTGlzdC5hZGQoIndlYmdsIik7CgogICAgICAgIC8vIENyZWF0ZSBtb2RhbCBvdmVybGF5IGNvbnRhaW5lcgogICAgICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgbW9kYWwuaWQgPSAndnItb3ZlcmxheS1tb2RhbCc7CgogICAgICAgIGNvbnN0IGNhbnZhc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIGNhbnZhc0NvbnRhaW5lci5pZCA9ICd2ci1jYW52YXMtY29udGFpbmVyJzsKCiAgICAgICAgY2FudmFzQ29udGFpbmVyLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpOwogICAgICAgIG1vZGFsLmFwcGVuZENoaWxkKGNhbnZhc0NvbnRhaW5lcik7CgogICAgICAgIC8vIEFkZCBTdGFydCBidXR0b24KICAgICAgICAvKmNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgc3RhcnRCdXR0b24uaWQgPSAndnItc3RhcnQtYnV0dG9uJzsKICAgICAgICBzdGFydEJ1dHRvbi50ZXh0Q29udGVudCA9ICdFbnRlciBWUic7CiAgICAgICAgc3RhcnRCdXR0b24ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgbW9kYWwucmVtb3ZlQ2hpbGQoc3RhcnRCdXR0b24pOyAvLyBSZW1vdmUgYnV0dG9uIGFmdGVyIGNsaWNrCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoVlJCdXR0b24uY3JlYXRlQnV0dG9uKHJlbmRlcmVyKSk7CiAgICAgICAgfTsKICAgICAgICBtb2RhbC5hcHBlbmRDaGlsZChzdGFydEJ1dHRvbik7Ki8KCiAgICAgICAgY29uc29sZS5sb2coInRlc3QxIik7CiAgICAgICAgbGV0IHZyX2J1dHRvbiA9IG1vZGFsLmFwcGVuZENoaWxkKFZSQnV0dG9uLmNyZWF0ZUJ1dHRvbihyZW5kZXJlcikpOwogICAgICAgIGNvbnNvbGUubG9nKCJ0ZXN0MiIsIHZyX2J1dHRvbik7CgogICAgICAgIC8vIEFkZCBDbG9zZSBidXR0b24KICAgICAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICAgIGNsb3NlQnV0dG9uLmlkID0gJ3ZyLWNsb3NlLWJ1dHRvbic7CiAgICAgICAgY2xvc2VCdXR0b24udGV4dENvbnRlbnQgPSAnQ2xvc2UnOwoKICAgICAgICAvKnN0YXJ0QnV0dG9uLm9uY2xpY2sgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgIG1vZGFsLnJlbW92ZUNoaWxkKHN0YXJ0QnV0dG9uKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyAxLiBSZXF1ZXN0IGFuIGltbWVyc2l2ZSBWUiBzZXNzaW9uIChtdXN0IGJlIGluc2lkZSB1c2VyIGdlc3R1cmUgaGFuZGxlcikKICAgICAgICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB4ci5yZXF1ZXN0U2Vzc2lvbigiaW5saW5lIiwgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbmFsRmVhdHVyZXM6IFsibG9jYWwiXSwKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIDIuIEF0dGFjaCBzZXNzaW9uIHRvIHJlbmRlcmVyCiAgICAgICAgICAgICAgICBhd2FpdCByZW5kZXJlci54ci5zZXRTZXNzaW9uKHNlc3Npb24pOwoKICAgICAgICAgICAgICAgIC8vIDMuIE9wdGlvbmFsbHkgYXBwZW5kIHRoZSBzdGFuZGFyZCBWUkJ1dHRvbiB0byBhbGxvdyBleGl0aW5nIGxhdGVyCiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKFZSQnV0dG9uLmNyZWF0ZUJ1dHRvbihyZW5kZXJlcikpOwoKICAgICAgICAgICAgICAgIC8vIDQuIChPcHRpb25hbCkgUmVzaXplIHJlbmRlcmVyIHRvIGZ1bGwtd2luZG93IGJlZm9yZSBzZXNzaW9uIGJlZ2lucwogICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gc3RhcnQgWFIgc2Vzc2lvbjoiLCBlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgfTsqLwoKICAgICAgICBtb2RhbC5hcHBlbmRDaGlsZChjbG9zZUJ1dHRvbik7CgogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobW9kYWwpOwoKICAgICAgICAvLyBCYWNrZ3JvdW5kCiAgICAgICAgY29uc3QgbG9hZGVyID0gbmV3IFRleHR1cmVMb2FkZXIoKTsKICAgICAgICBjb25zdCB0ZXh0dXJlID0gbG9hZGVyLmxvYWQoJ2JveC5wbmcnKTsKICAgICAgICBzY2VuZS5iYWNrZ3JvdW5kID0gdGV4dHVyZTsKCiAgICAgICAgLy8gVmlkZW8gUGxhbmUKICAgICAgICBjb25zdCBnZW9tZXRyeSA9IG5ldyBQbGFuZUdlb21ldHJ5KDEuNiwgMC45KTsKICAgICAgICBjb25zdCBtYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCh7IG1hcDogdmlkZW9UZXh0dXJlIH0pOwogICAgICAgIHZpZGVvUGxhbmUgPSBuZXcgTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICAgIHZpZGVvUGxhbmUucG9zaXRpb24uc2V0KDAsIDAsIC0xLjUpOwogICAgICAgIHNjZW5lLmFkZCh2aWRlb1BsYW5lKTsKCiAgICAgICAgLy8gQ29udHJvbHMKICAgICAgICBjcmVhdGVCdXR0b24oJ+KWticsIC0wLjYsIC0xLjUsICgpID0+IHZpZGVvLnBsYXkoKSk7CiAgICAgICAgY3JlYXRlQnV0dG9uKCfij6onLCAtMC45LCAtMS41LCAoKSA9PiB7IHZpZGVvLmN1cnJlbnRUaW1lID0gTWF0aC5tYXgoMCwgdmlkZW8uY3VycmVudFRpbWUgLSA1KTsgfSk7CiAgICAgICAgY3JlYXRlQnV0dG9uKCfij6knLCAtMC4zLCAtMS41LCAoKSA9PiB7IHZpZGVvLmN1cnJlbnRUaW1lID0gTWF0aC5taW4odmlkZW8uZHVyYXRpb24sIHZpZGVvLmN1cnJlbnRUaW1lICsgNSk7IH0pOwoKICAgICAgICAvLyBQcm9ncmVzcyBCYXIKICAgICAgICBjb25zdCBiYXJHZW9tZXRyeSA9IG5ldyBQbGFuZUdlb21ldHJ5KDEuMiwgMC4wNSk7CiAgICAgICAgYmFyTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogMHgwMGZmMDAgfSk7CiAgICAgICAgcHJvZ3Jlc3NCYXIgPSBuZXcgTWVzaChiYXJHZW9tZXRyeSwgYmFyTWF0ZXJpYWwpOwogICAgICAgIHByb2dyZXNzQmFyLnBvc2l0aW9uLnNldCgwLCAtMC45LCAtMS41KTsKICAgICAgICBzY2VuZS5hZGQocHJvZ3Jlc3NCYXIpOwoKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUpOwogICAgfQoKCiAgICBmdW5jdGlvbiBjcmVhdGVCdXR0b24obGFiZWwsIHgsIHksIG9uQ2xpY2spIHsKICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBjYW52YXMud2lkdGggPSAxMjg7CiAgICAgICAgY2FudmFzLmhlaWdodCA9IDEyODsKICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAnOwogICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCAxMjgsIDEyOCk7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmZmJzsKICAgICAgICBjdHguZm9udCA9ICdib2xkIDY0cHggc2Fucy1zZXJpZic7CiAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnbWlkZGxlJzsKICAgICAgICBjdHguZmlsbFRleHQobGFiZWwsIDY0LCA2NCk7CgogICAgICAgIGNvbnN0IHRleHR1cmUgPSBuZXcgQ2FudmFzVGV4dHVyZShjYW52YXMpOwogICAgICAgIGNvbnN0IG1hdCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCh7IG1hcDogdGV4dHVyZSwgdHJhbnNwYXJlbnQ6IHRydWUgfSk7CiAgICAgICAgY29uc3QgZ2VvID0gbmV3IFBsYW5lR2VvbWV0cnkoMC4zLCAwLjMpOwogICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgTWVzaChnZW8sIG1hdCk7CiAgICAgICAgbWVzaC5wb3NpdGlvbi5zZXQoeCwgeSwgLTEuNSk7CiAgICAgICAgc2NlbmUuYWRkKG1lc2gpOwogICAgICAgIC8vIEZvciBmdXR1cmUgaW50ZXJhY3Rpdml0eSAoZS5nLiwgcmF5Y2FzdGluZyk6IHN0b3JlIGNsaWNrIGhhbmRsZXIKICAgICAgICBtZXNoLnVzZXJEYXRhLm9uQ2xpY2sgPSBvbkNsaWNrOwogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2dyZXNzQmFyKCkgewogICAgICAgIGlmICghdmlkZW8uZHVyYXRpb24pIHJldHVybjsKICAgICAgICBjb25zdCByYXRpbyA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gdmlkZW8uZHVyYXRpb247CiAgICAgICAgcHJvZ3Jlc3NCYXIuc2NhbGUueCA9IHJhdGlvOwogICAgICAgIHByb2dyZXNzQmFyLnBvc2l0aW9uLnggPSAtMC42ICsgcmF0aW8gKiAwLjY7CiAgICB9CgogICAgZnVuY3Rpb24gb25XaW5kb3dSZXNpemUoKSB7CiAgICAgICAgY2FtZXJhLmFzcGVjdCA9IHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0OwogICAgICAgIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CiAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIHJlbmRlcmVyLnNldEFuaW1hdGlvbkxvb3AocmVuZGVyKTsKICAgIH0KCiAgICBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgdXBkYXRlUHJvZ3Jlc3NCYXIoKTsKICAgICAgICByZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYSk7CiAgICB9Cgp9KSgpOwo=';
const WEBVR_B64 = 'KGZ1bmN0aW9uICgpIHsKCSd1c2Ugc3RyaWN0JzsKCgkvKioKCSAqIEBsaWNlbnNlCgkgKiBDb3B5cmlnaHQgMjAxMC0yMDI1IFRocmVlLmpzIEF1dGhvcnMKCSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKCSAqLwoJY29uc3QgUkVWSVNJT04gPSAnMTc4JzsKCgkvKioKCSAqIERpc2FibGVzIGZhY2UgY3VsbGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEN1bGxGYWNlTm9uZSA9IDA7CgoJLyoqCgkgKiBDdWxscyBiYWNrIGZhY2VzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VsbEZhY2VCYWNrID0gMTsKCgkvKioKCSAqIEN1bGxzIGZyb250IGZhY2VzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VsbEZhY2VGcm9udCA9IDI7CgoJLyoqCgkgKiBGaWx0ZXJzIHNoYWRvdyBtYXBzIHVzaW5nIHRoZSBQZXJjZW50YWdlLUNsb3NlciBGaWx0ZXJpbmcgKFBDRikgYWxnb3JpdGhtLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUENGU2hhZG93TWFwID0gMTsKCgkvKioKCSAqIEZpbHRlcnMgc2hhZG93IG1hcHMgdXNpbmcgdGhlIFBlcmNlbnRhZ2UtQ2xvc2VyIEZpbHRlcmluZyAoUENGKSBhbGdvcml0aG0gd2l0aAoJICogYmV0dGVyIHNvZnQgc2hhZG93cyBlc3BlY2lhbGx5IHdoZW4gdXNpbmcgbG93LXJlc29sdXRpb24gc2hhZG93IG1hcHMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBQQ0ZTb2Z0U2hhZG93TWFwID0gMjsKCgkvKioKCSAqIEZpbHRlcnMgc2hhZG93IG1hcHMgdXNpbmcgdGhlIFZhcmlhbmNlIFNoYWRvdyBNYXAgKFZTTSkgYWxnb3JpdGhtLgoJICogV2hlbiB1c2luZyBWU01TaGFkb3dNYXAgYWxsIHNoYWRvdyByZWNlaXZlcnMgd2lsbCBhbHNvIGNhc3Qgc2hhZG93cy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFZTTVNoYWRvd01hcCA9IDM7CgoJLyoqCgkgKiBPbmx5IGZyb250IGZhY2VzIGFyZSByZW5kZXJlZC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEZyb250U2lkZSA9IDA7CgoJLyoqCgkgKiBPbmx5IGJhY2sgZmFjZXMgYXJlIHJlbmRlcmVkLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQmFja1NpZGUgPSAxOwoKCS8qKgoJICogQm90aCBmcm9udCBhbmQgYmFjayBmYWNlcyBhcmUgcmVuZGVyZWQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBEb3VibGVTaWRlID0gMjsKCgkvKioKCSAqIE5vIGJsZW5kaW5nIGlzIHBlcmZvcm1lZCB3aGljaCBlZmZlY3RpdmVseSBkaXNhYmxlcwoJICogYWxwaGEgdHJhbnNwYXJlbmN5LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTm9CbGVuZGluZyA9IDA7CgoJLyoqCgkgKiBUaGUgZGVmYXVsdCBibGVuZGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE5vcm1hbEJsZW5kaW5nID0gMTsKCgkvKioKCSAqIFJlcHJlc2VudHMgYWRkaXRpdmUgYmxlbmRpbmcuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBBZGRpdGl2ZUJsZW5kaW5nID0gMjsKCgkvKioKCSAqIFJlcHJlc2VudHMgc3VidHJhY3RpdmUgYmxlbmRpbmcuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTdWJ0cmFjdGl2ZUJsZW5kaW5nID0gMzsKCgkvKioKCSAqIFJlcHJlc2VudHMgbXVsdGlwbHkgYmxlbmRpbmcuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBNdWx0aXBseUJsZW5kaW5nID0gNDsKCgkvKioKCSAqIFJlcHJlc2VudHMgY3VzdG9tIGJsZW5kaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VzdG9tQmxlbmRpbmcgPSA1OwoKCS8qKgoJICogQSBgc291cmNlICsgZGVzdGluYXRpb25gIGJsZW5kaW5nIGVxdWF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQWRkRXF1YXRpb24gPSAxMDA7CgoJLyoqCgkgKiBBIGBzb3VyY2UgLSBkZXN0aW5hdGlvbmAgYmxlbmRpbmcgZXF1YXRpb24uCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTdWJ0cmFjdEVxdWF0aW9uID0gMTAxOwoKCS8qKgoJICogQSBgZGVzdGluYXRpb24gLSBzb3VyY2VgIGJsZW5kaW5nIGVxdWF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUmV2ZXJzZVN1YnRyYWN0RXF1YXRpb24gPSAxMDI7CgoJLyoqCgkgKiBBIGJsZW5kIGVxdWF0aW9uIHRoYXQgdXNlcyB0aGUgbWluaW11bSBvZiBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTWluRXF1YXRpb24gPSAxMDM7CgoJLyoqCgkgKiBBIGJsZW5kIGVxdWF0aW9uIHRoYXQgdXNlcyB0aGUgbWF4aW11bSBvZiBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTWF4RXF1YXRpb24gPSAxMDQ7CgoJLyoqCgkgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYDBgLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgWmVyb0ZhY3RvciA9IDIwMDsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVGYWN0b3IgPSAyMDE7CgoJLyoqCgkgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgdGhlIHNvdXJjZSBjb2xvcnMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTcmNDb2xvckZhY3RvciA9IDIwMjsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgZWFjaCBzb3VyY2UgY29sb3IuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gMjAzOwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTcmNBbHBoYUZhY3RvciA9IDIwNDsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSAxIG1pbnVzIHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c1NyY0FscGhhRmFjdG9yID0gMjA1OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBkZXN0aW5hdGlvbiBhbHBoYSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IERzdEFscGhhRmFjdG9yID0gMjA2OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAxYCBtaW51cyB0aGUgZGVzdGluYXRpb24gYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c0RzdEFscGhhRmFjdG9yID0gMjA3OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBkZXN0aW5hdGlvbiBjb2xvci4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IERzdENvbG9yRmFjdG9yID0gMjA4OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAxYCBtaW51cyBlYWNoIGRlc3RpbmF0aW9uIGNvbG9yLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgT25lTWludXNEc3RDb2xvckZhY3RvciA9IDIwOTsKCgkvKioKCSAqIE11bHRpcGxpZXMgdGhlIFJHQiBjb2xvcnMgYnkgdGhlIHNtYWxsZXIgb2YgZWl0aGVyIHRoZSBzb3VyY2UgYWxwaGEKCSAqIHZhbHVlIG9yIHRoZSB2YWx1ZSBvZiBgMWAgbWludXMgdGhlIGRlc3RpbmF0aW9uIGFscGhhIHZhbHVlLiBUaGUgYWxwaGEKCSAqIHZhbHVlIGlzIG11bHRpcGxpZWQgYnkgYDFgLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciA9IDIxMDsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBhIGNvbnN0YW50IGNvbG9yLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ29uc3RhbnRDb2xvckZhY3RvciA9IDIxMTsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgYSBjb25zdGFudCBjb2xvci4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvciA9IDIxMjsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBhIGNvbnN0YW50IGFscGhhIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ29uc3RhbnRBbHBoYUZhY3RvciA9IDIxMzsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSAxIG1pbnVzIGEgY29uc3RhbnQgYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c0NvbnN0YW50QWxwaGFGYWN0b3IgPSAyMTQ7CgoJLyoqCgkgKiBOZXZlciBwYXNzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTmV2ZXJEZXB0aCA9IDA7CgoJLyoqCgkgKiBBbHdheXMgcGFzcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEFsd2F5c0RlcHRoID0gMTsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGVzc0RlcHRoID0gMjsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGVzc0VxdWFsRGVwdGggPSAzOwoKCS8qKgoJICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgZXF1YWxzIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBFcXVhbERlcHRoID0gNDsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgR3JlYXRlckVxdWFsRGVwdGggPSA1OwoKCS8qKgoJICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBHcmVhdGVyRGVwdGggPSA2OwoKCS8qKgoJICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgbm90IGVxdWFsIHRvIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOb3RFcXVhbERlcHRoID0gNzsKCgkvKioKCSAqIE11bHRpcGxpZXMgdGhlIGVudmlyb25tZW50IG1hcCBjb2xvciB3aXRoIHRoZSBzdXJmYWNlIGNvbG9yLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTXVsdGlwbHlPcGVyYXRpb24gPSAwOwoKCS8qKgoJICogVXNlcyByZWZsZWN0aXZpdHkgdG8gYmxlbmQgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE1peE9wZXJhdGlvbiA9IDE7CgoJLyoqCgkgKiBBZGRzIHRoZSB0d28gY29sb3JzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQWRkT3BlcmF0aW9uID0gMjsKCgkvKioKCSAqIE5vIHRvbmUgbWFwcGluZyBpcyBhcHBsaWVkLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTm9Ub25lTWFwcGluZyA9IDA7CgoJLyoqCgkgKiBMaW5lYXIgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyVG9uZU1hcHBpbmcgPSAxOwoKCS8qKgoJICogUmVpbmhhcmQgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUmVpbmhhcmRUb25lTWFwcGluZyA9IDI7CgoJLyoqCgkgKiBDaW5lb24gdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ2luZW9uVG9uZU1hcHBpbmcgPSAzOwoKCS8qKgoJICogQUNFUyBGaWxtaWMgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nID0gNDsKCgkvKioKCSAqIEN1c3RvbSB0b25lIG1hcHBpbmcuCgkgKgoJICogRXhwZWN0cyBhIGN1c3RvbSBpbXBsZW1lbnRhdGlvbiBieSBtb2RpZnlpbmcgc2hhZGVyIGNvZGUgb2YgdGhlIG1hdGVyaWFsJ3MgZnJhZ21lbnQgc2hhZGVyLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VzdG9tVG9uZU1hcHBpbmcgPSA1OwoKCS8qKgoJICogQWdYIHRvbmUgbWFwcGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEFnWFRvbmVNYXBwaW5nID0gNjsKCgkvKioKCSAqIE5ldXRyYWwgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEltcGxlbWVudGF0aW9uIGJhc2VkIG9uIHRoZSBLaHJvbm9zIDNEIENvbW1lcmNlIEdyb3VwIHN0YW5kYXJkIHRvbmUgbWFwcGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE5ldXRyYWxUb25lTWFwcGluZyA9IDc7CgoJLyoqCgkgKiBNYXBzIHRleHR1cmVzIHVzaW5nIHRoZSBnZW9tZXRyeSdzIFVWIGNvb3JkaW5hdGVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVVZNYXBwaW5nID0gMzAwOwoKCS8qKgoJICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBjdWJlIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nID0gMzAxOwoKCS8qKgoJICogUmVmcmFjdGlvbiBtYXBwaW5nIGZvciBjdWJlIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nID0gMzAyOwoKCS8qKgoJICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyA9IDMwMzsKCgkvKioKCSAqIFJlZnJhY3Rpb24gbWFwcGluZyBmb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgPSAzMDQ7CgoJLyoqCgkgKiBSZWZsZWN0aW9uIG1hcHBpbmcgZm9yIFBNUkVNIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDY7CgoJLyoqCgkgKiBUaGUgdGV4dHVyZSB3aWxsIHNpbXBseSByZXBlYXQgdG8gaW5maW5pdHkuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSZXBlYXRXcmFwcGluZyA9IDEwMDA7CgoJLyoqCgkgKiBUaGUgbGFzdCBwaXhlbCBvZiB0aGUgdGV4dHVyZSBzdHJldGNoZXMgdG8gdGhlIGVkZ2Ugb2YgdGhlIG1lc2guCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBDbGFtcFRvRWRnZVdyYXBwaW5nID0gMTAwMTsKCgkvKioKCSAqIFRoZSB0ZXh0dXJlIHdpbGwgcmVwZWF0cyB0byBpbmZpbml0eSwgbWlycm9yaW5nIG9uIGVhY2ggcmVwZWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTWlycm9yZWRSZXBlYXRXcmFwcGluZyA9IDEwMDI7CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgdGV4dHVyZSBlbGVtZW50IHRoYXQgaXMgbmVhcmVzdCAoaW4gTWFuaGF0dGFuIGRpc3RhbmNlKQoJICogdG8gdGhlIHNwZWNpZmllZCB0ZXh0dXJlIGNvb3JkaW5hdGVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTmVhcmVzdEZpbHRlciA9IDEwMDM7CgoJLyoqCgkgKiBDaG9vc2VzIHRoZSBtaXBtYXAgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2hlcyB0aGUgc2l6ZSBvZiB0aGUgcGl4ZWwgYmVpbmcgdGV4dHVyZWQKCSAqIGFuZCB1c2VzIHRoZSBgTmVhcmVzdEZpbHRlcmAgY3JpdGVyaW9uICh0aGUgdGV4ZWwgbmVhcmVzdCB0byB0aGUgY2VudGVyIG9mIHRoZSBwaXhlbCkKCSAqIHRvIHByb2R1Y2UgYSB0ZXh0dXJlIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIgPSAxMDA0OwoKCS8qKgoJICogQ2hvb3NlcyB0aGUgdHdvIG1pcG1hcHMgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2ggdGhlIHNpemUgb2YgdGhlIHBpeGVsIGJlaW5nIHRleHR1cmVkIGFuZAoJICogdXNlcyB0aGUgYE5lYXJlc3RGaWx0ZXJgIGNyaXRlcmlvbiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZSBmcm9tIGVhY2ggbWlwbWFwLgoJICogVGhlIGZpbmFsIHRleHR1cmUgdmFsdWUgaXMgYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRob3NlIHR3byB2YWx1ZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyID0gMTAwNTsKCgkvKioKCSAqIFJldHVybnMgdGhlIHdlaWdodGVkIGF2ZXJhZ2Ugb2YgdGhlIGZvdXIgdGV4dHVyZSBlbGVtZW50cyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZSBzcGVjaWZpZWQKCSAqIHRleHR1cmUgY29vcmRpbmF0ZXMsIGFuZCBjYW4gaW5jbHVkZSBpdGVtcyB3cmFwcGVkIG9yIHJlcGVhdGVkIGZyb20gb3RoZXIgcGFydHMgb2YgYSB0ZXh0dXJlLAoJICogZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZXMgb2YgYHdyYXBTYCBhbmQgYHdyYXBUYCwgYW5kIG9uIHRoZSBleGFjdCBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyRmlsdGVyID0gMTAwNjsKCgkvKioKCSAqIENob29zZXMgdGhlIG1pcG1hcCB0aGF0IG1vc3QgY2xvc2VseSBtYXRjaGVzIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQgdXNlcwoJICogdGhlIGBMaW5lYXJGaWx0ZXJgIGNyaXRlcmlvbiAoYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRoZSBmb3VyIHRleGVscyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZQoJICogY2VudGVyIG9mIHRoZSBwaXhlbCkgdG8gcHJvZHVjZSBhIHRleHR1cmUgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyID0gMTAwNzsKCgkvKioKCSAqIENob29zZXMgdGhlIHR3byBtaXBtYXBzIHRoYXQgbW9zdCBjbG9zZWx5IG1hdGNoIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQgdXNlcwoJICogdGhlIGBMaW5lYXJGaWx0ZXJgIGNyaXRlcmlvbiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZSBmcm9tIGVhY2ggbWlwbWFwLiBUaGUgZmluYWwgdGV4dHVyZSB2YWx1ZQoJICogaXMgYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRob3NlIHR3byB2YWx1ZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgPSAxMDA4OwoKCS8qKgoJICogQW4gdW5zaWduZWQgYnl0ZSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRCeXRlVHlwZSA9IDEwMDk7CgoJLyoqCgkgKiBBIGJ5dGUgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEJ5dGVUeXBlID0gMTAxMDsKCgkvKioKCSAqIEEgc2hvcnQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFNob3J0VHlwZSA9IDEwMTE7CgoJLyoqCgkgKiBBbiB1bnNpZ25lZCBzaG9ydCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRTaG9ydFR5cGUgPSAxMDEyOwoKCS8qKgoJICogQW4gaW50IGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBJbnRUeXBlID0gMTAxMzsKCgkvKioKCSAqIEFuIHVuc2lnbmVkIGludCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRJbnRUeXBlID0gMTAxNDsKCgkvKioKCSAqIEEgZmxvYXQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEZsb2F0VHlwZSA9IDEwMTU7CgoJLyoqCgkgKiBBIGhhbGYgZmxvYXQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEhhbGZGbG9hdFR5cGUgPSAxMDE2OwoKCS8qKgoJICogQW4gdW5zaWduZWQgc2hvcnQgNF80XzRfNCAocGFja2VkKSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gMTAxNzsKCgkvKioKCSAqIEFuIHVuc2lnbmVkIHNob3J0IDVfNV81XzEgKHBhY2tlZCkgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZSA9IDEwMTg7CgoJLyoqCgkgKiBBbiB1bnNpZ25lZCBpbnQgMjRfOCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRJbnQyNDhUeXBlID0gMTAyMDsKCgkvKioKCSAqIEFuIHVuc2lnbmVkIGludCA1XzlfOV85IChwYWNrZWQpIGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBVbnNpZ25lZEludDU5OTlUeXBlID0gMzU5MDI7CgoJLyoqCgkgKiBEaXNjYXJkcyB0aGUgcmVkLCBncmVlbiBhbmQgYmx1ZSBjb21wb25lbnRzIGFuZCByZWFkcyBqdXN0IHRoZSBhbHBoYSBjb21wb25lbnQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBBbHBoYUZvcm1hdCA9IDEwMjE7CgoJLyoqCgkgKiBEaXNjYXJkcyB0aGUgYWxwaGEgY29tcG9uZW50IGFuZCByZWFkcyB0aGUgcmVkLCBncmVlbiBhbmQgYmx1ZSBjb21wb25lbnQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JGb3JtYXQgPSAxMDIyOwoKCS8qKgoJICogUmVhZHMgdGhlIHJlZCwgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBRm9ybWF0ID0gMTAyMzsKCgkvKioKCSAqIFJlYWRzIGVhY2ggZWxlbWVudCBhcyBhIHNpbmdsZSBkZXB0aCB2YWx1ZSwgY29udmVydHMgaXQgdG8gZmxvYXRpbmcgcG9pbnQsIGFuZCBjbGFtcHMgdG8gdGhlIHJhbmdlIGBbMCwxXWAuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBEZXB0aEZvcm1hdCA9IDEwMjY7CgoJLyoqCgkgKiBSZWFkcyBlYWNoIGVsZW1lbnQgaXMgYSBwYWlyIG9mIGRlcHRoIGFuZCBzdGVuY2lsIHZhbHVlcy4gVGhlIGRlcHRoIGNvbXBvbmVudCBvZiB0aGUgcGFpciBpcyBpbnRlcnByZXRlZCBhcwoJICogaW4gYERlcHRoRm9ybWF0YC4gVGhlIHN0ZW5jaWwgY29tcG9uZW50IGlzIGludGVycHJldGVkIGJhc2VkIG9uIHRoZSBkZXB0aCArIHN0ZW5jaWwgaW50ZXJuYWwgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgRGVwdGhTdGVuY2lsRm9ybWF0ID0gMTAyNzsKCgkvKioKCSAqIERpc2NhcmRzIHRoZSBncmVlbiwgYmx1ZSBhbmQgYWxwaGEgY29tcG9uZW50cyBhbmQgcmVhZHMganVzdCB0aGUgcmVkIGNvbXBvbmVudC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJlZEZvcm1hdCA9IDEwMjg7CgoJLyoqCgkgKiBEaXNjYXJkcyB0aGUgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMgYW5kIHJlYWRzIGp1c3QgdGhlIHJlZCBjb21wb25lbnQuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJlZEludGVnZXJGb3JtYXQgPSAxMDI5OwoKCS8qKgoJICogRGlzY2FyZHMgdGhlIGFscGhhLCBhbmQgYmx1ZSBjb21wb25lbnRzIGFuZCByZWFkcyB0aGUgcmVkLCBhbmQgZ3JlZW4gY29tcG9uZW50cy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHRm9ybWF0ID0gMTAzMDsKCgkvKioKCSAqIERpc2NhcmRzIHRoZSBhbHBoYSwgYW5kIGJsdWUgY29tcG9uZW50cyBhbmQgcmVhZHMgdGhlIHJlZCwgYW5kIGdyZWVuIGNvbXBvbmVudHMuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHSW50ZWdlckZvcm1hdCA9IDEwMzE7CgoJLyoqCgkgKiBSZWFkcyB0aGUgcmVkLCBncmVlbiwgYmx1ZSBhbmQgYWxwaGEgY29tcG9uZW50cy4gVGhlIHRleGVscyBhcmUgcmVhZCBhcyBpbnRlZ2VycyBpbnN0ZWFkIG9mIGZsb2F0aW5nIHBvaW50LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQUludGVnZXJGb3JtYXQgPSAxMDMzOwoKCS8qKgoJICogQSBEWFQxLWNvbXByZXNzZWQgaW1hZ2UgaW4gYW4gUkdCIGltYWdlIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQl9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3NzY7CgoJLyoqCgkgKiBBIERYVDEtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0IgaW1hZ2UgZm9ybWF0IHdpdGggYSBzaW1wbGUgb24vb2ZmIGFscGhhIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3Nzc7CgoJLyoqCgkgKiBBIERYVDMtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0JBIGltYWdlIGZvcm1hdC4gQ29tcGFyZWQgdG8gYSAzMi1iaXQgUkdCQSB0ZXh0dXJlLCBpdCBvZmZlcnMgNDoxIGNvbXByZXNzaW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9TM1RDX0RYVDNfRm9ybWF0ID0gMzM3Nzg7CgoJLyoqCgkgKiBBIERYVDUtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0JBIGltYWdlIGZvcm1hdC4gSXQgYWxzbyBwcm92aWRlcyBhIDQ6MSBjb21wcmVzc2lvbiwgYnV0IGRpZmZlcnMgdG8gdGhlIERYVDMKCSAqIGNvbXByZXNzaW9uIGluIGhvdyB0aGUgYWxwaGEgY29tcHJlc3Npb24gaXMgZG9uZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCA9IDMzNzc5OwoKCS8qKgoJICogUFZSVEMgUkdCIGNvbXByZXNzaW9uIGluIDQtYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA0w5c0IHBpeGVscy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDA7CgoJLyoqCgkgKiBQVlJUQyBSR0IgY29tcHJlc3Npb24gaW4gMi1iaXQgbW9kZS4gT25lIGJsb2NrIGZvciBlYWNoIDjDlzQgcGl4ZWxzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MTsKCgkvKioKCSAqIFBWUlRDIFJHQkEgY29tcHJlc3Npb24gaW4gNC1iaXQgbW9kZS4gT25lIGJsb2NrIGZvciBlYWNoIDTDlzQgcGl4ZWxzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDI7CgoJLyoqCgkgKiBQVlJUQyBSR0JBIGNvbXByZXNzaW9uIGluIDItYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA4w5c0IHBpeGVscy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCA9IDM1ODQzOwoKCS8qKgoJICogRVRDMSBSR0IgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCX0VUQzFfRm9ybWF0ID0gMzYxOTY7CgoJLyoqCgkgKiBFVEMyIFJHQiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JfRVRDMl9Gb3JtYXQgPSAzNzQ5MjsKCgkvKioKCSAqIEVUQzIgUkdCQSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0VUQzJfRUFDX0Zvcm1hdCA9IDM3NDk2OwoKCS8qKgoJICogQVNUQyBSR0JBIDR4NCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNHg0X0Zvcm1hdCA9IDM3ODA4OwoKCS8qKgoJICogQVNUQyBSR0JBIDV4NCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNXg0X0Zvcm1hdCA9IDM3ODA5OwoKCS8qKgoJICogQVNUQyBSR0JBIDV4NSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNXg1X0Zvcm1hdCA9IDM3ODEwOwoKCS8qKgoJICogQVNUQyBSR0JBIDZ4NSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNng1X0Zvcm1hdCA9IDM3ODExOwoKCS8qKgoJICogQVNUQyBSR0JBIDZ4NiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNng2X0Zvcm1hdCA9IDM3ODEyOwoKCS8qKgoJICogQVNUQyBSR0JBIDh4NSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfOHg1X0Zvcm1hdCA9IDM3ODEzOwoKCS8qKgoJICogQVNUQyBSR0JBIDh4NiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfOHg2X0Zvcm1hdCA9IDM3ODE0OwoKCS8qKgoJICogQVNUQyBSR0JBIDh4OCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfOHg4X0Zvcm1hdCA9IDM3ODE1OwoKCS8qKgoJICogQVNUQyBSR0JBIDEweDUgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9BU1RDXzEweDVfRm9ybWF0ID0gMzc4MTY7CgoJLyoqCgkgKiBBU1RDIFJHQkEgMTB4NiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgPSAzNzgxNzsKCgkvKioKCSAqIEFTVEMgUkdCQSAxMHg4IGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCA9IDM3ODE4OwoKCS8qKgoJICogQVNUQyBSR0JBIDEweDEwIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSAzNzgxOTsKCgkvKioKCSAqIEFTVEMgUkdCQSAxMngxMCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0ID0gMzc4MjA7CgoJLyoqCgkgKiBBU1RDIFJHQkEgMTJ4MTIgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCA9IDM3ODIxOwoKCS8qKgoJICogQlBUQyBSR0JBIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfQlBUQ19Gb3JtYXQgPSAzNjQ5MjsKCgkvKioKCSAqIEJQVEMgU2lnbmVkIFJHQiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JfQlBUQ19TSUdORURfRm9ybWF0ID0gMzY0OTQ7CgoJLyoqCgkgKiBCUFRDIFVuc2lnbmVkIFJHQiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgPSAzNjQ5NTsKCgkvKioKCSAqIFJHVEMxIFJlZCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSRURfUkdUQzFfRm9ybWF0ID0gMzYyODM7CgoJLyoqCgkgKiBSR1RDMSBTaWduZWQgUmVkIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFNJR05FRF9SRURfUkdUQzFfRm9ybWF0ID0gMzYyODQ7CgoJLyoqCgkgKiBSR1RDMiBSZWQgR3JlZW4gZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg1OwoKCS8qKgoJICogUkdUQzIgU2lnbmVkIFJlZCBHcmVlbiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg2OwoKCS8qKgoJICogQmFzaWMgZGVwdGggcGFja2luZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEJhc2ljRGVwdGhQYWNraW5nID0gMzIwMDsKCgkvKioKCSAqIEEgZGVwdGggdmFsdWUgaXMgcGFja2VkIGludG8gMzIgYml0IFJHQkEuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBRGVwdGhQYWNraW5nID0gMzIwMTsKCgkvKioKCSAqIE5vcm1hbCBpbmZvcm1hdGlvbiBpcyByZWxhdGl2ZSB0byB0aGUgdW5kZXJseWluZyBzdXJmYWNlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVGFuZ2VudFNwYWNlTm9ybWFsTWFwID0gMDsKCgkvKioKCSAqIE5vcm1hbCBpbmZvcm1hdGlvbiBpcyByZWxhdGl2ZSB0byB0aGUgb2JqZWN0IG9yaWVudGF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgT2JqZWN0U3BhY2VOb3JtYWxNYXAgPSAxOwoKCS8vIENvbG9yIHNwYWNlIHN0cmluZyBpZGVudGlmaWVycywgbWF0Y2hpbmcgQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0IGFuZCBXZWJHUFUgbmFtZXMgd2hlcmUgYXZhaWxhYmxlLgoKCS8qKgoJICogTm8gY29sb3Igc3BhY2UuCgkgKgoJICogQHR5cGUge3N0cmluZ30KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOb0NvbG9yU3BhY2UgPSAnJzsKCgkvKioKCSAqIHNSR0IgY29sb3Igc3BhY2UuCgkgKgoJICogQHR5cGUge3N0cmluZ30KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTUkdCQ29sb3JTcGFjZSA9ICdzcmdiJzsKCgkvKioKCSAqIHNSR0ItbGluZWFyIGNvbG9yIHNwYWNlLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyU1JHQkNvbG9yU3BhY2UgPSAnc3JnYi1saW5lYXInOwoKCS8qKgoJICogTGluZWFyIHRyYW5zZmVyIGZ1bmN0aW9uLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyVHJhbnNmZXIgPSAnbGluZWFyJzsKCgkvKioKCSAqIHNSR0IgdHJhbnNmZXIgZnVuY3Rpb24uCgkgKgoJICogQHR5cGUge3N0cmluZ30KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTUkdCVHJhbnNmZXIgPSAnc3JnYic7CgoJLyoqCgkgKiBLZWVwcyB0aGUgY3VycmVudCB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEtlZXBTdGVuY2lsT3AgPSA3NjgwOwoKCS8qKgoJICogV2lsbCBhbHdheXMgcmV0dXJuIHRydWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBBbHdheXNTdGVuY2lsRnVuYyA9IDUxOTsKCgkvKioKCSAqIE5ldmVyIHBhc3MuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOZXZlckNvbXBhcmUgPSA1MTI7CgoJLyoqCgkgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHRleHR1cmUgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBMZXNzQ29tcGFyZSA9IDUxMzsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGVxdWFscyB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEVxdWFsQ29tcGFyZSA9IDUxNDsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IExlc3NFcXVhbENvbXBhcmUgPSA1MTU7CgoJLyoqCgkgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRleHR1cmUgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBHcmVhdGVyQ29tcGFyZSA9IDUxNjsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIG5vdCBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE5vdEVxdWFsQ29tcGFyZSA9IDUxNzsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEdyZWF0ZXJFcXVhbENvbXBhcmUgPSA1MTg7CgoJLyoqCgkgKiBBbHdheXMgcGFzcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEFsd2F5c0NvbXBhcmUgPSA1MTk7CgoJLyoqCgkgKiBUaGUgY29udGVudHMgYXJlIGludGVuZGVkIHRvIGJlIHNwZWNpZmllZCBvbmNlIGJ5IHRoZSBhcHBsaWNhdGlvbiwgYW5kIHVzZWQgbWFueQoJICogdGltZXMgYXMgdGhlIHNvdXJjZSBmb3IgZHJhd2luZyBhbmQgaW1hZ2Ugc3BlY2lmaWNhdGlvbiBjb21tYW5kcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFN0YXRpY0RyYXdVc2FnZSA9IDM1MDQ0OwoKCS8qKgoJICogR0xTTCAzIHNoYWRlciBjb2RlLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgR0xTTDMgPSAnMzAwIGVzJzsKCgkvKioKCSAqIFdlYkdMIGNvb3JkaW5hdGUgc3lzdGVtLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgV2ViR0xDb29yZGluYXRlU3lzdGVtID0gMjAwMDsKCgkvKioKCSAqIFdlYkdQVSBjb29yZGluYXRlIHN5c3RlbS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gPSAyMDAxOwoKCS8qKgoJICogVGhpcyB0eXBlIHJlcHJlc2VudHMgbW91c2UgYnV0dG9ucyBhbmQgaW50ZXJhY3Rpb24gdHlwZXMgaW4gY29udGV4dCBvZiBjb250cm9scy4KCSAqCgkgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb25zdGFudHNNb3VzZQoJICogQHByb3BlcnR5IHtudW1iZXJ9IE1JRERMRSAtIFRoZSBsZWZ0IG1vdXNlIGJ1dHRvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBMRUZUIC0gVGhlIG1pZGRsZSBtb3VzZSBidXR0b24uCgkgKiBAcHJvcGVydHkge251bWJlcn0gUklHSFQgLSBUaGUgcmlnaHQgbW91c2UgYnV0dG9uLgoJICogQHByb3BlcnR5IHtudW1iZXJ9IFJPVEFURSAtIEEgcm90YXRlIGludGVyYWN0aW9uLgoJICogQHByb3BlcnR5IHtudW1iZXJ9IERPTExZIC0gQSBkb2xseSBpbnRlcmFjdGlvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQQU4gLSBBIHBhbiBpbnRlcmFjdGlvbi4KCSAqKi8KCgkvKioKCSAqIFRoaXMgdHlwZSByZXByZXNlbnRzIHRvdWNoIGludGVyYWN0aW9uIHR5cGVzIGluIGNvbnRleHQgb2YgY29udHJvbHMuCgkgKgoJICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzVG91Y2gKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBST1RBVEUgLSBBIHJvdGF0ZSBpbnRlcmFjdGlvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQQU4gLSBBIHBhbiBpbnRlcmFjdGlvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBET0xMWV9QQU4gLSBUaGUgZG9sbHktcGFuIGludGVyYWN0aW9uLgoJICogQHByb3BlcnR5IHtudW1iZXJ9IERPTExZX1JPVEFURSAtIEEgZG9sbHktcm90YXRlIGludGVyYWN0aW9uLgoJICoqLwoKCS8qKgoJICogVGhpcyB0eXBlIHJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCB0aW1lc3RhbXAgcXVlcnkgdHlwZXMuCgkgKgoJICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzVGltZXN0YW1wUXVlcnkKCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDT01QVVRFIC0gQSBgY29tcHV0ZWAgdGltZXN0YW1wIHF1ZXJ5LgoJICogQHByb3BlcnR5IHtzdHJpbmd9IFJFTkRFUiAtIEEgYHJlbmRlcmAgdGltZXN0YW1wIHF1ZXJ5LgoJICoqLwoKCS8qKgoJICogUmVwcmVzZW50cyB0aGUgZGlmZmVyZW50IGludGVycG9sYXRpb24gc2FtcGxpbmcgdHlwZXMuCgkgKgoJICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzSW50ZXJwb2xhdGlvblNhbXBsaW5nVHlwZQoJICogQHByb3BlcnR5IHtzdHJpbmd9IFBFUlNQRUNUSVZFIC0gUGVyc3BlY3RpdmUtY29ycmVjdCBpbnRlcnBvbGF0aW9uLgoJICogQHByb3BlcnR5IHtzdHJpbmd9IExJTkVBUiAtIExpbmVhciBpbnRlcnBvbGF0aW9uLgoJICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVQgLSBGbGF0IGludGVycG9sYXRpb24uCgkgKi8KCgkvKioKCSAqIFJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCBpbnRlcnBvbGF0aW9uIHNhbXBsaW5nIG1vZGVzLgoJICoKCSAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnN0YW50c0ludGVycG9sYXRpb25TYW1wbGluZ01vZGUKCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBOT1JNQUwgLSBOb3JtYWwgc2FtcGxpbmcgbW9kZS4KCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDRU5UUk9JRCAtIENlbnRyb2lkIHNhbXBsaW5nIG1vZGUuCgkgKiBAcHJvcGVydHkge3N0cmluZ30gU0FNUExFIC0gU2FtcGxlLXNwZWNpZmljIHNhbXBsaW5nIG1vZGUuCgkgKiBAcHJvcGVydHkge3N0cmluZ30gRkxBVF9GSVJTVCAtIEZsYXQgaW50ZXJwb2xhdGlvbiB1c2luZyB0aGUgZmlyc3QgdmVydGV4LgoJICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVRfRUlUSEVSIC0gRmxhdCBpbnRlcnBvbGF0aW9uIHVzaW5nIGVpdGhlciB2ZXJ0ZXguCgkgKi8KCgkvKioKCSAqIFRoaXMgbW9kdWxlcyBhbGxvd3MgdG8gZGlzcGF0Y2ggZXZlbnQgb2JqZWN0cyBvbiBjdXN0b20gSmF2YVNjcmlwdCBvYmplY3RzLgoJICoKCSAqIE1haW4gcmVwb3NpdG9yeTogW2V2ZW50ZGlzcGF0Y2hlci5qc117QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi9ldmVudGRpc3BhdGNoZXIuanMvfQoJICoKCSAqIENvZGUgRXhhbXBsZToKCSAqIGBgYGpzCgkgKiBjbGFzcyBDYXIgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoJICogCXN0YXJ0KCkgewoJICoJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc3RhcnQnLCBtZXNzYWdlOiAndnJvb20gdnJvb20hJyB9ICk7CgkgKgl9CgkgKn07CgkgKgoJICogLy8gVXNpbmcgZXZlbnRzIHdpdGggdGhlIGN1c3RvbSBvYmplY3QKCSAqIGNvbnN0IGNhciA9IG5ldyBDYXIoKTsKCSAqIGNhci5hZGRFdmVudExpc3RlbmVyKCAnc3RhcnQnLCBmdW5jdGlvbiAoIGV2ZW50ICkgewoJICogCWFsZXJ0KCBldmVudC5tZXNzYWdlICk7CgkgKiB9ICk7CgkgKgoJICogY2FyLnN0YXJ0KCk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgRXZlbnREaXNwYXRjaGVyIHsKCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGdpdmVuIGV2ZW50IHR5cGUuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSB0eXBlIG9mIGV2ZW50IHRvIGxpc3RlbiB0by4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBmdW5jdGlvbiB0aGF0IGdldHMgY2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIGZpcmVkLgoJCSAqLwoJCWFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGxpc3RlbmVyICkgewoKCQkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHRoaXMuX2xpc3RlbmVycyA9IHt9OwoKCQkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKCQkJaWYgKCBsaXN0ZW5lcnNbIHR5cGUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWxpc3RlbmVyc1sgdHlwZSBdID0gW107CgoJCQl9CgoJCQlpZiAoIGxpc3RlbmVyc1sgdHlwZSBdLmluZGV4T2YoIGxpc3RlbmVyICkgPT09IC0xICkgewoKCQkJCWxpc3RlbmVyc1sgdHlwZSBdLnB1c2goIGxpc3RlbmVyICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGV2ZW50IGxpc3RlbmVyIGhhcyBiZWVuIGFkZGVkIHRvIHRoZSBnaXZlbiBldmVudCB0eXBlLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudC4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBsaXN0ZW5lciB0byBjaGVjay4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBoYXMgYmVlbiBhZGRlZCB0byB0aGUgZ2l2ZW4gZXZlbnQgdHlwZS4KCQkgKi8KCQloYXNFdmVudExpc3RlbmVyKCB0eXBlLCBsaXN0ZW5lciApIHsKCgkJCWNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCgkJCWlmICggbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSByZXR1cm4gZmFsc2U7CgoJCQlyZXR1cm4gbGlzdGVuZXJzWyB0eXBlIF0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApICE9PSAtMTsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBmcm9tIHRoZSBnaXZlbiBldmVudCB0eXBlLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudC4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBsaXN0ZW5lciB0byByZW1vdmUuCgkJICovCgkJcmVtb3ZlRXZlbnRMaXN0ZW5lciggdHlwZSwgbGlzdGVuZXIgKSB7CgoJCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgoJCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgdHlwZSBdOwoKCQkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgaW5kZXggPSBsaXN0ZW5lckFycmF5LmluZGV4T2YoIGxpc3RlbmVyICk7CgoJCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgoJCQkJCWxpc3RlbmVyQXJyYXkuc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBEaXNwYXRjaGVzIGFuIGV2ZW50IG9iamVjdC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAtIFRoZSBldmVudCB0aGF0IGdldHMgZmlyZWQuCgkJICovCgkJZGlzcGF0Y2hFdmVudCggZXZlbnQgKSB7CgoJCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgoJCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgZXZlbnQudHlwZSBdOwoKCQkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZXZlbnQudGFyZ2V0ID0gdGhpczsKCgkJCQkvLyBNYWtlIGEgY29weSwgaW4gY2FzZSBsaXN0ZW5lcnMgYXJlIHJlbW92ZWQgd2hpbGUgaXRlcmF0aW5nLgoJCQkJY29uc3QgYXJyYXkgPSBsaXN0ZW5lckFycmF5LnNsaWNlKCAwICk7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJYXJyYXlbIGkgXS5jYWxsKCB0aGlzLCBldmVudCApOwoKCQkJCX0KCgkJCQlldmVudC50YXJnZXQgPSBudWxsOwoKCQkJfQoKCQl9CgoJfQoKCWNvbnN0IF9sdXQgPSBbICcwMCcsICcwMScsICcwMicsICcwMycsICcwNCcsICcwNScsICcwNicsICcwNycsICcwOCcsICcwOScsICcwYScsICcwYicsICcwYycsICcwZCcsICcwZScsICcwZicsICcxMCcsICcxMScsICcxMicsICcxMycsICcxNCcsICcxNScsICcxNicsICcxNycsICcxOCcsICcxOScsICcxYScsICcxYicsICcxYycsICcxZCcsICcxZScsICcxZicsICcyMCcsICcyMScsICcyMicsICcyMycsICcyNCcsICcyNScsICcyNicsICcyNycsICcyOCcsICcyOScsICcyYScsICcyYicsICcyYycsICcyZCcsICcyZScsICcyZicsICczMCcsICczMScsICczMicsICczMycsICczNCcsICczNScsICczNicsICczNycsICczOCcsICczOScsICczYScsICczYicsICczYycsICczZCcsICczZScsICczZicsICc0MCcsICc0MScsICc0MicsICc0MycsICc0NCcsICc0NScsICc0NicsICc0NycsICc0OCcsICc0OScsICc0YScsICc0YicsICc0YycsICc0ZCcsICc0ZScsICc0ZicsICc1MCcsICc1MScsICc1MicsICc1MycsICc1NCcsICc1NScsICc1NicsICc1NycsICc1OCcsICc1OScsICc1YScsICc1YicsICc1YycsICc1ZCcsICc1ZScsICc1ZicsICc2MCcsICc2MScsICc2MicsICc2MycsICc2NCcsICc2NScsICc2NicsICc2NycsICc2OCcsICc2OScsICc2YScsICc2YicsICc2YycsICc2ZCcsICc2ZScsICc2ZicsICc3MCcsICc3MScsICc3MicsICc3MycsICc3NCcsICc3NScsICc3NicsICc3NycsICc3OCcsICc3OScsICc3YScsICc3YicsICc3YycsICc3ZCcsICc3ZScsICc3ZicsICc4MCcsICc4MScsICc4MicsICc4MycsICc4NCcsICc4NScsICc4NicsICc4NycsICc4OCcsICc4OScsICc4YScsICc4YicsICc4YycsICc4ZCcsICc4ZScsICc4ZicsICc5MCcsICc5MScsICc5MicsICc5MycsICc5NCcsICc5NScsICc5NicsICc5NycsICc5OCcsICc5OScsICc5YScsICc5YicsICc5YycsICc5ZCcsICc5ZScsICc5ZicsICdhMCcsICdhMScsICdhMicsICdhMycsICdhNCcsICdhNScsICdhNicsICdhNycsICdhOCcsICdhOScsICdhYScsICdhYicsICdhYycsICdhZCcsICdhZScsICdhZicsICdiMCcsICdiMScsICdiMicsICdiMycsICdiNCcsICdiNScsICdiNicsICdiNycsICdiOCcsICdiOScsICdiYScsICdiYicsICdiYycsICdiZCcsICdiZScsICdiZicsICdjMCcsICdjMScsICdjMicsICdjMycsICdjNCcsICdjNScsICdjNicsICdjNycsICdjOCcsICdjOScsICdjYScsICdjYicsICdjYycsICdjZCcsICdjZScsICdjZicsICdkMCcsICdkMScsICdkMicsICdkMycsICdkNCcsICdkNScsICdkNicsICdkNycsICdkOCcsICdkOScsICdkYScsICdkYicsICdkYycsICdkZCcsICdkZScsICdkZicsICdlMCcsICdlMScsICdlMicsICdlMycsICdlNCcsICdlNScsICdlNicsICdlNycsICdlOCcsICdlOScsICdlYScsICdlYicsICdlYycsICdlZCcsICdlZScsICdlZicsICdmMCcsICdmMScsICdmMicsICdmMycsICdmNCcsICdmNScsICdmNicsICdmNycsICdmOCcsICdmOScsICdmYScsICdmYicsICdmYycsICdmZCcsICdmZScsICdmZicgXTsKCgoJY29uc3QgREVHMlJBRCA9IE1hdGguUEkgLyAxODA7Cgljb25zdCBSQUQyREVHID0gMTgwIC8gTWF0aC5QSTsKCgkvKioKCSAqIEdlbmVyYXRlIGEgW1VVSURde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1VuaXZlcnNhbGx5X3VuaXF1ZV9pZGVudGlmaWVyfQoJICogKHVuaXZlcnNhbGx5IHVuaXF1ZSBpZGVudGlmaWVyKS4KCSAqCgkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVVUlELgoJICovCglmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CgoJCS8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1MDM0L2hvdy10by1jcmVhdGUtYS1ndWlkLXV1aWQtaW4tamF2YXNjcmlwdC8yMTk2MzEzNiMyMTk2MzEzNgoKCQljb25zdCBkMCA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCBkMSA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCBkMiA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCBkMyA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCB1dWlkID0gX2x1dFsgZDAgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiA4ICYgMHhmZiBdICsgX2x1dFsgZDAgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiAyNCAmIDB4ZmYgXSArICctJyArCgkJCQlfbHV0WyBkMSAmIDB4ZmYgXSArIF9sdXRbIGQxID4+IDggJiAweGZmIF0gKyAnLScgKyBfbHV0WyBkMSA+PiAxNiAmIDB4MGYgfCAweDQwIF0gKyBfbHV0WyBkMSA+PiAyNCAmIDB4ZmYgXSArICctJyArCgkJCQlfbHV0WyBkMiAmIDB4M2YgfCAweDgwIF0gKyBfbHV0WyBkMiA+PiA4ICYgMHhmZiBdICsgJy0nICsgX2x1dFsgZDIgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMiA+PiAyNCAmIDB4ZmYgXSArCgkJCQlfbHV0WyBkMyAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDggJiAweGZmIF0gKyBfbHV0WyBkMyA+PiAxNiAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDI0ICYgMHhmZiBdOwoKCQkvLyAudG9Mb3dlckNhc2UoKSBoZXJlIGZsYXR0ZW5zIGNvbmNhdGVuYXRlZCBzdHJpbmdzIHRvIHNhdmUgaGVhcCBtZW1vcnkgc3BhY2UuCgkJcmV0dXJuIHV1aWQudG9Mb3dlckNhc2UoKTsKCgl9CgoJLyoqCgkgKiBDbGFtcHMgdGhlIGdpdmVuIHZhbHVlIGJldHdlZW4gbWluIGFuZCBtYXguCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNsYW1wLgoJICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW4gdmFsdWUuCgkgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heCB2YWx1ZS4KCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNsYW1wZWQgdmFsdWUuCgkgKi8KCWZ1bmN0aW9uIGNsYW1wKCB2YWx1ZSwgbWluLCBtYXggKSB7CgoJCXJldHVybiBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCB2YWx1ZSApICk7CgoJfQoKCS8qKgoJICogQ29tcHV0ZXMgdGhlIEV1Y2xpZGVhbiBtb2R1bG8gb2YgdGhlIGdpdmVuIHBhcmFtZXRlcnMgdGhhdAoJICogaXMgYCggKCBuICUgbSApICsgbSApICUgbWAuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IG4gLSBUaGUgZmlyc3QgcGFyYW1ldGVyLgoJICogQHBhcmFtIHtudW1iZXJ9IG0gLSBUaGUgc2Vjb25kIHBhcmFtZXRlci4KCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIEV1Y2xpZGVhbiBtb2R1bG8uCgkgKi8KCWZ1bmN0aW9uIGV1Y2xpZGVhbk1vZHVsbyggbiwgbSApIHsKCgkJLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTW9kdWxvX29wZXJhdGlvbgoKCQlyZXR1cm4gKCAoIG4gJSBtICkgKyBtICkgJSBtOwoKCX0KCgkvKioKCSAqIFJldHVybnMgYSB2YWx1ZSBsaW5lYXJseSBpbnRlcnBvbGF0ZWQgZnJvbSB0d28ga25vd24gcG9pbnRzIGJhc2VkIG9uIHRoZSBnaXZlbiBpbnRlcnZhbCAtCgkgKiBgdCA9IDBgIHdpbGwgcmV0dXJuIGB4YCBhbmQgYHQgPSAxYCB3aWxsIHJldHVybiBgeWAuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgc3RhcnQgcG9pbnQKCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGVuZCBwb2ludC4KCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCgkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbnRlcnBvbGF0ZWQgdmFsdWUuCgkgKi8KCWZ1bmN0aW9uIGxlcnAoIHgsIHksIHQgKSB7CgoJCXJldHVybiAoIDEgLSB0ICkgKiB4ICsgdCAqIHk7CgoJfQoKCS8qKgoJICogRGVub3JtYWxpemVzIHRoZSBnaXZlbiB2YWx1ZSBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHR5cGVkIGFycmF5LgoJICoKCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBkZW5vcm1hbGl6ZS4KCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgdHlwZWQgYXJyYXkgdGhhdCBkZWZpbmVzIHRoZSBkYXRhIHR5cGUgb2YgdGhlIHZhbHVlLgoJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGVub3JtYWxpemUgKGZsb2F0KSB2YWx1ZSBpbiB0aGUgcmFuZ2UgYFswLDFdYC4KCSAqLwoJZnVuY3Rpb24gZGVub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCgkJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgoJCQljYXNlIEZsb2F0MzJBcnJheToKCgkJCQlyZXR1cm4gdmFsdWU7CgoJCQljYXNlIFVpbnQzMkFycmF5OgoKCQkJCXJldHVybiB2YWx1ZSAvIDQyOTQ5NjcyOTUuMDsKCgkJCWNhc2UgVWludDE2QXJyYXk6CgoJCQkJcmV0dXJuIHZhbHVlIC8gNjU1MzUuMDsKCgkJCWNhc2UgVWludDhBcnJheToKCgkJCQlyZXR1cm4gdmFsdWUgLyAyNTUuMDsKCgkJCWNhc2UgSW50MzJBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMjE0NzQ4MzY0Ny4wLCAtMSApOwoKCQkJY2FzZSBJbnQxNkFycmF5OgoKCQkJCXJldHVybiBNYXRoLm1heCggdmFsdWUgLyAzMjc2Ny4wLCAtMSApOwoKCQkJY2FzZSBJbnQ4QXJyYXk6CgoJCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDEyNy4wLCAtMSApOwoKCQkJZGVmYXVsdDoKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCgkJfQoKCX0KCgkvKioKCSAqIE5vcm1hbGl6ZXMgdGhlIGdpdmVuIHZhbHVlIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gdHlwZWQgYXJyYXkuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIGZsb2F0IHZhbHVlIGluIHRoZSByYW5nZSBgWzAsMV1gIHRvIG5vcm1hbGl6ZS4KCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgdHlwZWQgYXJyYXkgdGhhdCBkZWZpbmVzIHRoZSBkYXRhIHR5cGUgb2YgdGhlIHZhbHVlLgoJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbm9ybWFsaXplIHZhbHVlLgoJICovCglmdW5jdGlvbiBub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCgkJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgoJCQljYXNlIEZsb2F0MzJBcnJheToKCgkJCQlyZXR1cm4gdmFsdWU7CgoJCQljYXNlIFVpbnQzMkFycmF5OgoKCQkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDQyOTQ5NjcyOTUuMCApOwoKCQkJY2FzZSBVaW50MTZBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiA2NTUzNS4wICk7CgoJCQljYXNlIFVpbnQ4QXJyYXk6CgoJCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogMjU1LjAgKTsKCgkJCWNhc2UgSW50MzJBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAyMTQ3NDgzNjQ3LjAgKTsKCgkJCWNhc2UgSW50MTZBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAzMjc2Ny4wICk7CgoJCQljYXNlIEludDhBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAxMjcuMCApOwoKCQkJZGVmYXVsdDoKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIDJEIHZlY3Rvci4gQSAyRCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCBwYWlyIG9mIG51bWJlcnMKCSAqIChsYWJlbGVkIHggYW5kIHkpLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgoJICoKCSAqIC0gQSBwb2ludCBpbiAyRCBzcGFjZSAoaS5lLiBhIHBvc2l0aW9uIG9uIGEgcGxhbmUpLgoJICogLSBBIGRpcmVjdGlvbiBhbmQgbGVuZ3RoIGFjcm9zcyBhIHBsYW5lLiBJbiB0aHJlZS5qcyB0aGUgbGVuZ3RoIHdpbGwKCSAqIGFsd2F5cyBiZSB0aGUgRXVjbGlkZWFuIGRpc3RhbmNlKHN0cmFpZ2h0LWxpbmUgZGlzdGFuY2UpIGZyb20gYCgwLCAwKWAgdG8gYCh4LCB5KWAKCSAqIGFuZCB0aGUgZGlyZWN0aW9uIGlzIGFsc28gbWVhc3VyZWQgZnJvbSBgKDAsIDApYCB0b3dhcmRzIGAoeCwgeSlgLgoJICogLSBBbnkgYXJiaXRyYXJ5IG9yZGVyZWQgcGFpciBvZiBudW1iZXJzLgoJICoKCSAqIFRoZXJlIGFyZSBvdGhlciB0aGluZ3MgYSAyRCB2ZWN0b3IgY2FuIGJlIHVzZWQgdG8gcmVwcmVzZW50LCBzdWNoIGFzCgkgKiBtb21lbnR1bSB2ZWN0b3JzLCBjb21wbGV4IG51bWJlcnMgYW5kIHNvIG9uLCBob3dldmVyIHRoZXNlIGFyZSB0aGUgbW9zdAoJICogY29tbW9uIHVzZXMgaW4gdGhyZWUuanMuCgkgKgoJICogSXRlcmF0aW5nIHRocm91Z2ggYSB2ZWN0b3IgaW5zdGFuY2Ugd2lsbCB5aWVsZCBpdHMgY29tcG9uZW50cyBgKHgsIHkpYCBpbgoJICogdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCgkgKiBgYGBqcwoJICogY29uc3QgYSA9IG5ldyBUSFJFRS5WZWN0b3IyKCAwLCAxICk7CgkgKgoJICogLy9ubyBhcmd1bWVudHM7IHdpbGwgYmUgaW5pdGlhbGlzZWQgdG8gKDAsIDApCgkgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjIoICk7CgkgKgoJICogY29uc3QgZCA9IGEuZGlzdGFuY2VUbyggYiApOwoJICogYGBgCgkgKi8KCWNsYXNzIFZlY3RvcjIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IDJEIHZlY3Rvci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeD0wXSAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeT0wXSAtIFRoZSB5IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJVmVjdG9yMi5wcm90b3R5cGUuaXNWZWN0b3IyID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMueCA9IHg7CgoJCQkvKioKCQkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnkgPSB5OwoKCQl9CgoJCS8qKgoJCSAqIEFsaWFzIGZvciB7QGxpbmsgVmVjdG9yMiN4fS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICovCgkJZ2V0IHdpZHRoKCkgewoKCQkJcmV0dXJuIHRoaXMueDsKCgkJfQoKCQlzZXQgd2lkdGgoIHZhbHVlICkgewoKCQkJdGhpcy54ID0gdmFsdWU7CgoJCX0KCgkJLyoqCgkJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3IyI3l9LgoJCSAqCgkJICogQHR5cGUge251bWJlcn0KCQkgKi8KCQlnZXQgaGVpZ2h0KCkgewoKCQkJcmV0dXJuIHRoaXMueTsKCgkJfQoKCQlzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCgkJCXRoaXMueSA9IHZhbHVlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXQoIHgsIHkgKSB7CgoJCQl0aGlzLnggPSB4OwoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHNhbWUgdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHZhbHVlIHRvIHNldCBmb3IgYWxsIHZlY3RvciBjb21wb25lbnRzLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ID0gc2NhbGFyOwoJCQl0aGlzLnkgPSBzY2FsYXI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB4IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRYKCB4ICkgewoKCQkJdGhpcy54ID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvcidzIHkgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFkoIHkgKSB7CgoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWxsb3dzIHRvIHNldCBhIHZlY3RvciBjb21wb25lbnQgd2l0aCBhbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSB2ZWN0b3IgY29tcG9uZW50IHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbXBvbmVudCBpbmRleC4gYDBgIGVxdWFscyB0byB4LCBgMWAgZXF1YWxzIHRvIHkuCgkJICogQHJldHVybiB7bnVtYmVyfSBBIHZlY3RvciBjb21wb25lbnQgdmFsdWUuCgkJICovCgkJZ2V0Q29tcG9uZW50KCBpbmRleCApIHsKCgkJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKCQkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKCQkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyB2ZWN0b3Igd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnkgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGNvcHkuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY29weSggdiApIHsKCgkJCXRoaXMueCA9IHYueDsKCQkJdGhpcy55ID0gdi55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGFkZC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGQoIHYgKSB7CgoJCQl0aGlzLnggKz0gdi54OwoJCQl0aGlzLnkgKz0gdi55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFNjYWxhciggcyApIHsKCgkJCXRoaXMueCArPSBzOwoJCQl0aGlzLnkgKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKyBiLng7CgkJCXRoaXMueSA9IGEueSArIGIueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciBzY2FsZWQgYnkgdGhlIGdpdmVuIGZhY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBmYWN0b3IgdGhhdCBzY2FsZXMgYHZgLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCgkJCXRoaXMueCArPSB2LnggKiBzOwoJCQl0aGlzLnkgKz0gdi55ICogczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gc3VidHJhY3QuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc3ViKCB2ICkgewoKCQkJdGhpcy54IC09IHYueDsKCQkJdGhpcy55IC09IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIGZyb20gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBzdWJ0cmFjdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzdWJTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnggLT0gczsKCQkJdGhpcy55IC09IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggLSBiLng7CgkJCXRoaXMueSA9IGEueSAtIGIueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIG11bHRpcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW11bHRpcGx5KCB2ICkgewoKCQkJdGhpcy54ICo9IHYueDsKCQkJdGhpcy55ICo9IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ICo9IHNjYWxhcjsKCQkJdGhpcy55ICo9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZGl2aWRlKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGlzIHZlY3RvciAod2l0aCBhbiBpbXBsaWNpdCAxIGFzIHRoZSAzcmQgY29tcG9uZW50KSBieQoJCSAqIHRoZSBnaXZlbiAzeDMgbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhcHBseU1hdHJpeDMoIG0gKSB7CgoJCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55OwoJCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyAzIF0gKiB5ICsgZVsgNiBdOwoJCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCBvciB5IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgZ2l2ZW4gdmVjdG9yJ3MgeCBvciB5CgkJICogdmFsdWUsIHJlcGxhY2UgdGhhdCB2YWx1ZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIG1pbiB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbWluKCB2ICkgewoKCQkJdGhpcy54ID0gTWF0aC5taW4oIHRoaXMueCwgdi54ICk7CgkJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4IG9yIHkKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltYXgoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2ZWN0b3IncyB4IG9yIHkKCQkgKiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmVjdG9yJ3MgeCBvciB5IHZhbHVlLAoJCSAqIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSBtaW4gLSBUaGUgbWluaW11bSB4IGFuZCB5IHZhbHVlcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1heCAtIFRoZSBtYXhpbXVtIHggYW5kIHkgdmFsdWVzIGluIHRoZSBkZXNpcmVkIHJhbmdlLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNsYW1wKCBtaW4sIG1heCApIHsKCgkJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgoJCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW4ueCwgbWF4LnggKTsKCQkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluLnksIG1heC55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZXMgYXJlIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCB0aGV5IGFyZQoJCSAqIHJlcGxhY2VkIGJ5IHRoZSBtYXggdmFsdWUuCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWVzIGFyZSBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgdGhleSBhcmUKCQkgKiByZXBsYWNlZCBieSB0aGUgbWluIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IG1pblZhbCAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcGFyYW0ge251bWJlcn0gbWF4VmFsIC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNsYW1wU2NhbGFyKCBtaW5WYWwsIG1heFZhbCApIHsKCgkJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pblZhbCwgbWF4VmFsICk7CgkJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pblZhbCwgbWF4VmFsICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkKCQkgKiB0aGUgbWF4IHZhbHVlLgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUKCQkgKiBtaW4gdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gbWluIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXggLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKCQkJY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggY2xhbXAoIGxlbmd0aCwgbWluLCBtYXggKSApOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWZsb29yKCkgewoKCQkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNlaWwoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmQoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0b3dhcmRzIHplcm8gKHVwIGlmIG5lZ2F0aXZlLAoJCSAqIGRvd24gaWYgcG9zaXRpdmUpIHRvIGFuIGludGVnZXIgdmFsdWUuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlyb3VuZFRvWmVybygpIHsKCgkJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLnRydW5jKCB0aGlzLnkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEludmVydHMgdGhpcyB2ZWN0b3IgLSBpLmUuIHNldHMgeCA9IC14IGFuZCB5ID0gLXkuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQluZWdhdGUoKSB7CgoJCQl0aGlzLnggPSAtIHRoaXMueDsKCQkJdGhpcy55ID0gLSB0aGlzLnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgZG90IHByb2R1Y3Qgd2l0aC4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgdGhlIGRvdCBwcm9kdWN0LgoJCSAqLwoJCWRvdCggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2Lnk7CgoJCX0KCgkJLyoqCgkJICogQ2FsY3VsYXRlcyB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgY3Jvc3MgcHJvZHVjdCB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgY3Jvc3MgcHJvZHVjdC4KCQkgKi8KCQljcm9zcyggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnkgLSB0aGlzLnkgKiB2Lng7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHNxdWFyZSBvZiB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIGZyb20KCQkgKiAoMCwgMCkgdG8gKHgsIHkpLiBJZiB5b3UgYXJlIGNvbXBhcmluZyB0aGUgbGVuZ3RocyBvZiB2ZWN0b3JzLCB5b3Ugc2hvdWxkCgkJICogY29tcGFyZSB0aGUgbGVuZ3RoIHNxdWFyZWQgaW5zdGVhZCBhcyBpdCBpcyBzbGlnaHRseSBtb3JlIGVmZmljaWVudCB0byBjYWxjdWxhdGUuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlbmd0aFNxKCkgewoKCQkJcmV0dXJuIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tICgwLCAwKSB0byAoeCwgeSkuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJbGVuZ3RoKCkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJbWFuaGF0dGFuTGVuZ3RoKCkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKTsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGlzIHZlY3RvciB0byBhIHVuaXQgdmVjdG9yIC0gdGhhdCBpcywgc2V0cyBpdCBlcXVhbCB0byBhIHZlY3RvcgoJCSAqIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQgd2l0aCBhIHZlY3RvciBsZW5ndGggb2YgYDFgLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbm9ybWFsaXplKCkgewoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgYW5nbGUgaW4gcmFkaWFucyBvZiB0aGlzIHZlY3RvciB3aXRoIHJlc3BlY3QgdG8gdGhlIHBvc2l0aXZlIHgtYXhpcy4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICovCgkJYW5nbGUoKSB7CgoJCQljb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoIC0gdGhpcy55LCAtIHRoaXMueCApICsgTWF0aC5QSTsKCgkJCXJldHVybiBhbmdsZTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgYW5nbGUgd2l0aC4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqLwoJCWFuZ2xlVG8oIHYgKSB7CgoJCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgoJCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKCQkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgoJCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKCQkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtMSwgMSApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICogSWYgeW91IGFyZSBqdXN0IGNvbXBhcmluZyB0aGUgZGlzdGFuY2Ugd2l0aCBhbm90aGVyIGRpc3RhbmNlLCB5b3Ugc2hvdWxkIGNvbXBhcmUKCQkgKiB0aGUgZGlzdGFuY2Ugc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgc3F1YXJlZCBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKCQkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55OwoJCQlyZXR1cm4gZHggKiBkeCArIGR5ICogZHk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIE1hbmhhdHRhbiBkaXN0YW5jZS4KCQkgKi8KCQltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdmVjdG9yIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQKCQkgKiB3aXRoIHRoZSBzcGVjaWZpZWQgbGVuZ3RoLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCAtIFRoZSBuZXcgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldExlbmd0aCggbGVuZ3RoICkgewoKCQkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UsIHdoZXJlCgkJICogYWxwaGEgaXMgdGhlIHBlcmNlbnQgZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgLSBhbHBoYSA9IDAgd2lsbCBiZSB0aGlzCgkJICogdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwgYmUgdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gaW50ZXJwb2xhdGUgdG93YXJkcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlcnAoIHYsIGFscGhhICkgewoKCQkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKCQkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3JzLCB3aGVyZSBhbHBoYSBpcyB0aGUgcGVyY2VudAoJCSAqIGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgZmlyc3QgdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwKCQkgKiBiZSB0aGUgc2Vjb25kIG9uZS4gVGhlIHJlc3VsdCBpcyBzdG9yZWQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdjEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdjIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKCQkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwoJCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggdiApIHsKCgkJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdmVjdG9yJ3MgeCB2YWx1ZSB0byBiZSBgYXJyYXlbIG9mZnNldCBdYCBhbmQgeQoJCSAqIHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMSBdYC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGlzIHZlY3RvciBhcm91bmQgdGhlIGdpdmVuIGNlbnRlciBieSB0aGUgZ2l2ZW4gYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGNlbnRlciAtIFRoZSBwb2ludCBhcm91bmQgd2hpY2ggdG8gcm90YXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSB0byByb3RhdGUsIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm90YXRlQXJvdW5kKCBjZW50ZXIsIGFuZ2xlICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCBhbmdsZSApLCBzID0gTWF0aC5zaW4oIGFuZ2xlICk7CgoJCQljb25zdCB4ID0gdGhpcy54IC0gY2VudGVyLng7CgkJCWNvbnN0IHkgPSB0aGlzLnkgLSBjZW50ZXIueTsKCgkJCXRoaXMueCA9IHggKiBjIC0geSAqIHMgKyBjZW50ZXIueDsKCQkJdGhpcy55ID0geCAqIHMgKyB5ICogYyArIGNlbnRlci55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyBlYWNoIGNvbXBvbmVudCBvZiB0aGlzIHZlY3RvciB0byBhIHBzZXVkby1yYW5kb20gdmFsdWUgYmV0d2VlbiBgMGAgYW5kCgkJICogYDFgLCBleGNsdWRpbmcgYDFgLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcmFuZG9tKCkgewoKCQkJdGhpcy54ID0gTWF0aC5yYW5kb20oKTsKCQkJdGhpcy55ID0gTWF0aC5yYW5kb20oKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQkJeWllbGQgdGhpcy54OwoJCQl5aWVsZCB0aGlzLnk7CgoJCX0KCgl9CgoJLyoqCgkgKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgUXVhdGVybmlvbi4gUXVhdGVybmlvbnMgYXJlIHVzZWQgaW4gdGhyZWUuanMgdG8gcmVwcmVzZW50IHJvdGF0aW9ucy4KCSAqCgkgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeiwgdylgIGluCgkgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KCSAqCgkgKiBOb3RlIHRoYXQgdGhyZWUuanMgZXhwZWN0cyBRdWF0ZXJuaW9ucyB0byBiZSBub3JtYWxpemVkLgoJICogYGBganMKCSAqIGNvbnN0IHF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpOwoJICogcXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBuZXcgVEhSRUUuVmVjdG9yMyggMCwgMSwgMCApLCBNYXRoLlBJIC8gMiApOwoJICoKCSAqIGNvbnN0IHZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAwLCAwICk7CgkgKiB2ZWN0b3IuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ZXJuaW9uICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgUXVhdGVybmlvbiB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeD0wXSAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdz0xXSAtIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCwgdyA9IDEgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc1F1YXRlcm5pb24gPSB0cnVlOwoKCQkJdGhpcy5feCA9IHg7CgkJCXRoaXMuX3kgPSB5OwoJCQl0aGlzLl96ID0gejsKCQkJdGhpcy5fdyA9IHc7CgoJCX0KCgkJLyoqCgkJICogSW50ZXJwb2xhdGVzIGJldHdlZW4gdHdvIHF1YXRlcm5pb25zIHZpYSBTTEVSUC4gVGhpcyBpbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZQoJCSAqIHF1YXRlcm5pb24gZGF0YSBhcmUgbWFuYWdlZCAgaW4gZmxhdCBhcnJheXMuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGRzdCAtIFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZHN0T2Zmc2V0IC0gQW4gb2Zmc2V0IGludG8gdGhlIGRlc3RpbmF0aW9uIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMCAtIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIGZpcnN0IHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHNyY09mZnNldDAgLSBBbiBvZmZzZXQgaW50byB0aGUgZmlyc3Qgc291cmNlIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMSAtICBUaGUgc291cmNlIGFycmF5IG9mIHRoZSBzZWNvbmQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MSAtIEFuIG9mZnNldCBpbnRvIHRoZSBzZWNvbmQgc291cmNlIGFycmF5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSByYW5nZSBgWzAsMV1gLgoJCSAqIEBzZWUge0BsaW5rIFF1YXRlcm5pb24jc2xlcnB9CgkJICovCgkJc3RhdGljIHNsZXJwRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEsIHQgKSB7CgoJCQkvLyBmdXp6LWZyZWUsIGFycmF5LWJhc2VkIFF1YXRlcm5pb24gU0xFUlAgb3BlcmF0aW9uCgoJCQlsZXQgeDAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMCBdLAoJCQkJeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdLAoJCQkJejAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMiBdLAoJCQkJdzAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMyBdOwoKCQkJY29uc3QgeDEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMCBdLAoJCQkJeTEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMSBdLAoJCQkJejEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMiBdLAoJCQkJdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKCQkJaWYgKCB0ID09PSAwICkgewoKCQkJCWRzdFsgZHN0T2Zmc2V0ICsgMCBdID0geDA7CgkJCQlkc3RbIGRzdE9mZnNldCArIDEgXSA9IHkwOwoJCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MDsKCQkJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlpZiAoIHQgPT09IDEgKSB7CgoJCQkJZHN0WyBkc3RPZmZzZXQgKyAwIF0gPSB4MTsKCQkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTE7CgkJCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHoxOwoJCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggdzAgIT09IHcxIHx8IHgwICE9PSB4MSB8fCB5MCAhPT0geTEgfHwgejAgIT09IHoxICkgewoKCQkJCWxldCBzID0gMSAtIHQ7CgkJCQljb25zdCBjb3MgPSB4MCAqIHgxICsgeTAgKiB5MSArIHowICogejEgKyB3MCAqIHcxLAoJCQkJCWRpciA9ICggY29zID49IDAgPyAxIDogLTEgKSwKCQkJCQlzcXJTaW4gPSAxIC0gY29zICogY29zOwoKCQkJCS8vIFNraXAgdGhlIFNsZXJwIGZvciB0aW55IHN0ZXBzIHRvIGF2b2lkIG51bWVyaWMgcHJvYmxlbXM6CgkJCQlpZiAoIHNxclNpbiA+IE51bWJlci5FUFNJTE9OICkgewoKCQkJCQljb25zdCBzaW4gPSBNYXRoLnNxcnQoIHNxclNpbiApLAoJCQkJCQlsZW4gPSBNYXRoLmF0YW4yKCBzaW4sIGNvcyAqIGRpciApOwoKCQkJCQlzID0gTWF0aC5zaW4oIHMgKiBsZW4gKSAvIHNpbjsKCQkJCQl0ID0gTWF0aC5zaW4oIHQgKiBsZW4gKSAvIHNpbjsKCgkJCQl9CgoJCQkJY29uc3QgdERpciA9IHQgKiBkaXI7CgoJCQkJeDAgPSB4MCAqIHMgKyB4MSAqIHREaXI7CgkJCQl5MCA9IHkwICogcyArIHkxICogdERpcjsKCQkJCXowID0gejAgKiBzICsgejEgKiB0RGlyOwoJCQkJdzAgPSB3MCAqIHMgKyB3MSAqIHREaXI7CgoJCQkJLy8gTm9ybWFsaXplIGluIGNhc2Ugd2UganVzdCBkaWQgYSBsZXJwOgoJCQkJaWYgKCBzID09PSAxIC0gdCApIHsKCgkJCQkJY29uc3QgZiA9IDEgLyBNYXRoLnNxcnQoIHgwICogeDAgKyB5MCAqIHkwICsgejAgKiB6MCArIHcwICogdzAgKTsKCgkJCQkJeDAgKj0gZjsKCQkJCQl5MCAqPSBmOwoJCQkJCXowICo9IGY7CgkJCQkJdzAgKj0gZjsKCgkJCQl9CgoJCQl9CgoJCQlkc3RbIGRzdE9mZnNldCBdID0geDA7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTA7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejA7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0d28gcXVhdGVybmlvbnMuIFRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgcXVhdGVybmlvbiBkYXRhIGFyZSBtYW5hZ2VkCgkJICogaW4gZmxhdCBhcnJheXMuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGRzdCAtIFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZHN0T2Zmc2V0IC0gQW4gb2Zmc2V0IGludG8gdGhlIGRlc3RpbmF0aW9uIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMCAtIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIGZpcnN0IHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHNyY09mZnNldDAgLSBBbiBvZmZzZXQgaW50byB0aGUgZmlyc3Qgc291cmNlIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMSAtICBUaGUgc291cmNlIGFycmF5IG9mIHRoZSBzZWNvbmQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MSAtIEFuIG9mZnNldCBpbnRvIHRoZSBzZWNvbmQgc291cmNlIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KCQkgKiBAc2VlIHtAbGluayBRdWF0ZXJuaW9uI211bHRpcGx5UXVhdGVybmlvbnN9LgoJCSAqLwoJCXN0YXRpYyBtdWx0aXBseVF1YXRlcm5pb25zRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEgKSB7CgoJCQljb25zdCB4MCA9IHNyYzBbIHNyY09mZnNldDAgXTsKCQkJY29uc3QgeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdOwoJCQljb25zdCB6MCA9IHNyYzBbIHNyY09mZnNldDAgKyAyIF07CgkJCWNvbnN0IHcwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDMgXTsKCgkJCWNvbnN0IHgxID0gc3JjMVsgc3JjT2Zmc2V0MSBdOwoJCQljb25zdCB5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF07CgkJCWNvbnN0IHoxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDIgXTsKCQkJY29uc3QgdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKCQkJZHN0WyBkc3RPZmZzZXQgXSA9IHgwICogdzEgKyB3MCAqIHgxICsgeTAgKiB6MSAtIHowICogeTE7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTAgKiB3MSArIHcwICogeTEgKyB6MCAqIHgxIC0geDAgKiB6MTsKCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MCAqIHcxICsgdzAgKiB6MSArIHgwICogeTEgLSB5MCAqIHgxOwoJCQlkc3RbIGRzdE9mZnNldCArIDMgXSA9IHcwICogdzEgLSB4MCAqIHgxIC0geTAgKiB5MSAtIHowICogejE7CgoJCQlyZXR1cm4gZHN0OwoKCQl9CgoJCS8qKgoJCSAqIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB4KCkgewoKCQkJcmV0dXJuIHRoaXMuX3g7CgoJCX0KCgkJc2V0IHgoIHZhbHVlICkgewoKCQkJdGhpcy5feCA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgoJCSAqCgkJICogQHR5cGUge251bWJlcn0KCQkgKiBAZGVmYXVsdCAwCgkJICovCgkJZ2V0IHkoKSB7CgoJCQlyZXR1cm4gdGhpcy5feTsKCgkJfQoKCQlzZXQgeSggdmFsdWUgKSB7CgoJCQl0aGlzLl95ID0gdmFsdWU7CgkJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJfQoKCQkvKioKCQkgKiBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICoKCQkgKiBAdHlwZSB7bnVtYmVyfQoJCSAqIEBkZWZhdWx0IDAKCQkgKi8KCQlnZXQgeigpIHsKCgkJCXJldHVybiB0aGlzLl96OwoKCQl9CgoJCXNldCB6KCB2YWx1ZSApIHsKCgkJCXRoaXMuX3ogPSB2YWx1ZTsKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMQoJCSAqLwoJCWdldCB3KCkgewoKCQkJcmV0dXJuIHRoaXMuX3c7CgoJCX0KCgkJc2V0IHcoIHZhbHVlICkgewoKCQkJdGhpcy5fdyA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdyB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXNldCggeCwgeSwgeiwgdyApIHsKCgkJCXRoaXMuX3ggPSB4OwoJCQl0aGlzLl95ID0geTsKCQkJdGhpcy5feiA9IHo7CgkJCXRoaXMuX3cgPSB3OwoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBxdWF0ZXJuaW9uIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX3cgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcXVhdGVybmlvbiB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHF1YXRlcm5pb24gdG8gY29weS4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJY29weSggcXVhdGVybmlvbiApIHsKCgkJCXRoaXMuX3ggPSBxdWF0ZXJuaW9uLng7CgkJCXRoaXMuX3kgPSBxdWF0ZXJuaW9uLnk7CgkJCXRoaXMuX3ogPSBxdWF0ZXJuaW9uLno7CgkJCXRoaXMuX3cgPSBxdWF0ZXJuaW9uLnc7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSByb3RhdGlvbiBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuCgkJICogRXVsZXIgYW5nbGVzLgoJCSAqCgkJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgYW5nbGVzLgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZT10cnVlXSAtIFdoZXRoZXIgdGhlIGludGVybmFsIGBvbkNoYW5nZWAgY2FsbGJhY2sgc2hvdWxkIGJlIGV4ZWN1dGVkIG9yIG5vdC4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJc2V0RnJvbUV1bGVyKCBldWxlciwgdXBkYXRlID0gdHJ1ZSApIHsKCgkJCWNvbnN0IHggPSBldWxlci5feCwgeSA9IGV1bGVyLl95LCB6ID0gZXVsZXIuX3osIG9yZGVyID0gZXVsZXIuX29yZGVyOwoKCQkJLy8gaHR0cDovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLwoJCQkvLyAJMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMvCgkJCS8vCWNvbnRlbnQvU3BpbkNhbGMubQoKCQkJY29uc3QgY29zID0gTWF0aC5jb3M7CgkJCWNvbnN0IHNpbiA9IE1hdGguc2luOwoKCQkJY29uc3QgYzEgPSBjb3MoIHggLyAyICk7CgkJCWNvbnN0IGMyID0gY29zKCB5IC8gMiApOwoJCQljb25zdCBjMyA9IGNvcyggeiAvIDIgKTsKCgkJCWNvbnN0IHMxID0gc2luKCB4IC8gMiApOwoJCQljb25zdCBzMiA9IHNpbiggeSAvIDIgKTsKCQkJY29uc3QgczMgPSBzaW4oIHogLyAyICk7CgoJCQlzd2l0Y2ggKCBvcmRlciApIHsKCgkJCQljYXNlICdYWVonOgoJCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwoJCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnWVhaJzoKCQkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1pYWSc6CgkJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwoJCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKCQkJCQlicmVhazsKCgkJCQljYXNlICdaWVgnOgoJCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CgkJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKCQkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwoJCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnWVpYJzoKCQkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CgkJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1haWSc6CgkJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwoJCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCQkJCQlicmVhazsKCgkJCQlkZWZhdWx0OgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCgkJCX0KCgkJCWlmICggdXBkYXRlID09PSB0cnVlICkgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gZnJvbSB0aGUgZ2l2ZW4gYXhpcyBhbmQgYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgbm9ybWFsaXplZCBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlzZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9hbmdsZVRvUXVhdGVybmlvbi9pbmRleC5odG0KCgkJCWNvbnN0IGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwgcyA9IE1hdGguc2luKCBoYWxmQW5nbGUgKTsKCgkJCXRoaXMuX3ggPSBheGlzLnggKiBzOwoJCQl0aGlzLl95ID0gYXhpcy55ICogczsKCQkJdGhpcy5feiA9IGF4aXMueiAqIHM7CgkJCXRoaXMuX3cgPSBNYXRoLmNvcyggaGFsZkFuZ2xlICk7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiByb3RhdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBBIDR4NCBtYXRyaXggb2Ygd2hpY2ggdGhlIHVwcGVyIDN4MyBvZiBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLiB1bnNjYWxlZCkuCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9tYXRyaXhUb1F1YXRlcm5pb24vaW5kZXguaHRtCgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJY29uc3QgdGUgPSBtLmVsZW1lbnRzLAoKCQkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCgkJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF0sCgoJCQkJdHJhY2UgPSBtMTEgKyBtMjIgKyBtMzM7CgoJCQlpZiAoIHRyYWNlID4gMCApIHsKCgkJCQljb25zdCBzID0gMC41IC8gTWF0aC5zcXJ0KCB0cmFjZSArIDEuMCApOwoKCQkJCXRoaXMuX3cgPSAwLjI1IC8gczsKCQkJCXRoaXMuX3ggPSAoIG0zMiAtIG0yMyApICogczsKCQkJCXRoaXMuX3kgPSAoIG0xMyAtIG0zMSApICogczsKCQkJCXRoaXMuX3ogPSAoIG0yMSAtIG0xMiApICogczsKCgkJCX0gZWxzZSBpZiAoIG0xMSA+IG0yMiAmJiBtMTEgPiBtMzMgKSB7CgoJCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTExIC0gbTIyIC0gbTMzICk7CgoJCQkJdGhpcy5fdyA9ICggbTMyIC0gbTIzICkgLyBzOwoJCQkJdGhpcy5feCA9IDAuMjUgKiBzOwoJCQkJdGhpcy5feSA9ICggbTEyICsgbTIxICkgLyBzOwoJCQkJdGhpcy5feiA9ICggbTEzICsgbTMxICkgLyBzOwoKCQkJfSBlbHNlIGlmICggbTIyID4gbTMzICkgewoKCQkJCWNvbnN0IHMgPSAyLjAgKiBNYXRoLnNxcnQoIDEuMCArIG0yMiAtIG0xMSAtIG0zMyApOwoKCQkJCXRoaXMuX3cgPSAoIG0xMyAtIG0zMSApIC8gczsKCQkJCXRoaXMuX3ggPSAoIG0xMiArIG0yMSApIC8gczsKCQkJCXRoaXMuX3kgPSAwLjI1ICogczsKCQkJCXRoaXMuX3ogPSAoIG0yMyArIG0zMiApIC8gczsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTMzIC0gbTExIC0gbTIyICk7CgoJCQkJdGhpcy5fdyA9ICggbTIxIC0gbTEyICkgLyBzOwoJCQkJdGhpcy5feCA9ICggbTEzICsgbTMxICkgLyBzOwoJCQkJdGhpcy5feSA9ICggbTIzICsgbTMyICkgLyBzOwoJCQkJdGhpcy5feiA9IDAuMjUgKiBzOwoKCQkJfQoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gdG8gdGhlIHJvdGF0aW9uIHJlcXVpcmVkIHRvIHJvdGF0ZSB0aGUgZGlyZWN0aW9uIHZlY3RvcgoJCSAqIGB2RnJvbWAgdG8gdGhlIGRpcmVjdGlvbiB2ZWN0b3IgYHZUb2AuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZGcm9tIC0gVGhlIGZpcnN0IChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdlRvIC0gVGhlIHNlY29uZCAobm9ybWFsaXplZCkgZGlyZWN0aW9uIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJc2V0RnJvbVVuaXRWZWN0b3JzKCB2RnJvbSwgdlRvICkgewoKCQkJLy8gYXNzdW1lcyBkaXJlY3Rpb24gdmVjdG9ycyB2RnJvbSBhbmQgdlRvIGFyZSBub3JtYWxpemVkCgoJCQlsZXQgciA9IHZGcm9tLmRvdCggdlRvICkgKyAxOwoKCQkJaWYgKCByIDwgMWUtOCApIHsgLy8gdGhlIGVwc2lsb24gdmFsdWUgaGFzIGJlZW4gZGlzY3Vzc2VkIGluICMzMTI4NgoKCQkJCS8vIHZGcm9tIGFuZCB2VG8gcG9pbnQgaW4gb3Bwb3NpdGUgZGlyZWN0aW9ucwoKCQkJCXIgPSAwOwoKCQkJCWlmICggTWF0aC5hYnMoIHZGcm9tLnggKSA+IE1hdGguYWJzKCB2RnJvbS56ICkgKSB7CgoJCQkJCXRoaXMuX3ggPSAtIHZGcm9tLnk7CgkJCQkJdGhpcy5feSA9IHZGcm9tLng7CgkJCQkJdGhpcy5feiA9IDA7CgkJCQkJdGhpcy5fdyA9IHI7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpcy5feCA9IDA7CgkJCQkJdGhpcy5feSA9IC0gdkZyb20uejsKCQkJCQl0aGlzLl96ID0gdkZyb20ueTsKCQkJCQl0aGlzLl93ID0gcjsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIGNyb3NzVmVjdG9ycyggdkZyb20sIHZUbyApOyAvLyBpbmxpbmVkIHRvIGF2b2lkIGN5Y2xpYyBkZXBlbmRlbmN5IG9uIFZlY3RvcjMKCgkJCQl0aGlzLl94ID0gdkZyb20ueSAqIHZUby56IC0gdkZyb20ueiAqIHZUby55OwoJCQkJdGhpcy5feSA9IHZGcm9tLnogKiB2VG8ueCAtIHZGcm9tLnggKiB2VG8uejsKCQkJCXRoaXMuX3ogPSB2RnJvbS54ICogdlRvLnkgLSB2RnJvbS55ICogdlRvLng7CgkJCQl0aGlzLl93ID0gcjsKCgkJCX0KCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGFuZ2xlIGJldHdlZW4gdGhpcyBxdWF0ZXJuaW9uIGFuZCB0aGUgZ2l2ZW4gb25lIGluIHJhZGlhbnMuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgcXVhdGVybmlvbiB0byBjb21wdXRlIHRoZSBhbmdsZSB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICovCgkJYW5nbGVUbyggcSApIHsKCgkJCXJldHVybiAyICogTWF0aC5hY29zKCBNYXRoLmFicyggY2xhbXAoIHRoaXMuZG90KCBxICksIC0xLCAxICkgKSApOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhpcyBxdWF0ZXJuaW9uIGJ5IGEgZ2l2ZW4gYW5ndWxhciBzdGVwIHRvIHRoZSBnaXZlbiBxdWF0ZXJuaW9uLgoJCSAqIFRoZSBtZXRob2QgZW5zdXJlcyB0aGF0IHRoZSBmaW5hbCBxdWF0ZXJuaW9uIHdpbGwgbm90IG92ZXJzaG9vdCBgcWAuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgdGFyZ2V0IHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0ZXAgLSBUaGUgYW5ndWxhciBzdGVwIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXJvdGF0ZVRvd2FyZHMoIHEsIHN0ZXAgKSB7CgoJCQljb25zdCBhbmdsZSA9IHRoaXMuYW5nbGVUbyggcSApOwoKCQkJaWYgKCBhbmdsZSA9PT0gMCApIHJldHVybiB0aGlzOwoKCQkJY29uc3QgdCA9IE1hdGgubWluKCAxLCBzdGVwIC8gYW5nbGUgKTsKCgkJCXRoaXMuc2xlcnAoIHEsIHQgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIHRoZSBpZGVudGl0eSBxdWF0ZXJuaW9uOyB0aGF0IGlzLCB0byB0aGUKCQkgKiBxdWF0ZXJuaW9uIHRoYXQgcmVwcmVzZW50cyAibm8gcm90YXRpb24iLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWlkZW50aXR5KCkgewoKCQkJcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwLCAxICk7CgoJCX0KCgkJLyoqCgkJICogSW52ZXJ0cyB0aGlzIHF1YXRlcm5pb24gdmlhIHtAbGluayBRdWF0ZXJuaW9uI2Nvbmp1Z2F0ZX0uIFRoZQoJCSAqIHF1YXRlcm5pb24gaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWludmVydCgpIHsKCgkJCXJldHVybiB0aGlzLmNvbmp1Z2F0ZSgpOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHJvdGF0aW9uYWwgY29uanVnYXRlIG9mIHRoaXMgcXVhdGVybmlvbi4gVGhlIGNvbmp1Z2F0ZSBvZiBhCgkJICogcXVhdGVybmlvbiByZXByZXNlbnRzIHRoZSBzYW1lIHJvdGF0aW9uIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24gYWJvdXQKCQkgKiB0aGUgcm90YXRpb25hbCBheGlzLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWNvbmp1Z2F0ZSgpIHsKCgkJCXRoaXMuX3ggKj0gLTE7CgkJCXRoaXMuX3kgKj0gLTE7CgkJCXRoaXMuX3ogKj0gLTE7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGlzIHF1YXRlcm5pb24gYW5kIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHYgLSBUaGUgcXVhdGVybmlvbiB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCgkJICovCgkJZG90KCB2ICkgewoKCQkJcmV0dXJuIHRoaXMuX3ggKiB2Ll94ICsgdGhpcy5feSAqIHYuX3kgKyB0aGlzLl96ICogdi5feiArIHRoaXMuX3cgKiB2Ll93OwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBzcXVhcmVkIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBvZiB0aGlzIHF1YXRlcm5pb24sCgkJICogY29uc2lkZXJlZCBhcyBhIDQgZGltZW5zaW9uYWwgdmVjdG9yLiBUaGlzIGNhbiBiZSB1c2VmdWwgaWYgeW91IGFyZSBjb21wYXJpbmcgdGhlCgkJICogbGVuZ3RocyBvZiB0d28gcXVhdGVybmlvbnMsIGFzIHRoaXMgaXMgYSBzbGlnaHRseSBtb3JlIGVmZmljaWVudCBjYWxjdWxhdGlvbiB0aGFuCgkJICoge0BsaW5rIFF1YXRlcm5pb24jbGVuZ3RofS4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgRXVjbGlkZWFuIGxlbmd0aC4KCQkgKi8KCQlsZW5ndGhTcSgpIHsKCgkJCXJldHVybiB0aGlzLl94ICogdGhpcy5feCArIHRoaXMuX3kgKiB0aGlzLl95ICsgdGhpcy5feiAqIHRoaXMuX3ogKyB0aGlzLl93ICogdGhpcy5fdzsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIG9mIHRoaXMgcXVhdGVybmlvbiwKCQkgKiBjb25zaWRlcmVkIGFzIGEgNCBkaW1lbnNpb25hbCB2ZWN0b3IuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBFdWNsaWRlYW4gbGVuZ3RoLgoJCSAqLwoJCWxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93ICk7CgoJCX0KCgkJLyoqCgkJICogTm9ybWFsaXplcyB0aGlzIHF1YXRlcm5pb24gLSB0aGF0IGlzLCBjYWxjdWxhdGVkIHRoZSBxdWF0ZXJuaW9uIHRoYXQgcGVyZm9ybXMKCQkgKiB0aGUgc2FtZSByb3RhdGlvbiBhcyB0aGlzIG9uZSwgYnV0IGhhcyBhIGxlbmd0aCBlcXVhbCB0byBgMWAuCgkJICoKCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJbm9ybWFsaXplKCkgewoKCQkJbGV0IGwgPSB0aGlzLmxlbmd0aCgpOwoKCQkJaWYgKCBsID09PSAwICkgewoKCQkJCXRoaXMuX3ggPSAwOwoJCQkJdGhpcy5feSA9IDA7CgkJCQl0aGlzLl96ID0gMDsKCQkJCXRoaXMuX3cgPSAxOwoKCQkJfSBlbHNlIHsKCgkJCQlsID0gMSAvIGw7CgoJCQkJdGhpcy5feCA9IHRoaXMuX3ggKiBsOwoJCQkJdGhpcy5feSA9IHRoaXMuX3kgKiBsOwoJCQkJdGhpcy5feiA9IHRoaXMuX3ogKiBsOwoJCQkJdGhpcy5fdyA9IHRoaXMuX3cgKiBsOwoKCQkJfQoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGlzIHF1YXRlcm5pb24gYnkgdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQltdWx0aXBseSggcSApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHRoaXMsIHEgKTsKCgkJfQoKCQkvKioKCQkgKiBQcmUtbXVsdGlwbGllcyB0aGlzIHF1YXRlcm5pb24gYnkgdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlwcmVtdWx0aXBseSggcSApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHEsIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBNdWx0aXBsaWVzIHRoZSBnaXZlbiBxdWF0ZXJuaW9ucyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gYSAtIFRoZSBmaXJzdCBxdWF0ZXJuaW9uLgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gYiAtIFRoZSBzZWNvbmQgcXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJbXVsdGlwbHlRdWF0ZXJuaW9ucyggYSwgYiApIHsKCgkJCS8vIGZyb20gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9jb2RlL2luZGV4Lmh0bQoKCQkJY29uc3QgcWF4ID0gYS5feCwgcWF5ID0gYS5feSwgcWF6ID0gYS5feiwgcWF3ID0gYS5fdzsKCQkJY29uc3QgcWJ4ID0gYi5feCwgcWJ5ID0gYi5feSwgcWJ6ID0gYi5feiwgcWJ3ID0gYi5fdzsKCgkJCXRoaXMuX3ggPSBxYXggKiBxYncgKyBxYXcgKiBxYnggKyBxYXkgKiBxYnogLSBxYXogKiBxYnk7CgkJCXRoaXMuX3kgPSBxYXkgKiBxYncgKyBxYXcgKiBxYnkgKyBxYXogKiBxYnggLSBxYXggKiBxYno7CgkJCXRoaXMuX3ogPSBxYXogKiBxYncgKyBxYXcgKiBxYnogKyBxYXggKiBxYnkgLSBxYXkgKiBxYng7CgkJCXRoaXMuX3cgPSBxYXcgKiBxYncgLSBxYXggKiBxYnggLSBxYXkgKiBxYnkgLSBxYXogKiBxYno7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHF1YXRlcm5pb25zLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYiAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlzbGVycCggcWIsIHQgKSB7CgoJCQlpZiAoIHQgPT09IDAgKSByZXR1cm4gdGhpczsKCQkJaWYgKCB0ID09PSAxICkgcmV0dXJuIHRoaXMuY29weSggcWIgKTsKCgkJCWNvbnN0IHggPSB0aGlzLl94LCB5ID0gdGhpcy5feSwgeiA9IHRoaXMuX3osIHcgPSB0aGlzLl93OwoKCQkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9zbGVycC8KCgkJCWxldCBjb3NIYWxmVGhldGEgPSB3ICogcWIuX3cgKyB4ICogcWIuX3ggKyB5ICogcWIuX3kgKyB6ICogcWIuX3o7CgoJCQlpZiAoIGNvc0hhbGZUaGV0YSA8IDAgKSB7CgoJCQkJdGhpcy5fdyA9IC0gcWIuX3c7CgkJCQl0aGlzLl94ID0gLSBxYi5feDsKCQkJCXRoaXMuX3kgPSAtIHFiLl95OwoJCQkJdGhpcy5feiA9IC0gcWIuX3o7CgoJCQkJY29zSGFsZlRoZXRhID0gLSBjb3NIYWxmVGhldGE7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuY29weSggcWIgKTsKCgkJCX0KCgkJCWlmICggY29zSGFsZlRoZXRhID49IDEuMCApIHsKCgkJCQl0aGlzLl93ID0gdzsKCQkJCXRoaXMuX3ggPSB4OwoJCQkJdGhpcy5feSA9IHk7CgkJCQl0aGlzLl96ID0gejsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWNvbnN0IHNxclNpbkhhbGZUaGV0YSA9IDEuMCAtIGNvc0hhbGZUaGV0YSAqIGNvc0hhbGZUaGV0YTsKCgkJCWlmICggc3FyU2luSGFsZlRoZXRhIDw9IE51bWJlci5FUFNJTE9OICkgewoKCQkJCWNvbnN0IHMgPSAxIC0gdDsKCQkJCXRoaXMuX3cgPSBzICogdyArIHQgKiB0aGlzLl93OwoJCQkJdGhpcy5feCA9IHMgKiB4ICsgdCAqIHRoaXMuX3g7CgkJCQl0aGlzLl95ID0gcyAqIHkgKyB0ICogdGhpcy5feTsKCQkJCXRoaXMuX3ogPSBzICogeiArIHQgKiB0aGlzLl96OwoKCQkJCXRoaXMubm9ybWFsaXplKCk7IC8vIG5vcm1hbGl6ZSBjYWxscyBfb25DaGFuZ2VDYWxsYmFjaygpCgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQljb25zdCBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoIHNxclNpbkhhbGZUaGV0YSApOwoJCQljb25zdCBoYWxmVGhldGEgPSBNYXRoLmF0YW4yKCBzaW5IYWxmVGhldGEsIGNvc0hhbGZUaGV0YSApOwoJCQljb25zdCByYXRpb0EgPSBNYXRoLnNpbiggKCAxIC0gdCApICogaGFsZlRoZXRhICkgLyBzaW5IYWxmVGhldGEsCgkJCQlyYXRpb0IgPSBNYXRoLnNpbiggdCAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhOwoKCQkJdGhpcy5fdyA9ICggdyAqIHJhdGlvQSArIHRoaXMuX3cgKiByYXRpb0IgKTsKCQkJdGhpcy5feCA9ICggeCAqIHJhdGlvQSArIHRoaXMuX3ggKiByYXRpb0IgKTsKCQkJdGhpcy5feSA9ICggeSAqIHJhdGlvQSArIHRoaXMuX3kgKiByYXRpb0IgKTsKCQkJdGhpcy5feiA9ICggeiAqIHJhdGlvQSArIHRoaXMuX3ogKiByYXRpb0IgKTsKCgkJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFBlcmZvcm1zIGEgc3BoZXJpY2FsIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdGhlIGdpdmVuIHF1YXRlcm5pb25zCgkJICogYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcWEgLSBUaGUgc291cmNlIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYiAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlzbGVycFF1YXRlcm5pb25zKCBxYSwgcWIsIHQgKSB7CgoJCQlyZXR1cm4gdGhpcy5jb3B5KCBxYSApLnNsZXJwKCBxYiwgdCApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIGEgdW5pZm9ybWx5IHJhbmRvbSwgbm9ybWFsaXplZCBxdWF0ZXJuaW9uLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXJhbmRvbSgpIHsKCgkJCS8vIEtlbiBTaG9lbWFrZQoJCQkvLyBVbmlmb3JtIHJhbmRvbSByb3RhdGlvbnMKCQkJLy8gRC4gS2lyaywgZWRpdG9yLCBHcmFwaGljcyBHZW1zIElJSSwgcGFnZXMgMTI0LTEzMi4gQWNhZGVtaWMgUHJlc3MsIE5ldyBZb3JrLCAxOTkyLgoKCQkJY29uc3QgdGhldGExID0gMiAqIE1hdGguUEkgKiBNYXRoLnJhbmRvbSgpOwoJCQljb25zdCB0aGV0YTIgPSAyICogTWF0aC5QSSAqIE1hdGgucmFuZG9tKCk7CgoJCQljb25zdCB4MCA9IE1hdGgucmFuZG9tKCk7CgkJCWNvbnN0IHIxID0gTWF0aC5zcXJ0KCAxIC0geDAgKTsKCQkJY29uc3QgcjIgPSBNYXRoLnNxcnQoIHgwICk7CgoJCQlyZXR1cm4gdGhpcy5zZXQoCgkJCQlyMSAqIE1hdGguc2luKCB0aGV0YTEgKSwKCQkJCXIxICogTWF0aC5jb3MoIHRoZXRhMSApLAoJCQkJcjIgKiBNYXRoLnNpbiggdGhldGEyICksCgkJCQlyMiAqIE1hdGguY29zKCB0aGV0YTIgKSwKCQkJKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHF1YXRlcm5pb24gaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHF1YXRlcm5pb24gdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHF1YXRlcm5pb24gaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggcXVhdGVybmlvbiApIHsKCgkJCXJldHVybiAoIHF1YXRlcm5pb24uX3ggPT09IHRoaXMuX3ggKSAmJiAoIHF1YXRlcm5pb24uX3kgPT09IHRoaXMuX3kgKSAmJiAoIHF1YXRlcm5pb24uX3ogPT09IHRoaXMuX3ogKSAmJiAoIHF1YXRlcm5pb24uX3cgPT09IHRoaXMuX3cgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbidzIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gYXJyYXkuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGFycmF5IC0gQW4gYXJyYXkgaG9sZGluZyB0aGUgcXVhdGVybmlvbiBjb21wb25lbnQgdmFsdWVzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMuX3ggPSBhcnJheVsgb2Zmc2V0IF07CgkJCXRoaXMuX3kgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCQl0aGlzLl96ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQkJdGhpcy5fdyA9IGFycmF5WyBvZmZzZXQgKyAzIF07CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBXcml0ZXMgdGhlIGNvbXBvbmVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCgkJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHF1YXRlcm5pb24gY29tcG9uZW50cy4KCQkgKi8KCQl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuX3k7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fdzsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgcXVhdGVybmlvbiBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgoJCQl0aGlzLl94ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMuX3kgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCQkJdGhpcy5feiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoJCQl0aGlzLl93ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUaGlzIG1ldGhvZHMgZGVmaW5lcyB0aGUgc2VyaWFsaXphdGlvbiByZXN1bHQgb2YgdGhpcyBjbGFzcy4gUmV0dXJucyB0aGUKCQkgKiBudW1lcmljYWwgZWxlbWVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIGluIGFuIGFycmF5IG9mIGZvcm1hdCBgW3gsIHksIHosIHddYC4KCQkgKgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBzZXJpYWxpemVkIHF1YXRlcm5pb24uCgkJICovCgkJdG9KU09OKCkgewoKCQkJcmV0dXJuIHRoaXMudG9BcnJheSgpOwoKCQl9CgoJCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgoJCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQkJeWllbGQgdGhpcy5feDsKCQkJeWllbGQgdGhpcy5feTsKCQkJeWllbGQgdGhpcy5fejsKCQkJeWllbGQgdGhpcy5fdzsKCgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIDNEIHZlY3Rvci4gQSAzRCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCB0cmlwbGV0IG9mIG51bWJlcnMKCSAqIChsYWJlbGVkIHgsIHkgYW5kIHopLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgoJICoKCSAqIC0gQSBwb2ludCBpbiAzRCBzcGFjZS4KCSAqIC0gQSBkaXJlY3Rpb24gYW5kIGxlbmd0aCBpbiAzRCBzcGFjZS4gSW4gdGhyZWUuanMgdGhlIGxlbmd0aCB3aWxsCgkgKiBhbHdheXMgYmUgdGhlIEV1Y2xpZGVhbiBkaXN0YW5jZShzdHJhaWdodC1saW5lIGRpc3RhbmNlKSBmcm9tIGAoMCwgMCwgMClgIHRvIGAoeCwgeSwgeilgCgkgKiBhbmQgdGhlIGRpcmVjdGlvbiBpcyBhbHNvIG1lYXN1cmVkIGZyb20gYCgwLCAwLCAwKWAgdG93YXJkcyBgKHgsIHksIHopYC4KCSAqIC0gQW55IGFyYml0cmFyeSBvcmRlcmVkIHRyaXBsZXQgb2YgbnVtYmVycy4KCSAqCgkgKiBUaGVyZSBhcmUgb3RoZXIgdGhpbmdzIGEgM0QgdmVjdG9yIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCwgc3VjaCBhcwoJICogbW9tZW50dW0gdmVjdG9ycyBhbmQgc28gb24sIGhvd2V2ZXIgdGhlc2UgYXJlIHRoZSBtb3N0CgkgKiBjb21tb24gdXNlcyBpbiB0aHJlZS5qcy4KCSAqCgkgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeilgIGluCgkgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KCSAqIGBgYGpzCgkgKiBjb25zdCBhID0gbmV3IFRIUkVFLlZlY3RvcjMoIDAsIDEsIDAgKTsKCSAqCgkgKiAvL25vIGFyZ3VtZW50czsgd2lsbCBiZSBpbml0aWFsaXNlZCB0byAoMCwgMCwgMCkKCSAqIGNvbnN0IGIgPSBuZXcgVEhSRUUuVmVjdG9yMyggKTsKCSAqCgkgKiBjb25zdCBkID0gYS5kaXN0YW5jZVRvKCBiICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgVmVjdG9yMyB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgM0QgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJVmVjdG9yMy5wcm90b3R5cGUuaXNWZWN0b3IzID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMueCA9IHg7CgoJCQkvKioKCQkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnkgPSB5OwoKCQkJLyoqCgkJCSAqIFRoZSB6IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy56ID0gejsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIG9mIHRoZSB4IGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSBvZiB0aGUgeSBjb21wb25lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgb2YgdGhlIHogY29tcG9uZW50LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldCggeCwgeSwgeiApIHsKCgkJCWlmICggeiA9PT0gdW5kZWZpbmVkICkgeiA9IHRoaXMuejsgLy8gc3ByaXRlLnNjYWxlLnNldCh4LHkpCgoJCQl0aGlzLnggPSB4OwoJCQl0aGlzLnkgPSB5OwoJCQl0aGlzLnogPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHNhbWUgdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHZhbHVlIHRvIHNldCBmb3IgYWxsIHZlY3RvciBjb21wb25lbnRzLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ID0gc2NhbGFyOwoJCQl0aGlzLnkgPSBzY2FsYXI7CgkJCXRoaXMueiA9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvcidzIHggY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFgoIHggKSB7CgoJCQl0aGlzLnggPSB4OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yJ3MgeSBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0WSggeSApIHsKCgkJCXRoaXMueSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB6IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRaKCB6ICkgewoKCQkJdGhpcy56ID0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFsbG93cyB0byBzZXQgYSB2ZWN0b3IgY29tcG9uZW50IHdpdGggYW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwgYDJgIGVxdWFscyB0byB6LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAyOiB0aGlzLnogPSB2YWx1ZTsgYnJlYWs7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwgYDJgIGVxdWFscyB0byB6LgoJCSAqIEByZXR1cm4ge251bWJlcn0gQSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlLgoJCSAqLwoJCWdldENvbXBvbmVudCggaW5kZXggKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHJldHVybiB0aGlzLng7CgkJCQljYXNlIDE6IHJldHVybiB0aGlzLnk7CgkJCQljYXNlIDI6IHJldHVybiB0aGlzLno7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgdmVjdG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55LCB0aGlzLnogKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGNvcHkuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY29weSggdiApIHsKCgkJCXRoaXMueCA9IHYueDsKCQkJdGhpcy55ID0gdi55OwoJCQl0aGlzLnogPSB2Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gYWRkLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZCggdiApIHsKCgkJCXRoaXMueCArPSB2Lng7CgkJCXRoaXMueSArPSB2Lnk7CgkJCXRoaXMueiArPSB2Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgdG8gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBhZGQuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJYWRkU2NhbGFyKCBzICkgewoKCQkJdGhpcy54ICs9IHM7CgkJCXRoaXMueSArPSBzOwoJCQl0aGlzLnogKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKyBiLng7CgkJCXRoaXMueSA9IGEueSArIGIueTsKCQkJdGhpcy56ID0gYS56ICsgYi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHNjYWxlZCBieSB0aGUgZ2l2ZW4gZmFjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN8VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgZmFjdG9yIHRoYXQgc2NhbGVzIGB2YC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgoJCQl0aGlzLnggKz0gdi54ICogczsKCQkJdGhpcy55ICs9IHYueSAqIHM7CgkJCXRoaXMueiArPSB2LnogKiBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU3VidHJhY3RzIHRoZSBnaXZlbiB2ZWN0b3IgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBzdWJ0cmFjdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzdWIoIHYgKSB7CgoJCQl0aGlzLnggLT0gdi54OwoJCQl0aGlzLnkgLT0gdi55OwoJCQl0aGlzLnogLT0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU3VidHJhY3RzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgZnJvbSBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIHN1YnRyYWN0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXN1YlNjYWxhciggcyApIHsKCgkJCXRoaXMueCAtPSBzOwoJCQl0aGlzLnkgLT0gczsKCQkJdGhpcy56IC09IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggLSBiLng7CgkJCXRoaXMueSA9IGEueSAtIGIueTsKCQkJdGhpcy56ID0gYS56IC0gYi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbXVsdGlwbHkoIHYgKSB7CgoJCQl0aGlzLnggKj0gdi54OwoJCQl0aGlzLnkgKj0gdi55OwoJCQl0aGlzLnogKj0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHdpdGggYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIG11bHRpcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnggKj0gc2NhbGFyOwoJCQl0aGlzLnkgKj0gc2NhbGFyOwoJCQl0aGlzLnogKj0gc2NhbGFyOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbXVsdGlwbHlWZWN0b3JzKCBhLCBiICkgewoKCQkJdGhpcy54ID0gYS54ICogYi54OwoJCQl0aGlzLnkgPSBhLnkgKiBiLnk7CgkJCXRoaXMueiA9IGEueiAqIGIuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgdGhlIGdpdmVuIEV1bGVyIHJvdGF0aW9uIHRvIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgYW5nbGVzLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5RXVsZXIoIGV1bGVyICkgewoKCQkJcmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQ0LnNldEZyb21FdWxlciggZXVsZXIgKSApOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgYSByb3RhdGlvbiBzcGVjaWZpZWQgYnkgYW4gYXhpcyBhbmQgYW4gYW5nbGUgdG8gdGhpcyB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBBIG5vcm1hbGl6ZWQgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgcm90YXRpb24gYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhcHBseUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgoJCQlyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uJDQuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSApOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gM3gzIG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSAzeDMgbWF0cml4LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4MyggbSApIHsKCgkJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF0gKiB6OwoJCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXSAqIHo7CgkJCXRoaXMueiA9IGVbIDIgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOCBdICogejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIG5vcm1hbCBtYXRyaXggYW5kIG5vcm1hbGl6ZXMKCQkgKiB0aGUgcmVzdWx0LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG5vcm1hbCBtYXRyaXguCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJYXBwbHlOb3JtYWxNYXRyaXgoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDMoIG0gKS5ub3JtYWxpemUoKTsKCgkJfQoKCQkvKioKCQkgKiBNdWx0aXBsaWVzIHRoaXMgdmVjdG9yICh3aXRoIGFuIGltcGxpY2l0IDEgaW4gdGhlIDR0aCBkaW1lbnNpb24pIGJ5IG0sIGFuZAoJCSAqIGRpdmlkZXMgYnkgcGVyc3BlY3RpdmUuCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIGFwcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbSApIHsKCgkJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJY29uc3QgdyA9IDEgLyAoIGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICk7CgoJCQl0aGlzLnggPSAoIGVbIDAgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgOCBdICogeiArIGVbIDEyIF0gKSAqIHc7CgkJCXRoaXMueSA9ICggZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSApICogdzsKCQkJdGhpcy56ID0gKCBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSApICogdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgdGhlIGdpdmVuIFF1YXRlcm5pb24gdG8gdGhpcyB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhcHBseVF1YXRlcm5pb24oIHEgKSB7CgoJCQkvLyBxdWF0ZXJuaW9uIHEgaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoCgoJCQljb25zdCB2eCA9IHRoaXMueCwgdnkgPSB0aGlzLnksIHZ6ID0gdGhpcy56OwoJCQljb25zdCBxeCA9IHEueCwgcXkgPSBxLnksIHF6ID0gcS56LCBxdyA9IHEudzsKCgkJCS8vIHQgPSAyICogY3Jvc3MoIHEueHl6LCB2ICk7CgkJCWNvbnN0IHR4ID0gMiAqICggcXkgKiB2eiAtIHF6ICogdnkgKTsKCQkJY29uc3QgdHkgPSAyICogKCBxeiAqIHZ4IC0gcXggKiB2eiApOwoJCQljb25zdCB0eiA9IDIgKiAoIHF4ICogdnkgLSBxeSAqIHZ4ICk7CgoJCQkvLyB2ICsgcS53ICogdCArIGNyb3NzKCBxLnh5eiwgdCApOwoJCQl0aGlzLnggPSB2eCArIHF3ICogdHggKyBxeSAqIHR6IC0gcXogKiB0eTsKCQkJdGhpcy55ID0gdnkgKyBxdyAqIHR5ICsgcXogKiB0eCAtIHF4ICogdHo7CgkJCXRoaXMueiA9IHZ6ICsgcXcgKiB0eiArIHF4ICogdHkgLSBxeSAqIHR4OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUHJvamVjdHMgdGhpcyB2ZWN0b3IgZnJvbSB3b3JsZCBzcGFjZSBpbnRvIHRoZSBjYW1lcmEncyBub3JtYWxpemVkCgkJICogZGV2aWNlIGNvb3JkaW5hdGUgKE5EQykgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlwcm9qZWN0KCBjYW1lcmEgKSB7CgoJCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCX0KCgkJLyoqCgkJICogVW5wcm9qZWN0cyB0aGlzIHZlY3RvciBmcm9tIHRoZSBjYW1lcmEncyBub3JtYWxpemVkIGRldmljZSBjb29yZGluYXRlIChOREMpCgkJICogc3BhY2UgaW50byB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXVucHJvamVjdCggY2FtZXJhICkgewoKCQkJcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKCQl9CgoJCS8qKgoJCSAqIFRyYW5zZm9ybXMgdGhlIGRpcmVjdGlvbiBvZiB0aGlzIHZlY3RvciBieSBhIG1hdHJpeCAodGhlIHVwcGVyIGxlZnQgMyB4IDMKCQkgKiBzdWJzZXQgb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXggYW5kIHRoZW4gbm9ybWFsaXplcyB0aGUgcmVzdWx0LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQl0cmFuc2Zvcm1EaXJlY3Rpb24oIG0gKSB7CgoJCQkvLyBpbnB1dDogVEhSRUUuTWF0cml4NCBhZmZpbmUgbWF0cml4CgkJCS8vIHZlY3RvciBpbnRlcnByZXRlZCBhcyBhIGRpcmVjdGlvbgoKCQkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHo7CgkJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogejsKCQkJdGhpcy56ID0gZVsgMiBdICogeCArIGVbIDYgXSAqIHkgKyBlWyAxMCBdICogejsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZGl2aWRlKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCQkJdGhpcy56IC89IHYuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5IG9yIHoKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWluIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltaW4oIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5taW4oIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWluKCB0aGlzLnosIHYueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5IG9yIHoKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltYXgoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWF4KCB0aGlzLnosIHYueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmVjdG9yJ3MgeCwgeSBvciB6CgkJICogdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZSwKCQkgKiBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gbWluIC0gVGhlIG1pbmltdW0geCwgeSBhbmQgeiB2YWx1ZXMuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBtYXggLSBUaGUgbWF4aW11bSB4LCB5IGFuZCB6IHZhbHVlcyBpbiB0aGUgZGVzaXJlZCByYW5nZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljbGFtcCggbWluLCBtYXggKSB7CgoJCQkvLyBhc3N1bWVzIG1pbiA8IG1heCwgY29tcG9uZW50d2lzZQoKCQkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluLngsIG1heC54ICk7CgkJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pbi55LCBtYXgueSApOwoJCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW4ueiwgbWF4LnogKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlcyBhcmUgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIHRoZXkgYXJlCgkJICogcmVwbGFjZWQgYnkgdGhlIG1heCB2YWx1ZS4KCQkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZXMgYXJlIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCB0aGV5IGFyZQoJCSAqIHJlcGxhY2VkIGJ5IHRoZSBtaW4gdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gbWluVmFsIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXhWYWwgLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKCQkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluVmFsLCBtYXhWYWwgKTsKCQkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluVmFsLCBtYXhWYWwgKTsKCQkJdGhpcy56ID0gY2xhbXAoIHRoaXMueiwgbWluVmFsLCBtYXhWYWwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieQoJCSAqIHRoZSBtYXggdmFsdWUuCgkJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZQoJCSAqIG1pbiB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW4gLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHBhcmFtIHtudW1iZXJ9IG1heCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljbGFtcExlbmd0aCggbWluLCBtYXggKSB7CgoJCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBjbGFtcCggbGVuZ3RoLCBtaW4sIG1heCApICk7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZmxvb3IoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5mbG9vciggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGguZmxvb3IoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNlaWwoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmQoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG93YXJkcyB6ZXJvICh1cCBpZiBuZWdhdGl2ZSwKCQkgKiBkb3duIGlmIHBvc2l0aXZlKSB0byBhbiBpbnRlZ2VyIHZhbHVlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmRUb1plcm8oKSB7CgoJCQl0aGlzLnggPSBNYXRoLnRydW5jKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC50cnVuYyggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgudHJ1bmMoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSW52ZXJ0cyB0aGlzIHZlY3RvciAtIGkuZS4gc2V0cyB4ID0gLXgsIHkgPSAteSBhbmQgeiA9IC16LgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbmVnYXRlKCkgewoKCQkJdGhpcy54ID0gLSB0aGlzLng7CgkJCXRoaXMueSA9IC0gdGhpcy55OwoJCQl0aGlzLnogPSAtIHRoaXMuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCgkJICovCgkJZG90KCB2ICkgewoKCQkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKCgkJfQoKCQkvLyBUT0RPIGxlbmd0aFNxdWFyZWQ/CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBzcXVhcmUgb2YgdGhlIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tCgkJICogKDAsIDAsIDApIHRvICh4LCB5LCB6KS4gSWYgeW91IGFyZSBjb21wYXJpbmcgdGhlIGxlbmd0aHMgb2YgdmVjdG9ycywgeW91IHNob3VsZAoJCSAqIGNvbXBhcmUgdGhlIGxlbmd0aCBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZW5ndGhTcSgpIHsKCgkJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLno7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlICBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbSAoMCwgMCwgMCkgdG8gKHgsIHksIHopLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBNYW5oYXR0YW4gbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW1hbmhhdHRhbkxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICk7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhpcyB2ZWN0b3IgdG8gYSB1bml0IHZlY3RvciAtIHRoYXQgaXMsIHNldHMgaXQgZXF1YWwgdG8gYSB2ZWN0b3IKCQkgKiB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0IHdpdGggYSB2ZWN0b3IgbGVuZ3RoIG9mIGAxYC4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW5vcm1hbGl6ZSgpIHsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHZlY3RvciB0byBhIHZlY3RvciB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0CgkJICogd2l0aCB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggLSBUaGUgbmV3IGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9yIGFuZCB0aGlzIGluc3RhbmNlLCB3aGVyZQoJCSAqIGFscGhhIGlzIHRoZSBwZXJjZW50IGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgdGhpcwoJCSAqIHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsIGJlIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGludGVycG9sYXRlIHRvd2FyZHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwKCB2LCBhbHBoYSApIHsKCgkJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CgkJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9ycywgd2hlcmUgYWxwaGEgaXMgdGhlIHBlcmNlbnQKCQkgKiBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIGZpcnN0IHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsCgkJICogYmUgdGhlIHNlY29uZCBvbmUuIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVGhlIGZpcnN0IHZlY3Rvci4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYyIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCgkJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKCQkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwoJCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDYWxjdWxhdGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBjcm9zcyBwcm9kdWN0IHdpdGguCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHJlc3VsdCBvZiB0aGUgY3Jvc3MgcHJvZHVjdC4KCQkgKi8KCQljcm9zcyggdiApIHsKCgkJCXJldHVybiB0aGlzLmNyb3NzVmVjdG9ycyggdGhpcywgdiApOwoKCQl9CgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CgkJICogaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY3Jvc3NWZWN0b3JzKCBhLCBiICkgewoKCQkJY29uc3QgYXggPSBhLngsIGF5ID0gYS55LCBheiA9IGEuejsKCQkJY29uc3QgYnggPSBiLngsIGJ5ID0gYi55LCBieiA9IGIuejsKCgkJCXRoaXMueCA9IGF5ICogYnogLSBheiAqIGJ5OwoJCQl0aGlzLnkgPSBheiAqIGJ4IC0gYXggKiBiejsKCQkJdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQcm9qZWN0cyB0aGlzIHZlY3RvciBvbnRvIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIHByb2plY3QgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcHJvamVjdE9uVmVjdG9yKCB2ICkgewoKCQkJY29uc3QgZGVub21pbmF0b3IgPSB2Lmxlbmd0aFNxKCk7CgoJCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwICk7CgoJCQljb25zdCBzY2FsYXIgPSB2LmRvdCggdGhpcyApIC8gZGVub21pbmF0b3I7CgoJCQlyZXR1cm4gdGhpcy5jb3B5KCB2ICkubXVsdGlwbHlTY2FsYXIoIHNjYWxhciApOwoKCQl9CgoJCS8qKgoJCSAqIFByb2plY3RzIHRoaXMgdmVjdG9yIG9udG8gYSBwbGFuZSBieSBzdWJ0cmFjdGluZyB0aGlzCgkJICogdmVjdG9yIHByb2plY3RlZCBvbnRvIHRoZSBwbGFuZSdzIG5vcm1hbCBmcm9tIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwbGFuZU5vcm1hbCAtIFRoZSBwbGFuZSBub3JtYWwuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcHJvamVjdE9uUGxhbmUoIHBsYW5lTm9ybWFsICkgewoKCQkJX3ZlY3RvciRjLmNvcHkoIHRoaXMgKS5wcm9qZWN0T25WZWN0b3IoIHBsYW5lTm9ybWFsICk7CgoJCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYyApOwoKCQl9CgoJCS8qKgoJCSAqIFJlZmxlY3RzIHRoaXMgdmVjdG9yIG9mZiBhIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGdpdmVuIG5vcm1hbCB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IG5vcm1hbCAtIFRoZSAobm9ybWFsaXplZCkgbm9ybWFsIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlyZWZsZWN0KCBub3JtYWwgKSB7CgoJCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYy5jb3B5KCBub3JtYWwgKS5tdWx0aXBseVNjYWxhciggMiAqIHRoaXMuZG90KCBub3JtYWwgKSApICk7CgoJCX0KCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgYW5nbGUgd2l0aC4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqLwoJCWFuZ2xlVG8oIHYgKSB7CgoJCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgoJCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKCQkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgoJCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKCQkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtMSwgMSApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICogSWYgeW91IGFyZSBqdXN0IGNvbXBhcmluZyB0aGUgZGlzdGFuY2Ugd2l0aCBhbm90aGVyIGRpc3RhbmNlLCB5b3Ugc2hvdWxkIGNvbXBhcmUKCQkgKiB0aGUgZGlzdGFuY2Ugc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgc3F1YXJlZCBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKCQkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55LCBkeiA9IHRoaXMueiAtIHYuejsKCgkJCXJldHVybiBkeCAqIGR4ICsgZHkgKiBkeSArIGR6ICogZHo7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIE1hbmhhdHRhbiBkaXN0YW5jZS4KCQkgKi8KCQltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKSArIE1hdGguYWJzKCB0aGlzLnogLSB2LnogKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBzcGhlcmljYWwgY29vcmRpbmF0ZXMuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyaWNhbH0gcyAtIFRoZSBzcGhlcmljYWwgY29vcmRpbmF0ZXMuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbVNwaGVyaWNhbCggcyApIHsKCgkJCXJldHVybiB0aGlzLnNldEZyb21TcGhlcmljYWxDb29yZHMoIHMucmFkaXVzLCBzLnBoaSwgcy50aGV0YSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIHNwaGVyaWNhbCBjb29yZGluYXRlcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgLSBUaGUgcmFkaXVzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBwaGkgLSBUaGUgcGhpIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHRoZXRhIC0gVGhlIHRoZXRhIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbVNwaGVyaWNhbENvb3JkcyggcmFkaXVzLCBwaGksIHRoZXRhICkgewoKCQkJY29uc3Qgc2luUGhpUmFkaXVzID0gTWF0aC5zaW4oIHBoaSApICogcmFkaXVzOwoKCQkJdGhpcy54ID0gc2luUGhpUmFkaXVzICogTWF0aC5zaW4oIHRoZXRhICk7CgkJCXRoaXMueSA9IE1hdGguY29zKCBwaGkgKSAqIHJhZGl1czsKCQkJdGhpcy56ID0gc2luUGhpUmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBjeWxpbmRyaWNhbCBjb29yZGluYXRlcy4KCQkgKgoJCSAqIEBwYXJhbSB7Q3lsaW5kcmljYWx9IGMgLSBUaGUgY3lsaW5kcmljYWwgY29vcmRpbmF0ZXMuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbUN5bGluZHJpY2FsKCBjICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKCBjLnJhZGl1cywgYy50aGV0YSwgYy55ICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gY3lsaW5kcmljYWwgY29vcmRpbmF0ZXMuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIC0gVGhlIHJhZGl1cy4KCQkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgdGhldGEgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IHZhbHVlLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldEZyb21DeWxpbmRyaWNhbENvb3JkcyggcmFkaXVzLCB0aGV0YSwgeSApIHsKCgkJCXRoaXMueCA9IHJhZGl1cyAqIE1hdGguc2luKCB0aGV0YSApOwoJCQl0aGlzLnkgPSB5OwoJCQl0aGlzLnogPSByYWRpdXMgKiBNYXRoLmNvcyggdGhldGEgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBwb3NpdGlvbiBlbGVtZW50cyBvZiB0aGUKCQkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgoJCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDEyIF07CgkJCXRoaXMueSA9IGVbIDEzIF07CgkJCXRoaXMueiA9IGVbIDE0IF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2NhbGUgZWxlbWVudHMgb2YgdGhlCgkJICogZ2l2ZW4gdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIDR4NCBtYXRyaXguCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbU1hdHJpeFNjYWxlKCBtICkgewoKCQkJY29uc3Qgc3ggPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDAgKS5sZW5ndGgoKTsKCQkJY29uc3Qgc3kgPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKCQkJY29uc3Qgc3ogPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDIgKS5sZW5ndGgoKTsKCgkJCXRoaXMueCA9IHN4OwoJCQl0aGlzLnkgPSBzeTsKCQkJdGhpcy56ID0gc3o7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBzcGVjaWZpZWQgbWF0cml4IGNvbHVtbi4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb2x1bW4gaW5kZXguCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogNCApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIHNwZWNpZmllZCBtYXRyaXggY29sdW1uLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbHVtbiBpbmRleC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tTWF0cml4M0NvbHVtbiggbSwgaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogMyApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIEV1bGVyIGFuZ2xlcy4KCQkgKgoJCSAqIEBwYXJhbSB7RXVsZXJ9IGUgLSBUaGUgRXVsZXIgYW5nbGVzIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tRXVsZXIoIGUgKSB7CgoJCQl0aGlzLnggPSBlLl94OwoJCQl0aGlzLnkgPSBlLl95OwoJCQl0aGlzLnogPSBlLl96OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgUkdCIGNvbXBvbmVudHMgb2YgdGhlCgkJICogZ2l2ZW4gY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjIC0gVGhlIGNvbG9yIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tQ29sb3IoIGMgKSB7CgoJCQl0aGlzLnggPSBjLnI7CgkJCXRoaXMueSA9IGMuZzsKCQkJdGhpcy56ID0gYy5iOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIHYgKSB7CgoJCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyB2ZWN0b3IncyB4IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0IF1gLCB5IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMSBdYAoJCSAqIGFuZCB6IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMiBdYC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLno7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoJCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgZWFjaCBjb21wb25lbnQgb2YgdGhpcyB2ZWN0b3IgdG8gYSBwc2V1ZG8tcmFuZG9tIHZhbHVlIGJldHdlZW4gYDBgIGFuZAoJCSAqIGAxYCwgZXhjbHVkaW5nIGAxYC4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXJhbmRvbSgpIHsKCgkJCXRoaXMueCA9IE1hdGgucmFuZG9tKCk7CgkJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CgkJCXRoaXMueiA9IE1hdGgucmFuZG9tKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdW5pZm9ybWx5IHJhbmRvbSBwb2ludCBvbiBhIHVuaXQgc3BoZXJlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcmFuZG9tRGlyZWN0aW9uKCkgewoKCQkJLy8gaHR0cHM6Ly9tYXRod29ybGQud29sZnJhbS5jb20vU3BoZXJlUG9pbnRQaWNraW5nLmh0bWwKCgkJCWNvbnN0IHRoZXRhID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOwoJCQljb25zdCB1ID0gTWF0aC5yYW5kb20oKSAqIDIgLSAxOwoJCQljb25zdCBjID0gTWF0aC5zcXJ0KCAxIC0gdSAqIHUgKTsKCgkJCXRoaXMueCA9IGMgKiBNYXRoLmNvcyggdGhldGEgKTsKCQkJdGhpcy55ID0gdTsKCQkJdGhpcy56ID0gYyAqIE1hdGguc2luKCB0aGV0YSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCQl5aWVsZCB0aGlzLng7CgkJCXlpZWxkIHRoaXMueTsKCQkJeWllbGQgdGhpcy56OwoKCQl9CgoJfQoKCWNvbnN0IF92ZWN0b3IkYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9xdWF0ZXJuaW9uJDQgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgoJLyoqCgkgKiBSZXByZXNlbnRzIGEgM3gzIG1hdHJpeC4KCSAqCgkgKiBBIE5vdGUgb24gUm93LU1ham9yIGFuZCBDb2x1bW4tTWFqb3IgT3JkZXJpbmc6CgkgKgoJICogVGhlIGNvbnN0cnVjdG9yIGFuZCB7QGxpbmsgTWF0cml4MyNzZXR9IG1ldGhvZCB0YWtlIGFyZ3VtZW50cyBpbgoJICogW3Jvdy1tYWpvcl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUm93LV9hbmRfY29sdW1uLW1ham9yX29yZGVyI0NvbHVtbi1tYWpvcl9vcmRlcn0KCSAqIG9yZGVyLCB3aGlsZSBpbnRlcm5hbGx5IHRoZXkgYXJlIHN0b3JlZCBpbiB0aGUge0BsaW5rIE1hdHJpeDMjZWxlbWVudHN9IGFycmF5IGluIGNvbHVtbi1tYWpvciBvcmRlci4KCSAqIFRoaXMgbWVhbnMgdGhhdCBjYWxsaW5nOgoJICogYGBganMKCSAqIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWF0cml4KCk7CgkgKiBtLnNldCggMTEsIDEyLCAxMywKCSAqICAgICAgICAyMSwgMjIsIDIzLAoJICogICAgICAgIDMxLCAzMiwgMzMgKTsKCSAqIGBgYAoJICogd2lsbCByZXN1bHQgaW4gdGhlIGVsZW1lbnRzIGFycmF5IGNvbnRhaW5pbmc6CgkgKiBgYGBqcwoJICogbS5lbGVtZW50cyA9IFsgMTEsIDIxLCAzMSwKCSAqICAgICAgICAgICAgICAgIDEyLCAyMiwgMzIsCgkgKiAgICAgICAgICAgICAgICAxMywgMjMsIDMzIF07CgkgKiBgYGAKCSAqIGFuZCBpbnRlcm5hbGx5IGFsbCBjYWxjdWxhdGlvbnMgYXJlIHBlcmZvcm1lZCB1c2luZyBjb2x1bW4tbWFqb3Igb3JkZXJpbmcuCgkgKiBIb3dldmVyLCBhcyB0aGUgYWN0dWFsIG9yZGVyaW5nIG1ha2VzIG5vIGRpZmZlcmVuY2UgbWF0aGVtYXRpY2FsbHkgYW5kCgkgKiBtb3N0IHBlb3BsZSBhcmUgdXNlZCB0byB0aGlua2luZyBhYm91dCBtYXRyaWNlcyBpbiByb3ctbWFqb3Igb3JkZXIsIHRoZQoJICogdGhyZWUuanMgZG9jdW1lbnRhdGlvbiBzaG93cyBtYXRyaWNlcyBpbiByb3ctbWFqb3Igb3JkZXIuIEp1c3QgYmVhciBpbgoJICogbWluZCB0aGF0IGlmIHlvdSBhcmUgcmVhZGluZyB0aGUgc291cmNlIGNvZGUsIHlvdSdsbCBoYXZlIHRvIHRha2UgdGhlCgkgKiB0cmFuc3Bvc2Ugb2YgYW55IG1hdHJpY2VzIG91dGxpbmVkIGhlcmUgdG8gbWFrZSBzZW5zZSBvZiB0aGUgY2FsY3VsYXRpb25zLgoJICovCgljbGFzcyBNYXRyaXgzIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyAzeDMgbWF0cml4LiBUaGUgYXJndW1lbnRzIGFyZSBzdXBwb3NlZCB0byBiZQoJCSAqIGluIHJvdy1tYWpvciBvcmRlci4gSWYgbm8gYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdG9yCgkJICogaW5pdGlhbGl6ZXMgdGhlIG1hdHJpeCBhcyBhbiBpZGVudGl0eSBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zMV0gLSAzLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzJdIC0gMy0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMzXSAtIDMtMyBtYXRyaXggZWxlbWVudC4KCQkgKi8KCQljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjIxLCBuMjIsIG4yMywgbjMxLCBuMzIsIG4zMyApIHsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQlNYXRyaXgzLnByb3RvdHlwZS5pc01hdHJpeDMgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIEEgY29sdW1uLW1ham9yIGxpc3Qgb2YgbWF0cml4IHZhbHVlcy4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PG51bWJlcj59CgkJCSAqLwoJCQl0aGlzLmVsZW1lbnRzID0gWwoKCQkJCTEsIDAsIDAsCgkJCQkwLCAxLCAwLAoJCQkJMCwgMCwgMQoKCQkJXTsKCgkJCWlmICggbjExICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4LlRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCgkJICogaW4gcm93LW1ham9yIG9yZGVyLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTFdIC0gMS0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEyXSAtIDEtMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24xM10gLSAxLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjFdIC0gMi0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIyXSAtIDItMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yM10gLSAyLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSA9IG4xMTsgdGVbIDEgXSA9IG4yMTsgdGVbIDIgXSA9IG4zMTsKCQkJdGVbIDMgXSA9IG4xMjsgdGVbIDQgXSA9IG4yMjsgdGVbIDUgXSA9IG4zMjsKCQkJdGVbIDYgXSA9IG4xMzsgdGVbIDcgXSA9IG4yMzsgdGVbIDggXSA9IG4zMzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggdG8gdGhlIDN4MyBpZGVudGl0eSBtYXRyaXguCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlpZGVudGl0eSgpIHsKCgkJCXRoaXMuc2V0KAoKCQkJCTEsIDAsIDAsCgkJCQkwLCAxLCAwLAoJCQkJMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRyaXggdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSBtYXRyaXggdG8gY29weS4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQljb3B5KCBtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOwoJCQl0ZVsgMyBdID0gbWVbIDMgXTsgdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOwoJCQl0ZVsgNiBdID0gbWVbIDYgXTsgdGVbIDcgXSA9IG1lWyA3IF07IHRlWyA4IF0gPSBtZVsgOCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXh0cmFjdHMgdGhlIGJhc2lzIG9mIHRoaXMgbWF0cml4IGludG8gdGhlIHRocmVlIGF4aXMgdmVjdG9ycyBwcm92aWRlZC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30geEF4aXMgLSBUaGUgYmFzaXMncyB4IGF4aXMuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB5QXhpcyAtIFRoZSBiYXNpcydzIHkgYXhpcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHpBeGlzIC0gVGhlIGJhc2lzJ3MgeiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJCXhBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAwICk7CgkJCXlBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAxICk7CgkJCXpBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAyICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXQgdGhpcyBtYXRyaXggdG8gdGhlIHVwcGVyIDN4MyBtYXRyaXggb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlzZXRGcm9tTWF0cml4NCggbSApIHsKCgkJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCgkJCXRoaXMuc2V0KAoKCQkJCW1lWyAwIF0sIG1lWyA0IF0sIG1lWyA4IF0sCgkJCQltZVsgMSBdLCBtZVsgNSBdLCBtZVsgOSBdLAoJCQkJbWVbIDIgXSwgbWVbIDYgXSwgbWVbIDEwIF0KCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQb3N0LW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDN4MyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgoJCX0KCgkJLyoqCgkJICogUHJlLW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDN4MyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJcHJlbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGVzIHRoZSBnaXZlbiAzeDMgbWF0cmljZXMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CgkJICogaW4gdGhpcyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IGEgLSBUaGUgZmlyc3QgbWF0cml4LgoJCSAqIEBwYXJhbSB7TWF0cml4M30gYiAtIFRoZSBzZWNvbmQgbWF0cml4LgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgoJCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CgkJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDMgXSwgYTEzID0gYWVbIDYgXTsKCQkJY29uc3QgYTIxID0gYWVbIDEgXSwgYTIyID0gYWVbIDQgXSwgYTIzID0gYWVbIDcgXTsKCQkJY29uc3QgYTMxID0gYWVbIDIgXSwgYTMyID0gYWVbIDUgXSwgYTMzID0gYWVbIDggXTsKCgkJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyAzIF0sIGIxMyA9IGJlWyA2IF07CgkJCWNvbnN0IGIyMSA9IGJlWyAxIF0sIGIyMiA9IGJlWyA0IF0sIGIyMyA9IGJlWyA3IF07CgkJCWNvbnN0IGIzMSA9IGJlWyAyIF0sIGIzMiA9IGJlWyA1IF0sIGIzMyA9IGJlWyA4IF07CgoJCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxOwoJCQl0ZVsgMyBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyOwoJCQl0ZVsgNiBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzOwoKCQkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKCQkJdGVbIDQgXSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKCQkJdGVbIDcgXSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKCgkJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CgkJCXRlWyA1IF0gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CgkJCXRlWyA4IF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBNdWx0aXBsaWVzIGV2ZXJ5IGNvbXBvbmVudCBvZiB0aGUgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIuCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0ZVsgMCBdICo9IHM7IHRlWyAzIF0gKj0gczsgdGVbIDYgXSAqPSBzOwoJCQl0ZVsgMSBdICo9IHM7IHRlWyA0IF0gKj0gczsgdGVbIDcgXSAqPSBzOwoJCQl0ZVsgMiBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDggXSAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgYW5kIHJldHVybnMgdGhlIGRldGVybWluYW50IG9mIHRoaXMgbWF0cml4LgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGV0ZXJtaW5hbnQuCgkJICovCgkJZGV0ZXJtaW5hbnQoKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQljb25zdCBhID0gdGVbIDAgXSwgYiA9IHRlWyAxIF0sIGMgPSB0ZVsgMiBdLAoJCQkJZCA9IHRlWyAzIF0sIGUgPSB0ZVsgNCBdLCBmID0gdGVbIDUgXSwKCQkJCWcgPSB0ZVsgNiBdLCBoID0gdGVbIDcgXSwgaSA9IHRlWyA4IF07CgoJCQlyZXR1cm4gYSAqIGUgKiBpIC0gYSAqIGYgKiBoIC0gYiAqIGQgKiBpICsgYiAqIGYgKiBnICsgYyAqIGQgKiBoIC0gYyAqIGUgKiBnOwoKCQl9CgoJCS8qKgoJCSAqIEludmVydHMgdGhpcyBtYXRyaXgsIHVzaW5nIHRoZSBbYW5hbHl0aWMgbWV0aG9kXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnRpYmxlX21hdHJpeCNBbmFseXRpY19zb2x1dGlvbn0uCgkJICogWW91IGNhbiBub3QgaW52ZXJ0IHdpdGggYSBkZXRlcm1pbmFudCBvZiB6ZXJvLiBJZiB5b3UgYXR0ZW1wdCB0aGlzLCB0aGUgbWV0aG9kIHByb2R1Y2VzCgkJICogYSB6ZXJvIG1hdHJpeCBpbnN0ZWFkLgoJCSAqCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJaW52ZXJ0KCkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKCQkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sCgkJCQluMTIgPSB0ZVsgMyBdLCBuMjIgPSB0ZVsgNCBdLCBuMzIgPSB0ZVsgNSBdLAoJCQkJbjEzID0gdGVbIDYgXSwgbjIzID0gdGVbIDcgXSwgbjMzID0gdGVbIDggXSwKCgkJCQl0MTEgPSBuMzMgKiBuMjIgLSBuMzIgKiBuMjMsCgkJCQl0MTIgPSBuMzIgKiBuMTMgLSBuMzMgKiBuMTIsCgkJCQl0MTMgPSBuMjMgKiBuMTIgLSBuMjIgKiBuMTMsCgoJCQkJZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzOwoKCQkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCgkJCWNvbnN0IGRldEludiA9IDEgLyBkZXQ7CgoJCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCQl0ZVsgMSBdID0gKCBuMzEgKiBuMjMgLSBuMzMgKiBuMjEgKSAqIGRldEludjsKCQkJdGVbIDIgXSA9ICggbjMyICogbjIxIC0gbjMxICogbjIyICkgKiBkZXRJbnY7CgoJCQl0ZVsgMyBdID0gdDEyICogZGV0SW52OwoJCQl0ZVsgNCBdID0gKCBuMzMgKiBuMTEgLSBuMzEgKiBuMTMgKSAqIGRldEludjsKCQkJdGVbIDUgXSA9ICggbjMxICogbjEyIC0gbjMyICogbjExICkgKiBkZXRJbnY7CgoJCQl0ZVsgNiBdID0gdDEzICogZGV0SW52OwoJCQl0ZVsgNyBdID0gKCBuMjEgKiBuMTMgLSBuMjMgKiBuMTEgKSAqIGRldEludjsKCQkJdGVbIDggXSA9ICggbjIyICogbjExIC0gbjIxICogbjEyICkgKiBkZXRJbnY7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc3Bvc2VzIHRoaXMgbWF0cml4IGluIHBsYWNlLgoJCSAqCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJdHJhbnNwb3NlKCkgewoKCQkJbGV0IHRtcDsKCQkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0bXAgPSBtWyAxIF07IG1bIDEgXSA9IG1bIDMgXTsgbVsgMyBdID0gdG1wOwoJCQl0bXAgPSBtWyAyIF07IG1bIDIgXSA9IG1bIDYgXTsgbVsgNiBdID0gdG1wOwoJCQl0bXAgPSBtWyA1IF07IG1bIDUgXSA9IG1bIDcgXTsgbVsgNyBdID0gdG1wOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIG5vcm1hbCBtYXRyaXggd2hpY2ggaXMgdGhlIGludmVyc2UgdHJhbnNwb3NlIG9mIHRoZSB1cHBlcgoJCSAqIGxlZnQgM3gzIHBvcnRpb24gb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeDQgLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlnZXROb3JtYWxNYXRyaXgoIG1hdHJpeDQgKSB7CgoJCQlyZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4NCggbWF0cml4NCApLmludmVydCgpLnRyYW5zcG9zZSgpOwoKCQl9CgoJCS8qKgoJCSAqIFRyYW5zcG9zZXMgdGhpcyBtYXRyaXggaW50byB0aGUgc3VwcGxpZWQgYXJyYXksIGFuZCByZXR1cm5zIGl0c2VsZiB1bmNoYW5nZWQuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IHIgLSBBbiBhcnJheSB0byBzdG9yZSB0aGUgdHJhbnNwb3NlZCBtYXRyaXggZWxlbWVudHMuCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJdHJhbnNwb3NlSW50b0FycmF5KCByICkgewoKCQkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgoJCQlyWyAwIF0gPSBtWyAwIF07CgkJCXJbIDEgXSA9IG1bIDMgXTsKCQkJclsgMiBdID0gbVsgNiBdOwoJCQlyWyAzIF0gPSBtWyAxIF07CgkJCXJbIDQgXSA9IG1bIDQgXTsKCQkJclsgNSBdID0gbVsgNyBdOwoJCQlyWyA2IF0gPSBtWyAyIF07CgkJCXJbIDcgXSA9IG1bIDUgXTsKCQkJclsgOCBdID0gbVsgOCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgVVYgdHJhbnNmb3JtIG1hdHJpeCBmcm9tIG9mZnNldCwgcmVwZWF0LCByb3RhdGlvbiwgYW5kIGNlbnRlci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0eCAtIE9mZnNldCB4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0eSAtIE9mZnNldCB5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzeCAtIFJlcGVhdCB4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzeSAtIFJlcGVhdCB5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByb3RhdGlvbiAtIFJvdGF0aW9uLCBpbiByYWRpYW5zLiBQb3NpdGl2ZSB2YWx1ZXMgcm90YXRlIGNvdW50ZXJjbG9ja3dpc2UuCgkJICogQHBhcmFtIHtudW1iZXJ9IGN4IC0gQ2VudGVyIHggb2Ygcm90YXRpb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IGN5IC0gQ2VudGVyIHkgb2Ygcm90YXRpb24KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlzZXRVdlRyYW5zZm9ybSggdHgsIHR5LCBzeCwgc3ksIHJvdGF0aW9uLCBjeCwgY3kgKSB7CgoJCQljb25zdCBjID0gTWF0aC5jb3MoIHJvdGF0aW9uICk7CgkJCWNvbnN0IHMgPSBNYXRoLnNpbiggcm90YXRpb24gKTsKCgkJCXRoaXMuc2V0KAoJCQkJc3ggKiBjLCBzeCAqIHMsIC0gc3ggKiAoIGMgKiBjeCArIHMgKiBjeSApICsgY3ggKyB0eCwKCQkJCS0gc3kgKiBzLCBzeSAqIGMsIC0gc3kgKiAoIC0gcyAqIGN4ICsgYyAqIGN5ICkgKyBjeSArIHR5LAoJCQkJMCwgMCwgMQoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2NhbGVzIHRoaXMgbWF0cml4IHdpdGggdGhlIGdpdmVuIHNjYWxhciB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc3ggLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBYIGF4aXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHN5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCXNjYWxlKCBzeCwgc3kgKSB7CgoJCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVNjYWxlKCBzeCwgc3kgKSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgcm90YXRpb24gaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlyb3RhdGUoIHRoZXRhICkgewoKCQkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VSb3RhdGlvbiggLSB0aGV0YSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGVzIHRoaXMgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIgdmFsdWVzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHR4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gdHkgLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgWSBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCXRyYW5zbGF0ZSggdHgsIHR5ICkgewoKCQkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VUcmFuc2xhdGlvbiggdHgsIHR5ICkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8vIGZvciAyRCBUcmFuc2Zvcm1zCgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSAyRCB0cmFuc2xhdGlvbiB0cmFuc2Zvcm0uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IyfSB4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcyBvciBhbHRlcm5hdGl2ZWx5IGEgdHJhbnNsYXRpb24gdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFkgYXhpcy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlVHJhbnNsYXRpb24oIHgsIHkgKSB7CgoJCQlpZiAoIHguaXNWZWN0b3IyICkgewoKCQkJCXRoaXMuc2V0KAoKCQkJCQkxLCAwLCB4LngsCgkJCQkJMCwgMSwgeC55LAoJCQkJCTAsIDAsIDEKCgkJCQkpOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNldCgKCgkJCQkJMSwgMCwgeCwKCQkJCQkwLCAxLCB5LAoJCQkJCTAsIDAsIDEKCgkJCQkpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIDJEIHJvdGF0aW9uYWwgdHJhbnNmb3JtYXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgcm90YXRpb24gaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlUm90YXRpb24oIHRoZXRhICkgewoKCQkJLy8gY291bnRlcmNsb2Nrd2lzZQoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApOwoJCQljb25zdCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQljLCAtIHMsIDAsCgkJCQlzLCBjLCAwLAoJCQkJMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSAyRCBzY2FsZSB0cmFuc2Zvcm0uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFkgYXhpcy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlU2NhbGUoIHgsIHkgKSB7CgoJCQl0aGlzLnNldCgKCgkJCQl4LCAwLCAwLAoJCQkJMCwgeSwgMCwKCQkJCTAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIG1hdHJpeCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG1hdHJpeCAtIFRoZSBtYXRyaXggdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIG1hdHJpeCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCBtYXRyaXggKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCWNvbnN0IG1lID0gbWF0cml4LmVsZW1lbnRzOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgOTsgaSArKyApIHsKCgkJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFycmF5LgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJCXRoaXMuZWxlbWVudHNbIGkgXSA9IGFycmF5WyBpICsgb2Zmc2V0IF07CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBXcml0ZXMgdGhlIGVsZW1lbnRzIG9mIHRoaXMgbWF0cml4IHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCgkJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGVbIDEgXTsKCQkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRlWyAyIF07CgoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCQkJYXJyYXlbIG9mZnNldCArIDQgXSA9IHRlWyA0IF07CgkJCWFycmF5WyBvZmZzZXQgKyA1IF0gPSB0ZVsgNSBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgOCBdID0gdGVbIDggXTsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbWF0cml4IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5mcm9tQXJyYXkoIHRoaXMuZWxlbWVudHMgKTsKCgkJfQoKCX0KCgljb25zdCBfbTMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgoJZnVuY3Rpb24gYXJyYXlOZWVkc1VpbnQzMiggYXJyYXkgKSB7CgoJCS8vIGFzc3VtZXMgbGFyZ2VyIHZhbHVlcyB1c3VhbGx5IG9uIGxhc3QKCgkJZm9yICggbGV0IGkgPSBhcnJheS5sZW5ndGggLSAxOyBpID49IDA7IC0tIGkgKSB7CgoJCQlpZiAoIGFycmF5WyBpIF0gPj0gNjU1MzUgKSByZXR1cm4gdHJ1ZTsgLy8gYWNjb3VudCBmb3IgUFJJTUlUSVZFX1JFU1RBUlRfRklYRURfSU5ERVgsICMyNDU2NQoKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gY3JlYXRlRWxlbWVudE5TKCBuYW1lICkgewoKCQlyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCcsIG5hbWUgKTsKCgl9CgoJZnVuY3Rpb24gY3JlYXRlQ2FudmFzRWxlbWVudCgpIHsKCgkJY29uc3QgY2FudmFzID0gY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwoJCWNhbnZhcy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCQlyZXR1cm4gY2FudmFzOwoKCX0KCgljb25zdCBfY2FjaGUgPSB7fTsKCglmdW5jdGlvbiB3YXJuT25jZSggbWVzc2FnZSApIHsKCgkJaWYgKCBtZXNzYWdlIGluIF9jYWNoZSApIHJldHVybjsKCgkJX2NhY2hlWyBtZXNzYWdlIF0gPSB0cnVlOwoKCQljb25zb2xlLndhcm4oIG1lc3NhZ2UgKTsKCgl9CgoJZnVuY3Rpb24gcHJvYmVBc3luYyggZ2wsIHN5bmMsIGludGVydmFsICkgewoKCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJZnVuY3Rpb24gcHJvYmUoKSB7CgoJCQkJc3dpdGNoICggZ2wuY2xpZW50V2FpdFN5bmMoIHN5bmMsIGdsLlNZTkNfRkxVU0hfQ09NTUFORFNfQklULCAwICkgKSB7CgoJCQkJCWNhc2UgZ2wuV0FJVF9GQUlMRUQ6CgkJCQkJCXJlamVjdCgpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBnbC5USU1FT1VUX0VYUElSRUQ6CgkJCQkJCXNldFRpbWVvdXQoIHByb2JlLCBpbnRlcnZhbCApOwoJCQkJCQlicmVhazsKCgkJCQkJZGVmYXVsdDoKCQkJCQkJcmVzb2x2ZSgpOwoKCQkJCX0KCgkJCX0KCgkJCXNldFRpbWVvdXQoIHByb2JlLCBpbnRlcnZhbCApOwoKCQl9ICk7CgoJfQoKCWZ1bmN0aW9uIHRvTm9ybWFsaXplZFByb2plY3Rpb25NYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSB7CgoJCWNvbnN0IG0gPSBwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwoKCQkvLyBDb252ZXJ0IFstMSwgMV0gdG8gWzAsIDFdIHByb2plY3Rpb24gbWF0cml4CgkJbVsgMiBdID0gMC41ICogbVsgMiBdICsgMC41ICogbVsgMyBdOwoJCW1bIDYgXSA9IDAuNSAqIG1bIDYgXSArIDAuNSAqIG1bIDcgXTsKCQltWyAxMCBdID0gMC41ICogbVsgMTAgXSArIDAuNSAqIG1bIDExIF07CgkJbVsgMTQgXSA9IDAuNSAqIG1bIDE0IF0gKyAwLjUgKiBtWyAxNSBdOwoKCX0KCglmdW5jdGlvbiB0b1JldmVyc2VkUHJvamVjdGlvbk1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApIHsKCgkJY29uc3QgbSA9IHByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgkJY29uc3QgaXNQZXJzcGVjdGl2ZU1hdHJpeCA9IG1bIDExIF0gPT09IC0xOwoKCQkvLyBSZXZlcnNlIFswLCAxXSBwcm9qZWN0aW9uIG1hdHJpeAoJCWlmICggaXNQZXJzcGVjdGl2ZU1hdHJpeCApIHsKCgkJCW1bIDEwIF0gPSAtIG1bIDEwIF0gLSAxOwoJCQltWyAxNCBdID0gLSBtWyAxNCBdOwoKCQl9IGVsc2UgewoKCQkJbVsgMTAgXSA9IC0gbVsgMTAgXTsKCQkJbVsgMTQgXSA9IC0gbVsgMTQgXSArIDE7CgoJCX0KCgl9CgoJY29uc3QgTElORUFSX1JFQzcwOV9UT19YWVogPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkuc2V0KAoJCTAuNDEyMzkwOCwgMC4zNTc1ODQzLCAwLjE4MDQ4MDgsCgkJMC4yMTI2MzkwLCAwLjcxNTE2ODcsIDAuMDcyMTkyMywKCQkwLjAxOTMzMDgsIDAuMTE5MTk0OCwgMC45NTA1MzIyCgkpOwoKCWNvbnN0IFhZWl9UT19MSU5FQVJfUkVDNzA5ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpLnNldCgKCQkzLjI0MDk2OTksIC0xLjUzNzM4MzIsIC0wLjQ5ODYxMDgsCgkJLTAuOTY5MjQzNiwgMS44NzU5Njc1LCAwLjA0MTU1NTEsCgkJMC4wNTU2MzAxLCAtMC4yMDM5NzcsIDEuMDU2OTcxNQoJKTsKCglmdW5jdGlvbiBjcmVhdGVDb2xvck1hbmFnZW1lbnQoKSB7CgoJCWNvbnN0IENvbG9yTWFuYWdlbWVudCA9IHsKCgkJCWVuYWJsZWQ6IHRydWUsCgoJCQl3b3JraW5nQ29sb3JTcGFjZTogTGluZWFyU1JHQkNvbG9yU3BhY2UsCgoJCQkvKioKCQkJICogSW1wbGVtZW50YXRpb25zIG9mIHN1cHBvcnRlZCBjb2xvciBzcGFjZXMuCgkJCSAqCgkJCSAqIFJlcXVpcmVkOgoJCQkgKgktIHByaW1hcmllczogY2hyb21hdGljaXR5IGNvb3JkaW5hdGVzIFsgcnggcnkgZ3ggZ3kgYnggYnkgXQoJCQkgKgktIHdoaXRlUG9pbnQ6IHJlZmVyZW5jZSB3aGl0ZSBbIHggeSBdCgkJCSAqCS0gdHJhbnNmZXI6IHRyYW5zZmVyIGZ1bmN0aW9uIChwcmUtZGVmaW5lZCkKCQkJICoJLSB0b1hZWjogTWF0cml4MyBSR0IgdG8gWFlaIHRyYW5zZm9ybQoJCQkgKgktIGZyb21YWVo6IE1hdHJpeDMgWFlaIHRvIFJHQiB0cmFuc2Zvcm0KCQkJICoJLSBsdW1pbmFuY2VDb2VmZmljaWVudHM6IFJHQiBsdW1pbmFuY2UgY29lZmZpY2llbnRzCgkJCSAqCgkJCSAqIE9wdGlvbmFsOgoJCQkgKiAgLSBvdXRwdXRDb2xvclNwYWNlQ29uZmlnOiB7IGRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOiBDb2xvclNwYWNlIH0KCQkJICogIC0gd29ya2luZ0NvbG9yU3BhY2VDb25maWc6IHsgdW5wYWNrQ29sb3JTcGFjZTogQ29sb3JTcGFjZSB9CgkJCSAqCgkJCSAqIFJlZmVyZW5jZToKCQkJICogLSBodHRwczovL3d3dy5ydXNzZWxsY290dHJlbGwuY29tL3Bob3RvL21hdHJpeENhbGN1bGF0b3IuaHRtCgkJCSAqLwoJCQlzcGFjZXM6IHt9LAoKCQkJY29udmVydDogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSwgdGFyZ2V0Q29sb3JTcGFjZSApIHsKCgkJCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgfHwgc291cmNlQ29sb3JTcGFjZSA9PT0gdGFyZ2V0Q29sb3JTcGFjZSB8fCAhIHNvdXJjZUNvbG9yU3BhY2UgfHwgISB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJCQlyZXR1cm4gY29sb3I7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCQljb2xvci5yID0gU1JHQlRvTGluZWFyKCBjb2xvci5yICk7CgkJCQkJY29sb3IuZyA9IFNSR0JUb0xpbmVhciggY29sb3IuZyApOwoJCQkJCWNvbG9yLmIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmIgKTsKCgkJCQl9CgoJCQkJaWYgKCB0aGlzLnNwYWNlc1sgc291cmNlQ29sb3JTcGFjZSBdLnByaW1hcmllcyAhPT0gdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS5wcmltYXJpZXMgKSB7CgoJCQkJCWNvbG9yLmFwcGx5TWF0cml4MyggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1hZWiApOwoJCQkJCWNvbG9yLmFwcGx5TWF0cml4MyggdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS5mcm9tWFlaICk7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS50cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCQljb2xvci5yID0gTGluZWFyVG9TUkdCKCBjb2xvci5yICk7CgkJCQkJY29sb3IuZyA9IExpbmVhclRvU1JHQiggY29sb3IuZyApOwoJCQkJCWNvbG9yLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIGNvbG9yOwoKCQkJfSwKCgkJCXdvcmtpbmdUb0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3IsIHRhcmdldENvbG9yU3BhY2UgKSB7CgoJCQkJcmV0dXJuIHRoaXMuY29udmVydCggY29sb3IsIHRoaXMud29ya2luZ0NvbG9yU3BhY2UsIHRhcmdldENvbG9yU3BhY2UgKTsKCgkJCX0sCgoJCQljb2xvclNwYWNlVG9Xb3JraW5nOiBmdW5jdGlvbiAoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlICkgewoKCQkJCXJldHVybiB0aGlzLmNvbnZlcnQoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlLCB0aGlzLndvcmtpbmdDb2xvclNwYWNlICk7CgoJCQl9LAoKCQkJZ2V0UHJpbWFyaWVzOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgoJCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ucHJpbWFyaWVzOwoKCQkJfSwKCgkJCWdldFRyYW5zZmVyOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgoJCQkJaWYgKCBjb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgKSByZXR1cm4gTGluZWFyVHJhbnNmZXI7CgoJCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0udHJhbnNmZXI7CgoJCQl9LAoKCQkJZ2V0THVtaW5hbmNlQ29lZmZpY2llbnRzOiBmdW5jdGlvbiAoIHRhcmdldCwgY29sb3JTcGFjZSA9IHRoaXMud29ya2luZ0NvbG9yU3BhY2UgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5mcm9tQXJyYXkoIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ubHVtaW5hbmNlQ29lZmZpY2llbnRzICk7CgoJCQl9LAoKCQkJZGVmaW5lOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2VzICkgewoKCQkJCU9iamVjdC5hc3NpZ24oIHRoaXMuc3BhY2VzLCBjb2xvclNwYWNlcyApOwoKCQkJfSwKCgkJCS8vIEludGVybmFsIEFQSXMKCgkJCV9nZXRNYXRyaXg6IGZ1bmN0aW9uICggdGFyZ2V0TWF0cml4LCBzb3VyY2VDb2xvclNwYWNlLCB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJCXJldHVybiB0YXJnZXRNYXRyaXgKCQkJCQkuY29weSggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1hZWiApCgkJCQkJLm11bHRpcGx5KCB0aGlzLnNwYWNlc1sgdGFyZ2V0Q29sb3JTcGFjZSBdLmZyb21YWVogKTsKCgkJCX0sCgoJCQlfZ2V0RHJhd2luZ0J1ZmZlckNvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3JTcGFjZSApIHsKCgkJCQlyZXR1cm4gdGhpcy5zcGFjZXNbIGNvbG9yU3BhY2UgXS5vdXRwdXRDb2xvclNwYWNlQ29uZmlnLmRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOwoKCQkJfSwKCgkJCV9nZXRVbnBhY2tDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgPSB0aGlzLndvcmtpbmdDb2xvclNwYWNlICkgewoKCQkJCXJldHVybiB0aGlzLnNwYWNlc1sgY29sb3JTcGFjZSBdLndvcmtpbmdDb2xvclNwYWNlQ29uZmlnLnVucGFja0NvbG9yU3BhY2U7CgoJCQl9LAoKCQkJLy8gRGVwcmVjYXRlZAoKCQkJZnJvbVdvcmtpbmdDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJCXdhcm5PbmNlKCAnVEhSRUUuQ29sb3JNYW5hZ2VtZW50OiAuZnJvbVdvcmtpbmdDb2xvclNwYWNlKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAud29ya2luZ1RvQ29sb3JTcGFjZSgpLicgKTsgLy8gQGRlcHJlY2F0ZWQsIHIxNzcKCgkJCQlyZXR1cm4gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICk7CgoJCQl9LAoKCQkJdG9Xb3JraW5nQ29sb3JTcGFjZTogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSApIHsKCgkJCQl3YXJuT25jZSggJ1RIUkVFLkNvbG9yTWFuYWdlbWVudDogLnRvV29ya2luZ0NvbG9yU3BhY2UoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5jb2xvclNwYWNlVG9Xb3JraW5nKCkuJyApOyAvLyBAZGVwcmVjYXRlZCwgcjE3NwoKCQkJCXJldHVybiBDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UgKTsKCgkJCX0sCgoJCX07CgoJCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCQkgKiBzUkdCIGRlZmluaXRpb25zCgkJICovCgoJCWNvbnN0IFJFQzcwOV9QUklNQVJJRVMgPSBbIDAuNjQwLCAwLjMzMCwgMC4zMDAsIDAuNjAwLCAwLjE1MCwgMC4wNjAgXTsKCQljb25zdCBSRUM3MDlfTFVNSU5BTkNFX0NPRUZGSUNJRU5UUyA9IFsgMC4yMTI2LCAwLjcxNTIsIDAuMDcyMiBdOwoJCWNvbnN0IEQ2NSA9IFsgMC4zMTI3LCAwLjMyOTAgXTsKCgkJQ29sb3JNYW5hZ2VtZW50LmRlZmluZSggewoKCQkJWyBMaW5lYXJTUkdCQ29sb3JTcGFjZSBdOiB7CgkJCQlwcmltYXJpZXM6IFJFQzcwOV9QUklNQVJJRVMsCgkJCQl3aGl0ZVBvaW50OiBENjUsCgkJCQl0cmFuc2ZlcjogTGluZWFyVHJhbnNmZXIsCgkJCQl0b1hZWjogTElORUFSX1JFQzcwOV9UT19YWVosCgkJCQlmcm9tWFlaOiBYWVpfVE9fTElORUFSX1JFQzcwOSwKCQkJCWx1bWluYW5jZUNvZWZmaWNpZW50czogUkVDNzA5X0xVTUlOQU5DRV9DT0VGRklDSUVOVFMsCgkJCQl3b3JraW5nQ29sb3JTcGFjZUNvbmZpZzogeyB1bnBhY2tDb2xvclNwYWNlOiBTUkdCQ29sb3JTcGFjZSB9LAoJCQkJb3V0cHV0Q29sb3JTcGFjZUNvbmZpZzogeyBkcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogU1JHQkNvbG9yU3BhY2UgfQoJCQl9LAoKCQkJWyBTUkdCQ29sb3JTcGFjZSBdOiB7CgkJCQlwcmltYXJpZXM6IFJFQzcwOV9QUklNQVJJRVMsCgkJCQl3aGl0ZVBvaW50OiBENjUsCgkJCQl0cmFuc2ZlcjogU1JHQlRyYW5zZmVyLAoJCQkJdG9YWVo6IExJTkVBUl9SRUM3MDlfVE9fWFlaLAoJCQkJZnJvbVhZWjogWFlaX1RPX0xJTkVBUl9SRUM3MDksCgkJCQlsdW1pbmFuY2VDb2VmZmljaWVudHM6IFJFQzcwOV9MVU1JTkFOQ0VfQ09FRkZJQ0lFTlRTLAoJCQkJb3V0cHV0Q29sb3JTcGFjZUNvbmZpZzogeyBkcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogU1JHQkNvbG9yU3BhY2UgfQoJCQl9LAoKCQl9ICk7CgoJCXJldHVybiBDb2xvck1hbmFnZW1lbnQ7CgoJfQoKCWNvbnN0IENvbG9yTWFuYWdlbWVudCA9IC8qQF9fUFVSRV9fKi8gY3JlYXRlQ29sb3JNYW5hZ2VtZW50KCk7CgoJZnVuY3Rpb24gU1JHQlRvTGluZWFyKCBjICkgewoKCQlyZXR1cm4gKCBjIDwgMC4wNDA0NSApID8gYyAqIDAuMDc3Mzk5MzgwOCA6IE1hdGgucG93KCBjICogMC45NDc4NjcyOTg2ICsgMC4wNTIxMzI3MDE0LCAyLjQgKTsKCgl9CgoJZnVuY3Rpb24gTGluZWFyVG9TUkdCKCBjICkgewoKCQlyZXR1cm4gKCBjIDwgMC4wMDMxMzA4ICkgPyBjICogMTIuOTIgOiAxLjA1NSAqICggTWF0aC5wb3coIGMsIDAuNDE2NjYgKSApIC0gMC4wNTU7CgoJfQoKCWxldCBfY2FudmFzOwoKCS8qKgoJICogQSBjbGFzcyBjb250YWluaW5nIHV0aWxpdHkgZnVuY3Rpb25zIGZvciBpbWFnZXMuCgkgKgoJICogQGhpZGVjb25zdHJ1Y3RvcgoJICovCgljbGFzcyBJbWFnZVV0aWxzIHsKCgkJLyoqCgkJICogUmV0dXJucyBhIGRhdGEgVVJJIGNvbnRhaW5pbmcgYSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gaW1hZ2UuCgkJICoKCQkgKiBAcGFyYW0geyhIVE1MSW1hZ2VFbGVtZW50fEhUTUxDYW52YXNFbGVtZW50KX0gaW1hZ2UgLSBUaGUgaW1hZ2Ugb2JqZWN0LgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbdHlwZT0naW1hZ2UvcG5nJ10gLSBJbmRpY2F0ZXMgdGhlIGltYWdlIGZvcm1hdC4KCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBkYXRhIFVSSS4KCQkgKi8KCQlzdGF0aWMgZ2V0RGF0YVVSTCggaW1hZ2UsIHR5cGUgPSAnaW1hZ2UvcG5nJyApIHsKCgkJCWlmICggL15kYXRhOi9pLnRlc3QoIGltYWdlLnNyYyApICkgewoKCQkJCXJldHVybiBpbWFnZS5zcmM7CgoJCQl9CgoJCQlpZiAoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJcmV0dXJuIGltYWdlLnNyYzsKCgkJCX0KCgkJCWxldCBjYW52YXM7CgoJCQlpZiAoIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB7CgoJCQkJY2FudmFzID0gaW1hZ2U7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggX2NhbnZhcyA9PT0gdW5kZWZpbmVkICkgX2NhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgkJCQlfY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CgkJCQlfY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKCgkJCQljb25zdCBjb250ZXh0ID0gX2NhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgoJCQkJaWYgKCBpbWFnZSBpbnN0YW5jZW9mIEltYWdlRGF0YSApIHsKCgkJCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlLCAwLCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCWNhbnZhcyA9IF9jYW52YXM7CgoJCQl9CgoJCQlyZXR1cm4gY2FudmFzLnRvRGF0YVVSTCggdHlwZSApOwoKCQl9CgoJCS8qKgoJCSAqIENvbnZlcnRzIHRoZSBnaXZlbiBzUkdCIGltYWdlIGRhdGEgdG8gbGluZWFyIGNvbG9yIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHsoSFRNTEltYWdlRWxlbWVudHxIVE1MQ2FudmFzRWxlbWVudHxJbWFnZUJpdG1hcHxPYmplY3QpfSBpbWFnZSAtIFRoZSBpbWFnZSBvYmplY3QuCgkJICogQHJldHVybiB7SFRNTENhbnZhc0VsZW1lbnR8T2JqZWN0fSBUaGUgY29udmVydGVkIGltYWdlLgoJCSAqLwoJCXN0YXRpYyBzUkdCVG9MaW5lYXIoIGltYWdlICkgewoKCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAoJCQkJKCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAgKSApIHsKCgkJCQljb25zdCBjYW52YXMgPSBjcmVhdGVFbGVtZW50TlMoICdjYW52YXMnICk7CgoJCQkJY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CgkJCQljYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwoJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCQkJCWNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJZGF0YVsgaSBdID0gU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NTsKCgkJCQl9CgoJCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlRGF0YSwgMCwgMCApOwoKCQkJCXJldHVybiBjYW52YXM7CgoJCQl9IGVsc2UgaWYgKCBpbWFnZS5kYXRhICkgewoKCQkJCWNvbnN0IGRhdGEgPSBpbWFnZS5kYXRhLnNsaWNlKCAwICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWlmICggZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgfHwgZGF0YSBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5ICkgewoKCQkJCQkJZGF0YVsgaSBdID0gTWF0aC5mbG9vciggU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gYXNzdW1pbmcgZmxvYXQKCgkJCQkJCWRhdGFbIGkgXSA9IFNSR0JUb0xpbmVhciggZGF0YVsgaSBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIHsKCQkJCQlkYXRhOiBkYXRhLAoJCQkJCXdpZHRoOiBpbWFnZS53aWR0aCwKCQkJCQloZWlnaHQ6IGltYWdlLmhlaWdodAoJCQkJfTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VVdGlscy5zUkdCVG9MaW5lYXIoKTogVW5zdXBwb3J0ZWQgaW1hZ2UgdHlwZS4gTm8gY29sb3Igc3BhY2UgY29udmVyc2lvbiBhcHBsaWVkLicgKTsKCQkJCXJldHVybiBpbWFnZTsKCgkJCX0KCgkJfQoKCX0KCglsZXQgX3NvdXJjZUlkID0gMDsKCgkvKioKCSAqIFJlcHJlc2VudHMgdGhlIGRhdGEgc291cmNlIG9mIGEgdGV4dHVyZS4KCSAqCgkgKiBUaGUgbWFpbiBwdXJwb3NlIG9mIHRoaXMgY2xhc3MgaXMgdG8gZGVjb3VwbGUgdGhlIGRhdGEgZGVmaW5pdGlvbiBmcm9tIHRoZSB0ZXh0dXJlCgkgKiBkZWZpbml0aW9uIHNvIHRoZSBzYW1lIGRhdGEgY2FuIGJlIHVzZWQgd2l0aCBtdWx0aXBsZSB0ZXh0dXJlIGluc3RhbmNlcy4KCSAqLwoJY2xhc3MgU291cmNlIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyB2aWRlbyB0ZXh0dXJlLgoJCSAqCgkJICogQHBhcmFtIHthbnl9IFtkYXRhPW51bGxdIC0gVGhlIGRhdGEgZGVmaW5pdGlvbiBvZiBhIHRleHR1cmUuCgkJICovCgkJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNTb3VyY2UgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoZSBJRCBvZiB0aGUgc291cmNlLgoJCQkgKgoJCQkgKiBAbmFtZSBTb3VyY2UjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9zb3VyY2VJZCArKyB9ICk7CgoJCQkvKioKCQkJICogVGhlIFVVSUQgb2YgdGhlIHNvdXJjZS4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge2FueX0KCQkJICovCgkJCXRoaXMuZGF0YSA9IGRhdGE7CgoJCQkvKioKCQkJICogVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHJlbGV2YW50IHdoZW4ge0BsaW5rIFNvdXJjZSNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYCBhbmQKCQkJICogcHJvdmlkZXMgbW9yZSBjb250cm9sIG9uIGhvdyB0ZXh0dXJlIGRhdGEgc2hvdWxkIGJlIHByb2Nlc3NlZC4gV2hlbiBgZGF0YVJlYWR5YCBpcyBzZXQKCQkJICogdG8gYGZhbHNlYCwgdGhlIGVuZ2luZSBwZXJmb3JtcyB0aGUgbWVtb3J5IGFsbG9jYXRpb24gKGlmIG5lY2Vzc2FyeSkgYnV0IGRvZXMgbm90IHRyYW5zZmVyCgkJCSAqIHRoZSBkYXRhIGludG8gdGhlIEdQVSBtZW1vcnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmRhdGFSZWFkeSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhpcyBzdGFydHMgYXQgYDBgIGFuZCBjb3VudHMgaG93IG1hbnkgdGltZXMge0BsaW5rIFNvdXJjZSNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMudmVyc2lvbiA9IDA7CgoJCX0KCgkJZ2V0U2l6ZSggdGFyZ2V0ICkgewoKCQkJY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCgkJCWlmICggZGF0YSBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQgKSB7CgoJCQkJdGFyZ2V0LnNldCggZGF0YS52aWRlb1dpZHRoLCBkYXRhLnZpZGVvSGVpZ2h0ICk7CgoJCQl9IGVsc2UgaWYgKCBkYXRhICE9PSBudWxsICkgewoKCQkJCXRhcmdldC5zZXQoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLmRlcHRoIHx8IDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGFyZ2V0LnNldCggMCwgMCwgMCApOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldDsKCgkJfQoKCQkvKioKCQkgKiBXaGVuIHRoZSBwcm9wZXJ0eSBpcyBzZXQgdG8gYHRydWVgLCB0aGUgZW5naW5lIGFsbG9jYXRlcyB0aGUgbWVtb3J5CgkJICogZm9yIHRoZSB0ZXh0dXJlIChpZiBuZWNlc3NhcnkpIGFuZCB0cmlnZ2VycyB0aGUgYWN0dWFsIHRleHR1cmUgdXBsb2FkCgkJICogdG8gdGhlIEdQVSBuZXh0IHRpbWUgdGhlIHNvdXJjZSBpcyB1c2VkLgoJCSAqCgkJICogQHR5cGUge2Jvb2xlYW59CgkJICogQGRlZmF1bHQgZmFsc2UKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCgkJICovCgkJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJLyoqCgkJICogU2VyaWFsaXplcyB0aGUgc291cmNlIGludG8gSlNPTi4KCQkgKgoJCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIHNvdXJjZS4KCQkgKiBAc2VlIHtAbGluayBPYmplY3RMb2FkZXIjcGFyc2V9CgkJICovCgkJdG9KU09OKCBtZXRhICkgewoKCQkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCQlpZiAoICEgaXNSb290T2JqZWN0ICYmIG1ldGEuaW1hZ2VzWyB0aGlzLnV1aWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBtZXRhLmltYWdlc1sgdGhpcy51dWlkIF07CgoJCQl9CgoJCQljb25zdCBvdXRwdXQgPSB7CgkJCQl1dWlkOiB0aGlzLnV1aWQsCgkJCQl1cmw6ICcnCgkJCX07CgoJCQljb25zdCBkYXRhID0gdGhpcy5kYXRhOwoKCQkJaWYgKCBkYXRhICE9PSBudWxsICkgewoKCQkJCWxldCB1cmw7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBkYXRhICkgKSB7CgoJCQkJCS8vIGN1YmUgdGV4dHVyZQoKCQkJCQl1cmwgPSBbXTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZGF0YS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJaWYgKCBkYXRhWyBpIF0uaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkJCQl1cmwucHVzaCggc2VyaWFsaXplSW1hZ2UoIGRhdGFbIGkgXS5pbWFnZSApICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXVybC5wdXNoKCBzZXJpYWxpemVJbWFnZSggZGF0YVsgaSBdICkgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHRleHR1cmUKCgkJCQkJdXJsID0gc2VyaWFsaXplSW1hZ2UoIGRhdGEgKTsKCgkJCQl9CgoJCQkJb3V0cHV0LnVybCA9IHVybDsKCgkJCX0KCgkJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgoJCQkJbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdID0gb3V0cHV0OwoKCQkJfQoKCQkJcmV0dXJuIG91dHB1dDsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXJpYWxpemVJbWFnZSggaW1hZ2UgKSB7CgoJCWlmICggKCB0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgfHwKCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAoJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKCQkJLy8gZGVmYXVsdCBpbWFnZXMKCgkJCXJldHVybiBJbWFnZVV0aWxzLmdldERhdGFVUkwoIGltYWdlICk7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGltYWdlLmRhdGEgKSB7CgoJCQkJLy8gaW1hZ2VzIG9mIERhdGFUZXh0dXJlCgoJCQkJcmV0dXJuIHsKCQkJCQlkYXRhOiBBcnJheS5mcm9tKCBpbWFnZS5kYXRhICksCgkJCQkJd2lkdGg6IGltYWdlLndpZHRoLAoJCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0LAoJCQkJCXR5cGU6IGltYWdlLmRhdGEuY29uc3RydWN0b3IubmFtZQoJCQkJfTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVGV4dHVyZTogVW5hYmxlIHRvIHNlcmlhbGl6ZSBUZXh0dXJlLicgKTsKCQkJCXJldHVybiB7fTsKCgkJCX0KCgkJfQoKCX0KCglsZXQgX3RleHR1cmVJZCA9IDA7CgoJY29uc3QgX3RlbXBWZWMzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCS8qKgoJICogQmFzZSBjbGFzcyBmb3IgYWxsIHRleHR1cmVzLgoJICoKCSAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIHRleHR1cmUsIGl0cyBkaW1lbnNpb25zLCBmb3JtYXQsIGFuZCB0eXBlCgkgKiBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwgY2FsbCB7QGxpbmsgVGV4dHVyZSNkaXNwb3NlfSBvbiB0aGUgdGV4dHVyZSBhbmQgaW5zdGFudGlhdGUgYSBuZXcgb25lLgoJICoKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqLwoJY2xhc3MgVGV4dHVyZSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7P09iamVjdH0gW2ltYWdlPVRleHR1cmUuREVGQVVMVF9JTUFHRV0gLSBUaGUgaW1hZ2UgaG9sZGluZyB0aGUgdGV4dHVyZSBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBpbWFnZSA9IFRleHR1cmUuREVGQVVMVF9JTUFHRSwgbWFwcGluZyA9IFRleHR1cmUuREVGQVVMVF9NQVBQSU5HLCB3cmFwUyA9IENsYW1wVG9FZGdlV3JhcHBpbmcsIHdyYXBUID0gQ2xhbXBUb0VkZ2VXcmFwcGluZywgbWFnRmlsdGVyID0gTGluZWFyRmlsdGVyLCBtaW5GaWx0ZXIgPSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsIGZvcm1hdCA9IFJHQkFGb3JtYXQsIHR5cGUgPSBVbnNpZ25lZEJ5dGVUeXBlLCBhbmlzb3Ryb3B5ID0gVGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFksIGNvbG9yU3BhY2UgPSBOb0NvbG9yU3BhY2UgKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgSUQgb2YgdGhlIHRleHR1cmUuCgkJCSAqCgkJCSAqIEBuYW1lIFRleHR1cmUjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF90ZXh0dXJlSWQgKysgfSApOwoKCQkJLyoqCgkJCSAqIFRoZSBVVUlEIG9mIHRoZSBtYXRlcmlhbC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgbmFtZSBvZiB0aGUgbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqLwoJCQl0aGlzLm5hbWUgPSAnJzsKCgkJCS8qKgoJCQkgKiBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4gQSByZWZlcmVuY2UgdG8gdGhlIGRhdGEgc291cmNlIGNhbiBiZQoJCQkgKiBzaGFyZWQgYWNyb3NzIHRleHR1cmVzLiBUaGlzIGlzIG9mdGVuIHVzZWZ1bCBpbiBjb250ZXh0IG9mIHNwcml0ZXNoZWV0cwoJCQkgKiB3aGVyZSBtdWx0aXBsZSB0ZXh0dXJlcyByZW5kZXIgdGhlIHNhbWUgZGF0YSBidXQgd2l0aCBkaWZmZXJlbnQgdGV4dHVyZQoJCQkgKiB0cmFuc2Zvcm1hdGlvbnMuCgkJCSAqCgkJCSAqIEB0eXBlIHtTb3VyY2V9CgkJCSAqLwoJCQl0aGlzLnNvdXJjZSA9IG5ldyBTb3VyY2UoIGltYWdlICk7CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB1c2VyLWRlZmluZWQgbWlwbWFwcy4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PE9iamVjdD59CgkJCSAqLwoJCQl0aGlzLm1pcG1hcHMgPSBbXTsKCgkJCS8qKgoJCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgYXBwbGllZCB0byB0aGUgb2JqZWN0LiBUaGUgdmFsdWUgYFVWTWFwcGluZ2AKCQkJICogaXMgdGhlIGRlZmF1bHQsIHdoZXJlIHRleHR1cmUgb3IgdXYgY29vcmRpbmF0ZXMgYXJlIHVzZWQgdG8gYXBwbHkgdGhlIG1hcC4KCQkJICoKCQkJICogQHR5cGUgeyhVVk1hcHBpbmd8Q3ViZVJlZmxlY3Rpb25NYXBwaW5nfEN1YmVSZWZyYWN0aW9uTWFwcGluZ3xFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZ3xFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZ3xDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IFVWTWFwcGluZwoJCQkqLwoJCQl0aGlzLm1hcHBpbmcgPSBtYXBwaW5nOwoKCQkJLyoqCgkJCSAqIExldHMgeW91IHNlbGVjdCB0aGUgdXYgYXR0cmlidXRlIHRvIG1hcCB0aGUgdGV4dHVyZSB0by4gYDBgIGZvciBgdXZgLAoJCQkgKiBgMWAgZm9yIGB1djFgLCBgMmAgZm9yIGB1djJgIGFuZCBgM2AgZm9yIGB1djNgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmNoYW5uZWwgPSAwOwoKCQkJLyoqCgkJCSAqIFRoaXMgZGVmaW5lcyBob3cgdGhlIHRleHR1cmUgaXMgd3JhcHBlZCBob3Jpem9udGFsbHkgYW5kIGNvcnJlc3BvbmRzIHRvCgkJCSAqICpVKiBpbiBVViBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKCQkJICovCgkJCXRoaXMud3JhcFMgPSB3cmFwUzsKCgkJCS8qKgoJCQkgKiBUaGlzIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGlzIHdyYXBwZWQgaG9yaXpvbnRhbGx5IGFuZCBjb3JyZXNwb25kcyB0bwoJCQkgKiAqViogaW4gVVYgbWFwcGluZy4KCQkJICoKCQkJICogQHR5cGUgeyhSZXBlYXRXcmFwcGluZ3xDbGFtcFRvRWRnZVdyYXBwaW5nfE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcpfQoJCQkgKiBAZGVmYXVsdCBDbGFtcFRvRWRnZVdyYXBwaW5nCgkJCSAqLwoJCQl0aGlzLndyYXBUID0gd3JhcFQ7CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBMaW5lYXJGaWx0ZXIKCQkJICovCgkJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyOwoKCQkJLyoqCgkJCSAqIEhvdyB0aGUgdGV4dHVyZSBpcyBzYW1wbGVkIHdoZW4gYSB0ZXhlbCBjb3ZlcnMgbGVzcyB0aGFuIG9uZSBwaXhlbC4KCQkJICoKCQkJICogQHR5cGUgeyhOZWFyZXN0RmlsdGVyfE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyfE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXJ8TGluZWFyRmlsdGVyfExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXJ8TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyKX0KCQkJICogQGRlZmF1bHQgTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlcjsKCgkJCS8qKgoJCQkgKiBUaGUgbnVtYmVyIG9mIHNhbXBsZXMgdGFrZW4gYWxvbmcgdGhlIGF4aXMgdGhyb3VnaCB0aGUgcGl4ZWwgdGhhdCBoYXMgdGhlCgkJCSAqIGhpZ2hlc3QgZGVuc2l0eSBvZiB0ZXhlbHMuIEJ5IGRlZmF1bHQsIHRoaXMgdmFsdWUgaXMgYDFgLiBBIGhpZ2hlciB2YWx1ZQoJCQkgKiBnaXZlcyBhIGxlc3MgYmx1cnJ5IHJlc3VsdCB0aGFuIGEgYmFzaWMgbWlwbWFwLCBhdCB0aGUgY29zdCBvZiBtb3JlCgkJCSAqIHRleHR1cmUgc2FtcGxlcyBiZWluZyB1c2VkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmFuaXNvdHJvcHkgPSBhbmlzb3Ryb3B5OwoKCQkJLyoqCgkJCSAqIFRoZSBmb3JtYXQgb2YgdGhlIHRleHR1cmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IFJHQkFGb3JtYXQKCQkJICovCgkJCXRoaXMuZm9ybWF0ID0gZm9ybWF0OwoKCQkJLyoqCgkJCSAqIFRoZSBkZWZhdWx0IGludGVybmFsIGZvcm1hdCBpcyBkZXJpdmVkIGZyb20ge0BsaW5rIFRleHR1cmUjZm9ybWF0fSBhbmQge0BsaW5rIFRleHR1cmUjdHlwZX0gYW5kCgkJCSAqIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGRhdGEgaXMgZ29pbmcgdG8gYmUgc3RvcmVkIG9uIHRoZSBHUFUuCgkJCSAqCgkJCSAqIFRoaXMgcHJvcGVydHkgYWxsb3dzIHRvIG92ZXJ3cml0ZSB0aGUgZGVmYXVsdCBmb3JtYXQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/c3RyaW5nfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmludGVybmFsRm9ybWF0ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBUaGUgZGF0YSB0eXBlIG9mIHRoZSB0ZXh0dXJlLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCBVbnNpZ25lZEJ5dGVUeXBlCgkJCSAqLwoJCQl0aGlzLnR5cGUgPSB0eXBlOwoKCQkJLyoqCgkJCSAqIEhvdyBtdWNoIGEgc2luZ2xlIHJlcGV0aXRpb24gb2YgdGhlIHRleHR1cmUgaXMgb2Zmc2V0IGZyb20gdGhlIGJlZ2lubmluZywKCQkJICogaW4gZWFjaCBkaXJlY3Rpb24gVSBhbmQgVi4gVHlwaWNhbCByYW5nZSBpcyBgMC4wYCB0byBgMS4wYC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjJ9CgkJCSAqIEBkZWZhdWx0ICgwLDApCgkJCSAqLwoJCQl0aGlzLm9mZnNldCA9IG5ldyBWZWN0b3IyKCAwLCAwICk7CgoJCQkvKioKCQkJICogSG93IG1hbnkgdGltZXMgdGhlIHRleHR1cmUgaXMgcmVwZWF0ZWQgYWNyb3NzIHRoZSBzdXJmYWNlLCBpbiBlYWNoCgkJCSAqIGRpcmVjdGlvbiBVIGFuZCBWLiBJZiByZXBlYXQgaXMgc2V0IGdyZWF0ZXIgdGhhbiBgMWAgaW4gZWl0aGVyIGRpcmVjdGlvbiwKCQkJICogdGhlIGNvcnJlc3BvbmRpbmcgd3JhcCBwYXJhbWV0ZXIgc2hvdWxkIGFsc28gYmUgc2V0IHRvIGBSZXBlYXRXcmFwcGluZ2AKCQkJICogb3IgYE1pcnJvcmVkUmVwZWF0V3JhcHBpbmdgIHRvIGFjaGlldmUgdGhlIGRlc2lyZWQgdGlsaW5nIGVmZmVjdC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjJ9CgkJCSAqIEBkZWZhdWx0ICgxLDEpCgkJCSAqLwoJCQl0aGlzLnJlcGVhdCA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgoJCQkvKioKCQkJICogVGhlIHBvaW50IGFyb3VuZCB3aGljaCByb3RhdGlvbiBvY2N1cnMuIEEgdmFsdWUgb2YgYCgwLjUsIDAuNSlgIGNvcnJlc3BvbmRzCgkJCSAqIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHRleHR1cmUuIERlZmF1bHQgaXMgYCgwLCAwKWAsIHRoZSBsb3dlciBsZWZ0LgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yMn0KCQkJICogQGRlZmF1bHQgKDAsMCkKCQkJICovCgkJCXRoaXMuY2VudGVyID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsKCgkJCS8qKgoJCQkgKiBIb3cgbXVjaCB0aGUgdGV4dHVyZSBpcyByb3RhdGVkIGFyb3VuZCB0aGUgY2VudGVyIHBvaW50LCBpbiByYWRpYW5zLgoJCQkgKiBQb3NpdGl2ZSB2YWx1ZXMgYXJlIGNvdW50ZXItY2xvY2t3aXNlLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLnJvdGF0aW9uID0gMDsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRvIHVwZGF0ZSB0aGUgdGV4dHVyZSdzIHV2LXRyYW5zZm9ybWF0aW9uIHtAbGluayBUZXh0dXJlI21hdHJpeH0KCQkJICogZnJvbSB0aGUgcHJvcGVydGllcyB7QGxpbmsgVGV4dHVyZSNvZmZzZXR9LCB7QGxpbmsgVGV4dHVyZSNyZXBlYXR9LAoJCQkgKiB7QGxpbmsgVGV4dHVyZSNyb3RhdGlvbn0sIGFuZCB7QGxpbmsgVGV4dHVyZSNjZW50ZXJ9LgoJCQkgKgoJCQkgKiBTZXQgdGhpcyB0byBgZmFsc2VgIGlmIHlvdSBhcmUgc3BlY2lmeWluZyB0aGUgdXYtdHJhbnNmb3JtIG1hdHJpeCBkaXJlY3RseS4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIHV2LXRyYW5zZm9ybWF0aW9uIG1hdHJpeCBvZiB0aGUgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge01hdHJpeDN9CgkJCSAqLwoJCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KCQkJICoKCQkJICogU2V0IHRoaXMgdG8gYGZhbHNlYCBpZiB5b3UgYXJlIGNyZWF0aW5nIG1pcG1hcHMgbWFudWFsbHkuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHRydWU7CgoJCQkvKioKCQkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIGFscGhhIGNoYW5uZWwsIGlmIHByZXNlbnQsIGlzIG11bHRpcGxpZWQgaW50byB0aGUKCQkJICogY29sb3IgY2hhbm5lbHMgd2hlbiB0aGUgdGV4dHVyZSBpcyB1cGxvYWRlZCB0byB0aGUgR1BVLgoJCQkgKgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwcm9wZXJ0eSBoYXMgbm8gZWZmZWN0IHdoZW4gdXNpbmcgYEltYWdlQml0bWFwYC4gWW91IG5lZWQgdG8KCQkJICogY29uZmlndXJlIHByZW11bHRpcGx5IGFscGhhIG9uIGJpdG1hcCBjcmVhdGlvbiBpbnN0ZWFkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSB0ZXh0dXJlIGlzIGZsaXBwZWQgYWxvbmcgdGhlIHZlcnRpY2FsIGF4aXMgd2hlbgoJCQkgKiB1cGxvYWRlZCB0byB0aGUgR1BVLgoJCQkgKgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwcm9wZXJ0eSBoYXMgbm8gZWZmZWN0IHdoZW4gdXNpbmcgYEltYWdlQml0bWFwYC4gWW91IG5lZWQgdG8KCQkJICogY29uZmlndXJlIHRoZSBmbGlwIG9uIGJpdG1hcCBjcmVhdGlvbiBpbnN0ZWFkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5mbGlwWSA9IHRydWU7CgoJCQkvKioKCQkJICogU3BlY2lmaWVzIHRoZSBhbGlnbm1lbnQgcmVxdWlyZW1lbnRzIGZvciB0aGUgc3RhcnQgb2YgZWFjaCBwaXhlbCByb3cgaW4gbWVtb3J5LgoJCQkgKiBUaGUgYWxsb3dhYmxlIHZhbHVlcyBhcmUgYDFgIChieXRlLWFsaWdubWVudCksIGAyYCAocm93cyBhbGlnbmVkIHRvIGV2ZW4tbnVtYmVyZWQgYnl0ZXMpLAoJCQkgKiBgNGAgKHdvcmQtYWxpZ25tZW50KSwgYW5kIGA4YCAocm93cyBzdGFydCBvbiBkb3VibGUtd29yZCBib3VuZGFyaWVzKS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgNAoJCQkgKi8KCQkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSA0OwkvLyB2YWxpZCB2YWx1ZXM6IDEsIDIsIDQsIDggKHNlZSBodHRwOi8vd3d3Lmtocm9ub3Mub3JnL29wZW5nbGVzL3Nkay9kb2NzL21hbi94aHRtbC9nbFBpeGVsU3RvcmVpLnhtbCkKCgkJCS8qKgoJCQkgKiBUZXh0dXJlcyBjb250YWluaW5nIGNvbG9yIGRhdGEgc2hvdWxkIGJlIGFubm90YXRlZCB3aXRoIGBTUkdCQ29sb3JTcGFjZWAgb3IgYExpbmVhclNSR0JDb2xvclNwYWNlYC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQGRlZmF1bHQgTm9Db2xvclNwYWNlCgkJCSAqLwoJCQl0aGlzLmNvbG9yU3BhY2UgPSBjb2xvclNwYWNlOwoKCQkJLyoqCgkJCSAqIEFuIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIHN0b3JlIGN1c3RvbSBkYXRhIGFib3V0IHRoZSB0ZXh0dXJlLiBJdAoJCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkgKi8KCQkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCQkJLyoqCgkJCSAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gb25seSB1cGRhdGUgYSBzdWJyZWdpb24gb3Igc3BlY2lmaWMgcm93cyBvZiB0aGUgdGV4dHVyZSAoZm9yIGV4YW1wbGUsIGp1c3QgdGhlCgkJCSAqIGZpcnN0IDMgcm93cykuIFVzZSB0aGUgYGFkZFVwZGF0ZVJhbmdlKClgIGZ1bmN0aW9uIHRvIGFkZCByYW5nZXMgdG8gdGhpcyBhcnJheS4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PE9iamVjdD59CgkJCSAqLwoJCQl0aGlzLnVwZGF0ZVJhbmdlcyA9IFtdOwoKCQkJLyoqCgkJCSAqIFRoaXMgc3RhcnRzIGF0IGAwYCBhbmQgY291bnRzIGhvdyBtYW55IHRpbWVzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy52ZXJzaW9uID0gMDsKCgkJCS8qKgoJCQkgKiBBIGNhbGxiYWNrIGZ1bmN0aW9uLCBjYWxsZWQgd2hlbiB0aGUgdGV4dHVyZSBpcyB1cGRhdGVkIChlLmcuLCB3aGVuCgkJCSAqIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBoYXMgYmVlbiBzZXQgdG8gdHJ1ZSBhbmQgdGhlbiB0aGUgdGV4dHVyZSBpcyB1c2VkKS4KCQkJICoKCQkJICogQHR5cGUgez9GdW5jdGlvbn0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5vblVwZGF0ZSA9IG51bGw7CgoJCQkvKioKCQkJICogQW4gb3B0aW9uYWwgYmFjayByZWZlcmVuY2UgdG8gdGhlIHRleHR1cmVzIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KFJlbmRlclRhcmdldHxXZWJHTFJlbmRlclRhcmdldCl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMucmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBJbmRpY2F0ZXMgd2hldGhlciBhIHRleHR1cmUgYmVsb25ncyB0byBhIHJlbmRlciB0YXJnZXQgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIEluZGljYXRlcyBpZiBhIHRleHR1cmUgc2hvdWxkIGJlIGhhbmRsZWQgbGlrZSBhIHRleHR1cmUgYXJyYXkuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuaXNBcnJheVRleHR1cmUgPSBpbWFnZSAmJiBpbWFnZS5kZXB0aCAmJiBpbWFnZS5kZXB0aCA+IDEgPyB0cnVlIDogZmFsc2U7CgoJCQkvKioKCQkJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhpcyB0ZXh0dXJlIHNob3VsZCBiZSBwcm9jZXNzZWQgYnkgYFBNUkVNR2VuZXJhdG9yYCBvciBub3QKCQkJICogKG9ubHkgcmVsZXZhbnQgZm9yIHJlbmRlciB0YXJnZXQgdGV4dHVyZXMpLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5wbXJlbVZlcnNpb24gPSAwOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCgkJICovCgkJZ2V0IHdpZHRoKCkgewoKCQkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLng7CgoJCX0KCgkJLyoqCgkJICogVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCgkJICovCgkJZ2V0IGhlaWdodCgpIHsKCgkJCXJldHVybiB0aGlzLnNvdXJjZS5nZXRTaXplKCBfdGVtcFZlYzMgKS55OwoKCQl9CgoJCS8qKgoJCSAqIFRoZSBkZXB0aCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCgkJICovCgkJZ2V0IGRlcHRoKCkgewoKCQkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLno7CgoJCX0KCgkJLyoqCgkJICogVGhlIGltYWdlIG9iamVjdCBob2xkaW5nIHRoZSB0ZXh0dXJlIGRhdGEuCgkJICoKCQkgKiBAdHlwZSB7P09iamVjdH0KCQkgKi8KCQlnZXQgaW1hZ2UoKSB7CgoJCQlyZXR1cm4gdGhpcy5zb3VyY2UuZGF0YTsKCgkJfQoKCQlzZXQgaW1hZ2UoIHZhbHVlID0gbnVsbCApIHsKCgkJCXRoaXMuc291cmNlLmRhdGEgPSB2YWx1ZTsKCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSB0ZXh0dXJlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBmcm9tIHRoZSBmcm9tIHRoZSBwcm9wZXJ0aWVzIHtAbGluayBUZXh0dXJlI29mZnNldH0sCgkJICoge0BsaW5rIFRleHR1cmUjcmVwZWF0fSwge0BsaW5rIFRleHR1cmUjcm90YXRpb259LCBhbmQge0BsaW5rIFRleHR1cmUjY2VudGVyfS4KCQkgKi8KCQl1cGRhdGVNYXRyaXgoKSB7CgoJCQl0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSggdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSwgdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueSwgdGhpcy5yb3RhdGlvbiwgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSApOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgYSByYW5nZSBvZiBkYXRhIGluIHRoZSBkYXRhIHRleHR1cmUgdG8gYmUgdXBkYXRlZCBvbiB0aGUgR1BVLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gUG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgdXBkYXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIFRoZSBudW1iZXIgb2YgY29tcG9uZW50cyB0byB1cGRhdGUuCgkJICovCgkJYWRkVXBkYXRlUmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCgkJfQoKCQkvKioKCQkgKiBDbGVhcnMgdGhlIHVwZGF0ZSByYW5nZXMuCgkJICovCgkJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgoJCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgdGV4dHVyZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7VGV4dHVyZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB0ZXh0dXJlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1RleHR1cmV9IHNvdXJjZSAtIFRoZSB0ZXh0dXJlIHRvIGNvcHkuCgkJICogQHJldHVybiB7VGV4dHVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljb3B5KCBzb3VyY2UgKSB7CgoJCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCgkJCXRoaXMuc291cmNlID0gc291cmNlLnNvdXJjZTsKCQkJdGhpcy5taXBtYXBzID0gc291cmNlLm1pcG1hcHMuc2xpY2UoIDAgKTsKCgkJCXRoaXMubWFwcGluZyA9IHNvdXJjZS5tYXBwaW5nOwoJCQl0aGlzLmNoYW5uZWwgPSBzb3VyY2UuY2hhbm5lbDsKCgkJCXRoaXMud3JhcFMgPSBzb3VyY2Uud3JhcFM7CgkJCXRoaXMud3JhcFQgPSBzb3VyY2Uud3JhcFQ7CgoJCQl0aGlzLm1hZ0ZpbHRlciA9IHNvdXJjZS5tYWdGaWx0ZXI7CgkJCXRoaXMubWluRmlsdGVyID0gc291cmNlLm1pbkZpbHRlcjsKCgkJCXRoaXMuYW5pc290cm9weSA9IHNvdXJjZS5hbmlzb3Ryb3B5OwoKCQkJdGhpcy5mb3JtYXQgPSBzb3VyY2UuZm9ybWF0OwoJCQl0aGlzLmludGVybmFsRm9ybWF0ID0gc291cmNlLmludGVybmFsRm9ybWF0OwoJCQl0aGlzLnR5cGUgPSBzb3VyY2UudHlwZTsKCgkJCXRoaXMub2Zmc2V0LmNvcHkoIHNvdXJjZS5vZmZzZXQgKTsKCQkJdGhpcy5yZXBlYXQuY29weSggc291cmNlLnJlcGVhdCApOwoJCQl0aGlzLmNlbnRlci5jb3B5KCBzb3VyY2UuY2VudGVyICk7CgkJCXRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCQkJdGhpcy5tYXRyaXguY29weSggc291cmNlLm1hdHJpeCApOwoKCQkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBzb3VyY2UuZ2VuZXJhdGVNaXBtYXBzOwoJCQl0aGlzLnByZW11bHRpcGx5QWxwaGEgPSBzb3VyY2UucHJlbXVsdGlwbHlBbHBoYTsKCQkJdGhpcy5mbGlwWSA9IHNvdXJjZS5mbGlwWTsKCQkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSBzb3VyY2UudW5wYWNrQWxpZ25tZW50OwoJCQl0aGlzLmNvbG9yU3BhY2UgPSBzb3VyY2UuY29sb3JTcGFjZTsKCgkJCXRoaXMucmVuZGVyVGFyZ2V0ID0gc291cmNlLnJlbmRlclRhcmdldDsKCQkJdGhpcy5pc1JlbmRlclRhcmdldFRleHR1cmUgPSBzb3VyY2UuaXNSZW5kZXJUYXJnZXRUZXh0dXJlOwoJCQl0aGlzLmlzQXJyYXlUZXh0dXJlID0gc291cmNlLmlzQXJyYXlUZXh0dXJlOwoKCQkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdGV4dHVyZSdzIHByb3BlcnRpZXMgYmFzZWQgb24gYHZhbHVlc2AuCgkJICogQHBhcmFtIHtPYmplY3R9IHZhbHVlcyAtIEEgY29udGFpbmVyIHdpdGggdGV4dHVyZSBwYXJhbWV0ZXJzLgoJCSAqLwoJCXNldFZhbHVlcyggdmFsdWVzICkgewoKCQkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCgkJCQljb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1sga2V5IF07CgoJCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5UZXh0dXJlLnNldFZhbHVlcygpOiBwYXJhbWV0ZXIgJyR7IGtleSB9JyBoYXMgdmFsdWUgb2YgdW5kZWZpbmVkLmAgKTsKCQkJCQljb250aW51ZTsKCgkJCQl9CgoJCQkJY29uc3QgY3VycmVudFZhbHVlID0gdGhpc1sga2V5IF07CgoJCQkJaWYgKCBjdXJyZW50VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCBgVEhSRUUuVGV4dHVyZS5zZXRWYWx1ZXMoKTogcHJvcGVydHkgJyR7IGtleSB9JyBkb2VzIG5vdCBleGlzdC5gICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWlmICggKCBjdXJyZW50VmFsdWUgJiYgbmV3VmFsdWUgKSAmJiAoIGN1cnJlbnRWYWx1ZS5pc1ZlY3RvcjIgJiYgbmV3VmFsdWUuaXNWZWN0b3IyICkgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKCQkJCX0gZWxzZSBpZiAoICggY3VycmVudFZhbHVlICYmIG5ld1ZhbHVlICkgJiYgKCBjdXJyZW50VmFsdWUuaXNWZWN0b3IzICYmIG5ld1ZhbHVlLmlzVmVjdG9yMyApICkgewoKCQkJCQljdXJyZW50VmFsdWUuY29weSggbmV3VmFsdWUgKTsKCgkJCQl9IGVsc2UgaWYgKCAoIGN1cnJlbnRWYWx1ZSAmJiBuZXdWYWx1ZSApICYmICggY3VycmVudFZhbHVlLmlzTWF0cml4MyAmJiBuZXdWYWx1ZS5pc01hdHJpeDMgKSApIHsKCgkJCQkJY3VycmVudFZhbHVlLmNvcHkoIG5ld1ZhbHVlICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpc1sga2V5IF0gPSBuZXdWYWx1ZTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogU2VyaWFsaXplcyB0aGUgdGV4dHVyZSBpbnRvIEpTT04uCgkJICoKCQkgKiBAcGFyYW0gez8oT2JqZWN0fHN0cmluZyl9IG1ldGEgLSBBbiBvcHRpb25hbCB2YWx1ZSBob2xkaW5nIG1ldGEgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNlcmlhbGl6YXRpb24uCgkJICogQHJldHVybiB7T2JqZWN0fSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCB0ZXh0dXJlLgoJCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KCQkgKi8KCQl0b0pTT04oIG1ldGEgKSB7CgoJCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJCWlmICggISBpc1Jvb3RPYmplY3QgJiYgbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZXR1cm4gbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF07CgoJCQl9CgoJCQljb25zdCBvdXRwdXQgPSB7CgoJCQkJbWV0YWRhdGE6IHsKCQkJCQl2ZXJzaW9uOiA0LjcsCgkJCQkJdHlwZTogJ1RleHR1cmUnLAoJCQkJCWdlbmVyYXRvcjogJ1RleHR1cmUudG9KU09OJwoJCQkJfSwKCgkJCQl1dWlkOiB0aGlzLnV1aWQsCgkJCQluYW1lOiB0aGlzLm5hbWUsCgoJCQkJaW1hZ2U6IHRoaXMuc291cmNlLnRvSlNPTiggbWV0YSApLnV1aWQsCgoJCQkJbWFwcGluZzogdGhpcy5tYXBwaW5nLAoJCQkJY2hhbm5lbDogdGhpcy5jaGFubmVsLAoKCQkJCXJlcGVhdDogWyB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55IF0sCgkJCQlvZmZzZXQ6IFsgdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSBdLAoJCQkJY2VudGVyOiBbIHRoaXMuY2VudGVyLngsIHRoaXMuY2VudGVyLnkgXSwKCQkJCXJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAoKCQkJCXdyYXA6IFsgdGhpcy53cmFwUywgdGhpcy53cmFwVCBdLAoKCQkJCWZvcm1hdDogdGhpcy5mb3JtYXQsCgkJCQlpbnRlcm5hbEZvcm1hdDogdGhpcy5pbnRlcm5hbEZvcm1hdCwKCQkJCXR5cGU6IHRoaXMudHlwZSwKCQkJCWNvbG9yU3BhY2U6IHRoaXMuY29sb3JTcGFjZSwKCgkJCQltaW5GaWx0ZXI6IHRoaXMubWluRmlsdGVyLAoJCQkJbWFnRmlsdGVyOiB0aGlzLm1hZ0ZpbHRlciwKCQkJCWFuaXNvdHJvcHk6IHRoaXMuYW5pc290cm9weSwKCgkJCQlmbGlwWTogdGhpcy5mbGlwWSwKCgkJCQlnZW5lcmF0ZU1pcG1hcHM6IHRoaXMuZ2VuZXJhdGVNaXBtYXBzLAoJCQkJcHJlbXVsdGlwbHlBbHBoYTogdGhpcy5wcmVtdWx0aXBseUFscGhhLAoJCQkJdW5wYWNrQWxpZ25tZW50OiB0aGlzLnVucGFja0FsaWdubWVudAoKCQkJfTsKCgkJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb3V0cHV0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgoJCQkJbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gPSBvdXRwdXQ7CgoJCQl9CgoJCQlyZXR1cm4gb3V0cHV0OwoKCQl9CgoJCS8qKgoJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwoJCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgoJCSAqCgkJICogQGZpcmVzIFRleHR1cmUjZGlzcG9zZQoJCSAqLwoJCWRpc3Bvc2UoKSB7CgoJCQkvKioKCQkJICogRmlyZXMgd2hlbiB0aGUgdGV4dHVyZSBoYXMgYmVlbiBkaXNwb3NlZCBvZi4KCQkJICoKCQkJICogQGV2ZW50IFRleHR1cmUjZGlzcG9zZQoJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkgKi8KCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJCX0KCgkJLyoqCgkJICogVHJhbnNmb3JtcyB0aGUgZ2l2ZW4gdXYgdmVjdG9yIHdpdGggdGhlIHRleHR1cmVzIHV2IHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdXYgLSBUaGUgdXYgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IFRoZSB0cmFuc2Zvcm1lZCB1diB2ZWN0b3IuCgkJICovCgkJdHJhbnNmb3JtVXYoIHV2ICkgewoKCQkJaWYgKCB0aGlzLm1hcHBpbmcgIT09IFVWTWFwcGluZyApIHJldHVybiB1djsKCgkJCXV2LmFwcGx5TWF0cml4MyggdGhpcy5tYXRyaXggKTsKCgkJCWlmICggdXYueCA8IDAgfHwgdXYueCA+IDEgKSB7CgoJCQkJc3dpdGNoICggdGhpcy53cmFwUyApIHsKCgkJCQkJY2FzZSBSZXBlYXRXcmFwcGluZzoKCgkJCQkJCXV2LnggPSB1di54IC0gTWF0aC5mbG9vciggdXYueCApOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBDbGFtcFRvRWRnZVdyYXBwaW5nOgoKCQkJCQkJdXYueCA9IHV2LnggPCAwID8gMCA6IDE7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6CgoJCQkJCQlpZiAoIE1hdGguYWJzKCBNYXRoLmZsb29yKCB1di54ICkgJSAyICkgPT09IDEgKSB7CgoJCQkJCQkJdXYueCA9IE1hdGguY2VpbCggdXYueCApIC0gdXYueDsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJdXYueCA9IHV2LnggLSBNYXRoLmZsb29yKCB1di54ICk7CgoJCQkJCQl9CgoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHV2LnkgPCAwIHx8IHV2LnkgPiAxICkgewoKCQkJCXN3aXRjaCAoIHRoaXMud3JhcFQgKSB7CgoJCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgoJCQkJCQl1di55ID0gdXYueSAtIE1hdGguZmxvb3IoIHV2LnkgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCgkJCQkJCXV2LnkgPSB1di55IDwgMCA/IDAgOiAxOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKCQkJCQkJaWYgKCBNYXRoLmFicyggTWF0aC5mbG9vciggdXYueSApICUgMiApID09PSAxICkgewoKCQkJCQkJCXV2LnkgPSBNYXRoLmNlaWwoIHV2LnkgKSAtIHV2Lnk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXV2LnkgPSB1di55IC0gTWF0aC5mbG9vciggdXYueSApOwoKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLmZsaXBZICkgewoKCQkJCXV2LnkgPSAxIC0gdXYueTsKCgkJCX0KCgkJCXJldHVybiB1djsKCgkJfQoKCQkvKioKCQkgKiBTZXR0aW5nIHRoaXMgcHJvcGVydHkgdG8gYHRydWVgIGluZGljYXRlcyB0aGUgZW5naW5lIHRoZSB0ZXh0dXJlCgkJICogbXVzdCBiZSB1cGRhdGVkIGluIHRoZSBuZXh0IHJlbmRlci4gVGhpcyB0cmlnZ2VycyBhIHRleHR1cmUgdXBsb2FkCgkJICogdG8gdGhlIEdQVSBhbmQgZW5zdXJlcyBjb3JyZWN0IHRleHR1cmUgcGFyYW1ldGVyIGNvbmZpZ3VyYXRpb24uCgkJICoKCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkgKiBAZGVmYXVsdCBmYWxzZQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKCQkgKi8KCQlzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCgkJCQl0aGlzLnZlcnNpb24gKys7CgkJCQl0aGlzLnNvdXJjZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogU2V0dGluZyB0aGlzIHByb3BlcnR5IHRvIGB0cnVlYCBpbmRpY2F0ZXMgdGhlIGVuZ2luZSB0aGUgUE1SRU0KCQkgKiBtdXN0IGJlIHJlZ2VuZXJhdGVkLgoJCSAqCgkJICogQHR5cGUge2Jvb2xlYW59CgkJICogQGRlZmF1bHQgZmFsc2UKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCgkJICovCgkJc2V0IG5lZWRzUE1SRU1VcGRhdGUoIHZhbHVlICkgewoKCQkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCgkJCQl0aGlzLnBtcmVtVmVyc2lvbiArKzsKCgkJCX0KCgkJfQoKCX0KCgkvKioKCSAqIFRoZSBkZWZhdWx0IGltYWdlIGZvciBhbGwgdGV4dHVyZXMuCgkgKgoJICogQHN0YXRpYwoJICogQHR5cGUgez9JbWFnZX0KCSAqIEBkZWZhdWx0IG51bGwKCSAqLwoJVGV4dHVyZS5ERUZBVUxUX0lNQUdFID0gbnVsbDsKCgkvKioKCSAqIFRoZSBkZWZhdWx0IG1hcHBpbmcgZm9yIGFsbCB0ZXh0dXJlcy4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGRlZmF1bHQgVVZNYXBwaW5nCgkgKi8KCVRleHR1cmUuREVGQVVMVF9NQVBQSU5HID0gVVZNYXBwaW5nOwoKCS8qKgoJICogVGhlIGRlZmF1bHQgYW5pc290cm9weSB2YWx1ZSBmb3IgYWxsIHRleHR1cmVzLgoJICoKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAZGVmYXVsdCAxCgkgKi8KCVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZID0gMTsKCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIDREIHZlY3Rvci4gQSA0RCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCBxdWFkcnVwbGV0IG9mIG51bWJlcnMKCSAqIChsYWJlbGVkIHgsIHksIHogYW5kIHcpLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgoJICoKCSAqIC0gQSBwb2ludCBpbiA0RCBzcGFjZS4KCSAqIC0gQSBkaXJlY3Rpb24gYW5kIGxlbmd0aCBpbiA0RCBzcGFjZS4gSW4gdGhyZWUuanMgdGhlIGxlbmd0aCB3aWxsCgkgKiBhbHdheXMgYmUgdGhlIEV1Y2xpZGVhbiBkaXN0YW5jZShzdHJhaWdodC1saW5lIGRpc3RhbmNlKSBmcm9tIGAoMCwgMCwgMCwgMClgIHRvIGAoeCwgeSwgeiwgdylgCgkgKiBhbmQgdGhlIGRpcmVjdGlvbiBpcyBhbHNvIG1lYXN1cmVkIGZyb20gYCgwLCAwLCAwLCAwKWAgdG93YXJkcyBgKHgsIHksIHosIHcpYC4KCSAqIC0gQW55IGFyYml0cmFyeSBvcmRlcmVkIHF1YWRydXBsZXQgb2YgbnVtYmVycy4KCSAqCgkgKiBUaGVyZSBhcmUgb3RoZXIgdGhpbmdzIGEgNEQgdmVjdG9yIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCwgaG93ZXZlciB0aGVzZQoJICogYXJlIHRoZSBtb3N0IGNvbW1vbiB1c2VzIGluICp0aHJlZS5qcyouCgkgKgoJICogSXRlcmF0aW5nIHRocm91Z2ggYSB2ZWN0b3IgaW5zdGFuY2Ugd2lsbCB5aWVsZCBpdHMgY29tcG9uZW50cyBgKHgsIHksIHosIHcpYCBpbgoJICogdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCgkgKiBgYGBqcwoJICogY29uc3QgYSA9IG5ldyBUSFJFRS5WZWN0b3I0KCAwLCAxLCAwLCAwICk7CgkgKgoJICogLy9ubyBhcmd1bWVudHM7IHdpbGwgYmUgaW5pdGlhbGlzZWQgdG8gKDAsIDAsIDAsIDEpCgkgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjQoICk7CgkgKgoJICogY29uc3QgZCA9IGEuZG90KCBiICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgVmVjdG9yNCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgNEQgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3PTFdIC0gVGhlIHcgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCVZlY3RvcjQucHJvdG90eXBlLmlzVmVjdG9yNCA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnggPSB4OwoKCQkJLyoqCgkJCSAqIFRoZSB5IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy55ID0geTsKCgkJCS8qKgoJCQkgKiBUaGUgeiB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMueiA9IHo7CgoJCQkvKioKCQkJICogVGhlIHcgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLncgPSB3OwoKCQl9CgoJCS8qKgoJCSAqIEFsaWFzIGZvciB7QGxpbmsgVmVjdG9yNCN6fS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICovCgkJZ2V0IHdpZHRoKCkgewoKCQkJcmV0dXJuIHRoaXMuejsKCgkJfQoKCQlzZXQgd2lkdGgoIHZhbHVlICkgewoKCQkJdGhpcy56ID0gdmFsdWU7CgoJCX0KCgkJLyoqCgkJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3I0I3d9LgoJCSAqCgkJICogQHR5cGUge251bWJlcn0KCQkgKi8KCQlnZXQgaGVpZ2h0KCkgewoKCQkJcmV0dXJuIHRoaXMudzsKCgkJfQoKCQlzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCgkJCXRoaXMudyA9IHZhbHVlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBvZiB0aGUgeiBjb21wb25lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgb2YgdGhlIHcgY29tcG9uZW50LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldCggeCwgeSwgeiwgdyApIHsKCgkJCXRoaXMueCA9IHg7CgkJCXRoaXMueSA9IHk7CgkJCXRoaXMueiA9IHo7CgkJCXRoaXMudyA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2FtZSB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgdmFsdWUgdG8gc2V0IGZvciBhbGwgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnggPSBzY2FsYXI7CgkJCXRoaXMueSA9IHNjYWxhcjsKCQkJdGhpcy56ID0gc2NhbGFyOwoJCQl0aGlzLncgPSBzY2FsYXI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB4IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRYKCB4ICkgewoKCQkJdGhpcy54ID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvcidzIHkgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFkoIHkgKSB7CgoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yJ3MgeiBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0WiggeiApIHsKCgkJCXRoaXMueiA9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB3IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRXKCB3ICkgewoKCQkJdGhpcy53ID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFsbG93cyB0byBzZXQgYSB2ZWN0b3IgY29tcG9uZW50IHdpdGggYW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwKCQkgKiBgMmAgZXF1YWxzIHRvIHosIGAzYCBlcXVhbHMgdG8gdy4KCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldENvbXBvbmVudCggaW5kZXgsIHZhbHVlICkgewoKCQkJc3dpdGNoICggaW5kZXggKSB7CgoJCQkJY2FzZSAwOiB0aGlzLnggPSB2YWx1ZTsgYnJlYWs7CgkJCQljYXNlIDE6IHRoaXMueSA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMjogdGhpcy56ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAzOiB0aGlzLncgPSB2YWx1ZTsgYnJlYWs7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwKCQkgKiBgMmAgZXF1YWxzIHRvIHosIGAzYCBlcXVhbHMgdG8gdy4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IEEgdmVjdG9yIGNvbXBvbmVudCB2YWx1ZS4KCQkgKi8KCQlnZXRDb21wb25lbnQoIGluZGV4ICkgewoKCQkJc3dpdGNoICggaW5kZXggKSB7CgoJCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwoJCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQkJY2FzZSAyOiByZXR1cm4gdGhpcy56OwoJCQkJY2FzZSAzOiByZXR1cm4gdGhpcy53OwoJCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IHZlY3RvciB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN8VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljb3B5KCB2ICkgewoKCQkJdGhpcy54ID0gdi54OwoJCQl0aGlzLnkgPSB2Lnk7CgkJCXRoaXMueiA9IHYuejsKCQkJdGhpcy53ID0gKCB2LncgIT09IHVuZGVmaW5lZCApID8gdi53IDogMTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBhZGQuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJYWRkKCB2ICkgewoKCQkJdGhpcy54ICs9IHYueDsKCQkJdGhpcy55ICs9IHYueTsKCQkJdGhpcy56ICs9IHYuejsKCQkJdGhpcy53ICs9IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB0byBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIGFkZC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGRTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnggKz0gczsKCQkJdGhpcy55ICs9IHM7CgkJCXRoaXMueiArPSBzOwoJCQl0aGlzLncgKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKyBiLng7CgkJCXRoaXMueSA9IGEueSArIGIueTsKCQkJdGhpcy56ID0gYS56ICsgYi56OwoJCQl0aGlzLncgPSBhLncgKyBiLnc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3Igc2NhbGVkIGJ5IHRoZSBnaXZlbiBmYWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgZmFjdG9yIHRoYXQgc2NhbGVzIGB2YC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgoJCQl0aGlzLnggKz0gdi54ICogczsKCQkJdGhpcy55ICs9IHYueSAqIHM7CgkJCXRoaXMueiArPSB2LnogKiBzOwoJCQl0aGlzLncgKz0gdi53ICogczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gc3VidHJhY3QuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc3ViKCB2ICkgewoKCQkJdGhpcy54IC09IHYueDsKCQkJdGhpcy55IC09IHYueTsKCQkJdGhpcy56IC09IHYuejsKCQkJdGhpcy53IC09IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIGZyb20gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBzdWJ0cmFjdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzdWJTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnggLT0gczsKCQkJdGhpcy55IC09IHM7CgkJCXRoaXMueiAtPSBzOwoJCQl0aGlzLncgLT0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCgkJICogQHBhcmFtIHtWZWN0b3I0fSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc3ViVmVjdG9ycyggYSwgYiApIHsKCgkJCXRoaXMueCA9IGEueCAtIGIueDsKCQkJdGhpcy55ID0gYS55IC0gYi55OwoJCQl0aGlzLnogPSBhLnogLSBiLno7CgkJCXRoaXMudyA9IGEudyAtIGIudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIG11bHRpcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW11bHRpcGx5KCB2ICkgewoKCQkJdGhpcy54ICo9IHYueDsKCQkJdGhpcy55ICo9IHYueTsKCQkJdGhpcy56ICo9IHYuejsKCQkJdGhpcy53ICo9IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ICo9IHNjYWxhcjsKCQkJdGhpcy55ICo9IHNjYWxhcjsKCQkJdGhpcy56ICo9IHNjYWxhcjsKCQkJdGhpcy53ICo9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbSApIHsKCgkJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLnosIHcgPSB0aGlzLnc7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6ICsgZVsgMTIgXSAqIHc7CgkJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogeiArIGVbIDEzIF0gKiB3OwoJCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSAqIHc7CgkJCXRoaXMudyA9IGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICogdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZGl2aWRlKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCQkJdGhpcy56IC89IHYuejsKCQkJdGhpcy53IC89IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgeCwgeSBhbmQgeiBjb21wb25lbnRzIG9mIHRoaXMKCQkgKiB2ZWN0b3IgdG8gdGhlIHF1YXRlcm5pb24ncyBheGlzIGFuZCB3IHRvIHRoZSBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBRdWF0ZXJuaW9uIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRBeGlzQW5nbGVGcm9tUXVhdGVybmlvbiggcSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9xdWF0ZXJuaW9uVG9BbmdsZS9pbmRleC5odG0KCgkJCS8vIHEgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCQl0aGlzLncgPSAyICogTWF0aC5hY29zKCBxLncgKTsKCgkJCWNvbnN0IHMgPSBNYXRoLnNxcnQoIDEgLSBxLncgKiBxLncgKTsKCgkJCWlmICggcyA8IDAuMDAwMSApIHsKCgkJCQl0aGlzLnggPSAxOwoJCQkJdGhpcy55ID0gMDsKCQkJCXRoaXMueiA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMueCA9IHEueCAvIHM7CgkJCQl0aGlzLnkgPSBxLnkgLyBzOwoJCQkJdGhpcy56ID0gcS56IC8gczsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHgsIHkgYW5kIHogY29tcG9uZW50cyBvZiB0aGlzCgkJICogdmVjdG9yIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uIGFuZCB3IHRvIHRoZSBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEEgNHg0IG1hdHJpeCBvZiB3aGljaCB0aGUgdXBwZXIgbGVmdCAzeDMgbWF0cml4IGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXguCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0QXhpc0FuZ2xlRnJvbVJvdGF0aW9uTWF0cml4KCBtICkgewoKCQkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL21hdHJpeFRvQW5nbGUvaW5kZXguaHRtCgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJbGV0IGFuZ2xlLCB4LCB5LCB6OyAvLyB2YXJpYWJsZXMgZm9yIHJlc3VsdAoJCQljb25zdCBlcHNpbG9uID0gMC4wMSwJCS8vIG1hcmdpbiB0byBhbGxvdyBmb3Igcm91bmRpbmcgZXJyb3JzCgkJCQllcHNpbG9uMiA9IDAuMSwJCS8vIG1hcmdpbiB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIDAgYW5kIDE4MCBkZWdyZWVzCgoJCQkJdGUgPSBtLmVsZW1lbnRzLAoKCQkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCgkJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF07CgoJCQlpZiAoICggTWF0aC5hYnMoIG0xMiAtIG0yMSApIDwgZXBzaWxvbiApICYmCgkJCSAgICAgKCBNYXRoLmFicyggbTEzIC0gbTMxICkgPCBlcHNpbG9uICkgJiYKCQkJICAgICAoIE1hdGguYWJzKCBtMjMgLSBtMzIgKSA8IGVwc2lsb24gKSApIHsKCgkJCQkvLyBzaW5ndWxhcml0eSBmb3VuZAoJCQkJLy8gZmlyc3QgY2hlY2sgZm9yIGlkZW50aXR5IG1hdHJpeCB3aGljaCBtdXN0IGhhdmUgKzEgZm9yIGFsbCB0ZXJtcwoJCQkJLy8gaW4gbGVhZGluZyBkaWFnb25hbCBhbmQgemVybyBpbiBvdGhlciB0ZXJtcwoKCQkJCWlmICggKCBNYXRoLmFicyggbTEyICsgbTIxICkgPCBlcHNpbG9uMiApICYmCgkJCQkgICAgICggTWF0aC5hYnMoIG0xMyArIG0zMSApIDwgZXBzaWxvbjIgKSAmJgoJCQkJICAgICAoIE1hdGguYWJzKCBtMjMgKyBtMzIgKSA8IGVwc2lsb24yICkgJiYKCQkJCSAgICAgKCBNYXRoLmFicyggbTExICsgbTIyICsgbTMzIC0gMyApIDwgZXBzaWxvbjIgKSApIHsKCgkJCQkJLy8gdGhpcyBzaW5ndWxhcml0eSBpcyBpZGVudGl0eSBtYXRyaXggc28gYW5nbGUgPSAwCgoJCQkJCXRoaXMuc2V0KCAxLCAwLCAwLCAwICk7CgoJCQkJCXJldHVybiB0aGlzOyAvLyB6ZXJvIGFuZ2xlLCBhcmJpdHJhcnkgYXhpcwoKCQkJCX0KCgkJCQkvLyBvdGhlcndpc2UgdGhpcyBzaW5ndWxhcml0eSBpcyBhbmdsZSA9IDE4MAoKCQkJCWFuZ2xlID0gTWF0aC5QSTsKCgkJCQljb25zdCB4eCA9ICggbTExICsgMSApIC8gMjsKCQkJCWNvbnN0IHl5ID0gKCBtMjIgKyAxICkgLyAyOwoJCQkJY29uc3QgenogPSAoIG0zMyArIDEgKSAvIDI7CgkJCQljb25zdCB4eSA9ICggbTEyICsgbTIxICkgLyA0OwoJCQkJY29uc3QgeHogPSAoIG0xMyArIG0zMSApIC8gNDsKCQkJCWNvbnN0IHl6ID0gKCBtMjMgKyBtMzIgKSAvIDQ7CgoJCQkJaWYgKCAoIHh4ID4geXkgKSAmJiAoIHh4ID4genogKSApIHsKCgkJCQkJLy8gbTExIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQkJaWYgKCB4eCA8IGVwc2lsb24gKSB7CgoJCQkJCQl4ID0gMDsKCQkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl4ID0gTWF0aC5zcXJ0KCB4eCApOwoJCQkJCQl5ID0geHkgLyB4OwoJCQkJCQl6ID0geHogLyB4OwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggeXkgPiB6eiApIHsKCgkJCQkJLy8gbTIyIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQkJaWYgKCB5eSA8IGVwc2lsb24gKSB7CgoJCQkJCQl4ID0gMC43MDcxMDY3ODE7CgkJCQkJCXkgPSAwOwoJCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl5ID0gTWF0aC5zcXJ0KCB5eSApOwoJCQkJCQl4ID0geHkgLyB5OwoJCQkJCQl6ID0geXogLyB5OwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gbTMzIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0gc28gYmFzZSByZXN1bHQgb24gdGhpcwoKCQkJCQlpZiAoIHp6IDwgZXBzaWxvbiApIHsKCgkJCQkJCXggPSAwLjcwNzEwNjc4MTsKCQkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCQl6ID0gMDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXogPSBNYXRoLnNxcnQoIHp6ICk7CgkJCQkJCXggPSB4eiAvIHo7CgkJCQkJCXkgPSB5eiAvIHo7CgoJCQkJCX0KCgkJCQl9CgoJCQkJdGhpcy5zZXQoIHgsIHksIHosIGFuZ2xlICk7CgoJCQkJcmV0dXJuIHRoaXM7IC8vIHJldHVybiAxODAgZGVnIHJvdGF0aW9uCgoJCQl9CgoJCQkvLyBhcyB3ZSBoYXZlIHJlYWNoZWQgaGVyZSB0aGVyZSBhcmUgbm8gc2luZ3VsYXJpdGllcyBzbyB3ZSBjYW4gaGFuZGxlIG5vcm1hbGx5CgoJCQlsZXQgcyA9IE1hdGguc3FydCggKCBtMzIgLSBtMjMgKSAqICggbTMyIC0gbTIzICkgKwoJCQkJKCBtMTMgLSBtMzEgKSAqICggbTEzIC0gbTMxICkgKwoJCQkJKCBtMjEgLSBtMTIgKSAqICggbTIxIC0gbTEyICkgKTsgLy8gdXNlZCB0byBub3JtYWxpemUKCgkJCWlmICggTWF0aC5hYnMoIHMgKSA8IDAuMDAxICkgcyA9IDE7CgoJCQkvLyBwcmV2ZW50IGRpdmlkZSBieSB6ZXJvLCBzaG91bGQgbm90IGhhcHBlbiBpZiBtYXRyaXggaXMgb3J0aG9nb25hbCBhbmQgc2hvdWxkIGJlCgkJCS8vIGNhdWdodCBieSBzaW5ndWxhcml0eSB0ZXN0IGFib3ZlLCBidXQgSSd2ZSBsZWZ0IGl0IGluIGp1c3QgaW4gY2FzZQoKCQkJdGhpcy54ID0gKCBtMzIgLSBtMjMgKSAvIHM7CgkJCXRoaXMueSA9ICggbTEzIC0gbTMxICkgLyBzOwoJCQl0aGlzLnogPSAoIG0yMSAtIG0xMiApIC8gczsKCQkJdGhpcy53ID0gTWF0aC5hY29zKCAoIG0xMSArIG0yMiArIG0zMyAtIDEgKSAvIDIgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBwb3NpdGlvbiBlbGVtZW50cyBvZiB0aGUKCQkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgoJCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDEyIF07CgkJCXRoaXMueSA9IGVbIDEzIF07CgkJCXRoaXMueiA9IGVbIDE0IF07CgkJCXRoaXMudyA9IGVbIDE1IF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHgsIHksIHogb3IgdwoJCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtaW4gdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW1pbiggdiApIHsKCgkJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwoJCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKCQkJdGhpcy56ID0gTWF0aC5taW4oIHRoaXMueiwgdi56ICk7CgkJCXRoaXMudyA9IE1hdGgubWluKCB0aGlzLncsIHYudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5LCB6IG9yIHcKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltYXgoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWF4KCB0aGlzLnosIHYueiApOwoJCQl0aGlzLncgPSBNYXRoLm1heCggdGhpcy53LCB2LncgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZlY3RvcidzIHgsIHksIHogb3IgdwoJCSAqIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KCQkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUsCgkJICogaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IG1pbiAtIFRoZSBtaW5pbXVtIHgsIHkgYW5kIHogdmFsdWVzLgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gbWF4IC0gVGhlIG1heGltdW0geCwgeSBhbmQgeiB2YWx1ZXMgaW4gdGhlIGRlc2lyZWQgcmFuZ2UuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY2xhbXAoIG1pbiwgbWF4ICkgewoKCQkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCgkJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pbi54LCBtYXgueCApOwoJCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW4ueSwgbWF4LnkgKTsKCQkJdGhpcy56ID0gY2xhbXAoIHRoaXMueiwgbWluLnosIG1heC56ICk7CgkJCXRoaXMudyA9IGNsYW1wKCB0aGlzLncsIG1pbi53LCBtYXgudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWVzIGFyZSBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgdGhleSBhcmUKCQkgKiByZXBsYWNlZCBieSB0aGUgbWF4IHZhbHVlLgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlcyBhcmUgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIHRoZXkgYXJlCgkJICogcmVwbGFjZWQgYnkgdGhlIG1pbiB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW5WYWwgLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHBhcmFtIHtudW1iZXJ9IG1heFZhbCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgoJCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW5WYWwsIG1heFZhbCApOwoJCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW5WYWwsIG1heFZhbCApOwoJCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW5WYWwsIG1heFZhbCApOwoJCQl0aGlzLncgPSBjbGFtcCggdGhpcy53LCBtaW5WYWwsIG1heFZhbCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5CgkJICogdGhlIG1heCB2YWx1ZS4KCQkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlCgkJICogbWluIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNsYW1wTGVuZ3RoKCBtaW4sIG1heCApIHsKCgkJCWNvbnN0IGxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7CgoJCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIGNsYW1wKCBsZW5ndGgsIG1pbiwgbWF4ICkgKTsKCgkJfQoKCQkvKioKCQkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCBkb3duIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgdmFsdWUuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmbG9vcigpIHsKCgkJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmZsb29yKCB0aGlzLnkgKTsKCQkJdGhpcy56ID0gTWF0aC5mbG9vciggdGhpcy56ICk7CgkJCXRoaXMudyA9IE1hdGguZmxvb3IoIHRoaXMudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNlaWwoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLmNlaWwoIHRoaXMudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmQoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLnJvdW5kKCB0aGlzLncgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIHRvd2FyZHMgemVybyAodXAgaWYgbmVnYXRpdmUsCgkJICogZG93biBpZiBwb3NpdGl2ZSkgdG8gYW4gaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXJvdW5kVG9aZXJvKCkgewoKCQkJdGhpcy54ID0gTWF0aC50cnVuYyggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLnRydW5jKCB0aGlzLnogKTsKCQkJdGhpcy53ID0gTWF0aC50cnVuYyggdGhpcy53ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJbnZlcnRzIHRoaXMgdmVjdG9yIC0gaS5lLiBzZXRzIHggPSAteCwgeSA9IC15LCB6ID0gLXosIHcgPSAtdy4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW5lZ2F0ZSgpIHsKCgkJCXRoaXMueCA9IC0gdGhpcy54OwoJCQl0aGlzLnkgPSAtIHRoaXMueTsKCQkJdGhpcy56ID0gLSB0aGlzLno7CgkJCXRoaXMudyA9IC0gdGhpcy53OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ2FsY3VsYXRlcyB0aGUgZG90IHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGRvdCBwcm9kdWN0IHdpdGguCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIHRoZSBkb3QgcHJvZHVjdC4KCQkgKi8KCQlkb3QoIHYgKSB7CgoJCQlyZXR1cm4gdGhpcy54ICogdi54ICsgdGhpcy55ICogdi55ICsgdGhpcy56ICogdi56ICsgdGhpcy53ICogdi53OwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBzcXVhcmUgb2YgdGhlIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tCgkJICogKDAsIDAsIDAsIDApIHRvICh4LCB5LCB6LCB3KS4gSWYgeW91IGFyZSBjb21wYXJpbmcgdGhlIGxlbmd0aHMgb2YgdmVjdG9ycywgeW91IHNob3VsZAoJCSAqIGNvbXBhcmUgdGhlIGxlbmd0aCBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZW5ndGhTcSgpIHsKCgkJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLnc7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlICBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbSAoMCwgMCwgMCwgMCkgdG8gKHgsIHksIHosIHcpLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBNYW5oYXR0YW4gbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW1hbmhhdHRhbkxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICkgKyBNYXRoLmFicyggdGhpcy53ICk7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhpcyB2ZWN0b3IgdG8gYSB1bml0IHZlY3RvciAtIHRoYXQgaXMsIHNldHMgaXQgZXF1YWwgdG8gYSB2ZWN0b3IKCQkgKiB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0IHdpdGggYSB2ZWN0b3IgbGVuZ3RoIG9mIGAxYC4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW5vcm1hbGl6ZSgpIHsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHZlY3RvciB0byBhIHZlY3RvciB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0CgkJICogd2l0aCB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggLSBUaGUgbmV3IGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9yIGFuZCB0aGlzIGluc3RhbmNlLCB3aGVyZQoJCSAqIGFscGhhIGlzIHRoZSBwZXJjZW50IGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgdGhpcwoJCSAqIHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsIGJlIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGludGVycG9sYXRlIHRvd2FyZHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwKCB2LCBhbHBoYSApIHsKCgkJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CgkJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgkJCXRoaXMudyArPSAoIHYudyAtIHRoaXMudyApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9ycywgd2hlcmUgYWxwaGEgaXMgdGhlIHBlcmNlbnQKCQkgKiBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIGZpcnN0IHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsCgkJICogYmUgdGhlIHNlY29uZCBvbmUuIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYxIC0gVGhlIGZpcnN0IHZlY3Rvci4KCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYyIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCgkJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKCQkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwoJCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgkJCXRoaXMudyA9IHYxLncgKyAoIHYyLncgLSB2MS53ICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCB2ICkgewoKCQkJcmV0dXJuICggKCB2LnggPT09IHRoaXMueCApICYmICggdi55ID09PSB0aGlzLnkgKSAmJiAoIHYueiA9PT0gdGhpcy56ICkgJiYgKCB2LncgPT09IHRoaXMudyApICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHZlY3RvcidzIHggdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgXWAsIHkgdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAxIF1gLAoJCSAqIHogdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAyIF1gLCB3IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMyBdYC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQkJdGhpcy53ID0gYXJyYXlbIG9mZnNldCArIDMgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLno7CgkJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLnc7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoJCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCQkJdGhpcy53ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIGVhY2ggY29tcG9uZW50IG9mIHRoaXMgdmVjdG9yIHRvIGEgcHNldWRvLXJhbmRvbSB2YWx1ZSBiZXR3ZWVuIGAwYCBhbmQKCQkgKiBgMWAsIGV4Y2x1ZGluZyBgMWAuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlyYW5kb20oKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwoJCQl0aGlzLnkgPSBNYXRoLnJhbmRvbSgpOwoJCQl0aGlzLnogPSBNYXRoLnJhbmRvbSgpOwoJCQl0aGlzLncgPSBNYXRoLnJhbmRvbSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCQl5aWVsZCB0aGlzLng7CgkJCXlpZWxkIHRoaXMueTsKCQkJeWllbGQgdGhpcy56OwoJCQl5aWVsZCB0aGlzLnc7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIHJlbmRlciB0YXJnZXQgaXMgYSBidWZmZXIgd2hlcmUgdGhlIHZpZGVvIGNhcmQgZHJhd3MgcGl4ZWxzIGZvciBhIHNjZW5lCgkgKiB0aGF0IGlzIGJlaW5nIHJlbmRlcmVkIGluIHRoZSBiYWNrZ3JvdW5kLiBJdCBpcyB1c2VkIGluIGRpZmZlcmVudCBlZmZlY3RzLAoJICogc3VjaCBhcyBhcHBseWluZyBwb3N0cHJvY2Vzc2luZyB0byBhIHJlbmRlcmVkIGltYWdlIGJlZm9yZSBkaXNwbGF5aW5nIGl0CgkgKiBvbiB0aGUgc2NyZWVuLgoJICoKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqLwoJY2xhc3MgUmVuZGVyVGFyZ2V0IGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgkJLyoqCgkJICogUmVuZGVyIHRhcmdldCBvcHRpb25zLgoJCSAqCgkJICogQHR5cGVkZWYge09iamVjdH0gUmVuZGVyVGFyZ2V0fk9wdGlvbnMKCQkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtnZW5lcmF0ZU1pcG1hcHM9ZmFsc2VdIC0gV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIG9yIG5vdC4KCQkgKiBAcHJvcGVydHkge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyLgoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHByb3BlcnR5IHs/c3RyaW5nfSBbaW50ZXJuYWxGb3JtYXQ9bnVsbF0gLSBUaGUgdGV4dHVyZSdzIGludGVybmFsIGZvcm1hdC4KCQkgKiBAcHJvcGVydHkge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHRleHR1cmUncyB1diB3cmFwcGluZyBtb2RlLgoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgdGV4dHVyZSdzIHV2IHdyYXBwaW5nIG1vZGUuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFthbmlzb3Ryb3B5PTFdIC0gVGhlIHRleHR1cmUncyBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIHRleHR1cmUncyBjb2xvciBzcGFjZS4KCQkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtkZXB0aEJ1ZmZlcj10cnVlXSAtIFdoZXRoZXIgdG8gYWxsb2NhdGUgYSBkZXB0aCBidWZmZXIgb3Igbm90LgoJCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3N0ZW5jaWxCdWZmZXI9ZmFsc2VdIC0gV2hldGhlciB0byBhbGxvY2F0ZSBhIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KCQkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtyZXNvbHZlRGVwdGhCdWZmZXI9dHJ1ZV0gLSBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCgkJICogQHByb3BlcnR5IHtib29sZWFufSBbcmVzb2x2ZVN0ZW5jaWxCdWZmZXI9dHJ1ZV0gLSBXaGV0aGVyICB0byByZXNvbHZlIHRoZSBzdGVuY2lsIGJ1ZmZlciBvciBub3QuCgkJICogQHByb3BlcnR5IHs/VGV4dHVyZX0gW2RlcHRoVGV4dHVyZT1udWxsXSAtIFJlZmVyZW5jZSB0byBhIGRlcHRoIHRleHR1cmUuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFtzYW1wbGVzPTBdIC0gVGhlIE1TQUEgc2FtcGxlcyBjb3VudC4KCQkgKiBAcHJvcGVydHkge251bWJlcn0gW2NvdW50PTFdIC0gRGVmaW5lcyB0aGUgbnVtYmVyIG9mIGNvbG9yIGF0dGFjaG1lbnRzIC4gTXVzdCBiZSBhdCBsZWFzdCBgMWAuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSB0ZXh0dXJlIGRlcHRoLgoJCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW211bHRpdmlldz1mYWxzZV0gLSBXaGV0aGVyIHRoaXMgdGFyZ2V0IGlzIHVzZWQgZm9yIG11bHRpdmlldyByZW5kZXJpbmcuCgkJICovCgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgcmVuZGVyIHRhcmdldC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgoJCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KCQkgKi8KCQljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCQlzdXBlcigpOwoKCQkJb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHsKCQkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCgkJCQlpbnRlcm5hbEZvcm1hdDogbnVsbCwKCQkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAoJCQkJZGVwdGhCdWZmZXI6IHRydWUsCgkJCQlzdGVuY2lsQnVmZmVyOiBmYWxzZSwKCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogdHJ1ZSwKCQkJCXJlc29sdmVTdGVuY2lsQnVmZmVyOiB0cnVlLAoJCQkJZGVwdGhUZXh0dXJlOiBudWxsLAoJCQkJc2FtcGxlczogMCwKCQkJCWNvdW50OiAxLAoJCQkJZGVwdGg6IDEsCgkJCQltdWx0aXZpZXc6IGZhbHNlCgkJCX0sIG9wdGlvbnMgKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMud2lkdGggPSB3aWR0aDsKCgkJCS8qKgoJCQkgKiBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLmhlaWdodCA9IGhlaWdodDsKCgkJCS8qKgoJCQkgKiBUaGUgZGVwdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuZGVwdGggPSBvcHRpb25zLmRlcHRoOwoKCQkJLyoqCgkJCSAqIEEgcmVjdGFuZ3VsYXIgYXJlYSBpbnNpZGUgdGhlIHJlbmRlciB0YXJnZXQncyB2aWV3cG9ydC4gRnJhZ21lbnRzIHRoYXQgYXJlCgkJCSAqIG91dHNpZGUgdGhlIGFyZWEgd2lsbCBiZSBkaXNjYXJkZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtWZWN0b3I0fQoJCQkgKiBAZGVmYXVsdCAoMCwwLHdpZHRoLGhlaWdodCkKCQkJICovCgkJCXRoaXMuc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQkvKioKCQkJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBzaG91bGQgYmUgZW5hYmxlZCB3aGVuIHJlbmRlcmluZyBpbnRvCgkJCSAqIHRoaXMgcmVuZGVyIHRhcmdldCBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIEEgcmVjdGFuZ3VsYXIgYXJlYSByZXByZXNlbnRpbmcgdGhlIHJlbmRlciB0YXJnZXQncyB2aWV3cG9ydC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjR9CgkJCSAqIEBkZWZhdWx0ICgwLDAsd2lkdGgsaGVpZ2h0KQoJCQkgKi8KCQkJdGhpcy52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IG9wdGlvbnMuZGVwdGggfTsKCgkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSggaW1hZ2UgKTsKCgkJCS8qKgoJCQkgKiBBbiBhcnJheSBvZiB0ZXh0dXJlcy4gRWFjaCBjb2xvciBhdHRhY2htZW50IGlzIHJlcHJlc2VudGVkIGFzIGEgc2VwYXJhdGUgdGV4dHVyZS4KCQkJICogSGFzIGF0IGxlYXN0IGEgc2luZ2xlIGVudHJ5IGZvciB0aGUgZGVmYXVsdCBjb2xvciBhdHRhY2htZW50LgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8VGV4dHVyZT59CgkJCSAqLwoJCQl0aGlzLnRleHR1cmVzID0gW107CgoJCQljb25zdCBjb3VudCA9IG9wdGlvbnMuY291bnQ7CgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKCQkJCXRoaXMudGV4dHVyZXNbIGkgXSA9IHRleHR1cmUuY2xvbmUoKTsKCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoJCQkJdGhpcy50ZXh0dXJlc1sgaSBdLnJlbmRlclRhcmdldCA9IHRoaXM7CgoJCQl9CgoJCQl0aGlzLl9zZXRUZXh0dXJlT3B0aW9ucyggb3B0aW9ucyApOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gYWxsb2NhdGUgYSBkZXB0aCBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5kZXB0aEJ1ZmZlciA9IG9wdGlvbnMuZGVwdGhCdWZmZXI7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBhbGxvY2F0ZSBhIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnN0ZW5jaWxCdWZmZXI7CgoJCQkvKioKCQkJICogV2hldGhlciB0byByZXNvbHZlIHRoZSBkZXB0aCBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5yZXNvbHZlRGVwdGhCdWZmZXIgPSBvcHRpb25zLnJlc29sdmVEZXB0aEJ1ZmZlcjsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMucmVzb2x2ZVN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnJlc29sdmVTdGVuY2lsQnVmZmVyOwoKCQkJdGhpcy5fZGVwdGhUZXh0dXJlID0gbnVsbDsKCQkJdGhpcy5kZXB0aFRleHR1cmUgPSBvcHRpb25zLmRlcHRoVGV4dHVyZTsKCgkJCS8qKgoJCQkgKiBUaGUgbnVtYmVyIG9mIE1TQUEgc2FtcGxlcy4KCQkJICoKCQkJICogQSB2YWx1ZSBvZiBgMGAgZGlzYWJsZXMgTVNBQS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5zYW1wbGVzID0gb3B0aW9ucy5zYW1wbGVzOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gdGhpcyB0YXJnZXQgaXMgdXNlZCBpbiBtdWx0aXZpZXcgcmVuZGVyaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMubXVsdGl2aWV3ID0gb3B0aW9ucy5tdWx0aXZpZXc7CgoJCX0KCgkJX3NldFRleHR1cmVPcHRpb25zKCBvcHRpb25zID0ge30gKSB7CgoJCQljb25zdCB2YWx1ZXMgPSB7CgkJCQltaW5GaWx0ZXI6IExpbmVhckZpbHRlciwKCQkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCgkJCQlmbGlwWTogZmFsc2UsCgkJCQlpbnRlcm5hbEZvcm1hdDogbnVsbAoJCQl9OwoKCQkJaWYgKCBvcHRpb25zLm1hcHBpbmcgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5tYXBwaW5nID0gb3B0aW9ucy5tYXBwaW5nOwoJCQlpZiAoIG9wdGlvbnMud3JhcFMgIT09IHVuZGVmaW5lZCApIHZhbHVlcy53cmFwUyA9IG9wdGlvbnMud3JhcFM7CgkJCWlmICggb3B0aW9ucy53cmFwVCAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLndyYXBUID0gb3B0aW9ucy53cmFwVDsKCQkJaWYgKCBvcHRpb25zLndyYXBSICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMud3JhcFIgPSBvcHRpb25zLndyYXBSOwoJCQlpZiAoIG9wdGlvbnMubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMubWFnRmlsdGVyID0gb3B0aW9ucy5tYWdGaWx0ZXI7CgkJCWlmICggb3B0aW9ucy5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlcjsKCQkJaWYgKCBvcHRpb25zLmZvcm1hdCAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLmZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0OwoJCQlpZiAoIG9wdGlvbnMudHlwZSAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLnR5cGUgPSBvcHRpb25zLnR5cGU7CgkJCWlmICggb3B0aW9ucy5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuYW5pc290cm9weSA9IG9wdGlvbnMuYW5pc290cm9weTsKCQkJaWYgKCBvcHRpb25zLmNvbG9yU3BhY2UgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5jb2xvclNwYWNlID0gb3B0aW9ucy5jb2xvclNwYWNlOwoJCQlpZiAoIG9wdGlvbnMuZmxpcFkgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5mbGlwWSA9IG9wdGlvbnMuZmxpcFk7CgkJCWlmICggb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5nZW5lcmF0ZU1pcG1hcHMgPSBvcHRpb25zLmdlbmVyYXRlTWlwbWFwczsKCQkJaWYgKCBvcHRpb25zLmludGVybmFsRm9ybWF0ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuaW50ZXJuYWxGb3JtYXQgPSBvcHRpb25zLmludGVybmFsRm9ybWF0OwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbIGkgXTsKCQkJCXRleHR1cmUuc2V0VmFsdWVzKCB2YWx1ZXMgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBUaGUgdGV4dHVyZSByZXByZXNlbnRpbmcgdGhlIGRlZmF1bHQgY29sb3IgYXR0YWNobWVudC4KCQkgKgoJCSAqIEB0eXBlIHtUZXh0dXJlfQoJCSAqLwoJCWdldCB0ZXh0dXJlKCkgewoKCQkJcmV0dXJuIHRoaXMudGV4dHVyZXNbIDAgXTsKCgkJfQoKCQlzZXQgdGV4dHVyZSggdmFsdWUgKSB7CgoJCQl0aGlzLnRleHR1cmVzWyAwIF0gPSB2YWx1ZTsKCgkJfQoKCQlzZXQgZGVwdGhUZXh0dXJlKCBjdXJyZW50ICkgewoKCQkJaWYgKCB0aGlzLl9kZXB0aFRleHR1cmUgIT09IG51bGwgKSB0aGlzLl9kZXB0aFRleHR1cmUucmVuZGVyVGFyZ2V0ID0gbnVsbDsKCQkJaWYgKCBjdXJyZW50ICE9PSBudWxsICkgY3VycmVudC5yZW5kZXJUYXJnZXQgPSB0aGlzOwoKCQkJdGhpcy5fZGVwdGhUZXh0dXJlID0gY3VycmVudDsKCgkJfQoKCQkvKioKCQkgKiBJbnN0ZWFkIG9mIHNhdmluZyB0aGUgZGVwdGggaW4gYSByZW5kZXJidWZmZXIsIGEgdGV4dHVyZQoJCSAqIGNhbiBiZSB1c2VkIGluc3RlYWQgd2hpY2ggaXMgdXNlZnVsIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcKCQkgKiBlLmcuIGluIGNvbnRleHQgb2YgcG9zdC1wcm9jZXNzaW5nLgoJCSAqCgkJICogQHR5cGUgez9EZXB0aFRleHR1cmV9CgkJICogQGRlZmF1bHQgbnVsbAoJCSAqLwoJCWdldCBkZXB0aFRleHR1cmUoKSB7CgoJCQlyZXR1cm4gdGhpcy5fZGVwdGhUZXh0dXJlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHNpemUgb2YgdGhpcyByZW5kZXIgdGFyZ2V0LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGguCgkJICovCgkJc2V0U2l6ZSggd2lkdGgsIGhlaWdodCwgZGVwdGggPSAxICkgewoKCQkJaWYgKCB0aGlzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuZGVwdGggIT09IGRlcHRoICkgewoKCQkJCXRoaXMud2lkdGggPSB3aWR0aDsKCQkJCXRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJCQkJdGhpcy5kZXB0aCA9IGRlcHRoOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLnRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaW1hZ2Uud2lkdGggPSB3aWR0aDsKCQkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaW1hZ2UuaGVpZ2h0ID0gaGVpZ2h0OwoJCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5kZXB0aCA9IGRlcHRoOwoJCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc0FycmF5VGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5kZXB0aCA+IDE7CgoJCQkJfQoKCQkJCXRoaXMuZGlzcG9zZSgpOwoKCQkJfQoKCQkJdGhpcy52aWV3cG9ydC5zZXQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCQkJdGhpcy5zY2lzc29yLnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgcmVuZGVyIHRhcmdldCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7UmVuZGVyVGFyZ2V0fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSBzZXR0aW5ncyBvZiB0aGUgZ2l2ZW4gcmVuZGVyIHRhcmdldC4gVGhpcyBpcyBhIHN0cnVjdHVyYWwgY29weSBzbwoJCSAqIG5vIHJlc291cmNlcyBhcmUgc2hhcmVkIGJldHdlZW4gcmVuZGVyIHRhcmdldHMgYWZ0ZXIgdGhlIGNvcHkuIFRoYXQgaW5jbHVkZXMKCQkgKiBhbGwgTVJUIHRleHR1cmVzIGFuZCB0aGUgZGVwdGggdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fSBzb3VyY2UgLSBUaGUgcmVuZGVyIHRhcmdldCB0byBjb3B5LgoJCSAqIEByZXR1cm4ge1JlbmRlclRhcmdldH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljb3B5KCBzb3VyY2UgKSB7CgoJCQl0aGlzLndpZHRoID0gc291cmNlLndpZHRoOwoJCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CgkJCXRoaXMuZGVwdGggPSBzb3VyY2UuZGVwdGg7CgoJCQl0aGlzLnNjaXNzb3IuY29weSggc291cmNlLnNjaXNzb3IgKTsKCQkJdGhpcy5zY2lzc29yVGVzdCA9IHNvdXJjZS5zY2lzc29yVGVzdDsKCgkJCXRoaXMudmlld3BvcnQuY29weSggc291cmNlLnZpZXdwb3J0ICk7CgoJCQl0aGlzLnRleHR1cmVzLmxlbmd0aCA9IDA7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gc291cmNlLnRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXRoaXMudGV4dHVyZXNbIGkgXSA9IHNvdXJjZS50ZXh0dXJlc1sgaSBdLmNsb25lKCk7CgkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5yZW5kZXJUYXJnZXQgPSB0aGlzOwoKCQkJCS8vIGVuc3VyZSBpbWFnZSBvYmplY3QgaXMgbm90IHNoYXJlZCwgc2VlICMyMDMyOAoKCQkJCWNvbnN0IGltYWdlID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS50ZXh0dXJlc1sgaSBdLmltYWdlICk7CgkJCQl0aGlzLnRleHR1cmVzWyBpIF0uc291cmNlID0gbmV3IFNvdXJjZSggaW1hZ2UgKTsKCgkJCX0KCgkJCXRoaXMuZGVwdGhCdWZmZXIgPSBzb3VyY2UuZGVwdGhCdWZmZXI7CgkJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwoKCQkJdGhpcy5yZXNvbHZlRGVwdGhCdWZmZXIgPSBzb3VyY2UucmVzb2x2ZURlcHRoQnVmZmVyOwoJCQl0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyID0gc291cmNlLnJlc29sdmVTdGVuY2lsQnVmZmVyOwoKCQkJaWYgKCBzb3VyY2UuZGVwdGhUZXh0dXJlICE9PSBudWxsICkgdGhpcy5kZXB0aFRleHR1cmUgPSBzb3VyY2UuZGVwdGhUZXh0dXJlLmNsb25lKCk7CgoJCQl0aGlzLnNhbXBsZXMgPSBzb3VyY2Uuc2FtcGxlczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwoJCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgoJCSAqCgkJICogQGZpcmVzIFJlbmRlclRhcmdldCNkaXNwb3NlCgkJICovCgkJZGlzcG9zZSgpIHsKCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9CgoJfQoKCS8qKgoJICogQSByZW5kZXIgdGFyZ2V0IHVzZWQgaW4gY29udGV4dCBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkgKgoJICogQGF1Z21lbnRzIFJlbmRlclRhcmdldAoJICovCgljbGFzcyBXZWJHTFJlbmRlclRhcmdldCBleHRlbmRzIFJlbmRlclRhcmdldCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgM0QgcmVuZGVyIHRhcmdldC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgoJCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KCQkgKi8KCQljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCQlzdXBlciggd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNXZWJHTFJlbmRlclRhcmdldCA9IHRydWU7CgoJCX0KCgl9CgoJLyoqCgkgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRleHR1cmVzIGRpcmVjdGx5IGZyb20gcmF3IGJ1ZmZlciBkYXRhLgoJICoKCSAqIEBhdWdtZW50cyBUZXh0dXJlCgkgKi8KCWNsYXNzIERhdGFBcnJheVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBkYXRhIGFycmF5IHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0gez9UeXBlZEFycmF5fSBbZGF0YT1udWxsXSAtIFRoZSBidWZmZXIgZGF0YS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoPTFdIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0PTFdIC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBkYXRhID0gbnVsbCwgd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEgKSB7CgoJCQlzdXBlciggbnVsbCApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNEYXRhQXJyYXlUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgaW1hZ2UgZGVmaW5pdGlvbiBvZiBhIGRhdGEgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge3tkYXRhOlR5cGVkQXJyYXksd2lkdGg6bnVtYmVyLGhlaWdodDpudW1iZXIsZGVwdGg6bnVtYmVyfX0KCQkJICovCgkJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGluIHRoZSBkZXB0aCBhbmQgY29ycmVzcG9uZHMgdG8KCQkJICogKlcqIGluIFVWVyBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKCQkJICovCgkJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgbWlwbWFwcyAoaWYgcG9zc2libGUpIGZvciBhIHRleHR1cmUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkvKioKCQkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCgkJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYDFgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJCQkvKioKCQkJICogQSBzZXQgb2YgYWxsIGxheWVycyB3aGljaCBuZWVkIHRvIGJlIHVwZGF0ZWQgaW4gdGhlIHRleHR1cmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtTZXQ8bnVtYmVyPn0KCQkJICovCgkJCXRoaXMubGF5ZXJVcGRhdGVzID0gbmV3IFNldCgpOwoKCQl9CgoJCS8qKgoJCSAqIERlc2NyaWJlcyB0aGF0IGEgc3BlY2lmaWMgbGF5ZXIgb2YgdGhlIHRleHR1cmUgbmVlZHMgdG8gYmUgdXBkYXRlZC4KCQkgKiBOb3JtYWxseSB3aGVuIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLCB0aGUKCQkgKiBlbnRpcmUgZGF0YSB0ZXh0dXJlIGFycmF5IGlzIHNlbnQgdG8gdGhlIEdQVS4gTWFya2luZyBzcGVjaWZpYwoJCSAqIGxheWVycyB3aWxsIG9ubHkgdHJhbnNtaXQgc3Vic2V0cyBvZiBhbGwgbWlwbWFwcyBhc3NvY2lhdGVkIHdpdGggYQoJCSAqIHNwZWNpZmljIGRlcHRoIGluIHRoZSBhcnJheSB3aGljaCBpcyBvZnRlbiBtdWNoIG1vcmUgcGVyZm9ybWFudC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllckluZGV4IC0gVGhlIGxheWVyIGluZGV4IHRoYXQgc2hvdWxkIGJlIHVwZGF0ZWQuCgkJICovCgkJYWRkTGF5ZXJVcGRhdGUoIGxheWVySW5kZXggKSB7CgoJCQl0aGlzLmxheWVyVXBkYXRlcy5hZGQoIGxheWVySW5kZXggKTsKCgkJfQoKCQkvKioKCQkgKiBSZXNldHMgdGhlIGxheWVyIHVwZGF0ZXMgcmVnaXN0cnkuCgkJICovCgkJY2xlYXJMYXllclVwZGF0ZXMoKSB7CgoJCQl0aGlzLmxheWVyVXBkYXRlcy5jbGVhcigpOwoKCQl9CgoJfQoKCS8qKgoJICogQ3JlYXRlcyBhIHRocmVlLWRpbWVuc2lvbmFsIHRleHR1cmUgZnJvbSByYXcgZGF0YSwgd2l0aCBwYXJhbWV0ZXJzIHRvCgkgKiBkaXZpZGUgaXQgaW50byB3aWR0aCwgaGVpZ2h0LCBhbmQgZGVwdGguCgkgKgoJICogQGF1Z21lbnRzIFRleHR1cmUKCSAqLwoJY2xhc3MgRGF0YTNEVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGRhdGEgYXJyYXkgdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7P1R5cGVkQXJyYXl9IFtkYXRhPW51bGxdIC0gVGhlIGJ1ZmZlciBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHRleHR1cmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSB0ZXh0dXJlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGggb2YgdGhlIHRleHR1cmUuCgkJICovCgkJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCgkJCS8vIFdlJ3JlIGdvaW5nIHRvIGFkZCAuc2V0WFhYKCkgbWV0aG9kcyBmb3Igc2V0dGluZyBwcm9wZXJ0aWVzIGxhdGVyLgoJCQkvLyBVc2VycyBjYW4gc3RpbGwgc2V0IGluIERhdGEzRFRleHR1cmUgZGlyZWN0bHkuCgkJCS8vCgkJCS8vCWNvbnN0IHRleHR1cmUgPSBuZXcgVEhSRUUuRGF0YTNEVGV4dHVyZSggZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggKTsKCQkJLy8gCXRleHR1cmUuYW5pc290cm9weSA9IDE2OwoJCQkvLwoJCQkvLyBTZWUgIzE0ODM5CgoJCQlzdXBlciggbnVsbCApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNEYXRhM0RUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgaW1hZ2UgZGVmaW5pdGlvbiBvZiBhIGRhdGEgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge3tkYXRhOlR5cGVkQXJyYXksd2lkdGg6bnVtYmVyLGhlaWdodDpudW1iZXIsZGVwdGg6bnVtYmVyfX0KCQkJICovCgkJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGluIHRoZSBkZXB0aCBhbmQgY29ycmVzcG9uZHMgdG8KCQkJICogKlcqIGluIFVWVyBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKCQkJICovCgkJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgbWlwbWFwcyAoaWYgcG9zc2libGUpIGZvciBhIHRleHR1cmUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkvKioKCQkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCgkJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYDFgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJCX0KCgl9CgoJLyoqCgkgKiBSZXByZXNlbnRzIGFuIGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggKEFBQkIpIGluIDNEIHNwYWNlLgoJICovCgljbGFzcyBCb3gzIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFttaW49KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KV0gLSBBIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBib3guCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbbWF4PSgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSldIC0gQSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgYm94LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBtaW4gPSBuZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApLCBtYXggPSBuZXcgVmVjdG9yMyggLSBJbmZpbml0eSwgLSBJbmZpbml0eSwgLSBJbmZpbml0eSApICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNCb3gzID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLm1pbiA9IG1pbjsKCgkJCS8qKgoJCQkgKiBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLm1heCA9IG1heDsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBsb3dlciBhbmQgdXBwZXIgYm91bmRhcmllcyBvZiB0aGlzIGJveC4KCQkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgY29waWVzIHRoZSB2YWx1ZXMgZnJvbSB0aGUgZ2l2ZW4gb2JqZWN0cy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gbWluIC0gVGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBib3guCgkJICogQHBhcmFtIHtWZWN0b3IzfSBtYXggLSBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlzZXQoIG1pbiwgbWF4ICkgewoKCQkJdGhpcy5taW4uY29weSggbWluICk7CgkJCXRoaXMubWF4LmNvcHkoIG1heCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJveCBzbyBpdCBlbmNsb3NlcyB0aGUgcG9zaXRpb24gZGF0YQoJCSAqIGluIHRoZSBnaXZlbiBhcnJheS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEuCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJc2V0RnJvbUFycmF5KCBhcnJheSApIHsKCgkJCXRoaXMubWFrZUVtcHR5KCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYi5mcm9tQXJyYXkoIGFycmF5LCBpICkgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHVwcGVyIGFuZCBsb3dlciBib3VuZHMgb2YgdGhpcyBib3ggc28gaXQgZW5jbG9zZXMgdGhlIHBvc2l0aW9uIGRhdGEKCQkgKiBpbiB0aGUgZ2l2ZW4gYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBBIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyAzRCBwb3NpdGlvbiBkYXRhLgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCXNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIHsKCgkJCXRoaXMubWFrZUVtcHR5KCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpICkgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHVwcGVyIGFuZCBsb3dlciBib3VuZHMgb2YgdGhpcyBib3ggc28gaXQgZW5jbG9zZXMgdGhlIHBvc2l0aW9uIGRhdGEKCQkgKiBpbiB0aGUgZ2l2ZW4gYXJyYXkuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBbiBhcnJheSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEgYXMgaW5zdGFuY2VzIG9mIHtAbGluayBWZWN0b3IzfS4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCQl0aGlzLm1ha2VFbXB0eSgpOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIHBvaW50c1sgaSBdICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDZW50ZXJzIHRoaXMgYm94IG9uIHRoZSBnaXZlbiBjZW50ZXIgdmVjdG9yIGFuZCBzZXRzIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQKCQkgKiBkZXB0aCB0byB0aGUgZ2l2ZW4gc2l6ZSB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGNlbnRlciAtIFRoZSBjZW50ZXIgb2YgdGhlIGJveC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHNpemUgLSBUaGUgeCwgeSBhbmQgeiBkaW1lbnNpb25zIG9mIHRoZSBib3guCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJc2V0RnJvbUNlbnRlckFuZFNpemUoIGNlbnRlciwgc2l6ZSApIHsKCgkJCWNvbnN0IGhhbGZTaXplID0gX3ZlY3RvciRiLmNvcHkoIHNpemUgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CgkJCXRoaXMubWF4LmNvcHkoIGNlbnRlciApLmFkZCggaGFsZlNpemUgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSB3b3JsZC1heGlzLWFsaWduZWQgYm91bmRpbmcgYm94IGZvciB0aGUgZ2l2ZW4gM0Qgb2JqZWN0CgkJICogKGluY2x1ZGluZyBpdHMgY2hpbGRyZW4pLCBhY2NvdW50aW5nIGZvciB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLAoJCSAqIHdvcmxkIHRyYW5zZm9ybXMuIFRoZSBmdW5jdGlvbiBtYXkgcmVzdWx0IGluIGEgbGFyZ2VyIGJveCB0aGFuIHN0cmljdGx5IG5lY2Vzc2FyeS4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gY29tcHV0ZSB0aGUgYm91bmRpbmcgYm94IGZvci4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtwcmVjaXNlPWZhbHNlXSAtIElmIHNldCB0byBgdHJ1ZWAsIHRoZSBtZXRob2QgY29tcHV0ZXMgdGhlIHNtYWxsZXN0CgkJICogd29ybGQtYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveCBhdCB0aGUgZXhwZW5zZSBvZiBtb3JlIGNvbXB1dGF0aW9uLgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCXNldEZyb21PYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKCQkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJCXJldHVybiB0aGlzLmV4cGFuZEJ5T2JqZWN0KCBvYmplY3QsIHByZWNpc2UgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IGJveCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7Qm94M30gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBib3ggdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBjb3B5LgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWNvcHkoIGJveCApIHsKCgkJCXRoaXMubWluLmNvcHkoIGJveC5taW4gKTsKCQkJdGhpcy5tYXguY29weSggYm94Lm1heCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTWFrZXMgdGhpcyBib3ggZW1wdHkgd2hpY2ggbWVhbnMgaW4gZW5jbG9zZXMgYSB6ZXJvIHNwYWNlIGluIDNELgoJCSAqCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJbWFrZUVtcHR5KCkgewoKCQkJdGhpcy5taW4ueCA9IHRoaXMubWluLnkgPSB0aGlzLm1pbi56ID0gKyBJbmZpbml0eTsKCQkJdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSB0aGlzLm1heC56ID0gLSBJbmZpbml0eTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGJveCBpbmNsdWRlcyB6ZXJvIHBvaW50cyB3aXRoaW4gaXRzIGJvdW5kcy4KCQkgKiBOb3RlIHRoYXQgYSBib3ggd2l0aCBlcXVhbCBsb3dlciBhbmQgdXBwZXIgYm91bmRzIHN0aWxsIGluY2x1ZGVzIG9uZQoJCSAqIHBvaW50LCB0aGUgb25lIGJvdGggYm91bmRzIHNoYXJlLgoJCSAqCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGJveCBpcyBlbXB0eSBvciBub3QuCgkJICovCgkJaXNFbXB0eSgpIHsKCgkJCS8vIHRoaXMgaXMgYSBtb3JlIHJvYnVzdCBjaGVjayBmb3IgZW1wdHkgdGhhbiAoIHZvbHVtZSA8PSAwICkgYmVjYXVzZSB2b2x1bWUgY2FuIGdldCBwb3NpdGl2ZSB3aXRoIHR3byBuZWdhdGl2ZSBheGVzCgoJCQlyZXR1cm4gKCB0aGlzLm1heC54IDwgdGhpcy5taW4ueCApIHx8ICggdGhpcy5tYXgueSA8IHRoaXMubWluLnkgKSB8fCAoIHRoaXMubWF4LnogPCB0aGlzLm1pbi56ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgY2VudGVyIHBvaW50IG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2VudGVyIHBvaW50LgoJCSAqLwoJCWdldENlbnRlciggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCwgMCApIDogdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMubWluLCB0aGlzLm1heCApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBkaW1lbnNpb25zIG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgc2l6ZS4KCQkgKi8KCQlnZXRTaXplKCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwLCAwICkgOiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5tYXgsIHRoaXMubWluICk7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIGJveCB0byBpbmNsdWRlIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdGhhdCBzaG91bGQgYmUgaW5jbHVkZWQgYnkgdGhlIGJvdW5kaW5nIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlleHBhbmRCeVBvaW50KCBwb2ludCApIHsKCgkJCXRoaXMubWluLm1pbiggcG9pbnQgKTsKCQkJdGhpcy5tYXgubWF4KCBwb2ludCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGlzIGJveCBlcXVpbGF0ZXJhbGx5IGJ5IHRoZSBnaXZlbiB2ZWN0b3IuIFRoZSB3aWR0aCBvZiB0aGlzCgkJICogYm94IHdpbGwgYmUgZXhwYW5kZWQgYnkgdGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgaW4gYm90aAoJCSAqIGRpcmVjdGlvbnMuIFRoZSBoZWlnaHQgb2YgdGhpcyBib3ggd2lsbCBiZSBleHBhbmRlZCBieSB0aGUgeSBjb21wb25lbnQgb2YKCQkgKiB0aGUgdmVjdG9yIGluIGJvdGggZGlyZWN0aW9ucy4gVGhlIGRlcHRoIG9mIHRoaXMgYm94IHdpbGwgYmUKCQkgKiBleHBhbmRlZCBieSB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBpbiBib3RoIGRpcmVjdGlvbnMuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZlY3RvciAtIFRoZSB2ZWN0b3IgdGhhdCBzaG91bGQgZXhwYW5kIHRoZSBib3VuZGluZyBib3guCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJZXhwYW5kQnlWZWN0b3IoIHZlY3RvciApIHsKCgkJCXRoaXMubWluLnN1YiggdmVjdG9yICk7CgkJCXRoaXMubWF4LmFkZCggdmVjdG9yICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBFeHBhbmRzIGVhY2ggZGltZW5zaW9uIG9mIHRoZSBib3ggYnkgdGhlIGdpdmVuIHNjYWxhci4gSWYgbmVnYXRpdmUsIHRoZQoJCSAqIGRpbWVuc2lvbnMgb2YgdGhlIGJveCB3aWxsIGJlIGNvbnRyYWN0ZWQuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB2YWx1ZSB0aGF0IHNob3VsZCBleHBhbmQgdGhlIGJvdW5kaW5nIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlleHBhbmRCeVNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy5taW4uYWRkU2NhbGFyKCAtIHNjYWxhciApOwoJCQl0aGlzLm1heC5hZGRTY2FsYXIoIHNjYWxhciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIGJveCB0byBpbmNsdWRlIHRoZSBnaXZlbiAzRCBvYmplY3QgYW5kCgkJICogaXRzIGNoaWxkcmVuLCBhY2NvdW50aW5nIGZvciB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZAoJCSAqIHRyYW5zZm9ybXMuIFRoZSBmdW5jdGlvbiBtYXkgcmVzdWx0IGluIGEgbGFyZ2VyIGJveCB0aGFuIHN0cmljdGx5CgkJICogbmVjZXNzYXJ5ICh1bmxlc3MgdGhlIHByZWNpc2UgcGFyYW1ldGVyIGlzIHNldCB0byB0cnVlKS4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdGhhdCBzaG91bGQgZXhwYW5kIHRoZSBib3VuZGluZyBib3guCgkJICogQHBhcmFtIHtib29sZWFufSBwcmVjaXNlIC0gSWYgc2V0IHRvIGB0cnVlYCwgdGhlIG1ldGhvZCBleHBhbmRzIHRoZSBib3VuZGluZyBib3gKCQkgKiBhcyBsaXR0bGUgYXMgbmVjZXNzYXJ5IGF0IHRoZSBleHBlbnNlIG9mIG1vcmUgY29tcHV0YXRpb24uCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJZXhwYW5kQnlPYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKCQkJLy8gQ29tcHV0ZXMgdGhlIHdvcmxkLWF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggb2YgYW4gb2JqZWN0IChpbmNsdWRpbmcgaXRzIGNoaWxkcmVuKSwKCQkJLy8gYWNjb3VudGluZyBmb3IgYm90aCB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZCB0cmFuc2Zvcm1zCgoJCQlvYmplY3QudXBkYXRlV29ybGRNYXRyaXgoIGZhbHNlLCBmYWxzZSApOwoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIGdlb21ldHJ5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCgkJCQkvLyBwcmVjaXNlIEFBQkIgY29tcHV0YXRpb24gYmFzZWQgb24gdmVydGV4IGRhdGEgcmVxdWlyZXMgYXQgbGVhc3QgYSBwb3NpdGlvbiBhdHRyaWJ1dGUuCgkJCQkvLyBpbnN0YW5jaW5nIGlzbid0IHN1cHBvcnRlZCBzbyBmYXIgYW5kIHVzZXMgdGhlIG5vcm1hbCAoY29uc2VydmF0aXZlKSBjb2RlIHBhdGguCgoJCQkJaWYgKCBwcmVjaXNlID09PSB0cnVlICYmIHBvc2l0aW9uQXR0cmlidXRlICE9PSB1bmRlZmluZWQgJiYgb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJaWYgKCBvYmplY3QuaXNNZXNoID09PSB0cnVlICkgewoKCQkJCQkJCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggaSwgX3ZlY3RvciRiICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCV92ZWN0b3IkYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoKCQkJCQkJfQoKCQkJCQkJX3ZlY3RvciRiLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgkJCQkJCXRoaXMuZXhwYW5kQnlQb2ludCggX3ZlY3RvciRiICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ0JveCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJLy8gb2JqZWN0LWxldmVsIGJvdW5kaW5nIGJveAoKCQkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQkJCQkJb2JqZWN0LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJCQkJfQoKCQkJCQkJX2JveCQ0LmNvcHkoIG9iamVjdC5ib3VuZGluZ0JveCApOwoKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGdlb21ldHJ5LWxldmVsIGJvdW5kaW5nIGJveAoKCQkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCQkJCQlnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJCQkJCX0KCgkJCQkJCV9ib3gkNC5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApOwoKCQkJCQl9CgoJCQkJCV9ib3gkNC5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCQl0aGlzLnVuaW9uKCBfYm94JDQgKTsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdGhpcy5leHBhbmRCeU9iamVjdCggY2hpbGRyZW5bIGkgXSwgcHJlY2lzZSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50IGxpZXMgd2l0aGluIG9yIG9uIHRoZSBib3VuZGFyaWVzIG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGJvdW5kaW5nIGJveCBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIHBvaW50LnggPj0gdGhpcy5taW4ueCAmJiBwb2ludC54IDw9IHRoaXMubWF4LnggJiYKCQkJCXBvaW50LnkgPj0gdGhpcy5taW4ueSAmJiBwb2ludC55IDw9IHRoaXMubWF4LnkgJiYKCQkJCXBvaW50LnogPj0gdGhpcy5taW4ueiAmJiBwb2ludC56IDw9IHRoaXMubWF4Lno7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBib3VuZGluZyBib3ggaW5jbHVkZXMgdGhlIGVudGlyZXR5IG9mIHRoZSBnaXZlbiBib3VuZGluZyBib3guCgkJICogSWYgdGhpcyBib3ggYW5kIHRoZSBnaXZlbiBvbmUgYXJlIGlkZW50aWNhbCwgdGhpcyBmdW5jdGlvbiBhbHNvIHJldHVybnMgYHRydWVgLgoJCSAqCgkJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm91bmRpbmcgYm94IHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYm91bmRpbmcgYm94IGNvbnRhaW5zIHRoZSBnaXZlbiBib3VuZGluZyBib3ggb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zQm94KCBib3ggKSB7CgoJCQlyZXR1cm4gdGhpcy5taW4ueCA8PSBib3gubWluLnggJiYgYm94Lm1heC54IDw9IHRoaXMubWF4LnggJiYKCQkJCXRoaXMubWluLnkgPD0gYm94Lm1pbi55ICYmIGJveC5tYXgueSA8PSB0aGlzLm1heC55ICYmCgkJCQl0aGlzLm1pbi56IDw9IGJveC5taW4ueiAmJiBib3gubWF4LnogPD0gdGhpcy5tYXguejsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgcG9pbnQgYXMgYSBwcm9wb3J0aW9uIG9mIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQgZGVwdGguCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBwb2ludCBpbiAzRCBzcGFjZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcG9pbnQgYXMgYSBwcm9wb3J0aW9uIG9mIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQgZGVwdGguCgkJICovCgkJZ2V0UGFyYW1ldGVyKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkJLy8gVGhpcyBjYW4gcG90ZW50aWFsbHkgaGF2ZSBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBib3gKCQkJLy8gaGFzIGEgc2l6ZSBkaW1lbnNpb24gb2YgMC4KCgkJCXJldHVybiB0YXJnZXQuc2V0KAoJCQkJKCBwb2ludC54IC0gdGhpcy5taW4ueCApIC8gKCB0aGlzLm1heC54IC0gdGhpcy5taW4ueCApLAoJCQkJKCBwb2ludC55IC0gdGhpcy5taW4ueSApIC8gKCB0aGlzLm1heC55IC0gdGhpcy5taW4ueSApLAoJCQkJKCBwb2ludC56IC0gdGhpcy5taW4ueiApIC8gKCB0aGlzLm1heC56IC0gdGhpcy5taW4ueiApCgkJCSk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWludGVyc2VjdHNCb3goIGJveCApIHsKCgkJCS8vIHVzaW5nIDYgc3BsaXR0aW5nIHBsYW5lcyB0byBydWxlIG91dCBpbnRlcnNlY3Rpb25zLgoJCQlyZXR1cm4gYm94Lm1heC54ID49IHRoaXMubWluLnggJiYgYm94Lm1pbi54IDw9IHRoaXMubWF4LnggJiYKCQkJCWJveC5tYXgueSA+PSB0aGlzLm1pbi55ICYmIGJveC5taW4ueSA8PSB0aGlzLm1heC55ICYmCgkJCQlib3gubWF4LnogPj0gdGhpcy5taW4ueiAmJiBib3gubWluLnogPD0gdGhpcy5tYXguejsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKgoJCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgYm91bmRpbmcgc3BoZXJlIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQkvLyBGaW5kIHRoZSBwb2ludCBvbiB0aGUgQUFCQiBjbG9zZXN0IHRvIHRoZSBzcGhlcmUgY2VudGVyLgoJCQl0aGlzLmNsYW1wUG9pbnQoIHNwaGVyZS5jZW50ZXIsIF92ZWN0b3IkYiApOwoKCQkJLy8gSWYgdGhhdCBwb2ludCBpcyBpbnNpZGUgdGhlIHNwaGVyZSwgdGhlIEFBQkIgYW5kIHNwaGVyZSBpbnRlcnNlY3QuCgkJCXJldHVybiBfdmVjdG9yJGIuZGlzdGFuY2VUb1NxdWFyZWQoIHNwaGVyZS5jZW50ZXIgKSA8PSAoIHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBsYW5lIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcGxhbmUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWludGVyc2VjdHNQbGFuZSggcGxhbmUgKSB7CgoJCQkvLyBXZSBjb21wdXRlIHRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGRvdCBwcm9kdWN0IHZhbHVlcy4gSWYgdGhvc2UgdmFsdWVzCgkJCS8vIGFyZSBvbiB0aGUgc2FtZSBzaWRlIChiYWNrIG9yIGZyb250KSBvZiB0aGUgcGxhbmUsIHRoZW4gdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoKCQkJbGV0IG1pbiwgbWF4OwoKCQkJaWYgKCBwbGFuZS5ub3JtYWwueCA+IDAgKSB7CgoJCQkJbWluID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwoJCQkJbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1heC54OwoKCQkJfSBlbHNlIHsKCgkJCQltaW4gPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWF4Lng7CgkJCQltYXggPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWluLng7CgoJCQl9CgoJCQlpZiAoIHBsYW5lLm5vcm1hbC55ID4gMCApIHsKCgkJCQltaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwoJCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCgkJCX0gZWxzZSB7CgoJCQkJbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCQkJCW1heCArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWluLnk7CgoJCQl9CgoJCQlpZiAoIHBsYW5lLm5vcm1hbC56ID4gMCApIHsKCgkJCQltaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwoJCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKCgkJCX0gZWxzZSB7CgoJCQkJbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKCQkJCW1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CgoJCQl9CgoJCQlyZXR1cm4gKCBtaW4gPD0gLSBwbGFuZS5jb25zdGFudCAmJiBtYXggPj0gLSBwbGFuZS5jb25zdGFudCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge1RyaWFuZ2xlfSB0cmlhbmdsZSAtIFRoZSB0cmlhbmdsZSB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIHRyaWFuZ2xlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlpbnRlcnNlY3RzVHJpYW5nbGUoIHRyaWFuZ2xlICkgewoKCQkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQkvLyBjb21wdXRlIGJveCBjZW50ZXIgYW5kIGV4dGVudHMKCQkJdGhpcy5nZXRDZW50ZXIoIF9jZW50ZXIgKTsKCQkJX2V4dGVudHMuc3ViVmVjdG9ycyggdGhpcy5tYXgsIF9jZW50ZXIgKTsKCgkJCS8vIHRyYW5zbGF0ZSB0cmlhbmdsZSB0byBhYWJiIG9yaWdpbgoJCQlfdjAkMi5zdWJWZWN0b3JzKCB0cmlhbmdsZS5hLCBfY2VudGVyICk7CgkJCV92MSQ3LnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmIsIF9jZW50ZXIgKTsKCQkJX3YyJDQuc3ViVmVjdG9ycyggdHJpYW5nbGUuYywgX2NlbnRlciApOwoKCQkJLy8gY29tcHV0ZSBlZGdlIHZlY3RvcnMgZm9yIHRyaWFuZ2xlCgkJCV9mMC5zdWJWZWN0b3JzKCBfdjEkNywgX3YwJDIgKTsKCQkJX2YxLnN1YlZlY3RvcnMoIF92MiQ0LCBfdjEkNyApOwoJCQlfZjIuc3ViVmVjdG9ycyggX3YwJDIsIF92MiQ0ICk7CgoJCQkvLyB0ZXN0IGFnYWluc3QgYXhlcyB0aGF0IGFyZSBnaXZlbiBieSBjcm9zcyBwcm9kdWN0IGNvbWJpbmF0aW9ucyBvZiB0aGUgZWRnZXMgb2YgdGhlIHRyaWFuZ2xlIGFuZCB0aGUgZWRnZXMgb2YgdGhlIGFhYmIKCQkJLy8gbWFrZSBhbiBheGlzIHRlc3Rpbmcgb2YgZWFjaCBvZiB0aGUgMyBzaWRlcyBvZiB0aGUgYWFiYiBhZ2FpbnN0IGVhY2ggb2YgdGhlIDMgc2lkZXMgb2YgdGhlIHRyaWFuZ2xlID0gOSBheGlzIG9mIHNlcGFyYXRpb24KCQkJLy8gYXhpc19paiA9IHVfaSB4IGZfaiAodTAsIHUxLCB1MiA9IGZhY2Ugbm9ybWFscyBvZiBhYWJiID0geCx5LHogYXhlcyB2ZWN0b3JzIHNpbmNlIGFhYmIgaXMgYXhpcyBhbGlnbmVkKQoJCQlsZXQgYXhlcyA9IFsKCQkJCTAsIC0gX2YwLnosIF9mMC55LCAwLCAtIF9mMS56LCBfZjEueSwgMCwgLSBfZjIueiwgX2YyLnksCgkJCQlfZjAueiwgMCwgLSBfZjAueCwgX2YxLnosIDAsIC0gX2YxLngsIF9mMi56LCAwLCAtIF9mMi54LAoJCQkJLSBfZjAueSwgX2YwLngsIDAsIC0gX2YxLnksIF9mMS54LCAwLCAtIF9mMi55LCBfZjIueCwgMAoJCQldOwoJCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQkvLyB0ZXN0IDMgZmFjZSBub3JtYWxzIGZyb20gdGhlIGFhYmIKCQkJYXhlcyA9IFsgMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSBdOwoJCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQkvLyBmaW5hbGx5IHRlc3RpbmcgdGhlIGZhY2Ugbm9ybWFsIG9mIHRoZSB0cmlhbmdsZQoJCQkvLyB1c2UgYWxyZWFkeSBleGlzdGluZyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMgaGVyZQoJCQlfdHJpYW5nbGVOb3JtYWwuY3Jvc3NWZWN0b3JzKCBfZjAsIF9mMSApOwoJCQlheGVzID0gWyBfdHJpYW5nbGVOb3JtYWwueCwgX3RyaWFuZ2xlTm9ybWFsLnksIF90cmlhbmdsZU5vcm1hbC56IF07CgoJCQlyZXR1cm4gc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKTsKCgkJfQoKCQkvKioKCQkgKiBDbGFtcHMgdGhlIGdpdmVuIHBvaW50IHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjbGFtcC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjbGFtcGVkIHBvaW50LgoJCSAqLwoJCWNsYW1wUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuY2xhbXAoIHRoaXMubWluLCB0aGlzLm1heCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBmcm9tIGFueSBlZGdlIG9mIHRoaXMgYm94IHRvIHRoZSBzcGVjaWZpZWQgcG9pbnQuIElmCgkJICogdGhlIGdpdmVuIHBvaW50IGxpZXMgaW5zaWRlIG9mIHRoaXMgYm94LCB0aGUgZGlzdGFuY2Ugd2lsbCBiZSBgMGAuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIHRoaXMuY2xhbXBQb2ludCggcG9pbnQsIF92ZWN0b3IkYiApLmRpc3RhbmNlVG8oIHBvaW50ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIGJvdW5kaW5nIHNwaGVyZSB0aGF0IGVuY2xvc2VzIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHRhcmdldCAtIFRoZSB0YXJnZXQgc3BoZXJlIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gVGhlIGJvdW5kaW5nIHNwaGVyZSB0aGF0IGVuY2xvc2VzIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWdldEJvdW5kaW5nU3BoZXJlKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJCXRhcmdldC5tYWtlRW1wdHkoKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy5nZXRDZW50ZXIoIHRhcmdldC5jZW50ZXIgKTsKCgkJCQl0YXJnZXQucmFkaXVzID0gdGhpcy5nZXRTaXplKCBfdmVjdG9yJGIgKS5sZW5ndGgoKSAqIDAuNTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBvZiB0aGlzIGJvdW5kaW5nIGJveCBhbmQgdGhlIGdpdmVuIG9uZSwgc2V0dGluZyB0aGUgdXBwZXIKCQkgKiBib3VuZCBvZiB0aGlzIGJveCB0byB0aGUgbGVzc2VyIG9mIHRoZSB0d28gYm94ZXMnIHVwcGVyIGJvdW5kcyBhbmQgdGhlCgkJICogbG93ZXIgYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGdyZWF0ZXIgb2YgdGhlIHR3byBib3hlcycgbG93ZXIgYm91bmRzLiBJZgoJCSAqIHRoZXJlJ3Mgbm8gb3ZlcmxhcCwgbWFrZXMgdGhpcyBib3ggZW1wdHkuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gaW50ZXJzZWN0IHdpdGguCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJaW50ZXJzZWN0KCBib3ggKSB7CgoJCQl0aGlzLm1pbi5tYXgoIGJveC5taW4gKTsKCQkJdGhpcy5tYXgubWluKCBib3gubWF4ICk7CgoJCQkvLyBlbnN1cmUgdGhhdCBpZiB0aGVyZSBpcyBubyBvdmVybGFwLCB0aGUgcmVzdWx0IGlzIGZ1bGx5IGVtcHR5LCBub3Qgc2xpZ2h0bHkgZW1wdHkgd2l0aCBub24taW5mLytpbmYgdmFsdWVzIHRoYXQgd2lsbCBjYXVzZSBzdWJzZXF1ZW5jZSBpbnRlcnNlY3RzIHRvIGVycm9uZW91c2x5IHJldHVybiB2YWxpZCB2YWx1ZXMuCgkJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB0aGlzLm1ha2VFbXB0eSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHVuaW9uIG9mIHRoaXMgYm94IGFuZCBhbm90aGVyIGFuZCB0aGUgZ2l2ZW4gb25lLCBzZXR0aW5nIHRoZSB1cHBlcgoJCSAqIGJvdW5kIG9mIHRoaXMgYm94IHRvIHRoZSBncmVhdGVyIG9mIHRoZSB0d28gYm94ZXMnIHVwcGVyIGJvdW5kcyBhbmQgdGhlCgkJICogbG93ZXIgYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGxlc3NlciBvZiB0aGUgdHdvIGJveGVzJyBsb3dlciBib3VuZHMuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdGhhdCB3aWxsIGJlIHVuaW9uZWQgd2l0aCB0aGlzIGluc3RhbmNlLgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCXVuaW9uKCBib3ggKSB7CgoJCQl0aGlzLm1pbi5taW4oIGJveC5taW4gKTsKCQkJdGhpcy5tYXgubWF4KCBib3gubWF4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2Zvcm1zIHRoaXMgYm91bmRpbmcgYm94IGJ5IHRoZSBnaXZlbiA0eDQgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKCQkJLy8gdHJhbnNmb3JtIG9mIGVtcHR5IGJveCBpcyBhbiBlbXB0eSBib3guCgkJCWlmICggdGhpcy5pc0VtcHR5KCkgKSByZXR1cm4gdGhpczsKCgkJCS8vIE5PVEU6IEkgYW0gdXNpbmcgYSBiaW5hcnkgcGF0dGVybiB0byBzcGVjaWZ5IGFsbCAyXjMgY29tYmluYXRpb25zIGJlbG93CgkJCV9wb2ludHNbIDAgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWluLnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMDAKCQkJX3BvaW50c1sgMSBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAwMQoJCQlfcG9pbnRzWyAyIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1heC55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDEwCgkJCV9wb2ludHNbIDMgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWF4LnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMTEKCQkJX3BvaW50c1sgNCBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDEwMAoJCQlfcG9pbnRzWyA1IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAxCgkJCV9wb2ludHNbIDYgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWF4LnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMTAKCQkJX3BvaW50c1sgNyBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDExMQoKCQkJdGhpcy5zZXRGcm9tUG9pbnRzKCBfcG9pbnRzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiBvZmZzZXQgdG8gYm90aCB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJvdW5kaW5nIGJveCwKCQkgKiBlZmZlY3RpdmVseSBtb3ZpbmcgaXQgaW4gM0Qgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQgdGhhdCBzaG91bGQgYmUgdXNlZCB0byB0cmFuc2xhdGUgdGhlIGJvdW5kaW5nIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQl0cmFuc2xhdGUoIG9mZnNldCApIHsKCgkJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CgkJCXRoaXMubWF4LmFkZCggb2Zmc2V0ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGJvdW5kaW5nIGJveCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGJvdW5kaW5nIGJveCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCBib3ggKSB7CgoJCQlyZXR1cm4gYm94Lm1pbi5lcXVhbHMoIHRoaXMubWluICkgJiYgYm94Lm1heC5lcXVhbHMoIHRoaXMubWF4ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcmV0dXJuIHtPYmplY3R9IFNlcmlhbGl6ZWQgc3RydWN0dXJlIHdpdGggZmllbGRzIHJlcHJlc2VudGluZyB0aGUgb2JqZWN0IHN0YXRlLgoJCSAqLwoJCXRvSlNPTigpIHsKCgkJCXJldHVybiB7CgkJCQltaW46IHRoaXMubWluLnRvQXJyYXkoKSwKCQkJCW1heDogdGhpcy5tYXgudG9BcnJheSgpCgkJCX07CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0ganNvbiAtIFRoZSBzZXJpYWxpemVkIGpzb24gdG8gc2V0IHRoZSBib3ggZnJvbS4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlmcm9tSlNPTigganNvbiApIHsKCgkJCXRoaXMubWluLmZyb21BcnJheSgganNvbi5taW4gKTsKCQkJdGhpcy5tYXguZnJvbUFycmF5KCBqc29uLm1heCApOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgljb25zdCBfcG9pbnRzID0gWwoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkKCV07CgoJY29uc3QgX3ZlY3RvciRiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCWNvbnN0IF9ib3gkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKCgkvLyB0cmlhbmdsZSBjZW50ZXJlZCB2ZXJ0aWNlcwoKCWNvbnN0IF92MCQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3YxJDcgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdjIkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvLyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMKCgljb25zdCBfZjAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZjEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX2NlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9leHRlbnRzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3RyaWFuZ2xlTm9ybWFsID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3Rlc3RBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCWZ1bmN0aW9uIHNhdEZvckF4ZXMoIGF4ZXMsIHYwLCB2MSwgdjIsIGV4dGVudHMgKSB7CgoJCWZvciAoIGxldCBpID0gMCwgaiA9IGF4ZXMubGVuZ3RoIC0gMzsgaSA8PSBqOyBpICs9IDMgKSB7CgoJCQlfdGVzdEF4aXMuZnJvbUFycmF5KCBheGVzLCBpICk7CgkJCS8vIHByb2plY3QgdGhlIGFhYmIgb250byB0aGUgc2VwYXJhdGluZyBheGlzCgkJCWNvbnN0IHIgPSBleHRlbnRzLnggKiBNYXRoLmFicyggX3Rlc3RBeGlzLnggKSArIGV4dGVudHMueSAqIE1hdGguYWJzKCBfdGVzdEF4aXMueSApICsgZXh0ZW50cy56ICogTWF0aC5hYnMoIF90ZXN0QXhpcy56ICk7CgkJCS8vIHByb2plY3QgYWxsIDMgdmVydGljZXMgb2YgdGhlIHRyaWFuZ2xlIG9udG8gdGhlIHNlcGFyYXRpbmcgYXhpcwoJCQljb25zdCBwMCA9IHYwLmRvdCggX3Rlc3RBeGlzICk7CgkJCWNvbnN0IHAxID0gdjEuZG90KCBfdGVzdEF4aXMgKTsKCQkJY29uc3QgcDIgPSB2Mi5kb3QoIF90ZXN0QXhpcyApOwoJCQkvLyBhY3R1YWwgdGVzdCwgYmFzaWNhbGx5IHNlZSBpZiBlaXRoZXIgb2YgdGhlIG1vc3QgZXh0cmVtZSBvZiB0aGUgdHJpYW5nbGUgcG9pbnRzIGludGVyc2VjdHMgcgoJCQlpZiAoIE1hdGgubWF4KCAtIE1hdGgubWF4KCBwMCwgcDEsIHAyICksIE1hdGgubWluKCBwMCwgcDEsIHAyICkgKSA+IHIgKSB7CgoJCQkJLy8gcG9pbnRzIG9mIHRoZSBwcm9qZWN0ZWQgdHJpYW5nbGUgYXJlIG91dHNpZGUgdGhlIHByb2plY3RlZCBoYWxmLWxlbmd0aCBvZiB0aGUgYWFiYgoJCQkJLy8gdGhlIGF4aXMgaXMgc2VwYXJhdGluZyBhbmQgd2UgY2FuIGV4aXQKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJY29uc3QgX2JveCQzID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwoJY29uc3QgX3YxJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdjIkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIEFuIGFuYWx5dGljYWwgM0Qgc3BoZXJlIGRlZmluZWQgYnkgYSBjZW50ZXIgYW5kIHJhZGl1cy4gVGhpcyBjbGFzcyBpcyBtYWlubHkKCSAqIHVzZWQgYXMgYSBCb3VuZGluZyBTcGhlcmUgZm9yIDNEIG9iamVjdHMuCgkgKi8KCWNsYXNzIFNwaGVyZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgc3BoZXJlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbY2VudGVyPSgwLDAsMCldIC0gVGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtyYWRpdXM9LTFdIC0gVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpLCByYWRpdXMgPSAtMSApIHsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzU3BoZXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLmNlbnRlciA9IGNlbnRlcjsKCgkJCS8qKgoJCQkgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBzcGhlcmUncyBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gY2VudGVyIC0gVGhlIGNlbnRlci4KCQkgKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIC0gVGhlIHJhZGl1cy4KCQkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgoJCSAqLwoJCXNldCggY2VudGVyLCByYWRpdXMgKSB7CgoJCQl0aGlzLmNlbnRlci5jb3B5KCBjZW50ZXIgKTsKCQkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgbWluaW11bSBib3VuZGluZyBzcGhlcmUgZm9yIGxpc3Qgb2YgcG9pbnRzLgoJCSAqIElmIHRoZSBvcHRpb25hbCBjZW50ZXIgcG9pbnQgaXMgZ2l2ZW4sIGl0IGlzIHVzZWQgYXMgdGhlIHNwaGVyZSdzCgkJICogY2VudGVyLiBPdGhlcndpc2UsIHRoZSBjZW50ZXIgb2YgdGhlIGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3gKCQkgKiBlbmNvbXBhc3NpbmcgdGhlIHBvaW50cyBpcyBjYWxjdWxhdGVkLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxWZWN0b3IzPn0gcG9pbnRzIC0gQSBsaXN0IG9mIHBvaW50cyBpbiAzRCBzcGFjZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbENlbnRlcl0gLSBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUuCgkJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KCQkgKi8KCQlzZXRGcm9tUG9pbnRzKCBwb2ludHMsIG9wdGlvbmFsQ2VudGVyICkgewoKCQkJY29uc3QgY2VudGVyID0gdGhpcy5jZW50ZXI7CgoJCQlpZiAoIG9wdGlvbmFsQ2VudGVyICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY2VudGVyLmNvcHkoIG9wdGlvbmFsQ2VudGVyICk7CgoJCQl9IGVsc2UgewoKCQkJCV9ib3gkMy5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKS5nZXRDZW50ZXIoIGNlbnRlciApOwoKCQkJfQoKCQkJbGV0IG1heFJhZGl1c1NxID0gMDsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnRzWyBpIF0gKSApOwoKCQkJfQoKCQkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gc3BoZXJlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBjb3B5LgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJY29weSggc3BoZXJlICkgewoKCQkJdGhpcy5jZW50ZXIuY29weSggc3BoZXJlLmNlbnRlciApOwoJCQl0aGlzLnJhZGl1cyA9IHNwaGVyZS5yYWRpdXM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc3BoZXJlIGlzIGVtcHR5ICh0aGUgcmFkaXVzIHNldCB0byBhIG5lZ2F0aXZlIG51bWJlcikuCgkJICoKCQkgKiBTcGhlcmVzIHdpdGggYSByYWRpdXMgb2YgYDBgIGNvbnRhaW4gb25seSB0aGVpciBjZW50ZXIgcG9pbnQgYW5kIGFyZSBub3QKCQkgKiBjb25zaWRlcmVkIHRvIGJlIGVtcHR5LgoJCSAqCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpcyBlbXB0eSBvciBub3QuCgkJICovCgkJaXNFbXB0eSgpIHsKCgkJCXJldHVybiAoIHRoaXMucmFkaXVzIDwgMCApOwoKCQl9CgoJCS8qKgoJCSAqIE1ha2VzIHRoaXMgc3BoZXJlIGVtcHR5IHdoaWNoIG1lYW5zIGluIGVuY2xvc2VzIGEgemVybyBzcGFjZSBpbiAzRC4KCQkgKgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJbWFrZUVtcHR5KCkgewoKCQkJdGhpcy5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJCXRoaXMucmFkaXVzID0gLTE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgaW5jbHVzaXZlIG9mCgkJICogdGhlIHN1cmZhY2Ugb2YgdGhlIHNwaGVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY2hlY2suCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuY2VudGVyICkgPD0gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBjbG9zZXN0IGRpc3RhbmNlIGZyb20gdGhlIGJvdW5kYXJ5IG9mIHRoZSBzcGhlcmUgdG8gdGhlCgkJICogZ2l2ZW4gcG9pbnQuIElmIHRoZSBzcGhlcmUgY29udGFpbnMgdGhlIHBvaW50LCB0aGUgZGlzdGFuY2Ugd2lsbAoJCSAqIGJlIG5lZ2F0aXZlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZSB0byB0aGUgcG9pbnQuCgkJICovCgkJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJCXJldHVybiAoIHBvaW50LmRpc3RhbmNlVG8oIHRoaXMuY2VudGVyICkgLSB0aGlzLnJhZGl1cyApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gb25lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQljb25zdCByYWRpdXNTdW0gPSB0aGlzLnJhZGl1cyArIHNwaGVyZS5yYWRpdXM7CgoJCQlyZXR1cm4gc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHJhZGl1c1N1bSAqIHJhZGl1c1N1bSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94LgoJCSAqCgkJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzU3BoZXJlKCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMuY2VudGVyICkgKSA8PSB0aGlzLnJhZGl1czsKCgkJfQoKCQkvKioKCQkgKiBDbGFtcHMgYSBwb2ludCB3aXRoaW4gdGhlIHNwaGVyZS4gSWYgdGhlIHBvaW50IGlzIG91dHNpZGUgdGhlIHNwaGVyZSwgaXQKCQkgKiB3aWxsIGNsYW1wIGl0IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBlZGdlIG9mIHRoZSBzcGhlcmUuIFBvaW50cwoJCSAqIGFscmVhZHkgaW5zaWRlIHRoZSBzcGhlcmUgd2lsbCBub3QgYmUgYWZmZWN0ZWQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBsYW5lIHRvIGNsYW1wLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsYW1wZWQgcG9pbnQuCgkJICovCgkJY2xhbXBQb2ludCggcG9pbnQsIHRhcmdldCApIHsKCgkJCWNvbnN0IGRlbHRhTGVuZ3RoU3EgPSB0aGlzLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCgkJCXRhcmdldC5jb3B5KCBwb2ludCApOwoKCQkJaWYgKCBkZWx0YUxlbmd0aFNxID4gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKSB7CgoJCQkJdGFyZ2V0LnN1YiggdGhpcy5jZW50ZXIgKS5ub3JtYWxpemUoKTsKCQkJCXRhcmdldC5tdWx0aXBseVNjYWxhciggdGhpcy5yYWRpdXMgKS5hZGQoIHRoaXMuY2VudGVyICk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBib3VuZGluZyBib3ggdGhhdCBlbmNsb3NlcyB0aGlzIHNwaGVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7Qm94M30gdGFyZ2V0IC0gVGhlIHRhcmdldCBib3ggdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7Qm94M30gVGhlIGJvdW5kaW5nIGJveCB0aGF0IGVuY2xvc2VzIHRoaXMgc3BoZXJlLgoJCSAqLwoJCWdldEJvdW5kaW5nQm94KCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJCS8vIEVtcHR5IHNwaGVyZSBwcm9kdWNlcyBlbXB0eSBib3VuZGluZyBib3gKCQkJCXRhcmdldC5tYWtlRW1wdHkoKTsKCQkJCXJldHVybiB0YXJnZXQ7CgoJCQl9CgoJCQl0YXJnZXQuc2V0KCB0aGlzLmNlbnRlciwgdGhpcy5jZW50ZXIgKTsKCQkJdGFyZ2V0LmV4cGFuZEJ5U2NhbGFyKCB0aGlzLnJhZGl1cyApOwoKCQkJcmV0dXJuIHRhcmdldDsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2Zvcm1zIHRoaXMgc3BoZXJlIHdpdGggdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KCQkgKi8KCQlhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJCXRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgkJCXRoaXMucmFkaXVzID0gdGhpcy5yYWRpdXMgKiBtYXRyaXguZ2V0TWF4U2NhbGVPbkF4aXMoKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFRyYW5zbGF0ZXMgdGhlIHNwaGVyZSdzIGNlbnRlciBieSB0aGUgZ2l2ZW4gb2Zmc2V0LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBvZmZzZXQgLSBUaGUgb2Zmc2V0LgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgoJCQl0aGlzLmNlbnRlci5hZGQoIG9mZnNldCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIHNwaGVyZSB0byBpbmNsdWRlIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gaW5jbHVkZS4KCQkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgoJCSAqLwoJCWV4cGFuZEJ5UG9pbnQoIHBvaW50ICkgewoKCQkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCQl0aGlzLmNlbnRlci5jb3B5KCBwb2ludCApOwoKCQkJCXRoaXMucmFkaXVzID0gMDsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCV92MSQ2LnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLmNlbnRlciApOwoKCQkJY29uc3QgbGVuZ3RoU3EgPSBfdjEkNi5sZW5ndGhTcSgpOwoKCQkJaWYgKCBsZW5ndGhTcSA+ICggdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyApICkgewoKCQkJCS8vIGNhbGN1bGF0ZSB0aGUgbWluaW1hbCBzcGhlcmUKCgkJCQljb25zdCBsZW5ndGggPSBNYXRoLnNxcnQoIGxlbmd0aFNxICk7CgoJCQkJY29uc3QgZGVsdGEgPSAoIGxlbmd0aCAtIHRoaXMucmFkaXVzICkgKiAwLjU7CgoJCQkJdGhpcy5jZW50ZXIuYWRkU2NhbGVkVmVjdG9yKCBfdjEkNiwgZGVsdGEgLyBsZW5ndGggKTsKCgkJCQl0aGlzLnJhZGl1cyArPSBkZWx0YTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEV4cGFuZHMgdGhpcyBzcGhlcmUgdG8gZW5jbG9zZSBib3RoIHRoZSBvcmlnaW5hbCBzcGhlcmUgYW5kIHRoZSBnaXZlbiBzcGhlcmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbmNsdWRlLgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJdW5pb24oIHNwaGVyZSApIHsKCgkJCWlmICggc3BoZXJlLmlzRW1wdHkoKSApIHsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgoJCQkJdGhpcy5jb3B5KCBzcGhlcmUgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggdGhpcy5jZW50ZXIuZXF1YWxzKCBzcGhlcmUuY2VudGVyICkgPT09IHRydWUgKSB7CgoJCQkJIHRoaXMucmFkaXVzID0gTWF0aC5tYXgoIHRoaXMucmFkaXVzLCBzcGhlcmUucmFkaXVzICk7CgoJCQl9IGVsc2UgewoKCQkJCV92MiQzLnN1YlZlY3RvcnMoIHNwaGVyZS5jZW50ZXIsIHRoaXMuY2VudGVyICkuc2V0TGVuZ3RoKCBzcGhlcmUucmFkaXVzICk7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuYWRkKCBfdjIkMyApICk7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuc3ViKCBfdjIkMyApICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgc3BoZXJlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIHNwaGVyZSApIHsKCgkJCXJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyggdGhpcy5jZW50ZXIgKSAmJiAoIHNwaGVyZS5yYWRpdXMgPT09IHRoaXMucmFkaXVzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBzcGhlcmUgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBzZXJpYWxpemVkIHN0cnVjdHVyZSBvZiB0aGUgYm91bmRpbmcgc3BoZXJlLgoJCSAqCgkJICogQHJldHVybiB7T2JqZWN0fSBTZXJpYWxpemVkIHN0cnVjdHVyZSB3aXRoIGZpZWxkcyByZXByZXNlbnRpbmcgdGhlIG9iamVjdCBzdGF0ZS4KCQkgKi8KCQl0b0pTT04oKSB7CgoJCQlyZXR1cm4gewoJCQkJcmFkaXVzOiB0aGlzLnJhZGl1cywKCQkJCWNlbnRlcjogdGhpcy5jZW50ZXIudG9BcnJheSgpCgkJCX07CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBzcGhlcmUuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0ganNvbiAtIFRoZSBzZXJpYWxpemVkIGpzb24gdG8gc2V0IHRoZSBzcGhlcmUgZnJvbS4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIHNwaGVyZS4KCQkgKi8KCQlmcm9tSlNPTigganNvbiApIHsKCgkJCXRoaXMucmFkaXVzID0ganNvbi5yYWRpdXM7CgkJCXRoaXMuY2VudGVyLmZyb21BcnJheSgganNvbi5jZW50ZXIgKTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9CgoJY29uc3QgX3ZlY3RvciRhID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3NlZ0NlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9zZWdEaXIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZGlmZiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfZWRnZTEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZWRnZTIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfbm9ybWFsJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJLyoqCgkgKiBBIHJheSB0aGF0IGVtaXRzIGZyb20gYW4gb3JpZ2luIGluIGEgY2VydGFpbiBkaXJlY3Rpb24uIFRoZSBjbGFzcyBpcyB1c2VkIGJ5CgkgKiB7QGxpbmsgUmF5Y2FzdGVyfSB0byBhc3Npc3Qgd2l0aCByYXljYXN0aW5nLiBSYXljYXN0aW5nIGlzIHVzZWQgZm9yCgkgKiBtb3VzZSBwaWNraW5nICh3b3JraW5nIG91dCB3aGF0IG9iamVjdHMgaW4gdGhlIDNEIHNwYWNlIHRoZSBtb3VzZSBpcyBvdmVyKQoJICogYW1vbmdzdCBvdGhlciB0aGluZ3MuCgkgKi8KCWNsYXNzIFJheSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgcmF5LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbb3JpZ2luPSgwLDAsMCldIC0gVGhlIG9yaWdpbiBvZiB0aGUgcmF5LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gW2RpcmVjdGlvbj0oMCwwLC0xKV0gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiBvZiB0aGUgcmF5LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBvcmlnaW4gPSBuZXcgVmVjdG9yMygpLCBkaXJlY3Rpb24gPSBuZXcgVmVjdG9yMyggMCwgMCwgLTEgKSApIHsKCgkJCS8qKgoJCQkgKiBUaGUgb3JpZ2luIG9mIHRoZSByYXkuCgkJCSAqCgkJCSAqIEB0eXBlIHtWZWN0b3IzfQoJCQkgKi8KCQkJdGhpcy5vcmlnaW4gPSBvcmlnaW47CgoJCQkvKioKCQkJICogVGhlIChub3JtYWxpemVkKSBkaXJlY3Rpb24gb2YgdGhlIHJheS4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSByYXkncyBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gb3JpZ2luIC0gVGhlIG9yaWdpbi4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGRpcmVjdGlvbiAtIFRoZSBkaXJlY3Rpb24uCgkJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KCQkgKi8KCQlzZXQoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKCQkJdGhpcy5vcmlnaW4uY29weSggb3JpZ2luICk7CgkJCXRoaXMuZGlyZWN0aW9uLmNvcHkoIGRpcmVjdGlvbiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIHJheSB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtSYXl9IHJheSAtIFRoZSByYXkgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtSYXl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcmF5LgoJCSAqLwoJCWNvcHkoIHJheSApIHsKCgkJCXRoaXMub3JpZ2luLmNvcHkoIHJheS5vcmlnaW4gKTsKCQkJdGhpcy5kaXJlY3Rpb24uY29weSggcmF5LmRpcmVjdGlvbiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHZlY3RvciB0aGF0IGlzIGxvY2F0ZWQgYXQgYSBnaXZlbiBkaXN0YW5jZSBhbG9uZyB0aGlzIHJheS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGRpc3RhbmNlIGFsb25nIHRoZSByYXkgdG8gcmV0cmlldmUgYSBwb3NpdGlvbiBmb3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHBvc2l0aW9uIG9uIHRoZSByYXkuCgkJICovCgkJYXQoIHQsIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCB0ICk7CgoJCX0KCgkJLyoqCgkJICogQWRqdXN0cyB0aGUgZGlyZWN0aW9uIG9mIHRoZSByYXkgdG8gcG9pbnQgYXQgdGhlIGdpdmVuIHZlY3RvciBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB0YXJnZXQgcG9zaXRpb24uCgkJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KCQkgKi8KCQlsb29rQXQoIHYgKSB7CgoJCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCB2ICkuc3ViKCB0aGlzLm9yaWdpbiApLm5vcm1hbGl6ZSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2hpZnQgdGhlIG9yaWdpbiBvZiB0aGlzIHJheSBhbG9uZyBpdHMgZGlyZWN0aW9uIGJ5IHRoZSBnaXZlbiBkaXN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGRpc3RhbmNlIGFsb25nIHRoZSByYXkgdG8gaW50ZXJwb2xhdGUuCgkJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KCQkgKi8KCQlyZWNhc3QoIHQgKSB7CgoJCQl0aGlzLm9yaWdpbi5jb3B5KCB0aGlzLmF0KCB0LCBfdmVjdG9yJGEgKSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgcG9pbnQgYWxvbmcgdGhpcyByYXkgdGhhdCBpcyBjbG9zZXN0IHRvIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGdldCB0aGUgY2xvc2V0IGxvY2F0aW9uIG9uIHRoZSByYXkgZm9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhpcyByYXkuCgkJICovCgkJY2xvc2VzdFBvaW50VG9Qb2ludCggcG9pbnQsIHRhcmdldCApIHsKCgkJCXRhcmdldC5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKTsKCgkJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gdGFyZ2V0LmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCWlmICggZGlyZWN0aW9uRGlzdGFuY2UgPCAwICkgewoKCQkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBkaXJlY3Rpb25EaXN0YW5jZSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGRpc3RhbmNlIG9mIHRoZSBjbG9zZXN0IGFwcHJvYWNoIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSB7CgoJCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgc3F1YXJlZCBkaXN0YW5jZSBvZiB0aGUgY2xvc2VzdCBhcHByb2FjaCBiZXR3ZWVuIHRoaXMgcmF5IGFuZCB0aGUgZ2l2ZW4gcG9pbnQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBwb2ludCBpbiAzRCBzcGFjZSB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApIHsKCgkJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gX3ZlY3RvciRhLnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLm9yaWdpbiApLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCS8vIHBvaW50IGJlaGluZCB0aGUgcmF5CgoJCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCgkJCQlyZXR1cm4gdGhpcy5vcmlnaW4uZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCQl9CgoJCQlfdmVjdG9yJGEuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBkaXJlY3Rpb25EaXN0YW5jZSApOwoKCQkJcmV0dXJuIF92ZWN0b3IkYS5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBzcXVhcmVkIGRpc3RhbmNlIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYwIC0gVGhlIHN0YXJ0IHBvaW50IG9mIHRoZSBsaW5lIHNlZ21lbnQuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2MSAtIFRoZSBlbmQgcG9pbnQgb2YgdGhlIGxpbmUgc2VnbWVudC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbFBvaW50T25SYXldIC0gV2hlbiBwcm92aWRlZCwgaXQgcmVjZWl2ZXMgdGhlIHBvaW50IG9uIHRoaXMgcmF5IHRoYXQgaXMgY2xvc2VzdCB0byB0aGUgc2VnbWVudC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbFBvaW50T25TZWdtZW50XSAtIFdoZW4gcHJvdmlkZWQsIGl0IHJlY2VpdmVzIHRoZSBwb2ludCBvbiB0aGUgbGluZSBzZWdtZW50IHRoYXQgaXMgY2xvc2VzdCB0byB0aGlzIHJheS4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlU3FUb1NlZ21lbnQoIHYwLCB2MSwgb3B0aW9uYWxQb2ludE9uUmF5LCBvcHRpb25hbFBvaW50T25TZWdtZW50ICkgewoKCQkJLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vcG1qb25pYWsvR2VvbWV0cmljVG9vbHMvYmxvYi9tYXN0ZXIvR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVEaXN0UmF5U2VnbWVudC5oCgkJCS8vIEl0IHJldHVybnMgdGhlIG1pbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSByYXkgYW5kIHRoZSBzZWdtZW50CgkJCS8vIGRlZmluZWQgYnkgdjAgYW5kIHYxCgkJCS8vIEl0IGNhbiBhbHNvIHNldCB0d28gb3B0aW9uYWwgdGFyZ2V0cyA6CgkJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHJheQoJCQkvLyAtIFRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzZWdtZW50CgoJCQlfc2VnQ2VudGVyLmNvcHkoIHYwICkuYWRkKCB2MSApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCQkJX3NlZ0Rpci5jb3B5KCB2MSApLnN1YiggdjAgKS5ub3JtYWxpemUoKTsKCQkJX2RpZmYuY29weSggdGhpcy5vcmlnaW4gKS5zdWIoIF9zZWdDZW50ZXIgKTsKCgkJCWNvbnN0IHNlZ0V4dGVudCA9IHYwLmRpc3RhbmNlVG8oIHYxICkgKiAwLjU7CgkJCWNvbnN0IGEwMSA9IC0gdGhpcy5kaXJlY3Rpb24uZG90KCBfc2VnRGlyICk7CgkJCWNvbnN0IGIwID0gX2RpZmYuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoJCQljb25zdCBiMSA9IC0gX2RpZmYuZG90KCBfc2VnRGlyICk7CgkJCWNvbnN0IGMgPSBfZGlmZi5sZW5ndGhTcSgpOwoJCQljb25zdCBkZXQgPSBNYXRoLmFicyggMSAtIGEwMSAqIGEwMSApOwoJCQlsZXQgczAsIHMxLCBzcXJEaXN0LCBleHREZXQ7CgoJCQlpZiAoIGRldCA+IDAgKSB7CgoJCQkJLy8gVGhlIHJheSBhbmQgc2VnbWVudCBhcmUgbm90IHBhcmFsbGVsLgoKCQkJCXMwID0gYTAxICogYjEgLSBiMDsKCQkJCXMxID0gYTAxICogYjAgLSBiMTsKCQkJCWV4dERldCA9IHNlZ0V4dGVudCAqIGRldDsKCgkJCQlpZiAoIHMwID49IDAgKSB7CgoJCQkJCWlmICggczEgPj0gLSBleHREZXQgKSB7CgoJCQkJCQlpZiAoIHMxIDw9IGV4dERldCApIHsKCgkJCQkJCQkvLyByZWdpb24gMAoJCQkJCQkJLy8gTWluaW11bSBhdCBpbnRlcmlvciBwb2ludHMgb2YgcmF5IGFuZCBzZWdtZW50LgoKCQkJCQkJCWNvbnN0IGludkRldCA9IDEgLyBkZXQ7CgkJCQkJCQlzMCAqPSBpbnZEZXQ7CgkJCQkJCQlzMSAqPSBpbnZEZXQ7CgkJCQkJCQlzcXJEaXN0ID0gczAgKiAoIHMwICsgYTAxICogczEgKyAyICogYjAgKSArIHMxICogKCBhMDEgKiBzMCArIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyByZWdpb24gMQoKCQkJCQkJCXMxID0gc2VnRXh0ZW50OwoJCQkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHJlZ2lvbiA1CgoJCQkJCQlzMSA9IC0gc2VnRXh0ZW50OwoJCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CgkJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIHMxIDw9IC0gZXh0RGV0ICkgewoKCQkJCQkJLy8gcmVnaW9uIDQKCgkJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCAtIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKCQkJCQkJczEgPSAoIHMwID4gMCApID8gLSBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQl9IGVsc2UgaWYgKCBzMSA8PSBleHREZXQgKSB7CgoJCQkJCQkvLyByZWdpb24gMwoKCQkJCQkJczAgPSAwOwoJCQkJCQlzMSA9IE1hdGgubWluKCBNYXRoLm1heCggLSBzZWdFeHRlbnQsIC0gYjEgKSwgc2VnRXh0ZW50ICk7CgkJCQkJCXNxckRpc3QgPSBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyByZWdpb24gMgoKCQkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKCQkJCQkJczEgPSAoIHMwID4gMCApID8gc2VnRXh0ZW50IDogTWF0aC5taW4oIE1hdGgubWF4KCAtIHNlZ0V4dGVudCwgLSBiMSApLCBzZWdFeHRlbnQgKTsKCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gUmF5IGFuZCBzZWdtZW50IGFyZSBwYXJhbGxlbC4KCgkJCQlzMSA9ICggYTAxID4gMCApID8gLSBzZWdFeHRlbnQgOiBzZWdFeHRlbnQ7CgkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CgkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJfQoKCQkJaWYgKCBvcHRpb25hbFBvaW50T25SYXkgKSB7CgoJCQkJb3B0aW9uYWxQb2ludE9uUmF5LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgczAgKTsKCgkJCX0KCgkJCWlmICggb3B0aW9uYWxQb2ludE9uU2VnbWVudCApIHsKCgkJCQlvcHRpb25hbFBvaW50T25TZWdtZW50LmNvcHkoIF9zZWdDZW50ZXIgKS5hZGRTY2FsZWRWZWN0b3IoIF9zZWdEaXIsIHMxICk7CgoJCQl9CgoJCQlyZXR1cm4gc3FyRGlzdDsKCgkJfQoKCQkvKioKCQkgKiBJbnRlcnNlY3RzIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIHNwaGVyZSwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KCQkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gaW50ZXJzZWN0LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCgkJICovCgkJaW50ZXJzZWN0U3BoZXJlKCBzcGhlcmUsIHRhcmdldCApIHsKCgkJCV92ZWN0b3IkYS5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLm9yaWdpbiApOwoJCQljb25zdCB0Y2EgPSBfdmVjdG9yJGEuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoJCQljb25zdCBkMiA9IF92ZWN0b3IkYS5kb3QoIF92ZWN0b3IkYSApIC0gdGNhICogdGNhOwoJCQljb25zdCByYWRpdXMyID0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CgoJCQlpZiAoIGQyID4gcmFkaXVzMiApIHJldHVybiBudWxsOwoKCQkJY29uc3QgdGhjID0gTWF0aC5zcXJ0KCByYWRpdXMyIC0gZDIgKTsKCgkJCS8vIHQwID0gZmlyc3QgaW50ZXJzZWN0IHBvaW50IC0gZW50cmFuY2Ugb24gZnJvbnQgb2Ygc3BoZXJlCgkJCWNvbnN0IHQwID0gdGNhIC0gdGhjOwoKCQkJLy8gdDEgPSBzZWNvbmQgaW50ZXJzZWN0IHBvaW50IC0gZXhpdCBwb2ludCBvbiBiYWNrIG9mIHNwaGVyZQoJCQljb25zdCB0MSA9IHRjYSArIHRoYzsKCgkJCS8vIHRlc3QgdG8gc2VlIGlmIHQxIGlzIGJlaGluZCB0aGUgcmF5IC0gaWYgc28sIHJldHVybiBudWxsCgkJCWlmICggdDEgPCAwICkgcmV0dXJuIG51bGw7CgoJCQkvLyB0ZXN0IHRvIHNlZSBpZiB0MCBpcyBiZWhpbmQgdGhlIHJheToKCQkJLy8gaWYgaXQgaXMsIHRoZSByYXkgaXMgaW5zaWRlIHRoZSBzcGhlcmUsIHNvIHJldHVybiB0aGUgc2Vjb25kIGV4aXQgcG9pbnQgc2NhbGVkIGJ5IHQxLAoJCQkvLyBpbiBvcmRlciB0byBhbHdheXMgcmV0dXJuIGFuIGludGVyc2VjdCBwb2ludCB0aGF0IGlzIGluIGZyb250IG9mIHRoZSByYXkuCgkJCWlmICggdDAgPCAwICkgcmV0dXJuIHRoaXMuYXQoIHQxLCB0YXJnZXQgKTsKCgkJCS8vIGVsc2UgdDAgaXMgaW4gZnJvbnQgb2YgdGhlIHJheSwgc28gcmV0dXJuIHRoZSBmaXJzdCBjb2xsaXNpb24gcG9pbnQgc2NhbGVkIGJ5IHQwCgkJCXJldHVybiB0aGlzLmF0KCB0MCwgdGFyZ2V0ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBzcGhlcmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbnRlcnNlY3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKCQkJaWYgKCBzcGhlcmUucmFkaXVzIDwgMCApIHJldHVybiBmYWxzZTsgLy8gaGFuZGxlIGVtcHR5IHNwaGVyZXMsIHNlZSAjMzExODcKCgkJCXJldHVybiB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgPD0gKCBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1cyApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSByYXkncyBvcmlnaW4gdG8gdGhlIGdpdmVuIHBsYW5lLiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgcmF5CgkJICogZG9lcyBub3QgaW50ZXJzZWN0IHdpdGggdGhlIHBsYW5lLgoJCSAqCgkJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgdG8uCgkJICogQHJldHVybiB7P251bWJlcn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZSBvciBub3QuCgkJICovCgkJZGlzdGFuY2VUb1BsYW5lKCBwbGFuZSApIHsKCgkJCWNvbnN0IGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgoJCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgoJCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICkgPT09IDAgKSB7CgoJCQkJCXJldHVybiAwOwoKCQkJCX0KCgkJCQkvLyBOdWxsIGlzIHByZWZlcmFibGUgdG8gdW5kZWZpbmVkIHNpbmNlIHVuZGVmaW5lZCBtZWFucy4uLi4gaXQgaXMgdW5kZWZpbmVkCgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQljb25zdCB0ID0gLSAoIHRoaXMub3JpZ2luLmRvdCggcGxhbmUubm9ybWFsICkgKyBwbGFuZS5jb25zdGFudCApIC8gZGVub21pbmF0b3I7CgoJCQkvLyBSZXR1cm4gaWYgdGhlIHJheSBuZXZlciBpbnRlcnNlY3RzIHRoZSBwbGFuZQoKCQkJcmV0dXJuIHQgPj0gMCA/IHQgOiBudWxsOwoKCQl9CgoJCS8qKgoJCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUsIHJldHVybmluZyB0aGUgaW50ZXJzZWN0aW9uCgkJICogcG9pbnQgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGludGVyc2VjdC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJzZWN0aW9uIHBvaW50LgoJCSAqLwoJCWludGVyc2VjdFBsYW5lKCBwbGFuZSwgdGFyZ2V0ICkgewoKCQkJY29uc3QgdCA9IHRoaXMuZGlzdGFuY2VUb1BsYW5lKCBwbGFuZSApOwoKCQkJaWYgKCB0ID09PSBudWxsICkgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuYXQoIHQsIHRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byBpbnRlcnNlY3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQkJLy8gY2hlY2sgaWYgdGhlIHJheSBsaWVzIG9uIHRoZSBwbGFuZSBmaXJzdAoKCQkJY29uc3QgZGlzdFRvUG9pbnQgPSBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICk7CgoJCQlpZiAoIGRpc3RUb1BvaW50ID09PSAwICkgewoKCQkJCXJldHVybiB0cnVlOwoKCQkJfQoKCQkJY29uc3QgZGVub21pbmF0b3IgPSBwbGFuZS5ub3JtYWwuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKCQkJaWYgKCBkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCApIHsKCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCS8vIHJheSBvcmlnaW4gaXMgYmVoaW5kIHRoZSBwbGFuZSAoYW5kIGlzIHBvaW50aW5nIGJlaGluZCBpdCkKCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQkvKioKCQkgKiBJbnRlcnNlY3RzIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIGJvdW5kaW5nIGJveCwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KCQkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIGludGVyc2VjdC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJzZWN0aW9uIHBvaW50LgoJCSAqLwoJCWludGVyc2VjdEJveCggYm94LCB0YXJnZXQgKSB7CgoJCQlsZXQgdG1pbiwgdG1heCwgdHltaW4sIHR5bWF4LCB0em1pbiwgdHptYXg7CgoJCQljb25zdCBpbnZkaXJ4ID0gMSAvIHRoaXMuZGlyZWN0aW9uLngsCgkJCQlpbnZkaXJ5ID0gMSAvIHRoaXMuZGlyZWN0aW9uLnksCgkJCQlpbnZkaXJ6ID0gMSAvIHRoaXMuZGlyZWN0aW9uLno7CgoJCQljb25zdCBvcmlnaW4gPSB0aGlzLm9yaWdpbjsKCgkJCWlmICggaW52ZGlyeCA+PSAwICkgewoKCQkJCXRtaW4gPSAoIGJveC5taW4ueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQkJdG1heCA9ICggYm94Lm1heC54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgoJCQl9IGVsc2UgewoKCQkJCXRtaW4gPSAoIGJveC5tYXgueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQkJdG1heCA9ICggYm94Lm1pbi54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgoJCQl9CgoJCQlpZiAoIGludmRpcnkgPj0gMCApIHsKCgkJCQl0eW1pbiA9ICggYm94Lm1pbi55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgkJCQl0eW1heCA9ICggYm94Lm1heC55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgoJCQl9IGVsc2UgewoKCQkJCXR5bWluID0gKCBib3gubWF4LnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCQkJCXR5bWF4ID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCgkJCX0KCgkJCWlmICggKCB0bWluID4gdHltYXggKSB8fCAoIHR5bWluID4gdG1heCApICkgcmV0dXJuIG51bGw7CgoJCQlpZiAoIHR5bWluID4gdG1pbiB8fCBpc05hTiggdG1pbiApICkgdG1pbiA9IHR5bWluOwoKCQkJaWYgKCB0eW1heCA8IHRtYXggfHwgaXNOYU4oIHRtYXggKSApIHRtYXggPSB0eW1heDsKCgkJCWlmICggaW52ZGlyeiA+PSAwICkgewoKCQkJCXR6bWluID0gKCBib3gubWluLnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCQkJCXR6bWF4ID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCgkJCX0gZWxzZSB7CgoJCQkJdHptaW4gPSAoIGJveC5tYXgueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoJCQkJdHptYXggPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKCQkJfQoKCQkJaWYgKCAoIHRtaW4gPiB0em1heCApIHx8ICggdHptaW4gPiB0bWF4ICkgKSByZXR1cm4gbnVsbDsKCgkJCWlmICggdHptaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4gKSB0bWluID0gdHptaW47CgoJCQlpZiAoIHR6bWF4IDwgdG1heCB8fCB0bWF4ICE9PSB0bWF4ICkgdG1heCA9IHR6bWF4OwoKCQkJLy9yZXR1cm4gcG9pbnQgY2xvc2VzdCB0byB0aGUgcmF5IChwb3NpdGl2ZSBzaWRlKQoKCQkJaWYgKCB0bWF4IDwgMCApIHJldHVybiBudWxsOwoKCQkJcmV0dXJuIHRoaXMuYXQoIHRtaW4gPj0gMCA/IHRtaW4gOiB0bWF4LCB0YXJnZXQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveC4KCQkgKgoJCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBpbnRlcnNlY3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0Qm94KCBib3gsIF92ZWN0b3IkYSApICE9PSBudWxsOwoKCQl9CgoJCS8qKgoJCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gdHJpYW5nbGUsIHJldHVybmluZyB0aGUgaW50ZXJzZWN0aW9uCgkJICogcG9pbnQgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZXJ0ZXggb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVydGV4IG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgdmVydGV4IG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IGJhY2tmYWNlQ3VsbGluZyAtIFdoZXRoZXIgdG8gdXNlIGJhY2tmYWNlIGN1bGxpbmcgb3Igbm90LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCgkJICovCgkJaW50ZXJzZWN0VHJpYW5nbGUoIGEsIGIsIGMsIGJhY2tmYWNlQ3VsbGluZywgdGFyZ2V0ICkgewoKCQkJLy8gQ29tcHV0ZSB0aGUgb2Zmc2V0IG9yaWdpbiwgZWRnZXMsIGFuZCBub3JtYWwuCgoJCQkvLyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9wbWpvbmlhay9HZW9tZXRyaWNUb29scy9ibG9iL21hc3Rlci9HVEVuZ2luZS9JbmNsdWRlL01hdGhlbWF0aWNzL0d0ZUludHJSYXkzVHJpYW5nbGUzLmgKCgkJCV9lZGdlMS5zdWJWZWN0b3JzKCBiLCBhICk7CgkJCV9lZGdlMi5zdWJWZWN0b3JzKCBjLCBhICk7CgkJCV9ub3JtYWwkMS5jcm9zc1ZlY3RvcnMoIF9lZGdlMSwgX2VkZ2UyICk7CgoJCQkvLyBTb2x2ZSBRICsgdCpEID0gYjEqRTEgKyBiMipFMiAoUSA9IGtEaWZmLCBEID0gcmF5IGRpcmVjdGlvbiwKCQkJLy8gRTEgPSBrRWRnZTEsIEUyID0ga0VkZ2UyLCBOID0gQ3Jvc3MoRTEsRTIpKSBieQoJCQkvLyAgIHxEb3QoRCxOKXwqYjEgPSBzaWduKERvdChELE4pKSpEb3QoRCxDcm9zcyhRLEUyKSkKCQkJLy8gICB8RG90KEQsTil8KmIyID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoRTEsUSkpCgkJCS8vICAgfERvdChELE4pfCp0ID0gLXNpZ24oRG90KEQsTikpKkRvdChRLE4pCgkJCWxldCBEZE4gPSB0aGlzLmRpcmVjdGlvbi5kb3QoIF9ub3JtYWwkMSApOwoJCQlsZXQgc2lnbjsKCgkJCWlmICggRGROID4gMCApIHsKCgkJCQlpZiAoIGJhY2tmYWNlQ3VsbGluZyApIHJldHVybiBudWxsOwoJCQkJc2lnbiA9IDE7CgoJCQl9IGVsc2UgaWYgKCBEZE4gPCAwICkgewoKCQkJCXNpZ24gPSAtMTsKCQkJCURkTiA9IC0gRGROOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCV9kaWZmLnN1YlZlY3RvcnMoIHRoaXMub3JpZ2luLCBhICk7CgkJCWNvbnN0IERkUXhFMiA9IHNpZ24gKiB0aGlzLmRpcmVjdGlvbi5kb3QoIF9lZGdlMi5jcm9zc1ZlY3RvcnMoIF9kaWZmLCBfZWRnZTIgKSApOwoKCQkJLy8gYjEgPCAwLCBubyBpbnRlcnNlY3Rpb24KCQkJaWYgKCBEZFF4RTIgPCAwICkgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJY29uc3QgRGRFMXhRID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UxLmNyb3NzKCBfZGlmZiApICk7CgoJCQkvLyBiMiA8IDAsIG5vIGludGVyc2VjdGlvbgoJCQlpZiAoIERkRTF4USA8IDAgKSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQkvLyBiMStiMiA+IDEsIG5vIGludGVyc2VjdGlvbgoJCQlpZiAoIERkUXhFMiArIERkRTF4USA+IERkTiApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCS8vIExpbmUgaW50ZXJzZWN0cyB0cmlhbmdsZSwgY2hlY2sgaWYgcmF5IGRvZXMuCgkJCWNvbnN0IFFkTiA9IC0gc2lnbiAqIF9kaWZmLmRvdCggX25vcm1hbCQxICk7CgoJCQkvLyB0IDwgMCwgbm8gaW50ZXJzZWN0aW9uCgkJCWlmICggUWROIDwgMCApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCS8vIFJheSBpbnRlcnNlY3RzIHRyaWFuZ2xlLgoJCQlyZXR1cm4gdGhpcy5hdCggUWROIC8gRGROLCB0YXJnZXQgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2Zvcm1zIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeDQgLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqIEByZXR1cm4ge1JheX0gQSByZWZlcmVuY2UgdG8gdGhpcyByYXkuCgkJICovCgkJYXBwbHlNYXRyaXg0KCBtYXRyaXg0ICkgewoKCQkJdGhpcy5vcmlnaW4uYXBwbHlNYXRyaXg0KCBtYXRyaXg0ICk7CgkJCXRoaXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4NCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtSYXl9IHJheSAtIFRoZSByYXkgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCByYXkgKSB7CgoJCQlyZXR1cm4gcmF5Lm9yaWdpbi5lcXVhbHMoIHRoaXMub3JpZ2luICkgJiYgcmF5LmRpcmVjdGlvbi5lcXVhbHMoIHRoaXMuZGlyZWN0aW9uICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyByYXkgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge1JheX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJfQoKCS8qKgoJICogUmVwcmVzZW50cyBhIDR4NCBtYXRyaXguCgkgKgoJICogVGhlIG1vc3QgY29tbW9uIHVzZSBvZiBhIDR4NCBtYXRyaXggaW4gM0QgY29tcHV0ZXIgZ3JhcGhpY3MgaXMgYXMgYSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkgKiBGb3IgYW4gaW50cm9kdWN0aW9uIHRvIHRyYW5zZm9ybWF0aW9uIG1hdHJpY2VzIGFzIHVzZWQgaW4gV2ViR0wsIGNoZWNrIG91dCBbdGhpcyB0dXRvcmlhbF17QGxpbmsgaHR0cHM6Ly93d3cub3BlbmdsLXR1dG9yaWFsLm9yZy9iZWdpbm5lcnMtdHV0b3JpYWxzL3R1dG9yaWFsLTMtbWF0cmljZXN9CgkgKgoJICogVGhpcyBhbGxvd3MgYSAzRCB2ZWN0b3IgcmVwcmVzZW50aW5nIGEgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdW5kZXJnbwoJICogdHJhbnNmb3JtYXRpb25zIHN1Y2ggYXMgdHJhbnNsYXRpb24sIHJvdGF0aW9uLCBzaGVhciwgc2NhbGUsIHJlZmxlY3Rpb24sCgkgKiBvcnRob2dvbmFsIG9yIHBlcnNwZWN0aXZlIHByb2plY3Rpb24gYW5kIHNvIG9uLCBieSBiZWluZyBtdWx0aXBsaWVkIGJ5IHRoZQoJICogbWF0cml4LiBUaGlzIGlzIGtub3duIGFzIGBhcHBseWluZ2AgdGhlIG1hdHJpeCB0byB0aGUgdmVjdG9yLgoJICoKCSAqIEEgTm90ZSBvbiBSb3ctTWFqb3IgYW5kIENvbHVtbi1NYWpvciBPcmRlcmluZzoKCSAqCgkgKiBUaGUgY29uc3RydWN0b3IgYW5kIHtAbGluayBNYXRyaXgzI3NldH0gbWV0aG9kIHRha2UgYXJndW1lbnRzIGluCgkgKiBbcm93LW1ham9yXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3ctX2FuZF9jb2x1bW4tbWFqb3Jfb3JkZXIjQ29sdW1uLW1ham9yX29yZGVyfQoJICogb3JkZXIsIHdoaWxlIGludGVybmFsbHkgdGhleSBhcmUgc3RvcmVkIGluIHRoZSB7QGxpbmsgTWF0cml4MyNlbGVtZW50c30gYXJyYXkgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJICogVGhpcyBtZWFucyB0aGF0IGNhbGxpbmc6CgkgKiBgYGBqcwoJICogY29uc3QgbSA9IG5ldyBUSFJFRS5NYXRyaXg0KCk7CgkgKiBtLnNldCggMTEsIDEyLCAxMywgMTQsCgkgKiAgICAgICAgMjEsIDIyLCAyMywgMjQsCgkgKiAgICAgICAgMzEsIDMyLCAzMywgMzQsCgkgKiAgICAgICAgNDEsIDQyLCA0MywgNDQgKTsKCSAqIGBgYAoJICogd2lsbCByZXN1bHQgaW4gdGhlIGVsZW1lbnRzIGFycmF5IGNvbnRhaW5pbmc6CgkgKiBgYGBqcwoJICogbS5lbGVtZW50cyA9IFsgMTEsIDIxLCAzMSwgNDEsCgkgKiAgICAgICAgICAgICAgICAxMiwgMjIsIDMyLCA0MiwKCSAqICAgICAgICAgICAgICAgIDEzLCAyMywgMzMsIDQzLAoJICogICAgICAgICAgICAgICAgMTQsIDI0LCAzNCwgNDQgXTsKCSAqIGBgYAoJICogYW5kIGludGVybmFsbHkgYWxsIGNhbGN1bGF0aW9ucyBhcmUgcGVyZm9ybWVkIHVzaW5nIGNvbHVtbi1tYWpvciBvcmRlcmluZy4KCSAqIEhvd2V2ZXIsIGFzIHRoZSBhY3R1YWwgb3JkZXJpbmcgbWFrZXMgbm8gZGlmZmVyZW5jZSBtYXRoZW1hdGljYWxseSBhbmQKCSAqIG1vc3QgcGVvcGxlIGFyZSB1c2VkIHRvIHRoaW5raW5nIGFib3V0IG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlciwgdGhlCgkgKiB0aHJlZS5qcyBkb2N1bWVudGF0aW9uIHNob3dzIG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlci4gSnVzdCBiZWFyIGluCgkgKiBtaW5kIHRoYXQgaWYgeW91IGFyZSByZWFkaW5nIHRoZSBzb3VyY2UgY29kZSwgeW91J2xsIGhhdmUgdG8gdGFrZSB0aGUKCSAqIHRyYW5zcG9zZSBvZiBhbnkgbWF0cmljZXMgb3V0bGluZWQgaGVyZSB0byBtYWtlIHNlbnNlIG9mIHRoZSBjYWxjdWxhdGlvbnMuCgkgKi8KCWNsYXNzIE1hdHJpeDQgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IDR4NCBtYXRyaXguIFRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCgkJICogaW4gcm93LW1ham9yIG9yZGVyLiBJZiBubyBhcmd1bWVudHMgYXJlIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0b3IKCQkgKiBpbml0aWFsaXplcyB0aGUgbWF0cml4IGFzIGFuIGlkZW50aXR5IG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjExXSAtIDEtMSBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24xMl0gLSAxLTIgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTNdIC0gMS0zIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjE0XSAtIDEtNCBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yNF0gLSAyLTQgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzRdIC0gMy00IG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQxXSAtIDQtMSBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW240Ml0gLSA0LTIgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuNDNdIC0gNC0zIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQ0XSAtIDQtNCBtYXRyaXggZWxlbWVudC4KCQkgKi8KCQljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCU1hdHJpeDQucHJvdG90eXBlLmlzTWF0cml4NCA9IHRydWU7CgoJCQkvKioKCQkJICogQSBjb2x1bW4tbWFqb3IgbGlzdCBvZiBtYXRyaXggdmFsdWVzLgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPn0KCQkJICovCgkJCXRoaXMuZWxlbWVudHMgPSBbCgoJCQkJMSwgMCwgMCwgMCwKCQkJCTAsIDEsIDAsIDAsCgkJCQkwLCAwLCAxLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJXTsKCgkJCWlmICggbjExICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtYXRyaXguVGhlIGFyZ3VtZW50cyBhcmUgc3VwcG9zZWQgdG8gYmUKCQkgKiBpbiByb3ctbWFqb3Igb3JkZXIuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24xNF0gLSAxLTQgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjFdIC0gMi0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIyXSAtIDItMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yM10gLSAyLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjRdIC0gMi00IG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMxXSAtIDMtMSBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zMl0gLSAzLTIgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzNdIC0gMy0zIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjM0XSAtIDMtNCBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW240MV0gLSA0LTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuNDJdIC0gNC0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQzXSAtIDQtMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW240NF0gLSA0LTQgbWF0cml4IGVsZW1lbnQuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMTQsIG4yMSwgbjIyLCBuMjMsIG4yNCwgbjMxLCBuMzIsIG4zMywgbjM0LCBuNDEsIG40MiwgbjQzLCBuNDQgKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0ZVsgMCBdID0gbjExOyB0ZVsgNCBdID0gbjEyOyB0ZVsgOCBdID0gbjEzOyB0ZVsgMTIgXSA9IG4xNDsKCQkJdGVbIDEgXSA9IG4yMTsgdGVbIDUgXSA9IG4yMjsgdGVbIDkgXSA9IG4yMzsgdGVbIDEzIF0gPSBuMjQ7CgkJCXRlWyAyIF0gPSBuMzE7IHRlWyA2IF0gPSBuMzI7IHRlWyAxMCBdID0gbjMzOyB0ZVsgMTQgXSA9IG4zNDsKCQkJdGVbIDMgXSA9IG40MTsgdGVbIDcgXSA9IG40MjsgdGVbIDExIF0gPSBuNDM7IHRlWyAxNSBdID0gbjQ0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgNHg0IGlkZW50aXR5IG1hdHJpeC4KCQkgKgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWlkZW50aXR5KCkgewoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgMCwgMCwKCQkJCTAsIDEsIDAsIDAsCgkJCQkwLCAwLCAxLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBtYXRyaXggd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgTWF0cml4NCgpLmZyb21BcnJheSggdGhpcy5lbGVtZW50cyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRyaXggdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gY29weS4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQljb3B5KCBtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOyB0ZVsgMyBdID0gbWVbIDMgXTsKCQkJdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOyB0ZVsgNiBdID0gbWVbIDYgXTsgdGVbIDcgXSA9IG1lWyA3IF07CgkJCXRlWyA4IF0gPSBtZVsgOCBdOyB0ZVsgOSBdID0gbWVbIDkgXTsgdGVbIDEwIF0gPSBtZVsgMTAgXTsgdGVbIDExIF0gPSBtZVsgMTEgXTsKCQkJdGVbIDEyIF0gPSBtZVsgMTIgXTsgdGVbIDEzIF0gPSBtZVsgMTMgXTsgdGVbIDE0IF0gPSBtZVsgMTQgXTsgdGVbIDE1IF0gPSBtZVsgMTUgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdHJhbnNsYXRpb24gY29tcG9uZW50IG9mIHRoZSBnaXZlbiBtYXRyaXgKCQkgKiBpbnRvIHRoaXMgbWF0cml4J3MgdHJhbnNsYXRpb24gY29tcG9uZW50LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBjb3B5IHRoZSB0cmFuc2xhdGlvbiBjb21wb25lbnQuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJY29weVBvc2l0aW9uKCBtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOwoJCQl0ZVsgMTMgXSA9IG1lWyAxMyBdOwoJCQl0ZVsgMTQgXSA9IG1lWyAxNCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0IHRoZSB1cHBlciAzeDMgZWxlbWVudHMgb2YgdGhpcyBtYXRyaXggdG8gdGhlIHZhbHVlcyBvZiBnaXZlbiAzeDMgbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0RnJvbU1hdHJpeDMoIG0gKSB7CgoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnNldCgKCgkJCQltZVsgMCBdLCBtZVsgMyBdLCBtZVsgNiBdLCAwLAoJCQkJbWVbIDEgXSwgbWVbIDQgXSwgbWVbIDcgXSwgMCwKCQkJCW1lWyAyIF0sIG1lWyA1IF0sIG1lWyA4IF0sIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXh0cmFjdHMgdGhlIGJhc2lzIG9mIHRoaXMgbWF0cml4IGludG8gdGhlIHRocmVlIGF4aXMgdmVjdG9ycyBwcm92aWRlZC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30geEF4aXMgLSBUaGUgYmFzaXMncyB4IGF4aXMuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB5QXhpcyAtIFRoZSBiYXNpcydzIHkgYXhpcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHpBeGlzIC0gVGhlIGJhc2lzJ3MgeiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJCXhBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDAgKTsKCQkJeUF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMSApOwoJCQl6QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAyICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiBiYXNpcyB2ZWN0b3JzIHRvIHRoaXMgbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB4QXhpcyAtIFRoZSBiYXNpcydzIHggYXhpcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHlBeGlzIC0gVGhlIGJhc2lzJ3MgeSBheGlzLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gekF4aXMgLSBUaGUgYmFzaXMncyB6IGF4aXMuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbWFrZUJhc2lzKCB4QXhpcywgeUF4aXMsIHpBeGlzICkgewoKCQkJdGhpcy5zZXQoCgkJCQl4QXhpcy54LCB5QXhpcy54LCB6QXhpcy54LCAwLAoJCQkJeEF4aXMueSwgeUF4aXMueSwgekF4aXMueSwgMCwKCQkJCXhBeGlzLnosIHlBeGlzLnosIHpBeGlzLnosIDAsCgkJCQkwLCAwLCAwLCAxCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBFeHRyYWN0cyB0aGUgcm90YXRpb24gY29tcG9uZW50IG9mIHRoZSBnaXZlbiBtYXRyaXgKCQkgKiBpbnRvIHRoaXMgbWF0cml4J3Mgcm90YXRpb24gY29tcG9uZW50LgoJCSAqCgkJICogTm90ZTogVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCByZWZsZWN0aW9uIG1hdHJpY2VzLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlleHRyYWN0Um90YXRpb24oIG0gKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCgkJCWNvbnN0IHNjYWxlWCA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJCWNvbnN0IHNjYWxlWSA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAxICkubGVuZ3RoKCk7CgkJCWNvbnN0IHNjYWxlWiA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAyICkubGVuZ3RoKCk7CgoJCQl0ZVsgMCBdID0gbWVbIDAgXSAqIHNjYWxlWDsKCQkJdGVbIDEgXSA9IG1lWyAxIF0gKiBzY2FsZVg7CgkJCXRlWyAyIF0gPSBtZVsgMiBdICogc2NhbGVYOwoJCQl0ZVsgMyBdID0gMDsKCgkJCXRlWyA0IF0gPSBtZVsgNCBdICogc2NhbGVZOwoJCQl0ZVsgNSBdID0gbWVbIDUgXSAqIHNjYWxlWTsKCQkJdGVbIDYgXSA9IG1lWyA2IF0gKiBzY2FsZVk7CgkJCXRlWyA3IF0gPSAwOwoKCQkJdGVbIDggXSA9IG1lWyA4IF0gKiBzY2FsZVo7CgkJCXRlWyA5IF0gPSBtZVsgOSBdICogc2NhbGVaOwoJCQl0ZVsgMTAgXSA9IG1lWyAxMCBdICogc2NhbGVaOwoJCQl0ZVsgMTEgXSA9IDA7CgoJCQl0ZVsgMTIgXSA9IDA7CgkJCXRlWyAxMyBdID0gMDsKCQkJdGVbIDE0IF0gPSAwOwoJCQl0ZVsgMTUgXSA9IDE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgKHRoZSB1cHBlciBsZWZ0IDN4MyBtYXRyaXgpIG9mIHRoaXMgbWF0cml4IHRvCgkJICogdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieSB0aGUgZ2l2ZW4gRXVsZXIgYW5nbGVzLiBUaGUgcmVzdCBvZgoJCSAqIHRoZSBtYXRyaXggaXMgc2V0IHRvIHRoZSBpZGVudGl0eS4gRGVwZW5kaW5nIG9uIHRoZSB7QGxpbmsgRXVsZXIjb3JkZXJ9LAoJCSAqIHRoZXJlIGFyZSBzaXggcG9zc2libGUgb3V0Y29tZXMuIFNlZSBbdGhpcyBwYWdlXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlcl9hbmdsZXMjUm90YXRpb25fbWF0cml4fQoJCSAqIGZvciBhIGNvbXBsZXRlIGxpc3QuCgkJICoKCQkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbWFrZVJvdGF0aW9uRnJvbUV1bGVyKCBldWxlciApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWNvbnN0IHggPSBldWxlci54LCB5ID0gZXVsZXIueSwgeiA9IGV1bGVyLno7CgkJCWNvbnN0IGEgPSBNYXRoLmNvcyggeCApLCBiID0gTWF0aC5zaW4oIHggKTsKCQkJY29uc3QgYyA9IE1hdGguY29zKCB5ICksIGQgPSBNYXRoLnNpbiggeSApOwoJCQljb25zdCBlID0gTWF0aC5jb3MoIHogKSwgZiA9IE1hdGguc2luKCB6ICk7CgoJCQlpZiAoIGV1bGVyLm9yZGVyID09PSAnWFlaJyApIHsKCgkJCQljb25zdCBhZSA9IGEgKiBlLCBhZiA9IGEgKiBmLCBiZSA9IGIgKiBlLCBiZiA9IGIgKiBmOwoKCQkJCXRlWyAwIF0gPSBjICogZTsKCQkJCXRlWyA0IF0gPSAtIGMgKiBmOwoJCQkJdGVbIDggXSA9IGQ7CgoJCQkJdGVbIDEgXSA9IGFmICsgYmUgKiBkOwoJCQkJdGVbIDUgXSA9IGFlIC0gYmYgKiBkOwoJCQkJdGVbIDkgXSA9IC0gYiAqIGM7CgoJCQkJdGVbIDIgXSA9IGJmIC0gYWUgKiBkOwoJCQkJdGVbIDYgXSA9IGJlICsgYWYgKiBkOwoJCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWVhaJyApIHsKCgkJCQljb25zdCBjZSA9IGMgKiBlLCBjZiA9IGMgKiBmLCBkZSA9IGQgKiBlLCBkZiA9IGQgKiBmOwoKCQkJCXRlWyAwIF0gPSBjZSArIGRmICogYjsKCQkJCXRlWyA0IF0gPSBkZSAqIGIgLSBjZjsKCQkJCXRlWyA4IF0gPSBhICogZDsKCgkJCQl0ZVsgMSBdID0gYSAqIGY7CgkJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCQl0ZVsgOSBdID0gLSBiOwoKCQkJCXRlWyAyIF0gPSBjZiAqIGIgLSBkZTsKCQkJCXRlWyA2IF0gPSBkZiArIGNlICogYjsKCQkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1pYWScgKSB7CgoJCQkJY29uc3QgY2UgPSBjICogZSwgY2YgPSBjICogZiwgZGUgPSBkICogZSwgZGYgPSBkICogZjsKCgkJCQl0ZVsgMCBdID0gY2UgLSBkZiAqIGI7CgkJCQl0ZVsgNCBdID0gLSBhICogZjsKCQkJCXRlWyA4IF0gPSBkZSArIGNmICogYjsKCgkJCQl0ZVsgMSBdID0gY2YgKyBkZSAqIGI7CgkJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCQl0ZVsgOSBdID0gZGYgLSBjZSAqIGI7CgoJCQkJdGVbIDIgXSA9IC0gYSAqIGQ7CgkJCQl0ZVsgNiBdID0gYjsKCQkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1pZWCcgKSB7CgoJCQkJY29uc3QgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKCgkJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCQl0ZVsgNCBdID0gYmUgKiBkIC0gYWY7CgkJCQl0ZVsgOCBdID0gYWUgKiBkICsgYmY7CgoJCQkJdGVbIDEgXSA9IGMgKiBmOwoJCQkJdGVbIDUgXSA9IGJmICogZCArIGFlOwoJCQkJdGVbIDkgXSA9IGFmICogZCAtIGJlOwoKCQkJCXRlWyAyIF0gPSAtIGQ7CgkJCQl0ZVsgNiBdID0gYiAqIGM7CgkJCQl0ZVsgMTAgXSA9IGEgKiBjOwoKCQkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWlgnICkgewoKCQkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgoJCQkJdGVbIDAgXSA9IGMgKiBlOwoJCQkJdGVbIDQgXSA9IGJkIC0gYWMgKiBmOwoJCQkJdGVbIDggXSA9IGJjICogZiArIGFkOwoKCQkJCXRlWyAxIF0gPSBmOwoJCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQkJdGVbIDkgXSA9IC0gYiAqIGU7CgoJCQkJdGVbIDIgXSA9IC0gZCAqIGU7CgkJCQl0ZVsgNiBdID0gYWQgKiBmICsgYmM7CgkJCQl0ZVsgMTAgXSA9IGFjIC0gYmQgKiBmOwoKCQkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdYWlknICkgewoKCQkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgoJCQkJdGVbIDAgXSA9IGMgKiBlOwoJCQkJdGVbIDQgXSA9IC0gZjsKCQkJCXRlWyA4IF0gPSBkICogZTsKCgkJCQl0ZVsgMSBdID0gYWMgKiBmICsgYmQ7CgkJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCQl0ZVsgOSBdID0gYWQgKiBmIC0gYmM7CgoJCQkJdGVbIDIgXSA9IGJjICogZiAtIGFkOwoJCQkJdGVbIDYgXSA9IGIgKiBlOwoJCQkJdGVbIDEwIF0gPSBiZCAqIGYgKyBhYzsKCgkJCX0KCgkJCS8vIGJvdHRvbSByb3cKCQkJdGVbIDMgXSA9IDA7CgkJCXRlWyA3IF0gPSAwOwoJCQl0ZVsgMTEgXSA9IDA7CgoJCQkvLyBsYXN0IGNvbHVtbgoJCQl0ZVsgMTIgXSA9IDA7CgkJCXRlWyAxMyBdID0gMDsKCQkJdGVbIDE0IF0gPSAwOwoJCQl0ZVsgMTUgXSA9IDE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgb2YgdGhpcyBtYXRyaXggdG8gdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieQoJCSAqIHRoZSBnaXZlbiBRdWF0ZXJuaW9uIGFzIG91dGxpbmVkIFtoZXJlXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3RhdGlvbl9tYXRyaXgjUXVhdGVybmlvbn0KCQkgKiBUaGUgcmVzdCBvZiB0aGUgbWF0cml4IGlzIHNldCB0byB0aGUgaWRlbnRpdHkuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApIHsKCgkJCXJldHVybiB0aGlzLmNvbXBvc2UoIF96ZXJvLCBxLCBfb25lICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgcm90YXRpb24gY29tcG9uZW50IG9mIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgsIGxvb2tpbmcgZnJvbSBgZXllYCB0b3dhcmRzCgkJICogYHRhcmdldGAsIGFuZCBvcmllbnRlZCBieSB0aGUgdXAtZGlyZWN0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBleWUgLSBUaGUgZXllIHZlY3Rvci4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdXAgLSBUaGUgdXAgdmVjdG9yLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWxvb2tBdCggZXllLCB0YXJnZXQsIHVwICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJX3ouc3ViVmVjdG9ycyggZXllLCB0YXJnZXQgKTsKCgkJCWlmICggX3oubGVuZ3RoU3EoKSA9PT0gMCApIHsKCgkJCQkvLyBleWUgYW5kIHRhcmdldCBhcmUgaW4gdGhlIHNhbWUgcG9zaXRpb24KCgkJCQlfei56ID0gMTsKCgkJCX0KCgkJCV96Lm5vcm1hbGl6ZSgpOwoJCQlfeC5jcm9zc1ZlY3RvcnMoIHVwLCBfeiApOwoKCQkJaWYgKCBfeC5sZW5ndGhTcSgpID09PSAwICkgewoKCQkJCS8vIHVwIGFuZCB6IGFyZSBwYXJhbGxlbAoKCQkJCWlmICggTWF0aC5hYnMoIHVwLnogKSA9PT0gMSApIHsKCgkJCQkJX3oueCArPSAwLjAwMDE7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX3oueiArPSAwLjAwMDE7CgoJCQkJfQoKCQkJCV96Lm5vcm1hbGl6ZSgpOwoJCQkJX3guY3Jvc3NWZWN0b3JzKCB1cCwgX3ogKTsKCgkJCX0KCgkJCV94Lm5vcm1hbGl6ZSgpOwoJCQlfeS5jcm9zc1ZlY3RvcnMoIF96LCBfeCApOwoKCQkJdGVbIDAgXSA9IF94Lng7IHRlWyA0IF0gPSBfeS54OyB0ZVsgOCBdID0gX3oueDsKCQkJdGVbIDEgXSA9IF94Lnk7IHRlWyA1IF0gPSBfeS55OyB0ZVsgOSBdID0gX3oueTsKCQkJdGVbIDIgXSA9IF94Lno7IHRlWyA2IF0gPSBfeS56OyB0ZVsgMTAgXSA9IF96Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQb3N0LW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgoJCX0KCgkJLyoqCgkJICogUHJlLW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJcHJlbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGVzIHRoZSBnaXZlbiA0eDQgbWF0cmljZXMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CgkJICogaW4gdGhpcyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IGEgLSBUaGUgZmlyc3QgbWF0cml4LgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gYiAtIFRoZSBzZWNvbmQgbWF0cml4LgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgoJCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CgkJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDQgXSwgYTEzID0gYWVbIDggXSwgYTE0ID0gYWVbIDEyIF07CgkJCWNvbnN0IGEyMSA9IGFlWyAxIF0sIGEyMiA9IGFlWyA1IF0sIGEyMyA9IGFlWyA5IF0sIGEyNCA9IGFlWyAxMyBdOwoJCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNiBdLCBhMzMgPSBhZVsgMTAgXSwgYTM0ID0gYWVbIDE0IF07CgkJCWNvbnN0IGE0MSA9IGFlWyAzIF0sIGE0MiA9IGFlWyA3IF0sIGE0MyA9IGFlWyAxMSBdLCBhNDQgPSBhZVsgMTUgXTsKCgkJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyA0IF0sIGIxMyA9IGJlWyA4IF0sIGIxNCA9IGJlWyAxMiBdOwoJCQljb25zdCBiMjEgPSBiZVsgMSBdLCBiMjIgPSBiZVsgNSBdLCBiMjMgPSBiZVsgOSBdLCBiMjQgPSBiZVsgMTMgXTsKCQkJY29uc3QgYjMxID0gYmVbIDIgXSwgYjMyID0gYmVbIDYgXSwgYjMzID0gYmVbIDEwIF0sIGIzNCA9IGJlWyAxNCBdOwoJCQljb25zdCBiNDEgPSBiZVsgMyBdLCBiNDIgPSBiZVsgNyBdLCBiNDMgPSBiZVsgMTEgXSwgYjQ0ID0gYmVbIDE1IF07CgoJCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwoJCQl0ZVsgNCBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyICsgYTE0ICogYjQyOwoJCQl0ZVsgOCBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzICsgYTE0ICogYjQzOwoJCQl0ZVsgMTIgXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKCgkJCXRlWyAxIF0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzEgKyBhMjQgKiBiNDE7CgkJCXRlWyA1IF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzIgKyBhMjQgKiBiNDI7CgkJCXRlWyA5IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzMgKyBhMjQgKiBiNDM7CgkJCXRlWyAxMyBdID0gYTIxICogYjE0ICsgYTIyICogYjI0ICsgYTIzICogYjM0ICsgYTI0ICogYjQ0OwoKCQkJdGVbIDIgXSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMSArIGEzNCAqIGI0MTsKCQkJdGVbIDYgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMiArIGEzNCAqIGI0MjsKCQkJdGVbIDEwIF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzMgKyBhMzQgKiBiNDM7CgkJCXRlWyAxNCBdID0gYTMxICogYjE0ICsgYTMyICogYjI0ICsgYTMzICogYjM0ICsgYTM0ICogYjQ0OwoKCQkJdGVbIDMgXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKCQkJdGVbIDcgXSA9IGE0MSAqIGIxMiArIGE0MiAqIGIyMiArIGE0MyAqIGIzMiArIGE0NCAqIGI0MjsKCQkJdGVbIDExIF0gPSBhNDEgKiBiMTMgKyBhNDIgKiBiMjMgKyBhNDMgKiBiMzMgKyBhNDQgKiBiNDM7CgkJCXRlWyAxNSBdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyBldmVyeSBjb21wb25lbnQgb2YgdGhlIG1hdHJpeCBieSB0aGUgZ2l2ZW4gc2NhbGFyLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW11bHRpcGx5U2NhbGFyKCBzICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA4IF0gKj0gczsgdGVbIDEyIF0gKj0gczsKCQkJdGVbIDEgXSAqPSBzOyB0ZVsgNSBdICo9IHM7IHRlWyA5IF0gKj0gczsgdGVbIDEzIF0gKj0gczsKCQkJdGVbIDIgXSAqPSBzOyB0ZVsgNiBdICo9IHM7IHRlWyAxMCBdICo9IHM7IHRlWyAxNCBdICo9IHM7CgkJCXRlWyAzIF0gKj0gczsgdGVbIDcgXSAqPSBzOyB0ZVsgMTEgXSAqPSBzOyB0ZVsgMTUgXSAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgYW5kIHJldHVybnMgdGhlIGRldGVybWluYW50IG9mIHRoaXMgbWF0cml4LgoJCSAqCgkJICogQmFzZWQgb24gdGhlIG1ldGhvZCBvdXRsaW5lZCBbaGVyZV17QGxpbmsgaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtbH0uCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkZXRlcm1pbmFudC4KCQkgKi8KCQlkZXRlcm1pbmFudCgpIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWNvbnN0IG4xMSA9IHRlWyAwIF0sIG4xMiA9IHRlWyA0IF0sIG4xMyA9IHRlWyA4IF0sIG4xNCA9IHRlWyAxMiBdOwoJCQljb25zdCBuMjEgPSB0ZVsgMSBdLCBuMjIgPSB0ZVsgNSBdLCBuMjMgPSB0ZVsgOSBdLCBuMjQgPSB0ZVsgMTMgXTsKCQkJY29uc3QgbjMxID0gdGVbIDIgXSwgbjMyID0gdGVbIDYgXSwgbjMzID0gdGVbIDEwIF0sIG4zNCA9IHRlWyAxNCBdOwoJCQljb25zdCBuNDEgPSB0ZVsgMyBdLCBuNDIgPSB0ZVsgNyBdLCBuNDMgPSB0ZVsgMTEgXSwgbjQ0ID0gdGVbIDE1IF07CgoJCQkvL1RPRE86IG1ha2UgdGhpcyBtb3JlIGVmZmljaWVudAoKCQkJcmV0dXJuICgKCQkJCW40MSAqICgKCQkJCQkrIG4xNCAqIG4yMyAqIG4zMgoJCQkJCSAtIG4xMyAqIG4yNCAqIG4zMgoJCQkJCSAtIG4xNCAqIG4yMiAqIG4zMwoJCQkJCSArIG4xMiAqIG4yNCAqIG4zMwoJCQkJCSArIG4xMyAqIG4yMiAqIG4zNAoJCQkJCSAtIG4xMiAqIG4yMyAqIG4zNAoJCQkJKSArCgkJCQluNDIgKiAoCgkJCQkJKyBuMTEgKiBuMjMgKiBuMzQKCQkJCQkgLSBuMTEgKiBuMjQgKiBuMzMKCQkJCQkgKyBuMTQgKiBuMjEgKiBuMzMKCQkJCQkgLSBuMTMgKiBuMjEgKiBuMzQKCQkJCQkgKyBuMTMgKiBuMjQgKiBuMzEKCQkJCQkgLSBuMTQgKiBuMjMgKiBuMzEKCQkJCSkgKwoJCQkJbjQzICogKAoJCQkJCSsgbjExICogbjI0ICogbjMyCgkJCQkJIC0gbjExICogbjIyICogbjM0CgkJCQkJIC0gbjE0ICogbjIxICogbjMyCgkJCQkJICsgbjEyICogbjIxICogbjM0CgkJCQkJICsgbjE0ICogbjIyICogbjMxCgkJCQkJIC0gbjEyICogbjI0ICogbjMxCgkJCQkpICsKCQkJCW40NCAqICgKCQkJCQktIG4xMyAqIG4yMiAqIG4zMQoJCQkJCSAtIG4xMSAqIG4yMyAqIG4zMgoJCQkJCSArIG4xMSAqIG4yMiAqIG4zMwoJCQkJCSArIG4xMyAqIG4yMSAqIG4zMgoJCQkJCSAtIG4xMiAqIG4yMSAqIG4zMwoJCQkJCSArIG4xMiAqIG4yMyAqIG4zMQoJCQkJKQoKCQkJKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc3Bvc2VzIHRoaXMgbWF0cml4IGluIHBsYWNlLgoJCSAqCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJdHJhbnNwb3NlKCkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQlsZXQgdG1wOwoKCQkJdG1wID0gdGVbIDEgXTsgdGVbIDEgXSA9IHRlWyA0IF07IHRlWyA0IF0gPSB0bXA7CgkJCXRtcCA9IHRlWyAyIF07IHRlWyAyIF0gPSB0ZVsgOCBdOyB0ZVsgOCBdID0gdG1wOwoJCQl0bXAgPSB0ZVsgNiBdOyB0ZVsgNiBdID0gdGVbIDkgXTsgdGVbIDkgXSA9IHRtcDsKCgkJCXRtcCA9IHRlWyAzIF07IHRlWyAzIF0gPSB0ZVsgMTIgXTsgdGVbIDEyIF0gPSB0bXA7CgkJCXRtcCA9IHRlWyA3IF07IHRlWyA3IF0gPSB0ZVsgMTMgXTsgdGVbIDEzIF0gPSB0bXA7CgkJCXRtcCA9IHRlWyAxMSBdOyB0ZVsgMTEgXSA9IHRlWyAxNCBdOyB0ZVsgMTQgXSA9IHRtcDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHBvc2l0aW9uIGNvbXBvbmVudCBmb3IgdGhpcyBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLAoJCSAqIHdpdGhvdXQgYWZmZWN0aW5nIHRoZSByZXN0IG9mIHRoZSBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IzfSB4IC0gVGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3Igb3IgYWx0ZXJuYXRpdmVseSB0aGUgdmVjdG9yIG9iamVjdC4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHogY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0UG9zaXRpb24oIHgsIHksIHogKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJCXRlWyAxMiBdID0geC54OwoJCQkJdGVbIDEzIF0gPSB4Lnk7CgkJCQl0ZVsgMTQgXSA9IHguejsKCgkJCX0gZWxzZSB7CgoJCQkJdGVbIDEyIF0gPSB4OwoJCQkJdGVbIDEzIF0gPSB5OwoJCQkJdGVbIDE0IF0gPSB6OwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSW52ZXJ0cyB0aGlzIG1hdHJpeCwgdXNpbmcgdGhlIFthbmFseXRpYyBtZXRob2Rde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVydGlibGVfbWF0cml4I0FuYWx5dGljX3NvbHV0aW9ufS4KCQkgKiBZb3UgY2FuIG5vdCBpbnZlcnQgd2l0aCBhIGRldGVybWluYW50IG9mIHplcm8uIElmIHlvdSBhdHRlbXB0IHRoaXMsIHRoZSBtZXRob2QgcHJvZHVjZXMKCQkgKiBhIHplcm8gbWF0cml4IGluc3RlYWQuCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlpbnZlcnQoKSB7CgoJCQkvLyBiYXNlZCBvbiBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL21hdHJpeC9mdW5jdGlvbnMvaW52ZXJzZS9mb3VyRC9pbmRleC5odG0KCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKCQkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sIG40MSA9IHRlWyAzIF0sCgkJCQluMTIgPSB0ZVsgNCBdLCBuMjIgPSB0ZVsgNSBdLCBuMzIgPSB0ZVsgNiBdLCBuNDIgPSB0ZVsgNyBdLAoJCQkJbjEzID0gdGVbIDggXSwgbjIzID0gdGVbIDkgXSwgbjMzID0gdGVbIDEwIF0sIG40MyA9IHRlWyAxMSBdLAoJCQkJbjE0ID0gdGVbIDEyIF0sIG4yNCA9IHRlWyAxMyBdLCBuMzQgPSB0ZVsgMTQgXSwgbjQ0ID0gdGVbIDE1IF0sCgoJCQkJdDExID0gbjIzICogbjM0ICogbjQyIC0gbjI0ICogbjMzICogbjQyICsgbjI0ICogbjMyICogbjQzIC0gbjIyICogbjM0ICogbjQzIC0gbjIzICogbjMyICogbjQ0ICsgbjIyICogbjMzICogbjQ0LAoJCQkJdDEyID0gbjE0ICogbjMzICogbjQyIC0gbjEzICogbjM0ICogbjQyIC0gbjE0ICogbjMyICogbjQzICsgbjEyICogbjM0ICogbjQzICsgbjEzICogbjMyICogbjQ0IC0gbjEyICogbjMzICogbjQ0LAoJCQkJdDEzID0gbjEzICogbjI0ICogbjQyIC0gbjE0ICogbjIzICogbjQyICsgbjE0ICogbjIyICogbjQzIC0gbjEyICogbjI0ICogbjQzIC0gbjEzICogbjIyICogbjQ0ICsgbjEyICogbjIzICogbjQ0LAoJCQkJdDE0ID0gbjE0ICogbjIzICogbjMyIC0gbjEzICogbjI0ICogbjMyIC0gbjE0ICogbjIyICogbjMzICsgbjEyICogbjI0ICogbjMzICsgbjEzICogbjIyICogbjM0IC0gbjEyICogbjIzICogbjM0OwoKCQkJY29uc3QgZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzICsgbjQxICogdDE0OwoKCQkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCgkJCWNvbnN0IGRldEludiA9IDEgLyBkZXQ7CgoJCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCQl0ZVsgMSBdID0gKCBuMjQgKiBuMzMgKiBuNDEgLSBuMjMgKiBuMzQgKiBuNDEgLSBuMjQgKiBuMzEgKiBuNDMgKyBuMjEgKiBuMzQgKiBuNDMgKyBuMjMgKiBuMzEgKiBuNDQgLSBuMjEgKiBuMzMgKiBuNDQgKSAqIGRldEludjsKCQkJdGVbIDIgXSA9ICggbjIyICogbjM0ICogbjQxIC0gbjI0ICogbjMyICogbjQxICsgbjI0ICogbjMxICogbjQyIC0gbjIxICogbjM0ICogbjQyIC0gbjIyICogbjMxICogbjQ0ICsgbjIxICogbjMyICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyAzIF0gPSAoIG4yMyAqIG4zMiAqIG40MSAtIG4yMiAqIG4zMyAqIG40MSAtIG4yMyAqIG4zMSAqIG40MiArIG4yMSAqIG4zMyAqIG40MiArIG4yMiAqIG4zMSAqIG40MyAtIG4yMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKCQkJdGVbIDQgXSA9IHQxMiAqIGRldEludjsKCQkJdGVbIDUgXSA9ICggbjEzICogbjM0ICogbjQxIC0gbjE0ICogbjMzICogbjQxICsgbjE0ICogbjMxICogbjQzIC0gbjExICogbjM0ICogbjQzIC0gbjEzICogbjMxICogbjQ0ICsgbjExICogbjMzICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyA2IF0gPSAoIG4xNCAqIG4zMiAqIG40MSAtIG4xMiAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMSAqIG40MiArIG4xMSAqIG4zNCAqIG40MiArIG4xMiAqIG4zMSAqIG40NCAtIG4xMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgNyBdID0gKCBuMTIgKiBuMzMgKiBuNDEgLSBuMTMgKiBuMzIgKiBuNDEgKyBuMTMgKiBuMzEgKiBuNDIgLSBuMTEgKiBuMzMgKiBuNDIgLSBuMTIgKiBuMzEgKiBuNDMgKyBuMTEgKiBuMzIgKiBuNDMgKSAqIGRldEludjsKCgkJCXRlWyA4IF0gPSB0MTMgKiBkZXRJbnY7CgkJCXRlWyA5IF0gPSAoIG4xNCAqIG4yMyAqIG40MSAtIG4xMyAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMSAqIG40MyArIG4xMSAqIG4yNCAqIG40MyArIG4xMyAqIG4yMSAqIG40NCAtIG4xMSAqIG4yMyAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgMTAgXSA9ICggbjEyICogbjI0ICogbjQxIC0gbjE0ICogbjIyICogbjQxICsgbjE0ICogbjIxICogbjQyIC0gbjExICogbjI0ICogbjQyIC0gbjEyICogbjIxICogbjQ0ICsgbjExICogbjIyICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyAxMSBdID0gKCBuMTMgKiBuMjIgKiBuNDEgLSBuMTIgKiBuMjMgKiBuNDEgLSBuMTMgKiBuMjEgKiBuNDIgKyBuMTEgKiBuMjMgKiBuNDIgKyBuMTIgKiBuMjEgKiBuNDMgLSBuMTEgKiBuMjIgKiBuNDMgKSAqIGRldEludjsKCgkJCXRlWyAxMiBdID0gdDE0ICogZGV0SW52OwoJCQl0ZVsgMTMgXSA9ICggbjEzICogbjI0ICogbjMxIC0gbjE0ICogbjIzICogbjMxICsgbjE0ICogbjIxICogbjMzIC0gbjExICogbjI0ICogbjMzIC0gbjEzICogbjIxICogbjM0ICsgbjExICogbjIzICogbjM0ICkgKiBkZXRJbnY7CgkJCXRlWyAxNCBdID0gKCBuMTQgKiBuMjIgKiBuMzEgLSBuMTIgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjEgKiBuMzIgKyBuMTEgKiBuMjQgKiBuMzIgKyBuMTIgKiBuMjEgKiBuMzQgLSBuMTEgKiBuMjIgKiBuMzQgKSAqIGRldEludjsKCQkJdGVbIDE1IF0gPSAoIG4xMiAqIG4yMyAqIG4zMSAtIG4xMyAqIG4yMiAqIG4zMSArIG4xMyAqIG4yMSAqIG4zMiAtIG4xMSAqIG4yMyAqIG4zMiAtIG4xMiAqIG4yMSAqIG4zMyArIG4xMSAqIG4yMiAqIG4zMyApICogZGV0SW52OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgY29sdW1ucyBvZiB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHNjYWxlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlzY2FsZSggdiApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQkJY29uc3QgeCA9IHYueCwgeSA9IHYueSwgeiA9IHYuejsKCgkJCXRlWyAwIF0gKj0geDsgdGVbIDQgXSAqPSB5OyB0ZVsgOCBdICo9IHo7CgkJCXRlWyAxIF0gKj0geDsgdGVbIDUgXSAqPSB5OyB0ZVsgOSBdICo9IHo7CgkJCXRlWyAyIF0gKj0geDsgdGVbIDYgXSAqPSB5OyB0ZVsgMTAgXSAqPSB6OwoJCQl0ZVsgMyBdICo9IHg7IHRlWyA3IF0gKj0geTsgdGVbIDExIF0gKj0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEdldHMgdGhlIG1heGltdW0gc2NhbGUgdmFsdWUgb2YgdGhlIHRocmVlIGF4ZXMuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBtYXhpbXVtIHNjYWxlLgoJCSAqLwoJCWdldE1heFNjYWxlT25BeGlzKCkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJY29uc3Qgc2NhbGVYU3EgPSB0ZVsgMCBdICogdGVbIDAgXSArIHRlWyAxIF0gKiB0ZVsgMSBdICsgdGVbIDIgXSAqIHRlWyAyIF07CgkJCWNvbnN0IHNjYWxlWVNxID0gdGVbIDQgXSAqIHRlWyA0IF0gKyB0ZVsgNSBdICogdGVbIDUgXSArIHRlWyA2IF0gKiB0ZVsgNiBdOwoJCQljb25zdCBzY2FsZVpTcSA9IHRlWyA4IF0gKiB0ZVsgOCBdICsgdGVbIDkgXSAqIHRlWyA5IF0gKyB0ZVsgMTAgXSAqIHRlWyAxMCBdOwoKCQkJcmV0dXJuIE1hdGguc3FydCggTWF0aC5tYXgoIHNjYWxlWFNxLCBzY2FsZVlTcSwgc2NhbGVaU3EgKSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSB0cmFuc2xhdGlvbiB0cmFuc2Zvcm0gZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ8VmVjdG9yM30geCAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBYIGF4aXMgb3IgYWx0ZXJuYXRpdmVseSBhIHRyYW5zbGF0aW9uIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBZIGF4aXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgeiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VUcmFuc2xhdGlvbiggeCwgeSwgeiApIHsKCgkJCWlmICggeC5pc1ZlY3RvcjMgKSB7CgoJCQkJdGhpcy5zZXQoCgoJCQkJCTEsIDAsIDAsIHgueCwKCQkJCQkwLCAxLCAwLCB4LnksCgkJCQkJMCwgMCwgMSwgeC56LAoJCQkJCTAsIDAsIDAsIDEKCgkJCQkpOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNldCgKCgkJCQkJMSwgMCwgMCwgeCwKCQkJCQkwLCAxLCAwLCB5LAoJCQkJCTAsIDAsIDEsIHosCgkJCQkJMCwgMCwgMCwgMQoKCQkJCSk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFggYXhpcyBieQoJCSAqIHRoZSBnaXZlbiBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvblgoIHRoZXRhICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCAwLCAwLCAwLAoJCQkJMCwgYywgLSBzLCAwLAoJCQkJMCwgcywgYywgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFkgYXhpcyBieQoJCSAqIHRoZSBnaXZlbiBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvblkoIHRoZXRhICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQkgYywgMCwgcywgMCwKCQkJCSAwLCAxLCAwLCAwLAoJCQkJLSBzLCAwLCBjLCAwLAoJCQkJIDAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFogYXhpcyBieQoJCSAqIHRoZSBnaXZlbiBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvblooIHRoZXRhICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQljLCAtIHMsIDAsIDAsCgkJCQlzLCBjLCAwLCAwLAoJCQkJMCwgMCwgMSwgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIGdpdmVuIGF4aXMgYnkKCQkgKiB0aGUgZ2l2ZW4gYW5nbGUuCgkJICoKCQkgKiBUaGlzIGlzIGEgc29tZXdoYXQgY29udHJvdmVyc2lhbCBidXQgbWF0aGVtYXRpY2FsbHkgc291bmQgYWx0ZXJuYXRpdmUgdG8KCQkgKiByb3RhdGluZyB2aWEgUXVhdGVybmlvbnMuIFNlZSB0aGUgZGlzY3Vzc2lvbiBbaGVyZV17QGxpbmsgaHR0cHM6Ly93d3cuZ2FtZWRldi5uZXQvYXJ0aWNsZXMvcHJvZ3JhbW1pbmcvbWF0aC1hbmQtcGh5c2ljcy9kby13ZS1yZWFsbHktbmVlZC1xdWF0ZXJuaW9ucy1yMTE5OX0uCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgbm9ybWFsaXplZCByb3RhdGlvbiBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvbkF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkJLy8gQmFzZWQgb24gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9yZWZlcmVuY2UvYXJ0aWNsZXMvYXJ0aWNsZTExOTkuYXNwCgoJCQljb25zdCBjID0gTWF0aC5jb3MoIGFuZ2xlICk7CgkJCWNvbnN0IHMgPSBNYXRoLnNpbiggYW5nbGUgKTsKCQkJY29uc3QgdCA9IDEgLSBjOwoJCQljb25zdCB4ID0gYXhpcy54LCB5ID0gYXhpcy55LCB6ID0gYXhpcy56OwoJCQljb25zdCB0eCA9IHQgKiB4LCB0eSA9IHQgKiB5OwoKCQkJdGhpcy5zZXQoCgoJCQkJdHggKiB4ICsgYywgdHggKiB5IC0gcyAqIHosIHR4ICogeiArIHMgKiB5LCAwLAoJCQkJdHggKiB5ICsgcyAqIHosIHR5ICogeSArIGMsIHR5ICogeiAtIHMgKiB4LCAwLAoJCQkJdHggKiB6IC0gcyAqIHksIHR5ICogeiArIHMgKiB4LCB0ICogeiAqIHogKyBjLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSBzY2FsZSB0cmFuc2Zvcm1hdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWCBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VTY2FsZSggeCwgeSwgeiApIHsKCgkJCXRoaXMuc2V0KAoKCQkJCXgsIDAsIDAsIDAsCgkJCQkwLCB5LCAwLCAwLAoJCQkJMCwgMCwgeiwgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgc2hlYXIgdHJhbnNmb3JtYXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geHkgLSBUaGUgYW1vdW50IHRvIHNoZWFyIFggYnkgWS4KCQkgKiBAcGFyYW0ge251bWJlcn0geHogLSBUaGUgYW1vdW50IHRvIHNoZWFyIFggYnkgWi4KCQkgKiBAcGFyYW0ge251bWJlcn0geXggLSBUaGUgYW1vdW50IHRvIHNoZWFyIFkgYnkgWC4KCQkgKiBAcGFyYW0ge251bWJlcn0geXogLSBUaGUgYW1vdW50IHRvIHNoZWFyIFkgYnkgWi4KCQkgKiBAcGFyYW0ge251bWJlcn0genggLSBUaGUgYW1vdW50IHRvIHNoZWFyIFogYnkgWC4KCQkgKiBAcGFyYW0ge251bWJlcn0genkgLSBUaGUgYW1vdW50IHRvIHNoZWFyIFogYnkgWS4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlU2hlYXIoIHh5LCB4eiwgeXgsIHl6LCB6eCwgenkgKSB7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCB5eCwgengsIDAsCgkJCQl4eSwgMSwgenksIDAsCgkJCQl4eiwgeXosIDEsIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgdHJhbnNmb3JtYXRpb24gY29tcG9zZWQgb2YgdGhlIGdpdmVuIHBvc2l0aW9uLAoJCSAqIHJvdGF0aW9uIChRdWF0ZXJuaW9uKSBhbmQgc2NhbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvc2l0aW9uIC0gVGhlIHBvc2l0aW9uIHZlY3Rvci4KCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHF1YXRlcm5pb24gLSBUaGUgcm90YXRpb24gYXMgYSBRdWF0ZXJuaW9uLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gc2NhbGUgLSBUaGUgc2NhbGUgdmVjdG9yLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWNvbnN0IHggPSBxdWF0ZXJuaW9uLl94LCB5ID0gcXVhdGVybmlvbi5feSwgeiA9IHF1YXRlcm5pb24uX3osIHcgPSBxdWF0ZXJuaW9uLl93OwoJCQljb25zdCB4MiA9IHggKyB4LAl5MiA9IHkgKyB5LCB6MiA9IHogKyB6OwoJCQljb25zdCB4eCA9IHggKiB4MiwgeHkgPSB4ICogeTIsIHh6ID0geCAqIHoyOwoJCQljb25zdCB5eSA9IHkgKiB5MiwgeXogPSB5ICogejIsIHp6ID0geiAqIHoyOwoJCQljb25zdCB3eCA9IHcgKiB4Miwgd3kgPSB3ICogeTIsIHd6ID0gdyAqIHoyOwoKCQkJY29uc3Qgc3ggPSBzY2FsZS54LCBzeSA9IHNjYWxlLnksIHN6ID0gc2NhbGUuejsKCgkJCXRlWyAwIF0gPSAoIDEgLSAoIHl5ICsgenogKSApICogc3g7CgkJCXRlWyAxIF0gPSAoIHh5ICsgd3ogKSAqIHN4OwoJCQl0ZVsgMiBdID0gKCB4eiAtIHd5ICkgKiBzeDsKCQkJdGVbIDMgXSA9IDA7CgoJCQl0ZVsgNCBdID0gKCB4eSAtIHd6ICkgKiBzeTsKCQkJdGVbIDUgXSA9ICggMSAtICggeHggKyB6eiApICkgKiBzeTsKCQkJdGVbIDYgXSA9ICggeXogKyB3eCApICogc3k7CgkJCXRlWyA3IF0gPSAwOwoKCQkJdGVbIDggXSA9ICggeHogKyB3eSApICogc3o7CgkJCXRlWyA5IF0gPSAoIHl6IC0gd3ggKSAqIHN6OwoJCQl0ZVsgMTAgXSA9ICggMSAtICggeHggKyB5eSApICkgKiBzejsKCQkJdGVbIDExIF0gPSAwOwoKCQkJdGVbIDEyIF0gPSBwb3NpdGlvbi54OwoJCQl0ZVsgMTMgXSA9IHBvc2l0aW9uLnk7CgkJCXRlWyAxNCBdID0gcG9zaXRpb24uejsKCQkJdGVbIDE1IF0gPSAxOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRGVjb21wb3NlcyB0aGlzIG1hdHJpeCBpbnRvIGl0cyBwb3NpdGlvbiwgcm90YXRpb24gYW5kIHNjYWxlIGNvbXBvbmVudHMKCQkgKiBhbmQgcHJvdmlkZXMgdGhlIHJlc3VsdCBpbiB0aGUgZ2l2ZW4gb2JqZWN0cy4KCQkgKgoJCSAqIE5vdGU6IE5vdCBhbGwgbWF0cmljZXMgYXJlIGRlY29tcG9zYWJsZSBpbiB0aGlzIHdheS4gRm9yIGV4YW1wbGUsIGlmIGFuCgkJICogb2JqZWN0IGhhcyBhIG5vbi11bmlmb3JtbHkgc2NhbGVkIHBhcmVudCwgdGhlbiB0aGUgb2JqZWN0J3Mgd29ybGQgbWF0cml4CgkJICogbWF5IG5vdCBiZSBkZWNvbXBvc2FibGUsIGFuZCB0aGlzIG1ldGhvZCBtYXkgbm90IGJlIGFwcHJvcHJpYXRlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb3NpdGlvbiAtIFRoZSBwb3NpdGlvbiB2ZWN0b3IuCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHJvdGF0aW9uIGFzIGEgUXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHNjYWxlIC0gVGhlIHNjYWxlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlkZWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWxldCBzeCA9IF92MSQ1LnNldCggdGVbIDAgXSwgdGVbIDEgXSwgdGVbIDIgXSApLmxlbmd0aCgpOwoJCQljb25zdCBzeSA9IF92MSQ1LnNldCggdGVbIDQgXSwgdGVbIDUgXSwgdGVbIDYgXSApLmxlbmd0aCgpOwoJCQljb25zdCBzeiA9IF92MSQ1LnNldCggdGVbIDggXSwgdGVbIDkgXSwgdGVbIDEwIF0gKS5sZW5ndGgoKTsKCgkJCS8vIGlmIGRldGVybWluZSBpcyBuZWdhdGl2ZSwgd2UgbmVlZCB0byBpbnZlcnQgb25lIHNjYWxlCgkJCWNvbnN0IGRldCA9IHRoaXMuZGV0ZXJtaW5hbnQoKTsKCQkJaWYgKCBkZXQgPCAwICkgc3ggPSAtIHN4OwoKCQkJcG9zaXRpb24ueCA9IHRlWyAxMiBdOwoJCQlwb3NpdGlvbi55ID0gdGVbIDEzIF07CgkJCXBvc2l0aW9uLnogPSB0ZVsgMTQgXTsKCgkJCS8vIHNjYWxlIHRoZSByb3RhdGlvbiBwYXJ0CgkJCV9tMSQyLmNvcHkoIHRoaXMgKTsKCgkJCWNvbnN0IGludlNYID0gMSAvIHN4OwoJCQljb25zdCBpbnZTWSA9IDEgLyBzeTsKCQkJY29uc3QgaW52U1ogPSAxIC8gc3o7CgoJCQlfbTEkMi5lbGVtZW50c1sgMCBdICo9IGludlNYOwoJCQlfbTEkMi5lbGVtZW50c1sgMSBdICo9IGludlNYOwoJCQlfbTEkMi5lbGVtZW50c1sgMiBdICo9IGludlNYOwoKCQkJX20xJDIuZWxlbWVudHNbIDQgXSAqPSBpbnZTWTsKCQkJX20xJDIuZWxlbWVudHNbIDUgXSAqPSBpbnZTWTsKCQkJX20xJDIuZWxlbWVudHNbIDYgXSAqPSBpbnZTWTsKCgkJCV9tMSQyLmVsZW1lbnRzWyA4IF0gKj0gaW52U1o7CgkJCV9tMSQyLmVsZW1lbnRzWyA5IF0gKj0gaW52U1o7CgkJCV9tMSQyLmVsZW1lbnRzWyAxMCBdICo9IGludlNaOwoKCQkJcXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQyICk7CgoJCQlzY2FsZS54ID0gc3g7CgkJCXNjYWxlLnkgPSBzeTsKCQkJc2NhbGUueiA9IHN6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ3JlYXRlcyBhIHBlcnNwZWN0aXZlIHByb2plY3Rpb24gbWF0cml4LiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSBieQoJCSAqIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSN1cGRhdGVQcm9qZWN0aW9uTWF0cml4fS4KCgkJICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgLSBMZWZ0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHJpZ2h0IC0gUmlnaHQgYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gdG9wIC0gVG9wIGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbSAtIEJvdHRvbSBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBuZWFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgZmFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0gW2Nvb3JkaW5hdGVTeXN0ZW09V2ViR0xDb29yZGluYXRlU3lzdGVtXSAtIFRoZSBjb29yZGluYXRlIHN5c3RlbS4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlUGVyc3BlY3RpdmUoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgbmVhciwgZmFyLCBjb29yZGluYXRlU3lzdGVtID0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQljb25zdCB4ID0gMiAqIG5lYXIgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQljb25zdCB5ID0gMiAqIG5lYXIgLyAoIHRvcCAtIGJvdHRvbSApOwoKCQkJY29uc3QgYSA9ICggcmlnaHQgKyBsZWZ0ICkgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQljb25zdCBiID0gKCB0b3AgKyBib3R0b20gKSAvICggdG9wIC0gYm90dG9tICk7CgoJCQlsZXQgYywgZDsKCgkJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJCWMgPSAtICggZmFyICsgbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgkJCQlkID0gKCAtMiAqIGZhciAqIG5lYXIgKSAvICggZmFyIC0gbmVhciApOwoKCQkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCQljID0gLSBmYXIgLyAoIGZhciAtIG5lYXIgKTsKCQkJCWQgPSAoIC0gZmFyICogbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgoJCQl9IGVsc2UgewoKCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLk1hdHJpeDQubWFrZVBlcnNwZWN0aXZlKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCQl9CgoJCQl0ZVsgMCBdID0geDsJdGVbIDQgXSA9IDA7CXRlWyA4IF0gPSBhOyAJdGVbIDEyIF0gPSAwOwoJCQl0ZVsgMSBdID0gMDsJdGVbIDUgXSA9IHk7CXRlWyA5IF0gPSBiOyAJdGVbIDEzIF0gPSAwOwoJCQl0ZVsgMiBdID0gMDsJdGVbIDYgXSA9IDA7CXRlWyAxMCBdID0gYzsgCXRlWyAxNCBdID0gZDsKCQkJdGVbIDMgXSA9IDA7CXRlWyA3IF0gPSAwOwl0ZVsgMTEgXSA9IC0xOwl0ZVsgMTUgXSA9IDA7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDcmVhdGVzIGEgb3J0aG9ncmFwaGljIHByb2plY3Rpb24gbWF0cml4LiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSBieQoJCSAqIHtAbGluayBPcnRob2dyYXBoaWNDYW1lcmEjdXBkYXRlUHJvamVjdGlvbk1hdHJpeH0uCgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0IC0gTGVmdCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByaWdodCAtIFJpZ2h0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHRvcCAtIFRvcCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBib3R0b20gLSBCb3R0b20gYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gbmVhciAtIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGZhciAtIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIGZhciBwbGFuZS4KCQkgKiBAcGFyYW0geyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9IFtjb29yZGluYXRlU3lzdGVtPVdlYkdMQ29vcmRpbmF0ZVN5c3RlbV0gLSBUaGUgY29vcmRpbmF0ZSBzeXN0ZW0uCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbWFrZU9ydGhvZ3JhcGhpYyggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIsIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCWNvbnN0IHcgPSAxLjAgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQljb25zdCBoID0gMS4wIC8gKCB0b3AgLSBib3R0b20gKTsKCQkJY29uc3QgcCA9IDEuMCAvICggZmFyIC0gbmVhciApOwoKCQkJY29uc3QgeCA9ICggcmlnaHQgKyBsZWZ0ICkgKiB3OwoJCQljb25zdCB5ID0gKCB0b3AgKyBib3R0b20gKSAqIGg7CgoJCQlsZXQgeiwgekludjsKCgkJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJCXogPSAoIGZhciArIG5lYXIgKSAqIHA7CgkJCQl6SW52ID0gLTIgKiBwOwoKCQkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCQl6ID0gbmVhciAqIHA7CgkJCQl6SW52ID0gLTEgKiBwOwoKCQkJfSBlbHNlIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5NYXRyaXg0Lm1ha2VPcnRob2dyYXBoaWMoKTogSW52YWxpZCBjb29yZGluYXRlIHN5c3RlbTogJyArIGNvb3JkaW5hdGVTeXN0ZW0gKTsKCgkJCX0KCgkJCXRlWyAwIF0gPSAyICogdzsJdGVbIDQgXSA9IDA7CQl0ZVsgOCBdID0gMDsgCQl0ZVsgMTIgXSA9IC0geDsKCQkJdGVbIDEgXSA9IDA7IAkJdGVbIDUgXSA9IDIgKiBoOwl0ZVsgOSBdID0gMDsgCQl0ZVsgMTMgXSA9IC0geTsKCQkJdGVbIDIgXSA9IDA7IAkJdGVbIDYgXSA9IDA7CQl0ZVsgMTAgXSA9IHpJbnY7CXRlWyAxNCBdID0gLSB6OwoJCQl0ZVsgMyBdID0gMDsgCQl0ZVsgNyBdID0gMDsJCXRlWyAxMSBdID0gMDsJCXRlWyAxNSBdID0gMTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIG1hdHJpeCB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIG1hdHJpeCApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQkJY29uc3QgbWUgPSBtYXRyaXguZWxlbWVudHM7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCgkJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFycmF5LgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCgkJCQl0aGlzLmVsZW1lbnRzWyBpIF0gPSBhcnJheVsgaSArIG9mZnNldCBdOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV3JpdGVzIHRoZSBlbGVtZW50cyBvZiB0aGlzIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgbWF0cml4IGVsZW1lbnRzIGluIGNvbHVtbi1tYWpvciBvcmRlci4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KCQkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgbWF0cml4IGVsZW1lbnRzIGluIGNvbHVtbi1tYWpvciBvcmRlci4KCQkgKi8KCQl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGVbIDAgXTsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRlWyAxIF07CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCgkJCWFycmF5WyBvZmZzZXQgKyA0IF0gPSB0ZVsgNCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKCQkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CgkJCWFycmF5WyBvZmZzZXQgKyA5IF0gPSB0ZVsgOSBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMTAgXSA9IHRlWyAxMCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMTEgXSA9IHRlWyAxMSBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDEyIF0gPSB0ZVsgMTIgXTsKCQkJYXJyYXlbIG9mZnNldCArIDEzIF0gPSB0ZVsgMTMgXTsKCQkJYXJyYXlbIG9mZnNldCArIDE0IF0gPSB0ZVsgMTQgXTsKCQkJYXJyYXlbIG9mZnNldCArIDE1IF0gPSB0ZVsgMTUgXTsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCX0KCgljb25zdCBfdjEkNSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9tMSQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoJY29uc3QgX3plcm8gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAwLCAwICk7Cgljb25zdCBfb25lID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwoJY29uc3QgX3ggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfeSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF96ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCWNvbnN0IF9tYXRyaXgkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IF9xdWF0ZXJuaW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgoJLyoqCgkgKiBBIGNsYXNzIHJlcHJlc2VudGluZyBFdWxlciBhbmdsZXMuCgkgKgoJICogRXVsZXIgYW5nbGVzIGRlc2NyaWJlIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBieSByb3RhdGluZyBhbiBvYmplY3Qgb24KCSAqIGl0cyB2YXJpb3VzIGF4ZXMgaW4gc3BlY2lmaWVkIGFtb3VudHMgcGVyIGF4aXMsIGFuZCBhIHNwZWNpZmllZCBheGlzCgkgKiBvcmRlci4KCSAqCgkgKiBJdGVyYXRpbmcgdGhyb3VnaCBhbiBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzICh4LCB5LCB6LAoJICogb3JkZXIpIGluIHRoZSBjb3JyZXNwb25kaW5nIG9yZGVyLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBhID0gbmV3IFRIUkVFLkV1bGVyKCAwLCAxLCAxLjU3LCAnWFlaJyApOwoJICogY29uc3QgYiA9IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAwLCAxICk7CgkgKiBiLmFwcGx5RXVsZXIoYSk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgRXVsZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGV1bGVyIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgYW5nbGUgb2YgdGhlIHkgYXhpcyBpbiByYWRpYW5zLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbej0wXSAtIFRoZSBhbmdsZSBvZiB0aGUgeiBheGlzIGluIHJhZGlhbnMuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcj1FdWxlci5ERUZBVUxUX09SREVSXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAsIHogPSAwLCBvcmRlciA9IEV1bGVyLkRFRkFVTFRfT1JERVIgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0V1bGVyID0gdHJ1ZTsKCgkJCXRoaXMuX3ggPSB4OwoJCQl0aGlzLl95ID0geTsKCQkJdGhpcy5feiA9IHo7CgkJCXRoaXMuX29yZGVyID0gb3JkZXI7CgoJCX0KCgkJLyoqCgkJICogVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB4KCkgewoKCQkJcmV0dXJuIHRoaXMuX3g7CgoJCX0KCgkJc2V0IHgoIHZhbHVlICkgewoKCQkJdGhpcy5feCA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogVGhlIGFuZ2xlIG9mIHRoZSB5IGF4aXMgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB5KCkgewoKCQkJcmV0dXJuIHRoaXMuX3k7CgoJCX0KCgkJc2V0IHkoIHZhbHVlICkgewoKCQkJdGhpcy5feSA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogVGhlIGFuZ2xlIG9mIHRoZSB6IGF4aXMgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB6KCkgewoKCQkJcmV0dXJuIHRoaXMuX3o7CgoJCX0KCgkJc2V0IHooIHZhbHVlICkgewoKCQkJdGhpcy5feiA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCgkJICoKCQkgKiBAdHlwZSB7c3RyaW5nfQoJCSAqIEBkZWZhdWx0ICdYWVonCgkJICovCgkJZ2V0IG9yZGVyKCkgewoKCQkJcmV0dXJuIHRoaXMuX29yZGVyOwoKCQl9CgoJCXNldCBvcmRlciggdmFsdWUgKSB7CgoJCQl0aGlzLl9vcmRlciA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgRXVsZXIgY29tcG9uZW50cy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbmdsZSBvZiB0aGUgeSBheGlzIGluIHJhZGlhbnMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW5nbGUgb2YgdGhlIHogYXhpcyBpbiByYWRpYW5zLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJc2V0KCB4LCB5LCB6LCBvcmRlciA9IHRoaXMuX29yZGVyICkgewoKCQkJdGhpcy5feCA9IHg7CgkJCXRoaXMuX3kgPSB5OwoJCQl0aGlzLl96ID0gejsKCQkJdGhpcy5fb3JkZXIgPSBvcmRlcjsKCgkJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgRXVsZXIgaW5zdGFuY2Ugd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX29yZGVyICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIEV1bGVyIGluc3RhbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBpbnN0YW5jZSB0byBjb3B5LgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgoJCSAqLwoJCWNvcHkoIGV1bGVyICkgewoKCQkJdGhpcy5feCA9IGV1bGVyLl94OwoJCQl0aGlzLl95ID0gZXVsZXIuX3k7CgkJCXRoaXMuX3ogPSBldWxlci5fejsKCQkJdGhpcy5fb3JkZXIgPSBldWxlci5fb3JkZXI7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIGEgcHVyZSByb3RhdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBBIDR4NCBtYXRyaXggb2Ygd2hpY2ggdGhlIHVwcGVyIDN4MyBvZiBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLiB1bnNjYWxlZCkuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGU9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBpbnRlcm5hbCBgb25DaGFuZ2VgIGNhbGxiYWNrIHNob3VsZCBiZSBleGVjdXRlZCBvciBub3QuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtLCBvcmRlciA9IHRoaXMuX29yZGVyLCB1cGRhdGUgPSB0cnVlICkgewoKCQkJY29uc3QgdGUgPSBtLmVsZW1lbnRzOwoJCQljb25zdCBtMTEgPSB0ZVsgMCBdLCBtMTIgPSB0ZVsgNCBdLCBtMTMgPSB0ZVsgOCBdOwoJCQljb25zdCBtMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdOwoJCQljb25zdCBtMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXTsKCgkJCXN3aXRjaCAoIG9yZGVyICkgewoKCQkJCWNhc2UgJ1hZWic6CgoJCQkJCXRoaXMuX3kgPSBNYXRoLmFzaW4oIGNsYW1wKCBtMTMsIC0xLCAxICkgKTsKCgkJCQkJaWYgKCBNYXRoLmFicyggbTEzICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0xMSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIG0zMiwgbTIyICk7CgkJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1lYWic6CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0yMywgLTEsIDEgKSApOwoKCQkJCQlpZiAoIE1hdGguYWJzKCBtMjMgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMjIgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTExICk7CgkJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1pYWSc6CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmFzaW4oIGNsYW1wKCBtMzIsIC0xLCAxICkgKTsKCgkJCQkJaWYgKCBNYXRoLmFicyggbTMyICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5feSA9IDA7CgkJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1pZWCc6CgoJCQkJCXRoaXMuX3kgPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0zMSwgLTEsIDEgKSApOwoKCQkJCQlpZiAoIE1hdGguYWJzKCBtMzEgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMTEgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3ggPSAwOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1laWCc6CgoJCQkJCXRoaXMuX3ogPSBNYXRoLmFzaW4oIGNsYW1wKCBtMjEsIC0xLCAxICkgKTsKCgkJCQkJaWYgKCBNYXRoLmFicyggbTIxICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0yMiApOwoJCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5feCA9IDA7CgkJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1haWSc6CgoJCQkJCXRoaXMuX3ogPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0xMiwgLTEsIDEgKSApOwoKCQkJCQlpZiAoIE1hdGguYWJzKCBtMTIgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0yMiApOwoJCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMTEgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCAtIG0yMywgbTMzICk7CgkJCQkJCXRoaXMuX3kgPSAwOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkV1bGVyOiAuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCkgZW5jb3VudGVyZWQgYW4gdW5rbm93biBvcmRlcjogJyArIG9yZGVyICk7CgoJCQl9CgoJCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKCQkJaWYgKCB1cGRhdGUgPT09IHRydWUgKSB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIGEgbm9ybWFsaXplZCBxdWF0ZXJuaW9uLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gQSBub3JtYWxpemVkIFF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGU9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBpbnRlcm5hbCBgb25DaGFuZ2VgIGNhbGxiYWNrIHNob3VsZCBiZSBleGVjdXRlZCBvciBub3QuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJc2V0RnJvbVF1YXRlcm5pb24oIHEsIG9yZGVyLCB1cGRhdGUgKSB7CgoJCQlfbWF0cml4JDIubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKTsKCgkJCXJldHVybiB0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX21hdHJpeCQyLCBvcmRlciwgdXBkYXRlICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgYW5nbGVzIG9mIHRoaXMgRXVsZXIgaW5zdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW29yZGVyXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgoJCSAqLwoJCXNldEZyb21WZWN0b3IzKCB2LCBvcmRlciA9IHRoaXMuX29yZGVyICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0KCB2LngsIHYueSwgdi56LCBvcmRlciApOwoKCQl9CgoJCS8qKgoJCSAqIFJlc2V0cyB0aGUgZXVsZXIgYW5nbGUgd2l0aCBhIG5ldyBvcmRlciBieSBjcmVhdGluZyBhIHF1YXRlcm5pb24gZnJvbSB0aGlzCgkJICogZXVsZXIgYW5nbGUgYW5kIHRoZW4gc2V0dGluZyB0aGlzIGV1bGVyIGFuZ2xlIHdpdGggdGhlIHF1YXRlcm5pb24gYW5kIHRoZQoJCSAqIG5ldyBvcmRlci4KCQkgKgoJCSAqIFdhcm5pbmc6IFRoaXMgZGlzY2FyZHMgcmV2b2x1dGlvbiBpbmZvcm1hdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbmV3T3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBuZXcgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgoJCSAqLwoJCXJlb3JkZXIoIG5ld09yZGVyICkgewoKCQkJX3F1YXRlcm5pb24kMy5zZXRGcm9tRXVsZXIoIHRoaXMgKTsKCgkJCXJldHVybiB0aGlzLnNldEZyb21RdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQzLCBuZXdPcmRlciApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgRXVsZXIgaW5zdGFuY2UgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgaW5zdGFuY2UgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIEV1bGVyIGluc3RhbmNlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIGV1bGVyICkgewoKCQkJcmV0dXJuICggZXVsZXIuX3ggPT09IHRoaXMuX3ggKSAmJiAoIGV1bGVyLl95ID09PSB0aGlzLl95ICkgJiYgKCBldWxlci5feiA9PT0gdGhpcy5feiApICYmICggZXVsZXIuX29yZGVyID09PSB0aGlzLl9vcmRlciApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBFdWxlciBpbnN0YW5jZSdzIGNvbXBvbmVudHMgdG8gdmFsdWVzIGZyb20gdGhlIGdpdmVuIGFycmF5LiBUaGUgZmlyc3QgdGhyZWUKCQkgKiBlbnRyaWVzIG9mIHRoZSBhcnJheSBhcmUgYXNzaWduIHRvIHRoZSB4LHkgYW5kIHogY29tcG9uZW50cy4gQW4gb3B0aW9uYWwgZm91cnRoIGVudHJ5CgkJICogZGVmaW5lcyB0aGUgRXVsZXIgb3JkZXIuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcixudW1iZXIsbnVtYmVyLD9zdHJpbmc+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIEV1bGVyIGNvbXBvbmVudCB2YWx1ZXMuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSApIHsKCgkJCXRoaXMuX3ggPSBhcnJheVsgMCBdOwoJCQl0aGlzLl95ID0gYXJyYXlbIDEgXTsKCQkJdGhpcy5feiA9IGFycmF5WyAyIF07CgkJCWlmICggYXJyYXlbIDMgXSAhPT0gdW5kZWZpbmVkICkgdGhpcy5fb3JkZXIgPSBhcnJheVsgMyBdOwoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV3JpdGVzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgRXVsZXIgaW5zdGFuY2UgdG8gdGhlIGdpdmVuIGFycmF5LiBJZiBubyBhcnJheSBpcyBwcm92aWRlZCwKCQkgKiB0aGUgbWV0aG9kIHJldHVybnMgYSBuZXcgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcixudW1iZXIsbnVtYmVyLHN0cmluZz59IFthcnJheT1bXV0gLSBUaGUgdGFyZ2V0IGFycmF5IGhvbGRpbmcgdGhlIEV1bGVyIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyLG51bWJlcixudW1iZXIsc3RyaW5nPn0gVGhlIEV1bGVyIGNvbXBvbmVudHMuCgkJICovCgkJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMuX3g7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLl95OwoJCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy5fejsKCQkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRoaXMuX29yZGVyOwoKCQkJcmV0dXJuIGFycmF5OwoKCQl9CgoJCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgoJCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQkJeWllbGQgdGhpcy5feDsKCQkJeWllbGQgdGhpcy5feTsKCQkJeWllbGQgdGhpcy5fejsKCQkJeWllbGQgdGhpcy5fb3JkZXI7CgoJCX0KCgl9CgoJLyoqCgkgKiBUaGUgZGVmYXVsdCBFdWxlciBhbmdsZSBvcmRlci4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7c3RyaW5nfQoJICogQGRlZmF1bHQgJ1hZWicKCSAqLwoJRXVsZXIuREVGQVVMVF9PUkRFUiA9ICdYWVonOwoKCS8qKgoJICogQSBsYXllcnMgb2JqZWN0IGFzc2lnbnMgYW4gM0Qgb2JqZWN0IHRvIDEgb3IgbW9yZSBvZiAzMgoJICogbGF5ZXJzIG51bWJlcmVkIGAwYCB0byBgMzFgIC0gaW50ZXJuYWxseSB0aGUgbGF5ZXJzIGFyZSBzdG9yZWQgYXMgYQoJICogYml0IG1hc2tdLCBhbmQgYnkgZGVmYXVsdCBhbGwgM0Qgb2JqZWN0cyBhcmUgYSBtZW1iZXIgb2YgbGF5ZXIgYDBgLgoJICoKCSAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gY29udHJvbCB2aXNpYmlsaXR5IC0gYW4gb2JqZWN0IG11c3Qgc2hhcmUgYSBsYXllciB3aXRoCgkgKiBhIGNhbWVyYSB0byBiZSB2aXNpYmxlIHdoZW4gdGhhdCBjYW1lcmEncyB2aWV3IGlzCgkgKiByZW5kZXJlZC4KCSAqCgkgKiBBbGwgY2xhc3NlcyB0aGF0IGluaGVyaXQgZnJvbSB7QGxpbmsgT2JqZWN0M0R9IGhhdmUgYW4gYGxheWVyc2AgcHJvcGVydHkgd2hpY2gKCSAqIGlzIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuCgkgKi8KCWNsYXNzIExheWVycyB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgbGF5ZXJzIGluc3RhbmNlLCB3aXRoIG1lbWJlcnNoaXAKCQkgKiBpbml0aWFsbHkgc2V0IHRvIGxheWVyIGAwYC4KCQkgKi8KCQljb25zdHJ1Y3RvcigpIHsKCgkJCS8qKgoJCQkgKiBBIGJpdCBtYXNrIHN0b3Jpbmcgd2hpY2ggb2YgdGhlIDMyIGxheWVycyB0aGlzIGxheWVycyBvYmplY3QgaXMgY3VycmVudGx5CgkJCSAqIGEgbWVtYmVyIG9mLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy5tYXNrID0gMSB8IDA7CgoJCX0KCgkJLyoqCgkJICogU2V0cyBtZW1iZXJzaGlwIHRvIHRoZSBnaXZlbiBsYXllciwgYW5kIHJlbW92ZSBtZW1iZXJzaGlwIGFsbCBvdGhlciBsYXllcnMuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gbGF5ZXIgLSBUaGUgbGF5ZXIgdG8gc2V0LgoJCSAqLwoJCXNldCggbGF5ZXIgKSB7CgoJCQl0aGlzLm1hc2sgPSAoIDEgPDwgbGF5ZXIgfCAwICkgPj4+IDA7CgoJCX0KCgkJLyoqCgkJICogQWRkcyBtZW1iZXJzaGlwIG9mIHRoZSBnaXZlbiBsYXllci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byBlbmFibGUuCgkJICovCgkJZW5hYmxlKCBsYXllciApIHsKCgkJCXRoaXMubWFzayB8PSAxIDw8IGxheWVyIHwgMDsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIG1lbWJlcnNoaXAgdG8gYWxsIGxheWVycy4KCQkgKi8KCQllbmFibGVBbGwoKSB7CgoJCQl0aGlzLm1hc2sgPSAweGZmZmZmZmZmIHwgMDsKCgkJfQoKCQkvKioKCQkgKiBUb2dnbGVzIHRoZSBtZW1iZXJzaGlwIG9mIHRoZSBnaXZlbiBsYXllci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byB0b2dnbGUuCgkJICovCgkJdG9nZ2xlKCBsYXllciApIHsKCgkJCXRoaXMubWFzayBePSAxIDw8IGxheWVyIHwgMDsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIG1lbWJlcnNoaXAgb2YgdGhlIGdpdmVuIGxheWVyLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIGVuYWJsZS4KCQkgKi8KCQlkaXNhYmxlKCBsYXllciApIHsKCgkJCXRoaXMubWFzayAmPSB+ICggMSA8PCBsYXllciB8IDAgKTsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBtZW1iZXJzaGlwIGZyb20gYWxsIGxheWVycy4KCQkgKi8KCQlkaXNhYmxlQWxsKCkgewoKCQkJdGhpcy5tYXNrID0gMDsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGFuZCB0aGUgZ2l2ZW4gbGF5ZXJzIG9iamVjdCBoYXZlIGF0IGxlYXN0IG9uZQoJCSAqIGxheWVyIGluIGNvbW1vbi4KCQkgKgoJCSAqIEBwYXJhbSB7TGF5ZXJzfSBsYXllcnMgLSBUaGUgbGF5ZXJzIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbiB9IFdoZXRoZXIgdGhpcyBhbmQgdGhlIGdpdmVuIGxheWVycyBvYmplY3QgaGF2ZSBhdCBsZWFzdCBvbmUgbGF5ZXIgaW4gY29tbW9uIG9yIG5vdC4KCQkgKi8KCQl0ZXN0KCBsYXllcnMgKSB7CgoJCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiBsYXllcnMubWFzayApICE9PSAwOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBsYXllciBpcyBlbmFibGVkLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbiB9IFdoZXRoZXIgdGhlIGdpdmVuIGxheWVyIGlzIGVuYWJsZWQgb3Igbm90LgoJCSAqLwoJCWlzRW5hYmxlZCggbGF5ZXIgKSB7CgoJCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiAoIDEgPDwgbGF5ZXIgfCAwICkgKSAhPT0gMDsKCgkJfQoKCX0KCglsZXQgX29iamVjdDNESWQgPSAwOwoKCWNvbnN0IF92MSQ0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ExID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwoJY29uc3QgX20xJDEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IF90YXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX3Bvc2l0aW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfc2NhbGUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9xdWF0ZXJuaW9uJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgoJY29uc3QgX3hBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMCwgMCApOwoJY29uc3QgX3lBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwoJY29uc3QgX3pBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMCwgMSApOwoKCS8qKgoJICogRmlyZXMgd2hlbiB0aGUgb2JqZWN0IGhhcyBiZWVuIGFkZGVkIHRvIGl0cyBwYXJlbnQgb2JqZWN0LgoJICoKCSAqIEBldmVudCBPYmplY3QzRCNhZGRlZAoJICogQHR5cGUge09iamVjdH0KCSAqLwoJY29uc3QgX2FkZGVkRXZlbnQgPSB7IHR5cGU6ICdhZGRlZCcgfTsKCgkvKioKCSAqIEZpcmVzIHdoZW4gdGhlIG9iamVjdCBoYXMgYmVlbiByZW1vdmVkIGZyb20gaXRzIHBhcmVudCBvYmplY3QuCgkgKgoJICogQGV2ZW50IE9iamVjdDNEI3JlbW92ZWQKCSAqIEB0eXBlIHtPYmplY3R9CgkgKi8KCWNvbnN0IF9yZW1vdmVkRXZlbnQgPSB7IHR5cGU6ICdyZW1vdmVkJyB9OwoKCS8qKgoJICogRmlyZXMgd2hlbiBhIG5ldyBjaGlsZCBvYmplY3QgaGFzIGJlZW4gYWRkZWQuCgkgKgoJICogQGV2ZW50IE9iamVjdDNEI2NoaWxkYWRkZWQKCSAqIEB0eXBlIHtPYmplY3R9CgkgKi8KCWNvbnN0IF9jaGlsZGFkZGVkRXZlbnQgPSB7IHR5cGU6ICdjaGlsZGFkZGVkJywgY2hpbGQ6IG51bGwgfTsKCgkvKioKCSAqIEZpcmVzIHdoZW4gYSBjaGlsZCBvYmplY3QgaGFzIGJlZW4gcmVtb3ZlZC4KCSAqCgkgKiBAZXZlbnQgT2JqZWN0M0QjY2hpbGRyZW1vdmVkCgkgKiBAdHlwZSB7T2JqZWN0fQoJICovCgljb25zdCBfY2hpbGRyZW1vdmVkRXZlbnQgPSB7IHR5cGU6ICdjaGlsZHJlbW92ZWQnLCBjaGlsZDogbnVsbCB9OwoKCS8qKgoJICogVGhpcyBpcyB0aGUgYmFzZSBjbGFzcyBmb3IgbW9zdCBvYmplY3RzIGluIHRocmVlLmpzIGFuZCBwcm92aWRlcyBhIHNldCBvZgoJICogcHJvcGVydGllcyBhbmQgbWV0aG9kcyBmb3IgbWFuaXB1bGF0aW5nIG9iamVjdHMgaW4gM0Qgc3BhY2UuCgkgKgoJICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgoJICovCgljbGFzcyBPYmplY3QzRCBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgM0Qgb2JqZWN0LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzT2JqZWN0M0QgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoZSBJRCBvZiB0aGUgM0Qgb2JqZWN0LgoJCQkgKgoJCQkgKiBAbmFtZSBPYmplY3QzRCNpZAoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAcmVhZG9ubHkKCQkJICovCgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX29iamVjdDNESWQgKysgfSApOwoKCQkJLyoqCgkJCSAqIFRoZSBVVUlEIG9mIHRoZSAzRCBvYmplY3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqIEByZWFkb25seQoJCQkgKi8KCQkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCQkvKioKCQkJICogVGhlIG5hbWUgb2YgdGhlIDNEIG9iamVjdC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMubmFtZSA9ICcnOwoKCQkJLyoqCgkJCSAqIFRoZSB0eXBlIHByb3BlcnR5IGlzIHVzZWQgZm9yIGRldGVjdGluZyB0aGUgb2JqZWN0IHR5cGUKCQkJICogaW4gY29udGV4dCBvZiBzZXJpYWxpemF0aW9uL2Rlc2VyaWFsaXphdGlvbi4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnR5cGUgPSAnT2JqZWN0M0QnOwoKCQkJLyoqCgkJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgb2JqZWN0LgoJCQkgKgoJCQkgKiBAdHlwZSB7P09iamVjdDNEfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLnBhcmVudCA9IG51bGw7CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB0aGUgY2hpbGQgM0Qgb2JqZWN0cyBvZiB0aGlzIGluc3RhbmNlLgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0M0Q+fQoJCQkgKi8KCQkJdGhpcy5jaGlsZHJlbiA9IFtdOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGB1cGAgZGlyZWN0aW9uIG9mIHRoZSAzRCBvYmplY3Qgd2hpY2ggaW5mbHVlbmNlcwoJCQkgKiB0aGUgb3JpZW50YXRpb24gdmlhIG1ldGhvZHMgbGlrZSB7QGxpbmsgT2JqZWN0M0QjbG9va0F0fS4KCQkJICoKCQkJICogVGhlIGRlZmF1bHQgdmFsdWVzIGZvciBhbGwgM0Qgb2JqZWN0cyBpcyBkZWZpbmVkIGJ5IGBPYmplY3QzRC5ERUZBVUxUX1VQYC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLnVwID0gT2JqZWN0M0QuREVGQVVMVF9VUC5jbG9uZSgpOwoKCQkJY29uc3QgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCByb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoJCQljb25zdCBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJY29uc3Qgc2NhbGUgPSBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwoKCQkJZnVuY3Rpb24gb25Sb3RhdGlvbkNoYW5nZSgpIHsKCgkJCQlxdWF0ZXJuaW9uLnNldEZyb21FdWxlciggcm90YXRpb24sIGZhbHNlICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvblF1YXRlcm5pb25DaGFuZ2UoKSB7CgoJCQkJcm90YXRpb24uc2V0RnJvbVF1YXRlcm5pb24oIHF1YXRlcm5pb24sIHVuZGVmaW5lZCwgZmFsc2UgKTsKCgkJCX0KCgkJCXJvdGF0aW9uLl9vbkNoYW5nZSggb25Sb3RhdGlvbkNoYW5nZSApOwoJCQlxdWF0ZXJuaW9uLl9vbkNoYW5nZSggb25RdWF0ZXJuaW9uQ2hhbmdlICk7CgoJCQlPYmplY3QuZGVmaW5lUHJvcGVydGllcyggdGhpcywgewoJCQkJLyoqCgkJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBsb2NhbCBwb3NpdGlvbi4KCQkJCSAqCgkJCQkgKiBAbmFtZSBPYmplY3QzRCNwb3NpdGlvbgoJCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCQkgKiBAZGVmYXVsdCAoMCwwLDApCgkJCQkgKi8KCQkJCXBvc2l0aW9uOiB7CgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQkJdmFsdWU6IHBvc2l0aW9uCgkJCQl9LAoJCQkJLyoqCgkJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBsb2NhbCByb3RhdGlvbiBhcyBFdWxlciBhbmdsZXMsIGluIHJhZGlhbnMuCgkJCQkgKgoJCQkJICogQG5hbWUgT2JqZWN0M0Qjcm90YXRpb24KCQkJCSAqIEB0eXBlIHtFdWxlcn0KCQkJCSAqIEBkZWZhdWx0ICgwLDAsMCkKCQkJCSAqLwoJCQkJcm90YXRpb246IHsKCQkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCQl2YWx1ZTogcm90YXRpb24KCQkJCX0sCgkJCQkvKioKCQkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHJvdGF0aW9uIGFzIFF1YXRlcm5pb25zLgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI3F1YXRlcm5pb24KCQkJCSAqIEB0eXBlIHtRdWF0ZXJuaW9ufQoJCQkJICovCgkJCQlxdWF0ZXJuaW9uOiB7CgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQkJdmFsdWU6IHF1YXRlcm5pb24KCQkJCX0sCgkJCQkvKioKCQkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHNjYWxlLgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI3NjYWxlCgkJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJCSAqIEBkZWZhdWx0ICgxLDEsMSkKCQkJCSAqLwoJCQkJc2NhbGU6IHsKCQkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCQl2YWx1ZTogc2NhbGUKCQkJCX0sCgkJCQkvKioKCQkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIG1vZGVsLXZpZXcgbWF0cml4LgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI21vZGVsVmlld01hdHJpeAoJCQkJICogQHR5cGUge01hdHJpeDR9CgkJCQkgKi8KCQkJCW1vZGVsVmlld01hdHJpeDogewoJCQkJCXZhbHVlOiBuZXcgTWF0cml4NCgpCgkJCQl9LAoJCQkJLyoqCgkJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBub3JtYWwgbWF0cml4LgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI25vcm1hbE1hdHJpeAoJCQkJICogQHR5cGUge01hdHJpeDN9CgkJCQkgKi8KCQkJCW5vcm1hbE1hdHJpeDogewoJCQkJCXZhbHVlOiBuZXcgTWF0cml4MygpCgkJCQl9CgkJCX0gKTsKCgkJCS8qKgoJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gbG9jYWwgc3BhY2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRyaXg0fQoJCQkgKi8KCQkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBpbiB3b3JsZCBzcGFjZS4KCQkJICogSWYgdGhlIDNEIG9iamVjdCBoYXMgbm8gcGFyZW50LCB0aGVuIGl0J3MgaWRlbnRpY2FsIHRvIHRoZSBsb2NhbCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCQkJICoKCQkJICogQHR5cGUge01hdHJpeDR9CgkJCSAqLwoJCQl0aGlzLm1hdHJpeFdvcmxkID0gbmV3IE1hdHJpeDQoKTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgbG9jYWwgbWF0cml4IGZyb20gcG9zaXRpb24sCgkJCSAqIHJvdGF0aW9uIGFuZCBzY2FsZSBldmVyeSBmcmFtZS4KCQkJICoKCQkJICogVGhlIGRlZmF1bHQgdmFsdWVzIGZvciBhbGwgM0Qgb2JqZWN0cyBpcyBkZWZpbmVkIGJ5IGBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURWAuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgd29ybGQgbWF0cml4IGZyb20gdGhlIGN1cnJlbnQgbG9jYWwKCQkJICogbWF0cml4IGFuZCB0aGUgb2JqZWN0J3MgdHJhbnNmb3JtYXRpb24gaGllcmFyY2h5LgoJCQkgKgoJCQkgKiBUaGUgZGVmYXVsdCB2YWx1ZXMgZm9yIGFsbCAzRCBvYmplY3RzIGlzIGRlZmluZWQgYnkgYE9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFYC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID0gT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfV09STERfQVVUT19VUERBVEU7IC8vIGNoZWNrZWQgYnkgdGhlIHJlbmRlcmVyCgoJCQkvKioKCQkJICogV2hlbiBzZXQgdG8gYHRydWVgLCBpdCBjYWxjdWxhdGVzIHRoZSB3b3JsZCBtYXRyaXggaW4gdGhhdCBmcmFtZSBhbmQgcmVzZXRzIHRoaXMgcHJvcGVydHkKCQkJICogdG8gYGZhbHNlYC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBUaGUgbGF5ZXIgbWVtYmVyc2hpcCBvZiB0aGUgM0Qgb2JqZWN0LiBUaGUgM0Qgb2JqZWN0IGlzIG9ubHkgdmlzaWJsZSBpZiBpdCBoYXMKCQkJICogYXQgbGVhc3Qgb25lIGxheWVyIGluIGNvbW1vbiB3aXRoIHRoZSBjYW1lcmEgaW4gdXNlLiBUaGlzIHByb3BlcnR5IGNhbiBhbHNvIGJlCgkJCSAqIHVzZWQgdG8gZmlsdGVyIG91dCB1bndhbnRlZCBvYmplY3RzIGluIHJheS1pbnRlcnNlY3Rpb24gdGVzdHMgd2hlbiB1c2luZyB7QGxpbmsgUmF5Y2FzdGVyfS4KCQkJICoKCQkJICogQHR5cGUge0xheWVyc30KCQkJICovCgkJCXRoaXMubGF5ZXJzID0gbmV3IExheWVycygpOwoKCQkJLyoqCgkJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBnZXRzIHJlbmRlcmVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy52aXNpYmxlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSAzRCBvYmplY3QgZ2V0cyByZW5kZXJlZCBpbnRvIHNoYWRvdyBtYXBzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuY2FzdFNoYWRvdyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBpcyBhZmZlY3RlZCBieSBzaGFkb3dzIGluIHRoZSBzY2VuZS4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSAzRCBvYmplY3QgaXMgaG9ub3JlZCBieSB2aWV3IGZydXN0dW0gY3VsbGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHRydWU7CgoJCQkvKioKCQkJICogVGhpcyB2YWx1ZSBhbGxvd3MgdGhlIGRlZmF1bHQgcmVuZGVyaW5nIG9yZGVyIG9mIHNjZW5lIGdyYXBoIG9iamVjdHMgdG8gYmUKCQkJICogb3ZlcnJpZGRlbiBhbHRob3VnaCBvcGFxdWUgYW5kIHRyYW5zcGFyZW50IG9iamVjdHMgcmVtYWluIHNvcnRlZCBpbmRlcGVuZGVudGx5LgoJCQkgKiBXaGVuIHRoaXMgcHJvcGVydHkgaXMgc2V0IGZvciBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgR3JvdXB9LGFsbCBkZXNjZW5kYW50cwoJCQkgKiBvYmplY3RzIHdpbGwgYmUgc29ydGVkIGFuZCByZW5kZXJlZCB0b2dldGhlci4gU29ydGluZyBpcyBmcm9tIGxvd2VzdCB0byBoaWdoZXN0CgkJCSAqIHJlbmRlciBvcmRlci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5yZW5kZXJPcmRlciA9IDA7CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB0aGUgYW5pbWF0aW9uIGNsaXBzIG9mIHRoZSAzRCBvYmplY3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtBcnJheTxBbmltYXRpb25DbGlwPn0KCQkJICovCgkJCXRoaXMuYW5pbWF0aW9ucyA9IFtdOwoKCQkJLyoqCgkJCSAqIEN1c3RvbSBkZXB0aCBtYXRlcmlhbCB0byBiZSB1c2VkIHdoZW4gcmVuZGVyaW5nIHRvIHRoZSBkZXB0aCBtYXAuIENhbiBvbmx5IGJlIHVzZWQKCQkJICogaW4gY29udGV4dCBvZiBtZXNoZXMuIFdoZW4gc2hhZG93LWNhc3Rpbmcgd2l0aCBhIHtAbGluayBEaXJlY3Rpb25hbExpZ2h0fSBvciB7QGxpbmsgU3BvdExpZ2h0fSwKCQkJICogaWYgeW91IGFyZSBtb2RpZnlpbmcgdmVydGV4IHBvc2l0aW9ucyBpbiB0aGUgdmVydGV4IHNoYWRlciB5b3UgbXVzdCBzcGVjaWZ5IGEgY3VzdG9tIGRlcHRoCgkJCSAqIG1hdGVyaWFsIGZvciBwcm9wZXIgc2hhZG93cy4KCQkJICoKCQkJICogT25seSByZWxldmFudCBpbiBjb250ZXh0IG9mIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KCQkJICoKCQkJICogQHR5cGUgeyhNYXRlcmlhbHx1bmRlZmluZWQpfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMuY3VzdG9tRGVwdGhNYXRlcmlhbCA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBTYW1lIGFzIHtAbGluayBPYmplY3QzRCNjdXN0b21EZXB0aE1hdGVyaWFsfSwgYnV0IHVzZWQgd2l0aCB7QGxpbmsgUG9pbnRMaWdodH0uCgkJCSAqCgkJCSAqIE9ubHkgcmVsZXZhbnQgaW4gY29udGV4dCBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHsoTWF0ZXJpYWx8dW5kZWZpbmVkKX0KCQkJICogQGRlZmF1bHQgdW5kZWZpbmVkCgkJCSAqLwoJCQl0aGlzLmN1c3RvbURpc3RhbmNlTWF0ZXJpYWwgPSB1bmRlZmluZWQ7CgoJCQkvKioKCQkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIDNEIG9iamVjdC4gSXQKCQkJICogc2hvdWxkIG5vdCBob2xkIHJlZmVyZW5jZXMgdG8gZnVuY3Rpb25zIGFzIHRoZXNlIHdpbGwgbm90IGJlIGNsb25lZC4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMudXNlckRhdGEgPSB7fTsKCgkJfQoKCQkvKioKCQkgKiBBIGNhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgaW1tZWRpYXRlbHkgYmVmb3JlIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkIHRvIGEgc2hhZG93IG1hcC4KCQkgKgoJCSAqIEBwYXJhbSB7UmVuZGVyZXJ8V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBzY2VuZS4KCQkgKiBAcGFyYW0ge0NhbWVyYX0gc2hhZG93Q2FtZXJhIC0gVGhlIHNoYWRvdyBjYW1lcmEuCgkJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtNYXRlcmlhbH0gZGVwdGhNYXRlcmlhbCAtIFRoZSBkZXB0aCBtYXRlcmlhbC4KCQkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KCQkgKi8KCQlvbkJlZm9yZVNoYWRvdyggLyogcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCAqLyApIHt9CgoJCS8qKgoJCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBhZnRlciBhIDNEIG9iamVjdCBpcyByZW5kZXJlZCB0byBhIHNoYWRvdyBtYXAuCgkJICoKCQkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCgkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCgkJICogQHBhcmFtIHtDYW1lcmF9IHNoYWRvd0NhbWVyYSAtIFRoZSBzaGFkb3cgY2FtZXJhLgoJCSAqIEBwYXJhbSB7QnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5IC0gVGhlIDNEIG9iamVjdCdzIGdlb21ldHJ5LgoJCSAqIEBwYXJhbSB7TWF0ZXJpYWx9IGRlcHRoTWF0ZXJpYWwgLSBUaGUgZGVwdGggbWF0ZXJpYWwuCgkJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCgkJICovCgkJb25BZnRlclNoYWRvdyggLyogcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCAqLyApIHt9CgoJCS8qKgoJCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgYSAzRCBvYmplY3QgaXMgcmVuZGVyZWQuCgkJICoKCQkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCgkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCgkJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtNYXRlcmlhbH0gbWF0ZXJpYWwgLSBUaGUgM0Qgb2JqZWN0J3MgbWF0ZXJpYWwuCgkJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCgkJICovCgkJb25CZWZvcmVSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCgkJLyoqCgkJICogQSBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGFmdGVyIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkLgoJCSAqCgkJICogQHBhcmFtIHtSZW5kZXJlcnxXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KCQkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0LgoJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhIHRoYXQgaXMgdXNlZCB0byByZW5kZXIgdGhlIHNjZW5lLgoJCSAqIEBwYXJhbSB7QnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5IC0gVGhlIDNEIG9iamVjdCdzIGdlb21ldHJ5LgoJCSAqIEBwYXJhbSB7TWF0ZXJpYWx9IG1hdGVyaWFsIC0gVGhlIDNEIG9iamVjdCdzIG1hdGVyaWFsLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBncm91cCAtIFRoZSBnZW9tZXRyeSBncm91cCBkYXRhLgoJCSAqLwoJCW9uQWZ0ZXJSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gdHJhbnNmb3JtYXRpb24gbWF0cml4IHRvIHRoZSBvYmplY3QgYW5kIHVwZGF0ZXMgdGhlIG9iamVjdCdzIHBvc2l0aW9uLAoJCSAqIHJvdGF0aW9uIGFuZCBzY2FsZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KCQkgKi8KCQlhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJCXRoaXMubWF0cml4LnByZW11bHRpcGx5KCBtYXRyaXggKTsKCgkJCXRoaXMubWF0cml4LmRlY29tcG9zZSggdGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCB0aGlzLnNjYWxlICk7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyBhIHJvdGF0aW9uIHJlcHJlc2VudGVkIGJ5IGdpdmVuIHRoZSBxdWF0ZXJuaW9uIHRvIHRoZSAzRCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgcXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlhcHBseVF1YXRlcm5pb24oIHEgKSB7CgoJCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIHEgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIGFuIGF4aXMvYW5nbGUgY291cGxlIHRvIHRoZSAzRCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqLwoJCXNldFJvdGF0aW9uRnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgoJCQkvLyBhc3N1bWVzIGF4aXMgaXMgbm9ybWFsaXplZAoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgZ2l2ZW4gcm90YXRpb24gcmVwcmVzZW50ZWQgYXMgRXVsZXIgYW5nbGVzIHRvIHRoZSAzRCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCgkJICovCgkJc2V0Um90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciggZXVsZXIsIHRydWUgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiByb3RhdGlvbiByZXByZXNlbnRlZCBhcyByb3RhdGlvbiBtYXRyaXggdG8gdGhlIDNEIG9iamVjdC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEFsdGhvdWdoIGEgNHg0IG1hdHJpeCBpcyBleHBlY3RlZCwgdGhlIHVwcGVyIDN4MyBwb3J0aW9uIG11c3QgYmUKCQkgKiBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKS4KCQkgKi8KCQlzZXRSb3RhdGlvbkZyb21NYXRyaXgoIG0gKSB7CgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIGEgUXVhdGVybmlvbiB0byB0aGUgM0Qgb2JqZWN0LgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24KCQkgKi8KCQlzZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKCQkJLy8gYXNzdW1lcyBxIGlzIG5vcm1hbGl6ZWQKCgkJCXRoaXMucXVhdGVybmlvbi5jb3B5KCBxICk7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFsb25nIGFuIGF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJvdGF0ZU9uQXhpcyggYXhpcywgYW5nbGUgKSB7CgoJCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gb2JqZWN0IHNwYWNlCgkJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCQlfcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCgkJCXRoaXMucXVhdGVybmlvbi5tdWx0aXBseSggX3ExICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYWxvbmcgYW4gYXhpcyBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSAobm9ybWFsaXplZCkgYXhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJcm90YXRlT25Xb3JsZEF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkJLy8gcm90YXRlIG9iamVjdCBvbiBheGlzIGluIHdvcmxkIHNwYWNlCgkJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgkJCS8vIG1ldGhvZCBhc3N1bWVzIG5vIHJvdGF0ZWQgcGFyZW50CgoJCQlfcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCgkJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYXJvdW5kIGl0cyBYIGF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlyb3RhdGVYKCBhbmdsZSApIHsKCgkJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggX3hBeGlzLCBhbmdsZSApOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhlIDNEIG9iamVjdCBhcm91bmQgaXRzIFkgYXhpcyBpbiBsb2NhbCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJvdGF0ZVkoIGFuZ2xlICkgewoKCQkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCBfeUF4aXMsIGFuZ2xlICk7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFyb3VuZCBpdHMgWiBheGlzIGluIGxvY2FsIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJcm90YXRlWiggYW5nbGUgKSB7CgoJCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIF96QXhpcywgYW5nbGUgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIHRoZSBnaXZlbiBheGlzIGluIGxvY2FsIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBheGlzIC0gVGhlIChub3JtYWxpemVkKSBheGlzIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlT25BeGlzKCBheGlzLCBkaXN0YW5jZSApIHsKCgkJCS8vIHRyYW5zbGF0ZSBvYmplY3QgYnkgZGlzdGFuY2UgYWxvbmcgYXhpcyBpbiBvYmplY3Qgc3BhY2UKCQkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJCV92MSQ0LmNvcHkoIGF4aXMgKS5hcHBseVF1YXRlcm5pb24oIHRoaXMucXVhdGVybmlvbiApOwoKCQkJdGhpcy5wb3NpdGlvbi5hZGQoIF92MSQ0Lm11bHRpcGx5U2NhbGFyKCBkaXN0YW5jZSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBYLWF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlWCggZGlzdGFuY2UgKSB7CgoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF94QXhpcywgZGlzdGFuY2UgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBZLWF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlWSggZGlzdGFuY2UgKSB7CgoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF95QXhpcywgZGlzdGFuY2UgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBaLWF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlWiggZGlzdGFuY2UgKSB7CgoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF96QXhpcywgZGlzdGFuY2UgKTsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyAzRCBvYmplY3QncyBsb2NhbCBzcGFjZSB0byB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0byBjb252ZXJ0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb252ZXJ0ZWQgdmVjdG9yLgoJCSAqLwoJCWxvY2FsVG9Xb3JsZCggdmVjdG9yICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhlIGdpdmVuIHZlY3RvciBmcm9tIHRoaXMgM0Qgb2JqZWN0J3Mgd29yZCBzcGFjZSB0byBsb2NhbCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0byBjb252ZXJ0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb252ZXJ0ZWQgdmVjdG9yLgoJCSAqLwoJCXdvcmxkVG9Mb2NhbCggdmVjdG9yICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCBfbTEkMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKSApOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhlIG9iamVjdCB0byBmYWNlIGEgcG9pbnQgaW4gd29ybGQgc3BhY2UuCgkJICoKCQkgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IG9iamVjdHMgaGF2aW5nIG5vbi11bmlmb3JtbHktc2NhbGVkIHBhcmVudChzKS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfFZlY3RvcjN9IHggLSBUaGUgeCBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLiBBbHRlcm5hdGl2ZWx5LCBhIHZlY3RvciByZXByZXNlbnRpbmcgYSBwb3NpdGlvbiBpbiB3b3JsZCBzcGFjZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeV0gLSBUaGUgeSBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbel0gLSBUaGUgeiBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLgoJCSAqLwoJCWxvb2tBdCggeCwgeSwgeiApIHsKCgkJCS8vIFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgb2JqZWN0cyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgcGFyZW50KHMpCgoJCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJCV90YXJnZXQuY29weSggeCApOwoKCQkJfSBlbHNlIHsKCgkJCQlfdGFyZ2V0LnNldCggeCwgeSwgeiApOwoKCQkJfQoKCQkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJX3Bvc2l0aW9uJDMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCQlpZiAoIHRoaXMuaXNDYW1lcmEgfHwgdGhpcy5pc0xpZ2h0ICkgewoKCQkJCV9tMSQxJDEubG9va0F0KCBfcG9zaXRpb24kMywgX3RhcmdldCwgdGhpcy51cCApOwoKCQkJfSBlbHNlIHsKCgkJCQlfbTEkMSQxLmxvb2tBdCggX3RhcmdldCwgX3Bvc2l0aW9uJDMsIHRoaXMudXAgKTsKCgkJCX0KCgkJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxJDEgKTsKCgkJCWlmICggcGFyZW50ICkgewoKCQkJCV9tMSQxJDEuZXh0cmFjdFJvdGF0aW9uKCBwYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCV9xMS5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxJDEgKTsKCQkJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExLmludmVydCgpICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gM0Qgb2JqZWN0IGFzIGEgY2hpbGQgdG8gdGhpcyAzRCBvYmplY3QuIEFuIGFyYml0cmFyeSBudW1iZXIgb2YKCQkgKiBvYmplY3RzIG1heSBiZSBhZGRlZC4gQW55IGN1cnJlbnQgcGFyZW50IG9uIGFuIG9iamVjdCBwYXNzZWQgaW4gaGVyZSB3aWxsIGJlCgkJICogcmVtb3ZlZCwgc2luY2UgYW4gb2JqZWN0IGNhbiBoYXZlIGF0IG1vc3Qgb25lIHBhcmVudC4KCQkgKgoJCSAqIEBmaXJlcyBPYmplY3QzRCNhZGRlZAoJCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZGFkZGVkCgkJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0byBhZGQuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYWRkKCBvYmplY3QgKSB7CgoJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXRoaXMuYWRkKCBhcmd1bWVudHNbIGkgXSApOwoKCQkJCX0KCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggb2JqZWN0ID09PSB0aGlzICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBjYW5cJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuJywgb2JqZWN0ICk7CgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggb2JqZWN0ICYmIG9iamVjdC5pc09iamVjdDNEICkgewoKCQkJCW9iamVjdC5yZW1vdmVGcm9tUGFyZW50KCk7CgkJCQlvYmplY3QucGFyZW50ID0gdGhpczsKCQkJCXRoaXMuY2hpbGRyZW4ucHVzaCggb2JqZWN0ICk7CgoJCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgoJCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG9iamVjdDsKCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkYWRkZWRFdmVudCApOwoJCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG51bGw7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuJywgb2JqZWN0ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgY2hpbGQgZnJvbSB0aGlzIDNEIG9iamVjdC4KCQkgKiBBbiBhcmJpdHJhcnkgbnVtYmVyIG9mIG9iamVjdHMgbWF5IGJlIHJlbW92ZWQuCgkJICoKCQkgKiBAZmlyZXMgT2JqZWN0M0QjcmVtb3ZlZAoJCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZHJlbW92ZWQKCQkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIHJlbW92ZS4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlyZW1vdmUoIG9iamVjdCApIHsKCgkJCWlmICggYXJndW1lbnRzLmxlbmd0aCA+IDEgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJdGhpcy5yZW1vdmUoIGFyZ3VtZW50c1sgaSBdICk7CgoJCQkJfQoKCQkJCXJldHVybiB0aGlzOwoKCQkJfQoKCQkJY29uc3QgaW5kZXggPSB0aGlzLmNoaWxkcmVuLmluZGV4T2YoIG9iamVjdCApOwoKCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgoJCQkJb2JqZWN0LnBhcmVudCA9IG51bGw7CgkJCQl0aGlzLmNoaWxkcmVuLnNwbGljZSggaW5kZXgsIDEgKTsKCgkJCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggX3JlbW92ZWRFdmVudCApOwoKCQkJCV9jaGlsZHJlbW92ZWRFdmVudC5jaGlsZCA9IG9iamVjdDsKCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkcmVtb3ZlZEV2ZW50ICk7CgkJCQlfY2hpbGRyZW1vdmVkRXZlbnQuY2hpbGQgPSBudWxsOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmVtb3ZlcyB0aGlzIDNEIG9iamVjdCBmcm9tIGl0cyBjdXJyZW50IHBhcmVudC4KCQkgKgoJCSAqIEBmaXJlcyBPYmplY3QzRCNyZW1vdmVkCgkJICogQGZpcmVzIE9iamVjdDNEI2NoaWxkcmVtb3ZlZAoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJlbW92ZUZyb21QYXJlbnQoKSB7CgoJCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCgkJCWlmICggcGFyZW50ICE9PSBudWxsICkgewoKCQkJCXBhcmVudC5yZW1vdmUoIHRoaXMgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJlbW92ZXMgYWxsIGNoaWxkIG9iamVjdHMuCgkJICoKCQkgKiBAZmlyZXMgT2JqZWN0M0QjcmVtb3ZlZAoJCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZHJlbW92ZWQKCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbGVhcigpIHsKCgkJCXJldHVybiB0aGlzLnJlbW92ZSggLi4uIHRoaXMuY2hpbGRyZW4gKTsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzIDNEIG9iamVjdCwgd2hpbGUgbWFpbnRhaW5pbmcgdGhlIG9iamVjdCdzIHdvcmxkCgkJICogdHJhbnNmb3JtLiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykuCgkJICoKCQkgKiBAZmlyZXMgT2JqZWN0M0QjYWRkZWQKCQkgKiBAZmlyZXMgT2JqZWN0M0QjY2hpbGRhZGRlZAoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gYXR0YWNoLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWF0dGFjaCggb2JqZWN0ICkgewoKCQkJLy8gYWRkcyBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzLCB3aGlsZSBtYWludGFpbmluZyB0aGUgb2JqZWN0J3Mgd29ybGQgdHJhbnNmb3JtCgoJCQkvLyBOb3RlOiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykKCgkJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCQlfbTEkMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJCWlmICggb2JqZWN0LnBhcmVudCAhPT0gbnVsbCApIHsKCgkJCQlvYmplY3QucGFyZW50LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJCV9tMSQxJDEubXVsdGlwbHkoIG9iamVjdC5wYXJlbnQubWF0cml4V29ybGQgKTsKCgkJCX0KCgkJCW9iamVjdC5hcHBseU1hdHJpeDQoIF9tMSQxJDEgKTsKCgkJCW9iamVjdC5yZW1vdmVGcm9tUGFyZW50KCk7CgkJCW9iamVjdC5wYXJlbnQgPSB0aGlzOwoJCQl0aGlzLmNoaWxkcmVuLnB1c2goIG9iamVjdCApOwoKCQkJb2JqZWN0LnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgdHJ1ZSApOwoKCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgoJCQlfY2hpbGRhZGRlZEV2ZW50LmNoaWxkID0gb2JqZWN0OwoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIF9jaGlsZGFkZGVkRXZlbnQgKTsKCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG51bGw7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZWFyY2hlcyB0aHJvdWdoIHRoZSAzRCBvYmplY3QgYW5kIGl0cyBjaGlsZHJlbiwgc3RhcnRpbmcgd2l0aCB0aGUgM0Qgb2JqZWN0CgkJICogaXRzZWxmLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgd2l0aCBhIG1hdGNoaW5nIElELgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGlkIC0gVGhlIGlkLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfHVuZGVmaW5lZH0gVGhlIGZvdW5kIDNEIG9iamVjdC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBubyAzRCBvYmplY3QgaGFzIGJlZW4gZm91bmQuCgkJICovCgkJZ2V0T2JqZWN0QnlJZCggaWQgKSB7CgoJCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnaWQnLCBpZCApOwoKCQl9CgoJCS8qKgoJCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKCQkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIHRoZSBmaXJzdCB3aXRoIGEgbWF0Y2hpbmcgbmFtZS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUuCgkJICogQHJldHVybiB7T2JqZWN0M0R8dW5kZWZpbmVkfSBUaGUgZm91bmQgM0Qgb2JqZWN0LiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIG5vIDNEIG9iamVjdCBoYXMgYmVlbiBmb3VuZC4KCQkgKi8KCQlnZXRPYmplY3RCeU5hbWUoIG5hbWUgKSB7CgoJCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnbmFtZScsIG5hbWUgKTsKCgkJfQoKCQkvKioKCQkgKiBTZWFyY2hlcyB0aHJvdWdoIHRoZSAzRCBvYmplY3QgYW5kIGl0cyBjaGlsZHJlbiwgc3RhcnRpbmcgd2l0aCB0aGUgM0Qgb2JqZWN0CgkJICogaXRzZWxmLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgd2l0aCBhIG1hdGNoaW5nIHByb3BlcnR5IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkuCgkJICogQHBhcmFtIHthbnl9IHZhbHVlIC0gVGhlIHZhbHVlLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfHVuZGVmaW5lZH0gVGhlIGZvdW5kIDNEIG9iamVjdC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBubyAzRCBvYmplY3QgaGFzIGJlZW4gZm91bmQuCgkJICovCgkJZ2V0T2JqZWN0QnlQcm9wZXJ0eSggbmFtZSwgdmFsdWUgKSB7CgoJCQlpZiAoIHRoaXNbIG5hbWUgXSA9PT0gdmFsdWUgKSByZXR1cm4gdGhpczsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW5bIGkgXTsKCQkJCWNvbnN0IG9iamVjdCA9IGNoaWxkLmdldE9iamVjdEJ5UHJvcGVydHkoIG5hbWUsIHZhbHVlICk7CgoJCQkJaWYgKCBvYmplY3QgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcmV0dXJuIG9iamVjdDsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdW5kZWZpbmVkOwoKCQl9CgoJCS8qKgoJCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKCQkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIGFsbCAzRCBvYmplY3RzIHdpdGggYSBtYXRjaGluZyBwcm9wZXJ0eSB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5LgoJCSAqIEBwYXJhbSB7YW55fSB2YWx1ZSAtIFRoZSB2YWx1ZS4KCQkgKiBAcGFyYW0ge0FycmF5PE9iamVjdDNEPn0gcmVzdWx0IC0gVGhlIG1ldGhvZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PE9iamVjdDNEPn0gVGhlIGZvdW5kIDNEIG9iamVjdHMuCgkJICovCgkJZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgPSBbXSApIHsKCgkJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJlc3VsdC5wdXNoKCB0aGlzICk7CgoJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNoaWxkcmVuWyBpIF0uZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgKTsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoZSByZXN1bHQgaXMgc3RvcmVkIHRvLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSAzRCBvYmplY3QncyBwb3NpdGlvbiBpbiB3b3JsZCBzcGFjZS4KCQkgKi8KCQlnZXRXb3JsZFBvc2l0aW9uKCB0YXJnZXQgKSB7CgoJCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJcmV0dXJuIHRhcmdldC5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubWF0cml4V29ybGQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgUXVhdGVybmlvbiByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHRhcmdldCAtIFRoZSB0YXJnZXQgUXVhdGVybmlvbiB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBUaGUgM0Qgb2JqZWN0J3Mgcm90YXRpb24gaW4gd29ybGQgc3BhY2UuCgkJICovCgkJZ2V0V29ybGRRdWF0ZXJuaW9uKCB0YXJnZXQgKSB7CgoJCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQzLCB0YXJnZXQsIF9zY2FsZSQyICk7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSBzY2FsZSBvZiB0aGUgM0Qgb2JqZWN0IGluIHdvcmxkIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgM0Qgb2JqZWN0J3Mgc2NhbGUgaW4gd29ybGQgc3BhY2UuCgkJICovCgkJZ2V0V29ybGRTY2FsZSggdGFyZ2V0ICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCXRoaXMubWF0cml4V29ybGQuZGVjb21wb3NlKCBfcG9zaXRpb24kMywgX3F1YXRlcm5pb24kMiwgdGFyZ2V0ICk7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSAoImxvb2siKSBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIGRpcmVjdGlvbiBpbiB3b3JsZCBzcGFjZS4KCQkgKi8KCQlnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCWNvbnN0IGUgPSB0aGlzLm1hdHJpeFdvcmxkLmVsZW1lbnRzOwoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIGVbIDggXSwgZVsgOSBdLCBlWyAxMCBdICkubm9ybWFsaXplKCk7CgoJCX0KCgkJLyoqCgkJICogQWJzdHJhY3QgbWV0aG9kIHRvIGdldCBpbnRlcnNlY3Rpb25zIGJldHdlZW4gYSBjYXN0ZWQgcmF5IGFuZCB0aGlzCgkJICogM0Qgb2JqZWN0LiBSZW5kZXJhYmxlIDNEIG9iamVjdHMgc3VjaCBhcyB7QGxpbmsgTWVzaH0sIHtAbGluayBMaW5lfSBvciB7QGxpbmsgUG9pbnRzfQoJCSAqIGltcGxlbWVudCB0aGlzIG1ldGhvZCBpbiBvcmRlciB0byB1c2UgcmF5Y2FzdGluZy4KCQkgKgoJCSAqIEBhYnN0cmFjdAoJCSAqIEBwYXJhbSB7UmF5Y2FzdGVyfSByYXljYXN0ZXIgLSBUaGUgcmF5Y2FzdGVyLgoJCSAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gaW50ZXJzZWN0cyAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIHJlc3VsdCBvZiB0aGUgbWV0aG9kLgoJCSAqLwoJCXJheWNhc3QoIC8qIHJheWNhc3RlciwgaW50ZXJzZWN0cyAqLyApIHt9CgoJCS8qKgoJCSAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBvbiB0aGlzIDNEIG9iamVjdCBhbmQgYWxsIGRlc2NlbmRhbnRzLgoJCSAqCgkJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgoJCSAqCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgoJCSAqLwoJCXRyYXZlcnNlKCBjYWxsYmFjayApIHsKCgkJCWNhbGxiYWNrKCB0aGlzICk7CgoJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNoaWxkcmVuWyBpIF0udHJhdmVyc2UoIGNhbGxiYWNrICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogTGlrZSB7QGxpbmsgT2JqZWN0M0QjdHJhdmVyc2V9LCBidXQgdGhlIGNhbGxiYWNrIHdpbGwgb25seSBiZSBleGVjdXRlZCBmb3IgdmlzaWJsZSAzRCBvYmplY3RzLgoJCSAqIERlc2NlbmRhbnRzIG9mIGludmlzaWJsZSAzRCBvYmplY3RzIGFyZSBub3QgdHJhdmVyc2VkLgoJCSAqCgkJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgoJCSAqCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgoJCSAqLwoJCXRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKSB7CgoJCQlpZiAoIHRoaXMudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQljYWxsYmFjayggdGhpcyApOwoKCQkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljaGlsZHJlblsgaSBdLnRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBMaWtlIHtAbGluayBPYmplY3QzRCN0cmF2ZXJzZX0sIGJ1dCB0aGUgY2FsbGJhY2sgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGZvciBhbGwgYW5jZXN0b3JzLgoJCSAqCgkJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgoJCSAqCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgoJCSAqLwoJCXRyYXZlcnNlQW5jZXN0b3JzKCBjYWxsYmFjayApIHsKCgkJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgoJCQkJY2FsbGJhY2soIHBhcmVudCApOwoKCQkJCXBhcmVudC50cmF2ZXJzZUFuY2VzdG9ycyggY2FsbGJhY2sgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gbG9jYWwgc3BhY2UgYnkgY29tcHV0aW5nIGl0IGZyb20gdGhlIGN1cnJlbnQKCQkgKiBwb3NpdGlvbiwgcm90YXRpb24gYW5kIHNjYWxlIHZhbHVlcy4KCQkgKi8KCQl1cGRhdGVNYXRyaXgoKSB7CgoJCQl0aGlzLm1hdHJpeC5jb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCgkJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJLyoqCgkJICogVXBkYXRlcyB0aGUgdHJhbnNmb3JtYXRpb24gbWF0cml4IGluIHdvcmxkIHNwYWNlIG9mIHRoaXMgM0Qgb2JqZWN0cyBhbmQgaXRzIGRlc2NlbmRhbnRzLgoJCSAqCgkJICogVG8gZW5zdXJlIGNvcnJlY3QgcmVzdWx0cywgdGhpcyBtZXRob2QgYWxzbyByZWNvbXB1dGVzIHRoZSAzRCBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4KCQkgKiBsb2NhbCBzcGFjZS4gVGhlIGNvbXB1dGF0aW9uIG9mIHRoZSBsb2NhbCBhbmQgd29ybGQgbWF0cml4IGNhbiBiZSBjb250cm9sbGVkIHdpdGggdGhlCgkJICoge0BsaW5rIE9iamVjdDNEI21hdHJpeEF1dG9VcGRhdGV9IGFuZCB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBmbGFncyB3aGljaCBhcmUgYm90aAoJCSAqIGB0cnVlYCBieSBkZWZhdWx0LiAgU2V0IHRoZXNlIGZsYWdzIHRvIGBmYWxzZWAgaWYgeW91IG5lZWQgbW9yZSBjb250cm9sIG92ZXIgdGhlIHVwZGF0ZSBtYXRyaXggcHJvY2Vzcy4KCQkgKgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlPWZhbHNlXSAtIFdoZW4gc2V0IHRvIGB0cnVlYCwgYSByZWNvbXB1dGF0aW9uIG9mIHdvcmxkIG1hdHJpY2VzIGlzIGZvcmNlZCBldmVuCgkJICogd2hlbiB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBpcyBzZXQgdG8gYGZhbHNlYC4KCQkgKi8KCQl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCQlpZiAoIHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSB8fCBmb3JjZSApIHsKCgkJCQlpZiAoIHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQlpZiAoIHRoaXMucGFyZW50ID09PSBudWxsICkgewoKCQkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5tYXRyaXhXb3JsZC5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLnBhcmVudC5tYXRyaXhXb3JsZCwgdGhpcy5tYXRyaXggKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCQlmb3JjZSA9IHRydWU7CgoJCQl9CgoJCQkvLyBtYWtlIHN1cmUgZGVzY2VuZGFudHMgYXJlIHVwZGF0ZWQgaWYgcmVxdWlyZWQKCgkJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKCQkJCWNoaWxkLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIEFuIGFsdGVybmF0aXZlIHZlcnNpb24gb2Yge0BsaW5rIE9iamVjdDNEI3VwZGF0ZU1hdHJpeFdvcmxkfSB3aXRoIG1vcmUgY29udHJvbCBvdmVyIHRoZQoJCSAqIHVwZGF0ZSBvZiBhbmNlc3RvciBhbmQgZGVzY2VuZGFudCBub2Rlcy4KCQkgKgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZVBhcmVudHM9ZmFsc2VdIFdoZXRoZXIgYW5jZXN0b3Igbm9kZXMgc2hvdWxkIGJlIHVwZGF0ZWQgb3Igbm90LgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZUNoaWxkcmVuPWZhbHNlXSBXaGV0aGVyIGRlc2NlbmRhbnQgbm9kZXMgc2hvdWxkIGJlIHVwZGF0ZWQgb3Igbm90LgoJCSAqLwoJCXVwZGF0ZVdvcmxkTWF0cml4KCB1cGRhdGVQYXJlbnRzLCB1cGRhdGVDaGlsZHJlbiApIHsKCgkJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQkJaWYgKCB1cGRhdGVQYXJlbnRzID09PSB0cnVlICYmIHBhcmVudCAhPT0gbnVsbCApIHsKCgkJCQlwYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCQl9CgoJCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCQlpZiAoIHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJCXRoaXMubWF0cml4V29ybGQuY29weSggdGhpcy5tYXRyaXggKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIG1ha2Ugc3VyZSBkZXNjZW5kYW50cyBhcmUgdXBkYXRlZAoKCQkJaWYgKCB1cGRhdGVDaGlsZHJlbiA9PT0gdHJ1ZSApIHsKCgkJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKCQkJCQljaGlsZC51cGRhdGVXb3JsZE1hdHJpeCggZmFsc2UsIHRydWUgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogU2VyaWFsaXplcyB0aGUgM0Qgb2JqZWN0IGludG8gSlNPTi4KCQkgKgoJCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIDNEIG9iamVjdC4KCQkgKiBAc2VlIHtAbGluayBPYmplY3RMb2FkZXIjcGFyc2V9CgkJICovCgkJdG9KU09OKCBtZXRhICkgewoKCQkJLy8gbWV0YSBpcyBhIHN0cmluZyB3aGVuIGNhbGxlZCBmcm9tIEpTT04uc3RyaW5naWZ5CgkJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKCQkJY29uc3Qgb3V0cHV0ID0ge307CgoJCQkvLyBtZXRhIGlzIGEgaGFzaCB1c2VkIHRvIGNvbGxlY3QgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLgoJCQkvLyBub3QgcHJvdmlkaW5nIGl0IGltcGxpZXMgdGhhdCB0aGlzIGlzIHRoZSByb290IG9iamVjdAoJCQkvLyBiZWluZyBzZXJpYWxpemVkLgoJCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCQkvLyBpbml0aWFsaXplIG1ldGEgb2JqCgkJCQltZXRhID0gewoJCQkJCWdlb21ldHJpZXM6IHt9LAoJCQkJCW1hdGVyaWFsczoge30sCgkJCQkJdGV4dHVyZXM6IHt9LAoJCQkJCWltYWdlczoge30sCgkJCQkJc2hhcGVzOiB7fSwKCQkJCQlza2VsZXRvbnM6IHt9LAoJCQkJCWFuaW1hdGlvbnM6IHt9LAoJCQkJCW5vZGVzOiB7fQoJCQkJfTsKCgkJCQlvdXRwdXQubWV0YWRhdGEgPSB7CgkJCQkJdmVyc2lvbjogNC43LAoJCQkJCXR5cGU6ICdPYmplY3QnLAoJCQkJCWdlbmVyYXRvcjogJ09iamVjdDNELnRvSlNPTicKCQkJCX07CgoJCQl9CgoJCQkvLyBzdGFuZGFyZCBPYmplY3QzRCBzZXJpYWxpemF0aW9uCgoJCQljb25zdCBvYmplY3QgPSB7fTsKCgkJCW9iamVjdC51dWlkID0gdGhpcy51dWlkOwoJCQlvYmplY3QudHlwZSA9IHRoaXMudHlwZTsKCgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIG9iamVjdC5uYW1lID0gdGhpcy5uYW1lOwoJCQlpZiAoIHRoaXMuY2FzdFNoYWRvdyA9PT0gdHJ1ZSApIG9iamVjdC5jYXN0U2hhZG93ID0gdHJ1ZTsKCQkJaWYgKCB0aGlzLnJlY2VpdmVTaGFkb3cgPT09IHRydWUgKSBvYmplY3QucmVjZWl2ZVNoYWRvdyA9IHRydWU7CgkJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIG9iamVjdC52aXNpYmxlID0gZmFsc2U7CgkJCWlmICggdGhpcy5mcnVzdHVtQ3VsbGVkID09PSBmYWxzZSApIG9iamVjdC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CgkJCWlmICggdGhpcy5yZW5kZXJPcmRlciAhPT0gMCApIG9iamVjdC5yZW5kZXJPcmRlciA9IHRoaXMucmVuZGVyT3JkZXI7CgkJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb2JqZWN0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJCW9iamVjdC5sYXllcnMgPSB0aGlzLmxheWVycy5tYXNrOwoJCQlvYmplY3QubWF0cml4ID0gdGhpcy5tYXRyaXgudG9BcnJheSgpOwoJCQlvYmplY3QudXAgPSB0aGlzLnVwLnRvQXJyYXkoKTsKCgkJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlID09PSBmYWxzZSApIG9iamVjdC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCQkvLyBvYmplY3Qgc3BlY2lmaWMgcHJvcGVydGllcwoKCQkJaWYgKCB0aGlzLmlzSW5zdGFuY2VkTWVzaCApIHsKCgkJCQlvYmplY3QudHlwZSA9ICdJbnN0YW5jZWRNZXNoJzsKCQkJCW9iamVjdC5jb3VudCA9IHRoaXMuY291bnQ7CgkJCQlvYmplY3QuaW5zdGFuY2VNYXRyaXggPSB0aGlzLmluc3RhbmNlTWF0cml4LnRvSlNPTigpOwoJCQkJaWYgKCB0aGlzLmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSBvYmplY3QuaW5zdGFuY2VDb2xvciA9IHRoaXMuaW5zdGFuY2VDb2xvci50b0pTT04oKTsKCgkJCX0KCgkJCWlmICggdGhpcy5pc0JhdGNoZWRNZXNoICkgewoKCQkJCW9iamVjdC50eXBlID0gJ0JhdGNoZWRNZXNoJzsKCQkJCW9iamVjdC5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkID0gdGhpcy5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkOwoJCQkJb2JqZWN0LnNvcnRPYmplY3RzID0gdGhpcy5zb3J0T2JqZWN0czsKCgkJCQlvYmplY3QuZHJhd1JhbmdlcyA9IHRoaXMuX2RyYXdSYW5nZXM7CgkJCQlvYmplY3QucmVzZXJ2ZWRSYW5nZXMgPSB0aGlzLl9yZXNlcnZlZFJhbmdlczsKCgkJCQlvYmplY3QuZ2VvbWV0cnlJbmZvID0gdGhpcy5fZ2VvbWV0cnlJbmZvLm1hcCggaW5mbyA9PiAoIHsKCQkJCQkuLi5pbmZvLAoJCQkJCWJvdW5kaW5nQm94OiBpbmZvLmJvdW5kaW5nQm94ID8gaW5mby5ib3VuZGluZ0JveC50b0pTT04oKSA6IHVuZGVmaW5lZCwKCQkJCQlib3VuZGluZ1NwaGVyZTogaW5mby5ib3VuZGluZ1NwaGVyZSA/IGluZm8uYm91bmRpbmdTcGhlcmUudG9KU09OKCkgOiB1bmRlZmluZWQKCQkJCX0gKSApOwoJCQkJb2JqZWN0Lmluc3RhbmNlSW5mbyA9IHRoaXMuX2luc3RhbmNlSW5mby5tYXAoIGluZm8gPT4gKCB7IC4uLmluZm8gfSApICk7CgoJCQkJb2JqZWN0LmF2YWlsYWJsZUluc3RhbmNlSWRzID0gdGhpcy5fYXZhaWxhYmxlSW5zdGFuY2VJZHMuc2xpY2UoKTsKCQkJCW9iamVjdC5hdmFpbGFibGVHZW9tZXRyeUlkcyA9IHRoaXMuX2F2YWlsYWJsZUdlb21ldHJ5SWRzLnNsaWNlKCk7CgoJCQkJb2JqZWN0Lm5leHRJbmRleFN0YXJ0ID0gdGhpcy5fbmV4dEluZGV4U3RhcnQ7CgkJCQlvYmplY3QubmV4dFZlcnRleFN0YXJ0ID0gdGhpcy5fbmV4dFZlcnRleFN0YXJ0OwoJCQkJb2JqZWN0Lmdlb21ldHJ5Q291bnQgPSB0aGlzLl9nZW9tZXRyeUNvdW50OwoKCQkJCW9iamVjdC5tYXhJbnN0YW5jZUNvdW50ID0gdGhpcy5fbWF4SW5zdGFuY2VDb3VudDsKCQkJCW9iamVjdC5tYXhWZXJ0ZXhDb3VudCA9IHRoaXMuX21heFZlcnRleENvdW50OwoJCQkJb2JqZWN0Lm1heEluZGV4Q291bnQgPSB0aGlzLl9tYXhJbmRleENvdW50OwoKCQkJCW9iamVjdC5nZW9tZXRyeUluaXRpYWxpemVkID0gdGhpcy5fZ2VvbWV0cnlJbml0aWFsaXplZDsKCgkJCQlvYmplY3QubWF0cmljZXNUZXh0dXJlID0gdGhpcy5fbWF0cmljZXNUZXh0dXJlLnRvSlNPTiggbWV0YSApOwoKCQkJCW9iamVjdC5pbmRpcmVjdFRleHR1cmUgPSB0aGlzLl9pbmRpcmVjdFRleHR1cmUudG9KU09OKCBtZXRhICk7CgoJCQkJaWYgKCB0aGlzLl9jb2xvcnNUZXh0dXJlICE9PSBudWxsICkgewoKCQkJCQlvYmplY3QuY29sb3JzVGV4dHVyZSA9IHRoaXMuX2NvbG9yc1RleHR1cmUudG9KU09OKCBtZXRhICk7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQkJb2JqZWN0LmJvdW5kaW5nU3BoZXJlID0gdGhpcy5ib3VuZGluZ1NwaGVyZS50b0pTT04oKTsKCgkJCQl9CgoJCQkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJCQlvYmplY3QuYm91bmRpbmdCb3ggPSB0aGlzLmJvdW5kaW5nQm94LnRvSlNPTigpOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlmdW5jdGlvbiBzZXJpYWxpemUoIGxpYnJhcnksIGVsZW1lbnQgKSB7CgoJCQkJaWYgKCBsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9IGVsZW1lbnQudG9KU09OKCBtZXRhICk7CgoJCQkJfQoKCQkJCXJldHVybiBlbGVtZW50LnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuaXNTY2VuZSApIHsKCgkJCQlpZiAoIHRoaXMuYmFja2dyb3VuZCApIHsKCgkJCQkJaWYgKCB0aGlzLmJhY2tncm91bmQuaXNDb2xvciApIHsKCgkJCQkJCW9iamVjdC5iYWNrZ3JvdW5kID0gdGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOwoKCQkJCQl9IGVsc2UgaWYgKCB0aGlzLmJhY2tncm91bmQuaXNUZXh0dXJlICkgewoKCQkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIHRoaXMuZW52aXJvbm1lbnQgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1JlbmRlclRhcmdldFRleHR1cmUgIT09IHRydWUgKSB7CgoJCQkJCW9iamVjdC5lbnZpcm9ubWVudCA9IHRoaXMuZW52aXJvbm1lbnQudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCB0aGlzLmlzTWVzaCB8fCB0aGlzLmlzTGluZSB8fCB0aGlzLmlzUG9pbnRzICkgewoKCQkJCW9iamVjdC5nZW9tZXRyeSA9IHNlcmlhbGl6ZSggbWV0YS5nZW9tZXRyaWVzLCB0aGlzLmdlb21ldHJ5ICk7CgoJCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuZ2VvbWV0cnkucGFyYW1ldGVyczsKCgkJCQlpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCAmJiBwYXJhbWV0ZXJzLnNoYXBlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zdCBzaGFwZXMgPSBwYXJhbWV0ZXJzLnNoYXBlczsKCgkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBzaGFwZXMgKSApIHsKCgkJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBpIF07CgoJCQkJCQkJc2VyaWFsaXplKCBtZXRhLnNoYXBlcywgc2hhcGUgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXNlcmlhbGl6ZSggbWV0YS5zaGFwZXMsIHNoYXBlcyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJb2JqZWN0LmJpbmRNb2RlID0gdGhpcy5iaW5kTW9kZTsKCQkJCW9iamVjdC5iaW5kTWF0cml4ID0gdGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKTsKCgkJCQlpZiAoIHRoaXMuc2tlbGV0b24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJc2VyaWFsaXplKCBtZXRhLnNrZWxldG9ucywgdGhpcy5za2VsZXRvbiApOwoKCQkJCQlvYmplY3Quc2tlbGV0b24gPSB0aGlzLnNrZWxldG9uLnV1aWQ7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLm1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCB0aGlzLm1hdGVyaWFsICkgKSB7CgoJCQkJCWNvbnN0IHV1aWRzID0gW107CgoJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMubWF0ZXJpYWwubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCXV1aWRzLnB1c2goIHNlcmlhbGl6ZSggbWV0YS5tYXRlcmlhbHMsIHRoaXMubWF0ZXJpYWxbIGkgXSApICk7CgoJCQkJCX0KCgkJCQkJb2JqZWN0Lm1hdGVyaWFsID0gdXVpZHM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJb2JqZWN0Lm1hdGVyaWFsID0gc2VyaWFsaXplKCBtZXRhLm1hdGVyaWFscywgdGhpcy5tYXRlcmlhbCApOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCApIHsKCgkJCQlvYmplY3QuY2hpbGRyZW4gPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJb2JqZWN0LmNoaWxkcmVuLnB1c2goIHRoaXMuY2hpbGRyZW5bIGkgXS50b0pTT04oIG1ldGEgKS5vYmplY3QgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoID4gMCApIHsKCgkJCQlvYmplY3QuYW5pbWF0aW9ucyA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uc1sgaSBdOwoKCQkJCQlvYmplY3QuYW5pbWF0aW9ucy5wdXNoKCBzZXJpYWxpemUoIG1ldGEuYW5pbWF0aW9ucywgYW5pbWF0aW9uICkgKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCQljb25zdCBnZW9tZXRyaWVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5nZW9tZXRyaWVzICk7CgkJCQljb25zdCBtYXRlcmlhbHMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLm1hdGVyaWFscyApOwoJCQkJY29uc3QgdGV4dHVyZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLnRleHR1cmVzICk7CgkJCQljb25zdCBpbWFnZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmltYWdlcyApOwoJCQkJY29uc3Qgc2hhcGVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5zaGFwZXMgKTsKCQkJCWNvbnN0IHNrZWxldG9ucyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuc2tlbGV0b25zICk7CgkJCQljb25zdCBhbmltYXRpb25zID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5hbmltYXRpb25zICk7CgkJCQljb25zdCBub2RlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEubm9kZXMgKTsKCgkJCQlpZiAoIGdlb21ldHJpZXMubGVuZ3RoID4gMCApIG91dHB1dC5nZW9tZXRyaWVzID0gZ2VvbWV0cmllczsKCQkJCWlmICggbWF0ZXJpYWxzLmxlbmd0aCA+IDAgKSBvdXRwdXQubWF0ZXJpYWxzID0gbWF0ZXJpYWxzOwoJCQkJaWYgKCB0ZXh0dXJlcy5sZW5ndGggPiAwICkgb3V0cHV0LnRleHR1cmVzID0gdGV4dHVyZXM7CgkJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgb3V0cHV0LmltYWdlcyA9IGltYWdlczsKCQkJCWlmICggc2hhcGVzLmxlbmd0aCA+IDAgKSBvdXRwdXQuc2hhcGVzID0gc2hhcGVzOwoJCQkJaWYgKCBza2VsZXRvbnMubGVuZ3RoID4gMCApIG91dHB1dC5za2VsZXRvbnMgPSBza2VsZXRvbnM7CgkJCQlpZiAoIGFuaW1hdGlvbnMubGVuZ3RoID4gMCApIG91dHB1dC5hbmltYXRpb25zID0gYW5pbWF0aW9uczsKCQkJCWlmICggbm9kZXMubGVuZ3RoID4gMCApIG91dHB1dC5ub2RlcyA9IG5vZGVzOwoKCQkJfQoKCQkJb3V0cHV0Lm9iamVjdCA9IG9iamVjdDsKCgkJCXJldHVybiBvdXRwdXQ7CgoJCQkvLyBleHRyYWN0IGRhdGEgZnJvbSB0aGUgY2FjaGUgaGFzaAoJCQkvLyByZW1vdmUgbWV0YWRhdGEgb24gZWFjaCBpdGVtCgkJCS8vIGFuZCByZXR1cm4gYXMgYXJyYXkKCQkJZnVuY3Rpb24gZXh0cmFjdEZyb21DYWNoZSggY2FjaGUgKSB7CgoJCQkJY29uc3QgdmFsdWVzID0gW107CgkJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgoJCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IDNEIG9iamVjdCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtib29sZWFufSBbcmVjdXJzaXZlPXRydWVdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBkZXNjZW5kYW50cyBvZiB0aGUgM0Qgb2JqZWN0IGFyZSBhbHNvIGNsb25lZC4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCByZWN1cnNpdmUgKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzLCByZWN1cnNpdmUgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gM0Qgb2JqZWN0IHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdDNEfSBzb3VyY2UgLSBUaGUgM0Qgb2JqZWN0IHRvIGNvcHkuCgkJICogQHBhcmFtIHtib29sZWFufSBbcmVjdXJzaXZlPXRydWVdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBkZXNjZW5kYW50cyBvZiB0aGUgM0Qgb2JqZWN0IGFyZSBjbG9uZWQuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weSggc291cmNlLCByZWN1cnNpdmUgPSB0cnVlICkgewoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCQl0aGlzLnVwLmNvcHkoIHNvdXJjZS51cCApOwoKCQkJdGhpcy5wb3NpdGlvbi5jb3B5KCBzb3VyY2UucG9zaXRpb24gKTsKCQkJdGhpcy5yb3RhdGlvbi5vcmRlciA9IHNvdXJjZS5yb3RhdGlvbi5vcmRlcjsKCQkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHNvdXJjZS5xdWF0ZXJuaW9uICk7CgkJCXRoaXMuc2NhbGUuY29weSggc291cmNlLnNjYWxlICk7CgoJCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CgkJCXRoaXMubWF0cml4V29ybGQuY29weSggc291cmNlLm1hdHJpeFdvcmxkICk7CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJCXRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZTsKCQkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU7CgoJCQl0aGlzLmxheWVycy5tYXNrID0gc291cmNlLmxheWVycy5tYXNrOwoJCQl0aGlzLnZpc2libGUgPSBzb3VyY2UudmlzaWJsZTsKCgkJCXRoaXMuY2FzdFNoYWRvdyA9IHNvdXJjZS5jYXN0U2hhZG93OwoJCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBzb3VyY2UucmVjZWl2ZVNoYWRvdzsKCgkJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHNvdXJjZS5mcnVzdHVtQ3VsbGVkOwoJCQl0aGlzLnJlbmRlck9yZGVyID0gc291cmNlLnJlbmRlck9yZGVyOwoKCQkJdGhpcy5hbmltYXRpb25zID0gc291cmNlLmFuaW1hdGlvbnMuc2xpY2UoKTsKCgkJCXRoaXMudXNlckRhdGEgPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeSggc291cmNlLnVzZXJEYXRhICkgKTsKCgkJCWlmICggcmVjdXJzaXZlID09PSB0cnVlICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNvdXJjZS5jaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNoaWxkID0gc291cmNlLmNoaWxkcmVuWyBpIF07CgkJCQkJdGhpcy5hZGQoIGNoaWxkLmNsb25lKCkgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgkvKioKCSAqIFRoZSBkZWZhdWx0IHVwIGRpcmVjdGlvbiBmb3Igb2JqZWN0cywgYWxzbyB1c2VkIGFzIHRoZSBkZWZhdWx0CgkgKiBwb3NpdGlvbiBmb3Ige0BsaW5rIERpcmVjdGlvbmFsTGlnaHR9IGFuZCB7QGxpbmsgSGVtaXNwaGVyZUxpZ2h0fS4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7VmVjdG9yM30KCSAqIEBkZWZhdWx0ICgwLDEsMCkKCSAqLwoJT2JqZWN0M0QuREVGQVVMVF9VUCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKCgkvKioKCSAqIFRoZSBkZWZhdWx0IHNldHRpbmcgZm9yIHtAbGluayBPYmplY3QzRCNtYXRyaXhBdXRvVXBkYXRlfSBmb3IKCSAqIG5ld2x5IGNyZWF0ZWQgM0Qgb2JqZWN0cy4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7Ym9vbGVhbn0KCSAqIEBkZWZhdWx0IHRydWUKCSAqLwoJT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfQVVUT19VUERBVEUgPSB0cnVlOwoKCS8qKgoJICogVGhlIGRlZmF1bHQgc2V0dGluZyBmb3Ige0BsaW5rIE9iamVjdDNEI21hdHJpeFdvcmxkQXV0b1VwZGF0ZX0gZm9yCgkgKiBuZXdseSBjcmVhdGVkIDNEIG9iamVjdHMuCgkgKgoJICogQHN0YXRpYwoJICogQHR5cGUge2Jvb2xlYW59CgkgKiBAZGVmYXVsdCB0cnVlCgkgKi8KCU9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFID0gdHJ1ZTsKCgljb25zdCBfdjAkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92MSQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3YyJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdjMkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfdmFiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZhYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92YmMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdmFwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZicCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92Y3AgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX3Y0MCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjQoKTsKCWNvbnN0IF92NDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3I0KCk7Cgljb25zdCBfdjQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yNCgpOwoKCS8qKgoJICogQSBnZW9tZXRyaWMgdHJpYW5nbGUgYXMgZGVmaW5lZCBieSB0aHJlZSB2ZWN0b3JzIHJlcHJlc2VudGluZyBpdHMgdGhyZWUgY29ybmVycy4KCSAqLwoJY2xhc3MgVHJpYW5nbGUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRyaWFuZ2xlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbYT0oMCwwLDApXSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gW2I9KDAsMCwwKV0gLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbYz0oMCwwLDApXSAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBhID0gbmV3IFZlY3RvcjMoKSwgYiA9IG5ldyBWZWN0b3IzKCksIGMgPSBuZXcgVmVjdG9yMygpICkgewoKCQkJLyoqCgkJCSAqIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJICovCgkJCXRoaXMuYSA9IGE7CgoJCQkvKioKCQkJICogVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJICovCgkJCXRoaXMuYiA9IGI7CgoJCQkvKioKCQkJICogVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtWZWN0b3IzfQoJCQkgKi8KCQkJdGhpcy5jID0gYzsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIHZlY3RvciBvZiBhIHRyaWFuZ2xlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3Mgbm9ybWFsLgoJCSAqLwoJCXN0YXRpYyBnZXROb3JtYWwoIGEsIGIsIGMsIHRhcmdldCApIHsKCgkJCXRhcmdldC5zdWJWZWN0b3JzKCBjLCBiICk7CgkJCV92MCQxLnN1YlZlY3RvcnMoIGEsIGIgKTsKCQkJdGFyZ2V0LmNyb3NzKCBfdjAkMSApOwoKCQkJY29uc3QgdGFyZ2V0TGVuZ3RoU3EgPSB0YXJnZXQubGVuZ3RoU3EoKTsKCQkJaWYgKCB0YXJnZXRMZW5ndGhTcSA+IDAgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5tdWx0aXBseVNjYWxhciggMSAvIE1hdGguc3FydCggdGFyZ2V0TGVuZ3RoU3EgKSApOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIDAsIDAsIDAgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyBhIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZyb20gdGhlIGdpdmVuIHZlY3Rvci4KCQkgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgdHJpYW5nbGUgaXMgZGVnZW5lcmF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgZm9yIHRoZSBnaXZlbiBwb2ludAoJCSAqLwoJCXN0YXRpYyBnZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCB0YXJnZXQgKSB7CgoJCQkvLyBiYXNlZCBvbjogaHR0cDovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbAoKCQkJX3YwJDEuc3ViVmVjdG9ycyggYywgYSApOwoJCQlfdjEkMy5zdWJWZWN0b3JzKCBiLCBhICk7CgkJCV92MiQyLnN1YlZlY3RvcnMoIHBvaW50LCBhICk7CgoJCQljb25zdCBkb3QwMCA9IF92MCQxLmRvdCggX3YwJDEgKTsKCQkJY29uc3QgZG90MDEgPSBfdjAkMS5kb3QoIF92MSQzICk7CgkJCWNvbnN0IGRvdDAyID0gX3YwJDEuZG90KCBfdjIkMiApOwoJCQljb25zdCBkb3QxMSA9IF92MSQzLmRvdCggX3YxJDMgKTsKCQkJY29uc3QgZG90MTIgPSBfdjEkMy5kb3QoIF92MiQyICk7CgoJCQljb25zdCBkZW5vbSA9ICggZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDEgKTsKCgkJCS8vIGNvbGxpbmVhciBvciBzaW5ndWxhciB0cmlhbmdsZQoJCQlpZiAoIGRlbm9tID09PSAwICkgewoKCQkJCXRhcmdldC5zZXQoIDAsIDAsIDAgKTsKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJY29uc3QgaW52RGVub20gPSAxIC8gZGVub207CgkJCWNvbnN0IHUgPSAoIGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyICkgKiBpbnZEZW5vbTsKCQkJY29uc3QgdiA9ICggZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIgKSAqIGludkRlbm9tOwoKCQkJLy8gYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgbXVzdCBhbHdheXMgc3VtIHRvIDEKCQkJcmV0dXJuIHRhcmdldC5zZXQoIDEgLSB1IC0gdiwgdiwgdSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBwb2ludCwgd2hlbiBwcm9qZWN0ZWQgb250byB0aGUgcGxhbmUgb2YgdGhlCgkJICogdHJpYW5nbGUsIGxpZXMgd2l0aGluIHRoZSB0cmlhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdGVzdC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQoJCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUgb3Igbm90LgoJCSAqLwoJCXN0YXRpYyBjb250YWluc1BvaW50KCBwb2ludCwgYSwgYiwgYyApIHsKCgkJCS8vIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlIHRoZW4gd2UgY2FuJ3QgY29udGFpbiBhIHBvaW50CgkJCWlmICggdGhpcy5nZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCBfdjMkMiApID09PSBudWxsICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJCXJldHVybiAoIF92MyQyLnggPj0gMCApICYmICggX3YzJDIueSA+PSAwICkgJiYgKCAoIF92MyQyLnggKyBfdjMkMi55ICkgPD0gMSApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSB2YWx1ZSBiYXJ5Y2VudHJpY2FsbHkgaW50ZXJwb2xhdGVkIGZvciB0aGUgZ2l2ZW4gcG9pbnQgb24gdGhlCgkJICogdHJpYW5nbGUuIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFBvc2l0aW9uIG9mIGludGVycG9sYXRlZCBwb2ludC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAxIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwMiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAzIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2MSAtIFZhbHVlIHRvIGludGVycG9sYXRlIG9mIGZpcnN0IHZlcnRleC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYyIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2Ygc2Vjb25kIHZlcnRleC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYzIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgdGhpcmQgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnBvbGF0ZWQgdmFsdWUuCgkJICovCgkJc3RhdGljIGdldEludGVycG9sYXRpb24oIHBvaW50LCBwMSwgcDIsIHAzLCB2MSwgdjIsIHYzLCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRoaXMuZ2V0QmFyeWNvb3JkKCBwb2ludCwgcDEsIHAyLCBwMywgX3YzJDIgKSA9PT0gbnVsbCApIHsKCgkJCQl0YXJnZXQueCA9IDA7CgkJCQl0YXJnZXQueSA9IDA7CgkJCQlpZiAoICd6JyBpbiB0YXJnZXQgKSB0YXJnZXQueiA9IDA7CgkJCQlpZiAoICd3JyBpbiB0YXJnZXQgKSB0YXJnZXQudyA9IDA7CgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCXRhcmdldC5zZXRTY2FsYXIoIDAgKTsKCQkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjEsIF92MyQyLnggKTsKCQkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjIsIF92MyQyLnkgKTsKCQkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjMsIF92MyQyLnogKTsKCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHZhbHVlIGJhcnljZW50cmljYWxseSBpbnRlcnBvbGF0ZWQgZm9yIHRoZSBnaXZlbiBhdHRyaWJ1dGUgYW5kIGluZGljZXMuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0ciAtIFRoZSBhdHRyaWJ1dGUgdG8gaW50ZXJwb2xhdGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gSW5kZXggb2YgZmlyc3QgdmVydGV4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIEluZGV4IG9mIHNlY29uZCB2ZXJ0ZXguCgkJICogQHBhcmFtIHtudW1iZXJ9IGkzIC0gSW5kZXggb2YgdGhpcmQgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYmFyeWNvb3JkIC0gVGhlIGJhcnljb29yZGluYXRlIHZhbHVlIHRvIHVzZSB0byBpbnRlcnBvbGF0ZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBpbnRlcnBvbGF0ZWQgYXR0cmlidXRlIHZhbHVlLgoJCSAqLwoJCXN0YXRpYyBnZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIGF0dHIsIGkxLCBpMiwgaTMsIGJhcnljb29yZCwgdGFyZ2V0ICkgewoKCQkJX3Y0MC5zZXRTY2FsYXIoIDAgKTsKCQkJX3Y0MS5zZXRTY2FsYXIoIDAgKTsKCQkJX3Y0Mi5zZXRTY2FsYXIoIDAgKTsKCgkJCV92NDAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0ciwgaTEgKTsKCQkJX3Y0MS5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyLCBpMiApOwoJCQlfdjQyLmZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHIsIGkzICk7CgoJCQl0YXJnZXQuc2V0U2NhbGFyKCAwICk7CgkJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDAsIGJhcnljb29yZC54ICk7CgkJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDEsIGJhcnljb29yZC55ICk7CgkJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDIsIGJhcnljb29yZC56ICk7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSB0cmlhbmdsZSBpcyBvcmllbnRlZCB0b3dhcmRzIHRoZSBnaXZlbiBkaXJlY3Rpb24uCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBkaXJlY3Rpb24gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiB2ZWN0b3IuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdHJpYW5nbGUgaXMgb3JpZW50ZWQgdG93YXJkcyB0aGUgZ2l2ZW4gZGlyZWN0aW9uIG9yIG5vdC4KCQkgKi8KCQlzdGF0aWMgaXNGcm9udEZhY2luZyggYSwgYiwgYywgZGlyZWN0aW9uICkgewoKCQkJX3YwJDEuc3ViVmVjdG9ycyggYywgYiApOwoJCQlfdjEkMy5zdWJWZWN0b3JzKCBhLCBiICk7CgoJCQkvLyBzdHJpY3RseSBmcm9udCBmYWNpbmcKCQkJcmV0dXJuICggX3YwJDEuY3Jvc3MoIF92MSQzICkuZG90KCBkaXJlY3Rpb24gKSA8IDAgKSA/IHRydWUgOiBmYWxzZTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcmV0dXJuIHtUcmlhbmdsZX0gQSByZWZlcmVuY2UgdG8gdGhpcyB0cmlhbmdsZS4KCQkgKi8KCQlzZXQoIGEsIGIsIGMgKSB7CgoJCQl0aGlzLmEuY29weSggYSApOwoJCQl0aGlzLmIuY29weSggYiApOwoJCQl0aGlzLmMuY29weSggYyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdHJpYW5nbGUncyB2ZXJ0aWNlcyBieSBjb3B5aW5nIHRoZSBnaXZlbiBhcnJheSB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBbiBhcnJheSB3aXRoIDNEIHBvaW50cy4KCQkgKiBAcGFyYW0ge251bWJlcn0gaTAgLSBUaGUgYXJyYXkgaW5kZXggcmVwcmVzZW50aW5nIHRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMSAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCgkJICovCgkJc2V0RnJvbVBvaW50c0FuZEluZGljZXMoIHBvaW50cywgaTAsIGkxLCBpMiApIHsKCgkJCXRoaXMuYS5jb3B5KCBwb2ludHNbIGkwIF0gKTsKCQkJdGhpcy5iLmNvcHkoIHBvaW50c1sgaTEgXSApOwoJCQl0aGlzLmMuY29weSggcG9pbnRzWyBpMiBdICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIGF0dHJpYnV0ZSB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gQSBidWZmZXIgYXR0cmlidXRlIHdpdGggM0QgcG9pbnRzIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGkwIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIFRoZSBhdHRyaWJ1dGUgaW5kZXggcmVwcmVzZW50aW5nIHRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEByZXR1cm4ge1RyaWFuZ2xlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHRyaWFuZ2xlLgoJCSAqLwoJCXNldEZyb21BdHRyaWJ1dGVBbmRJbmRpY2VzKCBhdHRyaWJ1dGUsIGkwLCBpMSwgaTIgKSB7CgoJCQl0aGlzLmEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMCApOwoJCQl0aGlzLmIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMSApOwoJCQl0aGlzLmMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyB0cmlhbmdsZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7VHJpYW5nbGV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdHJpYW5nbGUgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VHJpYW5nbGV9IHRyaWFuZ2xlIC0gVGhlIHRyaWFuZ2xlIHRvIGNvcHkuCgkJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCgkJICovCgkJY29weSggdHJpYW5nbGUgKSB7CgoJCQl0aGlzLmEuY29weSggdHJpYW5nbGUuYSApOwoJCQl0aGlzLmIuY29weSggdHJpYW5nbGUuYiApOwoJCQl0aGlzLmMuY29weSggdHJpYW5nbGUuYyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGFyZWEgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgdHJpYW5nbGUncyBhcmVhLgoJCSAqLwoJCWdldEFyZWEoKSB7CgoJCQlfdjAkMS5zdWJWZWN0b3JzKCB0aGlzLmMsIHRoaXMuYiApOwoJCQlfdjEkMy5zdWJWZWN0b3JzKCB0aGlzLmEsIHRoaXMuYiApOwoKCQkJcmV0dXJuIF92MCQxLmNyb3NzKCBfdjEkMyApLmxlbmd0aCgpICogMC41OwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBtaWRwb2ludCBvZiB0aGUgdHJpYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSB0cmlhbmdsZSdzIG1pZHBvaW50LgoJCSAqLwoJCWdldE1pZHBvaW50KCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICkuYWRkKCB0aGlzLmMgKS5tdWx0aXBseVNjYWxhciggMSAvIDMgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIG9mIHRoZSB0cmlhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3Mgbm9ybWFsLgoJCSAqLwoJCWdldE5vcm1hbCggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldE5vcm1hbCggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYywgdGFyZ2V0ICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgYSBwbGFuZSB0aGUgdHJpYW5nbGUgbGllcyB3aXRoaW4uCgkJICoKCQkgKiBAcGFyYW0ge1BsYW5lfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtQbGFuZX0gVGhlIHBsYW5lIHRoZSB0cmlhbmdsZSBsaWVzIHdpdGhpbi4KCQkgKi8KCQlnZXRQbGFuZSggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5zZXRGcm9tQ29wbGFuYXJQb2ludHMoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyBhIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZyb20gdGhlIGdpdmVuIHZlY3Rvci4KCQkgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgdHJpYW5nbGUgaXMgZGVnZW5lcmF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyBmb3IgdGhlIGdpdmVuIHBvaW50CgkJICovCgkJZ2V0QmFyeWNvb3JkKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldEJhcnljb29yZCggcG9pbnQsIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSB2YWx1ZSBiYXJ5Y2VudHJpY2FsbHkgaW50ZXJwb2xhdGVkIGZvciB0aGUgZ2l2ZW4gcG9pbnQgb24gdGhlCgkJICogdHJpYW5nbGUuIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFBvc2l0aW9uIG9mIGludGVycG9sYXRlZCBwb2ludC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgZmlyc3QgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdjIgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiBzZWNvbmQgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdjMgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiB0aGlyZCB2ZXJ0ZXguCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVycG9sYXRlZCB2YWx1ZS4KCQkgKi8KCQlnZXRJbnRlcnBvbGF0aW9uKCBwb2ludCwgdjEsIHYyLCB2MywgdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB2MSwgdjIsIHYzLCB0YXJnZXQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQoJCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IGluIDNEIHNwYWNlIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQoJCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUgb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmNvbnRhaW5zUG9pbnQoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gZGlyZWN0aW9uIC0gVGhlIChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbiBvciBub3QuCgkJICovCgkJaXNGcm9udEZhY2luZyggZGlyZWN0aW9uICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmlzRnJvbnRGYWNpbmcoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIGRpcmVjdGlvbiApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdHJpYW5nbGUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBib3guCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gaW50ZXJzZWN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzVHJpYW5nbGUoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSB0cmlhbmdsZSB0byB0aGUgZ2l2ZW4gcG9pbnQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgY2xvc2VzdCBwb2ludCBmb3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgdHJpYW5nbGUuCgkJICovCgkJY2xvc2VzdFBvaW50VG9Qb2ludCggcCwgdGFyZ2V0ICkgewoKCQkJY29uc3QgYSA9IHRoaXMuYSwgYiA9IHRoaXMuYiwgYyA9IHRoaXMuYzsKCQkJbGV0IHYsIHc7CgoJCQkvLyBhbGdvcml0aG0gdGhhbmtzIHRvIFJlYWwtVGltZSBDb2xsaXNpb24gRGV0ZWN0aW9uIGJ5IENocmlzdGVyIEVyaWNzb24sCgkJCS8vIHB1Ymxpc2hlZCBieSBNb3JnYW4gS2F1Zm1hbm4gUHVibGlzaGVycywgKGMpIDIwMDUgRWxzZXZpZXIgSW5jLiwKCQkJLy8gdW5kZXIgdGhlIGFjY29tcGFueWluZyBsaWNlbnNlOyBzZWUgY2hhcHRlciA1LjEuNSBmb3IgZGV0YWlsZWQgZXhwbGFuYXRpb24uCgkJCS8vIGJhc2ljYWxseSwgd2UncmUgZGlzdGluZ3Vpc2hpbmcgd2hpY2ggb2YgdGhlIHZvcm9ub2kgcmVnaW9ucyBvZiB0aGUgdHJpYW5nbGUKCQkJLy8gdGhlIHBvaW50IGxpZXMgaW4gd2l0aCB0aGUgbWluaW11bSBhbW91bnQgb2YgcmVkdW5kYW50IGNvbXB1dGF0aW9uLgoKCQkJX3ZhYi5zdWJWZWN0b3JzKCBiLCBhICk7CgkJCV92YWMuc3ViVmVjdG9ycyggYywgYSApOwoJCQlfdmFwLnN1YlZlY3RvcnMoIHAsIGEgKTsKCQkJY29uc3QgZDEgPSBfdmFiLmRvdCggX3ZhcCApOwoJCQljb25zdCBkMiA9IF92YWMuZG90KCBfdmFwICk7CgkJCWlmICggZDEgPD0gMCAmJiBkMiA8PSAwICkgewoKCQkJCS8vIHZlcnRleCByZWdpb24gb2YgQTsgYmFyeWNlbnRyaWMgY29vcmRzICgxLCAwLCAwKQoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICk7CgoJCQl9CgoJCQlfdmJwLnN1YlZlY3RvcnMoIHAsIGIgKTsKCQkJY29uc3QgZDMgPSBfdmFiLmRvdCggX3ZicCApOwoJCQljb25zdCBkNCA9IF92YWMuZG90KCBfdmJwICk7CgkJCWlmICggZDMgPj0gMCAmJiBkNCA8PSBkMyApIHsKCgkJCQkvLyB2ZXJ0ZXggcmVnaW9uIG9mIEI7IGJhcnljZW50cmljIGNvb3JkcyAoMCwgMSwgMCkKCQkJCXJldHVybiB0YXJnZXQuY29weSggYiApOwoKCQkJfQoKCQkJY29uc3QgdmMgPSBkMSAqIGQ0IC0gZDMgKiBkMjsKCQkJaWYgKCB2YyA8PSAwICYmIGQxID49IDAgJiYgZDMgPD0gMCApIHsKCgkJCQl2ID0gZDEgLyAoIGQxIC0gZDMgKTsKCQkJCS8vIGVkZ2UgcmVnaW9uIG9mIEFCOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDEtdiwgdiwgMCkKCQkJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggX3ZhYiwgdiApOwoKCQkJfQoKCQkJX3ZjcC5zdWJWZWN0b3JzKCBwLCBjICk7CgkJCWNvbnN0IGQ1ID0gX3ZhYi5kb3QoIF92Y3AgKTsKCQkJY29uc3QgZDYgPSBfdmFjLmRvdCggX3ZjcCApOwoJCQlpZiAoIGQ2ID49IDAgJiYgZDUgPD0gZDYgKSB7CgoJCQkJLy8gdmVydGV4IHJlZ2lvbiBvZiBDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDAsIDEpCgkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGMgKTsKCgkJCX0KCgkJCWNvbnN0IHZiID0gZDUgKiBkMiAtIGQxICogZDY7CgkJCWlmICggdmIgPD0gMCAmJiBkMiA+PSAwICYmIGQ2IDw9IDAgKSB7CgoJCQkJdyA9IGQyIC8gKCBkMiAtIGQ2ICk7CgkJCQkvLyBlZGdlIHJlZ2lvbiBvZiBBQzsgYmFyeWNlbnRyaWMgY29vcmRzICgxLXcsIDAsIHcpCgkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWMsIHcgKTsKCgkJCX0KCgkJCWNvbnN0IHZhID0gZDMgKiBkNiAtIGQ1ICogZDQ7CgkJCWlmICggdmEgPD0gMCAmJiAoIGQ0IC0gZDMgKSA+PSAwICYmICggZDUgLSBkNiApID49IDAgKSB7CgoJCQkJX3ZiYy5zdWJWZWN0b3JzKCBjLCBiICk7CgkJCQl3ID0gKCBkNCAtIGQzICkgLyAoICggZDQgLSBkMyApICsgKCBkNSAtIGQ2ICkgKTsKCQkJCS8vIGVkZ2UgcmVnaW9uIG9mIEJDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDEtdywgdykKCQkJCXJldHVybiB0YXJnZXQuY29weSggYiApLmFkZFNjYWxlZFZlY3RvciggX3ZiYywgdyApOyAvLyBlZGdlIHJlZ2lvbiBvZiBCQwoKCQkJfQoKCQkJLy8gZmFjZSByZWdpb24KCQkJY29uc3QgZGVub20gPSAxIC8gKCB2YSArIHZiICsgdmMgKTsKCQkJLy8gdSA9IHZhICogZGVub20KCQkJdiA9IHZiICogZGVub207CgkJCXcgPSB2YyAqIGRlbm9tOwoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFiLCB2ICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFjLCB3ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB0cmlhbmdsZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1RyaWFuZ2xlfSB0cmlhbmdsZSAtIFRoZSB0cmlhbmdsZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdHJpYW5nbGUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggdHJpYW5nbGUgKSB7CgoJCQlyZXR1cm4gdHJpYW5nbGUuYS5lcXVhbHMoIHRoaXMuYSApICYmIHRyaWFuZ2xlLmIuZXF1YWxzKCB0aGlzLmIgKSAmJiB0cmlhbmdsZS5jLmVxdWFscyggdGhpcy5jICk7CgoJCX0KCgl9CgoJY29uc3QgX2NvbG9yS2V5d29yZHMgPSB7ICdhbGljZWJsdWUnOiAweEYwRjhGRiwgJ2FudGlxdWV3aGl0ZSc6IDB4RkFFQkQ3LCAnYXF1YSc6IDB4MDBGRkZGLCAnYXF1YW1hcmluZSc6IDB4N0ZGRkQ0LCAnYXp1cmUnOiAweEYwRkZGRiwKCQknYmVpZ2UnOiAweEY1RjVEQywgJ2Jpc3F1ZSc6IDB4RkZFNEM0LCAnYmxhY2snOiAweDAwMDAwMCwgJ2JsYW5jaGVkYWxtb25kJzogMHhGRkVCQ0QsICdibHVlJzogMHgwMDAwRkYsICdibHVldmlvbGV0JzogMHg4QTJCRTIsCgkJJ2Jyb3duJzogMHhBNTJBMkEsICdidXJseXdvb2QnOiAweERFQjg4NywgJ2NhZGV0Ymx1ZSc6IDB4NUY5RUEwLCAnY2hhcnRyZXVzZSc6IDB4N0ZGRjAwLCAnY2hvY29sYXRlJzogMHhEMjY5MUUsICdjb3JhbCc6IDB4RkY3RjUwLAoJCSdjb3JuZmxvd2VyYmx1ZSc6IDB4NjQ5NUVELCAnY29ybnNpbGsnOiAweEZGRjhEQywgJ2NyaW1zb24nOiAweERDMTQzQywgJ2N5YW4nOiAweDAwRkZGRiwgJ2RhcmtibHVlJzogMHgwMDAwOEIsICdkYXJrY3lhbic6IDB4MDA4QjhCLAoJCSdkYXJrZ29sZGVucm9kJzogMHhCODg2MEIsICdkYXJrZ3JheSc6IDB4QTlBOUE5LCAnZGFya2dyZWVuJzogMHgwMDY0MDAsICdkYXJrZ3JleSc6IDB4QTlBOUE5LCAnZGFya2toYWtpJzogMHhCREI3NkIsICdkYXJrbWFnZW50YSc6IDB4OEIwMDhCLAoJCSdkYXJrb2xpdmVncmVlbic6IDB4NTU2QjJGLCAnZGFya29yYW5nZSc6IDB4RkY4QzAwLCAnZGFya29yY2hpZCc6IDB4OTkzMkNDLCAnZGFya3JlZCc6IDB4OEIwMDAwLCAnZGFya3NhbG1vbic6IDB4RTk5NjdBLCAnZGFya3NlYWdyZWVuJzogMHg4RkJDOEYsCgkJJ2RhcmtzbGF0ZWJsdWUnOiAweDQ4M0Q4QiwgJ2RhcmtzbGF0ZWdyYXknOiAweDJGNEY0RiwgJ2RhcmtzbGF0ZWdyZXknOiAweDJGNEY0RiwgJ2Rhcmt0dXJxdW9pc2UnOiAweDAwQ0VEMSwgJ2Rhcmt2aW9sZXQnOiAweDk0MDBEMywKCQknZGVlcHBpbmsnOiAweEZGMTQ5MywgJ2RlZXBza3libHVlJzogMHgwMEJGRkYsICdkaW1ncmF5JzogMHg2OTY5NjksICdkaW1ncmV5JzogMHg2OTY5NjksICdkb2RnZXJibHVlJzogMHgxRTkwRkYsICdmaXJlYnJpY2snOiAweEIyMjIyMiwKCQknZmxvcmFsd2hpdGUnOiAweEZGRkFGMCwgJ2ZvcmVzdGdyZWVuJzogMHgyMjhCMjIsICdmdWNoc2lhJzogMHhGRjAwRkYsICdnYWluc2Jvcm8nOiAweERDRENEQywgJ2dob3N0d2hpdGUnOiAweEY4RjhGRiwgJ2dvbGQnOiAweEZGRDcwMCwKCQknZ29sZGVucm9kJzogMHhEQUE1MjAsICdncmF5JzogMHg4MDgwODAsICdncmVlbic6IDB4MDA4MDAwLCAnZ3JlZW55ZWxsb3cnOiAweEFERkYyRiwgJ2dyZXknOiAweDgwODA4MCwgJ2hvbmV5ZGV3JzogMHhGMEZGRjAsICdob3RwaW5rJzogMHhGRjY5QjQsCgkJJ2luZGlhbnJlZCc6IDB4Q0Q1QzVDLCAnaW5kaWdvJzogMHg0QjAwODIsICdpdm9yeSc6IDB4RkZGRkYwLCAna2hha2knOiAweEYwRTY4QywgJ2xhdmVuZGVyJzogMHhFNkU2RkEsICdsYXZlbmRlcmJsdXNoJzogMHhGRkYwRjUsICdsYXduZ3JlZW4nOiAweDdDRkMwMCwKCQknbGVtb25jaGlmZm9uJzogMHhGRkZBQ0QsICdsaWdodGJsdWUnOiAweEFERDhFNiwgJ2xpZ2h0Y29yYWwnOiAweEYwODA4MCwgJ2xpZ2h0Y3lhbic6IDB4RTBGRkZGLCAnbGlnaHRnb2xkZW5yb2R5ZWxsb3cnOiAweEZBRkFEMiwgJ2xpZ2h0Z3JheSc6IDB4RDNEM0QzLAoJCSdsaWdodGdyZWVuJzogMHg5MEVFOTAsICdsaWdodGdyZXknOiAweEQzRDNEMywgJ2xpZ2h0cGluayc6IDB4RkZCNkMxLCAnbGlnaHRzYWxtb24nOiAweEZGQTA3QSwgJ2xpZ2h0c2VhZ3JlZW4nOiAweDIwQjJBQSwgJ2xpZ2h0c2t5Ymx1ZSc6IDB4ODdDRUZBLAoJCSdsaWdodHNsYXRlZ3JheSc6IDB4Nzc4ODk5LCAnbGlnaHRzbGF0ZWdyZXknOiAweDc3ODg5OSwgJ2xpZ2h0c3RlZWxibHVlJzogMHhCMEM0REUsICdsaWdodHllbGxvdyc6IDB4RkZGRkUwLCAnbGltZSc6IDB4MDBGRjAwLCAnbGltZWdyZWVuJzogMHgzMkNEMzIsCgkJJ2xpbmVuJzogMHhGQUYwRTYsICdtYWdlbnRhJzogMHhGRjAwRkYsICdtYXJvb24nOiAweDgwMDAwMCwgJ21lZGl1bWFxdWFtYXJpbmUnOiAweDY2Q0RBQSwgJ21lZGl1bWJsdWUnOiAweDAwMDBDRCwgJ21lZGl1bW9yY2hpZCc6IDB4QkE1NUQzLAoJCSdtZWRpdW1wdXJwbGUnOiAweDkzNzBEQiwgJ21lZGl1bXNlYWdyZWVuJzogMHgzQ0IzNzEsICdtZWRpdW1zbGF0ZWJsdWUnOiAweDdCNjhFRSwgJ21lZGl1bXNwcmluZ2dyZWVuJzogMHgwMEZBOUEsICdtZWRpdW10dXJxdW9pc2UnOiAweDQ4RDFDQywKCQknbWVkaXVtdmlvbGV0cmVkJzogMHhDNzE1ODUsICdtaWRuaWdodGJsdWUnOiAweDE5MTk3MCwgJ21pbnRjcmVhbSc6IDB4RjVGRkZBLCAnbWlzdHlyb3NlJzogMHhGRkU0RTEsICdtb2NjYXNpbic6IDB4RkZFNEI1LCAnbmF2YWpvd2hpdGUnOiAweEZGREVBRCwKCQknbmF2eSc6IDB4MDAwMDgwLCAnb2xkbGFjZSc6IDB4RkRGNUU2LCAnb2xpdmUnOiAweDgwODAwMCwgJ29saXZlZHJhYic6IDB4NkI4RTIzLCAnb3JhbmdlJzogMHhGRkE1MDAsICdvcmFuZ2VyZWQnOiAweEZGNDUwMCwgJ29yY2hpZCc6IDB4REE3MEQ2LAoJCSdwYWxlZ29sZGVucm9kJzogMHhFRUU4QUEsICdwYWxlZ3JlZW4nOiAweDk4RkI5OCwgJ3BhbGV0dXJxdW9pc2UnOiAweEFGRUVFRSwgJ3BhbGV2aW9sZXRyZWQnOiAweERCNzA5MywgJ3BhcGF5YXdoaXAnOiAweEZGRUZENSwgJ3BlYWNocHVmZic6IDB4RkZEQUI5LAoJCSdwZXJ1JzogMHhDRDg1M0YsICdwaW5rJzogMHhGRkMwQ0IsICdwbHVtJzogMHhEREEwREQsICdwb3dkZXJibHVlJzogMHhCMEUwRTYsICdwdXJwbGUnOiAweDgwMDA4MCwgJ3JlYmVjY2FwdXJwbGUnOiAweDY2MzM5OSwgJ3JlZCc6IDB4RkYwMDAwLCAncm9zeWJyb3duJzogMHhCQzhGOEYsCgkJJ3JveWFsYmx1ZSc6IDB4NDE2OUUxLCAnc2FkZGxlYnJvd24nOiAweDhCNDUxMywgJ3NhbG1vbic6IDB4RkE4MDcyLCAnc2FuZHlicm93bic6IDB4RjRBNDYwLCAnc2VhZ3JlZW4nOiAweDJFOEI1NywgJ3NlYXNoZWxsJzogMHhGRkY1RUUsCgkJJ3NpZW5uYSc6IDB4QTA1MjJELCAnc2lsdmVyJzogMHhDMEMwQzAsICdza3libHVlJzogMHg4N0NFRUIsICdzbGF0ZWJsdWUnOiAweDZBNUFDRCwgJ3NsYXRlZ3JheSc6IDB4NzA4MDkwLCAnc2xhdGVncmV5JzogMHg3MDgwOTAsICdzbm93JzogMHhGRkZBRkEsCgkJJ3NwcmluZ2dyZWVuJzogMHgwMEZGN0YsICdzdGVlbGJsdWUnOiAweDQ2ODJCNCwgJ3Rhbic6IDB4RDJCNDhDLCAndGVhbCc6IDB4MDA4MDgwLCAndGhpc3RsZSc6IDB4RDhCRkQ4LCAndG9tYXRvJzogMHhGRjYzNDcsICd0dXJxdW9pc2UnOiAweDQwRTBEMCwKCQkndmlvbGV0JzogMHhFRTgyRUUsICd3aGVhdCc6IDB4RjVERUIzLCAnd2hpdGUnOiAweEZGRkZGRiwgJ3doaXRlc21va2UnOiAweEY1RjVGNSwgJ3llbGxvdyc6IDB4RkZGRjAwLCAneWVsbG93Z3JlZW4nOiAweDlBQ0QzMiB9OwoKCWNvbnN0IF9oc2xBID0geyBoOiAwLCBzOiAwLCBsOiAwIH07Cgljb25zdCBfaHNsQiA9IHsgaDogMCwgczogMCwgbDogMCB9OwoKCWZ1bmN0aW9uIGh1ZTJyZ2IoIHAsIHEsIHQgKSB7CgoJCWlmICggdCA8IDAgKSB0ICs9IDE7CgkJaWYgKCB0ID4gMSApIHQgLT0gMTsKCQlpZiAoIHQgPCAxIC8gNiApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqIHQ7CgkJaWYgKCB0IDwgMSAvIDIgKSByZXR1cm4gcTsKCQlpZiAoIHQgPCAyIC8gMyApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqICggMiAvIDMgLSB0ICk7CgkJcmV0dXJuIHA7CgoJfQoKCS8qKgoJICogQSBDb2xvciBpbnN0YW5jZSBpcyByZXByZXNlbnRlZCBieSBSR0IgY29tcG9uZW50cyBpbiB0aGUgbGluZWFyIDxpPndvcmtpbmcKCSAqIGNvbG9yIHNwYWNlPC9pPiwgd2hpY2ggZGVmYXVsdHMgdG8gYExpbmVhclNSR0JDb2xvclNwYWNlYC4gSW5wdXRzCgkgKiBjb252ZW50aW9uYWxseSB1c2luZyBgU1JHQkNvbG9yU3BhY2VgIChzdWNoIGFzIGhleGFkZWNpbWFscyBhbmQgQ1NTCgkgKiBzdHJpbmdzKSBhcmUgY29udmVydGVkIHRvIHRoZSB3b3JraW5nIGNvbG9yIHNwYWNlIGF1dG9tYXRpY2FsbHkuCgkgKgoJICogYGBganMKCSAqIC8vIGNvbnZlcnRlZCBhdXRvbWF0aWNhbGx5IGZyb20gU1JHQkNvbG9yU3BhY2UgdG8gTGluZWFyU1JHQkNvbG9yU3BhY2UKCSAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0SGV4KCAweDExMjIzMyApOwoJICogYGBgCgkgKiBTb3VyY2UgY29sb3Igc3BhY2VzIG1heSBiZSBzcGVjaWZpZWQgZXhwbGljaXRseSwgdG8gZW5zdXJlIGNvcnJlY3QgY29udmVyc2lvbnMuCgkgKiBgYGBqcwoJICogLy8gYXNzdW1lZCBhbHJlYWR5IExpbmVhclNSR0JDb2xvclNwYWNlOyBubyBjb252ZXJzaW9uCgkgKiBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQiggMC41LCAwLjUsIDAuNSApOwoJICoKCSAqIC8vIGNvbnZlcnRlZCBleHBsaWNpdGx5IGZyb20gU1JHQkNvbG9yU3BhY2UgdG8gTGluZWFyU1JHQkNvbG9yU3BhY2UKCSAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKCAwLjUsIDAuNSwgMC41LCBTUkdCQ29sb3JTcGFjZSApOwoJICogYGBgCgkgKiBJZiBUSFJFRS5Db2xvck1hbmFnZW1lbnQgaXMgZGlzYWJsZWQsIG5vIGNvbnZlcnNpb25zIG9jY3VyLiBGb3IgZGV0YWlscywKCSAqIHNlZSA8aT5Db2xvciBtYW5hZ2VtZW50PC9pPi4gSXRlcmF0aW5nIHRocm91Z2ggYSBDb2xvciBpbnN0YW5jZSB3aWxsIHlpZWxkCgkgKiBpdHMgY29tcG9uZW50cyAociwgZywgYikgaW4gdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuIEEgQ29sb3IgY2FuIGJlIGluaXRpYWxpc2VkCgkgKiBpbiBhbnkgb2YgdGhlIGZvbGxvd2luZyB3YXlzOgoJICogYGBganMKCSAqIC8vZW1wdHkgY29uc3RydWN0b3IgLSB3aWxsIGRlZmF1bHQgd2hpdGUKCSAqIGNvbnN0IGNvbG9yMSA9IG5ldyBUSFJFRS5Db2xvcigpOwoJICoKCSAqIC8vSGV4YWRlY2ltYWwgY29sb3IgKHJlY29tbWVuZGVkKQoJICogY29uc3QgY29sb3IyID0gbmV3IFRIUkVFLkNvbG9yKCAweGZmMDAwMCApOwoJICoKCSAqIC8vUkdCIHN0cmluZwoJICogY29uc3QgY29sb3IzID0gbmV3IFRIUkVFLkNvbG9yKCJyZ2IoMjU1LCAwLCAwKSIpOwoJICogY29uc3QgY29sb3I0ID0gbmV3IFRIUkVFLkNvbG9yKCJyZ2IoMTAwJSwgMCUsIDAlKSIpOwoJICoKCSAqIC8vWDExIGNvbG9yIG5hbWUgLSBhbGwgMTQwIGNvbG9yIG5hbWVzIGFyZSBzdXBwb3J0ZWQuCgkgKiAvL05vdGUgdGhlIGxhY2sgb2YgQ2FtZWxDYXNlIGluIHRoZSBuYW1lCgkgKiBjb25zdCBjb2xvcjUgPSBuZXcgVEhSRUUuQ29sb3IoICdza3libHVlJyApOwoJICogLy9IU0wgc3RyaW5nCgkgKiBjb25zdCBjb2xvcjYgPSBuZXcgVEhSRUUuQ29sb3IoImhzbCgwLCAxMDAlLCA1MCUpIik7CgkgKgoJICogLy9TZXBhcmF0ZSBSR0IgdmFsdWVzIGJldHdlZW4gMCBhbmQgMQoJICogY29uc3QgY29sb3I3ID0gbmV3IFRIUkVFLkNvbG9yKCAxLCAwLCAwICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgQ29sb3IgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbG9yLgoJCSAqCgkJICogTm90ZSB0aGF0IHN0YW5kYXJkIG1ldGhvZCBvZiBzcGVjaWZ5aW5nIGNvbG9yIGluIHRocmVlLmpzIGlzIHdpdGggYSBoZXhhZGVjaW1hbCB0cmlwbGV0LAoJCSAqIGFuZCB0aGF0IG1ldGhvZCBpcyB1c2VkIHRocm91Z2hvdXQgdGhlIHJlc3Qgb2YgdGhlIGRvY3VtZW50YXRpb24uCgkJICoKCQkgKiBAcGFyYW0geyhudW1iZXJ8c3RyaW5nfENvbG9yKX0gW3JdIC0gVGhlIHJlZCBjb21wb25lbnQgb2YgdGhlIGNvbG9yLiBJZiBgZ2AgYW5kIGBiYCBhcmUKCQkgKiBub3QgcHJvdmlkZWQsIGl0IGNhbiBiZSBoZXhhZGVjaW1hbCB0cmlwbGV0LCBhIENTUy1zdHlsZSBzdHJpbmcgb3IgYW5vdGhlciBgQ29sb3JgIGluc3RhbmNlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZ10gLSBUaGUgZ3JlZW4gY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYl0gLSBUaGUgYmx1ZSBjb21wb25lbnQuCgkJICovCgkJY29uc3RydWN0b3IoIHIsIGcsIGIgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0NvbG9yID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgcmVkIGNvbXBvbmVudC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5yID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgZ3JlZW4gY29tcG9uZW50LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLmcgPSAxOwoKCQkJLyoqCgkJCSAqIFRoZSBibHVlIGNvbXBvbmVudC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5iID0gMTsKCgkJCXJldHVybiB0aGlzLnNldCggciwgZywgYiApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGNvbG9ycydzIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gdmFsdWVzLgoJCSAqCgkJICogQHBhcmFtIHsobnVtYmVyfHN0cmluZ3xDb2xvcil9IFtyXSAtIFRoZSByZWQgY29tcG9uZW50IG9mIHRoZSBjb2xvci4gSWYgYGdgIGFuZCBgYmAgYXJlCgkJICogbm90IHByb3ZpZGVkLCBpdCBjYW4gYmUgaGV4YWRlY2ltYWwgdHJpcGxldCwgYSBDU1Mtc3R5bGUgc3RyaW5nIG9yIGFub3RoZXIgYENvbG9yYCBpbnN0YW5jZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2ddIC0gVGhlIGdyZWVuIGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2JdIC0gVGhlIGJsdWUgY29tcG9uZW50LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXNldCggciwgZywgYiApIHsKCgkJCWlmICggZyA9PT0gdW5kZWZpbmVkICYmIGIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyByIGlzIFRIUkVFLkNvbG9yLCBoZXggb3Igc3RyaW5nCgoJCQkJY29uc3QgdmFsdWUgPSByOwoKCQkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNDb2xvciApIHsKCgkJCQkJdGhpcy5jb3B5KCB2YWx1ZSApOwoKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgKSB7CgoJCQkJCXRoaXMuc2V0SGV4KCB2YWx1ZSApOwoKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgKSB7CgoJCQkJCXRoaXMuc2V0U3R5bGUoIHZhbHVlICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNldFJHQiggciwgZywgYiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29sb3JzJ3MgY29tcG9uZW50cyB0byB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnIgPSBzY2FsYXI7CgkJCXRoaXMuZyA9IHNjYWxhcjsKCQkJdGhpcy5iID0gc2NhbGFyOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gYSBoZXhhZGVjaW1hbCB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZXggLSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlzZXRIZXgoIGhleCwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQkJaGV4ID0gTWF0aC5mbG9vciggaGV4ICk7CgoJCQl0aGlzLnIgPSAoIGhleCA+PiAxNiAmIDI1NSApIC8gMjU1OwoJCQl0aGlzLmcgPSAoIGhleCA+PiA4ICYgMjU1ICkgLyAyNTU7CgkJCXRoaXMuYiA9ICggaGV4ICYgMjU1ICkgLyAyNTU7CgoJCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gUkdCIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByIC0gUmVkIGNoYW5uZWwgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCgkJICogQHBhcmFtIHtudW1iZXJ9IGcgLSBHcmVlbiBjaGFubmVsIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBiIC0gQmx1ZSBjaGFubmVsIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXNldFJHQiggciwgZywgYiwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJCXRoaXMuciA9IHI7CgkJCXRoaXMuZyA9IGc7CgkJCXRoaXMuYiA9IGI7CgoJCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gUkdCIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBoIC0gSHVlIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gU2F0dXJhdGlvbiB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KCQkgKiBAcGFyYW0ge251bWJlcn0gbCAtIExpZ2h0bmVzcyB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Q29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlzZXRIU0woIGgsIHMsIGwsIGNvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKSB7CgoJCQkvLyBoLHMsbCByYW5nZXMgYXJlIGluIDAuMCAtIDEuMAoJCQloID0gZXVjbGlkZWFuTW9kdWxvKCBoLCAxICk7CgkJCXMgPSBjbGFtcCggcywgMCwgMSApOwoJCQlsID0gY2xhbXAoIGwsIDAsIDEgKTsKCgkJCWlmICggcyA9PT0gMCApIHsKCgkJCQl0aGlzLnIgPSB0aGlzLmcgPSB0aGlzLmIgPSBsOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCBwID0gbCA8PSAwLjUgPyBsICogKCAxICsgcyApIDogbCArIHMgLSAoIGwgKiBzICk7CgkJCQljb25zdCBxID0gKCAyICogbCApIC0gcDsKCgkJCQl0aGlzLnIgPSBodWUycmdiKCBxLCBwLCBoICsgMSAvIDMgKTsKCQkJCXRoaXMuZyA9IGh1ZTJyZ2IoIHEsIHAsIGggKTsKCQkJCXRoaXMuYiA9IGh1ZTJyZ2IoIHEsIHAsIGggLSAxIC8gMyApOwoKCQkJfQoKCQkJQ29sb3JNYW5hZ2VtZW50LmNvbG9yU3BhY2VUb1dvcmtpbmcoIHRoaXMsIGNvbG9yU3BhY2UgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBjb2xvciBmcm9tIGEgQ1NTLXN0eWxlIHN0cmluZy4gRm9yIGV4YW1wbGUsIGByZ2IoMjUwLCAwLDApYCwKCQkgKiBgcmdiKDEwMCUsIDAlLCAwJSlgLCBgaHNsKDAsIDEwMCUsIDUwJSlgLCBgI2ZmMDAwMGAsIGAjZjAwYCwgb3IgYHJlZGAgKCBvcgoJCSAqIGFueSBbWDExIGNvbG9yIG5hbWVde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1gxMV9jb2xvcl9uYW1lcyNDb2xvcl9uYW1lX2NoYXJ0fSAtCgkJICogYWxsIDE0MCBjb2xvciBuYW1lcyBhcmUgc3VwcG9ydGVkKS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZSAtIENvbG9yIGFzIGEgQ1NTLXN0eWxlIHN0cmluZy4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXNldFN0eWxlKCBzdHlsZSwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQkJZnVuY3Rpb24gaGFuZGxlQWxwaGEoIHN0cmluZyApIHsKCgkJCQlpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJCWlmICggcGFyc2VGbG9hdCggc3RyaW5nICkgPCAxICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogQWxwaGEgY29tcG9uZW50IG9mICcgKyBzdHlsZSArICcgd2lsbCBiZSBpZ25vcmVkLicgKTsKCgkJCQl9CgoJCQl9CgoKCQkJbGV0IG07CgoJCQlpZiAoIG0gPSAvXihcdyspXCgoW15cKV0qKVwpLy5leGVjKCBzdHlsZSApICkgewoKCQkJCS8vIHJnYiAvIGhzbAoKCQkJCWxldCBjb2xvcjsKCQkJCWNvbnN0IG5hbWUgPSBtWyAxIF07CgkJCQljb25zdCBjb21wb25lbnRzID0gbVsgMiBdOwoKCQkJCXN3aXRjaCAoIG5hbWUgKSB7CgoJCQkJCWNhc2UgJ3JnYic6CgkJCQkJY2FzZSAncmdiYSc6CgoJCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVxzKixccyooXGQrKVxzKixccyooXGQrKVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIHJnYigyNTUsMCwwKSByZ2JhKDI1NSwwLDAsMC41KQoKCQkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgoJCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAoJCQkJCQkJCU1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMSBdLCAxMCApICkgLyAyNTUsCgkJCQkJCQkJTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDI1NSwKCQkJCQkJCQlNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMjU1LAoJCQkJCQkJCWNvbG9yU3BhY2UKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVwlXHMqLFxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIHJnYigxMDAlLDAlLDAlKSByZ2JhKDEwMCUsMCUsMCUsMC41KQoKCQkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgoJCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAoJCQkJCQkJCU1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMSBdLCAxMCApICkgLyAxMDAsCgkJCQkJCQkJTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDEwMCwKCQkJCQkJCQlNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMTAwLAoJCQkJCQkJCWNvbG9yU3BhY2UKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnaHNsJzoKCQkJCQljYXNlICdoc2xhJzoKCgkJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCpcLj9cZCspXHMqLFxzKihcZCpcLj9cZCspXCVccyosXHMqKFxkKlwuP1xkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIGhzbCgxMjAsNTAlLDUwJSkgaHNsYSgxMjAsNTAlLDUwJSwwLjUpCgoJCQkJCQkJaGFuZGxlQWxwaGEoIGNvbG9yWyA0IF0gKTsKCgkJCQkJCQlyZXR1cm4gdGhpcy5zZXRIU0woCgkJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDEgXSApIC8gMzYwLAoJCQkJCQkJCXBhcnNlRmxvYXQoIGNvbG9yWyAyIF0gKSAvIDEwMCwKCQkJCQkJCQlwYXJzZUZsb2F0KCBjb2xvclsgMyBdICkgLyAxMDAsCgkJCQkJCQkJY29sb3JTcGFjZQoJCQkJCQkJKTsKCgkJCQkJCX0KCgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OgoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgbW9kZWwgJyArIHN0eWxlICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggbSA9IC9eXCMoW0EtRmEtZlxkXSspJC8uZXhlYyggc3R5bGUgKSApIHsKCgkJCQkvLyBoZXggY29sb3IKCgkJCQljb25zdCBoZXggPSBtWyAxIF07CgkJCQljb25zdCBzaXplID0gaGV4Lmxlbmd0aDsKCgkJCQlpZiAoIHNpemUgPT09IDMgKSB7CgoJCQkJCS8vICNmZjAKCQkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCgkJCQkJCXBhcnNlSW50KCBoZXguY2hhckF0KCAwICksIDE2ICkgLyAxNSwKCQkJCQkJcGFyc2VJbnQoIGhleC5jaGFyQXQoIDEgKSwgMTYgKSAvIDE1LAoJCQkJCQlwYXJzZUludCggaGV4LmNoYXJBdCggMiApLCAxNiApIC8gMTUsCgkJCQkJCWNvbG9yU3BhY2UKCQkJCQkpOwoKCQkJCX0gZWxzZSBpZiAoIHNpemUgPT09IDYgKSB7CgoJCQkJCS8vICNmZjAwMDAKCQkJCQlyZXR1cm4gdGhpcy5zZXRIZXgoIHBhcnNlSW50KCBoZXgsIDE2ICksIGNvbG9yU3BhY2UgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogSW52YWxpZCBoZXggY29sb3IgJyArIHN0eWxlICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggc3R5bGUgJiYgc3R5bGUubGVuZ3RoID4gMCApIHsKCgkJCQlyZXR1cm4gdGhpcy5zZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgY29sb3IgZnJvbSBhIGNvbG9yIG5hbWUuIEZhc3RlciB0aGFuIHtAbGluayBDb2xvciNzZXRTdHlsZX0gaWYKCQkgKiB5b3UgZG9uJ3QgbmVlZCB0aGUgb3RoZXIgQ1NTLXN0eWxlIGZvcm1hdHMuCgkJICoKCQkgKiBGb3IgY29udmVuaWVuY2UsIHRoZSBsaXN0IG9mIG5hbWVzIGlzIGV4cG9zZWQgaW4gYENvbG9yLk5BTUVTYCBhcyBhIGhhc2guCgkJICogYGBganMKCQkgKiBDb2xvci5OQU1FUy5hbGljZWJsdWUgLy8gcmV0dXJucyAweEYwRjhGRgoJCSAqIGBgYAoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlIC0gVGhlIGNvbG9yIG5hbWUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlzZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgoJCQkvLyBjb2xvciBrZXl3b3JkcwoJCQljb25zdCBoZXggPSBfY29sb3JLZXl3b3Jkc1sgc3R5bGUudG9Mb3dlckNhc2UoKSBdOwoKCQkJaWYgKCBoZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyByZWQKCQkJCXRoaXMuc2V0SGV4KCBoZXgsIGNvbG9yU3BhY2UgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gdW5rbm93biBjb2xvcgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgJyArIHN0eWxlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IGNvbG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLnIsIHRoaXMuZywgdGhpcy5iICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb3B5LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWNvcHkoIGNvbG9yICkgewoKCQkJdGhpcy5yID0gY29sb3IucjsKCQkJdGhpcy5nID0gY29sb3IuZzsKCQkJdGhpcy5iID0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgZ2l2ZW4gY29sb3IgaW50byB0aGlzIGNvbG9yLCBhbmQgdGhlbiBjb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20KCQkgKiBgU1JHQkNvbG9yU3BhY2VgIHRvIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb3B5L2NvbnZlcnQuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJY29weVNSR0JUb0xpbmVhciggY29sb3IgKSB7CgoJCQl0aGlzLnIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLnIgKTsKCQkJdGhpcy5nID0gU1JHQlRvTGluZWFyKCBjb2xvci5nICk7CgkJCXRoaXMuYiA9IFNSR0JUb0xpbmVhciggY29sb3IuYiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSBnaXZlbiBjb2xvciBpbnRvIHRoaXMgY29sb3IsIGFuZCB0aGVuIGNvbnZlcnRzIHRoaXMgY29sb3IgZnJvbQoJCSAqIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAgdG8gYFNSR0JDb2xvclNwYWNlYC4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvcHkvY29udmVydC4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQljb3B5TGluZWFyVG9TUkdCKCBjb2xvciApIHsKCgkJCXRoaXMuciA9IExpbmVhclRvU1JHQiggY29sb3IuciApOwoJCQl0aGlzLmcgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmcgKTsKCQkJdGhpcy5iID0gTGluZWFyVG9TUkdCKCBjb2xvci5iICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20gYFNSR0JDb2xvclNwYWNlYCB0byBgTGluZWFyU1JHQkNvbG9yU3BhY2VgLgoJCSAqCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJY29udmVydFNSR0JUb0xpbmVhcigpIHsKCgkJCXRoaXMuY29weVNSR0JUb0xpbmVhciggdGhpcyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhpcyBjb2xvciBmcm9tIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAgdG8gYFNSR0JDb2xvclNwYWNlYC4KCQkgKgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWNvbnZlcnRMaW5lYXJUb1NSR0IoKSB7CgoJCQl0aGlzLmNvcHlMaW5lYXJUb1NSR0IoIHRoaXMgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGhleGFkZWNpbWFsIHZhbHVlIG9mIHRoaXMgY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGhleGFkZWNpbWFsIHZhbHVlLgoJCSAqLwoJCWdldEhleCggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCgkJCXJldHVybiBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLnIgKiAyNTUsIDAsIDI1NSApICkgKiA2NTUzNiArIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuZyAqIDI1NSwgMCwgMjU1ICkgKSAqIDI1NiArIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuYiAqIDI1NSwgMCwgMjU1ICkgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBoZXhhZGVjaW1hbCB2YWx1ZSBvZiB0aGlzIGNvbG9yIGFzIGEgc3RyaW5nIChmb3IgZXhhbXBsZSwgJ0ZGRkZGRicpLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBoZXhhZGVjaW1hbCB2YWx1ZSBhcyBhIHN0cmluZy4KCQkgKi8KCQlnZXRIZXhTdHJpbmcoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJCXJldHVybiAoICcwMDAwMDAnICsgdGhpcy5nZXRIZXgoIGNvbG9yU3BhY2UgKS50b1N0cmluZyggMTYgKSApLnNsaWNlKCAtNiApOwoKCQl9CgoJCS8qKgoJCSAqIENvbnZlcnRzIHRoZSBjb2xvcnMgUkdCIHZhbHVlcyBpbnRvIHRoZSBIU0wgZm9ybWF0IGFuZCBzdG9yZXMgdGhlbSBpbnRvIHRoZQoJCSAqIGdpdmVuIHRhcmdldCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge3toOm51bWJlcixzOm51bWJlcixsOm51bWJlcn19IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge3toOm51bWJlcixzOm51bWJlcixsOm51bWJlcn19IFRoZSBIU0wgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBjb2xvci4KCQkgKi8KCQlnZXRIU0woIHRhcmdldCwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJCS8vIGgscyxsIHJhbmdlcyBhcmUgaW4gMC4wIC0gMS4wCgoJCQlDb2xvck1hbmFnZW1lbnQud29ya2luZ1RvQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQkJY29uc3QgciA9IF9jb2xvci5yLCBnID0gX2NvbG9yLmcsIGIgPSBfY29sb3IuYjsKCgkJCWNvbnN0IG1heCA9IE1hdGgubWF4KCByLCBnLCBiICk7CgkJCWNvbnN0IG1pbiA9IE1hdGgubWluKCByLCBnLCBiICk7CgoJCQlsZXQgaHVlLCBzYXR1cmF0aW9uOwoJCQljb25zdCBsaWdodG5lc3MgPSAoIG1pbiArIG1heCApIC8gMi4wOwoKCQkJaWYgKCBtaW4gPT09IG1heCApIHsKCgkJCQlodWUgPSAwOwoJCQkJc2F0dXJhdGlvbiA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IGRlbHRhID0gbWF4IC0gbWluOwoKCQkJCXNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAoIG1heCArIG1pbiApIDogZGVsdGEgLyAoIDIgLSBtYXggLSBtaW4gKTsKCgkJCQlzd2l0Y2ggKCBtYXggKSB7CgoJCQkJCWNhc2UgcjogaHVlID0gKCBnIC0gYiApIC8gZGVsdGEgKyAoIGcgPCBiID8gNiA6IDAgKTsgYnJlYWs7CgkJCQkJY2FzZSBnOiBodWUgPSAoIGIgLSByICkgLyBkZWx0YSArIDI7IGJyZWFrOwoJCQkJCWNhc2UgYjogaHVlID0gKCByIC0gZyApIC8gZGVsdGEgKyA0OyBicmVhazsKCgkJCQl9CgoJCQkJaHVlIC89IDY7CgoJCQl9CgoJCQl0YXJnZXQuaCA9IGh1ZTsKCQkJdGFyZ2V0LnMgPSBzYXR1cmF0aW9uOwoJCQl0YXJnZXQubCA9IGxpZ2h0bmVzczsKCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yIGFuZCBzdG9yZXMgdGhlbSBpbnRvIHRoZSBnaXZlbiB0YXJnZXQgb2JqZWN0LgoJCSAqCgkJICogQHBhcmFtIHtDb2xvcn0gdGFyZ2V0IC0gVGhlIHRhcmdldCBjb2xvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Q29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gVGhlIFJHQiByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGNvbG9yLgoJCSAqLwoJCWdldFJHQiggdGFyZ2V0LCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKCQkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCgkJCXRhcmdldC5yID0gX2NvbG9yLnI7CgkJCXRhcmdldC5nID0gX2NvbG9yLmc7CgkJCXRhcmdldC5iID0gX2NvbG9yLmI7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoaXMgY29sb3IgYXMgYSBDU1Mgc3R5bGUgc3RyaW5nLiBFeGFtcGxlOiBgcmdiKDI1NSwwLDApYC4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1TUkdCQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCgkJICogQHJldHVybiB7c3RyaW5nfSBUaGUgQ1NTIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgY29sb3IuCgkJICovCgkJZ2V0U3R5bGUoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJCUNvbG9yTWFuYWdlbWVudC53b3JraW5nVG9Db2xvclNwYWNlKCBfY29sb3IuY29weSggdGhpcyApLCBjb2xvclNwYWNlICk7CgoJCQljb25zdCByID0gX2NvbG9yLnIsIGcgPSBfY29sb3IuZywgYiA9IF9jb2xvci5iOwoKCQkJaWYgKCBjb2xvclNwYWNlICE9PSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJCQkvLyBSZXF1aXJlcyBDU1MgQ29sb3IgTW9kdWxlIExldmVsIDQgKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtY29sb3ItNC8pLgoJCQkJcmV0dXJuIGBjb2xvcigkeyBjb2xvclNwYWNlIH0gJHsgci50b0ZpeGVkKCAzICkgfSAkeyBnLnRvRml4ZWQoIDMgKSB9ICR7IGIudG9GaXhlZCggMyApIH0pYDsKCgkJCX0KCgkJCXJldHVybiBgcmdiKCR7IE1hdGgucm91bmQoIHIgKiAyNTUgKSB9LCR7IE1hdGgucm91bmQoIGcgKiAyNTUgKSB9LCR7IE1hdGgucm91bmQoIGIgKiAyNTUgKSB9KWA7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gSFNMIHZhbHVlcyB0byB0aGlzIGNvbG9yJ3MgdmFsdWVzLgoJCSAqIEludGVybmFsbHksIHRoaXMgY29udmVydHMgdGhlIGNvbG9yJ3MgUkdCIHZhbHVlcyB0byBIU0wsIGFkZHMgSFNMCgkJICogYW5kIHRoZW4gY29udmVydHMgdGhlIGNvbG9yIGJhY2sgdG8gUkdCLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGggLSBIdWUgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBTYXR1cmF0aW9uIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsIC0gTGlnaHRuZXNzIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCW9mZnNldEhTTCggaCwgcywgbCApIHsKCgkJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoKCQkJcmV0dXJuIHRoaXMuc2V0SFNMKCBfaHNsQS5oICsgaCwgX2hzbEEucyArIHMsIF9oc2xBLmwgKyBsICk7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3IgdG8gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGFkZC4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlhZGQoIGNvbG9yICkgewoKCQkJdGhpcy5yICs9IGNvbG9yLnI7CgkJCXRoaXMuZyArPSBjb2xvci5nOwoJCQl0aGlzLmIgKz0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIFJHQiB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMSAtIFRoZSBmaXJzdCBjb2xvci4KCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvcjIgLSBUaGUgc2Vjb25kIGNvbG9yLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWFkZENvbG9ycyggY29sb3IxLCBjb2xvcjIgKSB7CgoJCQl0aGlzLnIgPSBjb2xvcjEuciArIGNvbG9yMi5yOwoJCQl0aGlzLmcgPSBjb2xvcjEuZyArIGNvbG9yMi5nOwoJCQl0aGlzLmIgPSBjb2xvcjEuYiArIGNvbG9yMi5iOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWFkZFNjYWxhciggcyApIHsKCgkJCXRoaXMuciArPSBzOwoJCQl0aGlzLmcgKz0gczsKCQkJdGhpcy5iICs9IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTdWJ0cmFjdHMgdGhlIFJHQiB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9yIGZyb20gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIHN1YnRyYWN0LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXN1YiggY29sb3IgKSB7CgoJCQl0aGlzLnIgPSBNYXRoLm1heCggMCwgdGhpcy5yIC0gY29sb3IuciApOwoJCQl0aGlzLmcgPSBNYXRoLm1heCggMCwgdGhpcy5nIC0gY29sb3IuZyApOwoJCQl0aGlzLmIgPSBNYXRoLm1heCggMCwgdGhpcy5iIC0gY29sb3IuYiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3Igd2l0aCB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yLgoJCSAqCgkJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gbXVsdGlwbHkuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbXVsdGlwbHkoIGNvbG9yICkgewoKCQkJdGhpcy5yICo9IGNvbG9yLnI7CgkJCXRoaXMuZyAqPSBjb2xvci5nOwoJCQl0aGlzLmIgKj0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gbXVsdGlwbHkuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnIgKj0gczsKCQkJdGhpcy5nICo9IHM7CgkJCXRoaXMuYiAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIHRoaXMgY29sb3IncyBSR0IgdmFsdWVzIHRvd2FyZCB0aGUgUkdCIHZhbHVlcyBvZiB0aGUKCQkgKiBnaXZlbiBjb2xvci4gVGhlIGFscGhhIGFyZ3VtZW50IGNhbiBiZSB0aG91Z2h0IG9mIGFzIHRoZSByYXRpbyBiZXR3ZWVuCgkJICogdGhlIHR3byBjb2xvcnMsIHdoZXJlIGAwLjBgIGlzIHRoaXMgY29sb3IgYW5kIGAxLjBgIGlzIHRoZSBmaXJzdCBhcmd1bWVudC4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvbnZlcmdlIG9uLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbGVycCggY29sb3IsIGFscGhhICkgewoKCQkJdGhpcy5yICs9ICggY29sb3IuciAtIHRoaXMuciApICogYWxwaGE7CgkJCXRoaXMuZyArPSAoIGNvbG9yLmcgLSB0aGlzLmcgKSAqIGFscGhhOwoJCQl0aGlzLmIgKz0gKCBjb2xvci5iIC0gdGhpcy5iICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiBjb2xvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICogVGhlIGFscGhhIGFyZ3VtZW50IGNhbiBiZSB0aG91Z2h0IG9mIGFzIHRoZSByYXRpbyBiZXR3ZWVuIHRoZSB0d28gY29sb3JzLCB3aGVyZSBgMC4wYAoJCSAqIGlzIHRoZSBmaXJzdCBhbmQgYDEuMGAgaXMgdGhlIHNlY29uZCBjb2xvci4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMSAtIFRoZSBmaXJzdCBjb2xvci4KCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvcjIgLSBUaGUgc2Vjb25kIGNvbG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbGVycENvbG9ycyggY29sb3IxLCBjb2xvcjIsIGFscGhhICkgewoKCQkJdGhpcy5yID0gY29sb3IxLnIgKyAoIGNvbG9yMi5yIC0gY29sb3IxLnIgKSAqIGFscGhhOwoJCQl0aGlzLmcgPSBjb2xvcjEuZyArICggY29sb3IyLmcgLSBjb2xvcjEuZyApICogYWxwaGE7CgkJCXRoaXMuYiA9IGNvbG9yMS5iICsgKCBjb2xvcjIuYiAtIGNvbG9yMS5iICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyB0aGlzIGNvbG9yJ3MgSFNMIHZhbHVlcyB0b3dhcmQgdGhlIEhTTCB2YWx1ZXMgb2YgdGhlCgkJICogZ2l2ZW4gY29sb3IuIEl0IGRpZmZlcnMgZnJvbSB7QGxpbmsgQ29sb3IjbGVycH0gYnkgbm90IGludGVycG9sYXRpbmcgc3RyYWlnaHQKCQkgKiBmcm9tIG9uZSBjb2xvciB0byB0aGUgb3RoZXIsIGJ1dCBpbnN0ZWFkIGdvaW5nIHRocm91Z2ggYWxsIHRoZSBodWVzIGluIGJldHdlZW4KCQkgKiB0aG9zZSB0d28gY29sb3JzLiBUaGUgYWxwaGEgYXJndW1lbnQgY2FuIGJlIHRob3VnaHQgb2YgYXMgdGhlIHJhdGlvIGJldHdlZW4KCQkgKiB0aGUgdHdvIGNvbG9ycywgd2hlcmUgMC4wIGlzIHRoaXMgY29sb3IgYW5kIDEuMCBpcyB0aGUgZmlyc3QgYXJndW1lbnQuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb252ZXJnZSBvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsMV1gLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWxlcnBIU0woIGNvbG9yLCBhbHBoYSApIHsKCgkJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoJCQljb2xvci5nZXRIU0woIF9oc2xCICk7CgoJCQljb25zdCBoID0gbGVycCggX2hzbEEuaCwgX2hzbEIuaCwgYWxwaGEgKTsKCQkJY29uc3QgcyA9IGxlcnAoIF9oc2xBLnMsIF9oc2xCLnMsIGFscGhhICk7CgkJCWNvbnN0IGwgPSBsZXJwKCBfaHNsQS5sLCBfaHNsQi5sLCBhbHBoYSApOwoKCQkJdGhpcy5zZXRIU0woIGgsIHMsIGwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGNvbG9yJ3MgUkdCIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gM0QgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBzZXQuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJc2V0RnJvbVZlY3RvcjMoIHYgKSB7CgoJCQl0aGlzLnIgPSB2Lng7CgkJCXRoaXMuZyA9IHYueTsKCQkJdGhpcy5iID0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVHJhbnNmb3JtcyB0aGlzIGNvbG9yIHdpdGggdGhlIGdpdmVuIDN4MyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4MyggbSApIHsKCgkJCWNvbnN0IHIgPSB0aGlzLnIsIGcgPSB0aGlzLmcsIGIgPSB0aGlzLmI7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy5yID0gZVsgMCBdICogciArIGVbIDMgXSAqIGcgKyBlWyA2IF0gKiBiOwoJCQl0aGlzLmcgPSBlWyAxIF0gKiByICsgZVsgNCBdICogZyArIGVbIDcgXSAqIGI7CgkJCXRoaXMuYiA9IGVbIDIgXSAqIHIgKyBlWyA1IF0gKiBnICsgZVsgOCBdICogYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgY29sb3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtDb2xvcn0gYyAtIFRoZSBjb2xvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgY29sb3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggYyApIHsKCgkJCXJldHVybiAoIGMuciA9PT0gdGhpcy5yICkgJiYgKCBjLmcgPT09IHRoaXMuZyApICYmICggYy5iID09PSB0aGlzLmIgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgY29sb3IncyBSR0IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBhcnJheS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSBSR0IgdmFsdWVzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQkJdGhpcy5yID0gYXJyYXlbIG9mZnNldCBdOwoJCQl0aGlzLmcgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCQl0aGlzLmIgPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV3JpdGVzIHRoZSBSR0IgY29tcG9uZW50cyBvZiB0aGlzIGNvbG9yIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCgkJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBjb2xvciBjb21wb25lbnRzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBjb2xvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLnI7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLmc7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLmI7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIGNvbG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyBjb2xvciBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCgkJCXRoaXMuciA9IGF0dHJpYnV0ZS5nZXRYKCBpbmRleCApOwoJCQl0aGlzLmcgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCQkJdGhpcy5iID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUaGlzIG1ldGhvZHMgZGVmaW5lcyB0aGUgc2VyaWFsaXphdGlvbiByZXN1bHQgb2YgdGhpcyBjbGFzcy4gUmV0dXJucyB0aGUgY29sb3IKCQkgKiBhcyBhIGhleGFkZWNpbWFsIHZhbHVlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCgkJICovCgkJdG9KU09OKCkgewoKCQkJcmV0dXJuIHRoaXMuZ2V0SGV4KCk7CgoJCX0KCgkJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCQl5aWVsZCB0aGlzLnI7CgkJCXlpZWxkIHRoaXMuZzsKCQkJeWllbGQgdGhpcy5iOwoKCQl9CgoJfQoKCWNvbnN0IF9jb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CgoJLyoqCgkgKiBBIGRpY3Rpb25hcnkgd2l0aCBYMTEgY29sb3IgbmFtZXMuCgkgKgoJICogTm90ZSB0aGF0IG11bHRpcGxlIHdvcmRzIHN1Y2ggYXMgRGFyayBPcmFuZ2UgYmVjb21lIHRoZSBzdHJpbmcgJ2RhcmtvcmFuZ2UnLgoJICoKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKi8KCUNvbG9yLk5BTUVTID0gX2NvbG9yS2V5d29yZHM7CgoJbGV0IF9tYXRlcmlhbElkID0gMDsKCgkvKioKCSAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIG1hdGVyaWFscy4KCSAqCgkgKiBNYXRlcmlhbHMgZGVmaW5lIHRoZSBhcHBlYXJhbmNlIG9mIHJlbmRlcmFibGUgM0Qgb2JqZWN0cy4KCSAqCgkgKiBAYWJzdHJhY3QKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqLwoJY2xhc3MgTWF0ZXJpYWwgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1hdGVyaWFsLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzTWF0ZXJpYWwgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoZSBJRCBvZiB0aGUgbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEBuYW1lIE1hdGVyaWFsI2lkCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEByZWFkb25seQoJCQkgKi8KCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfbWF0ZXJpYWxJZCArKyB9ICk7CgoJCQkvKioKCQkJICogVGhlIFVVSUQgb2YgdGhlIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBAdHlwZSB7c3RyaW5nfQoJCQkgKiBAcmVhZG9ubHkKCQkJICovCgkJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQkJLyoqCgkJCSAqIFRoZSBuYW1lIG9mIHRoZSBtYXRlcmlhbC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMubmFtZSA9ICcnOwoKCQkJLyoqCgkJCSAqIFRoZSB0eXBlIHByb3BlcnR5IGlzIHVzZWQgZm9yIGRldGVjdGluZyB0aGUgb2JqZWN0IHR5cGUKCQkJICogaW4gY29udGV4dCBvZiBzZXJpYWxpemF0aW9uL2Rlc2VyaWFsaXphdGlvbi4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnR5cGUgPSAnTWF0ZXJpYWwnOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIHR5cGUgb2YgdGhlIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBJdCBtdXN0IGJlIHNldCB0byBgQ3VzdG9tQmxlbmRpbmdgIGlmIGN1c3RvbSBibGVuZGluZyBwcm9wZXJ0aWVzIGxpa2UKCQkJICoge0BsaW5rIE1hdGVyaWFsI2JsZW5kU3JjfSwge0BsaW5rIE1hdGVyaWFsI2JsZW5kRHN0fSBvciB7QGxpbmsgTWF0ZXJpYWwjYmxlbmRFcXVhdGlvbn0KCQkJICogc2hvdWxkIGhhdmUgYW55IGVmZmVjdC4KCQkJICoKCQkJICogQHR5cGUgeyhOb0JsZW5kaW5nfE5vcm1hbEJsZW5kaW5nfEFkZGl0aXZlQmxlbmRpbmd8U3VidHJhY3RpdmVCbGVuZGluZ3xNdWx0aXBseUJsZW5kaW5nfEN1c3RvbUJsZW5kaW5nKX0KCQkJICogQGRlZmF1bHQgTm9ybWFsQmxlbmRpbmcKCQkJICovCgkJCXRoaXMuYmxlbmRpbmcgPSBOb3JtYWxCbGVuZGluZzsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHdoaWNoIHNpZGUgb2YgZmFjZXMgd2lsbCBiZSByZW5kZXJlZCAtIGZyb250LCBiYWNrIG9yIGJvdGguCgkJCSAqCgkJCSAqIEB0eXBlIHsoRnJvbnRTaWRlfEJhY2tTaWRlfERvdWJsZVNpZGUpfQoJCQkgKiBAZGVmYXVsdCBGcm9udFNpZGUKCQkJICovCgkJCXRoaXMuc2lkZSA9IEZyb250U2lkZTsKCgkJCS8qKgoJCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB2ZXJ0ZXggY29sb3JzIHNob3VsZCBiZSB1c2VkLgoJCQkgKgoJCQkgKiBUaGUgZW5naW5lIHN1cHBvcnRzIFJHQiBhbmQgUkdCQSB2ZXJ0ZXggY29sb3JzIGRlcGVuZGluZyBvbiB3aGV0aGVyIGEgdGhyZWUgKFJHQikgb3IKCQkJICogZm91ciAoUkdCQSkgY29tcG9uZW50IGNvbG9yIGJ1ZmZlciBhdHRyaWJ1dGUgaXMgdXNlZC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLnZlcnRleENvbG9ycyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgaG93IHRyYW5zcGFyZW50IHRoZSBtYXRlcmlhbCBpcy4KCQkJICogQSB2YWx1ZSBvZiBgMC4wYCBpbmRpY2F0ZXMgZnVsbHkgdHJhbnNwYXJlbnQsIGAxLjBgIGlzIGZ1bGx5IG9wYXF1ZS4KCQkJICoKCQkJICogSWYgdGhlIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gaXMgbm90IHNldCB0byBgdHJ1ZWAsCgkJCSAqIHRoZSBtYXRlcmlhbCB3aWxsIHJlbWFpbiBmdWxseSBvcGFxdWUgYW5kIHRoaXMgdmFsdWUgd2lsbCBvbmx5IGFmZmVjdCBpdHMgY29sb3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMub3BhY2l0eSA9IDE7CgoJCQkvKioKCQkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgaXMgdHJhbnNwYXJlbnQuIFRoaXMgaGFzIGFuIGVmZmVjdCBvbgoJCQkgKiByZW5kZXJpbmcgYXMgdHJhbnNwYXJlbnQgb2JqZWN0cyBuZWVkIHNwZWNpYWwgdHJlYXRtZW50IGFuZCBhcmUgcmVuZGVyZWQKCQkJICogYWZ0ZXIgbm9uLXRyYW5zcGFyZW50IG9iamVjdHMuCgkJCSAqCgkJCSAqIFdoZW4gc2V0IHRvIHRydWUsIHRoZSBleHRlbnQgdG8gd2hpY2ggdGhlIG1hdGVyaWFsIGlzIHRyYW5zcGFyZW50IGlzCgkJCSAqIGNvbnRyb2xsZWQgYnkge0BsaW5rIE1hdGVyaWFsI29wYWNpdHl9LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMudHJhbnNwYXJlbnQgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBFbmFibGVzIGFscGhhIGhhc2hlZCB0cmFuc3BhcmVuY3ksIGFuIGFsdGVybmF0aXZlIHRvIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3IKCQkJICoge0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uIFRoZSBtYXRlcmlhbCB3aWxsIG5vdCBiZSByZW5kZXJlZCBpZiBvcGFjaXR5IGlzIGxvd2VyIHRoYW4KCQkJICogYSByYW5kb20gdGhyZXNob2xkLiBSYW5kb21pemF0aW9uIGludHJvZHVjZXMgc29tZSBncmFpbiBvciBub2lzZSwgYnV0IGFwcHJveGltYXRlcyBhbHBoYQoJCQkgKiBibGVuZGluZyB3aXRob3V0IHRoZSBhc3NvY2lhdGVkIHByb2JsZW1zIG9mIHNvcnRpbmcuIFVzaW5nIFRBQSBjYW4gcmVkdWNlIHRoZSByZXN1bHRpbmcgbm9pc2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5hbHBoYUhhc2ggPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBzb3VyY2UgZmFjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CgkJCSAqIEBkZWZhdWx0IFNyY0FscGhhRmFjdG9yCgkJCSAqLwoJCQl0aGlzLmJsZW5kU3JjID0gU3JjQWxwaGFGYWN0b3I7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZGVzdGluYXRpb24gZmFjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CgkJCSAqIEBkZWZhdWx0IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IKCQkJICovCgkJCXRoaXMuYmxlbmREc3QgPSBPbmVNaW51c1NyY0FscGhhRmFjdG9yOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIGVxdWF0aW9uLgoJCQkgKgoJCQkgKiBAdHlwZSB7KEFkZEVxdWF0aW9ufFN1YnRyYWN0RXF1YXRpb258UmV2ZXJzZVN1YnRyYWN0RXF1YXRpb258TWluRXF1YXRpb258TWF4RXF1YXRpb24pfQoJCQkgKiBAZGVmYXVsdCBBZGRFcXVhdGlvbgoJCQkgKi8KCQkJdGhpcy5ibGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgc291cmNlIGFscGhhIGZhY3Rvci4KCQkJICoKCQkJICogQHR5cGUgez8oWmVyb0ZhY3RvcnxPbmVGYWN0b3J8U3JjQ29sb3JGYWN0b3J8T25lTWludXNTcmNDb2xvckZhY3RvcnxTcmNBbHBoYUZhY3RvcnxPbmVNaW51c1NyY0FscGhhRmFjdG9yfERzdEFscGhhRmFjdG9yfE9uZU1pbnVzRHN0QWxwaGFGYWN0b3J8RHN0Q29sb3JGYWN0b3J8T25lTWludXNEc3RDb2xvckZhY3RvcnxTcmNBbHBoYVNhdHVyYXRlRmFjdG9yfENvbnN0YW50Q29sb3JGYWN0b3J8T25lTWludXNDb25zdGFudENvbG9yRmFjdG9yfENvbnN0YW50QWxwaGFGYWN0b3J8T25lTWludXNDb25zdGFudEFscGhhRmFjdG9yKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5ibGVuZFNyY0FscGhhID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBkZXN0aW5hdGlvbiBhbHBoYSBmYWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYmxlbmREc3RBbHBoYSA9IG51bGw7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZXF1YXRpb24gb2YgdGhlIGFscGhhIGNoYW5uZWwuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KEFkZEVxdWF0aW9ufFN1YnRyYWN0RXF1YXRpb258UmV2ZXJzZVN1YnRyYWN0RXF1YXRpb258TWluRXF1YXRpb258TWF4RXF1YXRpb24pfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CgoJCQkvKioKCQkJICogUmVwcmVzZW50cyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgY29uc3RhbnQgYmxlbmQgY29sb3IuCgkJCSAqCgkJCSAqIFRoaXMgcHJvcGVydHkgaGFzIG9ubHkgYW4gZWZmZWN0IHdoZW4gdXNpbmcgY3VzdG9tIGJsZW5kaW5nIHdpdGggYENvbnN0YW50Q29sb3JgIG9yIGBPbmVNaW51c0NvbnN0YW50Q29sb3JgLgoJCQkgKgoJCQkgKiBAdHlwZSB7Q29sb3J9CgkJCSAqIEBkZWZhdWx0ICgwLDAsMCkKCQkJICovCgkJCXRoaXMuYmxlbmRDb2xvciA9IG5ldyBDb2xvciggMCwgMCwgMCApOwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIGFscGhhIHZhbHVlIG9mIHRoZSBjb25zdGFudCBibGVuZCBjb2xvci4KCQkJICoKCQkJICogVGhpcyBwcm9wZXJ0eSBoYXMgb25seSBhbiBlZmZlY3Qgd2hlbiB1c2luZyBjdXN0b20gYmxlbmRpbmcgd2l0aCBgQ29uc3RhbnRBbHBoYWAgb3IgYE9uZU1pbnVzQ29uc3RhbnRBbHBoYWAuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMuYmxlbmRBbHBoYSA9IDA7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgZGVwdGggZnVuY3Rpb24uCgkJCSAqCgkJCSAqIEB0eXBlIHsoTmV2ZXJEZXB0aHxBbHdheXNEZXB0aHxMZXNzRGVwdGh8TGVzc0VxdWFsRGVwdGh8RXF1YWxEZXB0aHxHcmVhdGVyRXF1YWxEZXB0aHxHcmVhdGVyRGVwdGh8Tm90RXF1YWxEZXB0aCl9CgkJCSAqIEBkZWZhdWx0IExlc3NFcXVhbERlcHRoCgkJCSAqLwoJCQl0aGlzLmRlcHRoRnVuYyA9IExlc3NFcXVhbERlcHRoOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gaGF2ZSBkZXB0aCB0ZXN0IGVuYWJsZWQgd2hlbiByZW5kZXJpbmcgdGhpcyBtYXRlcmlhbC4KCQkJICogV2hlbiB0aGUgZGVwdGggdGVzdCBpcyBkaXNhYmxlZCwgdGhlIGRlcHRoIHdyaXRlIHdpbGwgYWxzbyBiZSBpbXBsaWNpdGx5IGRpc2FibGVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5kZXB0aFRlc3QgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgcmVuZGVyaW5nIHRoaXMgbWF0ZXJpYWwgaGFzIGFueSBlZmZlY3Qgb24gdGhlIGRlcHRoIGJ1ZmZlci4KCQkJICoKCQkJICogV2hlbiBkcmF3aW5nIDJEIG92ZXJsYXlzIGl0IGNhbiBiZSB1c2VmdWwgdG8gZGlzYWJsZSB0aGUgZGVwdGggd3JpdGluZyBpbgoJCQkgKiBvcmRlciB0byBsYXllciBzZXZlcmFsIHRoaW5ncyB0b2dldGhlciB3aXRob3V0IGNyZWF0aW5nIHotaW5kZXggYXJ0aWZhY3RzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5kZXB0aFdyaXRlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgYml0IG1hc2sgdG8gdXNlIHdoZW4gd3JpdGluZyB0byB0aGUgc3RlbmNpbCBidWZmZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDB4ZmYKCQkJICovCgkJCXRoaXMuc3RlbmNpbFdyaXRlTWFzayA9IDB4ZmY7CgoJCQkvKioKCQkJICogVGhlIHN0ZW5jaWwgY29tcGFyaXNvbiBmdW5jdGlvbiB0byB1c2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtOZXZlclN0ZW5jaWxGdW5jfExlc3NTdGVuY2lsRnVuY3xFcXVhbFN0ZW5jaWxGdW5jfExlc3NFcXVhbFN0ZW5jaWxGdW5jfEdyZWF0ZXJTdGVuY2lsRnVuY3xOb3RFcXVhbFN0ZW5jaWxGdW5jfEdyZWF0ZXJFcXVhbFN0ZW5jaWxGdW5jfEFsd2F5c1N0ZW5jaWxGdW5jfQoJCQkgKiBAZGVmYXVsdCBBbHdheXNTdGVuY2lsRnVuYwoJCQkgKi8KCQkJdGhpcy5zdGVuY2lsRnVuYyA9IEFsd2F5c1N0ZW5jaWxGdW5jOwoKCQkJLyoqCgkJCSAqIFRoZSB2YWx1ZSB0byB1c2Ugd2hlbiBwZXJmb3JtaW5nIHN0ZW5jaWwgY29tcGFyaXNvbnMgb3Igc3RlbmNpbCBvcGVyYXRpb25zLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxSZWYgPSAwOwoKCQkJLyoqCgkJCSAqIFRoZSBiaXQgbWFzayB0byB1c2Ugd2hlbiBjb21wYXJpbmcgYWdhaW5zdCB0aGUgc3RlbmNpbCBidWZmZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDB4ZmYKCQkJICovCgkJCXRoaXMuc3RlbmNpbEZ1bmNNYXNrID0gMHhmZjsKCgkJCS8qKgoJCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucyBgZmFsc2VgLgoJCQkgKgoJCQkgKiBAdHlwZSB7WmVyb1N0ZW5jaWxPcHxLZWVwU3RlbmNpbE9wfFJlcGxhY2VTdGVuY2lsT3B8SW5jcmVtZW50U3RlbmNpbE9wfERlY3JlbWVudFN0ZW5jaWxPcHxJbmNyZW1lbnRXcmFwU3RlbmNpbE9wfERlY3JlbWVudFdyYXBTdGVuY2lsT3B8SW52ZXJ0U3RlbmNpbE9wfQoJCQkgKiBAZGVmYXVsdCBLZWVwU3RlbmNpbE9wCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxGYWlsID0gS2VlcFN0ZW5jaWxPcDsKCgkJCS8qKgoJCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucwoJCQkgKiBgdHJ1ZWAgYnV0IHRoZSBkZXB0aCB0ZXN0IGZhaWxzLgoJCQkgKgoJCQkgKiBAdHlwZSB7WmVyb1N0ZW5jaWxPcHxLZWVwU3RlbmNpbE9wfFJlcGxhY2VTdGVuY2lsT3B8SW5jcmVtZW50U3RlbmNpbE9wfERlY3JlbWVudFN0ZW5jaWxPcHxJbmNyZW1lbnRXcmFwU3RlbmNpbE9wfERlY3JlbWVudFdyYXBTdGVuY2lsT3B8SW52ZXJ0U3RlbmNpbE9wfQoJCQkgKiBAZGVmYXVsdCBLZWVwU3RlbmNpbE9wCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IEtlZXBTdGVuY2lsT3A7CgoJCQkvKioKCQkJICogV2hpY2ggc3RlbmNpbCBvcGVyYXRpb24gdG8gcGVyZm9ybSB3aGVuIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uIHJldHVybnMKCQkJICogYHRydWVgIGFuZCB0aGUgZGVwdGggdGVzdCBwYXNzZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtaZXJvU3RlbmNpbE9wfEtlZXBTdGVuY2lsT3B8UmVwbGFjZVN0ZW5jaWxPcHxJbmNyZW1lbnRTdGVuY2lsT3B8RGVjcmVtZW50U3RlbmNpbE9wfEluY3JlbWVudFdyYXBTdGVuY2lsT3B8RGVjcmVtZW50V3JhcFN0ZW5jaWxPcHxJbnZlcnRTdGVuY2lsT3B9CgkJCSAqIEBkZWZhdWx0IEtlZXBTdGVuY2lsT3AKCQkJICovCgkJCXRoaXMuc3RlbmNpbFpQYXNzID0gS2VlcFN0ZW5jaWxPcDsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHN0ZW5jaWwgb3BlcmF0aW9ucyBhcmUgcGVyZm9ybWVkIGFnYWluc3QgdGhlIHN0ZW5jaWwgYnVmZmVyLiBJbgoJCQkgKiBvcmRlciB0byBwZXJmb3JtIHdyaXRlcyBvciBjb21wYXJpc29ucyBhZ2FpbnN0IHRoZSBzdGVuY2lsIGJ1ZmZlciB0aGlzCgkJCSAqIHZhbHVlIG11c3QgYmUgYHRydWVgLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuc3RlbmNpbFdyaXRlID0gZmFsc2U7CgoJCQkvKioKCQkJICogVXNlci1kZWZpbmVkIGNsaXBwaW5nIHBsYW5lcyBzcGVjaWZpZWQgYXMgVEhSRUUuUGxhbmUgb2JqZWN0cyBpbiB3b3JsZAoJCQkgKiBzcGFjZS4gVGhlc2UgcGxhbmVzIGFwcGx5IHRvIHRoZSBvYmplY3RzIHRoaXMgbWF0ZXJpYWwgaXMgYXR0YWNoZWQgdG8uCgkJCSAqIFBvaW50cyBpbiBzcGFjZSB3aG9zZSBzaWduZWQgZGlzdGFuY2UgdG8gdGhlIHBsYW5lIGlzIG5lZ2F0aXZlIGFyZSBjbGlwcGVkCgkJCSAqIChub3QgcmVuZGVyZWQpLiBUaGlzIHJlcXVpcmVzIHtAbGluayBXZWJHTFJlbmRlcmVyI2xvY2FsQ2xpcHBpbmdFbmFibGVkfSB0bwoJCQkgKiBiZSBgdHJ1ZWAuCgkJCSAqCgkJCSAqIEB0eXBlIHs/QXJyYXk8UGxhbmU+fQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBDaGFuZ2VzIHRoZSBiZWhhdmlvciBvZiBjbGlwcGluZyBwbGFuZXMgc28gdGhhdCBvbmx5IHRoZWlyIGludGVyc2VjdGlvbiBpcwoJCQkgKiBjbGlwcGVkLCByYXRoZXIgdGhhbiB0aGVpciB1bmlvbi4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmNsaXBJbnRlcnNlY3Rpb24gPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHdoZXRoZXIgdG8gY2xpcCBzaGFkb3dzIGFjY29yZGluZyB0byB0aGUgY2xpcHBpbmcgcGxhbmVzIHNwZWNpZmllZAoJCQkgKiBvbiB0aGlzIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuY2xpcFNoYWRvd3MgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHdoaWNoIHNpZGUgb2YgZmFjZXMgY2FzdCBzaGFkb3dzLiBJZiBgbnVsbGAsIHRoZSBzaWRlIGNhc3Rpbmcgc2hhZG93cwoJCQkgKiBpcyBkZXRlcm1pbmVkIGFzIGZvbGxvd3M6CgkJCSAqCgkJCSAqIC0gV2hlbiB7QGxpbmsgTWF0ZXJpYWwjc2lkZX0gaXMgc2V0IHRvIGBGcm9udFNpZGVgLCB0aGUgYmFjayBzaWRlIGNhc3Qgc2hhZG93cy4KCQkJICogLSBXaGVuIHtAbGluayBNYXRlcmlhbCNzaWRlfSBpcyBzZXQgdG8gYEJhY2tTaWRlYCwgdGhlIGZyb250IHNpZGUgY2FzdCBzaGFkb3dzLgoJCQkgKiAtIFdoZW4ge0BsaW5rIE1hdGVyaWFsI3NpZGV9IGlzIHNldCB0byBgRG91YmxlU2lkZWAsIGJvdGggc2lkZXMgY2FzdCBzaGFkb3dzLgoJCQkgKgoJCQkgKiBAdHlwZSB7PyhGcm9udFNpZGV8QmFja1NpZGV8RG91YmxlU2lkZSl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuc2hhZG93U2lkZSA9IG51bGw7CgoJCQkvKioKCQkJICogV2hldGhlciB0byByZW5kZXIgdGhlIG1hdGVyaWFsJ3MgY29sb3IuCgkJCSAqCgkJCSAqIFRoaXMgY2FuIGJlIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCB7QGxpbmsgT2JqZWN0M0QjcmVuZGVyT2Rlcn0gdG8gY3JlYXRlIGludmlzaWJsZQoJCQkgKiBvYmplY3RzIHRoYXQgb2NjbHVkZSBvdGhlciBvYmplY3RzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5jb2xvcldyaXRlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBPdmVycmlkZSB0aGUgcmVuZGVyZXIncyBkZWZhdWx0IHByZWNpc2lvbiBmb3IgdGhpcyBtYXRlcmlhbC4KCQkJICoKCQkJICogQHR5cGUgez8oJ2hpZ2hwJ3wnbWVkaXVtcCd8J2xvd3AnKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5wcmVjaXNpb24gPSBudWxsOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gdXNlIHBvbHlnb24gb2Zmc2V0IG9yIG5vdC4gV2hlbiBlbmFibGVkLCBlYWNoIGZyYWdtZW50J3MgZGVwdGggdmFsdWUgd2lsbAoJCQkgKiBiZSBvZmZzZXQgYWZ0ZXIgaXQgaXMgaW50ZXJwb2xhdGVkIGZyb20gdGhlIGRlcHRoIHZhbHVlcyBvZiB0aGUgYXBwcm9wcmlhdGUgdmVydGljZXMuCgkJCSAqIFRoZSBvZmZzZXQgaXMgYWRkZWQgYmVmb3JlIHRoZSBkZXB0aCB0ZXN0IGlzIHBlcmZvcm1lZCBhbmQgYmVmb3JlIHRoZSB2YWx1ZSBpcyB3cml0dGVuCgkJCSAqIGludG8gdGhlIGRlcHRoIGJ1ZmZlci4KCQkJICoKCQkJICogQ2FuIGJlIHVzZWZ1bCBmb3IgcmVuZGVyaW5nIGhpZGRlbi1saW5lIGltYWdlcywgZm9yIGFwcGx5aW5nIGRlY2FscyB0byBzdXJmYWNlcywgYW5kIGZvcgoJCQkgKiByZW5kZXJpbmcgc29saWRzIHdpdGggaGlnaGxpZ2h0ZWQgZWRnZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gZmFsc2U7CgoJCQkvKioKCQkJICogU3BlY2lmaWVzIGEgc2NhbGUgZmFjdG9yIHRoYXQgaXMgdXNlZCB0byBjcmVhdGUgYSB2YXJpYWJsZSBkZXB0aCBvZmZzZXQgZm9yIGVhY2ggcG9seWdvbi4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gMDsKCgkJCS8qKgoJCQkgKiBJcyBtdWx0aXBsaWVkIGJ5IGFuIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHZhbHVlIHRvIGNyZWF0ZSBhIGNvbnN0YW50IGRlcHRoIG9mZnNldC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgPSAwOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gYXBwbHkgZGl0aGVyaW5nIHRvIHRoZSBjb2xvciB0byByZW1vdmUgdGhlIGFwcGVhcmFuY2Ugb2YgYmFuZGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmRpdGhlcmluZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgYWxwaGEgdG8gY292ZXJhZ2Ugc2hvdWxkIGJlIGVuYWJsZWQgb3Igbm90LiBDYW4gb25seSBiZSB1c2VkIHdpdGggTVNBQS1lbmFibGVkIGNvbnRleHRzCgkJCSAqIChtZWFuaW5nIHdoZW4gdGhlIHJlbmRlcmVyIHdhcyBjcmVhdGVkIHdpdGggKmFudGlhbGlhcyogcGFyYW1ldGVyIHNldCB0byBgdHJ1ZWApLiBFbmFibGluZyB0aGlzCgkJCSAqIHdpbGwgc21vb3RoIGFsaWFzaW5nIG9uIGNsaXAgcGxhbmUgZWRnZXMgYW5kIGFscGhhVGVzdC1jbGlwcGVkIGVkZ2VzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuYWxwaGFUb0NvdmVyYWdlID0gZmFsc2U7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBwcmVtdWx0aXBseSB0aGUgYWxwaGEgKHRyYW5zcGFyZW5jeSkgdmFsdWUuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIGRvdWJsZS1zaWRlZCwgdHJhbnNwYXJlbnQgb2JqZWN0cyBzaG91bGQgYmUgcmVuZGVyZWQgd2l0aCBhIHNpbmdsZSBwYXNzIG9yIG5vdC4KCQkJICoKCQkJICogVGhlIGVuZ2luZSByZW5kZXJzIGRvdWJsZS1zaWRlZCwgdHJhbnNwYXJlbnQgb2JqZWN0cyB3aXRoIHR3byBkcmF3IGNhbGxzIChiYWNrIGZhY2VzIGZpcnN0LAoJCQkgKiB0aGVuIGZyb250IGZhY2VzKSB0byBtaXRpZ2F0ZSB0cmFuc3BhcmVuY3kgYXJ0aWZhY3RzLiBUaGVyZSBhcmUgc2NlbmFyaW9zIGhvd2V2ZXIgd2hlcmUgdGhpcwoJCQkgKiBhcHByb2FjaCBwcm9kdWNlcyBubyBxdWFsaXR5IGdhaW5zIGJ1dCBzdGlsbCBkb3VibGVzIGRyYXcgY2FsbHMgZS5nLiB3aGVuIHJlbmRlcmluZyBmbGF0CgkJCSAqIHZlZ2V0YXRpb24gbGlrZSBncmFzcyBzcHJpdGVzLiBJbiB0aGVzZSBjYXNlcywgc2V0IHRoZSBgZm9yY2VTaW5nbGVQYXNzYCBmbGFnIHRvIGB0cnVlYCB0bwoJCQkgKiBkaXNhYmxlIHRoZSB0d28gcGFzcyByZW5kZXJpbmcgdG8gYXZvaWQgcGVyZm9ybWFuY2UgaXNzdWVzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gZmFsc2U7CgoJCQkvKioKCQkJICogV2hldGhlciBpdCdzIHBvc3NpYmxlIHRvIG92ZXJyaWRlIHRoZSBtYXRlcmlhbCB3aXRoIHtAbGluayBTY2VuZSNvdmVycmlkZU1hdGVyaWFsfSBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmFsbG93T3ZlcnJpZGUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgd2hldGhlciAzRCBvYmplY3RzIHVzaW5nIHRoaXMgbWF0ZXJpYWwgYXJlIHZpc2libGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIGlzIHRvbmUgbWFwcGVkIGFjY29yZGluZyB0byB0aGUgcmVuZGVyZXIncyB0b25lIG1hcHBpbmcgc2V0dGluZy4KCQkJICoKCQkJICogSXQgaXMgaWdub3JlZCB3aGVuIHJlbmRlcmluZyB0byBhIHJlbmRlciB0YXJnZXQgb3IgdXNpbmcgcG9zdCBwcm9jZXNzaW5nIG9yIHdoZW4gdXNpbmcKCQkJICogYFdlYkdQVVJlbmRlcmVyYC4gSW4gYWxsIHRoZXNlIGNhc2VzLCBhbGwgbWF0ZXJpYWxzIGFyZSBob25vcmVkIGJ5IHRvbmUgbWFwcGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMudG9uZU1hcHBlZCA9IHRydWU7CgoJCQkvKioKCQkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIE1hdGVyaWFsLiBJdAoJCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkgKi8KCQkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCQkJLyoqCgkJCSAqIFRoaXMgc3RhcnRzIGF0IGAwYCBhbmQgY291bnRzIGhvdyBtYW55IHRpbWVzIHtAbGluayBNYXRlcmlhbCNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMudmVyc2lvbiA9IDA7CgoJCQl0aGlzLl9hbHBoYVRlc3QgPSAwOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGFscGhhIHZhbHVlIHRvIGJlIHVzZWQgd2hlbiBydW5uaW5nIGFuIGFscGhhIHRlc3QuIFRoZSBtYXRlcmlhbAoJCSAqIHdpbGwgbm90IGJlIHJlbmRlcmVkIGlmIHRoZSBvcGFjaXR5IGlzIGxvd2VyIHRoYW4gdGhpcyB2YWx1ZS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQHJlYWRvbmx5CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCBhbHBoYVRlc3QoKSB7CgoJCQlyZXR1cm4gdGhpcy5fYWxwaGFUZXN0OwoKCQl9CgoJCXNldCBhbHBoYVRlc3QoIHZhbHVlICkgewoKCQkJaWYgKCB0aGlzLl9hbHBoYVRlc3QgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgoJCQkJdGhpcy52ZXJzaW9uICsrOwoKCQkJfQoKCQkJdGhpcy5fYWxwaGFUZXN0ID0gdmFsdWU7CgoJCX0KCgkJLyoqCgkJICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIG1hdGVyaWFsIGlzIHVzZWQgdG8gcmVuZGVyIGEgM0Qgb2JqZWN0LgoJCSAqCgkJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgLSBUaGUgc2NlbmUuCgkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCgkJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KCQkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KCQkgKi8KCQlvbkJlZm9yZVJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICovICkge30KCgkJLyoqCgkJICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIHNoYWRlcgoJCSAqIHByb2dyYW0gaXMgY29tcGlsZWQuIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdpdGggdGhlIHNoYWRlciBzb3VyY2UgY29kZQoJCSAqIGFzIGEgcGFyYW1ldGVyLiBVc2VmdWwgZm9yIHRoZSBtb2RpZmljYXRpb24gb2YgYnVpbHQtaW4gbWF0ZXJpYWxzLgoJCSAqCgkJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4gVGhlCgkJICogcmVjb21tZW5kZWQgYXBwcm9hY2ggd2hlbiBjdXN0b21pemluZyBtYXRlcmlhbHMgaXMgdG8gdXNlIGBXZWJHUFVSZW5kZXJlcmAgd2l0aCB0aGUgbmV3CgkJICogTm9kZSBNYXRlcmlhbCBzeXN0ZW0gYW5kIFtUU0xde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvd2lraS9UaHJlZS5qcy1TaGFkaW5nLUxhbmd1YWdlfS4KCQkgKgoJCSAqIEBwYXJhbSB7e3ZlcnRleFNoYWRlcjpzdHJpbmcsZnJhZ21lbnRTaGFkZXI6c3RyaW5nLHVuaWZvcm1zOk9iamVjdH19IHNoYWRlcm9iamVjdCAtIFRoZSBvYmplY3QgaG9sZHMgdGhlIHVuaWZvcm1zIGFuZCB0aGUgdmVydGV4IGFuZCBmcmFnbWVudCBzaGFkZXIgc291cmNlLgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBBIHJlZmVyZW5jZSB0byB0aGUgcmVuZGVyZXIuCgkJICovCgkJb25CZWZvcmVDb21waWxlKCAvKiBzaGFkZXJvYmplY3QsIHJlbmRlcmVyICovICkge30KCgkJLyoqCgkJICogSW4gY2FzZSB7QGxpbmsgTWF0ZXJpYWwjb25CZWZvcmVDb21waWxlfSBpcyB1c2VkLCB0aGlzIGNhbGxiYWNrIGNhbiBiZSB1c2VkIHRvIGlkZW50aWZ5CgkJICogdmFsdWVzIG9mIHNldHRpbmdzIHVzZWQgaW4gYG9uQmVmb3JlQ29tcGlsZSgpYCwgc28gdGhyZWUuanMgY2FuIHJldXNlIGEgY2FjaGVkCgkJICogc2hhZGVyIG9yIHJlY29tcGlsZSB0aGUgc2hhZGVyIGZvciB0aGlzIG1hdGVyaWFsIGFzIG5lZWRlZC4KCQkgKgoJCSAqIFRoaXMgbWV0aG9kIGNhbiBvbmx5IGJlIHVzZWQgd2hlbiByZW5kZXJpbmcgd2l0aCB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkJICoKCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjdXN0b20gcHJvZ3JhbSBjYWNoZSBrZXkuCgkJICovCgkJY3VzdG9tUHJvZ3JhbUNhY2hlS2V5KCkgewoKCQkJcmV0dXJuIHRoaXMub25CZWZvcmVDb21waWxlLnRvU3RyaW5nKCk7CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgdG8gc2V0IGRlZmF1bHQgdmFsdWVzIGZyb20gcGFyYW1ldGVyIG9iamVjdHMuCgkJICogSXQgaXMgYSBnZW5lcmljIGltcGxlbWVudGF0aW9uIHNvIGl0IGNhbiBiZSB1c2VkIHdpdGggZGlmZmVyZW50IHR5cGVzCgkJICogb2YgbWF0ZXJpYWxzLgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IFt2YWx1ZXNdIC0gVGhlIG1hdGVyaWFsIHZhbHVlcyB0byBzZXQuCgkJICovCgkJc2V0VmFsdWVzKCB2YWx1ZXMgKSB7CgoJCQlpZiAoIHZhbHVlcyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCgkJCQljb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1sga2V5IF07CgoJCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5NYXRlcmlhbDogcGFyYW1ldGVyICckeyBrZXkgfScgaGFzIHZhbHVlIG9mIHVuZGVmaW5lZC5gICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRoaXNbIGtleSBdOwoKCQkJCWlmICggY3VycmVudFZhbHVlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk1hdGVyaWFsOiAnJHsga2V5IH0nIGlzIG5vdCBhIHByb3BlcnR5IG9mIFRIUkVFLiR7IHRoaXMudHlwZSB9LmAgKTsKCQkJCQljb250aW51ZTsKCgkJCQl9CgoJCQkJaWYgKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5zZXQoIG5ld1ZhbHVlICk7CgoJCQkJfSBlbHNlIGlmICggKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzVmVjdG9yMyApICYmICggbmV3VmFsdWUgJiYgbmV3VmFsdWUuaXNWZWN0b3IzICkgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXNbIGtleSBdID0gbmV3VmFsdWU7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFNlcmlhbGl6ZXMgdGhlIG1hdGVyaWFsIGludG8gSlNPTi4KCQkgKgoJCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIG1hdGVyaWFsLgoJCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KCQkgKi8KCQl0b0pTT04oIG1ldGEgKSB7CgoJCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJCW1ldGEgPSB7CgkJCQkJdGV4dHVyZXM6IHt9LAoJCQkJCWltYWdlczoge30KCQkJCX07CgoJCQl9CgoJCQljb25zdCBkYXRhID0gewoJCQkJbWV0YWRhdGE6IHsKCQkJCQl2ZXJzaW9uOiA0LjcsCgkJCQkJdHlwZTogJ01hdGVyaWFsJywKCQkJCQlnZW5lcmF0b3I6ICdNYXRlcmlhbC50b0pTT04nCgkJCQl9CgkJCX07CgoJCQkvLyBzdGFuZGFyZCBNYXRlcmlhbCBzZXJpYWxpemF0aW9uCgkJCWRhdGEudXVpZCA9IHRoaXMudXVpZDsKCQkJZGF0YS50eXBlID0gdGhpcy50eXBlOwoKCQkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoKCQkJaWYgKCB0aGlzLmNvbG9yICYmIHRoaXMuY29sb3IuaXNDb2xvciApIGRhdGEuY29sb3IgPSB0aGlzLmNvbG9yLmdldEhleCgpOwoKCQkJaWYgKCB0aGlzLnJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5yb3VnaG5lc3MgPSB0aGlzLnJvdWdobmVzczsKCQkJaWYgKCB0aGlzLm1ldGFsbmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5tZXRhbG5lc3MgPSB0aGlzLm1ldGFsbmVzczsKCgkJCWlmICggdGhpcy5zaGVlbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaGVlbiA9IHRoaXMuc2hlZW47CgkJCWlmICggdGhpcy5zaGVlbkNvbG9yICYmIHRoaXMuc2hlZW5Db2xvci5pc0NvbG9yICkgZGF0YS5zaGVlbkNvbG9yID0gdGhpcy5zaGVlbkNvbG9yLmdldEhleCgpOwoJCQlpZiAoIHRoaXMuc2hlZW5Sb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hlZW5Sb3VnaG5lc3MgPSB0aGlzLnNoZWVuUm91Z2huZXNzOwoJCQlpZiAoIHRoaXMuZW1pc3NpdmUgJiYgdGhpcy5lbWlzc2l2ZS5pc0NvbG9yICkgZGF0YS5lbWlzc2l2ZSA9IHRoaXMuZW1pc3NpdmUuZ2V0SGV4KCk7CgkJCWlmICggdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgIT09IDEgKSBkYXRhLmVtaXNzaXZlSW50ZW5zaXR5ID0gdGhpcy5lbWlzc2l2ZUludGVuc2l0eTsKCgkJCWlmICggdGhpcy5zcGVjdWxhciAmJiB0aGlzLnNwZWN1bGFyLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyID0gdGhpcy5zcGVjdWxhci5nZXRIZXgoKTsKCQkJaWYgKCB0aGlzLnNwZWN1bGFySW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBkYXRhLnNwZWN1bGFySW50ZW5zaXR5ID0gdGhpcy5zcGVjdWxhckludGVuc2l0eTsKCQkJaWYgKCB0aGlzLnNwZWN1bGFyQ29sb3IgJiYgdGhpcy5zcGVjdWxhckNvbG9yLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyQ29sb3IgPSB0aGlzLnNwZWN1bGFyQ29sb3IuZ2V0SGV4KCk7CgkJCWlmICggdGhpcy5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hpbmluZXNzID0gdGhpcy5zaGluaW5lc3M7CgkJCWlmICggdGhpcy5jbGVhcmNvYXQgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0ID0gdGhpcy5jbGVhcmNvYXQ7CgkJCWlmICggdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0Um91Z2huZXNzID0gdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3M7CgoJCQlpZiAoIHRoaXMuY2xlYXJjb2F0TWFwICYmIHRoaXMuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmNsZWFyY29hdE1hcCA9IHRoaXMuY2xlYXJjb2F0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwICYmIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwICYmIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmNsZWFyY29hdE5vcm1hbE1hcCA9IHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLmNsZWFyY29hdE5vcm1hbFNjYWxlID0gdGhpcy5jbGVhcmNvYXROb3JtYWxTY2FsZS50b0FycmF5KCk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuZGlzcGVyc2lvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5kaXNwZXJzaW9uID0gdGhpcy5kaXNwZXJzaW9uOwoKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlID0gdGhpcy5pcmlkZXNjZW5jZTsKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlSU9SICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlSU9SID0gdGhpcy5pcmlkZXNjZW5jZUlPUjsKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZTsKCgkJCWlmICggdGhpcy5pcmlkZXNjZW5jZU1hcCAmJiB0aGlzLmlyaWRlc2NlbmNlTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmlyaWRlc2NlbmNlTWFwID0gdGhpcy5pcmlkZXNjZW5jZU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICYmIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAuaXNUZXh0dXJlICkgewoKCQkJCWRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPSB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuYW5pc290cm9weSAhPT0gdW5kZWZpbmVkICkgZGF0YS5hbmlzb3Ryb3B5ID0gdGhpcy5hbmlzb3Ryb3B5OwoJCQlpZiAoIHRoaXMuYW5pc290cm9weVJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmFuaXNvdHJvcHlSb3RhdGlvbiA9IHRoaXMuYW5pc290cm9weVJvdGF0aW9uOwoKCQkJaWYgKCB0aGlzLmFuaXNvdHJvcHlNYXAgJiYgdGhpcy5hbmlzb3Ryb3B5TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmFuaXNvdHJvcHlNYXAgPSB0aGlzLmFuaXNvdHJvcHlNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCX0KCgkJCWlmICggdGhpcy5tYXAgJiYgdGhpcy5tYXAuaXNUZXh0dXJlICkgZGF0YS5tYXAgPSB0aGlzLm1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMubWF0Y2FwICYmIHRoaXMubWF0Y2FwLmlzVGV4dHVyZSApIGRhdGEubWF0Y2FwID0gdGhpcy5tYXRjYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJaWYgKCB0aGlzLmFscGhhTWFwICYmIHRoaXMuYWxwaGFNYXAuaXNUZXh0dXJlICkgZGF0YS5hbHBoYU1hcCA9IHRoaXMuYWxwaGFNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5saWdodE1hcCAmJiB0aGlzLmxpZ2h0TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmxpZ2h0TWFwID0gdGhpcy5saWdodE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQkJZGF0YS5saWdodE1hcEludGVuc2l0eSA9IHRoaXMubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuYW9NYXAgJiYgdGhpcy5hb01hcC5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS5hb01hcCA9IHRoaXMuYW9NYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJCWRhdGEuYW9NYXBJbnRlbnNpdHkgPSB0aGlzLmFvTWFwSW50ZW5zaXR5OwoKCQkJfQoKCQkJaWYgKCB0aGlzLmJ1bXBNYXAgJiYgdGhpcy5idW1wTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmJ1bXBNYXAgPSB0aGlzLmJ1bXBNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJCWRhdGEuYnVtcFNjYWxlID0gdGhpcy5idW1wU2NhbGU7CgoJCQl9CgoJCQlpZiAoIHRoaXMubm9ybWFsTWFwICYmIHRoaXMubm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLm5vcm1hbE1hcCA9IHRoaXMubm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLm5vcm1hbE1hcFR5cGUgPSB0aGlzLm5vcm1hbE1hcFR5cGU7CgkJCQlkYXRhLm5vcm1hbFNjYWxlID0gdGhpcy5ub3JtYWxTY2FsZS50b0FycmF5KCk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuZGlzcGxhY2VtZW50TWFwICYmIHRoaXMuZGlzcGxhY2VtZW50TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmRpc3BsYWNlbWVudE1hcCA9IHRoaXMuZGlzcGxhY2VtZW50TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLmRpc3BsYWNlbWVudFNjYWxlID0gdGhpcy5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJCWRhdGEuZGlzcGxhY2VtZW50QmlhcyA9IHRoaXMuZGlzcGxhY2VtZW50QmlhczsKCgkJCX0KCgkJCWlmICggdGhpcy5yb3VnaG5lc3NNYXAgJiYgdGhpcy5yb3VnaG5lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS5yb3VnaG5lc3NNYXAgPSB0aGlzLnJvdWdobmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMubWV0YWxuZXNzTWFwICYmIHRoaXMubWV0YWxuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEubWV0YWxuZXNzTWFwID0gdGhpcy5tZXRhbG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5lbWlzc2l2ZU1hcCAmJiB0aGlzLmVtaXNzaXZlTWFwLmlzVGV4dHVyZSApIGRhdGEuZW1pc3NpdmVNYXAgPSB0aGlzLmVtaXNzaXZlTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhck1hcCAmJiB0aGlzLnNwZWN1bGFyTWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJNYXAgPSB0aGlzLnNwZWN1bGFyTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhckludGVuc2l0eU1hcCAmJiB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhckNvbG9yTWFwICYmIHRoaXMuc3BlY3VsYXJDb2xvck1hcC5pc1RleHR1cmUgKSBkYXRhLnNwZWN1bGFyQ29sb3JNYXAgPSB0aGlzLnNwZWN1bGFyQ29sb3JNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5lbnZNYXAgJiYgdGhpcy5lbnZNYXAuaXNUZXh0dXJlICkgewoKCQkJCWRhdGEuZW52TWFwID0gdGhpcy5lbnZNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQlpZiAoIHRoaXMuY29tYmluZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5jb21iaW5lID0gdGhpcy5jb21iaW5lOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmVudk1hcFJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmVudk1hcFJvdGF0aW9uID0gdGhpcy5lbnZNYXBSb3RhdGlvbi50b0FycmF5KCk7CgkJCWlmICggdGhpcy5lbnZNYXBJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuZW52TWFwSW50ZW5zaXR5ID0gdGhpcy5lbnZNYXBJbnRlbnNpdHk7CgkJCWlmICggdGhpcy5yZWZsZWN0aXZpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEucmVmbGVjdGl2aXR5ID0gdGhpcy5yZWZsZWN0aXZpdHk7CgkJCWlmICggdGhpcy5yZWZyYWN0aW9uUmF0aW8gIT09IHVuZGVmaW5lZCApIGRhdGEucmVmcmFjdGlvblJhdGlvID0gdGhpcy5yZWZyYWN0aW9uUmF0aW87CgoJCQlpZiAoIHRoaXMuZ3JhZGllbnRNYXAgJiYgdGhpcy5ncmFkaWVudE1hcC5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS5ncmFkaWVudE1hcCA9IHRoaXMuZ3JhZGllbnRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCX0KCgkJCWlmICggdGhpcy50cmFuc21pc3Npb24gIT09IHVuZGVmaW5lZCApIGRhdGEudHJhbnNtaXNzaW9uID0gdGhpcy50cmFuc21pc3Npb247CgkJCWlmICggdGhpcy50cmFuc21pc3Npb25NYXAgJiYgdGhpcy50cmFuc21pc3Npb25NYXAuaXNUZXh0dXJlICkgZGF0YS50cmFuc21pc3Npb25NYXAgPSB0aGlzLnRyYW5zbWlzc2lvbk1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMudGhpY2tuZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnRoaWNrbmVzcyA9IHRoaXMudGhpY2tuZXNzOwoJCQlpZiAoIHRoaXMudGhpY2tuZXNzTWFwICYmIHRoaXMudGhpY2tuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEudGhpY2tuZXNzTWFwID0gdGhpcy50aGlja25lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJaWYgKCB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgIT09IEluZmluaXR5ICkgZGF0YS5hdHRlbnVhdGlvbkRpc3RhbmNlID0gdGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlOwoJCQlpZiAoIHRoaXMuYXR0ZW51YXRpb25Db2xvciAhPT0gdW5kZWZpbmVkICkgZGF0YS5hdHRlbnVhdGlvbkNvbG9yID0gdGhpcy5hdHRlbnVhdGlvbkNvbG9yLmdldEhleCgpOwoKCQkJaWYgKCB0aGlzLnNpemUgIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZSA9IHRoaXMuc2l6ZTsKCQkJaWYgKCB0aGlzLnNoYWRvd1NpZGUgIT09IG51bGwgKSBkYXRhLnNoYWRvd1NpZGUgPSB0aGlzLnNoYWRvd1NpZGU7CgkJCWlmICggdGhpcy5zaXplQXR0ZW51YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZUF0dGVudWF0aW9uID0gdGhpcy5zaXplQXR0ZW51YXRpb247CgoJCQlpZiAoIHRoaXMuYmxlbmRpbmcgIT09IE5vcm1hbEJsZW5kaW5nICkgZGF0YS5ibGVuZGluZyA9IHRoaXMuYmxlbmRpbmc7CgkJCWlmICggdGhpcy5zaWRlICE9PSBGcm9udFNpZGUgKSBkYXRhLnNpZGUgPSB0aGlzLnNpZGU7CgkJCWlmICggdGhpcy52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgKSBkYXRhLnZlcnRleENvbG9ycyA9IHRydWU7CgoJCQlpZiAoIHRoaXMub3BhY2l0eSA8IDEgKSBkYXRhLm9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7CgkJCWlmICggdGhpcy50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIGRhdGEudHJhbnNwYXJlbnQgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLmJsZW5kU3JjICE9PSBTcmNBbHBoYUZhY3RvciApIGRhdGEuYmxlbmRTcmMgPSB0aGlzLmJsZW5kU3JjOwoJCQlpZiAoIHRoaXMuYmxlbmREc3QgIT09IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgKSBkYXRhLmJsZW5kRHN0ID0gdGhpcy5ibGVuZERzdDsKCQkJaWYgKCB0aGlzLmJsZW5kRXF1YXRpb24gIT09IEFkZEVxdWF0aW9uICkgZGF0YS5ibGVuZEVxdWF0aW9uID0gdGhpcy5ibGVuZEVxdWF0aW9uOwoJCQlpZiAoIHRoaXMuYmxlbmRTcmNBbHBoYSAhPT0gbnVsbCApIGRhdGEuYmxlbmRTcmNBbHBoYSA9IHRoaXMuYmxlbmRTcmNBbHBoYTsKCQkJaWYgKCB0aGlzLmJsZW5kRHN0QWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRHN0QWxwaGEgPSB0aGlzLmJsZW5kRHN0QWxwaGE7CgkJCWlmICggdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRXF1YXRpb25BbHBoYSA9IHRoaXMuYmxlbmRFcXVhdGlvbkFscGhhOwoJCQlpZiAoIHRoaXMuYmxlbmRDb2xvciAmJiB0aGlzLmJsZW5kQ29sb3IuaXNDb2xvciApIGRhdGEuYmxlbmRDb2xvciA9IHRoaXMuYmxlbmRDb2xvci5nZXRIZXgoKTsKCQkJaWYgKCB0aGlzLmJsZW5kQWxwaGEgIT09IDAgKSBkYXRhLmJsZW5kQWxwaGEgPSB0aGlzLmJsZW5kQWxwaGE7CgoJCQlpZiAoIHRoaXMuZGVwdGhGdW5jICE9PSBMZXNzRXF1YWxEZXB0aCApIGRhdGEuZGVwdGhGdW5jID0gdGhpcy5kZXB0aEZ1bmM7CgkJCWlmICggdGhpcy5kZXB0aFRlc3QgPT09IGZhbHNlICkgZGF0YS5kZXB0aFRlc3QgPSB0aGlzLmRlcHRoVGVzdDsKCQkJaWYgKCB0aGlzLmRlcHRoV3JpdGUgPT09IGZhbHNlICkgZGF0YS5kZXB0aFdyaXRlID0gdGhpcy5kZXB0aFdyaXRlOwoJCQlpZiAoIHRoaXMuY29sb3JXcml0ZSA9PT0gZmFsc2UgKSBkYXRhLmNvbG9yV3JpdGUgPSB0aGlzLmNvbG9yV3JpdGU7CgoJCQlpZiAoIHRoaXMuc3RlbmNpbFdyaXRlTWFzayAhPT0gMHhmZiApIGRhdGEuc3RlbmNpbFdyaXRlTWFzayA9IHRoaXMuc3RlbmNpbFdyaXRlTWFzazsKCQkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jICE9PSBBbHdheXNTdGVuY2lsRnVuYyApIGRhdGEuc3RlbmNpbEZ1bmMgPSB0aGlzLnN0ZW5jaWxGdW5jOwoJCQlpZiAoIHRoaXMuc3RlbmNpbFJlZiAhPT0gMCApIGRhdGEuc3RlbmNpbFJlZiA9IHRoaXMuc3RlbmNpbFJlZjsKCQkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jTWFzayAhPT0gMHhmZiApIGRhdGEuc3RlbmNpbEZ1bmNNYXNrID0gdGhpcy5zdGVuY2lsRnVuY01hc2s7CgkJCWlmICggdGhpcy5zdGVuY2lsRmFpbCAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbEZhaWwgPSB0aGlzLnN0ZW5jaWxGYWlsOwoJCQlpZiAoIHRoaXMuc3RlbmNpbFpGYWlsICE9PSBLZWVwU3RlbmNpbE9wICkgZGF0YS5zdGVuY2lsWkZhaWwgPSB0aGlzLnN0ZW5jaWxaRmFpbDsKCQkJaWYgKCB0aGlzLnN0ZW5jaWxaUGFzcyAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbFpQYXNzID0gdGhpcy5zdGVuY2lsWlBhc3M7CgkJCWlmICggdGhpcy5zdGVuY2lsV3JpdGUgPT09IHRydWUgKSBkYXRhLnN0ZW5jaWxXcml0ZSA9IHRoaXMuc3RlbmNpbFdyaXRlOwoKCQkJLy8gcm90YXRpb24gKFNwcml0ZU1hdGVyaWFsKQoJCQlpZiAoIHRoaXMucm90YXRpb24gIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJvdGF0aW9uICE9PSAwICkgZGF0YS5yb3RhdGlvbiA9IHRoaXMucm90YXRpb247CgoJCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldCA9PT0gdHJ1ZSApIGRhdGEucG9seWdvbk9mZnNldCA9IHRydWU7CgkJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yOwoJCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldFVuaXRzICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0VW5pdHMgPSB0aGlzLnBvbHlnb25PZmZzZXRVbml0czsKCgkJCWlmICggdGhpcy5saW5ld2lkdGggIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxpbmV3aWR0aCAhPT0gMSApIGRhdGEubGluZXdpZHRoID0gdGhpcy5saW5ld2lkdGg7CgkJCWlmICggdGhpcy5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5kYXNoU2l6ZSA9IHRoaXMuZGFzaFNpemU7CgkJCWlmICggdGhpcy5nYXBTaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLmdhcFNpemUgPSB0aGlzLmdhcFNpemU7CgkJCWlmICggdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zY2FsZSA9IHRoaXMuc2NhbGU7CgoJCQlpZiAoIHRoaXMuZGl0aGVyaW5nID09PSB0cnVlICkgZGF0YS5kaXRoZXJpbmcgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLmFscGhhVGVzdCA+IDAgKSBkYXRhLmFscGhhVGVzdCA9IHRoaXMuYWxwaGFUZXN0OwoJCQlpZiAoIHRoaXMuYWxwaGFIYXNoID09PSB0cnVlICkgZGF0YS5hbHBoYUhhc2ggPSB0cnVlOwoJCQlpZiAoIHRoaXMuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlICkgZGF0YS5hbHBoYVRvQ292ZXJhZ2UgPSB0cnVlOwoJCQlpZiAoIHRoaXMucHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgZGF0YS5wcmVtdWx0aXBsaWVkQWxwaGEgPSB0cnVlOwoJCQlpZiAoIHRoaXMuZm9yY2VTaW5nbGVQYXNzID09PSB0cnVlICkgZGF0YS5mb3JjZVNpbmdsZVBhc3MgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLndpcmVmcmFtZSA9PT0gdHJ1ZSApIGRhdGEud2lyZWZyYW1lID0gdHJ1ZTsKCQkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA+IDEgKSBkYXRhLndpcmVmcmFtZUxpbmV3aWR0aCA9IHRoaXMud2lyZWZyYW1lTGluZXdpZHRoOwoJCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWNhcCAhPT0gJ3JvdW5kJyApIGRhdGEud2lyZWZyYW1lTGluZWNhcCA9IHRoaXMud2lyZWZyYW1lTGluZWNhcDsKCQkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmVqb2luICE9PSAncm91bmQnICkgZGF0YS53aXJlZnJhbWVMaW5lam9pbiA9IHRoaXMud2lyZWZyYW1lTGluZWpvaW47CgoJCQlpZiAoIHRoaXMuZmxhdFNoYWRpbmcgPT09IHRydWUgKSBkYXRhLmZsYXRTaGFkaW5nID0gdHJ1ZTsKCgkJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIGRhdGEudmlzaWJsZSA9IGZhbHNlOwoKCQkJaWYgKCB0aGlzLnRvbmVNYXBwZWQgPT09IGZhbHNlICkgZGF0YS50b25lTWFwcGVkID0gZmFsc2U7CgoJCQlpZiAoIHRoaXMuZm9nID09PSBmYWxzZSApIGRhdGEuZm9nID0gZmFsc2U7CgoJCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQkJLy8gVE9ETzogQ29waWVkIGZyb20gT2JqZWN0M0QudG9KU09OCgoJCQlmdW5jdGlvbiBleHRyYWN0RnJvbUNhY2hlKCBjYWNoZSApIHsKCgkJCQljb25zdCB2YWx1ZXMgPSBbXTsKCgkJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgoJCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCgkJCX0KCgkJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJCWNvbnN0IHRleHR1cmVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS50ZXh0dXJlcyApOwoJCQkJY29uc3QgaW1hZ2VzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5pbWFnZXMgKTsKCgkJCQlpZiAoIHRleHR1cmVzLmxlbmd0aCA+IDAgKSBkYXRhLnRleHR1cmVzID0gdGV4dHVyZXM7CgkJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgZGF0YS5pbWFnZXMgPSBpbWFnZXM7CgoJCQl9CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IG1hdGVyaWFsIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRlcmlhbH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRlcmlhbCB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtNYXRlcmlhbH0gc291cmNlIC0gVGhlIG1hdGVyaWFsIHRvIGNvcHkuCgkJICogQHJldHVybiB7TWF0ZXJpYWx9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weSggc291cmNlICkgewoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCQl0aGlzLmJsZW5kaW5nID0gc291cmNlLmJsZW5kaW5nOwoJCQl0aGlzLnNpZGUgPSBzb3VyY2Uuc2lkZTsKCQkJdGhpcy52ZXJ0ZXhDb2xvcnMgPSBzb3VyY2UudmVydGV4Q29sb3JzOwoKCQkJdGhpcy5vcGFjaXR5ID0gc291cmNlLm9wYWNpdHk7CgkJCXRoaXMudHJhbnNwYXJlbnQgPSBzb3VyY2UudHJhbnNwYXJlbnQ7CgoJCQl0aGlzLmJsZW5kU3JjID0gc291cmNlLmJsZW5kU3JjOwoJCQl0aGlzLmJsZW5kRHN0ID0gc291cmNlLmJsZW5kRHN0OwoJCQl0aGlzLmJsZW5kRXF1YXRpb24gPSBzb3VyY2UuYmxlbmRFcXVhdGlvbjsKCQkJdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7CgkJCXRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhOwoJCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uQWxwaGE7CgkJCXRoaXMuYmxlbmRDb2xvci5jb3B5KCBzb3VyY2UuYmxlbmRDb2xvciApOwoJCQl0aGlzLmJsZW5kQWxwaGEgPSBzb3VyY2UuYmxlbmRBbHBoYTsKCgkJCXRoaXMuZGVwdGhGdW5jID0gc291cmNlLmRlcHRoRnVuYzsKCQkJdGhpcy5kZXB0aFRlc3QgPSBzb3VyY2UuZGVwdGhUZXN0OwoJCQl0aGlzLmRlcHRoV3JpdGUgPSBzb3VyY2UuZGVwdGhXcml0ZTsKCgkJCXRoaXMuc3RlbmNpbFdyaXRlTWFzayA9IHNvdXJjZS5zdGVuY2lsV3JpdGVNYXNrOwoJCQl0aGlzLnN0ZW5jaWxGdW5jID0gc291cmNlLnN0ZW5jaWxGdW5jOwoJCQl0aGlzLnN0ZW5jaWxSZWYgPSBzb3VyY2Uuc3RlbmNpbFJlZjsKCQkJdGhpcy5zdGVuY2lsRnVuY01hc2sgPSBzb3VyY2Uuc3RlbmNpbEZ1bmNNYXNrOwoJCQl0aGlzLnN0ZW5jaWxGYWlsID0gc291cmNlLnN0ZW5jaWxGYWlsOwoJCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IHNvdXJjZS5zdGVuY2lsWkZhaWw7CgkJCXRoaXMuc3RlbmNpbFpQYXNzID0gc291cmNlLnN0ZW5jaWxaUGFzczsKCQkJdGhpcy5zdGVuY2lsV3JpdGUgPSBzb3VyY2Uuc3RlbmNpbFdyaXRlOwoKCQkJY29uc3Qgc3JjUGxhbmVzID0gc291cmNlLmNsaXBwaW5nUGxhbmVzOwoJCQlsZXQgZHN0UGxhbmVzID0gbnVsbDsKCgkJCWlmICggc3JjUGxhbmVzICE9PSBudWxsICkgewoKCQkJCWNvbnN0IG4gPSBzcmNQbGFuZXMubGVuZ3RoOwoJCQkJZHN0UGxhbmVzID0gbmV3IEFycmF5KCBuICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJCQlkc3RQbGFuZXNbIGkgXSA9IHNyY1BsYW5lc1sgaSBdLmNsb25lKCk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5jbGlwcGluZ1BsYW5lcyA9IGRzdFBsYW5lczsKCQkJdGhpcy5jbGlwSW50ZXJzZWN0aW9uID0gc291cmNlLmNsaXBJbnRlcnNlY3Rpb247CgkJCXRoaXMuY2xpcFNoYWRvd3MgPSBzb3VyY2UuY2xpcFNoYWRvd3M7CgoJCQl0aGlzLnNoYWRvd1NpZGUgPSBzb3VyY2Uuc2hhZG93U2lkZTsKCgkJCXRoaXMuY29sb3JXcml0ZSA9IHNvdXJjZS5jb2xvcldyaXRlOwoKCQkJdGhpcy5wcmVjaXNpb24gPSBzb3VyY2UucHJlY2lzaW9uOwoKCQkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gc291cmNlLnBvbHlnb25PZmZzZXQ7CgkJCXRoaXMucG9seWdvbk9mZnNldEZhY3RvciA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0RmFjdG9yOwoJCQl0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0VW5pdHM7CgoJCQl0aGlzLmRpdGhlcmluZyA9IHNvdXJjZS5kaXRoZXJpbmc7CgoJCQl0aGlzLmFscGhhVGVzdCA9IHNvdXJjZS5hbHBoYVRlc3Q7CgkJCXRoaXMuYWxwaGFIYXNoID0gc291cmNlLmFscGhhSGFzaDsKCQkJdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBzb3VyY2UuYWxwaGFUb0NvdmVyYWdlOwoJCQl0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBsaWVkQWxwaGE7CgkJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gc291cmNlLmZvcmNlU2luZ2xlUGFzczsKCgkJCXRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwoKCQkJdGhpcy50b25lTWFwcGVkID0gc291cmNlLnRvbmVNYXBwZWQ7CgoJCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBGcmVlcyB0aGUgR1BVLXJlbGF0ZWQgcmVzb3VyY2VzIGFsbG9jYXRlZCBieSB0aGlzIGluc3RhbmNlLiBDYWxsIHRoaXMKCQkgKiBtZXRob2Qgd2hlbmV2ZXIgdGhpcyBpbnN0YW5jZSBpcyBubyBsb25nZXIgdXNlZCBpbiB5b3VyIGFwcC4KCQkgKgoJCSAqIEBmaXJlcyBNYXRlcmlhbCNkaXNwb3NlCgkJICovCgkJZGlzcG9zZSgpIHsKCgkJCS8qKgoJCQkgKiBGaXJlcyB3aGVuIHRoZSBtYXRlcmlhbCBoYXMgYmVlbiBkaXNwb3NlZCBvZi4KCQkJICoKCQkJICogQGV2ZW50IE1hdGVyaWFsI2Rpc3Bvc2UKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHRpbmcgdGhpcyBwcm9wZXJ0eSB0byBgdHJ1ZWAgaW5kaWNhdGVzIHRoZSBlbmdpbmUgdGhlIG1hdGVyaWFsCgkJICogbmVlZHMgdG8gYmUgcmVjb21waWxlZC4KCQkgKgoJCSAqIEB0eXBlIHtib29sZWFufQoJCSAqIEBkZWZhdWx0IGZhbHNlCgkJICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQoJCSAqLwoJCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJfQoKCS8qKgoJICogQSBtYXRlcmlhbCBmb3IgZHJhd2luZyBnZW9tZXRyaWVzIGluIGEgc2ltcGxlIHNoYWRlZCAoZmxhdCBvciB3aXJlZnJhbWUpIHdheS4KCSAqCgkgKiBUaGlzIG1hdGVyaWFsIGlzIG5vdCBhZmZlY3RlZCBieSBsaWdodHMuCgkgKgoJICogQGF1Z21lbnRzIE1hdGVyaWFsCgkgKi8KCWNsYXNzIE1lc2hCYXNpY01hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2ggYmFzaWMgbWF0ZXJpYWwuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0gW3BhcmFtZXRlcnNdIC0gQW4gb2JqZWN0IHdpdGggb25lIG9yIG1vcmUgcHJvcGVydGllcwoJCSAqIGRlZmluaW5nIHRoZSBtYXRlcmlhbCdzIGFwcGVhcmFuY2UuIEFueSBwcm9wZXJ0eSBvZiB0aGUgbWF0ZXJpYWwKCQkgKiAoaW5jbHVkaW5nIGFueSBwcm9wZXJ0eSBmcm9tIGluaGVyaXRlZCBtYXRlcmlhbHMpIGNhbiBiZSBwYXNzZWQKCQkgKiBpbiBoZXJlLiBDb2xvciB2YWx1ZXMgY2FuIGJlIHBhc3NlZCBhbnkgdHlwZSBvZiB2YWx1ZSBhY2NlcHRlZAoJCSAqIGJ5IHtAbGluayBDb2xvciNzZXR9LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzTWVzaEJhc2ljTWF0ZXJpYWwgPSB0cnVlOwoKCQkJdGhpcy50eXBlID0gJ01lc2hCYXNpY01hdGVyaWFsJzsKCgkJCS8qKgoJCQkgKiBDb2xvciBvZiB0aGUgbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEB0eXBlIHtDb2xvcn0KCQkJICogQGRlZmF1bHQgKDEsMSwxKQoJCQkgKi8KCQkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZW1pc3NpdmUKCgkJCS8qKgoJCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAoJCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uIFRoZSB0ZXh0dXJlIG1hcAoJCQkgKiBjb2xvciBpcyBtb2R1bGF0ZWQgYnkgdGhlIGRpZmZ1c2UgYGNvbG9yYC4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLm1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGxpZ2h0IG1hcC4gUmVxdWlyZXMgYSBzZWNvbmQgc2V0IG9mIFVWcy4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBJbnRlbnNpdHkgb2YgdGhlIGJha2VkIGxpZ2h0LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQkJLyoqCgkJCSAqIFRoZSByZWQgY2hhbm5lbCBvZiB0aGlzIHRleHR1cmUgaXMgdXNlZCBhcyB0aGUgYW1iaWVudCBvY2NsdXNpb24gbWFwLgoJCQkgKiBSZXF1aXJlcyBhIHNlY29uZCBzZXQgb2YgVVZzLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYW9NYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEludGVuc2l0eSBvZiB0aGUgYW1iaWVudCBvY2NsdXNpb24gZWZmZWN0LiBSYW5nZSBpcyBgWzAsMV1gLCB3aGVyZSBgMGAKCQkJICogZGlzYWJsZXMgYW1iaWVudCBvY2NsdXNpb24uIFdoZXJlIGludGVuc2l0eSBpcyBgMWAgYW5kIHRoZSBBTyBtYXAncwoJCQkgKiByZWQgY2hhbm5lbCBpcyBhbHNvIGAxYCwgYW1iaWVudCBsaWdodCBpcyBmdWxseSBvY2NsdWRlZCBvbiBhIHN1cmZhY2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSAxLjA7CgoJCQkvKioKCQkJICogU3BlY3VsYXIgbWFwIHVzZWQgYnkgdGhlIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKCQkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KCQkJICoKCQkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCgkJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCgkJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKCQkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAoJCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGVudmlyb25tZW50IG1hcC4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmVudk1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBlbnZpcm9ubWVudCBtYXAgaW4gcmFkaWFucy4KCQkJICoKCQkJICogQHR5cGUge0V1bGVyfQoJCQkgKiBAZGVmYXVsdCAoMCwwLDApCgkJCSAqLwoJCQl0aGlzLmVudk1hcFJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CgoJCQkvKioKCQkJICogSG93IHRvIGNvbWJpbmUgdGhlIHJlc3VsdCBvZiB0aGUgc3VyZmFjZSdzIGNvbG9yIHdpdGggdGhlIGVudmlyb25tZW50IG1hcCwgaWYgYW55LgoJCQkgKgoJCQkgKiBXaGVuIHNldCB0byBgTWl4T3BlcmF0aW9uYCwgdGhlIHtAbGluayBNZXNoQmFzaWNNYXRlcmlhbCNyZWZsZWN0aXZpdHl9IGlzIHVzZWQgdG8KCQkJICogYmxlbmQgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycy4KCQkJICoKCQkJICogQHR5cGUgeyhNdWx0aXBseU9wZXJhdGlvbnxNaXhPcGVyYXRpb258QWRkT3BlcmF0aW9uKX0KCQkJICogQGRlZmF1bHQgTXVsdGlwbHlPcGVyYXRpb24KCQkJICovCgkJCXRoaXMuY29tYmluZSA9IE11bHRpcGx5T3BlcmF0aW9uOwoKCQkJLyoqCgkJCSAqIEhvdyBtdWNoIHRoZSBlbnZpcm9ubWVudCBtYXAgYWZmZWN0cyB0aGUgc3VyZmFjZS4KCQkJICogVGhlIHZhbGlkIHJhbmdlIGlzIGJldHdlZW4gYDBgIChubyByZWZsZWN0aW9ucykgYW5kIGAxYCAoZnVsbCByZWZsZWN0aW9ucykuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMucmVmbGVjdGl2aXR5ID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgaW5kZXggb2YgcmVmcmFjdGlvbiAoSU9SKSBvZiBhaXIgKGFwcHJveGltYXRlbHkgMSkgZGl2aWRlZCBieSB0aGUKCQkJICogaW5kZXggb2YgcmVmcmFjdGlvbiBvZiB0aGUgbWF0ZXJpYWwuIEl0IGlzIHVzZWQgd2l0aCBlbnZpcm9ubWVudCBtYXBwaW5nCgkJCSAqIG1vZGVzIHtAbGluayBDdWJlUmVmcmFjdGlvbk1hcHBpbmd9IGFuZCB7QGxpbmsgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmd9LgoJCQkgKiBUaGUgcmVmcmFjdGlvbiByYXRpbyBzaG91bGQgbm90IGV4Y2VlZCBgMWAuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAuOTgKCQkJICovCgkJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCgkJCS8qKgoJCQkgKiBSZW5kZXJzIHRoZSBnZW9tZXRyeSBhcyBhIHdpcmVmcmFtZS4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIENvbnRyb2xzIHRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZS4KCQkJICoKCQkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIGFwcGVhcmFuY2Ugb2Ygd2lyZWZyYW1lIGVuZHMuCgkJCSAqCgkJCSAqIENhbiBvbmx5IGJlIHVzZWQgd2l0aCB7QGxpbmsgU1ZHUmVuZGVyZXJ9LgoJCQkgKgoJCQkgKiBAdHlwZSB7KCdyb3VuZCd8J2JldmVsJ3wnbWl0ZXInKX0KCQkJICogQGRlZmF1bHQgJ3JvdW5kJwoJCQkgKi8KCQkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIGFwcGVhcmFuY2Ugb2Ygd2lyZWZyYW1lIGpvaW50cy4KCQkJICoKCQkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHsoJ3JvdW5kJ3wnYmV2ZWwnfCdtaXRlcicpfQoJCQkgKiBAZGVmYXVsdCAncm91bmQnCgkJCSAqLwoJCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRoZSBtYXRlcmlhbCBpcyBhZmZlY3RlZCBieSBmb2cgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5mb2cgPSB0cnVlOwoKCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwoJCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQkJdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKCQkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCgkJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCQl0aGlzLmVudk1hcFJvdGF0aW9uLmNvcHkoIHNvdXJjZS5lbnZNYXBSb3RhdGlvbiApOwoJCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQkJdGhpcy5yZWZsZWN0aXZpdHkgPSBzb3VyY2UucmVmbGVjdGl2aXR5OwoJCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CgoJCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCQkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CgkJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgljb25zdCBfdmVjdG9yJDkgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdmVjdG9yMiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKCWxldCBfaWQkMiA9IDA7CgoJLyoqCgkgKiBUaGlzIGNsYXNzIHN0b3JlcyBkYXRhIGZvciBhbiBhdHRyaWJ1dGUgKHN1Y2ggYXMgdmVydGV4IHBvc2l0aW9ucywgZmFjZQoJICogaW5kaWNlcywgbm9ybWFscywgY29sb3JzLCBVVnMsIGFuZCBhbnkgY3VzdG9tIGF0dHJpYnV0ZXMgKSBhc3NvY2lhdGVkIHdpdGgKCSAqIGEgZ2VvbWV0cnksIHdoaWNoIGFsbG93cyBmb3IgbW9yZSBlZmZpY2llbnQgcGFzc2luZyBvZiBkYXRhIHRvIHRoZSBHUFUuCgkgKgoJICogV2hlbiB3b3JraW5nIHdpdGggdmVjdG9yLWxpa2UgZGF0YSwgdGhlIGBmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4IClgCgkgKiBoZWxwZXIgbWV0aG9kcyBvbiB2ZWN0b3IgYW5kIGNvbG9yIGNsYXNzIG1pZ2h0IGJlIGhlbHBmdWwuIEUuZy4ge0BsaW5rIFZlY3RvcjMjZnJvbUJ1ZmZlckF0dHJpYnV0ZX0uCgkgKi8KCWNsYXNzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgPSBmYWxzZSApIHsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggYXJyYXkgKSApIHsKCgkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4nICk7CgoJCQl9CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0J1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIElEIG9mIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCQkgKgoJCQkgKiBAbmFtZSBCdWZmZXJBdHRyaWJ1dGUjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQyICsrIH0gKTsKCgkJCS8qKgoJCQkgKiBUaGUgbmFtZSBvZiB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMubmFtZSA9ICcnOwoKCQkJLyoqCgkJCSAqIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4gSXQgc2hvdWxkIGhhdmUgYGl0ZW1TaXplICogbnVtVmVydGljZXNgCgkJCSAqIGVsZW1lbnRzLCB3aGVyZSBgbnVtVmVydGljZXNgIGlzIHRoZSBudW1iZXIgb2YgdmVydGljZXMgaW4gdGhlIGFzc29jaWF0ZWQgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtUeXBlZEFycmF5fQoJCQkgKi8KCQkJdGhpcy5hcnJheSA9IGFycmF5OwoKCQkJLyoqCgkJCSAqIFRoZSBudW1iZXIgb2YgdmFsdWVzIG9mIHRoZSBhcnJheSB0aGF0IHNob3VsZCBiZSBhc3NvY2lhdGVkIHdpdGggYSBwYXJ0aWN1bGFyIHZlcnRleC4KCQkJICogRm9yIGluc3RhbmNlLCBpZiB0aGlzIGF0dHJpYnV0ZSBpcyBzdG9yaW5nIGEgMy1jb21wb25lbnQgdmVjdG9yIChzdWNoIGFzIGEgcG9zaXRpb24sCgkJCSAqIG5vcm1hbCwgb3IgY29sb3IpLCB0aGVuIHRoZSB2YWx1ZSBzaG91bGQgYmUgYDNgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIG51bWJlciBvZiBpdGVtcyB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUgc3RvcmVzLiBJdCBpcyBpbnRlcm5hbGx5IGNvbXB1dGVkCgkJCSAqIGJ5IGRpdmlkaW5nIHRoZSBgYXJyYXlgIGxlbmd0aCBieSB0aGUgYGl0ZW1TaXplYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLmNvdW50ID0gYXJyYXkgIT09IHVuZGVmaW5lZCA/IGFycmF5Lmxlbmd0aCAvIGl0ZW1TaXplIDogMDsKCgkJCS8qKgoJCQkgKiBBcHBsaWVzIHRvIGludGVnZXIgZGF0YSBvbmx5LiBJbmRpY2F0ZXMgaG93IHRoZSB1bmRlcmx5aW5nIGRhdGEgaW4gdGhlIGJ1ZmZlciBtYXBzIHRvCgkJCSAqIHRoZSB2YWx1ZXMgaW4gdGhlIEdMU0wgY29kZS4gRm9yIGluc3RhbmNlLCBpZiBgYXJyYXlgIGlzIGFuIGluc3RhbmNlIG9mIGBVSW50MTZBcnJheWAsCgkJCSAqIGFuZCBgbm9ybWFsaXplZGAgaXMgYHRydWVgLCB0aGUgdmFsdWVzIGAwIC0gKzY1NTM1YCBpbiB0aGUgYXJyYXkgZGF0YSB3aWxsIGJlIG1hcHBlZCB0bwoJCQkgKiBgMC4wZiAtICsxLjBmYCBpbiB0aGUgR0xTTCBhdHRyaWJ1dGUuIElmIGBub3JtYWxpemVkYCBpcyBgZmFsc2VgLCB0aGUgdmFsdWVzIHdpbGwgYmUgY29udmVydGVkCgkJCSAqIHRvIGZsb2F0cyB1bm1vZGlmaWVkLCBpLmUuIGA2NTUzNWAgYmVjb21lcyBgNjU1MzUuMGZgLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICovCgkJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQ7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgaW50ZW5kZWQgdXNhZ2UgcGF0dGVybiBvZiB0aGUgZGF0YSBzdG9yZSBmb3Igb3B0aW1pemF0aW9uIHB1cnBvc2VzLgoJCQkgKgoJCQkgKiBOb3RlOiBBZnRlciB0aGUgaW5pdGlhbCB1c2Ugb2YgYSBidWZmZXIsIGl0cyB1c2FnZSBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwKCQkJICogaW5zdGFudGlhdGUgYSBuZXcgb25lIGFuZCBzZXQgdGhlIGRlc2lyZWQgdXNhZ2UgYmVmb3JlIHRoZSBuZXh0IHJlbmRlci4KCQkJICoKCQkJICogQHR5cGUgeyhTdGF0aWNEcmF3VXNhZ2V8RHluYW1pY0RyYXdVc2FnZXxTdHJlYW1EcmF3VXNhZ2V8U3RhdGljUmVhZFVzYWdlfER5bmFtaWNSZWFkVXNhZ2V8U3RyZWFtUmVhZFVzYWdlfFN0YXRpY0NvcHlVc2FnZXxEeW5hbWljQ29weVVzYWdlfFN0cmVhbUNvcHlVc2FnZSl9CgkJCSAqIEBkZWZhdWx0IFN0YXRpY0RyYXdVc2FnZQoJCQkgKi8KCQkJdGhpcy51c2FnZSA9IFN0YXRpY0RyYXdVc2FnZTsKCgkJCS8qKgoJCQkgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIG9ubHkgdXBkYXRlIHNvbWUgY29tcG9uZW50cyBvZiBzdG9yZWQgdmVjdG9ycyAoZm9yIGV4YW1wbGUsIGp1c3QgdGhlCgkJCSAqIGNvbXBvbmVudCByZWxhdGVkIHRvIGNvbG9yKS4gVXNlIHRoZSBgYWRkVXBkYXRlUmFuZ2UoKWAgZnVuY3Rpb24gdG8gYWRkIHJhbmdlcyB0byB0aGlzIGFycmF5LgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0Pn0KCQkJICovCgkJCXRoaXMudXBkYXRlUmFuZ2VzID0gW107CgoJCQkvKioKCQkJICogQ29uZmlndXJlcyB0aGUgYm91bmQgR1BVIHR5cGUgZm9yIHVzZSBpbiBzaGFkZXJzLgoJCQkgKgoJCQkgKiBOb3RlOiB0aGlzIG9ubHkgaGFzIGFuIGVmZmVjdCBmb3IgaW50ZWdlciBhcnJheXMgYW5kIGlzIG5vdCBjb25maWd1cmFibGUgZm9yIGZsb2F0IGFycmF5cy4KCQkJICogRm9yIGxvd2VyIHByZWNpc2lvbiBmbG9hdCB0eXBlcywgdXNlIGBGbG9hdDE2QnVmZmVyQXR0cmlidXRlYC4KCQkJICoKCQkJICogQHR5cGUgeyhGbG9hdFR5cGV8SW50VHlwZSl9CgkJCSAqIEBkZWZhdWx0IEZsb2F0VHlwZQoJCQkgKi8KCQkJdGhpcy5ncHVUeXBlID0gRmxvYXRUeXBlOwoKCQkJLyoqCgkJCSAqIEEgdmVyc2lvbiBudW1iZXIsIGluY3JlbWVudGVkIGV2ZXJ5IHRpbWUgdGhlIGBuZWVkc1VwZGF0ZWAgaXMgc2V0IHRvIGB0cnVlYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMudmVyc2lvbiA9IDA7CgoJCX0KCgkJLyoqCgkJICogQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIGFmdGVyIHRoZSByZW5kZXJlciBoYXMgdHJhbnNmZXJyZWQgdGhlIGF0dHJpYnV0ZQoJCSAqIGFycmF5IGRhdGEgdG8gdGhlIEdQVS4KCQkgKi8KCQlvblVwbG9hZENhbGxiYWNrKCkge30KCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoaXMgYXR0cmlidXRlIGhhcyBjaGFuZ2VkIGFuZCBzaG91bGQgYmUgcmUtc2VudCB0bwoJCSAqIHRoZSBHUFUuIFNldCB0aGlzIHRvIGB0cnVlYCB3aGVuIHlvdSBtb2RpZnkgdGhlIHZhbHVlIG9mIHRoZSBhcnJheS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgZmFsc2UKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCgkJICovCgkJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdXNhZ2Ugb2YgdGhpcyBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHsoU3RhdGljRHJhd1VzYWdlfER5bmFtaWNEcmF3VXNhZ2V8U3RyZWFtRHJhd1VzYWdlfFN0YXRpY1JlYWRVc2FnZXxEeW5hbWljUmVhZFVzYWdlfFN0cmVhbVJlYWRVc2FnZXxTdGF0aWNDb3B5VXNhZ2V8RHluYW1pY0NvcHlVc2FnZXxTdHJlYW1Db3B5VXNhZ2UpfSB2YWx1ZSAtIFRoZSB1c2FnZSB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICovCgkJc2V0VXNhZ2UoIHZhbHVlICkgewoKCQkJdGhpcy51c2FnZSA9IHZhbHVlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyBhIHJhbmdlIG9mIGRhdGEgaW4gdGhlIGRhdGEgYXJyYXkgdG8gYmUgdXBkYXRlZCBvbiB0aGUgR1BVLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gUG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgdXBkYXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIFRoZSBudW1iZXIgb2YgY29tcG9uZW50cyB0byB1cGRhdGUuCgkJICovCgkJYWRkVXBkYXRlUmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCgkJfQoKCQkvKioKCQkgKiBDbGVhcnMgdGhlIHVwZGF0ZSByYW5nZXMuCgkJICovCgkJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgoJCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gc291cmNlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weSggc291cmNlICkgewoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgkJCXRoaXMuYXJyYXkgPSBuZXcgc291cmNlLmFycmF5LmNvbnN0cnVjdG9yKCBzb3VyY2UuYXJyYXkgKTsKCQkJdGhpcy5pdGVtU2l6ZSA9IHNvdXJjZS5pdGVtU2l6ZTsKCQkJdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKCQkJdGhpcy5ub3JtYWxpemVkID0gc291cmNlLm5vcm1hbGl6ZWQ7CgoJCQl0aGlzLnVzYWdlID0gc291cmNlLnVzYWdlOwoJCQl0aGlzLmdwdVR5cGUgPSBzb3VyY2UuZ3B1VHlwZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyBhIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlIHRvIHRoaXMgb25lLiBUaGUgc3RhcnQKCQkgKiBhbmQgZGVzdGluYXRpb24gcG9zaXRpb24gaW4gdGhlIGF0dHJpYnV0ZSBidWZmZXJzIGFyZSByZXByZXNlbnRlZCBieSB0aGUKCQkgKiBnaXZlbiBpbmRpY2VzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4MSAtIFRoZSBkZXN0aW5hdGlvbiBpbmRleCBpbnRvIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gY29weSBmcm9tLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleDIgLSBUaGUgc291cmNlIGluZGV4IGludG8gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNvcHlBdCggaW5kZXgxLCBhdHRyaWJ1dGUsIGluZGV4MiApIHsKCgkJCWluZGV4MSAqPSB0aGlzLml0ZW1TaXplOwoJCQlpbmRleDIgKj0gYXR0cmlidXRlLml0ZW1TaXplOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5pdGVtU2l6ZTsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdGhpcy5hcnJheVsgaW5kZXgxICsgaSBdID0gYXR0cmlidXRlLmFycmF5WyBpbmRleDIgKyBpIF07CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIGdpdmVuIGFycmF5IGRhdGEgaW50byB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhUeXBlZEFycmF5fEFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weUFycmF5KCBhcnJheSApIHsKCgkJCXRoaXMuYXJyYXkuc2V0KCBhcnJheSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gM3gzIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBXb3JrcyB3aXRoCgkJICogaXRlbSBzaXplIGAyYCBhbmQgYDNgLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYXBwbHlNYXRyaXgzKCBtICkgewoKCQkJaWYgKCB0aGlzLml0ZW1TaXplID09PSAyICkgewoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQlfdmVjdG9yMiQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCQkJCQlfdmVjdG9yMiQxLmFwcGx5TWF0cml4MyggbSApOwoKCQkJCQl0aGlzLnNldFhZKCBpLCBfdmVjdG9yMiQxLngsIF92ZWN0b3IyJDEueSApOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRoaXMuaXRlbVNpemUgPT09IDMgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgkJCQkJX3ZlY3RvciQ5LmFwcGx5TWF0cml4MyggbSApOwoKCQkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgdGhlIGdpdmVuIDR4NCBtYXRyaXggdG8gdGhlIGdpdmVuIGF0dHJpYnV0ZS4gT25seSB3b3JrcyB3aXRoCgkJICogaXRlbSBzaXplIGAzYC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbSApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgoJCQkJX3ZlY3RvciQ5LmFwcGx5TWF0cml4NCggbSApOwoKCQkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBcHBsaWVzIHRoZSBnaXZlbiAzeDMgbm9ybWFsIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKCQkgKiBpdGVtIHNpemUgYDNgLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG5vcm1hbCBtYXRyaXggdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCQlfdmVjdG9yJDkuYXBwbHlOb3JtYWxNYXRyaXgoIG0gKTsKCgkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKCQkgKiBpdGVtIHNpemUgYDNgIGFuZCB3aXRoIGRpcmVjdGlvbiB2ZWN0b3JzLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNmb3JtRGlyZWN0aW9uKCBtICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCQlfdmVjdG9yJDkudHJhbnNmb3JtRGlyZWN0aW9uKCBtICk7CgoJCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkOS54LCBfdmVjdG9yJDkueSwgX3ZlY3RvciQ5LnogKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGFycmF5IGRhdGEgaW4gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhUeXBlZEFycmF5fEFycmF5KX0gdmFsdWUgLSBUaGUgYXJyYXkgZGF0YSB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBUaGUgb2Zmc2V0IGluIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZSdzIGFycmF5LgoJCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXQoIHZhbHVlLCBvZmZzZXQgPSAwICkgewoKCQkJLy8gTWF0Y2hpbmcgQnVmZmVyQXR0cmlidXRlIGNvbnN0cnVjdG9yLCBkbyBub3Qgbm9ybWFsaXplIHRoZSBhcnJheS4KCQkJdGhpcy5hcnJheS5zZXQoIHZhbHVlLCBvZmZzZXQgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGdpdmVuIGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb21wb25lbnQgLSBUaGUgY29tcG9uZW50IGluZGV4LgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJldHVybmVkIHZhbHVlLgoJCSAqLwoJCWdldENvbXBvbmVudCggaW5kZXgsIGNvbXBvbmVudCApIHsKCgkJCWxldCB2YWx1ZSA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdOwoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IGRlbm9ybWFsaXplKCB2YWx1ZSwgdGhpcy5hcnJheSApOwoKCQkJcmV0dXJuIHZhbHVlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBnaXZlbiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gY29tcG9uZW50IC0gVGhlIGNvbXBvbmVudCBpbmRleC4KCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXRDb21wb25lbnQoIGluZGV4LCBjb21wb25lbnQsIHZhbHVlICkgewoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IG5vcm1hbGl6ZSggdmFsdWUsIHRoaXMuYXJyYXkgKTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdID0gdmFsdWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSB4IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHggY29tcG9uZW50LgoJCSAqLwoJCWdldFgoIGluZGV4ICkgewoKCQkJbGV0IHggPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgXTsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeCA9IGRlbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgoJCQlyZXR1cm4geDsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB4IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0WCggaW5kZXgsIHggKSB7CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSBdID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgeSBjb21wb25lbnQuCgkJICovCgkJZ2V0WSggaW5kZXggKSB7CgoJCQlsZXQgeSA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXTsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IGRlbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCQlyZXR1cm4geTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0WSggaW5kZXgsIHkgKSB7CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSB6IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHogY29tcG9uZW50LgoJCSAqLwoJCWdldFooIGluZGV4ICkgewoKCQkJbGV0IHogPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF07CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBkZW5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQkJcmV0dXJuIHo7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFooIGluZGV4LCB6ICkgewoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF0gPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgdyBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB3IGNvbXBvbmVudC4KCQkgKi8KCQlnZXRXKCBpbmRleCApIHsKCgkJCWxldCB3ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdOwoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB3ID0gZGVub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJCXJldHVybiB3OwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHcgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXRXKCBpbmRleCwgdyApIHsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHggYW5kIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFhZKCBpbmRleCwgeCwgeSApIHsKCgkJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCQl5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCQl9CgoJCQl0aGlzLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHgsIHkgYW5kIHogY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgZm9yIHRoZSB6IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFhZWiggaW5kZXgsIHgsIHksIHogKSB7CgoJCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQkJeCA9IG5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoJCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoJCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQkJfQoKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMiBdID0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHgsIHksIHogYW5kIHcgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgZm9yIHRoZSB6IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgZm9yIHRoZSB3IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFhZWlcoIGluZGV4LCB4LCB5LCB6LCB3ICkgewoKCQkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgewoKCQkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJCXogPSBub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCQkJCXcgPSBub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJCX0KCgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMyBdID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgYWZ0ZXIgdGhlIFJlbmRlcmVyIGhhcyB0cmFuc2ZlcnJlZAoJCSAqIHRoZSBhdHRyaWJ1dGUgYXJyYXkgZGF0YSB0byB0aGUgR1BVLiBDYW4gYmUgdXNlZCB0byBwZXJmb3JtIGNsZWFuLXVwIG9wZXJhdGlvbnMgYWZ0ZXIKCQkgKiB0aGUgdXBsb2FkIHdoZW4gYXR0cmlidXRlIGRhdGEgYXJlIG5vdCBuZWVkZWQgYW55bW9yZSBvbiB0aGUgQ1BVIHNpZGUuCgkJICoKCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIFRoZSBgb25VcGxvYWQoKWAgY2FsbGJhY2suCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCW9uVXBsb2FkKCBjYWxsYmFjayApIHsKCgkJCXRoaXMub25VcGxvYWRDYWxsYmFjayA9IGNhbGxiYWNrOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBidWZmZXIgYXR0cmlidXRlIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5hcnJheSwgdGhpcy5pdGVtU2l6ZSApLmNvcHkoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXJpYWxpemVzIHRoZSBidWZmZXIgYXR0cmlidXRlIGludG8gSlNPTi4KCQkgKgoJCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKi8KCQl0b0pTT04oKSB7CgoJCQljb25zdCBkYXRhID0gewoJCQkJaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCgkJCQl0eXBlOiB0aGlzLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQlhcnJheTogQXJyYXkuZnJvbSggdGhpcy5hcnJheSApLAoJCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCgkJCX07CgoJCQlpZiAoIHRoaXMubmFtZSAhPT0gJycgKSBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CgkJCWlmICggdGhpcy51c2FnZSAhPT0gU3RhdGljRHJhd1VzYWdlICkgZGF0YS51c2FnZSA9IHRoaXMudXNhZ2U7CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0KCgkvKioKCSAqIENvbnZlbmllbnQgY2xhc3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIGEgYFVJbnQxNmAgYnVmZmVyIGF0dHJpYnV0ZSB3aXRoCgkgKiBhIHBsYWluIGBBcnJheWAgaW5zdGFuY2UuCgkgKgoJICogQGF1Z21lbnRzIEJ1ZmZlckF0dHJpYnV0ZQoJICovCgljbGFzcyBVaW50MTZCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fFVpbnQxNkFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCQlzdXBlciggbmV3IFVpbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl9CgoJfQoKCS8qKgoJICogQ29udmVuaWVudCBjbGFzcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgYSBgVUludDMyYCBidWZmZXIgYXR0cmlidXRlIHdpdGgKCSAqIGEgcGxhaW4gYEFycmF5YCBpbnN0YW5jZS4KCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyQXR0cmlidXRlCgkgKi8KCWNsYXNzIFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7KEFycmF5PG51bWJlcj58VWludDMyQXJyYXkpfSBhcnJheSAtIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaXRlbVNpemUgLSBUaGUgaXRlbSBzaXplLgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW25vcm1hbGl6ZWQ9ZmFsc2VdIC0gV2hldGhlciB0aGUgZGF0YSBhcmUgbm9ybWFsaXplZCBvciBub3QuCgkJICovCgkJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJCXN1cGVyKCBuZXcgVWludDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBDb252ZW5pZW50IGNsYXNzIHRoYXQgY2FuIGJlIHVzZWQgd2hlbiBjcmVhdGluZyBhIGBGbG9hdDMyYCBidWZmZXIgYXR0cmlidXRlIHdpdGgKCSAqIGEgcGxhaW4gYEFycmF5YCBpbnN0YW5jZS4KCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyQXR0cmlidXRlCgkgKi8KCWNsYXNzIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fEZsb2F0MzJBcnJheSl9IGFycmF5IC0gVGhlIGFycmF5IGhvbGRpbmcgdGhlIGF0dHJpYnV0ZSBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpdGVtU2l6ZSAtIFRoZSBpdGVtIHNpemUuCgkJICogQHBhcmFtIHtib29sZWFufSBbbm9ybWFsaXplZD1mYWxzZV0gLSBXaGV0aGVyIHRoZSBkYXRhIGFyZSBub3JtYWxpemVkIG9yIG5vdC4KCQkgKi8KCQljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQkJc3VwZXIoIG5ldyBGbG9hdDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCX0KCgl9CgoJbGV0IF9pZCQxID0gMDsKCgljb25zdCBfbTEkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IF9vYmogPSAvKkBfX1BVUkVfXyovIG5ldyBPYmplY3QzRCgpOwoJY29uc3QgX29mZnNldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9ib3gkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKCWNvbnN0IF9ib3hNb3JwaFRhcmdldHMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7Cgljb25zdCBfdmVjdG9yJDggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJLyoqCgkgKiBBIHJlcHJlc2VudGF0aW9uIG9mIG1lc2gsIGxpbmUsIG9yIHBvaW50IGdlb21ldHJ5LiBJbmNsdWRlcyB2ZXJ0ZXgKCSAqIHBvc2l0aW9ucywgZmFjZSBpbmRpY2VzLCBub3JtYWxzLCBjb2xvcnMsIFVWcywgYW5kIGN1c3RvbSBhdHRyaWJ1dGVzCgkgKiB3aXRoaW4gYnVmZmVycywgcmVkdWNpbmcgdGhlIGNvc3Qgb2YgcGFzc2luZyBhbGwgdGhpcyBkYXRhIHRvIHRoZSBHUFUuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CgkgKiAvLyBjcmVhdGUgYSBzaW1wbGUgc3F1YXJlIHNoYXBlLiBXZSBkdXBsaWNhdGUgdGhlIHRvcCBsZWZ0IGFuZCBib3R0b20gcmlnaHQKCSAqIC8vIHZlcnRpY2VzIGJlY2F1c2UgZWFjaCB2ZXJ0ZXggbmVlZHMgdG8gYXBwZWFyIG9uY2UgcGVyIHRyaWFuZ2xlLgoJICogY29uc3QgdmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KCBbCgkgKiAJLTEuMCwgLTEuMCwgIDEuMCwgLy8gdjAKCSAqIAkgMS4wLCAtMS4wLCAgMS4wLCAvLyB2MQoJICogCSAxLjAsICAxLjAsICAxLjAsIC8vIHYyCgkgKgoJICogCSAxLjAsICAxLjAsICAxLjAsIC8vIHYzCgkgKiAJLTEuMCwgIDEuMCwgIDEuMCwgLy8gdjQKCSAqIAktMS4wLCAtMS4wLCAgMS4wICAvLyB2NQoJICogXSApOwoJICogLy8gaXRlbVNpemUgPSAzIGJlY2F1c2UgdGhlcmUgYXJlIDMgdmFsdWVzIChjb21wb25lbnRzKSBwZXIgdmVydGV4CgkgKiBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCSAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmMDAwMCB9ICk7CgkgKiBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgoJICovCgljbGFzcyBCdWZmZXJHZW9tZXRyeSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZ2VvbWV0cnkuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNCdWZmZXJHZW9tZXRyeSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIElEIG9mIHRoZSBnZW9tZXRyeS4KCQkJICoKCQkJICogQG5hbWUgQnVmZmVyR2VvbWV0cnkjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQxICsrIH0gKTsKCgkJCS8qKgoJCQkgKiBUaGUgVVVJRCBvZiB0aGUgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqIEByZWFkb25seQoJCQkgKi8KCQkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCQkvKioKCQkJICogVGhlIG5hbWUgb2YgdGhlIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7c3RyaW5nfQoJCQkgKi8KCQkJdGhpcy5uYW1lID0gJyc7CgkJCXRoaXMudHlwZSA9ICdCdWZmZXJHZW9tZXRyeSc7CgoJCQkvKioKCQkJICogQWxsb3dzIGZvciB2ZXJ0aWNlcyB0byBiZSByZS11c2VkIGFjcm9zcyBtdWx0aXBsZSB0cmlhbmdsZXM7IHRoaXMgaXMKCQkJICogY2FsbGVkIHVzaW5nICJpbmRleGVkIHRyaWFuZ2xlcyIuIEVhY2ggdHJpYW5nbGUgaXMgYXNzb2NpYXRlZCB3aXRoIHRoZQoJCQkgKiBpbmRpY2VzIG9mIHRocmVlIHZlcnRpY2VzLiBUaGlzIGF0dHJpYnV0ZSB0aGVyZWZvcmUgc3RvcmVzIHRoZSBpbmRleCBvZgoJCQkgKiBlYWNoIHZlcnRleCBmb3IgZWFjaCB0cmlhbmd1bGFyIGZhY2UuIElmIHRoaXMgYXR0cmlidXRlIGlzIG5vdCBzZXQsIHRoZQoJCQkgKiByZW5kZXJlciBhc3N1bWVzIHRoYXQgZWFjaCB0aHJlZSBjb250aWd1b3VzIHBvc2l0aW9ucyByZXByZXNlbnQgYSBzaW5nbGUgdHJpYW5nbGUuCgkJCSAqCgkJCSAqIEB0eXBlIHs/QnVmZmVyQXR0cmlidXRlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmluZGV4ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBBIChzdG9yYWdlKSBidWZmZXIgYXR0cmlidXRlIHdoaWNoIHdhcyBnZW5lcmF0ZWQgd2l0aCBhIGNvbXB1dGUgc2hhZGVyIGFuZAoJCQkgKiBub3cgZGVmaW5lcyBpbmRpcmVjdCBkcmF3IGNhbGxzLgoJCQkgKgoJCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdQVVJlbmRlcmVyfSBhbmQgYSBXZWJHUFUgYmFja2VuZC4KCQkJICoKCQkJICogQHR5cGUgez9CdWZmZXJBdHRyaWJ1dGV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuaW5kaXJlY3QgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoaXMgZGljdGlvbmFyeSBoYXMgYXMgaWQgdGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byBiZSBzZXQgYW5kIGFzIHZhbHVlCgkJCSAqIHRoZSBidWZmZXIgYXR0cmlidXRlIHRvIHNldCBpdCB0by4gUmF0aGVyIHRoYW4gYWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgZGlyZWN0bHksCgkJCSAqIHVzZSBgc2V0QXR0cmlidXRlKClgIGFuZCBgZ2V0QXR0cmlidXRlKClgIHRvIGFjY2VzcyBhdHRyaWJ1dGVzIG9mIHRoaXMgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLChCdWZmZXJBdHRyaWJ1dGV8SW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUpPn0KCQkJICovCgkJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoKCQkJLyoqCgkJCSAqIFRoaXMgZGljdGlvbmFyeSBob2xkcyB0aGUgbW9ycGggdGFyZ2V0cyBvZiB0aGUgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIE5vdGU6IE9uY2UgdGhlIGdlb21ldHJ5IGhhcyBiZWVuIHJlbmRlcmVkLCB0aGUgbW9ycGggYXR0cmlidXRlIGRhdGEgY2Fubm90CgkJCSAqIGJlIGNoYW5nZWQuIFlvdSB3aWxsIGhhdmUgdG8gY2FsbCBgZGlzcG9zZSgpPywgYW5kIGNyZWF0ZSBhIG5ldyBnZW9tZXRyeSBpbnN0YW5jZS4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMubW9ycGhBdHRyaWJ1dGVzID0ge307CgoJCQkvKioKCQkJICogVXNlZCB0byBjb250cm9sIHRoZSBtb3JwaCB0YXJnZXQgYmVoYXZpb3I7IHdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIG1vcnBoCgkJCSAqIHRhcmdldCBkYXRhIGlzIHRyZWF0ZWQgYXMgcmVsYXRpdmUgb2Zmc2V0cywgcmF0aGVyIHRoYW4gYXMgYWJzb2x1dGUKCQkJICogcG9zaXRpb25zL25vcm1hbHMuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFNwbGl0IHRoZSBnZW9tZXRyeSBpbnRvIGdyb3VwcywgZWFjaCBvZiB3aGljaCB3aWxsIGJlIHJlbmRlcmVkIGluIGEKCQkJICogc2VwYXJhdGUgZHJhdyBjYWxsLiBUaGlzIGFsbG93cyBhbiBhcnJheSBvZiBtYXRlcmlhbHMgdG8gYmUgdXNlZCB3aXRoIHRoZSBnZW9tZXRyeS4KCQkJICoKCQkJICogVXNlIGBhZGRHcm91cCgpYCBhbmQgYGNsZWFyR3JvdXBzKClgIHRvIGVkaXQgZ3JvdXBzLCByYXRoZXIgdGhhbiBtb2RpZnlpbmcgdGhpcyBhcnJheSBkaXJlY3RseS4KCQkJICoKCQkJICogRXZlcnkgdmVydGV4IGFuZCBpbmRleCBtdXN0IGJlbG9uZyB0byBleGFjdGx5IG9uZSBncm91cCDigJQgZ3JvdXBzIG11c3Qgbm90IHNoYXJlIHZlcnRpY2VzIG9yCgkJCSAqIGluZGljZXMsIGFuZCBtdXN0IG5vdCBsZWF2ZSB2ZXJ0aWNlcyBvciBpbmRpY2VzIHVudXNlZC4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PE9iamVjdD59CgkJCSAqLwoJCQl0aGlzLmdyb3VwcyA9IFtdOwoKCQkJLyoqCgkJCSAqIEJvdW5kaW5nIGJveCBmb3IgdGhlIGdlb21ldHJ5IHdoaWNoIGNhbiBiZSBjYWxjdWxhdGVkIHdpdGggYGNvbXB1dGVCb3VuZGluZ0JveCgpYC4KCQkJICoKCQkJICogQHR5cGUge0JveDN9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoKCQkJLyoqCgkJCSAqIEJvdW5kaW5nIHNwaGVyZSBmb3IgdGhlIGdlb21ldHJ5IHdoaWNoIGNhbiBiZSBjYWxjdWxhdGVkIHdpdGggYGNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpYC4KCQkJICoKCQkJICogQHR5cGUge1NwaGVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCQkvKioKCQkJICogRGV0ZXJtaW5lcyB0aGUgcGFydCBvZiB0aGUgZ2VvbWV0cnkgdG8gcmVuZGVyLiBUaGlzIHNob3VsZCBub3QgYmUgc2V0IGRpcmVjdGx5LAoJCQkgKiBpbnN0ZWFkIHVzZSBgc2V0RHJhd1JhbmdlKClgLgoJCQkgKgoJCQkgKiBAdHlwZSB7e3N0YXJ0Om51bWJlcixjb3VudDpudW1iZXJ9fQoJCQkgKi8KCQkJdGhpcy5kcmF3UmFuZ2UgPSB7IHN0YXJ0OiAwLCBjb3VudDogSW5maW5pdHkgfTsKCgkJCS8qKgoJCQkgKiBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9yZSBjdXN0b20gZGF0YSBhYm91dCB0aGUgZ2VvbWV0cnkuCgkJCSAqIEl0IHNob3VsZCBub3QgaG9sZCByZWZlcmVuY2VzIHRvIGZ1bmN0aW9ucyBhcyB0aGVzZSB3aWxsIG5vdCBiZSBjbG9uZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLnVzZXJEYXRhID0ge307CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhpcyBnZW9tZXRyeS4KCQkgKgoJCSAqIEByZXR1cm4gez9CdWZmZXJBdHRyaWJ1dGV9IFRoZSBpbmRleC4gUmV0dXJucyBgbnVsbGAgaWYgbm8gaW5kZXggaXMgZGVmaW5lZC4KCQkgKi8KCQlnZXRJbmRleCgpIHsKCgkJCXJldHVybiB0aGlzLmluZGV4OwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGluZGV4IHRvIHRoaXMgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj58QnVmZmVyQXR0cmlidXRlfSBpbmRleCAtIFRoZSBpbmRleCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0SW5kZXgoIGluZGV4ICkgewoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBpbmRleCApICkgewoKCQkJCXRoaXMuaW5kZXggPSBuZXcgKCBhcnJheU5lZWRzVWludDMyKCBpbmRleCApID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGV4LCAxICk7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuaW5kZXggPSBpbmRleDsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGluZGlyZWN0IGF0dHJpYnV0ZSB0byB0aGlzIGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGluZGlyZWN0IC0gVGhlIGF0dHJpYnV0ZSBob2xkaW5nIGluZGlyZWN0IGRyYXcgY2FsbHMuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0SW5kaXJlY3QoIGluZGlyZWN0ICkgewoKCQkJdGhpcy5pbmRpcmVjdCA9IGluZGlyZWN0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgaW5kaXJlY3QgYXR0cmlidXRlIG9mIHRoaXMgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcmV0dXJuIHs/QnVmZmVyQXR0cmlidXRlfSBUaGUgaW5kaXJlY3QgYXR0cmlidXRlLiBSZXR1cm5zIGBudWxsYCBpZiBubyBpbmRpcmVjdCBhdHRyaWJ1dGUgaXMgZGVmaW5lZC4KCQkgKi8KCQlnZXRJbmRpcmVjdCgpIHsKCgkJCXJldHVybiB0aGlzLmluZGlyZWN0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGJ1ZmZlciBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlfHVuZGVmaW5lZH0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBub3QgYXR0cmlidXRlIGhhcyBiZWVuIGZvdW5kLgoJCSAqLwoJCWdldEF0dHJpYnV0ZSggbmFtZSApIHsKCgkJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV8SW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBhdHRyaWJ1dGUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldEF0dHJpYnV0ZSggbmFtZSwgYXR0cmlidXRlICkgewoKCQkJdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF0gPSBhdHRyaWJ1dGU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBEZWxldGVzIHRoZSBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUgdG8gZGVsZXRlLgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWRlbGV0ZUF0dHJpYnV0ZSggbmFtZSApIHsKCgkJCWRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgZ2VvbWV0cnkgaGFzIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIG5hbWUuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBhdHRyaWJ1dGUgbmFtZS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgZ2VvbWV0cnkgaGFzIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIG5hbWUgb3Igbm90LgoJCSAqLwoJCWhhc0F0dHJpYnV0ZSggbmFtZSApIHsKCgkJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgYSBncm91cCB0byB0aGlzIGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gVGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhpcyBkcmF3IGNhbGwuIFRoYXQgaXMgdGhlIGZpcnN0CgkJICogdmVydGV4IGZvciBub24taW5kZXhlZCBnZW9tZXRyeSwgb3RoZXJ3aXNlIHRoZSBmaXJzdCB0cmlhbmdsZSBpbmRleC4KCQkgKiBAcGFyYW0ge251bWJlcn0gY291bnQgLSBTcGVjaWZpZXMgaG93IG1hbnkgdmVydGljZXMgKG9yIGluZGljZXMpIGFyZSBwYXJ0IG9mIHRoaXMgZ3JvdXAuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttYXRlcmlhbEluZGV4PTBdIC0gVGhlIG1hdGVyaWFsIGFycmF5IGluZGV4IHRvIHVzZS4KCQkgKi8KCQlhZGRHcm91cCggc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ID0gMCApIHsKCgkJCXRoaXMuZ3JvdXBzLnB1c2goIHsKCgkJCQlzdGFydDogc3RhcnQsCgkJCQljb3VudDogY291bnQsCgkJCQltYXRlcmlhbEluZGV4OiBtYXRlcmlhbEluZGV4CgoJCQl9ICk7CgoJCX0KCgkJLyoqCgkJICogQ2xlYXJzIGFsbCBncm91cHMuCgkJICovCgkJY2xlYXJHcm91cHMoKSB7CgoJCQl0aGlzLmdyb3VwcyA9IFtdOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGRyYXcgcmFuZ2UgZm9yIHRoaXMgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgLSBUaGUgZmlyc3QgdmVydGV4IGZvciBub24taW5kZXhlZCBnZW9tZXRyeSwgb3RoZXJ3aXNlIHRoZSBmaXJzdCB0cmlhbmdsZSBpbmRleC4KCQkgKiBAcGFyYW0ge251bWJlcn0gY291bnQgLSBGb3Igbm9uLWluZGV4ZWQgQnVmZmVyR2VvbWV0cnksIGBjb3VudGAgaXMgdGhlIG51bWJlciBvZiB2ZXJ0aWNlcyB0byByZW5kZXIuCgkJICogRm9yIGluZGV4ZWQgQnVmZmVyR2VvbWV0cnksIGBjb3VudGAgaXMgdGhlIG51bWJlciBvZiBpbmRpY2VzIHRvIHJlbmRlci4KCQkgKi8KCQlzZXREcmF3UmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc3RhcnQ7CgkJCXRoaXMuZHJhd1JhbmdlLmNvdW50ID0gY291bnQ7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IHRyYW5zZm9ybWF0aW9uIG1hdHJpeCB0byB0aGUgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlwb3NpdGlvbi5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJCXBvc2l0aW9uLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCWNvbnN0IG5vcm1hbCA9IHRoaXMuYXR0cmlidXRlcy5ub3JtYWw7CgoJCQlpZiAoIG5vcm1hbCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnN0IG5vcm1hbE1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCgkJCQlub3JtYWwuYXBwbHlOb3JtYWxNYXRyaXgoIG5vcm1hbE1hdHJpeCApOwoKCQkJCW5vcm1hbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCQljb25zdCB0YW5nZW50ID0gdGhpcy5hdHRyaWJ1dGVzLnRhbmdlbnQ7CgoJCQlpZiAoIHRhbmdlbnQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0YW5nZW50LnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4ICk7CgoJCQkJdGFuZ2VudC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJCX0KCgkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgcm90YXRpb24gcmVwcmVzZW50ZWQgYnkgdGhlIFF1YXRlcm5pb24gdG8gdGhlIGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24gdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYXBwbHlRdWF0ZXJuaW9uKCBxICkgewoKCQkJX20xJDMubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgYWJvdXQgdGhlIFggYXhpcy4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCgkJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjcm90YXRpb259IGZvciB0eXBpY2FsCgkJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlyb3RhdGVYKCBhbmdsZSApIHsKCgkJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgeC1heGlzCgoJCQlfbTEkMy5tYWtlUm90YXRpb25YKCBhbmdsZSApOwoKCQkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSQzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSb3RhdGVzIHRoZSBnZW9tZXRyeSBhYm91dCB0aGUgWSBheGlzLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKCQkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNyb3RhdGlvbn0gZm9yIHR5cGljYWwKCQkgKiByZWFsLXRpbWUgbWVzaCByb3RhdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJvdGF0ZVkoIGFuZ2xlICkgewoKCQkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB5LWF4aXMKCgkJCV9tMSQzLm1ha2VSb3RhdGlvblkoIGFuZ2xlICk7CgoJCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhlIGdlb21ldHJ5IGFib3V0IHRoZSBaIGF4aXMuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQoJCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3JvdGF0aW9ufSBmb3IgdHlwaWNhbAoJCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJcm90YXRlWiggYW5nbGUgKSB7CgoJCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHotYXhpcwoKCQkJX20xJDMubWFrZVJvdGF0aW9uWiggYW5nbGUgKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVHJhbnNsYXRlcyB0aGUgZ2VvbWV0cnkuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQoJCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3Bvc2l0aW9ufSBmb3IgdHlwaWNhbAoJCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCBvZmZzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgeSBvZmZzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBvZmZzZXQuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlKCB4LCB5LCB6ICkgewoKCQkJLy8gdHJhbnNsYXRlIGdlb21ldHJ5CgoJCQlfbTEkMy5tYWtlVHJhbnNsYXRpb24oIHgsIHksIHogKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2NhbGVzIHRoZSBnZW9tZXRyeS4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCgkJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjc2NhbGV9IGZvciB0eXBpY2FsCgkJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB4IHNjYWxlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHkgc2NhbGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBzY2FsZS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzY2FsZSggeCwgeSwgeiApIHsKCgkJCS8vIHNjYWxlIGdlb21ldHJ5CgoJCQlfbTEkMy5tYWtlU2NhbGUoIHgsIHksIHogKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgdG8gZmFjZSBhIHBvaW50IGluIDNEIHNwYWNlLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKCQkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNsb29rQXR9IGZvciB0eXBpY2FsCgkJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZlY3RvciAtIFRoZSB0YXJnZXQgcG9pbnQuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJbG9va0F0KCB2ZWN0b3IgKSB7CgoJCQlfb2JqLmxvb2tBdCggdmVjdG9yICk7CgoJCQlfb2JqLnVwZGF0ZU1hdHJpeCgpOwoKCQkJdGhpcy5hcHBseU1hdHJpeDQoIF9vYmoubWF0cml4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDZW50ZXIgdGhlIGdlb21ldHJ5IGJhc2VkIG9uIGl0cyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljZW50ZXIoKSB7CgoJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJdGhpcy5ib3VuZGluZ0JveC5nZXRDZW50ZXIoIF9vZmZzZXQgKS5uZWdhdGUoKTsKCgkJCXRoaXMudHJhbnNsYXRlKCBfb2Zmc2V0LngsIF9vZmZzZXQueSwgX29mZnNldC56ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBEZWZpbmVzIGEgZ2VvbWV0cnkgYnkgY3JlYXRpbmcgYSBgcG9zaXRpb25gIGF0dHJpYnV0ZSBiYXNlZCBvbiB0aGUgZ2l2ZW4gYXJyYXkgb2YgcG9pbnRzLiBUaGUgYXJyYXkKCQkgKiBjYW4gaG9sZCAyRCBvciAzRCB2ZWN0b3JzLiBXaGVuIHVzaW5nIHR3by1kaW1lbnNpb25hbCBkYXRhLCB0aGUgYHpgIGNvb3JkaW5hdGUgZm9yIGFsbCB2ZXJ0aWNlcyBpcwoJCSAqIHNldCB0byBgMGAuCgkJICoKCQkgKiBJZiB0aGUgbWV0aG9kIGlzIHVzZWQgd2l0aCBhbiBleGlzdGluZyBgcG9zaXRpb25gIGF0dHJpYnV0ZSwgdGhlIHZlcnRleCBkYXRhIGFyZSBvdmVyd3JpdHRlbiB3aXRoIHRoZQoJCSAqIGRhdGEgZnJvbSB0aGUgYXJyYXkuIFRoZSBsZW5ndGggb2YgdGhlIGFycmF5IG11c3QgbWF0Y2ggdGhlIHZlcnRleCBjb3VudC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8VmVjdG9yMj58QXJyYXk8VmVjdG9yMz59IHBvaW50cyAtIFRoZSBwb2ludHMuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0RnJvbVBvaW50cyggcG9pbnRzICkgewoKCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQkJaWYgKCBwb3NpdGlvbkF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnN0IHBvc2l0aW9uID0gW107CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHBvaW50ID0gcG9pbnRzWyBpIF07CgkJCQkJcG9zaXRpb24ucHVzaCggcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgoJCQkJfQoKCQkJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIDMgKSApOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCBsID0gTWF0aC5taW4oIHBvaW50cy5sZW5ndGgsIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICk7IC8vIG1ha2Ugc3VyZSBkYXRhIGRvIG5vdCBleGNlZWQgYnVmZmVyIHNpemUKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsOyBpICsrICkgewoKCQkJCQljb25zdCBwb2ludCA9IHBvaW50c1sgaSBdOwoJCQkJCXBvc2l0aW9uQXR0cmlidXRlLnNldFhZWiggaSwgcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgoJCQkJfQoKCQkJCWlmICggcG9pbnRzLmxlbmd0aCA+IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogQnVmZmVyIHNpemUgdG9vIHNtYWxsIGZvciBwb2ludHMgZGF0YS4gVXNlIC5kaXNwb3NlKCkgYW5kIGNyZWF0ZSBhIG5ldyBnZW9tZXRyeS4nICk7CgoJCQkJfQoKCQkJCXBvc2l0aW9uQXR0cmlidXRlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIGdlb21ldHJ5LCBhbmQgdXBkYXRlcyB0aGUgYGJvdW5kaW5nQm94YCBtZW1iZXIuCgkJICogVGhlIGJvdW5kaW5nIGJveCBpcyBub3QgY29tcHV0ZWQgYnkgdGhlIGVuZ2luZTsgaXQgbXVzdCBiZSBjb21wdXRlZCBieSB5b3VyIGFwcC4KCQkgKiBZb3UgbWF5IG5lZWQgdG8gcmVjb21wdXRlIHRoZSBib3VuZGluZyBib3ggaWYgdGhlIGdlb21ldHJ5IHZlcnRpY2VzIGFyZSBtb2RpZmllZC4KCQkgKi8KCQljb21wdXRlQm91bmRpbmdCb3goKSB7CgoJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQkJdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgoJCQl9CgoJCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIGJveC4nLCB0aGlzICk7CgoJCQkJdGhpcy5ib3VuZGluZ0JveC5zZXQoCgkJCQkJbmV3IFZlY3RvcjMoIC0gSW5maW5pdHksIC0gSW5maW5pdHksIC0gSW5maW5pdHkgKSwKCQkJCQluZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApCgkJCQkpOwoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nQm94LnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgoJCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJCV9ib3gkMi5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKCQkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCB0aGlzLmJvdW5kaW5nQm94Lm1pbiwgX2JveCQyLm1pbiApOwoJCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDggKTsKCgkJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggdGhpcy5ib3VuZGluZ0JveC5tYXgsIF9ib3gkMi5tYXggKTsKCQkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ4ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX2JveCQyLm1pbiApOwoJCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfYm94JDIubWF4ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuYm91bmRpbmdCb3gubWFrZUVtcHR5KCk7CgoJCQl9CgoJCQlpZiAoIGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi54ICkgfHwgaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnkgKSB8fCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueiApICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogQ29tcHV0ZWQgbWluL21heCBoYXZlIE5hTiB2YWx1ZXMuIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIG9mIHRoZSBnZW9tZXRyeSwgYW5kIHVwZGF0ZXMgdGhlIGBib3VuZGluZ1NwaGVyZWAgbWVtYmVyLgoJCSAqIFRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIHdoZW4gaXQgaXMgbmVlZGVkLCBlLmcuLCBmb3IgcmF5IGNhc3Rpbmcgb3IgdmlldyBmcnVzdHVtIGN1bGxpbmcuCgkJICogWW91IG1heSBuZWVkIHRvIHJlY29tcHV0ZSB0aGUgYm91bmRpbmcgc3BoZXJlIGlmIHRoZSBnZW9tZXRyeSB2ZXJ0aWNlcyBhcmUgbW9kaWZpZWQuCgkJICovCgkJY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCkgewoKCQkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQl9CgoJCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIHNwaGVyZS4nLCB0aGlzICk7CgoJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5zZXQoIG5ldyBWZWN0b3IzKCksIEluZmluaXR5ICk7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBwb3NpdGlvbiApIHsKCgkJCQkvLyBmaXJzdCwgZmluZCB0aGUgY2VudGVyIG9mIHRoZSBib3VuZGluZyBzcGhlcmUKCgkJCQljb25zdCBjZW50ZXIgPSB0aGlzLmJvdW5kaW5nU3BoZXJlLmNlbnRlcjsKCgkJCQlfYm94JDIuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24gKTsKCgkJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKCQkJCWlmICggbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gKSB7CgoJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKCQkJCQkJX2JveE1vcnBoVGFyZ2V0cy5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKCQkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWluLCBfYm94TW9ycGhUYXJnZXRzLm1pbiApOwoJCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKCQkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWF4LCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoJCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlfYm94JDIuZXhwYW5kQnlQb2ludCggX2JveE1vcnBoVGFyZ2V0cy5taW4gKTsKCQkJCQkJCV9ib3gkMi5leHBhbmRCeVBvaW50KCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCV9ib3gkMi5nZXRDZW50ZXIoIGNlbnRlciApOwoKCQkJCS8vIHNlY29uZCwgdHJ5IHRvIGZpbmQgYSBib3VuZGluZ1NwaGVyZSB3aXRoIGEgcmFkaXVzIHNtYWxsZXIgdGhhbiB0aGUKCQkJCS8vIGJvdW5kaW5nU3BoZXJlIG9mIHRoZSBib3VuZGluZ0JveDogc3FydCgzKSBzbWFsbGVyIGluIHRoZSBiZXN0IGNhc2UKCgkJCQlsZXQgbWF4UmFkaXVzU3EgPSAwOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb3NpdGlvbi5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGkgKTsKCgkJCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggX3ZlY3RvciQ4ICkgKTsKCgkJCQl9CgoJCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJCWNvbnN0IG1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJCQkJCWZvciAoIGxldCBqID0gMCwgamwgPSBtb3JwaEF0dHJpYnV0ZS5jb3VudDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJCV92ZWN0b3IkOC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgaiApOwoKCQkJCQkJCWlmICggbW9ycGhUYXJnZXRzUmVsYXRpdmUgKSB7CgoJCQkJCQkJCV9vZmZzZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGogKTsKCQkJCQkJCQlfdmVjdG9yJDguYWRkKCBfb2Zmc2V0ICk7CgoJCQkJCQkJfQoKCQkJCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IkOCApICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQkJaWYgKCBpc05hTiggdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgKSApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgYW5kIGFkZHMgYSB0YW5nZW50IGF0dHJpYnV0ZSB0byB0aGlzIGdlb21ldHJ5LgoJCSAqCgkJICogVGhlIGNvbXB1dGF0aW9uIGlzIG9ubHkgc3VwcG9ydGVkIGZvciBpbmRleGVkIGdlb21ldHJpZXMgYW5kIGlmIHBvc2l0aW9uLCBub3JtYWwsIGFuZCB1diBhdHRyaWJ1dGVzCgkJICogYXJlIGRlZmluZWQuIFdoZW4gdXNpbmcgYSB0YW5nZW50IHNwYWNlIG5vcm1hbCBtYXAsIHByZWZlciB0aGUgTWlra1RTcGFjZSBhbGdvcml0aG0gcHJvdmlkZWQgYnkKCQkgKiB7QGxpbmsgQnVmZmVyR2VvbWV0cnlVdGlscyNjb21wdXRlTWlra1RTcGFjZVRhbmdlbnRzfSBpbnN0ZWFkLgoJCSAqLwoJCWNvbXB1dGVUYW5nZW50cygpIHsKCgkJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCQkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJCS8vIGJhc2VkIG9uIGh0dHA6Ly93d3cudGVyYXRob24uY29tL2NvZGUvdGFuZ2VudC5odG1sCgkJCS8vIChwZXIgdmVydGV4IHRhbmdlbnRzKQoKCQkJaWYgKCBpbmRleCA9PT0gbnVsbCB8fAoJCQkJIGF0dHJpYnV0ZXMucG9zaXRpb24gPT09IHVuZGVmaW5lZCB8fAoJCQkJIGF0dHJpYnV0ZXMubm9ybWFsID09PSB1bmRlZmluZWQgfHwKCQkJCSBhdHRyaWJ1dGVzLnV2ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY29tcHV0ZVRhbmdlbnRzKCkgZmFpbGVkLiBNaXNzaW5nIHJlcXVpcmVkIGF0dHJpYnV0ZXMgKGluZGV4LCBwb3NpdGlvbiwgbm9ybWFsIG9yIHV2KScgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3Qgbm9ybWFsQXR0cmlidXRlID0gYXR0cmlidXRlcy5ub3JtYWw7CgkJCWNvbnN0IHV2QXR0cmlidXRlID0gYXR0cmlidXRlcy51djsKCgkJCWlmICggdGhpcy5oYXNBdHRyaWJ1dGUoICd0YW5nZW50JyApID09PSBmYWxzZSApIHsKCgkJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3RhbmdlbnQnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBuZXcgRmxvYXQzMkFycmF5KCA0ICogcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKSwgNCApICk7CgoJCQl9CgoJCQljb25zdCB0YW5nZW50QXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICd0YW5nZW50JyApOwoKCQkJY29uc3QgdGFuMSA9IFtdLCB0YW4yID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSArKyApIHsKCgkJCQl0YW4xWyBpIF0gPSBuZXcgVmVjdG9yMygpOwoJCQkJdGFuMlsgaSBdID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCWNvbnN0IHZBID0gbmV3IFZlY3RvcjMoKSwKCQkJCXZCID0gbmV3IFZlY3RvcjMoKSwKCQkJCXZDID0gbmV3IFZlY3RvcjMoKSwKCgkJCQl1dkEgPSBuZXcgVmVjdG9yMigpLAoJCQkJdXZCID0gbmV3IFZlY3RvcjIoKSwKCQkJCXV2QyA9IG5ldyBWZWN0b3IyKCksCgoJCQkJc2RpciA9IG5ldyBWZWN0b3IzKCksCgkJCQl0ZGlyID0gbmV3IFZlY3RvcjMoKTsKCgkJCWZ1bmN0aW9uIGhhbmRsZVRyaWFuZ2xlKCBhLCBiLCBjICkgewoKCQkJCXZBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBhICk7CgkJCQl2Qi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgYiApOwoJCQkJdkMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGMgKTsKCgkJCQl1dkEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXZBdHRyaWJ1dGUsIGEgKTsKCQkJCXV2Qi5mcm9tQnVmZmVyQXR0cmlidXRlKCB1dkF0dHJpYnV0ZSwgYiApOwoJCQkJdXZDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2QXR0cmlidXRlLCBjICk7CgoJCQkJdkIuc3ViKCB2QSApOwoJCQkJdkMuc3ViKCB2QSApOwoKCQkJCXV2Qi5zdWIoIHV2QSApOwoJCQkJdXZDLnN1YiggdXZBICk7CgoJCQkJY29uc3QgciA9IDEuMCAvICggdXZCLnggKiB1dkMueSAtIHV2Qy54ICogdXZCLnkgKTsKCgkJCQkvLyBzaWxlbnRseSBpZ25vcmUgZGVnZW5lcmF0ZSB1diB0cmlhbmdsZXMgaGF2aW5nIGNvaW5jaWRlbnQgb3IgY29saW5lYXIgdmVydGljZXMKCgkJCQlpZiAoICEgaXNGaW5pdGUoIHIgKSApIHJldHVybjsKCgkJCQlzZGlyLmNvcHkoIHZCICkubXVsdGlwbHlTY2FsYXIoIHV2Qy55ICkuYWRkU2NhbGVkVmVjdG9yKCB2QywgLSB1dkIueSApLm11bHRpcGx5U2NhbGFyKCByICk7CgkJCQl0ZGlyLmNvcHkoIHZDICkubXVsdGlwbHlTY2FsYXIoIHV2Qi54ICkuYWRkU2NhbGVkVmVjdG9yKCB2QiwgLSB1dkMueCApLm11bHRpcGx5U2NhbGFyKCByICk7CgoJCQkJdGFuMVsgYSBdLmFkZCggc2RpciApOwoJCQkJdGFuMVsgYiBdLmFkZCggc2RpciApOwoJCQkJdGFuMVsgYyBdLmFkZCggc2RpciApOwoKCQkJCXRhbjJbIGEgXS5hZGQoIHRkaXIgKTsKCQkJCXRhbjJbIGIgXS5hZGQoIHRkaXIgKTsKCQkJCXRhbjJbIGMgXS5hZGQoIHRkaXIgKTsKCgkJCX0KCgkJCWxldCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJCWlmICggZ3JvdXBzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQlncm91cHMgPSBbIHsKCQkJCQlzdGFydDogMCwKCQkJCQljb3VudDogaW5kZXguY291bnQKCQkJCX0gXTsKCgkJCX0KCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgoJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCgkJCQljb25zdCBzdGFydCA9IGdyb3VwLnN0YXJ0OwoJCQkJY29uc3QgY291bnQgPSBncm91cC5jb3VudDsKCgkJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IHN0YXJ0ICsgY291bnQ7IGogPCBqbDsgaiArPSAzICkgewoKCQkJCQloYW5kbGVUcmlhbmdsZSgKCQkJCQkJaW5kZXguZ2V0WCggaiArIDAgKSwKCQkJCQkJaW5kZXguZ2V0WCggaiArIDEgKSwKCQkJCQkJaW5kZXguZ2V0WCggaiArIDIgKQoJCQkJCSk7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgdG1wID0gbmV3IFZlY3RvcjMoKSwgdG1wMiA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IG4gPSBuZXcgVmVjdG9yMygpLCBuMiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlmdW5jdGlvbiBoYW5kbGVWZXJ0ZXgoIHYgKSB7CgoJCQkJbi5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHYgKTsKCQkJCW4yLmNvcHkoIG4gKTsKCgkJCQljb25zdCB0ID0gdGFuMVsgdiBdOwoKCQkJCS8vIEdyYW0tU2NobWlkdCBvcnRob2dvbmFsaXplCgoJCQkJdG1wLmNvcHkoIHQgKTsKCQkJCXRtcC5zdWIoIG4ubXVsdGlwbHlTY2FsYXIoIG4uZG90KCB0ICkgKSApLm5vcm1hbGl6ZSgpOwoKCQkJCS8vIENhbGN1bGF0ZSBoYW5kZWRuZXNzCgoJCQkJdG1wMi5jcm9zc1ZlY3RvcnMoIG4yLCB0ICk7CgkJCQljb25zdCB0ZXN0ID0gdG1wMi5kb3QoIHRhbjJbIHYgXSApOwoJCQkJY29uc3QgdyA9ICggdGVzdCA8IDAuMCApID8gLTEgOiAxLjA7CgoJCQkJdGFuZ2VudEF0dHJpYnV0ZS5zZXRYWVpXKCB2LCB0bXAueCwgdG1wLnksIHRtcC56LCB3ICk7CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyArKyBpICkgewoKCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgoJCQkJY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKCQkJCWNvbnN0IGNvdW50ID0gZ3JvdXAuY291bnQ7CgoJCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMCApICk7CgkJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMSApICk7CgkJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMiApICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHZlcnRleCBub3JtYWxzIGZvciB0aGUgZ2l2ZW4gdmVydGV4IGRhdGEuIEZvciBpbmRleGVkIGdlb21ldHJpZXMsIHRoZSBtZXRob2Qgc2V0cwoJCSAqIGVhY2ggdmVydGV4IG5vcm1hbCB0byBiZSB0aGUgYXZlcmFnZSBvZiB0aGUgZmFjZSBub3JtYWxzIG9mIHRoZSBmYWNlcyB0aGF0IHNoYXJlIHRoYXQgdmVydGV4LgoJCSAqIEZvciBub24taW5kZXhlZCBnZW9tZXRyaWVzLCB2ZXJ0aWNlcyBhcmUgbm90IHNoYXJlZCwgYW5kIHRoZSBtZXRob2Qgc2V0cyBlYWNoIHZlcnRleCBub3JtYWwKCQkgKiB0byBiZSB0aGUgc2FtZSBhcyB0aGUgZmFjZSBub3JtYWwuCgkJICovCgkJY29tcHV0ZVZlcnRleE5vcm1hbHMoKSB7CgoJCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CgkJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCgkJCWlmICggcG9zaXRpb25BdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlsZXQgbm9ybWFsQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdub3JtYWwnICk7CgoJCQkJaWYgKCBub3JtYWxBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbm9ybWFsQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKiAzICksIDMgKTsKCQkJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5vcm1hbEF0dHJpYnV0ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHJlc2V0IGV4aXN0aW5nIG5vcm1hbHMgdG8gemVybwoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbm9ybWFsQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpLCAwLCAwLCAwICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJY29uc3QgcEEgPSBuZXcgVmVjdG9yMygpLCBwQiA9IG5ldyBWZWN0b3IzKCksIHBDID0gbmV3IFZlY3RvcjMoKTsKCQkJCWNvbnN0IG5BID0gbmV3IFZlY3RvcjMoKSwgbkIgPSBuZXcgVmVjdG9yMygpLCBuQyA9IG5ldyBWZWN0b3IzKCk7CgkJCQljb25zdCBjYiA9IG5ldyBWZWN0b3IzKCksIGFiID0gbmV3IFZlY3RvcjMoKTsKCgkJCQkvLyBpbmRleGVkIGVsZW1lbnRzCgoJCQkJaWYgKCBpbmRleCApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGluZGV4LmNvdW50OyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJCWNvbnN0IHZBID0gaW5kZXguZ2V0WCggaSArIDAgKTsKCQkJCQkJY29uc3QgdkIgPSBpbmRleC5nZXRYKCBpICsgMSApOwoJCQkJCQljb25zdCB2QyA9IGluZGV4LmdldFgoIGkgKyAyICk7CgoJCQkJCQlwQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgdkEgKTsKCQkJCQkJcEIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZCICk7CgkJCQkJCXBDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QyApOwoKCQkJCQkJY2Iuc3ViVmVjdG9ycyggcEMsIHBCICk7CgkJCQkJCWFiLnN1YlZlY3RvcnMoIHBBLCBwQiApOwoJCQkJCQljYi5jcm9zcyggYWIgKTsKCgkJCQkJCW5BLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbEF0dHJpYnV0ZSwgdkEgKTsKCQkJCQkJbkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2QiApOwoJCQkJCQluQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHZDICk7CgoJCQkJCQluQS5hZGQoIGNiICk7CgkJCQkJCW5CLmFkZCggY2IgKTsKCQkJCQkJbkMuYWRkKCBjYiApOwoKCQkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkEsIG5BLngsIG5BLnksIG5BLnogKTsKCQkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkIsIG5CLngsIG5CLnksIG5CLnogKTsKCQkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkMsIG5DLngsIG5DLnksIG5DLnogKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIG5vbi1pbmRleGVkIGVsZW1lbnRzICh1bmNvbm5lY3RlZCB0cmlhbmdsZSBzb3VwKQoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQkJcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAwICk7CgkJCQkJCXBCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMSApOwoJCQkJCQlwQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDIgKTsKCgkJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwoJCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKCQkJCQkJY2IuY3Jvc3MoIGFiICk7CgoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMCwgY2IueCwgY2IueSwgY2IueiApOwoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMSwgY2IueCwgY2IueSwgY2IueiApOwoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMiwgY2IueCwgY2IueSwgY2IueiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOwoKCQkJCW5vcm1hbEF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogRW5zdXJlcyBldmVyeSBub3JtYWwgdmVjdG9yIGluIGEgZ2VvbWV0cnkgd2lsbCBoYXZlIGEgbWFnbml0dWRlIG9mIGAxYC4gVGhpcyB3aWxsCgkJICogY29ycmVjdCBsaWdodGluZyBvbiB0aGUgZ2VvbWV0cnkgc3VyZmFjZXMuCgkJICovCgkJbm9ybWFsaXplTm9ybWFscygpIHsKCgkJCWNvbnN0IG5vcm1hbHMgPSB0aGlzLmF0dHJpYnV0ZXMubm9ybWFsOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5vcm1hbHMuY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCgkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgaSApOwoKCQkJCV92ZWN0b3IkOC5ub3JtYWxpemUoKTsKCgkJCQlub3JtYWxzLnNldFhZWiggaSwgX3ZlY3RvciQ4LngsIF92ZWN0b3IkOC55LCBfdmVjdG9yJDgueiApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFJldHVybiBhIG5ldyBub24taW5kZXggdmVyc2lvbiBvZiB0aGlzIGluZGV4ZWQgZ2VvbWV0cnkuIElmIHRoZSBnZW9tZXRyeQoJCSAqIGlzIGFscmVhZHkgbm9uLWluZGV4ZWQsIHRoZSBtZXRob2QgaXMgYSBOT09QLgoJCSAqCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IFRoZSBub24taW5kZXhlZCB2ZXJzaW9uIG9mIHRoaXMgaW5kZXhlZCBnZW9tZXRyeS4KCQkgKi8KCQl0b05vbkluZGV4ZWQoKSB7CgoJCQlmdW5jdGlvbiBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CgkJCQljb25zdCBpdGVtU2l6ZSA9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKCQkJCWNvbnN0IG5vcm1hbGl6ZWQgPSBhdHRyaWJ1dGUubm9ybWFsaXplZDsKCgkJCQljb25zdCBhcnJheTIgPSBuZXcgYXJyYXkuY29uc3RydWN0b3IoIGluZGljZXMubGVuZ3RoICogaXRlbVNpemUgKTsKCgkJCQlsZXQgaW5kZXggPSAwLCBpbmRleDIgPSAwOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGluZGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogYXR0cmlidXRlLmRhdGEuc3RyaWRlICsgYXR0cmlidXRlLm9mZnNldDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogaXRlbVNpemU7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgaXRlbVNpemU7IGogKysgKSB7CgoJCQkJCQlhcnJheTJbIGluZGV4MiArKyBdID0gYXJyYXlbIGluZGV4ICsrIF07CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGFycmF5MiwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHRoaXMuaW5kZXggPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuJyApOwoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQljb25zdCBnZW9tZXRyeTIgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJCWNvbnN0IGluZGljZXMgPSB0aGlzLmluZGV4LmFycmF5OwoJCQljb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKCQkJLy8gYXR0cmlidXRlcwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCQlnZW9tZXRyeTIuc2V0QXR0cmlidXRlKCBuYW1lLCBuZXdBdHRyaWJ1dGUgKTsKCgkJCX0KCgkJCS8vIG1vcnBoIGF0dHJpYnV0ZXMKCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzOwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgbW9ycGhBcnJheSA9IFtdOwoJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsgLy8gbW9ycGhBdHRyaWJ1dGU6IGFycmF5IG9mIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGVzCgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBhdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZVsgaSBdOwoKCQkJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCQkJbW9ycGhBcnJheS5wdXNoKCBuZXdBdHRyaWJ1dGUgKTsKCgkJCQl9CgoJCQkJZ2VvbWV0cnkyLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gbW9ycGhBcnJheTsKCgkJCX0KCgkJCWdlb21ldHJ5Mi5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCQkvLyBncm91cHMKCgkJCWNvbnN0IGdyb3VwcyA9IHRoaXMuZ3JvdXBzOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCWdlb21ldHJ5Mi5hZGRHcm91cCggZ3JvdXAuc3RhcnQsIGdyb3VwLmNvdW50LCBncm91cC5tYXRlcmlhbEluZGV4ICk7CgoJCQl9CgoJCQlyZXR1cm4gZ2VvbWV0cnkyOwoKCQl9CgoJCS8qKgoJCSAqIFNlcmlhbGl6ZXMgdGhlIGdlb21ldHJ5IGludG8gSlNPTi4KCQkgKgoJCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCgkJICovCgkJdG9KU09OKCkgewoKCQkJY29uc3QgZGF0YSA9IHsKCQkJCW1ldGFkYXRhOiB7CgkJCQkJdmVyc2lvbjogNC43LAoJCQkJCXR5cGU6ICdCdWZmZXJHZW9tZXRyeScsCgkJCQkJZ2VuZXJhdG9yOiAnQnVmZmVyR2VvbWV0cnkudG9KU09OJwoJCQkJfQoJCQl9OwoKCQkJLy8gc3RhbmRhcmQgQnVmZmVyR2VvbWV0cnkgc2VyaWFsaXphdGlvbgoKCQkJZGF0YS51dWlkID0gdGhpcy51dWlkOwoJCQlkYXRhLnR5cGUgPSB0aGlzLnR5cGU7CgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKCQkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBkYXRhLnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJCWlmICggdGhpcy5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKCgkJCQlmb3IgKCBjb25zdCBrZXkgaW4gcGFyYW1ldGVycyApIHsKCgkJCQkJaWYgKCBwYXJhbWV0ZXJzWyBrZXkgXSAhPT0gdW5kZWZpbmVkICkgZGF0YVsga2V5IF0gPSBwYXJhbWV0ZXJzWyBrZXkgXTsKCgkJCQl9CgoJCQkJcmV0dXJuIGRhdGE7CgoJCQl9CgoJCQkvLyBmb3Igc2ltcGxpY2l0eSB0aGUgY29kZSBhc3N1bWVzIGF0dHJpYnV0ZXMgYXJlIG5vdCBzaGFyZWQgYWNyb3NzIGdlb21ldHJpZXMsIHNlZSAjMTU4MTEKCgkJCWRhdGEuZGF0YSA9IHsgYXR0cmlidXRlczoge30gfTsKCgkJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCgkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJZGF0YS5kYXRhLmluZGV4ID0gewoJCQkJCXR5cGU6IGluZGV4LmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBpbmRleC5hcnJheSApCgkJCQl9OwoKCQkJfQoKCQkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoKCQkJCWRhdGEuZGF0YS5hdHRyaWJ1dGVzWyBrZXkgXSA9IGF0dHJpYnV0ZS50b0pTT04oIGRhdGEuZGF0YSApOwoKCQkJfQoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0ge307CgkJCWxldCBoYXNNb3JwaEF0dHJpYnV0ZXMgPSBmYWxzZTsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiB0aGlzLm1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQljb25zdCBhdHRyaWJ1dGVBcnJheSA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzWyBrZXkgXTsKCgkJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhdHRyaWJ1dGVBcnJheS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlQXJyYXlbIGkgXTsKCgkJCQkJYXJyYXkucHVzaCggYXR0cmlidXRlLnRvSlNPTiggZGF0YS5kYXRhICkgKTsKCgkJCQl9CgoJCQkJaWYgKCBhcnJheS5sZW5ndGggPiAwICkgewoKCQkJCQltb3JwaEF0dHJpYnV0ZXNbIGtleSBdID0gYXJyYXk7CgoJCQkJCWhhc01vcnBoQXR0cmlidXRlcyA9IHRydWU7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBoYXNNb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJZGF0YS5kYXRhLm1vcnBoQXR0cmlidXRlcyA9IG1vcnBoQXR0cmlidXRlczsKCQkJCWRhdGEuZGF0YS5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCQl9CgoJCQljb25zdCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJCWlmICggZ3JvdXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJZGF0YS5kYXRhLmdyb3VwcyA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBncm91cHMgKSApOwoKCQkJfQoKCQkJY29uc3QgYm91bmRpbmdTcGhlcmUgPSB0aGlzLmJvdW5kaW5nU3BoZXJlOwoKCQkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQlkYXRhLmRhdGEuYm91bmRpbmdTcGhlcmUgPSBib3VuZGluZ1NwaGVyZS50b0pTT04oKTsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgZ2VvbWV0cnkgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGdlb21ldHJ5IHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBzb3VyY2UgLSBUaGUgZ2VvbWV0cnkgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljb3B5KCBzb3VyY2UgKSB7CgoJCQkvLyByZXNldAoKCQkJdGhpcy5pbmRleCA9IG51bGw7CgkJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoJCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwoJCQl0aGlzLmdyb3VwcyA9IFtdOwoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCQkvLyB1c2VkIGZvciBzdG9yaW5nIGNsb25lZCwgc2hhcmVkIGRhdGEKCgkJCWNvbnN0IGRhdGEgPSB7fTsKCgkJCS8vIG5hbWUKCgkJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQkJLy8gaW5kZXgKCgkJCWNvbnN0IGluZGV4ID0gc291cmNlLmluZGV4OwoKCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLnNldEluZGV4KCBpbmRleC5jbG9uZSgpICk7CgoJCQl9CgoJCQkvLyBhdHRyaWJ1dGVzCgoJCQljb25zdCBhdHRyaWJ1dGVzID0gc291cmNlLmF0dHJpYnV0ZXM7CgoJCQlmb3IgKCBjb25zdCBuYW1lIGluIGF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlc1sgbmFtZSBdOwoJCQkJdGhpcy5zZXRBdHRyaWJ1dGUoIG5hbWUsIGF0dHJpYnV0ZS5jbG9uZSggZGF0YSApICk7CgoJCQl9CgoJCQkvLyBtb3JwaCBhdHRyaWJ1dGVzCgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBzb3VyY2UubW9ycGhBdHRyaWJ1dGVzOwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBbXTsKCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF07IC8vIG1vcnBoQXR0cmlidXRlOiBhcnJheSBvZiBGbG9hdDMyQnVmZmVyQXR0cmlidXRlcwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWFycmF5LnB1c2goIG1vcnBoQXR0cmlidXRlWyBpIF0uY2xvbmUoIGRhdGEgKSApOwoKCQkJCX0KCgkJCQl0aGlzLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gYXJyYXk7CgoJCQl9CgoJCQl0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gc291cmNlLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKCQkJLy8gZ3JvdXBzCgoJCQljb25zdCBncm91cHMgPSBzb3VyY2UuZ3JvdXBzOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCXRoaXMuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKCQkJfQoKCQkJLy8gYm91bmRpbmcgYm94CgoJCQljb25zdCBib3VuZGluZ0JveCA9IHNvdXJjZS5ib3VuZGluZ0JveDsKCgkJCWlmICggYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJdGhpcy5ib3VuZGluZ0JveCA9IGJvdW5kaW5nQm94LmNsb25lKCk7CgoJCQl9CgoJCQkvLyBib3VuZGluZyBzcGhlcmUKCgkJCWNvbnN0IGJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlOwoKCQkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJCX0KCgkJCS8vIGRyYXcgcmFuZ2UKCgkJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc291cmNlLmRyYXdSYW5nZS5zdGFydDsKCQkJdGhpcy5kcmF3UmFuZ2UuY291bnQgPSBzb3VyY2UuZHJhd1JhbmdlLmNvdW50OwoKCQkJLy8gdXNlciBkYXRhCgoJCQl0aGlzLnVzZXJEYXRhID0gc291cmNlLnVzZXJEYXRhOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRnJlZXMgdGhlIEdQVS1yZWxhdGVkIHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzCgkJICogbWV0aG9kIHdoZW5ldmVyIHRoaXMgaW5zdGFuY2UgaXMgbm8gbG9uZ2VyIHVzZWQgaW4geW91ciBhcHAuCgkJICoKCQkgKiBAZmlyZXMgQnVmZmVyR2VvbWV0cnkjZGlzcG9zZQoJCSAqLwoJCWRpc3Bvc2UoKSB7CgoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgkJfQoKCX0KCgljb25zdCBfaW52ZXJzZU1hdHJpeCQzID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoJY29uc3QgX3JheSQzID0gLypAX19QVVJFX18qLyBuZXcgUmF5KCk7Cgljb25zdCBfc3BoZXJlJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKCWNvbnN0IF9zcGhlcmVIaXRBdCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfdkEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92QiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZDJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX3RlbXBBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX21vcnBoQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfaW50ZXJzZWN0aW9uUG9pbnQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyB0cmlhbmd1bGFyIHBvbHlnb24gbWVzaCBiYXNlZCBvYmplY3RzLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMSwgMSwgMSApOwoJICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZjAwIH0gKTsKCSAqIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkgKiBzY2VuZS5hZGQoIG1lc2ggKTsKCSAqIGBgYAoJICoKCSAqIEBhdWdtZW50cyBPYmplY3QzRAoJICovCgljbGFzcyBNZXNoIGV4dGVuZHMgT2JqZWN0M0QgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2guCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBbZ2VvbWV0cnldIC0gVGhlIG1lc2ggZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtNYXRlcmlhbHxBcnJheTxNYXRlcmlhbD59IFttYXRlcmlhbF0gLSBUaGUgbWVzaCBtYXRlcmlhbC4KCQkgKi8KCQljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKSwgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoKSApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc01lc2ggPSB0cnVlOwoKCQkJdGhpcy50eXBlID0gJ01lc2gnOwoKCQkJLyoqCgkJCSAqIFRoZSBtZXNoIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7QnVmZmVyR2VvbWV0cnl9CgkJCSAqLwoJCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgoJCQkvKioKCQkJICogVGhlIG1lc2ggbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRlcmlhbHxBcnJheTxNYXRlcmlhbD59CgkJCSAqIEBkZWZhdWx0IE1lc2hCYXNpY01hdGVyaWFsCgkJCSAqLwoJCQl0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgoJCQkvKioKCQkJICogQSBkaWN0aW9uYXJ5IHJlcHJlc2VudGluZyB0aGUgbW9ycGggdGFyZ2V0cyBpbiB0aGUgZ2VvbWV0cnkuIFRoZSBrZXkgaXMgdGhlCgkJCSAqIG1vcnBoIHRhcmdldHMgbmFtZSwgdGhlIHZhbHVlIGl0cyBhdHRyaWJ1dGUgaW5kZXguIFRoaXMgbWVtYmVyIGlzIGB1bmRlZmluZWRgCgkJCSAqIGJ5IGRlZmF1bHQgYW5kIG9ubHkgc2V0IHdoZW4gbW9ycGggdGFyZ2V0cyBhcmUgZGV0ZWN0ZWQgaW4gdGhlIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7T2JqZWN0PFN0cmluZyxudW1iZXI+fHVuZGVmaW5lZH0KCQkJICogQGRlZmF1bHQgdW5kZWZpbmVkCgkJCSAqLwoJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBBbiBhcnJheSBvZiB3ZWlnaHRzIHR5cGljYWxseSBpbiB0aGUgcmFuZ2UgYFswLDFdYCB0aGF0IHNwZWNpZnkgaG93IG11Y2ggb2YgdGhlIG1vcnBoCgkJCSAqIGlzIGFwcGxpZWQuIFRoaXMgbWVtYmVyIGlzIGB1bmRlZmluZWRgIGJ5IGRlZmF1bHQgYW5kIG9ubHkgc2V0IHdoZW4gbW9ycGggdGFyZ2V0cyBhcmUKCQkJICogZGV0ZWN0ZWQgaW4gdGhlIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPnx1bmRlZmluZWR9CgkJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAoJCQkgKi8KCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSB1bmRlZmluZWQ7CgoJCQkvKioKCQkJICogVGhlIG51bWJlciBvZiBpbnN0YW5jZXMgb2YgdGhpcyBtZXNoLgoJCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdQVVJlbmRlcmVyfS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5jb3VudCA9IDE7CgoJCQl0aGlzLnVwZGF0ZU1vcnBoVGFyZ2V0cygpOwoKCQl9CgoJCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJCWlmICggc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5zbGljZSgpOwoKCQkJfQoKCQkJaWYgKCBzb3VyY2UubW9ycGhUYXJnZXREaWN0aW9uYXJ5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSApOwoKCQkJfQoKCQkJdGhpcy5tYXRlcmlhbCA9IEFycmF5LmlzQXJyYXkoIHNvdXJjZS5tYXRlcmlhbCApID8gc291cmNlLm1hdGVyaWFsLnNsaWNlKCkgOiBzb3VyY2UubWF0ZXJpYWw7CgkJCXRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2YWx1ZXMgb2Yge0BsaW5rIE1lc2gjbW9ycGhUYXJnZXREaWN0aW9uYXJ5fSBhbmQge0BsaW5rIE1lc2gjbW9ycGhUYXJnZXRJbmZsdWVuY2VzfQoJCSAqIHRvIG1ha2Ugc3VyZSBleGlzdGluZyBtb3JwaCB0YXJnZXRzIGNhbiBpbmZsdWVuY2UgdGhpcyAzRCBvYmplY3QuCgkJICovCgkJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoJCQljb25zdCBrZXlzID0gT2JqZWN0LmtleXMoIG1vcnBoQXR0cmlidXRlcyApOwoKCQkJaWYgKCBrZXlzLmxlbmd0aCA+IDAgKSB7CgoJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIGtleXNbIDAgXSBdOwoKCQkJCWlmICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSBbXTsKCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHt9OwoKCQkJCQlmb3IgKCBsZXQgbSA9IDAsIG1sID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBtIDwgbWw7IG0gKysgKSB7CgoJCQkJCQljb25zdCBuYW1lID0gbW9ycGhBdHRyaWJ1dGVbIG0gXS5uYW1lIHx8IFN0cmluZyggbSApOwoKCQkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMucHVzaCggMCApOwoJCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgbmFtZSBdID0gbTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBsb2NhbC1zcGFjZSBwb3NpdGlvbiBvZiB0aGUgdmVydGV4IGF0IHRoZSBnaXZlbiBpbmRleCwgdGFraW5nIGludG8KCQkgKiBhY2NvdW50IHRoZSBjdXJyZW50IGFuaW1hdGlvbiBzdGF0ZSBvZiBib3RoIG1vcnBoIHRhcmdldHMgYW5kIHNraW5uaW5nLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIHZlcnRleCBpbmRleC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSB2ZXJ0ZXggcG9zaXRpb24gaW4gbG9jYWwgc3BhY2UuCgkJICovCgkJZ2V0VmVydGV4UG9zaXRpb24oIGluZGV4LCB0YXJnZXQgKSB7CgoJCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhQb3NpdGlvbiA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhUYXJnZXRzUmVsYXRpdmUgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJCXRhcmdldC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaW5kZXggKTsKCgkJCWNvbnN0IG1vcnBoSW5mbHVlbmNlcyA9IHRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKCQkJaWYgKCBtb3JwaFBvc2l0aW9uICYmIG1vcnBoSW5mbHVlbmNlcyApIHsKCgkJCQlfbW9ycGhBLnNldCggMCwgMCwgMCApOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaFBvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBpbmZsdWVuY2UgPSBtb3JwaEluZmx1ZW5jZXNbIGkgXTsKCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoUG9zaXRpb25bIGkgXTsKCgkJCQkJaWYgKCBpbmZsdWVuY2UgPT09IDAgKSBjb250aW51ZTsKCgkJCQkJX3RlbXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQXR0cmlidXRlLCBpbmRleCApOwoKCQkJCQlpZiAoIG1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJX21vcnBoQS5hZGRTY2FsZWRWZWN0b3IoIF90ZW1wQSwgaW5mbHVlbmNlICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlfbW9ycGhBLmFkZFNjYWxlZFZlY3RvciggX3RlbXBBLnN1YiggdGFyZ2V0ICksIGluZmx1ZW5jZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRhcmdldC5hZGQoIF9tb3JwaEEgKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgaW50ZXJzZWN0aW9uIHBvaW50cyBiZXR3ZWVuIGEgY2FzdGVkIHJheSBhbmQgdGhpcyBsaW5lLgoJCSAqCgkJICogQHBhcmFtIHtSYXljYXN0ZXJ9IHJheWNhc3RlciAtIFRoZSByYXljYXN0ZXIuCgkJICogQHBhcmFtIHtBcnJheTxPYmplY3Q+fSBpbnRlcnNlY3RzIC0gVGhlIHRhcmdldCBhcnJheSB0aGF0IGhvbGRzIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnRzLgoJCSAqLwoJCXJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoJCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgoJCQlpZiAoIG1hdGVyaWFsID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgc3BoZXJlIGluIHdvcmxkIHNwYWNlCgoJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQlfc3BoZXJlJDYuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKTsKCQkJX3NwaGVyZSQ2LmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCgkJCS8vIGNoZWNrIGRpc3RhbmNlIGZyb20gcmF5IG9yaWdpbiB0byBib3VuZGluZyBzcGhlcmUKCgkJCV9yYXkkMy5jb3B5KCByYXljYXN0ZXIucmF5ICkucmVjYXN0KCByYXljYXN0ZXIubmVhciApOwoKCQkJaWYgKCBfc3BoZXJlJDYuY29udGFpbnNQb2ludCggX3JheSQzLm9yaWdpbiApID09PSBmYWxzZSApIHsKCgkJCQlpZiAoIF9yYXkkMy5pbnRlcnNlY3RTcGhlcmUoIF9zcGhlcmUkNiwgX3NwaGVyZUhpdEF0ICkgPT09IG51bGwgKSByZXR1cm47CgoJCQkJaWYgKCBfcmF5JDMub3JpZ2luLmRpc3RhbmNlVG9TcXVhcmVkKCBfc3BoZXJlSGl0QXQgKSA+ICggcmF5Y2FzdGVyLmZhciAtIHJheWNhc3Rlci5uZWFyICkgKiogMiApIHJldHVybjsKCgkJCX0KCgkJCS8vIGNvbnZlcnQgcmF5IHRvIGxvY2FsIHNwYWNlIG9mIG1lc2gKCgkJCV9pbnZlcnNlTWF0cml4JDMuY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQkJX3JheSQzLmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4JDMgKTsKCgkJCS8vIHRlc3Qgd2l0aCBib3VuZGluZyBib3ggaW4gbG9jYWwgc3BhY2UKCgkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJaWYgKCBfcmF5JDMuaW50ZXJzZWN0c0JveCggZ2VvbWV0cnkuYm91bmRpbmdCb3ggKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQl9CgoJCQkvLyB0ZXN0IGZvciBpbnRlcnNlY3Rpb25zIHdpdGggZ2VvbWV0cnkKCgkJCXRoaXMuX2NvbXB1dGVJbnRlcnNlY3Rpb25zKCByYXljYXN0ZXIsIGludGVyc2VjdHMsIF9yYXkkMyApOwoKCQl9CgoJCV9jb21wdXRlSW50ZXJzZWN0aW9ucyggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCByYXlMb2NhbFNwYWNlICkgewoKCQkJbGV0IGludGVyc2VjdGlvbjsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoKCQkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQljb25zdCB1diA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXY7CgkJCWNvbnN0IHV2MSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYxOwoJCQljb25zdCBub3JtYWwgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLm5vcm1hbDsKCQkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoJCQljb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCS8vIGluZGV4ZWQgYnVmZmVyIGdlb21ldHJ5CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCBncm91cC5zdGFydCwgZHJhd1JhbmdlLnN0YXJ0ICk7CgkJCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBpbmRleC5jb3VudCwgTWF0aC5taW4oICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApLCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICkgKTsKCgkJCQkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJCQljb25zdCBhID0gaW5kZXguZ2V0WCggaiApOwoJCQkJCQkJY29uc3QgYiA9IGluZGV4LmdldFgoIGogKyAxICk7CgkJCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaiArIDIgKTsKCgkJCQkJCQlpbnRlcnNlY3Rpb24gPSBjaGVja0dlb21ldHJ5SW50ZXJzZWN0aW9uKCB0aGlzLCBncm91cE1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKCQkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaiAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIGluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwoJCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggMCwgZHJhd1JhbmdlLnN0YXJ0ICk7CgkJCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJCWNvbnN0IGEgPSBpbmRleC5nZXRYKCBpICk7CgkJCQkJCWNvbnN0IGIgPSBpbmRleC5nZXRYKCBpICsgMSApOwoJCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaSArIDIgKTsKCgkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKCQkJCQkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgoJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBpbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIG5vbi1pbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgkJCQkJCWNvbnN0IGdyb3VwTWF0ZXJpYWwgPSBtYXRlcmlhbFsgZ3JvdXAubWF0ZXJpYWxJbmRleCBdOwoKCQkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsIE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApICk7CgoJCQkJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IGVuZDsgaiA8IGpsOyBqICs9IDMgKSB7CgoJCQkJCQkJY29uc3QgYSA9IGo7CgkJCQkJCQljb25zdCBiID0gaiArIDE7CgkJCQkJCQljb25zdCBjID0gaiArIDI7CgoJCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgZ3JvdXBNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCgkJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGogLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBub24taW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCgkJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2UubWF0ZXJpYWxJbmRleCA9IGdyb3VwLm1hdGVyaWFsSW5kZXg7CgkJCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCBpbnRlcnNlY3Rpb24gKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCQkJZm9yICggbGV0IGkgPSBzdGFydCwgaWwgPSBlbmQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQkJY29uc3QgYSA9IGk7CgkJCQkJCWNvbnN0IGIgPSBpICsgMTsKCQkJCQkJY29uc3QgYyA9IGkgKyAyOwoKCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgoJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaSAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIG5vbi1pbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJZnVuY3Rpb24gY2hlY2tJbnRlcnNlY3Rpb24kMSggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHBBLCBwQiwgcEMsIHBvaW50ICkgewoKCQlsZXQgaW50ZXJzZWN0OwoKCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKCQkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQywgcEIsIHBBLCB0cnVlLCBwb2ludCApOwoKCQl9IGVsc2UgewoKCQkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQSwgcEIsIHBDLCAoIG1hdGVyaWFsLnNpZGUgPT09IEZyb250U2lkZSApLCBwb2ludCApOwoKCQl9CgoJCWlmICggaW50ZXJzZWN0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJCV9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmNvcHkoIHBvaW50ICk7CgkJX2ludGVyc2VjdGlvblBvaW50V29ybGQuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCApOwoKCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgcmV0dXJuIG51bGw7CgoJCXJldHVybiB7CgkJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQkJcG9pbnQ6IF9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmNsb25lKCksCgkJCW9iamVjdDogb2JqZWN0CgkJfTsKCgl9CgoJZnVuY3Rpb24gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApIHsKCgkJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBhLCBfdkEkMSApOwoJCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggYiwgX3ZCJDEgKTsKCQlvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGMsIF92QyQxICk7CgoJCWNvbnN0IGludGVyc2VjdGlvbiA9IGNoZWNrSW50ZXJzZWN0aW9uJDEoIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfaW50ZXJzZWN0aW9uUG9pbnQgKTsKCgkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgoJCQljb25zdCBiYXJ5Y29vcmQgPSBuZXcgVmVjdG9yMygpOwoJCQlUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIF9pbnRlcnNlY3Rpb25Qb2ludCwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgYmFyeWNvb3JkICk7CgoJCQlpZiAoIHV2ICkgewoKCQkJCWludGVyc2VjdGlvbi51diA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggdXYsIGEsIGIsIGMsIGJhcnljb29yZCwgbmV3IFZlY3RvcjIoKSApOwoKCQkJfQoKCQkJaWYgKCB1djEgKSB7CgoJCQkJaW50ZXJzZWN0aW9uLnV2MSA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggdXYxLCBhLCBiLCBjLCBiYXJ5Y29vcmQsIG5ldyBWZWN0b3IyKCkgKTsKCgkJCX0KCgkJCWlmICggbm9ybWFsICkgewoKCQkJCWludGVyc2VjdGlvbi5ub3JtYWwgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIG5vcm1hbCwgYSwgYiwgYywgYmFyeWNvb3JkLCBuZXcgVmVjdG9yMygpICk7CgoJCQkJaWYgKCBpbnRlcnNlY3Rpb24ubm9ybWFsLmRvdCggcmF5LmRpcmVjdGlvbiApID4gMCApIHsKCgkJCQkJaW50ZXJzZWN0aW9uLm5vcm1hbC5tdWx0aXBseVNjYWxhciggLTEgKTsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBmYWNlID0gewoJCQkJYTogYSwKCQkJCWI6IGIsCgkJCQljOiBjLAoJCQkJbm9ybWFsOiBuZXcgVmVjdG9yMygpLAoJCQkJbWF0ZXJpYWxJbmRleDogMAoJCQl9OwoKCQkJVHJpYW5nbGUuZ2V0Tm9ybWFsKCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBmYWNlLm5vcm1hbCApOwoKCQkJaW50ZXJzZWN0aW9uLmZhY2UgPSBmYWNlOwoJCQlpbnRlcnNlY3Rpb24uYmFyeWNvb3JkID0gYmFyeWNvb3JkOwoKCQl9CgoJCXJldHVybiBpbnRlcnNlY3Rpb247CgoJfQoKCS8qKgoJICogQSBnZW9tZXRyeSBjbGFzcyBmb3IgYSByZWN0YW5ndWxhciBjdWJvaWQgd2l0aCBhIGdpdmVuIHdpZHRoLCBoZWlnaHQsIGFuZCBkZXB0aC4KCSAqIE9uIGNyZWF0aW9uLCB0aGUgY3Vib2lkIGlzIGNlbnRyZWQgb24gdGhlIG9yaWdpbiwgd2l0aCBlYWNoIGVkZ2UgcGFyYWxsZWwgdG8gb25lCgkgKiBvZiB0aGUgYXhlcy4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDEsIDEgKTsKCSAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweDAwZmYwMCB9ICk7CgkgKiBjb25zdCBjdWJlID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJICogc2NlbmUuYWRkKCBjdWJlICk7CgkgKiBgYGAKCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyR2VvbWV0cnkKCSAqLwoJY2xhc3MgQm94R2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYm94IGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aC4gVGhhdCBpcywgdGhlIGxlbmd0aCBvZiB0aGUgZWRnZXMgcGFyYWxsZWwgdG8gdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQuIFRoYXQgaXMsIHRoZSBsZW5ndGggb2YgdGhlIGVkZ2VzIHBhcmFsbGVsIHRvIHRoZSBZIGF4aXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSBkZXB0aC4gVGhhdCBpcywgdGhlIGxlbmd0aCBvZiB0aGUgZWRnZXMgcGFyYWxsZWwgdG8gdGhlIFogYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoU2VnbWVudHM9MV0gLSBOdW1iZXIgb2Ygc2VnbWVudGVkIHJlY3Rhbmd1bGFyIGZhY2VzIGFsb25nIHRoZSB3aWR0aCBvZiB0aGUgc2lkZXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHRTZWdtZW50cz0xXSAtIE51bWJlciBvZiBzZWdtZW50ZWQgcmVjdGFuZ3VsYXIgZmFjZXMgYWxvbmcgdGhlIGhlaWdodCBvZiB0aGUgc2lkZXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aFNlZ21lbnRzPTFdIC0gTnVtYmVyIG9mIHNlZ21lbnRlZCByZWN0YW5ndWxhciBmYWNlcyBhbG9uZyB0aGUgZGVwdGggb2YgdGhlIHNpZGVzLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSwgZGVwdGhTZWdtZW50cyA9IDEgKSB7CgoJCQlzdXBlcigpOwoKCQkJdGhpcy50eXBlID0gJ0JveEdlb21ldHJ5JzsKCgkJCS8qKgoJCQkgKiBIb2xkcyB0aGUgY29uc3RydWN0b3IgcGFyYW1ldGVycyB0aGF0IGhhdmUgYmVlbgoJCQkgKiB1c2VkIHRvIGdlbmVyYXRlIHRoZSBnZW9tZXRyeS4gQW55IG1vZGlmaWNhdGlvbgoJCQkgKiBhZnRlciBpbnN0YW50aWF0aW9uIGRvZXMgbm90IGNoYW5nZSB0aGUgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCQl3aWR0aDogd2lkdGgsCgkJCQloZWlnaHQ6IGhlaWdodCwKCQkJCWRlcHRoOiBkZXB0aCwKCQkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCQlkZXB0aFNlZ21lbnRzOiBkZXB0aFNlZ21lbnRzCgkJCX07CgoJCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCQkvLyBzZWdtZW50cwoKCQkJd2lkdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoIHdpZHRoU2VnbWVudHMgKTsKCQkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApOwoJCQlkZXB0aFNlZ21lbnRzID0gTWF0aC5mbG9vciggZGVwdGhTZWdtZW50cyApOwoKCQkJLy8gYnVmZmVycwoKCQkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCQljb25zdCBub3JtYWxzID0gW107CgkJCWNvbnN0IHV2cyA9IFtdOwoKCQkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQkJbGV0IG51bWJlck9mVmVydGljZXMgPSAwOwoJCQlsZXQgZ3JvdXBTdGFydCA9IDA7CgoJCQkvLyBidWlsZCBlYWNoIHNpZGUgb2YgdGhlIGJveCBnZW9tZXRyeQoKCQkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgLTEsIC0xLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aCwgZGVwdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDAgKTsgLy8gcHgKCQkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgMSwgLTEsIGRlcHRoLCBoZWlnaHQsIC0gd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAxICk7IC8vIG54CgkJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIDEsIHdpZHRoLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAyICk7IC8vIHB5CgkJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIC0xLCB3aWR0aCwgZGVwdGgsIC0gaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAzICk7IC8vIG55CgkJCWJ1aWxkUGxhbmUoICd4JywgJ3knLCAneicsIDEsIC0xLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDQgKTsgLy8gcHoKCQkJYnVpbGRQbGFuZSggJ3gnLCAneScsICd6JywgLTEsIC0xLCB3aWR0aCwgaGVpZ2h0LCAtIGRlcHRoLCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgNSApOyAvLyBuegoKCQkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJCQlmdW5jdGlvbiBidWlsZFBsYW5lKCB1LCB2LCB3LCB1ZGlyLCB2ZGlyLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ3JpZFgsIGdyaWRZLCBtYXRlcmlhbEluZGV4ICkgewoKCQkJCWNvbnN0IHNlZ21lbnRXaWR0aCA9IHdpZHRoIC8gZ3JpZFg7CgkJCQljb25zdCBzZWdtZW50SGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgoJCQkJY29uc3Qgd2lkdGhIYWxmID0gd2lkdGggLyAyOwoJCQkJY29uc3QgaGVpZ2h0SGFsZiA9IGhlaWdodCAvIDI7CgkJCQljb25zdCBkZXB0aEhhbGYgPSBkZXB0aCAvIDI7CgoJCQkJY29uc3QgZ3JpZFgxID0gZ3JpZFggKyAxOwoJCQkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKCQkJCWxldCB2ZXJ0ZXhDb3VudGVyID0gMDsKCQkJCWxldCBncm91cENvdW50ID0gMDsKCgkJCQljb25zdCB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKCQkJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgoJCQkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRIZWlnaHQgLSBoZWlnaHRIYWxmOwoKCQkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYMTsgaXggKysgKSB7CgoJCQkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50V2lkdGggLSB3aWR0aEhhbGY7CgoJCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKCQkJCQkJdmVjdG9yWyB1IF0gPSB4ICogdWRpcjsKCQkJCQkJdmVjdG9yWyB2IF0gPSB5ICogdmRpcjsKCQkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aEhhbGY7CgoJCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIHZlcnRleCBidWZmZXIKCgkJCQkJCXZlcnRpY2VzLnB1c2goIHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnogKTsKCgkJCQkJCS8vIHNldCB2YWx1ZXMgdG8gY29ycmVjdCB2ZWN0b3IgY29tcG9uZW50CgoJCQkJCQl2ZWN0b3JbIHUgXSA9IDA7CgkJCQkJCXZlY3RvclsgdiBdID0gMDsKCQkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aCA+IDAgPyAxIDogLTE7CgoJCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIG5vcm1hbCBidWZmZXIKCgkJCQkJCW5vcm1hbHMucHVzaCggdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKCQkJCQkJLy8gdXZzCgoJCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJCQl1dnMucHVzaCggMSAtICggaXkgLyBncmlkWSApICk7CgoJCQkJCQkvLyBjb3VudGVycwoKCQkJCQkJdmVydGV4Q291bnRlciArPSAxOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGluZGljZXMKCgkJCQkvLyAxLiB5b3UgbmVlZCB0aHJlZSBpbmRpY2VzIHRvIGRyYXcgYSBzaW5nbGUgZmFjZQoJCQkJLy8gMi4gYSBzaW5nbGUgc2VnbWVudCBjb25zaXN0cyBvZiB0d28gZmFjZXMKCQkJCS8vIDMuIHNvIHdlIG5lZWQgdG8gZ2VuZXJhdGUgc2l4ICgyKjMpIGluZGljZXMgcGVyIHNlZ21lbnQKCgkJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCgkJCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDsgaXggKysgKSB7CgoJCQkJCQljb25zdCBhID0gbnVtYmVyT2ZWZXJ0aWNlcyArIGl4ICsgZ3JpZFgxICogaXk7CgkJCQkJCWNvbnN0IGIgPSBudW1iZXJPZlZlcnRpY2VzICsgaXggKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJCQljb25zdCBjID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJCQljb25zdCBkID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCgkJCQkJCS8vIGZhY2VzCgoJCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJCQkvLyBpbmNyZWFzZSBjb3VudGVyCgoJCQkJCQlncm91cENvdW50ICs9IDY7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gYWRkIGEgZ3JvdXAgdG8gdGhlIGdlb21ldHJ5LiB0aGlzIHdpbGwgZW5zdXJlIG11bHRpIG1hdGVyaWFsIHN1cHBvcnQKCgkJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgbWF0ZXJpYWxJbmRleCApOwoKCQkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCgkJCQkvLyB1cGRhdGUgdG90YWwgbnVtYmVyIG9mIHZlcnRpY2VzCgoJCQkJbnVtYmVyT2ZWZXJ0aWNlcyArPSB2ZXJ0ZXhDb3VudGVyOwoKCQkJfQoKCQl9CgoJCWNvcHkoIHNvdXJjZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBGYWN0b3J5IG1ldGhvZCBmb3IgY3JlYXRpbmcgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcyBmcm9tIHRoZSBnaXZlbgoJCSAqIEpTT04gb2JqZWN0LgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCBnZW9tZXRyeS4KCQkgKiBAcmV0dXJuIHtCb3hHZW9tZXRyeX0gQSBuZXcgaW5zdGFuY2UuCgkJICovCgkJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQkJcmV0dXJuIG5ldyBCb3hHZW9tZXRyeSggZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQsIGRhdGEuZGVwdGgsIGRhdGEud2lkdGhTZWdtZW50cywgZGF0YS5oZWlnaHRTZWdtZW50cywgZGF0YS5kZXB0aFNlZ21lbnRzICk7CgoJCX0KCgl9CgoJLy8gVW5pZm9ybSBVdGlsaXRpZXMKCglmdW5jdGlvbiBjbG9uZVVuaWZvcm1zKCBzcmMgKSB7CgoJCWNvbnN0IGRzdCA9IHt9OwoKCQlmb3IgKCBjb25zdCB1IGluIHNyYyApIHsKCgkJCWRzdFsgdSBdID0ge307CgoJCQlmb3IgKCBjb25zdCBwIGluIHNyY1sgdSBdICkgewoKCQkJCWNvbnN0IHByb3BlcnR5ID0gc3JjWyB1IF1bIHAgXTsKCgkJCQlpZiAoIHByb3BlcnR5ICYmICggcHJvcGVydHkuaXNDb2xvciB8fAoJCQkJCXByb3BlcnR5LmlzTWF0cml4MyB8fCBwcm9wZXJ0eS5pc01hdHJpeDQgfHwKCQkJCQlwcm9wZXJ0eS5pc1ZlY3RvcjIgfHwgcHJvcGVydHkuaXNWZWN0b3IzIHx8IHByb3BlcnR5LmlzVmVjdG9yNCB8fAoJCQkJCXByb3BlcnR5LmlzVGV4dHVyZSB8fCBwcm9wZXJ0eS5pc1F1YXRlcm5pb24gKSApIHsKCgkJCQkJaWYgKCBwcm9wZXJ0eS5pc1JlbmRlclRhcmdldFRleHR1cmUgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdVbmlmb3Jtc1V0aWxzOiBUZXh0dXJlcyBvZiByZW5kZXIgdGFyZ2V0cyBjYW5ub3QgYmUgY2xvbmVkIHZpYSBjbG9uZVVuaWZvcm1zKCkgb3IgbWVyZ2VVbmlmb3JtcygpLicgKTsKCQkJCQkJZHN0WyB1IF1bIHAgXSA9IG51bGw7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHkuY2xvbmUoKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIHByb3BlcnR5ICkgKSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eS5zbGljZSgpOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGRzdDsKCgl9CgoJZnVuY3Rpb24gbWVyZ2VVbmlmb3JtcyggdW5pZm9ybXMgKSB7CgoJCWNvbnN0IG1lcmdlZCA9IHt9OwoKCQlmb3IgKCBsZXQgdSA9IDA7IHUgPCB1bmlmb3Jtcy5sZW5ndGg7IHUgKysgKSB7CgoJCQljb25zdCB0bXAgPSBjbG9uZVVuaWZvcm1zKCB1bmlmb3Jtc1sgdSBdICk7CgoJCQlmb3IgKCBjb25zdCBwIGluIHRtcCApIHsKCgkJCQltZXJnZWRbIHAgXSA9IHRtcFsgcCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiBtZXJnZWQ7CgoJfQoKCWZ1bmN0aW9uIGNsb25lVW5pZm9ybXNHcm91cHMoIHNyYyApIHsKCgkJY29uc3QgZHN0ID0gW107CgoJCWZvciAoIGxldCB1ID0gMDsgdSA8IHNyYy5sZW5ndGg7IHUgKysgKSB7CgoJCQlkc3QucHVzaCggc3JjWyB1IF0uY2xvbmUoKSApOwoKCQl9CgoJCXJldHVybiBkc3Q7CgoJfQoKCWZ1bmN0aW9uIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgewoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCWlmICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApIHsKCgkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yMzkzNyNpc3N1ZWNvbW1lbnQtMTExMTA2NzM5OAoJCQlyZXR1cm4gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZTsKCgkJfQoKCQkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8yNzg2OAoJCWlmICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlICkgewoKCQkJcmV0dXJuIGN1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS5jb2xvclNwYWNlOwoKCQl9CgoJCXJldHVybiBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2U7CgoJfQoKCS8vIExlZ2FjeQoKCWNvbnN0IFVuaWZvcm1zVXRpbHMgPSB7IGNsb25lOiBjbG9uZVVuaWZvcm1zLCBtZXJnZTogbWVyZ2VVbmlmb3JtcyB9OwoKCXZhciBkZWZhdWx0X3ZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbn0iOwoKCXZhciBkZWZhdWx0X2ZyYWdtZW50ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggMS4wLCAwLjAsIDAuMCwgMS4wICk7XG59IjsKCgkvKioKCSAqIEEgbWF0ZXJpYWwgcmVuZGVyZWQgd2l0aCBjdXN0b20gc2hhZGVycy4gQSBzaGFkZXIgaXMgYSBzbWFsbCBwcm9ncmFtIHdyaXR0ZW4gaW4gR0xTTC4KCSAqIHRoYXQgcnVucyBvbiB0aGUgR1BVLiBZb3UgbWF5IHdhbnQgdG8gdXNlIGEgY3VzdG9tIHNoYWRlciBpZiB5b3UgbmVlZCB0byBpbXBsZW1lbnQgYW4KCSAqIGVmZmVjdCBub3QgaW5jbHVkZWQgd2l0aCBhbnkgb2YgdGhlIGJ1aWx0LWluIG1hdGVyaWFscy4KCSAqCgkgKiBUaGVyZSBhcmUgdGhlIGZvbGxvd2luZyBub3RlcyB0byBiZWFyIGluIG1pbmQgd2hlbiB1c2luZyBhIGBTaGFkZXJNYXRlcmlhbGA6CgkgKgoJICogLSBgU2hhZGVyTWF0ZXJpYWxgIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkgKiAtIEJ1aWx0IGluIGF0dHJpYnV0ZXMgYW5kIHVuaWZvcm1zIGFyZSBwYXNzZWQgdG8gdGhlIHNoYWRlcnMgYWxvbmcgd2l0aCB5b3VyIGNvZGUuIElmCgkgKiB5b3UgZG9uJ3Qgd2FudCB0aGF0LCB1c2Uge0BsaW5rIFJhd1NoYWRlck1hdGVyaWFsfSBpbnN0ZWFkLgoJICogLSBZb3UgY2FuIHVzZSB0aGUgZGlyZWN0aXZlIGAjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0YCBhbmQgYCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kYAoJICogaW4gb3JkZXIgdG8gdW5yb2xsIGEgYGZvcmAgbG9vcCBpbiBHTFNMIGJ5IHRoZSBzaGFkZXIgcHJlcHJvY2Vzc29yLiBUaGUgZGlyZWN0aXZlIGhhcwoJICogdG8gYmUgcGxhY2VkIHJpZ2h0IGFib3ZlIHRoZSBsb29wLiBUaGUgbG9vcCBmb3JtYXR0aW5nIGhhcyB0byBjb3JyZXNwb25kIHRvIGEgZGVmaW5lZCBzdGFuZGFyZC4KCSAqICAgLSBUaGUgbG9vcCBoYXMgdG8gYmUgW25vcm1hbGl6ZWRde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL05vcm1hbGl6ZWRfbG9vcH0uCgkgKiAgIC0gVGhlIGxvb3AgdmFyaWFibGUgaGFzIHRvIGJlICppKi4KCSAqICAgLSBUaGUgdmFsdWUgYFVOUk9MTEVEX0xPT1BfSU5ERVhgIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCB0aGUgZXhwbGljaXRseQoJICogdmFsdWUgb2YgKmkqIGZvciB0aGUgZ2l2ZW4gaXRlcmF0aW9uIGFuZCBjYW4gYmUgdXNlZCBpbiBwcmVwcm9jZXNzb3IKCSAqIHN0YXRlbWVudHMuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKCB7CgkgKiAJdW5pZm9ybXM6IHsKCSAqIAkJdGltZTogeyB2YWx1ZTogMS4wIH0sCgkgKiAJCXJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBUSFJFRS5WZWN0b3IyKCkgfQoJICogCX0sCgkgKiAJdmVydGV4U2hhZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3ZlcnRleFNoYWRlcicgKS50ZXh0Q29udGVudCwKCSAqIAlmcmFnbWVudFNoYWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdmcmFnbWVudFNoYWRlcicgKS50ZXh0Q29udGVudAoJICogfSApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIE1hdGVyaWFsCgkgKi8KCWNsYXNzIFNoYWRlck1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHNoYWRlciBtYXRlcmlhbC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCgkJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAoJCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAoJCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCgkJICogYnkge0BsaW5rIENvbG9yI3NldH0uCgkJICovCgkJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNTaGFkZXJNYXRlcmlhbCA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnU2hhZGVyTWF0ZXJpYWwnOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgY3VzdG9tIGNvbnN0YW50cyB1c2luZyBgI2RlZmluZWAgZGlyZWN0aXZlcyB3aXRoaW4gdGhlIEdMU0wgY29kZQoJCQkgKiBmb3IgYm90aCB0aGUgdmVydGV4IHNoYWRlciBhbmQgdGhlIGZyYWdtZW50IHNoYWRlcjsgZWFjaCBrZXkvdmFsdWUgcGFpcgoJCQkgKiB5aWVsZHMgYW5vdGhlciBkaXJlY3RpdmUuCgkJCSAqIGBgYGpzCgkJCSAqIGRlZmluZXM6IHsKCQkJICogCUZPTzogMTUsCgkJCSAqIAlCQVI6IHRydWUKCQkJICogfQoJCQkgKiBgYGAKCQkJICogWWllbGRzIHRoZSBsaW5lczoKCQkJICogYGBgCgkJCSAqICNkZWZpbmUgRk9PIDE1CgkJCSAqICNkZWZpbmUgQkFSIHRydWUKCQkJICogYGBgCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLmRlZmluZXMgPSB7fTsKCgkJCS8qKgoJCQkgKiBBbiBvYmplY3Qgb2YgdGhlIGZvcm06CgkJCSAqIGBgYGpzCgkJCSAqIHsKCQkJICogCSJ1bmlmb3JtMSI6IHsgdmFsdWU6IDEuMCB9LAoJCQkgKiAJInVuaWZvcm0yIjogeyB2YWx1ZTogMiB9CgkJCSAqIH0KCQkJICogYGBgCgkJCSAqIHNwZWNpZnlpbmcgdGhlIHVuaWZvcm1zIHRvIGJlIHBhc3NlZCB0byB0aGUgc2hhZGVyIGNvZGU7IGtleXMgYXJlIHVuaWZvcm0KCQkJICogbmFtZXMsIHZhbHVlcyBhcmUgZGVmaW5pdGlvbnMgb2YgdGhlIGZvcm0KCQkJICogYGBgCgkJCSAqIHsKCQkJICogCXZhbHVlOiAxLjAKCQkJICogfQoJCQkgKiBgYGAKCQkJICogd2hlcmUgYHZhbHVlYCBpcyB0aGUgdmFsdWUgb2YgdGhlIHVuaWZvcm0uIE5hbWVzIG11c3QgbWF0Y2ggdGhlIG5hbWUgb2YKCQkJICogdGhlIHVuaWZvcm0sIGFzIGRlZmluZWQgaW4gdGhlIEdMU0wgY29kZS4gTm90ZSB0aGF0IHVuaWZvcm1zIGFyZSByZWZyZXNoZWQKCQkJICogb24gZXZlcnkgZnJhbWUsIHNvIHVwZGF0aW5nIHRoZSB2YWx1ZSBvZiB0aGUgdW5pZm9ybSB3aWxsIGltbWVkaWF0ZWx5CgkJCSAqIHVwZGF0ZSB0aGUgdmFsdWUgYXZhaWxhYmxlIHRvIHRoZSBHTFNMIGNvZGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLnVuaWZvcm1zID0ge307CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB1bmlmb3JtcyBncm91cHMgZm9yIGNvbmZpZ3VyaW5nIFVCT3MuCgkJCSAqCgkJCSAqIEB0eXBlIHtBcnJheTxVbmlmb3Jtc0dyb3VwPn0KCQkJICovCgkJCXRoaXMudW5pZm9ybXNHcm91cHMgPSBbXTsKCgkJCS8qKgoJCQkgKiBWZXJ0ZXggc2hhZGVyIEdMU0wgY29kZS4gVGhpcyBpcyB0aGUgYWN0dWFsIGNvZGUgZm9yIHRoZSBzaGFkZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqLwoJCQl0aGlzLnZlcnRleFNoYWRlciA9IGRlZmF1bHRfdmVydGV4OwoKCQkJLyoqCgkJCSAqIEZyYWdtZW50IHNoYWRlciBHTFNMIGNvZGUuIFRoaXMgaXMgdGhlIGFjdHVhbCBjb2RlIGZvciB0aGUgc2hhZGVyLgoJCQkgKgoJCQkgKiBAdHlwZSB7c3RyaW5nfQoJCQkgKi8KCQkJdGhpcy5mcmFnbWVudFNoYWRlciA9IGRlZmF1bHRfZnJhZ21lbnQ7CgoJCQkvKioKCQkJICogQ29udHJvbHMgbGluZSB0aGlja25lc3Mgb3IgbGluZXMuCgkJCSAqCgkJCSAqIFdlYkdMIGFuZCBXZWJHUFUgaWdub3JlIHRoaXMgc2V0dGluZyBhbmQgYWx3YXlzIHJlbmRlciBsaW5lIHByaW1pdGl2ZXMgd2l0aCBhCgkJCSAqIHdpZHRoIG9mIG9uZSBwaXhlbC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5saW5ld2lkdGggPSAxOwoKCQkJLyoqCgkJCSAqIFJlbmRlcnMgdGhlIGdlb21ldHJ5IGFzIGEgd2lyZWZyYW1lLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgoJCQkvKioKCQkJICogQ29udHJvbHMgdGhlIHRoaWNrbmVzcyBvZiB0aGUgd2lyZWZyYW1lLgoJCQkgKgoJCQkgKiBXZWJHTCBhbmQgV2ViR1BVIGlnbm9yZSB0aGlzIHByb3BlcnR5IGFuZCBhbHdheXMgcmVuZGVyCgkJCSAqIDEgcGl4ZWwgd2lkZSBsaW5lcy4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoKCQkJLyoqCgkJCSAqIERlZmluZSB3aGV0aGVyIHRoZSBtYXRlcmlhbCBjb2xvciBpcyBhZmZlY3RlZCBieSBnbG9iYWwgZm9nIHNldHRpbmdzOyBgdHJ1ZWAKCQkJICogdG8gcGFzcyBmb2cgdW5pZm9ybXMgdG8gdGhlIHNoYWRlci4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmZvZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIHVzZXMgbGlnaHRpbmc7IGB0cnVlYCB0byBwYXNzIHVuaWZvcm0gZGF0YQoJCQkgKiByZWxhdGVkIHRvIGxpZ2h0aW5nIHRvIHRoaXMgc2hhZGVyLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMubGlnaHRzID0gZmFsc2U7CgoJCQkvKioKCQkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgY2xpcHBpbmc7IGB0cnVlYCB0byBsZXQgdGhlIHJlbmRlcmVyCgkJCSAqIHBhc3MgdGhlIGNsaXBwaW5nUGxhbmVzIHVuaWZvcm0uCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5jbGlwcGluZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYHRydWVgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmZvcmNlU2luZ2xlUGFzcyA9IHRydWU7CgoJCQkvKioKCQkJICogVGhpcyBvYmplY3QgYWxsb3dzIHRvIGVuYWJsZSBjZXJ0YWluIFdlYkdMIDIgZXh0ZW5zaW9ucy4KCQkJICoKCQkJICogLSBjbGlwQ3VsbERpc3RhbmNlOiBzZXQgdG8gYHRydWVgIHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIGNsaXBwaW5nCgkJCSAqIC0gbXVsdGlEcmF3OiBzZXQgdG8gYHRydWVgIHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIG11bHRpX2RyYXcgLyBlbmFibGUgZ2xfRHJhd0lECgkJCSAqCgkJCSAqIEB0eXBlIHt7Y2xpcEN1bGxEaXN0YW5jZTpmYWxzZSxtdWx0aURyYXc6ZmFsc2V9fQoJCQkgKi8KCQkJdGhpcy5leHRlbnNpb25zID0gewoJCQkJY2xpcEN1bGxEaXN0YW5jZTogZmFsc2UsIC8vIHNldCB0byB1c2UgdmVydGV4IHNoYWRlciBjbGlwcGluZwoJCQkJbXVsdGlEcmF3OiBmYWxzZSAvLyBzZXQgdG8gdXNlIHZlcnRleCBzaGFkZXIgbXVsdGlfZHJhdyAvIGVuYWJsZSBnbF9EcmF3SUQKCQkJfTsKCgkJCS8qKgoJCQkgKiBXaGVuIHRoZSByZW5kZXJlZCBnZW9tZXRyeSBkb2Vzbid0IGluY2x1ZGUgdGhlc2UgYXR0cmlidXRlcyBidXQgdGhlCgkJCSAqIG1hdGVyaWFsIGRvZXMsIHRoZXNlIGRlZmF1bHQgdmFsdWVzIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBzaGFkZXJzLiBUaGlzCgkJCSAqIGF2b2lkcyBlcnJvcnMgd2hlbiBidWZmZXIgZGF0YSBpcyBtaXNzaW5nLgoJCQkgKgoJCQkgKiAtIGNvbG9yOiBbIDEsIDEsIDEgXQoJCQkgKiAtIHV2OiBbIDAsIDAgXQoJCQkgKiAtIHV2MTogWyAwLCAwIF0KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyA9IHsKCQkJCSdjb2xvcic6IFsgMSwgMSwgMSBdLAoJCQkJJ3V2JzogWyAwLCAwIF0sCgkJCQkndXYxJzogWyAwLCAwIF0KCQkJfTsKCgkJCS8qKgoJCQkgKiBJZiBzZXQsIHRoaXMgY2FsbHMgW2dsLmJpbmRBdHRyaWJMb2NhdGlvbl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dlYkdMUmVuZGVyaW5nQ29udGV4dC9iaW5kQXR0cmliTG9jYXRpb259CgkJCSAqIHRvIGJpbmQgYSBnZW5lcmljIHZlcnRleCBpbmRleCB0byBhbiBhdHRyaWJ1dGUgdmFyaWFibGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMuaW5kZXgwQXR0cmlidXRlTmFtZSA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBDYW4gYmUgdXNlZCB0byBmb3JjZSBhIHVuaWZvcm0gdXBkYXRlIHdoaWxlIGNoYW5naW5nIHVuaWZvcm1zIGluCgkJCSAqIHtAbGluayBPYmplY3QzRCNvbkJlZm9yZVJlbmRlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHRoZSBHTFNMIHZlcnNpb24gb2YgY3VzdG9tIHNoYWRlciBjb2RlLgoJCQkgKgoJCQkgKiBAdHlwZSB7PyhHTFNMMXxHTFNMMyl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuZ2xzbFZlcnNpb24gPSBudWxsOwoKCQkJaWYgKCBwYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJCX0KCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBzb3VyY2UuZnJhZ21lbnRTaGFkZXI7CgkJCXRoaXMudmVydGV4U2hhZGVyID0gc291cmNlLnZlcnRleFNoYWRlcjsKCgkJCXRoaXMudW5pZm9ybXMgPSBjbG9uZVVuaWZvcm1zKCBzb3VyY2UudW5pZm9ybXMgKTsKCQkJdGhpcy51bmlmb3Jtc0dyb3VwcyA9IGNsb25lVW5pZm9ybXNHcm91cHMoIHNvdXJjZS51bmlmb3Jtc0dyb3VwcyApOwoKCQkJdGhpcy5kZWZpbmVzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5kZWZpbmVzICk7CgoJCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCgkJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCQkJdGhpcy5saWdodHMgPSBzb3VyY2UubGlnaHRzOwoJCQl0aGlzLmNsaXBwaW5nID0gc291cmNlLmNsaXBwaW5nOwoKCQkJdGhpcy5leHRlbnNpb25zID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5leHRlbnNpb25zICk7CgoJCQl0aGlzLmdsc2xWZXJzaW9uID0gc291cmNlLmdsc2xWZXJzaW9uOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJdG9KU09OKCBtZXRhICkgewoKCQkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQkJZGF0YS5nbHNsVmVyc2lvbiA9IHRoaXMuZ2xzbFZlcnNpb247CgkJCWRhdGEudW5pZm9ybXMgPSB7fTsKCgkJCWZvciAoIGNvbnN0IG5hbWUgaW4gdGhpcy51bmlmb3JtcyApIHsKCgkJCQljb25zdCB1bmlmb3JtID0gdGhpcy51bmlmb3Jtc1sgbmFtZSBdOwoJCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKCQkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNUZXh0dXJlICkgewoKCQkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJCXR5cGU6ICd0JywKCQkJCQkJdmFsdWU6IHZhbHVlLnRvSlNPTiggbWV0YSApLnV1aWQKCQkJCQl9OwoKCQkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQkJdHlwZTogJ2MnLAoJCQkJCQl2YWx1ZTogdmFsdWUuZ2V0SGV4KCkKCQkJCQl9OwoKCQkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMiApIHsKCgkJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCQl0eXBlOiAndjInLAoJCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQkJfTsKCgkJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjMgKSB7CgoJCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQkJdHlwZTogJ3YzJywKCQkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJCX07CgoJCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3I0ICkgewoKCQkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJCXR5cGU6ICd2NCcsCgkJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKCQkJCQl9OwoKCQkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzTWF0cml4MyApIHsKCgkJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCQl0eXBlOiAnbTMnLAoJCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQkJfTsKCgkJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDQgKSB7CgoJCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQkJdHlwZTogJ200JywKCQkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJCX07CgoJCQkJfSBlbHNlIHsKCgkJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCQl2YWx1ZTogdmFsdWUKCQkJCQl9OwoKCQkJCQkvLyBub3RlOiB0aGUgYXJyYXkgdmFyaWFudHMgdjJ2LCB2M3YsIHY0diwgbTR2IGFuZCB0diBhcmUgbm90IHN1cHBvcnRlZCBzbyBmYXIKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLmRlZmluZXMgKS5sZW5ndGggPiAwICkgZGF0YS5kZWZpbmVzID0gdGhpcy5kZWZpbmVzOwoKCQkJZGF0YS52ZXJ0ZXhTaGFkZXIgPSB0aGlzLnZlcnRleFNoYWRlcjsKCQkJZGF0YS5mcmFnbWVudFNoYWRlciA9IHRoaXMuZnJhZ21lbnRTaGFkZXI7CgoJCQlkYXRhLmxpZ2h0cyA9IHRoaXMubGlnaHRzOwoJCQlkYXRhLmNsaXBwaW5nID0gdGhpcy5jbGlwcGluZzsKCgkJCWNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiB0aGlzLmV4dGVuc2lvbnMgKSB7CgoJCQkJaWYgKCB0aGlzLmV4dGVuc2lvbnNbIGtleSBdID09PSB0cnVlICkgZXh0ZW5zaW9uc1sga2V5IF0gPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCBPYmplY3Qua2V5cyggZXh0ZW5zaW9ucyApLmxlbmd0aCA+IDAgKSBkYXRhLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zOwoKCQkJcmV0dXJuIGRhdGE7CgoJCX0KCgl9CgoJLyoqCgkgKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBjYW1lcmFzLiBUaGlzIGNsYXNzIHNob3VsZCBhbHdheXMgYmUgaW5oZXJpdGVkCgkgKiB3aGVuIHlvdSBidWlsZCBhIG5ldyBjYW1lcmEuCgkgKgoJICogQGFic3RyYWN0CgkgKiBAYXVnbWVudHMgT2JqZWN0M0QKCSAqLwoJY2xhc3MgQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0QgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGNhbWVyYS4KCQkgKi8KCQljb25zdHJ1Y3RvcigpIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0NhbWVyYSA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnQ2FtZXJhJzsKCgkJCS8qKgoJCQkgKiBUaGUgaW52ZXJzZSBvZiB0aGUgY2FtZXJhJ3Mgd29ybGQgbWF0cml4LgoJCQkgKgoJCQkgKiBAdHlwZSB7TWF0cml4NH0KCQkJICovCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRyaXg0fQoJCQkgKi8KCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgaW52ZXJzZSBvZiB0aGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRyaXg0fQoJCQkgKi8KCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCQkvKioKCQkJICogVGhlIGNvb3JkaW5hdGUgc3lzdGVtIGluIHdoaWNoIHRoZSBjYW1lcmEgaXMgdXNlZC4KCQkJICoKCQkJICogQHR5cGUgeyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9CgkJCSAqLwoJCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW07CgoJCX0KCgkJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQkJdGhpcy5tYXRyaXhXb3JsZEludmVyc2UuY29weSggc291cmNlLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoKCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCXRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggc291cmNlLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgoJCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSBzb3VyY2UuY29vcmRpbmF0ZVN5c3RlbTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSAoImxvb2siKSBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIFRoaXMgbWV0aG9kIGlzIG92ZXJ3cml0dGVuIHNpbmNlIGNhbWVyYXMgaGF2ZSBhIGRpZmZlcmVudCBmb3J3YXJkIHZlY3RvciBjb21wYXJlZCB0byBvdGhlcgoJCSAqIDNEIG9iamVjdHMuIEEgY2FtZXJhIGxvb2tzIGRvd24gaXRzIGxvY2FsLCBuZWdhdGl2ZSB6LWF4aXMgYnkgZGVmYXVsdC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIGRpcmVjdGlvbiBpbiB3b3JsZCBzcGFjZS4KCQkgKi8KCQlnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHN1cGVyLmdldFdvcmxkRGlyZWN0aW9uKCB0YXJnZXQgKS5uZWdhdGUoKTsKCgkJfQoKCQl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCQlzdXBlci51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJfQoKCQl1cGRhdGVXb3JsZE1hdHJpeCggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKSB7CgoJCQlzdXBlci51cGRhdGVXb3JsZE1hdHJpeCggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKTsKCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJfQoKCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfQoKCX0KCgljb25zdCBfdjMkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9taW5UYXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7Cgljb25zdCBfbWF4VGFyZ2V0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKCS8qKgoJICogQ2FtZXJhIHRoYXQgdXNlcyBbcGVyc3BlY3RpdmUgcHJvamVjdGlvbl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGVyc3BlY3RpdmVfKGdyYXBoaWNhbCl9LgoJICoKCSAqIFRoaXMgcHJvamVjdGlvbiBtb2RlIGlzIGRlc2lnbmVkIHRvIG1pbWljIHRoZSB3YXkgdGhlIGh1bWFuIGV5ZSBzZWVzLiBJdAoJICogaXMgdGhlIG1vc3QgY29tbW9uIHByb2plY3Rpb24gbW9kZSB1c2VkIGZvciByZW5kZXJpbmcgYSAzRCBzY2VuZS4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA0NSwgd2lkdGggLyBoZWlnaHQsIDEsIDEwMDAgKTsKCSAqIHNjZW5lLmFkZCggY2FtZXJhICk7CgkgKiBgYGAKCSAqCgkgKiBAYXVnbWVudHMgQ2FtZXJhCgkgKi8KCWNsYXNzIFBlcnNwZWN0aXZlQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBwZXJzcGVjdGl2ZSBjYW1lcmEuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gW2Zvdj01MF0gLSBUaGUgdmVydGljYWwgZmllbGQgb2Ygdmlldy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2FzcGVjdD0xXSAtIFRoZSBhc3BlY3QgcmF0aW8uCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuZWFyPTAuMV0gLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2Zhcj0yMDAwXSAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCgkJICovCgkJY29uc3RydWN0b3IoIGZvdiA9IDUwLCBhc3BlY3QgPSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzUGVyc3BlY3RpdmVDYW1lcmEgPSB0cnVlOwoKCQkJdGhpcy50eXBlID0gJ1BlcnNwZWN0aXZlQ2FtZXJhJzsKCgkJCS8qKgoJCQkgKiBUaGUgdmVydGljYWwgZmllbGQgb2YgdmlldywgZnJvbSBib3R0b20gdG8gdG9wIG9mIHZpZXcsCgkJCSAqIGluIGRlZ3JlZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDUwCgkJCSAqLwoJCQl0aGlzLmZvdiA9IGZvdjsKCgkJCS8qKgoJCQkgKiBUaGUgem9vbSBmYWN0b3Igb2YgdGhlIGNhbWVyYS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy56b29tID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4gVGhlIHZhbGlkIHJhbmdlIGlzIGdyZWF0ZXIgdGhhbiBgMGAKCQkJICogYW5kIGxlc3MgdGhhbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmFyfS4KCQkJICoKCQkJICogTm90ZSB0aGF0LCB1bmxpa2UgZm9yIHRoZSB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhfSwgYDBgIGlzIDxlbT5ub3Q8L2VtPiBhCgkJCSAqIHZhbGlkIHZhbHVlIGZvciBhIHBlcnNwZWN0aXZlIGNhbWVyYSdzIG5lYXIgcGxhbmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAuMQoJCQkgKi8KCQkJdGhpcy5uZWFyID0gbmVhcjsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgZmFyIHBsYW5lLiBNdXN0IGJlIGdyZWF0ZXIgdGhhbiB0aGUKCQkJICogY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjbmVhcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDIwMDAKCQkJICovCgkJCXRoaXMuZmFyID0gZmFyOwoKCQkJLyoqCgkJCSAqIE9iamVjdCBkaXN0YW5jZSB1c2VkIGZvciBzdGVyZW9zY29weSBhbmQgZGVwdGgtb2YtZmllbGQgZWZmZWN0cy4gVGhpcwoJCQkgKiBwYXJhbWV0ZXIgZG9lcyBub3QgaW5mbHVlbmNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCB1bmxlc3MgYQoJCQkgKiB7QGxpbmsgU3RlcmVvQ2FtZXJhfSBpcyBiZWluZyB1c2VkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxMAoJCQkgKi8KCQkJdGhpcy5mb2N1cyA9IDEwOwoKCQkJLyoqCgkJCSAqIFRoZSBhc3BlY3QgcmF0aW8sIHVzdWFsbHkgdGhlIGNhbnZhcyB3aWR0aCAvIGNhbnZhcyBoZWlnaHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuYXNwZWN0ID0gYXNwZWN0OwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIGZydXN0dW0gd2luZG93IHNwZWNpZmljYXRpb24uIFRoaXMgcHJvcGVydHkgc2hvdWxkIG5vdCBiZSBlZGl0ZWQKCQkJICogZGlyZWN0bHkgYnV0IHZpYSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0gYW5kIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNjbGVhclZpZXdPZmZzZXR9LgoJCQkgKgoJCQkgKiBAdHlwZSB7P09iamVjdH0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy52aWV3ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBGaWxtIHNpemUgdXNlZCBmb3IgdGhlIGxhcmdlciBheGlzLiBEZWZhdWx0IGlzIGAzNWAgKG1pbGxpbWV0ZXJzKS4gVGhpcwoJCQkgKiBwYXJhbWV0ZXIgZG9lcyBub3QgaW5mbHVlbmNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCB1bmxlc3Mge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1PZmZzZXR9CgkJCSAqIGlzIHNldCB0byBhIG5vbnplcm8gdmFsdWUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDM1CgkJCSAqLwoJCQl0aGlzLmZpbG1HYXVnZSA9IDM1OwoKCQkJLyoqCgkJCSAqIEhvcml6b250YWwgb2ZmLWNlbnRlciBvZmZzZXQgaW4gdGhlIHNhbWUgdW5pdCBhcyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5maWxtT2Zmc2V0ID0gMDsKCgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJCXRoaXMuZm92ID0gc291cmNlLmZvdjsKCQkJdGhpcy56b29tID0gc291cmNlLnpvb207CgoJCQl0aGlzLm5lYXIgPSBzb3VyY2UubmVhcjsKCQkJdGhpcy5mYXIgPSBzb3VyY2UuZmFyOwoJCQl0aGlzLmZvY3VzID0gc291cmNlLmZvY3VzOwoKCQkJdGhpcy5hc3BlY3QgPSBzb3VyY2UuYXNwZWN0OwoJCQl0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnZpZXcgKTsKCgkJCXRoaXMuZmlsbUdhdWdlID0gc291cmNlLmZpbG1HYXVnZTsKCQkJdGhpcy5maWxtT2Zmc2V0ID0gc291cmNlLmZpbG1PZmZzZXQ7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBGT1YgYnkgZm9jYWwgbGVuZ3RoIGluIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCgkJICoKCQkgKiBUaGUgZGVmYXVsdCBmaWxtIGdhdWdlIGlzIDM1LCBzbyB0aGF0IHRoZSBmb2NhbCBsZW5ndGggY2FuIGJlIHNwZWNpZmllZCBmb3IKCQkgKiBhIDM1bW0gKGZ1bGwgZnJhbWUpIGNhbWVyYS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBmb2NhbExlbmd0aCAtIFZhbHVlcyBmb3IgZm9jYWwgbGVuZ3RoIGFuZCBmaWxtIGdhdWdlIG11c3QgaGF2ZSB0aGUgc2FtZSB1bml0LgoJCSAqLwoJCXNldEZvY2FsTGVuZ3RoKCBmb2NhbExlbmd0aCApIHsKCgkJCS8qKiBzZWUge0BsaW5rIGh0dHA6Ly93d3cuYm9iYXRraW5zLmNvbS9waG90b2dyYXBoeS90ZWNobmljYWwvZmllbGRfb2Zfdmlldy5odG1sfSAqLwoJCQljb25zdCB2RXh0ZW50U2xvcGUgPSAwLjUgKiB0aGlzLmdldEZpbG1IZWlnaHQoKSAvIGZvY2FsTGVuZ3RoOwoKCQkJdGhpcy5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggdkV4dGVudFNsb3BlICk7CgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGZvY2FsIGxlbmd0aCBmcm9tIHRoZSBjdXJyZW50IHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmb3Z9IGFuZAoJCSAqIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmaWxtR2F1Z2V9LgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgY29tcHV0ZWQgZm9jYWwgbGVuZ3RoLgoJCSAqLwoJCWdldEZvY2FsTGVuZ3RoKCkgewoKCQkJY29uc3QgdkV4dGVudFNsb3BlID0gTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApOwoKCQkJcmV0dXJuIDAuNSAqIHRoaXMuZ2V0RmlsbUhlaWdodCgpIC8gdkV4dGVudFNsb3BlOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmVydGljYWwgZmllbGQgb2YgdmlldyBhbmdsZSBpbiBkZWdyZWVzIGNvbnNpZGVyaW5nIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSN6b29tfS4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGVmZmVjdGl2ZSBGT1YuCgkJICovCgkJZ2V0RWZmZWN0aXZlRk9WKCkgewoKCQkJcmV0dXJuIFJBRDJERUcgKiAyICogTWF0aC5hdGFuKAoJCQkJTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApIC8gdGhpcy56b29tICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgd2lkdGggb2YgdGhlIGltYWdlIG9uIHRoZSBmaWxtLiBJZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjYXNwZWN0fSBpcyBncmVhdGVyIHRoYW4gb3IKCQkgKiBlcXVhbCB0byBvbmUgKGxhbmRzY2FwZSBmb3JtYXQpLCB0aGUgcmVzdWx0IGVxdWFscyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGZpbG0gd2lkdGguCgkJICovCgkJZ2V0RmlsbVdpZHRoKCkgewoKCQkJLy8gZmlsbSBub3QgY29tcGxldGVseSBjb3ZlcmVkIGluIHBvcnRyYWl0IGZvcm1hdCAoYXNwZWN0IDwgMSkKCQkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4oIHRoaXMuYXNwZWN0LCAxICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgaGVpZ2h0IG9mIHRoZSBpbWFnZSBvbiB0aGUgZmlsbS4gSWYge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2FzcGVjdH0gaXMgZ3JlYXRlciB0aGFuIG9yCgkJICogZXF1YWwgdG8gb25lIChsYW5kc2NhcGUgZm9ybWF0KSwgdGhlIHJlc3VsdCBlcXVhbHMge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBmaWxtIHdpZHRoLgoJCSAqLwoJCWdldEZpbG1IZWlnaHQoKSB7CgoJCQkvLyBmaWxtIG5vdCBjb21wbGV0ZWx5IGNvdmVyZWQgaW4gbGFuZHNjYXBlIGZvcm1hdCAoYXNwZWN0ID4gMSkKCQkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlIC8gTWF0aC5tYXgoIHRoaXMuYXNwZWN0LCAxICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIDJEIGJvdW5kcyBvZiB0aGUgY2FtZXJhJ3Mgdmlld2FibGUgcmVjdGFuZ2xlIGF0IGEgZ2l2ZW4gZGlzdGFuY2UgYWxvbmcgdGhlIHZpZXdpbmcgZGlyZWN0aW9uLgoJCSAqIFNldHMgYG1pblRhcmdldGAgYW5kIGBtYXhUYXJnZXRgIHRvIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgbG93ZXItbGVmdCBhbmQgdXBwZXItcmlnaHQgY29ybmVycyBvZiB0aGUgdmlldyByZWN0YW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgdmlld2luZyBkaXN0YW5jZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1pblRhcmdldCAtIFRoZSBsb3dlci1sZWZ0IGNvcm5lciBvZiB0aGUgdmlldyByZWN0YW5nbGUgaXMgd3JpdHRlbiBpbnRvIHRoaXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gbWF4VGFyZ2V0IC0gVGhlIHVwcGVyLXJpZ2h0IGNvcm5lciBvZiB0aGUgdmlldyByZWN0YW5nbGUgaXMgd3JpdHRlbiBpbnRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWdldFZpZXdCb3VuZHMoIGRpc3RhbmNlLCBtaW5UYXJnZXQsIG1heFRhcmdldCApIHsKCgkJCV92MyQxLnNldCggLTEsIC0xLCAwLjUgKS5hcHBseU1hdHJpeDQoIHRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJCW1pblRhcmdldC5zZXQoIF92MyQxLngsIF92MyQxLnkgKS5tdWx0aXBseVNjYWxhciggLSBkaXN0YW5jZSAvIF92MyQxLnogKTsKCgkJCV92MyQxLnNldCggMSwgMSwgMC41ICkuYXBwbHlNYXRyaXg0KCB0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgoJCQltYXhUYXJnZXQuc2V0KCBfdjMkMS54LCBfdjMkMS55ICkubXVsdGlwbHlTY2FsYXIoIC0gZGlzdGFuY2UgLyBfdjMkMS56ICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIGNhbWVyYSdzIHZpZXdhYmxlIHJlY3RhbmdsZSBhdCBhIGdpdmVuIGRpc3RhbmNlIGFsb25nIHRoZSB2aWV3aW5nIGRpcmVjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSB2aWV3aW5nIGRpc3RhbmNlLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHJlc3VsdCB3aGVyZSB4IGlzIHdpZHRoIGFuZCB5IGlzIGhlaWdodC4KCQkgKiBAcmV0dXJucyB7VmVjdG9yMn0gVGhlIHZpZXcgc2l6ZS4KCQkgKi8KCQlnZXRWaWV3U2l6ZSggZGlzdGFuY2UsIHRhcmdldCApIHsKCgkJCXRoaXMuZ2V0Vmlld0JvdW5kcyggZGlzdGFuY2UsIF9taW5UYXJnZXQsIF9tYXhUYXJnZXQgKTsKCgkJCXJldHVybiB0YXJnZXQuc3ViVmVjdG9ycyggX21heFRhcmdldCwgX21pblRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgYW4gb2Zmc2V0IGluIGEgbGFyZ2VyIGZydXN0dW0uIFRoaXMgaXMgdXNlZnVsIGZvciBtdWx0aS13aW5kb3cgb3IKCQkgKiBtdWx0aS1tb25pdG9yL211bHRpLW1hY2hpbmUgc2V0dXBzLgoJCSAqCgkJICogRm9yIGV4YW1wbGUsIGlmIHlvdSBoYXZlIDN4MiBtb25pdG9ycyBhbmQgZWFjaCBtb25pdG9yIGlzIDE5MjB4MTA4MCBhbmQKCQkgKiB0aGUgbW9uaXRvcnMgYXJlIGluIGdyaWQgbGlrZSB0aGlzCgkJICpgYGAKCQkgKiAgICstLS0rLS0tKy0tLSsKCQkgKiAgIHwgQSB8IEIgfCBDIHwKCQkgKiAgICstLS0rLS0tKy0tLSsKCQkgKiAgIHwgRCB8IEUgfCBGIHwKCQkgKiAgICstLS0rLS0tKy0tLSsKCQkgKmBgYAoJCSAqIHRoZW4gZm9yIGVhY2ggbW9uaXRvciB5b3Ugd291bGQgY2FsbCBpdCBsaWtlIHRoaXM6CgkJICpgYGBqcwoJCSAqIGNvbnN0IHcgPSAxOTIwOwoJCSAqIGNvbnN0IGggPSAxMDgwOwoJCSAqIGNvbnN0IGZ1bGxXaWR0aCA9IHcgKiAzOwoJCSAqIGNvbnN0IGZ1bGxIZWlnaHQgPSBoICogMjsKCQkgKgoJCSAqIC8vIC0tQS0tCgkJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAwLCB3LCBoICk7CgkJICogLy8gLS1CLS0KCQkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDAsIHcsIGggKTsKCQkgKiAvLyAtLUMtLQoJCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAyLCBoICogMCwgdywgaCApOwoJCSAqIC8vIC0tRC0tCgkJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAxLCB3LCBoICk7CgkJICogLy8gLS1FLS0KCQkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDEsIHcsIGggKTsKCQkgKiAvLyAtLUYtLQoJCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAyLCBoICogMSwgdywgaCApOwoJCSAqIGBgYAoJCSAqCgkJICogTm90ZSB0aGVyZSBpcyBubyByZWFzb24gbW9uaXRvcnMgaGF2ZSB0byBiZSB0aGUgc2FtZSBzaXplIG9yIGluIGEgZ3JpZC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsV2lkdGggLSBUaGUgZnVsbCB3aWR0aCBvZiBtdWx0aXZpZXcgc2V0dXAuCgkJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxIZWlnaHQgLSBUaGUgZnVsbCBoZWlnaHQgb2YgbXVsdGl2aWV3IHNldHVwLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGhvcml6b250YWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHN1YmNhbWVyYS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiBzdWJjYW1lcmEuCgkJICovCgkJc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCQkJdGhpcy5hc3BlY3QgPSBmdWxsV2lkdGggLyBmdWxsSGVpZ2h0OwoKCQkJaWYgKCB0aGlzLnZpZXcgPT09IG51bGwgKSB7CgoJCQkJdGhpcy52aWV3ID0gewoJCQkJCWVuYWJsZWQ6IHRydWUsCgkJCQkJZnVsbFdpZHRoOiAxLAoJCQkJCWZ1bGxIZWlnaHQ6IDEsCgkJCQkJb2Zmc2V0WDogMCwKCQkJCQlvZmZzZXRZOiAwLAoJCQkJCXdpZHRoOiAxLAoJCQkJCWhlaWdodDogMQoJCQkJfTsKCgkJCX0KCgkJCXRoaXMudmlldy5lbmFibGVkID0gdHJ1ZTsKCQkJdGhpcy52aWV3LmZ1bGxXaWR0aCA9IGZ1bGxXaWR0aDsKCQkJdGhpcy52aWV3LmZ1bGxIZWlnaHQgPSBmdWxsSGVpZ2h0OwoJCQl0aGlzLnZpZXcub2Zmc2V0WCA9IHg7CgkJCXRoaXMudmlldy5vZmZzZXRZID0geTsKCQkJdGhpcy52aWV3LndpZHRoID0gd2lkdGg7CgkJCXRoaXMudmlldy5oZWlnaHQgPSBoZWlnaHQ7CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSB2aWV3IG9mZnNldCBmcm9tIHRoZSBwcm9qZWN0aW9uIG1hdHJpeC4KCQkgKi8KCQljbGVhclZpZXdPZmZzZXQoKSB7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLnZpZXcuZW5hYmxlZCA9IGZhbHNlOwoKCQkJfQoKCQkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJCX0KCgkJLyoqCgkJICogVXBkYXRlcyB0aGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguIE11c3QgYmUgY2FsbGVkIGFmdGVyIGFueSBjaGFuZ2Ugb2YKCQkgKiBjYW1lcmEgcHJvcGVydGllcy4KCQkgKi8KCQl1cGRhdGVQcm9qZWN0aW9uTWF0cml4KCkgewoKCQkJY29uc3QgbmVhciA9IHRoaXMubmVhcjsKCQkJbGV0IHRvcCA9IG5lYXIgKiBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICkgLyB0aGlzLnpvb207CgkJCWxldCBoZWlnaHQgPSAyICogdG9wOwoJCQlsZXQgd2lkdGggPSB0aGlzLmFzcGVjdCAqIGhlaWdodDsKCQkJbGV0IGxlZnQgPSAtMC41ICogd2lkdGg7CgkJCWNvbnN0IHZpZXcgPSB0aGlzLnZpZXc7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCgkJCQljb25zdCBmdWxsV2lkdGggPSB2aWV3LmZ1bGxXaWR0aCwKCQkJCQlmdWxsSGVpZ2h0ID0gdmlldy5mdWxsSGVpZ2h0OwoKCQkJCWxlZnQgKz0gdmlldy5vZmZzZXRYICogd2lkdGggLyBmdWxsV2lkdGg7CgkJCQl0b3AgLT0gdmlldy5vZmZzZXRZICogaGVpZ2h0IC8gZnVsbEhlaWdodDsKCQkJCXdpZHRoICo9IHZpZXcud2lkdGggLyBmdWxsV2lkdGg7CgkJCQloZWlnaHQgKj0gdmlldy5oZWlnaHQgLyBmdWxsSGVpZ2h0OwoKCQkJfQoKCQkJY29uc3Qgc2tldyA9IHRoaXMuZmlsbU9mZnNldDsKCQkJaWYgKCBza2V3ICE9PSAwICkgbGVmdCArPSBuZWFyICogc2tldyAvIHRoaXMuZ2V0RmlsbVdpZHRoKCk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0LCBsZWZ0ICsgd2lkdGgsIHRvcCwgdG9wIC0gaGVpZ2h0LCBuZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCQl9CgoJCXRvSlNPTiggbWV0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJCWRhdGEub2JqZWN0LmZvdiA9IHRoaXMuZm92OwoJCQlkYXRhLm9iamVjdC56b29tID0gdGhpcy56b29tOwoKCQkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKCQkJZGF0YS5vYmplY3QuZmFyID0gdGhpcy5mYXI7CgkJCWRhdGEub2JqZWN0LmZvY3VzID0gdGhpcy5mb2N1czsKCgkJCWRhdGEub2JqZWN0LmFzcGVjdCA9IHRoaXMuYXNwZWN0OwoKCQkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSBkYXRhLm9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIHRoaXMudmlldyApOwoKCQkJZGF0YS5vYmplY3QuZmlsbUdhdWdlID0gdGhpcy5maWxtR2F1Z2U7CgkJCWRhdGEub2JqZWN0LmZpbG1PZmZzZXQgPSB0aGlzLmZpbG1PZmZzZXQ7CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0KCgljb25zdCBmb3YgPSAtOTA7IC8vIG5lZ2F0aXZlIGZvdiBpcyBub3QgYW4gZXJyb3IKCWNvbnN0IGFzcGVjdCA9IDE7CgoJLyoqCgkgKiBBIHNwZWNpYWwgdHlwZSBvZiBjYW1lcmEgdGhhdCBpcyBwb3NpdGlvbmVkIGluIDNEIHNwYWNlIHRvIHJlbmRlciBpdHMgc3Vycm91bmRpbmdzIGludG8gYQoJICogY3ViZSByZW5kZXIgdGFyZ2V0LiBUaGUgcmVuZGVyIHRhcmdldCBjYW4gdGhlbiBiZSB1c2VkIGFzIGFuIGVudmlyb25tZW50IG1hcCBmb3IgcmVuZGVyaW5nCgkgKiByZWFsdGltZSByZWZsZWN0aW9ucyBpbiB5b3VyIHNjZW5lLgoJICoKCSAqIGBgYGpzCgkgKiAvLyBDcmVhdGUgY3ViZSByZW5kZXIgdGFyZ2V0CgkgKiBjb25zdCBjdWJlUmVuZGVyVGFyZ2V0ID0gbmV3IFRIUkVFLldlYkdMQ3ViZVJlbmRlclRhcmdldCggMjU2LCB7IGdlbmVyYXRlTWlwbWFwczogdHJ1ZSwgbWluRmlsdGVyOiBUSFJFRS5MaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgfSApOwoJICoKCSAqIC8vIENyZWF0ZSBjdWJlIGNhbWVyYQoJICogY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBUSFJFRS5DdWJlQ2FtZXJhKCAxLCAxMDAwMDAsIGN1YmVSZW5kZXJUYXJnZXQgKTsKCSAqIHNjZW5lLmFkZCggY3ViZUNhbWVyYSApOwoJICoKCSAqIC8vIENyZWF0ZSBjYXIKCSAqIGNvbnN0IGNocm9tZU1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBlbnZNYXA6IGN1YmVSZW5kZXJUYXJnZXQudGV4dHVyZSB9ICk7CgkgKiBjb25zdCBjYXIgPSBuZXcgVEhSRUUuTWVzaCggY2FyR2VvbWV0cnksIGNocm9tZU1hdGVyaWFsICk7CgkgKiBzY2VuZS5hZGQoIGNhciApOwoJICoKCSAqIC8vIFVwZGF0ZSB0aGUgcmVuZGVyIHRhcmdldCBjdWJlCgkgKiBjYXIudmlzaWJsZSA9IGZhbHNlOwoJICogY3ViZUNhbWVyYS5wb3NpdGlvbi5jb3B5KCBjYXIucG9zaXRpb24gKTsKCSAqIGN1YmVDYW1lcmEudXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKTsKCSAqCgkgKiAvLyBSZW5kZXIgdGhlIHNjZW5lCgkgKiBjYXIudmlzaWJsZSA9IHRydWU7CgkgKiByZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmEgKTsKCSAqIGBgYAoJICoKCSAqIEBhdWdtZW50cyBPYmplY3QzRAoJICovCgljbGFzcyBDdWJlQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0QgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGN1YmUgY2FtZXJhLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IG5lYXIgLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4KCQkgKiBAcGFyYW0ge1dlYkdMQ3ViZVJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIGN1YmUgcmVuZGVyIHRhcmdldC4KCQkgKi8KCQljb25zdHJ1Y3RvciggbmVhciwgZmFyLCByZW5kZXJUYXJnZXQgKSB7CgoJCQlzdXBlcigpOwoKCQkJdGhpcy50eXBlID0gJ0N1YmVDYW1lcmEnOwoKCQkJLyoqCgkJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBjdWJlIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHtXZWJHTEN1YmVSZW5kZXJUYXJnZXR9CgkJCSAqLwoJCQl0aGlzLnJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKCgkJCS8qKgoJCQkgKiBUaGUgY3VycmVudCBhY3RpdmUgY29vcmRpbmF0ZSBzeXN0ZW0uCgkJCSAqCgkJCSAqIEB0eXBlIHs/KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBUaGUgY3VycmVudCBhY3RpdmUgbWlwbWFwIGxldmVsCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMuYWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoKCQkJY29uc3QgY2FtZXJhUFggPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhUFgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFQWCApOwoKCQkJY29uc3QgY2FtZXJhTlggPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhTlgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFOWCApOwoKCQkJY29uc3QgY2FtZXJhUFkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhUFkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFQWSApOwoKCQkJY29uc3QgY2FtZXJhTlkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhTlkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFOWSApOwoKCQkJY29uc3QgY2FtZXJhUFogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhUFoubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFQWiApOwoKCQkJY29uc3QgY2FtZXJhTlogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhTloubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFOWiApOwoKCQl9CgoJCS8qKgoJCSAqIE11c3QgYmUgY2FsbGVkIHdoZW4gdGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9mIHRoZSBjdWJlIGNhbWVyYSBpcyBjaGFuZ2VkLgoJCSAqLwoJCXVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CgoJCQljb25zdCBjb29yZGluYXRlU3lzdGVtID0gdGhpcy5jb29yZGluYXRlU3lzdGVtOwoKCQkJY29uc3QgY2FtZXJhcyA9IHRoaXMuY2hpbGRyZW4uY29uY2F0KCk7CgoJCQljb25zdCBbIGNhbWVyYVBYLCBjYW1lcmFOWCwgY2FtZXJhUFksIGNhbWVyYU5ZLCBjYW1lcmFQWiwgY2FtZXJhTlogXSA9IGNhbWVyYXM7CgoJCQlmb3IgKCBjb25zdCBjYW1lcmEgb2YgY2FtZXJhcyApIHRoaXMucmVtb3ZlKCBjYW1lcmEgKTsKCgkJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJCWNhbWVyYVBYLnVwLnNldCggMCwgMSwgMCApOwoJCQkJY2FtZXJhUFgubG9va0F0KCAxLCAwLCAwICk7CgoJCQkJY2FtZXJhTlgudXAuc2V0KCAwLCAxLCAwICk7CgkJCQljYW1lcmFOWC5sb29rQXQoIC0xLCAwLCAwICk7CgoJCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAtMSApOwoJCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgoJCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAxICk7CgkJCQljYW1lcmFOWS5sb29rQXQoIDAsIC0xLCAwICk7CgoJCQkJY2FtZXJhUFoudXAuc2V0KCAwLCAxLCAwICk7CgkJCQljYW1lcmFQWi5sb29rQXQoIDAsIDAsIDEgKTsKCgkJCQljYW1lcmFOWi51cC5zZXQoIDAsIDEsIDAgKTsKCQkJCWNhbWVyYU5aLmxvb2tBdCggMCwgMCwgLTEgKTsKCgkJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQkJY2FtZXJhUFgudXAuc2V0KCAwLCAtMSwgMCApOwoJCQkJY2FtZXJhUFgubG9va0F0KCAtMSwgMCwgMCApOwoKCQkJCWNhbWVyYU5YLnVwLnNldCggMCwgLTEsIDAgKTsKCQkJCWNhbWVyYU5YLmxvb2tBdCggMSwgMCwgMCApOwoKCQkJCWNhbWVyYVBZLnVwLnNldCggMCwgMCwgMSApOwoJCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgoJCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAtMSApOwoJCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtMSwgMCApOwoKCQkJCWNhbWVyYVBaLnVwLnNldCggMCwgLTEsIDAgKTsKCQkJCWNhbWVyYVBaLmxvb2tBdCggMCwgMCwgMSApOwoKCQkJCWNhbWVyYU5aLnVwLnNldCggMCwgLTEsIDAgKTsKCQkJCWNhbWVyYU5aLmxvb2tBdCggMCwgMCwgLTEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuQ3ViZUNhbWVyYS51cGRhdGVDb29yZGluYXRlU3lzdGVtKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCQl9CgoJCQlmb3IgKCBjb25zdCBjYW1lcmEgb2YgY2FtZXJhcyApIHsKCgkJCQl0aGlzLmFkZCggY2FtZXJhICk7CgoJCQkJY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogQ2FsbGluZyB0aGlzIG1ldGhvZCB3aWxsIHJlbmRlciB0aGUgZ2l2ZW4gc2NlbmUgd2l0aCB0aGUgZ2l2ZW4gcmVuZGVyZXIKCQkgKiBpbnRvIHRoZSBjdWJlIHJlbmRlciB0YXJnZXQgb2YgdGhlIGNhbWVyYS4KCQkgKgoJCSAqIEBwYXJhbSB7KFJlbmRlcmVyfFdlYkdMUmVuZGVyZXIpfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KCQkgKiBAcGFyYW0ge1NjZW5lfSBzY2VuZSAtIFRoZSBzY2VuZSB0byByZW5kZXIuCgkJICovCgkJdXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKSB7CgoJCQlpZiAoIHRoaXMucGFyZW50ID09PSBudWxsICkgdGhpcy51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJY29uc3QgeyByZW5kZXJUYXJnZXQsIGFjdGl2ZU1pcG1hcExldmVsIH0gPSB0aGlzOwoKCQkJaWYgKCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gIT09IHJlbmRlcmVyLmNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gcmVuZGVyZXIuY29vcmRpbmF0ZVN5c3RlbTsKCgkJCQl0aGlzLnVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKTsKCgkJCX0KCgkJCWNvbnN0IFsgY2FtZXJhUFgsIGNhbWVyYU5YLCBjYW1lcmFQWSwgY2FtZXJhTlksIGNhbWVyYVBaLCBjYW1lcmFOWiBdID0gdGhpcy5jaGlsZHJlbjsKCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJY29uc3QgY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQkJY29uc3QgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCgkJCWNvbnN0IGN1cnJlbnRYckVuYWJsZWQgPSByZW5kZXJlci54ci5lbmFibGVkOwoKCQkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKCQkJY29uc3QgZ2VuZXJhdGVNaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhUFggKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCAxLCBhY3RpdmVNaXBtYXBMZXZlbCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWCApOwoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDIsIGFjdGl2ZU1pcG1hcExldmVsICk7CgkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVBZICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMywgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlkgKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCA0LCBhY3RpdmVNaXBtYXBMZXZlbCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWiApOwoKCQkJLy8gbWlwbWFwcyBhcmUgZ2VuZXJhdGVkIGR1cmluZyB0aGUgbGFzdCBjYWxsIG9mIHJlbmRlcigpCgkJCS8vIGF0IHRoaXMgcG9pbnQsIGFsbCBzaWRlcyBvZiB0aGUgY3ViZSByZW5kZXIgdGFyZ2V0IGFyZSBkZWZpbmVkCgoJCQlyZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBnZW5lcmF0ZU1pcG1hcHM7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgNSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlogKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgY3VycmVudEFjdGl2ZUN1YmVGYWNlLCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgKTsKCgkJCXJlbmRlcmVyLnhyLmVuYWJsZWQgPSBjdXJyZW50WHJFbmFibGVkOwoKCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUubmVlZHNQTVJFTVVwZGF0ZSA9IHRydWU7CgoJCX0KCgl9CgoJLyoqCgkgKiBDcmVhdGVzIGEgY3ViZSB0ZXh0dXJlIG1hZGUgdXAgb2Ygc2l4IGltYWdlcy4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLkN1YmVUZXh0dXJlTG9hZGVyKCk7CgkgKiBsb2FkZXIuc2V0UGF0aCggJ3RleHR1cmVzL2N1YmUvcGlzYS8nICk7CgkgKgoJICogY29uc3QgdGV4dHVyZUN1YmUgPSBsb2FkZXIubG9hZCggWwoJICogCSdweC5wbmcnLCAnbngucG5nJywgJ3B5LnBuZycsICdueS5wbmcnLCAncHoucG5nJywgJ256LnBuZycKCSAqIF0gKTsKCSAqCgkgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmZmYsIGVudk1hcDogdGV4dHVyZUN1YmUgfSApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIFRleHR1cmUKCSAqLwoJY2xhc3MgQ3ViZVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBjdWJlIHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PEltYWdlPn0gW2ltYWdlcz1bXV0gLSBBbiBhcnJheSBob2xkaW5nIGEgaW1hZ2UgZm9yIGVhY2ggc2lkZSBvZiBhIGN1YmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPUN1YmVSZWZsZWN0aW9uTWFwcGluZ10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlIHZhbHVlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBpbWFnZXMgPSBbXSwgbWFwcGluZyA9IEN1YmVSZWZsZWN0aW9uTWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKCQkJc3VwZXIoIGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0N1YmVUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgdGV4dHVyZSBpcyBmbGlwcGVkIGFsb25nIHRoZSB2ZXJ0aWNhbCBheGlzIHdoZW4KCQkJICogdXBsb2FkZWQgdG8gdGhlIEdQVS4KCQkJICoKCQkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKCQl9CgoJCS8qKgoJCSAqIEFsaWFzIGZvciB7QGxpbmsgQ3ViZVRleHR1cmUjaW1hZ2V9LgoJCSAqCgkJICogQHR5cGUge0FycmF5PEltYWdlPn0KCQkgKi8KCQlnZXQgaW1hZ2VzKCkgewoKCQkJcmV0dXJuIHRoaXMuaW1hZ2U7CgoJCX0KCgkJc2V0IGltYWdlcyggdmFsdWUgKSB7CgoJCQl0aGlzLmltYWdlID0gdmFsdWU7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIGN1YmUgcmVuZGVyIHRhcmdldCB1c2VkIGluIGNvbnRleHQgb2Yge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LgoJICoKCSAqIEBhdWdtZW50cyBXZWJHTFJlbmRlclRhcmdldAoJICovCgljbGFzcyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgY3ViZSByZW5kZXIgdGFyZ2V0LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFtzaXplPTFdIC0gVGhlIHNpemUgb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJICogQHBhcmFtIHtSZW5kZXJUYXJnZXR+T3B0aW9uc30gW29wdGlvbnNdIC0gVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBzaXplID0gMSwgb3B0aW9ucyA9IHt9ICkgewoKCQkJc3VwZXIoIHNpemUsIHNpemUsIG9wdGlvbnMgKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCgkJCWNvbnN0IGltYWdlID0geyB3aWR0aDogc2l6ZSwgaGVpZ2h0OiBzaXplLCBkZXB0aDogMSB9OwoJCQljb25zdCBpbWFnZXMgPSBbIGltYWdlLCBpbWFnZSwgaW1hZ2UsIGltYWdlLCBpbWFnZSwgaW1hZ2UgXTsKCgkJCS8qKgoJCQkgKiBPdmVyd3JpdHRlbiB3aXRoIGEgZGlmZmVyZW50IHRleHR1cmUgdHlwZS4KCQkJICoKCQkJICogQHR5cGUge0RhdGFBcnJheVRleHR1cmV9CgkJCSAqLwoJCQl0aGlzLnRleHR1cmUgPSBuZXcgQ3ViZVRleHR1cmUoIGltYWdlcyApOwoJCQl0aGlzLl9zZXRUZXh0dXJlT3B0aW9ucyggb3B0aW9ucyApOwoKCQkJLy8gQnkgY29udmVudGlvbiAtLSBsaWtlbHkgYmFzZWQgb24gdGhlIFJlbmRlck1hbiBzcGVjIGZyb20gdGhlIDE5OTAncyAtLSBjdWJlIG1hcHMgYXJlIHNwZWNpZmllZCBieSBXZWJHTCAoYW5kIHRocmVlLmpzKQoJCQkvLyBpbiBhIGNvb3JkaW5hdGUgc3lzdGVtIGluIHdoaWNoIHBvc2l0aXZlLXggaXMgdG8gdGhlIHJpZ2h0IHdoZW4gbG9va2luZyB1cCB0aGUgcG9zaXRpdmUteiBheGlzIC0tIGluIG90aGVyIHdvcmRzLAoJCQkvLyBpbiBhIGxlZnQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBCeSBjb250aW51aW5nIHRoaXMgY29udmVudGlvbiwgcHJlZXhpc3RpbmcgY3ViZSBtYXBzIGNvbnRpbnVlZCB0byByZW5kZXIgY29ycmVjdGx5LgoKCQkJLy8gdGhyZWUuanMgdXNlcyBhIHJpZ2h0LWhhbmRlZCBjb29yZGluYXRlIHN5c3RlbS4gU28gZW52aXJvbm1lbnQgbWFwcyB1c2VkIGluIHRocmVlLmpzIGFwcGVhciB0byBoYXZlIHB4IGFuZCBueCBzd2FwcGVkCgkJCS8vIGFuZCB0aGUgZmxhZyBpc1JlbmRlclRhcmdldFRleHR1cmUgY29udHJvbHMgdGhpcyBjb252ZXJzaW9uLiBUaGUgZmxpcCBpcyBub3QgcmVxdWlyZWQgd2hlbiB1c2luZyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQudGV4dHVyZQoJCQkvLyBhcyBhIGN1YmUgdGV4dHVyZSAodGhpcyBpcyBkZXRlY3RlZCB3aGVuIGlzUmVuZGVyVGFyZ2V0VGV4dHVyZSBpcyBzZXQgdG8gdHJ1ZSBmb3IgY3ViZSB0ZXh0dXJlcykuCgoJCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmUgdG8gYSBjdWJlIG1hcC4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlLgoJCSAqIEByZXR1cm4ge1dlYkdMQ3ViZVJlbmRlclRhcmdldH0gQSByZWZlcmVuY2UgdG8gdGhpcyBjdWJlIHJlbmRlciB0YXJnZXQuCgkJICovCgkJZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUoIHJlbmRlcmVyLCB0ZXh0dXJlICkgewoKCQkJdGhpcy50ZXh0dXJlLnR5cGUgPSB0ZXh0dXJlLnR5cGU7CgkJCXRoaXMudGV4dHVyZS5jb2xvclNwYWNlID0gdGV4dHVyZS5jb2xvclNwYWNlOwoKCQkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoJCQl0aGlzLnRleHR1cmUubWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgkJCXRoaXMudGV4dHVyZS5tYWdGaWx0ZXIgPSB0ZXh0dXJlLm1hZ0ZpbHRlcjsKCgkJCWNvbnN0IHNoYWRlciA9IHsKCgkJCQl1bmlmb3JtczogewoJCQkJCXRFcXVpcmVjdDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJfSwKCgkJCQl2ZXJ0ZXhTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQkJdmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjsKCgkJCQl2ZWMzIHRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkgewoKCQkJCQlyZXR1cm4gbm9ybWFsaXplKCAoIG1hdHJpeCAqIHZlYzQoIGRpciwgMC4wICkgKS54eXogKTsKCgkJCQl9CgoJCQkJdm9pZCBtYWluKCkgewoKCQkJCQl2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApOwoKCQkJCQkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PgoJCQkJCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD4KCgkJCQl9CgkJCWAsCgoJCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQkJdW5pZm9ybSBzYW1wbGVyMkQgdEVxdWlyZWN0OwoKCQkJCXZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247CgoJCQkJI2luY2x1ZGUgPGNvbW1vbj4KCgkJCQl2b2lkIG1haW4oKSB7CgoJCQkJCXZlYzMgZGlyZWN0aW9uID0gbm9ybWFsaXplKCB2V29ybGREaXJlY3Rpb24gKTsKCgkJCQkJdmVjMiBzYW1wbGVVViA9IGVxdWlyZWN0VXYoIGRpcmVjdGlvbiApOwoKCQkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoIHRFcXVpcmVjdCwgc2FtcGxlVVYgKTsKCgkJCQl9CgkJCWAKCQkJfTsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IEJveEdlb21ldHJ5KCA1LCA1LCA1ICk7CgoJCQljb25zdCBtYXRlcmlhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoKCQkJCW5hbWU6ICdDdWJlbWFwRnJvbUVxdWlyZWN0JywKCgkJCQl1bmlmb3JtczogY2xvbmVVbmlmb3Jtcyggc2hhZGVyLnVuaWZvcm1zICksCgkJCQl2ZXJ0ZXhTaGFkZXI6IHNoYWRlci52ZXJ0ZXhTaGFkZXIsCgkJCQlmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLAoJCQkJc2lkZTogQmFja1NpZGUsCgkJCQlibGVuZGluZzogTm9CbGVuZGluZwoKCQkJfSApOwoKCQkJbWF0ZXJpYWwudW5pZm9ybXMudEVxdWlyZWN0LnZhbHVlID0gdGV4dHVyZTsKCgkJCWNvbnN0IG1lc2ggPSBuZXcgTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCQljb25zdCBjdXJyZW50TWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgoJCQkvLyBBdm9pZCBibHVycmVkIHBvbGVzCgkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgPT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHRleHR1cmUubWluRmlsdGVyID0gTGluZWFyRmlsdGVyOwoKCQkJY29uc3QgY2FtZXJhID0gbmV3IEN1YmVDYW1lcmEoIDEsIDEwLCB0aGlzICk7CgkJCWNhbWVyYS51cGRhdGUoIHJlbmRlcmVyLCBtZXNoICk7CgoJCQl0ZXh0dXJlLm1pbkZpbHRlciA9IGN1cnJlbnRNaW5GaWx0ZXI7CgoJCQltZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQkJbWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDbGVhcnMgdGhpcyBjdWJlIHJlbmRlciB0YXJnZXQuCgkJICoKCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NvbG9yPXRydWVdIC0gV2hldGhlciB0aGUgY29sb3IgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZXB0aD10cnVlXSAtIFdoZXRoZXIgdGhlIGRlcHRoIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCgkJICogQHBhcmFtIHtib29sZWFufSBbc3RlbmNpbD10cnVlXSAtIFdoZXRoZXIgdGhlIHN0ZW5jaWwgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KCQkgKi8KCQljbGVhciggcmVuZGVyZXIsIGNvbG9yID0gdHJ1ZSwgZGVwdGggPSB0cnVlLCBzdGVuY2lsID0gdHJ1ZSApIHsKCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCB0aGlzLCBpICk7CgoJCQkJcmVuZGVyZXIuY2xlYXIoIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCApOwoKCQkJfQoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBjdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBUaGlzIGlzIGFsbW9zdCBpZGVudGljYWwgdG8gYW4ge0BsaW5rIE9iamVjdDNEfS4gSXRzIHB1cnBvc2UgaXMgdG8KCSAqIG1ha2Ugd29ya2luZyB3aXRoIGdyb3VwcyBvZiBvYmplY3RzIHN5bnRhY3RpY2FsbHkgY2xlYXJlci4KCSAqCgkgKiBgYGBqcwoJICogLy8gQ3JlYXRlIGEgZ3JvdXAgYW5kIGFkZCB0aGUgdHdvIGN1YmVzLgoJICogLy8gVGhlc2UgY3ViZXMgY2FuIG5vdyBiZSByb3RhdGVkIC8gc2NhbGVkIGV0YyBhcyBhIGdyb3VwLgoJICogY29uc3QgZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKCSAqCgkgKiBncm91cC5hZGQoIG1lc2hBICk7CgkgKiBncm91cC5hZGQoIG1lc2hCICk7CgkgKgoJICogc2NlbmUuYWRkKCBncm91cCApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIE9iamVjdDNECgkgKi8KCWNsYXNzIEdyb3VwIGV4dGVuZHMgT2JqZWN0M0QgewoKCQljb25zdHJ1Y3RvcigpIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0dyb3VwID0gdHJ1ZTsKCgkJCXRoaXMudHlwZSA9ICdHcm91cCc7CgoJCX0KCgl9CgoJY29uc3QgX21vdmVFdmVudCA9IHsgdHlwZTogJ21vdmUnIH07CgoJLyoqCgkgKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgWFIgY29udHJvbGxlciB3aXRoIGl0cwoJICogZGlmZmVyZW50IGNvb3JkaW5hdGUgc3lzdGVtcy4KCSAqCgkgKiBAcHJpdmF0ZQoJICovCgljbGFzcyBXZWJYUkNvbnRyb2xsZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IFhSIGNvbnRyb2xsZXIuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQkvKioKCQkJICogQSBncm91cCByZXByZXNlbnRpbmcgdGhlIHRhcmdldCByYXkgc3BhY2UKCQkJICogb2YgdGhlIFhSIGNvbnRyb2xsZXIuCgkJCSAqCgkJCSAqIEBwcml2YXRlCgkJCSAqIEB0eXBlIHs/R3JvdXB9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuX3RhcmdldFJheSA9IG51bGw7CgoJCQkvKioKCQkJICogQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGdyaXAgc3BhY2UKCQkJICogb2YgdGhlIFhSIGNvbnRyb2xsZXIuCgkJCSAqCgkJCSAqIEBwcml2YXRlCgkJCSAqIEB0eXBlIHs/R3JvdXB9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuX2dyaXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlCgkJCSAqIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCQkgKgoJCQkgKiBAcHJpdmF0ZQoJCQkgKiBAdHlwZSB7P0dyb3VwfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLl9oYW5kID0gbnVsbDsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCSAqCgkJICogQHJldHVybiB7R3JvdXB9IEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCSAqLwoJCWdldEhhbmRTcGFjZSgpIHsKCgkJCWlmICggdGhpcy5faGFuZCA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLl9oYW5kID0gbmV3IEdyb3VwKCk7CgkJCQl0aGlzLl9oYW5kLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCXRoaXMuX2hhbmQudmlzaWJsZSA9IGZhbHNlOwoKCQkJCXRoaXMuX2hhbmQuam9pbnRzID0ge307CgkJCQl0aGlzLl9oYW5kLmlucHV0U3RhdGUgPSB7IHBpbmNoaW5nOiBmYWxzZSB9OwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuX2hhbmQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHJheSBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKgoJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHJheSBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKi8KCQlnZXRUYXJnZXRSYXlTcGFjZSgpIHsKCgkJCWlmICggdGhpcy5fdGFyZ2V0UmF5ID09PSBudWxsICkgewoKCQkJCXRoaXMuX3RhcmdldFJheSA9IG5ldyBHcm91cCgpOwoJCQkJdGhpcy5fdGFyZ2V0UmF5Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCXRoaXMuX3RhcmdldFJheS52aXNpYmxlID0gZmFsc2U7CgkJCQl0aGlzLl90YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJCXRoaXMuX3RhcmdldFJheS5saW5lYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgkJCQl0aGlzLl90YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgkJCQl0aGlzLl90YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLl90YXJnZXRSYXk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgZ3JpcCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKgoJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgZ3JpcCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKi8KCQlnZXRHcmlwU3BhY2UoKSB7CgoJCQlpZiAoIHRoaXMuX2dyaXAgPT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZ3JpcCA9IG5ldyBHcm91cCgpOwoJCQkJdGhpcy5fZ3JpcC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgkJCQl0aGlzLl9ncmlwLnZpc2libGUgPSBmYWxzZTsKCQkJCXRoaXMuX2dyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJCXRoaXMuX2dyaXAubGluZWFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwoJCQkJdGhpcy5fZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJCXRoaXMuX2dyaXAuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLl9ncmlwOwoKCQl9CgoJCS8qKgoJCSAqIERpc3BhdGNoZXMgdGhlIGdpdmVuIGV2ZW50IHRvIHRoZSBncm91cHMgcmVwcmVzZW50aW5nCgkJICogdGhlIGRpZmZlcmVudCBjb29yZGluYXRlIHNwYWNlcyBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAtIFRoZSBldmVudCB0byBkaXNwYXRjaC4KCQkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJZGlzcGF0Y2hFdmVudCggZXZlbnQgKSB7CgoJCQlpZiAoIHRoaXMuX3RhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLl90YXJnZXRSYXkuZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCgkJCX0KCgkJCWlmICggdGhpcy5fZ3JpcCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLl9ncmlwLmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5faGFuZC5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29ubmVjdHMgdGhlIGNvbnRyb2xsZXIgd2l0aCB0aGUgZ2l2ZW4gWFIgaW5wdXQgc291cmNlLgoJCSAqCgkJICogQHBhcmFtIHtYUklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIFRoZSBpbnB1dCBzb3VyY2UuCgkJICogQHJldHVybiB7V2ViWFJDb250cm9sbGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNvbm5lY3QoIGlucHV0U291cmNlICkgewoKCQkJaWYgKCBpbnB1dFNvdXJjZSAmJiBpbnB1dFNvdXJjZS5oYW5kICkgewoKCQkJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKCQkJCWlmICggaGFuZCApIHsKCgkJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKCQkJCQkJLy8gSW5pdGlhbGl6ZSBoYW5kIHdpdGggam9pbnRzIHdoZW4gY29ubmVjdGVkCgkJCQkJCXRoaXMuX2dldEhhbmRKb2ludCggaGFuZCwgaW5wdXRqb2ludCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdjb25uZWN0ZWQnLCBkYXRhOiBpbnB1dFNvdXJjZSB9ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBEaXNjb25uZWN0cyB0aGUgY29udHJvbGxlciBmcm9tIHRoZSBnaXZlbiBYUiBpbnB1dCBzb3VyY2UuCgkJICoKCQkgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gVGhlIGlucHV0IHNvdXJjZS4KCQkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJZGlzY29ubmVjdCggaW5wdXRTb3VyY2UgKSB7CgoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc2Nvbm5lY3RlZCcsIGRhdGE6IGlucHV0U291cmNlIH0gKTsKCgkJCWlmICggdGhpcy5fdGFyZ2V0UmF5ICE9PSBudWxsICkgewoKCQkJCXRoaXMuX3RhcmdldFJheS52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCQlpZiAoIHRoaXMuX2dyaXAgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZ3JpcC52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5faGFuZC52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSBjb250cm9sbGVyIHdpdGggdGhlIGdpdmVuIGlucHV0IHNvdXJjZSwgWFIgZnJhbWUgYW5kIHJlZmVyZW5jZSBzcGFjZS4KCQkgKiBUaGlzIHVwZGF0ZXMgdGhlIHRyYW5zZm9ybWF0aW9ucyBvZiB0aGUgZ3JvdXBzIHRoYXQgcmVwcmVzZW50IHRoZSBkaWZmZXJlbnQKCQkgKiBjb29yZGluYXRlIHN5c3RlbXMgb2YgdGhlIGNvbnRyb2xsZXIuCgkJICoKCQkgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gVGhlIGlucHV0IHNvdXJjZS4KCQkgKiBAcGFyYW0ge1hSRnJhbWV9IGZyYW1lIC0gVGhlIFhSIGZyYW1lLgoJCSAqIEBwYXJhbSB7WFJSZWZlcmVuY2VTcGFjZX0gcmVmZXJlbmNlU3BhY2UgLSBUaGUgcmVmZXJlbmNlIHNwYWNlLgoJCSAqIEByZXR1cm4ge1dlYlhSQ29udHJvbGxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQl1cGRhdGUoIGlucHV0U291cmNlLCBmcmFtZSwgcmVmZXJlbmNlU3BhY2UgKSB7CgoJCQlsZXQgaW5wdXRQb3NlID0gbnVsbDsKCQkJbGV0IGdyaXBQb3NlID0gbnVsbDsKCQkJbGV0IGhhbmRQb3NlID0gbnVsbDsKCgkJCWNvbnN0IHRhcmdldFJheSA9IHRoaXMuX3RhcmdldFJheTsKCQkJY29uc3QgZ3JpcCA9IHRoaXMuX2dyaXA7CgkJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKCQkJaWYgKCBpbnB1dFNvdXJjZSAmJiBmcmFtZS5zZXNzaW9uLnZpc2liaWxpdHlTdGF0ZSAhPT0gJ3Zpc2libGUtYmx1cnJlZCcgKSB7CgoJCQkJaWYgKCBoYW5kICYmIGlucHV0U291cmNlLmhhbmQgKSB7CgoJCQkJCWhhbmRQb3NlID0gdHJ1ZTsKCgkJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKCQkJCQkJLy8gVXBkYXRlIHRoZSBqb2ludHMgZ3JvdXBzIHdpdGggdGhlIFhSSm9pbnQgcG9zZXMKCQkJCQkJY29uc3Qgam9pbnRQb3NlID0gZnJhbWUuZ2V0Sm9pbnRQb3NlKCBpbnB1dGpvaW50LCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCQkJLy8gVGhlIHRyYW5zZm9ybSBvZiB0aGlzIGpvaW50IHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRoZSBqb2ludCBwb3NlIG9uIGVhY2ggZnJhbWUKCQkJCQkJY29uc3Qgam9pbnQgPSB0aGlzLl9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKTsKCgkJCQkJCWlmICggam9pbnRQb3NlICE9PSBudWxsICkgewoKCQkJCQkJCWpvaW50Lm1hdHJpeC5mcm9tQXJyYXkoIGpvaW50UG9zZS50cmFuc2Zvcm0ubWF0cml4ICk7CgkJCQkJCQlqb2ludC5tYXRyaXguZGVjb21wb3NlKCBqb2ludC5wb3NpdGlvbiwgam9pbnQucm90YXRpb24sIGpvaW50LnNjYWxlICk7CgkJCQkJCQlqb2ludC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQkJCWpvaW50LmpvaW50UmFkaXVzID0gam9pbnRQb3NlLnJhZGl1czsKCgkJCQkJCX0KCgkJCQkJCWpvaW50LnZpc2libGUgPSBqb2ludFBvc2UgIT09IG51bGw7CgoJCQkJCX0KCgkJCQkJLy8gQ3VzdG9tIGV2ZW50cwoKCQkJCQkvLyBDaGVjayBwaW5jaHoKCQkJCQljb25zdCBpbmRleFRpcCA9IGhhbmQuam9pbnRzWyAnaW5kZXgtZmluZ2VyLXRpcCcgXTsKCQkJCQljb25zdCB0aHVtYlRpcCA9IGhhbmQuam9pbnRzWyAndGh1bWItdGlwJyBdOwoJCQkJCWNvbnN0IGRpc3RhbmNlID0gaW5kZXhUaXAucG9zaXRpb24uZGlzdGFuY2VUbyggdGh1bWJUaXAucG9zaXRpb24gKTsKCgkJCQkJY29uc3QgZGlzdGFuY2VUb1BpbmNoID0gMC4wMjsKCQkJCQljb25zdCB0aHJlc2hvbGQgPSAwLjAwNTsKCgkJCQkJaWYgKCBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgJiYgZGlzdGFuY2UgPiBkaXN0YW5jZVRvUGluY2ggKyB0aHJlc2hvbGQgKSB7CgoJCQkJCQloYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSBmYWxzZTsKCQkJCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7CgkJCQkJCQl0eXBlOiAncGluY2hlbmQnLAoJCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKCQkJCQkJCXRhcmdldDogdGhpcwoJCQkJCQl9ICk7CgoJCQkJCX0gZWxzZSBpZiAoICEgaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlIDw9IGRpc3RhbmNlVG9QaW5jaCAtIHRocmVzaG9sZCApIHsKCgkJCQkJCWhhbmQuaW5wdXRTdGF0ZS5waW5jaGluZyA9IHRydWU7CgkJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggewoJCQkJCQkJdHlwZTogJ3BpbmNoc3RhcnQnLAoJCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKCQkJCQkJCXRhcmdldDogdGhpcwoJCQkJCQl9ICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIGdyaXAgIT09IG51bGwgJiYgaW5wdXRTb3VyY2UuZ3JpcFNwYWNlICkgewoKCQkJCQkJZ3JpcFBvc2UgPSBmcmFtZS5nZXRQb3NlKCBpbnB1dFNvdXJjZS5ncmlwU3BhY2UsIHJlZmVyZW5jZVNwYWNlICk7CgoJCQkJCQlpZiAoIGdyaXBQb3NlICE9PSBudWxsICkgewoKCQkJCQkJCWdyaXAubWF0cml4LmZyb21BcnJheSggZ3JpcFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwoJCQkJCQkJZ3JpcC5tYXRyaXguZGVjb21wb3NlKCBncmlwLnBvc2l0aW9uLCBncmlwLnJvdGF0aW9uLCBncmlwLnNjYWxlICk7CgkJCQkJCQlncmlwLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCQkJCWlmICggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKSB7CgoJCQkJCQkJCWdyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwoJCQkJCQkJCWdyaXAubGluZWFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICkgewoKCQkJCQkJCQlncmlwLmhhc0FuZ3VsYXJWZWxvY2l0eSA9IHRydWU7CgkJCQkJCQkJZ3JpcC5hbmd1bGFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCB0YXJnZXRSYXkgIT09IG51bGwgKSB7CgoJCQkJCWlucHV0UG9zZSA9IGZyYW1lLmdldFBvc2UoIGlucHV0U291cmNlLnRhcmdldFJheVNwYWNlLCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCQkvLyBTb21lIHJ1bnRpbWVzIChuYW1lbHkgVml2ZSBDb3Ntb3Mgd2l0aCBWaXZlIE9wZW5YUiBSdW50aW1lKSBoYXZlIG9ubHkgZ3JpcCBzcGFjZSBhbmQgcmF5IHNwYWNlIGlzIGVxdWFsIHRvIGl0CgkJCQkJaWYgKCBpbnB1dFBvc2UgPT09IG51bGwgJiYgZ3JpcFBvc2UgIT09IG51bGwgKSB7CgoJCQkJCQlpbnB1dFBvc2UgPSBncmlwUG9zZTsKCgkJCQkJfQoKCQkJCQlpZiAoIGlucHV0UG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJCXRhcmdldFJheS5tYXRyaXguZnJvbUFycmF5KCBpbnB1dFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwoJCQkJCQl0YXJnZXRSYXkubWF0cml4LmRlY29tcG9zZSggdGFyZ2V0UmF5LnBvc2l0aW9uLCB0YXJnZXRSYXkucm90YXRpb24sIHRhcmdldFJheS5zY2FsZSApOwoJCQkJCQl0YXJnZXRSYXkubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCQlpZiAoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwoJCQkJCQkJdGFyZ2V0UmF5LmxpbmVhclZlbG9jaXR5LmNvcHkoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCgkJCQkJCX0KCgkJCQkJCWlmICggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gdHJ1ZTsKCQkJCQkJCXRhcmdldFJheS5hbmd1bGFyVmVsb2NpdHkuY29weSggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCQl9CgoJCQkJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIF9tb3ZlRXZlbnQgKTsKCgkJCQkJfQoKCQkJCX0KCgoJCQl9CgoJCQlpZiAoIHRhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCQl0YXJnZXRSYXkudmlzaWJsZSA9ICggaW5wdXRQb3NlICE9PSBudWxsICk7CgoJCQl9CgoJCQlpZiAoIGdyaXAgIT09IG51bGwgKSB7CgoJCQkJZ3JpcC52aXNpYmxlID0gKCBncmlwUG9zZSAhPT0gbnVsbCApOwoKCQkJfQoKCQkJaWYgKCBoYW5kICE9PSBudWxsICkgewoKCQkJCWhhbmQudmlzaWJsZSA9ICggaGFuZFBvc2UgIT09IG51bGwgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgam9pbnQgZm9yIHRoZSBnaXZlbiBpbnB1dCBqb2ludC4KCQkgKgoJCSAqIEBwcml2YXRlCgkJICogQHBhcmFtIHtHcm91cH0gaGFuZCAtIFRoZSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgc3BhY2UuCgkJICogQHBhcmFtIHtYUkpvaW50U3BhY2V9IGlucHV0am9pbnQgLSBUaGUgaGFuZCBqb2ludCBkYXRhLgoJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgaGFuZCBqb2ludCBmb3IgdGhlIGdpdmVuIGlucHV0IGpvaW50LgoJCSAqLwoJCV9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKSB7CgoJCQlpZiAoIGhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3Qgam9pbnQgPSBuZXcgR3JvdXAoKTsKCQkJCWpvaW50Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCWpvaW50LnZpc2libGUgPSBmYWxzZTsKCQkJCWhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID0gam9pbnQ7CgoJCQkJaGFuZC5hZGQoIGpvaW50ICk7CgoJCQl9CgoJCQlyZXR1cm4gaGFuZC5qb2ludHNbIGlucHV0am9pbnQuam9pbnROYW1lIF07CgoJCX0KCgl9CgoJLyoqCgkgKiBTY2VuZXMgYWxsb3cgeW91IHRvIHNldCB1cCB3aGF0IGlzIHRvIGJlIHJlbmRlcmVkIGFuZCB3aGVyZSBieSB0aHJlZS5qcy4KCSAqIFRoaXMgaXMgd2hlcmUgeW91IHBsYWNlIDNEIG9iamVjdHMgbGlrZSBtZXNoZXMsIGxpbmVzIG9yIGxpZ2h0cy4KCSAqCgkgKiBAYXVnbWVudHMgT2JqZWN0M0QKCSAqLwoJY2xhc3MgU2NlbmUgZXh0ZW5kcyBPYmplY3QzRCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgc2NlbmUuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNTY2VuZSA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnU2NlbmUnOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGJhY2tncm91bmQgb2YgdGhlIHNjZW5lLiBWYWxpZCBpbnB1dHMgYXJlOgoJCQkgKgoJCQkgKiAtIEEgY29sb3IgZm9yIGRlZmluaW5nIGEgdW5pZm9ybSBjb2xvcmVkIGJhY2tncm91bmQuCgkJCSAqIC0gQSB0ZXh0dXJlIGZvciBkZWZpbmluZyBhIChmbGF0KSB0ZXh0dXJlZCBiYWNrZ3JvdW5kLgoJCQkgKiAtIEN1YmUgdGV4dHVyZXMgb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzIGZvciBkZWZpbmluZyBhIHNreWJveC4KCQkJICoKCQkJICogQHR5cGUgez8oQ29sb3J8VGV4dHVyZSl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYmFja2dyb3VuZCA9IG51bGw7CgoJCQkvKioKCQkJICogU2V0cyB0aGUgZW52aXJvbm1lbnQgbWFwIGZvciBhbGwgcGh5c2ljYWwgbWF0ZXJpYWxzIGluIHRoZSBzY2VuZS4gSG93ZXZlciwKCQkJICogaXQncyBub3QgcG9zc2libGUgdG8gb3ZlcndyaXRlIGFuIGV4aXN0aW5nIHRleHR1cmUgYXNzaWduZWQgdG8gdGhlIGBlbnZNYXBgCgkJCSAqIG1hdGVyaWFsIHByb3BlcnR5LgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuZW52aXJvbm1lbnQgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEEgZm9nIGluc3RhbmNlIGRlZmluaW5nIHRoZSB0eXBlIG9mIGZvZyB0aGF0IGFmZmVjdHMgZXZlcnl0aGluZwoJCQkgKiByZW5kZXJlZCBpbiB0aGUgc2NlbmUuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KEZvZ3xGb2dFeHAyKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5mb2cgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIGJsdXJyaW5lc3Mgb2YgdGhlIGJhY2tncm91bmQuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCgkJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNiYWNrZ3JvdW5kfS4gVmFsaWQgaW5wdXQgaXMgYSBmbG9hdCBiZXR3ZWVuIGAwYAoJCQkgKiBhbmQgYDFgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmJhY2tncm91bmRCbHVycmluZXNzID0gMDsKCgkJCS8qKgoJCQkgKiBBdHRlbnVhdGVzIHRoZSBjb2xvciBvZiB0aGUgYmFja2dyb3VuZC4gT25seSBhcHBsaWVzIHRvIGJhY2tncm91bmQgdGV4dHVyZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuYmFja2dyb3VuZEludGVuc2l0eSA9IDE7CgoJCQkvKioKCQkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBiYWNrZ3JvdW5kIGluIHJhZGlhbnMuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCgkJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNiYWNrZ3JvdW5kfS4KCQkJICoKCQkJICogQHR5cGUge0V1bGVyfQoJCQkgKiBAZGVmYXVsdCAoMCwwLDApCgkJCSAqLwoJCQl0aGlzLmJhY2tncm91bmRSb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoKCQkJLyoqCgkJCSAqIEF0dGVudWF0ZXMgdGhlIGNvbG9yIG9mIHRoZSBlbnZpcm9ubWVudC4gT25seSBpbmZsdWVuY2VzIGVudmlyb25tZW50IG1hcHMKCQkJICogYXNzaWduZWQgdG8ge0BsaW5rIFNjZW5lI2Vudmlyb25tZW50fS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5lbnZpcm9ubWVudEludGVuc2l0eSA9IDE7CgoJCQkvKioKCQkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBlbnZpcm9ubWVudCBtYXAgaW4gcmFkaWFucy4gT25seSBpbmZsdWVuY2VzIHBoeXNpY2FsIG1hdGVyaWFscwoJCQkgKiBpbiB0aGUgc2NlbmUgd2hlbiB7QGxpbmsgU2NlbmUjZW52aXJvbm1lbnR9IGlzIHVzZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtFdWxlcn0KCQkJICogQGRlZmF1bHQgKDAsMCwwKQoJCQkgKi8KCQkJdGhpcy5lbnZpcm9ubWVudFJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CgoJCQkvKioKCQkJICogRm9yY2VzIGV2ZXJ5dGhpbmcgaW4gdGhlIHNjZW5lIHRvIGJlIHJlbmRlcmVkIHdpdGggdGhlIGRlZmluZWQgbWF0ZXJpYWwuIEl0IGlzIHBvc3NpYmxlCgkJCSAqIHRvIGV4Y2x1ZGUgbWF0ZXJpYWxzIGZyb20gb3ZlcnJpZGUgYnkgc2V0dGluZyB7QGxpbmsgTWF0ZXJpYWwjYWxsb3dPdmVycmlkZX0gdG8gYGZhbHNlYC4KCQkJICoKCQkJICogQHR5cGUgez9NYXRlcmlhbH0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5vdmVycmlkZU1hdGVyaWFsID0gbnVsbDsKCgkJCWlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJCX0KCgkJfQoKCQljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCQlpZiAoIHNvdXJjZS5iYWNrZ3JvdW5kICE9PSBudWxsICkgdGhpcy5iYWNrZ3JvdW5kID0gc291cmNlLmJhY2tncm91bmQuY2xvbmUoKTsKCQkJaWYgKCBzb3VyY2UuZW52aXJvbm1lbnQgIT09IG51bGwgKSB0aGlzLmVudmlyb25tZW50ID0gc291cmNlLmVudmlyb25tZW50LmNsb25lKCk7CgkJCWlmICggc291cmNlLmZvZyAhPT0gbnVsbCApIHRoaXMuZm9nID0gc291cmNlLmZvZy5jbG9uZSgpOwoKCQkJdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHNvdXJjZS5iYWNrZ3JvdW5kQmx1cnJpbmVzczsKCQkJdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gc291cmNlLmJhY2tncm91bmRJbnRlbnNpdHk7CgkJCXRoaXMuYmFja2dyb3VuZFJvdGF0aW9uLmNvcHkoIHNvdXJjZS5iYWNrZ3JvdW5kUm90YXRpb24gKTsKCgkJCXRoaXMuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSBzb3VyY2UuZW52aXJvbm1lbnRJbnRlbnNpdHk7CgkJCXRoaXMuZW52aXJvbm1lbnRSb3RhdGlvbi5jb3B5KCBzb3VyY2UuZW52aXJvbm1lbnRSb3RhdGlvbiApOwoKCQkJaWYgKCBzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMub3ZlcnJpZGVNYXRlcmlhbCA9IHNvdXJjZS5vdmVycmlkZU1hdGVyaWFsLmNsb25lKCk7CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCXRvSlNPTiggbWV0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJCWlmICggdGhpcy5mb2cgIT09IG51bGwgKSBkYXRhLm9iamVjdC5mb2cgPSB0aGlzLmZvZy50b0pTT04oKTsKCgkJCWlmICggdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDAgKSBkYXRhLm9iamVjdC5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3M7CgkJCWlmICggdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ICE9PSAxICkgZGF0YS5vYmplY3QuYmFja2dyb3VuZEludGVuc2l0eSA9IHRoaXMuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJZGF0YS5vYmplY3QuYmFja2dyb3VuZFJvdGF0aW9uID0gdGhpcy5iYWNrZ3JvdW5kUm90YXRpb24udG9BcnJheSgpOwoKCQkJaWYgKCB0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5ICE9PSAxICkgZGF0YS5vYmplY3QuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSB0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5OwoJCQlkYXRhLm9iamVjdC5lbnZpcm9ubWVudFJvdGF0aW9uID0gdGhpcy5lbnZpcm9ubWVudFJvdGF0aW9uLnRvQXJyYXkoKTsKCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJfQoKCWNvbnN0IF92ZWN0b3IxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZlY3RvcjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfbm9ybWFsTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpOwoKCS8qKgoJICogQSB0d28gZGltZW5zaW9uYWwgc3VyZmFjZSB0aGF0IGV4dGVuZHMgaW5maW5pdGVseSBpbiAzRCBzcGFjZSwgcmVwcmVzZW50ZWQKCSAqIGluIFtIZXNzaWFuIG5vcm1hbCBmb3JtXXtAbGluayBodHRwOi8vbWF0aHdvcmxkLndvbGZyYW0uY29tL0hlc3NpYW5Ob3JtYWxGb3JtLmh0bWx9CgkgKiBieSBhIHVuaXQgbGVuZ3RoIG5vcm1hbCB2ZWN0b3IgYW5kIGEgY29uc3RhbnQuCgkgKi8KCWNsYXNzIFBsYW5lIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gW25vcm1hbD0oMSwwLDApXSAtIEEgdW5pdCBsZW5ndGggdmVjdG9yIGRlZmluaW5nIHRoZSBub3JtYWwgb2YgdGhlIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbY29uc3RhbnQ9MF0gLSBUaGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIG9yaWdpbiB0byB0aGUgcGxhbmUuCgkJICovCgkJY29uc3RydWN0b3IoIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCAxLCAwLCAwICksIGNvbnN0YW50ID0gMCApIHsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzUGxhbmUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIEEgdW5pdCBsZW5ndGggdmVjdG9yIGRlZmluaW5nIHRoZSBub3JtYWwgb2YgdGhlIHBsYW5lLgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJICovCgkJCXRoaXMubm9ybWFsID0gbm9ybWFsOwoKCQkJLyoqCgkJCSAqIFRoZSBzaWduZWQgZGlzdGFuY2UgZnJvbSB0aGUgb3JpZ2luIHRvIHRoZSBwbGFuZS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHBsYW5lIGNvbXBvbmVudHMgYnkgY29weWluZyB0aGUgZ2l2ZW4gdmFsdWVzLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBub3JtYWwgLSBUaGUgbm9ybWFsLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb25zdGFudCAtIFRoZSBjb25zdGFudC4KCQkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KCQkgKi8KCQlzZXQoIG5vcm1hbCwgY29uc3RhbnQgKSB7CgoJCQl0aGlzLm5vcm1hbC5jb3B5KCBub3JtYWwgKTsKCQkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgcGxhbmUgY29tcG9uZW50cyBieSBkZWZpbmluZyBgeGAsIGB5YCwgYHpgIGFzIHRoZQoJCSAqIHBsYW5lIG5vcm1hbCBhbmQgYHdgIGFzIHRoZSBjb25zdGFudC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIGZvciB0aGUgbm9ybWFsJ3MgeCBjb21wb25lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSBub3JtYWwncyB5IGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBmb3IgdGhlIG5vcm1hbCdzIHogY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIGNvbnN0YW50IHZhbHVlLgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXNldENvbXBvbmVudHMoIHgsIHksIHosIHcgKSB7CgoJCQl0aGlzLm5vcm1hbC5zZXQoIHgsIHksIHogKTsKCQkJdGhpcy5jb25zdGFudCA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBwbGFuZSBmcm9tIHRoZSBnaXZlbiBub3JtYWwgYW5kIGNvcGxhbmFyIHBvaW50ICh0aGF0IGlzIGEgcG9pbnQKCQkgKiB0aGF0IGxpZXMgb250byB0aGUgcGxhbmUpLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBub3JtYWwgLSBUaGUgbm9ybWFsLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIGNvcGxhbmFyIHBvaW50LgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KCBub3JtYWwsIHBvaW50ICkgewoKCQkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJCXRoaXMuY29uc3RhbnQgPSAtIHBvaW50LmRvdCggdGhpcy5ub3JtYWwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHBsYW5lIGZyb20gdGhyZWUgY29wbGFuYXIgcG9pbnRzLiBUaGUgd2luZGluZyBvcmRlciBpcwoJCSAqIGFzc3VtZWQgdG8gYmUgY291bnRlci1jbG9ja3dpc2UsIGFuZCBkZXRlcm1pbmVzIHRoZSBkaXJlY3Rpb24gb2YKCQkgKiB0aGUgcGxhbmUgbm9ybWFsLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcGxhbmFyIHBvaW50LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29wbGFuYXIgcG9pbnQuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcGxhbmFyIHBvaW50LgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXNldEZyb21Db3BsYW5hclBvaW50cyggYSwgYiwgYyApIHsKCgkJCWNvbnN0IG5vcm1hbCA9IF92ZWN0b3IxLnN1YlZlY3RvcnMoIGMsIGIgKS5jcm9zcyggX3ZlY3RvcjIuc3ViVmVjdG9ycyggYSwgYiApICkubm9ybWFsaXplKCk7CgoJCQkvLyBROiBzaG91bGQgYW4gZXJyb3IgYmUgdGhyb3duIGlmIG5vcm1hbCBpcyB6ZXJvIChlLmcuIGRlZ2VuZXJhdGUgcGxhbmUpPwoKCQkJdGhpcy5zZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBhICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcGxhbmUgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGNvcHkuCgkJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCgkJICovCgkJY29weSggcGxhbmUgKSB7CgoJCQl0aGlzLm5vcm1hbC5jb3B5KCBwbGFuZS5ub3JtYWwgKTsKCQkJdGhpcy5jb25zdGFudCA9IHBsYW5lLmNvbnN0YW50OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTm9ybWFsaXplcyB0aGUgcGxhbmUgbm9ybWFsIGFuZCBhZGp1c3RzIHRoZSBjb25zdGFudCBhY2NvcmRpbmdseS4KCQkgKgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCW5vcm1hbGl6ZSgpIHsKCgkJCS8vIE5vdGU6IHdpbGwgbGVhZCB0byBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBwbGFuZSBpcyBpbnZhbGlkLgoKCQkJY29uc3QgaW52ZXJzZU5vcm1hbExlbmd0aCA9IDEuMCAvIHRoaXMubm9ybWFsLmxlbmd0aCgpOwoJCQl0aGlzLm5vcm1hbC5tdWx0aXBseVNjYWxhciggaW52ZXJzZU5vcm1hbExlbmd0aCApOwoJCQl0aGlzLmNvbnN0YW50ICo9IGludmVyc2VOb3JtYWxMZW5ndGg7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBOZWdhdGVzIGJvdGggdGhlIHBsYW5lIG5vcm1hbCBhbmQgdGhlIGNvbnN0YW50LgoJCSAqCgkJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCgkJICovCgkJbmVnYXRlKCkgewoKCQkJdGhpcy5jb25zdGFudCAqPSAtMTsKCQkJdGhpcy5ub3JtYWwubmVnYXRlKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBzaWduZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gcG9pbnQgdG8gdGhpcyBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgZm9yLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNpZ25lZCBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIHRoaXMubm9ybWFsLmRvdCggcG9pbnQgKSArIHRoaXMuY29uc3RhbnQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHNwaGVyZSB0byB0aGlzIHBsYW5lLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgZm9yLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNpZ25lZCBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQlyZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQoIHNwaGVyZS5jZW50ZXIgKSAtIHNwaGVyZS5yYWRpdXM7CgoJCX0KCgkJLyoqCgkJICogUHJvamVjdHMgYSB0aGUgZ2l2ZW4gcG9pbnQgb250byB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIHByb2plY3QuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgcHJvamVjdGVkIHBvaW50IG9uIHRoZSBwbGFuZS4KCQkgKi8KCQlwcm9qZWN0UG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLm5vcm1hbCwgLSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGludGVyc2VjdGlvbiBwb2ludCBvZiB0aGUgcGFzc2VkIGxpbmUgYW5kIHRoZSBwbGFuZS4gUmV0dXJucwoJCSAqIGBudWxsYCBpZiB0aGUgbGluZSBkb2VzIG5vdCBpbnRlcnNlY3QuIFJldHVybnMgdGhlIGxpbmUncyBzdGFydGluZyBwb2ludCBpZgoJCSAqIHRoZSBsaW5lIGlzIGNvcGxhbmFyIHdpdGggdGhlIHBsYW5lLgoJCSAqCgkJICogQHBhcmFtIHtMaW5lM30gbGluZSAtIFRoZSBsaW5lIHRvIGNvbXB1dGUgdGhlIGludGVyc2VjdGlvbiBmb3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVyc2VjdGlvbiBwb2ludC4KCQkgKi8KCQlpbnRlcnNlY3RMaW5lKCBsaW5lLCB0YXJnZXQgKSB7CgoJCQljb25zdCBkaXJlY3Rpb24gPSBsaW5lLmRlbHRhKCBfdmVjdG9yMSApOwoKCQkJY29uc3QgZGVub21pbmF0b3IgPSB0aGlzLm5vcm1hbC5kb3QoIGRpcmVjdGlvbiApOwoKCQkJaWYgKCBkZW5vbWluYXRvciA9PT0gMCApIHsKCgkJCQkvLyBsaW5lIGlzIGNvcGxhbmFyLCByZXR1cm4gb3JpZ2luCgkJCQlpZiAoIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICkgPT09IDAgKSB7CgoJCQkJCXJldHVybiB0YXJnZXQuY29weSggbGluZS5zdGFydCApOwoKCQkJCX0KCgkJCQkvLyBVbnN1cmUgaWYgdGhpcyBpcyB0aGUgY29ycmVjdCBtZXRob2QgdG8gaGFuZGxlIHRoaXMgY2FzZS4KCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJY29uc3QgdCA9IC0gKCBsaW5lLnN0YXJ0LmRvdCggdGhpcy5ub3JtYWwgKSArIHRoaXMuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQkJaWYgKCB0IDwgMCB8fCB0ID4gMSApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggbGluZS5zdGFydCApLmFkZFNjYWxlZFZlY3RvciggZGlyZWN0aW9uLCB0ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGxpbmUgc2VnbWVudCBpbnRlcnNlY3RzIHdpdGggKHBhc3NlcyB0aHJvdWdoKSB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge0xpbmUzfSBsaW5lIC0gVGhlIGxpbmUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQgaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0xpbmUoIGxpbmUgKSB7CgoJCQkvLyBOb3RlOiB0aGlzIHRlc3RzIGlmIGEgbGluZSBpbnRlcnNlY3RzIHRoZSBwbGFuZSwgbm90IHdoZXRoZXIgaXQgKG9yIGl0cyBlbmQtcG9pbnRzKSBhcmUgY29wbGFuYXIgd2l0aCBpdC4KCgkJCWNvbnN0IHN0YXJ0U2lnbiA9IHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICk7CgkJCWNvbnN0IGVuZFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5lbmQgKTsKCgkJCXJldHVybiAoIHN0YXJ0U2lnbiA8IDAgJiYgZW5kU2lnbiA+IDAgKSB8fCAoIGVuZFNpZ24gPCAwICYmIHN0YXJ0U2lnbiA+IDAgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIGJvdW5kaW5nIHNwaGVyZSB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYW5lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQlyZXR1cm4gc3BoZXJlLmludGVyc2VjdHNQbGFuZSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBjb3BsYW5hciB2ZWN0b3IgdG8gdGhlIHBsYW5lLCBieSBjYWxjdWxhdGluZyB0aGUKCQkgKiBwcm9qZWN0aW9uIG9mIHRoZSBub3JtYWwgYXQgdGhlIG9yaWdpbiBvbnRvIHRoZSBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNvcGxhbmFyIHBvaW50LgoJCSAqLwoJCWNvcGxhbmFyUG9pbnQoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5ub3JtYWwgKS5tdWx0aXBseVNjYWxhciggLSB0aGlzLmNvbnN0YW50ICk7CgoJCX0KCgkJLyoqCgkJICogQXBwbHkgYSA0eDQgbWF0cml4IHRvIHRoZSBwbGFuZS4gVGhlIG1hdHJpeCBtdXN0IGJlIGFuIGFmZmluZSwgaG9tb2dlbmVvdXMgdHJhbnNmb3JtLgoJCSAqCgkJICogVGhlIG9wdGlvbmFsIG5vcm1hbCBtYXRyaXggY2FuIGJlIHByZS1jb21wdXRlZCBsaWtlIHNvOgoJCSAqIGBgYGpzCgkJICogY29uc3Qgb3B0aW9uYWxOb3JtYWxNYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgkJICogYGBgCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICogQHBhcmFtIHtNYXRyaXg0fSBbb3B0aW9uYWxOb3JtYWxNYXRyaXhdIC0gQSBwcmUtY29tcHV0ZWQgbm9ybWFsIG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KCQkgKi8KCQlhcHBseU1hdHJpeDQoIG1hdHJpeCwgb3B0aW9uYWxOb3JtYWxNYXRyaXggKSB7CgoJCQljb25zdCBub3JtYWxNYXRyaXggPSBvcHRpb25hbE5vcm1hbE1hdHJpeCB8fCBfbm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgoJCQljb25zdCByZWZlcmVuY2VQb2ludCA9IHRoaXMuY29wbGFuYXJQb2ludCggX3ZlY3RvcjEgKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJY29uc3Qgbm9ybWFsID0gdGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTsKCgkJCXRoaXMuY29uc3RhbnQgPSAtIHJlZmVyZW5jZVBvaW50LmRvdCggbm9ybWFsICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGVzIHRoZSBwbGFuZSBieSB0aGUgZGlzdGFuY2UgZGVmaW5lZCBieSB0aGUgZ2l2ZW4gb2Zmc2V0IHZlY3Rvci4KCQkgKiBOb3RlIHRoYXQgdGhpcyBvbmx5IGFmZmVjdHMgdGhlIHBsYW5lIGNvbnN0YW50IGFuZCB3aWxsIG5vdCBhZmZlY3QgdGhlIG5vcm1hbCB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXRyYW5zbGF0ZSggb2Zmc2V0ICkgewoKCQkJdGhpcy5jb25zdGFudCAtPSBvZmZzZXQuZG90KCB0aGlzLm5vcm1hbCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBwbGFuZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcGxhbmUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggcGxhbmUgKSB7CgoJCQlyZXR1cm4gcGxhbmUubm9ybWFsLmVxdWFscyggdGhpcy5ub3JtYWwgKSAmJiAoIHBsYW5lLmNvbnN0YW50ID09PSB0aGlzLmNvbnN0YW50ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBwbGFuZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7UGxhbmV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfQoKCX0KCgljb25zdCBfc3BoZXJlJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKCWNvbnN0IF9kZWZhdWx0U3ByaXRlQ2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMC41LCAwLjUgKTsKCWNvbnN0IF92ZWN0b3IkNiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIEZydXN0dW1zIGFyZSB1c2VkIHRvIGRldGVybWluZSB3aGF0IGlzIGluc2lkZSB0aGUgY2FtZXJhJ3MgZmllbGQgb2Ygdmlldy4KCSAqIFRoZXkgaGVscCBzcGVlZCB1cCB0aGUgcmVuZGVyaW5nIHByb2Nlc3MgLSBvYmplY3RzIHdoaWNoIGxpZSBvdXRzaWRlIGEgY2FtZXJhJ3MKCSAqIGZydXN0dW0gY2FuIHNhZmVseSBiZSBleGNsdWRlZCBmcm9tIHJlbmRlcmluZy4KCSAqCgkgKiBUaGlzIGNsYXNzIGlzIG1haW5seSBpbnRlbmRlZCBmb3IgdXNlIGludGVybmFsbHkgYnkgYSByZW5kZXJlci4KCSAqLwoJY2xhc3MgRnJ1c3R1bSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZnJ1c3R1bS4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwMF0gLSBUaGUgZmlyc3QgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcGFyYW0ge1BsYW5lfSBbcDFdIC0gVGhlIHNlY29uZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwMl0gLSBUaGUgdGhpcmQgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcGFyYW0ge1BsYW5lfSBbcDNdIC0gVGhlIGZvdXJ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwNF0gLSBUaGUgZmlmdGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcGFyYW0ge1BsYW5lfSBbcDVdIC0gVGhlIHNpeHRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCgkJICovCgkJY29uc3RydWN0b3IoIHAwID0gbmV3IFBsYW5lKCksIHAxID0gbmV3IFBsYW5lKCksIHAyID0gbmV3IFBsYW5lKCksIHAzID0gbmV3IFBsYW5lKCksIHA0ID0gbmV3IFBsYW5lKCksIHA1ID0gbmV3IFBsYW5lKCkgKSB7CgoJCQkvKioKCQkJICogVGhpcyBhcnJheSBob2xkcyB0aGUgcGxhbmVzIHRoYXQgZW5jbG9zZSB0aGUgZnJ1c3R1bS4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PFBsYW5lPn0KCQkJICovCgkJCXRoaXMucGxhbmVzID0gWyBwMCwgcDEsIHAyLCBwMywgcDQsIHA1IF07CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgZnJ1c3R1bSBwbGFuZXMgYnkgY29weWluZyB0aGUgZ2l2ZW4gcGxhbmVzLgoJCSAqCgkJICogQHBhcmFtIHtQbGFuZX0gW3AwXSAtIFRoZSBmaXJzdCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwMV0gLSBUaGUgc2Vjb25kIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCgkJICogQHBhcmFtIHtQbGFuZX0gW3AyXSAtIFRoZSB0aGlyZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwM10gLSBUaGUgZm91cnRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCgkJICogQHBhcmFtIHtQbGFuZX0gW3A0XSAtIFRoZSBmaWZ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwNV0gLSBUaGUgc2l4dGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIHJlZmVyZW5jZSB0byB0aGlzIGZydXN0dW0uCgkJICovCgkJc2V0KCBwMCwgcDEsIHAyLCBwMywgcDQsIHA1ICkgewoKCQkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgoJCQlwbGFuZXNbIDAgXS5jb3B5KCBwMCApOwoJCQlwbGFuZXNbIDEgXS5jb3B5KCBwMSApOwoJCQlwbGFuZXNbIDIgXS5jb3B5KCBwMiApOwoJCQlwbGFuZXNbIDMgXS5jb3B5KCBwMyApOwoJCQlwbGFuZXNbIDQgXS5jb3B5KCBwNCApOwoJCQlwbGFuZXNbIDUgXS5jb3B5KCBwNSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGZydXN0dW0gdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7RnJ1c3R1bX0gZnJ1c3R1bSAtIFRoZSBmcnVzdHVtIHRvIGNvcHkuCgkJICogQHJldHVybiB7RnJ1c3R1bX0gQSByZWZlcmVuY2UgdG8gdGhpcyBmcnVzdHVtLgoJCSAqLwoJCWNvcHkoIGZydXN0dW0gKSB7CgoJCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJcGxhbmVzWyBpIF0uY29weSggZnJ1c3R1bS5wbGFuZXNbIGkgXSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgZnJ1c3R1bSBwbGFuZXMgZnJvbSB0aGUgZ2l2ZW4gcHJvamVjdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgcHJvamVjdGlvbiBtYXRyaXguCgkJICogQHBhcmFtIHsoV2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0pfSBjb29yZGluYXRlU3lzdGVtIC0gVGhlIGNvb3JkaW5hdGUgc3lzdGVtLgoJCSAqIEByZXR1cm4ge0ZydXN0dW19IEEgcmVmZXJlbmNlIHRvIHRoaXMgZnJ1c3R1bS4KCQkgKi8KCQlzZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggbSwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgkJCWNvbnN0IG1lMCA9IG1lWyAwIF0sIG1lMSA9IG1lWyAxIF0sIG1lMiA9IG1lWyAyIF0sIG1lMyA9IG1lWyAzIF07CgkJCWNvbnN0IG1lNCA9IG1lWyA0IF0sIG1lNSA9IG1lWyA1IF0sIG1lNiA9IG1lWyA2IF0sIG1lNyA9IG1lWyA3IF07CgkJCWNvbnN0IG1lOCA9IG1lWyA4IF0sIG1lOSA9IG1lWyA5IF0sIG1lMTAgPSBtZVsgMTAgXSwgbWUxMSA9IG1lWyAxMSBdOwoJCQljb25zdCBtZTEyID0gbWVbIDEyIF0sIG1lMTMgPSBtZVsgMTMgXSwgbWUxNCA9IG1lWyAxNCBdLCBtZTE1ID0gbWVbIDE1IF07CgoJCQlwbGFuZXNbIDAgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTAsIG1lNyAtIG1lNCwgbWUxMSAtIG1lOCwgbWUxNSAtIG1lMTIgKS5ub3JtYWxpemUoKTsKCQkJcGxhbmVzWyAxIF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUwLCBtZTcgKyBtZTQsIG1lMTEgKyBtZTgsIG1lMTUgKyBtZTEyICkubm9ybWFsaXplKCk7CgkJCXBsYW5lc1sgMiBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMSwgbWU3ICsgbWU1LCBtZTExICsgbWU5LCBtZTE1ICsgbWUxMyApLm5vcm1hbGl6ZSgpOwoJCQlwbGFuZXNbIDMgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTEsIG1lNyAtIG1lNSwgbWUxMSAtIG1lOSwgbWUxNSAtIG1lMTMgKS5ub3JtYWxpemUoKTsKCQkJcGxhbmVzWyA0IF0uc2V0Q29tcG9uZW50cyggbWUzIC0gbWUyLCBtZTcgLSBtZTYsIG1lMTEgLSBtZTEwLCBtZTE1IC0gbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQkJcGxhbmVzWyA1IF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUyLCBtZTcgKyBtZTYsIG1lMTEgKyBtZTEwLCBtZTE1ICsgbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTIsIG1lNiwgbWUxMCwgbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQkJfSBlbHNlIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5GcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgM0Qgb2JqZWN0J3MgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0uCgkJICoKCQkgKiBOb3RlIHRoYXQgdGhlIDNEIG9iamVjdCBtdXN0IGhhdmUgYSBnZW9tZXRyeSBzbyB0aGF0IHRoZSBib3VuZGluZyBzcGhlcmUgY2FuIGJlIGNhbGN1bGF0ZWQuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgM0Qgb2JqZWN0J3MgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0gb3Igbm90LgoJCSAqLwoJCWludGVyc2VjdHNPYmplY3QoIG9iamVjdCApIHsKCgkJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBvYmplY3QuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQkJX3NwaGVyZSQzLmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSApLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoKCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJCQlfc3BoZXJlJDMuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHNwcml0ZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgoJCSAqCgkJICogQHBhcmFtIHtTcHJpdGV9IHNwcml0ZSAtIFRoZSBzcHJpdGUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBzcHJpdGUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c1Nwcml0ZSggc3ByaXRlICkgewoKCQkJX3NwaGVyZSQzLmNlbnRlci5zZXQoIDAsIDAsIDAgKTsKCgkJCWNvbnN0IG9mZnNldCA9IF9kZWZhdWx0U3ByaXRlQ2VudGVyLmRpc3RhbmNlVG8oIHNwcml0ZS5jZW50ZXIgKTsKCgkJCV9zcGhlcmUkMy5yYWRpdXMgPSAwLjcwNzEwNjc4MTE4NjU0NzYgKyBvZmZzZXQ7CgkJCV9zcGhlcmUkMy5hcHBseU1hdHJpeDQoIHNwcml0ZS5tYXRyaXhXb3JsZCApOwoKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBib3VuZGluZyBzcGhlcmUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBzcGhlcmUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKCQkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgkJCWNvbnN0IGNlbnRlciA9IHNwaGVyZS5jZW50ZXI7CgkJCWNvbnN0IG5lZ1JhZGl1cyA9IC0gc3BoZXJlLnJhZGl1czsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJY29uc3QgZGlzdGFuY2UgPSBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIGNlbnRlciApOwoKCQkJCWlmICggZGlzdGFuY2UgPCBuZWdSYWRpdXMgKSB7CgoJCQkJCXJldHVybiBmYWxzZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0uCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBib3ggaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCWNvbnN0IHBsYW5lID0gcGxhbmVzWyBpIF07CgoJCQkJLy8gY29ybmVyIGF0IG1heCBkaXN0YW5jZQoKCQkJCV92ZWN0b3IkNi54ID0gcGxhbmUubm9ybWFsLnggPiAwID8gYm94Lm1heC54IDogYm94Lm1pbi54OwoJCQkJX3ZlY3RvciQ2LnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CgkJCQlfdmVjdG9yJDYueiA9IHBsYW5lLm5vcm1hbC56ID4gMCA/IGJveC5tYXgueiA6IGJveC5taW4uejsKCgkJCQlpZiAoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggX3ZlY3RvciQ2ICkgPCAwICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50IGxpZXMgd2l0aGluIHRoZSBmcnVzdHVtLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHBvaW50IGxpZXMgd2l0aGluIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgoJCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJaWYgKCBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgPCAwICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBmcnVzdHVtIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIHRleHR1cmUgZm9yIHVzZSB3aXRoIGEgdmlkZW8uCgkgKgoJICogYGBganMKCSAqIC8vIGFzc3VtaW5nIHlvdSBoYXZlIGNyZWF0ZWQgYSBIVE1MIHZpZGVvIGVsZW1lbnQgd2l0aCBpZD0idmlkZW8iCgkgKiBjb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAndmlkZW8nICk7CgkgKiBjb25zdCB0ZXh0dXJlID0gbmV3IFRIUkVFLlZpZGVvVGV4dHVyZSggdmlkZW8gKTsKCSAqIGBgYAoJICoKCSAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIHRleHR1cmUsIGl0cyBkaW1lbnNpb25zLCBmb3JtYXQsIGFuZCB0eXBlCgkgKiBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwgY2FsbCB7QGxpbmsgVGV4dHVyZSNkaXNwb3NlfSBvbiB0aGUgdGV4dHVyZSBhbmQgaW5zdGFudGlhdGUgYSBuZXcgb25lLgoJICoKCSAqIEBhdWdtZW50cyBUZXh0dXJlCgkgKi8KCWNsYXNzIFZpZGVvVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHZpZGVvIHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0ge0hUTUxWaWRlb0VsZW1lbnR9IHZpZGVvIC0gVGhlIHZpZGVvIGVsZW1lbnQgdG8gdXNlIGFzIGEgZGF0YSBzb3VyY2UgZm9yIHRoZSB0ZXh0dXJlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIgPSBMaW5lYXJGaWx0ZXIsIG1pbkZpbHRlciA9IExpbmVhckZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICkgewoKCQkJc3VwZXIoIHZpZGVvLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzVmlkZW9UZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIG1pcG1hcHMgKGlmIHBvc3NpYmxlKSBmb3IgYSB0ZXh0dXJlLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkJZnVuY3Rpb24gdXBkYXRlVmlkZW8oKSB7CgoJCQkJc2NvcGUubmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJdmlkZW8ucmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjayggdXBkYXRlVmlkZW8gKTsKCgkJCX0KCgkJCWlmICggJ3JlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2snIGluIHZpZGVvICkgewoKCQkJCXZpZGVvLnJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2soIHVwZGF0ZVZpZGVvICk7CgoJCQl9CgoJCX0KCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuaW1hZ2UgKS5jb3B5KCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIGF1dG9tYXRpY2FsbHkgYnkgdGhlIHJlbmRlcmVyIGFuZCBzZXRzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfQoJCSAqIHRvIGB0cnVlYCBldmVyeSB0aW1lIGEgbmV3IGZyYW1lIGlzIGF2YWlsYWJsZS4KCQkgKgoJCSAqIE9ubHkgcmVsZXZhbnQgaWYgYHJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2tgIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhlIGJyb3dzZXIuCgkJICovCgkJdXBkYXRlKCkgewoKCQkJY29uc3QgdmlkZW8gPSB0aGlzLmltYWdlOwoJCQljb25zdCBoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPSAncmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjaycgaW4gdmlkZW87CgoJCQlpZiAoIGhhc1ZpZGVvRnJhbWVDYWxsYmFjayA9PT0gZmFsc2UgJiYgdmlkZW8ucmVhZHlTdGF0ZSA+PSB2aWRlby5IQVZFX0NVUlJFTlRfREFUQSApIHsKCgkJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJfQoKCX0KCgkvKioKCSAqIFRoaXMgY2xhc3MgY2FuIGJlIHVzZWQgdG8gYXV0b21hdGljYWxseSBzYXZlIHRoZSBkZXB0aCBpbmZvcm1hdGlvbiBvZiBhCgkgKiByZW5kZXJpbmcgaW50byBhIHRleHR1cmUuCgkgKgoJICogQGF1Z21lbnRzIFRleHR1cmUKCSAqLwoJY2xhc3MgRGVwdGhUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZGVwdGggdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3R5cGU9VW5zaWduZWRJbnRUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPVRleHR1cmUuREVGQVVMVF9NQVBQSU5HXSAtIFRoZSB0ZXh0dXJlIG1hcHBpbmcuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwUz1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwUyB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBUPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBUIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFnRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWFnIGZpbHRlciB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21pbkZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1pbiBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PURlcHRoRm9ybWF0XSAtIFRoZSB0ZXh0dXJlIGZvcm1hdC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB3aWR0aCwgaGVpZ2h0LCB0eXBlID0gVW5zaWduZWRJbnRUeXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIG1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIGFuaXNvdHJvcHksIGZvcm1hdCA9IERlcHRoRm9ybWF0LCBkZXB0aCA9IDEgKSB7CgoJCQlpZiAoIGZvcm1hdCAhPT0gRGVwdGhGb3JtYXQgJiYgZm9ybWF0ICE9PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnRGVwdGhUZXh0dXJlIGZvcm1hdCBtdXN0IGJlIGVpdGhlciBUSFJFRS5EZXB0aEZvcm1hdCBvciBUSFJFRS5EZXB0aFN0ZW5jaWxGb3JtYXQnICk7CgoJCQl9CgoJCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IGRlcHRoIH07CgoJCQlzdXBlciggaW1hZ2UsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNEZXB0aFRleHR1cmUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSB0ZXh0dXJlIGlzIGZsaXBwZWQgYWxvbmcgdGhlIHZlcnRpY2FsIGF4aXMgd2hlbgoJCQkgKiB1cGxvYWRlZCB0byB0aGUgR1BVLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmZsaXBZID0gZmFsc2U7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KCQkJICoKCQkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBDb2RlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRlcHRoIGNvbXBhcmUgZnVuY3Rpb24uCgkJCSAqCgkJCSAqIEB0eXBlIHs/KE5ldmVyQ29tcGFyZXxMZXNzQ29tcGFyZXxFcXVhbENvbXBhcmV8TGVzc0VxdWFsQ29tcGFyZXxHcmVhdGVyQ29tcGFyZXxOb3RFcXVhbENvbXBhcmV8R3JlYXRlckVxdWFsQ29tcGFyZXxBbHdheXNDb21wYXJlKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBudWxsOwoKCQl9CgoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMuc291cmNlID0gbmV3IFNvdXJjZSggT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5pbWFnZSApICk7IC8vIHNlZSAjMzA1NDAKCQkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBzb3VyY2UuY29tcGFyZUZ1bmN0aW9uOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJdG9KU09OKCBtZXRhICkgewoKCQkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQkJaWYgKCB0aGlzLmNvbXBhcmVGdW5jdGlvbiAhPT0gbnVsbCApIGRhdGEuY29tcGFyZUZ1bmN0aW9uID0gdGhpcy5jb21wYXJlRnVuY3Rpb247CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0KCgkvKioKCSAqIEEgZ2VvbWV0cnkgY2xhc3MgZm9yIHJlcHJlc2VudGluZyBhIHBsYW5lLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KCAxLCAxICk7CgkgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSApOwoJICogY29uc3QgcGxhbmUgPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkgKiBzY2VuZS5hZGQoIHBsYW5lICk7CgkgKiBgYGAKCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyR2VvbWV0cnkKCSAqLwoJY2xhc3MgUGxhbmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBwbGFuZSBnZW9tZXRyeS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggYWxvbmcgdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQgYWxvbmcgdGhlIFkgYXhpcwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGhTZWdtZW50cz0xXSAtIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgYWxvbmcgdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodFNlZ21lbnRzPTFdIC0gVGhlIG51bWJlciBvZiBzZWdtZW50cyBhbG9uZyB0aGUgWSBheGlzLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIHdpZHRoU2VnbWVudHMgPSAxLCBoZWlnaHRTZWdtZW50cyA9IDEgKSB7CgoJCQlzdXBlcigpOwoKCQkJdGhpcy50eXBlID0gJ1BsYW5lR2VvbWV0cnknOwoKCQkJLyoqCgkJCSAqIEhvbGRzIHRoZSBjb25zdHJ1Y3RvciBwYXJhbWV0ZXJzIHRoYXQgaGF2ZSBiZWVuCgkJCSAqIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGdlb21ldHJ5LiBBbnkgbW9kaWZpY2F0aW9uCgkJCSAqIGFmdGVyIGluc3RhbnRpYXRpb24gZG9lcyBub3QgY2hhbmdlIHRoZSBnZW9tZXRyeS4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJCXdpZHRoOiB3aWR0aCwKCQkJCWhlaWdodDogaGVpZ2h0LAoJCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKCQkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cwoJCQl9OwoKCQkJY29uc3Qgd2lkdGhfaGFsZiA9IHdpZHRoIC8gMjsKCQkJY29uc3QgaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyOwoKCQkJY29uc3QgZ3JpZFggPSBNYXRoLmZsb29yKCB3aWR0aFNlZ21lbnRzICk7CgkJCWNvbnN0IGdyaWRZID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKTsKCgkJCWNvbnN0IGdyaWRYMSA9IGdyaWRYICsgMTsKCQkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKCQkJY29uc3Qgc2VnbWVudF93aWR0aCA9IHdpZHRoIC8gZ3JpZFg7CgkJCWNvbnN0IHNlZ21lbnRfaGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgoJCQkvLwoKCQkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCQljb25zdCBub3JtYWxzID0gW107CgkJCWNvbnN0IHV2cyA9IFtdOwoKCQkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5ICsrICkgewoKCQkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRfaGVpZ2h0IC0gaGVpZ2h0X2hhbGY7CgoJCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKCQkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50X3dpZHRoIC0gd2lkdGhfaGFsZjsKCgkJCQkJdmVydGljZXMucHVzaCggeCwgLSB5LCAwICk7CgoJCQkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJCXV2cy5wdXNoKCAxIC0gKCBpeSAvIGdyaWRZICkgKTsKCgkJCQl9CgoJCQl9CgoJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCgkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCArKyApIHsKCgkJCQkJY29uc3QgYSA9IGl4ICsgZ3JpZFgxICogaXk7CgkJCQkJY29uc3QgYiA9IGl4ICsgZ3JpZFgxICogKCBpeSArIDEgKTsKCQkJCQljb25zdCBjID0gKCBpeCArIDEgKSArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQkJY29uc3QgZCA9ICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRmFjdG9yeSBtZXRob2QgZm9yIGNyZWF0aW5nIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgZnJvbSB0aGUgZ2l2ZW4KCQkgKiBKU09OIG9iamVjdC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCgkJICogQHJldHVybiB7UGxhbmVHZW9tZXRyeX0gQSBuZXcgaW5zdGFuY2UuCgkJICovCgkJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQkJcmV0dXJuIG5ldyBQbGFuZUdlb21ldHJ5KCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIG1hdGVyaWFsIGZvciBkcmF3aW5nIGdlb21ldHJ5IGJ5IGRlcHRoLiBEZXB0aCBpcyBiYXNlZCBvZmYgb2YgdGhlIGNhbWVyYQoJICogbmVhciBhbmQgZmFyIHBsYW5lLiBXaGl0ZSBpcyBuZWFyZXN0LCBibGFjayBpcyBmYXJ0aGVzdC4KCSAqCgkgKiBAYXVnbWVudHMgTWF0ZXJpYWwKCSAqLwoJY2xhc3MgTWVzaERlcHRoTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgbWVzaCBkZXB0aCBtYXRlcmlhbC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCgkJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAoJCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAoJCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCgkJICogYnkge0BsaW5rIENvbG9yI3NldH0uCgkJICovCgkJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNNZXNoRGVwdGhNYXRlcmlhbCA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnTWVzaERlcHRoTWF0ZXJpYWwnOwoKCQkJLyoqCgkJCSAqIFR5cGUgZm9yIGRlcHRoIHBhY2tpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHsoQmFzaWNEZXB0aFBhY2tpbmd8UkdCQURlcHRoUGFja2luZ3xSR0JEZXB0aFBhY2tpbmd8UkdEZXB0aFBhY2tpbmcpfQoJCQkgKiBAZGVmYXVsdCBCYXNpY0RlcHRoUGFja2luZwoJCQkgKi8KCQkJdGhpcy5kZXB0aFBhY2tpbmcgPSBCYXNpY0RlcHRoUGFja2luZzsKCgkJCS8qKgoJCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAoJCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5tYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKCQkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KCQkJICoKCQkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCgkJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCgkJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKCQkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAoJCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGRpc3BsYWNlbWVudCBtYXAgYWZmZWN0cyB0aGUgcG9zaXRpb24gb2YgdGhlIG1lc2gncyB2ZXJ0aWNlcy4gVW5saWtlCgkJCSAqIG90aGVyIG1hcHMgd2hpY2ggb25seSBhZmZlY3QgdGhlIGxpZ2h0IGFuZCBzaGFkZSBvZiB0aGUgbWF0ZXJpYWwgdGhlCgkJCSAqIGRpc3BsYWNlZCB2ZXJ0aWNlcyBjYW4gY2FzdCBzaGFkb3dzLCBibG9jayBvdGhlciBvYmplY3RzLCBhbmQgb3RoZXJ3aXNlCgkJCSAqIGFjdCBhcyByZWFsIGdlb21ldHJ5LiBUaGUgZGlzcGxhY2VtZW50IHRleHR1cmUgaXMgYW4gaW1hZ2Ugd2hlcmUgdGhlIHZhbHVlCgkJCSAqIG9mIGVhY2ggcGl4ZWwgKHdoaXRlIGJlaW5nIHRoZSBoaWdoZXN0KSBpcyBtYXBwZWQgYWdhaW5zdCwgYW5kCgkJCSAqIHJlcG9zaXRpb25zLCB0aGUgdmVydGljZXMgb2YgdGhlIG1lc2guCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEhvdyBtdWNoIHRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIG1lc2ggKHdoZXJlIGJsYWNrIGlzIG5vCgkJCSAqIGRpc3BsYWNlbWVudCwgYW5kIHdoaXRlIGlzIG1heGltdW0gZGlzcGxhY2VtZW50KS4gV2l0aG91dCBhIGRpc3BsYWNlbWVudAoJCQkgKiBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgb2Zmc2V0IG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwJ3MgdmFsdWVzIG9uIHRoZSBtZXNoJ3MgdmVydGljZXMuCgkJCSAqIFRoZSBiaWFzIGlzIGFkZGVkIHRvIHRoZSBzY2FsZWQgc2FtcGxlIG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwLgoJCQkgKiBXaXRob3V0IGEgZGlzcGxhY2VtZW50IG1hcCBzZXQsIHRoaXMgdmFsdWUgaXMgbm90IGFwcGxpZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCQkvKioKCQkJICogUmVuZGVycyB0aGUgZ2VvbWV0cnkgYXMgYSB3aXJlZnJhbWUuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBDb250cm9scyB0aGUgdGhpY2tuZXNzIG9mIHRoZSB3aXJlZnJhbWUuCgkJCSAqCgkJCSAqIFdlYkdMIGFuZCBXZWJHUFUgaWdub3JlIHRoaXMgcHJvcGVydHkgYW5kIGFsd2F5cyByZW5kZXIKCQkJICogMSBwaXhlbCB3aWRlIGxpbmVzLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCQl9CgoJCWNvcHkoIHNvdXJjZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQkJdGhpcy5kZXB0aFBhY2tpbmcgPSBzb3VyY2UuZGVwdGhQYWNraW5nOwoKCQkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfQoKCS8qKgoJICogQSBtYXRlcmlhbCB1c2VkIGludGVybmFsbHkgZm9yIGltcGxlbWVudGluZyBzaGFkb3cgbWFwcGluZyB3aXRoCgkgKiBwb2ludCBsaWdodHMuCgkgKgoJICogQ2FuIGFsc28gYmUgdXNlZCB0byBjdXN0b21pemUgdGhlIHNoYWRvdyBjYXN0aW5nIG9mIGFuIG9iamVjdCBieSBhc3NpZ25pbmcKCSAqIGFuIGluc3RhbmNlIG9mIGBNZXNoRGlzdGFuY2VNYXRlcmlhbGAgdG8ge0BsaW5rIE9iamVjdDNEI2N1c3RvbURpc3RhbmNlTWF0ZXJpYWx9LgoJICogVGhlIGZvbGxvd2luZyBleGFtcGxlcyBkZW1vbnN0cmF0ZXMgdGhpcyBhcHByb2FjaCBpbiBvcmRlciB0byBlbnN1cmUKCSAqIHRyYW5zcGFyZW50IHBhcnRzIG9mIG9iamVjdHMgZG8gbm8gY2FzdCBzaGFkb3dzLgoJICoKCSAqIEBhdWdtZW50cyBNYXRlcmlhbAoJICovCgljbGFzcyBNZXNoRGlzdGFuY2VNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBtZXNoIGRpc3RhbmNlIG1hdGVyaWFsLgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IFtwYXJhbWV0ZXJzXSAtIEFuIG9iamVjdCB3aXRoIG9uZSBvciBtb3JlIHByb3BlcnRpZXMKCQkgKiBkZWZpbmluZyB0aGUgbWF0ZXJpYWwncyBhcHBlYXJhbmNlLiBBbnkgcHJvcGVydHkgb2YgdGhlIG1hdGVyaWFsCgkJICogKGluY2x1ZGluZyBhbnkgcHJvcGVydHkgZnJvbSBpbmhlcml0ZWQgbWF0ZXJpYWxzKSBjYW4gYmUgcGFzc2VkCgkJICogaW4gaGVyZS4gQ29sb3IgdmFsdWVzIGNhbiBiZSBwYXNzZWQgYW55IHR5cGUgb2YgdmFsdWUgYWNjZXB0ZWQKCQkgKiBieSB7QGxpbmsgQ29sb3Ijc2V0fS4KCQkgKi8KCQljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc01lc2hEaXN0YW5jZU1hdGVyaWFsID0gdHJ1ZTsKCgkJCXRoaXMudHlwZSA9ICdNZXNoRGlzdGFuY2VNYXRlcmlhbCc7CgoJCQkvKioKCQkJICogVGhlIGNvbG9yIG1hcC4gTWF5IG9wdGlvbmFsbHkgaW5jbHVkZSBhbiBhbHBoYSBjaGFubmVsLCB0eXBpY2FsbHkgY29tYmluZWQKCQkJICogd2l0aCB7QGxpbmsgTWF0ZXJpYWwjdHJhbnNwYXJlbnR9IG9yIHtAbGluayBNYXRlcmlhbCNhbHBoYVRlc3R9LgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMubWFwID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBUaGUgYWxwaGEgbWFwIGlzIGEgZ3JheXNjYWxlIHRleHR1cmUgdGhhdCBjb250cm9scyB0aGUgb3BhY2l0eSBhY3Jvc3MgdGhlCgkJCSAqIHN1cmZhY2UgKGJsYWNrOiBmdWxseSB0cmFuc3BhcmVudDsgd2hpdGU6IGZ1bGx5IG9wYXF1ZSkuCgkJCSAqCgkJCSAqIE9ubHkgdGhlIGNvbG9yIG9mIHRoZSB0ZXh0dXJlIGlzIHVzZWQsIGlnbm9yaW5nIHRoZSBhbHBoYSBjaGFubmVsIGlmIG9uZQoJCQkgKiBleGlzdHMuIEZvciBSR0IgYW5kIFJHQkEgdGV4dHVyZXMsIHRoZSByZW5kZXJlciB3aWxsIHVzZSB0aGUgZ3JlZW4gY2hhbm5lbAoJCQkgKiB3aGVuIHNhbXBsaW5nIHRoaXMgdGV4dHVyZSBkdWUgdG8gdGhlIGV4dHJhIGJpdCBvZiBwcmVjaXNpb24gcHJvdmlkZWQgZm9yCgkJCSAqIGdyZWVuIGluIERYVC1jb21wcmVzc2VkIGFuZCB1bmNvbXByZXNzZWQgUkdCIDU2NSBmb3JtYXRzLiBMdW1pbmFuY2Utb25seSBhbmQKCQkJICogbHVtaW5hbmNlL2FscGhhIHRleHR1cmVzIHdpbGwgYWxzbyBzdGlsbCB3b3JrIGFzIGV4cGVjdGVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBtZXNoJ3MgdmVydGljZXMuIFVubGlrZQoJCQkgKiBvdGhlciBtYXBzIHdoaWNoIG9ubHkgYWZmZWN0IHRoZSBsaWdodCBhbmQgc2hhZGUgb2YgdGhlIG1hdGVyaWFsIHRoZQoJCQkgKiBkaXNwbGFjZWQgdmVydGljZXMgY2FuIGNhc3Qgc2hhZG93cywgYmxvY2sgb3RoZXIgb2JqZWN0cywgYW5kIG90aGVyd2lzZQoJCQkgKiBhY3QgYXMgcmVhbCBnZW9tZXRyeS4gVGhlIGRpc3BsYWNlbWVudCB0ZXh0dXJlIGlzIGFuIGltYWdlIHdoZXJlIHRoZSB2YWx1ZQoJCQkgKiBvZiBlYWNoIHBpeGVsICh3aGl0ZSBiZWluZyB0aGUgaGlnaGVzdCkgaXMgbWFwcGVkIGFnYWluc3QsIGFuZAoJCQkgKiByZXBvc2l0aW9ucywgdGhlIHZlcnRpY2VzIG9mIHRoZSBtZXNoLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBIb3cgbXVjaCB0aGUgZGlzcGxhY2VtZW50IG1hcCBhZmZlY3RzIHRoZSBtZXNoICh3aGVyZSBibGFjayBpcyBubwoJCQkgKiBkaXNwbGFjZW1lbnQsIGFuZCB3aGl0ZSBpcyBtYXhpbXVtIGRpc3BsYWNlbWVudCkuIFdpdGhvdXQgYSBkaXNwbGFjZW1lbnQKCQkJICogbWFwIHNldCwgdGhpcyB2YWx1ZSBpcyBub3QgYXBwbGllZC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgoJCQkvKioKCQkJICogVGhlIG9mZnNldCBvZiB0aGUgZGlzcGxhY2VtZW50IG1hcCdzIHZhbHVlcyBvbiB0aGUgbWVzaCdzIHZlcnRpY2VzLgoJCQkgKiBUaGUgYmlhcyBpcyBhZGRlZCB0byB0aGUgc2NhbGVkIHNhbXBsZSBvZiB0aGUgZGlzcGxhY2VtZW50IG1hcC4KCQkJICogV2l0aG91dCBhIGRpc3BsYWNlbWVudCBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwoKCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9CgoJLyoqCgkgKiBAY2xhc3MKCSAqIEBjbGFzc2Rlc2MgQSBzaW1wbGUgY2FjaGluZyBzeXN0ZW0sIHVzZWQgaW50ZXJuYWxseSBieSB7QGxpbmsgRmlsZUxvYWRlcn0uCgkgKiBUbyBlbmFibGUgY2FjaGluZyBhY3Jvc3MgYWxsIGxvYWRlcnMgdGhhdCB1c2Uge0BsaW5rIEZpbGVMb2FkZXJ9LCBhZGQgYFRIUkVFLkNhY2hlLmVuYWJsZWQgPSB0cnVlLmAgb25jZSBpbiB5b3VyIGFwcC4KCSAqIEBoaWRlY29uc3RydWN0b3IKCSAqLwoJY29uc3QgQ2FjaGUgPSB7CgoJCS8qKgoJCSAqIFdoZXRoZXIgY2FjaGluZyBpcyBlbmFibGVkIG9yIG5vdC4KCQkgKgoJCSAqIEBzdGF0aWMKCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkgKiBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCWVuYWJsZWQ6IGZhbHNlLAoKCQkvKioKCQkgKiBBIGRpY3Rpb25hcnkgdGhhdCBob2xkcyBjYWNoZWQgZmlsZXMuCgkJICoKCQkgKiBAc3RhdGljCgkJICogQHR5cGUge09iamVjdDxzdHJpbmcsT2JqZWN0Pn0KCQkgKi8KCQlmaWxlczoge30sCgoJCS8qKgoJCSAqIEFkZHMgYSBjYWNoZSBlbnRyeSB3aXRoIGEga2V5IHRvIHJlZmVyZW5jZSB0aGUgZmlsZS4gSWYgdGhpcyBrZXkgYWxyZWFkeQoJCSAqIGhvbGRzIGEgZmlsZSwgaXQgaXMgb3ZlcndyaXR0ZW4uCgkJICoKCQkgKiBAc3RhdGljCgkJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KCQkgKiBAcGFyYW0ge09iamVjdH0gZmlsZSAtICBUaGUgZmlsZSB0byBiZSBjYWNoZWQuCgkJICovCgkJYWRkOiBmdW5jdGlvbiAoIGtleSwgZmlsZSApIHsKCgkJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQ2FjaGUnLCAnQWRkaW5nIGtleTonLCBrZXkgKTsKCgkJCXRoaXMuZmlsZXNbIGtleSBdID0gZmlsZTsKCgkJfSwKCgkJLyoqCgkJICogR2V0cyB0aGUgY2FjaGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4ga2V5LgoJCSAqCgkJICogQHN0YXRpYwoJCSAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSBUaGUga2V5IHRvIHJlZmVyZW5jZSB0aGUgY2FjaGVkIGZpbGUuCgkJICogQHJldHVybiB7T2JqZWN0fHVuZGVmaW5lZH0gVGhlIGNhY2hlZCBmaWxlLiBJZiB0aGUga2V5IGRvZXMgbm90IGV4aXN0IGB1bmRlZmluZWRgIGlzIHJldHVybmVkLgoJCSAqLwoJCWdldDogZnVuY3Rpb24gKCBrZXkgKSB7CgoJCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLkNhY2hlJywgJ0NoZWNraW5nIGtleTonLCBrZXkgKTsKCgkJCXJldHVybiB0aGlzLmZpbGVzWyBrZXkgXTsKCgkJfSwKCgkJLyoqCgkJICogUmVtb3ZlcyB0aGUgY2FjaGVkIGZpbGUgYXNzb2NpYXRlZCB3aXRoIHRoZSBnaXZlbiBrZXkuCgkJICoKCQkgKiBAc3RhdGljCgkJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KCQkgKi8KCQlyZW1vdmU6IGZ1bmN0aW9uICgga2V5ICkgewoKCQkJZGVsZXRlIHRoaXMuZmlsZXNbIGtleSBdOwoKCQl9LAoKCQkvKioKCQkgKiBSZW1vdmUgYWxsIHZhbHVlcyBmcm9tIHRoZSBjYWNoZS4KCQkgKgoJCSAqIEBzdGF0aWMKCQkgKi8KCQljbGVhcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5maWxlcyA9IHt9OwoKCQl9CgoJfTsKCgkvKioKCSAqIEhhbmRsZXMgYW5kIGtlZXBzIHRyYWNrIG9mIGxvYWRlZCBhbmQgcGVuZGluZyBkYXRhLiBBIGRlZmF1bHQgZ2xvYmFsCgkgKiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzIGlzIGNyZWF0ZWQgYW5kIHVzZWQgYnkgbG9hZGVycyBpZiBub3Qgc3VwcGxpZWQKCSAqIG1hbnVhbGx5LgoJICoKCSAqIEluIGdlbmVyYWwgdGhhdCBzaG91bGQgYmUgc3VmZmljaWVudCwgaG93ZXZlciB0aGVyZSBhcmUgdGltZXMgd2hlbiBpdCBjYW4KCSAqIGJlIHVzZWZ1bCB0byBoYXZlIHNlcGFyYXRlIGxvYWRlcnMgLSBmb3IgZXhhbXBsZSBpZiB5b3Ugd2FudCB0byBzaG93CgkgKiBzZXBhcmF0ZSBsb2FkaW5nIGJhcnMgZm9yIG9iamVjdHMgYW5kIHRleHR1cmVzLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBtYW5hZ2VyID0gbmV3IFRIUkVFLkxvYWRpbmdNYW5hZ2VyKCk7CgkgKiBtYW5hZ2VyLm9uTG9hZCA9ICgpID0+IGNvbnNvbGUubG9nKCAnTG9hZGluZyBjb21wbGV0ZSEnICk7CgkgKgoJICogY29uc3QgbG9hZGVyMSA9IG5ldyBPQkpMb2FkZXIoIG1hbmFnZXIgKTsKCSAqIGNvbnN0IGxvYWRlcjIgPSBuZXcgQ29sbGFkYUxvYWRlciggbWFuYWdlciApOwoJICogYGBgCgkgKi8KCWNsYXNzIExvYWRpbmdNYW5hZ2VyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBsb2FkaW5nIG1hbmFnZXIuCgkJICoKCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Mb2FkXSAtIEV4ZWN1dGVzIHdoZW4gYWxsIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gW29uUHJvZ3Jlc3NdIC0gRXhlY3V0ZXMgd2hlbiBzaW5nbGUgaXRlbXMgaGF2ZSBiZWVuIGxvYWRlZC4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25FcnJvcl0gLSBFeGVjdXRlcyB3aGVuIGFuIGVycm9yIG9jY3Vycy4KCQkgKi8KCQljb25zdHJ1Y3Rvciggb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkJbGV0IGlzTG9hZGluZyA9IGZhbHNlOwoJCQlsZXQgaXRlbXNMb2FkZWQgPSAwOwoJCQlsZXQgaXRlbXNUb3RhbCA9IDA7CgkJCWxldCB1cmxNb2RpZmllciA9IHVuZGVmaW5lZDsKCQkJY29uc3QgaGFuZGxlcnMgPSBbXTsKCgkJCS8vIFJlZmVyIHRvICM1Njg5IGZvciB0aGUgcmVhc29uIHdoeSB3ZSBkb24ndCBzZXQgLm9uU3RhcnQKCQkJLy8gaW4gdGhlIGNvbnN0cnVjdG9yCgoJCQkvKioKCQkJICogRXhlY3V0ZXMgd2hlbiBhbiBpdGVtIHN0YXJ0cyBsb2FkaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMub25TdGFydCA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBFeGVjdXRlcyB3aGVuIGFsbCBpdGVtcyBoYXZlIGJlZW4gbG9hZGVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMub25Mb2FkID0gb25Mb2FkOwoKCQkJLyoqCgkJCSAqIEV4ZWN1dGVzIHdoZW4gc2luZ2xlIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtGdW5jdGlvbnx1bmRlZmluZWR9CgkJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAoJCQkgKi8KCQkJdGhpcy5vblByb2dyZXNzID0gb25Qcm9ncmVzczsKCgkJCS8qKgoJCQkgKiBFeGVjdXRlcyB3aGVuIGFuIGVycm9yIG9jY3Vycy4KCQkJICoKCQkJICogQHR5cGUge0Z1bmN0aW9ufHVuZGVmaW5lZH0KCQkJICogQGRlZmF1bHQgdW5kZWZpbmVkCgkJCSAqLwoJCQl0aGlzLm9uRXJyb3IgPSBvbkVycm9yOwoKCQkJLyoqCgkJCSAqIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBieSBhbnkgbG9hZGVyIHVzaW5nIHRoZSBtYW5hZ2VyIHdoZW4gdGhlIGxvYWRlcgoJCQkgKiBzdGFydHMgbG9hZGluZyBhbiBpdGVtLgoJCQkgKgoJCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBsb2FkLgoJCQkgKi8KCQkJdGhpcy5pdGVtU3RhcnQgPSBmdW5jdGlvbiAoIHVybCApIHsKCgkJCQlpdGVtc1RvdGFsICsrOwoKCQkJCWlmICggaXNMb2FkaW5nID09PSBmYWxzZSApIHsKCgkJCQkJaWYgKCBzY29wZS5vblN0YXJ0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlzY29wZS5vblN0YXJ0KCB1cmwsIGl0ZW1zTG9hZGVkLCBpdGVtc1RvdGFsICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaXNMb2FkaW5nID0gdHJ1ZTsKCgkJCX07CgoJCQkvKioKCQkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCgkJCSAqIGVuZGVkIGxvYWRpbmcgYW4gaXRlbS4KCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIGxvYWRlZCBpdGVtLgoJCQkgKi8KCQkJdGhpcy5pdGVtRW5kID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQkJaXRlbXNMb2FkZWQgKys7CgoJCQkJaWYgKCBzY29wZS5vblByb2dyZXNzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXNjb3BlLm9uUHJvZ3Jlc3MoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCgkJCQl9CgoJCQkJaWYgKCBpdGVtc0xvYWRlZCA9PT0gaXRlbXNUb3RhbCApIHsKCgkJCQkJaXNMb2FkaW5nID0gZmFsc2U7CgoJCQkJCWlmICggc2NvcGUub25Mb2FkICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlzY29wZS5vbkxvYWQoKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCgkJCSAqIGVuY291bnRlcnMgYW4gZXJyb3Igd2hlbiBsb2FkaW5nIGFuIGl0ZW0uCgkJCSAqCgkJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIG9mIHRoZSBpdGVtIHRoYXQgcHJvZHVjZXMgYW4gZXJyb3IuCgkJCSAqLwoJCQl0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJCWlmICggc2NvcGUub25FcnJvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5vbkVycm9yKCB1cmwgKTsKCgkJCQl9CgoJCQl9OwoKCQkJLyoqCgkJCSAqIEdpdmVuIGEgVVJMLCB1c2VzIHRoZSBVUkwgbW9kaWZpZXIgY2FsbGJhY2sgKGlmIGFueSkgYW5kIHJldHVybnMgYQoJCQkgKiByZXNvbHZlZCBVUkwuIElmIG5vIFVSTCBtb2RpZmllciBpcyBzZXQsIHJldHVybnMgdGhlIG9yaWdpbmFsIFVSTC4KCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgdG8gbG9hZC4KCQkJICogQHJldHVybiB7c3RyaW5nfSBUaGUgcmVzb2x2ZWQgVVJMLgoJCQkgKi8KCQkJdGhpcy5yZXNvbHZlVVJMID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQkJaWYgKCB1cmxNb2RpZmllciApIHsKCgkJCQkJcmV0dXJuIHVybE1vZGlmaWVyKCB1cmwgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHVybDsKCgkJCX07CgoJCQkvKioKCQkJICogSWYgcHJvdmlkZWQsIHRoZSBjYWxsYmFjayB3aWxsIGJlIHBhc3NlZCBlYWNoIHJlc291cmNlIFVSTCBiZWZvcmUgYQoJCQkgKiByZXF1ZXN0IGlzIHNlbnQuIFRoZSBjYWxsYmFjayBtYXkgcmV0dXJuIHRoZSBvcmlnaW5hbCBVUkwsIG9yIGEgbmV3IFVSTCB0bwoJCQkgKiBvdmVycmlkZSBsb2FkaW5nIGJlaGF2aW9yLiBUaGlzIGJlaGF2aW9yIGNhbiBiZSB1c2VkIHRvIGxvYWQgYXNzZXRzIGZyb20KCQkJICogLlpJUCBmaWxlcywgZHJhZy1hbmQtZHJvcCBBUElzLCBhbmQgRGF0YSBVUklzLgoJCQkgKgoJCQkgKiBgYGBqcwoJCQkgKiBjb25zdCBibG9icyA9IHsnZmlzaC5nbHRmJzogYmxvYjEsICdkaWZmdXNlLnBuZyc6IGJsb2IyLCAnbm9ybWFsLnBuZyc6IGJsb2IzfTsKCQkJICoKCQkJICogY29uc3QgbWFuYWdlciA9IG5ldyBUSFJFRS5Mb2FkaW5nTWFuYWdlcigpOwoJCQkgKgoJCQkgKiAvLyBJbml0aWFsaXplIGxvYWRpbmcgbWFuYWdlciB3aXRoIFVSTCBjYWxsYmFjay4KCQkJICogY29uc3Qgb2JqZWN0VVJMcyA9IFtdOwoJCQkgKiBtYW5hZ2VyLnNldFVSTE1vZGlmaWVyKCAoIHVybCApID0+IHsKCQkJICoKCQkJICogCXVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoIGJsb2JzWyB1cmwgXSApOwoJCQkgKiAJb2JqZWN0VVJMcy5wdXNoKCB1cmwgKTsKCQkJICogCXJldHVybiB1cmw7CgkJCSAqCgkJCSAqIH0gKTsKCQkJICoKCQkJICogLy8gTG9hZCBhcyB1c3VhbCwgdGhlbiByZXZva2UgdGhlIGJsb2IgVVJMcy4KCQkJICogY29uc3QgbG9hZGVyID0gbmV3IEdMVEZMb2FkZXIoIG1hbmFnZXIgKTsKCQkJICogbG9hZGVyLmxvYWQoICdmaXNoLmdsdGYnLCAoZ2x0ZikgPT4gewoJCQkgKgoJCQkgKiAJc2NlbmUuYWRkKCBnbHRmLnNjZW5lICk7CgkJCSAqIAlvYmplY3RVUkxzLmZvckVhY2goICggdXJsICkgPT4gVVJMLnJldm9rZU9iamVjdFVSTCggdXJsICkgKTsKCQkJICoKCQkJICogfSApOwoJCQkgKiBgYGAKCQkJICoKCQkJICogQHBhcmFtIHtmdW5jdGlvbihzdHJpbmcpOnN0cmluZ30gdHJhbnNmb3JtIC0gVVJMIG1vZGlmaWVyIGNhbGxiYWNrLiBDYWxsZWQgd2l0aCBhbiBVUkwgYW5kIG11c3QgcmV0dXJuIGEgcmVzb2x2ZWQgVVJMLgoJCQkgKiBAcmV0dXJuIHtMb2FkaW5nTWFuYWdlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBsb2FkaW5nIG1hbmFnZXIuCgkJCSAqLwoJCQl0aGlzLnNldFVSTE1vZGlmaWVyID0gZnVuY3Rpb24gKCB0cmFuc2Zvcm0gKSB7CgoJCQkJdXJsTW9kaWZpZXIgPSB0cmFuc2Zvcm07CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJlZ2lzdGVycyBhIGxvYWRlciB3aXRoIHRoZSBnaXZlbiByZWd1bGFyIGV4cHJlc3Npb24uIENhbiBiZSB1c2VkIHRvCgkJCSAqIGRlZmluZSB3aGF0IGxvYWRlciBzaG91bGQgYmUgdXNlZCBpbiBvcmRlciB0byBsb2FkIHNwZWNpZmljIGZpbGVzLiBBCgkJCSAqIHR5cGljYWwgdXNlIGNhc2UgaXMgdG8gb3ZlcndyaXRlIHRoZSBkZWZhdWx0IGxvYWRlciBmb3IgdGV4dHVyZXMuCgkJCSAqCgkJCSAqIGBgYGpzCgkJCSAqIC8vIGFkZCBoYW5kbGVyIGZvciBUR0EgdGV4dHVyZXMKCQkJICogbWFuYWdlci5hZGRIYW5kbGVyKCAvXC50Z2EkL2ksIG5ldyBUR0FMb2FkZXIoKSApOwoJCQkgKiBgYGAKCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IHJlZ2V4IC0gQSByZWd1bGFyIGV4cHJlc3Npb24uCgkJCSAqIEBwYXJhbSB7TG9hZGVyfSBsb2FkZXIgLSBBIGxvYWRlciB0aGF0IHNob3VsZCBoYW5kbGUgbWF0Y2hlZCBjYXNlcy4KCQkJICogQHJldHVybiB7TG9hZGluZ01hbmFnZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbG9hZGluZyBtYW5hZ2VyLgoJCQkgKi8KCQkJdGhpcy5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCwgbG9hZGVyICkgewoKCQkJCWhhbmRsZXJzLnB1c2goIHJlZ2V4LCBsb2FkZXIgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCQkvKioKCQkJICogUmVtb3ZlcyB0aGUgbG9hZGVyIGZvciB0aGUgZ2l2ZW4gcmVndWxhciBleHByZXNzaW9uLgoJCQkgKgoJCQkgKiBAcGFyYW0ge3N0cmluZ30gcmVnZXggLSBBIHJlZ3VsYXIgZXhwcmVzc2lvbi4KCQkJICogQHJldHVybiB7TG9hZGluZ01hbmFnZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbG9hZGluZyBtYW5hZ2VyLgoJCQkgKi8KCQkJdGhpcy5yZW1vdmVIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCApIHsKCgkJCQljb25zdCBpbmRleCA9IGhhbmRsZXJzLmluZGV4T2YoIHJlZ2V4ICk7CgoJCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgoJCQkJCWhhbmRsZXJzLnNwbGljZSggaW5kZXgsIDIgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIENhbiBiZSB1c2VkIHRvIHJldHJpZXZlIHRoZSByZWdpc3RlcmVkIGxvYWRlciBmb3IgdGhlIGdpdmVuIGZpbGUgcGF0aC4KCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IGZpbGUgLSBUaGUgZmlsZSBwYXRoLgoJCQkgKiBAcmV0dXJuIHs/TG9hZGVyfSBUaGUgcmVnaXN0ZXJlZCBsb2FkZXIuIFJldHVybnMgYG51bGxgIGlmIG5vIGxvYWRlciB3YXMgZm91bmQuCgkJCSAqLwoJCQl0aGlzLmdldEhhbmRsZXIgPSBmdW5jdGlvbiAoIGZpbGUgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyICkgewoKCQkJCQljb25zdCByZWdleCA9IGhhbmRsZXJzWyBpIF07CgkJCQkJY29uc3QgbG9hZGVyID0gaGFuZGxlcnNbIGkgKyAxIF07CgoJCQkJCWlmICggcmVnZXguZ2xvYmFsICkgcmVnZXgubGFzdEluZGV4ID0gMDsgLy8gc2VlICMxNzkyMAoKCQkJCQlpZiAoIHJlZ2V4LnRlc3QoIGZpbGUgKSApIHsKCgkJCQkJCXJldHVybiBsb2FkZXI7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9OwoKCQl9CgoJfQoKCS8qKgoJICogVGhlIGdsb2JhbCBkZWZhdWx0IGxvYWRpbmcgbWFuYWdlci4KCSAqCgkgKiBAY29uc3RhbnQKCSAqIEB0eXBlIHtMb2FkaW5nTWFuYWdlcn0KCSAqLwoJY29uc3QgRGVmYXVsdExvYWRpbmdNYW5hZ2VyID0gLypAX19QVVJFX18qLyBuZXcgTG9hZGluZ01hbmFnZXIoKTsKCgkvKioKCSAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGxvYWRlcnMuCgkgKgoJICogQGFic3RyYWN0CgkgKi8KCWNsYXNzIExvYWRlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgbG9hZGVyLgoJCSAqCgkJICogQHBhcmFtIHtMb2FkaW5nTWFuYWdlcn0gW21hbmFnZXJdIC0gVGhlIGxvYWRpbmcgbWFuYWdlci4KCQkgKi8KCQljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJCS8qKgoJCQkgKiBUaGUgbG9hZGluZyBtYW5hZ2VyLgoJCQkgKgoJCQkgKiBAdHlwZSB7TG9hZGluZ01hbmFnZXJ9CgkJCSAqIEBkZWZhdWx0IERlZmF1bHRMb2FkaW5nTWFuYWdlcgoJCQkgKi8KCQkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCQkvKioKCQkJICogVGhlIGNyb3NzT3JpZ2luIHN0cmluZyB0byBpbXBsZW1lbnQgQ09SUyBmb3IgbG9hZGluZyB0aGUgdXJsIGZyb20gYQoJCQkgKiBkaWZmZXJlbnQgZG9tYWluIHRoYXQgYWxsb3dzIENPUlMuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqIEBkZWZhdWx0ICdhbm9ueW1vdXMnCgkJCSAqLwoJCQl0aGlzLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7CgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgWE1MSHR0cFJlcXVlc3QgdXNlcyBjcmVkZW50aWFscy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFRoZSBiYXNlIHBhdGggZnJvbSB3aGljaCB0aGUgYXNzZXQgd2lsbCBiZSBsb2FkZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqLwoJCQl0aGlzLnBhdGggPSAnJzsKCgkJCS8qKgoJCQkgKiBUaGUgYmFzZSBwYXRoIGZyb20gd2hpY2ggYWRkaXRpb25hbCByZXNvdXJjZXMgbGlrZSB0ZXh0dXJlcyB3aWxsIGJlIGxvYWRlZC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMucmVzb3VyY2VQYXRoID0gJyc7CgoJCQkvKioKCQkJICogVGhlIFtyZXF1ZXN0IGhlYWRlcl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9HbG9zc2FyeS9SZXF1ZXN0X2hlYWRlcn0KCQkJICogdXNlZCBpbiBIVFRQIHJlcXVlc3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLCBhbnk+fQoJCQkgKi8KCQkJdGhpcy5yZXF1ZXN0SGVhZGVyID0ge307CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYWxsIGNvbmNyZXRlIGxvYWRlcnMuIEl0IGhvbGRzIHRoZQoJCSAqIGxvZ2ljIGZvciBsb2FkaW5nIGFzc2V0cyBmcm9tIHRoZSBiYWNrZW5kLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBwYXRoL1VSTCBvZiB0aGUgZmlsZSB0byBiZSBsb2FkZWQuCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gb25Mb2FkIC0gRXhlY3V0ZWQgd2hlbiB0aGUgbG9hZGluZyBwcm9jZXNzIGhhcyBiZWVuIGZpbmlzaGVkLgoJCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlZCB3aGlsZSB0aGUgbG9hZGluZyBpcyBpbiBwcm9ncmVzcy4KCQkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gW29uRXJyb3JdIC0gRXhlY3V0ZWQgd2hlbiBlcnJvcnMgb2NjdXIuCgkJICovCgkJbG9hZCggLyogdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKi8gKSB7fQoKCQkvKioKCQkgKiBBIGFzeW5jIHZlcnNpb24gb2Yge0BsaW5rIExvYWRlciNsb2FkfS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLgoJCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlZCB3aGlsZSB0aGUgbG9hZGluZyBpcyBpbiBwcm9ncmVzcy4KCQkgKiBAcmV0dXJuIHtQcm9taXNlfSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBhc3NldCBoYXMgYmVlbiBsb2FkZWQuCgkJICovCgkJbG9hZEFzeW5jKCB1cmwsIG9uUHJvZ3Jlc3MgKSB7CgoJCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJCXNjb3BlLmxvYWQoIHVybCwgcmVzb2x2ZSwgb25Qcm9ncmVzcywgcmVqZWN0ICk7CgoJCQl9ICk7CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYWxsIGNvbmNyZXRlIGxvYWRlcnMuIEl0IGhvbGRzIHRoZQoJCSAqIGxvZ2ljIGZvciBwYXJzaW5nIHRoZSBhc3NldCBpbnRvIHRocmVlLmpzIGVudGl0aWVzLgoJCSAqCgkJICogQHBhcmFtIHthbnl9IGRhdGEgLSBUaGUgZGF0YSB0byBwYXJzZS4KCQkgKi8KCQlwYXJzZSggLyogZGF0YSAqLyApIHt9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGBjcm9zc09yaWdpbmAgU3RyaW5nIHRvIGltcGxlbWVudCBDT1JTIGZvciBsb2FkaW5nIHRoZSBVUkwKCQkgKiBmcm9tIGEgZGlmZmVyZW50IGRvbWFpbiB0aGF0IGFsbG93cyBDT1JTLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IGNyb3NzT3JpZ2luIC0gVGhlIGBjcm9zc09yaWdpbmAgdmFsdWUuCgkJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldENyb3NzT3JpZ2luKCBjcm9zc09yaWdpbiApIHsKCgkJCXRoaXMuY3Jvc3NPcmlnaW4gPSBjcm9zc09yaWdpbjsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV2hldGhlciB0aGUgWE1MSHR0cFJlcXVlc3QgdXNlcyBjcmVkZW50aWFscyBzdWNoIGFzIGNvb2tpZXMsIGF1dGhvcml6YXRpb24KCQkgKiBoZWFkZXJzIG9yIFRMUyBjbGllbnQgY2VydGlmaWNhdGVzLCBzZWUgW1hNTEh0dHBSZXF1ZXN0LndpdGhDcmVkZW50aWFsc117QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0L3dpdGhDcmVkZW50aWFsc30uCgkJICoKCQkgKiBOb3RlOiBUaGlzIHNldHRpbmcgaGFzIG5vIGVmZmVjdCBpZiB5b3UgYXJlIGxvYWRpbmcgZmlsZXMgbG9jYWxseSBvciBmcm9tIHRoZSBzYW1lIGRvbWFpbi4KCQkgKgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUgLSBUaGUgYHdpdGhDcmVkZW50aWFsc2AgdmFsdWUuCgkJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFdpdGhDcmVkZW50aWFscyggdmFsdWUgKSB7CgoJCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBiYXNlIHBhdGggZm9yIHRoZSBhc3NldC4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIGJhc2UgcGF0aC4KCQkgKiBAcmV0dXJuIHtMb2FkZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0UGF0aCggcGF0aCApIHsKCgkJCXRoaXMucGF0aCA9IHBhdGg7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGJhc2UgcGF0aCBmb3IgZGVwZW5kZW50IHJlc291cmNlcyBsaWtlIHRleHR1cmVzLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHJlc291cmNlUGF0aCAtIFRoZSByZXNvdXJjZSBwYXRoLgoJCSAqIEByZXR1cm4ge0xvYWRlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXRSZXNvdXJjZVBhdGgoIHJlc291cmNlUGF0aCApIHsKCgkJCXRoaXMucmVzb3VyY2VQYXRoID0gcmVzb3VyY2VQYXRoOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiByZXF1ZXN0IGhlYWRlci4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0SGVhZGVyIC0gQSBbcmVxdWVzdCBoZWFkZXJde0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvR2xvc3NhcnkvUmVxdWVzdF9oZWFkZXJ9CgkJICogZm9yIGNvbmZpZ3VyaW5nIHRoZSBIVFRQIHJlcXVlc3QuCgkJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFJlcXVlc3RIZWFkZXIoIHJlcXVlc3RIZWFkZXIgKSB7CgoJCQl0aGlzLnJlcXVlc3RIZWFkZXIgPSByZXF1ZXN0SGVhZGVyOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgkvKioKCSAqIENhbGxiYWNrIGZvciBvblByb2dyZXNzIGluIGxvYWRlcnMuCgkgKgoJICogQGNhbGxiYWNrIG9uUHJvZ3Jlc3NDYWxsYmFjawoJICogQHBhcmFtIHtQcm9ncmVzc0V2ZW50fSBldmVudCAtIEFuIGluc3RhbmNlIG9mIGBQcm9ncmVzc0V2ZW50YCB0aGF0IHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgbG9hZGluZyBzdGF0dXMuCgkgKi8KCgkvKioKCSAqIENhbGxiYWNrIGZvciBvbkVycm9yIGluIGxvYWRlcnMuCgkgKgoJICogQGNhbGxiYWNrIG9uRXJyb3JDYWxsYmFjawoJICogQHBhcmFtIHtFcnJvcn0gZXJyb3IgLSBUaGUgZXJyb3Igd2hpY2ggb2NjdXJyZWQgZHVyaW5nIHRoZSBsb2FkaW5nIHByb2Nlc3MuCgkgKi8KCgkvKioKCSAqIFRoZSBkZWZhdWx0IG1hdGVyaWFsIG5hbWUgdGhhdCBpcyB1c2VkIGJ5IGxvYWRlcnMKCSAqIHdoZW4gY3JlYXRpbmcgbWF0ZXJpYWxzIGZvciBsb2FkZWQgM0Qgb2JqZWN0cy4KCSAqCgkgKiBOb3RlOiBOb3QgYWxsIGxvYWRlcnMgbWlnaHQgaG9ub3IgdGhpcyBzZXR0aW5nLgoJICoKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAZGVmYXVsdCAnX19ERUZBVUxUJwoJICovCglMb2FkZXIuREVGQVVMVF9NQVRFUklBTF9OQU1FID0gJ19fREVGQVVMVCc7CgoJY29uc3QgX2xvYWRpbmcgPSBuZXcgV2Vha01hcCgpOwoKCS8qKgoJICogQSBsb2FkZXIgZm9yIGxvYWRpbmcgaW1hZ2VzLiBUaGUgY2xhc3MgbG9hZHMgaW1hZ2VzIHdpdGggdGhlIEhUTUwgYEltYWdlYCBBUEkuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5JbWFnZUxvYWRlcigpOwoJICogY29uc3QgaW1hZ2UgPSBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCAnaW1hZ2UucG5nJyApOwoJICogYGBgCgkgKiBQbGVhc2Ugbm90ZSB0aGF0IGBJbWFnZUxvYWRlcmAgaGFzIGRyb3BwZWQgc3VwcG9ydCBmb3IgcHJvZ3Jlc3MKCSAqIGV2ZW50cyBpbiBgcjg0YC4gRm9yIGFuIGBJbWFnZUxvYWRlcmAgdGhhdCBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMsIHNlZQoJICogW3RoaXMgdGhyZWFkXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8xMDQzOSNpc3N1ZWNvbW1lbnQtMjc1Nzg1NjM5fS4KCSAqCgkgKiBAYXVnbWVudHMgTG9hZGVyCgkgKi8KCWNsYXNzIEltYWdlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBpbWFnZSBsb2FkZXIuCgkJICoKCQkgKiBAcGFyYW0ge0xvYWRpbmdNYW5hZ2VyfSBbbWFuYWdlcl0gLSBUaGUgbG9hZGluZyBtYW5hZ2VyLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQkJc3VwZXIoIG1hbmFnZXIgKTsKCgkJfQoKCQkvKioKCQkgKiBTdGFydHMgbG9hZGluZyBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIHBhc3NlcyB0aGUgbG9hZGVkIGltYWdlCgkJICogdG8gdGhlIGBvbkxvYWQoKWAgY2FsbGJhY2suIFRoZSBtZXRob2QgYWxzbyByZXR1cm5zIGEgbmV3IGBJbWFnZWAgb2JqZWN0IHdoaWNoIGNhbgoJCSAqIGRpcmVjdGx5IGJlIHVzZWQgZm9yIHRleHR1cmUgY3JlYXRpb24uIElmIHlvdSBkbyBpdCB0aGlzIHdheSwgdGhlIHRleHR1cmUKCQkgKiBtYXkgcG9wIHVwIGluIHlvdXIgc2NlbmUgb25jZSB0aGUgcmVzcGVjdGl2ZSBsb2FkaW5nIHByb2Nlc3MgaXMgZmluaXNoZWQuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIHBhdGgvVVJMIG9mIHRoZSBmaWxlIHRvIGJlIGxvYWRlZC4gVGhpcyBjYW4gYWxzbyBiZSBhIGRhdGEgVVJJLgoJCSAqIEBwYXJhbSB7ZnVuY3Rpb24oSW1hZ2UpfSBvbkxvYWQgLSBFeGVjdXRlZCB3aGVuIHRoZSBsb2FkaW5nIHByb2Nlc3MgaGFzIGJlZW4gZmluaXNoZWQuCgkJICogQHBhcmFtIHtvblByb2dyZXNzQ2FsbGJhY2t9IG9uUHJvZ3Jlc3MgLSBVbnN1cHBvcnRlZCBpbiB0aGlzIGxvYWRlci4KCQkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gb25FcnJvciAtIEV4ZWN1dGVkIHdoZW4gZXJyb3JzIG9jY3VyLgoJCSAqIEByZXR1cm4ge0ltYWdlfSBUaGUgaW1hZ2UuCgkJICovCgkJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQlpZiAoIHRoaXMucGF0aCAhPT0gdW5kZWZpbmVkICkgdXJsID0gdGhpcy5wYXRoICsgdXJsOwoKCQkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkJY29uc3QgY2FjaGVkID0gQ2FjaGUuZ2V0KCBgaW1hZ2U6JHt1cmx9YCApOwoKCQkJaWYgKCBjYWNoZWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlpZiAoIGNhY2hlZC5jb21wbGV0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKCQkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgoJCQkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggY2FjaGVkICk7CgoJCQkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJCQl9LCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJbGV0IGFyciA9IF9sb2FkaW5nLmdldCggY2FjaGVkICk7CgoJCQkJCWlmICggYXJyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlhcnIgPSBbXTsKCQkJCQkJX2xvYWRpbmcuc2V0KCBjYWNoZWQsIGFyciApOwoKCQkJCQl9CgoJCQkJCWFyci5wdXNoKCB7IG9uTG9hZCwgb25FcnJvciB9ICk7CgoJCQkJfQoKCQkJCXJldHVybiBjYWNoZWQ7CgoJCQl9CgoJCQljb25zdCBpbWFnZSA9IGNyZWF0ZUVsZW1lbnROUyggJ2ltZycgKTsKCgkJCWZ1bmN0aW9uIG9uSW1hZ2VMb2FkKCkgewoKCQkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgoJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRoaXMgKTsKCgkJCQkvLwoKCQkJCWNvbnN0IGNhbGxiYWNrcyA9IF9sb2FkaW5nLmdldCggdGhpcyApIHx8IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkxvYWQgKSBjYWxsYmFjay5vbkxvYWQoIHRoaXMgKTsKCgkJCQl9CgoJCQkJX2xvYWRpbmcuZGVsZXRlKCB0aGlzICk7CgoJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uSW1hZ2VFcnJvciggZXZlbnQgKSB7CgoJCQkJcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKCgkJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBldmVudCApOwoKCQkJCUNhY2hlLnJlbW92ZSggYGltYWdlOiR7dXJsfWAgKTsKCgkJCQkvLwoKCQkJCWNvbnN0IGNhbGxiYWNrcyA9IF9sb2FkaW5nLmdldCggdGhpcyApIHx8IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkVycm9yICkgY2FsbGJhY2sub25FcnJvciggZXZlbnQgKTsKCgkJCQl9CgoJCQkJX2xvYWRpbmcuZGVsZXRlKCB0aGlzICk7CgoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9CgoJCQlmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycygpIHsKCgkJCQlpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnbG9hZCcsIG9uSW1hZ2VMb2FkLCBmYWxzZSApOwoJCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQkJfQoKCQkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKCQkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQkJaWYgKCB1cmwuc2xpY2UoIDAsIDUgKSAhPT0gJ2RhdGE6JyApIHsKCgkJCQlpZiAoIHRoaXMuY3Jvc3NPcmlnaW4gIT09IHVuZGVmaW5lZCApIGltYWdlLmNyb3NzT3JpZ2luID0gdGhpcy5jcm9zc09yaWdpbjsKCgkJCX0KCgkJCUNhY2hlLmFkZCggYGltYWdlOiR7dXJsfWAsIGltYWdlICk7CgkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCWltYWdlLnNyYyA9IHVybDsKCgkJCXJldHVybiBpbWFnZTsKCgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIGZvciBsb2FkaW5nIHRleHR1cmVzLiBJbWFnZXMgYXJlIGludGVybmFsbHkKCSAqIGxvYWRlZCB2aWEge0BsaW5rIEltYWdlTG9hZGVyfS4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKTsKCSAqIGNvbnN0IHRleHR1cmUgPSBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCAndGV4dHVyZXMvbGFuZF9vY2Vhbl9pY2VfY2xvdWRfMjA0OC5qcGcnICk7CgkgKgoJICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgbWFwOnRleHR1cmUgfSApOwoJICogYGBgCgkgKiBQbGVhc2Ugbm90ZSB0aGF0IGBUZXh0dXJlTG9hZGVyYCBoYXMgZHJvcHBlZCBzdXBwb3J0IGZvciBwcm9ncmVzcwoJICogZXZlbnRzIGluIGByODRgLiBGb3IgYSBgVGV4dHVyZUxvYWRlcmAgdGhhdCBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMsIHNlZQoJICogW3RoaXMgdGhyZWFkXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8xMDQzOSNpc3N1ZWNvbW1lbnQtMjkzMjYwMTQ1fS4KCSAqCgkgKiBAYXVnbWVudHMgTG9hZGVyCgkgKi8KCWNsYXNzIFRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRleHR1cmUgbG9hZGVyLgoJCSAqCgkJICogQHBhcmFtIHtMb2FkaW5nTWFuYWdlcn0gW21hbmFnZXJdIC0gVGhlIGxvYWRpbmcgbWFuYWdlci4KCQkgKi8KCQljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJCXN1cGVyKCBtYW5hZ2VyICk7CgoJCX0KCgkJLyoqCgkJICogU3RhcnRzIGxvYWRpbmcgZnJvbSB0aGUgZ2l2ZW4gVVJMIGFuZCBwYXNzIHRoZSBmdWxseSBsb2FkZWQgdGV4dHVyZQoJCSAqIHRvIHRoZSBgb25Mb2FkKClgIGNhbGxiYWNrLiBUaGUgbWV0aG9kIGFsc28gcmV0dXJucyBhIG5ldyB0ZXh0dXJlIG9iamVjdCB3aGljaCBjYW4KCQkgKiBkaXJlY3RseSBiZSB1c2VkIGZvciBtYXRlcmlhbCBjcmVhdGlvbi4gSWYgeW91IGRvIGl0IHRoaXMgd2F5LCB0aGUgdGV4dHVyZQoJCSAqIG1heSBwb3AgdXAgaW4geW91ciBzY2VuZSBvbmNlIHRoZSByZXNwZWN0aXZlIGxvYWRpbmcgcHJvY2VzcyBpcyBmaW5pc2hlZC4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLiBUaGlzIGNhbiBhbHNvIGJlIGEgZGF0YSBVUkkuCgkJICogQHBhcmFtIHtmdW5jdGlvbihUZXh0dXJlKX0gb25Mb2FkIC0gRXhlY3V0ZWQgd2hlbiB0aGUgbG9hZGluZyBwcm9jZXNzIGhhcyBiZWVuIGZpbmlzaGVkLgoJCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBvblByb2dyZXNzIC0gVW5zdXBwb3J0ZWQgaW4gdGhpcyBsb2FkZXIuCgkJICogQHBhcmFtIHtvbkVycm9yQ2FsbGJhY2t9IG9uRXJyb3IgLSBFeGVjdXRlZCB3aGVuIGVycm9ycyBvY2N1ci4KCQkgKiBAcmV0dXJuIHtUZXh0dXJlfSBUaGUgdGV4dHVyZS4KCQkgKi8KCQlsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQkJY29uc3QgbG9hZGVyID0gbmV3IEltYWdlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQkJbG9hZGVyLnNldENyb3NzT3JpZ2luKCB0aGlzLmNyb3NzT3JpZ2luICk7CgkJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggaW1hZ2UgKSB7CgoJCQkJdGV4dHVyZS5pbWFnZSA9IGltYWdlOwoJCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQkJfQoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0KCgl9CgoJLyoqCgkgKiBDYW1lcmEgdGhhdCB1c2VzIFtvcnRob2dyYXBoaWMgcHJvamVjdGlvbl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvT3J0aG9ncmFwaGljX3Byb2plY3Rpb259LgoJICoKCSAqIEluIHRoaXMgcHJvamVjdGlvbiBtb2RlLCBhbiBvYmplY3QncyBzaXplIGluIHRoZSByZW5kZXJlZCBpbWFnZSBzdGF5cwoJICogY29uc3RhbnQgcmVnYXJkbGVzcyBvZiBpdHMgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhLiBUaGlzIGNhbiBiZSB1c2VmdWwKCSAqIGZvciByZW5kZXJpbmcgMkQgc2NlbmVzIGFuZCBVSSBlbGVtZW50cywgYW1vbmdzdCBvdGhlciB0aGluZ3MuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IGNhbWVyYSA9IG5ldyBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEoIHdpZHRoIC8gLSAyLCB3aWR0aCAvIDIsIGhlaWdodCAvIDIsIGhlaWdodCAvIC0gMiwgMSwgMTAwMCApOwoJICogc2NlbmUuYWRkKCBjYW1lcmEgKTsKCSAqIGBgYAoJICoKCSAqIEBhdWdtZW50cyBDYW1lcmEKCSAqLwoJY2xhc3MgT3J0aG9ncmFwaGljQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBvcnRob2dyYXBoaWMgY2FtZXJhLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFtsZWZ0PS0xXSAtIFRoZSBsZWZ0IHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbcmlnaHQ9MV0gLSBUaGUgcmlnaHQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJICogQHBhcmFtIHtudW1iZXJ9IFt0b3A9MV0gLSBUaGUgdG9wIHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYm90dG9tPS0xXSAtIFRoZSBib3R0b20gcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuZWFyPTAuMV0gLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2Zhcj0yMDAwXSAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCgkJICovCgkJY29uc3RydWN0b3IoIGxlZnQgPSAtMSwgcmlnaHQgPSAxLCB0b3AgPSAxLCBib3R0b20gPSAtMSwgbmVhciA9IDAuMSwgZmFyID0gMjAwMCApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnT3J0aG9ncmFwaGljQ2FtZXJhJzsKCgkJCS8qKgoJCQkgKiBUaGUgem9vbSBmYWN0b3Igb2YgdGhlIGNhbWVyYS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy56b29tID0gMTsKCgkJCS8qKgoJCQkgKiBSZXByZXNlbnRzIHRoZSBmcnVzdHVtIHdpbmRvdyBzcGVjaWZpY2F0aW9uLiBUaGlzIHByb3BlcnR5IHNob3VsZCBub3QgYmUgZWRpdGVkCgkJCSAqIGRpcmVjdGx5IGJ1dCB2aWEge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI3NldFZpZXdPZmZzZXR9IGFuZCB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjY2xlYXJWaWV3T2Zmc2V0fS4KCQkJICoKCQkJICogQHR5cGUgez9PYmplY3R9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMudmlldyA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGxlZnQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IC0xCgkJCSAqLwoJCQl0aGlzLmxlZnQgPSBsZWZ0OwoKCQkJLyoqCgkJCSAqIFRoZSByaWdodCBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5yaWdodCA9IHJpZ2h0OwoKCQkJLyoqCgkJCSAqIFRoZSB0b3AgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMudG9wID0gdG9wOwoKCQkJLyoqCgkJCSAqIFRoZSBib3R0b20gcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IC0xCgkJCSAqLwoJCQl0aGlzLmJvdHRvbSA9IGJvdHRvbTsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4gVGhlIHZhbGlkIHJhbmdlIGlzIGdyZWF0ZXIgdGhhbiBgMGAKCQkJICogYW5kIGxlc3MgdGhhbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhI2Zhcn0uCgkJCSAqCgkJCSAqIE5vdGUgdGhhdCwgdW5saWtlIGZvciB0aGUge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhfSwgYDBgIGlzIGEKCQkJICogdmFsaWQgdmFsdWUgZm9yIGFuIG9ydGhvZ3JhcGhpYyBjYW1lcmEncyBuZWFyIHBsYW5lLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwLjEKCQkJICovCgkJCXRoaXMubmVhciA9IG5lYXI7CgoJCQkvKioKCQkJICogVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4gTXVzdCBiZSBncmVhdGVyIHRoYW4gdGhlCgkJCSAqIGN1cnJlbnQgdmFsdWUgb2Yge0BsaW5rIE9ydGhvZ3JhcGhpY0NhbWVyYSNuZWFyfS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMjAwMAoJCQkgKi8KCQkJdGhpcy5mYXIgPSBmYXI7CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCQl0aGlzLmxlZnQgPSBzb3VyY2UubGVmdDsKCQkJdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDsKCQkJdGhpcy50b3AgPSBzb3VyY2UudG9wOwoJCQl0aGlzLmJvdHRvbSA9IHNvdXJjZS5ib3R0b207CgkJCXRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwoJCQl0aGlzLmZhciA9IHNvdXJjZS5mYXI7CgoJCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKCQkJdGhpcy52aWV3ID0gc291cmNlLnZpZXcgPT09IG51bGwgPyBudWxsIDogT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS52aWV3ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIGFuIG9mZnNldCBpbiBhIGxhcmdlciBmcnVzdHVtLiBUaGlzIGlzIHVzZWZ1bCBmb3IgbXVsdGktd2luZG93IG9yCgkJICogbXVsdGktbW9uaXRvci9tdWx0aS1tYWNoaW5lIHNldHVwcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsV2lkdGggLSBUaGUgZnVsbCB3aWR0aCBvZiBtdWx0aXZpZXcgc2V0dXAuCgkJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxIZWlnaHQgLSBUaGUgZnVsbCBoZWlnaHQgb2YgbXVsdGl2aWV3IHNldHVwLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGhvcml6b250YWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHN1YmNhbWVyYS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiBzdWJjYW1lcmEuCgkJICogQHNlZSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0KCQkgKi8KCQlzZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHRoaXMudmlldyA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLnZpZXcgPSB7CgkJCQkJZW5hYmxlZDogdHJ1ZSwKCQkJCQlmdWxsV2lkdGg6IDEsCgkJCQkJZnVsbEhlaWdodDogMSwKCQkJCQlvZmZzZXRYOiAwLAoJCQkJCW9mZnNldFk6IDAsCgkJCQkJd2lkdGg6IDEsCgkJCQkJaGVpZ2h0OiAxCgkJCQl9OwoKCQkJfQoKCQkJdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwoJCQl0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwoJCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CgkJCXRoaXMudmlldy5vZmZzZXRYID0geDsKCQkJdGhpcy52aWV3Lm9mZnNldFkgPSB5OwoJCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKCQkJdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKCgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCS8qKgoJCSAqIFJlbW92ZXMgdGhlIHZpZXcgb2Zmc2V0IGZyb20gdGhlIHByb2plY3Rpb24gbWF0cml4LgoJCSAqLwoJCWNsZWFyVmlld09mZnNldCgpIHsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgewoKCQkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgoJCQl9CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSBjYW1lcmEncyBwcm9qZWN0aW9uIG1hdHJpeC4gTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYW55IGNoYW5nZSBvZgoJCSAqIGNhbWVyYSBwcm9wZXJ0aWVzLgoJCSAqLwoJCXVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKSB7CgoJCQljb25zdCBkeCA9ICggdGhpcy5yaWdodCAtIHRoaXMubGVmdCApIC8gKCAyICogdGhpcy56b29tICk7CgkJCWNvbnN0IGR5ID0gKCB0aGlzLnRvcCAtIHRoaXMuYm90dG9tICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKCQkJY29uc3QgY3ggPSAoIHRoaXMucmlnaHQgKyB0aGlzLmxlZnQgKSAvIDI7CgkJCWNvbnN0IGN5ID0gKCB0aGlzLnRvcCArIHRoaXMuYm90dG9tICkgLyAyOwoKCQkJbGV0IGxlZnQgPSBjeCAtIGR4OwoJCQlsZXQgcmlnaHQgPSBjeCArIGR4OwoJCQlsZXQgdG9wID0gY3kgKyBkeTsKCQkJbGV0IGJvdHRvbSA9IGN5IC0gZHk7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCgkJCQljb25zdCBzY2FsZVcgPSAoIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQgKSAvIHRoaXMudmlldy5mdWxsV2lkdGggLyB0aGlzLnpvb207CgkJCQljb25zdCBzY2FsZUggPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvIHRoaXMudmlldy5mdWxsSGVpZ2h0IC8gdGhpcy56b29tOwoKCQkJCWxlZnQgKz0gc2NhbGVXICogdGhpcy52aWV3Lm9mZnNldFg7CgkJCQlyaWdodCA9IGxlZnQgKyBzY2FsZVcgKiB0aGlzLnZpZXcud2lkdGg7CgkJCQl0b3AgLT0gc2NhbGVIICogdGhpcy52aWV3Lm9mZnNldFk7CgkJCQlib3R0b20gPSB0b3AgLSBzY2FsZUggKiB0aGlzLnZpZXcuaGVpZ2h0OwoKCQkJfQoKCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VPcnRob2dyYXBoaWMoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgdGhpcy5uZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCQl9CgoJCXRvSlNPTiggbWV0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJCWRhdGEub2JqZWN0Lnpvb20gPSB0aGlzLnpvb207CgkJCWRhdGEub2JqZWN0LmxlZnQgPSB0aGlzLmxlZnQ7CgkJCWRhdGEub2JqZWN0LnJpZ2h0ID0gdGhpcy5yaWdodDsKCQkJZGF0YS5vYmplY3QudG9wID0gdGhpcy50b3A7CgkJCWRhdGEub2JqZWN0LmJvdHRvbSA9IHRoaXMuYm90dG9tOwoJCQlkYXRhLm9iamVjdC5uZWFyID0gdGhpcy5uZWFyOwoJCQlkYXRhLm9iamVjdC5mYXIgPSB0aGlzLmZhcjsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgZGF0YS5vYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCB0aGlzLnZpZXcgKTsKCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJfQoKCS8qKgoJICogVGhpcyB0eXBlIG9mIGNhbWVyYSBjYW4gYmUgdXNlZCBpbiBvcmRlciB0byBlZmZpY2llbnRseSByZW5kZXIgYSBzY2VuZSB3aXRoIGEKCSAqIHByZWRlZmluZWQgc2V0IG9mIGNhbWVyYXMuIFRoaXMgaXMgYW4gaW1wb3J0YW50IHBlcmZvcm1hbmNlIGFzcGVjdCBmb3IKCSAqIHJlbmRlcmluZyBWUiBzY2VuZXMuCgkgKgoJICogQW4gaW5zdGFuY2Ugb2YgYEFycmF5Q2FtZXJhYCBhbHdheXMgaGFzIGFuIGFycmF5IG9mIHN1YiBjYW1lcmFzLiBJdCdzIG1hbmRhdG9yeQoJICogdG8gZGVmaW5lIGZvciBlYWNoIHN1YiBjYW1lcmEgdGhlIGB2aWV3cG9ydGAgcHJvcGVydHkgd2hpY2ggZGV0ZXJtaW5lcyB0aGUKCSAqIHBhcnQgb2YgdGhlIHZpZXdwb3J0IHRoYXQgaXMgcmVuZGVyZWQgd2l0aCB0aGlzIGNhbWVyYS4KCSAqCgkgKiBAYXVnbWVudHMgUGVyc3BlY3RpdmVDYW1lcmEKCSAqLwoJY2xhc3MgQXJyYXlDYW1lcmEgZXh0ZW5kcyBQZXJzcGVjdGl2ZUNhbWVyYSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYXJyYXkgY2FtZXJhLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxQZXJzcGVjdGl2ZUNhbWVyYT59IFthcnJheT1bXV0gLSBBbiBhcnJheSBvZiBwZXJzcGVjdGl2ZSBzdWIgY2FtZXJhcy4KCQkgKi8KCQljb25zdHJ1Y3RvciggYXJyYXkgPSBbXSApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0FycmF5Q2FtZXJhID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRoaXMgY2FtZXJhIGlzIHVzZWQgd2l0aCBtdWx0aXZpZXcgcmVuZGVyaW5nIG9yIG5vdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5pc011bHRpVmlld0NhbWVyYSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIEFuIGFycmF5IG9mIHBlcnNwZWN0aXZlIHN1YiBjYW1lcmFzLgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8UGVyc3BlY3RpdmVDYW1lcmE+fQoJCQkgKi8KCQkJdGhpcy5jYW1lcmFzID0gYXJyYXk7CgoJCX0KCgl9CgoJLyoqCgkgKiBEZXRlcm1pbmVzIGhvdyBtYW55IGJ5dGVzIG11c3QgYmUgdXNlZCB0byByZXByZXNlbnQgdGhlIHRleHR1cmUuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgoJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHRleHR1cmUuCgkgKiBAcGFyYW0ge251bWJlcn0gZm9ybWF0IC0gVGhlIHRleHR1cmUncyBmb3JtYXQuCgkgKiBAcGFyYW0ge251bWJlcn0gdHlwZSAtIFRoZSB0ZXh0dXJlJ3MgdHlwZS4KCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGJ5dGUgbGVuZ3RoLgoJICovCglmdW5jdGlvbiBnZXRCeXRlTGVuZ3RoKCB3aWR0aCwgaGVpZ2h0LCBmb3JtYXQsIHR5cGUgKSB7CgoJCWNvbnN0IHR5cGVCeXRlTGVuZ3RoID0gZ2V0VGV4dHVyZVR5cGVCeXRlTGVuZ3RoKCB0eXBlICk7CgoJCXN3aXRjaCAoIGZvcm1hdCApIHsKCgkJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvT3BlbkdMLVJlZnBhZ2VzL2VzMy4wL2h0bWwvZ2xUZXhJbWFnZTJELnhodG1sCgkJCWNhc2UgQWxwaGFGb3JtYXQ6CgkJCQlyZXR1cm4gd2lkdGggKiBoZWlnaHQ7CgkJCWNhc2UgUmVkRm9ybWF0OgoJCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKCQkJY2FzZSBSZWRJbnRlZ2VyRm9ybWF0OgoJCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKCQkJY2FzZSBSR0Zvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAyICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoJCQljYXNlIFJHSW50ZWdlckZvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAyICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoJCQljYXNlIFJHQkZvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAzICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoJCQljYXNlIFJHQkFGb3JtYXQ6CgkJCQlyZXR1cm4gKCAoIHdpZHRoICogaGVpZ2h0ICogNCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKCQkJY2FzZSBSR0JBSW50ZWdlckZvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiA0ICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2IvCgkJCWNhc2UgUkdCX1MzVENfRFhUMV9Gb3JtYXQ6CgkJCWNhc2UgUkdCQV9TM1RDX0RYVDFfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDg7CgkJCWNhc2UgUkdCQV9TM1RDX0RYVDNfRm9ybWF0OgoJCQljYXNlIFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMyApIC8gNCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAzICkgLyA0ICkgKiAxNjsKCgkJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvd2ViZ2wvZXh0ZW5zaW9ucy9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMvCgkJCWNhc2UgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQ6CgkJCWNhc2UgUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0OgoJCQkJcmV0dXJuICggTWF0aC5tYXgoIHdpZHRoLCAxNiApICogTWF0aC5tYXgoIGhlaWdodCwgOCApICkgLyA0OwoJCQljYXNlIFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0OgoJCQljYXNlIFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdDoKCQkJCXJldHVybiAoIE1hdGgubWF4KCB3aWR0aCwgOCApICogTWF0aC5tYXgoIGhlaWdodCwgOCApICkgLyAyOwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMvCgkJCWNhc2UgUkdCX0VUQzFfRm9ybWF0OgoJCQljYXNlIFJHQl9FVEMyX0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMyApIC8gNCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAzICkgLyA0ICkgKiA4OwoJCQljYXNlIFJHQkFfRVRDMl9FQUNfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjLwoJCQljYXNlIFJHQkFfQVNUQ180eDRfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ181eDRfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA0ICkgLyA1ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ181eDVfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA0ICkgLyA1ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ182eDVfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA1ICkgLyA2ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ182eDZfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA1ICkgLyA2ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ184eDVfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ184eDZfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ184eDhfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDcgKSAvIDggKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ18xMHg1X0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgOSApIC8gMTAgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNCApIC8gNSApICogMTY7CgkJCWNhc2UgUkdCQV9BU1RDXzEweDZfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA5ICkgLyAxMCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyA1ICkgLyA2ICkgKiAxNjsKCQkJY2FzZSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDcgKSAvIDggKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDkgKSAvIDEwICkgKiAxNjsKCQkJY2FzZSBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAxMSApIC8gMTIgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgOSApIC8gMTAgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDExICkgLyAxMiApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAxMSApIC8gMTIgKSAqIDE2OwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL0VYVF90ZXh0dXJlX2NvbXByZXNzaW9uX2JwdGMvCgkJCWNhc2UgUkdCQV9CUFRDX0Zvcm1hdDoKCQkJY2FzZSBSR0JfQlBUQ19TSUdORURfRm9ybWF0OgoJCQljYXNlIFJHQl9CUFRDX1VOU0lHTkVEX0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmNlaWwoIHdpZHRoIC8gNCApICogTWF0aC5jZWlsKCBoZWlnaHQgLyA0ICkgKiAxNjsKCgkJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvd2ViZ2wvZXh0ZW5zaW9ucy9FWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9yZ3RjLwoJCQljYXNlIFJFRF9SR1RDMV9Gb3JtYXQ6CgkJCWNhc2UgU0lHTkVEX1JFRF9SR1RDMV9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5jZWlsKCB3aWR0aCAvIDQgKSAqIE1hdGguY2VpbCggaGVpZ2h0IC8gNCApICogODsKCQkJY2FzZSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0OgoJCQljYXNlIFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguY2VpbCggd2lkdGggLyA0ICkgKiBNYXRoLmNlaWwoIGhlaWdodCAvIDQgKSAqIDE2OwoKCQl9CgoJCXRocm93IG5ldyBFcnJvcigKCQkJYFVuYWJsZSB0byBkZXRlcm1pbmUgdGV4dHVyZSBieXRlIGxlbmd0aCBmb3IgJHtmb3JtYXR9IGZvcm1hdC5gLAoJCSk7CgoJfQoKCWZ1bmN0aW9uIGdldFRleHR1cmVUeXBlQnl0ZUxlbmd0aCggdHlwZSApIHsKCgkJc3dpdGNoICggdHlwZSApIHsKCgkJCWNhc2UgVW5zaWduZWRCeXRlVHlwZToKCQkJY2FzZSBCeXRlVHlwZToKCQkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDEsIGNvbXBvbmVudHM6IDEgfTsKCQkJY2FzZSBVbnNpZ25lZFNob3J0VHlwZToKCQkJY2FzZSBTaG9ydFR5cGU6CgkJCWNhc2UgSGFsZkZsb2F0VHlwZToKCQkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDIsIGNvbXBvbmVudHM6IDEgfTsKCQkJY2FzZSBVbnNpZ25lZFNob3J0NDQ0NFR5cGU6CgkJCWNhc2UgVW5zaWduZWRTaG9ydDU1NTFUeXBlOgoJCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogMiwgY29tcG9uZW50czogNCB9OwoJCQljYXNlIFVuc2lnbmVkSW50VHlwZToKCQkJY2FzZSBJbnRUeXBlOgoJCQljYXNlIEZsb2F0VHlwZToKCQkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDQsIGNvbXBvbmVudHM6IDEgfTsKCQkJY2FzZSBVbnNpZ25lZEludDU5OTlUeXBlOgoJCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogNCwgY29tcG9uZW50czogMyB9OwoKCQl9CgoJCXRocm93IG5ldyBFcnJvciggYFVua25vd24gdGV4dHVyZSB0eXBlICR7dHlwZX0uYCApOwoKCX0KCglpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKCQlfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudCggbmV3IEN1c3RvbUV2ZW50KCAncmVnaXN0ZXInLCB7IGRldGFpbDogewoJCQlyZXZpc2lvbjogUkVWSVNJT04sCgkJfSB9ICkgKTsKCgl9CgoJaWYgKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyApIHsKCgkJaWYgKCB3aW5kb3cuX19USFJFRV9fICkgewoKCQkJY29uc29sZS53YXJuKCAnV0FSTklORzogTXVsdGlwbGUgaW5zdGFuY2VzIG9mIFRocmVlLmpzIGJlaW5nIGltcG9ydGVkLicgKTsKCgkJfSBlbHNlIHsKCgkJCXdpbmRvdy5fX1RIUkVFX18gPSBSRVZJU0lPTjsKCgkJfQoKCX0KCgkvKioKCSAqIEBsaWNlbnNlCgkgKiBDb3B5cmlnaHQgMjAxMC0yMDI1IFRocmVlLmpzIEF1dGhvcnMKCSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKCSAqLwoKCWZ1bmN0aW9uIFdlYkdMQW5pbWF0aW9uKCkgewoKCQlsZXQgY29udGV4dCA9IG51bGw7CgkJbGV0IGlzQW5pbWF0aW5nID0gZmFsc2U7CgkJbGV0IGFuaW1hdGlvbkxvb3AgPSBudWxsOwoJCWxldCByZXF1ZXN0SWQgPSBudWxsOwoKCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lLCBmcmFtZSApIHsKCgkJCWFuaW1hdGlvbkxvb3AoIHRpbWUsIGZyYW1lICk7CgoJCQlyZXF1ZXN0SWQgPSBjb250ZXh0LnJlcXVlc3RBbmltYXRpb25GcmFtZSggb25BbmltYXRpb25GcmFtZSApOwoKCQl9CgoJCXJldHVybiB7CgoJCQlzdGFydDogZnVuY3Rpb24gKCkgewoKCQkJCWlmICggaXNBbmltYXRpbmcgPT09IHRydWUgKSByZXR1cm47CgkJCQlpZiAoIGFuaW1hdGlvbkxvb3AgPT09IG51bGwgKSByZXR1cm47CgoJCQkJcmVxdWVzdElkID0gY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgkJCQlpc0FuaW1hdGluZyA9IHRydWU7CgoJCQl9LAoKCQkJc3RvcDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnRleHQuY2FuY2VsQW5pbWF0aW9uRnJhbWUoIHJlcXVlc3RJZCApOwoKCQkJCWlzQW5pbWF0aW5nID0gZmFsc2U7CgoJCQl9LAoKCQkJc2V0QW5pbWF0aW9uTG9vcDogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCQlhbmltYXRpb25Mb29wID0gY2FsbGJhY2s7CgoJCQl9LAoKCQkJc2V0Q29udGV4dDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb250ZXh0ID0gdmFsdWU7CgoJCQl9CgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQXR0cmlidXRlcyggZ2wgKSB7CgoJCWNvbnN0IGJ1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApIHsKCgkJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCQljb25zdCB1c2FnZSA9IGF0dHJpYnV0ZS51c2FnZTsKCQkJY29uc3Qgc2l6ZSA9IGFycmF5LmJ5dGVMZW5ndGg7CgoJCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCgkJCWdsLmJpbmRCdWZmZXIoIGJ1ZmZlclR5cGUsIGJ1ZmZlciApOwoJCQlnbC5idWZmZXJEYXRhKCBidWZmZXJUeXBlLCBhcnJheSwgdXNhZ2UgKTsKCgkJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgoJCQlsZXQgdHlwZTsKCgkJCWlmICggYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgKSB7CgoJCQkJdHlwZSA9IGdsLkZMT0FUOwoKCQkJfSBlbHNlIGlmICggdHlwZW9mIEZsb2F0MTZBcnJheSAhPT0gJ3VuZGVmaW5lZCcgJiYgYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDE2QXJyYXkgKSB7CgoJCQkJdHlwZSA9IGdsLkhBTEZfRkxPQVQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5ICkgewoKCQkJCWlmICggYXR0cmlidXRlLmlzRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJdHlwZSA9IGdsLkhBTEZfRkxPQVQ7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50MTZBcnJheSApIHsKCgkJCQl0eXBlID0gZ2wuU0hPUlQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQzMkFycmF5ICkgewoKCQkJCXR5cGUgPSBnbC5VTlNJR05FRF9JTlQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkgKSB7CgoJCQkJdHlwZSA9IGdsLklOVDsKCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50OEFycmF5ICkgewoKCQkJCXR5cGUgPSBnbC5CWVRFOwoKCQkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OEFycmF5ICkgewoKCQkJCXR5cGUgPSBnbC5VTlNJR05FRF9CWVRFOwoKCQkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSApIHsKCgkJCQl0eXBlID0gZ2wuVU5TSUdORURfQllURTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVbnN1cHBvcnRlZCBidWZmZXIgZGF0YSBmb3JtYXQ6ICcgKyBhcnJheSApOwoKCQkJfQoKCQkJcmV0dXJuIHsKCQkJCWJ1ZmZlcjogYnVmZmVyLAoJCQkJdHlwZTogdHlwZSwKCQkJCWJ5dGVzUGVyRWxlbWVudDogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCgkJCQl2ZXJzaW9uOiBhdHRyaWJ1dGUudmVyc2lvbiwKCQkJCXNpemU6IHNpemUKCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVCdWZmZXIoIGJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CgkJCWNvbnN0IHVwZGF0ZVJhbmdlcyA9IGF0dHJpYnV0ZS51cGRhdGVSYW5nZXM7CgoJCQlnbC5iaW5kQnVmZmVyKCBidWZmZXJUeXBlLCBidWZmZXIgKTsKCgkJCWlmICggdXBkYXRlUmFuZ2VzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQkvLyBOb3QgdXNpbmcgdXBkYXRlIHJhbmdlcwoJCQkJZ2wuYnVmZmVyU3ViRGF0YSggYnVmZmVyVHlwZSwgMCwgYXJyYXkgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gQmVmb3JlIGFwcGx5aW5nIHVwZGF0ZSByYW5nZXMsIHdlIG1lcmdlIGFueSBhZGphY2VudCAvIG92ZXJsYXBwaW5nCgkJCQkvLyByYW5nZXMgdG8gcmVkdWNlIGxvYWQgb24gYGdsLmJ1ZmZlclN1YkRhdGFgLiBFbXBpcmljYWxseSwgdGhpcyBoYXMgbGVkCgkJCQkvLyB0byBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBtYWtlIGhlYXZ5IHVzZSBvZgoJCQkJLy8gdXBkYXRlIHJhbmdlcy4gTGlrZWx5IGR1ZSB0byBHUFUgY29tbWFuZCBvdmVyaGVhZC4KCQkJCS8vCgkJCQkvLyBOb3RlIHRoYXQgdG8gcmVkdWNlIGdhcmJhZ2UgY29sbGVjdGlvbiBiZXR3ZWVuIGZyYW1lcywgd2UgbWVyZ2UgdGhlCgkJCQkvLyB1cGRhdGUgcmFuZ2VzIGluLXBsYWNlLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB0aGlzIG1ldGhvZCB3aWxsIGNsZWFyIHRoZQoJCQkJLy8gdXBkYXRlIHJhbmdlcyBvbmNlIHVwZGF0ZWQuCgoJCQkJdXBkYXRlUmFuZ2VzLnNvcnQoICggYSwgYiApID0+IGEuc3RhcnQgLSBiLnN0YXJ0ICk7CgoJCQkJLy8gVG8gbWVyZ2UgdGhlIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UsIHdlIHdvcmsgZnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZQoJCQkJLy8gZXhpc3RpbmcgdXBkYXRlUmFuZ2VzIGFycmF5LCBtZXJnaW5nIHJhbmdlcy4gVGhpcyBtYXkgcmVzdWx0IGluIGEgZmluYWwKCQkJCS8vIGFycmF5IHdoaWNoIGlzIHNtYWxsZXIgdGhhbiB0aGUgb3JpZ2luYWwuIFRoaXMgaW5kZXggdHJhY2tzIHRoZSBsYXN0CgkJCQkvLyBpbmRleCByZXByZXNlbnRpbmcgYSBtZXJnZWQgcmFuZ2UsIGFueSBkYXRhIGFmdGVyIHRoaXMgaW5kZXggY2FuIGJlCgkJCQkvLyB0cmltbWVkIG9uY2UgdGhlIG1lcmdlIGFsZ29yaXRobSBpcyBjb21wbGV0ZWQuCgkJCQlsZXQgbWVyZ2VJbmRleCA9IDA7CgoJCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgcHJldmlvdXNSYW5nZSA9IHVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdOwoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCS8vIFdlIGFkZCBvbmUgaGVyZSB0byBtZXJnZSBhZGphY2VudCByYW5nZXMuIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHJhbmdlcwoJCQkJCS8vIG9wZXJhdGUgb3ZlciBwb3NpdGl2ZSBpbnRlZ2Vycy4KCQkJCQlpZiAoIHJhbmdlLnN0YXJ0IDw9IHByZXZpb3VzUmFuZ2Uuc3RhcnQgKyBwcmV2aW91c1JhbmdlLmNvdW50ICsgMSApIHsKCgkJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQgPSBNYXRoLm1heCgKCQkJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQsCgkJCQkJCQlyYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gcHJldmlvdXNSYW5nZS5zdGFydAoJCQkJCQkpOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJKysgbWVyZ2VJbmRleDsKCQkJCQkJdXBkYXRlUmFuZ2VzWyBtZXJnZUluZGV4IF0gPSByYW5nZTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyBUcmltIHRoZSBhcnJheSB0byBvbmx5IGNvbnRhaW4gdGhlIG1lcmdlZCByYW5nZXMuCgkJCQl1cGRhdGVSYW5nZXMubGVuZ3RoID0gbWVyZ2VJbmRleCArIDE7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHJhbmdlLnN0YXJ0ICogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCgkJCQkJCWFycmF5LCByYW5nZS5zdGFydCwgcmFuZ2UuY291bnQgKTsKCgkJCQl9CgoJCQkJYXR0cmlidXRlLmNsZWFyVXBkYXRlUmFuZ2VzKCk7CgoJCQl9CgoJCQlhdHRyaWJ1dGUub25VcGxvYWRDYWxsYmFjaygpOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIGdldCggYXR0cmlidXRlICkgewoKCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwoKCQkJcmV0dXJuIGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgkJfQoKCQlmdW5jdGlvbiByZW1vdmUoIGF0dHJpYnV0ZSApIHsKCgkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCQlpZiAoIGRhdGEgKSB7CgoJCQkJZ2wuZGVsZXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciApOwoKCQkJCWJ1ZmZlcnMuZGVsZXRlKCBhdHRyaWJ1dGUgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGUoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApIHsKCgkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCWlmICggYXR0cmlidXRlLmlzR0xCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJY29uc3QgY2FjaGVkID0gYnVmZmVycy5nZXQoIGF0dHJpYnV0ZSApOwoKCQkJCWlmICggISBjYWNoZWQgfHwgY2FjaGVkLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCQkJYnVmZmVycy5zZXQoIGF0dHJpYnV0ZSwgewoJCQkJCQlidWZmZXI6IGF0dHJpYnV0ZS5idWZmZXIsCgkJCQkJCXR5cGU6IGF0dHJpYnV0ZS50eXBlLAoJCQkJCQlieXRlc1BlckVsZW1lbnQ6IGF0dHJpYnV0ZS5lbGVtZW50U2l6ZSwKCQkJCQkJdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KCQkJCQl9ICk7CgoJCQkJfQoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlidWZmZXJzLnNldCggYXR0cmlidXRlLCBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApICk7CgoJCQl9IGVsc2UgaWYgKCBkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCQlpZiAoIGRhdGEuc2l6ZSAhPT0gYXR0cmlidXRlLmFycmF5LmJ5dGVMZW5ndGggKSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMQXR0cmlidXRlczogVGhlIHNpemUgb2YgdGhlIGJ1ZmZlciBhdHRyaWJ1dGVcJ3MgYXJyYXkgYnVmZmVyIGRvZXMgbm90IG1hdGNoIHRoZSBvcmlnaW5hbCBzaXplLiBSZXNpemluZyBidWZmZXIgYXR0cmlidXRlcyBpcyBub3Qgc3VwcG9ydGVkLicgKTsKCgkJCQl9CgoJCQkJdXBkYXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICk7CgoJCQkJZGF0YS52ZXJzaW9uID0gYXR0cmlidXRlLnZlcnNpb247CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCgkJCWdldDogZ2V0LAoJCQlyZW1vdmU6IHJlbW92ZSwKCQkJdXBkYXRlOiB1cGRhdGUKCgkJfTsKCgl9CgoJdmFyIGFscGhhaGFzaF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2UG9zaXRpb24gKSApIGRpc2NhcmQ7XG4jZW5kaWYiOwoKCXZhciBhbHBoYWhhc2hfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRjb25zdCBmbG9hdCBBTFBIQV9IQVNIX1NDQUxFID0gMC4wNTtcblx0ZmxvYXQgaGFzaDJEKCB2ZWMyIHZhbHVlICkge1xuXHRcdHJldHVybiBmcmFjdCggMS4wZTQgKiBzaW4oIDE3LjAgKiB2YWx1ZS54ICsgMC4xICogdmFsdWUueSApICogKCAwLjEgKyBhYnMoIHNpbiggMTMuMCAqIHZhbHVlLnkgKyB2YWx1ZS54ICkgKSApICk7XG5cdH1cblx0ZmxvYXQgaGFzaDNEKCB2ZWMzIHZhbHVlICkge1xuXHRcdHJldHVybiBoYXNoMkQoIHZlYzIoIGhhc2gyRCggdmFsdWUueHkgKSwgdmFsdWUueiApICk7XG5cdH1cblx0ZmxvYXQgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2ZWMzIHBvc2l0aW9uICkge1xuXHRcdGZsb2F0IG1heERlcml2ID0gbWF4KFxuXHRcdFx0bGVuZ3RoKCBkRmR4KCBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0bGVuZ3RoKCBkRmR5KCBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBwaXhTY2FsZSA9IDEuMCAvICggQUxQSEFfSEFTSF9TQ0FMRSAqIG1heERlcml2ICk7XG5cdFx0dmVjMiBwaXhTY2FsZXMgPSB2ZWMyKFxuXHRcdFx0ZXhwMiggZmxvb3IoIGxvZzIoIHBpeFNjYWxlICkgKSApLFxuXHRcdFx0ZXhwMiggY2VpbCggbG9nMiggcGl4U2NhbGUgKSApIClcblx0XHQpO1xuXHRcdHZlYzIgYWxwaGEgPSB2ZWMyKFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnggKiBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnkgKiBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBsZXJwRmFjdG9yID0gZnJhY3QoIGxvZzIoIHBpeFNjYWxlICkgKTtcblx0XHRmbG9hdCB4ID0gKCAxLjAgLSBsZXJwRmFjdG9yICkgKiBhbHBoYS54ICsgbGVycEZhY3RvciAqIGFscGhhLnk7XG5cdFx0ZmxvYXQgYSA9IG1pbiggbGVycEZhY3RvciwgMS4wIC0gbGVycEZhY3RvciApO1xuXHRcdHZlYzMgY2FzZXMgPSB2ZWMzKFxuXHRcdFx0eCAqIHggLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApLFxuXHRcdFx0KCB4IC0gMC41ICogYSApIC8gKCAxLjAgLSBhICksXG5cdFx0XHQxLjAgLSAoICggMS4wIC0geCApICogKCAxLjAgLSB4ICkgLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApIClcblx0XHQpO1xuXHRcdGZsb2F0IHRocmVzaG9sZCA9ICggeCA8ICggMS4wIC0gYSApIClcblx0XHRcdD8gKCAoIHggPCBhICkgPyBjYXNlcy54IDogY2FzZXMueSApXG5cdFx0XHQ6IGNhc2VzLno7XG5cdFx0cmV0dXJuIGNsYW1wKCB0aHJlc2hvbGQgLCAxLjBlLTYsIDEuMCApO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBhbHBoYW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG5cdGRpZmZ1c2VDb2xvci5hICo9IHRleHR1cmUyRCggYWxwaGFNYXAsIHZBbHBoYU1hcFV2ICkuZztcbiNlbmRpZiI7CgoJdmFyIGFscGhhbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgoJdmFyIGFscGhhdGVzdF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHQjaWZkZWYgQUxQSEFfVE9fQ09WRVJBR0Vcblx0ZGlmZnVzZUNvbG9yLmEgPSBzbW9vdGhzdGVwKCBhbHBoYVRlc3QsIGFscGhhVGVzdCArIGZ3aWR0aCggZGlmZnVzZUNvbG9yLmEgKSwgZGlmZnVzZUNvbG9yLmEgKTtcblx0aWYgKCBkaWZmdXNlQ29sb3IuYSA9PSAwLjAgKSBkaXNjYXJkO1xuXHQjZWxzZVxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgYWxwaGFUZXN0ICkgZGlzY2FyZDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBhbHBoYXRlc3RfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHR1bmlmb3JtIGZsb2F0IGFscGhhVGVzdDtcbiNlbmRpZiI7CgoJdmFyIGFvbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQU9NQVBcblx0ZmxvYXQgYW1iaWVudE9jY2x1c2lvbiA9ICggdGV4dHVyZTJEKCBhb01hcCwgdkFvTWFwVXYgKS5yIC0gMS4wICkgKiBhb01hcEludGVuc2l0eSArIDEuMDtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGFtYmllbnRPY2NsdXNpb247XG5cdCNpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUICkgXG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9TSEVFTiApIFxuXHRcdHNoZWVuU3BlY3VsYXJJbmRpcmVjdCAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBTVEFOREFSRCApXG5cdFx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyICkgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICo9IGNvbXB1dGVTcGVjdWxhck9jY2x1c2lvbiggZG90TlYsIGFtYmllbnRPY2NsdXNpb24sIG1hdGVyaWFsLnJvdWdobmVzcyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGFvbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhb01hcDtcblx0dW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7CgoJdmFyIGJhdGNoaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0I2lmICEgZGVmaW5lZCggR0xfQU5HTEVfbXVsdGlfZHJhdyApXG5cdCNkZWZpbmUgZ2xfRHJhd0lEIF9nbF9EcmF3SURcblx0dW5pZm9ybSBpbnQgX2dsX0RyYXdJRDtcblx0I2VuZGlmXG5cdHVuaWZvcm0gaGlnaHAgc2FtcGxlcjJEIGJhdGNoaW5nVGV4dHVyZTtcblx0dW5pZm9ybSBoaWdocCB1c2FtcGxlcjJEIGJhdGNoaW5nSWRUZXh0dXJlO1xuXHRtYXQ0IGdldEJhdGNoaW5nTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKTtcblx0XHR2ZWM0IHYyID0gdGV4ZWxGZXRjaCggYmF0Y2hpbmdUZXh0dXJlLCBpdmVjMiggeCArIDEsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjMgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJhdGNoaW5nVGV4dHVyZSwgaXZlYzIoIHggKyAzLCB5ICksIDAgKTtcblx0XHRyZXR1cm4gbWF0NCggdjEsIHYyLCB2MywgdjQgKTtcblx0fVxuXHRmbG9hdCBnZXRJbmRpcmVjdEluZGV4KCBjb25zdCBpbiBpbnQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBiYXRjaGluZ0lkVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IHggPSBpICUgc2l6ZTtcblx0XHRpbnQgeSA9IGkgLyBzaXplO1xuXHRcdHJldHVybiBmbG9hdCggdGV4ZWxGZXRjaCggYmF0Y2hpbmdJZFRleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKS5yICk7XG5cdH1cbiNlbmRpZlxuI2lmZGVmIFVTRV9CQVRDSElOR19DT0xPUlxuXHR1bmlmb3JtIHNhbXBsZXIyRCBiYXRjaGluZ0NvbG9yVGV4dHVyZTtcblx0dmVjMyBnZXRCYXRjaGluZ0NvbG9yKCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nQ29sb3JUZXh0dXJlLCAwICkueDtcblx0XHRpbnQgaiA9IGludCggaSApO1xuXHRcdGludCB4ID0gaiAlIHNpemU7XG5cdFx0aW50IHkgPSBqIC8gc2l6ZTtcblx0XHRyZXR1cm4gdGV4ZWxGZXRjaCggYmF0Y2hpbmdDb2xvclRleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKS5yZ2I7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGJhdGNoaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0JBVENISU5HXG5cdG1hdDQgYmF0Y2hpbmdNYXRyaXggPSBnZXRCYXRjaGluZ01hdHJpeCggZ2V0SW5kaXJlY3RJbmRleCggZ2xfRHJhd0lEICkgKTtcbiNlbmRpZiI7CgoJdmFyIGJlZ2luX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkID0gdmVjMyggcG9zaXRpb24gKTtcbiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdHZQb3NpdGlvbiA9IHZlYzMoIHBvc2l0aW9uICk7XG4jZW5kaWYiOwoKCXZhciBiZWdpbm5vcm1hbF92ZXJ0ZXggPSAidmVjMyBvYmplY3ROb3JtYWwgPSB2ZWMzKCBub3JtYWwgKTtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIG9iamVjdFRhbmdlbnQgPSB2ZWMzKCB0YW5nZW50Lnh5eiApO1xuI2VuZGlmIjsKCgl2YXIgYnNkZnMgPSAiZmxvYXQgR19CbGlublBob25nX0ltcGxpY2l0KCApIHtcblx0cmV0dXJuIDAuMjU7XG59XG5mbG9hdCBEX0JsaW5uUGhvbmcoIGNvbnN0IGluIGZsb2F0IHNoaW5pbmVzcywgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogKCBzaGluaW5lc3MgKiAwLjUgKyAxLjAgKSAqIHBvdyggZG90TkgsIHNoaW5pbmVzcyApO1xufVxudmVjMyBCUkRGX0JsaW5uUGhvbmcoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzICkge1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggc3BlY3VsYXJDb2xvciwgMS4wLCBkb3RWSCApO1xuXHRmbG9hdCBHID0gR19CbGlublBob25nX0ltcGxpY2l0KCApO1xuXHRmbG9hdCBEID0gRF9CbGlublBob25nKCBzaGluaW5lc3MsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKCXZhciBpcmlkZXNjZW5jZV9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdGNvbnN0IG1hdDMgWFlaX1RPX1JFQzcwOSA9IG1hdDMoXG5cdFx0IDMuMjQwNDU0MiwgLTAuOTY5MjY2MCwgIDAuMDU1NjQzNCxcblx0XHQtMS41MzcxMzg1LCAgMS44NzYwMTA4LCAtMC4yMDQwMjU5LFxuXHRcdC0wLjQ5ODUzMTQsICAwLjA0MTU1NjAsICAxLjA1NzIyNTJcblx0KTtcblx0dmVjMyBGcmVzbmVsMFRvSW9yKCB2ZWMzIGZyZXNuZWwwICkge1xuXHRcdHZlYzMgc3FydEYwID0gc3FydCggZnJlc25lbDAgKTtcblx0XHRyZXR1cm4gKCB2ZWMzKCAxLjAgKSArIHNxcnRGMCApIC8gKCB2ZWMzKCAxLjAgKSAtIHNxcnRGMCApO1xuXHR9XG5cdHZlYzMgSW9yVG9GcmVzbmVsMCggdmVjMyB0cmFuc21pdHRlZElvciwgZmxvYXQgaW5jaWRlbnRJb3IgKSB7XG5cdFx0cmV0dXJuIHBvdzIoICggdHJhbnNtaXR0ZWRJb3IgLSB2ZWMzKCBpbmNpZGVudElvciApICkgLyAoIHRyYW5zbWl0dGVkSW9yICsgdmVjMyggaW5jaWRlbnRJb3IgKSApICk7XG5cdH1cblx0ZmxvYXQgSW9yVG9GcmVzbmVsMCggZmxvYXQgdHJhbnNtaXR0ZWRJb3IsIGZsb2F0IGluY2lkZW50SW9yICkge1xuXHRcdHJldHVybiBwb3cyKCAoIHRyYW5zbWl0dGVkSW9yIC0gaW5jaWRlbnRJb3IgKSAvICggdHJhbnNtaXR0ZWRJb3IgKyBpbmNpZGVudElvciApKTtcblx0fVxuXHR2ZWMzIGV2YWxTZW5zaXRpdml0eSggZmxvYXQgT1BELCB2ZWMzIHNoaWZ0ICkge1xuXHRcdGZsb2F0IHBoYXNlID0gMi4wICogUEkgKiBPUEQgKiAxLjBlLTk7XG5cdFx0dmVjMyB2YWwgPSB2ZWMzKCA1LjQ4NTZlLTEzLCA0LjQyMDFlLTEzLCA1LjI0ODFlLTEzICk7XG5cdFx0dmVjMyBwb3MgPSB2ZWMzKCAxLjY4MTBlKzA2LCAxLjc5NTNlKzA2LCAyLjIwODRlKzA2ICk7XG5cdFx0dmVjMyB2YXIgPSB2ZWMzKCA0LjMyNzhlKzA5LCA5LjMwNDZlKzA5LCA2LjYxMjFlKzA5ICk7XG5cdFx0dmVjMyB4eXogPSB2YWwgKiBzcXJ0KCAyLjAgKiBQSSAqIHZhciApICogY29zKCBwb3MgKiBwaGFzZSArIHNoaWZ0ICkgKiBleHAoIC0gcG93MiggcGhhc2UgKSAqIHZhciApO1xuXHRcdHh5ei54ICs9IDkuNzQ3MGUtMTQgKiBzcXJ0KCAyLjAgKiBQSSAqIDQuNTI4MmUrMDkgKSAqIGNvcyggMi4yMzk5ZSswNiAqIHBoYXNlICsgc2hpZnRbIDAgXSApICogZXhwKCAtIDQuNTI4MmUrMDkgKiBwb3cyKCBwaGFzZSApICk7XG5cdFx0eHl6IC89IDEuMDY4NWUtNztcblx0XHR2ZWMzIHJnYiA9IFhZWl9UT19SRUM3MDkgKiB4eXo7XG5cdFx0cmV0dXJuIHJnYjtcblx0fVxuXHR2ZWMzIGV2YWxJcmlkZXNjZW5jZSggZmxvYXQgb3V0c2lkZUlPUiwgZmxvYXQgZXRhMiwgZmxvYXQgY29zVGhldGExLCBmbG9hdCB0aGluRmlsbVRoaWNrbmVzcywgdmVjMyBiYXNlRjAgKSB7XG5cdFx0dmVjMyBJO1xuXHRcdGZsb2F0IGlyaWRlc2NlbmNlSU9SID0gbWl4KCBvdXRzaWRlSU9SLCBldGEyLCBzbW9vdGhzdGVwKCAwLjAsIDAuMDMsIHRoaW5GaWxtVGhpY2tuZXNzICkgKTtcblx0XHRmbG9hdCBzaW5UaGV0YTJTcSA9IHBvdzIoIG91dHNpZGVJT1IgLyBpcmlkZXNjZW5jZUlPUiApICogKCAxLjAgLSBwb3cyKCBjb3NUaGV0YTEgKSApO1xuXHRcdGZsb2F0IGNvc1RoZXRhMlNxID0gMS4wIC0gc2luVGhldGEyU3E7XG5cdFx0aWYgKCBjb3NUaGV0YTJTcSA8IDAuMCApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9XG5cdFx0ZmxvYXQgY29zVGhldGEyID0gc3FydCggY29zVGhldGEyU3EgKTtcblx0XHRmbG9hdCBSMCA9IElvclRvRnJlc25lbDAoIGlyaWRlc2NlbmNlSU9SLCBvdXRzaWRlSU9SICk7XG5cdFx0ZmxvYXQgUjEyID0gRl9TY2hsaWNrKCBSMCwgMS4wLCBjb3NUaGV0YTEgKTtcblx0XHRmbG9hdCBUMTIxID0gMS4wIC0gUjEyO1xuXHRcdGZsb2F0IHBoaTEyID0gMC4wO1xuXHRcdGlmICggaXJpZGVzY2VuY2VJT1IgPCBvdXRzaWRlSU9SICkgcGhpMTIgPSBQSTtcblx0XHRmbG9hdCBwaGkyMSA9IFBJIC0gcGhpMTI7XG5cdFx0dmVjMyBiYXNlSU9SID0gRnJlc25lbDBUb0lvciggY2xhbXAoIGJhc2VGMCwgMC4wLCAwLjk5OTkgKSApO1x0XHR2ZWMzIFIxID0gSW9yVG9GcmVzbmVsMCggYmFzZUlPUiwgaXJpZGVzY2VuY2VJT1IgKTtcblx0XHR2ZWMzIFIyMyA9IEZfU2NobGljayggUjEsIDEuMCwgY29zVGhldGEyICk7XG5cdFx0dmVjMyBwaGkyMyA9IHZlYzMoIDAuMCApO1xuXHRcdGlmICggYmFzZUlPUlsgMCBdIDwgaXJpZGVzY2VuY2VJT1IgKSBwaGkyM1sgMCBdID0gUEk7XG5cdFx0aWYgKCBiYXNlSU9SWyAxIF0gPCBpcmlkZXNjZW5jZUlPUiApIHBoaTIzWyAxIF0gPSBQSTtcblx0XHRpZiAoIGJhc2VJT1JbIDIgXSA8IGlyaWRlc2NlbmNlSU9SICkgcGhpMjNbIDIgXSA9IFBJO1xuXHRcdGZsb2F0IE9QRCA9IDIuMCAqIGlyaWRlc2NlbmNlSU9SICogdGhpbkZpbG1UaGlja25lc3MgKiBjb3NUaGV0YTI7XG5cdFx0dmVjMyBwaGkgPSB2ZWMzKCBwaGkyMSApICsgcGhpMjM7XG5cdFx0dmVjMyBSMTIzID0gY2xhbXAoIFIxMiAqIFIyMywgMWUtNSwgMC45OTk5ICk7XG5cdFx0dmVjMyByMTIzID0gc3FydCggUjEyMyApO1xuXHRcdHZlYzMgUnMgPSBwb3cyKCBUMTIxICkgKiBSMjMgLyAoIHZlYzMoIDEuMCApIC0gUjEyMyApO1xuXHRcdHZlYzMgQzAgPSBSMTIgKyBScztcblx0XHRJID0gQzA7XG5cdFx0dmVjMyBDbSA9IFJzIC0gVDEyMTtcblx0XHRmb3IgKCBpbnQgbSA9IDE7IG0gPD0gMjsgKysgbSApIHtcblx0XHRcdENtICo9IHIxMjM7XG5cdFx0XHR2ZWMzIFNtID0gMi4wICogZXZhbFNlbnNpdGl2aXR5KCBmbG9hdCggbSApICogT1BELCBmbG9hdCggbSApICogcGhpICk7XG5cdFx0XHRJICs9IENtICogU207XG5cdFx0fVxuXHRcdHJldHVybiBtYXgoIEksIHZlYzMoIDAuMCApICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGJ1bXBtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0JVTVBNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgYnVtcE1hcDtcblx0dW5pZm9ybSBmbG9hdCBidW1wU2NhbGU7XG5cdHZlYzIgZEhkeHlfZndkKCkge1xuXHRcdHZlYzIgZFNUZHggPSBkRmR4KCB2QnVtcE1hcFV2ICk7XG5cdFx0dmVjMiBkU1RkeSA9IGRGZHkoIHZCdW1wTWFwVXYgKTtcblx0XHRmbG9hdCBIbGwgPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKS54O1xuXHRcdGZsb2F0IGRCeCA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdkJ1bXBNYXBVdiArIGRTVGR4ICkueCAtIEhsbDtcblx0XHRmbG9hdCBkQnkgPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKyBkU1RkeSApLnggLSBIbGw7XG5cdFx0cmV0dXJuIHZlYzIoIGRCeCwgZEJ5ICk7XG5cdH1cblx0dmVjMyBwZXJ0dXJiTm9ybWFsQXJiKCB2ZWMzIHN1cmZfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiBkSGR4eSwgZmxvYXQgZmFjZURpcmVjdGlvbiApIHtcblx0XHR2ZWMzIHZTaWdtYVggPSBub3JtYWxpemUoIGRGZHgoIHN1cmZfcG9zLnh5eiApICk7XG5cdFx0dmVjMyB2U2lnbWFZID0gbm9ybWFsaXplKCBkRmR5KCBzdXJmX3Bvcy54eXogKSApO1xuXHRcdHZlYzMgdk4gPSBzdXJmX25vcm07XG5cdFx0dmVjMyBSMSA9IGNyb3NzKCB2U2lnbWFZLCB2TiApO1xuXHRcdHZlYzMgUjIgPSBjcm9zcyggdk4sIHZTaWdtYVggKTtcblx0XHRmbG9hdCBmRGV0ID0gZG90KCB2U2lnbWFYLCBSMSApICogZmFjZURpcmVjdGlvbjtcblx0XHR2ZWMzIHZHcmFkID0gc2lnbiggZkRldCApICogKCBkSGR4eS54ICogUjEgKyBkSGR4eS55ICogUjIgKTtcblx0XHRyZXR1cm4gbm9ybWFsaXplKCBhYnMoIGZEZXQgKSAqIHN1cmZfbm9ybSAtIHZHcmFkICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmVjNCBwbGFuZTtcblx0I2lmZGVmIEFMUEhBX1RPX0NPVkVSQUdFXG5cdFx0ZmxvYXQgZGlzdGFuY2VUb1BsYW5lLCBkaXN0YW5jZUdyYWRpZW50O1xuXHRcdGZsb2F0IGNsaXBPcGFjaXR5ID0gMS4wO1xuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBVTklPTl9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRkaXN0YW5jZVRvUGxhbmUgPSAtIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgKyBwbGFuZS53O1xuXHRcdFx0ZGlzdGFuY2VHcmFkaWVudCA9IGZ3aWR0aCggZGlzdGFuY2VUb1BsYW5lICkgLyAyLjA7XG5cdFx0XHRjbGlwT3BhY2l0eSAqPSBzbW9vdGhzdGVwKCAtIGRpc3RhbmNlR3JhZGllbnQsIGRpc3RhbmNlR3JhZGllbnQsIGRpc3RhbmNlVG9QbGFuZSApO1xuXHRcdFx0aWYgKCBjbGlwT3BhY2l0eSA9PSAwLjAgKSBkaXNjYXJkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0XHRmbG9hdCB1bmlvbkNsaXBPcGFjaXR5ID0gMS4wO1xuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRcdGRpc3RhbmNlVG9QbGFuZSA9IC0gZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSArIHBsYW5lLnc7XG5cdFx0XHRcdGRpc3RhbmNlR3JhZGllbnQgPSBmd2lkdGgoIGRpc3RhbmNlVG9QbGFuZSApIC8gMi4wO1xuXHRcdFx0XHR1bmlvbkNsaXBPcGFjaXR5ICo9IDEuMCAtIHNtb290aHN0ZXAoIC0gZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VUb1BsYW5lICk7XG5cdFx0XHR9XG5cdFx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdFx0Y2xpcE9wYWNpdHkgKj0gMS4wIC0gdW5pb25DbGlwT3BhY2l0eTtcblx0XHQjZW5kaWZcblx0XHRkaWZmdXNlQ29sb3IuYSAqPSBjbGlwT3BhY2l0eTtcblx0XHRpZiAoIGRpZmZ1c2VDb2xvci5hID09IDAuMCApIGRpc2NhcmQ7XG5cdCNlbHNlXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IFVOSU9OX0NMSVBQSU5HX1BMQU5FUzsgaSArKyApIHtcblx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdGlmICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSBkaXNjYXJkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0XHRib29sIGNsaXBwZWQgPSB0cnVlO1xuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRcdGNsaXBwZWQgPSAoIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgPiBwbGFuZS53ICkgJiYgY2xpcHBlZDtcblx0XHRcdH1cblx0XHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdFx0XHRpZiAoIGNsaXBwZWQgKSBkaXNjYXJkO1xuXHRcdCNlbmRpZlxuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2YXJ5aW5nIHZlYzMgdkNsaXBQb3NpdGlvbjtcblx0dW5pZm9ybSB2ZWM0IGNsaXBwaW5nUGxhbmVzWyBOVU1fQ0xJUFBJTkdfUExBTkVTIF07XG4jZW5kaWYiOwoKCXZhciBjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZhcnlpbmcgdmVjMyB2Q2xpcFBvc2l0aW9uO1xuI2VuZGlmIjsKCgl2YXIgY2xpcHBpbmdfcGxhbmVzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dkNsaXBQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWYiOwoKCXZhciBjb2xvcl9mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0ZGlmZnVzZUNvbG9yICo9IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdGRpZmZ1c2VDb2xvci5yZ2IgKj0gdkNvbG9yO1xuI2VuZGlmIjsKCgl2YXIgY29sb3JfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdHZhcnlpbmcgdmVjMyB2Q29sb3I7XG4jZW5kaWYiOwoKCXZhciBjb2xvcl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0JBVENISU5HX0NPTE9SIClcblx0dmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7CgoJdmFyIGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dkNvbG9yID0gdmVjNCggMS4wICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKSB8fCBkZWZpbmVkKCBVU0VfSU5TVEFOQ0lOR19DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9CQVRDSElOR19DT0xPUiApXG5cdHZDb2xvciA9IHZlYzMoIDEuMCApO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NPTE9SXG5cdHZDb2xvciAqPSBjb2xvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JTlNUQU5DSU5HX0NPTE9SXG5cdHZDb2xvci54eXogKj0gaW5zdGFuY2VDb2xvci54eXo7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdfQ09MT1Jcblx0dmVjMyBiYXRjaGluZ0NvbG9yID0gZ2V0QmF0Y2hpbmdDb2xvciggZ2V0SW5kaXJlY3RJbmRleCggZ2xfRHJhd0lEICkgKTtcblx0dkNvbG9yLnh5eiAqPSBiYXRjaGluZ0NvbG9yLnh5ejtcbiNlbmRpZiI7CgoJdmFyIGNvbW1vbiA9ICIjZGVmaW5lIFBJIDMuMTQxNTkyNjUzNTg5NzkzXG4jZGVmaW5lIFBJMiA2LjI4MzE4NTMwNzE3OTU4NlxuI2RlZmluZSBQSV9IQUxGIDEuNTcwNzk2MzI2Nzk0ODk2NlxuI2RlZmluZSBSRUNJUFJPQ0FMX1BJIDAuMzE4MzA5ODg2MTgzNzkwN1xuI2RlZmluZSBSRUNJUFJPQ0FMX1BJMiAwLjE1OTE1NDk0MzA5MTg5NTM1XG4jZGVmaW5lIEVQU0lMT04gMWUtNlxuI2lmbmRlZiBzYXR1cmF0ZVxuI2RlZmluZSBzYXR1cmF0ZSggYSApIGNsYW1wKCBhLCAwLjAsIDEuMCApXG4jZW5kaWZcbiNkZWZpbmUgd2hpdGVDb21wbGVtZW50KCBhICkgKCAxLjAgLSBzYXR1cmF0ZSggYSApIClcbmZsb2F0IHBvdzIoIGNvbnN0IGluIGZsb2F0IHggKSB7IHJldHVybiB4Kng7IH1cbnZlYzMgcG93MiggY29uc3QgaW4gdmVjMyB4ICkgeyByZXR1cm4geCp4OyB9XG5mbG9hdCBwb3czKCBjb25zdCBpbiBmbG9hdCB4ICkgeyByZXR1cm4geCp4Kng7IH1cbmZsb2F0IHBvdzQoIGNvbnN0IGluIGZsb2F0IHggKSB7IGZsb2F0IHgyID0geCp4OyByZXR1cm4geDIqeDI7IH1cbmZsb2F0IG1heDMoIGNvbnN0IGluIHZlYzMgdiApIHsgcmV0dXJuIG1heCggbWF4KCB2LngsIHYueSApLCB2LnogKTsgfVxuZmxvYXQgYXZlcmFnZSggY29uc3QgaW4gdmVjMyB2ICkgeyByZXR1cm4gZG90KCB2LCB2ZWMzKCAwLjMzMzMzMzMgKSApOyB9XG5oaWdocCBmbG9hdCByYW5kKCBjb25zdCBpbiB2ZWMyIHV2ICkge1xuXHRjb25zdCBoaWdocCBmbG9hdCBhID0gMTIuOTg5OCwgYiA9IDc4LjIzMywgYyA9IDQzNzU4LjU0NTM7XG5cdGhpZ2hwIGZsb2F0IGR0ID0gZG90KCB1di54eSwgdmVjMiggYSxiICkgKSwgc24gPSBtb2QoIGR0LCBQSSApO1xuXHRyZXR1cm4gZnJhY3QoIHNpbiggc24gKSAqIGMgKTtcbn1cbiNpZmRlZiBISUdIX1BSRUNJU0lPTlxuXHRmbG9hdCBwcmVjaXNpb25TYWZlTGVuZ3RoKCB2ZWMzIHYgKSB7IHJldHVybiBsZW5ndGgoIHYgKTsgfVxuI2Vsc2Vcblx0ZmxvYXQgcHJlY2lzaW9uU2FmZUxlbmd0aCggdmVjMyB2ICkge1xuXHRcdGZsb2F0IG1heENvbXBvbmVudCA9IG1heDMoIGFicyggdiApICk7XG5cdFx0cmV0dXJuIGxlbmd0aCggdiAvIG1heENvbXBvbmVudCApICogbWF4Q29tcG9uZW50O1xuXHR9XG4jZW5kaWZcbnN0cnVjdCBJbmNpZGVudExpZ2h0IHtcblx0dmVjMyBjb2xvcjtcblx0dmVjMyBkaXJlY3Rpb247XG5cdGJvb2wgdmlzaWJsZTtcbn07XG5zdHJ1Y3QgUmVmbGVjdGVkTGlnaHQge1xuXHR2ZWMzIGRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgZGlyZWN0U3BlY3VsYXI7XG5cdHZlYzMgaW5kaXJlY3REaWZmdXNlO1xuXHR2ZWMzIGluZGlyZWN0U3BlY3VsYXI7XG59O1xuI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0dmFyeWluZyB2ZWMzIHZQb3NpdGlvbjtcbiNlbmRpZlxudmVjMyB0cmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7XG59XG52ZWMzIGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCB2ZWM0KCBkaXIsIDAuMCApICogbWF0cml4ICkueHl6ICk7XG59XG5tYXQzIHRyYW5zcG9zZU1hdDMoIGNvbnN0IGluIG1hdDMgbSApIHtcblx0bWF0MyB0bXA7XG5cdHRtcFsgMCBdID0gdmVjMyggbVsgMCBdLngsIG1bIDEgXS54LCBtWyAyIF0ueCApO1xuXHR0bXBbIDEgXSA9IHZlYzMoIG1bIDAgXS55LCBtWyAxIF0ueSwgbVsgMiBdLnkgKTtcblx0dG1wWyAyIF0gPSB2ZWMzKCBtWyAwIF0ueiwgbVsgMSBdLnosIG1bIDIgXS56ICk7XG5cdHJldHVybiB0bXA7XG59XG5ib29sIGlzUGVyc3BlY3RpdmVNYXRyaXgoIG1hdDQgbSApIHtcblx0cmV0dXJuIG1bIDIgXVsgMyBdID09IC0gMS4wO1xufVxudmVjMiBlcXVpcmVjdFV2KCBpbiB2ZWMzIGRpciApIHtcblx0ZmxvYXQgdSA9IGF0YW4oIGRpci56LCBkaXIueCApICogUkVDSVBST0NBTF9QSTIgKyAwLjU7XG5cdGZsb2F0IHYgPSBhc2luKCBjbGFtcCggZGlyLnksIC0gMS4wLCAxLjAgKSApICogUkVDSVBST0NBTF9QSSArIDAuNTtcblx0cmV0dXJuIHZlYzIoIHUsIHYgKTtcbn1cbnZlYzMgQlJERl9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvciApIHtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBkaWZmdXNlQ29sb3I7XG59XG52ZWMzIEZfU2NobGljayggY29uc3QgaW4gdmVjMyBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufVxuZmxvYXQgRl9TY2hsaWNrKCBjb25zdCBpbiBmbG9hdCBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKCXZhciBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQgPSAiI2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0I2RlZmluZSBjdWJlVVZfbWluTWlwTGV2ZWwgNC4wXG5cdCNkZWZpbmUgY3ViZVVWX21pblRpbGVTaXplIDE2LjBcblx0ZmxvYXQgZ2V0RmFjZSggdmVjMyBkaXJlY3Rpb24gKSB7XG5cdFx0dmVjMyBhYnNEaXJlY3Rpb24gPSBhYnMoIGRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGZhY2UgPSAtIDEuMDtcblx0XHRpZiAoIGFic0RpcmVjdGlvbi54ID4gYWJzRGlyZWN0aW9uLnogKSB7XG5cdFx0XHRpZiAoIGFic0RpcmVjdGlvbi54ID4gYWJzRGlyZWN0aW9uLnkgKVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnggPiAwLjAgPyAwLjAgOiAzLjA7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKCBhYnNEaXJlY3Rpb24ueiA+IGFic0RpcmVjdGlvbi55IClcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi56ID4gMC4wID8gMi4wIDogNS4wO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnkgPiAwLjAgPyAxLjAgOiA0LjA7XG5cdFx0fVxuXHRcdHJldHVybiBmYWNlO1xuXHR9XG5cdHZlYzIgZ2V0VVYoIHZlYzMgZGlyZWN0aW9uLCBmbG9hdCBmYWNlICkge1xuXHRcdHZlYzIgdXY7XG5cdFx0aWYgKCBmYWNlID09IDAuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggZGlyZWN0aW9uLnosIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi54ICk7XG5cdFx0fSBlbHNlIGlmICggZmFjZSA9PSAxLjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIC0gZGlyZWN0aW9uLngsIC0gZGlyZWN0aW9uLnogKSAvIGFicyggZGlyZWN0aW9uLnkgKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDIuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnggKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDQuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnogKSAvIGFicyggZGlyZWN0aW9uLnkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dXYgPSB2ZWMyKCBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcblx0XHR9XG5cdFx0cmV0dXJuIDAuNSAqICggdXYgKyAxLjAgKTtcblx0fVxuXHR2ZWMzIGJpbGluZWFyQ3ViZVVWKCBzYW1wbGVyMkQgZW52TWFwLCB2ZWMzIGRpcmVjdGlvbiwgZmxvYXQgbWlwSW50ICkge1xuXHRcdGZsb2F0IGZhY2UgPSBnZXRGYWNlKCBkaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBmaWx0ZXJJbnQgPSBtYXgoIGN1YmVVVl9taW5NaXBMZXZlbCAtIG1pcEludCwgMC4wICk7XG5cdFx0bWlwSW50ID0gbWF4KCBtaXBJbnQsIGN1YmVVVl9taW5NaXBMZXZlbCApO1xuXHRcdGZsb2F0IGZhY2VTaXplID0gZXhwMiggbWlwSW50ICk7XG5cdFx0aGlnaHAgdmVjMiB1diA9IGdldFVWKCBkaXJlY3Rpb24sIGZhY2UgKSAqICggZmFjZVNpemUgLSAyLjAgKSArIDEuMDtcblx0XHRpZiAoIGZhY2UgPiAyLjAgKSB7XG5cdFx0XHR1di55ICs9IGZhY2VTaXplO1xuXHRcdFx0ZmFjZSAtPSAzLjA7XG5cdFx0fVxuXHRcdHV2LnggKz0gZmFjZSAqIGZhY2VTaXplO1xuXHRcdHV2LnggKz0gZmlsdGVySW50ICogMy4wICogY3ViZVVWX21pblRpbGVTaXplO1xuXHRcdHV2LnkgKz0gNC4wICogKCBleHAyKCBDVUJFVVZfTUFYX01JUCApIC0gZmFjZVNpemUgKTtcblx0XHR1di54ICo9IENVQkVVVl9URVhFTF9XSURUSDtcblx0XHR1di55ICo9IENVQkVVVl9URVhFTF9IRUlHSFQ7XG5cdFx0I2lmZGVmIHRleHR1cmUyREdyYWRFWFRcblx0XHRcdHJldHVybiB0ZXh0dXJlMkRHcmFkRVhUKCBlbnZNYXAsIHV2LCB2ZWMyKCAwLjAgKSwgdmVjMiggMC4wICkgKS5yZ2I7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdH1cblx0I2RlZmluZSBjdWJlVVZfcjAgMS4wXG5cdCNkZWZpbmUgY3ViZVVWX20wIC0gMi4wXG5cdCNkZWZpbmUgY3ViZVVWX3IxIDAuOFxuXHQjZGVmaW5lIGN1YmVVVl9tMSAtIDEuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNCAwLjRcblx0I2RlZmluZSBjdWJlVVZfbTQgMi4wXG5cdCNkZWZpbmUgY3ViZVVWX3I1IDAuMzA1XG5cdCNkZWZpbmUgY3ViZVVWX201IDMuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNiAwLjIxXG5cdCNkZWZpbmUgY3ViZVVWX202IDQuMFxuXHRmbG9hdCByb3VnaG5lc3NUb01pcCggZmxvYXQgcm91Z2huZXNzICkge1xuXHRcdGZsb2F0IG1pcCA9IDAuMDtcblx0XHRpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjEgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yMCAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTEgLSBjdWJlVVZfbTAgKSAvICggY3ViZVVWX3IwIC0gY3ViZVVWX3IxICkgKyBjdWJlVVZfbTA7XG5cdFx0fSBlbHNlIGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yNCApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3IxIC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tNCAtIGN1YmVVVl9tMSApIC8gKCBjdWJlVVZfcjEgLSBjdWJlVVZfcjQgKSArIGN1YmVVVl9tMTtcblx0XHR9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3I1ICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjQgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX201IC0gY3ViZVVWX200ICkgLyAoIGN1YmVVVl9yNCAtIGN1YmVVVl9yNSApICsgY3ViZVVWX200O1xuXHRcdH0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjYgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yNSAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTYgLSBjdWJlVVZfbTUgKSAvICggY3ViZVVWX3I1IC0gY3ViZVVWX3I2ICkgKyBjdWJlVVZfbTU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1pcCA9IC0gMi4wICogbG9nMiggMS4xNiAqIHJvdWdobmVzcyApO1x0XHR9XG5cdFx0cmV0dXJuIG1pcDtcblx0fVxuXHR2ZWM0IHRleHR1cmVDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgc2FtcGxlRGlyLCBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0ZmxvYXQgbWlwID0gY2xhbXAoIHJvdWdobmVzc1RvTWlwKCByb3VnaG5lc3MgKSwgY3ViZVVWX20wLCBDVUJFVVZfTUFYX01JUCApO1xuXHRcdGZsb2F0IG1pcEYgPSBmcmFjdCggbWlwICk7XG5cdFx0ZmxvYXQgbWlwSW50ID0gZmxvb3IoIG1pcCApO1xuXHRcdHZlYzMgY29sb3IwID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKTtcblx0XHRpZiAoIG1pcEYgPT0gMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzQoIGNvbG9yMCwgMS4wICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZlYzMgY29sb3IxID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKyAxLjAgKTtcblx0XHRcdHJldHVybiB2ZWM0KCBtaXgoIGNvbG9yMCwgY29sb3IxLCBtaXBGICksIDEuMCApO1xuXHRcdH1cblx0fVxuI2VuZGlmIjsKCgl2YXIgZGVmYXVsdG5vcm1hbF92ZXJ0ZXggPSAidmVjMyB0cmFuc2Zvcm1lZE5vcm1hbCA9IG9iamVjdE5vcm1hbDtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIHRyYW5zZm9ybWVkVGFuZ2VudCA9IG9iamVjdFRhbmdlbnQ7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0bWF0MyBibSA9IG1hdDMoIGJhdGNoaW5nTWF0cml4ICk7XG5cdHRyYW5zZm9ybWVkTm9ybWFsIC89IHZlYzMoIGRvdCggYm1bIDAgXSwgYm1bIDAgXSApLCBkb3QoIGJtWyAxIF0sIGJtWyAxIF0gKSwgZG90KCBibVsgMiBdLCBibVsgMiBdICkgKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgPSBibSAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSBibSAqIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuXHRtYXQzIGltID0gbWF0MyggaW5zdGFuY2VNYXRyaXggKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgLz0gdmVjMyggZG90KCBpbVsgMCBdLCBpbVsgMCBdICksIGRvdCggaW1bIDEgXSwgaW1bIDEgXSApLCBkb3QoIGltWyAyIF0sIGltWyAyIF0gKSApO1xuXHR0cmFuc2Zvcm1lZE5vcm1hbCA9IGltICogdHJhbnNmb3JtZWROb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHRyYW5zZm9ybWVkVGFuZ2VudCA9IGltICogdHJhbnNmb3JtZWRUYW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxudHJhbnNmb3JtZWROb3JtYWwgPSBub3JtYWxNYXRyaXggKiB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNpZmRlZiBGTElQX1NJREVEXG5cdHRyYW5zZm9ybWVkTm9ybWFsID0gLSB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHRyYW5zZm9ybWVkVGFuZ2VudCA9ICggbW9kZWxWaWV3TWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWRUYW5nZW50LCAwLjAgKSApLnh5ejtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSAtIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZGlzcGxhY2VtZW50TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudFNjYWxlO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudEJpYXM7XG4jZW5kaWYiOwoKCXZhciBkaXNwbGFjZW1lbnRtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHRyYW5zZm9ybWVkICs9IG5vcm1hbGl6ZSggb2JqZWN0Tm9ybWFsICkgKiAoIHRleHR1cmUyRCggZGlzcGxhY2VtZW50TWFwLCB2RGlzcGxhY2VtZW50TWFwVXYgKS54ICogZGlzcGxhY2VtZW50U2NhbGUgKyBkaXNwbGFjZW1lbnRCaWFzICk7XG4jZW5kaWYiOwoKCXZhciBlbWlzc2l2ZW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZlYzQgZW1pc3NpdmVDb2xvciA9IHRleHR1cmUyRCggZW1pc3NpdmVNYXAsIHZFbWlzc2l2ZU1hcFV2ICk7XG5cdCNpZmRlZiBERUNPREVfVklERU9fVEVYVFVSRV9FTUlTU0lWRVxuXHRcdGVtaXNzaXZlQ29sb3IgPSBzUkdCVHJhbnNmZXJFT1RGKCBlbWlzc2l2ZUNvbG9yICk7XG5cdCNlbmRpZlxuXHR0b3RhbEVtaXNzaXZlUmFkaWFuY2UgKj0gZW1pc3NpdmVDb2xvci5yZ2I7XG4jZW5kaWYiOwoKCXZhciBlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZW1pc3NpdmVNYXA7XG4jZW5kaWYiOwoKCXZhciBjb2xvcnNwYWNlX2ZyYWdtZW50ID0gImdsX0ZyYWdDb2xvciA9IGxpbmVhclRvT3V0cHV0VGV4ZWwoIGdsX0ZyYWdDb2xvciApOyI7CgoJdmFyIGNvbG9yc3BhY2VfcGFyc19mcmFnbWVudCA9ICJ2ZWM0IExpbmVhclRyYW5zZmVyT0VURiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZhbHVlO1xufVxudmVjNCBzUkdCVHJhbnNmZXJFT1RGKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiAqIDAuOTQ3ODY3Mjk4NiArIHZlYzMoIDAuMDUyMTMyNzAxNCApLCB2ZWMzKCAyLjQgKSApLCB2YWx1ZS5yZ2IgKiAwLjA3NzM5OTM4MDgsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wNDA0NSApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IHNSR0JUcmFuc2Zlck9FVEYoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCBtaXgoIHBvdyggdmFsdWUucmdiLCB2ZWMzKCAwLjQxNjY2ICkgKSAqIDEuMDU1IC0gdmVjMyggMC4wNTUgKSwgdmFsdWUucmdiICogMTIuOTIsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wMDMxMzA4ICkgKSApICksIHZhbHVlLmEgKTtcbn0iOwoKCXZhciBlbnZtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdHZlYzMgY2FtZXJhVG9GcmFnO1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZlYzMoIC0gdmlld01hdHJpeFsgMCBdWyAyIF0sIC0gdmlld01hdHJpeFsgMSBdWyAyIF0sIC0gdmlld01hdHJpeFsgMiBdWyAyIF0gKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZXb3JsZFBvc2l0aW9uIC0gY2FtZXJhUG9zaXRpb24gKTtcblx0XHR9XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZnJhY3QoIGNhbWVyYVRvRnJhZywgd29ybGROb3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuXHRcdCNlbmRpZlxuXHQjZWxzZVxuXHRcdHZlYzMgcmVmbGVjdFZlYyA9IHZSZWZsZWN0O1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IGVudkNvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiB2ZWMzKCBmbGlwRW52TWFwICogcmVmbGVjdFZlYy54LCByZWZsZWN0VmVjLnl6ICkgKTtcblx0I2Vsc2Vcblx0XHR2ZWM0IGVudkNvbG9yID0gdmVjNCggMC4wICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZXG5cdFx0b3V0Z29pbmdMaWdodCA9IG1peCggb3V0Z29pbmdMaWdodCwgb3V0Z29pbmdMaWdodCAqIGVudkNvbG9yLnh5eiwgc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfTUlYIClcblx0XHRvdXRnb2luZ0xpZ2h0ID0gbWl4KCBvdXRnb2luZ0xpZ2h0LCBlbnZDb2xvci54eXosIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX0JMRU5ESU5HX0FERCApXG5cdFx0b3V0Z29pbmdMaWdodCArPSBlbnZDb2xvci54eXogKiBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IGVudk1hcEludGVuc2l0eTtcblx0dW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwO1xuXHR1bmlmb3JtIG1hdDMgZW52TWFwUm90YXRpb247XG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dW5pZm9ybSBzYW1wbGVyQ3ViZSBlbnZNYXA7XG5cdCNlbHNlXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgZW52TWFwO1xuXHQjZW5kaWZcblx0XG4jZW5kaWYiOwoKCXZhciBlbnZtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IHJlZmxlY3Rpdml0eTtcblx0I2lmIGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFBIT05HICkgfHwgZGVmaW5lZCggTEFNQkVSVCApXG5cdFx0I2RlZmluZSBFTlZfV09STERQT1Ncblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbHNlXG5cdFx0dmFyeWluZyB2ZWMzIHZSZWZsZWN0O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGVudm1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggUEhPTkcgKSB8fCBkZWZpbmVkKCBMQU1CRVJUIClcblx0XHQjZGVmaW5lIEVOVl9XT1JMRFBPU1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdFxuXHRcdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcblx0I2Vsc2Vcblx0XHR2YXJ5aW5nIHZlYzMgdlJlZmxlY3Q7XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgZW52bWFwX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcblx0I2Vsc2Vcblx0XHR2ZWMzIGNhbWVyYVRvVmVydGV4O1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb1ZlcnRleCA9IG5vcm1hbGl6ZSggdmVjMyggLSB2aWV3TWF0cml4WyAwIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAxIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAyIF1bIDIgXSApICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB3b3JsZFBvc2l0aW9uLnh5eiAtIGNhbWVyYVBvc2l0aW9uICk7XG5cdFx0fVxuXHRcdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCB0cmFuc2Zvcm1lZE5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2UmVmbGVjdCA9IHJlZmxlY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCApO1xuXHRcdCNlbHNlXG5cdFx0XHR2UmVmbGVjdCA9IHJlZnJhY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCwgcmVmcmFjdGlvblJhdGlvICk7XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgZm9nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2Rm9nRGVwdGggPSAtIG12UG9zaXRpb24uejtcbiNlbmRpZiI7CgoJdmFyIGZvZ19wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcbiNlbmRpZiI7CgoJdmFyIGZvZ19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHQjaWZkZWYgRk9HX0VYUDJcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSAxLjAgLSBleHAoIC0gZm9nRGVuc2l0eSAqIGZvZ0RlbnNpdHkgKiB2Rm9nRGVwdGggKiB2Rm9nRGVwdGggKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSBzbW9vdGhzdGVwKCBmb2dOZWFyLCBmb2dGYXIsIHZGb2dEZXB0aCApO1xuXHQjZW5kaWZcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IG1peCggZ2xfRnJhZ0NvbG9yLnJnYiwgZm9nQ29sb3IsIGZvZ0ZhY3RvciApO1xuI2VuZGlmIjsKCgl2YXIgZm9nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9GT0dcblx0dW5pZm9ybSB2ZWMzIGZvZ0NvbG9yO1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcblx0I2lmZGVmIEZPR19FWFAyXG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dEZW5zaXR5O1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gZmxvYXQgZm9nTmVhcjtcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ0Zhcjtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfR1JBRElFTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZ3JhZGllbnRNYXA7XG4jZW5kaWZcbnZlYzMgZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCB2ZWMzIG5vcm1hbCwgdmVjMyBsaWdodERpcmVjdGlvbiApIHtcblx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgbGlnaHREaXJlY3Rpb24gKTtcblx0dmVjMiBjb29yZCA9IHZlYzIoIGRvdE5MICogMC41ICsgMC41LCAwLjAgKTtcblx0I2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuXHRcdHJldHVybiB2ZWMzKCB0ZXh0dXJlMkQoIGdyYWRpZW50TWFwLCBjb29yZCApLnIgKTtcblx0I2Vsc2Vcblx0XHR2ZWMyIGZ3ID0gZndpZHRoKCBjb29yZCApICogMC41O1xuXHRcdHJldHVybiBtaXgoIHZlYzMoIDAuNyApLCB2ZWMzKCAxLjAgKSwgc21vb3Roc3RlcCggMC43IC0gZncueCwgMC43ICsgZncueCwgY29vcmQueCApICk7XG5cdCNlbmRpZlxufSI7CgoJdmFyIGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBsaWdodE1hcDtcblx0dW5pZm9ybSBmbG9hdCBsaWdodE1hcEludGVuc2l0eTtcbiNlbmRpZiI7CgoJdmFyIGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50ID0gIkxhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwoKCXZhciBsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50ID0gInZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuc3RydWN0IExhbWJlcnRNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xufTtcbnZvaWQgUkVfRGlyZWN0X0xhbWJlcnQoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfTGFtYmVydFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX0xhbWJlcnQiOwoKCXZhciBsaWdodHNfcGFyc19iZWdpbiA9ICJ1bmlmb3JtIGJvb2wgcmVjZWl2ZVNoYWRvdztcbnVuaWZvcm0gdmVjMyBhbWJpZW50TGlnaHRDb2xvcjtcbiNpZiBkZWZpbmVkKCBVU0VfTElHSFRfUFJPQkVTIClcblx0dW5pZm9ybSB2ZWMzIGxpZ2h0UHJvYmVbIDkgXTtcbiNlbmRpZlxudmVjMyBzaEdldElycmFkaWFuY2VBdCggaW4gdmVjMyBub3JtYWwsIGluIHZlYzMgc2hDb2VmZmljaWVudHNbIDkgXSApIHtcblx0ZmxvYXQgeCA9IG5vcm1hbC54LCB5ID0gbm9ybWFsLnksIHogPSBub3JtYWwuejtcblx0dmVjMyByZXN1bHQgPSBzaENvZWZmaWNpZW50c1sgMCBdICogMC44ODYyMjc7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMSBdICogMi4wICogMC41MTE2NjQgKiB5O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDIgXSAqIDIuMCAqIDAuNTExNjY0ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyAzIF0gKiAyLjAgKiAwLjUxMTY2NCAqIHg7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNCBdICogMi4wICogMC40MjkwNDMgKiB4ICogeTtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA1IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHkgKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDYgXSAqICggMC43NDMxMjUgKiB6ICogeiAtIDAuMjQ3NzA4ICk7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNyBdICogMi4wICogMC40MjkwNDMgKiB4ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA4IF0gKiAwLjQyOTA0MyAqICggeCAqIHggLSB5ICogeSApO1xuXHRyZXR1cm4gcmVzdWx0O1xufVxudmVjMyBnZXRMaWdodFByb2JlSXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBsaWdodFByb2JlWyA5IF0sIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IHNoR2V0SXJyYWRpYW5jZUF0KCB3b3JsZE5vcm1hbCwgbGlnaHRQcm9iZSApO1xuXHRyZXR1cm4gaXJyYWRpYW5jZTtcbn1cbnZlYzMgZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBhbWJpZW50TGlnaHRDb2xvciApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gYW1iaWVudExpZ2h0Q29sb3I7XG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxuZmxvYXQgZ2V0RGlzdGFuY2VBdHRlbnVhdGlvbiggY29uc3QgaW4gZmxvYXQgbGlnaHREaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgY3V0b2ZmRGlzdGFuY2UsIGNvbnN0IGluIGZsb2F0IGRlY2F5RXhwb25lbnQgKSB7XG5cdGZsb2F0IGRpc3RhbmNlRmFsbG9mZiA9IDEuMCAvIG1heCggcG93KCBsaWdodERpc3RhbmNlLCBkZWNheUV4cG9uZW50ICksIDAuMDEgKTtcblx0aWYgKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCApIHtcblx0XHRkaXN0YW5jZUZhbGxvZmYgKj0gcG93Miggc2F0dXJhdGUoIDEuMCAtIHBvdzQoIGxpZ2h0RGlzdGFuY2UgLyBjdXRvZmZEaXN0YW5jZSApICkgKTtcblx0fVxuXHRyZXR1cm4gZGlzdGFuY2VGYWxsb2ZmO1xufVxuZmxvYXQgZ2V0U3BvdEF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCBjb25lQ29zaW5lLCBjb25zdCBpbiBmbG9hdCBwZW51bWJyYUNvc2luZSwgY29uc3QgaW4gZmxvYXQgYW5nbGVDb3NpbmUgKSB7XG5cdHJldHVybiBzbW9vdGhzdGVwKCBjb25lQ29zaW5lLCBwZW51bWJyYUNvc2luZSwgYW5nbGVDb3NpbmUgKTtcbn1cbiNpZiBOVU1fRElSX0xJR0hUUyA+IDBcblx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdH07XG5cdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0c1sgTlVNX0RJUl9MSUdIVFMgXTtcblx0dm9pZCBnZXREaXJlY3Rpb25hbExpZ2h0SW5mbyggY29uc3QgaW4gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0LCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHRsaWdodC5jb2xvciA9IGRpcmVjdGlvbmFsTGlnaHQuY29sb3I7XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gZGlyZWN0aW9uYWxMaWdodC5kaXJlY3Rpb247XG5cdFx0bGlnaHQudmlzaWJsZSA9IHRydWU7XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG5cdHN0cnVjdCBQb2ludExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdH07XG5cdHVuaWZvcm0gUG9pbnRMaWdodCBwb2ludExpZ2h0c1sgTlVNX1BPSU5UX0xJR0hUUyBdO1xuXHR2b2lkIGdldFBvaW50TGlnaHRJbmZvKCBjb25zdCBpbiBQb2ludExpZ2h0IHBvaW50TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgb3V0IEluY2lkZW50TGlnaHQgbGlnaHQgKSB7XG5cdFx0dmVjMyBsVmVjdG9yID0gcG9pbnRMaWdodC5wb3NpdGlvbiAtIGdlb21ldHJ5UG9zaXRpb247XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gbm9ybWFsaXplKCBsVmVjdG9yICk7XG5cdFx0ZmxvYXQgbGlnaHREaXN0YW5jZSA9IGxlbmd0aCggbFZlY3RvciApO1xuXHRcdGxpZ2h0LmNvbG9yID0gcG9pbnRMaWdodC5jb2xvcjtcblx0XHRsaWdodC5jb2xvciAqPSBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBsaWdodERpc3RhbmNlLCBwb2ludExpZ2h0LmRpc3RhbmNlLCBwb2ludExpZ2h0LmRlY2F5ICk7XG5cdFx0bGlnaHQudmlzaWJsZSA9ICggbGlnaHQuY29sb3IgIT0gdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRTID4gMFxuXHRzdHJ1Y3QgU3BvdExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdFx0ZmxvYXQgY29uZUNvcztcblx0XHRmbG9hdCBwZW51bWJyYUNvcztcblx0fTtcblx0dW5pZm9ybSBTcG90TGlnaHQgc3BvdExpZ2h0c1sgTlVNX1NQT1RfTElHSFRTIF07XG5cdHZvaWQgZ2V0U3BvdExpZ2h0SW5mbyggY29uc3QgaW4gU3BvdExpZ2h0IHNwb3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHR2ZWMzIGxWZWN0b3IgPSBzcG90TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdGxpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuXHRcdGZsb2F0IGFuZ2xlQ29zID0gZG90KCBsaWdodC5kaXJlY3Rpb24sIHNwb3RMaWdodC5kaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBzcG90QXR0ZW51YXRpb24gPSBnZXRTcG90QXR0ZW51YXRpb24oIHNwb3RMaWdodC5jb25lQ29zLCBzcG90TGlnaHQucGVudW1icmFDb3MsIGFuZ2xlQ29zICk7XG5cdFx0aWYgKCBzcG90QXR0ZW51YXRpb24gPiAwLjAgKSB7XG5cdFx0XHRmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG5cdFx0XHRsaWdodC5jb2xvciA9IHNwb3RMaWdodC5jb2xvciAqIHNwb3RBdHRlbnVhdGlvbjtcblx0XHRcdGxpZ2h0LmNvbG9yICo9IGdldERpc3RhbmNlQXR0ZW51YXRpb24oIGxpZ2h0RGlzdGFuY2UsIHNwb3RMaWdodC5kaXN0YW5jZSwgc3BvdExpZ2h0LmRlY2F5ICk7XG5cdFx0XHRsaWdodC52aXNpYmxlID0gKCBsaWdodC5jb2xvciAhPSB2ZWMzKCAwLjAgKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsaWdodC5jb2xvciA9IHZlYzMoIDAuMCApO1xuXHRcdFx0bGlnaHQudmlzaWJsZSA9IGZhbHNlO1xuXHRcdH1cblx0fVxuI2VuZGlmXG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBSZWN0QXJlYUxpZ2h0IHtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0O1xuXHR9O1xuXHR1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMTtcdHVuaWZvcm0gc2FtcGxlcjJEIGx0Y18yO1xuXHR1bmlmb3JtIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodHNbIE5VTV9SRUNUX0FSRUFfTElHSFRTIF07XG4jZW5kaWZcbiNpZiBOVU1fSEVNSV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBIZW1pc3BoZXJlTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgc2t5Q29sb3I7XG5cdFx0dmVjMyBncm91bmRDb2xvcjtcblx0fTtcblx0dW5pZm9ybSBIZW1pc3BoZXJlTGlnaHQgaGVtaXNwaGVyZUxpZ2h0c1sgTlVNX0hFTUlfTElHSFRTIF07XG5cdHZlYzMgZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gSGVtaXNwaGVyZUxpZ2h0IGhlbWlMaWdodCwgY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdFx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgaGVtaUxpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGhlbWlEaWZmdXNlV2VpZ2h0ID0gMC41ICogZG90TkwgKyAwLjU7XG5cdFx0dmVjMyBpcnJhZGlhbmNlID0gbWl4KCBoZW1pTGlnaHQuZ3JvdW5kQ29sb3IsIGhlbWlMaWdodC5za3lDb2xvciwgaGVtaURpZmZ1c2VXZWlnaHQgKTtcblx0XHRyZXR1cm4gaXJyYWRpYW5jZTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0dmVjMyBnZXRJQkxJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiB3b3JsZE5vcm1hbCwgMS4wICk7XG5cdFx0XHRyZXR1cm4gUEkgKiBlbnZNYXBDb2xvci5yZ2IgKiBlbnZNYXBJbnRlbnNpdHk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHQjZW5kaWZcblx0fVxuXHR2ZWMzIGdldElCTFJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZmxlY3QoIC0gdmlld0Rpciwgbm9ybWFsICk7XG5cdFx0XHRyZWZsZWN0VmVjID0gbm9ybWFsaXplKCBtaXgoIHJlZmxlY3RWZWMsIG5vcm1hbCwgcm91Z2huZXNzICogcm91Z2huZXNzKSApO1xuXHRcdFx0cmVmbGVjdFZlYyA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHJlZmxlY3RWZWMsIHZpZXdNYXRyaXggKTtcblx0XHRcdHZlYzQgZW52TWFwQ29sb3IgPSB0ZXh0dXJlQ3ViZVVWKCBlbnZNYXAsIGVudk1hcFJvdGF0aW9uICogcmVmbGVjdFZlYywgcm91Z2huZXNzICk7XG5cdFx0XHRyZXR1cm4gZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdmVjMyggMC4wICk7XG5cdFx0I2VuZGlmXG5cdH1cblx0I2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdFx0dmVjMyBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgY29uc3QgaW4gdmVjMyBiaXRhbmdlbnQsIGNvbnN0IGluIGZsb2F0IGFuaXNvdHJvcHkgKSB7XG5cdFx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0XHR2ZWMzIGJlbnROb3JtYWwgPSBjcm9zcyggYml0YW5nZW50LCB2aWV3RGlyICk7XG5cdFx0XHRcdGJlbnROb3JtYWwgPSBub3JtYWxpemUoIGNyb3NzKCBiZW50Tm9ybWFsLCBiaXRhbmdlbnQgKSApO1xuXHRcdFx0XHRiZW50Tm9ybWFsID0gbm9ybWFsaXplKCBtaXgoIGJlbnROb3JtYWwsIG5vcm1hbCwgcG93MiggcG93MiggMS4wIC0gYW5pc290cm9weSAqICggMS4wIC0gcm91Z2huZXNzICkgKSApICkgKTtcblx0XHRcdFx0cmV0dXJuIGdldElCTFJhZGlhbmNlKCB2aWV3RGlyLCBiZW50Tm9ybWFsLCByb3VnaG5lc3MgKTtcblx0XHRcdCNlbHNlXG5cdFx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHRcdCNlbmRpZlxuXHRcdH1cblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBsaWdodHNfdG9vbl9mcmFnbWVudCA9ICJUb29uTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiOyI7CgoJdmFyIGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5zdHJ1Y3QgVG9vbk1hdGVyaWFsIHtcblx0dmVjMyBkaWZmdXNlQ29sb3I7XG59O1xudm9pZCBSRV9EaXJlY3RfVG9vbiggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX1Rvb24oIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9Ub29uXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiI7CgoJdmFyIGxpZ2h0c19waG9uZ19mcmFnbWVudCA9ICJCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiO1xubWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IHNwZWN1bGFyO1xubWF0ZXJpYWwuc3BlY3VsYXJTaGluaW5lc3MgPSBzaGluaW5lc3M7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwoKCXZhciBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBCbGlublBob25nTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0dmVjMyBzcGVjdWxhckNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclNoaW5pbmVzcztcblx0ZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbn07XG52b2lkIFJFX0RpcmVjdF9CbGlublBob25nKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogQlJERl9CbGlublBob25nKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzICkgKiBtYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZyggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X0JsaW5uUGhvbmdcbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9CbGlublBob25nIjsKCgl2YXIgbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50ID0gIlBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiICogKCAxLjAgLSBtZXRhbG5lc3NGYWN0b3IgKTtcbnZlYzMgZHh5ID0gbWF4KCBhYnMoIGRGZHgoIG5vblBlcnR1cmJlZE5vcm1hbCApICksIGFicyggZEZkeSggbm9uUGVydHVyYmVkTm9ybWFsICkgKSApO1xuZmxvYXQgZ2VvbWV0cnlSb3VnaG5lc3MgPSBtYXgoIG1heCggZHh5LngsIGR4eS55ICksIGR4eS56ICk7XG5tYXRlcmlhbC5yb3VnaG5lc3MgPSBtYXgoIHJvdWdobmVzc0ZhY3RvciwgMC4wNTI1ICk7bWF0ZXJpYWwucm91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xubWF0ZXJpYWwucm91Z2huZXNzID0gbWluKCBtYXRlcmlhbC5yb3VnaG5lc3MsIDEuMCApO1xuI2lmZGVmIElPUlxuXHRtYXRlcmlhbC5pb3IgPSBpb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0XHRmbG9hdCBzcGVjdWxhckludGVuc2l0eUZhY3RvciA9IHNwZWN1bGFySW50ZW5zaXR5O1xuXHRcdHZlYzMgc3BlY3VsYXJDb2xvckZhY3RvciA9IHNwZWN1bGFyQ29sb3I7XG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdFx0c3BlY3VsYXJDb2xvckZhY3RvciAqPSB0ZXh0dXJlMkQoIHNwZWN1bGFyQ29sb3JNYXAsIHZTcGVjdWxhckNvbG9yTWFwVXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHRcdHNwZWN1bGFySW50ZW5zaXR5RmFjdG9yICo9IHRleHR1cmUyRCggc3BlY3VsYXJJbnRlbnNpdHlNYXAsIHZTcGVjdWxhckludGVuc2l0eU1hcFV2ICkuYTtcblx0XHQjZW5kaWZcblx0XHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IG1peCggc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIDEuMCwgbWV0YWxuZXNzRmFjdG9yICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IgPSAxLjA7XG5cdFx0dmVjMyBzcGVjdWxhckNvbG9yRmFjdG9yID0gdmVjMyggMS4wICk7XG5cdFx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCBtaW4oIHBvdzIoICggbWF0ZXJpYWwuaW9yIC0gMS4wICkgLyAoIG1hdGVyaWFsLmlvciArIDEuMCApICkgKiBzcGVjdWxhckNvbG9yRmFjdG9yLCB2ZWMzKCAxLjAgKSApICogc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuI2Vsc2Vcblx0bWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IG1peCggdmVjMyggMC4wNCApLCBkaWZmdXNlQ29sb3IucmdiLCBtZXRhbG5lc3NGYWN0b3IgKTtcblx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IGNsZWFyY29hdDtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gY2xlYXJjb2F0Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRGMCA9IHZlYzMoIDAuMDQgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0RjkwID0gMS4wO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdCAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE1hcCwgdkNsZWFyY29hdE1hcFV2ICkueDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdFJvdWdobmVzc01hcCwgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2ICkueTtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IHNhdHVyYXRlKCBtYXRlcmlhbC5jbGVhcmNvYXQgKTtcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IG1heCggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCAwLjA1MjUgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRElTUEVSU0lPTlxuXHRtYXRlcmlhbC5kaXNwZXJzaW9uID0gZGlzcGVyc2lvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IGlyaWRlc2NlbmNlO1xuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUiA9IGlyaWRlc2NlbmNlSU9SO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgKj0gdGV4dHVyZTJEKCBpcmlkZXNjZW5jZU1hcCwgdklyaWRlc2NlbmNlTWFwVXYgKS5yO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcyA9IChpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0gLSBpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0pICogdGV4dHVyZTJEKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcCwgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgKS5nICsgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHQjZWxzZVxuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID0gaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHRtYXRlcmlhbC5zaGVlbkNvbG9yID0gc2hlZW5Db2xvcjtcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdG1hdGVyaWFsLnNoZWVuQ29sb3IgKj0gdGV4dHVyZTJEKCBzaGVlbkNvbG9yTWFwLCB2U2hlZW5Db2xvck1hcFV2ICkucmdiO1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgPSBjbGFtcCggc2hlZW5Sb3VnaG5lc3MsIDAuMDcsIDEuMCApO1xuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzICo9IHRleHR1cmUyRCggc2hlZW5Sb3VnaG5lc3NNYXAsIHZTaGVlblJvdWdobmVzc01hcFV2ICkuYTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHRtYXQyIGFuaXNvdHJvcHlNYXQgPSBtYXQyKCBhbmlzb3Ryb3B5VmVjdG9yLngsIGFuaXNvdHJvcHlWZWN0b3IueSwgLSBhbmlzb3Ryb3B5VmVjdG9yLnksIGFuaXNvdHJvcHlWZWN0b3IueCApO1xuXHRcdHZlYzMgYW5pc290cm9weVBvbGFyID0gdGV4dHVyZTJEKCBhbmlzb3Ryb3B5TWFwLCB2QW5pc290cm9weU1hcFV2ICkucmdiO1xuXHRcdHZlYzIgYW5pc290cm9weVYgPSBhbmlzb3Ryb3B5TWF0ICogbm9ybWFsaXplKCAyLjAgKiBhbmlzb3Ryb3B5UG9sYXIucmcgLSB2ZWMyKCAxLjAgKSApICogYW5pc290cm9weVBvbGFyLmI7XG5cdCNlbHNlXG5cdFx0dmVjMiBhbmlzb3Ryb3B5ViA9IGFuaXNvdHJvcHlWZWN0b3I7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5hbmlzb3Ryb3B5ID0gbGVuZ3RoKCBhbmlzb3Ryb3B5ViApO1xuXHRpZiggbWF0ZXJpYWwuYW5pc290cm9weSA9PSAwLjAgKSB7XG5cdFx0YW5pc290cm9weVYgPSB2ZWMyKCAxLjAsIDAuMCApO1xuXHR9IGVsc2Uge1xuXHRcdGFuaXNvdHJvcHlWIC89IG1hdGVyaWFsLmFuaXNvdHJvcHk7XG5cdFx0bWF0ZXJpYWwuYW5pc290cm9weSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICk7XG5cdH1cblx0bWF0ZXJpYWwuYWxwaGFUID0gbWl4KCBwb3cyKCBtYXRlcmlhbC5yb3VnaG5lc3MgKSwgMS4wLCBwb3cyKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICkgKTtcblx0bWF0ZXJpYWwuYW5pc290cm9weVQgPSB0Ym5bIDAgXSAqIGFuaXNvdHJvcHlWLnggKyB0Ym5bIDEgXSAqIGFuaXNvdHJvcHlWLnk7XG5cdG1hdGVyaWFsLmFuaXNvdHJvcHlCID0gdGJuWyAxIF0gKiBhbmlzb3Ryb3B5Vi54IC0gdGJuWyAwIF0gKiBhbmlzb3Ryb3B5Vi55O1xuI2VuZGlmIjsKCgl2YXIgbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAic3RydWN0IFBoeXNpY2FsTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0ZmxvYXQgcm91Z2huZXNzO1xuXHR2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdGZsb2F0IHNwZWN1bGFyRjkwO1xuXHRmbG9hdCBkaXNwZXJzaW9uO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGZsb2F0IGNsZWFyY29hdDtcblx0XHRmbG9hdCBjbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0dmVjMyBjbGVhcmNvYXRGMDtcblx0XHRmbG9hdCBjbGVhcmNvYXRGOTA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2U7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3M7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUZyZXNuZWw7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUYwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHZlYzMgc2hlZW5Db2xvcjtcblx0XHRmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2VuZGlmXG5cdCNpZmRlZiBJT1Jcblx0XHRmbG9hdCBpb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRcdGZsb2F0IHRyYW5zbWlzc2lvbjtcblx0XHRmbG9hdCB0cmFuc21pc3Npb25BbHBoYTtcblx0XHRmbG9hdCB0aGlja25lc3M7XG5cdFx0ZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHR2ZWMzIGF0dGVudWF0aW9uQ29sb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRmbG9hdCBhbmlzb3Ryb3B5O1xuXHRcdGZsb2F0IGFscGhhVDtcblx0XHR2ZWMzIGFuaXNvdHJvcHlUO1xuXHRcdHZlYzMgYW5pc290cm9weUI7XG5cdCNlbmRpZlxufTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXJEaXJlY3QgPSB2ZWMzKCAwLjAgKTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCA9IHZlYzMoIDAuMCApO1xudmVjMyBzaGVlblNwZWN1bGFyRGlyZWN0ID0gdmVjMyggMC4wICk7XG52ZWMzIHNoZWVuU3BlY3VsYXJJbmRpcmVjdCA9IHZlYzMoMC4wICk7XG52ZWMzIFNjaGxpY2tfdG9fRjAoIGNvbnN0IGluIHZlYzMgZiwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcbiAgICBmbG9hdCB4ID0gY2xhbXAoIDEuMCAtIGRvdFZILCAwLjAsIDEuMCApO1xuICAgIGZsb2F0IHgyID0geCAqIHg7XG4gICAgZmxvYXQgeDUgPSBjbGFtcCggeCAqIHgyICogeDIsIDAuMCwgMC45OTk5ICk7XG4gICAgcmV0dXJuICggZiAtIHZlYzMoIGY5MCApICogeDUgKSAvICggMS4wIC0geDUgKTtcbn1cbmZsb2F0IFZfR0dYX1NtaXRoQ29ycmVsYXRlZCggY29uc3QgaW4gZmxvYXQgYWxwaGEsIGNvbnN0IGluIGZsb2F0IGRvdE5MLCBjb25zdCBpbiBmbG9hdCBkb3ROViApIHtcblx0ZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuXHRmbG9hdCBndiA9IGRvdE5MICogc3FydCggYTIgKyAoIDEuMCAtIGEyICkgKiBwb3cyKCBkb3ROViApICk7XG5cdGZsb2F0IGdsID0gZG90TlYgKiBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5MICkgKTtcblx0cmV0dXJuIDAuNSAvIG1heCggZ3YgKyBnbCwgRVBTSUxPTiApO1xufVxuZmxvYXQgRF9HR1goIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROSCApIHtcblx0ZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuXHRmbG9hdCBkZW5vbSA9IHBvdzIoIGRvdE5IICkgKiAoIGEyIC0gMS4wICkgKyAxLjA7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogYTIgLyBwb3cyKCBkZW5vbSApO1xufVxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdGZsb2F0IFZfR0dYX1NtaXRoQ29ycmVsYXRlZF9Bbmlzb3Ryb3BpYyggY29uc3QgaW4gZmxvYXQgYWxwaGFULCBjb25zdCBpbiBmbG9hdCBhbHBoYUIsIGNvbnN0IGluIGZsb2F0IGRvdFRWLCBjb25zdCBpbiBmbG9hdCBkb3RCViwgY29uc3QgaW4gZmxvYXQgZG90VEwsIGNvbnN0IGluIGZsb2F0IGRvdEJMLCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgZG90TkwgKSB7XG5cdFx0ZmxvYXQgZ3YgPSBkb3ROTCAqIGxlbmd0aCggdmVjMyggYWxwaGFUICogZG90VFYsIGFscGhhQiAqIGRvdEJWLCBkb3ROViApICk7XG5cdFx0ZmxvYXQgZ2wgPSBkb3ROViAqIGxlbmd0aCggdmVjMyggYWxwaGFUICogZG90VEwsIGFscGhhQiAqIGRvdEJMLCBkb3ROTCApICk7XG5cdFx0ZmxvYXQgdiA9IDAuNSAvICggZ3YgKyBnbCApO1xuXHRcdHJldHVybiBzYXR1cmF0ZSh2KTtcblx0fVxuXHRmbG9hdCBEX0dHWF9Bbmlzb3Ryb3BpYyggY29uc3QgaW4gZmxvYXQgYWxwaGFULCBjb25zdCBpbiBmbG9hdCBhbHBoYUIsIGNvbnN0IGluIGZsb2F0IGRvdE5ILCBjb25zdCBpbiBmbG9hdCBkb3RUSCwgY29uc3QgaW4gZmxvYXQgZG90QkggKSB7XG5cdFx0ZmxvYXQgYTIgPSBhbHBoYVQgKiBhbHBoYUI7XG5cdFx0aGlnaHAgdmVjMyB2ID0gdmVjMyggYWxwaGFCICogZG90VEgsIGFscGhhVCAqIGRvdEJILCBhMiAqIGRvdE5IICk7XG5cdFx0aGlnaHAgZmxvYXQgdjIgPSBkb3QoIHYsIHYgKTtcblx0XHRmbG9hdCB3MiA9IGEyIC8gdjI7XG5cdFx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBhMiAqIHBvdzIgKCB3MiApO1xuXHR9XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHZlYzMgQlJERl9HR1hfQ2xlYXJjb2F0KCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsKSB7XG5cdFx0dmVjMyBmMCA9IG1hdGVyaWFsLmNsZWFyY29hdEYwO1xuXHRcdGZsb2F0IGY5MCA9IG1hdGVyaWFsLmNsZWFyY29hdEY5MDtcblx0XHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0XHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRcdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdFx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRcdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0XHRmbG9hdCBkb3RWSCA9IHNhdHVyYXRlKCBkb3QoIHZpZXdEaXIsIGhhbGZEaXIgKSApO1xuXHRcdHZlYzMgRiA9IEZfU2NobGljayggZjAsIGY5MCwgZG90VkggKTtcblx0XHRmbG9hdCBWID0gVl9HR1hfU21pdGhDb3JyZWxhdGVkKCBhbHBoYSwgZG90TkwsIGRvdE5WICk7XG5cdFx0ZmxvYXQgRCA9IERfR0dYKCBhbHBoYSwgZG90TkggKTtcblx0XHRyZXR1cm4gRiAqICggViAqIEQgKTtcblx0fVxuI2VuZGlmXG52ZWMzIEJSREZfR0dYKCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsICkge1xuXHR2ZWMzIGYwID0gbWF0ZXJpYWwuc3BlY3VsYXJDb2xvcjtcblx0ZmxvYXQgZjkwID0gbWF0ZXJpYWwuc3BlY3VsYXJGOTA7XG5cdGZsb2F0IHJvdWdobmVzcyA9IG1hdGVyaWFsLnJvdWdobmVzcztcblx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBsaWdodERpciArIHZpZXdEaXIgKTtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggZjAsIGY5MCwgZG90VkggKTtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRcdEYgPSBtaXgoIEYsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdGZsb2F0IGRvdFRMID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgbGlnaHREaXIgKTtcblx0XHRmbG9hdCBkb3RUViA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIHZpZXdEaXIgKTtcblx0XHRmbG9hdCBkb3RUSCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIGhhbGZEaXIgKTtcblx0XHRmbG9hdCBkb3RCTCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIGxpZ2h0RGlyICk7XG5cdFx0ZmxvYXQgZG90QlYgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCB2aWV3RGlyICk7XG5cdFx0ZmxvYXQgZG90QkggPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCBoYWxmRGlyICk7XG5cdFx0ZmxvYXQgViA9IFZfR0dYX1NtaXRoQ29ycmVsYXRlZF9Bbmlzb3Ryb3BpYyggbWF0ZXJpYWwuYWxwaGFULCBhbHBoYSwgZG90VFYsIGRvdEJWLCBkb3RUTCwgZG90QkwsIGRvdE5WLCBkb3ROTCApO1xuXHRcdGZsb2F0IEQgPSBEX0dHWF9Bbmlzb3Ryb3BpYyggbWF0ZXJpYWwuYWxwaGFULCBhbHBoYSwgZG90TkgsIGRvdFRILCBkb3RCSCApO1xuXHQjZWxzZVxuXHRcdGZsb2F0IFYgPSBWX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGFscGhhLCBkb3ROTCwgZG90TlYgKTtcblx0XHRmbG9hdCBEID0gRF9HR1goIGFscGhhLCBkb3ROSCApO1xuXHQjZW5kaWZcblx0cmV0dXJuIEYgKiAoIFYgKiBEICk7XG59XG52ZWMyIExUQ19VdiggY29uc3QgaW4gdmVjMyBOLCBjb25zdCBpbiB2ZWMzIFYsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0Y29uc3QgZmxvYXQgTFVUX1NJWkUgPSA2NC4wO1xuXHRjb25zdCBmbG9hdCBMVVRfU0NBTEUgPSAoIExVVF9TSVpFIC0gMS4wICkgLyBMVVRfU0laRTtcblx0Y29uc3QgZmxvYXQgTFVUX0JJQVMgPSAwLjUgLyBMVVRfU0laRTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBOLCBWICkgKTtcblx0dmVjMiB1diA9IHZlYzIoIHJvdWdobmVzcywgc3FydCggMS4wIC0gZG90TlYgKSApO1xuXHR1diA9IHV2ICogTFVUX1NDQUxFICsgTFVUX0JJQVM7XG5cdHJldHVybiB1djtcbn1cbmZsb2F0IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggY29uc3QgaW4gdmVjMyBmICkge1xuXHRmbG9hdCBsID0gbGVuZ3RoKCBmICk7XG5cdHJldHVybiBtYXgoICggbCAqIGwgKyBmLnogKSAvICggbCArIDEuMCApLCAwLjAgKTtcbn1cbnZlYzMgTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb25zdCBpbiB2ZWMzIHYxLCBjb25zdCBpbiB2ZWMzIHYyICkge1xuXHRmbG9hdCB4ID0gZG90KCB2MSwgdjIgKTtcblx0ZmxvYXQgeSA9IGFicyggeCApO1xuXHRmbG9hdCBhID0gMC44NTQzOTg1ICsgKCAwLjQ5NjUxNTUgKyAwLjAxNDUyMDYgKiB5ICkgKiB5O1xuXHRmbG9hdCBiID0gMy40MTc1OTQwICsgKCA0LjE2MTY3MjQgKyB5ICkgKiB5O1xuXHRmbG9hdCB2ID0gYSAvIGI7XG5cdGZsb2F0IHRoZXRhX3NpbnRoZXRhID0gKCB4ID4gMC4wICkgPyB2IDogMC41ICogaW52ZXJzZXNxcnQoIG1heCggMS4wIC0geCAqIHgsIDFlLTcgKSApIC0gdjtcblx0cmV0dXJuIGNyb3NzKCB2MSwgdjIgKSAqIHRoZXRhX3NpbnRoZXRhO1xufVxudmVjMyBMVENfRXZhbHVhdGUoIGNvbnN0IGluIHZlYzMgTiwgY29uc3QgaW4gdmVjMyBWLCBjb25zdCBpbiB2ZWMzIFAsIGNvbnN0IGluIG1hdDMgbUludiwgY29uc3QgaW4gdmVjMyByZWN0Q29vcmRzWyA0IF0gKSB7XG5cdHZlYzMgdjEgPSByZWN0Q29vcmRzWyAxIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgdjIgPSByZWN0Q29vcmRzWyAzIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgbGlnaHROb3JtYWwgPSBjcm9zcyggdjEsIHYyICk7XG5cdGlmKCBkb3QoIGxpZ2h0Tm9ybWFsLCBQIC0gcmVjdENvb3Jkc1sgMCBdICkgPCAwLjAgKSByZXR1cm4gdmVjMyggMC4wICk7XG5cdHZlYzMgVDEsIFQyO1xuXHRUMSA9IG5vcm1hbGl6ZSggViAtIE4gKiBkb3QoIFYsIE4gKSApO1xuXHRUMiA9IC0gY3Jvc3MoIE4sIFQxICk7XG5cdG1hdDMgbWF0ID0gbUludiAqIHRyYW5zcG9zZU1hdDMoIG1hdDMoIFQxLCBUMiwgTiApICk7XG5cdHZlYzMgY29vcmRzWyA0IF07XG5cdGNvb3Jkc1sgMCBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAwIF0gLSBQICk7XG5cdGNvb3Jkc1sgMSBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAxIF0gLSBQICk7XG5cdGNvb3Jkc1sgMiBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAyIF0gLSBQICk7XG5cdGNvb3Jkc1sgMyBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAzIF0gLSBQICk7XG5cdGNvb3Jkc1sgMCBdID0gbm9ybWFsaXplKCBjb29yZHNbIDAgXSApO1xuXHRjb29yZHNbIDEgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAxIF0gKTtcblx0Y29vcmRzWyAyIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMiBdICk7XG5cdGNvb3Jkc1sgMyBdID0gbm9ybWFsaXplKCBjb29yZHNbIDMgXSApO1xuXHR2ZWMzIHZlY3RvckZvcm1GYWN0b3IgPSB2ZWMzKCAwLjAgKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMCBdLCBjb29yZHNbIDEgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAxIF0sIGNvb3Jkc1sgMiBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDIgXSwgY29vcmRzWyAzIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMyBdLCBjb29yZHNbIDAgXSApO1xuXHRmbG9hdCByZXN1bHQgPSBMVENfQ2xpcHBlZFNwaGVyZUZvcm1GYWN0b3IoIHZlY3RvckZvcm1GYWN0b3IgKTtcblx0cmV0dXJuIHZlYzMoIHJlc3VsdCApO1xufVxuI2lmIGRlZmluZWQoIFVTRV9TSEVFTiApXG5mbG9hdCBEX0NoYXJsaWUoIGZsb2F0IHJvdWdobmVzcywgZmxvYXQgZG90TkggKSB7XG5cdGZsb2F0IGFscGhhID0gcG93Miggcm91Z2huZXNzICk7XG5cdGZsb2F0IGludkFscGhhID0gMS4wIC8gYWxwaGE7XG5cdGZsb2F0IGNvczJoID0gZG90TkggKiBkb3ROSDtcblx0ZmxvYXQgc2luMmggPSBtYXgoIDEuMCAtIGNvczJoLCAwLjAwNzgxMjUgKTtcblx0cmV0dXJuICggMi4wICsgaW52QWxwaGEgKSAqIHBvdyggc2luMmgsIGludkFscGhhICogMC41ICkgLyAoIDIuMCAqIFBJICk7XG59XG5mbG9hdCBWX05ldWJlbHQoIGZsb2F0IGRvdE5WLCBmbG9hdCBkb3ROTCApIHtcblx0cmV0dXJuIHNhdHVyYXRlKCAxLjAgLyAoIDQuMCAqICggZG90TkwgKyBkb3ROViAtIGRvdE5MICogZG90TlYgKSApICk7XG59XG52ZWMzIEJSREZfU2hlZW4oIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIHZlYzMgc2hlZW5Db2xvciwgY29uc3QgaW4gZmxvYXQgc2hlZW5Sb3VnaG5lc3MgKSB7XG5cdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRmbG9hdCBEID0gRF9DaGFybGllKCBzaGVlblJvdWdobmVzcywgZG90TkggKTtcblx0ZmxvYXQgViA9IFZfTmV1YmVsdCggZG90TlYsIGRvdE5MICk7XG5cdHJldHVybiBzaGVlbkNvbG9yICogKCBEICogViApO1xufVxuI2VuZGlmXG5mbG9hdCBJQkxTaGVlbkJSREYoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCByMiA9IHJvdWdobmVzcyAqIHJvdWdobmVzcztcblx0ZmxvYXQgYSA9IHJvdWdobmVzcyA8IDAuMjUgPyAtMzM5LjIgKiByMiArIDE2MS40ICogcm91Z2huZXNzIC0gMjUuOSA6IC04LjQ4ICogcjIgKyAxNC4zICogcm91Z2huZXNzIC0gOS45NTtcblx0ZmxvYXQgYiA9IHJvdWdobmVzcyA8IDAuMjUgPyA0NC4wICogcjIgLSAyMy43ICogcm91Z2huZXNzICsgMy4yNiA6IDEuOTcgKiByMiAtIDMuMjcgKiByb3VnaG5lc3MgKyAwLjcyO1xuXHRmbG9hdCBERyA9IGV4cCggYSAqIGRvdE5WICsgYiApICsgKCByb3VnaG5lc3MgPCAwLjI1ID8gMC4wIDogMC4xICogKCByb3VnaG5lc3MgLSAwLjI1ICkgKTtcblx0cmV0dXJuIHNhdHVyYXRlKCBERyAqIFJFQ0lQUk9DQUxfUEkgKTtcbn1cbnZlYzIgREZHQXBwcm94KCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0Y29uc3QgdmVjNCBjMCA9IHZlYzQoIC0gMSwgLSAwLjAyNzUsIC0gMC41NzIsIDAuMDIyICk7XG5cdGNvbnN0IHZlYzQgYzEgPSB2ZWM0KCAxLCAwLjA0MjUsIDEuMDQsIC0gMC4wNCApO1xuXHR2ZWM0IHIgPSByb3VnaG5lc3MgKiBjMCArIGMxO1xuXHRmbG9hdCBhMDA0ID0gbWluKCByLnggKiByLngsIGV4cDIoIC0gOS4yOCAqIGRvdE5WICkgKSAqIHIueCArIHIueTtcblx0dmVjMiBmYWIgPSB2ZWMyKCAtIDEuMDQsIDEuMDQgKSAqIGEwMDQgKyByLnp3O1xuXHRyZXR1cm4gZmFiO1xufVxudmVjMyBFbnZpcm9ubWVudEJSREYoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0dmVjMiBmYWIgPSBERkdBcHByb3goIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG5cdHJldHVybiBzcGVjdWxhckNvbG9yICogZmFiLnggKyBzcGVjdWxhckY5MCAqIGZhYi55O1xufVxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxudm9pZCBjb21wdXRlTXVsdGlzY2F0dGVyaW5nSXJpZGVzY2VuY2UoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IGlyaWRlc2NlbmNlLCBjb25zdCBpbiB2ZWMzIGlyaWRlc2NlbmNlRjAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgaW5vdXQgdmVjMyBzaW5nbGVTY2F0dGVyLCBpbm91dCB2ZWMzIG11bHRpU2NhdHRlciApIHtcbiNlbHNlXG52b2lkIGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmcoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgaW5vdXQgdmVjMyBzaW5nbGVTY2F0dGVyLCBpbm91dCB2ZWMzIG11bHRpU2NhdHRlciApIHtcbiNlbmRpZlxuXHR2ZWMyIGZhYiA9IERGR0FwcHJveCggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRcdHZlYzMgRnIgPSBtaXgoIHNwZWN1bGFyQ29sb3IsIGlyaWRlc2NlbmNlRjAsIGlyaWRlc2NlbmNlICk7XG5cdCNlbHNlXG5cdFx0dmVjMyBGciA9IHNwZWN1bGFyQ29sb3I7XG5cdCNlbmRpZlxuXHR2ZWMzIEZzc0VzcyA9IEZyICogZmFiLnggKyBzcGVjdWxhckY5MCAqIGZhYi55O1xuXHRmbG9hdCBFc3MgPSBmYWIueCArIGZhYi55O1xuXHRmbG9hdCBFbXMgPSAxLjAgLSBFc3M7XG5cdHZlYzMgRmF2ZyA9IEZyICsgKCAxLjAgLSBGciApICogMC4wNDc2MTk7XHR2ZWMzIEZtcyA9IEZzc0VzcyAqIEZhdmcgLyAoIDEuMCAtIEVtcyAqIEZhdmcgKTtcblx0c2luZ2xlU2NhdHRlciArPSBGc3NFc3M7XG5cdG11bHRpU2NhdHRlciArPSBGbXMgKiBFbXM7XG59XG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHZvaWQgUkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsKCBjb25zdCBpbiBSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRcdHZlYzMgbm9ybWFsID0gZ2VvbWV0cnlOb3JtYWw7XG5cdFx0dmVjMyB2aWV3RGlyID0gZ2VvbWV0cnlWaWV3RGlyO1xuXHRcdHZlYzMgcG9zaXRpb24gPSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdHZlYzMgbGlnaHRQb3MgPSByZWN0QXJlYUxpZ2h0LnBvc2l0aW9uO1xuXHRcdHZlYzMgaGFsZldpZHRoID0gcmVjdEFyZWFMaWdodC5oYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0ID0gcmVjdEFyZWFMaWdodC5oYWxmSGVpZ2h0O1xuXHRcdHZlYzMgbGlnaHRDb2xvciA9IHJlY3RBcmVhTGlnaHQuY29sb3I7XG5cdFx0ZmxvYXQgcm91Z2huZXNzID0gbWF0ZXJpYWwucm91Z2huZXNzO1xuXHRcdHZlYzMgcmVjdENvb3Jkc1sgNCBdO1xuXHRcdHJlY3RDb29yZHNbIDAgXSA9IGxpZ2h0UG9zICsgaGFsZldpZHRoIC0gaGFsZkhlaWdodDtcdFx0cmVjdENvb3Jkc1sgMSBdID0gbGlnaHRQb3MgLSBoYWxmV2lkdGggLSBoYWxmSGVpZ2h0O1xuXHRcdHJlY3RDb29yZHNbIDIgXSA9IGxpZ2h0UG9zIC0gaGFsZldpZHRoICsgaGFsZkhlaWdodDtcblx0XHRyZWN0Q29vcmRzWyAzIF0gPSBsaWdodFBvcyArIGhhbGZXaWR0aCArIGhhbGZIZWlnaHQ7XG5cdFx0dmVjMiB1diA9IExUQ19Vdiggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0XHR2ZWM0IHQxID0gdGV4dHVyZTJEKCBsdGNfMSwgdXYgKTtcblx0XHR2ZWM0IHQyID0gdGV4dHVyZTJEKCBsdGNfMiwgdXYgKTtcblx0XHRtYXQzIG1JbnYgPSBtYXQzKFxuXHRcdFx0dmVjMyggdDEueCwgMCwgdDEueSApLFxuXHRcdFx0dmVjMyggICAgMCwgMSwgICAgMCApLFxuXHRcdFx0dmVjMyggdDEueiwgMCwgdDEudyApXG5cdFx0KTtcblx0XHR2ZWMzIGZyZXNuZWwgPSAoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKiB0Mi54ICsgKCB2ZWMzKCAxLjAgKSAtIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKSAqIHQyLnkgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBsaWdodENvbG9yICogZnJlc25lbCAqIExUQ19FdmFsdWF0ZSggbm9ybWFsLCB2aWV3RGlyLCBwb3NpdGlvbiwgbUludiwgcmVjdENvb3JkcyApO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gbGlnaHRDb2xvciAqIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciAqIExUQ19FdmFsdWF0ZSggbm9ybWFsLCB2aWV3RGlyLCBwb3NpdGlvbiwgbWF0MyggMS4wICksIHJlY3RDb29yZHMgKTtcblx0fVxuI2VuZGlmXG52b2lkIFJFX0RpcmVjdF9QaHlzaWNhbCggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgZG90TkxjYyA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHRcdHZlYzMgY2NJcnJhZGlhbmNlID0gZG90TkxjYyAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRcdGNsZWFyY29hdFNwZWN1bGFyRGlyZWN0ICs9IGNjSXJyYWRpYW5jZSAqIEJSREZfR0dYX0NsZWFyY29hdCggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHNoZWVuU3BlY3VsYXJEaXJlY3QgKz0gaXJyYWRpYW5jZSAqIEJSREZfU2hlZW4oIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwuc2hlZW5Db2xvciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGlycmFkaWFuY2UgKiBCUkRGX0dHWCggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbCApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfUGh5c2ljYWwoIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbCggY29uc3QgaW4gdmVjMyByYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGNsZWFyY29hdFJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCkge1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKz0gY2xlYXJjb2F0UmFkaWFuY2UgKiBFbnZpcm9ubWVudEJSREYoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLmNsZWFyY29hdEYwLCBtYXRlcmlhbC5jbGVhcmNvYXRGOTAsIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHNoZWVuU3BlY3VsYXJJbmRpcmVjdCArPSBpcnJhZGlhbmNlICogbWF0ZXJpYWwuc2hlZW5Db2xvciAqIElCTFNoZWVuQlJERiggZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHZlYzMgc2luZ2xlU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIG11bHRpU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZSA9IGlycmFkaWFuY2UgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0Y29tcHV0ZU11bHRpc2NhdHRlcmluZ0lyaWRlc2NlbmNlKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2Vsc2Vcblx0XHRjb21wdXRlTXVsdGlzY2F0dGVyaW5nKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2VuZGlmXG5cdHZlYzMgdG90YWxTY2F0dGVyaW5nID0gc2luZ2xlU2NhdHRlcmluZyArIG11bHRpU2NhdHRlcmluZztcblx0dmVjMyBkaWZmdXNlID0gbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogKCAxLjAgLSBtYXgoIG1heCggdG90YWxTY2F0dGVyaW5nLnIsIHRvdGFsU2NhdHRlcmluZy5nICksIHRvdGFsU2NhdHRlcmluZy5iICkgKTtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSByYWRpYW5jZSAqIHNpbmdsZVNjYXR0ZXJpbmc7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gbXVsdGlTY2F0dGVyaW5nICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gZGlmZnVzZSAqIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfUGh5c2ljYWxcbiNkZWZpbmUgUkVfRGlyZWN0X1JlY3RBcmVhXHRcdFJFX0RpcmVjdF9SZWN0QXJlYV9QaHlzaWNhbFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0U3BlY3VsYXJcdFx0UkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbFxuZmxvYXQgY29tcHV0ZVNwZWN1bGFyT2NjbHVzaW9uKCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgYW1iaWVudE9jY2x1c2lvbiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHBvdyggZG90TlYgKyBhbWJpZW50T2NjbHVzaW9uLCBleHAyKCAtIDE2LjAgKiByb3VnaG5lc3MgLSAxLjAgKSApIC0gMS4wICsgYW1iaWVudE9jY2x1c2lvbiApO1xufSI7CgoJdmFyIGxpZ2h0c19mcmFnbWVudF9iZWdpbiA9ICJcbnZlYzMgZ2VvbWV0cnlQb3NpdGlvbiA9IC0gdlZpZXdQb3NpdGlvbjtcbnZlYzMgZ2VvbWV0cnlOb3JtYWwgPSBub3JtYWw7XG52ZWMzIGdlb21ldHJ5Vmlld0RpciA9ICggaXNPcnRob2dyYXBoaWMgKSA/IHZlYzMoIDAsIDAsIDEgKSA6IG5vcm1hbGl6ZSggdlZpZXdQb3NpdGlvbiApO1xudmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCA9IHZlYzMoIDAuMCApO1xuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0Z2VvbWV0cnlDbGVhcmNvYXROb3JtYWwgPSBjbGVhcmNvYXROb3JtYWw7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0ZmxvYXQgZG90TlZpID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID09IDAuMCApIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IDAuMDtcblx0fSBlbHNlIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSApO1xuXHR9XG5cdGlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPiAwLjAgKSB7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsID0gZXZhbElyaWRlc2NlbmNlKCAxLjAsIG1hdGVyaWFsLmlyaWRlc2NlbmNlSU9SLCBkb3ROVmksIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICk7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGMCA9IFNjaGxpY2tfdG9fRjAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgMS4wLCBkb3ROVmkgKTtcblx0fVxuI2VuZGlmXG5JbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0O1xuI2lmICggTlVNX1BPSU5UX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3QgKVxuXHRQb2ludExpZ2h0IHBvaW50TGlnaHQ7XG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUUzsgaSArKyApIHtcblx0XHRwb2ludExpZ2h0ID0gcG9pbnRMaWdodHNbIGkgXTtcblx0XHRnZXRQb2ludExpZ2h0SW5mbyggcG9pbnRMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIClcblx0XHRwb2ludExpZ2h0U2hhZG93ID0gcG9pbnRMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSAoIGRpcmVjdExpZ2h0LnZpc2libGUgJiYgcmVjZWl2ZVNoYWRvdyApID8gZ2V0UG9pbnRTaGFkb3coIHBvaW50U2hhZG93TWFwWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dJbnRlbnNpdHksIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93QmlhcywgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93Q2FtZXJhTmVhciwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFGYXIgKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1NQT1RfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFNwb3RMaWdodCBzcG90TGlnaHQ7XG5cdHZlYzQgc3BvdENvbG9yO1xuXHR2ZWMzIHNwb3RMaWdodENvb3JkO1xuXHRib29sIGluU3BvdExpZ2h0TWFwO1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3c7XG5cdCNlbmRpZlxuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUUzsgaSArKyApIHtcblx0XHRzcG90TGlnaHQgPSBzcG90TGlnaHRzWyBpIF07XG5cdFx0Z2V0U3BvdExpZ2h0SW5mbyggc3BvdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBkaXJlY3RMaWdodCApO1xuXHRcdCNpZiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBVTlJPTExFRF9MT09QX0lOREVYXG5cdFx0I2VsaWYgKCBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBOVU1fU1BPVF9MSUdIVF9NQVBTXG5cdFx0I2Vsc2Vcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYICggVU5ST0xMRURfTE9PUF9JTkRFWCAtIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgKyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2VuZGlmXG5cdFx0I2lmICggU1BPVF9MSUdIVF9NQVBfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9NQVBTIClcblx0XHRcdHNwb3RMaWdodENvb3JkID0gdlNwb3RMaWdodENvb3JkWyBpIF0ueHl6IC8gdlNwb3RMaWdodENvb3JkWyBpIF0udztcblx0XHRcdGluU3BvdExpZ2h0TWFwID0gYWxsKCBsZXNzVGhhbiggYWJzKCBzcG90TGlnaHRDb29yZCAqIDIuIC0gMS4gKSwgdmVjMyggMS4wICkgKSApO1xuXHRcdFx0c3BvdENvbG9yID0gdGV4dHVyZTJEKCBzcG90TGlnaHRNYXBbIFNQT1RfTElHSFRfTUFQX0lOREVYIF0sIHNwb3RMaWdodENvb3JkLnh5ICk7XG5cdFx0XHRkaXJlY3RMaWdodC5jb2xvciA9IGluU3BvdExpZ2h0TWFwID8gZGlyZWN0TGlnaHQuY29sb3IgKiBzcG90Q29sb3IucmdiIDogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0I2VuZGlmXG5cdFx0I3VuZGVmIFNQT1RfTElHSFRfTUFQX0lOREVYXG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRzcG90TGlnaHRTaGFkb3cgPSBzcG90TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0ludGVuc2l0eSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZTcG90TGlnaHRDb29yZFsgaSBdICkgOiAxLjA7XG5cdFx0I2VuZGlmXG5cdFx0UkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiAoIE5VTV9ESVJfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodDtcblx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG5cdFx0ZGlyZWN0aW9uYWxMaWdodCA9IGRpcmVjdGlvbmFsTGlnaHRzWyBpIF07XG5cdFx0Z2V0RGlyZWN0aW9uYWxMaWdodEluZm8oIGRpcmVjdGlvbmFsTGlnaHQsIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fRElSX0xJR0hUX1NIQURPV1MgKVxuXHRcdGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9ICggZGlyZWN0TGlnaHQudmlzaWJsZSAmJiByZWNlaXZlU2hhZG93ICkgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dJbnRlbnNpdHksIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93QmlhcywgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBpIF0gKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0X1JlY3RBcmVhIClcblx0UmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9SRUNUX0FSRUFfTElHSFRTOyBpICsrICkge1xuXHRcdHJlY3RBcmVhTGlnaHQgPSByZWN0QXJlYUxpZ2h0c1sgaSBdO1xuXHRcdFJFX0RpcmVjdF9SZWN0QXJlYSggcmVjdEFyZWFMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHR2ZWMzIGlibElycmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTtcblx0I2lmIGRlZmluZWQoIFVTRV9MSUdIVF9QUk9CRVMgKVxuXHRcdGlycmFkaWFuY2UgKz0gZ2V0TGlnaHRQcm9iZUlycmFkaWFuY2UoIGxpZ2h0UHJvYmUsIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuXHQjaWYgKCBOVU1fSEVNSV9MSUdIVFMgPiAwIClcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0hFTUlfTElHSFRTOyBpICsrICkge1xuXHRcdFx0aXJyYWRpYW5jZSArPSBnZXRIZW1pc3BoZXJlTGlnaHRJcnJhZGlhbmNlKCBoZW1pc3BoZXJlTGlnaHRzWyBpIF0sIGdlb21ldHJ5Tm9ybWFsICk7XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdHZlYzMgcmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcblx0dmVjMyBjbGVhcmNvYXRSYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuI2VuZGlmIjsKCgl2YXIgbGlnaHRzX2ZyYWdtZW50X21hcHMgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdCNpZmRlZiBVU0VfTElHSFRNQVBcblx0XHR2ZWM0IGxpZ2h0TWFwVGV4ZWwgPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2TGlnaHRNYXBVdiApO1xuXHRcdHZlYzMgbGlnaHRNYXBJcnJhZGlhbmNlID0gbGlnaHRNYXBUZXhlbC5yZ2IgKiBsaWdodE1hcEludGVuc2l0eTtcblx0XHRpcnJhZGlhbmNlICs9IGxpZ2h0TWFwSXJyYWRpYW5jZTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKSAmJiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHRpYmxJcnJhZGlhbmNlICs9IGdldElCTElycmFkaWFuY2UoIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuYW5pc290cm9weUIsIG1hdGVyaWFsLmFuaXNvdHJvcHkgKTtcblx0I2Vsc2Vcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxSYWRpYW5jZSggZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwucm91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFJhZGlhbmNlICs9IGdldElCTFJhZGlhbmNlKCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBsaWdodHNfZnJhZ21lbnRfZW5kID0gIiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHRSRV9JbmRpcmVjdERpZmZ1c2UoIGlycmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHRSRV9JbmRpcmVjdFNwZWN1bGFyKCByYWRpYW5jZSwgaWJsSXJyYWRpYW5jZSwgY2xlYXJjb2F0UmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZiI7CgoJdmFyIGxvZ2RlcHRoYnVmX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKVxuXHRnbF9GcmFnRGVwdGggPSB2SXNQZXJzcGVjdGl2ZSA9PSAwLjAgPyBnbF9GcmFnQ29vcmQueiA6IGxvZzIoIHZGcmFnRGVwdGggKSAqIGxvZ0RlcHRoQnVmRkMgKiAwLjU7XG4jZW5kaWYiOwoKCXZhciBsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKVxuXHR1bmlmb3JtIGZsb2F0IGxvZ0RlcHRoQnVmRkM7XG5cdHZhcnlpbmcgZmxvYXQgdkZyYWdEZXB0aDtcblx0dmFyeWluZyBmbG9hdCB2SXNQZXJzcGVjdGl2ZTtcbiNlbmRpZiI7CgoJdmFyIGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuXHR2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuI2VuZGlmIjsKCgl2YXIgbG9nZGVwdGhidWZfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0dkZyYWdEZXB0aCA9IDEuMCArIGdsX1Bvc2l0aW9uLnc7XG5cdHZJc1BlcnNwZWN0aXZlID0gZmxvYXQoIGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSApO1xuI2VuZGlmIjsKCgl2YXIgbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG5cdHZlYzQgc2FtcGxlZERpZmZ1c2VDb2xvciA9IHRleHR1cmUyRCggbWFwLCB2TWFwVXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0c2FtcGxlZERpZmZ1c2VDb2xvciA9IHNSR0JUcmFuc2ZlckVPVEYoIHNhbXBsZWREaWZmdXNlQ29sb3IgKTtcblx0I2VuZGlmXG5cdGRpZmZ1c2VDb2xvciAqPSBzYW1wbGVkRGlmZnVzZUNvbG9yO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnRpY2xlX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQIClcblx0I2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHRcdHZlYzIgdXYgPSB2VXY7XG5cdCNlbHNlXG5cdFx0dmVjMiB1diA9ICggdXZUcmFuc2Zvcm0gKiB2ZWMzKCBnbF9Qb2ludENvb3JkLngsIDEuMCAtIGdsX1BvaW50Q29vcmQueSwgMSApICkueHk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHRkaWZmdXNlQ29sb3IgKj0gdGV4dHVyZTJEKCBtYXAsIHV2ICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdXYgKS5nO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2Vsc2Vcblx0I2lmIGRlZmluZWQoIFVTRV9NQVAgKSB8fCBkZWZpbmVkKCBVU0VfQUxQSEFNQVAgKVxuXHRcdHVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgoJdmFyIG1ldGFsbmVzc21hcF9mcmFnbWVudCA9ICJmbG9hdCBtZXRhbG5lc3NGYWN0b3IgPSBtZXRhbG5lc3M7XG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2ZWM0IHRleGVsTWV0YWxuZXNzID0gdGV4dHVyZTJEKCBtZXRhbG5lc3NNYXAsIHZNZXRhbG5lc3NNYXBVdiApO1xuXHRtZXRhbG5lc3NGYWN0b3IgKj0gdGV4ZWxNZXRhbG5lc3MuYjtcbiNlbmRpZiI7CgoJdmFyIG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1ldGFsbmVzc01hcDtcbiNlbmRpZiI7CgoJdmFyIG1vcnBoaW5zdGFuY2VfdmVydGV4ID0gIiNpZmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSFxuXHRmbG9hdCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIE1PUlBIVEFSR0VUU19DT1VOVCBdO1xuXHRmbG9hdCBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UgPSB0ZXhlbEZldGNoKCBtb3JwaFRleHR1cmUsIGl2ZWMyKCAwLCBnbF9JbnN0YW5jZUlEICksIDAgKS5yO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0bW9ycGhUYXJnZXRJbmZsdWVuY2VzW2ldID0gIHRleGVsRmV0Y2goIG1vcnBoVGV4dHVyZSwgaXZlYzIoIGkgKyAxLCBnbF9JbnN0YW5jZUlEICksIDAgKS5yO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBtb3JwaGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX01PUlBIQ09MT1JTIClcblx0dkNvbG9yICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTU9SUEhUQVJHRVRTX0NPVU5UOyBpICsrICkge1xuXHRcdCNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkucmdiICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdFx0I2VuZGlmXG5cdH1cbiNlbmRpZiI7CgoJdmFyIG1vcnBobm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBITk9STUFMU1xuXHRvYmplY3ROb3JtYWwgKj0gbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSBvYmplY3ROb3JtYWwgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAxICkueHl6ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdH1cbiNlbmRpZiI7CgoJdmFyIG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTXG5cdCNpZm5kZWYgVVNFX0lOU1RBTkNJTkdfTU9SUEhcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgTU9SUEhUQVJHRVRTX0NPVU5UIF07XG5cdCNlbmRpZlxuXHR1bmlmb3JtIHNhbXBsZXIyREFycmF5IG1vcnBoVGFyZ2V0c1RleHR1cmU7XG5cdHVuaWZvcm0gaXZlYzIgbW9ycGhUYXJnZXRzVGV4dHVyZVNpemU7XG5cdHZlYzQgZ2V0TW9ycGgoIGNvbnN0IGluIGludCB2ZXJ0ZXhJbmRleCwgY29uc3QgaW4gaW50IG1vcnBoVGFyZ2V0SW5kZXgsIGNvbnN0IGluIGludCBvZmZzZXQgKSB7XG5cdFx0aW50IHRleGVsSW5kZXggPSB2ZXJ0ZXhJbmRleCAqIE1PUlBIVEFSR0VUU19URVhUVVJFX1NUUklERSArIG9mZnNldDtcblx0XHRpbnQgeSA9IHRleGVsSW5kZXggLyBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdGludCB4ID0gdGV4ZWxJbmRleCAtIHkgKiBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdGl2ZWMzIG1vcnBoVVYgPSBpdmVjMyggeCwgeSwgbW9ycGhUYXJnZXRJbmRleCApO1xuXHRcdHJldHVybiB0ZXhlbEZldGNoKCBtb3JwaFRhcmdldHNUZXh0dXJlLCBtb3JwaFVWLCAwICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIG1vcnBodGFyZ2V0X3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuXHR0cmFuc2Zvcm1lZCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHRyYW5zZm9ybWVkICs9IGdldE1vcnBoKCBnbF9WZXJ0ZXhJRCwgaSwgMCApLnh5eiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBub3JtYWxfZnJhZ21lbnRfYmVnaW4gPSAiZmxvYXQgZmFjZURpcmVjdGlvbiA9IGdsX0Zyb250RmFjaW5nID8gMS4wIDogLSAxLjA7XG4jaWZkZWYgRkxBVF9TSEFERURcblx0dmVjMyBmZHggPSBkRmR4KCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgZmR5ID0gZEZkeSggdlZpZXdQb3NpdGlvbiApO1xuXHR2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGZkeCwgZmR5ICkgKTtcbiNlbHNlXG5cdHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7XG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibiA9IG1hdDMoIG5vcm1hbGl6ZSggdlRhbmdlbnQgKSwgbm9ybWFsaXplKCB2Qml0YW5nZW50ICksIG5vcm1hbCApO1xuXHQjZWxzZVxuXHRcdG1hdDMgdGJuID0gZ2V0VGFuZ2VudEZyYW1lKCAtIHZWaWV3UG9zaXRpb24sIG5vcm1hbCxcblx0XHQjaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApXG5cdFx0XHR2Tm9ybWFsTWFwVXZcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApXG5cdFx0XHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXZcblx0XHQjZWxzZVxuXHRcdFx0dlV2XG5cdFx0I2VuZGlmXG5cdFx0KTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym5bMF0gKj0gZmFjZURpcmVjdGlvbjtcblx0XHR0Ym5bMV0gKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibjIgPSBtYXQzKCBub3JtYWxpemUoIHZUYW5nZW50ICksIG5vcm1hbGl6ZSggdkJpdGFuZ2VudCApLCBub3JtYWwgKTtcblx0I2Vsc2Vcblx0XHRtYXQzIHRibjIgPSBnZXRUYW5nZW50RnJhbWUoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym4yWzBdICo9IGZhY2VEaXJlY3Rpb247XG5cdFx0dGJuMlsxXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcbiNlbmRpZlxudmVjMyBub25QZXJ0dXJiZWROb3JtYWwgPSBub3JtYWw7IjsKCgl2YXIgbm9ybWFsX2ZyYWdtZW50X21hcHMgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0Vcblx0bm9ybWFsID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHRub3JtYWwgPSAtIG5vcm1hbDtcblx0I2VuZGlmXG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgPSBub3JtYWwgKiBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcblx0bm9ybWFsID0gbm9ybWFsaXplKCBub3JtYWxNYXRyaXggKiBub3JtYWwgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmVjMyBtYXBOID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0bWFwTi54eSAqPSBub3JtYWxTY2FsZTtcblx0bm9ybWFsID0gbm9ybWFsaXplKCB0Ym4gKiBtYXBOICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApXG5cdG5vcm1hbCA9IHBlcnR1cmJOb3JtYWxBcmIoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSwgZmFjZURpcmVjdGlvbiApO1xuI2VuZGlmIjsKCgl2YXIgbm9ybWFsX3BhcnNfZnJhZ21lbnQgPSAiI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuXHRcdHZhcnlpbmcgdmVjMyB2Qml0YW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG5vcm1hbF9wYXJzX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgbm9ybWFsX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZOb3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZUYW5nZW50ID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZFRhbmdlbnQgKTtcblx0XHR2Qml0YW5nZW50ID0gbm9ybWFsaXplKCBjcm9zcyggdk5vcm1hbCwgdlRhbmdlbnQgKSAqIHRhbmdlbnQudyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG5vcm1hbE1hcDtcblx0dW5pZm9ybSB2ZWMyIG5vcm1hbFNjYWxlO1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRVxuXHR1bmlmb3JtIG1hdDMgbm9ybWFsTWF0cml4O1xuI2VuZGlmXG4jaWYgISBkZWZpbmVkICggVVNFX1RBTkdFTlQgKSAmJiAoIGRlZmluZWQgKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQgKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZICkgKVxuXHRtYXQzIGdldFRhbmdlbnRGcmFtZSggdmVjMyBleWVfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiB1diApIHtcblx0XHR2ZWMzIHEwID0gZEZkeCggZXllX3Bvcy54eXogKTtcblx0XHR2ZWMzIHExID0gZEZkeSggZXllX3Bvcy54eXogKTtcblx0XHR2ZWMyIHN0MCA9IGRGZHgoIHV2LnN0ICk7XG5cdFx0dmVjMiBzdDEgPSBkRmR5KCB1di5zdCApO1xuXHRcdHZlYzMgTiA9IHN1cmZfbm9ybTtcblx0XHR2ZWMzIHExcGVycCA9IGNyb3NzKCBxMSwgTiApO1xuXHRcdHZlYzMgcTBwZXJwID0gY3Jvc3MoIE4sIHEwICk7XG5cdFx0dmVjMyBUID0gcTFwZXJwICogc3QwLnggKyBxMHBlcnAgKiBzdDEueDtcblx0XHR2ZWMzIEIgPSBxMXBlcnAgKiBzdDAueSArIHEwcGVycCAqIHN0MS55O1xuXHRcdGZsb2F0IGRldCA9IG1heCggZG90KCBULCBUICksIGRvdCggQiwgQiApICk7XG5cdFx0ZmxvYXQgc2NhbGUgPSAoIGRldCA9PSAwLjAgKSA/IDAuMCA6IGludmVyc2VzcXJ0KCBkZXQgKTtcblx0XHRyZXR1cm4gbWF0MyggVCAqIHNjYWxlLCBCICogc2NhbGUsIE4gKTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHR2ZWMzIGNsZWFyY29hdE5vcm1hbCA9IG5vblBlcnR1cmJlZE5vcm1hbDtcbiNlbmRpZiI7CgoJdmFyIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dmVjMyBjbGVhcmNvYXRNYXBOID0gdGV4dHVyZTJEKCBjbGVhcmNvYXROb3JtYWxNYXAsIHZDbGVhcmNvYXROb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0Y2xlYXJjb2F0TWFwTi54eSAqPSBjbGVhcmNvYXROb3JtYWxTY2FsZTtcblx0Y2xlYXJjb2F0Tm9ybWFsID0gbm9ybWFsaXplKCB0Ym4yICogY2xlYXJjb2F0TWFwTiApO1xuI2VuZGlmIjsKCgl2YXIgY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0TWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0Tm9ybWFsTWFwO1xuXHR1bmlmb3JtIHZlYzIgY2xlYXJjb2F0Tm9ybWFsU2NhbGU7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXRSb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKCXZhciBpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgaXJpZGVzY2VuY2VNYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwO1xuI2VuZGlmIjsKCgl2YXIgb3BhcXVlX2ZyYWdtZW50ID0gIiNpZmRlZiBPUEFRVUVcbmRpZmZ1c2VDb2xvci5hID0gMS4wO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuZGlmZnVzZUNvbG9yLmEgKj0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGE7XG4jZW5kaWZcbmdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7IjsKCgl2YXIgcGFja2luZyA9ICJ2ZWMzIHBhY2tOb3JtYWxUb1JHQiggY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdHJldHVybiBub3JtYWxpemUoIG5vcm1hbCApICogMC41ICsgMC41O1xufVxudmVjMyB1bnBhY2tSR0JUb05vcm1hbCggY29uc3QgaW4gdmVjMyByZ2IgKSB7XG5cdHJldHVybiAyLjAgKiByZ2IueHl6IC0gMS4wO1xufVxuY29uc3QgZmxvYXQgUGFja1Vwc2NhbGUgPSAyNTYuIC8gMjU1Ljtjb25zdCBmbG9hdCBVbnBhY2tEb3duc2NhbGUgPSAyNTUuIC8gMjU2Ljtjb25zdCBmbG9hdCBTaGlmdFJpZ2h0OCA9IDEuIC8gMjU2LjtcbmNvbnN0IGZsb2F0IEludjI1NSA9IDEuIC8gMjU1LjtcbmNvbnN0IHZlYzQgUGFja0ZhY3RvcnMgPSB2ZWM0KCAxLjAsIDI1Ni4wLCAyNTYuMCAqIDI1Ni4wLCAyNTYuMCAqIDI1Ni4wICogMjU2LjAgKTtcbmNvbnN0IHZlYzIgVW5wYWNrRmFjdG9yczIgPSB2ZWMyKCBVbnBhY2tEb3duc2NhbGUsIDEuMCAvIFBhY2tGYWN0b3JzLmcgKTtcbmNvbnN0IHZlYzMgVW5wYWNrRmFjdG9yczMgPSB2ZWMzKCBVbnBhY2tEb3duc2NhbGUgLyBQYWNrRmFjdG9ycy5yZywgMS4wIC8gUGFja0ZhY3RvcnMuYiApO1xuY29uc3QgdmVjNCBVbnBhY2tGYWN0b3JzNCA9IHZlYzQoIFVucGFja0Rvd25zY2FsZSAvIFBhY2tGYWN0b3JzLnJnYiwgMS4wIC8gUGFja0ZhY3RvcnMuYSApO1xudmVjNCBwYWNrRGVwdGhUb1JHQkEoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdGlmKCB2IDw9IDAuMCApXG5cdFx0cmV0dXJuIHZlYzQoIDAuLCAwLiwgMC4sIDAuICk7XG5cdGlmKCB2ID49IDEuMCApXG5cdFx0cmV0dXJuIHZlYzQoIDEuLCAxLiwgMS4sIDEuICk7XG5cdGZsb2F0IHZ1Zjtcblx0ZmxvYXQgYWYgPSBtb2RmKCB2ICogUGFja0ZhY3RvcnMuYSwgdnVmICk7XG5cdGZsb2F0IGJmID0gbW9kZiggdnVmICogU2hpZnRSaWdodDgsIHZ1ZiApO1xuXHRmbG9hdCBnZiA9IG1vZGYoIHZ1ZiAqIFNoaWZ0UmlnaHQ4LCB2dWYgKTtcblx0cmV0dXJuIHZlYzQoIHZ1ZiAqIEludjI1NSwgZ2YgKiBQYWNrVXBzY2FsZSwgYmYgKiBQYWNrVXBzY2FsZSwgYWYgKTtcbn1cbnZlYzMgcGFja0RlcHRoVG9SR0IoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdGlmKCB2IDw9IDAuMCApXG5cdFx0cmV0dXJuIHZlYzMoIDAuLCAwLiwgMC4gKTtcblx0aWYoIHYgPj0gMS4wIClcblx0XHRyZXR1cm4gdmVjMyggMS4sIDEuLCAxLiApO1xuXHRmbG9hdCB2dWY7XG5cdGZsb2F0IGJmID0gbW9kZiggdiAqIFBhY2tGYWN0b3JzLmIsIHZ1ZiApO1xuXHRmbG9hdCBnZiA9IG1vZGYoIHZ1ZiAqIFNoaWZ0UmlnaHQ4LCB2dWYgKTtcblx0cmV0dXJuIHZlYzMoIHZ1ZiAqIEludjI1NSwgZ2YgKiBQYWNrVXBzY2FsZSwgYmYgKTtcbn1cbnZlYzIgcGFja0RlcHRoVG9SRyggY29uc3QgaW4gZmxvYXQgdiApIHtcblx0aWYoIHYgPD0gMC4wIClcblx0XHRyZXR1cm4gdmVjMiggMC4sIDAuICk7XG5cdGlmKCB2ID49IDEuMCApXG5cdFx0cmV0dXJuIHZlYzIoIDEuLCAxLiApO1xuXHRmbG9hdCB2dWY7XG5cdGZsb2F0IGdmID0gbW9kZiggdiAqIDI1Ni4sIHZ1ZiApO1xuXHRyZXR1cm4gdmVjMiggdnVmICogSW52MjU1LCBnZiApO1xufVxuZmxvYXQgdW5wYWNrUkdCQVRvRGVwdGgoIGNvbnN0IGluIHZlYzQgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9yczQgKTtcbn1cbmZsb2F0IHVucGFja1JHQlRvRGVwdGgoIGNvbnN0IGluIHZlYzMgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9yczMgKTtcbn1cbmZsb2F0IHVucGFja1JHVG9EZXB0aCggY29uc3QgaW4gdmVjMiB2ICkge1xuXHRyZXR1cm4gdi5yICogVW5wYWNrRmFjdG9yczIuciArIHYuZyAqIFVucGFja0ZhY3RvcnMyLmc7XG59XG52ZWM0IHBhY2sySGFsZlRvUkdCQSggY29uc3QgaW4gdmVjMiB2ICkge1xuXHR2ZWM0IHIgPSB2ZWM0KCB2LngsIGZyYWN0KCB2LnggKiAyNTUuMCApLCB2LnksIGZyYWN0KCB2LnkgKiAyNTUuMCApICk7XG5cdHJldHVybiB2ZWM0KCByLnggLSByLnkgLyAyNTUuMCwgci55LCByLnogLSByLncgLyAyNTUuMCwgci53ICk7XG59XG52ZWMyIHVucGFja1JHQkFUbzJIYWxmKCBjb25zdCBpbiB2ZWM0IHYgKSB7XG5cdHJldHVybiB2ZWMyKCB2LnggKyAoIHYueSAvIDI1NS4wICksIHYueiArICggdi53IC8gMjU1LjAgKSApO1xufVxuZmxvYXQgdmlld1pUb09ydGhvZ3JhcGhpY0RlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCB2aWV3WiArIG5lYXIgKSAvICggbmVhciAtIGZhciApO1xufVxuZmxvYXQgb3J0aG9ncmFwaGljRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBkZXB0aCwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gZGVwdGggKiAoIG5lYXIgLSBmYXIgKSAtIG5lYXI7XG59XG5mbG9hdCB2aWV3WlRvUGVyc3BlY3RpdmVEZXB0aCggY29uc3QgaW4gZmxvYXQgdmlld1osIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggKCBuZWFyICsgdmlld1ogKSAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIHZpZXdaICk7XG59XG5mbG9hdCBwZXJzcGVjdGl2ZURlcHRoVG9WaWV3WiggY29uc3QgaW4gZmxvYXQgZGVwdGgsIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggbmVhciAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIGRlcHRoIC0gZmFyICk7XG59IjsKCgl2YXIgcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCA9ICIjaWZkZWYgUFJFTVVMVElQTElFRF9BTFBIQVxuXHRnbF9GcmFnQ29sb3IucmdiICo9IGdsX0ZyYWdDb2xvci5hO1xuI2VuZGlmIjsKCgl2YXIgcHJvamVjdF92ZXJ0ZXggPSAidmVjNCBtdlBvc2l0aW9uID0gdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuI2lmZGVmIFVTRV9CQVRDSElOR1xuXHRtdlBvc2l0aW9uID0gYmF0Y2hpbmdNYXRyaXggKiBtdlBvc2l0aW9uO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lOU1RBTkNJTkdcblx0bXZQb3NpdGlvbiA9IGluc3RhbmNlTWF0cml4ICogbXZQb3NpdGlvbjtcbiNlbmRpZlxubXZQb3NpdGlvbiA9IG1vZGVsVmlld01hdHJpeCAqIG12UG9zaXRpb247XG5nbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uOyI7CgoJdmFyIGRpdGhlcmluZ19mcmFnbWVudCA9ICIjaWZkZWYgRElUSEVSSU5HXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSBkaXRoZXJpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7CgoJdmFyIGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBESVRIRVJJTkdcblx0dmVjMyBkaXRoZXJpbmcoIHZlYzMgY29sb3IgKSB7XG5cdFx0ZmxvYXQgZ3JpZF9wb3NpdGlvbiA9IHJhbmQoIGdsX0ZyYWdDb29yZC54eSApO1xuXHRcdHZlYzMgZGl0aGVyX3NoaWZ0X1JHQiA9IHZlYzMoIDAuMjUgLyAyNTUuMCwgLTAuMjUgLyAyNTUuMCwgMC4yNSAvIDI1NS4wICk7XG5cdFx0ZGl0aGVyX3NoaWZ0X1JHQiA9IG1peCggMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgLTIuMCAqIGRpdGhlcl9zaGlmdF9SR0IsIGdyaWRfcG9zaXRpb24gKTtcblx0XHRyZXR1cm4gY29sb3IgKyBkaXRoZXJfc2hpZnRfUkdCO1xuXHR9XG4jZW5kaWYiOwoKCXZhciByb3VnaG5lc3NtYXBfZnJhZ21lbnQgPSAiZmxvYXQgcm91Z2huZXNzRmFjdG9yID0gcm91Z2huZXNzO1xuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dmVjNCB0ZXhlbFJvdWdobmVzcyA9IHRleHR1cmUyRCggcm91Z2huZXNzTWFwLCB2Um91Z2huZXNzTWFwVXYgKTtcblx0cm91Z2huZXNzRmFjdG9yICo9IHRleGVsUm91Z2huZXNzLmc7XG4jZW5kaWYiOwoKCXZhciByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCByb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXBfcGFyc19mcmFnbWVudCA9ICIjaWYgTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMFxuXHR2YXJ5aW5nIHZlYzQgdlNwb3RMaWdodENvb3JkWyBOVU1fU1BPVF9MSUdIVF9DT09SRFMgXTtcbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUX01BUFMgPiAwXG5cdHVuaWZvcm0gc2FtcGxlcjJEIHNwb3RMaWdodE1hcFsgTlVNX1NQT1RfTElHSFRfTUFQUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwb3RTaGFkb3dNYXBbIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHBvaW50U2hhZG93TWFwWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2UG9pbnRTaGFkb3dDb29yZFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgUG9pbnRMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYU5lYXI7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFGYXI7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvd3NbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHRmbG9hdCB0ZXh0dXJlMkRDb21wYXJlKCBzYW1wbGVyMkQgZGVwdGhzLCB2ZWMyIHV2LCBmbG9hdCBjb21wYXJlICkge1xuXHRcdHJldHVybiBzdGVwKCBjb21wYXJlLCB1bnBhY2tSR0JBVG9EZXB0aCggdGV4dHVyZTJEKCBkZXB0aHMsIHV2ICkgKSApO1xuXHR9XG5cdHZlYzIgdGV4dHVyZTJERGlzdHJpYnV0aW9uKCBzYW1wbGVyMkQgc2hhZG93LCB2ZWMyIHV2ICkge1xuXHRcdHJldHVybiB1bnBhY2tSR0JBVG8ySGFsZiggdGV4dHVyZTJEKCBzaGFkb3csIHV2ICkgKTtcblx0fVxuXHRmbG9hdCBWU01TaGFkb3cgKHNhbXBsZXIyRCBzaGFkb3csIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKXtcblx0XHRmbG9hdCBvY2NsdXNpb24gPSAxLjA7XG5cdFx0dmVjMiBkaXN0cmlidXRpb24gPSB0ZXh0dXJlMkREaXN0cmlidXRpb24oIHNoYWRvdywgdXYgKTtcblx0XHRmbG9hdCBoYXJkX3NoYWRvdyA9IHN0ZXAoIGNvbXBhcmUgLCBkaXN0cmlidXRpb24ueCApO1xuXHRcdGlmIChoYXJkX3NoYWRvdyAhPSAxLjAgKSB7XG5cdFx0XHRmbG9hdCBkaXN0YW5jZSA9IGNvbXBhcmUgLSBkaXN0cmlidXRpb24ueCA7XG5cdFx0XHRmbG9hdCB2YXJpYW5jZSA9IG1heCggMC4wMDAwMCwgZGlzdHJpYnV0aW9uLnkgKiBkaXN0cmlidXRpb24ueSApO1xuXHRcdFx0ZmxvYXQgc29mdG5lc3NfcHJvYmFiaWxpdHkgPSB2YXJpYW5jZSAvICh2YXJpYW5jZSArIGRpc3RhbmNlICogZGlzdGFuY2UgKTtcdFx0XHRzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IGNsYW1wKCAoIHNvZnRuZXNzX3Byb2JhYmlsaXR5IC0gMC4zICkgLyAoIDAuOTUgLSAwLjMgKSwgMC4wLCAxLjAgKTtcdFx0XHRvY2NsdXNpb24gPSBjbGFtcCggbWF4KCBoYXJkX3NoYWRvdywgc29mdG5lc3NfcHJvYmFiaWxpdHkgKSwgMC4wLCAxLjAgKTtcblx0XHR9XG5cdFx0cmV0dXJuIG9jY2x1c2lvbjtcblx0fVxuXHRmbG9hdCBnZXRTaGFkb3coIHNhbXBsZXIyRCBzaGFkb3dNYXAsIHZlYzIgc2hhZG93TWFwU2l6ZSwgZmxvYXQgc2hhZG93SW50ZW5zaXR5LCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHNoYWRvd0Nvb3JkLnh5eiAvPSBzaGFkb3dDb29yZC53O1xuXHRcdHNoYWRvd0Nvb3JkLnogKz0gc2hhZG93Qmlhcztcblx0XHRib29sIGluRnJ1c3R1bSA9IHNoYWRvd0Nvb3JkLnggPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnggPD0gMS4wICYmIHNoYWRvd0Nvb3JkLnkgPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnkgPD0gMS4wO1xuXHRcdGJvb2wgZnJ1c3R1bVRlc3QgPSBpbkZydXN0dW0gJiYgc2hhZG93Q29vcmQueiA8PSAxLjA7XG5cdFx0aWYgKCBmcnVzdHVtVGVzdCApIHtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHgwID0gLSB0ZXhlbFNpemUueCAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR5MCA9IC0gdGV4ZWxTaXplLnkgKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeDEgPSArIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkxID0gKyB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MiA9IGR4MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MiA9IGR5MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR4MyA9IGR4MSAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MyA9IGR5MSAvIDIuMDtcblx0XHRcdHNoYWRvdyA9IChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkyICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCBkeTIgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIGR5MyApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTMgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gMTcuMCApO1xuXHRcdCNlbGlmIGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRl9TT0ZUIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHggPSB0ZXhlbFNpemUueDtcblx0XHRcdGZsb2F0IGR5ID0gdGV4ZWxTaXplLnk7XG5cdFx0XHR2ZWMyIHV2ID0gc2hhZG93Q29vcmQueHk7XG5cdFx0XHR2ZWMyIGYgPSBmcmFjdCggdXYgKiBzaGFkb3dNYXBTaXplICsgMC41ICk7XG5cdFx0XHR1diAtPSBmICogdGV4ZWxTaXplO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCBkeSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdGV4ZWxTaXplLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi54ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueCApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueSApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCBmLnkgKSArXG5cdFx0XHRcdG1peCggbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggLWR4LCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdFx0ICB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBmLnkgKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcblx0XHRcdHNoYWRvdyA9IFZTTVNoYWRvdyggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuXHRcdCNlbHNlXG5cdFx0XHRzaGFkb3cgPSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICk7XG5cdFx0I2VuZGlmXG5cdFx0fVxuXHRcdHJldHVybiBtaXgoIDEuMCwgc2hhZG93LCBzaGFkb3dJbnRlbnNpdHkgKTtcblx0fVxuXHR2ZWMyIGN1YmVUb1VWKCB2ZWMzIHYsIGZsb2F0IHRleGVsU2l6ZVkgKSB7XG5cdFx0dmVjMyBhYnNWID0gYWJzKCB2ICk7XG5cdFx0ZmxvYXQgc2NhbGVUb0N1YmUgPSAxLjAgLyBtYXgoIGFic1YueCwgbWF4KCBhYnNWLnksIGFic1YueiApICk7XG5cdFx0YWJzViAqPSBzY2FsZVRvQ3ViZTtcblx0XHR2ICo9IHNjYWxlVG9DdWJlICogKCAxLjAgLSAyLjAgKiB0ZXhlbFNpemVZICk7XG5cdFx0dmVjMiBwbGFuYXIgPSB2Lnh5O1xuXHRcdGZsb2F0IGFsbW9zdEFUZXhlbCA9IDEuNSAqIHRleGVsU2l6ZVk7XG5cdFx0ZmxvYXQgYWxtb3N0T25lID0gMS4wIC0gYWxtb3N0QVRleGVsO1xuXHRcdGlmICggYWJzVi56ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGlmICggdi56ID4gMC4wIClcblx0XHRcdFx0cGxhbmFyLnggPSA0LjAgLSB2Lng7XG5cdFx0fSBlbHNlIGlmICggYWJzVi54ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25YID0gc2lnbiggdi54ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueiAqIHNpZ25YICsgMi4wICogc2lnblg7XG5cdFx0fSBlbHNlIGlmICggYWJzVi55ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25ZID0gc2lnbiggdi55ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueCArIDIuMCAqIHNpZ25ZICsgMi4wO1xuXHRcdFx0cGxhbmFyLnkgPSB2LnogKiBzaWduWSAtIDIuMDtcblx0XHR9XG5cdFx0cmV0dXJuIHZlYzIoIDAuMTI1LCAwLjI1ICkgKiBwbGFuYXIgKyB2ZWMyKCAwLjM3NSwgMC43NSApO1xuXHR9XG5cdGZsb2F0IGdldFBvaW50U2hhZG93KCBzYW1wbGVyMkQgc2hhZG93TWFwLCB2ZWMyIHNoYWRvd01hcFNpemUsIGZsb2F0IHNoYWRvd0ludGVuc2l0eSwgZmxvYXQgc2hhZG93QmlhcywgZmxvYXQgc2hhZG93UmFkaXVzLCB2ZWM0IHNoYWRvd0Nvb3JkLCBmbG9hdCBzaGFkb3dDYW1lcmFOZWFyLCBmbG9hdCBzaGFkb3dDYW1lcmFGYXIgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHZlYzMgbGlnaHRUb1Bvc2l0aW9uID0gc2hhZG93Q29vcmQueHl6O1xuXHRcdFxuXHRcdGZsb2F0IGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCA9IGxlbmd0aCggbGlnaHRUb1Bvc2l0aW9uICk7XG5cdFx0aWYgKCBsaWdodFRvUG9zaXRpb25MZW5ndGggLSBzaGFkb3dDYW1lcmFGYXIgPD0gMC4wICYmIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYU5lYXIgPj0gMC4wICkge1xuXHRcdFx0ZmxvYXQgZHAgPSAoIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYU5lYXIgKSAvICggc2hhZG93Q2FtZXJhRmFyIC0gc2hhZG93Q2FtZXJhTmVhciApO1x0XHRcdGRwICs9IHNoYWRvd0JpYXM7XG5cdFx0XHR2ZWMzIGJkM0QgPSBub3JtYWxpemUoIGxpZ2h0VG9Qb3NpdGlvbiApO1xuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvICggc2hhZG93TWFwU2l6ZSAqIHZlYzIoIDQuMCwgMi4wICkgKTtcblx0XHRcdCNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCApIHx8IGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1ZTTSApXG5cdFx0XHRcdHZlYzIgb2Zmc2V0ID0gdmVjMiggLSAxLCAxICkgKiBzaGFkb3dSYWRpdXMgKiB0ZXhlbFNpemUueTtcblx0XHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHl5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXl4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eHksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eCwgdGV4ZWxTaXplLnkgKSwgZHAgKVxuXHRcdFx0XHQpICogKCAxLjAgLyA5LjAgKTtcblx0XHRcdCNlbHNlXG5cdFx0XHRcdHNoYWRvdyA9IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QsIHRleGVsU2l6ZS55ICksIGRwICk7XG5cdFx0XHQjZW5kaWZcblx0XHR9XG5cdFx0cmV0dXJuIG1peCggMS4wLCBzaGFkb3csIHNoYWRvd0ludGVuc2l0eSApO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXBfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0dW5pZm9ybSBtYXQ0IHNwb3RMaWdodE1hdHJpeFsgTlVNX1NQT1RfTElHSFRfQ09PUkRTIF07XG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHR9O1xuXHRcdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBwb2ludFNoYWRvd01hdHJpeFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IFBvaW50TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93SW50ZW5zaXR5O1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhRmFyO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHRTaGFkb3dzWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIHNoYWRvd21hcF92ZXJ0ZXggPSAiI2lmICggZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMCB8fCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDAgKSApIHx8ICggTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMCApXG5cdHZlYzMgc2hhZG93V29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCB0cmFuc2Zvcm1lZE5vcm1hbCwgdmlld01hdHJpeCApO1xuXHR2ZWM0IHNoYWRvd1dvcmxkUG9zaXRpb247XG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQIClcblx0I2lmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24gKyB2ZWM0KCBzaGFkb3dXb3JsZE5vcm1hbCAqIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBpIF0uc2hhZG93Tm9ybWFsQmlhcywgMCApO1xuXHRcdFx0dkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSA9IGRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRcdHNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uICsgdmVjNCggc2hhZG93V29ybGROb3JtYWwgKiBwb2ludExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXMsIDAgKTtcblx0XHRcdHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0gPSBwb2ludFNoYWRvd01hdHJpeFsgaSBdICogc2hhZG93V29ybGRQb3NpdGlvbjtcblx0XHR9XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRfQ09PUkRTOyBpICsrICkge1xuXHRcdHNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uO1xuXHRcdCNpZiAoIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0XHRzaGFkb3dXb3JsZFBvc2l0aW9uLnh5eiArPSBzaGFkb3dXb3JsZE5vcm1hbCAqIHNwb3RMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzO1xuXHRcdCNlbmRpZlxuXHRcdHZTcG90TGlnaHRDb29yZFsgaSBdID0gc3BvdExpZ2h0TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQgPSAiZmxvYXQgZ2V0U2hhZG93TWFzaygpIHtcblx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHQjaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHREaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdGRpcmVjdGlvbmFsTGlnaHQgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBkaXJlY3Rpb25hbFNoYWRvd01hcFsgaSBdLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd01hcFNpemUsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93SW50ZW5zaXR5LCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0c3BvdExpZ2h0ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodC5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHQuc2hhZG93SW50ZW5zaXR5LCBzcG90TGlnaHQuc2hhZG93Qmlhcywgc3BvdExpZ2h0LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0ludGVuc2l0eSwgcG9pbnRMaWdodC5zaGFkb3dCaWFzLCBwb2ludExpZ2h0LnNoYWRvd1JhZGl1cywgdlBvaW50U2hhZG93Q29vcmRbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dDYW1lcmFOZWFyLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYUZhciApIDogMS4wO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjZW5kaWZcblx0cmV0dXJuIHNoYWRvdztcbn0iOwoKCXZhciBza2luYmFzZV92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHRtYXQ0IGJvbmVNYXRYID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnggKTtcblx0bWF0NCBib25lTWF0WSA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC55ICk7XG5cdG1hdDQgYm9uZU1hdFogPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueiApO1xuXHRtYXQ0IGJvbmVNYXRXID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LncgKTtcbiNlbmRpZiI7CgoJdmFyIHNraW5uaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBiaW5kTWF0cml4SW52ZXJzZTtcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYm9uZVRleHR1cmU7XG5cdG1hdDQgZ2V0Qm9uZU1hdHJpeCggY29uc3QgaW4gZmxvYXQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBib25lVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjIgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHggKyAxLCB5ICksIDAgKTtcblx0XHR2ZWM0IHYzID0gdGV4ZWxGZXRjaCggYm9uZVRleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJvbmVUZXh0dXJlLCBpdmVjMiggeCArIDMsIHkgKSwgMCApO1xuXHRcdHJldHVybiBtYXQ0KCB2MSwgdjIsIHYzLCB2NCApO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBza2lubmluZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHR2ZWM0IHNraW5WZXJ0ZXggPSBiaW5kTWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuXHR2ZWM0IHNraW5uZWQgPSB2ZWM0KCAwLjAgKTtcblx0c2tpbm5lZCArPSBib25lTWF0WCAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lng7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFkgKiBza2luVmVydGV4ICogc2tpbldlaWdodC55O1xuXHRza2lubmVkICs9IGJvbmVNYXRaICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQuejtcblx0c2tpbm5lZCArPSBib25lTWF0VyAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnc7XG5cdHRyYW5zZm9ybWVkID0gKCBiaW5kTWF0cml4SW52ZXJzZSAqIHNraW5uZWQgKS54eXo7XG4jZW5kaWYiOwoKCXZhciBza2lubm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdG1hdDQgc2tpbk1hdHJpeCA9IG1hdDQoIDAuMCApO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueCAqIGJvbmVNYXRYO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueSAqIGJvbmVNYXRZO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueiAqIGJvbmVNYXRaO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQudyAqIGJvbmVNYXRXO1xuXHRza2luTWF0cml4ID0gYmluZE1hdHJpeEludmVyc2UgKiBza2luTWF0cml4ICogYmluZE1hdHJpeDtcblx0b2JqZWN0Tm9ybWFsID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdE5vcm1hbCwgMC4wICkgKS54eXo7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdG9iamVjdFRhbmdlbnQgPSB2ZWM0KCBza2luTWF0cml4ICogdmVjNCggb2JqZWN0VGFuZ2VudCwgMC4wICkgKS54eXo7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgc3BlY3VsYXJtYXBfZnJhZ21lbnQgPSAiZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dmVjNCB0ZXhlbFNwZWN1bGFyID0gdGV4dHVyZTJEKCBzcGVjdWxhck1hcCwgdlNwZWN1bGFyTWFwVXYgKTtcblx0c3BlY3VsYXJTdHJlbmd0aCA9IHRleGVsU3BlY3VsYXIucjtcbiNlbHNlXG5cdHNwZWN1bGFyU3RyZW5ndGggPSAxLjA7XG4jZW5kaWYiOwoKCXZhciBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgc3BlY3VsYXJNYXA7XG4jZW5kaWYiOwoKCXZhciB0b25lbWFwcGluZ19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVE9ORV9NQVBQSU5HIClcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IHRvbmVNYXBwaW5nKCBnbF9GcmFnQ29sb3IucmdiICk7XG4jZW5kaWYiOwoKCXZhciB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZm5kZWYgc2F0dXJhdGVcbiNkZWZpbmUgc2F0dXJhdGUoIGEgKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG51bmlmb3JtIGZsb2F0IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG52ZWMzIExpbmVhclRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvciApO1xufVxudmVjMyBSZWluaGFyZFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRyZXR1cm4gc2F0dXJhdGUoIGNvbG9yIC8gKCB2ZWMzKCAxLjAgKSArIGNvbG9yICkgKTtcbn1cbnZlYzMgQ2luZW9uVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGNvbG9yID0gbWF4KCB2ZWMzKCAwLjAgKSwgY29sb3IgLSAwLjAwNCApO1xuXHRyZXR1cm4gcG93KCAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDAuNSApICkgLyAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDEuNyApICsgMC4wNiApLCB2ZWMzKCAyLjIgKSApO1xufVxudmVjMyBSUlRBbmRPRFRGaXQoIHZlYzMgdiApIHtcblx0dmVjMyBhID0gdiAqICggdiArIDAuMDI0NTc4NiApIC0gMC4wMDAwOTA1Mzc7XG5cdHZlYzMgYiA9IHYgKiAoIDAuOTgzNzI5ICogdiArIDAuNDMyOTUxMCApICsgMC4yMzgwODE7XG5cdHJldHVybiBhIC8gYjtcbn1cbnZlYzMgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBtYXQzIEFDRVNJbnB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggMC41OTcxOSwgMC4wNzYwMCwgMC4wMjg0MCApLFx0XHR2ZWMzKCAwLjM1NDU4LCAwLjkwODM0LCAwLjEzMzgzICksXG5cdFx0dmVjMyggMC4wNDgyMywgMC4wMTU2NiwgMC44Mzc3NyApXG5cdCk7XG5cdGNvbnN0IG1hdDMgQUNFU091dHB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggIDEuNjA0NzUsIC0wLjEwMjA4LCAtMC4wMDMyNyApLFx0XHR2ZWMzKCAtMC41MzEwOCwgIDEuMTA4MTMsIC0wLjA3Mjc2ICksXG5cdFx0dmVjMyggLTAuMDczNjcsIC0wLjAwNjA1LCAgMS4wNzYwMiApXG5cdCk7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmUgLyAwLjY7XG5cdGNvbG9yID0gQUNFU0lucHV0TWF0ICogY29sb3I7XG5cdGNvbG9yID0gUlJUQW5kT0RURml0KCBjb2xvciApO1xuXHRjb2xvciA9IEFDRVNPdXRwdXRNYXQgKiBjb2xvcjtcblx0cmV0dXJuIHNhdHVyYXRlKCBjb2xvciApO1xufVxuY29uc3QgbWF0MyBMSU5FQVJfUkVDMjAyMF9UT19MSU5FQVJfU1JHQiA9IG1hdDMoXG5cdHZlYzMoIDEuNjYwNSwgLSAwLjEyNDYsIC0gMC4wMTgyICksXG5cdHZlYzMoIC0gMC41ODc2LCAxLjEzMjksIC0gMC4xMDA2ICksXG5cdHZlYzMoIC0gMC4wNzI4LCAtIDAuMDA4MywgMS4xMTg3IClcbik7XG5jb25zdCBtYXQzIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9SRUMyMDIwID0gbWF0Myhcblx0dmVjMyggMC42Mjc0LCAwLjA2OTEsIDAuMDE2NCApLFxuXHR2ZWMzKCAwLjMyOTMsIDAuOTE5NSwgMC4wODgwICksXG5cdHZlYzMoIDAuMDQzMywgMC4wMTEzLCAwLjg5NTYgKVxuKTtcbnZlYzMgYWd4RGVmYXVsdENvbnRyYXN0QXBwcm94KCB2ZWMzIHggKSB7XG5cdHZlYzMgeDIgPSB4ICogeDtcblx0dmVjMyB4NCA9IHgyICogeDI7XG5cdHJldHVybiArIDE1LjUgKiB4NCAqIHgyXG5cdFx0LSA0MC4xNCAqIHg0ICogeFxuXHRcdCsgMzEuOTYgKiB4NFxuXHRcdC0gNi44NjggKiB4MiAqIHhcblx0XHQrIDAuNDI5OCAqIHgyXG5cdFx0KyAwLjExOTEgKiB4XG5cdFx0LSAwLjAwMjMyO1xufVxudmVjMyBBZ1hUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgbWF0MyBBZ1hJbnNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMC44NTY2MjcxNTMzMTU5ODMsIDAuMTM3MzE4OTcyOTI5ODQ3LCAwLjExMTg5ODIxMjk5OTk1ICksXG5cdFx0dmVjMyggMC4wOTUxMjEyNDA1MzgxNTg4LCAwLjc2MTI0MTk5MDYwMjU5MSwgMC4wNzY3OTk0MTg2MDMxOTAzICksXG5cdFx0dmVjMyggMC4wNDgyNTE2MDYxNDU4NTgzLCAwLjEwMTQzOTAzNjQ2NzU2MiwgMC44MTEzMDIzNjgzOTY4NTkgKVxuXHQpO1xuXHRjb25zdCBtYXQzIEFnWE91dHNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMS4xMjcxMDA1ODE4MTQ0MzY4LCAtIDAuMTQxMzI5NzYzNDk4NDM4MywgLSAwLjE0MTMyOTc2MzQ5ODQzODI2ICksXG5cdFx0dmVjMyggLSAwLjExMDYwNjY0MzA5NjYwMzIzLCAxLjE1NzgyMzcwMjIxNjI3MiwgLSAwLjExMDYwNjY0MzA5NjYwMjk0ICksXG5cdFx0dmVjMyggLSAwLjAxNjQ5MzkzODcxNzgzNDU3MywgLSAwLjAxNjQ5MzkzODcxNzgzNDI1NywgMS4yNTE5MzY0MDY1OTUwNDA1IClcblx0KTtcblx0Y29uc3QgZmxvYXQgQWd4TWluRXYgPSAtIDEyLjQ3MzkzO1x0Y29uc3QgZmxvYXQgQWd4TWF4RXYgPSA0LjAyNjA2OTtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0Y29sb3IgPSBMSU5FQVJfU1JHQl9UT19MSU5FQVJfUkVDMjAyMCAqIGNvbG9yO1xuXHRjb2xvciA9IEFnWEluc2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gbWF4KCBjb2xvciwgMWUtMTAgKTtcdGNvbG9yID0gbG9nMiggY29sb3IgKTtcblx0Y29sb3IgPSAoIGNvbG9yIC0gQWd4TWluRXYgKSAvICggQWd4TWF4RXYgLSBBZ3hNaW5FdiApO1xuXHRjb2xvciA9IGNsYW1wKCBjb2xvciwgMC4wLCAxLjAgKTtcblx0Y29sb3IgPSBhZ3hEZWZhdWx0Q29udHJhc3RBcHByb3goIGNvbG9yICk7XG5cdGNvbG9yID0gQWdYT3V0c2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gcG93KCBtYXgoIHZlYzMoIDAuMCApLCBjb2xvciApLCB2ZWMzKCAyLjIgKSApO1xuXHRjb2xvciA9IExJTkVBUl9SRUMyMDIwX1RPX0xJTkVBUl9TUkdCICogY29sb3I7XG5cdGNvbG9yID0gY2xhbXAoIGNvbG9yLCAwLjAsIDEuMCApO1xuXHRyZXR1cm4gY29sb3I7XG59XG52ZWMzIE5ldXRyYWxUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgZmxvYXQgU3RhcnRDb21wcmVzc2lvbiA9IDAuOCAtIDAuMDQ7XG5cdGNvbnN0IGZsb2F0IERlc2F0dXJhdGlvbiA9IDAuMTU7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGZsb2F0IHggPSBtaW4oIGNvbG9yLnIsIG1pbiggY29sb3IuZywgY29sb3IuYiApICk7XG5cdGZsb2F0IG9mZnNldCA9IHggPCAwLjA4ID8geCAtIDYuMjUgKiB4ICogeCA6IDAuMDQ7XG5cdGNvbG9yIC09IG9mZnNldDtcblx0ZmxvYXQgcGVhayA9IG1heCggY29sb3IuciwgbWF4KCBjb2xvci5nLCBjb2xvci5iICkgKTtcblx0aWYgKCBwZWFrIDwgU3RhcnRDb21wcmVzc2lvbiApIHJldHVybiBjb2xvcjtcblx0ZmxvYXQgZCA9IDEuIC0gU3RhcnRDb21wcmVzc2lvbjtcblx0ZmxvYXQgbmV3UGVhayA9IDEuIC0gZCAqIGQgLyAoIHBlYWsgKyBkIC0gU3RhcnRDb21wcmVzc2lvbiApO1xuXHRjb2xvciAqPSBuZXdQZWFrIC8gcGVhaztcblx0ZmxvYXQgZyA9IDEuIC0gMS4gLyAoIERlc2F0dXJhdGlvbiAqICggcGVhayAtIG5ld1BlYWsgKSArIDEuICk7XG5cdHJldHVybiBtaXgoIGNvbG9yLCB2ZWMzKCBuZXdQZWFrICksIGcgKTtcbn1cbnZlYzMgQ3VzdG9tVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7IHJldHVybiBjb2xvcjsgfSI7CgoJdmFyIHRyYW5zbWlzc2lvbl9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRtYXRlcmlhbC50cmFuc21pc3Npb24gPSB0cmFuc21pc3Npb247XG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhID0gMS4wO1xuXHRtYXRlcmlhbC50aGlja25lc3MgPSB0aGlja25lc3M7XG5cdG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2UgPSBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHRtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yID0gYXR0ZW51YXRpb25Db2xvcjtcblx0I2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0XHRtYXRlcmlhbC50cmFuc21pc3Npb24gKj0gdGV4dHVyZTJEKCB0cmFuc21pc3Npb25NYXAsIHZUcmFuc21pc3Npb25NYXBVdiApLnI7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHRcdG1hdGVyaWFsLnRoaWNrbmVzcyAqPSB0ZXh0dXJlMkQoIHRoaWNrbmVzc01hcCwgdlRoaWNrbmVzc01hcFV2ICkuZztcblx0I2VuZGlmXG5cdHZlYzMgcG9zID0gdldvcmxkUG9zaXRpb247XG5cdHZlYzMgdiA9IG5vcm1hbGl6ZSggY2FtZXJhUG9zaXRpb24gLSBwb3MgKTtcblx0dmVjMyBuID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzQgdHJhbnNtaXR0ZWQgPSBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKFxuXHRcdG4sIHYsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuZGlmZnVzZUNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCxcblx0XHRwb3MsIG1vZGVsTWF0cml4LCB2aWV3TWF0cml4LCBwcm9qZWN0aW9uTWF0cml4LCBtYXRlcmlhbC5kaXNwZXJzaW9uLCBtYXRlcmlhbC5pb3IsIG1hdGVyaWFsLnRoaWNrbmVzcyxcblx0XHRtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yLCBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlICk7XG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhID0gbWl4KCBtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYSwgdHJhbnNtaXR0ZWQuYSwgbWF0ZXJpYWwudHJhbnNtaXNzaW9uICk7XG5cdHRvdGFsRGlmZnVzZSA9IG1peCggdG90YWxEaWZmdXNlLCB0cmFuc21pdHRlZC5yZ2IsIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiApO1xuI2VuZGlmIjsKCgl2YXIgdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dW5pZm9ybSBmbG9hdCB0cmFuc21pc3Npb247XG5cdHVuaWZvcm0gZmxvYXQgdGhpY2tuZXNzO1xuXHR1bmlmb3JtIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdHVuaWZvcm0gdmVjMyBhdHRlbnVhdGlvbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHRyYW5zbWlzc2lvbk1hcDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgdGhpY2tuZXNzTWFwO1xuXHQjZW5kaWZcblx0dW5pZm9ybSB2ZWMyIHRyYW5zbWlzc2lvblNhbXBsZXJTaXplO1xuXHR1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25TYW1wbGVyTWFwO1xuXHR1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4O1xuXHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdGZsb2F0IHcwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogKCBhICogKCAtIGEgKyAzLjAgKSAtIDMuMCApICsgMS4wICk7XG5cdH1cblx0ZmxvYXQgdzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiAgYSAqICggMy4wICogYSAtIDYuMCApICsgNC4wICk7XG5cdH1cblx0ZmxvYXQgdzIoIGZsb2F0IGEgKXtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqICggYSAqICggLSAzLjAgKiBhICsgMy4wICkgKyAzLjAgKSArIDEuMCApO1xuXHR9XG5cdGZsb2F0IHczKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogYSAqIGEgKTtcblx0fVxuXHRmbG9hdCBnMCggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gdzAoIGEgKSArIHcxKCBhICk7XG5cdH1cblx0ZmxvYXQgZzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIHcyKCBhICkgKyB3MyggYSApO1xuXHR9XG5cdGZsb2F0IGgwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAtIDEuMCArIHcxKCBhICkgLyAoIHcwKCBhICkgKyB3MSggYSApICk7XG5cdH1cblx0ZmxvYXQgaDEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIDEuMCArIHczKCBhICkgLyAoIHcyKCBhICkgKyB3MyggYSApICk7XG5cdH1cblx0dmVjNCBiaWN1YmljKCBzYW1wbGVyMkQgdGV4LCB2ZWMyIHV2LCB2ZWM0IHRleGVsU2l6ZSwgZmxvYXQgbG9kICkge1xuXHRcdHV2ID0gdXYgKiB0ZXhlbFNpemUuencgKyAwLjU7XG5cdFx0dmVjMiBpdXYgPSBmbG9vciggdXYgKTtcblx0XHR2ZWMyIGZ1diA9IGZyYWN0KCB1diApO1xuXHRcdGZsb2F0IGcweCA9IGcwKCBmdXYueCApO1xuXHRcdGZsb2F0IGcxeCA9IGcxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweCA9IGgwKCBmdXYueCApO1xuXHRcdGZsb2F0IGgxeCA9IGgxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweSA9IGgwKCBmdXYueSApO1xuXHRcdGZsb2F0IGgxeSA9IGgxKCBmdXYueSApO1xuXHRcdHZlYzIgcDAgPSAoIHZlYzIoIGl1di54ICsgaDB4LCBpdXYueSArIGgweSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0dmVjMiBwMSA9ICggdmVjMiggaXV2LnggKyBoMXgsIGl1di55ICsgaDB5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHR2ZWMyIHAyID0gKCB2ZWMyKCBpdXYueCArIGgweCwgaXV2LnkgKyBoMXkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHZlYzIgcDMgPSAoIHZlYzIoIGl1di54ICsgaDF4LCBpdXYueSArIGgxeSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0cmV0dXJuIGcwKCBmdXYueSApICogKCBnMHggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAwLCBsb2QgKSArIGcxeCAqIHRleHR1cmVMb2QoIHRleCwgcDEsIGxvZCApICkgK1xuXHRcdFx0ZzEoIGZ1di55ICkgKiAoIGcweCAqIHRleHR1cmVMb2QoIHRleCwgcDIsIGxvZCApICsgZzF4ICogdGV4dHVyZUxvZCggdGV4LCBwMywgbG9kICkgKTtcblx0fVxuXHR2ZWM0IHRleHR1cmVCaWN1YmljKCBzYW1wbGVyMkQgc2FtcGxlciwgdmVjMiB1diwgZmxvYXQgbG9kICkge1xuXHRcdHZlYzIgZkxvZFNpemUgPSB2ZWMyKCB0ZXh0dXJlU2l6ZSggc2FtcGxlciwgaW50KCBsb2QgKSApICk7XG5cdFx0dmVjMiBjTG9kU2l6ZSA9IHZlYzIoIHRleHR1cmVTaXplKCBzYW1wbGVyLCBpbnQoIGxvZCArIDEuMCApICkgKTtcblx0XHR2ZWMyIGZMb2RTaXplSW52ID0gMS4wIC8gZkxvZFNpemU7XG5cdFx0dmVjMiBjTG9kU2l6ZUludiA9IDEuMCAvIGNMb2RTaXplO1xuXHRcdHZlYzQgZlNhbXBsZSA9IGJpY3ViaWMoIHNhbXBsZXIsIHV2LCB2ZWM0KCBmTG9kU2l6ZUludiwgZkxvZFNpemUgKSwgZmxvb3IoIGxvZCApICk7XG5cdFx0dmVjNCBjU2FtcGxlID0gYmljdWJpYyggc2FtcGxlciwgdXYsIHZlYzQoIGNMb2RTaXplSW52LCBjTG9kU2l6ZSApLCBjZWlsKCBsb2QgKSApO1xuXHRcdHJldHVybiBtaXgoIGZTYW1wbGUsIGNTYW1wbGUsIGZyYWN0KCBsb2QgKSApO1xuXHR9XG5cdHZlYzMgZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgdGhpY2tuZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIG1hdDQgbW9kZWxNYXRyaXggKSB7XG5cdFx0dmVjMyByZWZyYWN0aW9uVmVjdG9yID0gcmVmcmFjdCggLSB2LCBub3JtYWxpemUoIG4gKSwgMS4wIC8gaW9yICk7XG5cdFx0dmVjMyBtb2RlbFNjYWxlO1xuXHRcdG1vZGVsU2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueSA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueiA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDIgXS54eXogKSApO1xuXHRcdHJldHVybiBub3JtYWxpemUoIHJlZnJhY3Rpb25WZWN0b3IgKSAqIHRoaWNrbmVzcyAqIG1vZGVsU2NhbGU7XG5cdH1cblx0ZmxvYXQgYXBwbHlJb3JUb1JvdWdobmVzcyggY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IgKSB7XG5cdFx0cmV0dXJuIHJvdWdobmVzcyAqIGNsYW1wKCBpb3IgKiAyLjAgLSAyLjAsIDAuMCwgMS4wICk7XG5cdH1cblx0dmVjNCBnZXRUcmFuc21pc3Npb25TYW1wbGUoIGNvbnN0IGluIHZlYzIgZnJhZ0Nvb3JkLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIGZsb2F0IGlvciApIHtcblx0XHRmbG9hdCBsb2QgPSBsb2cyKCB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZS54ICkgKiBhcHBseUlvclRvUm91Z2huZXNzKCByb3VnaG5lc3MsIGlvciApO1xuXHRcdHJldHVybiB0ZXh0dXJlQmljdWJpYyggdHJhbnNtaXNzaW9uU2FtcGxlck1hcCwgZnJhZ0Nvb3JkLnh5LCBsb2QgKTtcblx0fVxuXHR2ZWMzIHZvbHVtZUF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCB0cmFuc21pc3Npb25EaXN0YW5jZSwgY29uc3QgaW4gdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlICkge1xuXHRcdGlmICggaXNpbmYoIGF0dGVudWF0aW9uRGlzdGFuY2UgKSApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmVjMyBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ID0gLWxvZyggYXR0ZW51YXRpb25Db2xvciApIC8gYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHRcdHZlYzMgdHJhbnNtaXR0YW5jZSA9IGV4cCggLSBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ICogdHJhbnNtaXNzaW9uRGlzdGFuY2UgKTtcdFx0XHRyZXR1cm4gdHJhbnNtaXR0YW5jZTtcblx0XHR9XG5cdH1cblx0dmVjNCBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvcixcblx0XHRjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiB2ZWMzIHBvc2l0aW9uLCBjb25zdCBpbiBtYXQ0IG1vZGVsTWF0cml4LFxuXHRcdGNvbnN0IGluIG1hdDQgdmlld01hdHJpeCwgY29uc3QgaW4gbWF0NCBwcm9qTWF0cml4LCBjb25zdCBpbiBmbG9hdCBkaXNwZXJzaW9uLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIGZsb2F0IHRoaWNrbmVzcyxcblx0XHRjb25zdCBpbiB2ZWMzIGF0dGVudWF0aW9uQ29sb3IsIGNvbnN0IGluIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2UgKSB7XG5cdFx0dmVjNCB0cmFuc21pdHRlZExpZ2h0O1xuXHRcdHZlYzMgdHJhbnNtaXR0YW5jZTtcblx0XHQjaWZkZWYgVVNFX0RJU1BFUlNJT05cblx0XHRcdGZsb2F0IGhhbGZTcHJlYWQgPSAoIGlvciAtIDEuMCApICogMC4wMjUgKiBkaXNwZXJzaW9uO1xuXHRcdFx0dmVjMyBpb3JzID0gdmVjMyggaW9yIC0gaGFsZlNwcmVhZCwgaW9yLCBpb3IgKyBoYWxmU3ByZWFkICk7XG5cdFx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCAzOyBpICsrICkge1xuXHRcdFx0XHR2ZWMzIHRyYW5zbWlzc2lvblJheSA9IGdldFZvbHVtZVRyYW5zbWlzc2lvblJheSggbiwgdiwgdGhpY2tuZXNzLCBpb3JzWyBpIF0sIG1vZGVsTWF0cml4ICk7XG5cdFx0XHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdFx0XHR2ZWM0IG5kY1BvcyA9IHByb2pNYXRyaXggKiB2aWV3TWF0cml4ICogdmVjNCggcmVmcmFjdGVkUmF5RXhpdCwgMS4wICk7XG5cdFx0XHRcdHZlYzIgcmVmcmFjdGlvbkNvb3JkcyA9IG5kY1Bvcy54eSAvIG5kY1Bvcy53O1xuXHRcdFx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRcdFx0cmVmcmFjdGlvbkNvb3JkcyAvPSAyLjA7XG5cdFx0XHRcdHZlYzQgdHJhbnNtaXNzaW9uU2FtcGxlID0gZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKCByZWZyYWN0aW9uQ29vcmRzLCByb3VnaG5lc3MsIGlvcnNbIGkgXSApO1xuXHRcdFx0XHR0cmFuc21pdHRlZExpZ2h0WyBpIF0gPSB0cmFuc21pc3Npb25TYW1wbGVbIGkgXTtcblx0XHRcdFx0dHJhbnNtaXR0ZWRMaWdodC5hICs9IHRyYW5zbWlzc2lvblNhbXBsZS5hO1xuXHRcdFx0XHR0cmFuc21pdHRhbmNlWyBpIF0gPSBkaWZmdXNlQ29sb3JbIGkgXSAqIHZvbHVtZUF0dGVudWF0aW9uKCBsZW5ndGgoIHRyYW5zbWlzc2lvblJheSApLCBhdHRlbnVhdGlvbkNvbG9yLCBhdHRlbnVhdGlvbkRpc3RhbmNlIClbIGkgXTtcblx0XHRcdH1cblx0XHRcdHRyYW5zbWl0dGVkTGlnaHQuYSAvPSAzLjA7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgdHJhbnNtaXNzaW9uUmF5ID0gZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBuLCB2LCB0aGlja25lc3MsIGlvciwgbW9kZWxNYXRyaXggKTtcblx0XHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdFx0dmVjNCBuZGNQb3MgPSBwcm9qTWF0cml4ICogdmlld01hdHJpeCAqIHZlYzQoIHJlZnJhY3RlZFJheUV4aXQsIDEuMCApO1xuXHRcdFx0dmVjMiByZWZyYWN0aW9uQ29vcmRzID0gbmRjUG9zLnh5IC8gbmRjUG9zLnc7XG5cdFx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRcdHJlZnJhY3Rpb25Db29yZHMgLz0gMi4wO1xuXHRcdFx0dHJhbnNtaXR0ZWRMaWdodCA9IGdldFRyYW5zbWlzc2lvblNhbXBsZSggcmVmcmFjdGlvbkNvb3Jkcywgcm91Z2huZXNzLCBpb3IgKTtcblx0XHRcdHRyYW5zbWl0dGFuY2UgPSBkaWZmdXNlQ29sb3IgKiB2b2x1bWVBdHRlbnVhdGlvbiggbGVuZ3RoKCB0cmFuc21pc3Npb25SYXkgKSwgYXR0ZW51YXRpb25Db2xvciwgYXR0ZW51YXRpb25EaXN0YW5jZSApO1xuXHRcdCNlbmRpZlxuXHRcdHZlYzMgYXR0ZW51YXRlZENvbG9yID0gdHJhbnNtaXR0YW5jZSAqIHRyYW5zbWl0dGVkTGlnaHQucmdiO1xuXHRcdHZlYzMgRiA9IEVudmlyb25tZW50QlJERiggbiwgdiwgc3BlY3VsYXJDb2xvciwgc3BlY3VsYXJGOTAsIHJvdWdobmVzcyApO1xuXHRcdGZsb2F0IHRyYW5zbWl0dGFuY2VGYWN0b3IgPSAoIHRyYW5zbWl0dGFuY2UuciArIHRyYW5zbWl0dGFuY2UuZyArIHRyYW5zbWl0dGFuY2UuYiApIC8gMy4wO1xuXHRcdHJldHVybiB2ZWM0KCAoIDEuMCAtIEYgKSAqIGF0dGVudWF0ZWRDb2xvciwgMS4wIC0gKCAxLjAgLSB0cmFuc21pdHRlZExpZ2h0LmEgKSAqIHRyYW5zbWl0dGFuY2VGYWN0b3IgKTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgdXZfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkxpZ2h0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dmFyeWluZyB2ZWMyIHZBb01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dmFyeWluZyB2ZWMyIHZCdW1wTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHZhcnlpbmcgdmVjMiB2Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dmFyeWluZyB2ZWMyIHZFbWlzc2l2ZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1ldGFsbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdlJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dmFyeWluZyB2ZWMyIHZBbmlzb3Ryb3B5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZTaGVlblJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhckludGVuc2l0eU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHR1bmlmb3JtIG1hdDMgdHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRyYW5zbWlzc2lvbk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgdGhpY2tuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRoaWNrbmVzc01hcFV2O1xuI2VuZGlmIjsKCgl2YXIgdXZfcGFyc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBtYXQzIG1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIG1hdDMgYWxwaGFNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIG1hdDMgbGlnaHRNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2TGlnaHRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIG1hdDMgYW9NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QW9NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHVuaWZvcm0gbWF0MyBidW1wTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkJ1bXBNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBtYXQzIG5vcm1hbE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZOb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBtYXQzIGRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZEaXNwbGFjZW1lbnRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR1bmlmb3JtIG1hdDMgZW1pc3NpdmVNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2RW1pc3NpdmVNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIG1ldGFsbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNZXRhbG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHJvdWdobmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdHVuaWZvcm0gbWF0MyBhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkFuaXNvdHJvcHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBtYXQzIGNsZWFyY29hdE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHVuaWZvcm0gbWF0MyBjbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzaGVlbkNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuUm91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBtYXQzIGlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhck1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdHVuaWZvcm0gbWF0MyB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VHJhbnNtaXNzaW9uTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyB0aGlja25lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VGhpY2tuZXNzTWFwVXY7XG4jZW5kaWYiOwoKCXZhciB1dl92ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dlV2ID0gdmVjMyggdXYsIDEgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dk1hcFV2ID0gKCBtYXBUcmFuc2Zvcm0gKiB2ZWMzKCBNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZBbHBoYU1hcFV2ID0gKCBhbHBoYU1hcFRyYW5zZm9ybSAqIHZlYzMoIEFMUEhBTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2TGlnaHRNYXBVdiA9ICggbGlnaHRNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBMSUdIVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dkFvTWFwVXYgPSAoIGFvTWFwVHJhbnNmb3JtICogdmVjMyggQU9NQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dkJ1bXBNYXBVdiA9ICggYnVtcE1hcFRyYW5zZm9ybSAqIHZlYzMoIEJVTVBNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR2Tm9ybWFsTWFwVXYgPSAoIG5vcm1hbE1hcFRyYW5zZm9ybSAqIHZlYzMoIE5PUk1BTE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHZEaXNwbGFjZW1lbnRNYXBVdiA9ICggZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtICogdmVjMyggRElTUExBQ0VNRU5UTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR2RW1pc3NpdmVNYXBVdiA9ICggZW1pc3NpdmVNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBFTUlTU0lWRU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHZNZXRhbG5lc3NNYXBVdiA9ICggbWV0YWxuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggTUVUQUxORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dlJvdWdobmVzc01hcFV2ID0gKCByb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dkFuaXNvdHJvcHlNYXBVdiA9ICggYW5pc290cm9weU1hcFRyYW5zZm9ybSAqIHZlYzMoIEFOSVNPVFJPUFlNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR2Q2xlYXJjb2F0TWFwVXYgPSAoIGNsZWFyY29hdE1hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgPSAoIGNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVF9OT1JNQUxNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dkNsZWFyY29hdFJvdWdobmVzc01hcFV2ID0gKCBjbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBDTEVBUkNPQVRfUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2SXJpZGVzY2VuY2VNYXBVdiA9ICggaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBJUklERVNDRU5DRU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ID0gKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIElSSURFU0NFTkNFX1RISUNLTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0dlNoZWVuQ29sb3JNYXBVdiA9ICggc2hlZW5Db2xvck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNIRUVOX0NPTE9STUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dlNoZWVuUm91Z2huZXNzTWFwVXYgPSAoIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtICogdmVjMyggU0hFRU5fUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR2U3BlY3VsYXJNYXBVdiA9ICggc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTUEVDVUxBUk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0dlNwZWN1bGFyQ29sb3JNYXBVdiA9ICggc3BlY3VsYXJDb2xvck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNQRUNVTEFSX0NPTE9STUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dlNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPSAoIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtICogdmVjMyggU1BFQ1VMQVJfSU5URU5TSVRZTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0dlRyYW5zbWlzc2lvbk1hcFV2ID0gKCB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm0gKiB2ZWMzKCBUUkFOU01JU1NJT05NQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR2VGhpY2tuZXNzTWFwVXYgPSAoIHRoaWNrbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIFRISUNLTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWYiOwoKCXZhciB3b3JsZHBvc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSB8fCBkZWZpbmVkKCBESVNUQU5DRSApIHx8IGRlZmluZWQgKCBVU0VfU0hBRE9XTUFQICkgfHwgZGVmaW5lZCAoIFVTRV9UUkFOU01JU1NJT04gKSB8fCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZlYzQgd29ybGRQb3NpdGlvbiA9IHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcblx0I2lmZGVmIFVTRV9CQVRDSElOR1xuXHRcdHdvcmxkUG9zaXRpb24gPSBiYXRjaGluZ01hdHJpeCAqIHdvcmxkUG9zaXRpb247XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lOU1RBTkNJTkdcblx0XHR3b3JsZFBvc2l0aW9uID0gaW5zdGFuY2VNYXRyaXggKiB3b3JsZFBvc2l0aW9uO1xuXHQjZW5kaWZcblx0d29ybGRQb3NpdGlvbiA9IG1vZGVsTWF0cml4ICogd29ybGRQb3NpdGlvbjtcbiNlbmRpZiI7CgoJY29uc3QgdmVydGV4JGggPSAidmFyeWluZyB2ZWMyIHZVdjtcbnVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbnZvaWQgbWFpbigpIHtcblx0dlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbi54eSwgMS4wLCAxLjAgKTtcbn0iOwoKCWNvbnN0IGZyYWdtZW50JGggPSAidW5pZm9ybSBzYW1wbGVyMkQgdDJEO1xudW5pZm9ybSBmbG9hdCBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xudmFyeWluZyB2ZWMyIHZVdjtcbnZvaWQgbWFpbigpIHtcblx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmUyRCggdDJELCB2VXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0dGV4Q29sb3IgPSB2ZWM0KCBtaXgoIHBvdyggdGV4Q29sb3IucmdiICogMC45NDc4NjcyOTg2ICsgdmVjMyggMC4wNTIxMzI3MDE0ICksIHZlYzMoIDIuNCApICksIHRleENvbG9yLnJnYiAqIDAuMDc3Mzk5MzgwOCwgdmVjMyggbGVzc1RoYW5FcXVhbCggdGV4Q29sb3IucmdiLCB2ZWMzKCAwLjA0MDQ1ICkgKSApICksIHRleENvbG9yLncgKTtcblx0I2VuZGlmXG5cdHRleENvbG9yLnJnYiAqPSBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXhDb2xvcjtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCRnID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1Bvc2l0aW9uLnogPSBnbF9Qb3NpdGlvbi53O1xufSI7CgoJY29uc3QgZnJhZ21lbnQkZyA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcbiNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcbnVuaWZvcm0gZmxvYXQgYmFja2dyb3VuZEJsdXJyaW5lc3M7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG51bmlmb3JtIG1hdDMgYmFja2dyb3VuZFJvdGF0aW9uO1xudmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIGJhY2tncm91bmRSb3RhdGlvbiAqIHZlYzMoIGZsaXBFbnZNYXAgKiB2V29ybGREaXJlY3Rpb24ueCwgdldvcmxkRGlyZWN0aW9uLnl6ICkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX1RZUEVfQ1VCRV9VViApXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgYmFja2dyb3VuZFJvdGF0aW9uICogdldvcmxkRGlyZWN0aW9uLCBiYWNrZ3JvdW5kQmx1cnJpbmVzcyApO1xuXHQjZWxzZVxuXHRcdHZlYzQgdGV4Q29sb3IgPSB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTtcblx0I2VuZGlmXG5cdHRleENvbG9yLnJnYiAqPSBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXhDb2xvcjtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCRmID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1Bvc2l0aW9uLnogPSBnbF9Qb3NpdGlvbi53O1xufSI7CgoJY29uc3QgZnJhZ21lbnQkZiA9ICJ1bmlmb3JtIHNhbXBsZXJDdWJlIHRDdWJlO1xudW5pZm9ybSBmbG9hdCB0RmxpcDtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlQ3ViZSggdEN1YmUsIHZlYzMoIHRGbGlwICogdldvcmxkRGlyZWN0aW9uLngsIHZXb3JsZERpcmVjdGlvbi55eiApICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHRnbF9GcmFnQ29sb3IuYSAqPSBvcGFjaXR5O1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JGUgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4PlxudmFyeWluZyB2ZWMyIHZIaWdoUHJlY2lzaW9uWlc7XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZIaWdoUHJlY2lzaW9uWlcgPSBnbF9Qb3NpdGlvbi56dztcbn0iOwoKCWNvbnN0IGZyYWdtZW50JGUgPSAiI2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHR1bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZhcnlpbmcgdmVjMiB2SGlnaFByZWNpc2lvblpXO1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdFx0ZGlmZnVzZUNvbG9yLmEgPSBvcGFjaXR5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdGZsb2F0IGZyYWdDb29yZFogPSAwLjUgKiB2SGlnaFByZWNpc2lvblpXWzBdIC8gdkhpZ2hQcmVjaXNpb25aV1sxXSArIDAuNTtcblx0I2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHZlYzMoIDEuMCAtIGZyYWdDb29yZFogKSwgb3BhY2l0eSApO1xuXHQjZWxpZiBERVBUSF9QQUNLSU5HID09IDMyMDFcblx0XHRnbF9GcmFnQ29sb3IgPSBwYWNrRGVwdGhUb1JHQkEoIGZyYWdDb29yZFogKTtcblx0I2VsaWYgREVQVEhfUEFDS0lORyA9PSAzMjAyXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja0RlcHRoVG9SR0IoIGZyYWdDb29yZFogKSwgMS4wICk7XG5cdCNlbGlmIERFUFRIX1BBQ0tJTkcgPT0gMzIwM1xuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tEZXB0aFRvUkcoIGZyYWdDb29yZFogKSwgMC4wLCAxLjAgKTtcblx0I2VuZGlmXG59IjsKCgljb25zdCB2ZXJ0ZXgkZCA9ICIjZGVmaW5lIERJU1RBTkNFXG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG59IjsKCgljb25zdCBmcmFnbWVudCRkID0gIiNkZWZpbmUgRElTVEFOQ0VcbnVuaWZvcm0gdmVjMyByZWZlcmVuY2VQb3NpdGlvbjtcbnVuaWZvcm0gZmxvYXQgbmVhckRpc3RhbmNlO1xudW5pZm9ybSBmbG9hdCBmYXJEaXN0YW5jZTtcbnZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4gKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdGZsb2F0IGRpc3QgPSBsZW5ndGgoIHZXb3JsZFBvc2l0aW9uIC0gcmVmZXJlbmNlUG9zaXRpb24gKTtcblx0ZGlzdCA9ICggZGlzdCAtIG5lYXJEaXN0YW5jZSApIC8gKCBmYXJEaXN0YW5jZSAtIG5lYXJEaXN0YW5jZSApO1xuXHRkaXN0ID0gc2F0dXJhdGUoIGRpc3QgKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFja0RlcHRoVG9SR0JBKCBkaXN0ICk7XG59IjsKCgljb25zdCB2ZXJ0ZXgkYyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkYyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0RXF1aXJlY3Q7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dmVjMyBkaXJlY3Rpb24gPSBub3JtYWxpemUoIHZXb3JsZERpcmVjdGlvbiApO1xuXHR2ZWMyIHNhbXBsZVVWID0gZXF1aXJlY3RVdiggZGlyZWN0aW9uICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCggdEVxdWlyZWN0LCBzYW1wbGVVViApO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JGIgPSAidW5pZm9ybSBmbG9hdCBzY2FsZTtcbmF0dHJpYnV0ZSBmbG9hdCBsaW5lRGlzdGFuY2U7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdHZMaW5lRGlzdGFuY2UgPSBzY2FsZSAqIGxpbmVEaXN0YW5jZTtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkYiA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gZmxvYXQgZGFzaFNpemU7XG51bmlmb3JtIGZsb2F0IHRvdGFsU2l6ZTtcbnZhcnlpbmcgZmxvYXQgdkxpbmVEaXN0YW5jZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSwgdG90YWxTaXplICkgPiBkYXNoU2l6ZSApIHtcblx0XHRkaXNjYXJkO1xuXHR9XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JGEgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpZiBkZWZpbmVkICggVVNFX0VOVk1BUCApIHx8IGRlZmluZWQgKCBVU0VfU0tJTk5JTkcgKVxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgljb25zdCBmcmFnbWVudCRhID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHkgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjZWxzZVxuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSB2ZWMzKCAxLjAgKTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkOSA9ICIjZGVmaW5lIExBTUJFUlRcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkOSA9ICIjZGVmaW5lIExBTUJFUlRcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCA9IFJlZmxlY3RlZExpZ2h0KCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSApO1xuXHR2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8c3BlY3VsYXJtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkOCA9ICIjZGVmaW5lIE1BVENBUFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbn0iOwoKCWNvbnN0IGZyYWdtZW50JDggPSAiI2RlZmluZSBNQVRDQVBcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xudW5pZm9ybSBzYW1wbGVyMkQgbWF0Y2FwO1xudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHR2ZWMzIHZpZXdEaXIgPSBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTtcblx0dmVjMyB4ID0gbm9ybWFsaXplKCB2ZWMzKCB2aWV3RGlyLnosIDAuMCwgLSB2aWV3RGlyLnggKSApO1xuXHR2ZWMzIHkgPSBjcm9zcyggdmlld0RpciwgeCApO1xuXHR2ZWMyIHV2ID0gdmVjMiggZG90KCB4LCBub3JtYWwgKSwgZG90KCB5LCBub3JtYWwgKSApICogMC40OTUgKyAwLjU7XG5cdCNpZmRlZiBVU0VfTUFUQ0FQXG5cdFx0dmVjNCBtYXRjYXBDb2xvciA9IHRleHR1cmUyRCggbWF0Y2FwLCB1diApO1xuXHQjZWxzZVxuXHRcdHZlYzQgbWF0Y2FwQ29sb3IgPSB2ZWM0KCB2ZWMzKCBtaXgoIDAuMiwgMC44LCB1di55ICkgKSwgMS4wICk7XG5cdCNlbmRpZlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiICogbWF0Y2FwQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCQ3ID0gIiNkZWZpbmUgTk9STUFMXG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKVxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbiNlbmRpZlxufSI7CgoJY29uc3QgZnJhZ21lbnQkNyA9ICIjZGVmaW5lIE5PUk1BTFxudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApXG5cdHZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tOb3JtYWxUb1JHQiggbm9ybWFsICksIGRpZmZ1c2VDb2xvci5hICk7XG5cdCNpZmRlZiBPUEFRVUVcblx0XHRnbF9GcmFnQ29sb3IuYSA9IDEuMDtcblx0I2VuZGlmXG59IjsKCgljb25zdCB2ZXJ0ZXgkNiA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGVudm1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKCWNvbnN0IGZyYWdtZW50JDYgPSAiI2RlZmluZSBQSE9OR1xudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIHZlYzMgc3BlY3VsYXI7XG51bmlmb3JtIGZsb2F0IHNoaW5pbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkNSA9ICIjZGVmaW5lIFNUQU5EQVJEXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKCWNvbnN0IGZyYWdtZW50JDUgPSAiI2RlZmluZSBTVEFOREFSRFxuI2lmZGVmIFBIWVNJQ0FMXG5cdCNkZWZpbmUgSU9SXG5cdCNkZWZpbmUgVVNFX1NQRUNVTEFSXG4jZW5kaWZcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCByb3VnaG5lc3M7XG51bmlmb3JtIGZsb2F0IG1ldGFsbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpZmRlZiBJT1Jcblx0dW5pZm9ybSBmbG9hdCBpb3I7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0dW5pZm9ybSBmbG9hdCBzcGVjdWxhckludGVuc2l0eTtcblx0dW5pZm9ybSB2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhckNvbG9yTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhckludGVuc2l0eU1hcDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHVuaWZvcm0gZmxvYXQgY2xlYXJjb2F0O1xuXHR1bmlmb3JtIGZsb2F0IGNsZWFyY29hdFJvdWdobmVzcztcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQRVJTSU9OXG5cdHVuaWZvcm0gZmxvYXQgZGlzcGVyc2lvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlSU9SO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bTtcblx0dW5pZm9ybSBmbG9hdCBpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5cblx0dW5pZm9ybSB2ZWMzIHNoZWVuQ29sb3I7XG5cdHVuaWZvcm0gZmxvYXQgc2hlZW5Sb3VnaG5lc3M7XG5cdCNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzaGVlbkNvbG9yTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzaGVlblJvdWdobmVzc01hcDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHR1bmlmb3JtIHZlYzIgYW5pc290cm9weVZlY3Rvcjtcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgYW5pc290cm9weU1hcDtcblx0I2VuZGlmXG4jZW5kaWZcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGlyaWRlc2NlbmNlX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsZWFyY29hdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGlyaWRlc2NlbmNlX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8cm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIHRvdGFsRGlmZnVzZSA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgdG90YWxTcGVjdWxhciA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhcjtcblx0I2luY2x1ZGUgPHRyYW5zbWlzc2lvbl9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdG90YWxEaWZmdXNlICsgdG90YWxTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdGZsb2F0IHNoZWVuRW5lcmd5Q29tcCA9IDEuMCAtIDAuMTU3ICogbWF4MyggbWF0ZXJpYWwuc2hlZW5Db2xvciApO1xuXHRcdG91dGdvaW5nTGlnaHQgPSBvdXRnb2luZ0xpZ2h0ICogc2hlZW5FbmVyZ3lDb21wICsgc2hlZW5TcGVjdWxhckRpcmVjdCArIHNoZWVuU3BlY3VsYXJJbmRpcmVjdDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgZG90TlZjYyA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRcdHZlYzMgRmNjID0gRl9TY2hsaWNrKCBtYXRlcmlhbC5jbGVhcmNvYXRGMCwgbWF0ZXJpYWwuY2xlYXJjb2F0RjkwLCBkb3ROVmNjICk7XG5cdFx0b3V0Z29pbmdMaWdodCA9IG91dGdvaW5nTGlnaHQgKiAoIDEuMCAtIG1hdGVyaWFsLmNsZWFyY29hdCAqIEZjYyApICsgKCBjbGVhcmNvYXRTcGVjdWxhckRpcmVjdCArIGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKSAqIG1hdGVyaWFsLmNsZWFyY29hdDtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JDQgPSAiI2RlZmluZSBUT09OXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgljb25zdCBmcmFnbWVudCQ0ID0gIiNkZWZpbmUgVE9PTlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Z3JhZGllbnRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfdG9vbl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCQzID0gInVuaWZvcm0gZmxvYXQgc2l6ZTtcbnVuaWZvcm0gZmxvYXQgc2NhbGU7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG4jaWZkZWYgVVNFX1BPSU5UU19VVlxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuXHR1bmlmb3JtIG1hdDMgdXZUcmFuc2Zvcm07XG4jZW5kaWZcbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIFVTRV9QT0lOVFNfVVZcblx0XHR2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0Z2xfUG9pbnRTaXplID0gc2l6ZTtcblx0I2lmZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgZ2xfUG9pbnRTaXplICo9ICggc2NhbGUgLyAtIG12UG9zaXRpb24ueiApO1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkMyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9wYXJ0aWNsZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkMiA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkMiA9ICJ1bmlmb3JtIHZlYzMgY29sb3I7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggY29sb3IsIG9wYWNpdHkgKiAoIDEuMCAtIGdldFNoYWRvd01hc2soKSApICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkMSA9ICJ1bmlmb3JtIGZsb2F0IHJvdGF0aW9uO1xudW5pZm9ybSB2ZWMyIGNlbnRlcjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0dmVjNCBtdlBvc2l0aW9uID0gbW9kZWxWaWV3TWF0cml4WyAzIF07XG5cdHZlYzIgc2NhbGUgPSB2ZWMyKCBsZW5ndGgoIG1vZGVsTWF0cml4WyAwIF0ueHl6ICksIGxlbmd0aCggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHQjaWZuZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgc2NhbGUgKj0gLSBtdlBvc2l0aW9uLno7XG5cdCNlbmRpZlxuXHR2ZWMyIGFsaWduZWRQb3NpdGlvbiA9ICggcG9zaXRpb24ueHkgLSAoIGNlbnRlciAtIHZlYzIoIDAuNSApICkgKSAqIHNjYWxlO1xuXHR2ZWMyIHJvdGF0ZWRQb3NpdGlvbjtcblx0cm90YXRlZFBvc2l0aW9uLnggPSBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueCAtIHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi55O1xuXHRyb3RhdGVkUG9zaXRpb24ueSA9IHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54ICsgY29zKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdG12UG9zaXRpb24ueHkgKz0gcm90YXRlZFBvc2l0aW9uO1xuXHRnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgljb25zdCBmcmFnbWVudCQxID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCgljb25zdCBTaGFkZXJDaHVuayA9IHsKCQlhbHBoYWhhc2hfZnJhZ21lbnQ6IGFscGhhaGFzaF9mcmFnbWVudCwKCQlhbHBoYWhhc2hfcGFyc19mcmFnbWVudDogYWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQsCgkJYWxwaGFtYXBfZnJhZ21lbnQ6IGFscGhhbWFwX2ZyYWdtZW50LAoJCWFscGhhbWFwX3BhcnNfZnJhZ21lbnQ6IGFscGhhbWFwX3BhcnNfZnJhZ21lbnQsCgkJYWxwaGF0ZXN0X2ZyYWdtZW50OiBhbHBoYXRlc3RfZnJhZ21lbnQsCgkJYWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ6IGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50LAoJCWFvbWFwX2ZyYWdtZW50OiBhb21hcF9mcmFnbWVudCwKCQlhb21hcF9wYXJzX2ZyYWdtZW50OiBhb21hcF9wYXJzX2ZyYWdtZW50LAoJCWJhdGNoaW5nX3BhcnNfdmVydGV4OiBiYXRjaGluZ19wYXJzX3ZlcnRleCwKCQliYXRjaGluZ192ZXJ0ZXg6IGJhdGNoaW5nX3ZlcnRleCwKCQliZWdpbl92ZXJ0ZXg6IGJlZ2luX3ZlcnRleCwKCQliZWdpbm5vcm1hbF92ZXJ0ZXg6IGJlZ2lubm9ybWFsX3ZlcnRleCwKCQlic2RmczogYnNkZnMsCgkJaXJpZGVzY2VuY2VfZnJhZ21lbnQ6IGlyaWRlc2NlbmNlX2ZyYWdtZW50LAoJCWJ1bXBtYXBfcGFyc19mcmFnbWVudDogYnVtcG1hcF9wYXJzX2ZyYWdtZW50LAoJCWNsaXBwaW5nX3BsYW5lc19mcmFnbWVudDogY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50LAoJCWNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCwKCQljbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCwKCQljbGlwcGluZ19wbGFuZXNfdmVydGV4OiBjbGlwcGluZ19wbGFuZXNfdmVydGV4LAoJCWNvbG9yX2ZyYWdtZW50OiBjb2xvcl9mcmFnbWVudCwKCQljb2xvcl9wYXJzX2ZyYWdtZW50OiBjb2xvcl9wYXJzX2ZyYWdtZW50LAoJCWNvbG9yX3BhcnNfdmVydGV4OiBjb2xvcl9wYXJzX3ZlcnRleCwKCQljb2xvcl92ZXJ0ZXg6IGNvbG9yX3ZlcnRleCwKCQljb21tb246IGNvbW1vbiwKCQljdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ6IGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCwKCQlkZWZhdWx0bm9ybWFsX3ZlcnRleDogZGVmYXVsdG5vcm1hbF92ZXJ0ZXgsCgkJZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXgsCgkJZGlzcGxhY2VtZW50bWFwX3ZlcnRleDogZGlzcGxhY2VtZW50bWFwX3ZlcnRleCwKCQllbWlzc2l2ZW1hcF9mcmFnbWVudDogZW1pc3NpdmVtYXBfZnJhZ21lbnQsCgkJZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudDogZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudCwKCQljb2xvcnNwYWNlX2ZyYWdtZW50OiBjb2xvcnNwYWNlX2ZyYWdtZW50LAoJCWNvbG9yc3BhY2VfcGFyc19mcmFnbWVudDogY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50LAoJCWVudm1hcF9mcmFnbWVudDogZW52bWFwX2ZyYWdtZW50LAoJCWVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudDogZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50LAoJCWVudm1hcF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGFyc19mcmFnbWVudCwKCQllbnZtYXBfcGFyc192ZXJ0ZXg6IGVudm1hcF9wYXJzX3ZlcnRleCwKCQllbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCgkJZW52bWFwX3ZlcnRleDogZW52bWFwX3ZlcnRleCwKCQlmb2dfdmVydGV4OiBmb2dfdmVydGV4LAoJCWZvZ19wYXJzX3ZlcnRleDogZm9nX3BhcnNfdmVydGV4LAoJCWZvZ19mcmFnbWVudDogZm9nX2ZyYWdtZW50LAoJCWZvZ19wYXJzX2ZyYWdtZW50OiBmb2dfcGFyc19mcmFnbWVudCwKCQlncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50OiBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50LAoJCWxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50LAoJCWxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX3BhcnNfYmVnaW46IGxpZ2h0c19wYXJzX2JlZ2luLAoJCWxpZ2h0c190b29uX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9mcmFnbWVudCwKCQlsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50LAoJCWxpZ2h0c19waG9uZ19mcmFnbWVudDogbGlnaHRzX3Bob25nX2ZyYWdtZW50LAoJCWxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50OiBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCwKCQlsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQ6IGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudCwKCQlsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX2ZyYWdtZW50X2JlZ2luOiBsaWdodHNfZnJhZ21lbnRfYmVnaW4sCgkJbGlnaHRzX2ZyYWdtZW50X21hcHM6IGxpZ2h0c19mcmFnbWVudF9tYXBzLAoJCWxpZ2h0c19mcmFnbWVudF9lbmQ6IGxpZ2h0c19mcmFnbWVudF9lbmQsCgkJbG9nZGVwdGhidWZfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX2ZyYWdtZW50LAoJCWxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQsCgkJbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg6IGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4LAoJCWxvZ2RlcHRoYnVmX3ZlcnRleDogbG9nZGVwdGhidWZfdmVydGV4LAoJCW1hcF9mcmFnbWVudDogbWFwX2ZyYWdtZW50LAoJCW1hcF9wYXJzX2ZyYWdtZW50OiBtYXBfcGFyc19mcmFnbWVudCwKCQltYXBfcGFydGljbGVfZnJhZ21lbnQ6IG1hcF9wYXJ0aWNsZV9mcmFnbWVudCwKCQltYXBfcGFydGljbGVfcGFyc19mcmFnbWVudDogbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQsCgkJbWV0YWxuZXNzbWFwX2ZyYWdtZW50OiBtZXRhbG5lc3NtYXBfZnJhZ21lbnQsCgkJbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ6IG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50LAoJCW1vcnBoaW5zdGFuY2VfdmVydGV4OiBtb3JwaGluc3RhbmNlX3ZlcnRleCwKCQltb3JwaGNvbG9yX3ZlcnRleDogbW9ycGhjb2xvcl92ZXJ0ZXgsCgkJbW9ycGhub3JtYWxfdmVydGV4OiBtb3JwaG5vcm1hbF92ZXJ0ZXgsCgkJbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg6IG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4LAoJCW1vcnBodGFyZ2V0X3ZlcnRleDogbW9ycGh0YXJnZXRfdmVydGV4LAoJCW5vcm1hbF9mcmFnbWVudF9iZWdpbjogbm9ybWFsX2ZyYWdtZW50X2JlZ2luLAoJCW5vcm1hbF9mcmFnbWVudF9tYXBzOiBub3JtYWxfZnJhZ21lbnRfbWFwcywKCQlub3JtYWxfcGFyc19mcmFnbWVudDogbm9ybWFsX3BhcnNfZnJhZ21lbnQsCgkJbm9ybWFsX3BhcnNfdmVydGV4OiBub3JtYWxfcGFyc192ZXJ0ZXgsCgkJbm9ybWFsX3ZlcnRleDogbm9ybWFsX3ZlcnRleCwKCQlub3JtYWxtYXBfcGFyc19mcmFnbWVudDogbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQsCgkJY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbjogY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiwKCQljbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHM6IGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcywKCQljbGVhcmNvYXRfcGFyc19mcmFnbWVudDogY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQsCgkJaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudDogaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudCwKCQlvcGFxdWVfZnJhZ21lbnQ6IG9wYXF1ZV9mcmFnbWVudCwKCQlwYWNraW5nOiBwYWNraW5nLAoJCXByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ6IHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQsCgkJcHJvamVjdF92ZXJ0ZXg6IHByb2plY3RfdmVydGV4LAoJCWRpdGhlcmluZ19mcmFnbWVudDogZGl0aGVyaW5nX2ZyYWdtZW50LAoJCWRpdGhlcmluZ19wYXJzX2ZyYWdtZW50OiBkaXRoZXJpbmdfcGFyc19mcmFnbWVudCwKCQlyb3VnaG5lc3NtYXBfZnJhZ21lbnQ6IHJvdWdobmVzc21hcF9mcmFnbWVudCwKCQlyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudDogcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQsCgkJc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50LAoJCXNoYWRvd21hcF9wYXJzX3ZlcnRleDogc2hhZG93bWFwX3BhcnNfdmVydGV4LAoJCXNoYWRvd21hcF92ZXJ0ZXg6IHNoYWRvd21hcF92ZXJ0ZXgsCgkJc2hhZG93bWFza19wYXJzX2ZyYWdtZW50OiBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQsCgkJc2tpbmJhc2VfdmVydGV4OiBza2luYmFzZV92ZXJ0ZXgsCgkJc2tpbm5pbmdfcGFyc192ZXJ0ZXg6IHNraW5uaW5nX3BhcnNfdmVydGV4LAoJCXNraW5uaW5nX3ZlcnRleDogc2tpbm5pbmdfdmVydGV4LAoJCXNraW5ub3JtYWxfdmVydGV4OiBza2lubm9ybWFsX3ZlcnRleCwKCQlzcGVjdWxhcm1hcF9mcmFnbWVudDogc3BlY3VsYXJtYXBfZnJhZ21lbnQsCgkJc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudDogc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudCwKCQl0b25lbWFwcGluZ19mcmFnbWVudDogdG9uZW1hcHBpbmdfZnJhZ21lbnQsCgkJdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudDogdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCwKCQl0cmFuc21pc3Npb25fZnJhZ21lbnQ6IHRyYW5zbWlzc2lvbl9mcmFnbWVudCwKCQl0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudDogdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQsCgkJdXZfcGFyc19mcmFnbWVudDogdXZfcGFyc19mcmFnbWVudCwKCQl1dl9wYXJzX3ZlcnRleDogdXZfcGFyc192ZXJ0ZXgsCgkJdXZfdmVydGV4OiB1dl92ZXJ0ZXgsCgkJd29ybGRwb3NfdmVydGV4OiB3b3JsZHBvc192ZXJ0ZXgsCgoJCWJhY2tncm91bmRfdmVydDogdmVydGV4JGgsCgkJYmFja2dyb3VuZF9mcmFnOiBmcmFnbWVudCRoLAoJCWJhY2tncm91bmRDdWJlX3ZlcnQ6IHZlcnRleCRnLAoJCWJhY2tncm91bmRDdWJlX2ZyYWc6IGZyYWdtZW50JGcsCgkJY3ViZV92ZXJ0OiB2ZXJ0ZXgkZiwKCQljdWJlX2ZyYWc6IGZyYWdtZW50JGYsCgkJZGVwdGhfdmVydDogdmVydGV4JGUsCgkJZGVwdGhfZnJhZzogZnJhZ21lbnQkZSwKCQlkaXN0YW5jZVJHQkFfdmVydDogdmVydGV4JGQsCgkJZGlzdGFuY2VSR0JBX2ZyYWc6IGZyYWdtZW50JGQsCgkJZXF1aXJlY3RfdmVydDogdmVydGV4JGMsCgkJZXF1aXJlY3RfZnJhZzogZnJhZ21lbnQkYywKCQlsaW5lZGFzaGVkX3ZlcnQ6IHZlcnRleCRiLAoJCWxpbmVkYXNoZWRfZnJhZzogZnJhZ21lbnQkYiwKCQltZXNoYmFzaWNfdmVydDogdmVydGV4JGEsCgkJbWVzaGJhc2ljX2ZyYWc6IGZyYWdtZW50JGEsCgkJbWVzaGxhbWJlcnRfdmVydDogdmVydGV4JDksCgkJbWVzaGxhbWJlcnRfZnJhZzogZnJhZ21lbnQkOSwKCQltZXNobWF0Y2FwX3ZlcnQ6IHZlcnRleCQ4LAoJCW1lc2htYXRjYXBfZnJhZzogZnJhZ21lbnQkOCwKCQltZXNobm9ybWFsX3ZlcnQ6IHZlcnRleCQ3LAoJCW1lc2hub3JtYWxfZnJhZzogZnJhZ21lbnQkNywKCQltZXNocGhvbmdfdmVydDogdmVydGV4JDYsCgkJbWVzaHBob25nX2ZyYWc6IGZyYWdtZW50JDYsCgkJbWVzaHBoeXNpY2FsX3ZlcnQ6IHZlcnRleCQ1LAoJCW1lc2hwaHlzaWNhbF9mcmFnOiBmcmFnbWVudCQ1LAoJCW1lc2h0b29uX3ZlcnQ6IHZlcnRleCQ0LAoJCW1lc2h0b29uX2ZyYWc6IGZyYWdtZW50JDQsCgkJcG9pbnRzX3ZlcnQ6IHZlcnRleCQzLAoJCXBvaW50c19mcmFnOiBmcmFnbWVudCQzLAoJCXNoYWRvd192ZXJ0OiB2ZXJ0ZXgkMiwKCQlzaGFkb3dfZnJhZzogZnJhZ21lbnQkMiwKCQlzcHJpdGVfdmVydDogdmVydGV4JDEsCgkJc3ByaXRlX2ZyYWc6IGZyYWdtZW50JDEKCX07CgoJLy8gVW5pZm9ybXMgbGlicmFyeSBmb3Igc2hhcmVkIHdlYmdsIHNoYWRlcnMKCWNvbnN0IFVuaWZvcm1zTGliID0gewoKCQljb21tb246IHsKCgkJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCgkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoKCQkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCW1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgoJCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlhbHBoYU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgoJCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKCQl9LAoKCQlzcGVjdWxhcm1hcDogewoKCQkJc3BlY3VsYXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJc3BlY3VsYXJNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCWVudm1hcDogewoKCQkJZW52TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWVudk1hcFJvdGF0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJZmxpcEVudk1hcDogeyB2YWx1ZTogLTEgfSwKCQkJcmVmbGVjdGl2aXR5OiB7IHZhbHVlOiAxLjAgfSwgLy8gYmFzaWMsIGxhbWJlcnQsIHBob25nCgkJCWlvcjogeyB2YWx1ZTogMS41IH0sIC8vIHBoeXNpY2FsCgkJCXJlZnJhY3Rpb25SYXRpbzogeyB2YWx1ZTogMC45OCB9LCAvLyBiYXNpYywgbGFtYmVydCwgcGhvbmcKCgkJfSwKCgkJYW9tYXA6IHsKCgkJCWFvTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFvTWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCgkJCWFvTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCQl9LAoKCQlsaWdodG1hcDogewoKCQkJbGlnaHRNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJbGlnaHRNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKCQkJbGlnaHRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCWJ1bXBtYXA6IHsKCgkJCWJ1bXBNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJYnVtcE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCWJ1bXBTY2FsZTogeyB2YWx1ZTogMSB9CgoJCX0sCgoJCW5vcm1hbG1hcDogewoKCQkJbm9ybWFsTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCW5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCW5vcm1hbFNjYWxlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCAxLCAxICkgfQoKCQl9LAoKCQlkaXNwbGFjZW1lbnRtYXA6IHsKCgkJCWRpc3BsYWNlbWVudE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlkaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlkaXNwbGFjZW1lbnRTY2FsZTogeyB2YWx1ZTogMSB9LAoJCQlkaXNwbGFjZW1lbnRCaWFzOiB7IHZhbHVlOiAwIH0KCgkJfSwKCgkJZW1pc3NpdmVtYXA6IHsKCgkJCWVtaXNzaXZlTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWVtaXNzaXZlTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCQl9LAoKCQltZXRhbG5lc3NtYXA6IHsKCgkJCW1ldGFsbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQltZXRhbG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCXJvdWdobmVzc21hcDogewoKCQkJcm91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXJvdWdobmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgkJfSwKCgkJZ3JhZGllbnRtYXA6IHsKCgkJCWdyYWRpZW50TWFwOiB7IHZhbHVlOiBudWxsIH0KCgkJfSwKCgkJZm9nOiB7CgoJCQlmb2dEZW5zaXR5OiB7IHZhbHVlOiAwLjAwMDI1IH0sCgkJCWZvZ05lYXI6IHsgdmFsdWU6IDEgfSwKCQkJZm9nRmFyOiB7IHZhbHVlOiAyMDAwIH0sCgkJCWZvZ0NvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9CgoJCX0sCgoJCWxpZ2h0czogewoKCQkJYW1iaWVudExpZ2h0Q29sb3I6IHsgdmFsdWU6IFtdIH0sCgoJCQlsaWdodFByb2JlOiB7IHZhbHVlOiBbXSB9LAoKCQkJZGlyZWN0aW9uYWxMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlkaXJlY3Rpb246IHt9LAoJCQkJY29sb3I6IHt9CgkJCX0gfSwKCgkJCWRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAoJCQkJc2hhZG93Qmlhczoge30sCgkJCQlzaGFkb3dOb3JtYWxCaWFzOiB7fSwKCQkJCXNoYWRvd1JhZGl1czoge30sCgkJCQlzaGFkb3dNYXBTaXplOiB7fQoJCQl9IH0sCgoJCQlkaXJlY3Rpb25hbFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQkJZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCgoJCQlzcG90TGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJY29sb3I6IHt9LAoJCQkJcG9zaXRpb246IHt9LAoJCQkJZGlyZWN0aW9uOiB7fSwKCQkJCWRpc3RhbmNlOiB7fSwKCQkJCWNvbmVDb3M6IHt9LAoJCQkJcGVudW1icmFDb3M6IHt9LAoJCQkJZGVjYXk6IHt9CgkJCX0gfSwKCgkJCXNwb3RMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCgkJCQlzaGFkb3dCaWFzOiB7fSwKCQkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJCXNoYWRvd01hcFNpemU6IHt9CgkJCX0gfSwKCgkJCXNwb3RMaWdodE1hcDogeyB2YWx1ZTogW10gfSwKCQkJc3BvdFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQkJc3BvdExpZ2h0TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKCQkJcG9pbnRMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQljb2xvcjoge30sCgkJCQlwb3NpdGlvbjoge30sCgkJCQlkZWNheToge30sCgkJCQlkaXN0YW5jZToge30KCQkJfSB9LAoKCQkJcG9pbnRMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCgkJCQlzaGFkb3dCaWFzOiB7fSwKCQkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJCXNoYWRvd01hcFNpemU6IHt9LAoJCQkJc2hhZG93Q2FtZXJhTmVhcjoge30sCgkJCQlzaGFkb3dDYW1lcmFGYXI6IHt9CgkJCX0gfSwKCgkJCXBvaW50U2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAoJCQlwb2ludFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKCgkJCWhlbWlzcGhlcmVMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlkaXJlY3Rpb246IHt9LAoJCQkJc2t5Q29sb3I6IHt9LAoJCQkJZ3JvdW5kQ29sb3I6IHt9CgkJCX0gfSwKCgkJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBSZWN0QXJlYUxpZ2h0IEJSREYgZGF0YSBuZWVkcyB0byBiZSBtb3ZlZCBmcm9tIGV4YW1wbGUgdG8gbWFpbiBzcmMKCQkJcmVjdEFyZWFMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQljb2xvcjoge30sCgkJCQlwb3NpdGlvbjoge30sCgkJCQl3aWR0aDoge30sCgkJCQloZWlnaHQ6IHt9CgkJCX0gfSwKCgkJCWx0Y18xOiB7IHZhbHVlOiBudWxsIH0sCgkJCWx0Y18yOiB7IHZhbHVlOiBudWxsIH0KCgkJfSwKCgkJcG9pbnRzOiB7CgoJCQlkaWZmdXNlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9LAoJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfSwKCQkJc2l6ZTogeyB2YWx1ZTogMS4wIH0sCgkJCXNjYWxlOiB7IHZhbHVlOiAxLjAgfSwKCQkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFscGhhTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJYWxwaGFUZXN0OiB7IHZhbHVlOiAwIH0sCgkJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCQl9LAoKCQlzcHJpdGU6IHsKCgkJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCgkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoJCQljZW50ZXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDAuNSwgMC41ICkgfSwKCQkJcm90YXRpb246IHsgdmFsdWU6IDAuMCB9LAoJCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJbWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJYWxwaGFNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKCQl9CgoJfTsKCgljb25zdCBTaGFkZXJMaWIgPSB7CgoJCWJhc2ljOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKCQkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5mb2cKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNoYmFzaWNfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY19mcmFnCgoJCX0sCgoJCWxhbWJlcnQ6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobGFtYmVydF9mcmFnCgoJCX0sCgoJCXBob25nOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKCQkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCQl7CgkJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQkJc3BlY3VsYXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDExMTExMSApIH0sCgkJCQkJc2hpbmluZXNzOiB7IHZhbHVlOiAzMCB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBob25nX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfZnJhZwoKCQl9LAoKCQlzdGFuZGFyZDogewoKCQkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLnJvdWdobmVzc21hcCwKCQkJCVVuaWZvcm1zTGliLm1ldGFsbmVzc21hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKCQkJCQlyb3VnaG5lc3M6IHsgdmFsdWU6IDEuMCB9LAoJCQkJCW1ldGFsbmVzczogeyB2YWx1ZTogMC4wIH0sCgkJCQkJZW52TWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0KCQkJCX0KCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF9mcmFnCgoJCX0sCgoJCXRvb246IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ncmFkaWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2h0b29uX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNodG9vbl9mcmFnCgoJCX0sCgoJCW1hdGNhcDogewoKCQkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCXsKCQkJCQltYXRjYXA6IHsgdmFsdWU6IG51bGwgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfZnJhZwoKCQl9LAoKCQlwb2ludHM6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLnBvaW50cywKCQkJCVVuaWZvcm1zTGliLmZvZwoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnBvaW50c192ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsucG9pbnRzX2ZyYWcKCgkJfSwKCgkJZGFzaGVkOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCQl7CgkJCQkJc2NhbGU6IHsgdmFsdWU6IDEgfSwKCQkJCQlkYXNoU2l6ZTogeyB2YWx1ZTogMSB9LAoJCQkJCXRvdGFsU2l6ZTogeyB2YWx1ZTogMiB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF9mcmFnCgoJCX0sCgoJCWRlcHRoOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfZnJhZwoKCQl9LAoKCQlub3JtYWw6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQl7CgkJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJCX0KCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX2ZyYWcKCgkJfSwKCgkJc3ByaXRlOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5zcHJpdGUsCgkJCQlVbmlmb3Jtc0xpYi5mb2cKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zcHJpdGVfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV9mcmFnCgoJCX0sCgoJCWJhY2tncm91bmQ6IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQl1dlRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQl0MkQ6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWJhY2tncm91bmRJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfQoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX2ZyYWcKCgkJfSwKCgkJYmFja2dyb3VuZEN1YmU6IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQllbnZNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWZsaXBFbnZNYXA6IHsgdmFsdWU6IC0xIH0sCgkJCQliYWNrZ3JvdW5kQmx1cnJpbmVzczogeyB2YWx1ZTogMCB9LAoJCQkJYmFja2dyb3VuZEludGVuc2l0eTogeyB2YWx1ZTogMSB9LAoJCQkJYmFja2dyb3VuZFJvdGF0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kQ3ViZV92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuYmFja2dyb3VuZEN1YmVfZnJhZwoKCQl9LAoKCQljdWJlOiB7CgoJCQl1bmlmb3JtczogewoJCQkJdEN1YmU6IHsgdmFsdWU6IG51bGwgfSwKCQkJCXRGbGlwOiB7IHZhbHVlOiAtMSB9LAoJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV9mcmFnCgoJCX0sCgoJCWVxdWlyZWN0OiB7CgoJCQl1bmlmb3JtczogewoJCQkJdEVxdWlyZWN0OiB7IHZhbHVlOiBudWxsIH0sCgkJCX0sCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmVxdWlyZWN0X3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5lcXVpcmVjdF9mcmFnCgoJCX0sCgoJCWRpc3RhbmNlUkdCQTogewoKCQkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQkJewoJCQkJCXJlZmVyZW5jZVBvc2l0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkgfSwKCQkJCQluZWFyRGlzdGFuY2U6IHsgdmFsdWU6IDEgfSwKCQkJCQlmYXJEaXN0YW5jZTogeyB2YWx1ZTogMTAwMCB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZGlzdGFuY2VSR0JBX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfZnJhZwoKCQl9LAoKCQlzaGFkb3c6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCXsKCQkJCQljb2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAgKSB9LAoJCQkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9CgkJCQl9LAoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnNoYWRvd192ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X2ZyYWcKCgkJfQoKCX07CgoJU2hhZGVyTGliLnBoeXNpY2FsID0gewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVNoYWRlckxpYi5zdGFuZGFyZC51bmlmb3JtcywKCQkJewoJCQkJY2xlYXJjb2F0OiB7IHZhbHVlOiAwIH0sCgkJCQljbGVhcmNvYXRNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWNsZWFyY29hdE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQljbGVhcmNvYXROb3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQljbGVhcmNvYXROb3JtYWxTY2FsZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMSwgMSApIH0sCgkJCQljbGVhcmNvYXRSb3VnaG5lc3M6IHsgdmFsdWU6IDAgfSwKCQkJCWNsZWFyY29hdFJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCWRpc3BlcnNpb246IHsgdmFsdWU6IDAgfSwKCQkJCWlyaWRlc2NlbmNlOiB7IHZhbHVlOiAwIH0sCgkJCQlpcmlkZXNjZW5jZU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJaXJpZGVzY2VuY2VJT1I6IHsgdmFsdWU6IDEuMyB9LAoJCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtOiB7IHZhbHVlOiAxMDAgfSwKCQkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTogeyB2YWx1ZTogNDAwIH0sCgkJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJc2hlZW46IHsgdmFsdWU6IDAgfSwKCQkJCXNoZWVuQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQlzaGVlbkNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlzaGVlbkNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCXNoZWVuUm91Z2huZXNzOiB7IHZhbHVlOiAxIH0sCgkJCQlzaGVlblJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJdHJhbnNtaXNzaW9uOiB7IHZhbHVlOiAwIH0sCgkJCQl0cmFuc21pc3Npb25NYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCXRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQl0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCgkJCQl0cmFuc21pc3Npb25TYW1wbGVyTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQl0aGlja25lc3M6IHsgdmFsdWU6IDAgfSwKCQkJCXRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJdGhpY2tuZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCWF0dGVudWF0aW9uRGlzdGFuY2U6IHsgdmFsdWU6IDAgfSwKCQkJCWF0dGVudWF0aW9uQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQlzcGVjdWxhckNvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMSwgMSwgMSApIH0sCgkJCQlzcGVjdWxhckNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCXNwZWN1bGFySW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCgkJCQlzcGVjdWxhckludGVuc2l0eU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJYW5pc290cm9weVZlY3RvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCgkJCQlhbmlzb3Ryb3B5TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX2ZyYWcKCgl9OwoKCWNvbnN0IF9yZ2IgPSB7IHI6IDAsIGI6IDAsIGc6IDAgfTsKCWNvbnN0IF9lMSQxID0gLypAX19QVVJFX18qLyBuZXcgRXVsZXIoKTsKCWNvbnN0IF9tMSQxID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKCWZ1bmN0aW9uIFdlYkdMQmFja2dyb3VuZCggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBzdGF0ZSwgb2JqZWN0cywgYWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJY29uc3QgY2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQlsZXQgY2xlYXJBbHBoYSA9IGFscGhhID09PSB0cnVlID8gMCA6IDE7CgoJCWxldCBwbGFuZU1lc2g7CgkJbGV0IGJveE1lc2g7CgoJCWxldCBjdXJyZW50QmFja2dyb3VuZCA9IG51bGw7CgkJbGV0IGN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IDA7CgkJbGV0IGN1cnJlbnRUb25lbWFwcGluZyA9IG51bGw7CgoJCWZ1bmN0aW9uIGdldEJhY2tncm91bmQoIHNjZW5lICkgewoKCQkJbGV0IGJhY2tncm91bmQgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUuYmFja2dyb3VuZCA6IG51bGw7CgoJCQlpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgoJCQkJY29uc3QgdXNlUE1SRU0gPSBzY2VuZS5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDA7IC8vIHVzZSBQTVJFTSBpZiB0aGUgdXNlciB3YW50cyB0byBibHVyIHRoZSBiYWNrZ3JvdW5kCgkJCQliYWNrZ3JvdW5kID0gKCB1c2VQTVJFTSA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggYmFja2dyb3VuZCApOwoKCQkJfQoKCQkJcmV0dXJuIGJhY2tncm91bmQ7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyKCBzY2VuZSApIHsKCgkJCWxldCBmb3JjZUNsZWFyID0gZmFsc2U7CgkJCWNvbnN0IGJhY2tncm91bmQgPSBnZXRCYWNrZ3JvdW5kKCBzY2VuZSApOwoKCQkJaWYgKCBiYWNrZ3JvdW5kID09PSBudWxsICkgewoKCQkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCQl9IGVsc2UgaWYgKCBiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNDb2xvciApIHsKCgkJCQlzZXRDbGVhciggYmFja2dyb3VuZCwgMSApOwoJCQkJZm9yY2VDbGVhciA9IHRydWU7CgoJCQl9CgoJCQljb25zdCBlbnZpcm9ubWVudEJsZW5kTW9kZSA9IHJlbmRlcmVyLnhyLmdldEVudmlyb25tZW50QmxlbmRNb2RlKCk7CgoJCQlpZiAoIGVudmlyb25tZW50QmxlbmRNb2RlID09PSAnYWRkaXRpdmUnICkgewoKCQkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDAsIDAsIDAsIDEsIHByZW11bHRpcGxpZWRBbHBoYSApOwoKCQkJfSBlbHNlIGlmICggZW52aXJvbm1lbnRCbGVuZE1vZGUgPT09ICdhbHBoYS1ibGVuZCcgKSB7CgoJCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMCwgMCwgMCwgMCwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJCQl9CgoJCQlpZiAoIHJlbmRlcmVyLmF1dG9DbGVhciB8fCBmb3JjZUNsZWFyICkgewoKCQkJCS8vIGJ1ZmZlcnMgbWlnaHQgbm90IGJlIHdyaXRhYmxlIHdoaWNoIGlzIHJlcXVpcmVkIHRvIGVuc3VyZSBhIGNvcnJlY3QgY2xlYXIKCgkJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0TWFzayggdHJ1ZSApOwoJCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRNYXNrKCB0cnVlICk7CgoJCQkJcmVuZGVyZXIuY2xlYXIoIHJlbmRlcmVyLmF1dG9DbGVhckNvbG9yLCByZW5kZXJlci5hdXRvQ2xlYXJEZXB0aCwgcmVuZGVyZXIuYXV0b0NsZWFyU3RlbmNpbCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGFkZFRvUmVuZGVyTGlzdCggcmVuZGVyTGlzdCwgc2NlbmUgKSB7CgoJCQljb25zdCBiYWNrZ3JvdW5kID0gZ2V0QmFja2dyb3VuZCggc2NlbmUgKTsKCgkJCWlmICggYmFja2dyb3VuZCAmJiAoIGJhY2tncm91bmQuaXNDdWJlVGV4dHVyZSB8fCBiYWNrZ3JvdW5kLm1hcHBpbmcgPT09IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nICkgKSB7CgoJCQkJaWYgKCBib3hNZXNoID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWJveE1lc2ggPSBuZXcgTWVzaCgKCQkJCQkJbmV3IEJveEdlb21ldHJ5KCAxLCAxLCAxICksCgkJCQkJCW5ldyBTaGFkZXJNYXRlcmlhbCggewoJCQkJCQkJbmFtZTogJ0JhY2tncm91bmRDdWJlTWF0ZXJpYWwnLAoJCQkJCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS51bmlmb3JtcyApLAoJCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZEN1YmUudmVydGV4U2hhZGVyLAoJCQkJCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS5mcmFnbWVudFNoYWRlciwKCQkJCQkJCXNpZGU6IEJhY2tTaWRlLAoJCQkJCQkJZGVwdGhUZXN0OiBmYWxzZSwKCQkJCQkJCWRlcHRoV3JpdGU6IGZhbHNlLAoJCQkJCQkJZm9nOiBmYWxzZSwKCQkJCQkJCWFsbG93T3ZlcnJpZGU6IGZhbHNlCgkJCQkJCX0gKQoJCQkJCSk7CgoJCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbm9ybWFsJyApOwoJCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAndXYnICk7CgoJCQkJCWJveE1lc2gub25CZWZvcmVSZW5kZXIgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKCQkJCQl9OwoKCQkJCQkvLyBhZGQgImVudk1hcCIgbWF0ZXJpYWwgcHJvcGVydHkgc28gdGhlIHJlbmRlcmVyIGNhbiBldmFsdWF0ZSBpdCBsaWtlIGZvciBidWlsdC1pbiBtYXRlcmlhbHMKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIGJveE1lc2gubWF0ZXJpYWwsICdlbnZNYXAnLCB7CgoJCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5lbnZNYXAudmFsdWU7CgoJCQkJCQl9CgoJCQkJCX0gKTsKCgkJCQkJb2JqZWN0cy51cGRhdGUoIGJveE1lc2ggKTsKCgkJCQl9CgoJCQkJX2UxJDEuY29weSggc2NlbmUuYmFja2dyb3VuZFJvdGF0aW9uICk7CgoJCQkJLy8gYWNjb21tb2RhdGUgbGVmdC1oYW5kZWQgZnJhbWUKCQkJCV9lMSQxLnggKj0gLTE7IF9lMSQxLnkgKj0gLTE7IF9lMSQxLnogKj0gLTE7CgoJCQkJaWYgKCBiYWNrZ3JvdW5kLmlzQ3ViZVRleHR1cmUgJiYgYmFja2dyb3VuZC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgewoKCQkJCQkvLyBlbnZpcm9ubWVudCBtYXBzIHdoaWNoIGFyZSBub3QgY3ViZSByZW5kZXIgdGFyZ2V0cyBvciBQTVJFTXMgZm9sbG93IGEgZGlmZmVyZW50IGNvbnZlbnRpb24KCQkJCQlfZTEkMS55ICo9IC0xOwoJCQkJCV9lMSQxLnogKj0gLTE7CgoJCQkJfQoKCQkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZW52TWFwLnZhbHVlID0gYmFja2dyb3VuZDsKCQkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlICYmIGJhY2tncm91bmQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLTEgOiAxOwoJCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcy52YWx1ZSA9IHNjZW5lLmJhY2tncm91bmRCbHVycmluZXNzOwoJCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuYmFja2dyb3VuZFJvdGF0aW9uLnZhbHVlLnNldEZyb21NYXRyaXg0KCBfbTEkMS5tYWtlUm90YXRpb25Gcm9tRXVsZXIoIF9lMSQxICkgKTsKCQkJCWJveE1lc2gubWF0ZXJpYWwudG9uZU1hcHBlZCA9IENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggYmFja2dyb3VuZC5jb2xvclNwYWNlICkgIT09IFNSR0JUcmFuc2ZlcjsKCgkJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKCQkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKCQkJCQlib3hNZXNoLm1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJY3VycmVudEJhY2tncm91bmQgPSBiYWNrZ3JvdW5kOwoJCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IGJhY2tncm91bmQudmVyc2lvbjsKCQkJCQljdXJyZW50VG9uZW1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCgkJCQl9CgoJCQkJYm94TWVzaC5sYXllcnMuZW5hYmxlQWxsKCk7CgoJCQkJLy8gcHVzaCB0byB0aGUgcHJlLXNvcnRlZCBvcGFxdWUgcmVuZGVyIGxpc3QKCQkJCXJlbmRlckxpc3QudW5zaGlmdCggYm94TWVzaCwgYm94TWVzaC5nZW9tZXRyeSwgYm94TWVzaC5tYXRlcmlhbCwgMCwgMCwgbnVsbCApOwoKCQkJfSBlbHNlIGlmICggYmFja2dyb3VuZCAmJiBiYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCgkJCQlpZiAoIHBsYW5lTWVzaCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlwbGFuZU1lc2ggPSBuZXcgTWVzaCgKCQkJCQkJbmV3IFBsYW5lR2VvbWV0cnkoIDIsIDIgKSwKCQkJCQkJbmV3IFNoYWRlck1hdGVyaWFsKCB7CgkJCQkJCQluYW1lOiAnQmFja2dyb3VuZE1hdGVyaWFsJywKCQkJCQkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBTaGFkZXJMaWIuYmFja2dyb3VuZC51bmlmb3JtcyApLAoJCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC52ZXJ0ZXhTaGFkZXIsCgkJCQkJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyTGliLmJhY2tncm91bmQuZnJhZ21lbnRTaGFkZXIsCgkJCQkJCQlzaWRlOiBGcm9udFNpZGUsCgkJCQkJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQkJCQkJZGVwdGhXcml0ZTogZmFsc2UsCgkJCQkJCQlmb2c6IGZhbHNlLAoJCQkJCQkJYWxsb3dPdmVycmlkZTogZmFsc2UKCQkJCQkJfSApCgkJCQkJKTsKCgkJCQkJcGxhbmVNZXNoLmdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSggJ25vcm1hbCcgKTsKCgkJCQkJLy8gYWRkICJtYXAiIG1hdGVyaWFsIHByb3BlcnR5IHNvIHRoZSByZW5kZXJlciBjYW4gZXZhbHVhdGUgaXQgbGlrZSBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzCgkJCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBwbGFuZU1lc2gubWF0ZXJpYWwsICdtYXAnLCB7CgoJCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy50MkQudmFsdWU7CgoJCQkJCQl9CgoJCQkJCX0gKTsKCgkJCQkJb2JqZWN0cy51cGRhdGUoIHBsYW5lTWVzaCApOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudDJELnZhbHVlID0gYmFja2dyb3VuZDsKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC50b25lTWFwcGVkID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBiYWNrZ3JvdW5kLmNvbG9yU3BhY2UgKSAhPT0gU1JHQlRyYW5zZmVyOwoKCQkJCWlmICggYmFja2dyb3VuZC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQliYWNrZ3JvdW5kLnVwZGF0ZU1hdHJpeCgpOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudXZUcmFuc2Zvcm0udmFsdWUuY29weSggYmFja2dyb3VuZC5tYXRyaXggKTsKCgkJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKCQkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKCQkJCQlwbGFuZU1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gYmFja2dyb3VuZC52ZXJzaW9uOwoJCQkJCWN1cnJlbnRUb25lbWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubGF5ZXJzLmVuYWJsZUFsbCgpOwoKCQkJCS8vIHB1c2ggdG8gdGhlIHByZS1zb3J0ZWQgb3BhcXVlIHJlbmRlciBsaXN0CgkJCQlyZW5kZXJMaXN0LnVuc2hpZnQoIHBsYW5lTWVzaCwgcGxhbmVNZXNoLmdlb21ldHJ5LCBwbGFuZU1lc2gubWF0ZXJpYWwsIDAsIDAsIG51bGwgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXRDbGVhciggY29sb3IsIGFscGhhICkgewoKCQkJY29sb3IuZ2V0UkdCKCBfcmdiLCBnZXRVbmxpdFVuaWZvcm1Db2xvclNwYWNlKCByZW5kZXJlciApICk7CgoJCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCBfcmdiLnIsIF9yZ2IuZywgX3JnYi5iLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCWlmICggYm94TWVzaCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWJveE1lc2guZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCQkJYm94TWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQkJYm94TWVzaCA9IHVuZGVmaW5lZDsKCgkJCX0KCgkJCWlmICggcGxhbmVNZXNoICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcGxhbmVNZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQkJcGxhbmVNZXNoID0gdW5kZWZpbmVkOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7CgoJCQlnZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGNsZWFyQ29sb3I7CgoJCQl9LAoJCQlzZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoIGNvbG9yLCBhbHBoYSA9IDEgKSB7CgoJCQkJY2xlYXJDb2xvci5zZXQoIGNvbG9yICk7CgkJCQljbGVhckFscGhhID0gYWxwaGE7CgkJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKCQkJfSwKCQkJZ2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBjbGVhckFscGhhOwoKCQkJfSwKCQkJc2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCBhbHBoYSApIHsKCgkJCQljbGVhckFscGhhID0gYWxwaGE7CgkJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKCQkJfSwKCQkJcmVuZGVyOiByZW5kZXIsCgkJCWFkZFRvUmVuZGVyTGlzdDogYWRkVG9SZW5kZXJMaXN0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQmluZGluZ1N0YXRlcyggZ2wsIGF0dHJpYnV0ZXMgKSB7CgoJCWNvbnN0IG1heFZlcnRleEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwoKCQljb25zdCBiaW5kaW5nU3RhdGVzID0ge307CgoJCWNvbnN0IGRlZmF1bHRTdGF0ZSA9IGNyZWF0ZUJpbmRpbmdTdGF0ZSggbnVsbCApOwoJCWxldCBjdXJyZW50U3RhdGUgPSBkZWZhdWx0U3RhdGU7CgkJbGV0IGZvcmNlVXBkYXRlID0gZmFsc2U7CgoJCWZ1bmN0aW9uIHNldHVwKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSwgaW5kZXggKSB7CgoJCQlsZXQgdXBkYXRlQnVmZmVycyA9IGZhbHNlOwoKCQkJY29uc3Qgc3RhdGUgPSBnZXRCaW5kaW5nU3RhdGUoIGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCApOwoKCQkJaWYgKCBjdXJyZW50U3RhdGUgIT09IHN0YXRlICkgewoKCQkJCWN1cnJlbnRTdGF0ZSA9IHN0YXRlOwoJCQkJYmluZFZlcnRleEFycmF5T2JqZWN0KCBjdXJyZW50U3RhdGUub2JqZWN0ICk7CgoJCQl9CgoJCQl1cGRhdGVCdWZmZXJzID0gbmVlZHNVcGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0sIGluZGV4ICk7CgoJCQlpZiAoIHVwZGF0ZUJ1ZmZlcnMgKSBzYXZlQ2FjaGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0sIGluZGV4ICk7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBpbmRleCwgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIgKTsKCgkJCX0KCgkJCWlmICggdXBkYXRlQnVmZmVycyB8fCBmb3JjZVVwZGF0ZSApIHsKCgkJCQlmb3JjZVVwZGF0ZSA9IGZhbHNlOwoKCQkJCXNldHVwVmVydGV4QXR0cmlidXRlcyggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnkgKTsKCgkJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCQlnbC5iaW5kQnVmZmVyKCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYXR0cmlidXRlcy5nZXQoIGluZGV4ICkuYnVmZmVyICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgewoKCQkJcmV0dXJuIGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7CgoJCX0KCgkJZnVuY3Rpb24gYmluZFZlcnRleEFycmF5T2JqZWN0KCB2YW8gKSB7CgoJCQlyZXR1cm4gZ2wuYmluZFZlcnRleEFycmF5KCB2YW8gKTsKCgkJfQoKCQlmdW5jdGlvbiBkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCggdmFvICkgewoKCQkJcmV0dXJuIGdsLmRlbGV0ZVZlcnRleEFycmF5KCB2YW8gKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRCaW5kaW5nU3RhdGUoIGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCApIHsKCgkJCWNvbnN0IHdpcmVmcmFtZSA9ICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICk7CgoJCQlsZXQgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCQlpZiAoIHByb2dyYW1NYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwcm9ncmFtTWFwID0ge307CgkJCQliaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdID0gcHJvZ3JhbU1hcDsKCgkJCX0KCgkJCWxldCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCgkJCWlmICggc3RhdGVNYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlzdGF0ZU1hcCA9IHt9OwoJCQkJcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID0gc3RhdGVNYXA7CgoJCQl9CgoJCQlsZXQgc3RhdGUgPSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgoJCQlpZiAoIHN0YXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc3RhdGUgPSBjcmVhdGVCaW5kaW5nU3RhdGUoIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgKTsKCQkJCXN0YXRlTWFwWyB3aXJlZnJhbWUgXSA9IHN0YXRlOwoKCQkJfQoKCQkJcmV0dXJuIHN0YXRlOwoKCQl9CgoJCWZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdTdGF0ZSggdmFvICkgewoKCQkJY29uc3QgbmV3QXR0cmlidXRlcyA9IFtdOwoJCQljb25zdCBlbmFibGVkQXR0cmlidXRlcyA9IFtdOwoJCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbWF4VmVydGV4QXR0cmlidXRlczsgaSArKyApIHsKCgkJCQluZXdBdHRyaWJ1dGVzWyBpIF0gPSAwOwoJCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSA9IDA7CgkJCQlhdHRyaWJ1dGVEaXZpc29yc1sgaSBdID0gMDsKCgkJCX0KCgkJCXJldHVybiB7CgoJCQkJLy8gZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb24gbm9uLVZBTyBzdXBwb3J0IGJyb3dzZXIKCQkJCWdlb21ldHJ5OiBudWxsLAoJCQkJcHJvZ3JhbTogbnVsbCwKCQkJCXdpcmVmcmFtZTogZmFsc2UsCgoJCQkJbmV3QXR0cmlidXRlczogbmV3QXR0cmlidXRlcywKCQkJCWVuYWJsZWRBdHRyaWJ1dGVzOiBlbmFibGVkQXR0cmlidXRlcywKCQkJCWF0dHJpYnV0ZURpdmlzb3JzOiBhdHRyaWJ1dGVEaXZpc29ycywKCQkJCW9iamVjdDogdmFvLAoJCQkJYXR0cmlidXRlczoge30sCgkJCQlpbmRleDogbnVsbAoKCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiBuZWVkc1VwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgoJCQljb25zdCBjYWNoZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmF0dHJpYnV0ZXM7CgkJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgoJCQlsZXQgYXR0cmlidXRlc051bSA9IDA7CgoJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBwcm9ncmFtQXR0cmlidXRlcyApIHsKCgkJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gPj0gMCApIHsKCgkJCQkJY29uc3QgY2FjaGVkQXR0cmlidXRlID0gY2FjaGVkQXR0cmlidXRlc1sgbmFtZSBdOwoJCQkJCWxldCBnZW9tZXRyeUF0dHJpYnV0ZSA9IGdlb21ldHJ5QXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CgkJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlQ29sb3InICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VDb2xvcjsKCgkJCQkJfQoKCQkJCQlpZiAoIGNhY2hlZEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIHRydWU7CgoJCQkJCWlmICggY2FjaGVkQXR0cmlidXRlLmF0dHJpYnV0ZSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUgKSByZXR1cm4gdHJ1ZTsKCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSAmJiBjYWNoZWRBdHRyaWJ1dGUuZGF0YSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YSApIHJldHVybiB0cnVlOwoKCQkJCQlhdHRyaWJ1dGVzTnVtICsrOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggY3VycmVudFN0YXRlLmF0dHJpYnV0ZXNOdW0gIT09IGF0dHJpYnV0ZXNOdW0gKSByZXR1cm4gdHJ1ZTsKCgkJCWlmICggY3VycmVudFN0YXRlLmluZGV4ICE9PSBpbmRleCApIHJldHVybiB0cnVlOwoKCQkJcmV0dXJuIGZhbHNlOwoKCQl9CgoJCWZ1bmN0aW9uIHNhdmVDYWNoZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgoJCQljb25zdCBjYWNoZSA9IHt9OwoJCQljb25zdCBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCQkJbGV0IGF0dHJpYnV0ZXNOdW0gPSAwOwoKCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJCWZvciAoIGNvbnN0IG5hbWUgaW4gcHJvZ3JhbUF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uID49IDAgKSB7CgoJCQkJCWxldCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJCWlmICggYXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgYXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKCQkJCQl9CgoJCQkJCWNvbnN0IGRhdGEgPSB7fTsKCQkJCQlkYXRhLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTsKCgkJCQkJaWYgKCBhdHRyaWJ1dGUgJiYgYXR0cmlidXRlLmRhdGEgKSB7CgoJCQkJCQlkYXRhLmRhdGEgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCQkJfQoKCQkJCQljYWNoZVsgbmFtZSBdID0gZGF0YTsKCgkJCQkJYXR0cmlidXRlc051bSArKzsKCgkJCQl9CgoJCQl9CgoJCQljdXJyZW50U3RhdGUuYXR0cmlidXRlcyA9IGNhY2hlOwoJCQljdXJyZW50U3RhdGUuYXR0cmlidXRlc051bSA9IGF0dHJpYnV0ZXNOdW07CgoJCQljdXJyZW50U3RhdGUuaW5kZXggPSBpbmRleDsKCgkJfQoKCQlmdW5jdGlvbiBpbml0QXR0cmlidXRlcygpIHsKCgkJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBuZXdBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCW5ld0F0dHJpYnV0ZXNbIGkgXSA9IDA7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZW5hYmxlQXR0cmlidXRlKCBhdHRyaWJ1dGUgKSB7CgoJCQllbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIDAgKTsKCgkJfQoKCQlmdW5jdGlvbiBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKSB7CgoJCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CgkJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwoJCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVEaXZpc29yczsKCgkJCW5ld0F0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCgkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID09PSAwICkgewoKCQkJCWdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KCBhdHRyaWJ1dGUgKTsKCQkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBhdHRyaWJ1dGUgXSA9IDE7CgoJCQl9CgoJCQlpZiAoIGF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSAhPT0gbWVzaFBlckF0dHJpYnV0ZSApIHsKCgkJCQlnbC52ZXJ0ZXhBdHRyaWJEaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKTsKCQkJCWF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSA9IG1lc2hQZXJBdHRyaWJ1dGU7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKSB7CgoJCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CgkJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGVuYWJsZWRBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSAhPT0gbmV3QXR0cmlidXRlc1sgaSBdICkgewoKCQkJCQlnbC5kaXNhYmxlVmVydGV4QXR0cmliQXJyYXkoIGkgKTsKCQkJCQllbmFibGVkQXR0cmlidXRlc1sgaSBdID0gMDsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0LCBpbnRlZ2VyICkgewoKCQkJaWYgKCBpbnRlZ2VyID09PSB0cnVlICkgewoKCQkJCWdsLnZlcnRleEF0dHJpYklQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgc3RyaWRlLCBvZmZzZXQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJZ2wudmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSApIHsKCgkJCWluaXRBdHRyaWJ1dGVzKCk7CgoJCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJCWNvbnN0IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyA9IG1hdGVyaWFsLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXM7CgoJCQlmb3IgKCBjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKCQkJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGUgPSBwcm9ncmFtQXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCWlmICggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiA+PSAwICkgewoKCQkJCQlsZXQgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBnZW9tZXRyeUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VNYXRyaXgnICYmIG9iamVjdC5pbnN0YW5jZU1hdHJpeCApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlQ29sb3I7CgoJCQkJCX0KCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJY29uc3Qgbm9ybWFsaXplZCA9IGdlb21ldHJ5QXR0cmlidXRlLm5vcm1hbGl6ZWQ7CgkJCQkJCWNvbnN0IHNpemUgPSBnZW9tZXRyeUF0dHJpYnV0ZS5pdGVtU2l6ZTsKCgkJCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeUF0dHJpYnV0ZSApOwoKCQkJCQkJLy8gVE9ETyBBdHRyaWJ1dGUgbWF5IG5vdCBiZSBhdmFpbGFibGUgb24gY29udGV4dCByZXN0b3JlCgoJCQkJCQlpZiAoIGF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgY29udGludWU7CgoJCQkJCQljb25zdCBidWZmZXIgPSBhdHRyaWJ1dGUuYnVmZmVyOwoJCQkJCQljb25zdCB0eXBlID0gYXR0cmlidXRlLnR5cGU7CgkJCQkJCWNvbnN0IGJ5dGVzUGVyRWxlbWVudCA9IGF0dHJpYnV0ZS5ieXRlc1BlckVsZW1lbnQ7CgoJCQkJCQkvLyBjaGVjayBmb3IgaW50ZWdlciBhdHRyaWJ1dGVzCgoJCQkJCQljb25zdCBpbnRlZ2VyID0gKCB0eXBlID09PSBnbC5JTlQgfHwgdHlwZSA9PT0gZ2wuVU5TSUdORURfSU5UIHx8IGdlb21ldHJ5QXR0cmlidXRlLmdwdVR5cGUgPT09IEludFR5cGUgKTsKCgkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJCQljb25zdCBkYXRhID0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YTsKCQkJCQkJCWNvbnN0IHN0cmlkZSA9IGRhdGEuc3RyaWRlOwoJCQkJCQkJY29uc3Qgb2Zmc2V0ID0gZ2VvbWV0cnlBdHRyaWJ1dGUub2Zmc2V0OwoKCQkJCQkJCWlmICggZGF0YS5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyICkgewoKCQkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLCBkYXRhLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZGF0YS5tZXNoUGVyQXR0cmlidXRlICogZGF0YS5jb3VudDsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCQkJZW5hYmxlQXR0cmlidXRlKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJCWdsLmJpbmRCdWZmZXIoIGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyICk7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCXZlcnRleEF0dHJpYlBvaW50ZXIoCgkJCQkJCQkJCXByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLAoJCQkJCQkJCQlzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUsCgkJCQkJCQkJCXR5cGUsCgkJCQkJCQkJCW5vcm1hbGl6ZWQsCgkJCQkJCQkJCXN0cmlkZSAqIGJ5dGVzUGVyRWxlbWVudCwKCQkJCQkJCQkJKCBvZmZzZXQgKyAoIHNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSApICogaSApICogYnl0ZXNQZXJFbGVtZW50LAoJCQkJCQkJCQlpbnRlZ2VyCgkJCQkJCQkJKTsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCQkJZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksIGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZ2VvbWV0cnlBdHRyaWJ1dGUubWVzaFBlckF0dHJpYnV0ZSAqIGdlb21ldHJ5QXR0cmlidXRlLmNvdW50OwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCQllbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQkJZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCBidWZmZXIgKTsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJdmVydGV4QXR0cmliUG9pbnRlcigKCQkJCQkJCQkJcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksCgkJCQkJCQkJCXNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSwKCQkJCQkJCQkJdHlwZSwKCQkJCQkJCQkJbm9ybWFsaXplZCwKCQkJCQkJCQkJc2l6ZSAqIGJ5dGVzUGVyRWxlbWVudCwKCQkJCQkJCQkJKCBzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUgKSAqIGkgKiBieXRlc1BlckVsZW1lbnQsCgkJCQkJCQkJCWludGVnZXIKCQkJCQkJCQkpOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQljb25zdCB2YWx1ZSA9IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlc1sgbmFtZSBdOwoKCQkJCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCXN3aXRjaCAoIHZhbHVlLmxlbmd0aCApIHsKCgkJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWIyZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIDM6CgkJCQkJCQkJCWdsLnZlcnRleEF0dHJpYjNmdiggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiwgdmFsdWUgKTsKCQkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJCWNhc2UgNDoKCQkJCQkJCQkJZ2wudmVydGV4QXR0cmliNGZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoJCQkJCQkJCQlicmVhazsKCgkJCQkJCQkJZGVmYXVsdDoKCQkJCQkJCQkJZ2wudmVydGV4QXR0cmliMWZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzKCk7CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCXJlc2V0KCk7CgoJCQlmb3IgKCBjb25zdCBnZW9tZXRyeUlkIGluIGJpbmRpbmdTdGF0ZXMgKSB7CgoJCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5SWQgXTsKCgkJCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCgkJCQkJY29uc3Qgc3RhdGVNYXAgPSBwcm9ncmFtTWFwWyBwcm9ncmFtSWQgXTsKCgkJCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKCQkJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQkJCWRlbGV0ZSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgoJCQkJCX0KCgkJCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJCX0KCgkJCQlkZWxldGUgYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlbGVhc2VTdGF0ZXNPZkdlb21ldHJ5KCBnZW9tZXRyeSApIHsKCgkJCWlmICggYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCgkJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJCWZvciAoIGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCApIHsKCgkJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCgkJCQl9CgoJCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJfQoKCQkJZGVsZXRlIGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCX0KCgkJZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJCWZvciAoIGNvbnN0IGdlb21ldHJ5SWQgaW4gYmluZGluZ1N0YXRlcyApIHsKCgkJCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKCQkJCWlmICggcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCgkJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCgkJCQlmb3IgKCBjb25zdCB3aXJlZnJhbWUgaW4gc3RhdGVNYXAgKSB7CgoJCQkJCWRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCBzdGF0ZU1hcFsgd2lyZWZyYW1lIF0ub2JqZWN0ICk7CgoJCQkJCWRlbGV0ZSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgoJCQkJfQoKCQkJCWRlbGV0ZSBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF07CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVzZXQoKSB7CgoJCQlyZXNldERlZmF1bHRTdGF0ZSgpOwoJCQlmb3JjZVVwZGF0ZSA9IHRydWU7CgoJCQlpZiAoIGN1cnJlbnRTdGF0ZSA9PT0gZGVmYXVsdFN0YXRlICkgcmV0dXJuOwoKCQkJY3VycmVudFN0YXRlID0gZGVmYXVsdFN0YXRlOwoJCQliaW5kVmVydGV4QXJyYXlPYmplY3QoIGN1cnJlbnRTdGF0ZS5vYmplY3QgKTsKCgkJfQoKCQkvLyBmb3IgYmFja3dhcmQtY29tcGF0aWJpbGl0eQoKCQlmdW5jdGlvbiByZXNldERlZmF1bHRTdGF0ZSgpIHsKCgkJCWRlZmF1bHRTdGF0ZS5nZW9tZXRyeSA9IG51bGw7CgkJCWRlZmF1bHRTdGF0ZS5wcm9ncmFtID0gbnVsbDsKCQkJZGVmYXVsdFN0YXRlLndpcmVmcmFtZSA9IGZhbHNlOwoKCQl9CgoJCXJldHVybiB7CgoJCQlzZXR1cDogc2V0dXAsCgkJCXJlc2V0OiByZXNldCwKCQkJcmVzZXREZWZhdWx0U3RhdGU6IHJlc2V0RGVmYXVsdFN0YXRlLAoJCQlkaXNwb3NlOiBkaXNwb3NlLAoJCQlyZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeTogcmVsZWFzZVN0YXRlc09mR2VvbWV0cnksCgkJCXJlbGVhc2VTdGF0ZXNPZlByb2dyYW06IHJlbGVhc2VTdGF0ZXNPZlByb2dyYW0sCgoJCQlpbml0QXR0cmlidXRlczogaW5pdEF0dHJpYnV0ZXMsCgkJCWVuYWJsZUF0dHJpYnV0ZTogZW5hYmxlQXR0cmlidXRlLAoJCQlkaXNhYmxlVW51c2VkQXR0cmlidXRlczogZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMKCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xCdWZmZXJSZW5kZXJlciggZ2wsIGV4dGVuc2lvbnMsIGluZm8gKSB7CgoJCWxldCBtb2RlOwoKCQlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCgkJCW1vZGUgPSB2YWx1ZTsKCgkJfQoKCQlmdW5jdGlvbiByZW5kZXIoIHN0YXJ0LCBjb3VudCApIHsKCgkJCWdsLmRyYXdBcnJheXMoIG1vZGUsIHN0YXJ0LCBjb3VudCApOwoKCQkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCAxICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKCBzdGFydCwgY291bnQsIHByaW1jb3VudCApIHsKCgkJCWlmICggcHJpbWNvdW50ID09PSAwICkgcmV0dXJuOwoKCQkJZ2wuZHJhd0FycmF5c0luc3RhbmNlZCggbW9kZSwgc3RhcnQsIGNvdW50LCBwcmltY291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3KCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50ICkgewoKCQkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgoJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CgkJCWV4dGVuc2lvbi5tdWx0aURyYXdBcnJheXNXRUJHTCggbW9kZSwgc3RhcnRzLCAwLCBjb3VudHMsIDAsIGRyYXdDb3VudCApOwoKCQkJbGV0IGVsZW1lbnRDb3VudCA9IDA7CgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCgkJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF07CgoJCQl9CgoJCQlpbmZvLnVwZGF0ZSggZWxlbWVudENvdW50LCBtb2RlLCAxICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzKCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50LCBwcmltY291bnQgKSB7CgoJCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCgkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHN0YXJ0cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXJlbmRlckluc3RhbmNlcyggc3RhcnRzWyBpIF0sIGNvdW50c1sgaSBdLCBwcmltY291bnRbIGkgXSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0FycmF5c0luc3RhbmNlZFdFQkdMKCBtb2RlLCBzdGFydHMsIDAsIGNvdW50cywgMCwgcHJpbWNvdW50LCAwLCBkcmF3Q291bnQgKTsKCgkJCQlsZXQgZWxlbWVudENvdW50ID0gMDsKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCgkJCQkJZWxlbWVudENvdW50ICs9IGNvdW50c1sgaSBdICogcHJpbWNvdW50WyBpIF07CgoJCQkJfQoKCQkJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQl0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwoJCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3ID0gcmVuZGVyTXVsdGlEcmF3OwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzID0gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzOwoKCX0KCglmdW5jdGlvbiBXZWJHTENhcGFiaWxpdGllcyggZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHV0aWxzICkgewoKCQlsZXQgbWF4QW5pc290cm9weTsKCgkJZnVuY3Rpb24gZ2V0TWF4QW5pc290cm9weSgpIHsKCgkJCWlmICggbWF4QW5pc290cm9weSAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIG1heEFuaXNvdHJvcHk7CgoJCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApID09PSB0cnVlICkgewoKCQkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwoKCQkJCW1heEFuaXNvdHJvcHkgPSBnbC5nZXRQYXJhbWV0ZXIoIGV4dGVuc2lvbi5NQVhfVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJbWF4QW5pc290cm9weSA9IDA7CgoJCQl9CgoJCQlyZXR1cm4gbWF4QW5pc290cm9weTsKCgkJfQoKCQlmdW5jdGlvbiB0ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSB7CgoJCQlpZiAoIHRleHR1cmVGb3JtYXQgIT09IFJHQkFGb3JtYXQgJiYgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApICE9PSBnbC5nZXRQYXJhbWV0ZXIoIGdsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfRk9STUFUICkgKSB7CgoJCQkJcmV0dXJuIGZhbHNlOwoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJZnVuY3Rpb24gdGV4dHVyZVR5cGVSZWFkYWJsZSggdGV4dHVyZVR5cGUgKSB7CgoJCQljb25zdCBoYWxmRmxvYXRTdXBwb3J0ZWRCeUV4dCA9ICggdGV4dHVyZVR5cGUgPT09IEhhbGZGbG9hdFR5cGUgKSAmJiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApOwoKCQkJaWYgKCB0ZXh0dXJlVHlwZSAhPT0gVW5zaWduZWRCeXRlVHlwZSAmJiB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApICE9PSBnbC5nZXRQYXJhbWV0ZXIoIGdsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfVFlQRSApICYmIC8vIEVkZ2UgYW5kIENocm9tZSBNYWMgPCA1MiAoIzk1MTMpCgkJCQl0ZXh0dXJlVHlwZSAhPT0gRmxvYXRUeXBlICYmICEgaGFsZkZsb2F0U3VwcG9ydGVkQnlFeHQgKSB7CgoJCQkJcmV0dXJuIGZhbHNlOwoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0TWF4UHJlY2lzaW9uKCBwcmVjaXNpb24gKSB7CgoJCQlpZiAoIHByZWNpc2lvbiA9PT0gJ2hpZ2hwJyApIHsKCgkJCQlpZiAoIGdsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCggZ2wuVkVSVEVYX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgJiYKCQkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgoJCQkJCXJldHVybiAnaGlnaHAnOwoKCQkJCX0KCgkJCQlwcmVjaXNpb24gPSAnbWVkaXVtcCc7CgoJCQl9CgoJCQlpZiAoIHByZWNpc2lvbiA9PT0gJ21lZGl1bXAnICkgewoKCQkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5WRVJURVhfU0hBREVSLCBnbC5NRURJVU1fRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCgkJCQkJZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5GUkFHTUVOVF9TSEFERVIsIGdsLk1FRElVTV9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgoJCQkJCXJldHVybiAnbWVkaXVtcCc7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuICdsb3dwJzsKCgkJfQoKCQlsZXQgcHJlY2lzaW9uID0gcGFyYW1ldGVycy5wcmVjaXNpb24gIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucHJlY2lzaW9uIDogJ2hpZ2hwJzsKCQljb25zdCBtYXhQcmVjaXNpb24gPSBnZXRNYXhQcmVjaXNpb24oIHByZWNpc2lvbiApOwoKCQlpZiAoIG1heFByZWNpc2lvbiAhPT0gcHJlY2lzaW9uICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjonLCBwcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIG1heFByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoJCQlwcmVjaXNpb24gPSBtYXhQcmVjaXNpb247CgoJCX0KCgkJY29uc3QgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9PT0gdHJ1ZTsKCQljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSBwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA9PT0gdHJ1ZSAmJiBleHRlbnNpb25zLmhhcyggJ0VYVF9jbGlwX2NvbnRyb2wnICk7CgoJCWNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoJCWNvbnN0IG1heFZlcnRleFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkVSVEVYX1RFWFRVUkVfSU1BR0VfVU5JVFMgKTsKCQljb25zdCBtYXhUZXh0dXJlU2l6ZSA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1RFWFRVUkVfU0laRSApOwoJCWNvbnN0IG1heEN1YmVtYXBTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfQ1VCRV9NQVBfVEVYVFVSRV9TSVpFICk7CgoJCWNvbnN0IG1heEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwoJCWNvbnN0IG1heFZlcnRleFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkVSVEVYX1VOSUZPUk1fVkVDVE9SUyApOwoJCWNvbnN0IG1heFZhcnlpbmdzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkFSWUlOR19WRUNUT1JTICk7CgkJY29uc3QgbWF4RnJhZ21lbnRVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX0ZSQUdNRU5UX1VOSUZPUk1fVkVDVE9SUyApOwoKCQljb25zdCB2ZXJ0ZXhUZXh0dXJlcyA9IG1heFZlcnRleFRleHR1cmVzID4gMDsKCgkJY29uc3QgbWF4U2FtcGxlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1NBTVBMRVMgKTsKCgkJcmV0dXJuIHsKCgkJCWlzV2ViR0wyOiB0cnVlLCAvLyBrZWVwaW5nIHRoaXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgoJCQlnZXRNYXhBbmlzb3Ryb3B5OiBnZXRNYXhBbmlzb3Ryb3B5LAoJCQlnZXRNYXhQcmVjaXNpb246IGdldE1heFByZWNpc2lvbiwKCgkJCXRleHR1cmVGb3JtYXRSZWFkYWJsZTogdGV4dHVyZUZvcm1hdFJlYWRhYmxlLAoJCQl0ZXh0dXJlVHlwZVJlYWRhYmxlOiB0ZXh0dXJlVHlwZVJlYWRhYmxlLAoKCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgkJCWxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIsCgkJCXJldmVyc2VEZXB0aEJ1ZmZlcjogcmV2ZXJzZURlcHRoQnVmZmVyLAoKCQkJbWF4VGV4dHVyZXM6IG1heFRleHR1cmVzLAoJCQltYXhWZXJ0ZXhUZXh0dXJlczogbWF4VmVydGV4VGV4dHVyZXMsCgkJCW1heFRleHR1cmVTaXplOiBtYXhUZXh0dXJlU2l6ZSwKCQkJbWF4Q3ViZW1hcFNpemU6IG1heEN1YmVtYXBTaXplLAoKCQkJbWF4QXR0cmlidXRlczogbWF4QXR0cmlidXRlcywKCQkJbWF4VmVydGV4VW5pZm9ybXM6IG1heFZlcnRleFVuaWZvcm1zLAoJCQltYXhWYXJ5aW5nczogbWF4VmFyeWluZ3MsCgkJCW1heEZyYWdtZW50VW5pZm9ybXM6IG1heEZyYWdtZW50VW5pZm9ybXMsCgoJCQl2ZXJ0ZXhUZXh0dXJlczogdmVydGV4VGV4dHVyZXMsCgoJCQltYXhTYW1wbGVzOiBtYXhTYW1wbGVzCgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJbGV0IGdsb2JhbFN0YXRlID0gbnVsbCwKCQkJbnVtR2xvYmFsUGxhbmVzID0gMCwKCQkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZSwKCQkJcmVuZGVyaW5nU2hhZG93cyA9IGZhbHNlOwoKCQljb25zdCBwbGFuZSA9IG5ldyBQbGFuZSgpLAoJCQl2aWV3Tm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDMoKSwKCgkJCXVuaWZvcm0gPSB7IHZhbHVlOiBudWxsLCBuZWVkc1VwZGF0ZTogZmFsc2UgfTsKCgkJdGhpcy51bmlmb3JtID0gdW5pZm9ybTsKCQl0aGlzLm51bVBsYW5lcyA9IDA7CgkJdGhpcy5udW1JbnRlcnNlY3Rpb24gPSAwOwoKCQl0aGlzLmluaXQgPSBmdW5jdGlvbiAoIHBsYW5lcywgZW5hYmxlTG9jYWxDbGlwcGluZyApIHsKCgkJCWNvbnN0IGVuYWJsZWQgPQoJCQkJcGxhbmVzLmxlbmd0aCAhPT0gMCB8fAoJCQkJZW5hYmxlTG9jYWxDbGlwcGluZyB8fAoJCQkJLy8gZW5hYmxlIHN0YXRlIG9mIHByZXZpb3VzIGZyYW1lIC0gdGhlIGNsaXBwaW5nIGNvZGUgaGFzIHRvCgkJCQkvLyBydW4gYW5vdGhlciBmcmFtZSBpbiBvcmRlciB0byByZXNldCB0aGUgc3RhdGU6CgkJCQludW1HbG9iYWxQbGFuZXMgIT09IDAgfHwKCQkJCWxvY2FsQ2xpcHBpbmdFbmFibGVkOwoKCQkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBlbmFibGVMb2NhbENsaXBwaW5nOwoKCQkJbnVtR2xvYmFsUGxhbmVzID0gcGxhbmVzLmxlbmd0aDsKCgkJCXJldHVybiBlbmFibGVkOwoKCQl9OwoKCQl0aGlzLmJlZ2luU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJlbmRlcmluZ1NoYWRvd3MgPSB0cnVlOwoJCQlwcm9qZWN0UGxhbmVzKCBudWxsICk7CgoJCX07CgoJCXRoaXMuZW5kU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJlbmRlcmluZ1NoYWRvd3MgPSBmYWxzZTsKCgkJfTsKCgkJdGhpcy5zZXRHbG9iYWxTdGF0ZSA9IGZ1bmN0aW9uICggcGxhbmVzLCBjYW1lcmEgKSB7CgoJCQlnbG9iYWxTdGF0ZSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCAwICk7CgoJCX07CgoJCXRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsLCBjYW1lcmEsIHVzZUNhY2hlICkgewoKCQkJY29uc3QgcGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXMsCgkJCQljbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbiwKCQkJCWNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CgoJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCgkJCWlmICggISBsb2NhbENsaXBwaW5nRW5hYmxlZCB8fCBwbGFuZXMgPT09IG51bGwgfHwgcGxhbmVzLmxlbmd0aCA9PT0gMCB8fCByZW5kZXJpbmdTaGFkb3dzICYmICEgY2xpcFNoYWRvd3MgKSB7CgoJCQkJLy8gdGhlcmUncyBubyBsb2NhbCBjbGlwcGluZwoKCQkJCWlmICggcmVuZGVyaW5nU2hhZG93cyApIHsKCgkJCQkJLy8gdGhlcmUncyBubyBnbG9iYWwgY2xpcHBpbmcKCgkJCQkJcHJvamVjdFBsYW5lcyggbnVsbCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJlc2V0R2xvYmFsU3RhdGUoKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IG5HbG9iYWwgPSByZW5kZXJpbmdTaGFkb3dzID8gMCA6IG51bUdsb2JhbFBsYW5lcywKCQkJCQlsR2xvYmFsID0gbkdsb2JhbCAqIDQ7CgoJCQkJbGV0IGRzdEFycmF5ID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmNsaXBwaW5nU3RhdGUgfHwgbnVsbDsKCgkJCQl1bmlmb3JtLnZhbHVlID0gZHN0QXJyYXk7IC8vIGVuc3VyZSB1bmlxdWUgc3RhdGUKCgkJCQlkc3RBcnJheSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBsR2xvYmFsLCB1c2VDYWNoZSApOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbEdsb2JhbDsgKysgaSApIHsKCgkJCQkJZHN0QXJyYXlbIGkgXSA9IGdsb2JhbFN0YXRlWyBpIF07CgoJCQkJfQoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5jbGlwcGluZ1N0YXRlID0gZHN0QXJyYXk7CgkJCQl0aGlzLm51bUludGVyc2VjdGlvbiA9IGNsaXBJbnRlcnNlY3Rpb24gPyB0aGlzLm51bVBsYW5lcyA6IDA7CgkJCQl0aGlzLm51bVBsYW5lcyArPSBuR2xvYmFsOwoKCQkJfQoKCgkJfTsKCgkJZnVuY3Rpb24gcmVzZXRHbG9iYWxTdGF0ZSgpIHsKCgkJCWlmICggdW5pZm9ybS52YWx1ZSAhPT0gZ2xvYmFsU3RhdGUgKSB7CgoJCQkJdW5pZm9ybS52YWx1ZSA9IGdsb2JhbFN0YXRlOwoJCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IG51bUdsb2JhbFBsYW5lcyA+IDA7CgoJCQl9CgoJCQlzY29wZS5udW1QbGFuZXMgPSBudW1HbG9iYWxQbGFuZXM7CgkJCXNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CgoJCX0KCgkJZnVuY3Rpb24gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIGRzdE9mZnNldCwgc2tpcFRyYW5zZm9ybSApIHsKCgkJCWNvbnN0IG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMDsKCQkJbGV0IGRzdEFycmF5ID0gbnVsbDsKCgkJCWlmICggblBsYW5lcyAhPT0gMCApIHsKCgkJCQlkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CgoJCQkJaWYgKCBza2lwVHJhbnNmb3JtICE9PSB0cnVlIHx8IGRzdEFycmF5ID09PSBudWxsICkgewoKCQkJCQljb25zdCBmbGF0U2l6ZSA9IGRzdE9mZnNldCArIG5QbGFuZXMgKiA0LAoJCQkJCQl2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCQkJdmlld05vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIHZpZXdNYXRyaXggKTsKCgkJCQkJaWYgKCBkc3RBcnJheSA9PT0gbnVsbCB8fCBkc3RBcnJheS5sZW5ndGggPCBmbGF0U2l6ZSApIHsKCgkJCQkJCWRzdEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggZmxhdFNpemUgKTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGk0ID0gZHN0T2Zmc2V0OyBpICE9PSBuUGxhbmVzOyArKyBpLCBpNCArPSA0ICkgewoKCQkJCQkJcGxhbmUuY29weSggcGxhbmVzWyBpIF0gKS5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXgsIHZpZXdOb3JtYWxNYXRyaXggKTsKCgkJCQkJCXBsYW5lLm5vcm1hbC50b0FycmF5KCBkc3RBcnJheSwgaTQgKTsKCQkJCQkJZHN0QXJyYXlbIGk0ICsgMyBdID0gcGxhbmUuY29uc3RhbnQ7CgoJCQkJCX0KCgkJCQl9CgoJCQkJdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OwoJCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCQlzY29wZS5udW1QbGFuZXMgPSBuUGxhbmVzOwoJCQlzY29wZS5udW1JbnRlcnNlY3Rpb24gPSAwOwoKCQkJcmV0dXJuIGRzdEFycmF5OwoKCQl9CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQ3ViZU1hcHMoIHJlbmRlcmVyICkgewoKCQlsZXQgY3ViZW1hcHMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBtYXBUZXh0dXJlTWFwcGluZyggdGV4dHVyZSwgbWFwcGluZyApIHsKCgkJCWlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgKSB7CgoJCQkJdGV4dHVyZS5tYXBwaW5nID0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOwoKCQkJfSBlbHNlIGlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKSB7CgoJCQkJdGV4dHVyZS5tYXBwaW5nID0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOwoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCB0ZXh0dXJlICkgewoKCQkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKCQkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgoJCQkJaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyB8fCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyApIHsKCgkJCQkJaWYgKCBjdWJlbWFwcy5oYXMoIHRleHR1cmUgKSApIHsKCgkJCQkJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKS50ZXh0dXJlOwoJCQkJCQlyZXR1cm4gbWFwVGV4dHVyZU1hcHBpbmcoIGN1YmVtYXAsIHRleHR1cmUubWFwcGluZyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc3QgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKCQkJCQkJaWYgKCBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgewoKCQkJCQkJCWNvbnN0IHJlbmRlclRhcmdldCA9IG5ldyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQoIGltYWdlLmhlaWdodCApOwoJCQkJCQkJcmVuZGVyVGFyZ2V0LmZyb21FcXVpcmVjdGFuZ3VsYXJUZXh0dXJlKCByZW5kZXJlciwgdGV4dHVyZSApOwoJCQkJCQkJY3ViZW1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCQl0ZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKCQkJCQkJCXJldHVybiBtYXBUZXh0dXJlTWFwcGluZyggcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHRleHR1cmUubWFwcGluZyApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyBpbWFnZSBub3QgeWV0IHJlYWR5LiB0cnkgdGhlIGNvbnZlcnNpb24gbmV4dCBmcmFtZQoKCQkJCQkJCXJldHVybiBudWxsOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0KCgkJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggY3ViZW1hcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWN1YmVtYXBzLmRlbGV0ZSggdGV4dHVyZSApOwoJCQkJY3ViZW1hcC5kaXNwb3NlKCk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCWN1YmVtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJfQoKCQlyZXR1cm4gewoJCQlnZXQ6IGdldCwKCQkJZGlzcG9zZTogZGlzcG9zZQoJCX07CgoJfQoKCWNvbnN0IExPRF9NSU4gPSA0OwoKCS8vIFRoZSBzdGFuZGFyZCBkZXZpYXRpb25zIChyYWRpYW5zKSBhc3NvY2lhdGVkIHdpdGggdGhlIGV4dHJhIG1pcHMuIFRoZXNlIGFyZQoJLy8gY2hvc2VuIHRvIGFwcHJveGltYXRlIGEgVHJvd2JyaWRnZS1SZWl0eiBkaXN0cmlidXRpb24gZnVuY3Rpb24gdGltZXMgdGhlCgkvLyBnZW9tZXRyaWMgc2hhZG93aW5nIGZ1bmN0aW9uLiBUaGVzZSBzaWdtYSB2YWx1ZXMgc3F1YXJlZCBtdXN0IG1hdGNoIHRoZQoJLy8gdmFyaWFuY2UgI2RlZmluZXMgaW4gY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50Lmdsc2wuanMuCgljb25zdCBFWFRSQV9MT0RfU0lHTUEgPSBbIDAuMTI1LCAwLjIxNSwgMC4zNSwgMC40NDYsIDAuNTI2LCAwLjU4MiBdOwoKCS8vIFRoZSBtYXhpbXVtIGxlbmd0aCBvZiB0aGUgYmx1ciBmb3IgbG9vcC4gU21hbGxlciBzaWdtYXMgd2lsbCB1c2UgZmV3ZXIKCS8vIHNhbXBsZXMgYW5kIGV4aXQgZWFybHksIGJ1dCBub3QgcmVjb21waWxlIHRoZSBzaGFkZXIuCgljb25zdCBNQVhfU0FNUExFUyA9IDIwOwoKCWNvbnN0IF9mbGF0Q2FtZXJhID0gLypAX19QVVJFX18qLyBuZXcgT3J0aG9ncmFwaGljQ2FtZXJhKCk7Cgljb25zdCBfY2xlYXJDb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CglsZXQgX29sZFRhcmdldCA9IG51bGw7CglsZXQgX29sZEFjdGl2ZUN1YmVGYWNlID0gMDsKCWxldCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoJbGV0IF9vbGRYckVuYWJsZWQgPSBmYWxzZTsKCgkvLyBHb2xkZW4gUmF0aW8KCWNvbnN0IFBISSA9ICggMSArIE1hdGguc3FydCggNSApICkgLyAyOwoJY29uc3QgSU5WX1BISSA9IDEgLyBQSEk7CgoJLy8gVmVydGljZXMgb2YgYSBkb2RlY2FoZWRyb24gKGV4Y2VwdCB0aGUgb3Bwb3NpdGVzLCB3aGljaCByZXByZXNlbnQgdGhlCgkvLyBzYW1lIGF4aXMpLCB1c2VkIGFzIGF4aXMgZGlyZWN0aW9ucyBldmVubHkgc3ByZWFkIG9uIGEgc3BoZXJlLgoJY29uc3QgX2F4aXNEaXJlY3Rpb25zID0gWwoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0gUEhJLCBJTlZfUEhJLCAwICksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggUEhJLCBJTlZfUEhJLCAwICksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSBJTlZfUEhJLCAwLCBQSEkgKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCBJTlZfUEhJLCAwLCBQSEkgKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCBQSEksIC0gSU5WX1BISSApLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIFBISSwgSU5WX1BISSApLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0xLCAxLCAtMSApLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIC0xICksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLTEsIDEsIDEgKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAxLCAxLCAxICkgXTsKCgljb25zdCBfb3JpZ2luID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCS8qKgoJICogVGhpcyBjbGFzcyBnZW5lcmF0ZXMgYSBQcmVmaWx0ZXJlZCwgTWlwbWFwcGVkIFJhZGlhbmNlIEVudmlyb25tZW50IE1hcAoJICogKFBNUkVNKSBmcm9tIGEgY3ViZU1hcCBlbnZpcm9ubWVudCB0ZXh0dXJlLiBUaGlzIGFsbG93cyBkaWZmZXJlbnQgbGV2ZWxzIG9mCgkgKiBibHVyIHRvIGJlIHF1aWNrbHkgYWNjZXNzZWQgYmFzZWQgb24gbWF0ZXJpYWwgcm91Z2huZXNzLiBJdCBpcyBwYWNrZWQgaW50byBhCgkgKiBzcGVjaWFsIEN1YmVVViBmb3JtYXQgdGhhdCBhbGxvd3MgdXMgdG8gcGVyZm9ybSBjdXN0b20gaW50ZXJwb2xhdGlvbiBzbyB0aGF0CgkgKiB3ZSBjYW4gc3VwcG9ydCBub25saW5lYXIgZm9ybWF0cyBzdWNoIGFzIFJHQkUuIFVubGlrZSBhIHRyYWRpdGlvbmFsIG1pcG1hcAoJICogY2hhaW4sIGl0IG9ubHkgZ29lcyBkb3duIHRvIHRoZSBMT0RfTUlOIGxldmVsIChhYm92ZSksIGFuZCB0aGVuIGNyZWF0ZXMgZXh0cmEKCSAqIGV2ZW4gbW9yZSBmaWx0ZXJlZCAnbWlwcycgYXQgdGhlIHNhbWUgTE9EX01JTiByZXNvbHV0aW9uLCBhc3NvY2lhdGVkIHdpdGgKCSAqIGhpZ2hlciByb3VnaG5lc3MgbGV2ZWxzLiBJbiB0aGlzIHdheSB3ZSBtYWludGFpbiByZXNvbHV0aW9uIHRvIHNtb290aGx5CgkgKiBpbnRlcnBvbGF0ZSBkaWZmdXNlIGxpZ2h0aW5nIHdoaWxlIGxpbWl0aW5nIHNhbXBsaW5nIGNvbXB1dGF0aW9uLgoJICoKCSAqIFBhcGVyOiBGYXN0LCBBY2N1cmF0ZSBJbWFnZS1CYXNlZCBMaWdodGluZzoKCSAqIHtAbGluayBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vZmlsZS9kLzE1eThyX1VwS2xVOVN2VjRJTGIwQzNxQ1BlY1M4cHZMei92aWV3fQoJKi8KCWNsYXNzIFBNUkVNR2VuZXJhdG9yIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBQTVJFTSBnZW5lcmF0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCByZW5kZXJlciApIHsKCgkJCXRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CgkJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCXRoaXMuX2xvZE1heCA9IDA7CgkJCXRoaXMuX2N1YmVTaXplID0gMDsKCQkJdGhpcy5fbG9kUGxhbmVzID0gW107CgkJCXRoaXMuX3NpemVMb2RzID0gW107CgkJCXRoaXMuX3NpZ21hcyA9IFtdOwoKCQkJdGhpcy5fYmx1ck1hdGVyaWFsID0gbnVsbDsKCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gbnVsbDsKCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IG51bGw7CgoJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2JsdXJNYXRlcmlhbCApOwoKCQl9CgoJCS8qKgoJCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYSBzdXBwbGllZCBTY2VuZSwgd2hpY2ggY2FuIGJlIGZhc3RlciB0aGFuIHVzaW5nIGFuCgkJICogaW1hZ2UgaWYgbmV0d29ya2luZyBiYW5kd2lkdGggaXMgbG93LiBPcHRpb25hbCBzaWdtYSBzcGVjaWZpZXMgYSBibHVyIHJhZGl1cwoJCSAqIGluIHJhZGlhbnMgdG8gYmUgYXBwbGllZCB0byB0aGUgc2NlbmUgYmVmb3JlIFBNUkVNIGdlbmVyYXRpb24uIE9wdGlvbmFsIG5lYXIKCQkgKiBhbmQgZmFyIHBsYW5lcyBlbnN1cmUgdGhlIHNjZW5lIGlzIHJlbmRlcmVkIGluIGl0cyBlbnRpcmV0eS4KCQkgKgoJCSAqIEBwYXJhbSB7U2NlbmV9IHNjZW5lIC0gVGhlIHNjZW5lIHRvIGJlIGNhcHR1cmVkLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbc2lnbWE9MF0gLSBUaGUgYmx1ciByYWRpdXMgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW25lYXI9MC4xXSAtIFRoZSBuZWFyIHBsYW5lIGRpc3RhbmNlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZmFyPTEwMF0gLSBUaGUgZmFyIHBsYW5lIGRpc3RhbmNlLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gLSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5zaXplPTI1Nl0gLSBUaGUgdGV4dHVyZSBzaXplIG9mIHRoZSBQTVJFTS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25zLnJlbmRlclRhcmdldD1vcmlnaW5dIC0gVGhlIHBvc2l0aW9uIG9mIHRoZSBpbnRlcm5hbCBjdWJlIGNhbWVyYSB0aGF0IHJlbmRlcnMgdGhlIHNjZW5lLgoJCSAqIEByZXR1cm4ge1dlYkdMUmVuZGVyVGFyZ2V0fSBUaGUgcmVzdWx0aW5nIFBNUkVNLgoJCSAqLwoJCWZyb21TY2VuZSggc2NlbmUsIHNpZ21hID0gMCwgbmVhciA9IDAuMSwgZmFyID0gMTAwLCBvcHRpb25zID0ge30gKSB7CgoJCQljb25zdCB7CgkJCQlzaXplID0gMjU2LAoJCQkJcG9zaXRpb24gPSBfb3JpZ2luLAoJCQl9ID0gb3B0aW9uczsKCgkJCV9vbGRUYXJnZXQgPSB0aGlzLl9yZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJX29sZEFjdGl2ZUN1YmVGYWNlID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQkJX29sZEFjdGl2ZU1pcG1hcExldmVsID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCQkJX29sZFhyRW5hYmxlZCA9IHRoaXMuX3JlbmRlcmVyLnhyLmVuYWJsZWQ7CgoJCQl0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkID0gZmFsc2U7CgoJCQl0aGlzLl9zZXRTaXplKCBzaXplICk7CgoJCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSB0aGlzLl9hbGxvY2F0ZVRhcmdldHMoKTsKCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyID0gdHJ1ZTsKCgkJCXRoaXMuX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCwgcG9zaXRpb24gKTsKCgkJCWlmICggc2lnbWEgPiAwICkgewoKCQkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgc2lnbWEgKTsKCgkJCX0KCgkJCXRoaXMuX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCQl0aGlzLl9jbGVhbnVwKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCgkJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhbiBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSwgd2hpY2ggY2FuIGJlIGVpdGhlciBMRFIKCQkgKiBvciBIRFIuIFRoZSBpZGVhbCBpbnB1dCBpbWFnZSBzaXplIGlzIDFrICgxMDI0IHggNTEyKSwKCQkgKiBhcyB0aGlzIG1hdGNoZXMgYmVzdCB3aXRoIHRoZSAyNTYgeCAyNTYgY3ViZW1hcCBvdXRwdXQuCgkJICoKCQkgKiBAcGFyYW0ge1RleHR1cmV9IGVxdWlyZWN0YW5ndWxhciAtIFRoZSBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSB0byBiZSBjb252ZXJ0ZWQuCgkJICogQHBhcmFtIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFtyZW5kZXJUYXJnZXQ9bnVsbF0gLSBUaGUgcmVuZGVyIHRhcmdldCB0byB1c2UuCgkJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCgkJICovCgkJZnJvbUVxdWlyZWN0YW5ndWxhciggZXF1aXJlY3Rhbmd1bGFyLCByZW5kZXJUYXJnZXQgPSBudWxsICkgewoKCQkJcmV0dXJuIHRoaXMuX2Zyb21UZXh0dXJlKCBlcXVpcmVjdGFuZ3VsYXIsIHJlbmRlclRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYW4gY3ViZW1hcCB0ZXh0dXJlLCB3aGljaCBjYW4gYmUgZWl0aGVyIExEUgoJCSAqIG9yIEhEUi4gVGhlIGlkZWFsIGlucHV0IGN1YmUgc2l6ZSBpcyAyNTYgeCAyNTYsCgkJICogYXMgdGhpcyBtYXRjaGVzIGJlc3Qgd2l0aCB0aGUgMjU2IHggMjU2IGN1YmVtYXAgb3V0cHV0LgoJCSAqCgkJICogQHBhcmFtIHtUZXh0dXJlfSBjdWJlbWFwIC0gVGhlIGN1YmVtYXAgdGV4dHVyZSB0byBiZSBjb252ZXJ0ZWQuCgkJICogQHBhcmFtIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFtyZW5kZXJUYXJnZXQ9bnVsbF0gLSBUaGUgcmVuZGVyIHRhcmdldCB0byB1c2UuCgkJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCgkJICovCgkJZnJvbUN1YmVtYXAoIGN1YmVtYXAsIHJlbmRlclRhcmdldCA9IG51bGwgKSB7CgoJCQlyZXR1cm4gdGhpcy5fZnJvbVRleHR1cmUoIGN1YmVtYXAsIHJlbmRlclRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIFByZS1jb21waWxlcyB0aGUgY3ViZW1hcCBzaGFkZXIuIFlvdSBjYW4gZ2V0IGZhc3RlciBzdGFydC11cCBieSBpbnZva2luZyB0aGlzIG1ldGhvZCBkdXJpbmcKCQkgKiB5b3VyIHRleHR1cmUncyBuZXR3b3JrIGZldGNoIGZvciBpbmNyZWFzZWQgY29uY3VycmVuY3kuCgkJICovCgkJY29tcGlsZUN1YmVtYXBTaGFkZXIoKSB7CgoJCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPSBfZ2V0Q3ViZW1hcE1hdGVyaWFsKCk7CgkJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFByZS1jb21waWxlcyB0aGUgZXF1aXJlY3Rhbmd1bGFyIHNoYWRlci4gWW91IGNhbiBnZXQgZmFzdGVyIHN0YXJ0LXVwIGJ5IGludm9raW5nIHRoaXMgbWV0aG9kIGR1cmluZwoJCSAqIHlvdXIgdGV4dHVyZSdzIG5ldHdvcmsgZmV0Y2ggZm9yIGluY3JlYXNlZCBjb25jdXJyZW5jeS4KCQkgKi8KCQljb21waWxlRXF1aXJlY3Rhbmd1bGFyU2hhZGVyKCkgewoKCQkJaWYgKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID09PSBudWxsICkgewoKCQkJCXRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPSBfZ2V0RXF1aXJlY3RNYXRlcmlhbCgpOwoJCQkJdGhpcy5fY29tcGlsZU1hdGVyaWFsKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogRGlzcG9zZXMgb2YgdGhlIFBNUkVNR2VuZXJhdG9yJ3MgaW50ZXJuYWwgbWVtb3J5LiBOb3RlIHRoYXQgUE1SRU1HZW5lcmF0b3IgaXMgYSBzdGF0aWMgY2xhc3MsCgkJICogc28geW91IHNob3VsZCBub3QgbmVlZCBtb3JlIHRoYW4gb25lIFBNUkVNR2VuZXJhdG9yIG9iamVjdC4gSWYgeW91IGRvLCBjYWxsaW5nIGRpc3Bvc2UoKSBvbgoJCSAqIG9uZSBvZiB0aGVtIHdpbGwgY2F1c2UgYW55IG90aGVycyB0byBhbHNvIGJlY29tZSB1bnVzYWJsZS4KCQkgKi8KCQlkaXNwb3NlKCkgewoKCQkJdGhpcy5fZGlzcG9zZSgpOwoKCQkJaWYgKCB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwuZGlzcG9zZSgpOwoJCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJfQoKCQkvLyBwcml2YXRlIGludGVyZmFjZQoKCQlfc2V0U2l6ZSggY3ViZVNpemUgKSB7CgoJCQl0aGlzLl9sb2RNYXggPSBNYXRoLmZsb29yKCBNYXRoLmxvZzIoIGN1YmVTaXplICkgKTsKCQkJdGhpcy5fY3ViZVNpemUgPSBNYXRoLnBvdyggMiwgdGhpcy5fbG9kTWF4ICk7CgoJCX0KCgkJX2Rpc3Bvc2UoKSB7CgoJCQlpZiAoIHRoaXMuX2JsdXJNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMuX2JsdXJNYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQuZGlzcG9zZSgpOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fbG9kUGxhbmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl0aGlzLl9sb2RQbGFuZXNbIGkgXS5kaXNwb3NlKCk7CgoJCQl9CgoJCX0KCgkJX2NsZWFudXAoIG91dHB1dFRhcmdldCApIHsKCgkJCXRoaXMuX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggX29sZFRhcmdldCwgX29sZEFjdGl2ZUN1YmVGYWNlLCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZCA9IF9vbGRYckVuYWJsZWQ7CgoJCQlvdXRwdXRUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsKCQkJX3NldFZpZXdwb3J0KCBvdXRwdXRUYXJnZXQsIDAsIDAsIG91dHB1dFRhcmdldC53aWR0aCwgb3V0cHV0VGFyZ2V0LmhlaWdodCApOwoKCQl9CgoJCV9mcm9tVGV4dHVyZSggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgewoKCQkJaWYgKCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZsZWN0aW9uTWFwcGluZyB8fCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApIHsKCgkJCQl0aGlzLl9zZXRTaXplKCB0ZXh0dXJlLmltYWdlLmxlbmd0aCA9PT0gMCA/IDE2IDogKCB0ZXh0dXJlLmltYWdlWyAwIF0ud2lkdGggfHwgdGV4dHVyZS5pbWFnZVsgMCBdLmltYWdlLndpZHRoICkgKTsKCgkJCX0gZWxzZSB7IC8vIEVxdWlyZWN0YW5ndWxhcgoKCQkJCXRoaXMuX3NldFNpemUoIHRleHR1cmUuaW1hZ2Uud2lkdGggLyA0ICk7CgoJCQl9CgoJCQlfb2xkVGFyZ2V0ID0gdGhpcy5fcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJCV9vbGRBY3RpdmVDdWJlRmFjZSA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CgkJCV9vbGRBY3RpdmVNaXBtYXBMZXZlbCA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CgkJCV9vbGRYckVuYWJsZWQgPSB0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkOwoKCQkJdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKCQkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0IHx8IHRoaXMuX2FsbG9jYXRlVGFyZ2V0cygpOwoJCQl0aGlzLl90ZXh0dXJlVG9DdWJlVVYoIHRleHR1cmUsIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCQl0aGlzLl9hcHBseVBNUkVNKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCQkJdGhpcy5fY2xlYW51cCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgoJCQlyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKCQl9CgoJCV9hbGxvY2F0ZVRhcmdldHMoKSB7CgoJCQljb25zdCB3aWR0aCA9IDMgKiBNYXRoLm1heCggdGhpcy5fY3ViZVNpemUsIDE2ICogNyApOwoJCQljb25zdCBoZWlnaHQgPSA0ICogdGhpcy5fY3ViZVNpemU7CgoJCQljb25zdCBwYXJhbXMgPSB7CgkJCQltYWdGaWx0ZXI6IExpbmVhckZpbHRlciwKCQkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAoJCQkJZ2VuZXJhdGVNaXBtYXBzOiBmYWxzZSwKCQkJCXR5cGU6IEhhbGZGbG9hdFR5cGUsCgkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCQljb2xvclNwYWNlOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSwKCQkJCWRlcHRoQnVmZmVyOiBmYWxzZQoJCQl9OwoKCQkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgoJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0LndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldC5oZWlnaHQgIT09IGhlaWdodCApIHsKCgkJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgewoKCQkJCQl0aGlzLl9kaXNwb3NlKCk7CgoJCQkJfQoKCQkJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgoJCQkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwoJCQkJKCB7IHNpemVMb2RzOiB0aGlzLl9zaXplTG9kcywgbG9kUGxhbmVzOiB0aGlzLl9sb2RQbGFuZXMsIHNpZ21hczogdGhpcy5fc2lnbWFzIH0gPSBfY3JlYXRlUGxhbmVzKCBfbG9kTWF4ICkgKTsKCgkJCQl0aGlzLl9ibHVyTWF0ZXJpYWwgPSBfZ2V0Qmx1clNoYWRlciggX2xvZE1heCwgd2lkdGgsIGhlaWdodCApOwoKCQkJfQoKCQkJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCgkJfQoKCQlfY29tcGlsZU1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCgkJCWNvbnN0IHRtcE1lc2ggPSBuZXcgTWVzaCggdGhpcy5fbG9kUGxhbmVzWyAwIF0sIG1hdGVyaWFsICk7CgkJCXRoaXMuX3JlbmRlcmVyLmNvbXBpbGUoIHRtcE1lc2gsIF9mbGF0Q2FtZXJhICk7CgoJCX0KCgkJX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCwgcG9zaXRpb24gKSB7CgoJCQljb25zdCBmb3YgPSA5MDsKCQkJY29uc3QgYXNwZWN0ID0gMTsKCQkJY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggZm92LCBhc3BlY3QsIG5lYXIsIGZhciApOwoJCQljb25zdCB1cFNpZ24gPSBbIDEsIC0xLCAxLCAxLCAxLCAxIF07CgkJCWNvbnN0IGZvcndhcmRTaWduID0gWyAxLCAxLCAxLCAtMSwgLTEsIC0xIF07CgkJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgoJCQljb25zdCBvcmlnaW5hbEF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKCQkJY29uc3QgdG9uZU1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCQkJcmVuZGVyZXIuZ2V0Q2xlYXJDb2xvciggX2NsZWFyQ29sb3IgKTsKCgkJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgoJCQljb25zdCBiYWNrZ3JvdW5kTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsKCQkJCW5hbWU6ICdQTVJFTS5CYWNrZ3JvdW5kJywKCQkJCXNpZGU6IEJhY2tTaWRlLAoJCQkJZGVwdGhXcml0ZTogZmFsc2UsCgkJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQl9ICk7CgoJCQljb25zdCBiYWNrZ3JvdW5kQm94ID0gbmV3IE1lc2goIG5ldyBCb3hHZW9tZXRyeSgpLCBiYWNrZ3JvdW5kTWF0ZXJpYWwgKTsKCgkJCWxldCB1c2VTb2xpZENvbG9yID0gZmFsc2U7CgkJCWNvbnN0IGJhY2tncm91bmQgPSBzY2VuZS5iYWNrZ3JvdW5kOwoKCQkJaWYgKCBiYWNrZ3JvdW5kICkgewoKCQkJCWlmICggYmFja2dyb3VuZC5pc0NvbG9yICkgewoKCQkJCQliYWNrZ3JvdW5kTWF0ZXJpYWwuY29sb3IuY29weSggYmFja2dyb3VuZCApOwoJCQkJCXNjZW5lLmJhY2tncm91bmQgPSBudWxsOwoJCQkJCXVzZVNvbGlkQ29sb3IgPSB0cnVlOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJYmFja2dyb3VuZE1hdGVyaWFsLmNvbG9yLmNvcHkoIF9jbGVhckNvbG9yICk7CgkJCQl1c2VTb2xpZENvbG9yID0gdHJ1ZTsKCgkJCX0KCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJY29uc3QgY29sID0gaSAlIDM7CgoJCQkJaWYgKCBjb2wgPT09IDAgKSB7CgoJCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCB1cFNpZ25bIGkgXSwgMCApOwoJCQkJCWN1YmVDYW1lcmEucG9zaXRpb24uc2V0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CgkJCQkJY3ViZUNhbWVyYS5sb29rQXQoIHBvc2l0aW9uLnggKyBmb3J3YXJkU2lnblsgaSBdLCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CgoJCQkJfSBlbHNlIGlmICggY29sID09PSAxICkgewoKCQkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgMCwgdXBTaWduWyBpIF0gKTsKCQkJCQljdWJlQ2FtZXJhLnBvc2l0aW9uLnNldCggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwoJCQkJCWN1YmVDYW1lcmEubG9va0F0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55ICsgZm9yd2FyZFNpZ25bIGkgXSwgcG9zaXRpb24ueiApOwoKCgkJCQl9IGVsc2UgewoKCQkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgdXBTaWduWyBpIF0sIDAgKTsKCQkJCQljdWJlQ2FtZXJhLnBvc2l0aW9uLnNldCggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwoJCQkJCWN1YmVDYW1lcmEubG9va0F0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICsgZm9yd2FyZFNpZ25bIGkgXSApOwoKCQkJCX0KCgkJCQljb25zdCBzaXplID0gdGhpcy5fY3ViZVNpemU7CgoJCQkJX3NldFZpZXdwb3J0KCBjdWJlVVZSZW5kZXJUYXJnZXQsIGNvbCAqIHNpemUsIGkgPiAyID8gc2l6ZSA6IDAsIHNpemUsIHNpemUgKTsKCgkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKCQkJCWlmICggdXNlU29saWRDb2xvciApIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVyKCBiYWNrZ3JvdW5kQm94LCBjdWJlQ2FtZXJhICk7CgoJCQkJfQoKCQkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGN1YmVDYW1lcmEgKTsKCgkJCX0KCgkJCWJhY2tncm91bmRCb3guZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCQliYWNrZ3JvdW5kQm94Lm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gdG9uZU1hcHBpbmc7CgkJCXJlbmRlcmVyLmF1dG9DbGVhciA9IG9yaWdpbmFsQXV0b0NsZWFyOwoJCQlzY2VuZS5iYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCgkJfQoKCQlfdGV4dHVyZVRvQ3ViZVVWKCB0ZXh0dXJlLCBjdWJlVVZSZW5kZXJUYXJnZXQgKSB7CgoJCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoKCQkJY29uc3QgaXNDdWJlVGV4dHVyZSA9ICggdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgfHwgdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmcmFjdGlvbk1hcHBpbmcgKTsKCgkJCWlmICggaXNDdWJlVGV4dHVyZSApIHsKCgkJCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gX2dldEN1YmVtYXBNYXRlcmlhbCgpOwoKCQkJCX0KCgkJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IF9nZXRFcXVpcmVjdE1hdGVyaWFsKCk7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgbWF0ZXJpYWwgPSBpc0N1YmVUZXh0dXJlID8gdGhpcy5fY3ViZW1hcE1hdGVyaWFsIDogdGhpcy5fZXF1aXJlY3RNYXRlcmlhbDsKCQkJY29uc3QgbWVzaCA9IG5ldyBNZXNoKCB0aGlzLl9sb2RQbGFuZXNbIDAgXSwgbWF0ZXJpYWwgKTsKCgkJCWNvbnN0IHVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgoJCQl1bmlmb3Jtc1sgJ2Vudk1hcCcgXS52YWx1ZSA9IHRleHR1cmU7CgoJCQljb25zdCBzaXplID0gdGhpcy5fY3ViZVNpemU7CgoJCQlfc2V0Vmlld3BvcnQoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgMyAqIHNpemUsIDIgKiBzaXplICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIG1lc2gsIF9mbGF0Q2FtZXJhICk7CgoJCX0KCgkJX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCgkJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgkJCWNvbnN0IGF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgkJCWNvbnN0IG4gPSB0aGlzLl9sb2RQbGFuZXMubGVuZ3RoOwoKCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgbjsgaSArKyApIHsKCgkJCQljb25zdCBzaWdtYSA9IE1hdGguc3FydCggdGhpcy5fc2lnbWFzWyBpIF0gKiB0aGlzLl9zaWdtYXNbIGkgXSAtIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSAqIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSApOwoKCQkJCWNvbnN0IHBvbGVBeGlzID0gX2F4aXNEaXJlY3Rpb25zWyAoIG4gLSBpIC0gMSApICUgX2F4aXNEaXJlY3Rpb25zLmxlbmd0aCBdOwoKCQkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgaSAtIDEsIGksIHNpZ21hLCBwb2xlQXhpcyApOwoKCQkJfQoKCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gYXV0b0NsZWFyOwoKCQl9CgoJCS8qKgoJCSAqIFRoaXMgaXMgYSB0d28tcGFzcyBHYXVzc2lhbiBibHVyIGZvciBhIGN1YmVtYXAuIE5vcm1hbGx5IHRoaXMgaXMgZG9uZQoJCSAqIHZlcnRpY2FsbHkgYW5kIGhvcml6b250YWxseSwgYnV0IHRoaXMgYnJlYWtzIGRvd24gb24gYSBjdWJlLiBIZXJlIHdlIGFwcGx5CgkJICogdGhlIGJsdXIgbGF0aXR1ZGluYWxseSAoYXJvdW5kIHRoZSBwb2xlcyksIGFuZCB0aGVuIGxvbmdpdHVkaW5hbGx5ICh0b3dhcmRzCgkJICogdGhlIHBvbGVzKSB0byBhcHByb3hpbWF0ZSB0aGUgb3J0aG9nb25hbGx5LXNlcGFyYWJsZSBibHVyLiBJdCBpcyBsZWFzdAoJCSAqIGFjY3VyYXRlIGF0IHRoZSBwb2xlcywgYnV0IHN0aWxsIGRvZXMgYSBkZWNlbnQgam9iLgoJCSAqCgkJICogQHByaXZhdGUKCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyVGFyZ2V0fSBjdWJlVVZSZW5kZXJUYXJnZXQKCQkgKiBAcGFyYW0ge251bWJlcn0gbG9kSW4KCQkgKiBAcGFyYW0ge251bWJlcn0gbG9kT3V0CgkJICogQHBhcmFtIHtudW1iZXJ9IHNpZ21hCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbcG9sZUF4aXNdCgkJICovCgkJX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgbG9kSW4sIGxvZE91dCwgc2lnbWEsIHBvbGVBeGlzICkgewoKCQkJY29uc3QgcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldDsKCgkJCXRoaXMuX2hhbGZCbHVyKAoJCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LAoJCQkJcGluZ1BvbmdSZW5kZXJUYXJnZXQsCgkJCQlsb2RJbiwKCQkJCWxvZE91dCwKCQkJCXNpZ21hLAoJCQkJJ2xhdGl0dWRpbmFsJywKCQkJCXBvbGVBeGlzICk7CgoJCQl0aGlzLl9oYWxmQmx1cigKCQkJCXBpbmdQb25nUmVuZGVyVGFyZ2V0LAoJCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LAoJCQkJbG9kT3V0LAoJCQkJbG9kT3V0LAoJCQkJc2lnbWEsCgkJCQknbG9uZ2l0dWRpbmFsJywKCQkJCXBvbGVBeGlzICk7CgoJCX0KCgkJX2hhbGZCbHVyKCB0YXJnZXRJbiwgdGFyZ2V0T3V0LCBsb2RJbiwgbG9kT3V0LCBzaWdtYVJhZGlhbnMsIGRpcmVjdGlvbiwgcG9sZUF4aXMgKSB7CgoJCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoJCQljb25zdCBibHVyTWF0ZXJpYWwgPSB0aGlzLl9ibHVyTWF0ZXJpYWw7CgoJCQlpZiAoIGRpcmVjdGlvbiAhPT0gJ2xhdGl0dWRpbmFsJyAmJiBkaXJlY3Rpb24gIT09ICdsb25naXR1ZGluYWwnICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoCgkJCQkJJ2JsdXIgZGlyZWN0aW9uIG11c3QgYmUgZWl0aGVyIGxhdGl0dWRpbmFsIG9yIGxvbmdpdHVkaW5hbCEnICk7CgoJCQl9CgoJCQkvLyBOdW1iZXIgb2Ygc3RhbmRhcmQgZGV2aWF0aW9ucyBhdCB3aGljaCB0byBjdXQgb2ZmIHRoZSBkaXNjcmV0ZSBhcHByb3hpbWF0aW9uLgoJCQljb25zdCBTVEFOREFSRF9ERVZJQVRJT05TID0gMzsKCgkJCWNvbnN0IGJsdXJNZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgbG9kT3V0IF0sIGJsdXJNYXRlcmlhbCApOwoJCQljb25zdCBibHVyVW5pZm9ybXMgPSBibHVyTWF0ZXJpYWwudW5pZm9ybXM7CgoJCQljb25zdCBwaXhlbHMgPSB0aGlzLl9zaXplTG9kc1sgbG9kSW4gXSAtIDE7CgkJCWNvbnN0IHJhZGlhbnNQZXJQaXhlbCA9IGlzRmluaXRlKCBzaWdtYVJhZGlhbnMgKSA/IE1hdGguUEkgLyAoIDIgKiBwaXhlbHMgKSA6IDIgKiBNYXRoLlBJIC8gKCAyICogTUFYX1NBTVBMRVMgLSAxICk7CgkJCWNvbnN0IHNpZ21hUGl4ZWxzID0gc2lnbWFSYWRpYW5zIC8gcmFkaWFuc1BlclBpeGVsOwoJCQljb25zdCBzYW1wbGVzID0gaXNGaW5pdGUoIHNpZ21hUmFkaWFucyApID8gMSArIE1hdGguZmxvb3IoIFNUQU5EQVJEX0RFVklBVElPTlMgKiBzaWdtYVBpeGVscyApIDogTUFYX1NBTVBMRVM7CgoJCQlpZiAoIHNhbXBsZXMgPiBNQVhfU0FNUExFUyApIHsKCgkJCQljb25zb2xlLndhcm4oIGBzaWdtYVJhZGlhbnMsICR7CgkJCQlzaWdtYVJhZGlhbnN9LCBpcyB0b28gbGFyZ2UgYW5kIHdpbGwgY2xpcCwgYXMgaXQgcmVxdWVzdGVkICR7CgkJCQlzYW1wbGVzfSBzYW1wbGVzIHdoZW4gdGhlIG1heGltdW0gaXMgc2V0IHRvICR7TUFYX1NBTVBMRVN9YCApOwoKCQkJfQoKCQkJY29uc3Qgd2VpZ2h0cyA9IFtdOwoJCQlsZXQgc3VtID0gMDsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IE1BWF9TQU1QTEVTOyArKyBpICkgewoKCQkJCWNvbnN0IHggPSBpIC8gc2lnbWFQaXhlbHM7CgkJCQljb25zdCB3ZWlnaHQgPSBNYXRoLmV4cCggLSB4ICogeCAvIDIgKTsKCQkJCXdlaWdodHMucHVzaCggd2VpZ2h0ICk7CgoJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQlzdW0gKz0gd2VpZ2h0OwoKCQkJCX0gZWxzZSBpZiAoIGkgPCBzYW1wbGVzICkgewoKCQkJCQlzdW0gKz0gMiAqIHdlaWdodDsKCgkJCQl9CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB3ZWlnaHRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl3ZWlnaHRzWyBpIF0gPSB3ZWlnaHRzWyBpIF0gLyBzdW07CgoJCQl9CgoJCQlibHVyVW5pZm9ybXNbICdlbnZNYXAnIF0udmFsdWUgPSB0YXJnZXRJbi50ZXh0dXJlOwoJCQlibHVyVW5pZm9ybXNbICdzYW1wbGVzJyBdLnZhbHVlID0gc2FtcGxlczsKCQkJYmx1clVuaWZvcm1zWyAnd2VpZ2h0cycgXS52YWx1ZSA9IHdlaWdodHM7CgkJCWJsdXJVbmlmb3Jtc1sgJ2xhdGl0dWRpbmFsJyBdLnZhbHVlID0gZGlyZWN0aW9uID09PSAnbGF0aXR1ZGluYWwnOwoKCQkJaWYgKCBwb2xlQXhpcyApIHsKCgkJCQlibHVyVW5pZm9ybXNbICdwb2xlQXhpcycgXS52YWx1ZSA9IHBvbGVBeGlzOwoKCQkJfQoKCQkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwoJCQlibHVyVW5pZm9ybXNbICdkVGhldGEnIF0udmFsdWUgPSByYWRpYW5zUGVyUGl4ZWw7CgkJCWJsdXJVbmlmb3Jtc1sgJ21pcEludCcgXS52YWx1ZSA9IF9sb2RNYXggLSBsb2RJbjsKCgkJCWNvbnN0IG91dHB1dFNpemUgPSB0aGlzLl9zaXplTG9kc1sgbG9kT3V0IF07CgkJCWNvbnN0IHggPSAzICogb3V0cHV0U2l6ZSAqICggbG9kT3V0ID4gX2xvZE1heCAtIExPRF9NSU4gPyBsb2RPdXQgLSBfbG9kTWF4ICsgTE9EX01JTiA6IDAgKTsKCQkJY29uc3QgeSA9IDQgKiAoIHRoaXMuX2N1YmVTaXplIC0gb3V0cHV0U2l6ZSApOwoKCQkJX3NldFZpZXdwb3J0KCB0YXJnZXRPdXQsIHgsIHksIDMgKiBvdXRwdXRTaXplLCAyICogb3V0cHV0U2l6ZSApOwoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHRhcmdldE91dCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIGJsdXJNZXNoLCBfZmxhdENhbWVyYSApOwoKCQl9CgoJfQoKCgoJZnVuY3Rpb24gX2NyZWF0ZVBsYW5lcyggbG9kTWF4ICkgewoKCQljb25zdCBsb2RQbGFuZXMgPSBbXTsKCQljb25zdCBzaXplTG9kcyA9IFtdOwoJCWNvbnN0IHNpZ21hcyA9IFtdOwoKCQlsZXQgbG9kID0gbG9kTWF4OwoKCQljb25zdCB0b3RhbExvZHMgPSBsb2RNYXggLSBMT0RfTUlOICsgMSArIEVYVFJBX0xPRF9TSUdNQS5sZW5ndGg7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRvdGFsTG9kczsgaSArKyApIHsKCgkJCWNvbnN0IHNpemVMb2QgPSBNYXRoLnBvdyggMiwgbG9kICk7CgkJCXNpemVMb2RzLnB1c2goIHNpemVMb2QgKTsKCQkJbGV0IHNpZ21hID0gMS4wIC8gc2l6ZUxvZDsKCgkJCWlmICggaSA+IGxvZE1heCAtIExPRF9NSU4gKSB7CgoJCQkJc2lnbWEgPSBFWFRSQV9MT0RfU0lHTUFbIGkgLSBsb2RNYXggKyBMT0RfTUlOIC0gMSBdOwoKCQkJfSBlbHNlIGlmICggaSA9PT0gMCApIHsKCgkJCQlzaWdtYSA9IDA7CgoJCQl9CgoJCQlzaWdtYXMucHVzaCggc2lnbWEgKTsKCgkJCWNvbnN0IHRleGVsU2l6ZSA9IDEuMCAvICggc2l6ZUxvZCAtIDIgKTsKCQkJY29uc3QgbWluID0gLSB0ZXhlbFNpemU7CgkJCWNvbnN0IG1heCA9IDEgKyB0ZXhlbFNpemU7CgkJCWNvbnN0IHV2MSA9IFsgbWluLCBtaW4sIG1heCwgbWluLCBtYXgsIG1heCwgbWluLCBtaW4sIG1heCwgbWF4LCBtaW4sIG1heCBdOwoKCQkJY29uc3QgY3ViZUZhY2VzID0gNjsKCQkJY29uc3QgdmVydGljZXMgPSA2OwoJCQljb25zdCBwb3NpdGlvblNpemUgPSAzOwoJCQljb25zdCB1dlNpemUgPSAyOwoJCQljb25zdCBmYWNlSW5kZXhTaXplID0gMTsKCgkJCWNvbnN0IHBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25TaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCQkJY29uc3QgdXYgPSBuZXcgRmxvYXQzMkFycmF5KCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGN1YmVGYWNlcyApOwoJCQljb25zdCBmYWNlSW5kZXggPSBuZXcgRmxvYXQzMkFycmF5KCBmYWNlSW5kZXhTaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCgkJCWZvciAoIGxldCBmYWNlID0gMDsgZmFjZSA8IGN1YmVGYWNlczsgZmFjZSArKyApIHsKCgkJCQljb25zdCB4ID0gKCBmYWNlICUgMyApICogMiAvIDMgLSAxOwoJCQkJY29uc3QgeSA9IGZhY2UgPiAyID8gMCA6IC0xOwoJCQkJY29uc3QgY29vcmRpbmF0ZXMgPSBbCgkJCQkJeCwgeSwgMCwKCQkJCQl4ICsgMiAvIDMsIHksIDAsCgkJCQkJeCArIDIgLyAzLCB5ICsgMSwgMCwKCQkJCQl4LCB5LCAwLAoJCQkJCXggKyAyIC8gMywgeSArIDEsIDAsCgkJCQkJeCwgeSArIDEsIDAKCQkJCV07CgkJCQlwb3NpdGlvbi5zZXQoIGNvb3JkaW5hdGVzLCBwb3NpdGlvblNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCQkJCXV2LnNldCggdXYxLCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCQkJCWNvbnN0IGZpbGwgPSBbIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UgXTsKCQkJCWZhY2VJbmRleC5zZXQoIGZpbGwsIGZhY2VJbmRleFNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCgkJCX0KCgkJCWNvbnN0IHBsYW5lcyA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCQlwbGFuZXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgcG9zaXRpb25TaXplICkgKTsKCQkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdXYsIHV2U2l6ZSApICk7CgkJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICdmYWNlSW5kZXgnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBmYWNlSW5kZXgsIGZhY2VJbmRleFNpemUgKSApOwoJCQlsb2RQbGFuZXMucHVzaCggcGxhbmVzICk7CgoJCQlpZiAoIGxvZCA+IExPRF9NSU4gKSB7CgoJCQkJbG9kIC0tOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7IGxvZFBsYW5lcywgc2l6ZUxvZHMsIHNpZ21hcyB9OwoKCX0KCglmdW5jdGlvbiBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKSB7CgoJCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgkJY3ViZVVWUmVuZGVyVGFyZ2V0LnRleHR1cmUubWFwcGluZyA9IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOwoJCWN1YmVVVlJlbmRlclRhcmdldC50ZXh0dXJlLm5hbWUgPSAnUE1SRU0uY3ViZVV2JzsKCQljdWJlVVZSZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSB0cnVlOwoJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgoJfQoKCWZ1bmN0aW9uIF9zZXRWaWV3cG9ydCggdGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCQl0YXJnZXQudmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgkJdGFyZ2V0LnNjaXNzb3Iuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJfQoKCWZ1bmN0aW9uIF9nZXRCbHVyU2hhZGVyKCBsb2RNYXgsIHdpZHRoLCBoZWlnaHQgKSB7CgoJCWNvbnN0IHdlaWdodHMgPSBuZXcgRmxvYXQzMkFycmF5KCBNQVhfU0FNUExFUyApOwoJCWNvbnN0IHBvbGVBeGlzID0gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKCQljb25zdCBzaGFkZXJNYXRlcmlhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoKCQkJbmFtZTogJ1NwaGVyaWNhbEdhdXNzaWFuQmx1cicsCgoJCQlkZWZpbmVzOiB7CgkJCQknbic6IE1BWF9TQU1QTEVTLAoJCQkJJ0NVQkVVVl9URVhFTF9XSURUSCc6IDEuMCAvIHdpZHRoLAoJCQkJJ0NVQkVVVl9URVhFTF9IRUlHSFQnOiAxLjAgLyBoZWlnaHQsCgkJCQknQ1VCRVVWX01BWF9NSVAnOiBgJHtsb2RNYXh9LjBgLAoJCQl9LAoKCQkJdW5pZm9ybXM6IHsKCQkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0sCgkJCQknc2FtcGxlcyc6IHsgdmFsdWU6IDEgfSwKCQkJCSd3ZWlnaHRzJzogeyB2YWx1ZTogd2VpZ2h0cyB9LAoJCQkJJ2xhdGl0dWRpbmFsJzogeyB2YWx1ZTogZmFsc2UgfSwKCQkJCSdkVGhldGEnOiB7IHZhbHVlOiAwIH0sCgkJCQknbWlwSW50JzogeyB2YWx1ZTogMCB9LAoJCQkJJ3BvbGVBeGlzJzogeyB2YWx1ZTogcG9sZUF4aXMgfQoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgoJCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDsKCQkJdW5pZm9ybSBpbnQgc2FtcGxlczsKCQkJdW5pZm9ybSBmbG9hdCB3ZWlnaHRzWyBuIF07CgkJCXVuaWZvcm0gYm9vbCBsYXRpdHVkaW5hbDsKCQkJdW5pZm9ybSBmbG9hdCBkVGhldGE7CgkJCXVuaWZvcm0gZmxvYXQgbWlwSW50OwoJCQl1bmlmb3JtIHZlYzMgcG9sZUF4aXM7CgoJCQkjZGVmaW5lIEVOVk1BUF9UWVBFX0NVQkVfVVYKCQkJI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD4KCgkJCXZlYzMgZ2V0U2FtcGxlKCBmbG9hdCB0aGV0YSwgdmVjMyBheGlzICkgewoKCQkJCWZsb2F0IGNvc1RoZXRhID0gY29zKCB0aGV0YSApOwoJCQkJLy8gUm9kcmlndWVzJyBheGlzLWFuZ2xlIHJvdGF0aW9uCgkJCQl2ZWMzIHNhbXBsZURpcmVjdGlvbiA9IHZPdXRwdXREaXJlY3Rpb24gKiBjb3NUaGV0YQoJCQkJCSsgY3Jvc3MoIGF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKSAqIHNpbiggdGhldGEgKQoJCQkJCSsgYXhpcyAqIGRvdCggYXhpcywgdk91dHB1dERpcmVjdGlvbiApICogKCAxLjAgLSBjb3NUaGV0YSApOwoKCQkJCXJldHVybiBiaWxpbmVhckN1YmVVViggZW52TWFwLCBzYW1wbGVEaXJlY3Rpb24sIG1pcEludCApOwoKCQkJfQoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgYXhpcyA9IGxhdGl0dWRpbmFsID8gcG9sZUF4aXMgOiBjcm9zcyggcG9sZUF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKTsKCgkJCQlpZiAoIGFsbCggZXF1YWwoIGF4aXMsIHZlYzMoIDAuMCApICkgKSApIHsKCgkJCQkJYXhpcyA9IHZlYzMoIHZPdXRwdXREaXJlY3Rpb24ueiwgMC4wLCAtIHZPdXRwdXREaXJlY3Rpb24ueCApOwoKCQkJCX0KCgkJCQlheGlzID0gbm9ybWFsaXplKCBheGlzICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggMC4wLCAwLjAsIDAuMCwgMS4wICk7CgkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIDAgXSAqIGdldFNhbXBsZSggMC4wLCBheGlzICk7CgoJCQkJZm9yICggaW50IGkgPSAxOyBpIDwgbjsgaSsrICkgewoKCQkJCQlpZiAoIGkgPj0gc2FtcGxlcyApIHsKCgkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJCWZsb2F0IHRoZXRhID0gZFRoZXRhICogZmxvYXQoIGkgKTsKCQkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIGkgXSAqIGdldFNhbXBsZSggLTEuMCAqIHRoZXRhLCBheGlzICk7CgkJCQkJZ2xfRnJhZ0NvbG9yLnJnYiArPSB3ZWlnaHRzWyBpIF0gKiBnZXRTYW1wbGUoIHRoZXRhLCBheGlzICk7CgoJCQkJfQoKCQkJfQoJCWAsCgoJCQlibGVuZGluZzogTm9CbGVuZGluZywKCQkJZGVwdGhUZXN0OiBmYWxzZSwKCQkJZGVwdGhXcml0ZTogZmFsc2UKCgkJfSApOwoKCQlyZXR1cm4gc2hhZGVyTWF0ZXJpYWw7CgoJfQoKCWZ1bmN0aW9uIF9nZXRFcXVpcmVjdE1hdGVyaWFsKCkgewoKCQlyZXR1cm4gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgoJCQluYW1lOiAnRXF1aXJlY3Rhbmd1bGFyVG9DdWJlVVYnLAoKCQkJdW5pZm9ybXM6IHsKCQkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0KCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7CgoJCQkjaW5jbHVkZSA8Y29tbW9uPgoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgb3V0cHV0RGlyZWN0aW9uID0gbm9ybWFsaXplKCB2T3V0cHV0RGlyZWN0aW9uICk7CgkJCQl2ZWMyIHV2ID0gZXF1aXJlY3RVdiggb3V0cHV0RGlyZWN0aW9uICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggdGV4dHVyZTJEICggZW52TWFwLCB1diApLnJnYiwgMS4wICk7CgoJCQl9CgkJYCwKCgkJCWJsZW5kaW5nOiBOb0JsZW5kaW5nLAoJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQlkZXB0aFdyaXRlOiBmYWxzZQoKCQl9ICk7CgoJfQoKCWZ1bmN0aW9uIF9nZXRDdWJlbWFwTWF0ZXJpYWwoKSB7CgoJCXJldHVybiBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCgkJCW5hbWU6ICdDdWJlbWFwVG9DdWJlVVYnLAoKCQkJdW5pZm9ybXM6IHsKCQkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0sCgkJCQknZmxpcEVudk1hcCc6IHsgdmFsdWU6IC0xIH0KCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwOwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDsKCgkJCXZvaWQgbWFpbigpIHsKCgkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlQ3ViZSggZW52TWFwLCB2ZWMzKCBmbGlwRW52TWFwICogdk91dHB1dERpcmVjdGlvbi54LCB2T3V0cHV0RGlyZWN0aW9uLnl6ICkgKTsKCgkJCX0KCQlgLAoKCQkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCgkJCWRlcHRoVGVzdDogZmFsc2UsCgkJCWRlcHRoV3JpdGU6IGZhbHNlCgoJCX0gKTsKCgl9CgoJZnVuY3Rpb24gX2dldENvbW1vblZlcnRleFNoYWRlcigpIHsKCgkJcmV0dXJuIC8qIGdsc2wgKi9gCgoJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJYXR0cmlidXRlIGZsb2F0IGZhY2VJbmRleDsKCgkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCS8vIFJIIGNvb3JkaW5hdGUgc3lzdGVtOyBQTVJFTSBmYWNlLWluZGV4aW5nIGNvbnZlbnRpb24KCQl2ZWMzIGdldERpcmVjdGlvbiggdmVjMiB1diwgZmxvYXQgZmFjZSApIHsKCgkJCXV2ID0gMi4wICogdXYgLSAxLjA7CgoJCQl2ZWMzIGRpcmVjdGlvbiA9IHZlYzMoIHV2LCAxLjAgKTsKCgkJCWlmICggZmFjZSA9PSAwLjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnp5eDsgLy8gKCAxLCB2LCB1ICkgcG9zIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gMS4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHogKj0gLTEuMDsgLy8gKCAtdSwgMSwgLXYgKSBwb3MgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSAyLjAgKSB7CgoJCQkJZGlyZWN0aW9uLnggKj0gLTEuMDsgLy8gKCAtdSwgdiwgMSApIHBvcyB6CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24uenl4OwoJCQkJZGlyZWN0aW9uLnh6ICo9IC0xLjA7IC8vICggLTEsIHYsIC11ICkgbmVnIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHkgKj0gLTEuMDsgLy8gKCAtdSwgLTEsIHYgKSBuZWcgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSA1LjAgKSB7CgoJCQkJZGlyZWN0aW9uLnogKj0gLTEuMDsgLy8gKCB1LCB2LCAtMSApIG5lZyB6CgoJCQl9CgoJCQlyZXR1cm4gZGlyZWN0aW9uOwoKCQl9CgoJCXZvaWQgbWFpbigpIHsKCgkJCXZPdXRwdXREaXJlY3Rpb24gPSBnZXREaXJlY3Rpb24oIHV2LCBmYWNlSW5kZXggKTsKCQkJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7CgoJCX0KCWA7CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQ3ViZVVWTWFwcyggcmVuZGVyZXIgKSB7CgoJCWxldCBjdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJbGV0IHBtcmVtR2VuZXJhdG9yID0gbnVsbDsKCgkJZnVuY3Rpb24gZ2V0KCB0ZXh0dXJlICkgewoKCQkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKCQkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgoJCQkJY29uc3QgaXNFcXVpcmVjdE1hcCA9ICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgfHwgbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKTsKCQkJCWNvbnN0IGlzQ3ViZU1hcCA9ICggbWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApOwoKCQkJCS8vIGVxdWlyZWN0L2N1YmUgbWFwIHRvIGN1YmVVViBjb252ZXJzaW9uCgoJCQkJaWYgKCBpc0VxdWlyZWN0TWFwIHx8IGlzQ3ViZU1hcCApIHsKCgkJCQkJbGV0IHJlbmRlclRhcmdldCA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgoJCQkJCWNvbnN0IGN1cnJlbnRQTVJFTVZlcnNpb24gPSByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCA/IHJlbmRlclRhcmdldC50ZXh0dXJlLnBtcmVtVmVyc2lvbiA6IDA7CgoJCQkJCWlmICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgJiYgdGV4dHVyZS5wbXJlbVZlcnNpb24gIT09IGN1cnJlbnRQTVJFTVZlcnNpb24gKSB7CgoJCQkJCQlpZiAoIHBtcmVtR2VuZXJhdG9yID09PSBudWxsICkgcG1yZW1HZW5lcmF0b3IgPSBuZXcgUE1SRU1HZW5lcmF0b3IoIHJlbmRlcmVyICk7CgoJCQkJCQlyZW5kZXJUYXJnZXQgPSBpc0VxdWlyZWN0TWFwID8gcG1yZW1HZW5lcmF0b3IuZnJvbUVxdWlyZWN0YW5ndWxhciggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgOiBwbXJlbUdlbmVyYXRvci5mcm9tQ3ViZW1hcCggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICk7CgkJCQkJCXJlbmRlclRhcmdldC50ZXh0dXJlLnBtcmVtVmVyc2lvbiA9IHRleHR1cmUucG1yZW1WZXJzaW9uOwoKCQkJCQkJY3ViZVVWbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKCQkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKCgkJCQkJCQlpZiAoICggaXNFcXVpcmVjdE1hcCAmJiBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgfHwgKCBpc0N1YmVNYXAgJiYgaW1hZ2UgJiYgaXNDdWJlVGV4dHVyZUNvbXBsZXRlKCBpbWFnZSApICkgKSB7CgoJCQkJCQkJCWlmICggcG1yZW1HZW5lcmF0b3IgPT09IG51bGwgKSBwbXJlbUdlbmVyYXRvciA9IG5ldyBQTVJFTUdlbmVyYXRvciggcmVuZGVyZXIgKTsKCgkJCQkJCQkJcmVuZGVyVGFyZ2V0ID0gaXNFcXVpcmVjdE1hcCA/IHBtcmVtR2VuZXJhdG9yLmZyb21FcXVpcmVjdGFuZ3VsYXIoIHRleHR1cmUgKSA6IHBtcmVtR2VuZXJhdG9yLmZyb21DdWJlbWFwKCB0ZXh0dXJlICk7CgkJCQkJCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUucG1yZW1WZXJzaW9uID0gdGV4dHVyZS5wbXJlbVZlcnNpb247CgoJCQkJCQkJCWN1YmVVVm1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCQkJdGV4dHVyZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCQkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCS8vIGltYWdlIG5vdCB5ZXQgcmVhZHkuIHRyeSB0aGUgY29udmVyc2lvbiBuZXh0IGZyYW1lCgoJCQkJCQkJCXJldHVybiBudWxsOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiB0ZXh0dXJlOwoKCQl9CgoJCWZ1bmN0aW9uIGlzQ3ViZVRleHR1cmVDb21wbGV0ZSggaW1hZ2UgKSB7CgoJCQlsZXQgY291bnQgPSAwOwoJCQljb25zdCBsZW5ndGggPSA2OwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKCQkJCWlmICggaW1hZ2VbIGkgXSAhPT0gdW5kZWZpbmVkICkgY291bnQgKys7CgoJCQl9CgoJCQlyZXR1cm4gY291bnQgPT09IGxlbmd0aDsKCgoJCX0KCgkJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCWNvbnN0IGN1YmVtYXBVViA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlpZiAoIGN1YmVtYXBVViAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWN1YmVVVm1hcHMuZGVsZXRlKCB0ZXh0dXJlICk7CgkJCQljdWJlbWFwVVYuZGlzcG9zZSgpOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQljdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJCWlmICggcG1yZW1HZW5lcmF0b3IgIT09IG51bGwgKSB7CgoJCQkJcG1yZW1HZW5lcmF0b3IuZGlzcG9zZSgpOwoJCQkJcG1yZW1HZW5lcmF0b3IgPSBudWxsOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7CgkJCWdldDogZ2V0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xFeHRlbnNpb25zKCBnbCApIHsKCgkJY29uc3QgZXh0ZW5zaW9ucyA9IHt9OwoKCQlmdW5jdGlvbiBnZXRFeHRlbnNpb24oIG5hbWUgKSB7CgoJCQlpZiAoIGV4dGVuc2lvbnNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBleHRlbnNpb25zWyBuYW1lIF07CgoJCQl9CgoJCQlsZXQgZXh0ZW5zaW9uOwoKCQkJc3dpdGNoICggbmFtZSApIHsKCgkJCQljYXNlICdXRUJHTF9kZXB0aF90ZXh0dXJlJzoKCQkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9kZXB0aF90ZXh0dXJlJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9XRUJHTF9kZXB0aF90ZXh0dXJlJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9kZXB0aF90ZXh0dXJlJyApOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyc6CgkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Yyc6CgkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnOgoJCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApOwoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCBuYW1lICk7CgoJCQl9CgoJCQlleHRlbnNpb25zWyBuYW1lIF0gPSBleHRlbnNpb247CgoJCQlyZXR1cm4gZXh0ZW5zaW9uOwoKCQl9CgoJCXJldHVybiB7CgoJCQloYXM6IGZ1bmN0aW9uICggbmFtZSApIHsKCgkJCQlyZXR1cm4gZ2V0RXh0ZW5zaW9uKCBuYW1lICkgIT09IG51bGw7CgoJCQl9LAoKCQkJaW5pdDogZnVuY3Rpb24gKCkgewoKCQkJCWdldEV4dGVuc2lvbiggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9jbGlwX2N1bGxfZGlzdGFuY2UnICk7CgkJCQlnZXRFeHRlbnNpb24oICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICk7CgkJCQlnZXRFeHRlbnNpb24oICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9yZW5kZXJfc2hhcmVkX2V4cG9uZW50JyApOwoKCQkJfSwKCgkJCWdldDogZnVuY3Rpb24gKCBuYW1lICkgewoKCQkJCWNvbnN0IGV4dGVuc2lvbiA9IGdldEV4dGVuc2lvbiggbmFtZSApOwoKCQkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMUmVuZGVyZXI6ICcgKyBuYW1lICsgJyBleHRlbnNpb24gbm90IHN1cHBvcnRlZC4nICk7CgoJCQkJfQoKCQkJCXJldHVybiBleHRlbnNpb247CgoJCQl9CgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMR2VvbWV0cmllcyggZ2wsIGF0dHJpYnV0ZXMsIGluZm8sIGJpbmRpbmdTdGF0ZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJpZXMgPSB7fTsKCQljb25zdCB3aXJlZnJhbWVBdHRyaWJ1dGVzID0gbmV3IFdlYWtNYXAoKTsKCgkJZnVuY3Rpb24gb25HZW9tZXRyeURpc3Bvc2UoIGV2ZW50ICkgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBldmVudC50YXJnZXQ7CgoJCQlpZiAoIGdlb21ldHJ5LmluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBnZW9tZXRyeS5pbmRleCApOwoKCQkJfQoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBnZW9tZXRyeS5hdHRyaWJ1dGVzICkgewoKCQkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBnZW9tZXRyeS5hdHRyaWJ1dGVzWyBuYW1lIF0gKTsKCgkJCX0KCgkJCWdlb21ldHJ5LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25HZW9tZXRyeURpc3Bvc2UgKTsKCgkJCWRlbGV0ZSBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdOwoKCQkJY29uc3QgYXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgoJCQlpZiAoIGF0dHJpYnV0ZSApIHsKCgkJCQlhdHRyaWJ1dGVzLnJlbW92ZSggYXR0cmlidXRlICk7CgkJCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCgkJCX0KCgkJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgoJCQlpZiAoIGdlb21ldHJ5LmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgPT09IHRydWUgKSB7CgoJCQkJZGVsZXRlIGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50OwoKCQkJfQoKCQkJLy8KCgkJCWluZm8ubWVtb3J5Lmdlb21ldHJpZXMgLS07CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICkgewoKCQkJaWYgKCBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdID09PSB0cnVlICkgcmV0dXJuIGdlb21ldHJ5OwoKCQkJZ2VvbWV0cnkuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkdlb21ldHJ5RGlzcG9zZSApOwoKCQkJZ2VvbWV0cmllc1sgZ2VvbWV0cnkuaWQgXSA9IHRydWU7CgoJCQlpbmZvLm1lbW9yeS5nZW9tZXRyaWVzICsrOwoKCQkJcmV0dXJuIGdlb21ldHJ5OwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZSggZ2VvbWV0cnkgKSB7CgoJCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJLy8gVXBkYXRpbmcgaW5kZXggYnVmZmVyIGluIFZBTyBub3cuIFNlZSBXZWJHTEJpbmRpbmdTdGF0ZXMuCgoJCQlmb3IgKCBjb25zdCBuYW1lIGluIGdlb21ldHJ5QXR0cmlidXRlcyApIHsKCgkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF0sIGdsLkFSUkFZX0JVRkZFUiApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgoJCQljb25zdCBpbmRpY2VzID0gW107CgoJCQljb25zdCBnZW9tZXRyeUluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCWNvbnN0IGdlb21ldHJ5UG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQlsZXQgdmVyc2lvbiA9IDA7CgoJCQlpZiAoIGdlb21ldHJ5SW5kZXggIT09IG51bGwgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeUluZGV4LmFycmF5OwoJCQkJdmVyc2lvbiA9IGdlb21ldHJ5SW5kZXgudmVyc2lvbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpICs9IDMgKSB7CgoJCQkJCWNvbnN0IGEgPSBhcnJheVsgaSArIDAgXTsKCQkJCQljb25zdCBiID0gYXJyYXlbIGkgKyAxIF07CgkJCQkJY29uc3QgYyA9IGFycmF5WyBpICsgMiBdOwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBnZW9tZXRyeVBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeVBvc2l0aW9uLmFycmF5OwoJCQkJdmVyc2lvbiA9IGdlb21ldHJ5UG9zaXRpb24udmVyc2lvbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSAoIGFycmF5Lmxlbmd0aCAvIDMgKSAtIDE7IGkgPCBsOyBpICs9IDMgKSB7CgoJCQkJCWNvbnN0IGEgPSBpICsgMDsKCQkJCQljb25zdCBiID0gaSArIDE7CgkJCQkJY29uc3QgYyA9IGkgKyAyOwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IGF0dHJpYnV0ZSA9IG5ldyAoIGFycmF5TmVlZHNVaW50MzIoIGluZGljZXMgKSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSApKCBpbmRpY2VzLCAxICk7CgkJCWF0dHJpYnV0ZS52ZXJzaW9uID0gdmVyc2lvbjsKCgkJCS8vIFVwZGF0aW5nIGluZGV4IGJ1ZmZlciBpbiBWQU8gbm93LiBTZWUgV2ViR0xCaW5kaW5nU3RhdGVzCgoJCQkvLwoKCQkJY29uc3QgcHJldmlvdXNBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCgkJCWlmICggcHJldmlvdXNBdHRyaWJ1dGUgKSBhdHRyaWJ1dGVzLnJlbW92ZSggcHJldmlvdXNBdHRyaWJ1dGUgKTsKCgkJCS8vCgoJCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLnNldCggZ2VvbWV0cnksIGF0dHJpYnV0ZSApOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgoJCQljb25zdCBjdXJyZW50QXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgoJCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUgKSB7CgoJCQkJY29uc3QgZ2VvbWV0cnlJbmRleCA9IGdlb21ldHJ5LmluZGV4OwoKCQkJCWlmICggZ2VvbWV0cnlJbmRleCAhPT0gbnVsbCApIHsKCgkJCQkJLy8gaWYgdGhlIGF0dHJpYnV0ZSBpcyBvYnNvbGV0ZSwgY3JlYXRlIGEgbmV3IG9uZQoKCQkJCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUudmVyc2lvbiA8IGdlb21ldHJ5SW5kZXgudmVyc2lvbiApIHsKCgkJCQkJCXVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdXBkYXRlV2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoKCQkJfQoKCQkJcmV0dXJuIHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQl9CgoJCXJldHVybiB7CgoJCQlnZXQ6IGdldCwKCQkJdXBkYXRlOiB1cGRhdGUsCgoJCQlnZXRXaXJlZnJhbWVBdHRyaWJ1dGU6IGdldFdpcmVmcmFtZUF0dHJpYnV0ZQoKCQl9OwoKCX0KCglmdW5jdGlvbiBXZWJHTEluZGV4ZWRCdWZmZXJSZW5kZXJlciggZ2wsIGV4dGVuc2lvbnMsIGluZm8gKSB7CgoJCWxldCBtb2RlOwoKCQlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCgkJCW1vZGUgPSB2YWx1ZTsKCgkJfQoKCQlsZXQgdHlwZSwgYnl0ZXNQZXJFbGVtZW50OwoKCQlmdW5jdGlvbiBzZXRJbmRleCggdmFsdWUgKSB7CgoJCQl0eXBlID0gdmFsdWUudHlwZTsKCQkJYnl0ZXNQZXJFbGVtZW50ID0gdmFsdWUuYnl0ZXNQZXJFbGVtZW50OwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKCQkJZ2wuZHJhd0VsZW1lbnRzKCBtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgMSApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyggc3RhcnQsIGNvdW50LCBwcmltY291bnQgKSB7CgoJCQlpZiAoIHByaW1jb3VudCA9PT0gMCApIHJldHVybjsKCgkJCWdsLmRyYXdFbGVtZW50c0luc3RhbmNlZCggbW9kZSwgY291bnQsIHR5cGUsIHN0YXJ0ICogYnl0ZXNQZXJFbGVtZW50LCBwcmltY291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3KCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50ICkgewoKCQkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgoJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CgkJCWV4dGVuc2lvbi5tdWx0aURyYXdFbGVtZW50c1dFQkdMKCBtb2RlLCBjb3VudHMsIDAsIHR5cGUsIHN0YXJ0cywgMCwgZHJhd0NvdW50ICk7CgoJCQlsZXQgZWxlbWVudENvdW50ID0gMDsKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKCQkJCWVsZW1lbnRDb3VudCArPSBjb3VudHNbIGkgXTsKCgkJCX0KCgkJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzKCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50LCBwcmltY291bnQgKSB7CgoJCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCgkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHN0YXJ0cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXJlbmRlckluc3RhbmNlcyggc3RhcnRzWyBpIF0gLyBieXRlc1BlckVsZW1lbnQsIGNvdW50c1sgaSBdLCBwcmltY291bnRbIGkgXSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0VsZW1lbnRzSW5zdGFuY2VkV0VCR0woIG1vZGUsIGNvdW50cywgMCwgdHlwZSwgc3RhcnRzLCAwLCBwcmltY291bnQsIDAsIGRyYXdDb3VudCApOwoKCQkJCWxldCBlbGVtZW50Q291bnQgPSAwOwoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKCQkJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF0gKiBwcmltY291bnRbIGkgXTsKCgkJCQl9CgoJCQkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKCQkJfQoKCQl9CgoJCS8vCgoJCXRoaXMuc2V0TW9kZSA9IHNldE1vZGU7CgkJdGhpcy5zZXRJbmRleCA9IHNldEluZGV4OwoJCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3ID0gcmVuZGVyTXVsdGlEcmF3OwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzID0gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzOwoKCX0KCglmdW5jdGlvbiBXZWJHTEluZm8oIGdsICkgewoKCQljb25zdCBtZW1vcnkgPSB7CgkJCWdlb21ldHJpZXM6IDAsCgkJCXRleHR1cmVzOiAwCgkJfTsKCgkJY29uc3QgcmVuZGVyID0gewoJCQlmcmFtZTogMCwKCQkJY2FsbHM6IDAsCgkJCXRyaWFuZ2xlczogMCwKCQkJcG9pbnRzOiAwLAoJCQlsaW5lczogMAoJCX07CgoJCWZ1bmN0aW9uIHVwZGF0ZSggY291bnQsIG1vZGUsIGluc3RhbmNlQ291bnQgKSB7CgoJCQlyZW5kZXIuY2FsbHMgKys7CgoJCQlzd2l0Y2ggKCBtb2RlICkgewoKCQkJCWNhc2UgZ2wuVFJJQU5HTEVTOgoJCQkJCXJlbmRlci50cmlhbmdsZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLyAzICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBnbC5MSU5FUzoKCQkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLyAyICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBnbC5MSU5FX1NUUklQOgoJCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAtIDEgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlIGdsLkxJTkVfTE9PUDoKCQkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgZ2wuUE9JTlRTOgoJCQkJCXJlbmRlci5wb2ludHMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMSW5mbzogVW5rbm93biBkcmF3IG1vZGU6JywgbW9kZSApOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlc2V0KCkgewoKCQkJcmVuZGVyLmNhbGxzID0gMDsKCQkJcmVuZGVyLnRyaWFuZ2xlcyA9IDA7CgkJCXJlbmRlci5wb2ludHMgPSAwOwoJCQlyZW5kZXIubGluZXMgPSAwOwoKCQl9CgoJCXJldHVybiB7CgkJCW1lbW9yeTogbWVtb3J5LAoJCQlyZW5kZXI6IHJlbmRlciwKCQkJcHJvZ3JhbXM6IG51bGwsCgkJCWF1dG9SZXNldDogdHJ1ZSwKCQkJcmVzZXQ6IHJlc2V0LAoJCQl1cGRhdGU6IHVwZGF0ZQoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMTW9ycGh0YXJnZXRzKCBnbCwgY2FwYWJpbGl0aWVzLCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgbW9ycGhUZXh0dXJlcyA9IG5ldyBXZWFrTWFwKCk7CgkJY29uc3QgbW9ycGggPSBuZXcgVmVjdG9yNCgpOwoKCQlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKSB7CgoJCQljb25zdCBvYmplY3RJbmZsdWVuY2VzID0gb2JqZWN0Lm1vcnBoVGFyZ2V0SW5mbHVlbmNlczsKCgkJCS8vIHRoZSBmb2xsb3dpbmcgZW5jb2RlcyBtb3JwaCB0YXJnZXRzIGludG8gYW4gYXJyYXkgb2YgZGF0YSB0ZXh0dXJlcy4gRWFjaCBsYXllciByZXByZXNlbnRzIGEgc2luZ2xlIG1vcnBoIHRhcmdldC4KCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoJCQljb25zdCBtb3JwaFRhcmdldHNDb3VudCA9ICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApID8gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoIDogMDsKCgkJCWxldCBlbnRyeSA9IG1vcnBoVGV4dHVyZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQkJaWYgKCBlbnRyeSA9PT0gdW5kZWZpbmVkIHx8IGVudHJ5LmNvdW50ICE9PSBtb3JwaFRhcmdldHNDb3VudCApIHsKCgkJCQlpZiAoIGVudHJ5ICE9PSB1bmRlZmluZWQgKSBlbnRyeS50ZXh0dXJlLmRpc3Bvc2UoKTsKCgkJCQljb25zdCBoYXNNb3JwaFBvc2l0aW9uID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQ7CgkJCQljb25zdCBoYXNNb3JwaE5vcm1hbHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQ7CgkJCQljb25zdCBoYXNNb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkOwoKCQkJCWNvbnN0IG1vcnBoVGFyZ2V0cyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBbXTsKCQkJCWNvbnN0IG1vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgW107CgkJCQljb25zdCBtb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciB8fCBbXTsKCgkJCQlsZXQgdmVydGV4RGF0YUNvdW50ID0gMDsKCgkJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAxOwoJCQkJaWYgKCBoYXNNb3JwaE5vcm1hbHMgPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAyOwoJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHZlcnRleERhdGFDb3VudCA9IDM7CgoJCQkJbGV0IHdpZHRoID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCAqIHZlcnRleERhdGFDb3VudDsKCQkJCWxldCBoZWlnaHQgPSAxOwoKCQkJCWlmICggd2lkdGggPiBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKSB7CgoJCQkJCWhlaWdodCA9IE1hdGguY2VpbCggd2lkdGggLyBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKCQkJCQl3aWR0aCA9IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCgkJCQl9CgoJCQkJY29uc3QgYnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSggd2lkdGggKiBoZWlnaHQgKiA0ICogbW9ycGhUYXJnZXRzQ291bnQgKTsKCgkJCQljb25zdCB0ZXh0dXJlID0gbmV3IERhdGFBcnJheVRleHR1cmUoIGJ1ZmZlciwgd2lkdGgsIGhlaWdodCwgbW9ycGhUYXJnZXRzQ291bnQgKTsKCQkJCXRleHR1cmUudHlwZSA9IEZsb2F0VHlwZTsKCQkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCS8vIGZpbGwgYnVmZmVyCgoJCQkJY29uc3QgdmVydGV4RGF0YVN0cmlkZSA9IHZlcnRleERhdGFDb3VudCAqIDQ7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbW9ycGhUYXJnZXRzQ291bnQ7IGkgKysgKSB7CgoJCQkJCWNvbnN0IG1vcnBoVGFyZ2V0ID0gbW9ycGhUYXJnZXRzWyBpIF07CgkJCQkJY29uc3QgbW9ycGhOb3JtYWwgPSBtb3JwaE5vcm1hbHNbIGkgXTsKCQkJCQljb25zdCBtb3JwaENvbG9yID0gbW9ycGhDb2xvcnNbIGkgXTsKCgkJCQkJY29uc3Qgb2Zmc2V0ID0gd2lkdGggKiBoZWlnaHQgKiA0ICogaTsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbW9ycGhUYXJnZXQuY291bnQ7IGogKysgKSB7CgoJCQkJCQljb25zdCBzdHJpZGUgPSBqICogdmVydGV4RGF0YVN0cmlkZTsKCgkJCQkJCWlmICggaGFzTW9ycGhQb3NpdGlvbiA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaFRhcmdldCwgaiApOwoKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMCBdID0gbW9ycGgueDsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMSBdID0gbW9ycGgueTsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMiBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMyBdID0gMDsKCgkJCQkJCX0KCgkJCQkJCWlmICggaGFzTW9ycGhOb3JtYWxzID09PSB0cnVlICkgewoKCQkJCQkJCW1vcnBoLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoTm9ybWFsLCBqICk7CgoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA0IF0gPSBtb3JwaC54OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA1IF0gPSBtb3JwaC55OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA2IF0gPSBtb3JwaC56OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA3IF0gPSAwOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaENvbG9yLCBqICk7CgoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA4IF0gPSBtb3JwaC54OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA5IF0gPSBtb3JwaC55OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAxMCBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMTEgXSA9ICggbW9ycGhDb2xvci5pdGVtU2l6ZSA9PT0gNCApID8gbW9ycGgudyA6IDE7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJZW50cnkgPSB7CgkJCQkJY291bnQ6IG1vcnBoVGFyZ2V0c0NvdW50LAoJCQkJCXRleHR1cmU6IHRleHR1cmUsCgkJCQkJc2l6ZTogbmV3IFZlY3RvcjIoIHdpZHRoLCBoZWlnaHQgKQoJCQkJfTsKCgkJCQltb3JwaFRleHR1cmVzLnNldCggZ2VvbWV0cnksIGVudHJ5ICk7CgoJCQkJZnVuY3Rpb24gZGlzcG9zZVRleHR1cmUoKSB7CgoJCQkJCXRleHR1cmUuZGlzcG9zZSgpOwoKCQkJCQltb3JwaFRleHR1cmVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJZ2VvbWV0cnkucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlVGV4dHVyZSApOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIGRpc3Bvc2VUZXh0dXJlICk7CgoJCQl9CgoJCQkvLwoJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWUgJiYgb2JqZWN0Lm1vcnBoVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUZXh0dXJlJywgb2JqZWN0Lm1vcnBoVGV4dHVyZSwgdGV4dHVyZXMgKTsKCgkJCX0gZWxzZSB7CgoJCQkJbGV0IG1vcnBoSW5mbHVlbmNlc1N1bSA9IDA7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgb2JqZWN0SW5mbHVlbmNlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCW1vcnBoSW5mbHVlbmNlc1N1bSArPSBvYmplY3RJbmZsdWVuY2VzWyBpIF07CgoJCQkJfQoKCQkJCWNvbnN0IG1vcnBoQmFzZUluZmx1ZW5jZSA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlID8gMSA6IDEgLSBtb3JwaEluZmx1ZW5jZXNTdW07CgoKCQkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UnLCBtb3JwaEJhc2VJbmZsdWVuY2UgKTsKCQkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnLCBvYmplY3RJbmZsdWVuY2VzICk7CgoJCQl9CgoJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRzVGV4dHVyZScsIGVudHJ5LnRleHR1cmUsIHRleHR1cmVzICk7CgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZScsIGVudHJ5LnNpemUgKTsKCgkJfQoKCQlyZXR1cm4gewoKCQkJdXBkYXRlOiB1cGRhdGUKCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xPYmplY3RzKCBnbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApIHsKCgkJbGV0IHVwZGF0ZU1hcCA9IG5ldyBXZWFrTWFwKCk7CgoJCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0ICkgewoKCQkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoJCQljb25zdCBidWZmZXJnZW9tZXRyeSA9IGdlb21ldHJpZXMuZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICk7CgoJCQkvLyBVcGRhdGUgb25jZSBwZXIgZnJhbWUKCgkJCWlmICggdXBkYXRlTWFwLmdldCggYnVmZmVyZ2VvbWV0cnkgKSAhPT0gZnJhbWUgKSB7CgoJCQkJZ2VvbWV0cmllcy51cGRhdGUoIGJ1ZmZlcmdlb21ldHJ5ICk7CgoJCQkJdXBkYXRlTWFwLnNldCggYnVmZmVyZ2VvbWV0cnksIGZyYW1lICk7CgoJCQl9CgoJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggKSB7CgoJCQkJaWYgKCBvYmplY3QuaGFzRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICkgPT09IGZhbHNlICkgewoKCQkJCQlvYmplY3QuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICk7CgoJCQkJfQoKCQkJCWlmICggdXBkYXRlTWFwLmdldCggb2JqZWN0ICkgIT09IGZyYW1lICkgewoKCQkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggb2JqZWN0Lmluc3RhbmNlTWF0cml4LCBnbC5BUlJBWV9CVUZGRVIgKTsKCgkJCQkJaWYgKCBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCApIHsKCgkJCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBvYmplY3QuaW5zdGFuY2VDb2xvciwgZ2wuQVJSQVlfQlVGRkVSICk7CgoJCQkJCX0KCgkJCQkJdXBkYXRlTWFwLnNldCggb2JqZWN0LCBmcmFtZSApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJY29uc3Qgc2tlbGV0b24gPSBvYmplY3Quc2tlbGV0b247CgoJCQkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBza2VsZXRvbiApICE9PSBmcmFtZSApIHsKCgkJCQkJc2tlbGV0b24udXBkYXRlKCk7CgoJCQkJCXVwZGF0ZU1hcC5zZXQoIHNrZWxldG9uLCBmcmFtZSApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBidWZmZXJnZW9tZXRyeTsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJdXBkYXRlTWFwID0gbmV3IFdlYWtNYXAoKTsKCgkJfQoKCQlmdW5jdGlvbiBvbkluc3RhbmNlZE1lc2hEaXNwb3NlKCBldmVudCApIHsKCgkJCWNvbnN0IGluc3RhbmNlZE1lc2ggPSBldmVudC50YXJnZXQ7CgoJCQlpbnN0YW5jZWRNZXNoLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25JbnN0YW5jZWRNZXNoRGlzcG9zZSApOwoKCQkJYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VNYXRyaXggKTsKCgkJCWlmICggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VDb2xvciApOwoKCQl9CgoJCXJldHVybiB7CgoJCQl1cGRhdGU6IHVwZGF0ZSwKCQkJZGlzcG9zZTogZGlzcG9zZQoKCQl9OwoKCX0KCgkvKioKCSAqIFVuaWZvcm1zIG9mIGEgcHJvZ3JhbS4KCSAqIFRob3NlIGZvcm0gYSB0cmVlIHN0cnVjdHVyZSB3aXRoIGEgc3BlY2lhbCB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciB0aGUgcm9vdCwKCSAqIHdoaWNoIHlvdSBnZXQgYnkgY2FsbGluZyAnbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICknLgoJICoKCSAqCgkgKiBQcm9wZXJ0aWVzIG9mIGlubmVyIG5vZGVzIGluY2x1ZGluZyB0aGUgdG9wLWxldmVsIGNvbnRhaW5lcjoKCSAqCgkgKiAuc2VxIC0gYXJyYXkgb2YgbmVzdGVkIHVuaWZvcm1zCgkgKiAubWFwIC0gbmVzdGVkIHVuaWZvcm1zIGJ5IG5hbWUKCSAqCgkgKgoJICogTWV0aG9kcyBvZiBhbGwgbm9kZXMgZXhjZXB0IHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyOgoJICoKCSAqIC5zZXRWYWx1ZSggZ2wsIHZhbHVlLCBbdGV4dHVyZXNdICkKCSAqCgkgKiAJCXVwbG9hZHMgYSB1bmlmb3JtIHZhbHVlKHMpCgkgKiAgCXRoZSAndGV4dHVyZXMnIHBhcmFtZXRlciBpcyBuZWVkZWQgZm9yIHNhbXBsZXIgdW5pZm9ybXMKCSAqCgkgKgoJICogU3RhdGljIG1ldGhvZHMgb2YgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgKHRleHR1cmVzIGZhY3Rvcml6YXRpb25zKToKCSAqCgkgKiAudXBsb2FkKCBnbCwgc2VxLCB2YWx1ZXMsIHRleHR1cmVzICkKCSAqCgkgKiAJCXNldHMgdW5pZm9ybXMgaW4gJ3NlcScgdG8gJ3ZhbHVlc1tpZF0udmFsdWUnCgkgKgoJICogLnNlcVdpdGhWYWx1ZSggc2VxLCB2YWx1ZXMgKSA6IGZpbHRlcmVkU2VxCgkgKgoJICogCQlmaWx0ZXJzICdzZXEnIGVudHJpZXMgd2l0aCBjb3JyZXNwb25kaW5nIGVudHJ5IGluIHZhbHVlcwoJICoKCSAqCgkgKiBNZXRob2RzIG9mIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyICh0ZXh0dXJlcyBmYWN0b3JpemF0aW9ucyk6CgkgKgoJICogLnNldFZhbHVlKCBnbCwgbmFtZSwgdmFsdWUsIHRleHR1cmVzICkKCSAqCgkgKiAJCXNldHMgdW5pZm9ybSB3aXRoICBuYW1lICduYW1lJyB0byAndmFsdWUnCgkgKgoJICogLnNldE9wdGlvbmFsKCBnbCwgb2JqLCBwcm9wICkKCSAqCgkgKiAJCWxpa2UgLnNldCBmb3IgYW4gb3B0aW9uYWwgcHJvcGVydHkgb2YgdGhlIG9iamVjdAoJICoKCSAqLwoKCgljb25zdCBlbXB0eVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBUZXh0dXJlKCk7CgoJY29uc3QgZW1wdHlTaGFkb3dUZXh0dXJlID0gLypAX19QVVJFX18qLyBuZXcgRGVwdGhUZXh0dXJlKCAxLCAxICk7CgoJY29uc3QgZW1wdHlBcnJheVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEYXRhQXJyYXlUZXh0dXJlKCk7Cgljb25zdCBlbXB0eTNkVGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IERhdGEzRFRleHR1cmUoKTsKCWNvbnN0IGVtcHR5Q3ViZVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBDdWJlVGV4dHVyZSgpOwoKCS8vIC0tLSBVdGlsaXRpZXMgLS0tCgoJLy8gQXJyYXkgQ2FjaGVzIChwcm92aWRlIHR5cGVkIGFycmF5cyBmb3IgdGVtcG9yYXJ5IGJ5IHNpemUpCgoJY29uc3QgYXJyYXlDYWNoZUYzMiA9IFtdOwoJY29uc3QgYXJyYXlDYWNoZUkzMiA9IFtdOwoKCS8vIEZsb2F0MzJBcnJheSBjYWNoZXMgdXNlZCBmb3IgdXBsb2FkaW5nIE1hdHJpeCB1bmlmb3JtcwoKCWNvbnN0IG1hdDRhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDE2ICk7Cgljb25zdCBtYXQzYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA5ICk7Cgljb25zdCBtYXQyYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA0ICk7CgoJLy8gRmxhdHRlbmluZyBmb3IgYXJyYXlzIG9mIHZlY3RvcnMgYW5kIG1hdHJpY2VzCgoJZnVuY3Rpb24gZmxhdHRlbiggYXJyYXksIG5CbG9ja3MsIGJsb2NrU2l6ZSApIHsKCgkJY29uc3QgZmlyc3RFbGVtID0gYXJyYXlbIDAgXTsKCgkJaWYgKCBmaXJzdEVsZW0gPD0gMCB8fCBmaXJzdEVsZW0gPiAwICkgcmV0dXJuIGFycmF5OwoJCS8vIHVub3B0aW1pemVkOiAhIGlzTmFOKCBmaXJzdEVsZW0gKQoJCS8vIHNlZSBodHRwOi8vamFja3NvbmR1bnN0YW4uY29tL2FydGljbGVzLzk4MwoKCQljb25zdCBuID0gbkJsb2NrcyAqIGJsb2NrU2l6ZTsKCQlsZXQgciA9IGFycmF5Q2FjaGVGMzJbIG4gXTsKCgkJaWYgKCByID09PSB1bmRlZmluZWQgKSB7CgoJCQlyID0gbmV3IEZsb2F0MzJBcnJheSggbiApOwoJCQlhcnJheUNhY2hlRjMyWyBuIF0gPSByOwoKCQl9CgoJCWlmICggbkJsb2NrcyAhPT0gMCApIHsKCgkJCWZpcnN0RWxlbS50b0FycmF5KCByLCAwICk7CgoJCQlmb3IgKCBsZXQgaSA9IDEsIG9mZnNldCA9IDA7IGkgIT09IG5CbG9ja3M7ICsrIGkgKSB7CgoJCQkJb2Zmc2V0ICs9IGJsb2NrU2l6ZTsKCQkJCWFycmF5WyBpIF0udG9BcnJheSggciwgb2Zmc2V0ICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHI7CgoJfQoKCWZ1bmN0aW9uIGFycmF5c0VxdWFsKCBhLCBiICkgewoKCQlpZiAoIGEubGVuZ3RoICE9PSBiLmxlbmd0aCApIHJldHVybiBmYWxzZTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJaWYgKCBhWyBpIF0gIT09IGJbIGkgXSApIHJldHVybiBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJZnVuY3Rpb24gY29weUFycmF5KCBhLCBiICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBiLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlhWyBpIF0gPSBiWyBpIF07CgoJCX0KCgl9CgoJLy8gVGV4dHVyZSB1bml0IGFsbG9jYXRpb24KCglmdW5jdGlvbiBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApIHsKCgkJbGV0IHIgPSBhcnJheUNhY2hlSTMyWyBuIF07CgoJCWlmICggciA9PT0gdW5kZWZpbmVkICkgewoKCQkJciA9IG5ldyBJbnQzMkFycmF5KCBuICk7CgkJCWFycmF5Q2FjaGVJMzJbIG4gXSA9IHI7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJclsgaSBdID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwoKCQl9CgoJCXJldHVybiByOwoKCX0KCgkvLyAtLS0gU2V0dGVycyAtLS0KCgkvLyBOb3RlOiBEZWZpbmluZyB0aGVzZSBtZXRob2RzIGV4dGVybmFsbHksIGJlY2F1c2UgdGhleSBjb21lIGluIGEgYnVuY2gKCS8vIGFuZCB0aGlzIHdheSB0aGVpciBuYW1lcyBtaW5pZnkuCgoJLy8gU2luZ2xlIHNjYWxhcgoKCWZ1bmN0aW9uIHNldFZhbHVlVjFmKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0xZiggdGhpcy5hZGRyLCB2ICk7CgoJCWNhY2hlWyAwIF0gPSB2OwoKCX0KCgkvLyBTaW5nbGUgZmxvYXQgdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCglmdW5jdGlvbiBzZXRWYWx1ZVYyZiggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCQlnbC51bmlmb3JtMmYoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMmZ2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVYzZiggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgoJCQkJZ2wudW5pZm9ybTNmKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCQl9CgoJCX0gZWxzZSBpZiAoIHYuciAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnIgfHwgY2FjaGVbIDEgXSAhPT0gdi5nIHx8IGNhY2hlWyAyIF0gIT09IHYuYiApIHsKCgkJCQlnbC51bmlmb3JtM2YoIHRoaXMuYWRkciwgdi5yLCB2LmcsIHYuYiApOwoKCQkJCWNhY2hlWyAwIF0gPSB2LnI7CgkJCQljYWNoZVsgMSBdID0gdi5nOwoJCQkJY2FjaGVbIDIgXSA9IHYuYjsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtM2Z2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0ZiggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKCQkJCWdsLnVuaWZvcm00ZiggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgkJCQljYWNoZVsgMyBdID0gdi53OwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJCWdsLnVuaWZvcm00ZnYoIHRoaXMuYWRkciwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9CgoJfQoKCS8vIFNpbmdsZSBtYXRyaXggKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5NYXRyaXhOKQoKCWZ1bmN0aW9uIHNldFZhbHVlTTIoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCQlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCQltYXQyYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0MmFycmF5ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlTTMoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCQlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCQltYXQzYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0M2FycmF5ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlTTQoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCQlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCQltYXQ0YXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0NGFycmF5ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCQl9CgoJfQoKCS8vIFNpbmdsZSBpbnRlZ2VyIC8gYm9vbGVhbgoKCWZ1bmN0aW9uIHNldFZhbHVlVjFpKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB2ICk7CgoJCWNhY2hlWyAwIF0gPSB2OwoKCX0KCgkvLyBTaW5nbGUgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCglmdW5jdGlvbiBzZXRWYWx1ZVYyaSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCQlnbC51bmlmb3JtMmkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVYzaSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgoJCQkJZ2wudW5pZm9ybTNpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybTNpdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVWNGkoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56IHx8IGNhY2hlWyAzIF0gIT09IHYudyApIHsKCgkJCQlnbC51bmlmb3JtNGkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgoJCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCQljYWNoZVsgMiBdID0gdi56OwoJCQkJY2FjaGVbIDMgXSA9IHYudzsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtNGl2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCgkvLyBTaW5nbGUgdW5zaWduZWQgaW50ZWdlcgoKCWZ1bmN0aW9uIHNldFZhbHVlVjF1aSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCBjYWNoZVsgMCBdID09PSB2ICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMXVpKCB0aGlzLmFkZHIsIHYgKTsKCgkJY2FjaGVbIDAgXSA9IHY7CgoJfQoKCS8vIFNpbmdsZSB1bnNpZ25lZCBpbnRlZ2VyIHZlY3RvciAoZnJvbSBmbGF0IGFycmF5IG9yIFRIUkVFLlZlY3Rvck4pCgoJZnVuY3Rpb24gc2V0VmFsdWVWMnVpKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55ICkgewoKCQkJCWdsLnVuaWZvcm0ydWkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVWM3VpKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCgkJCQlnbC51bmlmb3JtM3VpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjR1aSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKCQkJCWdsLnVuaWZvcm00dWkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgoJCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCQljYWNoZVsgMiBdID0gdi56OwoJCQkJY2FjaGVbIDMgXSA9IHYudzsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtNHVpdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoKCS8vIFNpbmdsZSB0ZXh0dXJlICgyRCAvIEN1YmUpCgoJZnVuY3Rpb24gc2V0VmFsdWVUMSggZ2wsIHYsIHRleHR1cmVzICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJbGV0IGVtcHR5VGV4dHVyZTJEOwoKCQlpZiAoIHRoaXMudHlwZSA9PT0gZ2wuU0FNUExFUl8yRF9TSEFET1cgKSB7CgoJCQllbXB0eVNoYWRvd1RleHR1cmUuY29tcGFyZUZ1bmN0aW9uID0gTGVzc0VxdWFsQ29tcGFyZTsgLy8gIzI4NjcwCgkJCWVtcHR5VGV4dHVyZTJEID0gZW1wdHlTaGFkb3dUZXh0dXJlOwoKCQl9IGVsc2UgewoKCQkJZW1wdHlUZXh0dXJlMkQgPSBlbXB0eVRleHR1cmU7CgoJCX0KCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2IHx8IGVtcHR5VGV4dHVyZTJELCB1bml0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDNEMSggZ2wsIHYsIHRleHR1cmVzICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB2IHx8IGVtcHR5M2RUZXh0dXJlLCB1bml0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDYoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCgkJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJCWNhY2hlWyAwIF0gPSB1bml0OwoKCQl9CgoJCXRleHR1cmVzLnNldFRleHR1cmVDdWJlKCB2IHx8IGVtcHR5Q3ViZVRleHR1cmUsIHVuaXQgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheTEoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCgkJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJCWNhY2hlWyAwIF0gPSB1bml0OwoKCQl9CgoJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB2IHx8IGVtcHR5QXJyYXlUZXh0dXJlLCB1bml0ICk7CgoJfQoKCS8vIEhlbHBlciB0byBwaWNrIHRoZSByaWdodCBzZXR0ZXIgZm9yIHRoZSBzaW5ndWxhciBjYXNlCgoJZnVuY3Rpb24gZ2V0U2luZ3VsYXJTZXR0ZXIoIHR5cGUgKSB7CgoJCXN3aXRjaCAoIHR5cGUgKSB7CgoJCQljYXNlIDB4MTQwNjogcmV0dXJuIHNldFZhbHVlVjFmOyAvLyBGTE9BVAoJCQljYXNlIDB4OGI1MDogcmV0dXJuIHNldFZhbHVlVjJmOyAvLyBfVkVDMgoJCQljYXNlIDB4OGI1MTogcmV0dXJuIHNldFZhbHVlVjNmOyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1MjogcmV0dXJuIHNldFZhbHVlVjRmOyAvLyBfVkVDNAoKCQkJY2FzZSAweDhiNWE6IHJldHVybiBzZXRWYWx1ZU0yOyAvLyBfTUFUMgoJCQljYXNlIDB4OGI1YjogcmV0dXJuIHNldFZhbHVlTTM7IC8vIF9NQVQzCgkJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNDsgLy8gX01BVDQKCgkJCWNhc2UgMHgxNDA0OiBjYXNlIDB4OGI1NjogcmV0dXJuIHNldFZhbHVlVjFpOyAvLyBJTlQsIEJPT0wKCQkJY2FzZSAweDhiNTM6IGNhc2UgMHg4YjU3OiByZXR1cm4gc2V0VmFsdWVWMmk7IC8vIF9WRUMyCgkJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlVjNpOyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZVY0aTsgLy8gX1ZFQzQKCgkJCWNhc2UgMHgxNDA1OiByZXR1cm4gc2V0VmFsdWVWMXVpOyAvLyBVSU5UCgkJCWNhc2UgMHg4ZGM2OiByZXR1cm4gc2V0VmFsdWVWMnVpOyAvLyBfVkVDMgoJCQljYXNlIDB4OGRjNzogcmV0dXJuIHNldFZhbHVlVjN1aTsgLy8gX1ZFQzMKCQkJY2FzZSAweDhkYzg6IHJldHVybiBzZXRWYWx1ZVY0dWk7IC8vIF9WRUM0CgoJCQljYXNlIDB4OGI1ZTogLy8gU0FNUExFUl8yRAoJCQljYXNlIDB4OGQ2NjogLy8gU0FNUExFUl9FWFRFUk5BTF9PRVMKCQkJY2FzZSAweDhkY2E6IC8vIElOVF9TQU1QTEVSXzJECgkJCWNhc2UgMHg4ZGQyOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRAoJCQljYXNlIDB4OGI2MjogLy8gU0FNUExFUl8yRF9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQxOwoKCQkJY2FzZSAweDhiNWY6IC8vIFNBTVBMRVJfM0QKCQkJY2FzZSAweDhkY2I6IC8vIElOVF9TQU1QTEVSXzNECgkJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQkJcmV0dXJuIHNldFZhbHVlVDNEMTsKCgkJCWNhc2UgMHg4YjYwOiAvLyBTQU1QTEVSX0NVQkUKCQkJY2FzZSAweDhkY2M6IC8vIElOVF9TQU1QTEVSX0NVQkUKCQkJY2FzZSAweDhkZDQ6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSX0NVQkUKCQkJY2FzZSAweDhkYzU6IC8vIFNBTVBMRVJfQ1VCRV9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQ2OwoKCQkJY2FzZSAweDhkYzE6IC8vIFNBTVBMRVJfMkRfQVJSQVkKCQkJY2FzZSAweDhkY2Y6IC8vIElOVF9TQU1QTEVSXzJEX0FSUkFZCgkJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCQljYXNlIDB4OGRjNDogLy8gU0FNUExFUl8yRF9BUlJBWV9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQyREFycmF5MTsKCgkJfQoKCX0KCgoJLy8gQXJyYXkgb2Ygc2NhbGFycwoKCWZ1bmN0aW9uIHNldFZhbHVlVjFmQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMWZ2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLlZlY3Rvck4pCgoJZnVuY3Rpb24gc2V0VmFsdWVWMmZBcnJheSggZ2wsIHYgKSB7CgoJCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDIgKTsKCgkJZ2wudW5pZm9ybTJmdiggdGhpcy5hZGRyLCBkYXRhICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjNmQXJyYXkoIGdsLCB2ICkgewoKCQljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAzICk7CgoJCWdsLnVuaWZvcm0zZnYoIHRoaXMuYWRkciwgZGF0YSApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0ZkFycmF5KCBnbCwgdiApIHsKCgkJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgNCApOwoKCQlnbC51bmlmb3JtNGZ2KCB0aGlzLmFkZHIsIGRhdGEgKTsKCgl9CgoJLy8gQXJyYXkgb2YgbWF0cmljZXMgKGZyb20gZmxhdCBhcnJheSBvciBhcnJheSBvZiBUSFJFRS5NYXRyaXhOKQoKCWZ1bmN0aW9uIHNldFZhbHVlTTJBcnJheSggZ2wsIHYgKSB7CgoJCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDQgKTsKCgkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZU0zQXJyYXkoIGdsLCB2ICkgewoKCQljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA5ICk7CgoJCWdsLnVuaWZvcm1NYXRyaXgzZnYoIHRoaXMuYWRkciwgZmFsc2UsIGRhdGEgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVNNEFycmF5KCBnbCwgdiApIHsKCgkJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgMTYgKTsKCgkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKCX0KCgkvLyBBcnJheSBvZiBpbnRlZ2VyIC8gYm9vbGVhbgoKCWZ1bmN0aW9uIHNldFZhbHVlVjFpQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKCWZ1bmN0aW9uIHNldFZhbHVlVjJpQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVWM2lBcnJheSggZ2wsIHYgKSB7CgoJCWdsLnVuaWZvcm0zaXYoIHRoaXMuYWRkciwgdiApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0aUFycmF5KCBnbCwgdiApIHsKCgkJZ2wudW5pZm9ybTRpdiggdGhpcy5hZGRyLCB2ICk7CgoJfQoKCS8vIEFycmF5IG9mIHVuc2lnbmVkIGludGVnZXIKCglmdW5jdGlvbiBzZXRWYWx1ZVYxdWlBcnJheSggZ2wsIHYgKSB7CgoJCWdsLnVuaWZvcm0xdWl2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgdW5zaWduZWQgaW50ZWdlciB2ZWN0b3JzIChmcm9tIGZsYXQgYXJyYXkpCgoJZnVuY3Rpb24gc2V0VmFsdWVWMnVpQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjN1aUFycmF5KCBnbCwgdiApIHsKCgkJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0dWlBcnJheSggZ2wsIHYgKSB7CgoJCWdsLnVuaWZvcm00dWl2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoKCS8vIEFycmF5IG9mIHRleHR1cmVzICgyRCAvIDNEIC8gQ3ViZSAvIDJEQXJyYXkpCgoJZnVuY3Rpb24gc2V0VmFsdWVUMUFycmF5KCBnbCwgdiwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJY29uc3QgbiA9IHYubGVuZ3RoOwoKCQljb25zdCB1bml0cyA9IGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICk7CgoJCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB1bml0cyApOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCXRleHR1cmVzLnNldFRleHR1cmUyRCggdlsgaSBdIHx8IGVtcHR5VGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDNEQXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQljb25zdCBuID0gdi5sZW5ndGg7CgoJCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCgkJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCgkJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB2WyBpIF0gfHwgZW1wdHkzZFRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVQ2QXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQljb25zdCBuID0gdi5sZW5ndGg7CgoJCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCgkJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCgkJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHZbIGkgXSB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0c1sgaSBdICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheUFycmF5KCBnbCwgdiwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJY29uc3QgbiA9IHYubGVuZ3RoOwoKCQljb25zdCB1bml0cyA9IGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICk7CgoJCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB1bml0cyApOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB2WyBpIF0gfHwgZW1wdHlBcnJheVRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCgkJfQoKCX0KCgoJLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgYSBwdXJlIChib3R0b20tbGV2ZWwpIGFycmF5CgoJZnVuY3Rpb24gZ2V0UHVyZUFycmF5U2V0dGVyKCB0eXBlICkgewoKCQlzd2l0Y2ggKCB0eXBlICkgewoKCQkJY2FzZSAweDE0MDY6IHJldHVybiBzZXRWYWx1ZVYxZkFycmF5OyAvLyBGTE9BVAoJCQljYXNlIDB4OGI1MDogcmV0dXJuIHNldFZhbHVlVjJmQXJyYXk7IC8vIF9WRUMyCgkJCWNhc2UgMHg4YjUxOiByZXR1cm4gc2V0VmFsdWVWM2ZBcnJheTsgLy8gX1ZFQzMKCQkJY2FzZSAweDhiNTI6IHJldHVybiBzZXRWYWx1ZVY0ZkFycmF5OyAvLyBfVkVDNAoKCQkJY2FzZSAweDhiNWE6IHJldHVybiBzZXRWYWx1ZU0yQXJyYXk7IC8vIF9NQVQyCgkJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNM0FycmF5OyAvLyBfTUFUMwoJCQljYXNlIDB4OGI1YzogcmV0dXJuIHNldFZhbHVlTTRBcnJheTsgLy8gX01BVDQKCgkJCWNhc2UgMHgxNDA0OiBjYXNlIDB4OGI1NjogcmV0dXJuIHNldFZhbHVlVjFpQXJyYXk7IC8vIElOVCwgQk9PTAoJCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZVYyaUFycmF5OyAvLyBfVkVDMgoJCQljYXNlIDB4OGI1NDogY2FzZSAweDhiNTg6IHJldHVybiBzZXRWYWx1ZVYzaUFycmF5OyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZVY0aUFycmF5OyAvLyBfVkVDNAoKCQkJY2FzZSAweDE0MDU6IHJldHVybiBzZXRWYWx1ZVYxdWlBcnJheTsgLy8gVUlOVAoJCQljYXNlIDB4OGRjNjogcmV0dXJuIHNldFZhbHVlVjJ1aUFycmF5OyAvLyBfVkVDMgoJCQljYXNlIDB4OGRjNzogcmV0dXJuIHNldFZhbHVlVjN1aUFycmF5OyAvLyBfVkVDMwoJCQljYXNlIDB4OGRjODogcmV0dXJuIHNldFZhbHVlVjR1aUFycmF5OyAvLyBfVkVDNAoKCQkJY2FzZSAweDhiNWU6IC8vIFNBTVBMRVJfMkQKCQkJY2FzZSAweDhkNjY6IC8vIFNBTVBMRVJfRVhURVJOQUxfT0VTCgkJCWNhc2UgMHg4ZGNhOiAvLyBJTlRfU0FNUExFUl8yRAoJCQljYXNlIDB4OGRkMjogLy8gVU5TSUdORURfSU5UX1NBTVBMRVJfMkQKCQkJY2FzZSAweDhiNjI6IC8vIFNBTVBMRVJfMkRfU0hBRE9XCgkJCQlyZXR1cm4gc2V0VmFsdWVUMUFycmF5OwoKCQkJY2FzZSAweDhiNWY6IC8vIFNBTVBMRVJfM0QKCQkJY2FzZSAweDhkY2I6IC8vIElOVF9TQU1QTEVSXzNECgkJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQkJcmV0dXJuIHNldFZhbHVlVDNEQXJyYXk7CgoJCQljYXNlIDB4OGI2MDogLy8gU0FNUExFUl9DVUJFCgkJCWNhc2UgMHg4ZGNjOiAvLyBJTlRfU0FNUExFUl9DVUJFCgkJCWNhc2UgMHg4ZGQ0OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl9DVUJFCgkJCWNhc2UgMHg4ZGM1OiAvLyBTQU1QTEVSX0NVQkVfU0hBRE9XCgkJCQlyZXR1cm4gc2V0VmFsdWVUNkFycmF5OwoKCQkJY2FzZSAweDhkYzE6IC8vIFNBTVBMRVJfMkRfQVJSQVkKCQkJY2FzZSAweDhkY2Y6IC8vIElOVF9TQU1QTEVSXzJEX0FSUkFZCgkJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCQljYXNlIDB4OGRjNDogLy8gU0FNUExFUl8yRF9BUlJBWV9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQyREFycmF5QXJyYXk7CgoJCX0KCgl9CgoJLy8gLS0tIFVuaWZvcm0gQ2xhc3NlcyAtLS0KCgljbGFzcyBTaW5nbGVVbmlmb3JtIHsKCgkJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKCQkJdGhpcy5pZCA9IGlkOwoJCQl0aGlzLmFkZHIgPSBhZGRyOwoJCQl0aGlzLmNhY2hlID0gW107CgkJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKCQkJdGhpcy5zZXRWYWx1ZSA9IGdldFNpbmd1bGFyU2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCgkJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCgkJfQoKCX0KCgljbGFzcyBQdXJlQXJyYXlVbmlmb3JtIHsKCgkJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKCQkJdGhpcy5pZCA9IGlkOwoJCQl0aGlzLmFkZHIgPSBhZGRyOwoJCQl0aGlzLmNhY2hlID0gW107CgkJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKCQkJdGhpcy5zaXplID0gYWN0aXZlSW5mby5zaXplOwoJCQl0aGlzLnNldFZhbHVlID0gZ2V0UHVyZUFycmF5U2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCgkJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCgkJfQoKCX0KCgljbGFzcyBTdHJ1Y3R1cmVkVW5pZm9ybSB7CgoJCWNvbnN0cnVjdG9yKCBpZCApIHsKCgkJCXRoaXMuaWQgPSBpZDsKCgkJCXRoaXMuc2VxID0gW107CgkJCXRoaXMubWFwID0ge307CgoJCX0KCgkJc2V0VmFsdWUoIGdsLCB2YWx1ZSwgdGV4dHVyZXMgKSB7CgoJCQljb25zdCBzZXEgPSB0aGlzLnNlcTsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgdSA9IHNlcVsgaSBdOwoJCQkJdS5zZXRWYWx1ZSggZ2wsIHZhbHVlWyB1LmlkIF0sIHRleHR1cmVzICk7CgoJCQl9CgoJCX0KCgl9CgoJLy8gLS0tIFRvcC1sZXZlbCAtLS0KCgkvLyBQYXJzZXIgLSBidWlsZHMgdXAgdGhlIHByb3BlcnR5IHRyZWUgZnJvbSB0aGUgcGF0aCBzdHJpbmdzCgoJY29uc3QgUmVQYXRoUGFydCA9IC8oXHcrKShcXSk/KFxbfFwuKT8vZzsKCgkvLyBleHRyYWN0cwoJLy8gCS0gdGhlIGlkZW50aWZpZXIgKG1lbWJlciBuYW1lIG9yIGFycmF5IGluZGV4KQoJLy8gIC0gZm9sbG93ZWQgYnkgYW4gb3B0aW9uYWwgcmlnaHQgYnJhY2tldCAoZm91bmQgd2hlbiBhcnJheSBpbmRleCkKCS8vICAtIGZvbGxvd2VkIGJ5IGFuIG9wdGlvbmFsIGxlZnQgYnJhY2tldCBvciBkb3QgKHR5cGUgb2Ygc3Vic2NyaXB0KQoJLy8KCS8vIE5vdGU6IFRoZXNlIHBvcnRpb25zIGNhbiBiZSByZWFkIGluIGEgbm9uLW92ZXJsYXBwaW5nIGZhc2hpb24gYW5kCgkvLyBhbGxvdyBzdHJhaWdodGZvcndhcmQgcGFyc2luZyBvZiB0aGUgaGllcmFyY2h5IHRoYXQgV2ViR0wgZW5jb2RlcwoJLy8gaW4gdGhlIHVuaWZvcm0gbmFtZXMuCgoJZnVuY3Rpb24gYWRkVW5pZm9ybSggY29udGFpbmVyLCB1bmlmb3JtT2JqZWN0ICkgewoKCQljb250YWluZXIuc2VxLnB1c2goIHVuaWZvcm1PYmplY3QgKTsKCQljb250YWluZXIubWFwWyB1bmlmb3JtT2JqZWN0LmlkIF0gPSB1bmlmb3JtT2JqZWN0OwoKCX0KCglmdW5jdGlvbiBwYXJzZVVuaWZvcm0oIGFjdGl2ZUluZm8sIGFkZHIsIGNvbnRhaW5lciApIHsKCgkJY29uc3QgcGF0aCA9IGFjdGl2ZUluZm8ubmFtZSwKCQkJcGF0aExlbmd0aCA9IHBhdGgubGVuZ3RoOwoKCQkvLyByZXNldCBSZWdFeHAgb2JqZWN0LCBiZWNhdXNlIG9mIHRoZSBlYXJseSBleGl0IG9mIGEgcHJldmlvdXMgcnVuCgkJUmVQYXRoUGFydC5sYXN0SW5kZXggPSAwOwoKCQl3aGlsZSAoIHRydWUgKSB7CgoJCQljb25zdCBtYXRjaCA9IFJlUGF0aFBhcnQuZXhlYyggcGF0aCApLAoJCQkJbWF0Y2hFbmQgPSBSZVBhdGhQYXJ0Lmxhc3RJbmRleDsKCgkJCWxldCBpZCA9IG1hdGNoWyAxIF07CgkJCWNvbnN0IGlkSXNJbmRleCA9IG1hdGNoWyAyIF0gPT09ICddJywKCQkJCXN1YnNjcmlwdCA9IG1hdGNoWyAzIF07CgoJCQlpZiAoIGlkSXNJbmRleCApIGlkID0gaWQgfCAwOyAvLyBjb252ZXJ0IHRvIGludGVnZXIKCgkJCWlmICggc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgfHwgc3Vic2NyaXB0ID09PSAnWycgJiYgbWF0Y2hFbmQgKyAyID09PSBwYXRoTGVuZ3RoICkgewoKCQkJCS8vIGJhcmUgbmFtZSBvciAicHVyZSIgYm90dG9tLWxldmVsIGFycmF5ICJbMF0iIHN1ZmZpeAoKCQkJCWFkZFVuaWZvcm0oIGNvbnRhaW5lciwgc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgPwoJCQkJCW5ldyBTaW5nbGVVbmlmb3JtKCBpZCwgYWN0aXZlSW5mbywgYWRkciApIDoKCQkJCQluZXcgUHVyZUFycmF5VW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSApOwoKCQkJCWJyZWFrOwoKCQkJfSBlbHNlIHsKCgkJCQkvLyBzdGVwIGludG8gaW5uZXIgbm9kZSAvIGNyZWF0ZSBpdCBpbiBjYXNlIGl0IGRvZXNuJ3QgZXhpc3QKCgkJCQljb25zdCBtYXAgPSBjb250YWluZXIubWFwOwoJCQkJbGV0IG5leHQgPSBtYXBbIGlkIF07CgoJCQkJaWYgKCBuZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCW5leHQgPSBuZXcgU3RydWN0dXJlZFVuaWZvcm0oIGlkICk7CgkJCQkJYWRkVW5pZm9ybSggY29udGFpbmVyLCBuZXh0ICk7CgoJCQkJfQoKCQkJCWNvbnRhaW5lciA9IG5leHQ7CgoJCQl9CgoJCX0KCgl9CgoJLy8gUm9vdCBDb250YWluZXIKCgljbGFzcyBXZWJHTFVuaWZvcm1zIHsKCgkJY29uc3RydWN0b3IoIGdsLCBwcm9ncmFtICkgewoKCQkJdGhpcy5zZXEgPSBbXTsKCQkJdGhpcy5tYXAgPSB7fTsKCgkJCWNvbnN0IG4gPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5BQ1RJVkVfVU5JRk9STVMgKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZVVuaWZvcm0oIHByb2dyYW0sIGkgKSwKCQkJCQlhZGRyID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKCBwcm9ncmFtLCBpbmZvLm5hbWUgKTsKCgkJCQlwYXJzZVVuaWZvcm0oIGluZm8sIGFkZHIsIHRoaXMgKTsKCgkJCX0KCgkJfQoKCQlzZXRWYWx1ZSggZ2wsIG5hbWUsIHZhbHVlLCB0ZXh0dXJlcyApIHsKCgkJCWNvbnN0IHUgPSB0aGlzLm1hcFsgbmFtZSBdOwoKCQkJaWYgKCB1ICE9PSB1bmRlZmluZWQgKSB1LnNldFZhbHVlKCBnbCwgdmFsdWUsIHRleHR1cmVzICk7CgoJCX0KCgkJc2V0T3B0aW9uYWwoIGdsLCBvYmplY3QsIG5hbWUgKSB7CgoJCQljb25zdCB2ID0gb2JqZWN0WyBuYW1lIF07CgoJCQlpZiAoIHYgIT09IHVuZGVmaW5lZCApIHRoaXMuc2V0VmFsdWUoIGdsLCBuYW1lLCB2ICk7CgoJCX0KCgkJc3RhdGljIHVwbG9hZCggZ2wsIHNlcSwgdmFsdWVzLCB0ZXh0dXJlcyApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgdSA9IHNlcVsgaSBdLAoJCQkJCXYgPSB2YWx1ZXNbIHUuaWQgXTsKCgkJCQlpZiAoIHYubmVlZHNVcGRhdGUgIT09IGZhbHNlICkgewoKCQkJCQkvLyBub3RlOiBhbHdheXMgdXBkYXRpbmcgd2hlbiAubmVlZHNVcGRhdGUgaXMgdW5kZWZpbmVkCgkJCQkJdS5zZXRWYWx1ZSggZ2wsIHYudmFsdWUsIHRleHR1cmVzICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXN0YXRpYyBzZXFXaXRoVmFsdWUoIHNlcSwgdmFsdWVzICkgewoKCQkJY29uc3QgciA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQljb25zdCB1ID0gc2VxWyBpIF07CgkJCQlpZiAoIHUuaWQgaW4gdmFsdWVzICkgci5wdXNoKCB1ICk7CgoJCQl9CgoJCQlyZXR1cm4gcjsKCgkJfQoKCX0KCglmdW5jdGlvbiBXZWJHTFNoYWRlciggZ2wsIHR5cGUsIHN0cmluZyApIHsKCgkJY29uc3Qgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKCB0eXBlICk7CgoJCWdsLnNoYWRlclNvdXJjZSggc2hhZGVyLCBzdHJpbmcgKTsKCQlnbC5jb21waWxlU2hhZGVyKCBzaGFkZXIgKTsKCgkJcmV0dXJuIHNoYWRlcjsKCgl9CgoJLy8gRnJvbSBodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9leHRlbnNpb25zL0tIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZS8KCWNvbnN0IENPTVBMRVRJT05fU1RBVFVTX0tIUiA9IDB4OTFCMTsKCglsZXQgcHJvZ3JhbUlkQ291bnQgPSAwOwoKCWZ1bmN0aW9uIGhhbmRsZVNvdXJjZSggc3RyaW5nLCBlcnJvckxpbmUgKSB7CgoJCWNvbnN0IGxpbmVzID0gc3RyaW5nLnNwbGl0KCAnXG4nICk7CgkJY29uc3QgbGluZXMyID0gW107CgoJCWNvbnN0IGZyb20gPSBNYXRoLm1heCggZXJyb3JMaW5lIC0gNiwgMCApOwoJCWNvbnN0IHRvID0gTWF0aC5taW4oIGVycm9yTGluZSArIDYsIGxpbmVzLmxlbmd0aCApOwoKCQlmb3IgKCBsZXQgaSA9IGZyb207IGkgPCB0bzsgaSArKyApIHsKCgkJCWNvbnN0IGxpbmUgPSBpICsgMTsKCQkJbGluZXMyLnB1c2goIGAke2xpbmUgPT09IGVycm9yTGluZSA/ICc+JyA6ICcgJ30gJHtsaW5lfTogJHtsaW5lc1sgaSBdfWAgKTsKCgkJfQoKCQlyZXR1cm4gbGluZXMyLmpvaW4oICdcbicgKTsKCgl9CgoJY29uc3QgX20wID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpOwoKCWZ1bmN0aW9uIGdldEVuY29kaW5nQ29tcG9uZW50cyggY29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50Ll9nZXRNYXRyaXgoIF9tMCwgQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlLCBjb2xvclNwYWNlICk7CgoJCWNvbnN0IGVuY29kaW5nTWF0cml4ID0gYG1hdDMoICR7IF9tMC5lbGVtZW50cy5tYXAoICggdiApID0+IHYudG9GaXhlZCggNCApICkgfSApYDsKCgkJc3dpdGNoICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICkgKSB7CgoJCQljYXNlIExpbmVhclRyYW5zZmVyOgoJCQkJcmV0dXJuIFsgZW5jb2RpbmdNYXRyaXgsICdMaW5lYXJUcmFuc2Zlck9FVEYnIF07CgoJCQljYXNlIFNSR0JUcmFuc2ZlcjoKCQkJCXJldHVybiBbIGVuY29kaW5nTWF0cml4LCAnc1JHQlRyYW5zZmVyT0VURicgXTsKCgkJCWRlZmF1bHQ6CgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IFVuc3VwcG9ydGVkIGNvbG9yIHNwYWNlOiAnLCBjb2xvclNwYWNlICk7CgkJCQlyZXR1cm4gWyBlbmNvZGluZ01hdHJpeCwgJ0xpbmVhclRyYW5zZmVyT0VURicgXTsKCgkJfQoKCX0KCglmdW5jdGlvbiBnZXRTaGFkZXJFcnJvcnMoIGdsLCBzaGFkZXIsIHR5cGUgKSB7CgoJCWNvbnN0IHN0YXR1cyA9IGdsLmdldFNoYWRlclBhcmFtZXRlciggc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUyApOwoJCWNvbnN0IGVycm9ycyA9IGdsLmdldFNoYWRlckluZm9Mb2coIHNoYWRlciApLnRyaW0oKTsKCgkJaWYgKCBzdGF0dXMgJiYgZXJyb3JzID09PSAnJyApIHJldHVybiAnJzsKCgkJY29uc3QgZXJyb3JNYXRjaGVzID0gL0VSUk9SOiAwOihcZCspLy5leGVjKCBlcnJvcnMgKTsKCQlpZiAoIGVycm9yTWF0Y2hlcyApIHsKCgkJCS8vIC0tZW5hYmxlLXByaXZpbGVnZWQtd2ViZ2wtZXh0ZW5zaW9uCgkJCS8vIGNvbnNvbGUubG9nKCAnKionICsgdHlwZSArICcqKicsIGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlYnVnX3NoYWRlcnMnICkuZ2V0VHJhbnNsYXRlZFNoYWRlclNvdXJjZSggc2hhZGVyICkgKTsKCgkJCWNvbnN0IGVycm9yTGluZSA9IHBhcnNlSW50KCBlcnJvck1hdGNoZXNbIDEgXSApOwoJCQlyZXR1cm4gdHlwZS50b1VwcGVyQ2FzZSgpICsgJ1xuXG4nICsgZXJyb3JzICsgJ1xuXG4nICsgaGFuZGxlU291cmNlKCBnbC5nZXRTaGFkZXJTb3VyY2UoIHNoYWRlciApLCBlcnJvckxpbmUgKTsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBlcnJvcnM7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGNvbG9yU3BhY2UgKSB7CgoJCWNvbnN0IGNvbXBvbmVudHMgPSBnZXRFbmNvZGluZ0NvbXBvbmVudHMoIGNvbG9yU3BhY2UgKTsKCgkJcmV0dXJuIFsKCgkJCWB2ZWM0ICR7ZnVuY3Rpb25OYW1lfSggdmVjNCB2YWx1ZSApIHtgLAoKCQkJYAlyZXR1cm4gJHtjb21wb25lbnRzWyAxIF19KCB2ZWM0KCB2YWx1ZS5yZ2IgKiAke2NvbXBvbmVudHNbIDAgXX0sIHZhbHVlLmEgKSApO2AsCgoJCQknfScsCgoJCV0uam9pbiggJ1xuJyApOwoKCX0KCglmdW5jdGlvbiBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIHRvbmVNYXBwaW5nICkgewoKCQlsZXQgdG9uZU1hcHBpbmdOYW1lOwoKCQlzd2l0Y2ggKCB0b25lTWFwcGluZyApIHsKCgkJCWNhc2UgTGluZWFyVG9uZU1hcHBpbmc6CgkJCQl0b25lTWFwcGluZ05hbWUgPSAnTGluZWFyJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBSZWluaGFyZFRvbmVNYXBwaW5nOgoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ1JlaW5oYXJkJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBDaW5lb25Ub25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDaW5lb24nOwoJCQkJYnJlYWs7CgoJCQljYXNlIEFDRVNGaWxtaWNUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBQ0VTRmlsbWljJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBBZ1hUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBZ1gnOwoJCQkJYnJlYWs7CgoJCQljYXNlIE5ldXRyYWxUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdOZXV0cmFsJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBDdXN0b21Ub25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDdXN0b20nOwoJCQkJYnJlYWs7CgoJCQlkZWZhdWx0OgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xQcm9ncmFtOiBVbnN1cHBvcnRlZCB0b25lTWFwcGluZzonLCB0b25lTWFwcGluZyApOwoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0xpbmVhcic7CgoJCX0KCgkJcmV0dXJuICd2ZWMzICcgKyBmdW5jdGlvbk5hbWUgKyAnKCB2ZWMzIGNvbG9yICkgeyByZXR1cm4gJyArIHRvbmVNYXBwaW5nTmFtZSArICdUb25lTWFwcGluZyggY29sb3IgKTsgfSc7CgoJfQoKCWNvbnN0IF92MCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCglmdW5jdGlvbiBnZXRMdW1pbmFuY2VGdW5jdGlvbigpIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmdldEx1bWluYW5jZUNvZWZmaWNpZW50cyggX3YwICk7CgoJCWNvbnN0IHIgPSBfdjAueC50b0ZpeGVkKCA0ICk7CgkJY29uc3QgZyA9IF92MC55LnRvRml4ZWQoIDQgKTsKCQljb25zdCBiID0gX3YwLnoudG9GaXhlZCggNCApOwoKCQlyZXR1cm4gWwoKCQkJJ2Zsb2F0IGx1bWluYW5jZSggY29uc3QgaW4gdmVjMyByZ2IgKSB7JywKCgkJCWAJY29uc3QgdmVjMyB3ZWlnaHRzID0gdmVjMyggJHsgciB9LCAkeyBnIH0sICR7IGIgfSApO2AsCgoJCQknCXJldHVybiBkb3QoIHdlaWdodHMsIHJnYiApOycsCgoJCQknfScKCgkJXS5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlVmVydGV4RXh0ZW5zaW9ucyggcGFyYW1ldGVycyApIHsKCgkJY29uc3QgY2h1bmtzID0gWwoJCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2UgPyAnI2V4dGVuc2lvbiBHTF9BTkdMRV9jbGlwX2N1bGxfZGlzdGFuY2UgOiByZXF1aXJlJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbk11bHRpRHJhdyA/ICcjZXh0ZW5zaW9uIEdMX0FOR0xFX211bHRpX2RyYXcgOiByZXF1aXJlJyA6ICcnLAoJCV07CgoJCXJldHVybiBjaHVua3MuZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApIHsKCgkJY29uc3QgY2h1bmtzID0gW107CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gZGVmaW5lcyApIHsKCgkJCWNvbnN0IHZhbHVlID0gZGVmaW5lc1sgbmFtZSBdOwoKCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCgkJCWNodW5rcy5wdXNoKCAnI2RlZmluZSAnICsgbmFtZSArICcgJyArIHZhbHVlICk7CgoJCX0KCgkJcmV0dXJuIGNodW5rcy5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApIHsKCgkJY29uc3QgYXR0cmlidXRlcyA9IHt9OwoKCQljb25zdCBuID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuQUNUSVZFX0FUVFJJQlVURVMgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgaSArKyApIHsKCgkJCWNvbnN0IGluZm8gPSBnbC5nZXRBY3RpdmVBdHRyaWIoIHByb2dyYW0sIGkgKTsKCQkJY29uc3QgbmFtZSA9IGluZm8ubmFtZTsKCgkJCWxldCBsb2NhdGlvblNpemUgPSAxOwoJCQlpZiAoIGluZm8udHlwZSA9PT0gZ2wuRkxPQVRfTUFUMiApIGxvY2F0aW9uU2l6ZSA9IDI7CgkJCWlmICggaW5mby50eXBlID09PSBnbC5GTE9BVF9NQVQzICkgbG9jYXRpb25TaXplID0gMzsKCQkJaWYgKCBpbmZvLnR5cGUgPT09IGdsLkZMT0FUX01BVDQgKSBsb2NhdGlvblNpemUgPSA0OwoKCQkJLy8gY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFByb2dyYW06IEFDVElWRSBWRVJURVggQVRUUklCVVRFOicsIG5hbWUsIGkgKTsKCgkJCWF0dHJpYnV0ZXNbIG5hbWUgXSA9IHsKCQkJCXR5cGU6IGluZm8udHlwZSwKCQkJCWxvY2F0aW9uOiBnbC5nZXRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgbmFtZSApLAoJCQkJbG9jYXRpb25TaXplOiBsb2NhdGlvblNpemUKCQkJfTsKCgkJfQoKCQlyZXR1cm4gYXR0cmlidXRlczsKCgl9CgoJZnVuY3Rpb24gZmlsdGVyRW1wdHlMaW5lKCBzdHJpbmcgKSB7CgoJCXJldHVybiBzdHJpbmcgIT09ICcnOwoKCX0KCglmdW5jdGlvbiByZXBsYWNlTGlnaHROdW1zKCBzdHJpbmcsIHBhcmFtZXRlcnMgKSB7CgoJCWNvbnN0IG51bVNwb3RMaWdodENvb3JkcyA9IHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cyArIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0TWFwcyAtIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOwoKCQlyZXR1cm4gc3RyaW5nCgkJCS5yZXBsYWNlKCAvTlVNX0RJUl9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICkKCQkJLnJlcGxhY2UoIC9OVU1fU1BPVF9MSUdIVF9DT09SRFMvZywgbnVtU3BvdExpZ2h0Q29vcmRzICkKCQkJLnJlcGxhY2UoIC9OVU1fUkVDVF9BUkVBX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVJlY3RBcmVhTGlnaHRzICkKCQkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9IRU1JX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bUhlbWlMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9ESVJfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0U2hhZG93cyApCgkJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XU19XSVRIX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzICkKCQkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRTaGFkb3dzICk7CgoJfQoKCWZ1bmN0aW9uIHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggc3RyaW5nLCBwYXJhbWV0ZXJzICkgewoKCQlyZXR1cm4gc3RyaW5nCgkJCS5yZXBsYWNlKCAvTlVNX0NMSVBQSU5HX1BMQU5FUy9nLCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICkKCQkJLnJlcGxhY2UoIC9VTklPTl9DTElQUElOR19QTEFORVMvZywgKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzIC0gcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uICkgKTsKCgl9CgoJLy8gUmVzb2x2ZSBJbmNsdWRlcwoKCWNvbnN0IGluY2x1ZGVQYXR0ZXJuID0gL15bIFx0XSojaW5jbHVkZSArPChbXHdcZC4vXSspPi9nbTsKCglmdW5jdGlvbiByZXNvbHZlSW5jbHVkZXMoIHN0cmluZyApIHsKCgkJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCBpbmNsdWRlUGF0dGVybiwgaW5jbHVkZVJlcGxhY2VyICk7CgoJfQoKCWNvbnN0IHNoYWRlckNodW5rTWFwID0gbmV3IE1hcCgpOwoKCWZ1bmN0aW9uIGluY2x1ZGVSZXBsYWNlciggbWF0Y2gsIGluY2x1ZGUgKSB7CgoJCWxldCBzdHJpbmcgPSBTaGFkZXJDaHVua1sgaW5jbHVkZSBdOwoKCQlpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgbmV3SW5jbHVkZSA9IHNoYWRlckNodW5rTWFwLmdldCggaW5jbHVkZSApOwoKCQkJaWYgKCBuZXdJbmNsdWRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJc3RyaW5nID0gU2hhZGVyQ2h1bmtbIG5ld0luY2x1ZGUgXTsKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFNoYWRlciBjaHVuayAiJXMiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAiJXMiIGluc3RlYWQuJywgaW5jbHVkZSwgbmV3SW5jbHVkZSApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdDYW4gbm90IHJlc29sdmUgI2luY2x1ZGUgPCcgKyBpbmNsdWRlICsgJz4nICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHJlc29sdmVJbmNsdWRlcyggc3RyaW5nICk7CgoJfQoKCS8vIFVucm9sbCBMb29wcwoKCWNvbnN0IHVucm9sbExvb3BQYXR0ZXJuID0gLyNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRccytmb3JccypcKFxzKmludFxzK2lccyo9XHMqKFxkKylccyo7XHMqaVxzKjxccyooXGQrKVxzKjtccyppXHMqXCtcK1xzKlwpXHMqeyhbXHNcU10rPyl9XHMrI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmQvZzsKCglmdW5jdGlvbiB1bnJvbGxMb29wcyggc3RyaW5nICkgewoKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHVucm9sbExvb3BQYXR0ZXJuLCBsb29wUmVwbGFjZXIgKTsKCgl9CgoJZnVuY3Rpb24gbG9vcFJlcGxhY2VyKCBtYXRjaCwgc3RhcnQsIGVuZCwgc25pcHBldCApIHsKCgkJbGV0IHN0cmluZyA9ICcnOwoKCQlmb3IgKCBsZXQgaSA9IHBhcnNlSW50KCBzdGFydCApOyBpIDwgcGFyc2VJbnQoIGVuZCApOyBpICsrICkgewoKCQkJc3RyaW5nICs9IHNuaXBwZXQKCQkJCS5yZXBsYWNlKCAvXFtccyppXHMqXF0vZywgJ1sgJyArIGkgKyAnIF0nICkKCQkJCS5yZXBsYWNlKCAvVU5ST0xMRURfTE9PUF9JTkRFWC9nLCBpICk7CgoJCX0KCgkJcmV0dXJuIHN0cmluZzsKCgl9CgoJLy8KCglmdW5jdGlvbiBnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApIHsKCgkJbGV0IHByZWNpc2lvbnN0cmluZyA9IGBwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gZmxvYXQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaW50OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIyRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyQ3ViZTsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyM0Q7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEQXJyYXk7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEU2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXJDdWJlU2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIyREFycmF5U2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IGlzYW1wbGVyMkQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBpc2FtcGxlckN1YmU7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIyREFycmF5OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHVzYW1wbGVyMkQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSB1c2FtcGxlckN1YmU7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIyREFycmF5OwoJYDsKCgkJaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2hpZ2hwJyApIHsKCgkJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIEhJR0hfUFJFQ0lTSU9OJzsKCgkJfSBlbHNlIGlmICggcGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICdtZWRpdW1wJyApIHsKCgkJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIE1FRElVTV9QUkVDSVNJT04nOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2xvd3AnICkgewoKCQkJcHJlY2lzaW9uc3RyaW5nICs9ICdcbiNkZWZpbmUgTE9XX1BSRUNJU0lPTic7CgoJCX0KCgkJcmV0dXJuIHByZWNpc2lvbnN0cmluZzsKCgl9CgoJZnVuY3Rpb24gZ2VuZXJhdGVTaGFkb3dNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCQlsZXQgc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9CQVNJQyc7CgoJCWlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBQQ0ZTaGFkb3dNYXAgKSB7CgoJCQlzaGFkb3dNYXBUeXBlRGVmaW5lID0gJ1NIQURPV01BUF9UWVBFX1BDRic7CgoJCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gUENGU29mdFNoYWRvd01hcCApIHsKCgkJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQnOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfVlNNJzsKCgkJfQoKCQlyZXR1cm4gc2hhZG93TWFwVHlwZURlZmluZTsKCgl9CgoJZnVuY3Rpb24gZ2VuZXJhdGVFbnZNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCQlsZXQgZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCgkJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJCXN3aXRjaCAoIHBhcmFtZXRlcnMuZW52TWFwTW9kZSApIHsKCgkJCQljYXNlIEN1YmVSZWZsZWN0aW9uTWFwcGluZzoKCQkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoJCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRSc7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzoKCQkJCQllbnZNYXBUeXBlRGVmaW5lID0gJ0VOVk1BUF9UWVBFX0NVQkVfVVYnOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCXJldHVybiBlbnZNYXBUeXBlRGVmaW5lOwoKCX0KCglmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgoJCWxldCBlbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRkxFQ1RJT04nOwoKCQlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKCQkJc3dpdGNoICggcGFyYW1ldGVycy5lbnZNYXBNb2RlICkgewoKCQkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoKCQkJCQllbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRlJBQ1RJT04nOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCXJldHVybiBlbnZNYXBNb2RlRGVmaW5lOwoKCX0KCglmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCQlsZXQgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX05PTkUnOwoKCQlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKCQkJc3dpdGNoICggcGFyYW1ldGVycy5jb21iaW5lICkgewoKCQkJCWNhc2UgTXVsdGlwbHlPcGVyYXRpb246CgkJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZJzsKCQkJCQlicmVhazsKCgkJCQljYXNlIE1peE9wZXJhdGlvbjoKCQkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTUlYJzsKCQkJCQlicmVhazsKCgkJCQljYXNlIEFkZE9wZXJhdGlvbjoKCQkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfQUREJzsKCQkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gZW52TWFwQmxlbmRpbmdEZWZpbmU7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApIHsKCgkJY29uc3QgaW1hZ2VIZWlnaHQgPSBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVVkhlaWdodDsKCgkJaWYgKCBpbWFnZUhlaWdodCA9PT0gbnVsbCApIHJldHVybiBudWxsOwoKCQljb25zdCBtYXhNaXAgPSBNYXRoLmxvZzIoIGltYWdlSGVpZ2h0ICkgLSAyOwoKCQljb25zdCB0ZXhlbEhlaWdodCA9IDEuMCAvIGltYWdlSGVpZ2h0OwoKCQljb25zdCB0ZXhlbFdpZHRoID0gMS4wIC8gKCAzICogTWF0aC5tYXgoIE1hdGgucG93KCAyLCBtYXhNaXAgKSwgNyAqIDE2ICkgKTsKCgkJcmV0dXJuIHsgdGV4ZWxXaWR0aCwgdGV4ZWxIZWlnaHQsIG1heE1pcCB9OwoKCX0KCglmdW5jdGlvbiBXZWJHTFByb2dyYW0oIHJlbmRlcmVyLCBjYWNoZUtleSwgcGFyYW1ldGVycywgYmluZGluZ1N0YXRlcyApIHsKCgkJLy8gVE9ETyBTZW5kIHRoaXMgZXZlbnQgdG8gVGhyZWUuanMgRGV2VG9vbHMKCQkvLyBjb25zb2xlLmxvZyggJ1dlYkdMUHJvZ3JhbScsIGNhY2hlS2V5ICk7CgoJCWNvbnN0IGdsID0gcmVuZGVyZXIuZ2V0Q29udGV4dCgpOwoKCQljb25zdCBkZWZpbmVzID0gcGFyYW1ldGVycy5kZWZpbmVzOwoKCQlsZXQgdmVydGV4U2hhZGVyID0gcGFyYW1ldGVycy52ZXJ0ZXhTaGFkZXI7CgkJbGV0IGZyYWdtZW50U2hhZGVyID0gcGFyYW1ldGVycy5mcmFnbWVudFNoYWRlcjsKCgkJY29uc3Qgc2hhZG93TWFwVHlwZURlZmluZSA9IGdlbmVyYXRlU2hhZG93TWFwVHlwZURlZmluZSggcGFyYW1ldGVycyApOwoJCWNvbnN0IGVudk1hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCQljb25zdCBlbnZNYXBNb2RlRGVmaW5lID0gZ2VuZXJhdGVFbnZNYXBNb2RlRGVmaW5lKCBwYXJhbWV0ZXJzICk7CgkJY29uc3QgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICk7CgkJY29uc3QgZW52TWFwQ3ViZVVWU2l6ZSA9IGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApOwoKCQljb25zdCBjdXN0b21WZXJ0ZXhFeHRlbnNpb25zID0gZ2VuZXJhdGVWZXJ0ZXhFeHRlbnNpb25zKCBwYXJhbWV0ZXJzICk7CgoJCWNvbnN0IGN1c3RvbURlZmluZXMgPSBnZW5lcmF0ZURlZmluZXMoIGRlZmluZXMgKTsKCgkJY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTsKCgkJbGV0IHByZWZpeFZlcnRleCwgcHJlZml4RnJhZ21lbnQ7CgkJbGV0IHZlcnNpb25TdHJpbmcgPSBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID8gJyN2ZXJzaW9uICcgKyBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uICsgJ1xuJyA6ICcnOwoKCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCgkJCXByZWZpeFZlcnRleCA9IFsKCgkJCQknI2RlZmluZSBTSEFERVJfVFlQRSAnICsgcGFyYW1ldGVycy5zaGFkZXJUeXBlLAoJCQkJJyNkZWZpbmUgU0hBREVSX05BTUUgJyArIHBhcmFtZXRlcnMuc2hhZGVyTmFtZSwKCgkJCQljdXN0b21EZWZpbmVzCgoJCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKCQkJaWYgKCBwcmVmaXhWZXJ0ZXgubGVuZ3RoID4gMCApIHsKCgkJCQlwcmVmaXhWZXJ0ZXggKz0gJ1xuJzsKCgkJCX0KCgkJCXByZWZpeEZyYWdtZW50ID0gWwoKCQkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJCWN1c3RvbURlZmluZXMKCgkJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCQlpZiAoIHByZWZpeEZyYWdtZW50Lmxlbmd0aCA+IDAgKSB7CgoJCQkJcHJlZml4RnJhZ21lbnQgKz0gJ1xuJzsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCXByZWZpeFZlcnRleCA9IFsKCgkJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKCQkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJCWN1c3RvbURlZmluZXMsCgoJCQkJcGFyYW1ldGVycy5leHRlbnNpb25DbGlwQ3VsbERpc3RhbmNlID8gJyNkZWZpbmUgVVNFX0NMSVBfRElTVEFOQ0UnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmJhdGNoaW5nID8gJyNkZWZpbmUgVVNFX0JBVENISU5HJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yID8gJyNkZWZpbmUgVVNFX0JBVENISU5HX0NPTE9SJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nID8gJyNkZWZpbmUgVVNFX0lOU1RBTkNJTkcnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9JTlNUQU5DSU5HX0NPTE9SJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nTW9ycGggPyAnI2RlZmluZSBVU0VfSU5TVEFOQ0lOR19NT1JQSCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyA/ICcjZGVmaW5lIFVTRV9GT0cnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm1hcCA/ICcjZGVmaW5lIFVTRV9NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lIFVTRV9FTlZNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBNb2RlRGVmaW5lIDogJycsCgkJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYnVtcE1hcCA/ICcjZGVmaW5lIFVTRV9CVU1QTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBPYmplY3RTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0UnIDogJycsCgkJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFRhbmdlbnRTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXAgPyAnI2RlZmluZSBVU0VfRElTUExBQ0VNRU5UTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5lbWlzc2l2ZU1hcCA/ICcjZGVmaW5lIFVTRV9FTUlTU0lWRU1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWScgOiAnJywKCQkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcCA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0NPTE9STUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfTUVUQUxORVNTTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04nIDogJycsCgkJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcCA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT05NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9USElDS05FU1NNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX0NPTE9STUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgoJCQkJLy8KCgkJCQlwYXJhbWV0ZXJzLm1hcFV2ID8gJyNkZWZpbmUgTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmFscGhhTWFwVXYgPyAnI2RlZmluZSBBTFBIQU1BUF9VViAnICsgcGFyYW1ldGVycy5hbHBoYU1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwVXYgPyAnI2RlZmluZSBMSUdIVE1BUF9VViAnICsgcGFyYW1ldGVycy5saWdodE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmFvTWFwVXYgPyAnI2RlZmluZSBBT01BUF9VViAnICsgcGFyYW1ldGVycy5hb01hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgPyAnI2RlZmluZSBFTUlTU0lWRU1BUF9VViAnICsgcGFyYW1ldGVycy5lbWlzc2l2ZU1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmJ1bXBNYXBVdiA/ICcjZGVmaW5lIEJVTVBNQVBfVVYgJyArIHBhcmFtZXRlcnMuYnVtcE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2ID8gJyNkZWZpbmUgTk9STUFMTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ID8gJyNkZWZpbmUgRElTUExBQ0VNRU5UTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2IDogJycsCgoJCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA/ICcjZGVmaW5lIE1FVEFMTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA6ICcnLAoJCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIFJPVUdITkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2ID8gJyNkZWZpbmUgQU5JU09UUk9QWU1BUF9VViAnICsgcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUX05PUk1BTE1BUF9VViAnICsgcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXBVdiA6ICcnLAoJCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIENMRUFSQ09BVF9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRU1BUF9VViAnICsgcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRV9USElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2ID8gJyNkZWZpbmUgU0hFRU5fQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgPyAnI2RlZmluZSBTSEVFTl9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXBVdiA/ICcjZGVmaW5lIFNQRUNVTEFSTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgOiAnJywKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ID8gJyNkZWZpbmUgU1BFQ1VMQVJfQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPyAnI2RlZmluZSBTUEVDVUxBUl9JTlRFTlNJVFlNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgPyAnI2RlZmluZSBUUkFOU01JU1NJT05NQVBfVVYgJyArIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgOiAnJywKCQkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBUSElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgOiAnJywKCgkJCQkvLwoKCQkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzID8gJyNkZWZpbmUgVVNFX0NPTE9SJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAnI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPyAnI2RlZmluZSBVU0VfVVYxJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjJzID8gJyNkZWZpbmUgVVNFX1VWMicgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4VXYzcyA/ICcjZGVmaW5lIFVTRV9VVjMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5wb2ludHNVdnMgPyAnI2RlZmluZSBVU0VfUE9JTlRTX1VWJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNraW5uaW5nID8gJyNkZWZpbmUgVVNFX1NLSU5OSU5HJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMubW9ycGhUYXJnZXRzID8gJyNkZWZpbmUgVVNFX01PUlBIVEFSR0VUUycgOiAnJywKCQkJCXBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICYmIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPT09IGZhbHNlID8gJyNkZWZpbmUgVVNFX01PUlBITk9STUFMUycgOiAnJywKCQkJCSggcGFyYW1ldGVycy5tb3JwaENvbG9ycyApID8gJyNkZWZpbmUgVVNFX01PUlBIQ09MT1JTJyA6ICcnLAoJCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX1RFWFRVUkVfU1RSSURFICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGV4dHVyZVN0cmlkZSA6ICcnLAoJCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX0NPVU5UICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50IDogJycsCgkJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2l6ZUF0dGVudWF0aW9uID8gJyNkZWZpbmUgVVNFX1NJWkVBVFRFTlVBVElPTicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5yZXZlcnNlRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfUkVWRVJTRURFUFRIQlVGJyA6ICcnLAoKCQkJCSd1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7JywKCQkJCSd1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OycsCgkJCQkndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7JywKCQkJCSd1bmlmb3JtIG1hdDQgdmlld01hdHJpeDsnLAoJCQkJJ3VuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7JywKCQkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKCQkJCSd1bmlmb3JtIGJvb2wgaXNPcnRob2dyYXBoaWM7JywKCgkJCQknI2lmZGVmIFVTRV9JTlNUQU5DSU5HJywKCgkJCQknCWF0dHJpYnV0ZSBtYXQ0IGluc3RhbmNlTWF0cml4OycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19DT0xPUicsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjMyBpbnN0YW5jZUNvbG9yOycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSCcsCgoJCQkJJwl1bmlmb3JtIHNhbXBsZXIyRCBtb3JwaFRleHR1cmU7JywKCgkJCQknI2VuZGlmJywKCgkJCQknYXR0cmlidXRlIHZlYzMgcG9zaXRpb247JywKCQkJCSdhdHRyaWJ1dGUgdmVjMyBub3JtYWw7JywKCQkJCSdhdHRyaWJ1dGUgdmVjMiB1djsnLAoKCQkJCScjaWZkZWYgVVNFX1VWMScsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjMiB1djE7JywKCgkJCQknI2VuZGlmJywKCgkJCQknI2lmZGVmIFVTRV9VVjInLAoKCQkJCScJYXR0cmlidXRlIHZlYzIgdXYyOycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfVVYzJywKCgkJCQknCWF0dHJpYnV0ZSB2ZWMyIHV2MzsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCScjaWZkZWYgVVNFX1RBTkdFTlQnLAoKCQkJCScJYXR0cmlidXRlIHZlYzQgdGFuZ2VudDsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCScjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBICknLAoKCQkJCScJYXR0cmlidXRlIHZlYzQgY29sb3I7JywKCgkJCQknI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICknLAoKCQkJCScJYXR0cmlidXRlIHZlYzMgY29sb3I7JywKCgkJCQknI2VuZGlmJywKCgkJCQknI2lmZGVmIFVTRV9TS0lOTklORycsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luSW5kZXg7JywKCQkJCScJYXR0cmlidXRlIHZlYzQgc2tpbldlaWdodDsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCSdcbicKCgkJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCgkJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKCQkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJCWN1c3RvbURlZmluZXMsCgoJCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2cgPyAnI2RlZmluZSBVU0VfRk9HJyA6ICcnLAoJCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2dFeHAyID8gJyNkZWZpbmUgRk9HX0VYUDInIDogJycsCgoJCQkJcGFyYW1ldGVycy5hbHBoYVRvQ292ZXJhZ2UgPyAnI2RlZmluZSBBTFBIQV9UT19DT1ZFUkFHRScgOiAnJywKCQkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubWF0Y2FwID8gJyNkZWZpbmUgVVNFX01BVENBUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcFR5cGVEZWZpbmUgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcE1vZGVEZWZpbmUgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcEJsZW5kaW5nRGVmaW5lIDogJycsCgkJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX1RFWEVMX1dJRFRIICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsV2lkdGggOiAnJywKCQkJCWVudk1hcEN1YmVVVlNpemUgPyAnI2RlZmluZSBDVUJFVVZfVEVYRUxfSEVJR0hUICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsSGVpZ2h0IDogJycsCgkJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX01BWF9NSVAgJyArIGVudk1hcEN1YmVVVlNpemUubWF4TWlwICsgJy4wJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5saWdodE1hcCA/ICcjZGVmaW5lIFVTRV9MSUdIVE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYW9NYXAgPyAnI2RlZmluZSBVU0VfQU9NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX09CSkVDVFNQQUNFJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRScgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5ID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFknIDogJycsCgkJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXAgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWU1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVQnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRpc3BlcnNpb24gPyAnI2RlZmluZSBVU0VfRElTUEVSU0lPTicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRU1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfQ09MT1JNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFUZXN0ID8gJyNkZWZpbmUgVVNFX0FMUEhBVEVTVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNoZWVuID8gJyNkZWZpbmUgVVNFX1NIRUVOJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX0NPTE9STUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb24gPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OJyA6ICcnLAoJCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXAgPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy50aGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzIHx8IHBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yIHx8IHBhcmFtZXRlcnMuYmF0Y2hpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9DT0xPUicgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4QWxwaGFzID8gJyNkZWZpbmUgVVNFX0NPTE9SX0FMUEhBJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjFzID8gJyNkZWZpbmUgVVNFX1VWMScgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA/ICcjZGVmaW5lIFVTRV9VVjInIDogJycsCgkJCQlwYXJhbWV0ZXJzLnZlcnRleFV2M3MgPyAnI2RlZmluZSBVU0VfVVYzJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMucG9pbnRzVXZzID8gJyNkZWZpbmUgVVNFX1BPSU5UU19VVicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmdyYWRpZW50TWFwID8gJyNkZWZpbmUgVVNFX0dSQURJRU5UTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKCQkJCXBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhID8gJyNkZWZpbmUgUFJFTVVMVElQTElFRF9BTFBIQScgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmUgPyAnI2RlZmluZSBERUNPREVfVklERU9fVEVYVFVSRScgOiAnJywKCQkJCXBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlRW1pc3NpdmUgPyAnI2RlZmluZSBERUNPREVfVklERU9fVEVYVFVSRV9FTUlTU0lWRScgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUYnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA/ICcjZGVmaW5lIFVTRV9SRVZFUlNFREVQVEhCVUYnIDogJycsCgoJCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCgkJCQkndW5pZm9ybSB2ZWMzIGNhbWVyYVBvc2l0aW9uOycsCgkJCQkndW5pZm9ybSBib29sIGlzT3J0aG9ncmFwaGljOycsCgoJCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyAnI2RlZmluZSBUT05FX01BUFBJTkcnIDogJycsCgkJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/IFNoYWRlckNodW5rWyAndG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCcgXSA6ICcnLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHRvbmVNYXBwaW5nKCkgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwoJCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCAndG9uZU1hcHBpbmcnLCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICkgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRpdGhlcmluZyA/ICcjZGVmaW5lIERJVEhFUklORycgOiAnJywKCQkJCXBhcmFtZXRlcnMub3BhcXVlID8gJyNkZWZpbmUgT1BBUVVFJyA6ICcnLAoKCQkJCVNoYWRlckNodW5rWyAnY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50JyBdLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHZhcmlvdXMgZW5jb2RpbmcvZGVjb2RpbmcgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwoJCQkJZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCAnbGluZWFyVG9PdXRwdXRUZXhlbCcsIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApLAoJCQkJZ2V0THVtaW5hbmNlRnVuY3Rpb24oKSwKCgkJCQlwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyA/ICcjZGVmaW5lIERFUFRIX1BBQ0tJTkcgJyArIHBhcmFtZXRlcnMuZGVwdGhQYWNraW5nIDogJycsCgoJCQkJJ1xuJwoKCQkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJfQoKCQl2ZXJ0ZXhTaGFkZXIgPSByZXNvbHZlSW5jbHVkZXMoIHZlcnRleFNoYWRlciApOwoJCXZlcnRleFNoYWRlciA9IHJlcGxhY2VMaWdodE51bXMoIHZlcnRleFNoYWRlciwgcGFyYW1ldGVycyApOwoJCXZlcnRleFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggdmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzICk7CgoJCWZyYWdtZW50U2hhZGVyID0gcmVzb2x2ZUluY2x1ZGVzKCBmcmFnbWVudFNoYWRlciApOwoJCWZyYWdtZW50U2hhZGVyID0gcmVwbGFjZUxpZ2h0TnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCQlmcmFnbWVudFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCgkJdmVydGV4U2hhZGVyID0gdW5yb2xsTG9vcHMoIHZlcnRleFNoYWRlciApOwoJCWZyYWdtZW50U2hhZGVyID0gdW5yb2xsTG9vcHMoIGZyYWdtZW50U2hhZGVyICk7CgoJCWlmICggcGFyYW1ldGVycy5pc1Jhd1NoYWRlck1hdGVyaWFsICE9PSB0cnVlICkgewoKCQkJLy8gR0xTTCAzLjAgY29udmVyc2lvbiBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzIGFuZCBTaGFkZXJNYXRlcmlhbAoKCQkJdmVyc2lvblN0cmluZyA9ICcjdmVyc2lvbiAzMDAgZXNcbic7CgoJCQlwcmVmaXhWZXJ0ZXggPSBbCgkJCQljdXN0b21WZXJ0ZXhFeHRlbnNpb25zLAoJCQkJJyNkZWZpbmUgYXR0cmlidXRlIGluJywKCQkJCScjZGVmaW5lIHZhcnlpbmcgb3V0JywKCQkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJwoJCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhWZXJ0ZXg7CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCQkJCScjZGVmaW5lIHZhcnlpbmcgaW4nLAoJCQkJKCBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID09PSBHTFNMMyApID8gJycgOiAnbGF5b3V0KGxvY2F0aW9uID0gMCkgb3V0IGhpZ2hwIHZlYzQgcGNfZnJhZ0NvbG9yOycsCgkJCQkoIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPT09IEdMU0wzICkgPyAnJyA6ICcjZGVmaW5lIGdsX0ZyYWdDb2xvciBwY19mcmFnQ29sb3InLAoJCQkJJyNkZWZpbmUgZ2xfRnJhZ0RlcHRoRVhUIGdsX0ZyYWdEZXB0aCcsCgkJCQknI2RlZmluZSB0ZXh0dXJlMkQgdGV4dHVyZScsCgkJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZSB0ZXh0dXJlJywKCQkJCScjZGVmaW5lIHRleHR1cmUyRFByb2ogdGV4dHVyZVByb2onLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJETG9kRVhUIHRleHR1cmVMb2QnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvakxvZEVYVCB0ZXh0dXJlUHJvakxvZCcsCgkJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZUxvZEVYVCB0ZXh0dXJlTG9kJywKCQkJCScjZGVmaW5lIHRleHR1cmUyREdyYWRFWFQgdGV4dHVyZUdyYWQnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvakdyYWRFWFQgdGV4dHVyZVByb2pHcmFkJywKCQkJCScjZGVmaW5lIHRleHR1cmVDdWJlR3JhZEVYVCB0ZXh0dXJlR3JhZCcKCQkJXS5qb2luKCAnXG4nICkgKyAnXG4nICsgcHJlZml4RnJhZ21lbnQ7CgoJCX0KCgkJY29uc3QgdmVydGV4R2xzbCA9IHZlcnNpb25TdHJpbmcgKyBwcmVmaXhWZXJ0ZXggKyB2ZXJ0ZXhTaGFkZXI7CgkJY29uc3QgZnJhZ21lbnRHbHNsID0gdmVyc2lvblN0cmluZyArIHByZWZpeEZyYWdtZW50ICsgZnJhZ21lbnRTaGFkZXI7CgoJCS8vIGNvbnNvbGUubG9nKCAnKlZFUlRFWConLCB2ZXJ0ZXhHbHNsICk7CgkJLy8gY29uc29sZS5sb2coICcqRlJBR01FTlQqJywgZnJhZ21lbnRHbHNsICk7CgoJCWNvbnN0IGdsVmVydGV4U2hhZGVyID0gV2ViR0xTaGFkZXIoIGdsLCBnbC5WRVJURVhfU0hBREVSLCB2ZXJ0ZXhHbHNsICk7CgkJY29uc3QgZ2xGcmFnbWVudFNoYWRlciA9IFdlYkdMU2hhZGVyKCBnbCwgZ2wuRlJBR01FTlRfU0hBREVSLCBmcmFnbWVudEdsc2wgKTsKCgkJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJCWdsLmF0dGFjaFNoYWRlciggcHJvZ3JhbSwgZ2xGcmFnbWVudFNoYWRlciApOwoKCQkvLyBGb3JjZSBhIHBhcnRpY3VsYXIgYXR0cmlidXRlIHRvIGluZGV4IDAuCgoJCWlmICggcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICE9PSB1bmRlZmluZWQgKSB7CgoJCQlnbC5iaW5kQXR0cmliTG9jYXRpb24oIHByb2dyYW0sIDAsIHBhcmFtZXRlcnMuaW5kZXgwQXR0cmlidXRlTmFtZSApOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyA9PT0gdHJ1ZSApIHsKCgkJCS8vIHByb2dyYW1zIHdpdGggbW9ycGhUYXJnZXRzIGRpc3BsYWNlIHBvc2l0aW9uIG91dCBvZiBhdHRyaWJ1dGUgMAoJCQlnbC5iaW5kQXR0cmliTG9jYXRpb24oIHByb2dyYW0sIDAsICdwb3NpdGlvbicgKTsKCgkJfQoKCQlnbC5saW5rUHJvZ3JhbSggcHJvZ3JhbSApOwoKCQlmdW5jdGlvbiBvbkZpcnN0VXNlKCBzZWxmICkgewoKCQkJLy8gY2hlY2sgZm9yIGxpbmsgZXJyb3JzCgkJCWlmICggcmVuZGVyZXIuZGVidWcuY2hlY2tTaGFkZXJFcnJvcnMgKSB7CgoJCQkJY29uc3QgcHJvZ3JhbUxvZyA9IGdsLmdldFByb2dyYW1JbmZvTG9nKCBwcm9ncmFtICkudHJpbSgpOwoJCQkJY29uc3QgdmVydGV4TG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggZ2xWZXJ0ZXhTaGFkZXIgKS50cmltKCk7CgkJCQljb25zdCBmcmFnbWVudExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsRnJhZ21lbnRTaGFkZXIgKS50cmltKCk7CgoJCQkJbGV0IHJ1bm5hYmxlID0gdHJ1ZTsKCQkJCWxldCBoYXZlRGlhZ25vc3RpY3MgPSB0cnVlOwoKCQkJCWlmICggZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCXJ1bm5hYmxlID0gZmFsc2U7CgoJCQkJCWlmICggdHlwZW9mIHJlbmRlcmVyLmRlYnVnLm9uU2hhZGVyRXJyb3IgPT09ICdmdW5jdGlvbicgKSB7CgoJCQkJCQlyZW5kZXJlci5kZWJ1Zy5vblNoYWRlckVycm9yKCBnbCwgcHJvZ3JhbSwgZ2xWZXJ0ZXhTaGFkZXIsIGdsRnJhZ21lbnRTaGFkZXIgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGRlZmF1bHQgZXJyb3IgcmVwb3J0aW5nCgoJCQkJCQljb25zdCB2ZXJ0ZXhFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbFZlcnRleFNoYWRlciwgJ3ZlcnRleCcgKTsKCQkJCQkJY29uc3QgZnJhZ21lbnRFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbEZyYWdtZW50U2hhZGVyLCAnZnJhZ21lbnQnICk7CgoJCQkJCQljb25zb2xlLmVycm9yKAoJCQkJCQkJJ1RIUkVFLldlYkdMUHJvZ3JhbTogU2hhZGVyIEVycm9yICcgKyBnbC5nZXRFcnJvcigpICsgJyAtICcgKwoJCQkJCQkJJ1ZBTElEQVRFX1NUQVRVUyAnICsgZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuVkFMSURBVEVfU1RBVFVTICkgKyAnXG5cbicgKwoJCQkJCQkJJ01hdGVyaWFsIE5hbWU6ICcgKyBzZWxmLm5hbWUgKyAnXG4nICsKCQkJCQkJCSdNYXRlcmlhbCBUeXBlOiAnICsgc2VsZi50eXBlICsgJ1xuXG4nICsKCQkJCQkJCSdQcm9ncmFtIEluZm8gTG9nOiAnICsgcHJvZ3JhbUxvZyArICdcbicgKwoJCQkJCQkJdmVydGV4RXJyb3JzICsgJ1xuJyArCgkJCQkJCQlmcmFnbWVudEVycm9ycwoJCQkJCQkpOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggcHJvZ3JhbUxvZyAhPT0gJycgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogUHJvZ3JhbSBJbmZvIExvZzonLCBwcm9ncmFtTG9nICk7CgoJCQkJfSBlbHNlIGlmICggdmVydGV4TG9nID09PSAnJyB8fCBmcmFnbWVudExvZyA9PT0gJycgKSB7CgoJCQkJCWhhdmVEaWFnbm9zdGljcyA9IGZhbHNlOwoKCQkJCX0KCgkJCQlpZiAoIGhhdmVEaWFnbm9zdGljcyApIHsKCgkJCQkJc2VsZi5kaWFnbm9zdGljcyA9IHsKCgkJCQkJCXJ1bm5hYmxlOiBydW5uYWJsZSwKCgkJCQkJCXByb2dyYW1Mb2c6IHByb2dyYW1Mb2csCgoJCQkJCQl2ZXJ0ZXhTaGFkZXI6IHsKCgkJCQkJCQlsb2c6IHZlcnRleExvZywKCQkJCQkJCXByZWZpeDogcHJlZml4VmVydGV4CgoJCQkJCQl9LAoKCQkJCQkJZnJhZ21lbnRTaGFkZXI6IHsKCgkJCQkJCQlsb2c6IGZyYWdtZW50TG9nLAoJCQkJCQkJcHJlZml4OiBwcmVmaXhGcmFnbWVudAoKCQkJCQkJfQoKCQkJCQl9OwoKCQkJCX0KCgkJCX0KCgkJCS8vIENsZWFuIHVwCgoJCQkvLyBDcmFzaGVzIGluIGlPUzkgYW5kIGlPUzEwLiAjMTg0MDIKCQkJLy8gZ2wuZGV0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJCQkvLyBnbC5kZXRhY2hTaGFkZXIoIHByb2dyYW0sIGdsRnJhZ21lbnRTaGFkZXIgKTsKCgkJCWdsLmRlbGV0ZVNoYWRlciggZ2xWZXJ0ZXhTaGFkZXIgKTsKCQkJZ2wuZGVsZXRlU2hhZGVyKCBnbEZyYWdtZW50U2hhZGVyICk7CgoJCQljYWNoZWRVbmlmb3JtcyA9IG5ldyBXZWJHTFVuaWZvcm1zKCBnbCwgcHJvZ3JhbSApOwoJCQljYWNoZWRBdHRyaWJ1dGVzID0gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoIGdsLCBwcm9ncmFtICk7CgoJCX0KCgkJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIHVuaWZvcm0gbG9jYXRpb25zCgoJCWxldCBjYWNoZWRVbmlmb3JtczsKCgkJdGhpcy5nZXRVbmlmb3JtcyA9IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggY2FjaGVkVW5pZm9ybXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBQb3B1bGF0ZXMgY2FjaGVkVW5pZm9ybXMgYW5kIGNhY2hlZEF0dHJpYnV0ZXMKCQkJCW9uRmlyc3RVc2UoIHRoaXMgKTsKCgkJCX0KCgkJCXJldHVybiBjYWNoZWRVbmlmb3JtczsKCgkJfTsKCgkJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIGF0dHJpYnV0ZSBsb2NhdGlvbnMKCgkJbGV0IGNhY2hlZEF0dHJpYnV0ZXM7CgoJCXRoaXMuZ2V0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggY2FjaGVkQXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIFBvcHVsYXRlcyBjYWNoZWRBdHRyaWJ1dGVzIGFuZCBjYWNoZWRVbmlmb3JtcwoJCQkJb25GaXJzdFVzZSggdGhpcyApOwoKCQkJfQoKCQkJcmV0dXJuIGNhY2hlZEF0dHJpYnV0ZXM7CgoJCX07CgoJCS8vIGluZGljYXRlIHdoZW4gdGhlIHByb2dyYW0gaXMgcmVhZHkgdG8gYmUgdXNlZC4gaWYgdGhlIEtIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZSBleHRlbnNpb24gaXNuJ3Qgc3VwcG9ydGVkLAoJCS8vIGZsYWcgdGhlIHByb2dyYW0gYXMgcmVhZHkgaW1tZWRpYXRlbHkuIEl0IG1heSBjYXVzZSBhIHN0YWxsIHdoZW4gaXQncyBmaXJzdCB1c2VkLgoKCQlsZXQgcHJvZ3JhbVJlYWR5ID0gKCBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uUGFyYWxsZWxTaGFkZXJDb21waWxlID09PSBmYWxzZSApOwoKCQl0aGlzLmlzUmVhZHkgPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHByb2dyYW1SZWFkeSA9PT0gZmFsc2UgKSB7CgoJCQkJcHJvZ3JhbVJlYWR5ID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgQ09NUExFVElPTl9TVEFUVVNfS0hSICk7CgoJCQl9CgoJCQlyZXR1cm4gcHJvZ3JhbVJlYWR5OwoKCQl9OwoKCQkvLyBmcmVlIHJlc291cmNlCgoJCXRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKCgkJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggdGhpcyApOwoKCQkJZ2wuZGVsZXRlUHJvZ3JhbSggcHJvZ3JhbSApOwoJCQl0aGlzLnByb2dyYW0gPSB1bmRlZmluZWQ7CgoJCX07CgoJCS8vCgoJCXRoaXMudHlwZSA9IHBhcmFtZXRlcnMuc2hhZGVyVHlwZTsKCQl0aGlzLm5hbWUgPSBwYXJhbWV0ZXJzLnNoYWRlck5hbWU7CgkJdGhpcy5pZCA9IHByb2dyYW1JZENvdW50ICsrOwoJCXRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsKCQl0aGlzLnVzZWRUaW1lcyA9IDE7CgkJdGhpcy5wcm9ncmFtID0gcHJvZ3JhbTsKCQl0aGlzLnZlcnRleFNoYWRlciA9IGdsVmVydGV4U2hhZGVyOwoJCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBnbEZyYWdtZW50U2hhZGVyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGV0IF9pZCA9IDA7CgoJY2xhc3MgV2ViR0xTaGFkZXJDYWNoZSB7CgoJCWNvbnN0cnVjdG9yKCkgewoKCQkJdGhpcy5zaGFkZXJDYWNoZSA9IG5ldyBNYXAoKTsKCQkJdGhpcy5tYXRlcmlhbENhY2hlID0gbmV3IE1hcCgpOwoKCQl9CgoJCXVwZGF0ZSggbWF0ZXJpYWwgKSB7CgoJCQljb25zdCB2ZXJ0ZXhTaGFkZXIgPSBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXI7CgkJCWNvbnN0IGZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgoJCQljb25zdCB2ZXJ0ZXhTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCB2ZXJ0ZXhTaGFkZXIgKTsKCQkJY29uc3QgZnJhZ21lbnRTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCBmcmFnbWVudFNoYWRlciApOwoKCQkJY29uc3QgbWF0ZXJpYWxTaGFkZXJzID0gdGhpcy5fZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCgkJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggdmVydGV4U2hhZGVyU3RhZ2UgKSA9PT0gZmFsc2UgKSB7CgoJCQkJbWF0ZXJpYWxTaGFkZXJzLmFkZCggdmVydGV4U2hhZGVyU3RhZ2UgKTsKCQkJCXZlcnRleFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggZnJhZ21lbnRTaGFkZXJTdGFnZSApID09PSBmYWxzZSApIHsKCgkJCQltYXRlcmlhbFNoYWRlcnMuYWRkKCBmcmFnbWVudFNoYWRlclN0YWdlICk7CgkJCQlmcmFnbWVudFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCXJlbW92ZSggbWF0ZXJpYWwgKSB7CgoJCQljb25zdCBtYXRlcmlhbFNoYWRlcnMgPSB0aGlzLm1hdGVyaWFsQ2FjaGUuZ2V0KCBtYXRlcmlhbCApOwoKCQkJZm9yICggY29uc3Qgc2hhZGVyU3RhZ2Ugb2YgbWF0ZXJpYWxTaGFkZXJzICkgewoKCQkJCXNoYWRlclN0YWdlLnVzZWRUaW1lcyAtLTsKCgkJCQlpZiAoIHNoYWRlclN0YWdlLnVzZWRUaW1lcyA9PT0gMCApIHRoaXMuc2hhZGVyQ2FjaGUuZGVsZXRlKCBzaGFkZXJTdGFnZS5jb2RlICk7CgoJCQl9CgoJCQl0aGlzLm1hdGVyaWFsQ2FjaGUuZGVsZXRlKCBtYXRlcmlhbCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICkgewoKCQkJcmV0dXJuIHRoaXMuX2dldFNoYWRlclN0YWdlKCBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXIgKS5pZDsKCgkJfQoKCQlnZXRGcmFnbWVudFNoYWRlcklEKCBtYXRlcmlhbCApIHsKCgkJCXJldHVybiB0aGlzLl9nZXRTaGFkZXJTdGFnZSggbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXIgKS5pZDsKCgkJfQoKCQlkaXNwb3NlKCkgewoKCQkJdGhpcy5zaGFkZXJDYWNoZS5jbGVhcigpOwoJCQl0aGlzLm1hdGVyaWFsQ2FjaGUuY2xlYXIoKTsKCgkJfQoKCQlfZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgoJCQljb25zdCBjYWNoZSA9IHRoaXMubWF0ZXJpYWxDYWNoZTsKCQkJbGV0IHNldCA9IGNhY2hlLmdldCggbWF0ZXJpYWwgKTsKCgkJCWlmICggc2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc2V0ID0gbmV3IFNldCgpOwoJCQkJY2FjaGUuc2V0KCBtYXRlcmlhbCwgc2V0ICk7CgoJCQl9CgoJCQlyZXR1cm4gc2V0OwoKCQl9CgoJCV9nZXRTaGFkZXJTdGFnZSggY29kZSApIHsKCgkJCWNvbnN0IGNhY2hlID0gdGhpcy5zaGFkZXJDYWNoZTsKCQkJbGV0IHN0YWdlID0gY2FjaGUuZ2V0KCBjb2RlICk7CgoJCQlpZiAoIHN0YWdlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc3RhZ2UgPSBuZXcgV2ViR0xTaGFkZXJTdGFnZSggY29kZSApOwoJCQkJY2FjaGUuc2V0KCBjb2RlLCBzdGFnZSApOwoKCQkJfQoKCQkJcmV0dXJuIHN0YWdlOwoKCQl9CgoJfQoKCWNsYXNzIFdlYkdMU2hhZGVyU3RhZ2UgewoKCQljb25zdHJ1Y3RvciggY29kZSApIHsKCgkJCXRoaXMuaWQgPSBfaWQgKys7CgoJCQl0aGlzLmNvZGUgPSBjb2RlOwoJCQl0aGlzLnVzZWRUaW1lcyA9IDA7CgoJCX0KCgl9CgoJZnVuY3Rpb24gV2ViR0xQcm9ncmFtcyggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIGJpbmRpbmdTdGF0ZXMsIGNsaXBwaW5nICkgewoKCQljb25zdCBfcHJvZ3JhbUxheWVycyA9IG5ldyBMYXllcnMoKTsKCQljb25zdCBfY3VzdG9tU2hhZGVycyA9IG5ldyBXZWJHTFNoYWRlckNhY2hlKCk7CgkJY29uc3QgX2FjdGl2ZUNoYW5uZWxzID0gbmV3IFNldCgpOwoJCWNvbnN0IHByb2dyYW1zID0gW107CgoJCWNvbnN0IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPSBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjsKCQljb25zdCBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMgPSBjYXBhYmlsaXRpZXMudmVydGV4VGV4dHVyZXM7CgoJCWxldCBwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMucHJlY2lzaW9uOwoKCQljb25zdCBzaGFkZXJJRHMgPSB7CgkJCU1lc2hEZXB0aE1hdGVyaWFsOiAnZGVwdGgnLAoJCQlNZXNoRGlzdGFuY2VNYXRlcmlhbDogJ2Rpc3RhbmNlUkdCQScsCgkJCU1lc2hOb3JtYWxNYXRlcmlhbDogJ25vcm1hbCcsCgkJCU1lc2hCYXNpY01hdGVyaWFsOiAnYmFzaWMnLAoJCQlNZXNoTGFtYmVydE1hdGVyaWFsOiAnbGFtYmVydCcsCgkJCU1lc2hQaG9uZ01hdGVyaWFsOiAncGhvbmcnLAoJCQlNZXNoVG9vbk1hdGVyaWFsOiAndG9vbicsCgkJCU1lc2hTdGFuZGFyZE1hdGVyaWFsOiAncGh5c2ljYWwnLAoJCQlNZXNoUGh5c2ljYWxNYXRlcmlhbDogJ3BoeXNpY2FsJywKCQkJTWVzaE1hdGNhcE1hdGVyaWFsOiAnbWF0Y2FwJywKCQkJTGluZUJhc2ljTWF0ZXJpYWw6ICdiYXNpYycsCgkJCUxpbmVEYXNoZWRNYXRlcmlhbDogJ2Rhc2hlZCcsCgkJCVBvaW50c01hdGVyaWFsOiAncG9pbnRzJywKCQkJU2hhZG93TWF0ZXJpYWw6ICdzaGFkb3cnLAoJCQlTcHJpdGVNYXRlcmlhbDogJ3Nwcml0ZScKCQl9OwoKCQlmdW5jdGlvbiBnZXRDaGFubmVsKCB2YWx1ZSApIHsKCgkJCV9hY3RpdmVDaGFubmVscy5hZGQoIHZhbHVlICk7CgoJCQlpZiAoIHZhbHVlID09PSAwICkgcmV0dXJuICd1dic7CgoJCQlyZXR1cm4gYHV2JHsgdmFsdWUgfWA7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0UGFyYW1ldGVycyggbWF0ZXJpYWwsIGxpZ2h0cywgc2hhZG93cywgc2NlbmUsIG9iamVjdCApIHsKCgkJCWNvbnN0IGZvZyA9IHNjZW5lLmZvZzsKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgkJCWNvbnN0IGVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKCgkJCWNvbnN0IGVudk1hcCA9ICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggbWF0ZXJpYWwuZW52TWFwIHx8IGVudmlyb25tZW50ICk7CgkJCWNvbnN0IGVudk1hcEN1YmVVVkhlaWdodCA9ICggISEgZW52TWFwICkgJiYgKCBlbnZNYXAubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSA/IGVudk1hcC5pbWFnZS5oZWlnaHQgOiBudWxsOwoKCQkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKCgkJCS8vIGhldXJpc3RpY3MgdG8gY3JlYXRlIHNoYWRlciBwYXJhbWV0ZXJzIGFjY29yZGluZyB0byBsaWdodHMgaW4gdGhlIHNjZW5lCgkJCS8vIChub3QgdG8gYmxvdyBvdmVyIG1heExpZ2h0cyBidWRnZXQpCgoJCQlpZiAoIG1hdGVyaWFsLnByZWNpc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMuZ2V0TWF4UHJlY2lzaW9uKCBtYXRlcmlhbC5wcmVjaXNpb24gKTsKCgkJCQlpZiAoIHByZWNpc2lvbiAhPT0gbWF0ZXJpYWwucHJlY2lzaW9uICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW0uZ2V0UGFyYW1ldGVyczonLCBtYXRlcmlhbC5wcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIHByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvcjsKCQkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgoJCQlsZXQgbW9ycGhUZXh0dXJlU3RyaWRlID0gMDsKCgkJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAxOwoJCQlpZiAoIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDI7CgkJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAzOwoKCQkJLy8KCgkJCWxldCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyOwoJCQlsZXQgY3VzdG9tVmVydGV4U2hhZGVySUQsIGN1c3RvbUZyYWdtZW50U2hhZGVySUQ7CgoJCQlpZiAoIHNoYWRlcklEICkgewoKCQkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKCgkJCQl2ZXJ0ZXhTaGFkZXIgPSBzaGFkZXIudmVydGV4U2hhZGVyOwoJCQkJZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXI7CgoJCQl9IGVsc2UgewoKCQkJCXZlcnRleFNoYWRlciA9IG1hdGVyaWFsLnZlcnRleFNoYWRlcjsKCQkJCWZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgoJCQkJX2N1c3RvbVNoYWRlcnMudXBkYXRlKCBtYXRlcmlhbCApOwoKCQkJCWN1c3RvbVZlcnRleFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICk7CgkJCQljdXN0b21GcmFnbWVudFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0RnJhZ21lbnRTaGFkZXJJRCggbWF0ZXJpYWwgKTsKCgkJCX0KCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJY29uc3QgcmV2ZXJzZURlcHRoQnVmZmVyID0gcmVuZGVyZXIuc3RhdGUuYnVmZmVycy5kZXB0aC5nZXRSZXZlcnNlZCgpOwoKCQkJY29uc3QgSVNfSU5TVEFOQ0VETUVTSCA9IG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWU7CgkJCWNvbnN0IElTX0JBVENIRURNRVNIID0gb2JqZWN0LmlzQmF0Y2hlZE1lc2ggPT09IHRydWU7CgoJCQljb25zdCBIQVNfTUFQID0gISEgbWF0ZXJpYWwubWFwOwoJCQljb25zdCBIQVNfTUFUQ0FQID0gISEgbWF0ZXJpYWwubWF0Y2FwOwoJCQljb25zdCBIQVNfRU5WTUFQID0gISEgZW52TWFwOwoJCQljb25zdCBIQVNfQU9NQVAgPSAhISBtYXRlcmlhbC5hb01hcDsKCQkJY29uc3QgSEFTX0xJR0hUTUFQID0gISEgbWF0ZXJpYWwubGlnaHRNYXA7CgkJCWNvbnN0IEhBU19CVU1QTUFQID0gISEgbWF0ZXJpYWwuYnVtcE1hcDsKCQkJY29uc3QgSEFTX05PUk1BTE1BUCA9ICEhIG1hdGVyaWFsLm5vcm1hbE1hcDsKCQkJY29uc3QgSEFTX0RJU1BMQUNFTUVOVE1BUCA9ICEhIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQkJY29uc3QgSEFTX0VNSVNTSVZFTUFQID0gISEgbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQljb25zdCBIQVNfTUVUQUxORVNTTUFQID0gISEgbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwoJCQljb25zdCBIQVNfUk9VR0hORVNTTUFQID0gISEgbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQkJY29uc3QgSEFTX0FOSVNPVFJPUFkgPSBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMDsKCQkJY29uc3QgSEFTX0NMRUFSQ09BVCA9IG1hdGVyaWFsLmNsZWFyY29hdCA+IDA7CgkJCWNvbnN0IEhBU19ESVNQRVJTSU9OID0gbWF0ZXJpYWwuZGlzcGVyc2lvbiA+IDA7CgkJCWNvbnN0IEhBU19JUklERVNDRU5DRSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMDsKCQkJY29uc3QgSEFTX1NIRUVOID0gbWF0ZXJpYWwuc2hlZW4gPiAwOwoJCQljb25zdCBIQVNfVFJBTlNNSVNTSU9OID0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMDsKCgkJCWNvbnN0IEhBU19BTklTT1RST1BZTUFQID0gSEFTX0FOSVNPVFJPUFkgJiYgISEgbWF0ZXJpYWwuYW5pc290cm9weU1hcDsKCgkJCWNvbnN0IEhBU19DTEVBUkNPQVRNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdE1hcDsKCQkJY29uc3QgSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKCQkJY29uc3QgSEFTX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJCWNvbnN0IEhBU19JUklERVNDRU5DRU1BUCA9IEhBU19JUklERVNDRU5DRSAmJiAhISBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcDsKCQkJY29uc3QgSEFTX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCA9IEhBU19JUklERVNDRU5DRSAmJiAhISBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcDsKCgkJCWNvbnN0IEhBU19TSEVFTl9DT0xPUk1BUCA9IEhBU19TSEVFTiAmJiAhISBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoJCQljb25zdCBIQVNfU0hFRU5fUk9VR0hORVNTTUFQID0gSEFTX1NIRUVOICYmICEhIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKCQkJY29uc3QgSEFTX1NQRUNVTEFSTUFQID0gISEgbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CgkJCWNvbnN0IEhBU19TUEVDVUxBUl9DT0xPUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXA7CgkJCWNvbnN0IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAgPSAhISBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcDsKCgkJCWNvbnN0IEhBU19UUkFOU01JU1NJT05NQVAgPSBIQVNfVFJBTlNNSVNTSU9OICYmICEhIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKCQkJY29uc3QgSEFTX1RISUNLTkVTU01BUCA9IEhBU19UUkFOU01JU1NJT04gJiYgISEgbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKCQkJY29uc3QgSEFTX0dSQURJRU5UTUFQID0gISEgbWF0ZXJpYWwuZ3JhZGllbnRNYXA7CgoJCQljb25zdCBIQVNfQUxQSEFNQVAgPSAhISBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCWNvbnN0IEhBU19BTFBIQVRFU1QgPSBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwOwoKCQkJY29uc3QgSEFTX0FMUEhBSEFTSCA9ICEhIG1hdGVyaWFsLmFscGhhSGFzaDsKCgkJCWNvbnN0IEhBU19FWFRFTlNJT05TID0gISEgbWF0ZXJpYWwuZXh0ZW5zaW9uczsKCgkJCWxldCB0b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQlpZiAoIG1hdGVyaWFsLnRvbmVNYXBwZWQgKSB7CgoJCQkJaWYgKCBjdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IGN1cnJlbnRSZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApIHsKCgkJCQkJdG9uZU1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBwYXJhbWV0ZXJzID0gewoKCQkJCXNoYWRlcklEOiBzaGFkZXJJRCwKCQkJCXNoYWRlclR5cGU6IG1hdGVyaWFsLnR5cGUsCgkJCQlzaGFkZXJOYW1lOiBtYXRlcmlhbC5uYW1lLAoKCQkJCXZlcnRleFNoYWRlcjogdmVydGV4U2hhZGVyLAoJCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50U2hhZGVyLAoJCQkJZGVmaW5lczogbWF0ZXJpYWwuZGVmaW5lcywKCgkJCQljdXN0b21WZXJ0ZXhTaGFkZXJJRDogY3VzdG9tVmVydGV4U2hhZGVySUQsCgkJCQljdXN0b21GcmFnbWVudFNoYWRlcklEOiBjdXN0b21GcmFnbWVudFNoYWRlcklELAoKCQkJCWlzUmF3U2hhZGVyTWF0ZXJpYWw6IG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgPT09IHRydWUsCgkJCQlnbHNsVmVyc2lvbjogbWF0ZXJpYWwuZ2xzbFZlcnNpb24sCgoJCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgoJCQkJYmF0Y2hpbmc6IElTX0JBVENIRURNRVNILAoJCQkJYmF0Y2hpbmdDb2xvcjogSVNfQkFUQ0hFRE1FU0ggJiYgb2JqZWN0Ll9jb2xvcnNUZXh0dXJlICE9PSBudWxsLAoJCQkJaW5zdGFuY2luZzogSVNfSU5TVEFOQ0VETUVTSCwKCQkJCWluc3RhbmNpbmdDb2xvcjogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCwKCQkJCWluc3RhbmNpbmdNb3JwaDogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QubW9ycGhUZXh0dXJlICE9PSBudWxsLAoKCQkJCXN1cHBvcnRzVmVydGV4VGV4dHVyZXM6IFNVUFBPUlRTX1ZFUlRFWF9URVhUVVJFUywKCQkJCW91dHB1dENvbG9yU3BhY2U6ICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApID8gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSA6ICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlID8gY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApLAoJCQkJYWxwaGFUb0NvdmVyYWdlOiAhISBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UsCgoJCQkJbWFwOiBIQVNfTUFQLAoJCQkJbWF0Y2FwOiBIQVNfTUFUQ0FQLAoJCQkJZW52TWFwOiBIQVNfRU5WTUFQLAoJCQkJZW52TWFwTW9kZTogSEFTX0VOVk1BUCAmJiBlbnZNYXAubWFwcGluZywKCQkJCWVudk1hcEN1YmVVVkhlaWdodDogZW52TWFwQ3ViZVVWSGVpZ2h0LAoJCQkJYW9NYXA6IEhBU19BT01BUCwKCQkJCWxpZ2h0TWFwOiBIQVNfTElHSFRNQVAsCgkJCQlidW1wTWFwOiBIQVNfQlVNUE1BUCwKCQkJCW5vcm1hbE1hcDogSEFTX05PUk1BTE1BUCwKCQkJCWRpc3BsYWNlbWVudE1hcDogU1VQUE9SVFNfVkVSVEVYX1RFWFRVUkVTICYmIEhBU19ESVNQTEFDRU1FTlRNQVAsCgkJCQllbWlzc2l2ZU1hcDogSEFTX0VNSVNTSVZFTUFQLAoKCQkJCW5vcm1hbE1hcE9iamVjdFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IE9iamVjdFNwYWNlTm9ybWFsTWFwLAoJCQkJbm9ybWFsTWFwVGFuZ2VudFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCwKCgkJCQltZXRhbG5lc3NNYXA6IEhBU19NRVRBTE5FU1NNQVAsCgkJCQlyb3VnaG5lc3NNYXA6IEhBU19ST1VHSE5FU1NNQVAsCgoJCQkJYW5pc290cm9weTogSEFTX0FOSVNPVFJPUFksCgkJCQlhbmlzb3Ryb3B5TWFwOiBIQVNfQU5JU09UUk9QWU1BUCwKCgkJCQljbGVhcmNvYXQ6IEhBU19DTEVBUkNPQVQsCgkJCQljbGVhcmNvYXRNYXA6IEhBU19DTEVBUkNPQVRNQVAsCgkJCQljbGVhcmNvYXROb3JtYWxNYXA6IEhBU19DTEVBUkNPQVRfTk9STUFMTUFQLAoJCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwOiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCwKCgkJCQlkaXNwZXJzaW9uOiBIQVNfRElTUEVSU0lPTiwKCgkJCQlpcmlkZXNjZW5jZTogSEFTX0lSSURFU0NFTkNFLAoJCQkJaXJpZGVzY2VuY2VNYXA6IEhBU19JUklERVNDRU5DRU1BUCwKCQkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQLAoKCQkJCXNoZWVuOiBIQVNfU0hFRU4sCgkJCQlzaGVlbkNvbG9yTWFwOiBIQVNfU0hFRU5fQ09MT1JNQVAsCgkJCQlzaGVlblJvdWdobmVzc01hcDogSEFTX1NIRUVOX1JPVUdITkVTU01BUCwKCgkJCQlzcGVjdWxhck1hcDogSEFTX1NQRUNVTEFSTUFQLAoJCQkJc3BlY3VsYXJDb2xvck1hcDogSEFTX1NQRUNVTEFSX0NPTE9STUFQLAoJCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXA6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAsCgoJCQkJdHJhbnNtaXNzaW9uOiBIQVNfVFJBTlNNSVNTSU9OLAoJCQkJdHJhbnNtaXNzaW9uTWFwOiBIQVNfVFJBTlNNSVNTSU9OTUFQLAoJCQkJdGhpY2tuZXNzTWFwOiBIQVNfVEhJQ0tORVNTTUFQLAoKCQkJCWdyYWRpZW50TWFwOiBIQVNfR1JBRElFTlRNQVAsCgoJCQkJb3BhcXVlOiBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gZmFsc2UgJiYgbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gZmFsc2UsCgoJCQkJYWxwaGFNYXA6IEhBU19BTFBIQU1BUCwKCQkJCWFscGhhVGVzdDogSEFTX0FMUEhBVEVTVCwKCQkJCWFscGhhSGFzaDogSEFTX0FMUEhBSEFTSCwKCgkJCQljb21iaW5lOiBtYXRlcmlhbC5jb21iaW5lLAoKCQkJCS8vCgoJCQkJbWFwVXY6IEhBU19NQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubWFwLmNoYW5uZWwgKSwKCQkJCWFvTWFwVXY6IEhBU19BT01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5hb01hcC5jaGFubmVsICksCgkJCQlsaWdodE1hcFV2OiBIQVNfTElHSFRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubGlnaHRNYXAuY2hhbm5lbCApLAoJCQkJYnVtcE1hcFV2OiBIQVNfQlVNUE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5idW1wTWFwLmNoYW5uZWwgKSwKCQkJCW5vcm1hbE1hcFV2OiBIQVNfTk9STUFMTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLm5vcm1hbE1hcC5jaGFubmVsICksCgkJCQlkaXNwbGFjZW1lbnRNYXBVdjogSEFTX0RJU1BMQUNFTUVOVE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAuY2hhbm5lbCApLAoJCQkJZW1pc3NpdmVNYXBVdjogSEFTX0VNSVNTSVZFTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmNoYW5uZWwgKSwKCgkJCQltZXRhbG5lc3NNYXBVdjogSEFTX01FVEFMTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAuY2hhbm5lbCApLAoJCQkJcm91Z2huZXNzTWFwVXY6IEhBU19ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwucm91Z2huZXNzTWFwLmNoYW5uZWwgKSwKCgkJCQlhbmlzb3Ryb3B5TWFwVXY6IEhBU19BTklTT1RST1BZTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAuY2hhbm5lbCApLAoKCQkJCWNsZWFyY29hdE1hcFV2OiBIQVNfQ0xFQVJDT0FUTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmNsZWFyY29hdE1hcC5jaGFubmVsICksCgkJCQljbGVhcmNvYXROb3JtYWxNYXBVdjogSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwLmNoYW5uZWwgKSwKCQkJCWNsZWFyY29hdFJvdWdobmVzc01hcFV2OiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKCQkJCWlyaWRlc2NlbmNlTWFwVXY6IEhBU19JUklERVNDRU5DRU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcC5jaGFubmVsICksCgkJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2OiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLmNoYW5uZWwgKSwKCgkJCQlzaGVlbkNvbG9yTWFwVXY6IEhBU19TSEVFTl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwLmNoYW5uZWwgKSwKCQkJCXNoZWVuUm91Z2huZXNzTWFwVXY6IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKCQkJCXNwZWN1bGFyTWFwVXY6IEhBU19TUEVDVUxBUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhck1hcC5jaGFubmVsICksCgkJCQlzcGVjdWxhckNvbG9yTWFwVXY6IEhBU19TUEVDVUxBUl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLmNoYW5uZWwgKSwKCQkJCXNwZWN1bGFySW50ZW5zaXR5TWFwVXY6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAuY2hhbm5lbCApLAoKCQkJCXRyYW5zbWlzc2lvbk1hcFV2OiBIQVNfVFJBTlNNSVNTSU9OTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcC5jaGFubmVsICksCgkJCQl0aGlja25lc3NNYXBVdjogSEFTX1RISUNLTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC50aGlja25lc3NNYXAuY2hhbm5lbCApLAoKCQkJCWFscGhhTWFwVXY6IEhBU19BTFBIQU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5hbHBoYU1hcC5jaGFubmVsICksCgoJCQkJLy8KCgkJCQl2ZXJ0ZXhUYW5nZW50czogISEgZ2VvbWV0cnkuYXR0cmlidXRlcy50YW5nZW50ICYmICggSEFTX05PUk1BTE1BUCB8fCBIQVNfQU5JU09UUk9QWSApLAoJCQkJdmVydGV4Q29sb3JzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMsCgkJCQl2ZXJ0ZXhBbHBoYXM6IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQsCgoJCQkJcG9pbnRzVXZzOiBvYmplY3QuaXNQb2ludHMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy51diAmJiAoIEhBU19NQVAgfHwgSEFTX0FMUEhBTUFQICksCgoJCQkJZm9nOiAhISBmb2csCgkJCQl1c2VGb2c6IG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSwKCQkJCWZvZ0V4cDI6ICggISEgZm9nICYmIGZvZy5pc0ZvZ0V4cDIgKSwKCgkJCQlmbGF0U2hhZGluZzogKCBtYXRlcmlhbC5mbGF0U2hhZGluZyA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC53aXJlZnJhbWUgPT09IGZhbHNlICksCgoJCQkJc2l6ZUF0dGVudWF0aW9uOiBtYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPT09IHRydWUsCgkJCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoJCQkJcmV2ZXJzZURlcHRoQnVmZmVyOiByZXZlcnNlRGVwdGhCdWZmZXIsCgoJCQkJc2tpbm5pbmc6IG9iamVjdC5pc1NraW5uZWRNZXNoID09PSB0cnVlLAoKCQkJCW1vcnBoVGFyZ2V0czogZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQsCgkJCQltb3JwaE5vcm1hbHM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCwKCQkJCW1vcnBoQ29sb3JzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCwKCQkJCW1vcnBoVGFyZ2V0c0NvdW50OiBtb3JwaFRhcmdldHNDb3VudCwKCQkJCW1vcnBoVGV4dHVyZVN0cmlkZTogbW9ycGhUZXh0dXJlU3RyaWRlLAoKCQkJCW51bURpckxpZ2h0czogbGlnaHRzLmRpcmVjdGlvbmFsLmxlbmd0aCwKCQkJCW51bVBvaW50TGlnaHRzOiBsaWdodHMucG9pbnQubGVuZ3RoLAoJCQkJbnVtU3BvdExpZ2h0czogbGlnaHRzLnNwb3QubGVuZ3RoLAoJCQkJbnVtU3BvdExpZ2h0TWFwczogbGlnaHRzLnNwb3RMaWdodE1hcC5sZW5ndGgsCgkJCQludW1SZWN0QXJlYUxpZ2h0czogbGlnaHRzLnJlY3RBcmVhLmxlbmd0aCwKCQkJCW51bUhlbWlMaWdodHM6IGxpZ2h0cy5oZW1pLmxlbmd0aCwKCgkJCQludW1EaXJMaWdodFNoYWRvd3M6IGxpZ2h0cy5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGgsCgkJCQludW1Qb2ludExpZ2h0U2hhZG93czogbGlnaHRzLnBvaW50U2hhZG93TWFwLmxlbmd0aCwKCQkJCW51bVNwb3RMaWdodFNoYWRvd3M6IGxpZ2h0cy5zcG90U2hhZG93TWFwLmxlbmd0aCwKCQkJCW51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwczogbGlnaHRzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcywKCgkJCQludW1MaWdodFByb2JlczogbGlnaHRzLm51bUxpZ2h0UHJvYmVzLAoKCQkJCW51bUNsaXBwaW5nUGxhbmVzOiBjbGlwcGluZy5udW1QbGFuZXMsCgkJCQludW1DbGlwSW50ZXJzZWN0aW9uOiBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24sCgoJCQkJZGl0aGVyaW5nOiBtYXRlcmlhbC5kaXRoZXJpbmcsCgoJCQkJc2hhZG93TWFwRW5hYmxlZDogcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgJiYgc2hhZG93cy5sZW5ndGggPiAwLAoJCQkJc2hhZG93TWFwVHlwZTogcmVuZGVyZXIuc2hhZG93TWFwLnR5cGUsCgoJCQkJdG9uZU1hcHBpbmc6IHRvbmVNYXBwaW5nLAoKCQkJCWRlY29kZVZpZGVvVGV4dHVyZTogSEFTX01BUCAmJiAoIG1hdGVyaWFsLm1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5tYXAuY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSwKCQkJCWRlY29kZVZpZGVvVGV4dHVyZUVtaXNzaXZlOiBIQVNfRU1JU1NJVkVNQVAgJiYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcC5jb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApLAoKCQkJCXByZW11bHRpcGxpZWRBbHBoYTogbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhLAoKCQkJCWRvdWJsZVNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlLAoJCQkJZmxpcFNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSwKCgkJCQl1c2VEZXB0aFBhY2tpbmc6IG1hdGVyaWFsLmRlcHRoUGFja2luZyA+PSAwLAoJCQkJZGVwdGhQYWNraW5nOiBtYXRlcmlhbC5kZXB0aFBhY2tpbmcgfHwgMCwKCgkJCQlpbmRleDBBdHRyaWJ1dGVOYW1lOiBtYXRlcmlhbC5pbmRleDBBdHRyaWJ1dGVOYW1lLAoKCQkJCWV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2U6IEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuY2xpcEN1bGxEaXN0YW5jZSA9PT0gdHJ1ZSAmJiBleHRlbnNpb25zLmhhcyggJ1dFQkdMX2NsaXBfY3VsbF9kaXN0YW5jZScgKSwKCQkJCWV4dGVuc2lvbk11bHRpRHJhdzogKCBIQVNfRVhURU5TSU9OUyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLm11bHRpRHJhdyA9PT0gdHJ1ZSB8fCBJU19CQVRDSEVETUVTSCApICYmIGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlfZHJhdycgKSwKCgkJCQlyZW5kZXJlckV4dGVuc2lvblBhcmFsbGVsU2hhZGVyQ29tcGlsZTogZXh0ZW5zaW9ucy5oYXMoICdLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUnICksCgoJCQkJY3VzdG9tUHJvZ3JhbUNhY2hlS2V5OiBtYXRlcmlhbC5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkoKQoKCQkJfTsKCgkJCS8vIHRoZSB1c2FnZSBvZiBnZXRDaGFubmVsKCkgZGV0ZXJtaW5lcyB0aGUgYWN0aXZlIHRleHR1cmUgY2hhbm5lbHMgZm9yIHRoaXMgc2hhZGVyCgoJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPSBfYWN0aXZlQ2hhbm5lbHMuaGFzKCAxICk7CgkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA9IF9hY3RpdmVDaGFubmVscy5oYXMoIDIgKTsKCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjNzID0gX2FjdGl2ZUNoYW5uZWxzLmhhcyggMyApOwoKCQkJX2FjdGl2ZUNoYW5uZWxzLmNsZWFyKCk7CgoJCQlyZXR1cm4gcGFyYW1ldGVyczsKCgkJfQoKCQlmdW5jdGlvbiBnZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKSB7CgoJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRlcklEICkgewoKCQkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hhZGVySUQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21WZXJ0ZXhTaGFkZXJJRCApOwoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21GcmFnbWVudFNoYWRlcklEICk7CgoJCQl9CgoJCQlpZiAoIHBhcmFtZXRlcnMuZGVmaW5lcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWZvciAoIGNvbnN0IG5hbWUgaW4gcGFyYW1ldGVycy5kZWZpbmVzICkgewoKCQkJCQlhcnJheS5wdXNoKCBuYW1lICk7CgkJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZWZpbmVzWyBuYW1lIF0gKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gZmFsc2UgKSB7CgoJCQkJZ2V0UHJvZ3JhbUNhY2hlS2V5UGFyYW1ldGVycyggYXJyYXksIHBhcmFtZXRlcnMgKTsKCQkJCWdldFByb2dyYW1DYWNoZUtleUJvb2xlYW5zKCBhcnJheSwgcGFyYW1ldGVycyApOwoJCQkJYXJyYXkucHVzaCggcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSApOwoKCQkJfQoKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkgKTsKCgkJCXJldHVybiBhcnJheS5qb2luKCk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0UHJvZ3JhbUNhY2hlS2V5UGFyYW1ldGVycyggYXJyYXksIHBhcmFtZXRlcnMgKSB7CgoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm91dHB1dENvbG9yU3BhY2UgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5lbnZNYXBNb2RlICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWSGVpZ2h0ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5hbHBoYU1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubGlnaHRNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmFvTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5idW1wTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5ub3JtYWxNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMucm91Z2huZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jbGVhcmNvYXRNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zcGVjdWxhck1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jb21iaW5lICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZm9nRXhwMiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNpemVBdHRlbnVhdGlvbiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubW9ycGhBdHRyaWJ1dGVDb3VudCApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0cyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRzICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0cyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodE1hcHMgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1IZW1pTGlnaHRzICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtUmVjdEFyZWFMaWdodHMgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1EaXJMaWdodFNoYWRvd3MgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1MaWdodFByb2JlcyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy50b25lTWFwcGluZyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRlcHRoUGFja2luZyApOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleUJvb2xlYW5zKCBhcnJheSwgcGFyYW1ldGVycyApIHsKCgkJCV9wcm9ncmFtTGF5ZXJzLmRpc2FibGVBbGwoKTsKCgkJCWlmICggcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdNb3JwaCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDMgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLm1hdGNhcCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDQgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLm5vcm1hbE1hcE9iamVjdFNwYWNlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNiApOwoJCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNyApOwoJCQlpZiAoIHBhcmFtZXRlcnMuY2xlYXJjb2F0ICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2UgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA5ICk7CgkJCWlmICggcGFyYW1ldGVycy5hbHBoYVRlc3QgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4Q29sb3JzICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTEgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleEFscGhhcyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEyICk7CgkJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjFzICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTMgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleFV2MnMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4VXYzcyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE1ICk7CgkJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE2ICk7CgkJCWlmICggcGFyYW1ldGVycy5hbmlzb3Ryb3B5ICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhSGFzaCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE4ICk7CgkJCWlmICggcGFyYW1ldGVycy5iYXRjaGluZyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE5ICk7CgkJCWlmICggcGFyYW1ldGVycy5kaXNwZXJzaW9uICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjAgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmJhdGNoaW5nQ29sb3IgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMSApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZ3JhZGllbnRNYXAgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMiApOwoKCQkJYXJyYXkucHVzaCggX3Byb2dyYW1MYXllcnMubWFzayApOwoJCQlfcHJvZ3JhbUxheWVycy5kaXNhYmxlQWxsKCk7CgoJCQlpZiAoIHBhcmFtZXRlcnMuZm9nICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudXNlRm9nICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMSApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyICk7CgkJCWlmICggcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMyApOwoJCQlpZiAoIHBhcmFtZXRlcnMucmV2ZXJzZURlcHRoQnVmZmVyICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuc2tpbm5pbmcgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA1ICk7CgkJCWlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA2ICk7CgkJCWlmICggcGFyYW1ldGVycy5tb3JwaE5vcm1hbHMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CgkJCWlmICggcGFyYW1ldGVycy5tb3JwaENvbG9ycyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDggKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDkgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMSApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZmxpcFNpZGVkICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTIgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEzICk7CgkJCWlmICggcGFyYW1ldGVycy5kaXRoZXJpbmcgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTUgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnNoZWVuICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTYgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLm9wYXF1ZSApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE3ICk7CgkJCWlmICggcGFyYW1ldGVycy5wb2ludHNVdnMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTkgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmRlY29kZVZpZGVvVGV4dHVyZUVtaXNzaXZlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjAgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhVG9Db3ZlcmFnZSApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIxICk7CgoJCQlhcnJheS5wdXNoKCBfcHJvZ3JhbUxheWVycy5tYXNrICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICkgewoKCQkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKCQkJbGV0IHVuaWZvcm1zOwoKCQkJaWYgKCBzaGFkZXJJRCApIHsKCgkJCQljb25zdCBzaGFkZXIgPSBTaGFkZXJMaWJbIHNoYWRlcklEIF07CgkJCQl1bmlmb3JtcyA9IFVuaWZvcm1zVXRpbHMuY2xvbmUoIHNoYWRlci51bmlmb3JtcyApOwoKCQkJfSBlbHNlIHsKCgkJCQl1bmlmb3JtcyA9IG1hdGVyaWFsLnVuaWZvcm1zOwoKCQkJfQoKCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQl9CgoJCWZ1bmN0aW9uIGFjcXVpcmVQcm9ncmFtKCBwYXJhbWV0ZXJzLCBjYWNoZUtleSApIHsKCgkJCWxldCBwcm9ncmFtOwoKCQkJLy8gQ2hlY2sgaWYgY29kZSBoYXMgYmVlbiBhbHJlYWR5IGNvbXBpbGVkCgkJCWZvciAoIGxldCBwID0gMCwgcGwgPSBwcm9ncmFtcy5sZW5ndGg7IHAgPCBwbDsgcCArKyApIHsKCgkJCQljb25zdCBwcmVleGlzdGluZ1Byb2dyYW0gPSBwcm9ncmFtc1sgcCBdOwoKCQkJCWlmICggcHJlZXhpc3RpbmdQcm9ncmFtLmNhY2hlS2V5ID09PSBjYWNoZUtleSApIHsKCgkJCQkJcHJvZ3JhbSA9IHByZWV4aXN0aW5nUHJvZ3JhbTsKCQkJCQkrKyBwcm9ncmFtLnVzZWRUaW1lczsKCgkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBwcm9ncmFtID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJvZ3JhbSA9IG5ldyBXZWJHTFByb2dyYW0oIHJlbmRlcmVyLCBjYWNoZUtleSwgcGFyYW1ldGVycywgYmluZGluZ1N0YXRlcyApOwoJCQkJcHJvZ3JhbXMucHVzaCggcHJvZ3JhbSApOwoKCQkJfQoKCQkJcmV0dXJuIHByb2dyYW07CgoJCX0KCgkJZnVuY3Rpb24gcmVsZWFzZVByb2dyYW0oIHByb2dyYW0gKSB7CgoJCQlpZiAoIC0tIHByb2dyYW0udXNlZFRpbWVzID09PSAwICkgewoKCQkJCS8vIFJlbW92ZSBmcm9tIHVub3JkZXJlZCBzZXQKCQkJCWNvbnN0IGkgPSBwcm9ncmFtcy5pbmRleE9mKCBwcm9ncmFtICk7CgkJCQlwcm9ncmFtc1sgaSBdID0gcHJvZ3JhbXNbIHByb2dyYW1zLmxlbmd0aCAtIDEgXTsKCQkJCXByb2dyYW1zLnBvcCgpOwoKCQkJCS8vIEZyZWUgV2ViR0wgcmVzb3VyY2VzCgkJCQlwcm9ncmFtLmRlc3Ryb3koKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWxlYXNlU2hhZGVyQ2FjaGUoIG1hdGVyaWFsICkgewoKCQkJX2N1c3RvbVNoYWRlcnMucmVtb3ZlKCBtYXRlcmlhbCApOwoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQlfY3VzdG9tU2hhZGVycy5kaXNwb3NlKCk7CgoJCX0KCgkJcmV0dXJuIHsKCQkJZ2V0UGFyYW1ldGVyczogZ2V0UGFyYW1ldGVycywKCQkJZ2V0UHJvZ3JhbUNhY2hlS2V5OiBnZXRQcm9ncmFtQ2FjaGVLZXksCgkJCWdldFVuaWZvcm1zOiBnZXRVbmlmb3JtcywKCQkJYWNxdWlyZVByb2dyYW06IGFjcXVpcmVQcm9ncmFtLAoJCQlyZWxlYXNlUHJvZ3JhbTogcmVsZWFzZVByb2dyYW0sCgkJCXJlbGVhc2VTaGFkZXJDYWNoZTogcmVsZWFzZVNoYWRlckNhY2hlLAoJCQkvLyBFeHBvc2VkIGZvciByZXNvdXJjZSBtb25pdG9yaW5nICYgZXJyb3IgZmVlZGJhY2sgdmlhIHJlbmRlcmVyLmluZm86CgkJCXByb2dyYW1zOiBwcm9ncmFtcywKCQkJZGlzcG9zZTogZGlzcG9zZQoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMUHJvcGVydGllcygpIHsKCgkJbGV0IHByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBoYXMoIG9iamVjdCApIHsKCgkJCXJldHVybiBwcm9wZXJ0aWVzLmhhcyggb2JqZWN0ICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCBvYmplY3QgKSB7CgoJCQlsZXQgbWFwID0gcHJvcGVydGllcy5nZXQoIG9iamVjdCApOwoKCQkJaWYgKCBtYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCQltYXAgPSB7fTsKCQkJCXByb3BlcnRpZXMuc2V0KCBvYmplY3QsIG1hcCApOwoKCQkJfQoKCQkJcmV0dXJuIG1hcDsKCgkJfQoKCQlmdW5jdGlvbiByZW1vdmUoIG9iamVjdCApIHsKCgkJCXByb3BlcnRpZXMuZGVsZXRlKCBvYmplY3QgKTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwga2V5LCB2YWx1ZSApIHsKCgkJCXByb3BlcnRpZXMuZ2V0KCBvYmplY3QgKVsga2V5IF0gPSB2YWx1ZTsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJcHJvcGVydGllcyA9IG5ldyBXZWFrTWFwKCk7CgoJCX0KCgkJcmV0dXJuIHsKCQkJaGFzOiBoYXMsCgkJCWdldDogZ2V0LAoJCQlyZW1vdmU6IHJlbW92ZSwKCQkJdXBkYXRlOiB1cGRhdGUsCgkJCWRpc3Bvc2U6IGRpc3Bvc2UKCQl9OwoKCX0KCglmdW5jdGlvbiBwYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCgkJaWYgKCBhLmdyb3VwT3JkZXIgIT09IGIuZ3JvdXBPcmRlciApIHsKCgkJCXJldHVybiBhLmdyb3VwT3JkZXIgLSBiLmdyb3VwT3JkZXI7CgoJCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCQlyZXR1cm4gYS5yZW5kZXJPcmRlciAtIGIucmVuZGVyT3JkZXI7CgoJCX0gZWxzZSBpZiAoIGEubWF0ZXJpYWwuaWQgIT09IGIubWF0ZXJpYWwuaWQgKSB7CgoJCQlyZXR1cm4gYS5tYXRlcmlhbC5pZCAtIGIubWF0ZXJpYWwuaWQ7CgoJCX0gZWxzZSBpZiAoIGEueiAhPT0gYi56ICkgewoKCQkJcmV0dXJuIGEueiAtIGIuejsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBhLmlkIC0gYi5pZDsKCgkJfQoKCX0KCglmdW5jdGlvbiByZXZlcnNlUGFpbnRlclNvcnRTdGFibGUoIGEsIGIgKSB7CgoJCWlmICggYS5ncm91cE9yZGVyICE9PSBiLmdyb3VwT3JkZXIgKSB7CgoJCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCQl9IGVsc2UgaWYgKCBhLnJlbmRlck9yZGVyICE9PSBiLnJlbmRlck9yZGVyICkgewoKCQkJcmV0dXJuIGEucmVuZGVyT3JkZXIgLSBiLnJlbmRlck9yZGVyOwoKCQl9IGVsc2UgaWYgKCBhLnogIT09IGIueiApIHsKCgkJCXJldHVybiBiLnogLSBhLno7CgoJCX0gZWxzZSB7CgoJCQlyZXR1cm4gYS5pZCAtIGIuaWQ7CgoJCX0KCgl9CgoKCWZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdCgpIHsKCgkJY29uc3QgcmVuZGVySXRlbXMgPSBbXTsKCQlsZXQgcmVuZGVySXRlbXNJbmRleCA9IDA7CgoJCWNvbnN0IG9wYXF1ZSA9IFtdOwoJCWNvbnN0IHRyYW5zbWlzc2l2ZSA9IFtdOwoJCWNvbnN0IHRyYW5zcGFyZW50ID0gW107CgoJCWZ1bmN0aW9uIGluaXQoKSB7CgoJCQlyZW5kZXJJdGVtc0luZGV4ID0gMDsKCgkJCW9wYXF1ZS5sZW5ndGggPSAwOwoJCQl0cmFuc21pc3NpdmUubGVuZ3RoID0gMDsKCQkJdHJhbnNwYXJlbnQubGVuZ3RoID0gMDsKCgkJfQoKCQlmdW5jdGlvbiBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQkJbGV0IHJlbmRlckl0ZW0gPSByZW5kZXJJdGVtc1sgcmVuZGVySXRlbXNJbmRleCBdOwoKCQkJaWYgKCByZW5kZXJJdGVtID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcmVuZGVySXRlbSA9IHsKCQkJCQlpZDogb2JqZWN0LmlkLAoJCQkJCW9iamVjdDogb2JqZWN0LAoJCQkJCWdlb21ldHJ5OiBnZW9tZXRyeSwKCQkJCQltYXRlcmlhbDogbWF0ZXJpYWwsCgkJCQkJZ3JvdXBPcmRlcjogZ3JvdXBPcmRlciwKCQkJCQlyZW5kZXJPcmRlcjogb2JqZWN0LnJlbmRlck9yZGVyLAoJCQkJCXo6IHosCgkJCQkJZ3JvdXA6IGdyb3VwCgkJCQl9OwoKCQkJCXJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF0gPSByZW5kZXJJdGVtOwoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwoJCQkJcmVuZGVySXRlbS5vYmplY3QgPSBvYmplY3Q7CgkJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJCQlyZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgkJCQlyZW5kZXJJdGVtLmdyb3VwT3JkZXIgPSBncm91cE9yZGVyOwoJCQkJcmVuZGVySXRlbS5yZW5kZXJPcmRlciA9IG9iamVjdC5yZW5kZXJPcmRlcjsKCQkJCXJlbmRlckl0ZW0ueiA9IHo7CgkJCQlyZW5kZXJJdGVtLmdyb3VwID0gZ3JvdXA7CgoJCQl9CgoJCQlyZW5kZXJJdGVtc0luZGV4ICsrOwoKCQkJcmV0dXJuIHJlbmRlckl0ZW07CgoJCX0KCgkJZnVuY3Rpb24gcHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQkJY29uc3QgcmVuZGVySXRlbSA9IGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKTsKCgkJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKCQkJCXRyYW5zbWlzc2l2ZS5wdXNoKCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIHsKCgkJCQl0cmFuc3BhcmVudC5wdXNoKCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgewoKCQkJCW9wYXF1ZS5wdXNoKCByZW5kZXJJdGVtICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdW5zaGlmdCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQkJY29uc3QgcmVuZGVySXRlbSA9IGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKTsKCgkJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKCQkJCXRyYW5zbWlzc2l2ZS51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIHsKCgkJCQl0cmFuc3BhcmVudC51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgewoKCQkJCW9wYXF1ZS51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc29ydCggY3VzdG9tT3BhcXVlU29ydCwgY3VzdG9tVHJhbnNwYXJlbnRTb3J0ICkgewoKCQkJaWYgKCBvcGFxdWUubGVuZ3RoID4gMSApIG9wYXF1ZS5zb3J0KCBjdXN0b21PcGFxdWVTb3J0IHx8IHBhaW50ZXJTb3J0U3RhYmxlICk7CgkJCWlmICggdHJhbnNtaXNzaXZlLmxlbmd0aCA+IDEgKSB0cmFuc21pc3NpdmUuc29ydCggY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSApOwoJCQlpZiAoIHRyYW5zcGFyZW50Lmxlbmd0aCA+IDEgKSB0cmFuc3BhcmVudC5zb3J0KCBjdXN0b21UcmFuc3BhcmVudFNvcnQgfHwgcmV2ZXJzZVBhaW50ZXJTb3J0U3RhYmxlICk7CgoJCX0KCgkJZnVuY3Rpb24gZmluaXNoKCkgewoKCQkJLy8gQ2xlYXIgcmVmZXJlbmNlcyBmcm9tIGluYWN0aXZlIHJlbmRlckl0ZW1zIGluIHRoZSBsaXN0CgoJCQlmb3IgKCBsZXQgaSA9IHJlbmRlckl0ZW1zSW5kZXgsIGlsID0gcmVuZGVySXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckl0ZW1zWyBpIF07CgoJCQkJaWYgKCByZW5kZXJJdGVtLmlkID09PSBudWxsICkgYnJlYWs7CgoJCQkJcmVuZGVySXRlbS5pZCA9IG51bGw7CgkJCQlyZW5kZXJJdGVtLm9iamVjdCA9IG51bGw7CgkJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gbnVsbDsKCQkJCXJlbmRlckl0ZW0ubWF0ZXJpYWwgPSBudWxsOwoJCQkJcmVuZGVySXRlbS5ncm91cCA9IG51bGw7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCgkJCW9wYXF1ZTogb3BhcXVlLAoJCQl0cmFuc21pc3NpdmU6IHRyYW5zbWlzc2l2ZSwKCQkJdHJhbnNwYXJlbnQ6IHRyYW5zcGFyZW50LAoKCQkJaW5pdDogaW5pdCwKCQkJcHVzaDogcHVzaCwKCQkJdW5zaGlmdDogdW5zaGlmdCwKCQkJZmluaXNoOiBmaW5pc2gsCgoJCQlzb3J0OiBzb3J0CgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0cygpIHsKCgkJbGV0IGxpc3RzID0gbmV3IFdlYWtNYXAoKTsKCgkJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgcmVuZGVyQ2FsbERlcHRoICkgewoKCQkJY29uc3QgbGlzdEFycmF5ID0gbGlzdHMuZ2V0KCBzY2VuZSApOwoJCQlsZXQgbGlzdDsKCgkJCWlmICggbGlzdEFycmF5ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKCQkJCWxpc3RzLnNldCggc2NlbmUsIFsgbGlzdCBdICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IGxpc3RBcnJheS5sZW5ndGggKSB7CgoJCQkJCWxpc3QgPSBuZXcgV2ViR0xSZW5kZXJMaXN0KCk7CgkJCQkJbGlzdEFycmF5LnB1c2goIGxpc3QgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlsaXN0ID0gbGlzdEFycmF5WyByZW5kZXJDYWxsRGVwdGggXTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbGlzdDsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJbGlzdHMgPSBuZXcgV2Vha01hcCgpOwoKCQl9CgoJCXJldHVybiB7CgkJCWdldDogZ2V0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJZnVuY3Rpb24gVW5pZm9ybXNDYWNoZSgpIHsKCgkJY29uc3QgbGlnaHRzID0ge307CgoJCXJldHVybiB7CgoJCQlnZXQ6IGZ1bmN0aW9uICggbGlnaHQgKSB7CgoJCQkJaWYgKCBsaWdodHNbIGxpZ2h0LmlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcmV0dXJuIGxpZ2h0c1sgbGlnaHQuaWQgXTsKCgkJCQl9CgoJCQkJbGV0IHVuaWZvcm1zOwoKCQkJCXN3aXRjaCAoIGxpZ2h0LnR5cGUgKSB7CgoJCQkJCWNhc2UgJ0RpcmVjdGlvbmFsTGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnU3BvdExpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlwb3NpdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCWRpc3RhbmNlOiAwLAoJCQkJCQkJY29uZUNvczogMCwKCQkJCQkJCXBlbnVtYnJhQ29zOiAwLAoJCQkJCQkJZGVjYXk6IDAKCQkJCQkJfTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ1BvaW50TGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpLAoJCQkJCQkJZGlzdGFuY2U6IDAsCgkJCQkJCQlkZWNheTogMAoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnSGVtaXNwaGVyZUxpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCQlza3lDb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCQlncm91bmRDb2xvcjogbmV3IENvbG9yKCkKCQkJCQkJfTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ1JlY3RBcmVhTGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJaGFsZldpZHRoOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJaGFsZkhlaWdodDogbmV3IFZlY3RvcjMoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQkJbGlnaHRzWyBsaWdodC5pZCBdID0gdW5pZm9ybXM7CgoJCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQkJfQoKCQl9OwoKCX0KCglmdW5jdGlvbiBTaGFkb3dVbmlmb3Jtc0NhY2hlKCkgewoKCQljb25zdCBsaWdodHMgPSB7fTsKCgkJcmV0dXJuIHsKCgkJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCgkJCQlpZiAoIGxpZ2h0c1sgbGlnaHQuaWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKCQkJCX0KCgkJCQlsZXQgdW5pZm9ybXM7CgoJCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCgkJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CgkJCQkJCXVuaWZvcm1zID0gewoJCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAoJCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCgkJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCgkJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCgkJCQkJCX07CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdTcG90TGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCXNoYWRvd0ludGVuc2l0eTogMSwKCQkJCQkJCXNoYWRvd0JpYXM6IDAsCgkJCQkJCQlzaGFkb3dOb3JtYWxCaWFzOiAwLAoJCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQkJc2hhZG93TWFwU2l6ZTogbmV3IFZlY3RvcjIoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnUG9pbnRMaWdodCc6CgkJCQkJCXVuaWZvcm1zID0gewoJCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAoJCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCgkJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCgkJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAoJCQkJCQkJc2hhZG93Q2FtZXJhTmVhcjogMSwKCQkJCQkJCXNoYWRvd0NhbWVyYUZhcjogMTAwMAoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IHNldCBSZWN0QXJlYUxpZ2h0IHNoYWRvdyB1bmlmb3JtcwoKCQkJCX0KCgkJCQlsaWdodHNbIGxpZ2h0LmlkIF0gPSB1bmlmb3JtczsKCgkJCQlyZXR1cm4gdW5pZm9ybXM7CgoJCQl9CgoJCX07CgoJfQoKCgoJbGV0IG5leHRWZXJzaW9uID0gMDsKCglmdW5jdGlvbiBzaGFkb3dDYXN0aW5nQW5kVGV4dHVyaW5nTGlnaHRzRmlyc3QoIGxpZ2h0QSwgbGlnaHRCICkgewoKCQlyZXR1cm4gKCBsaWdodEIuY2FzdFNoYWRvdyA/IDIgOiAwICkgLSAoIGxpZ2h0QS5jYXN0U2hhZG93ID8gMiA6IDAgKSArICggbGlnaHRCLm1hcCA/IDEgOiAwICkgLSAoIGxpZ2h0QS5tYXAgPyAxIDogMCApOwoKCX0KCglmdW5jdGlvbiBXZWJHTExpZ2h0cyggZXh0ZW5zaW9ucyApIHsKCgkJY29uc3QgY2FjaGUgPSBuZXcgVW5pZm9ybXNDYWNoZSgpOwoKCQljb25zdCBzaGFkb3dDYWNoZSA9IFNoYWRvd1VuaWZvcm1zQ2FjaGUoKTsKCgkJY29uc3Qgc3RhdGUgPSB7CgoJCQl2ZXJzaW9uOiAwLAoKCQkJaGFzaDogewoJCQkJZGlyZWN0aW9uYWxMZW5ndGg6IC0xLAoJCQkJcG9pbnRMZW5ndGg6IC0xLAoJCQkJc3BvdExlbmd0aDogLTEsCgkJCQlyZWN0QXJlYUxlbmd0aDogLTEsCgkJCQloZW1pTGVuZ3RoOiAtMSwKCgkJCQludW1EaXJlY3Rpb25hbFNoYWRvd3M6IC0xLAoJCQkJbnVtUG9pbnRTaGFkb3dzOiAtMSwKCQkJCW51bVNwb3RTaGFkb3dzOiAtMSwKCQkJCW51bVNwb3RNYXBzOiAtMSwKCgkJCQludW1MaWdodFByb2JlczogLTEKCQkJfSwKCgkJCWFtYmllbnQ6IFsgMCwgMCwgMCBdLAoJCQlwcm9iZTogW10sCgkJCWRpcmVjdGlvbmFsOiBbXSwKCQkJZGlyZWN0aW9uYWxTaGFkb3c6IFtdLAoJCQlkaXJlY3Rpb25hbFNoYWRvd01hcDogW10sCgkJCWRpcmVjdGlvbmFsU2hhZG93TWF0cml4OiBbXSwKCQkJc3BvdDogW10sCgkJCXNwb3RMaWdodE1hcDogW10sCgkJCXNwb3RTaGFkb3c6IFtdLAoJCQlzcG90U2hhZG93TWFwOiBbXSwKCQkJc3BvdExpZ2h0TWF0cml4OiBbXSwKCQkJcmVjdEFyZWE6IFtdLAoJCQlyZWN0QXJlYUxUQzE6IG51bGwsCgkJCXJlY3RBcmVhTFRDMjogbnVsbCwKCQkJcG9pbnQ6IFtdLAoJCQlwb2ludFNoYWRvdzogW10sCgkJCXBvaW50U2hhZG93TWFwOiBbXSwKCQkJcG9pbnRTaGFkb3dNYXRyaXg6IFtdLAoJCQloZW1pOiBbXSwKCQkJbnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOiAwLAoJCQludW1MaWdodFByb2JlczogMAoKCQl9OwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgc3RhdGUucHJvYmUucHVzaCggbmV3IFZlY3RvcjMoKSApOwoKCQljb25zdCB2ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBtYXRyaXg0ID0gbmV3IE1hdHJpeDQoKTsKCQljb25zdCBtYXRyaXg0MiA9IG5ldyBNYXRyaXg0KCk7CgoJCWZ1bmN0aW9uIHNldHVwKCBsaWdodHMgKSB7CgoJCQlsZXQgciA9IDAsIGcgPSAwLCBiID0gMDsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSBzdGF0ZS5wcm9iZVsgaSBdLnNldCggMCwgMCwgMCApOwoKCQkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKCQkJbGV0IHBvaW50TGVuZ3RoID0gMDsKCQkJbGV0IHNwb3RMZW5ndGggPSAwOwoJCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwoJCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgoJCQlsZXQgbnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gMDsKCQkJbGV0IG51bVBvaW50U2hhZG93cyA9IDA7CgkJCWxldCBudW1TcG90U2hhZG93cyA9IDA7CgkJCWxldCBudW1TcG90TWFwcyA9IDA7CgkJCWxldCBudW1TcG90U2hhZG93c1dpdGhNYXBzID0gMDsKCgkJCWxldCBudW1MaWdodFByb2JlcyA9IDA7CgoJCQkvLyBvcmRlcmluZyA6IFtzaGFkb3cgY2FzdGluZyArIG1hcCB0ZXh0dXJpbmcsIG1hcCB0ZXh0dXJpbmcsIHNoYWRvdyBjYXN0aW5nLCBub25lIF0KCQkJbGlnaHRzLnNvcnQoIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgbGlnaHQgPSBsaWdodHNbIGkgXTsKCgkJCQljb25zdCBjb2xvciA9IGxpZ2h0LmNvbG9yOwoJCQkJY29uc3QgaW50ZW5zaXR5ID0gbGlnaHQuaW50ZW5zaXR5OwoJCQkJY29uc3QgZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCgkJCQljb25zdCBzaGFkb3dNYXAgPSAoIGxpZ2h0LnNoYWRvdyAmJiBsaWdodC5zaGFkb3cubWFwICkgPyBsaWdodC5zaGFkb3cubWFwLnRleHR1cmUgOiBudWxsOwoKCQkJCWlmICggbGlnaHQuaXNBbWJpZW50TGlnaHQgKSB7CgoJCQkJCXIgKz0gY29sb3IuciAqIGludGVuc2l0eTsKCQkJCQlnICs9IGNvbG9yLmcgKiBpbnRlbnNpdHk7CgkJCQkJYiArPSBjb2xvci5iICogaW50ZW5zaXR5OwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzTGlnaHRQcm9iZSApIHsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgOTsgaiArKyApIHsKCgkJCQkJCXN0YXRlLnByb2JlWyBqIF0uYWRkU2NhbGVkVmVjdG9yKCBsaWdodC5zaC5jb2VmZmljaWVudHNbIGogXSwgaW50ZW5zaXR5ICk7CgoJCQkJCX0KCgkJCQkJbnVtTGlnaHRQcm9iZXMgKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNEaXJlY3Rpb25hbExpZ2h0ICkgewoKCQkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJdW5pZm9ybXMuY29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggbGlnaHQuaW50ZW5zaXR5ICk7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCgkJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93WyBkaXJlY3Rpb25hbExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CgkJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwWyBkaXJlY3Rpb25hbExlbmd0aCBdID0gc2hhZG93TWFwOwoJCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CgoJCQkJCQludW1EaXJlY3Rpb25hbFNoYWRvd3MgKys7CgoJCQkJCX0KCgkJCQkJc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJZGlyZWN0aW9uYWxMZW5ndGggKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNTcG90TGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgoJCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoJCQkJCXVuaWZvcm1zLmRpc3RhbmNlID0gZGlzdGFuY2U7CgoJCQkJCXVuaWZvcm1zLmNvbmVDb3MgPSBNYXRoLmNvcyggbGlnaHQuYW5nbGUgKTsKCQkJCQl1bmlmb3Jtcy5wZW51bWJyYUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSAqICggMSAtIGxpZ2h0LnBlbnVtYnJhICkgKTsKCQkJCQl1bmlmb3Jtcy5kZWNheSA9IGxpZ2h0LmRlY2F5OwoKCQkJCQlzdGF0ZS5zcG90WyBzcG90TGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCQlpZiAoIGxpZ2h0Lm1hcCApIHsKCgkJCQkJCXN0YXRlLnNwb3RMaWdodE1hcFsgbnVtU3BvdE1hcHMgXSA9IGxpZ2h0Lm1hcDsKCQkJCQkJbnVtU3BvdE1hcHMgKys7CgoJCQkJCQkvLyBtYWtlIHN1cmUgdGhlIGxpZ2h0TWF0cml4IGlzIHVwIHRvIGRhdGUKCQkJCQkJLy8gVE9ETyA6IGRvIGl0IGlmIHJlcXVpcmVkIG9ubHkKCQkJCQkJc2hhZG93LnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKCQkJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgbnVtU3BvdFNoYWRvd3NXaXRoTWFwcyArKzsKCgkJCQkJfQoKCQkJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXhbIHNwb3RMZW5ndGggXSA9IHNoYWRvdy5tYXRyaXg7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJCXN0YXRlLnNwb3RTaGFkb3dbIHNwb3RMZW5ndGggXSA9IHNoYWRvd1VuaWZvcm1zOwoJCQkJCQlzdGF0ZS5zcG90U2hhZG93TWFwWyBzcG90TGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgoJCQkJCQludW1TcG90U2hhZG93cyArKzsKCgkJCQkJfQoKCQkJCQlzcG90TGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCgkJCQkJY29uc3QgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgoJCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoKCQkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKCQkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKCQkJCQlzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXSA9IHVuaWZvcm1zOwoKCQkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKTsKCQkJCQl1bmlmb3Jtcy5kaXN0YW5jZSA9IGxpZ2h0LmRpc3RhbmNlOwoJCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCgkJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhTmVhciA9IHNoYWRvdy5jYW1lcmEubmVhcjsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhRmFyID0gc2hhZG93LmNhbWVyYS5mYXI7CgoJCQkJCQlzdGF0ZS5wb2ludFNoYWRvd1sgcG9pbnRMZW5ndGggXSA9IHNoYWRvd1VuaWZvcm1zOwoJCQkJCQlzdGF0ZS5wb2ludFNoYWRvd01hcFsgcG9pbnRMZW5ndGggXSA9IHNoYWRvd01hcDsKCQkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXhbIHBvaW50TGVuZ3RoIF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwoKCQkJCQkJbnVtUG9pbnRTaGFkb3dzICsrOwoKCQkJCQl9CgoJCQkJCXN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJCXBvaW50TGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzSGVtaXNwaGVyZUxpZ2h0ICkgewoKCQkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJdW5pZm9ybXMuc2t5Q29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgkJCQkJdW5pZm9ybXMuZ3JvdW5kQ29sb3IuY29weSggbGlnaHQuZ3JvdW5kQ29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgoJCQkJCXN0YXRlLmhlbWlbIGhlbWlMZW5ndGggXSA9IHVuaWZvcm1zOwoKCQkJCQloZW1pTGVuZ3RoICsrOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggcmVjdEFyZWFMZW5ndGggPiAwICkgewoKCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IHRydWUgKSB7CgoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8xOwoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8yOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzE7CgkJCQkJc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0hBTEZfMjsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5hbWJpZW50WyAwIF0gPSByOwoJCQlzdGF0ZS5hbWJpZW50WyAxIF0gPSBnOwoJCQlzdGF0ZS5hbWJpZW50WyAyIF0gPSBiOwoKCQkJY29uc3QgaGFzaCA9IHN0YXRlLmhhc2g7CgoJCQlpZiAoIGhhc2guZGlyZWN0aW9uYWxMZW5ndGggIT09IGRpcmVjdGlvbmFsTGVuZ3RoIHx8CgkJCQloYXNoLnBvaW50TGVuZ3RoICE9PSBwb2ludExlbmd0aCB8fAoJCQkJaGFzaC5zcG90TGVuZ3RoICE9PSBzcG90TGVuZ3RoIHx8CgkJCQloYXNoLnJlY3RBcmVhTGVuZ3RoICE9PSByZWN0QXJlYUxlbmd0aCB8fAoJCQkJaGFzaC5oZW1pTGVuZ3RoICE9PSBoZW1pTGVuZ3RoIHx8CgkJCQloYXNoLm51bURpcmVjdGlvbmFsU2hhZG93cyAhPT0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzIHx8CgkJCQloYXNoLm51bVBvaW50U2hhZG93cyAhPT0gbnVtUG9pbnRTaGFkb3dzIHx8CgkJCQloYXNoLm51bVNwb3RTaGFkb3dzICE9PSBudW1TcG90U2hhZG93cyB8fAoJCQkJaGFzaC5udW1TcG90TWFwcyAhPT0gbnVtU3BvdE1hcHMgfHwKCQkJCWhhc2gubnVtTGlnaHRQcm9iZXMgIT09IG51bUxpZ2h0UHJvYmVzICkgewoKCQkJCXN0YXRlLmRpcmVjdGlvbmFsLmxlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwoJCQkJc3RhdGUuc3BvdC5sZW5ndGggPSBzcG90TGVuZ3RoOwoJCQkJc3RhdGUucmVjdEFyZWEubGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCQlzdGF0ZS5wb2ludC5sZW5ndGggPSBwb2ludExlbmd0aDsKCQkJCXN0YXRlLmhlbWkubGVuZ3RoID0gaGVtaUxlbmd0aDsKCgkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdy5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CgkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CgkJCQlzdGF0ZS5wb2ludFNoYWRvdy5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CgkJCQlzdGF0ZS5wb2ludFNoYWRvd01hcC5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CgkJCQlzdGF0ZS5zcG90U2hhZG93Lmxlbmd0aCA9IG51bVNwb3RTaGFkb3dzOwoJCQkJc3RhdGUuc3BvdFNoYWRvd01hcC5sZW5ndGggPSBudW1TcG90U2hhZG93czsKCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJCXN0YXRlLnBvaW50U2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bVBvaW50U2hhZG93czsKCQkJCXN0YXRlLnNwb3RMaWdodE1hdHJpeC5sZW5ndGggPSBudW1TcG90U2hhZG93cyArIG51bVNwb3RNYXBzIC0gbnVtU3BvdFNoYWRvd3NXaXRoTWFwczsKCQkJCXN0YXRlLnNwb3RMaWdodE1hcC5sZW5ndGggPSBudW1TcG90TWFwczsKCQkJCXN0YXRlLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcyA9IG51bVNwb3RTaGFkb3dzV2l0aE1hcHM7CgkJCQlzdGF0ZS5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKCQkJCWhhc2guZGlyZWN0aW9uYWxMZW5ndGggPSBkaXJlY3Rpb25hbExlbmd0aDsKCQkJCWhhc2gucG9pbnRMZW5ndGggPSBwb2ludExlbmd0aDsKCQkJCWhhc2guc3BvdExlbmd0aCA9IHNwb3RMZW5ndGg7CgkJCQloYXNoLnJlY3RBcmVhTGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCQloYXNoLmhlbWlMZW5ndGggPSBoZW1pTGVuZ3RoOwoKCQkJCWhhc2gubnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzOwoJCQkJaGFzaC5udW1Qb2ludFNoYWRvd3MgPSBudW1Qb2ludFNoYWRvd3M7CgkJCQloYXNoLm51bVNwb3RTaGFkb3dzID0gbnVtU3BvdFNoYWRvd3M7CgkJCQloYXNoLm51bVNwb3RNYXBzID0gbnVtU3BvdE1hcHM7CgoJCQkJaGFzaC5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKCQkJCXN0YXRlLnZlcnNpb24gPSBuZXh0VmVyc2lvbiArKzsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXR1cFZpZXcoIGxpZ2h0cywgY2FtZXJhICkgewoKCQkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKCQkJbGV0IHBvaW50TGVuZ3RoID0gMDsKCQkJbGV0IHNwb3RMZW5ndGggPSAwOwoJCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwoJCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgoJCQljb25zdCB2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgoJCQkJaWYgKCBsaWdodC5pc0RpcmVjdGlvbmFsTGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF07CgoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQkJdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zdWIoIHZlY3RvcjMgKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCB2aWV3TWF0cml4ICk7CgoJCQkJCWRpcmVjdGlvbmFsTGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzU3BvdExpZ2h0ICkgewoKCQkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnNwb3RbIHNwb3RMZW5ndGggXTsKCgkJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC50YXJnZXQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKCB2ZWN0b3IzICk7CgkJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKCQkJCQlzcG90TGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCgkJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXTsKCgkJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKCQkJCQkvLyBleHRyYWN0IGxvY2FsIHJvdGF0aW9uIG9mIGxpZ2h0IHRvIGRlcml2ZSB3aWR0aC9oZWlnaHQgaGFsZiB2ZWN0b3JzCgkJCQkJbWF0cml4NDIuaWRlbnRpdHkoKTsKCQkJCQltYXRyaXg0LmNvcHkoIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQkJbWF0cml4NC5wcmVtdWx0aXBseSggdmlld01hdHJpeCApOwoJCQkJCW1hdHJpeDQyLmV4dHJhY3RSb3RhdGlvbiggbWF0cml4NCApOwoKCQkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKCQkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKCQkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguYXBwbHlNYXRyaXg0KCBtYXRyaXg0MiApOwoJCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuYXBwbHlNYXRyaXg0KCBtYXRyaXg0MiApOwoKCQkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUucG9pbnRbIHBvaW50TGVuZ3RoIF07CgoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkJcG9pbnRMZW5ndGggKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuaGVtaVsgaGVtaUxlbmd0aCBdOwoKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCgkJCQkJaGVtaUxlbmd0aCArKzsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCQkJc2V0dXA6IHNldHVwLAoJCQlzZXR1cFZpZXc6IHNldHVwVmlldywKCQkJc3RhdGU6IHN0YXRlCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZSggZXh0ZW5zaW9ucyApIHsKCgkJY29uc3QgbGlnaHRzID0gbmV3IFdlYkdMTGlnaHRzKCBleHRlbnNpb25zICk7CgoJCWNvbnN0IGxpZ2h0c0FycmF5ID0gW107CgkJY29uc3Qgc2hhZG93c0FycmF5ID0gW107CgoJCWZ1bmN0aW9uIGluaXQoIGNhbWVyYSApIHsKCgkJCXN0YXRlLmNhbWVyYSA9IGNhbWVyYTsKCgkJCWxpZ2h0c0FycmF5Lmxlbmd0aCA9IDA7CgkJCXNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2hMaWdodCggbGlnaHQgKSB7CgoJCQlsaWdodHNBcnJheS5wdXNoKCBsaWdodCApOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2hTaGFkb3coIHNoYWRvd0xpZ2h0ICkgewoKCQkJc2hhZG93c0FycmF5LnB1c2goIHNoYWRvd0xpZ2h0ICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBMaWdodHMoKSB7CgoJCQlsaWdodHMuc2V0dXAoIGxpZ2h0c0FycmF5ICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKSB7CgoJCQlsaWdodHMuc2V0dXBWaWV3KCBsaWdodHNBcnJheSwgY2FtZXJhICk7CgoJCX0KCgkJY29uc3Qgc3RhdGUgPSB7CgkJCWxpZ2h0c0FycmF5OiBsaWdodHNBcnJheSwKCQkJc2hhZG93c0FycmF5OiBzaGFkb3dzQXJyYXksCgoJCQljYW1lcmE6IG51bGwsCgoJCQlsaWdodHM6IGxpZ2h0cywKCgkJCXRyYW5zbWlzc2lvblJlbmRlclRhcmdldDoge30KCQl9OwoKCQlyZXR1cm4gewoJCQlpbml0OiBpbml0LAoJCQlzdGF0ZTogc3RhdGUsCgkJCXNldHVwTGlnaHRzOiBzZXR1cExpZ2h0cywKCQkJc2V0dXBMaWdodHNWaWV3OiBzZXR1cExpZ2h0c1ZpZXcsCgoJCQlwdXNoTGlnaHQ6IHB1c2hMaWdodCwKCQkJcHVzaFNoYWRvdzogcHVzaFNoYWRvdwoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMUmVuZGVyU3RhdGVzKCBleHRlbnNpb25zICkgewoKCQlsZXQgcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCgkJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgcmVuZGVyQ2FsbERlcHRoID0gMCApIHsKCgkJCWNvbnN0IHJlbmRlclN0YXRlQXJyYXkgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSApOwoJCQlsZXQgcmVuZGVyU3RhdGU7CgoJCQlpZiAoIHJlbmRlclN0YXRlQXJyYXkgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICk7CgkJCQlyZW5kZXJTdGF0ZXMuc2V0KCBzY2VuZSwgWyByZW5kZXJTdGF0ZSBdICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IHJlbmRlclN0YXRlQXJyYXkubGVuZ3RoICkgewoKCQkJCQlyZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICk7CgkJCQkJcmVuZGVyU3RhdGVBcnJheS5wdXNoKCByZW5kZXJTdGF0ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVBcnJheVsgcmVuZGVyQ2FsbERlcHRoIF07CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHJlbmRlclN0YXRlOwoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQlyZW5kZXJTdGF0ZXMgPSBuZXcgV2Vha01hcCgpOwoKCQl9CgoJCXJldHVybiB7CgkJCWdldDogZ2V0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJY29uc3QgdmVydGV4ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG59IjsKCgljb25zdCBmcmFnbWVudCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCBzaGFkb3dfcGFzcztcbnVuaWZvcm0gdmVjMiByZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCByYWRpdXM7XG4jaW5jbHVkZSA8cGFja2luZz5cbnZvaWQgbWFpbigpIHtcblx0Y29uc3QgZmxvYXQgc2FtcGxlcyA9IGZsb2F0KCBWU01fU0FNUExFUyApO1xuXHRmbG9hdCBtZWFuID0gMC4wO1xuXHRmbG9hdCBzcXVhcmVkX21lYW4gPSAwLjA7XG5cdGZsb2F0IHV2U3RyaWRlID0gc2FtcGxlcyA8PSAxLjAgPyAwLjAgOiAyLjAgLyAoIHNhbXBsZXMgLSAxLjAgKTtcblx0ZmxvYXQgdXZTdGFydCA9IHNhbXBsZXMgPD0gMS4wID8gMC4wIDogLSAxLjA7XG5cdGZvciAoIGZsb2F0IGkgPSAwLjA7IGkgPCBzYW1wbGVzOyBpICsrICkge1xuXHRcdGZsb2F0IHV2T2Zmc2V0ID0gdXZTdGFydCArIGkgKiB1dlN0cmlkZTtcblx0XHQjaWZkZWYgSE9SSVpPTlRBTF9QQVNTXG5cdFx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIHV2T2Zmc2V0LCAwLjAgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRpc3RyaWJ1dGlvbi54O1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRpc3RyaWJ1dGlvbi55ICogZGlzdHJpYnV0aW9uLnkgKyBkaXN0cmlidXRpb24ueCAqIGRpc3RyaWJ1dGlvbi54O1xuXHRcdCNlbHNlXG5cdFx0XHRmbG9hdCBkZXB0aCA9IHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIDAuMCwgdXZPZmZzZXQgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRlcHRoO1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRlcHRoICogZGVwdGg7XG5cdFx0I2VuZGlmXG5cdH1cblx0bWVhbiA9IG1lYW4gLyBzYW1wbGVzO1xuXHRzcXVhcmVkX21lYW4gPSBzcXVhcmVkX21lYW4gLyBzYW1wbGVzO1xuXHRmbG9hdCBzdGRfZGV2ID0gc3FydCggc3F1YXJlZF9tZWFuIC0gbWVhbiAqIG1lYW4gKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFjazJIYWxmVG9SR0JBKCB2ZWMyKCBtZWFuLCBzdGRfZGV2ICkgKTtcbn0iOwoKCWZ1bmN0aW9uIFdlYkdMU2hhZG93TWFwKCByZW5kZXJlciwgb2JqZWN0cywgY2FwYWJpbGl0aWVzICkgewoKCQlsZXQgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKCQljb25zdCBfc2hhZG93TWFwU2l6ZSA9IG5ldyBWZWN0b3IyKCksCgkJCV92aWV3cG9ydFNpemUgPSBuZXcgVmVjdG9yMigpLAoKCQkJX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKSwKCgkJCV9kZXB0aE1hdGVyaWFsID0gbmV3IE1lc2hEZXB0aE1hdGVyaWFsKCB7IGRlcHRoUGFja2luZzogUkdCQURlcHRoUGFja2luZyB9ICksCgkJCV9kaXN0YW5jZU1hdGVyaWFsID0gbmV3IE1lc2hEaXN0YW5jZU1hdGVyaWFsKCksCgoJCQlfbWF0ZXJpYWxDYWNoZSA9IHt9LAoKCQkJX21heFRleHR1cmVTaXplID0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplOwoKCQljb25zdCBzaGFkb3dTaWRlID0geyBbIEZyb250U2lkZSBdOiBCYWNrU2lkZSwgWyBCYWNrU2lkZSBdOiBGcm9udFNpZGUsIFsgRG91YmxlU2lkZSBdOiBEb3VibGVTaWRlIH07CgoJCWNvbnN0IHNoYWRvd01hdGVyaWFsVmVydGljYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCQkJZGVmaW5lczogewoJCQkJVlNNX1NBTVBMRVM6IDgKCQkJfSwKCQkJdW5pZm9ybXM6IHsKCQkJCXNoYWRvd19wYXNzOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlyZXNvbHV0aW9uOiB7IHZhbHVlOiBuZXcgVmVjdG9yMigpIH0sCgkJCQlyYWRpdXM6IHsgdmFsdWU6IDQuMCB9CgkJCX0sCgoJCQl2ZXJ0ZXhTaGFkZXI6IHZlcnRleCwKCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50CgoJCX0gKTsKCgkJY29uc3Qgc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsID0gc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5jbG9uZSgpOwoJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5kZWZpbmVzLkhPUklaT05UQUxfUEFTUyA9IDE7CgoJCWNvbnN0IGZ1bGxTY3JlZW5UcmkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlmdWxsU2NyZWVuVHJpLnNldEF0dHJpYnV0ZSgKCQkJJ3Bvc2l0aW9uJywKCQkJbmV3IEJ1ZmZlckF0dHJpYnV0ZSgKCQkJCW5ldyBGbG9hdDMyQXJyYXkoIFsgLTEsIC0xLCAwLjUsIDMsIC0xLCAwLjUsIC0xLCAzLCAwLjUgXSApLAoJCQkJMwoJCQkpCgkJKTsKCgkJY29uc3QgZnVsbFNjcmVlbk1lc2ggPSBuZXcgTWVzaCggZnVsbFNjcmVlblRyaSwgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCApOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCQl0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOwoJCXRoaXMubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy50eXBlID0gUENGU2hhZG93TWFwOwoJCWxldCBfcHJldmlvdXNUeXBlID0gdGhpcy50eXBlOwoKCQl0aGlzLnJlbmRlciA9IGZ1bmN0aW9uICggbGlnaHRzLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCQkJaWYgKCBzY29wZS5hdXRvVXBkYXRlID09PSBmYWxzZSAmJiBzY29wZS5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQlpZiAoIGxpZ2h0cy5sZW5ndGggPT09IDAgKSByZXR1cm47CgoJCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJCWNvbnN0IGFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQkJY29uc3QgYWN0aXZlTWlwbWFwTGV2ZWwgPSByZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQkJY29uc3QgX3N0YXRlID0gcmVuZGVyZXIuc3RhdGU7CgoJCQkvLyBTZXQgR0wgc3RhdGUgZm9yIGRlcHRoIG1hcC4KCQkJX3N0YXRlLnNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICk7CgkJCV9zdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCAxLCAxLCAxLCAxICk7CgkJCV9zdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQkJX3N0YXRlLnNldFNjaXNzb3JUZXN0KCBmYWxzZSApOwoKCQkJLy8gY2hlY2sgZm9yIHNoYWRvdyBtYXAgdHlwZSBjaGFuZ2VzCgoJCQljb25zdCB0b1ZTTSA9ICggX3ByZXZpb3VzVHlwZSAhPT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwICk7CgkJCWNvbnN0IGZyb21WU00gPSAoIF9wcmV2aW91c1R5cGUgPT09IFZTTVNoYWRvd01hcCAmJiB0aGlzLnR5cGUgIT09IFZTTVNoYWRvd01hcCApOwoKCQkJLy8gcmVuZGVyIGRlcHRoIG1hcAoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBsaWdodCA9IGxpZ2h0c1sgaSBdOwoJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCWlmICggc2hhZG93ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMU2hhZG93TWFwOicsIGxpZ2h0LCAnaGFzIG5vIHNoYWRvdy4nICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWlmICggc2hhZG93LmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNoYWRvdy5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCgkJCQlfc2hhZG93TWFwU2l6ZS5jb3B5KCBzaGFkb3cubWFwU2l6ZSApOwoKCQkJCWNvbnN0IHNoYWRvd0ZyYW1lRXh0ZW50cyA9IHNoYWRvdy5nZXRGcmFtZUV4dGVudHMoKTsKCgkJCQlfc2hhZG93TWFwU2l6ZS5tdWx0aXBseSggc2hhZG93RnJhbWVFeHRlbnRzICk7CgoJCQkJX3ZpZXdwb3J0U2l6ZS5jb3B5KCBzaGFkb3cubWFwU2l6ZSApOwoKCQkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSB8fCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCQlpZiAoIF9zaGFkb3dNYXBTaXplLnggPiBfbWF4VGV4dHVyZVNpemUgKSB7CgoJCQkJCQlfdmlld3BvcnRTaXplLnggPSBNYXRoLmZsb29yKCBfbWF4VGV4dHVyZVNpemUgLyBzaGFkb3dGcmFtZUV4dGVudHMueCApOwoJCQkJCQlfc2hhZG93TWFwU2l6ZS54ID0gX3ZpZXdwb3J0U2l6ZS54ICogc2hhZG93RnJhbWVFeHRlbnRzLng7CgkJCQkJCXNoYWRvdy5tYXBTaXplLnggPSBfdmlld3BvcnRTaXplLng7CgoJCQkJCX0KCgkJCQkJaWYgKCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCQkJX3ZpZXdwb3J0U2l6ZS55ID0gTWF0aC5mbG9vciggX21heFRleHR1cmVTaXplIC8gc2hhZG93RnJhbWVFeHRlbnRzLnkgKTsKCQkJCQkJX3NoYWRvd01hcFNpemUueSA9IF92aWV3cG9ydFNpemUueSAqIHNoYWRvd0ZyYW1lRXh0ZW50cy55OwoJCQkJCQlzaGFkb3cubWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55OwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggc2hhZG93Lm1hcCA9PT0gbnVsbCB8fCB0b1ZTTSA9PT0gdHJ1ZSB8fCBmcm9tVlNNID09PSB0cnVlICkgewoKCQkJCQljb25zdCBwYXJzID0gKCB0aGlzLnR5cGUgIT09IFZTTVNoYWRvd01hcCApID8geyBtaW5GaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsIG1hZ0ZpbHRlcjogTmVhcmVzdEZpbHRlciB9IDoge307CgoJCQkJCWlmICggc2hhZG93Lm1hcCAhPT0gbnVsbCApIHsKCgkJCQkJCXNoYWRvdy5tYXAuZGlzcG9zZSgpOwoKCQkJCQl9CgoJCQkJCXNoYWRvdy5tYXAgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIF9zaGFkb3dNYXBTaXplLngsIF9zaGFkb3dNYXBTaXplLnksIHBhcnMgKTsKCQkJCQlzaGFkb3cubWFwLnRleHR1cmUubmFtZSA9IGxpZ2h0Lm5hbWUgKyAnLnNoYWRvd01hcCc7CgoJCQkJCXNoYWRvdy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQkJCX0KCgkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXAgKTsKCQkJCXJlbmRlcmVyLmNsZWFyKCk7CgoJCQkJY29uc3Qgdmlld3BvcnRDb3VudCA9IHNoYWRvdy5nZXRWaWV3cG9ydENvdW50KCk7CgoJCQkJZm9yICggbGV0IHZwID0gMDsgdnAgPCB2aWV3cG9ydENvdW50OyB2cCArKyApIHsKCgkJCQkJY29uc3Qgdmlld3BvcnQgPSBzaGFkb3cuZ2V0Vmlld3BvcnQoIHZwICk7CgoJCQkJCV92aWV3cG9ydC5zZXQoCgkJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LngsCgkJCQkJCV92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LnksCgkJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LnosCgkJCQkJCV92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LncKCQkJCQkpOwoKCQkJCQlfc3RhdGUudmlld3BvcnQoIF92aWV3cG9ydCApOwoKCQkJCQlzaGFkb3cudXBkYXRlTWF0cmljZXMoIGxpZ2h0LCB2cCApOwoKCQkJCQlfZnJ1c3R1bSA9IHNoYWRvdy5nZXRGcnVzdHVtKCk7CgoJCQkJCXJlbmRlck9iamVjdCggc2NlbmUsIGNhbWVyYSwgc2hhZG93LmNhbWVyYSwgbGlnaHQsIHRoaXMudHlwZSApOwoKCQkJCX0KCgkJCQkvLyBkbyBibHVyIHBhc3MgZm9yIFZTTQoKCQkJCWlmICggc2hhZG93LmlzUG9pbnRMaWdodFNoYWRvdyAhPT0gdHJ1ZSAmJiB0aGlzLnR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCQkJVlNNUGFzcyggc2hhZG93LCBjYW1lcmEgKTsKCgkJCQl9CgoJCQkJc2hhZG93Lm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCQl9CgoJCQlfcHJldmlvdXNUeXBlID0gdGhpcy50eXBlOwoKCQkJc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJCX07CgoJCWZ1bmN0aW9uIFZTTVBhc3MoIHNoYWRvdywgY2FtZXJhICkgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggZnVsbFNjcmVlbk1lc2ggKTsKCgkJCWlmICggc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTICE9PSBzaGFkb3cuYmx1clNhbXBsZXMgKSB7CgoJCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTID0gc2hhZG93LmJsdXJTYW1wbGVzOwoJCQkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLmRlZmluZXMuVlNNX1NBTVBMRVMgPSBzaGFkb3cuYmx1clNhbXBsZXM7CgoJCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQlzaGFkb3dNYXRlcmlhbEhvcml6b250YWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCBzaGFkb3cubWFwUGFzcyA9PT0gbnVsbCApIHsKCgkJCQlzaGFkb3cubWFwUGFzcyA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggX3NoYWRvd01hcFNpemUueCwgX3NoYWRvd01hcFNpemUueSApOwoKCQkJfQoKCQkJLy8gdmVydGljYWwgcGFzcwoKCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5zaGFkb3dfcGFzcy52YWx1ZSA9IHNoYWRvdy5tYXAudGV4dHVyZTsKCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CgkJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmFkaXVzLnZhbHVlID0gc2hhZG93LnJhZGl1czsKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwUGFzcyApOwoJCQlyZW5kZXJlci5jbGVhcigpOwoJCQlyZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsVmVydGljYWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgoJCQkvLyBob3Jpem9udGFsIHBhc3MKCgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5zaGFkb3dfcGFzcy52YWx1ZSA9IHNoYWRvdy5tYXBQYXNzLnRleHR1cmU7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yYWRpdXMudmFsdWUgPSBzaGFkb3cucmFkaXVzOwoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXAgKTsKCQkJcmVuZGVyZXIuY2xlYXIoKTsKCQkJcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgbGlnaHQsIHR5cGUgKSB7CgoJCQlsZXQgcmVzdWx0ID0gbnVsbDsKCgkJCWNvbnN0IGN1c3RvbU1hdGVyaWFsID0gKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgKSA/IG9iamVjdC5jdXN0b21EaXN0YW5jZU1hdGVyaWFsIDogb2JqZWN0LmN1c3RvbURlcHRoTWF0ZXJpYWw7CgoJCQlpZiAoIGN1c3RvbU1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmVzdWx0ID0gY3VzdG9tTWF0ZXJpYWw7CgoJCQl9IGVsc2UgewoKCQkJCXJlc3VsdCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBfZGlzdGFuY2VNYXRlcmlhbCA6IF9kZXB0aE1hdGVyaWFsOwoKCQkJCWlmICggKCByZW5kZXJlci5sb2NhbENsaXBwaW5nRW5hYmxlZCAmJiBtYXRlcmlhbC5jbGlwU2hhZG93cyA9PT0gdHJ1ZSAmJiBBcnJheS5pc0FycmF5KCBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcyApICYmIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzLmxlbmd0aCAhPT0gMCApIHx8CgkJCQkJKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgJiYgbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGUgIT09IDAgKSB8fAoJCQkJCSggbWF0ZXJpYWwuYWxwaGFNYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHx8CgkJCQkJKCBtYXRlcmlhbC5tYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHx8CgkJCQkJKCBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSApIHsKCgkJCQkJLy8gaW4gdGhpcyBjYXNlIHdlIG5lZWQgYSB1bmlxdWUgbWF0ZXJpYWwgaW5zdGFuY2UgcmVmbGVjdGluZyB0aGUKCQkJCQkvLyBhcHByb3ByaWF0ZSBzdGF0ZQoKCQkJCQljb25zdCBrZXlBID0gcmVzdWx0LnV1aWQsIGtleUIgPSBtYXRlcmlhbC51dWlkOwoKCQkJCQlsZXQgbWF0ZXJpYWxzRm9yVmFyaWFudCA9IF9tYXRlcmlhbENhY2hlWyBrZXlBIF07CgoJCQkJCWlmICggbWF0ZXJpYWxzRm9yVmFyaWFudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudCA9IHt9OwoJCQkJCQlfbWF0ZXJpYWxDYWNoZVsga2V5QSBdID0gbWF0ZXJpYWxzRm9yVmFyaWFudDsKCgkJCQkJfQoKCQkJCQlsZXQgY2FjaGVkTWF0ZXJpYWwgPSBtYXRlcmlhbHNGb3JWYXJpYW50WyBrZXlCIF07CgoJCQkJCWlmICggY2FjaGVkTWF0ZXJpYWwgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNhY2hlZE1hdGVyaWFsID0gcmVzdWx0LmNsb25lKCk7CgkJCQkJCW1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXSA9IGNhY2hlZE1hdGVyaWFsOwoJCQkJCQltYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uTWF0ZXJpYWxEaXNwb3NlICk7CgoJCQkJCX0KCgkJCQkJcmVzdWx0ID0gY2FjaGVkTWF0ZXJpYWw7CgoJCQkJfQoKCQkJfQoKCQkJcmVzdWx0LnZpc2libGUgPSBtYXRlcmlhbC52aXNpYmxlOwoJCQlyZXN1bHQud2lyZWZyYW1lID0gbWF0ZXJpYWwud2lyZWZyYW1lOwoKCQkJaWYgKCB0eXBlID09PSBWU01TaGFkb3dNYXAgKSB7CgoJCQkJcmVzdWx0LnNpZGUgPSAoIG1hdGVyaWFsLnNoYWRvd1NpZGUgIT09IG51bGwgKSA/IG1hdGVyaWFsLnNoYWRvd1NpZGUgOiBtYXRlcmlhbC5zaWRlOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXN1bHQuc2lkZSA9ICggbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCApID8gbWF0ZXJpYWwuc2hhZG93U2lkZSA6IHNoYWRvd1NpZGVbIG1hdGVyaWFsLnNpZGUgXTsKCgkJCX0KCgkJCXJlc3VsdC5hbHBoYU1hcCA9IG1hdGVyaWFsLmFscGhhTWFwOwoJCQlyZXN1bHQuYWxwaGFUZXN0ID0gKCBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSA/IDAuNSA6IG1hdGVyaWFsLmFscGhhVGVzdDsgLy8gYXBwcm94aW1hdGUgYWxwaGFUb0NvdmVyYWdlIGJ5IHVzaW5nIGEgZml4ZWQgYWxwaGFUZXN0IHZhbHVlCgkJCXJlc3VsdC5tYXAgPSBtYXRlcmlhbC5tYXA7CgoJCQlyZXN1bHQuY2xpcFNoYWRvd3MgPSBtYXRlcmlhbC5jbGlwU2hhZG93czsKCQkJcmVzdWx0LmNsaXBwaW5nUGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXM7CgkJCXJlc3VsdC5jbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbjsKCgkJCXJlc3VsdC5kaXNwbGFjZW1lbnRNYXAgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CgkJCXJlc3VsdC5kaXNwbGFjZW1lbnRTY2FsZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQlyZXN1bHQuZGlzcGxhY2VtZW50QmlhcyA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCQlyZXN1bHQud2lyZWZyYW1lTGluZXdpZHRoID0gbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoOwoJCQlyZXN1bHQubGluZXdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKCQkJaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgJiYgcmVzdWx0LmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgPT09IHRydWUgKSB7CgoJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHJlc3VsdCApOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0ID0gbGlnaHQ7CgoJCQl9CgoJCQlyZXR1cm4gcmVzdWx0OwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKSB7CgoJCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJCWNvbnN0IHZpc2libGUgPSBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKTsKCgkJCWlmICggdmlzaWJsZSAmJiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSApIHsKCgkJCQlpZiAoICggb2JqZWN0LmNhc3RTaGFkb3cgfHwgKCBvYmplY3QucmVjZWl2ZVNoYWRvdyAmJiB0eXBlID09PSBWU01TaGFkb3dNYXAgKSApICYmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSApICkgewoKCQkJCQlvYmplY3QubW9kZWxWaWV3TWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIHNoYWRvd0NhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKCQkJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IGdyb3Vwcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCgkJCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgayBdOwoJCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQkJaWYgKCBncm91cE1hdGVyaWFsICYmIGdyb3VwTWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQkJY29uc3QgZGVwdGhNYXRlcmlhbCA9IGdldERlcHRoTWF0ZXJpYWwoIG9iamVjdCwgZ3JvdXBNYXRlcmlhbCwgbGlnaHQsIHR5cGUgKTsKCgkJCQkJCQkJb2JqZWN0Lm9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICk7CgoJCQkJCQkJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJCQkJCQlvYmplY3Qub25BZnRlclNoYWRvdyggcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCWNvbnN0IGRlcHRoTWF0ZXJpYWwgPSBnZXREZXB0aE1hdGVyaWFsKCBvYmplY3QsIG1hdGVyaWFsLCBsaWdodCwgdHlwZSApOwoKCQkJCQkJb2JqZWN0Lm9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIG51bGwgKTsKCgkJCQkJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBudWxsICk7CgoJCQkJCQlvYmplY3Qub25BZnRlclNoYWRvdyggcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBudWxsICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJcmVuZGVyT2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBvbk1hdGVyaWFsRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCBtYXRlcmlhbCA9IGV2ZW50LnRhcmdldDsKCgkJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCS8vIG1ha2Ugc3VyZSB0byByZW1vdmUgdGhlIHVuaXF1ZSBkaXN0YW5jZS9kZXB0aCBtYXRlcmlhbHMgdXNlZCBmb3Igc2hhZG93IG1hcCByZW5kZXJpbmcKCgkJCWZvciAoIGNvbnN0IGlkIGluIF9tYXRlcmlhbENhY2hlICkgewoKCQkJCWNvbnN0IGNhY2hlID0gX21hdGVyaWFsQ2FjaGVbIGlkIF07CgoJCQkJY29uc3QgdXVpZCA9IGV2ZW50LnRhcmdldC51dWlkOwoKCQkJCWlmICggdXVpZCBpbiBjYWNoZSApIHsKCgkJCQkJY29uc3Qgc2hhZG93TWF0ZXJpYWwgPSBjYWNoZVsgdXVpZCBdOwoJCQkJCXNoYWRvd01hdGVyaWFsLmRpc3Bvc2UoKTsKCQkJCQlkZWxldGUgY2FjaGVbIHV1aWQgXTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJY29uc3QgcmV2ZXJzZWRGdW5jcyA9IHsKCQlbIE5ldmVyRGVwdGggXTogQWx3YXlzRGVwdGgsCgkJWyBMZXNzRGVwdGggXTogR3JlYXRlckRlcHRoLAoJCVsgRXF1YWxEZXB0aCBdOiBOb3RFcXVhbERlcHRoLAoJCVsgTGVzc0VxdWFsRGVwdGggXTogR3JlYXRlckVxdWFsRGVwdGgsCgoJCVsgQWx3YXlzRGVwdGggXTogTmV2ZXJEZXB0aCwKCQlbIEdyZWF0ZXJEZXB0aCBdOiBMZXNzRGVwdGgsCgkJWyBOb3RFcXVhbERlcHRoIF06IEVxdWFsRGVwdGgsCgkJWyBHcmVhdGVyRXF1YWxEZXB0aCBdOiBMZXNzRXF1YWxEZXB0aCwKCX07CgoJZnVuY3Rpb24gV2ViR0xTdGF0ZSggZ2wsIGV4dGVuc2lvbnMgKSB7CgoJCWZ1bmN0aW9uIENvbG9yQnVmZmVyKCkgewoKCQkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKCQkJY29uc3QgY29sb3IgPSBuZXcgVmVjdG9yNCgpOwoJCQlsZXQgY3VycmVudENvbG9yTWFzayA9IG51bGw7CgkJCWNvbnN0IGN1cnJlbnRDb2xvckNsZWFyID0gbmV3IFZlY3RvcjQoIDAsIDAsIDAsIDAgKTsKCgkJCXJldHVybiB7CgoJCQkJc2V0TWFzazogZnVuY3Rpb24gKCBjb2xvck1hc2sgKSB7CgoJCQkJCWlmICggY3VycmVudENvbG9yTWFzayAhPT0gY29sb3JNYXNrICYmICEgbG9ja2VkICkgewoKCQkJCQkJZ2wuY29sb3JNYXNrKCBjb2xvck1hc2ssIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2sgKTsKCQkJCQkJY3VycmVudENvbG9yTWFzayA9IGNvbG9yTWFzazsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCByLCBnLCBiLCBhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKSB7CgoJCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgewoKCQkJCQkJciAqPSBhOyBnICo9IGE7IGIgKj0gYTsKCgkJCQkJfQoKCQkJCQljb2xvci5zZXQoIHIsIGcsIGIsIGEgKTsKCgkJCQkJaWYgKCBjdXJyZW50Q29sb3JDbGVhci5lcXVhbHMoIGNvbG9yICkgPT09IGZhbHNlICkgewoKCQkJCQkJZ2wuY2xlYXJDb2xvciggciwgZywgYiwgYSApOwoJCQkJCQljdXJyZW50Q29sb3JDbGVhci5jb3B5KCBjb2xvciApOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKCQkJCQlsb2NrZWQgPSBmYWxzZTsKCgkJCQkJY3VycmVudENvbG9yTWFzayA9IG51bGw7CgkJCQkJY3VycmVudENvbG9yQ2xlYXIuc2V0KCAtMSwgMCwgMCwgMCApOyAvLyBzZXQgdG8gaW52YWxpZCBzdGF0ZQoKCQkJCX0KCgkJCX07CgoJCX0KCgkJZnVuY3Rpb24gRGVwdGhCdWZmZXIoKSB7CgoJCQlsZXQgbG9ja2VkID0gZmFsc2U7CgoJCQlsZXQgY3VycmVudFJldmVyc2VkID0gZmFsc2U7CgkJCWxldCBjdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKCQkJbGV0IGN1cnJlbnREZXB0aEZ1bmMgPSBudWxsOwoJCQlsZXQgY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwoKCQkJcmV0dXJuIHsKCgkJCQlzZXRSZXZlcnNlZDogZnVuY3Rpb24gKCByZXZlcnNlZCApIHsKCgkJCQkJaWYgKCBjdXJyZW50UmV2ZXJzZWQgIT09IHJldmVyc2VkICkgewoKCQkJCQkJY29uc3QgZXh0ID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfY2xpcF9jb250cm9sJyApOwoKCQkJCQkJaWYgKCByZXZlcnNlZCApIHsKCgkJCQkJCQlleHQuY2xpcENvbnRyb2xFWFQoIGV4dC5MT1dFUl9MRUZUX0VYVCwgZXh0LlpFUk9fVE9fT05FX0VYVCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlleHQuY2xpcENvbnRyb2xFWFQoIGV4dC5MT1dFUl9MRUZUX0VYVCwgZXh0Lk5FR0FUSVZFX09ORV9UT19PTkVfRVhUICk7CgoJCQkJCQl9CgoJCQkJCQljdXJyZW50UmV2ZXJzZWQgPSByZXZlcnNlZDsKCgkJCQkJCWNvbnN0IG9sZERlcHRoID0gY3VycmVudERlcHRoQ2xlYXI7CgkJCQkJCWN1cnJlbnREZXB0aENsZWFyID0gbnVsbDsKCQkJCQkJdGhpcy5zZXRDbGVhciggb2xkRGVwdGggKTsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJZ2V0UmV2ZXJzZWQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJcmV0dXJuIGN1cnJlbnRSZXZlcnNlZDsKCgkJCQl9LAoKCQkJCXNldFRlc3Q6IGZ1bmN0aW9uICggZGVwdGhUZXN0ICkgewoKCQkJCQlpZiAoIGRlcHRoVGVzdCApIHsKCgkJCQkJCWVuYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIGRlcHRoTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhNYXNrICE9PSBkZXB0aE1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCQlnbC5kZXB0aE1hc2soIGRlcHRoTWFzayApOwoJCQkJCQljdXJyZW50RGVwdGhNYXNrID0gZGVwdGhNYXNrOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIGRlcHRoRnVuYyApIHsKCgkJCQkJaWYgKCBjdXJyZW50UmV2ZXJzZWQgKSBkZXB0aEZ1bmMgPSByZXZlcnNlZEZ1bmNzWyBkZXB0aEZ1bmMgXTsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhGdW5jICE9PSBkZXB0aEZ1bmMgKSB7CgoJCQkJCQlzd2l0Y2ggKCBkZXB0aEZ1bmMgKSB7CgoJCQkJCQkJY2FzZSBOZXZlckRlcHRoOgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLk5FVkVSICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBBbHdheXNEZXB0aDoKCgkJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5BTFdBWVMgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIExlc3NEZXB0aDoKCgkJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVNTICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBMZXNzRXF1YWxEZXB0aDoKCgkJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVFVQUwgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEVxdWFsRGVwdGg6CgoJCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuRVFVQUwgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEdyZWF0ZXJFcXVhbERlcHRoOgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdFUVVBTCApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgR3JlYXRlckRlcHRoOgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdSRUFURVIgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIE5vdEVxdWFsRGVwdGg6CgoJCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTk9URVFVQUwgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQlkZWZhdWx0OgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFUVVBTCApOwoKCQkJCQkJfQoKCQkJCQkJY3VycmVudERlcHRoRnVuYyA9IGRlcHRoRnVuYzsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBkZXB0aCApIHsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhDbGVhciAhPT0gZGVwdGggKSB7CgoJCQkJCQlpZiAoIGN1cnJlbnRSZXZlcnNlZCApIHsKCgkJCQkJCQlkZXB0aCA9IDEgLSBkZXB0aDsKCgkJCQkJCX0KCgkJCQkJCWdsLmNsZWFyRGVwdGgoIGRlcHRoICk7CgkJCQkJCWN1cnJlbnREZXB0aENsZWFyID0gZGVwdGg7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCQljdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKCQkJCQljdXJyZW50RGVwdGhGdW5jID0gbnVsbDsKCQkJCQljdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CgkJCQkJY3VycmVudFJldmVyc2VkID0gZmFsc2U7CgoJCQkJfQoKCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiBTdGVuY2lsQnVmZmVyKCkgewoKCQkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKCQkJbGV0IGN1cnJlbnRTdGVuY2lsTWFzayA9IG51bGw7CgkJCWxldCBjdXJyZW50U3RlbmNpbEZ1bmMgPSBudWxsOwoJCQlsZXQgY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwoJCQlsZXQgY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IG51bGw7CgkJCWxldCBjdXJyZW50U3RlbmNpbEZhaWwgPSBudWxsOwoJCQlsZXQgY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CgkJCWxldCBjdXJyZW50U3RlbmNpbFpQYXNzID0gbnVsbDsKCQkJbGV0IGN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBudWxsOwoKCQkJcmV0dXJuIHsKCgkJCQlzZXRUZXN0OiBmdW5jdGlvbiAoIHN0ZW5jaWxUZXN0ICkgewoKCQkJCQlpZiAoICEgbG9ja2VkICkgewoKCQkJCQkJaWYgKCBzdGVuY2lsVGVzdCApIHsKCgkJCQkJCQllbmFibGUoIGdsLlNURU5DSUxfVEVTVCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlkaXNhYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TWFzazogZnVuY3Rpb24gKCBzdGVuY2lsTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50U3RlbmNpbE1hc2sgIT09IHN0ZW5jaWxNYXNrICYmICEgbG9ja2VkICkgewoKCQkJCQkJZ2wuc3RlbmNpbE1hc2soIHN0ZW5jaWxNYXNrICk7CgkJCQkJCWN1cnJlbnRTdGVuY2lsTWFzayA9IHN0ZW5jaWxNYXNrOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIHN0ZW5jaWxGdW5jLCBzdGVuY2lsUmVmLCBzdGVuY2lsTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZ1bmMgIT09IHN0ZW5jaWxGdW5jIHx8CgkJCQkJICAgICBjdXJyZW50U3RlbmNpbFJlZiAhPT0gc3RlbmNpbFJlZiB8fAoJCQkJCSAgICAgY3VycmVudFN0ZW5jaWxGdW5jTWFzayAhPT0gc3RlbmNpbE1hc2sgKSB7CgoJCQkJCQlnbC5zdGVuY2lsRnVuYyggc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrICk7CgoJCQkJCQljdXJyZW50U3RlbmNpbEZ1bmMgPSBzdGVuY2lsRnVuYzsKCQkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBzdGVuY2lsUmVmOwoJCQkJCQljdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gc3RlbmNpbE1hc2s7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXNldE9wOiBmdW5jdGlvbiAoIHN0ZW5jaWxGYWlsLCBzdGVuY2lsWkZhaWwsIHN0ZW5jaWxaUGFzcyApIHsKCgkJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZhaWwgIT09IHN0ZW5jaWxGYWlsIHx8CgkJCQkJICAgICBjdXJyZW50U3RlbmNpbFpGYWlsICE9PSBzdGVuY2lsWkZhaWwgfHwKCQkJCQkgICAgIGN1cnJlbnRTdGVuY2lsWlBhc3MgIT09IHN0ZW5jaWxaUGFzcyApIHsKCgkJCQkJCWdsLnN0ZW5jaWxPcCggc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzICk7CgoJCQkJCQljdXJyZW50U3RlbmNpbEZhaWwgPSBzdGVuY2lsRmFpbDsKCQkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IHN0ZW5jaWxaRmFpbDsKCQkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IHN0ZW5jaWxaUGFzczsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBzdGVuY2lsICkgewoKCQkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsQ2xlYXIgIT09IHN0ZW5jaWwgKSB7CgoJCQkJCQlnbC5jbGVhclN0ZW5jaWwoIHN0ZW5jaWwgKTsKCQkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IHN0ZW5jaWw7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCQljdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CgoJCQkJfQoKCQkJfTsKCgkJfQoKCQkvLwoKCQljb25zdCBjb2xvckJ1ZmZlciA9IG5ldyBDb2xvckJ1ZmZlcigpOwoJCWNvbnN0IGRlcHRoQnVmZmVyID0gbmV3IERlcHRoQnVmZmVyKCk7CgkJY29uc3Qgc3RlbmNpbEJ1ZmZlciA9IG5ldyBTdGVuY2lsQnVmZmVyKCk7CgoJCWNvbnN0IHVib0JpbmRpbmdzID0gbmV3IFdlYWtNYXAoKTsKCQljb25zdCB1Ym9Qcm9ncmFtTWFwID0gbmV3IFdlYWtNYXAoKTsKCgkJbGV0IGVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKCgkJbGV0IGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVycyA9IHt9OwoJCWxldCBjdXJyZW50RHJhd2J1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwoJCWxldCBkZWZhdWx0RHJhd2J1ZmZlcnMgPSBbXTsKCgkJbGV0IGN1cnJlbnRQcm9ncmFtID0gbnVsbDsKCgkJbGV0IGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCQlsZXQgY3VycmVudEJsZW5kaW5nID0gbnVsbDsKCQlsZXQgY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmRTcmMgPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmREc3QgPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKCQlsZXQgY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmREc3RBbHBoYSA9IG51bGw7CgkJbGV0IGN1cnJlbnRCbGVuZENvbG9yID0gbmV3IENvbG9yKCAwLCAwLCAwICk7CgkJbGV0IGN1cnJlbnRCbGVuZEFscGhhID0gMDsKCQlsZXQgY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gZmFsc2U7CgoJCWxldCBjdXJyZW50RmxpcFNpZGVkID0gbnVsbDsKCQlsZXQgY3VycmVudEN1bGxGYWNlID0gbnVsbDsKCgkJbGV0IGN1cnJlbnRMaW5lV2lkdGggPSBudWxsOwoKCQlsZXQgY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBudWxsOwoJCWxldCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gbnVsbDsKCgkJY29uc3QgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9DT01CSU5FRF9URVhUVVJFX0lNQUdFX1VOSVRTICk7CgoJCWxldCBsaW5lV2lkdGhBdmFpbGFibGUgPSBmYWxzZTsKCQlsZXQgdmVyc2lvbiA9IDA7CgkJY29uc3QgZ2xWZXJzaW9uID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5WRVJTSU9OICk7CgoJCWlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdXZWJHTCcgKSAhPT0gLTEgKSB7CgoJCQl2ZXJzaW9uID0gcGFyc2VGbG9hdCggL15XZWJHTCAoXGQpLy5leGVjKCBnbFZlcnNpb24gKVsgMSBdICk7CgkJCWxpbmVXaWR0aEF2YWlsYWJsZSA9ICggdmVyc2lvbiA+PSAxLjAgKTsKCgkJfSBlbHNlIGlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdPcGVuR0wgRVMnICkgIT09IC0xICkgewoKCQkJdmVyc2lvbiA9IHBhcnNlRmxvYXQoIC9eT3BlbkdMIEVTIChcZCkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKCQkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDIuMCApOwoKCQl9CgoJCWxldCBjdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJCWxldCBjdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCQljb25zdCBzY2lzc29yUGFyYW0gPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLlNDSVNTT1JfQk9YICk7CgkJY29uc3Qgdmlld3BvcnRQYXJhbSA9IGdsLmdldFBhcmFtZXRlciggZ2wuVklFV1BPUlQgKTsKCgkJY29uc3QgY3VycmVudFNjaXNzb3IgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggc2Npc3NvclBhcmFtICk7CgkJY29uc3QgY3VycmVudFZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKS5mcm9tQXJyYXkoIHZpZXdwb3J0UGFyYW0gKTsKCgkJZnVuY3Rpb24gY3JlYXRlVGV4dHVyZSggdHlwZSwgdGFyZ2V0LCBjb3VudCwgZGltZW5zaW9ucyApIHsKCgkJCWNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSggNCApOyAvLyA0IGlzIHJlcXVpcmVkIHRvIG1hdGNoIGRlZmF1bHQgdW5wYWNrIGFsaWdubWVudCBvZiA0LgoJCQljb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJZ2wuYmluZFRleHR1cmUoIHR5cGUsIHRleHR1cmUgKTsKCQkJZ2wudGV4UGFyYW1ldGVyaSggdHlwZSwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUICk7CgkJCWdsLnRleFBhcmFtZXRlcmkoIHR5cGUsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVCApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgoJCQkJaWYgKCB0eXBlID09PSBnbC5URVhUVVJFXzNEIHx8IHR5cGUgPT09IGdsLlRFWFRVUkVfMkRfQVJSQVkgKSB7CgoJCQkJCWdsLnRleEltYWdlM0QoIHRhcmdldCwgMCwgZ2wuUkdCQSwgMSwgMSwgZGltZW5zaW9ucywgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgZGF0YSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWdsLnRleEltYWdlMkQoIHRhcmdldCArIGksIDAsIGdsLlJHQkEsIDEsIDEsIDAsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIGRhdGEgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGV4dHVyZTsKCgkJfQoKCQljb25zdCBlbXB0eVRleHR1cmVzID0ge307CgkJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV8yRCBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV8yRCwgMSApOwoJCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfQ1VCRV9NQVAgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCwgNiApOwoJCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfMkRfQVJSQVkgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfMkRfQVJSQVksIGdsLlRFWFRVUkVfMkRfQVJSQVksIDEsIDEgKTsKCQllbXB0eVRleHR1cmVzWyBnbC5URVhUVVJFXzNEIF0gPSBjcmVhdGVUZXh0dXJlKCBnbC5URVhUVVJFXzNELCBnbC5URVhUVVJFXzNELCAxLCAxICk7CgoJCS8vIGluaXQKCgkJY29sb3JCdWZmZXIuc2V0Q2xlYXIoIDAsIDAsIDAsIDEgKTsKCQlkZXB0aEJ1ZmZlci5zZXRDbGVhciggMSApOwoJCXN0ZW5jaWxCdWZmZXIuc2V0Q2xlYXIoIDAgKTsKCgkJZW5hYmxlKCBnbC5ERVBUSF9URVNUICk7CgkJZGVwdGhCdWZmZXIuc2V0RnVuYyggTGVzc0VxdWFsRGVwdGggKTsKCgkJc2V0RmxpcFNpZGVkKCBmYWxzZSApOwoJCXNldEN1bGxGYWNlKCBDdWxsRmFjZUJhY2sgKTsKCQllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQlzZXRCbGVuZGluZyggTm9CbGVuZGluZyApOwoKCQkvLwoKCQlmdW5jdGlvbiBlbmFibGUoIGlkICkgewoKCQkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSB0cnVlICkgewoKCQkJCWdsLmVuYWJsZSggaWQgKTsKCQkJCWVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gPSB0cnVlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGRpc2FibGUoIGlkICkgewoKCQkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSBmYWxzZSApIHsKCgkJCQlnbC5kaXNhYmxlKCBpZCApOwoJCQkJZW5hYmxlZENhcGFiaWxpdGllc1sgaWQgXSA9IGZhbHNlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGJpbmRGcmFtZWJ1ZmZlciggdGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCgkJCWlmICggY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSAhPT0gZnJhbWVidWZmZXIgKSB7CgoJCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCB0YXJnZXQsIGZyYW1lYnVmZmVyICk7CgoJCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSA9IGZyYW1lYnVmZmVyOwoKCQkJCS8vIGdsLkRSQVdfRlJBTUVCVUZGRVIgaXMgZXF1aXZhbGVudCB0byBnbC5GUkFNRUJVRkZFUgoKCQkJCWlmICggdGFyZ2V0ID09PSBnbC5EUkFXX0ZSQU1FQlVGRkVSICkgewoKCQkJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIGdsLkZSQU1FQlVGRkVSIF0gPSBmcmFtZWJ1ZmZlcjsKCgkJCQl9CgoJCQkJaWYgKCB0YXJnZXQgPT09IGdsLkZSQU1FQlVGRkVSICkgewoKCQkJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIGdsLkRSQVdfRlJBTUVCVUZGRVIgXSA9IGZyYW1lYnVmZmVyOwoKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQlmdW5jdGlvbiBkcmF3QnVmZmVycyggcmVuZGVyVGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCgkJCWxldCBkcmF3QnVmZmVycyA9IGRlZmF1bHREcmF3YnVmZmVyczsKCgkJCWxldCBuZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJCQkJZHJhd0J1ZmZlcnMgPSBjdXJyZW50RHJhd2J1ZmZlcnMuZ2V0KCBmcmFtZWJ1ZmZlciApOwoKCQkJCWlmICggZHJhd0J1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJZHJhd0J1ZmZlcnMgPSBbXTsKCQkJCQljdXJyZW50RHJhd2J1ZmZlcnMuc2V0KCBmcmFtZWJ1ZmZlciwgZHJhd0J1ZmZlcnMgKTsKCgkJCQl9CgoJCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgoJCQkJaWYgKCBkcmF3QnVmZmVycy5sZW5ndGggIT09IHRleHR1cmVzLmxlbmd0aCB8fCBkcmF3QnVmZmVyc1sgMCBdICE9PSBnbC5DT0xPUl9BVFRBQ0hNRU5UMCApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJZHJhd0J1ZmZlcnNbIGkgXSA9IGdsLkNPTE9SX0FUVEFDSE1FTlQwICsgaTsKCgkJCQkJfQoKCQkJCQlkcmF3QnVmZmVycy5sZW5ndGggPSB0ZXh0dXJlcy5sZW5ndGg7CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggZHJhd0J1ZmZlcnNbIDAgXSAhPT0gZ2wuQkFDSyApIHsKCgkJCQkJZHJhd0J1ZmZlcnNbIDAgXSA9IGdsLkJBQ0s7CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIG5lZWRzVXBkYXRlICkgewoKCQkJCWdsLmRyYXdCdWZmZXJzKCBkcmF3QnVmZmVycyApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVzZVByb2dyYW0oIHByb2dyYW0gKSB7CgoJCQlpZiAoIGN1cnJlbnRQcm9ncmFtICE9PSBwcm9ncmFtICkgewoKCQkJCWdsLnVzZVByb2dyYW0oIHByb2dyYW0gKTsKCgkJCQljdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CgoJCQkJcmV0dXJuIHRydWU7CgoJCQl9CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJY29uc3QgZXF1YXRpb25Ub0dMID0gewoJCQlbIEFkZEVxdWF0aW9uIF06IGdsLkZVTkNfQURELAoJCQlbIFN1YnRyYWN0RXF1YXRpb24gXTogZ2wuRlVOQ19TVUJUUkFDVCwKCQkJWyBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiBdOiBnbC5GVU5DX1JFVkVSU0VfU1VCVFJBQ1QKCQl9OwoKCQllcXVhdGlvblRvR0xbIE1pbkVxdWF0aW9uIF0gPSBnbC5NSU47CgkJZXF1YXRpb25Ub0dMWyBNYXhFcXVhdGlvbiBdID0gZ2wuTUFYOwoKCQljb25zdCBmYWN0b3JUb0dMID0gewoJCQlbIFplcm9GYWN0b3IgXTogZ2wuWkVSTywKCQkJWyBPbmVGYWN0b3IgXTogZ2wuT05FLAoJCQlbIFNyY0NvbG9yRmFjdG9yIF06IGdsLlNSQ19DT0xPUiwKCQkJWyBTcmNBbHBoYUZhY3RvciBdOiBnbC5TUkNfQUxQSEEsCgkJCVsgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciBdOiBnbC5TUkNfQUxQSEFfU0FUVVJBVEUsCgkJCVsgRHN0Q29sb3JGYWN0b3IgXTogZ2wuRFNUX0NPTE9SLAoJCQlbIERzdEFscGhhRmFjdG9yIF06IGdsLkRTVF9BTFBIQSwKCQkJWyBPbmVNaW51c1NyY0NvbG9yRmFjdG9yIF06IGdsLk9ORV9NSU5VU19TUkNfQ09MT1IsCgkJCVsgT25lTWludXNTcmNBbHBoYUZhY3RvciBdOiBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLAoJCQlbIE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0RTVF9DT0xPUiwKCQkJWyBPbmVNaW51c0RzdEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19EU1RfQUxQSEEsCgkJCVsgQ29uc3RhbnRDb2xvckZhY3RvciBdOiBnbC5DT05TVEFOVF9DT0xPUiwKCQkJWyBPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0NPTlNUQU5UX0NPTE9SLAoJCQlbIENvbnN0YW50QWxwaGFGYWN0b3IgXTogZ2wuQ09OU1RBTlRfQUxQSEEsCgkJCVsgT25lTWludXNDb25zdGFudEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19DT05TVEFOVF9BTFBIQQoJCX07CgoJCWZ1bmN0aW9uIHNldEJsZW5kaW5nKCBibGVuZGluZywgYmxlbmRFcXVhdGlvbiwgYmxlbmRTcmMsIGJsZW5kRHN0LCBibGVuZEVxdWF0aW9uQWxwaGEsIGJsZW5kU3JjQWxwaGEsIGJsZW5kRHN0QWxwaGEsIGJsZW5kQ29sb3IsIGJsZW5kQWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJCWlmICggYmxlbmRpbmcgPT09IE5vQmxlbmRpbmcgKSB7CgoJCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSB0cnVlICkgewoKCQkJCQlkaXNhYmxlKCBnbC5CTEVORCApOwoJCQkJCWN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCgkJCQl9CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSBmYWxzZSApIHsKCgkJCQllbmFibGUoIGdsLkJMRU5EICk7CgkJCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICggYmxlbmRpbmcgIT09IEN1c3RvbUJsZW5kaW5nICkgewoKCQkJCWlmICggYmxlbmRpbmcgIT09IGN1cnJlbnRCbGVuZGluZyB8fCBwcmVtdWx0aXBsaWVkQWxwaGEgIT09IGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSApIHsKCgkJCQkJaWYgKCBjdXJyZW50QmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gfHwgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSAhPT0gQWRkRXF1YXRpb24gKSB7CgoJCQkJCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwoKCQkJCQkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBBZGRFcXVhdGlvbjsKCQkJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IEFkZEVxdWF0aW9uOwoKCQkJCQl9CgoJCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgoJCQkJCQkJY2FzZSBOb3JtYWxCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEFkZGl0aXZlQmxlbmRpbmc6CgkJCQkJCQkJZ2wuYmxlbmRGdW5jKCBnbC5PTkUsIGdsLk9ORSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgU3VidHJhY3RpdmVCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwgZ2wuWkVSTywgZ2wuT05FICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBNdWx0aXBseUJsZW5kaW5nOgoJCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5EU1RfQ09MT1IsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLlpFUk8sIGdsLk9ORSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWRlZmF1bHQ6CgkJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6IEludmFsaWQgYmxlbmRpbmc6ICcsIGJsZW5kaW5nICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzd2l0Y2ggKCBibGVuZGluZyApIHsKCgkJCQkJCQljYXNlIE5vcm1hbEJsZW5kaW5nOgoJCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5TUkNfQUxQSEEsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORSwgZ2wuT05FICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgoJCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBTdWJ0cmFjdGl2ZUJsZW5kaW5nIHJlcXVpcmVzIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUnICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBNdWx0aXBseUJsZW5kaW5nOgoJCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBNdWx0aXBseUJsZW5kaW5nIHJlcXVpcmVzIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUnICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJZGVmYXVsdDoKCQkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTogSW52YWxpZCBibGVuZGluZzogJywgYmxlbmRpbmcgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQljdXJyZW50QmxlbmRTcmMgPSBudWxsOwoJCQkJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CgkJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCQkJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKCQkJCQljdXJyZW50QmxlbmRDb2xvci5zZXQoIDAsIDAsIDAgKTsKCQkJCQljdXJyZW50QmxlbmRBbHBoYSA9IDA7CgoJCQkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCQkJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IHByZW11bHRpcGxpZWRBbHBoYTsKCgkJCQl9CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJLy8gY3VzdG9tIGJsZW5kaW5nCgoJCQlibGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGEgfHwgYmxlbmRFcXVhdGlvbjsKCQkJYmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGEgfHwgYmxlbmRTcmM7CgkJCWJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhIHx8IGJsZW5kRHN0OwoKCQkJaWYgKCBibGVuZEVxdWF0aW9uICE9PSBjdXJyZW50QmxlbmRFcXVhdGlvbiB8fCBibGVuZEVxdWF0aW9uQWxwaGEgIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgKSB7CgoJCQkJZ2wuYmxlbmRFcXVhdGlvblNlcGFyYXRlKCBlcXVhdGlvblRvR0xbIGJsZW5kRXF1YXRpb24gXSwgZXF1YXRpb25Ub0dMWyBibGVuZEVxdWF0aW9uQWxwaGEgXSApOwoKCQkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gYmxlbmRFcXVhdGlvbjsKCQkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGE7CgoJCQl9CgoJCQlpZiAoIGJsZW5kU3JjICE9PSBjdXJyZW50QmxlbmRTcmMgfHwgYmxlbmREc3QgIT09IGN1cnJlbnRCbGVuZERzdCB8fCBibGVuZFNyY0FscGhhICE9PSBjdXJyZW50QmxlbmRTcmNBbHBoYSB8fCBibGVuZERzdEFscGhhICE9PSBjdXJyZW50QmxlbmREc3RBbHBoYSApIHsKCgkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZmFjdG9yVG9HTFsgYmxlbmRTcmMgXSwgZmFjdG9yVG9HTFsgYmxlbmREc3QgXSwgZmFjdG9yVG9HTFsgYmxlbmRTcmNBbHBoYSBdLCBmYWN0b3JUb0dMWyBibGVuZERzdEFscGhhIF0gKTsKCgkJCQljdXJyZW50QmxlbmRTcmMgPSBibGVuZFNyYzsKCQkJCWN1cnJlbnRCbGVuZERzdCA9IGJsZW5kRHN0OwoJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBibGVuZFNyY0FscGhhOwoJCQkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhOwoKCQkJfQoKCQkJaWYgKCBibGVuZENvbG9yLmVxdWFscyggY3VycmVudEJsZW5kQ29sb3IgKSA9PT0gZmFsc2UgfHwgYmxlbmRBbHBoYSAhPT0gY3VycmVudEJsZW5kQWxwaGEgKSB7CgoJCQkJZ2wuYmxlbmRDb2xvciggYmxlbmRDb2xvci5yLCBibGVuZENvbG9yLmcsIGJsZW5kQ29sb3IuYiwgYmxlbmRBbHBoYSApOwoKCQkJCWN1cnJlbnRCbGVuZENvbG9yLmNvcHkoIGJsZW5kQ29sb3IgKTsKCQkJCWN1cnJlbnRCbGVuZEFscGhhID0gYmxlbmRBbHBoYTsKCgkJCX0KCgkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCgkJfQoKCQlmdW5jdGlvbiBzZXRNYXRlcmlhbCggbWF0ZXJpYWwsIGZyb250RmFjZUNXICkgewoKCQkJbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZQoJCQkJPyBkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKQoJCQkJOiBlbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQkJbGV0IGZsaXBTaWRlZCA9ICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKTsKCQkJaWYgKCBmcm9udEZhY2VDVyApIGZsaXBTaWRlZCA9ICEgZmxpcFNpZGVkOwoKCQkJc2V0RmxpcFNpZGVkKCBmbGlwU2lkZWQgKTsKCgkJCSggbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSBmYWxzZSApCgkJCQk/IHNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICkKCQkJCTogc2V0QmxlbmRpbmcoIG1hdGVyaWFsLmJsZW5kaW5nLCBtYXRlcmlhbC5ibGVuZEVxdWF0aW9uLCBtYXRlcmlhbC5ibGVuZFNyYywgbWF0ZXJpYWwuYmxlbmREc3QsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb25BbHBoYSwgbWF0ZXJpYWwuYmxlbmRTcmNBbHBoYSwgbWF0ZXJpYWwuYmxlbmREc3RBbHBoYSwgbWF0ZXJpYWwuYmxlbmRDb2xvciwgbWF0ZXJpYWwuYmxlbmRBbHBoYSwgbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhICk7CgoJCQlkZXB0aEJ1ZmZlci5zZXRGdW5jKCBtYXRlcmlhbC5kZXB0aEZ1bmMgKTsKCQkJZGVwdGhCdWZmZXIuc2V0VGVzdCggbWF0ZXJpYWwuZGVwdGhUZXN0ICk7CgkJCWRlcHRoQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLmRlcHRoV3JpdGUgKTsKCQkJY29sb3JCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuY29sb3JXcml0ZSApOwoKCQkJY29uc3Qgc3RlbmNpbFdyaXRlID0gbWF0ZXJpYWwuc3RlbmNpbFdyaXRlOwoJCQlzdGVuY2lsQnVmZmVyLnNldFRlc3QoIHN0ZW5jaWxXcml0ZSApOwoJCQlpZiAoIHN0ZW5jaWxXcml0ZSApIHsKCgkJCQlzdGVuY2lsQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLnN0ZW5jaWxXcml0ZU1hc2sgKTsKCQkJCXN0ZW5jaWxCdWZmZXIuc2V0RnVuYyggbWF0ZXJpYWwuc3RlbmNpbEZ1bmMsIG1hdGVyaWFsLnN0ZW5jaWxSZWYsIG1hdGVyaWFsLnN0ZW5jaWxGdW5jTWFzayApOwoJCQkJc3RlbmNpbEJ1ZmZlci5zZXRPcCggbWF0ZXJpYWwuc3RlbmNpbEZhaWwsIG1hdGVyaWFsLnN0ZW5jaWxaRmFpbCwgbWF0ZXJpYWwuc3RlbmNpbFpQYXNzICk7CgoJCQl9CgoJCQlzZXRQb2x5Z29uT2Zmc2V0KCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0LCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0RmFjdG9yLCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0VW5pdHMgKTsKCgkJCW1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gdHJ1ZQoJCQkJPyBlbmFibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApCgkJCQk6IGRpc2FibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIHNldEZsaXBTaWRlZCggZmxpcFNpZGVkICkgewoKCQkJaWYgKCBjdXJyZW50RmxpcFNpZGVkICE9PSBmbGlwU2lkZWQgKSB7CgoJCQkJaWYgKCBmbGlwU2lkZWQgKSB7CgoJCQkJCWdsLmZyb250RmFjZSggZ2wuQ1cgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKCQkJCX0KCgkJCQljdXJyZW50RmxpcFNpZGVkID0gZmxpcFNpZGVkOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHNldEN1bGxGYWNlKCBjdWxsRmFjZSApIHsKCgkJCWlmICggY3VsbEZhY2UgIT09IEN1bGxGYWNlTm9uZSApIHsKCgkJCQllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQkJCWlmICggY3VsbEZhY2UgIT09IGN1cnJlbnRDdWxsRmFjZSApIHsKCgkJCQkJaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VCYWNrICkgewoKCQkJCQkJZ2wuY3VsbEZhY2UoIGdsLkJBQ0sgKTsKCgkJCQkJfSBlbHNlIGlmICggY3VsbEZhY2UgPT09IEN1bGxGYWNlRnJvbnQgKSB7CgoJCQkJCQlnbC5jdWxsRmFjZSggZ2wuRlJPTlQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWdsLmN1bGxGYWNlKCBnbC5GUk9OVF9BTkRfQkFDSyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCgkJCX0KCgkJCWN1cnJlbnRDdWxsRmFjZSA9IGN1bGxGYWNlOwoKCQl9CgoJCWZ1bmN0aW9uIHNldExpbmVXaWR0aCggd2lkdGggKSB7CgoJCQlpZiAoIHdpZHRoICE9PSBjdXJyZW50TGluZVdpZHRoICkgewoKCQkJCWlmICggbGluZVdpZHRoQXZhaWxhYmxlICkgZ2wubGluZVdpZHRoKCB3aWR0aCApOwoKCQkJCWN1cnJlbnRMaW5lV2lkdGggPSB3aWR0aDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXRQb2x5Z29uT2Zmc2V0KCBwb2x5Z29uT2Zmc2V0LCBmYWN0b3IsIHVuaXRzICkgewoKCQkJaWYgKCBwb2x5Z29uT2Zmc2V0ICkgewoKCQkJCWVuYWJsZSggZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCApOwoKCQkJCWlmICggY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgIT09IGZhY3RvciB8fCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzICE9PSB1bml0cyApIHsKCgkJCQkJZ2wucG9seWdvbk9mZnNldCggZmFjdG9yLCB1bml0cyApOwoKCQkJCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IGZhY3RvcjsKCQkJCQljdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gdW5pdHM7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0U2Npc3NvclRlc3QoIHNjaXNzb3JUZXN0ICkgewoKCQkJaWYgKCBzY2lzc29yVGVzdCApIHsKCgkJCQllbmFibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCBnbC5TQ0lTU09SX1RFU1QgKTsKCgkJCX0KCgkJfQoKCQkvLyB0ZXh0dXJlCgoJCWZ1bmN0aW9uIGFjdGl2ZVRleHR1cmUoIHdlYmdsU2xvdCApIHsKCgkJCWlmICggd2ViZ2xTbG90ID09PSB1bmRlZmluZWQgKSB3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCgkJCWlmICggY3VycmVudFRleHR1cmVTbG90ICE9PSB3ZWJnbFNsb3QgKSB7CgoJCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CgkJCQljdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gYmluZFRleHR1cmUoIHdlYmdsVHlwZSwgd2ViZ2xUZXh0dXJlLCB3ZWJnbFNsb3QgKSB7CgoJCQlpZiAoIHdlYmdsU2xvdCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWlmICggY3VycmVudFRleHR1cmVTbG90ID09PSBudWxsICkgewoKCQkJCQl3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCgkJCQl9IGVsc2UgewoKCQkJCQl3ZWJnbFNsb3QgPSBjdXJyZW50VGV4dHVyZVNsb3Q7CgoJCQkJfQoKCQkJfQoKCQkJbGV0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzWyB3ZWJnbFNsb3QgXTsKCgkJCWlmICggYm91bmRUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJYm91bmRUZXh0dXJlID0geyB0eXBlOiB1bmRlZmluZWQsIHRleHR1cmU6IHVuZGVmaW5lZCB9OwoJCQkJY3VycmVudEJvdW5kVGV4dHVyZXNbIHdlYmdsU2xvdCBdID0gYm91bmRUZXh0dXJlOwoKCQkJfQoKCQkJaWYgKCBib3VuZFRleHR1cmUudHlwZSAhPT0gd2ViZ2xUeXBlIHx8IGJvdW5kVGV4dHVyZS50ZXh0dXJlICE9PSB3ZWJnbFRleHR1cmUgKSB7CgoJCQkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCgkJCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CgkJCQkJY3VycmVudFRleHR1cmVTbG90ID0gd2ViZ2xTbG90OwoKCQkJCX0KCgkJCQlnbC5iaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUgfHwgZW1wdHlUZXh0dXJlc1sgd2ViZ2xUeXBlIF0gKTsKCgkJCQlib3VuZFRleHR1cmUudHlwZSA9IHdlYmdsVHlwZTsKCQkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gd2ViZ2xUZXh0dXJlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVuYmluZFRleHR1cmUoKSB7CgoJCQljb25zdCBib3VuZFRleHR1cmUgPSBjdXJyZW50Qm91bmRUZXh0dXJlc1sgY3VycmVudFRleHR1cmVTbG90IF07CgoJCQlpZiAoIGJvdW5kVGV4dHVyZSAhPT0gdW5kZWZpbmVkICYmIGJvdW5kVGV4dHVyZS50eXBlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZ2wuYmluZFRleHR1cmUoIGJvdW5kVGV4dHVyZS50eXBlLCBudWxsICk7CgoJCQkJYm91bmRUZXh0dXJlLnR5cGUgPSB1bmRlZmluZWQ7CgkJCQlib3VuZFRleHR1cmUudGV4dHVyZSA9IHVuZGVmaW5lZDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBjb21wcmVzc2VkVGV4SW1hZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wuY29tcHJlc3NlZFRleEltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29tcHJlc3NlZFRleEltYWdlM0QoKSB7CgoJCQl0cnkgewoKCQkJCWdsLmNvbXByZXNzZWRUZXhJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleFN1YkltYWdlMkQoKSB7CgoJCQl0cnkgewoKCQkJCWdsLnRleFN1YkltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdGV4U3ViSW1hZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4U3ViSW1hZ2UzRCggLi4uYXJndW1lbnRzICk7CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29tcHJlc3NlZFRleFN1YkltYWdlM0QoKSB7CgoJCQl0cnkgewoKCQkJCWdsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleFN0b3JhZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4U3RvcmFnZTJEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleFN0b3JhZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4U3RvcmFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleEltYWdlMkQoKSB7CgoJCQl0cnkgewoKCQkJCWdsLnRleEltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdGV4SW1hZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4SW1hZ2UzRCggLi4uYXJndW1lbnRzICk7CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiBzY2lzc29yKCBzY2lzc29yICkgewoKCQkJaWYgKCBjdXJyZW50U2Npc3Nvci5lcXVhbHMoIHNjaXNzb3IgKSA9PT0gZmFsc2UgKSB7CgoJCQkJZ2wuc2Npc3Nvciggc2Npc3Nvci54LCBzY2lzc29yLnksIHNjaXNzb3Iueiwgc2Npc3Nvci53ICk7CgkJCQljdXJyZW50U2Npc3Nvci5jb3B5KCBzY2lzc29yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdmlld3BvcnQoIHZpZXdwb3J0ICkgewoKCQkJaWYgKCBjdXJyZW50Vmlld3BvcnQuZXF1YWxzKCB2aWV3cG9ydCApID09PSBmYWxzZSApIHsKCgkJCQlnbC52aWV3cG9ydCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQueiwgdmlld3BvcnQudyApOwoJCQkJY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlVUJPTWFwcGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJCWxldCBtYXBwaW5nID0gdWJvUHJvZ3JhbU1hcC5nZXQoIHByb2dyYW0gKTsKCgkJCWlmICggbWFwcGluZyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCW1hcHBpbmcgPSBuZXcgV2Vha01hcCgpOwoKCQkJCXVib1Byb2dyYW1NYXAuc2V0KCBwcm9ncmFtLCBtYXBwaW5nICk7CgoJCQl9CgoJCQlsZXQgYmxvY2tJbmRleCA9IG1hcHBpbmcuZ2V0KCB1bmlmb3Jtc0dyb3VwICk7CgoJCQlpZiAoIGJsb2NrSW5kZXggPT09IHVuZGVmaW5lZCApIHsKCgkJCQlibG9ja0luZGV4ID0gZ2wuZ2V0VW5pZm9ybUJsb2NrSW5kZXgoIHByb2dyYW0sIHVuaWZvcm1zR3JvdXAubmFtZSApOwoKCQkJCW1hcHBpbmcuc2V0KCB1bmlmb3Jtc0dyb3VwLCBibG9ja0luZGV4ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJCWNvbnN0IG1hcHBpbmcgPSB1Ym9Qcm9ncmFtTWFwLmdldCggcHJvZ3JhbSApOwoJCQljb25zdCBibG9ja0luZGV4ID0gbWFwcGluZy5nZXQoIHVuaWZvcm1zR3JvdXAgKTsKCgkJCWlmICggdWJvQmluZGluZ3MuZ2V0KCBwcm9ncmFtICkgIT09IGJsb2NrSW5kZXggKSB7CgoJCQkJLy8gYmluZCBzaGFkZXIgc3BlY2lmaWMgYmxvY2sgaW5kZXggdG8gZ2xvYmFsIGJsb2NrIHBvaW50CgkJCQlnbC51bmlmb3JtQmxvY2tCaW5kaW5nKCBwcm9ncmFtLCBibG9ja0luZGV4LCB1bmlmb3Jtc0dyb3VwLl9fYmluZGluZ1BvaW50SW5kZXggKTsKCgkJCQl1Ym9CaW5kaW5ncy5zZXQoIHByb2dyYW0sIGJsb2NrSW5kZXggKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiByZXNldCgpIHsKCgkJCS8vIHJlc2V0IHN0YXRlCgoJCQlnbC5kaXNhYmxlKCBnbC5CTEVORCApOwoJCQlnbC5kaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCQkJZ2wuZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwoJCQlnbC5kaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgkJCWdsLmRpc2FibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoJCQlnbC5kaXNhYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKCQkJZ2wuZGlzYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICk7CgoJCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwoJCQlnbC5ibGVuZEZ1bmMoIGdsLk9ORSwgZ2wuWkVSTyApOwoJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5aRVJPLCBnbC5PTkUsIGdsLlpFUk8gKTsKCQkJZ2wuYmxlbmRDb2xvciggMCwgMCwgMCwgMCApOwoKCQkJZ2wuY29sb3JNYXNrKCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlICk7CgkJCWdsLmNsZWFyQ29sb3IoIDAsIDAsIDAsIDAgKTsKCgkJCWdsLmRlcHRoTWFzayggdHJ1ZSApOwoJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFU1MgKTsKCgkJCWRlcHRoQnVmZmVyLnNldFJldmVyc2VkKCBmYWxzZSApOwoKCQkJZ2wuY2xlYXJEZXB0aCggMSApOwoKCQkJZ2wuc3RlbmNpbE1hc2soIDB4ZmZmZmZmZmYgKTsKCQkJZ2wuc3RlbmNpbEZ1bmMoIGdsLkFMV0FZUywgMCwgMHhmZmZmZmZmZiApOwoJCQlnbC5zdGVuY2lsT3AoIGdsLktFRVAsIGdsLktFRVAsIGdsLktFRVAgKTsKCQkJZ2wuY2xlYXJTdGVuY2lsKCAwICk7CgoJCQlnbC5jdWxsRmFjZSggZ2wuQkFDSyApOwoJCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKCQkJZ2wucG9seWdvbk9mZnNldCggMCwgMCApOwoKCQkJZ2wuYWN0aXZlVGV4dHVyZSggZ2wuVEVYVFVSRTAgKTsKCgkJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgkJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoKCQkJZ2wudXNlUHJvZ3JhbSggbnVsbCApOwoKCQkJZ2wubGluZVdpZHRoKCAxICk7CgoJCQlnbC5zY2lzc29yKCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCQkJZ2wudmlld3BvcnQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoKCQkJLy8gcmVzZXQgaW50ZXJuYWxzCgoJCQllbmFibGVkQ2FwYWJpbGl0aWVzID0ge307CgoJCQljdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJCQljdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzID0ge307CgkJCWN1cnJlbnREcmF3YnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgkJCWRlZmF1bHREcmF3YnVmZmVycyA9IFtdOwoKCQkJY3VycmVudFByb2dyYW0gPSBudWxsOwoKCQkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwoJCQljdXJyZW50QmxlbmRpbmcgPSBudWxsOwoJCQljdXJyZW50QmxlbmRFcXVhdGlvbiA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBudWxsOwoJCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKCQkJY3VycmVudEJsZW5kQ29sb3IgPSBuZXcgQ29sb3IoIDAsIDAsIDAgKTsKCQkJY3VycmVudEJsZW5kQWxwaGEgPSAwOwoJCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCgkJCWN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwoJCQljdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKCQkJY3VycmVudExpbmVXaWR0aCA9IG51bGw7CgoJCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IG51bGw7CgkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKCQkJY3VycmVudFNjaXNzb3Iuc2V0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCQkJY3VycmVudFZpZXdwb3J0LnNldCggMCwgMCwgZ2wuY2FudmFzLndpZHRoLCBnbC5jYW52YXMuaGVpZ2h0ICk7CgoJCQljb2xvckJ1ZmZlci5yZXNldCgpOwoJCQlkZXB0aEJ1ZmZlci5yZXNldCgpOwoJCQlzdGVuY2lsQnVmZmVyLnJlc2V0KCk7CgoJCX0KCgkJcmV0dXJuIHsKCgkJCWJ1ZmZlcnM6IHsKCQkJCWNvbG9yOiBjb2xvckJ1ZmZlciwKCQkJCWRlcHRoOiBkZXB0aEJ1ZmZlciwKCQkJCXN0ZW5jaWw6IHN0ZW5jaWxCdWZmZXIKCQkJfSwKCgkJCWVuYWJsZTogZW5hYmxlLAoJCQlkaXNhYmxlOiBkaXNhYmxlLAoKCQkJYmluZEZyYW1lYnVmZmVyOiBiaW5kRnJhbWVidWZmZXIsCgkJCWRyYXdCdWZmZXJzOiBkcmF3QnVmZmVycywKCgkJCXVzZVByb2dyYW06IHVzZVByb2dyYW0sCgoJCQlzZXRCbGVuZGluZzogc2V0QmxlbmRpbmcsCgkJCXNldE1hdGVyaWFsOiBzZXRNYXRlcmlhbCwKCgkJCXNldEZsaXBTaWRlZDogc2V0RmxpcFNpZGVkLAoJCQlzZXRDdWxsRmFjZTogc2V0Q3VsbEZhY2UsCgoJCQlzZXRMaW5lV2lkdGg6IHNldExpbmVXaWR0aCwKCQkJc2V0UG9seWdvbk9mZnNldDogc2V0UG9seWdvbk9mZnNldCwKCgkJCXNldFNjaXNzb3JUZXN0OiBzZXRTY2lzc29yVGVzdCwKCgkJCWFjdGl2ZVRleHR1cmU6IGFjdGl2ZVRleHR1cmUsCgkJCWJpbmRUZXh0dXJlOiBiaW5kVGV4dHVyZSwKCQkJdW5iaW5kVGV4dHVyZTogdW5iaW5kVGV4dHVyZSwKCQkJY29tcHJlc3NlZFRleEltYWdlMkQ6IGNvbXByZXNzZWRUZXhJbWFnZTJELAoJCQljb21wcmVzc2VkVGV4SW1hZ2UzRDogY29tcHJlc3NlZFRleEltYWdlM0QsCgkJCXRleEltYWdlMkQ6IHRleEltYWdlMkQsCgkJCXRleEltYWdlM0Q6IHRleEltYWdlM0QsCgoJCQl1cGRhdGVVQk9NYXBwaW5nOiB1cGRhdGVVQk9NYXBwaW5nLAoJCQl1bmlmb3JtQmxvY2tCaW5kaW5nOiB1bmlmb3JtQmxvY2tCaW5kaW5nLAoKCQkJdGV4U3RvcmFnZTJEOiB0ZXhTdG9yYWdlMkQsCgkJCXRleFN0b3JhZ2UzRDogdGV4U3RvcmFnZTNELAoJCQl0ZXhTdWJJbWFnZTJEOiB0ZXhTdWJJbWFnZTJELAoJCQl0ZXhTdWJJbWFnZTNEOiB0ZXhTdWJJbWFnZTNELAoJCQljb21wcmVzc2VkVGV4U3ViSW1hZ2UyRDogY29tcHJlc3NlZFRleFN1YkltYWdlMkQsCgkJCWNvbXByZXNzZWRUZXhTdWJJbWFnZTNEOiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCwKCgkJCXNjaXNzb3I6IHNjaXNzb3IsCgkJCXZpZXdwb3J0OiB2aWV3cG9ydCwKCgkJCXJlc2V0OiByZXNldAoKCQl9OwoKCX0KCglmdW5jdGlvbiBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICkgewoKCQljb25zdCBtdWx0aXNhbXBsZWRSVFRFeHQgPSBleHRlbnNpb25zLmhhcyggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA/IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApIDogbnVsbDsKCQljb25zdCBzdXBwb3J0c0ludmFsaWRhdGVGcmFtZWJ1ZmZlciA9IHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnID8gZmFsc2UgOiAvT2N1bHVzQnJvd3Nlci9nLnRlc3QoIG5hdmlnYXRvci51c2VyQWdlbnQgKTsKCgkJY29uc3QgX2ltYWdlRGltZW5zaW9ucyA9IG5ldyBWZWN0b3IyKCk7CgkJY29uc3QgX3ZpZGVvVGV4dHVyZXMgPSBuZXcgV2Vha01hcCgpOwoJCWxldCBfY2FudmFzOwoKCQljb25zdCBfc291cmNlcyA9IG5ldyBXZWFrTWFwKCk7IC8vIG1hcHMgV2ViZ2xUZXh0dXJlIG9iamVjdHMgdG8gaW5zdGFuY2VzIG9mIFNvdXJjZQoKCQkvLyBjb3Jkb3ZhIGlPUyAoYXMgb2YgNS4wKSBzdGlsbCB1c2VzIFVJV2ViVmlldywgd2hpY2ggcHJvdmlkZXMgT2Zmc2NyZWVuQ2FudmFzLAoJCS8vIGFsc28gT2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIndlYmdsIiksIGJ1dCBub3QgT2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIjJkIikhCgkJLy8gU29tZSBpbXBsZW1lbnRhdGlvbnMgbWF5IG9ubHkgaW1wbGVtZW50IE9mZnNjcmVlbkNhbnZhcyBwYXJ0aWFsbHkgKGUuZy4gbGFja2luZyAyZCkuCgoJCWxldCB1c2VPZmZzY3JlZW5DYW52YXMgPSBmYWxzZTsKCgkJdHJ5IHsKCgkJCXVzZU9mZnNjcmVlbkNhbnZhcyA9IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICd1bmRlZmluZWQnCgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGF0L2NvbXBhdAoJCQkJJiYgKCBuZXcgT2Zmc2NyZWVuQ2FudmFzKCAxLCAxICkuZ2V0Q29udGV4dCggJzJkJyApICkgIT09IG51bGw7CgoJCX0gY2F0Y2ggKCBlcnIgKSB7CgoJCQkvLyBJZ25vcmUgYW55IGVycm9ycwoKCQl9CgoJCWZ1bmN0aW9uIGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIHsKCgkJCS8vIFVzZSBPZmZzY3JlZW5DYW52YXMgd2hlbiBhdmFpbGFibGUuIFNwZWNpYWxseSBuZWVkZWQgaW4gd2ViIHdvcmtlcnMKCgkJCXJldHVybiB1c2VPZmZzY3JlZW5DYW52YXMgPwoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBhdC9jb21wYXQKCQkJCW5ldyBPZmZzY3JlZW5DYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgkJfQoKCQlmdW5jdGlvbiByZXNpemVJbWFnZSggaW1hZ2UsIG5lZWRzTmV3Q2FudmFzLCBtYXhTaXplICkgewoKCQkJbGV0IHNjYWxlID0gMTsKCgkJCWNvbnN0IGRpbWVuc2lvbnMgPSBnZXREaW1lbnNpb25zKCBpbWFnZSApOwoKCQkJLy8gaGFuZGxlIGNhc2UgaWYgdGV4dHVyZSBleGNlZWRzIG1heCBzaXplCgoJCQlpZiAoIGRpbWVuc2lvbnMud2lkdGggPiBtYXhTaXplIHx8IGRpbWVuc2lvbnMuaGVpZ2h0ID4gbWF4U2l6ZSApIHsKCgkJCQlzY2FsZSA9IG1heFNpemUgLyBNYXRoLm1heCggZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCgkJCX0KCgkJCS8vIG9ubHkgcGVyZm9ybSByZXNpemUgaWYgbmVjZXNzYXJ5CgoJCQlpZiAoIHNjYWxlIDwgMSApIHsKCgkJCQkvLyBvbmx5IHBlcmZvcm0gcmVzaXplIGZvciBjZXJ0YWluIGltYWdlIHR5cGVzCgoJCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCQkJCSggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgfHwKCQkJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApIHx8CgkJCQkJKCB0eXBlb2YgVmlkZW9GcmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lICkgKSB7CgoJCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggc2NhbGUgKiBkaW1lbnNpb25zLndpZHRoICk7CgkJCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5mbG9vciggc2NhbGUgKiBkaW1lbnNpb25zLmhlaWdodCApOwoKCQkJCQlpZiAoIF9jYW52YXMgPT09IHVuZGVmaW5lZCApIF9jYW52YXMgPSBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkJLy8gY3ViZSB0ZXh0dXJlcyBjYW4ndCByZXVzZSB0aGUgc2FtZSBjYW52YXMKCgkJCQkJY29uc3QgY2FudmFzID0gbmVlZHNOZXdDYW52YXMgPyBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IF9jYW52YXM7CgoJCQkJCWNhbnZhcy53aWR0aCA9IHdpZHRoOwoJCQkJCWNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CgoJCQkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwoJCQkJCWNvbnRleHQuZHJhd0ltYWdlKCBpbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGhhcyBiZWVuIHJlc2l6ZWQgZnJvbSAoJyArIGRpbWVuc2lvbnMud2lkdGggKyAneCcgKyBkaW1lbnNpb25zLmhlaWdodCArICcpIHRvICgnICsgd2lkdGggKyAneCcgKyBoZWlnaHQgKyAnKS4nICk7CgoJCQkJCXJldHVybiBjYW52YXM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCAnZGF0YScgaW4gaW1hZ2UgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBJbWFnZSBpbiBEYXRhVGV4dHVyZSBpcyB0b28gYmlnICgnICsgZGltZW5zaW9ucy53aWR0aCArICd4JyArIGRpbWVuc2lvbnMuaGVpZ2h0ICsgJykuJyApOwoKCQkJCQl9CgoJCQkJCXJldHVybiBpbWFnZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gaW1hZ2U7CgoJCX0KCgkJZnVuY3Rpb24gdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgewoKCQkJcmV0dXJuIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKSB7CgoJCQlfZ2wuZ2VuZXJhdGVNaXBtYXAoIHRhcmdldCApOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFRhcmdldFR5cGUoIHRleHR1cmUgKSB7CgoJCQlpZiAoIHRleHR1cmUuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgKSByZXR1cm4gX2dsLlRFWFRVUkVfQ1VCRV9NQVA7CgkJCWlmICggdGV4dHVyZS5pc1dlYkdMM0RSZW5kZXJUYXJnZXQgKSByZXR1cm4gX2dsLlRFWFRVUkVfM0Q7CgkJCWlmICggdGV4dHVyZS5pc1dlYkdMQXJyYXlSZW5kZXJUYXJnZXQgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSByZXR1cm4gX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgkJCXJldHVybiBfZ2wuVEVYVFVSRV8yRDsKCgkJfQoKCQlmdW5jdGlvbiBnZXRJbnRlcm5hbEZvcm1hdCggaW50ZXJuYWxGb3JtYXROYW1lLCBnbEZvcm1hdCwgZ2xUeXBlLCBjb2xvclNwYWNlLCBmb3JjZUxpbmVhclRyYW5zZmVyID0gZmFsc2UgKSB7CgoJCQlpZiAoIGludGVybmFsRm9ybWF0TmFtZSAhPT0gbnVsbCApIHsKCgkJCQlpZiAoIF9nbFsgaW50ZXJuYWxGb3JtYXROYW1lIF0gIT09IHVuZGVmaW5lZCApIHJldHVybiBfZ2xbIGludGVybmFsRm9ybWF0TmFtZSBdOwoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gdXNlIG5vbi1leGlzdGluZyBXZWJHTCBpbnRlcm5hbCBmb3JtYXQgXCcnICsgaW50ZXJuYWxGb3JtYXROYW1lICsgJ1wnJyApOwoKCQkJfQoKCQkJbGV0IGludGVybmFsRm9ybWF0ID0gZ2xGb3JtYXQ7CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkVEICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMzJGOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2RjsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4OwoKCQkJfQoKCQkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJFRF9JTlRFR0VSICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjhJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIxNkk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMkk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkcgKSB7CgoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJGOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkY7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzg7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdfSU5URUdFUiApIHsKCgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzhVSTsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzE2VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJVSTsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHOEk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJJOwoKCQkJfQoKCQkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJHQl9JTlRFR0VSICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjhVSTsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IxNlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IzMlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOEk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCMTZJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IzMkk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCQV9JTlRFR0VSICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkE4VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTE2VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQThJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkExNkk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMkk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfSU5UXzVfOV85XzlfUkVWICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOV9FNTsKCgkJCX0KCgkJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR0JBICkgewoKCQkJCWNvbnN0IHRyYW5zZmVyID0gZm9yY2VMaW5lYXJUcmFuc2ZlciA/IExpbmVhclRyYW5zZmVyIDogQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMkY7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBMTZGOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IF9nbC5TUkdCOF9BTFBIQTggOiBfZ2wuUkdCQTg7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUXzRfNF80XzQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBNDsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjVfQTE7CgoJCQl9CgoJCQlpZiAoIGludGVybmFsRm9ybWF0ID09PSBfZ2wuUjE2RiB8fCBpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlIzMkYgfHwKCQkJCWludGVybmFsRm9ybWF0ID09PSBfZ2wuUkcxNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SRzMyRiB8fAoJCQkJaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SR0JBMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUkdCQTMyRiApIHsKCgkJCQlleHRlbnNpb25zLmdldCggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgoJCQl9CgoJCQlyZXR1cm4gaW50ZXJuYWxGb3JtYXQ7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0SW50ZXJuYWxEZXB0aEZvcm1hdCggdXNlU3RlbmNpbCwgZGVwdGhUeXBlICkgewoKCQkJbGV0IGdsSW50ZXJuYWxGb3JtYXQ7CgkJCWlmICggdXNlU3RlbmNpbCApIHsKCgkJCQlpZiAoIGRlcHRoVHlwZSA9PT0gbnVsbCB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSDI0X1NURU5DSUw4OwoKCQkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gRmxvYXRUeXBlICkgewoKCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIMzJGX1NURU5DSUw4OwoKCQkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSB7CgoJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBfZ2wuREVQVEgyNF9TVEVOQ0lMODsKCQkJCQljb25zb2xlLndhcm4oICdEZXB0aFRleHR1cmU6IDE2IGJpdCBkZXB0aCBhdHRhY2htZW50IGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCBzdGVuY2lsLiBVc2luZyAyNC1iaXQgYXR0YWNobWVudC4nICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIGRlcHRoVHlwZSA9PT0gbnVsbCB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQyNDsKCgkJCQl9IGVsc2UgaWYgKCBkZXB0aFR5cGUgPT09IEZsb2F0VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQzMkY7CgoJCQkJfSBlbHNlIGlmICggZGVwdGhUeXBlID09PSBVbnNpZ25lZFNob3J0VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQxNjsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gZ2xJbnRlcm5hbEZvcm1hdDsKCgkJfQoKCQlmdW5jdGlvbiBnZXRNaXBMZXZlbHMoIHRleHR1cmUsIGltYWdlICkgewoKCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSA9PT0gdHJ1ZSB8fCAoIHRleHR1cmUuaXNGcmFtZWJ1ZmZlclRleHR1cmUgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlciApICkgewoKCQkJCXJldHVybiBNYXRoLmxvZzIoIE1hdGgubWF4KCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICkgKSArIDE7CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLm1pcG1hcHMgIT09IHVuZGVmaW5lZCAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkvLyB1c2VyLWRlZmluZWQgbWlwbWFwcwoKCQkJCXJldHVybiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOwoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICYmIEFycmF5LmlzQXJyYXkoIHRleHR1cmUuaW1hZ2UgKSApIHsKCgkJCQlyZXR1cm4gaW1hZ2UubWlwbWFwcy5sZW5ndGg7CgoJCQl9IGVsc2UgewoKCQkJCS8vIHRleHR1cmUgd2l0aG91dCBtaXBtYXBzIChvbmx5IGJhc2UgbGV2ZWwpCgoJCQkJcmV0dXJuIDE7CgoJCQl9CgoJCX0KCgkJLy8KCgkJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCWRlYWxsb2NhdGVUZXh0dXJlKCB0ZXh0dXJlICk7CgoJCQlpZiAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKSB7CgoJCQkJX3ZpZGVvVGV4dHVyZXMuZGVsZXRlKCB0ZXh0dXJlICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gb25SZW5kZXJUYXJnZXREaXNwb3NlKCBldmVudCApIHsKCgkJCWNvbnN0IHJlbmRlclRhcmdldCA9IGV2ZW50LnRhcmdldDsKCgkJCXJlbmRlclRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSApOwoKCQkJZGVhbGxvY2F0ZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCX0KCgkJLy8KCgkJZnVuY3Rpb24gZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKSB7CgoJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZW1vdmUgdGhlIFdlYkdMVGV4dHVyZSBvYmplY3QKCgkJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoJCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCgkJCWlmICggd2ViZ2xUZXh0dXJlcyApIHsKCgkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5IF07CgkJCQl3ZWJnbFRleHR1cmUudXNlZFRpbWVzIC0tOwoKCQkJCS8vIHRoZSBXZWJHTFRleHR1cmUgb2JqZWN0IGlzIG5vdCB1c2VkIGFueW1vcmUsIHJlbW92ZSBpdAoKCQkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCQkJZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApOwoKCQkJCX0KCgkJCQkvLyByZW1vdmUgdGhlIHdlYWsgbWFwIGVudHJ5IGlmIG5vIFdlYkdMVGV4dHVyZSB1c2VzIHRoZSBzb3VyY2UgYW55bW9yZQoKCQkJCWlmICggT2JqZWN0LmtleXMoIHdlYmdsVGV4dHVyZXMgKS5sZW5ndGggPT09IDAgKSB7CgoJCQkJCV9zb3VyY2VzLmRlbGV0ZSggc291cmNlICk7CgoJCQkJfQoKCQkJfQoKCQkJcHJvcGVydGllcy5yZW1vdmUoIHRleHR1cmUgKTsKCgkJfQoKCQlmdW5jdGlvbiBkZWxldGVUZXh0dXJlKCB0ZXh0dXJlICkgewoKCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoJCQlfZ2wuZGVsZXRlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCgkJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoJCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCQkJZGVsZXRlIHdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXTsKCgkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQl9CgoJCWZ1bmN0aW9uIGRlYWxsb2NhdGVSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKSB7CgoJCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5kaXNwb3NlKCk7CgoJCQkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKTsKCgkJCX0KCgkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApICkgewoKCQkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdLmxlbmd0aDsgbGV2ZWwgKysgKSBfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF1bIGxldmVsIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoKCQkJCQl9CgoJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgoJCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIubGVuZ3RoOyBsZXZlbCArKyApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0gKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJfQoKCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApOwoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCgkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlci5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyICk7CgoJCQl9CgoJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgoJCQkJaWYgKCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApIHsKCgkJCQkJX2dsLmRlbGV0ZVRleHR1cmUoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQkJCX0KCgkJCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZXNbIGkgXSApOwoKCQkJfQoKCQkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldCApOwoKCQl9CgoJCS8vCgoJCWxldCB0ZXh0dXJlVW5pdHMgPSAwOwoKCQlmdW5jdGlvbiByZXNldFRleHR1cmVVbml0cygpIHsKCgkJCXRleHR1cmVVbml0cyA9IDA7CgoJCX0KCgkJZnVuY3Rpb24gYWxsb2NhdGVUZXh0dXJlVW5pdCgpIHsKCgkJCWNvbnN0IHRleHR1cmVVbml0ID0gdGV4dHVyZVVuaXRzOwoKCQkJaWYgKCB0ZXh0dXJlVW5pdCA+PSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZXMgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVHJ5aW5nIHRvIHVzZSAnICsgdGV4dHVyZVVuaXQgKyAnIHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAnICsgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzICk7CgoJCQl9CgoJCQl0ZXh0dXJlVW5pdHMgKz0gMTsKCgkJCXJldHVybiB0ZXh0dXJlVW5pdDsKCgkJfQoKCQlmdW5jdGlvbiBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKSB7CgoJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJYXJyYXkucHVzaCggdGV4dHVyZS53cmFwUyApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLndyYXBUICk7CgkJCWFycmF5LnB1c2goIHRleHR1cmUud3JhcFIgfHwgMCApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1hZ0ZpbHRlciApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1pbkZpbHRlciApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmFuaXNvdHJvcHkgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmZvcm1hdCApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnR5cGUgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CgkJCWFycmF5LnB1c2goIHRleHR1cmUuZmxpcFkgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5jb2xvclNwYWNlICk7CgoJCQlyZXR1cm4gYXJyYXkuam9pbigpOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIHNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApIHVwZGF0ZVZpZGVvVGV4dHVyZSggdGV4dHVyZSApOwoKCQkJaWYgKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgJiYgdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQljb25zdCBpbWFnZSA9IHRleHR1cmUuaW1hZ2U7CgoJCQkJaWYgKCBpbWFnZSA9PT0gbnVsbCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgbm8gaW1hZ2UgZGF0YSBmb3VuZC4nICk7CgoJCQkJfSBlbHNlIGlmICggaW1hZ2UuY29tcGxldGUgPT09IGZhbHNlICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBpbWFnZSBpcyBpbmNvbXBsZXRlJyApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJfQoKCQlmdW5jdGlvbiBzZXRUZXh0dXJlMkRBcnJheSggdGV4dHVyZSwgc2xvdCApIHsKCgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQl9CgoJCWZ1bmN0aW9uIHNldFRleHR1cmUzRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzNELCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQl9CgoJCWZ1bmN0aW9uIHNldFRleHR1cmVDdWJlKCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKCQkJCXVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQl9CgoJCWNvbnN0IHdyYXBwaW5nVG9HTCA9IHsKCQkJWyBSZXBlYXRXcmFwcGluZyBdOiBfZ2wuUkVQRUFULAoJCQlbIENsYW1wVG9FZGdlV3JhcHBpbmcgXTogX2dsLkNMQU1QX1RPX0VER0UsCgkJCVsgTWlycm9yZWRSZXBlYXRXcmFwcGluZyBdOiBfZ2wuTUlSUk9SRURfUkVQRUFUCgkJfTsKCgkJY29uc3QgZmlsdGVyVG9HTCA9IHsKCQkJWyBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNULAoJCQlbIE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNUX01JUE1BUF9ORUFSRVNULAoJCQlbIE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgXTogX2dsLk5FQVJFU1RfTUlQTUFQX0xJTkVBUiwKCgkJCVsgTGluZWFyRmlsdGVyIF06IF9nbC5MSU5FQVIsCgkJCVsgTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9ORUFSRVNULAoJCQlbIExpbmVhck1pcG1hcExpbmVhckZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9MSU5FQVIKCQl9OwoKCQljb25zdCBjb21wYXJlVG9HTCA9IHsKCQkJWyBOZXZlckNvbXBhcmUgXTogX2dsLk5FVkVSLAoJCQlbIEFsd2F5c0NvbXBhcmUgXTogX2dsLkFMV0FZUywKCQkJWyBMZXNzQ29tcGFyZSBdOiBfZ2wuTEVTUywKCQkJWyBMZXNzRXF1YWxDb21wYXJlIF06IF9nbC5MRVFVQUwsCgkJCVsgRXF1YWxDb21wYXJlIF06IF9nbC5FUVVBTCwKCQkJWyBHcmVhdGVyRXF1YWxDb21wYXJlIF06IF9nbC5HRVFVQUwsCgkJCVsgR3JlYXRlckNvbXBhcmUgXTogX2dsLkdSRUFURVIsCgkJCVsgTm90RXF1YWxDb21wYXJlIF06IF9nbC5OT1RFUVVBTAoJCX07CgoJCWZ1bmN0aW9uIHNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSApIHsKCgkJCWlmICggdGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IGZhbHNlICYmCgkJCQkoIHRleHR1cmUubWFnRmlsdGVyID09PSBMaW5lYXJGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciB8fAoJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPT09IExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyICkgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5hYmxlIHRvIHVzZSBsaW5lYXIgZmlsdGVyaW5nIHdpdGggZmxvYXRpbmcgcG9pbnQgdGV4dHVyZXMuIE9FU190ZXh0dXJlX2Zsb2F0X2xpbmVhciBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlLicgKTsKCgkJCX0KCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9TLCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFMgXSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfVCwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBUIF0gKTsKCgkJCWlmICggdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUeXBlID09PSBfZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfUiwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBSIF0gKTsKCgkJCX0KCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZmlsdGVyVG9HTFsgdGV4dHVyZS5tYWdGaWx0ZXIgXSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX01JTl9GSUxURVIsIGZpbHRlclRvR0xbIHRleHR1cmUubWluRmlsdGVyIF0gKTsKCgkJCWlmICggdGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gKSB7CgoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9DT01QQVJFX01PREUsIF9nbC5DT01QQVJFX1JFRl9UT19URVhUVVJFICk7CgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX0NPTVBBUkVfRlVOQywgY29tcGFyZVRvR0xbIHRleHR1cmUuY29tcGFyZUZ1bmN0aW9uIF0gKTsKCgkJCX0KCgkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgPT09IHRydWUgKSB7CgoJCQkJaWYgKCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTmVhcmVzdEZpbHRlciApIHJldHVybjsKCQkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHJldHVybjsKCQkJCWlmICggdGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IGZhbHNlICkgcmV0dXJuOyAvLyB2ZXJpZnkgZXh0ZW5zaW9uCgoJCQkJaWYgKCB0ZXh0dXJlLmFuaXNvdHJvcHkgPiAxIHx8IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSApIHsKCgkJCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgkJCQkJX2dsLnRleFBhcmFtZXRlcmYoIHRleHR1cmVUeXBlLCBleHRlbnNpb24uVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIE1hdGgubWluKCB0ZXh0dXJlLmFuaXNvdHJvcHksIGNhcGFiaWxpdGllcy5nZXRNYXhBbmlzb3Ryb3B5KCkgKSApOwoJCQkJCXByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSA9IHRleHR1cmUuYW5pc290cm9weTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICkgewoKCQkJbGV0IGZvcmNlVXBsb2FkID0gZmFsc2U7CgoJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPSB0cnVlOwoKCQkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCQl9CgoJCQkvLyBjcmVhdGUgU291cmNlIDwtPiBXZWJHTFRleHR1cmVzIG1hcHBpbmcgaWYgbmVjZXNzYXJ5CgoJCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCQkJbGV0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwoKCQkJaWYgKCB3ZWJnbFRleHR1cmVzID09PSB1bmRlZmluZWQgKSB7CgoJCQkJd2ViZ2xUZXh0dXJlcyA9IHt9OwoJCQkJX3NvdXJjZXMuc2V0KCBzb3VyY2UsIHdlYmdsVGV4dHVyZXMgKTsKCgkJCX0KCgkJCS8vIGNoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBXZWJHTFRleHR1cmUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gdGV4dHVyZSBwYXJhbWV0ZXJzCgoJCQljb25zdCB0ZXh0dXJlQ2FjaGVLZXkgPSBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZUNhY2hlS2V5ICE9PSB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5ICkgewoKCQkJCS8vIGlmIG5vdCwgY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIFdlYkdMVGV4dHVyZQoKCQkJCWlmICggd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gY3JlYXRlIG5ldyBlbnRyeQoKCQkJCQl3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXSA9IHsKCQkJCQkJdGV4dHVyZTogX2dsLmNyZWF0ZVRleHR1cmUoKSwKCQkJCQkJdXNlZFRpbWVzOiAwCgkJCQkJfTsKCgkJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgoJCQkJCS8vIHdoZW4gYSBuZXcgaW5zdGFuY2Ugb2YgV2ViR0xUZXh0dXJlIHdhcyBjcmVhdGVkLCBhIHRleHR1cmUgdXBsb2FkIGlzIHJlcXVpcmVkCgkJCQkJLy8gZXZlbiBpZiB0aGUgaW1hZ2UgY29udGVudHMgYXJlIGlkZW50aWNhbAoKCQkJCQlmb3JjZVVwbG9hZCA9IHRydWU7CgoJCQkJfQoKCQkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnVzZWRUaW1lcyArKzsKCgkJCQkvLyBldmVyeSB0aW1lIHRoZSB0ZXh0dXJlIGNhY2hlIGtleSBjaGFuZ2VzLCBpdCdzIG5lY2Vzc2FyeSB0byBjaGVjayBpZiBhbiBpbnN0YW5jZSBvZgoJCQkJLy8gV2ViR0xUZXh0dXJlIGNhbiBiZSBkZWxldGVkIGluIG9yZGVyIHRvIGF2b2lkIGEgbWVtb3J5IGxlYWsuCgoJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoKCQkJCWlmICggd2ViZ2xUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXS51c2VkVGltZXMgLS07CgoJCQkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCQkJCWRlbGV0ZVRleHR1cmUoIHRleHR1cmUgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyBzdG9yZSByZWZlcmVuY2VzIHRvIGNhY2hlIGtleSBhbmQgV2ViR0xUZXh0dXJlIG9iamVjdAoKCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgPSB0ZXh0dXJlQ2FjaGVLZXk7CgkJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnRleHR1cmU7CgoJCQl9CgoJCQlyZXR1cm4gZm9yY2VVcGxvYWQ7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0Um93KCBpbmRleCwgcm93TGVuZ3RoLCBjb21wb25lbnRTdHJpZGUgKSB7CgoJCQlyZXR1cm4gTWF0aC5mbG9vciggTWF0aC5mbG9vciggaW5kZXggLyBjb21wb25lbnRTdHJpZGUgKSAvIHJvd0xlbmd0aCApOwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVRleHR1cmUoIHRleHR1cmUsIGltYWdlLCBnbEZvcm1hdCwgZ2xUeXBlICkgewoKCQkJY29uc3QgY29tcG9uZW50U3RyaWRlID0gNDsgLy8gb25seSBSR0JBIHN1cHBvcnRlZAoKCQkJY29uc3QgdXBkYXRlUmFuZ2VzID0gdGV4dHVyZS51cGRhdGVSYW5nZXM7CgoJCQlpZiAoIHVwZGF0ZVJhbmdlcy5sZW5ndGggPT09IDAgKSB7CgoJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gQmVmb3JlIGFwcGx5aW5nIHVwZGF0ZSByYW5nZXMsIHdlIG1lcmdlIGFueSBhZGphY2VudCAvIG92ZXJsYXBwaW5nCgkJCQkvLyByYW5nZXMgdG8gcmVkdWNlIGxvYWQgb24gYGdsLnRleFN1YkltYWdlMkRgLiBFbXBpcmljYWxseSwgdGhpcyBoYXMgbGVkCgkJCQkvLyB0byBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBtYWtlIGhlYXZ5IHVzZSBvZgoJCQkJLy8gdXBkYXRlIHJhbmdlcy4gTGlrZWx5IGR1ZSB0byBHUFUgY29tbWFuZCBvdmVyaGVhZC4KCQkJCS8vCgkJCQkvLyBOb3RlIHRoYXQgdG8gcmVkdWNlIGdhcmJhZ2UgY29sbGVjdGlvbiBiZXR3ZWVuIGZyYW1lcywgd2UgbWVyZ2UgdGhlCgkJCQkvLyB1cGRhdGUgcmFuZ2VzIGluLXBsYWNlLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB0aGlzIG1ldGhvZCB3aWxsIGNsZWFyIHRoZQoJCQkJLy8gdXBkYXRlIHJhbmdlcyBvbmNlIHVwZGF0ZWQuCgoJCQkJdXBkYXRlUmFuZ2VzLnNvcnQoICggYSwgYiApID0+IGEuc3RhcnQgLSBiLnN0YXJ0ICk7CgoJCQkJLy8gVG8gbWVyZ2UgdGhlIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UsIHdlIHdvcmsgZnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZQoJCQkJLy8gZXhpc3RpbmcgdXBkYXRlUmFuZ2VzIGFycmF5LCBtZXJnaW5nIHJhbmdlcy4gVGhpcyBtYXkgcmVzdWx0IGluIGEgZmluYWwKCQkJCS8vIGFycmF5IHdoaWNoIGlzIHNtYWxsZXIgdGhhbiB0aGUgb3JpZ2luYWwuIFRoaXMgaW5kZXggdHJhY2tzIHRoZSBsYXN0CgkJCQkvLyBpbmRleCByZXByZXNlbnRpbmcgYSBtZXJnZWQgcmFuZ2UsIGFueSBkYXRhIGFmdGVyIHRoaXMgaW5kZXggY2FuIGJlCgkJCQkvLyB0cmltbWVkIG9uY2UgdGhlIG1lcmdlIGFsZ29yaXRobSBpcyBjb21wbGV0ZWQuCgkJCQlsZXQgbWVyZ2VJbmRleCA9IDA7CgoJCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgcHJldmlvdXNSYW5nZSA9IHVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdOwoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCS8vIE9ubHkgbWVyZ2UgaWYgaW4gdGhlIHNhbWUgcm93IGFuZCBvdmVybGFwcGluZy9hZGphY2VudAoJCQkJCWNvbnN0IHByZXZpb3VzRW5kID0gcHJldmlvdXNSYW5nZS5zdGFydCArIHByZXZpb3VzUmFuZ2UuY291bnQ7CgkJCQkJY29uc3QgY3VycmVudFJvdyA9IGdldFJvdyggcmFuZ2Uuc3RhcnQsIGltYWdlLndpZHRoLCBjb21wb25lbnRTdHJpZGUgKTsKCQkJCQljb25zdCBwcmV2aW91c1JvdyA9IGdldFJvdyggcHJldmlvdXNSYW5nZS5zdGFydCwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApOwoKCQkJCQkvLyBXZSBhZGQgb25lIGhlcmUgdG8gbWVyZ2UgYWRqYWNlbnQgcmFuZ2VzLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSByYW5nZXMKCQkJCQkvLyBvcGVyYXRlIG92ZXIgcG9zaXRpdmUgaW50ZWdlcnMuCgkJCQkJaWYgKAoJCQkJCQlyYW5nZS5zdGFydCA8PSBwcmV2aW91c0VuZCArIDEgJiYKCQkJCQkJY3VycmVudFJvdyA9PT0gcHJldmlvdXNSb3cgJiYKCQkJCQkJZ2V0Um93KCByYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gMSwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApID09PSBjdXJyZW50Um93IC8vIGVuc3VyZSByYW5nZSBkb2Vzbid0IHNwaWxsCgkJCQkJKSB7CgoJCQkJCQlwcmV2aW91c1JhbmdlLmNvdW50ID0gTWF0aC5tYXgoCgkJCQkJCQlwcmV2aW91c1JhbmdlLmNvdW50LAoJCQkJCQkJcmFuZ2Uuc3RhcnQgKyByYW5nZS5jb3VudCAtIHByZXZpb3VzUmFuZ2Uuc3RhcnQKCQkJCQkJKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCSsrIG1lcmdlSW5kZXg7CgkJCQkJCXVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdID0gcmFuZ2U7CgoJCQkJCX0KCgoJCQkJfQoKCQkJCS8vIFRyaW0gdGhlIGFycmF5IHRvIG9ubHkgY29udGFpbiB0aGUgbWVyZ2VkIHJhbmdlcy4KCQkJCXVwZGF0ZVJhbmdlcy5sZW5ndGggPSBtZXJnZUluZGV4ICsgMTsKCgkJCQljb25zdCBjdXJyZW50VW5wYWNrUm93TGVuID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19ST1dfTEVOR1RIICk7CgkJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGltYWdlLndpZHRoICk7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCWNvbnN0IHBpeGVsU3RhcnQgPSBNYXRoLmZsb29yKCByYW5nZS5zdGFydCAvIGNvbXBvbmVudFN0cmlkZSApOwoJCQkJCWNvbnN0IHBpeGVsQ291bnQgPSBNYXRoLmNlaWwoIHJhbmdlLmNvdW50IC8gY29tcG9uZW50U3RyaWRlICk7CgoJCQkJCWNvbnN0IHggPSBwaXhlbFN0YXJ0ICUgaW1hZ2Uud2lkdGg7CgkJCQkJY29uc3QgeSA9IE1hdGguZmxvb3IoIHBpeGVsU3RhcnQgLyBpbWFnZS53aWR0aCApOwoKCQkJCQkvLyBBc3N1bWVzIHVwZGF0ZSByYW5nZXMgcmVmZXIgdG8gY29udGlndW91cyBtZW1vcnkKCQkJCQljb25zdCB3aWR0aCA9IHBpeGVsQ291bnQ7CgkJCQkJY29uc3QgaGVpZ2h0ID0gMTsKCgkJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCB4ICk7CgkJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUk9XUywgeSApOwoKCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCX0KCgkJCQl0ZXh0dXJlLmNsZWFyVXBkYXRlUmFuZ2VzKCk7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGN1cnJlbnRVbnBhY2tSb3dMZW4gKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgY3VycmVudFVucGFja1NraXBQaXhlbHMgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIGN1cnJlbnRVbnBhY2tTa2lwUm93cyApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJbGV0IHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfMkQ7CgoJCQlpZiAoIHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlIHx8IHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCQkJaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfM0Q7CgoJCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwoJCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgoJCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCgkJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwoJCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgoJCQkJbGV0IGltYWdlID0gcmVzaXplSW1hZ2UoIHRleHR1cmUuaW1hZ2UsIGZhbHNlLCBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKCQkJCWltYWdlID0gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgaW1hZ2UgKTsKCgkJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCgkJCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKCQkJCWxldCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApOwoKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSApOwoKCQkJCWxldCBtaXBtYXA7CgkJCQljb25zdCBtaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKCQkJCWNvbnN0IHVzZVRleFN0b3JhZ2UgPSAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgIT09IHRydWUgKTsKCQkJCWNvbnN0IGFsbG9jYXRlTWVtb3J5ID0gKCBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9PT0gdW5kZWZpbmVkICkgfHwgKCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApOwoJCQkJY29uc3QgZGF0YVJlYWR5ID0gc291cmNlLmRhdGFSZWFkeTsKCQkJCWNvbnN0IGxldmVscyA9IGdldE1pcExldmVscyggdGV4dHVyZSwgaW1hZ2UgKTsKCgkJCQlpZiAoIHRleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbERlcHRoRm9ybWF0KCB0ZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0LCB0ZXh0dXJlLnR5cGUgKTsKCgkJCQkJLy8KCgkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCAxLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUgKSB7CgoJCQkJCS8vIHVzZSBtYW51YWxseSBjcmVhdGVkIG1pcG1hcHMgaWYgYXZhaWxhYmxlCgkJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCgkJCQkJLy8gc2V0IDAgbGV2ZWwgbWlwbWFwIGFuZCB0aGVuIHVzZSBHTCB0byBnZW5lcmF0ZSBvdGhlciBtaXBtYXAgbGV2ZWxzCgoJCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCQl9CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCgkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQl1cGRhdGVUZXh0dXJlKCB0ZXh0dXJlLCBpbWFnZSwgZ2xGb3JtYXQsIGdsVHlwZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCgkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCgkJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKCQkJCQkJCQlpZiAoIGdsRm9ybWF0ICE9PSBudWxsICkgewoKCQkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCQlpZiAoIHRleHR1cmUubGF5ZXJVcGRhdGVzLnNpemUgPiAwICkgewoKCQkJCQkJCQkJCQkJY29uc3QgbGF5ZXJCeXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aCggbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS50eXBlICk7CgoJCQkJCQkJCQkJCQlmb3IgKCBjb25zdCBsYXllckluZGV4IG9mIHRleHR1cmUubGF5ZXJVcGRhdGVzICkgewoKCQkJCQkJCQkJCQkJCWNvbnN0IGxheWVyRGF0YSA9IG1pcG1hcC5kYXRhLnN1YmFycmF5KAoJCQkJCQkJCQkJCQkJCWxheWVySW5kZXggKiBsYXllckJ5dGVMZW5ndGggLyBtaXBtYXAuZGF0YS5CWVRFU19QRVJfRUxFTUVOVCwKCQkJCQkJCQkJCQkJCQkoIGxheWVySW5kZXggKyAxICkgKiBsYXllckJ5dGVMZW5ndGggLyBtaXBtYXAuZGF0YS5CWVRFU19QRVJfRUxFTUVOVAoJCQkJCQkJCQkJCQkJKTsKCQkJCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgMCwgMCwgbGF5ZXJJbmRleCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAxLCBnbEZvcm1hdCwgbGF5ZXJEYXRhICk7CgoJCQkJCQkJCQkJCQl9CgoJCQkJCQkJCQkJCQl0ZXh0dXJlLmNsZWFyTGF5ZXJVcGRhdGVzKCk7CgoJCQkJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIDAsIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQkJCQl9CgoJCQkJCQkJCQkJfQoKCQkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIG1pcG1hcC5kYXRhLCAwLCAwICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAudXBsb2FkVGV4dHVyZSgpJyApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIDAsIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCApOwoKCQkJCQkJfQoKCQkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQkJbWlwbWFwID0gbWlwbWFwc1sgaSBdOwoKCQkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgKSB7CgoJCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgoJCQkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJCQl9CgoJCQkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQkJfQoKCQkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnVwbG9hZFRleHR1cmUoKScgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJaWYgKCB0ZXh0dXJlLmxheWVyVXBkYXRlcy5zaXplID4gMCApIHsKCgkJCQkJCQkJY29uc3QgbGF5ZXJCeXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aCggaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUudHlwZSApOwoKCQkJCQkJCQlmb3IgKCBjb25zdCBsYXllckluZGV4IG9mIHRleHR1cmUubGF5ZXJVcGRhdGVzICkgewoKCQkJCQkJCQkJY29uc3QgbGF5ZXJEYXRhID0gaW1hZ2UuZGF0YS5zdWJhcnJheSgKCQkJCQkJCQkJCWxheWVySW5kZXggKiBsYXllckJ5dGVMZW5ndGggLyBpbWFnZS5kYXRhLkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCQkJCQkJKCBsYXllckluZGV4ICsgMSApICogbGF5ZXJCeXRlTGVuZ3RoIC8gaW1hZ2UuZGF0YS5CWVRFU19QRVJfRUxFTUVOVAoJCQkJCQkJCQkpOwoJCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgMCwgMCwgbGF5ZXJJbmRleCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgMSwgZ2xGb3JtYXQsIGdsVHlwZSwgbGF5ZXJEYXRhICk7CgoJCQkJCQkJCX0KCgkJCQkJCQkJdGV4dHVyZS5jbGVhckxheWVyVXBkYXRlcygpOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCAwLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNGcmFtZWJ1ZmZlclRleHR1cmUgKSB7CgoJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWxldCB3aWR0aCA9IGltYWdlLndpZHRoLCBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGV2ZWxzOyBpICsrICkgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbnVsbCApOwoKCQkJCQkJCQl3aWR0aCA+Pj0gMTsKCQkJCQkJCQloZWlnaHQgPj49IDE7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gcmVndWxhciBUZXh0dXJlIChpbWFnZSwgdmlkZW8sIGNhbnZhcykKCgkJCQkJLy8gdXNlIG1hbnVhbGx5IGNyZWF0ZWQgbWlwbWFwcyBpZiBhdmFpbGFibGUKCQkJCQkvLyBpZiB0aGVyZSBhcmUgbm8gbWFudWFsIG1pcG1hcHMKCQkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCgkJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIG1pcG1hcHNbIDAgXSApOwoKCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGltYWdlICk7CgoJCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCgkJCQkJZ2VuZXJhdGVNaXBtYXAoIHRleHR1cmVUeXBlICk7CgoJCQkJfQoKCQkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgoJCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQkJfQoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCQl9CgoJCWZ1bmN0aW9uIHVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApIHsKCgkJCWlmICggdGV4dHVyZS5pbWFnZS5sZW5ndGggIT09IDYgKSByZXR1cm47CgoJCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwoJCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgoJCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCgkJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwoJCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgoJCQkJY29uc3QgaXNDb21wcmVzc2VkID0gKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgfHwgdGV4dHVyZS5pbWFnZVsgMCBdLmlzQ29tcHJlc3NlZFRleHR1cmUgKTsKCQkJCWNvbnN0IGlzRGF0YVRleHR1cmUgPSAoIHRleHR1cmUuaW1hZ2VbIDAgXSAmJiB0ZXh0dXJlLmltYWdlWyAwIF0uaXNEYXRhVGV4dHVyZSApOwoKCQkJCWNvbnN0IGN1YmVJbWFnZSA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCWlmICggISBpc0NvbXByZXNzZWQgJiYgISBpc0RhdGFUZXh0dXJlICkgewoKCQkJCQkJY3ViZUltYWdlWyBpIF0gPSByZXNpemVJbWFnZSggdGV4dHVyZS5pbWFnZVsgaSBdLCB0cnVlLCBjYXBhYmlsaXRpZXMubWF4Q3ViZW1hcFNpemUgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWN1YmVJbWFnZVsgaSBdID0gaXNEYXRhVGV4dHVyZSA/IHRleHR1cmUuaW1hZ2VbIGkgXS5pbWFnZSA6IHRleHR1cmUuaW1hZ2VbIGkgXTsKCgkJCQkJfQoKCQkJCQljdWJlSW1hZ2VbIGkgXSA9IHZlcmlmeUNvbG9yU3BhY2UoIHRleHR1cmUsIGN1YmVJbWFnZVsgaSBdICk7CgoJCQkJfQoKCQkJCWNvbnN0IGltYWdlID0gY3ViZUltYWdlWyAwIF0sCgkJCQkJZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICksCgkJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCgkJCQljb25zdCB1c2VUZXhTdG9yYWdlID0gKCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICE9PSB0cnVlICk7CgkJCQljb25zdCBhbGxvY2F0ZU1lbW9yeSA9ICggc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPT09IHVuZGVmaW5lZCApIHx8ICggZm9yY2VVcGxvYWQgPT09IHRydWUgKTsKCQkJCWNvbnN0IGRhdGFSZWFkeSA9IHNvdXJjZS5kYXRhUmVhZHk7CgkJCQlsZXQgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSApOwoKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZSApOwoKCQkJCWxldCBtaXBtYXBzOwoKCQkJCWlmICggaXNDb21wcmVzc2VkICkgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQkJbWlwbWFwcyA9IGN1YmVJbWFnZVsgaSBdLm1pcG1hcHM7CgoJCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaiArKyApIHsKCgkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgoJCQkJCQkJaWYgKCB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCApIHsKCgkJCQkJCQkJaWYgKCBnbEZvcm1hdCAhPT0gbnVsbCApIHsKCgkJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCgkJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQkJCX0KCgkJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAuc2V0VGV4dHVyZUN1YmUoKScgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJbWlwbWFwcyA9IHRleHR1cmUubWlwbWFwczsKCgkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkJLy8gVE9ETzogVW5pZm9ybWx5IGhhbmRsZSBtaXBtYXAgZGVmaW5pdGlvbnMKCQkJCQkJLy8gTm9ybWFsIHRleHR1cmVzIGFuZCBjb21wcmVzc2VkIGN1YmUgdGV4dHVyZXMgZGVmaW5lIGJhc2UgbGV2ZWwgKyBtaXBzIHdpdGggdGhlaXIgbWlwbWFwIGFycmF5CgkJCQkJCS8vIFVuY29tcHJlc3NlZCBjdWJlIHRleHR1cmVzIHVzZSB0aGVpciBtaXBtYXAgYXJyYXkgb25seSBmb3IgbWlwcyAobm8gYmFzZSBsZXZlbCkKCgkJCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgbGV2ZWxzICsrOwoKCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGN1YmVJbWFnZVsgMCBdICk7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGRpbWVuc2lvbnMud2lkdGgsIGRpbWVuc2lvbnMuaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJCWlmICggaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIDAsIDAsIGN1YmVJbWFnZVsgaSBdLndpZHRoLCBjdWJlSW1hZ2VbIGkgXS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCBnbEludGVybmFsRm9ybWF0LCBjdWJlSW1hZ2VbIGkgXS53aWR0aCwgY3ViZUltYWdlWyBpIF0uaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXS5kYXRhICk7CgoJCQkJCQkJfQoKCQkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgkJCQkJCQkJY29uc3QgbWlwbWFwSW1hZ2UgPSBtaXBtYXAuaW1hZ2VbIGkgXS5pbWFnZTsKCgkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCAwLCAwLCBtaXBtYXBJbWFnZS53aWR0aCwgbWlwbWFwSW1hZ2UuaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXBJbWFnZS5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCgkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdICk7CgoJCQkJCQkJfQoKCQkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgMCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCgkJCQkJCQkJCX0KCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSApICkgewoKCQkJCQkvLyBXZSBhc3N1bWUgaW1hZ2VzIGZvciBjdWJlIG1hcCBoYXZlIHRoZSBzYW1lIHNpemUuCgkJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFX0NVQkVfTUFQICk7CgoJCQkJfQoKCQkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgoJCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQkJfQoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCQl9CgoJCS8vIFJlbmRlciB0YXJnZXRzCgoJCS8vIFNldHVwIHN0b3JhZ2UgZm9yIHRhcmdldCB0ZXh0dXJlIGFuZCBiaW5kIGl0IHRvIGNvcnJlY3QgZnJhbWVidWZmZXIKCQlmdW5jdGlvbiBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgbGV2ZWwgKSB7CgoJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICk7CgkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoKCQkJaWYgKCAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC53aWR0aCA+PiBsZXZlbCApOwoJCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC5oZWlnaHQgPj4gbGV2ZWwgKTsKCgkJCQlpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCB0ZXh0dXJlVGFyZ2V0LCBsZXZlbCwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgcmVuZGVyVGFyZ2V0LmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3RhdGUudGV4SW1hZ2UyRCggdGV4dHVyZVRhcmdldCwgbGV2ZWwsIGdsSW50ZXJuYWxGb3JtYXQsIHdpZHRoLCBoZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBhdHRhY2htZW50LCB0ZXh0dXJlVGFyZ2V0LCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgMCwgZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICkgKTsKCgkJCX0gZWxzZSBpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEIHx8ICggdGV4dHVyZVRhcmdldCA+PSBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICYmIHRleHR1cmVUYXJnZXQgPD0gX2dsLlRFWFRVUkVfQ1VCRV9NQVBfTkVHQVRJVkVfWiApICkgeyAvLyBzZWUgIzI0NzUzCgoJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIGF0dGFjaG1lbnQsIHRleHR1cmVUYXJnZXQsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBsZXZlbCApOwoKCQkJfQoKCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJfQoKCQkvLyBTZXR1cCBzdG9yYWdlIGZvciBpbnRlcm5hbCBkZXB0aC9zdGVuY2lsIGJ1ZmZlcnMgYW5kIGJpbmQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgoJCWZ1bmN0aW9uIHNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIGlzTXVsdGlzYW1wbGUgKSB7CgoJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCgkJCQkvLyByZXRyaWV2ZSB0aGUgZGVwdGggYXR0YWNobWVudCB0eXBlcwoJCQkJY29uc3QgZGVwdGhUZXh0dXJlID0gcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZTsKCQkJCWNvbnN0IGRlcHRoVHlwZSA9IGRlcHRoVGV4dHVyZSAmJiBkZXB0aFRleHR1cmUuaXNEZXB0aFRleHR1cmUgPyBkZXB0aFRleHR1cmUudHlwZSA6IG51bGw7CgkJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxEZXB0aEZvcm1hdCggcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIsIGRlcHRoVHlwZSApOwoJCQkJY29uc3QgZ2xBdHRhY2htZW50VHlwZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwoKCQkJCS8vIHNldCB1cCB0aGUgYXR0YWNobWVudAoJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoJCQkJY29uc3QgaXNVc2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApOwoJCQkJaWYgKCBpc1VzZU11bHRpc2FtcGxlZFJUVCApIHsKCgkJCQkJbXVsdGlzYW1wbGVkUlRURXh0LnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZUVYVCggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfSBlbHNlIGlmICggaXNNdWx0aXNhbXBsZSApIHsKCgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0KCgkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZ2xBdHRhY2htZW50VHlwZSwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgoJCQkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCQkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKCQkJCQlpZiAoIGlzTXVsdGlzYW1wbGUgJiYgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQkJfSBlbHNlIGlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGVFWFQoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgkJfQoKCQkvLyBTZXR1cCByZXNvdXJjZXMgZm9yIGEgRGVwdGggVGV4dHVyZSBmb3IgYSBGQk8gKG5lZWRzIGFuIGV4dGVuc2lvbikKCQlmdW5jdGlvbiBzZXR1cERlcHRoVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCApIHsKCgkJCWNvbnN0IGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApOwoJCQlpZiAoIGlzQ3ViZSApIHRocm93IG5ldyBFcnJvciggJ0RlcHRoIFRleHR1cmUgd2l0aCBjdWJlIHJlbmRlciB0YXJnZXRzIGlzIG5vdCBzdXBwb3J0ZWQnICk7CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCWlmICggISAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApICkgewoKCQkJCXRocm93IG5ldyBFcnJvciggJ3JlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBUSFJFRS5EZXB0aFRleHR1cmUnICk7CgoJCQl9CgoJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICk7CgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoKCQkJLy8gdXBsb2FkIGFuIGVtcHR5IGRlcHRoIHRleHR1cmUgd2l0aCBmcmFtZWJ1ZmZlciBzaXplCgkJCWlmICggISB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSB8fAoJCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggIT09IHJlbmRlclRhcmdldC53aWR0aCB8fAoJCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ICE9PSByZW5kZXJUYXJnZXQuaGVpZ2h0ICkgewoKCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggPSByZW5kZXJUYXJnZXQud2lkdGg7CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCXNldFRleHR1cmUyRCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSwgMCApOwoKCQkJY29uc3Qgd2ViZ2xEZXB0aFRleHR1cmUgPSB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZTsKCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhGb3JtYXQgKSB7CgoJCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwLCBzYW1wbGVzICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgewoKCQkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQkJbXVsdGlzYW1wbGVkUlRURXh0LmZyYW1lYnVmZmVyVGV4dHVyZTJETXVsdGlzYW1wbGVFWFQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwLCBzYW1wbGVzICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVW5rbm93biBkZXB0aFRleHR1cmUgZm9ybWF0JyApOwoKCQkJfQoKCQl9CgoJCS8vIFNldHVwIEdMIHJlc291cmNlcyBmb3IgYSBub24tdGV4dHVyZSBkZXB0aCBidWZmZXIKCQlmdW5jdGlvbiBzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKSB7CgoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQljb25zdCBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwoKCQkJLy8gaWYgdGhlIGJvdW5kIGRlcHRoIHRleHR1cmUgaGFzIGNoYW5nZWQKCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmUgIT09IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKSB7CgoJCQkJLy8gZmlyZSB0aGUgZGlzcG9zZSBldmVudCB0byBnZXQgcmlkIG9mIHN0b3JlZCBzdGF0ZSBhc3NvY2lhdGVkIHdpdGggdGhlIHByZXZpb3VzbHkgYm91bmQgZGVwdGggYnVmZmVyCgkJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fZGVwdGhEaXNwb3NlQ2FsbGJhY2sgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19kZXB0aERpc3Bvc2VDYWxsYmFjaygpOwoKCQkJCX0KCgkJCQkvLyBzZXQgdXAgZGlzcG9zZSBsaXN0ZW5lcnMgdG8gdHJhY2sgd2hlbiB0aGUgY3VycmVudGx5IGF0dGFjaGVkIGJ1ZmZlciBpcyBpbXBsaWNpdGx5IHVuYm91bmQKCQkJCWlmICggZGVwdGhUZXh0dXJlICkgewoKCQkJCQljb25zdCBkaXNwb3NlRXZlbnQgPSAoKSA9PiB7CgoJCQkJCQlkZWxldGUgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2JvdW5kRGVwdGhUZXh0dXJlOwoJCQkJCQlkZWxldGUgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrOwoJCQkJCQlkZXB0aFRleHR1cmUucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlRXZlbnQgKTsKCgkJCQkJfTsKCgkJCQkJZGVwdGhUZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgZGlzcG9zZUV2ZW50ICk7CgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrID0gZGlzcG9zZUV2ZW50OwoKCQkJCX0KCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmUgPSBkZXB0aFRleHR1cmU7CgoJCQl9CgoJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgISByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYXV0b0FsbG9jYXRlRGVwdGhCdWZmZXIgKSB7CgoJCQkJaWYgKCBpc0N1YmUgKSB0aHJvdyBuZXcgRXJyb3IoICd0YXJnZXQuZGVwdGhUZXh0dXJlIG5vdCBzdXBwb3J0ZWQgaW4gQ3ViZSByZW5kZXIgdGFyZ2V0cycgKTsKCgkJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCgkJCQlpZiAoIG1pcG1hcHMgJiYgbWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCQlzZXR1cERlcHRoVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSwgcmVuZGVyVGFyZ2V0ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc2V0dXBEZXB0aFRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggaXNDdWJlICkgewoKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9IFtdOwoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gKTsKCgkJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJCQlzZXR1cFJlbmRlckJ1ZmZlclN0b3JhZ2UoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJLy8gYXR0YWNoIGJ1ZmZlciBpZiBpdCdzIGJlZW4gY3JlYXRlZCBhbHJlYWR5CgkJCQkJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgkJCQkJCQljb25zdCByZW5kZXJidWZmZXIgPSByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdOwoJCQkJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGdsQXR0YWNobWVudFR5cGUsIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc3QgbWlwbWFwcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlLm1pcG1hcHM7CgoJCQkJCWlmICggbWlwbWFwcyAmJiBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJCX0KCgkJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIsIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGF0dGFjaCBidWZmZXIgaWYgaXQncyBiZWVuIGNyZWF0ZWQgYWxyZWFkeQoJCQkJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgkJCQkJCWNvbnN0IHJlbmRlcmJ1ZmZlciA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyOwoJCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgkJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBnbEF0dGFjaG1lbnRUeXBlLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgoJCX0KCgkJLy8gcmViaW5kIGZyYW1lYnVmZmVyIHdpdGggZXh0ZXJuYWwgdGV4dHVyZXMKCQlmdW5jdGlvbiByZWJpbmRUZXh0dXJlcyggcmVuZGVyVGFyZ2V0LCBjb2xvclRleHR1cmUsIGRlcHRoVGV4dHVyZSApIHsKCgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQlpZiAoIGNvbG9yVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCByZW5kZXJUYXJnZXQudGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKCQkJfQoKCQkJaWYgKCBkZXB0aFRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCgkJCX0KCgkJfQoKCQkvLyBTZXQgdXAgR0wgcmVzb3VyY2VzIGZvciB0aGUgcmVuZGVyIHRhcmdldAoJCWZ1bmN0aW9uIHNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlyZW5kZXJUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblJlbmRlclRhcmdldERpc3Bvc2UgKTsKCgkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKCQkJY29uc3QgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKCQkJY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSAoIHRleHR1cmVzLmxlbmd0aCA+IDEgKTsKCgkJCWlmICggISBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKCgkJCQl9CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgoJCQl9CgoJCQkvLyBTZXR1cCBmcmFtZWJ1ZmZlcgoKCQkJaWYgKCBpc0N1YmUgKSB7CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gPSBbXTsKCgkJCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsgbGV2ZWwgKysgKSB7CgoJCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBsZXZlbCBdID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCX0KCgkJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgoJCQkJCQlpZiAoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzICsrOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggKCByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlciA9IFtdOwoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgoJCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKCQkJCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCQkJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgcmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKCQkJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoJCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCX0KCgkJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgoJCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKCQkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0cnVlICk7CgoJCQkJCX0KCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBTZXR1cCBjb2xvciBidWZmZXIKCgkJCWlmICggaXNDdWJlICkgewoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZSApOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCWlmICggdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBsZXZlbCApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgoJCQkJCWdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCApOwoKCQkJCX0KCgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9IGVsc2UgaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGF0dGFjaG1lbnQgPSB0ZXh0dXJlc1sgaSBdOwoJCQkJCWNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGF0dGFjaG1lbnQgKTsKCgkJCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJELCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV8yRCwgYXR0YWNobWVudCApOwoJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBhdHRhY2htZW50LCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKCQkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggYXR0YWNobWVudCApICkgewoKCQkJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFXzJEICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQkJfSBlbHNlIHsKCgkJCQlsZXQgZ2xUZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzJEOwoKCQkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCB8fCByZW5kZXJUYXJnZXQuaXNXZWJHTEFycmF5UmVuZGVyVGFyZ2V0ICkgewoKCQkJCQlnbFRleHR1cmVUeXBlID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCA/IF9nbC5URVhUVVJFXzNEIDogX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgoJCQkJfQoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCBnbFRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIGdsVGV4dHVyZVR5cGUsIHRleHR1cmUgKTsKCgkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsVGV4dHVyZVR5cGUsIGxldmVsICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbFRleHR1cmVUeXBlLCAwICk7CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgoJCQkJCWdlbmVyYXRlTWlwbWFwKCBnbFRleHR1cmVUeXBlICk7CgoJCQkJfQoKCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCX0KCgkJCS8vIFNldHVwIGRlcHRoIGFuZCBzdGVuY2lsIGJ1ZmZlcnMKCgkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKCQkJCXNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggcmVuZGVyVGFyZ2V0ICkgewoKCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgoJCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCgkJCQkJY29uc3QgdGFyZ2V0VHlwZSA9IGdldFRhcmdldFR5cGUoIHJlbmRlclRhcmdldCApOwoJCQkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX193ZWJnbFRleHR1cmU7CgoJCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCB0YXJnZXRUeXBlLCB3ZWJnbFRleHR1cmUgKTsKCQkJCQlnZW5lcmF0ZU1pcG1hcCggdGFyZ2V0VHlwZSApOwoJCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJY29uc3QgaW52YWxpZGF0aW9uQXJyYXlSZWFkID0gW107CgkJY29uc3QgaW52YWxpZGF0aW9uQXJyYXlEcmF3ID0gW107CgoJCWZ1bmN0aW9uIHVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApIHsKCgkJCQlpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKCQkJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCQkJCQljb25zdCB3aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKCQkJCQljb25zdCBoZWlnaHQgPSByZW5kZXJUYXJnZXQuaGVpZ2h0OwoJCQkJCWxldCBtYXNrID0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CgkJCQkJY29uc3QgZGVwdGhTdHlsZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwoJCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJCQkJY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSAoIHRleHR1cmVzLmxlbmd0aCA+IDEgKTsKCgkJCQkJLy8gSWYgTVJUIHdlIG5lZWQgdG8gcmVtb3ZlIEZCTyBhdHRhY2htZW50cwoJCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgkJCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlJFTkRFUkJVRkZFUiwgbnVsbCApOwoKCQkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIG51bGwsIDAgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKCQkJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCgkJCQkJaWYgKCBtaXBtYXBzICYmIG1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyAwIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQucmVzb2x2ZURlcHRoQnVmZmVyICkgewoKCQkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgbWFzayB8PSBfZ2wuREVQVEhfQlVGRkVSX0JJVDsKCgkJCQkJCQkvLyByZXNvbHZpbmcgc3RlbmNpbCBpcyBzbG93IHdpdGggYSBEM0QgYmFja2VuZC4gZGlzYWJsZSBpdCBmb3IgYWxsIHRyYW5zbWlzc2lvbiByZW5kZXIgdGFyZ2V0cyAoc2VlICMyNzc5OSkKCgkJCQkJCQlpZiAoIHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyICYmIHJlbmRlclRhcmdldC5yZXNvbHZlU3RlbmNpbEJ1ZmZlciApIG1hc2sgfD0gX2dsLlNURU5DSUxfQlVGRkVSX0JJVDsKCgkJCQkJCX0KCgkJCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmVzWyBpIF0gKS5fX3dlYmdsVGV4dHVyZTsKCQkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKCQkJCQkJfQoKCQkJCQkJX2dsLmJsaXRGcmFtZWJ1ZmZlciggMCwgMCwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCwgbWFzaywgX2dsLk5FQVJFU1QgKTsKCgkJCQkJCWlmICggc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgPT09IHRydWUgKSB7CgoJCQkJCQkJaW52YWxpZGF0aW9uQXJyYXlSZWFkLmxlbmd0aCA9IDA7CgkJCQkJCQlpbnZhbGlkYXRpb25BcnJheURyYXcubGVuZ3RoID0gMDsKCgkJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQucHVzaCggX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSApOwoKCQkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICYmIHJlbmRlclRhcmdldC5yZXNvbHZlRGVwdGhCdWZmZXIgPT09IGZhbHNlICkgewoKCQkJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQucHVzaCggZGVwdGhTdHlsZSApOwoJCQkJCQkJCWludmFsaWRhdGlvbkFycmF5RHJhdy5wdXNoKCBkZXB0aFN0eWxlICk7CgoJCQkJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBpbnZhbGlkYXRpb25BcnJheURyYXcgKTsKCgkJCQkJCQl9CgoJCQkJCQkJX2dsLmludmFsaWRhdGVGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIGludmFsaWRhdGlvbkFycmF5UmVhZCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgoJCQkJCS8vIElmIE1SVCBzaW5jZSBwcmUtYmxpdCB3ZSByZW1vdmVkIHRoZSBGQk8gd2UgbmVlZCB0byByZWNvbnN0cnVjdCB0aGUgYXR0YWNobWVudHMKCQkJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCgkJCQkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApLl9fd2ViZ2xUZXh0dXJlOwoKCQkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgJiYgc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgKSB7CgoJCQkJCQljb25zdCBkZXB0aFN0eWxlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgoJCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgWyBkZXB0aFN0eWxlIF0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKSB7CgoJCQlyZXR1cm4gTWF0aC5taW4oIGNhcGFiaWxpdGllcy5tYXhTYW1wbGVzLCByZW5kZXJUYXJnZXQuc2FtcGxlcyApOwoKCQl9CgoJCWZ1bmN0aW9uIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgewoKCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJCXJldHVybiByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgJiYgZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IHRydWUgJiYgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZVJlbmRlclRvVGV4dHVyZSAhPT0gZmFsc2U7CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlVmlkZW9UZXh0dXJlKCB0ZXh0dXJlICkgewoKCQkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJCS8vIENoZWNrIHRoZSBsYXN0IGZyYW1lIHdlIHVwZGF0ZWQgdGhlIFZpZGVvVGV4dHVyZQoKCQkJaWYgKCBfdmlkZW9UZXh0dXJlcy5nZXQoIHRleHR1cmUgKSAhPT0gZnJhbWUgKSB7CgoJCQkJX3ZpZGVvVGV4dHVyZXMuc2V0KCB0ZXh0dXJlLCBmcmFtZSApOwoJCQkJdGV4dHVyZS51cGRhdGUoKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiB2ZXJpZnlDb2xvclNwYWNlKCB0ZXh0dXJlLCBpbWFnZSApIHsKCgkJCWNvbnN0IGNvbG9yU3BhY2UgPSB0ZXh0dXJlLmNvbG9yU3BhY2U7CgkJCWNvbnN0IGZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwoJCQljb25zdCB0eXBlID0gdGV4dHVyZS50eXBlOwoKCQkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgPT09IHRydWUgfHwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApIHJldHVybiBpbWFnZTsKCgkJCWlmICggY29sb3JTcGFjZSAhPT0gTGluZWFyU1JHQkNvbG9yU3BhY2UgJiYgY29sb3JTcGFjZSAhPT0gTm9Db2xvclNwYWNlICkgewoKCQkJCS8vIHNSR0IKCgkJCQlpZiAoIENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSB7CgoJCQkJCS8vIGluIFdlYkdMIDIgdW5jb21wcmVzc2VkIHRleHR1cmVzIGNhbiBvbmx5IGJlIHNSR0IgZW5jb2RlZCBpZiB0aGV5IGhhdmUgdGhlIFJHQkE4IGZvcm1hdAoKCQkJCQlpZiAoIGZvcm1hdCAhPT0gUkdCQUZvcm1hdCB8fCB0eXBlICE9PSBVbnNpZ25lZEJ5dGVUeXBlICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogc1JHQiBlbmNvZGVkIHRleHR1cmVzIGhhdmUgdG8gdXNlIFJHQkFGb3JtYXQgYW5kIFVuc2lnbmVkQnl0ZVR5cGUuJyApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMVGV4dHVyZXM6IFVuc3VwcG9ydGVkIHRleHR1cmUgY29sb3Igc3BhY2U6JywgY29sb3JTcGFjZSApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBpbWFnZTsKCgkJfQoKCQlmdW5jdGlvbiBnZXREaW1lbnNpb25zKCBpbWFnZSApIHsKCgkJCWlmICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHsKCgkJCQkvLyBpZiBpbnRyaW5zaWMgZGF0YSBhcmUgbm90IGF2YWlsYWJsZSwgZmFsbGJhY2sgdG8gd2lkdGgvaGVpZ2h0CgoJCQkJX2ltYWdlRGltZW5zaW9ucy53aWR0aCA9IGltYWdlLm5hdHVyYWxXaWR0aCB8fCBpbWFnZS53aWR0aDsKCQkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UubmF0dXJhbEhlaWdodCB8fCBpbWFnZS5oZWlnaHQ7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgVmlkZW9GcmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lICkgewoKCQkJCV9pbWFnZURpbWVuc2lvbnMud2lkdGggPSBpbWFnZS5kaXNwbGF5V2lkdGg7CgkJCQlfaW1hZ2VEaW1lbnNpb25zLmhlaWdodCA9IGltYWdlLmRpc3BsYXlIZWlnaHQ7CgoJCQl9IGVsc2UgewoKCQkJCV9pbWFnZURpbWVuc2lvbnMud2lkdGggPSBpbWFnZS53aWR0aDsKCQkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJfQoKCQkJcmV0dXJuIF9pbWFnZURpbWVuc2lvbnM7CgoJCX0KCgkJLy8KCgkJdGhpcy5hbGxvY2F0ZVRleHR1cmVVbml0ID0gYWxsb2NhdGVUZXh0dXJlVW5pdDsKCQl0aGlzLnJlc2V0VGV4dHVyZVVuaXRzID0gcmVzZXRUZXh0dXJlVW5pdHM7CgoJCXRoaXMuc2V0VGV4dHVyZTJEID0gc2V0VGV4dHVyZTJEOwoJCXRoaXMuc2V0VGV4dHVyZTJEQXJyYXkgPSBzZXRUZXh0dXJlMkRBcnJheTsKCQl0aGlzLnNldFRleHR1cmUzRCA9IHNldFRleHR1cmUzRDsKCQl0aGlzLnNldFRleHR1cmVDdWJlID0gc2V0VGV4dHVyZUN1YmU7CgkJdGhpcy5yZWJpbmRUZXh0dXJlcyA9IHJlYmluZFRleHR1cmVzOwoJCXRoaXMuc2V0dXBSZW5kZXJUYXJnZXQgPSBzZXR1cFJlbmRlclRhcmdldDsKCQl0aGlzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCA9IHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcDsKCQl0aGlzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ7CgkJdGhpcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyID0gc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlcjsKCQl0aGlzLnNldHVwRnJhbWVCdWZmZXJUZXh0dXJlID0gc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmU7CgkJdGhpcy51c2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQ7CgoJfQoKCWZ1bmN0aW9uIFdlYkdMVXRpbHMoIGdsLCBleHRlbnNpb25zICkgewoKCQlmdW5jdGlvbiBjb252ZXJ0KCBwLCBjb2xvclNwYWNlID0gTm9Db2xvclNwYWNlICkgewoKCQkJbGV0IGV4dGVuc2lvbjsKCgkJCWNvbnN0IHRyYW5zZmVyID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgoJCQlpZiAoIHAgPT09IFVuc2lnbmVkQnl0ZVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfQllURTsKCQkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NDQ0NFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNF80XzRfNDsKCQkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMTsKCQkJaWYgKCBwID09PSBVbnNpZ25lZEludDU5OTlUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVF81XzlfOV85X1JFVjsKCgkJCWlmICggcCA9PT0gQnl0ZVR5cGUgKSByZXR1cm4gZ2wuQllURTsKCQkJaWYgKCBwID09PSBTaG9ydFR5cGUgKSByZXR1cm4gZ2wuU0hPUlQ7CgkJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlQ7CgkJCWlmICggcCA9PT0gSW50VHlwZSApIHJldHVybiBnbC5JTlQ7CgkJCWlmICggcCA9PT0gVW5zaWduZWRJbnRUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVDsKCQkJaWYgKCBwID09PSBGbG9hdFR5cGUgKSByZXR1cm4gZ2wuRkxPQVQ7CgkJCWlmICggcCA9PT0gSGFsZkZsb2F0VHlwZSApIHJldHVybiBnbC5IQUxGX0ZMT0FUOwoKCQkJaWYgKCBwID09PSBBbHBoYUZvcm1hdCApIHJldHVybiBnbC5BTFBIQTsKCQkJaWYgKCBwID09PSBSR0JGb3JtYXQgKSByZXR1cm4gZ2wuUkdCOwoJCQlpZiAoIHAgPT09IFJHQkFGb3JtYXQgKSByZXR1cm4gZ2wuUkdCQTsKCQkJaWYgKCBwID09PSBEZXB0aEZvcm1hdCApIHJldHVybiBnbC5ERVBUSF9DT01QT05FTlQ7CgkJCWlmICggcCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgcmV0dXJuIGdsLkRFUFRIX1NURU5DSUw7CgoJCQkvLyBXZWJHTDIgZm9ybWF0cy4KCgkJCWlmICggcCA9PT0gUmVkRm9ybWF0ICkgcmV0dXJuIGdsLlJFRDsKCQkJaWYgKCBwID09PSBSZWRJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJFRF9JTlRFR0VSOwoJCQlpZiAoIHAgPT09IFJHRm9ybWF0ICkgcmV0dXJuIGdsLlJHOwoJCQlpZiAoIHAgPT09IFJHSW50ZWdlckZvcm1hdCApIHJldHVybiBnbC5SR19JTlRFR0VSOwoJCQlpZiAoIHAgPT09IFJHQkFJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJHQkFfSU5URUdFUjsKCgkJCS8vIFMzVEMKCgkJCWlmICggcCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSB7CgoJCQkJaWYgKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2InICk7CgoJCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX1MzVENfRFhUMV9FWFQ7CgkJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfQUxQSEFfUzNUQ19EWFQxX0VYVDsKCQkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUM19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9TM1RDX0RYVDNfRVhUOwoJCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX1MzVENfRFhUNV9FWFQ7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICk7CgoJCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUzNUQ19EWFQxX0VYVDsKCQkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDFfRVhUOwoJCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUM19FWFQ7CgkJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQ1X0VYVDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXJldHVybiBudWxsOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gUFZSVEMKCgkJCWlmICggcCA9PT0gUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUFZSVENfNEJQUFYxX0lNRzsKCQkJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ18yQlBQVjFfSU1HOwoJCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfNEJQUFYxX0lNRzsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1BWUlRDXzJCUFBWMV9JTUc7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQkJLy8gRVRDCgoJCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCB8fCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfZXRjJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCB8fCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9FVEMyIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCOF9FVEMyOwoJCQkJCWlmICggcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfRVRDMl9FQUMgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBOF9FVEMyX0VBQzsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQl9CgoJCQkvLyBBU1RDCgoJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ181eDRfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ181eDVfRm9ybWF0IHx8CgkJCQlwID09PSBSR0JBX0FTVENfNng1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCB8fAoJCQkJcCA9PT0gUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDVfRm9ybWF0IHx8CgkJCQlwID09PSBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgfHwKCQkJCXAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNHg0X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ180eDRfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ181eDRfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzV4NF9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNXg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzV4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNXg1X0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ182eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNng1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ182eDVfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ182eDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzZ4Nl9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzh4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfOHg1X0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ184eDZfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfOHg2X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ184eDZfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ184eDhfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzh4OF9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHg1X0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDZfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4OF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4OF9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4MTBfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDEwX0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMngxMF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTJ4MTBfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEyeDEyX0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMngxMl9LSFI7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQkJLy8gQlBUQwoKCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0IHx8IHAgPT09IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgfHwgcCA9PT0gUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ICkgewoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fYnB0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9CUFRDX1VOT1JNX0VYVCA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQlBUQ19VTk9STV9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19TSUdORURfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9CUFRDX1NJR05FRF9GTE9BVF9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0JQVENfVU5TSUdORURfRkxPQVRfRVhUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJldHVybiBudWxsOwoKCQkJCX0KCgkJCX0KCgkJCS8vIFJHVEMKCgkJCWlmICggcCA9PT0gUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0IHx8IHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgewoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fcmd0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JFRF9SR1RDMV9FWFQ7CgkJCQkJaWYgKCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TSUdORURfUkVEX1JHVEMxX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkVEX0dSRUVOX1JHVEMyX0VYVDsKCQkJCQlpZiAoIHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NJR05FRF9SRURfR1JFRU5fUkdUQzJfRVhUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJldHVybiBudWxsOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9JTlRfMjRfODsKCgkJCS8vIGlmICJwIiBjYW4ndCBiZSByZXNvbHZlZCwgYXNzdW1lIHRoZSB1c2VyIGRlZmluZXMgYSBXZWJHTCBjb25zdGFudCBhcyBhIHN0cmluZyAoZmFsbGJhY2svd29ya2Fyb3VuZCBmb3IgcGFja2VkIFJHQiBmb3JtYXRzKQoKCQkJcmV0dXJuICggZ2xbIHAgXSAhPT0gdW5kZWZpbmVkICkgPyBnbFsgcCBdIDogbnVsbDsKCgkJfQoKCQlyZXR1cm4geyBjb252ZXJ0OiBjb252ZXJ0IH07CgoJfQoKCWNvbnN0IF9vY2NsdXNpb25fdmVydGV4ID0gYAp2b2lkIG1haW4oKSB7CgoJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7Cgp9YDsKCgljb25zdCBfb2NjbHVzaW9uX2ZyYWdtZW50ID0gYAp1bmlmb3JtIHNhbXBsZXIyREFycmF5IGRlcHRoQ29sb3I7CnVuaWZvcm0gZmxvYXQgZGVwdGhXaWR0aDsKdW5pZm9ybSBmbG9hdCBkZXB0aEhlaWdodDsKCnZvaWQgbWFpbigpIHsKCgl2ZWMyIGNvb3JkID0gdmVjMiggZ2xfRnJhZ0Nvb3JkLnggLyBkZXB0aFdpZHRoLCBnbF9GcmFnQ29vcmQueSAvIGRlcHRoSGVpZ2h0ICk7CgoJaWYgKCBjb29yZC54ID49IDEuMCApIHsKCgkJZ2xfRnJhZ0RlcHRoID0gdGV4dHVyZSggZGVwdGhDb2xvciwgdmVjMyggY29vcmQueCAtIDEuMCwgY29vcmQueSwgMSApICkucjsKCgl9IGVsc2UgewoKCQlnbF9GcmFnRGVwdGggPSB0ZXh0dXJlKCBkZXB0aENvbG9yLCB2ZWMzKCBjb29yZC54LCBjb29yZC55LCAwICkgKS5yOwoKCX0KCn1gOwoKCS8qKgoJICogQSBYUiBtb2R1bGUgdGhhdCBtYW5hZ2VzIHRoZSBhY2Nlc3MgdG8gdGhlIERlcHRoIFNlbnNpbmcgQVBJLgoJICovCgljbGFzcyBXZWJYUkRlcHRoU2Vuc2luZyB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZGVwdGggc2Vuc2luZyBtb2R1bGUuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQkvKioKCQkJICogQSB0ZXh0dXJlIHJlcHJlc2VudGluZyB0aGUgZGVwdGggb2YgdGhlIHVzZXIncyBlbnZpcm9ubWVudC4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKi8KCQkJdGhpcy50ZXh0dXJlID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBBIHBsYW5lIG1lc2ggZm9yIHZpc3VhbGl6aW5nIHRoZSBkZXB0aCB0ZXh0dXJlLgoJCQkgKgoJCQkgKiBAdHlwZSB7P01lc2h9CgkJCSAqLwoJCQl0aGlzLm1lc2ggPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBkZXB0aCBuZWFyIHZhbHVlLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy5kZXB0aE5lYXIgPSAwOwoKCQkJLyoqCgkJCSAqIFRoZSBkZXB0aCBuZWFyIGZhci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMuZGVwdGhGYXIgPSAwOwoKCQl9CgoJCS8qKgoJCSAqIEluaXRzIHRoZSBkZXB0aCBzZW5zaW5nIG1vZHVsZQoJCSAqCgkJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KCQkgKiBAcGFyYW0ge1hSV2ViR0xEZXB0aEluZm9ybWF0aW9ufSBkZXB0aERhdGEgLSBUaGUgWFIgZGVwdGggZGF0YS4KCQkgKiBAcGFyYW0ge1hSUmVuZGVyU3RhdGV9IHJlbmRlclN0YXRlIC0gVGhlIFhSIHJlbmRlciBzdGF0ZS4KCQkgKi8KCQlpbml0KCByZW5kZXJlciwgZGVwdGhEYXRhLCByZW5kZXJTdGF0ZSApIHsKCgkJCWlmICggdGhpcy50ZXh0dXJlID09PSBudWxsICkgewoKCQkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQkJCWNvbnN0IHRleFByb3BzID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCQkJCXRleFByb3BzLl9fd2ViZ2xUZXh0dXJlID0gZGVwdGhEYXRhLnRleHR1cmU7CgoJCQkJaWYgKCAoIGRlcHRoRGF0YS5kZXB0aE5lYXIgIT09IHJlbmRlclN0YXRlLmRlcHRoTmVhciApIHx8ICggZGVwdGhEYXRhLmRlcHRoRmFyICE9PSByZW5kZXJTdGF0ZS5kZXB0aEZhciApICkgewoKCQkJCQl0aGlzLmRlcHRoTmVhciA9IGRlcHRoRGF0YS5kZXB0aE5lYXI7CgkJCQkJdGhpcy5kZXB0aEZhciA9IGRlcHRoRGF0YS5kZXB0aEZhcjsKCgkJCQl9CgoJCQkJdGhpcy50ZXh0dXJlID0gdGV4dHVyZTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgcGxhbmUgbWVzaCB0aGF0IHZpc3VhbGl6ZXMgdGhlIGRlcHRoIHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5Q2FtZXJhfSBjYW1lcmFYUiAtIFRoZSBYUiBjYW1lcmEuCgkJICogQHJldHVybiB7P01lc2h9IFRoZSBwbGFuZSBtZXNoLgoJCSAqLwoJCWdldE1lc2goIGNhbWVyYVhSICkgewoKCQkJaWYgKCB0aGlzLnRleHR1cmUgIT09IG51bGwgKSB7CgoJCQkJaWYgKCB0aGlzLm1lc2ggPT09IG51bGwgKSB7CgoJCQkJCWNvbnN0IHZpZXdwb3J0ID0gY2FtZXJhWFIuY2FtZXJhc1sgMCBdLnZpZXdwb3J0OwoJCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgkJCQkJCXZlcnRleFNoYWRlcjogX29jY2x1c2lvbl92ZXJ0ZXgsCgkJCQkJCWZyYWdtZW50U2hhZGVyOiBfb2NjbHVzaW9uX2ZyYWdtZW50LAoJCQkJCQl1bmlmb3JtczogewoJCQkJCQkJZGVwdGhDb2xvcjogeyB2YWx1ZTogdGhpcy50ZXh0dXJlIH0sCgkJCQkJCQlkZXB0aFdpZHRoOiB7IHZhbHVlOiB2aWV3cG9ydC56IH0sCgkJCQkJCQlkZXB0aEhlaWdodDogeyB2YWx1ZTogdmlld3BvcnQudyB9CgkJCQkJCX0KCQkJCQl9ICk7CgoJCQkJCXRoaXMubWVzaCA9IG5ldyBNZXNoKCBuZXcgUGxhbmVHZW9tZXRyeSggMjAsIDIwICksIG1hdGVyaWFsICk7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRoaXMubWVzaDsKCgkJfQoKCQkvKioKCQkgKiBSZXNldHMgdGhlIG1vZHVsZQoJCSAqLwoJCXJlc2V0KCkgewoKCQkJdGhpcy50ZXh0dXJlID0gbnVsbDsKCQkJdGhpcy5tZXNoID0gbnVsbDsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgdGV4dHVyZSByZXByZXNlbnRpbmcgdGhlIGRlcHRoIG9mIHRoZSB1c2VyJ3MgZW52aXJvbm1lbnQuCgkJICoKCQkgKiBAcmV0dXJuIHs/VGV4dHVyZX0gVGhlIGRlcHRoIHRleHR1cmUuCgkJICovCgkJZ2V0RGVwdGhUZXh0dXJlKCkgewoKCQkJcmV0dXJuIHRoaXMudGV4dHVyZTsKCgkJfQoKCX0KCgkvKioKCSAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyBhbiBhYnN0cmFjdGlvbiBvZiB0aGUgV2ViWFIgRGV2aWNlIEFQSSBhbmQgaXMKCSAqIGludGVybmFsbHkgdXNlZCBieSB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uIGBXZWJYUk1hbmFnZXJgIGFsc28gcHJvdmlkZXMgYSBwdWJsaWMKCSAqIGludGVyZmFjZSB0aGF0IGFsbG93cyB1c2VycyB0byBlbmFibGUvZGlzYWJsZSBYUiBhbmQgcGVyZm9ybSBYUiByZWxhdGVkCgkgKiB0YXNrcyBsaWtlIGZvciBpbnN0YW5jZSByZXRyaWV2aW5nIGNvbnRyb2xsZXJzLgoJICoKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqIEBoaWRlY29uc3RydWN0b3IKCSAqLwoJY2xhc3MgV2ViWFJNYW5hZ2VyIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBXZWJHTCByZW5kZXJlci4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtXZWJHTDJSZW5kZXJpbmdDb250ZXh0fSBnbCAtIFRoZSByZW5kZXJpbmcgY29udGV4dC4KCQkgKi8KCQljb25zdHJ1Y3RvciggcmVuZGVyZXIsIGdsICkgewoKCQkJc3VwZXIoKTsKCgkJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJCWxldCBzZXNzaW9uID0gbnVsbDsKCgkJCWxldCBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gMS4wOwoKCQkJbGV0IHJlZmVyZW5jZVNwYWNlID0gbnVsbDsKCQkJbGV0IHJlZmVyZW5jZVNwYWNlVHlwZSA9ICdsb2NhbC1mbG9vcic7CgkJCS8vIFNldCBkZWZhdWx0IGZvdmVhdGlvbiB0byBtYXhpbXVtLgoJCQlsZXQgZm92ZWF0aW9uID0gMS4wOwoJCQlsZXQgY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwoKCQkJbGV0IHBvc2UgPSBudWxsOwoJCQlsZXQgZ2xCaW5kaW5nID0gbnVsbDsKCQkJbGV0IGdsUHJvakxheWVyID0gbnVsbDsKCQkJbGV0IGdsQmFzZUxheWVyID0gbnVsbDsKCQkJbGV0IHhyRnJhbWUgPSBudWxsOwoKCQkJY29uc3QgZGVwdGhTZW5zaW5nID0gbmV3IFdlYlhSRGVwdGhTZW5zaW5nKCk7CgkJCWNvbnN0IGF0dHJpYnV0ZXMgPSBnbC5nZXRDb250ZXh0QXR0cmlidXRlcygpOwoKCQkJbGV0IGluaXRpYWxSZW5kZXJUYXJnZXQgPSBudWxsOwoJCQlsZXQgbmV3UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCWNvbnN0IGNvbnRyb2xsZXJzID0gW107CgkJCWNvbnN0IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMgPSBbXTsKCgkJCWNvbnN0IGN1cnJlbnRTaXplID0gbmV3IFZlY3RvcjIoKTsKCQkJbGV0IGN1cnJlbnRQaXhlbFJhdGlvID0gbnVsbDsKCgkJCS8vCgoJCQljb25zdCBjYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJCWNhbWVyYUwudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKCQkJY29uc3QgY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCQljYW1lcmFSLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKCgkJCWNvbnN0IGNhbWVyYXMgPSBbIGNhbWVyYUwsIGNhbWVyYVIgXTsKCgkJCWNvbnN0IGNhbWVyYVhSID0gbmV3IEFycmF5Q2FtZXJhKCk7CgoJCQlsZXQgX2N1cnJlbnREZXB0aE5lYXIgPSBudWxsOwoJCQlsZXQgX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CgoJCQkvLwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdGhlIG1hbmFnZXIncyBYUiBjYW1lcmEgc2hvdWxkIGJlIGF1dG9tYXRpY2FsbHkgdXBkYXRlZCBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmNhbWVyYUF1dG9VcGRhdGUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBub3RpZmllcyB0aGUgcmVuZGVyZXIgdG8gYmUgcmVhZHkgZm9yIFhSIHJlbmRlcmluZy4gU2V0IGl0IHRvIGB0cnVlYAoJCQkgKiBpZiB5b3UgYXJlIGdvaW5nIHRvIHVzZSBYUiBpbiB5b3VyIGFwcC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIFhSIHByZXNlbnRhdGlvbiBpcyBhY3RpdmUgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGB0YXJnZXQgcmF5YCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkJICogVXNlIHRoaXMgc3BhY2UgZm9yIHZpc3VhbGl6aW5nIDNEIG9iamVjdHMgdGhhdCBzdXBwb3J0IHRoZSB1c2VyIGluIHBvaW50aW5nCgkJCSAqIHRhc2tzIGxpa2UgVUkgaW50ZXJhY3Rpb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgY29udHJvbGxlci4KCQkJICogQHJldHVybiB7R3JvdXB9IEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgdGFyZ2V0IHJheWAgc3BhY2UuCgkJCSAqLwoJCQl0aGlzLmdldENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgoJCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CgkJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKCQkJCX0KCgkJCQlyZXR1cm4gY29udHJvbGxlci5nZXRUYXJnZXRSYXlTcGFjZSgpOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgZ3JpcGAgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCgkJCSAqIFVzZSB0aGlzIHNwYWNlIGZvciB2aXN1YWxpemluZyAzRCBvYmplY3RzIHRoYXQgc3VwcG9ydCB0aGUgdXNlciBpbiBwb2ludGluZwoJCQkgKiB0YXNrcyBsaWtlIFVJIGludGVyYWN0aW9uLgoJCQkgKgoJCQkgKiBOb3RlOiBJZiB5b3Ugd2FudCB0byBzaG93IHNvbWV0aGluZyBpbiB0aGUgdXNlcidzIGhhbmQgQU5EIG9mZmVyIGEKCQkJICogcG9pbnRpbmcgcmF5IGF0IHRoZSBzYW1lIHRpbWUsIHlvdSdsbCB3YW50IHRvIGF0dGFjaGVkIHRoZSBoYW5kaGVsZCBvYmplY3QKCQkJICogdG8gdGhlIGdyb3VwIHJldHVybmVkIGJ5IGBnZXRDb250cm9sbGVyR3JpcCgpYCBhbmQgdGhlIHJheSB0byB0aGUKCQkJICogZ3JvdXAgcmV0dXJuZWQgYnkgYGdldENvbnRyb2xsZXIoKWAuIFRoZSBpZGVhIGlzIHRvIGhhdmUgdHdvCgkJCSAqIGRpZmZlcmVudCBncm91cHMgaW4gdHdvIGRpZmZlcmVudCBjb29yZGluYXRlIHNwYWNlcyBmb3IgdGhlIHNhbWUgV2ViWFIKCQkJICogY29udHJvbGxlci4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgoJCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBncmlwYCBzcGFjZS4KCQkJICovCgkJCXRoaXMuZ2V0Q29udHJvbGxlckdyaXAgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgoJCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CgkJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKCQkJCX0KCgkJCQlyZXR1cm4gY29udHJvbGxlci5nZXRHcmlwU3BhY2UoKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgYGhhbmRgIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCQkgKiBVc2UgdGhpcyBzcGFjZSBmb3IgdmlzdWFsaXppbmcgM0Qgb2JqZWN0cyB0aGF0IHN1cHBvcnQgdGhlIHVzZXIgaW4gcG9pbnRpbmcKCQkJICogdGFza3MgbGlrZSBVSSBpbnRlcmFjdGlvbi4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgoJCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBoYW5kYCBzcGFjZS4KCQkJICovCgkJCXRoaXMuZ2V0SGFuZCA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCgkJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKCQkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgoJCQkJfQoKCQkJCXJldHVybiBjb250cm9sbGVyLmdldEhhbmRTcGFjZSgpOwoKCQkJfTsKCgkJCS8vCgoJCQlmdW5jdGlvbiBvblNlc3Npb25FdmVudCggZXZlbnQgKSB7CgoJCQkJY29uc3QgY29udHJvbGxlckluZGV4ID0gY29udHJvbGxlcklucHV0U291cmNlcy5pbmRleE9mKCBldmVudC5pbnB1dFNvdXJjZSApOwoKCQkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtMSApIHsKCgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQljb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGNvbnRyb2xsZXJJbmRleCBdOwoKCQkJCWlmICggY29udHJvbGxlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljb250cm9sbGVyLnVwZGF0ZSggZXZlbnQuaW5wdXRTb3VyY2UsIGV2ZW50LmZyYW1lLCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwoJCQkJCWNvbnRyb2xsZXIuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiBldmVudC50eXBlLCBkYXRhOiBldmVudC5pbnB1dFNvdXJjZSB9ICk7CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gb25TZXNzaW9uRW5kKCkgewoKCQkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZScsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzcXVlZXplc3RhcnQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZWVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdlbmQnLCBvblNlc3Npb25FbmQgKTsKCQkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIG9uSW5wdXRTb3VyY2VzQ2hhbmdlICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKCQkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXTsKCgkJCQkJaWYgKCBpbnB1dFNvdXJjZSA9PT0gbnVsbCApIGNvbnRpbnVlOwoKCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBudWxsOwoKCQkJCQljb250cm9sbGVyc1sgaSBdLmRpc2Nvbm5lY3QoIGlucHV0U291cmNlICk7CgoJCQkJfQoKCQkJCV9jdXJyZW50RGVwdGhOZWFyID0gbnVsbDsKCQkJCV9jdXJyZW50RGVwdGhGYXIgPSBudWxsOwoKCQkJCWRlcHRoU2Vuc2luZy5yZXNldCgpOwoKCQkJCS8vIHJlc3RvcmUgZnJhbWVidWZmZXIvcmVuZGVyaW5nIHN0YXRlCgoJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBpbml0aWFsUmVuZGVyVGFyZ2V0ICk7CgoJCQkJZ2xCYXNlTGF5ZXIgPSBudWxsOwoJCQkJZ2xQcm9qTGF5ZXIgPSBudWxsOwoJCQkJZ2xCaW5kaW5nID0gbnVsbDsKCQkJCXNlc3Npb24gPSBudWxsOwoJCQkJbmV3UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCQkvLwoKCQkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCQkJc2NvcGUuaXNQcmVzZW50aW5nID0gZmFsc2U7CgoJCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggY3VycmVudFBpeGVsUmF0aW8gKTsKCQkJCXJlbmRlcmVyLnNldFNpemUoIGN1cnJlbnRTaXplLndpZHRoLCBjdXJyZW50U2l6ZS5oZWlnaHQsIGZhbHNlICk7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc2Vzc2lvbmVuZCcgfSApOwoKCQkJfQoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIGZyYW1lYnVmZmVyIHNjYWxlIGZhY3Rvci4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgY2FuIG5vdCBiZSB1c2VkIGR1cmluZyBhIFhSIHNlc3Npb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSBmcmFtZWJ1ZmZlciBzY2FsZSBmYWN0b3IuCgkJCSAqLwoJCQl0aGlzLnNldEZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSB2YWx1ZTsKCgkJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIGZyYW1lYnVmZmVyIHNjYWxlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgcmVmZXJlbmNlIHNwYWNlIHR5cGUuIENhbiBiZSB1c2VkIHRvIGNvbmZpZ3VyZSBhIHNwYXRpYWwgcmVsYXRpb25zaGlwIHdpdGggdGhlIHVzZXIncyBwaHlzaWNhbAoJCQkgKiBlbnZpcm9ubWVudC4gRGVwZW5kaW5nIG9uIGhvdyB0aGUgdXNlciBtb3ZlcyBpbiAzRCBzcGFjZSwgc2V0dGluZyBhbiBhcHByb3ByaWF0ZSByZWZlcmVuY2Ugc3BhY2UgY2FuCgkJCSAqIGltcHJvdmUgdHJhY2tpbmcuIERlZmF1bHQgaXMgYGxvY2FsLWZsb29yYC4gVmFsaWQgdmFsdWVzIGNhbiBiZSBmb3VuZCBoZXJlCgkJCSAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9YUlJlZmVyZW5jZVNwYWNlI3JlZmVyZW5jZV9zcGFjZV90eXBlcy4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgY2FuIG5vdCBiZSB1c2VkIGR1cmluZyBhIFhSIHNlc3Npb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSByZWZlcmVuY2Ugc3BhY2UgdHlwZS4KCQkJICovCgkJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2VUeXBlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQlyZWZlcmVuY2VTcGFjZVR5cGUgPSB2YWx1ZTsKCgkJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIHJlZmVyZW5jZSBzcGFjZSB0eXBlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgWFIgcmVmZXJlbmNlIHNwYWNlLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHtYUlJlZmVyZW5jZVNwYWNlfSBUaGUgWFIgcmVmZXJlbmNlIHNwYWNlLgoJCQkgKi8KCQkJdGhpcy5nZXRSZWZlcmVuY2VTcGFjZSA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2U7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgYSBjdXN0b20gWFIgcmVmZXJlbmNlIHNwYWNlLgoJCQkgKgoJCQkgKiBAcGFyYW0ge1hSUmVmZXJlbmNlU3BhY2V9IHNwYWNlIC0gVGhlIFhSIHJlZmVyZW5jZSBzcGFjZS4KCQkJICovCgkJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2UgPSBmdW5jdGlvbiAoIHNwYWNlICkgewoKCQkJCWN1c3RvbVJlZmVyZW5jZVNwYWNlID0gc3BhY2U7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgYmFzZSBsYXllci4KCQkJICoKCQkJICogQHJldHVybiB7PyhYUldlYkdMTGF5ZXJ8WFJQcm9qZWN0aW9uTGF5ZXIpfSBUaGUgWFIgYmFzZSBsYXllci4KCQkJICovCgkJCXRoaXMuZ2V0QmFzZUxheWVyID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBnbFByb2pMYXllciAhPT0gbnVsbCA/IGdsUHJvakxheWVyIDogZ2xCYXNlTGF5ZXI7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgWFIgYmluZGluZy4KCQkJICoKCQkJICogQHJldHVybiB7P1hSV2ViR0xCaW5kaW5nfSBUaGUgWFIgYmluZGluZy4KCQkJICovCgkJCXRoaXMuZ2V0QmluZGluZyA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gZ2xCaW5kaW5nOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IFhSIGZyYW1lLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHs/WFJGcmFtZX0gVGhlIFhSIGZyYW1lLiBSZXR1cm5zIGBudWxsYCB3aGVuIHVzZWQgb3V0c2lkZSBhIFhSIHNlc3Npb24uCgkJCSAqLwoJCQl0aGlzLmdldEZyYW1lID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB4ckZyYW1lOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IFhSIHNlc3Npb24uCgkJCSAqCgkJCSAqIEByZXR1cm4gez9YUlNlc3Npb259IFRoZSBYUiBzZXNzaW9uLiBSZXR1cm5zIGBudWxsYCB3aGVuIHVzZWQgb3V0c2lkZSBhIFhSIHNlc3Npb24uCgkJCSAqLwoJCQl0aGlzLmdldFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIHNlc3Npb247CgoJCQl9OwoKCQkJLyoqCgkJCSAqIEFmdGVyIGEgWFIgc2Vzc2lvbiBoYXMgYmVlbiByZXF1ZXN0ZWQgdXN1YWxseSB3aXRoIG9uZSBvZiB0aGUgYCpCdXR0b25gIG1vZHVsZXMsIGl0CgkJCSAqIGlzIGluamVjdGVkIGludG8gdGhlIHJlbmRlcmVyIHdpdGggdGhpcyBtZXRob2QuIFRoaXMgbWV0aG9kIHRyaWdnZXJzIHRoZSBzdGFydCBvZgoJCQkgKiB0aGUgYWN0dWFsIFhSIHJlbmRlcmluZy4KCQkJICoKCQkJICogQGFzeW5jCgkJCSAqIEBwYXJhbSB7WFJTZXNzaW9ufSB2YWx1ZSAtIFRoZSBYUiBzZXNzaW9uIHRvIHNldC4KCQkJICogQHJldHVybiB7UHJvbWlzZX0gQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgc2Vzc2lvbiBoYXMgYmVlbiBzZXQuCgkJCSAqLwoJCQl0aGlzLnNldFNlc3Npb24gPSBhc3luYyBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCXNlc3Npb24gPSB2YWx1ZTsKCgkJCQlpZiAoIHNlc3Npb24gIT09IG51bGwgKSB7CgoJCQkJCWluaXRpYWxSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCgkJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0ZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplc3RhcnQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZCApOwoJCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIG9uSW5wdXRTb3VyY2VzQ2hhbmdlICk7CgoJCQkJCWlmICggYXR0cmlidXRlcy54ckNvbXBhdGlibGUgIT09IHRydWUgKSB7CgoJCQkJCQlhd2FpdCBnbC5tYWtlWFJDb21wYXRpYmxlKCk7CgoJCQkJCX0KCgkJCQkJY3VycmVudFBpeGVsUmF0aW8gPSByZW5kZXJlci5nZXRQaXhlbFJhdGlvKCk7CgkJCQkJcmVuZGVyZXIuZ2V0U2l6ZSggY3VycmVudFNpemUgKTsKCgkJCQkJLy8gQ2hlY2sgdGhhdCB0aGUgYnJvd3NlciBpbXBsZW1lbnRzIHRoZSBuZWNlc3NhcnkgQVBJcyB0byB1c2UgYW4KCQkJCQkvLyBYUlByb2plY3Rpb25MYXllciByYXRoZXIgdGhhbiBhbiBYUldlYkdMTGF5ZXIKCQkJCQljb25zdCB1c2VMYXllcnMgPSB0eXBlb2YgWFJXZWJHTEJpbmRpbmcgIT09ICd1bmRlZmluZWQnICYmICdjcmVhdGVQcm9qZWN0aW9uTGF5ZXInIGluIFhSV2ViR0xCaW5kaW5nLnByb3RvdHlwZTsKCgkJCQkJaWYgKCAhIHVzZUxheWVycyApIHsKCgkJCQkJCWNvbnN0IGxheWVySW5pdCA9IHsKCQkJCQkJCWFudGlhbGlhczogYXR0cmlidXRlcy5hbnRpYWxpYXMsCgkJCQkJCQlhbHBoYTogdHJ1ZSwKCQkJCQkJCWRlcHRoOiBhdHRyaWJ1dGVzLmRlcHRoLAoJCQkJCQkJc3RlbmNpbDogYXR0cmlidXRlcy5zdGVuY2lsLAoJCQkJCQkJZnJhbWVidWZmZXJTY2FsZUZhY3RvcjogZnJhbWVidWZmZXJTY2FsZUZhY3RvcgoJCQkJCQl9OwoKCQkJCQkJZ2xCYXNlTGF5ZXIgPSBuZXcgWFJXZWJHTExheWVyKCBzZXNzaW9uLCBnbCwgbGF5ZXJJbml0ICk7CgoJCQkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7IGJhc2VMYXllcjogZ2xCYXNlTGF5ZXIgfSApOwoKCQkJCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggMSApOwoJCQkJCQlyZW5kZXJlci5zZXRTaXplKCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlcldpZHRoLCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwgZmFsc2UgKTsKCgkJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKCQkJCQkJCWdsQmFzZUxheWVyLmZyYW1lYnVmZmVyV2lkdGgsCgkJCQkJCQlnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwKCQkJCQkJCXsKCQkJCQkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCQkJCQkJdHlwZTogVW5zaWduZWRCeXRlVHlwZSwKCQkJCQkJCQljb2xvclNwYWNlOiByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlLAoJCQkJCQkJCXN0ZW5jaWxCdWZmZXI6IGF0dHJpYnV0ZXMuc3RlbmNpbCwKCQkJCQkJCQlyZXNvbHZlRGVwdGhCdWZmZXI6ICggZ2xCYXNlTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICksCgkJCQkJCQkJcmVzb2x2ZVN0ZW5jaWxCdWZmZXI6ICggZ2xCYXNlTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICkKCgkJCQkJCQl9CgkJCQkJCSk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlsZXQgZGVwdGhGb3JtYXQgPSBudWxsOwoJCQkJCQlsZXQgZGVwdGhUeXBlID0gbnVsbDsKCQkJCQkJbGV0IGdsRGVwdGhGb3JtYXQgPSBudWxsOwoKCQkJCQkJaWYgKCBhdHRyaWJ1dGVzLmRlcHRoICkgewoKCQkJCQkJCWdsRGVwdGhGb3JtYXQgPSBhdHRyaWJ1dGVzLnN0ZW5jaWwgPyBnbC5ERVBUSDI0X1NURU5DSUw4IDogZ2wuREVQVEhfQ09NUE9ORU5UMjQ7CgkJCQkJCQlkZXB0aEZvcm1hdCA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IERlcHRoU3RlbmNpbEZvcm1hdCA6IERlcHRoRm9ybWF0OwoJCQkJCQkJZGVwdGhUeXBlID0gYXR0cmlidXRlcy5zdGVuY2lsID8gVW5zaWduZWRJbnQyNDhUeXBlIDogVW5zaWduZWRJbnRUeXBlOwoKCQkJCQkJfQoKCQkJCQkJY29uc3QgcHJvamVjdGlvbmxheWVySW5pdCA9IHsKCQkJCQkJCWNvbG9yRm9ybWF0OiBnbC5SR0JBOCwKCQkJCQkJCWRlcHRoRm9ybWF0OiBnbERlcHRoRm9ybWF0LAoJCQkJCQkJc2NhbGVGYWN0b3I6IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IKCQkJCQkJfTsKCgkJCQkJCWdsQmluZGluZyA9IG5ldyBYUldlYkdMQmluZGluZyggc2Vzc2lvbiwgZ2wgKTsKCgkJCQkJCWdsUHJvakxheWVyID0gZ2xCaW5kaW5nLmNyZWF0ZVByb2plY3Rpb25MYXllciggcHJvamVjdGlvbmxheWVySW5pdCApOwoKCQkJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggeyBsYXllcnM6IFsgZ2xQcm9qTGF5ZXIgXSB9ICk7CgoJCQkJCQlyZW5kZXJlci5zZXRQaXhlbFJhdGlvKCAxICk7CgkJCQkJCXJlbmRlcmVyLnNldFNpemUoIGdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwgZ2xQcm9qTGF5ZXIudGV4dHVyZUhlaWdodCwgZmFsc2UgKTsKCgkJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKCQkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwKCQkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsCgkJCQkJCQl7CgkJCQkJCQkJZm9ybWF0OiBSR0JBRm9ybWF0LAoJCQkJCQkJCXR5cGU6IFVuc2lnbmVkQnl0ZVR5cGUsCgkJCQkJCQkJZGVwdGhUZXh0dXJlOiBuZXcgRGVwdGhUZXh0dXJlKCBnbFByb2pMYXllci50ZXh0dXJlV2lkdGgsIGdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsIGRlcHRoVHlwZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGVwdGhGb3JtYXQgKSwKCQkJCQkJCQlzdGVuY2lsQnVmZmVyOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCgkJCQkJCQkJY29sb3JTcGFjZTogcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSwKCQkJCQkJCQlzYW1wbGVzOiBhdHRyaWJ1dGVzLmFudGlhbGlhcyA/IDQgOiAwLAoJCQkJCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogKCBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKSwKCQkJCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogKCBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKQoJCQkJCQkJfSApOwoKCQkJCQl9CgoJCQkJCW5ld1JlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsgLy8gVE9ETyBSZW1vdmUgdGhpcyB3aGVuIHBvc3NpYmxlLCBzZWUgIzIzMjc4CgoJCQkJCXRoaXMuc2V0Rm92ZWF0aW9uKCBmb3ZlYXRpb24gKTsKCgkJCQkJY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwoJCQkJCXJlZmVyZW5jZVNwYWNlID0gYXdhaXQgc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UoIHJlZmVyZW5jZVNwYWNlVHlwZSApOwoKCQkJCQlhbmltYXRpb24uc2V0Q29udGV4dCggc2Vzc2lvbiApOwoJCQkJCWFuaW1hdGlvbi5zdGFydCgpOwoKCQkJCQlzY29wZS5pc1ByZXNlbnRpbmcgPSB0cnVlOwoKCQkJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZXNzaW9uc3RhcnQnIH0gKTsKCgkJCQl9CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGVudmlyb25tZW50IGJsZW5kIG1vZGUgZnJvbSB0aGUgY3VycmVudCBYUiBzZXNzaW9uLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHsnb3BhcXVlJ3wnYWRkaXRpdmUnfCdhbHBoYS1ibGVuZCd8dW5kZWZpbmVkfSBUaGUgZW52aXJvbm1lbnQgYmxlbmQgbW9kZS4gUmV0dXJucyBgdW5kZWZpbmVkYCB3aGVuIHVzZWQgb3V0c2lkZSBvZiBhIFhSIHNlc3Npb24uCgkJCSAqLwoJCQl0aGlzLmdldEVudmlyb25tZW50QmxlbmRNb2RlID0gZnVuY3Rpb24gKCkgewoKCQkJCWlmICggc2Vzc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJcmV0dXJuIHNlc3Npb24uZW52aXJvbm1lbnRCbGVuZE1vZGU7CgoJCQkJfQoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGRlcHRoIHRleHR1cmUgY29tcHV0ZWQgdmlhIGRlcHRoIHNlbnNpbmcuCgkJCSAqCgkJCSAqIEByZXR1cm4gez9UZXh0dXJlfSBUaGUgZGVwdGggdGV4dHVyZS4KCQkJICovCgkJCXRoaXMuZ2V0RGVwdGhUZXh0dXJlID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBkZXB0aFNlbnNpbmcuZ2V0RGVwdGhUZXh0dXJlKCk7CgoJCQl9OwoKCQkJZnVuY3Rpb24gb25JbnB1dFNvdXJjZXNDaGFuZ2UoIGV2ZW50ICkgewoKCQkJCS8vIE5vdGlmeSBkaXNjb25uZWN0ZWQKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5yZW1vdmVkLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBldmVudC5yZW1vdmVkWyBpIF07CgkJCQkJY29uc3QgaW5kZXggPSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmluZGV4T2YoIGlucHV0U291cmNlICk7CgoJCQkJCWlmICggaW5kZXggPj0gMCApIHsKCgkJCQkJCWNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGluZGV4IF0gPSBudWxsOwoJCQkJCQljb250cm9sbGVyc1sgaW5kZXggXS5kaXNjb25uZWN0KCBpbnB1dFNvdXJjZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIE5vdGlmeSBjb25uZWN0ZWQKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5hZGRlZC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGlucHV0U291cmNlID0gZXZlbnQuYWRkZWRbIGkgXTsKCgkJCQkJbGV0IGNvbnRyb2xsZXJJbmRleCA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMuaW5kZXhPZiggaW5wdXRTb3VyY2UgKTsKCgkJCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0xICkgewoKCQkJCQkJLy8gQXNzaWduIGlucHV0IHNvdXJjZSBhIGNvbnRyb2xsZXIgdGhhdCBjdXJyZW50bHkgaGFzIG5vIGlucHV0IHNvdXJjZQoKCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCWlmICggaSA+PSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmxlbmd0aCApIHsKCgkJCQkJCQkJY29udHJvbGxlcklucHV0U291cmNlcy5wdXNoKCBpbnB1dFNvdXJjZSApOwoJCQkJCQkJCWNvbnRyb2xsZXJJbmRleCA9IGk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJfSBlbHNlIGlmICggY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdID09PSBudWxsICkgewoKCQkJCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBpbnB1dFNvdXJjZTsKCQkJCQkJCQljb250cm9sbGVySW5kZXggPSBpOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCS8vIElmIGFsbCBjb250cm9sbGVycyBkbyBjdXJyZW50bHkgcmVjZWl2ZSBpbnB1dCB3ZSBpZ25vcmUgbmV3IG9uZXMKCgkJCQkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtMSApIGJyZWFrOwoKCQkJCQl9CgoJCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgY29udHJvbGxlckluZGV4IF07CgoJCQkJCWlmICggY29udHJvbGxlciApIHsKCgkJCQkJCWNvbnRyb2xsZXIuY29ubmVjdCggaW5wdXRTb3VyY2UgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQljb25zdCBjYW1lcmFMUG9zID0gbmV3IFZlY3RvcjMoKTsKCQkJY29uc3QgY2FtZXJhUlBvcyA9IG5ldyBWZWN0b3IzKCk7CgoJCQkvKioKCQkJICogQXNzdW1lcyAyIGNhbWVyYXMgdGhhdCBhcmUgcGFyYWxsZWwgYW5kIHNoYXJlIGFuIFgtYXhpcywgYW5kIHRoYXQKCQkJICogdGhlIGNhbWVyYXMnIHByb2plY3Rpb24gYW5kIHdvcmxkIG1hdHJpY2VzIGhhdmUgYWxyZWFkeSBiZWVuIHNldC4KCQkJICogQW5kIHRoYXQgbmVhciBhbmQgZmFyIHBsYW5lcyBhcmUgaWRlbnRpY2FsIGZvciBib3RoIGNhbWVyYXMuCgkJCSAqIFZpc3VhbGl6YXRpb24gb2YgdGhpcyB0ZWNobmlxdWU6IGh0dHBzOi8vY29tcHV0ZXJncmFwaGljcy5zdGFja2V4Y2hhbmdlLmNvbS9hLzQ3NjUKCQkJICoKCQkJICogQHBhcmFtIHtBcnJheUNhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0byB1cGRhdGUuCgkJCSAqIEBwYXJhbSB7UGVyc3BlY3RpdmVDYW1lcmF9IGNhbWVyYUwgLSBUaGUgbGVmdCBjYW1lcmEuCgkJCSAqIEBwYXJhbSB7UGVyc3BlY3RpdmVDYW1lcmF9IGNhbWVyYVIgLSBUaGUgcmlnaHQgY2FtZXJhLgoJCQkgKi8KCQkJZnVuY3Rpb24gc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhLCBjYW1lcmFMLCBjYW1lcmFSICkgewoKCQkJCWNhbWVyYUxQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmFMLm1hdHJpeFdvcmxkICk7CgkJCQljYW1lcmFSUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhUi5tYXRyaXhXb3JsZCApOwoKCQkJCWNvbnN0IGlwZCA9IGNhbWVyYUxQb3MuZGlzdGFuY2VUbyggY2FtZXJhUlBvcyApOwoKCQkJCWNvbnN0IHByb2pMID0gY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwoJCQkJY29uc3QgcHJvalIgPSBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgoJCQkJLy8gVlIgc3lzdGVtcyB3aWxsIGhhdmUgaWRlbnRpY2FsIGZhciBhbmQgbmVhciBwbGFuZXMsIGFuZAoJCQkJLy8gbW9zdCBsaWtlbHkgaWRlbnRpY2FsIHRvcCBhbmQgYm90dG9tIGZydXN0dW0gZXh0ZW50cy4KCQkJCS8vIFVzZSB0aGUgbGVmdCBjYW1lcmEgZm9yIHRoZXNlIHZhbHVlcy4KCQkJCWNvbnN0IG5lYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gLSAxICk7CgkJCQljb25zdCBmYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gKyAxICk7CgkJCQljb25zdCB0b3BGb3YgPSAoIHByb2pMWyA5IF0gKyAxICkgLyBwcm9qTFsgNSBdOwoJCQkJY29uc3QgYm90dG9tRm92ID0gKCBwcm9qTFsgOSBdIC0gMSApIC8gcHJvakxbIDUgXTsKCgkJCQljb25zdCBsZWZ0Rm92ID0gKCBwcm9qTFsgOCBdIC0gMSApIC8gcHJvakxbIDAgXTsKCQkJCWNvbnN0IHJpZ2h0Rm92ID0gKCBwcm9qUlsgOCBdICsgMSApIC8gcHJvalJbIDAgXTsKCQkJCWNvbnN0IGxlZnQgPSBuZWFyICogbGVmdEZvdjsKCQkJCWNvbnN0IHJpZ2h0ID0gbmVhciAqIHJpZ2h0Rm92OwoKCQkJCS8vIENhbGN1bGF0ZSB0aGUgbmV3IGNhbWVyYSdzIHBvc2l0aW9uIG9mZnNldCBmcm9tIHRoZQoJCQkJLy8gbGVmdCBjYW1lcmEuIHhPZmZzZXQgc2hvdWxkIGJlIHJvdWdobHkgaGFsZiBgaXBkYC4KCQkJCWNvbnN0IHpPZmZzZXQgPSBpcGQgLyAoIC0gbGVmdEZvdiArIHJpZ2h0Rm92ICk7CgkJCQljb25zdCB4T2Zmc2V0ID0gek9mZnNldCAqIC0gbGVmdEZvdjsKCgkJCQkvLyBUT0RPOiBCZXR0ZXIgd2F5IHRvIGFwcGx5IHRoaXMgb2Zmc2V0PwoJCQkJY2FtZXJhTC5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQkJY2FtZXJhLnRyYW5zbGF0ZVgoIHhPZmZzZXQgKTsKCQkJCWNhbWVyYS50cmFuc2xhdGVaKCB6T2Zmc2V0ICk7CgkJCQljYW1lcmEubWF0cml4V29ybGQuY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CgkJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQkJCS8vIENoZWNrIGlmIHRoZSBwcm9qZWN0aW9uIHVzZXMgYW4gaW5maW5pdGUgZmFyIHBsYW5lLgoJCQkJaWYgKCBwcm9qTFsgMTAgXSA9PT0gLTEgKSB7CgoJCQkJCS8vIFVzZSB0aGUgcHJvamVjdGlvbiBtYXRyaXggZnJvbSB0aGUgbGVmdCBleWUuCgkJCQkJLy8gVGhlIGNhbWVyYSBvZmZzZXQgaXMgc3VmZmljaWVudCB0byBpbmNsdWRlIHRoZSB2aWV3IHZvbHVtZXMKCQkJCQkvLyBvZiBib3RoIGV5ZXMgKGFzc3VtaW5nIHN5bW1ldHJpYyBwcm9qZWN0aW9ucykuCgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBGaW5kIHRoZSB1bmlvbiBvZiB0aGUgZnJ1c3R1bSB2YWx1ZXMgb2YgdGhlIGNhbWVyYXMgYW5kIHNjYWxlCgkJCQkJLy8gdGhlIHZhbHVlcyBzbyB0aGF0IHRoZSBuZWFyIHBsYW5lJ3MgcG9zaXRpb24gZG9lcyBub3QgY2hhbmdlIGluIHdvcmxkIHNwYWNlLAoJCQkJCS8vIGFsdGhvdWdoIG11c3Qgbm93IGJlIHJlbGF0aXZlIHRvIHRoZSBuZXcgdW5pb24gY2FtZXJhLgoJCQkJCWNvbnN0IG5lYXIyID0gbmVhciArIHpPZmZzZXQ7CgkJCQkJY29uc3QgZmFyMiA9IGZhciArIHpPZmZzZXQ7CgkJCQkJY29uc3QgbGVmdDIgPSBsZWZ0IC0geE9mZnNldDsKCQkJCQljb25zdCByaWdodDIgPSByaWdodCArICggaXBkIC0geE9mZnNldCApOwoJCQkJCWNvbnN0IHRvcDIgPSB0b3BGb3YgKiBmYXIgLyBmYXIyICogbmVhcjI7CgkJCQkJY29uc3QgYm90dG9tMiA9IGJvdHRvbUZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKCgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0MiwgcmlnaHQyLCB0b3AyLCBib3R0b20yLCBuZWFyMiwgZmFyMiApOwoJCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIHVwZGF0ZUNhbWVyYSggY2FtZXJhLCBwYXJlbnQgKSB7CgoJCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJCWNhbWVyYS5tYXRyaXhXb3JsZC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHBhcmVudC5tYXRyaXhXb3JsZCwgY2FtZXJhLm1hdHJpeCApOwoKCQkJCX0KCgkJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQkJfQoKCQkJLyoqCgkJCSAqIFVwZGF0ZXMgdGhlIHN0YXRlIG9mIHRoZSBYUiBjYW1lcmEuIFVzZSB0aGlzIG1ldGhvZCBvbiBhcHAgbGV2ZWwgaWYgeW91CgkJCSAqIHNldCBjYW1lcmFBdXRvVXBkYXRlYCB0byBgZmFsc2VgLiBUaGUgbWV0aG9kIHJlcXVpcmVzIHRoZSBub24tWFIKCQkJICogY2FtZXJhIG9mIHRoZSBzY2VuZSBhcyBhIHBhcmFtZXRlci4gVGhlIHBhc3NlZCBpbiBjYW1lcmEncyB0cmFuc2Zvcm1hdGlvbgoJCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFkanVzdGVkIHRvIHRoZSBwb3NpdGlvbiBvZiB0aGUgWFIgY2FtZXJhIHdoZW4gY2FsbGluZwoJCQkgKiB0aGlzIG1ldGhvZC4KCQkJICoKCQkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEuCgkJCSAqLwoJCQl0aGlzLnVwZGF0ZUNhbWVyYSA9IGZ1bmN0aW9uICggY2FtZXJhICkgewoKCQkJCWlmICggc2Vzc2lvbiA9PT0gbnVsbCApIHJldHVybjsKCgkJCQlsZXQgZGVwdGhOZWFyID0gY2FtZXJhLm5lYXI7CgkJCQlsZXQgZGVwdGhGYXIgPSBjYW1lcmEuZmFyOwoKCQkJCWlmICggZGVwdGhTZW5zaW5nLnRleHR1cmUgIT09IG51bGwgKSB7CgoJCQkJCWlmICggZGVwdGhTZW5zaW5nLmRlcHRoTmVhciA+IDAgKSBkZXB0aE5lYXIgPSBkZXB0aFNlbnNpbmcuZGVwdGhOZWFyOwoJCQkJCWlmICggZGVwdGhTZW5zaW5nLmRlcHRoRmFyID4gMCApIGRlcHRoRmFyID0gZGVwdGhTZW5zaW5nLmRlcHRoRmFyOwoKCQkJCX0KCgkJCQljYW1lcmFYUi5uZWFyID0gY2FtZXJhUi5uZWFyID0gY2FtZXJhTC5uZWFyID0gZGVwdGhOZWFyOwoJCQkJY2FtZXJhWFIuZmFyID0gY2FtZXJhUi5mYXIgPSBjYW1lcmFMLmZhciA9IGRlcHRoRmFyOwoKCQkJCWlmICggX2N1cnJlbnREZXB0aE5lYXIgIT09IGNhbWVyYVhSLm5lYXIgfHwgX2N1cnJlbnREZXB0aEZhciAhPT0gY2FtZXJhWFIuZmFyICkgewoKCQkJCQkvLyBOb3RlIHRoYXQgdGhlIG5ldyByZW5kZXJTdGF0ZSB3b24ndCBhcHBseSB1bnRpbCB0aGUgbmV4dCBmcmFtZS4gU2VlICMxODMyMAoKCQkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7CgkJCQkJCWRlcHRoTmVhcjogY2FtZXJhWFIubmVhciwKCQkJCQkJZGVwdGhGYXI6IGNhbWVyYVhSLmZhcgoJCQkJCX0gKTsKCgkJCQkJX2N1cnJlbnREZXB0aE5lYXIgPSBjYW1lcmFYUi5uZWFyOwoJCQkJCV9jdXJyZW50RGVwdGhGYXIgPSBjYW1lcmFYUi5mYXI7CgoJCQkJfQoKCQkJCWNhbWVyYUwubGF5ZXJzLm1hc2sgPSBjYW1lcmEubGF5ZXJzLm1hc2sgfCAwYjAxMDsKCQkJCWNhbWVyYVIubGF5ZXJzLm1hc2sgPSBjYW1lcmEubGF5ZXJzLm1hc2sgfCAwYjEwMDsKCQkJCWNhbWVyYVhSLmxheWVycy5tYXNrID0gY2FtZXJhTC5sYXllcnMubWFzayB8IGNhbWVyYVIubGF5ZXJzLm1hc2s7CgoJCQkJY29uc3QgcGFyZW50ID0gY2FtZXJhLnBhcmVudDsKCQkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmFYUi5jYW1lcmFzOwoKCQkJCXVwZGF0ZUNhbWVyYSggY2FtZXJhWFIsIHBhcmVudCApOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbWVyYXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQl1cGRhdGVDYW1lcmEoIGNhbWVyYXNbIGkgXSwgcGFyZW50ICk7CgoJCQkJfQoKCQkJCS8vIHVwZGF0ZSBwcm9qZWN0aW9uIG1hdHJpeCBmb3IgcHJvcGVyIHZpZXcgZnJ1c3R1bSBjdWxsaW5nCgoJCQkJaWYgKCBjYW1lcmFzLmxlbmd0aCA9PT0gMiApIHsKCgkJCQkJc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhWFIsIGNhbWVyYUwsIGNhbWVyYVIgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBhc3N1bWUgc2luZ2xlIGNhbWVyYSBzZXR1cCAoQVIpCgoJCQkJCWNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkJfQoKCQkJCS8vIHVwZGF0ZSB1c2VyIGNhbWVyYSBhbmQgaXRzIGNoaWxkcmVuCgoJCQkJdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICk7CgoJCQl9OwoKCQkJZnVuY3Rpb24gdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICkgewoKCQkJCWlmICggcGFyZW50ID09PSBudWxsICkgewoKCQkJCQljYW1lcmEubWF0cml4LmNvcHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY2FtZXJhLm1hdHJpeC5jb3B5KCBwYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCQljYW1lcmEubWF0cml4LmludmVydCgpOwoJCQkJCWNhbWVyYS5tYXRyaXgubXVsdGlwbHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgoJCQkJfQoKCQkJCWNhbWVyYS5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUgKTsKCQkJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXggKTsKCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmFYUi5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKCQkJCWlmICggY2FtZXJhLmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgoJCQkJCWNhbWVyYS5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggMSAvIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyA1IF0gKTsKCQkJCQljYW1lcmEuem9vbSA9IDE7CgoJCQkJfQoKCQkJfQoKCQkJLyoqCgkJCSAqIFJldHVybnMgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIEFycmF5Q2FtZXJhfSB3aGljaCByZXByZXNlbnRzIHRoZSBYUiBjYW1lcmEKCQkJICogb2YgdGhlIGFjdGl2ZSBYUiBzZXNzaW9uLiBGb3IgZWFjaCB2aWV3IGl0IGhvbGRzIGEgc2VwYXJhdGUgY2FtZXJhIG9iamVjdC4KCQkJICoKCQkJICogVGhlIGNhbWVyYSdzIGBmb3ZgIGlzIGN1cnJlbnRseSBub3QgdXNlZCBhbmQgZG9lcyBub3QgcmVmbGVjdCB0aGUgZm92IG9mCgkJCSAqIHRoZSBYUiBjYW1lcmEuIElmIHlvdSBuZWVkIHRoZSBmb3Ygb24gYXBwIGxldmVsLCB5b3UgaGF2ZSB0byBjb21wdXRlIGluCgkJCSAqIG1hbnVhbGx5IGZyb20gdGhlIFhSIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cmljZXMuCgkJCSAqCgkJCSAqIEByZXR1cm4ge0FycmF5Q2FtZXJhfSBUaGUgWFIgY2FtZXJhLgoJCQkgKi8KCQkJdGhpcy5nZXRDYW1lcmEgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGNhbWVyYVhSOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBhbW91bnQgb2YgZm92ZWF0aW9uIHVzZWQgYnkgdGhlIFhSIGNvbXBvc2l0b3IgZm9yIHRoZSBwcm9qZWN0aW9uIGxheWVyLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbW91bnQgb2YgZm92ZWF0aW9uLgoJCQkgKi8KCQkJdGhpcy5nZXRGb3ZlYXRpb24gPSBmdW5jdGlvbiAoKSB7CgoJCQkJaWYgKCBnbFByb2pMYXllciA9PT0gbnVsbCAmJiBnbEJhc2VMYXllciA9PT0gbnVsbCApIHsKCgkJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCgkJCQl9CgoJCQkJcmV0dXJuIGZvdmVhdGlvbjsKCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgZm92ZWF0aW9uIHZhbHVlLgoJCQkgKgoJCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBBIG51bWJlciBpbiB0aGUgcmFuZ2UgYFswLDFdYCB3aGVyZSBgMGAgbWVhbnMgbm8gZm92ZWF0aW9uIChmdWxsIHJlc29sdXRpb24pCgkJCSAqIGFuZCBgMWAgbWVhbnMgbWF4aW11bSBmb3ZlYXRpb24gKHRoZSBlZGdlcyByZW5kZXIgYXQgbG93ZXIgcmVzb2x1dGlvbikuCgkJCSAqLwoJCQl0aGlzLnNldEZvdmVhdGlvbiA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJLy8gMCA9IG5vIGZvdmVhdGlvbiA9IGZ1bGwgcmVzb2x1dGlvbgoJCQkJLy8gMSA9IG1heGltdW0gZm92ZWF0aW9uID0gdGhlIGVkZ2VzIHJlbmRlciBhdCBsb3dlciByZXNvbHV0aW9uCgoJCQkJZm92ZWF0aW9uID0gdmFsdWU7CgoJCQkJaWYgKCBnbFByb2pMYXllciAhPT0gbnVsbCApIHsKCgkJCQkJZ2xQcm9qTGF5ZXIuZml4ZWRGb3ZlYXRpb24gPSB2YWx1ZTsKCgkJCQl9CgoJCQkJaWYgKCBnbEJhc2VMYXllciAhPT0gbnVsbCAmJiBnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiA9IHZhbHVlOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyBgdHJ1ZWAgaWYgZGVwdGggc2Vuc2luZyBpcyBzdXBwb3J0ZWQuCgkJCSAqCgkJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgZGVwdGggc2Vuc2luZyBpcyBzdXBwb3J0ZWQgb3Igbm90LgoJCQkgKi8KCQkJdGhpcy5oYXNEZXB0aFNlbnNpbmcgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy50ZXh0dXJlICE9PSBudWxsOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBkZXB0aCBzZW5zaW5nIG1lc2guCgkJCSAqCgkJCSAqIEByZXR1cm4ge01lc2h9IFRoZSBkZXB0aCBzZW5zaW5nIG1lc2guCgkJCSAqLwoJCQl0aGlzLmdldERlcHRoU2Vuc2luZ01lc2ggPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy5nZXRNZXNoKCBjYW1lcmFYUiApOwoKCQkJfTsKCgkJCS8vIEFuaW1hdGlvbiBMb29wCgoJCQlsZXQgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gbnVsbDsKCgkJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKCQkJCXBvc2UgPSBmcmFtZS5nZXRWaWV3ZXJQb3NlKCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwoJCQkJeHJGcmFtZSA9IGZyYW1lOwoKCQkJCWlmICggcG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJY29uc3Qgdmlld3MgPSBwb3NlLnZpZXdzOwoKCQkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0RnJhbWVidWZmZXIoIG5ld1JlbmRlclRhcmdldCwgZ2xCYXNlTGF5ZXIuZnJhbWVidWZmZXIgKTsKCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBuZXdSZW5kZXJUYXJnZXQgKTsKCgkJCQkJfQoKCQkJCQlsZXQgY2FtZXJhWFJOZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZWJ1aWxkIGNhbWVyYVhSJ3MgY2FtZXJhIGxpc3QKCgkJCQkJaWYgKCB2aWV3cy5sZW5ndGggIT09IGNhbWVyYVhSLmNhbWVyYXMubGVuZ3RoICkgewoKCQkJCQkJY2FtZXJhWFIuY2FtZXJhcy5sZW5ndGggPSAwOwoJCQkJCQljYW1lcmFYUk5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB2aWV3cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQljb25zdCB2aWV3ID0gdmlld3NbIGkgXTsKCgkJCQkJCWxldCB2aWV3cG9ydCA9IG51bGw7CgoJCQkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKCQkJCQkJCXZpZXdwb3J0ID0gZ2xCYXNlTGF5ZXIuZ2V0Vmlld3BvcnQoIHZpZXcgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJY29uc3QgZ2xTdWJJbWFnZSA9IGdsQmluZGluZy5nZXRWaWV3U3ViSW1hZ2UoIGdsUHJvakxheWVyLCB2aWV3ICk7CgkJCQkJCQl2aWV3cG9ydCA9IGdsU3ViSW1hZ2Uudmlld3BvcnQ7CgoJCQkJCQkJLy8gRm9yIHNpZGUtYnktc2lkZSBwcm9qZWN0aW9uLCB3ZSBvbmx5IHByb2R1Y2UgYSBzaW5nbGUgdGV4dHVyZSBmb3IgYm90aCBleWVzLgoJCQkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXRUZXh0dXJlcygKCQkJCQkJCQkJbmV3UmVuZGVyVGFyZ2V0LAoJCQkJCQkJCQlnbFN1YkltYWdlLmNvbG9yVGV4dHVyZSwKCQkJCQkJCQkJZ2xTdWJJbWFnZS5kZXB0aFN0ZW5jaWxUZXh0dXJlICk7CgoJCQkJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggbmV3UmVuZGVyVGFyZ2V0ICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQkJbGV0IGNhbWVyYSA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJCWlmICggY2FtZXJhID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJCQkJCQljYW1lcmEubGF5ZXJzLmVuYWJsZSggaSApOwoJCQkJCQkJY2FtZXJhLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKCQkJCQkJCWNhbWVyYXNbIGkgXSA9IGNhbWVyYTsKCgkJCQkJCX0KCgkJCQkJCWNhbWVyYS5tYXRyaXguZnJvbUFycmF5KCB2aWV3LnRyYW5zZm9ybS5tYXRyaXggKTsKCQkJCQkJY2FtZXJhLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5mcm9tQXJyYXkoIHZpZXcucHJvamVjdGlvbk1hdHJpeCApOwoJCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKS5pbnZlcnQoKTsKCQkJCQkJY2FtZXJhLnZpZXdwb3J0LnNldCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQud2lkdGgsIHZpZXdwb3J0LmhlaWdodCApOwoKCQkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJCWNhbWVyYVhSLm1hdHJpeC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CgkJCQkJCQljYW1lcmFYUi5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmFYUi5wb3NpdGlvbiwgY2FtZXJhWFIucXVhdGVybmlvbiwgY2FtZXJhWFIuc2NhbGUgKTsKCgkJCQkJCX0KCgkJCQkJCWlmICggY2FtZXJhWFJOZWVkc1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJCQljYW1lcmFYUi5jYW1lcmFzLnB1c2goIGNhbWVyYSApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCS8vCgoJCQkJCWNvbnN0IGVuYWJsZWRGZWF0dXJlcyA9IHNlc3Npb24uZW5hYmxlZEZlYXR1cmVzOwoJCQkJCWNvbnN0IGdwdURlcHRoU2Vuc2luZ0VuYWJsZWQgPSBlbmFibGVkRmVhdHVyZXMgJiYKCQkJCQkJZW5hYmxlZEZlYXR1cmVzLmluY2x1ZGVzKCAnZGVwdGgtc2Vuc2luZycgKSAmJgoJCQkJCQlzZXNzaW9uLmRlcHRoVXNhZ2UgPT0gJ2dwdS1vcHRpbWl6ZWQnOwoKCQkJCQlpZiAoIGdwdURlcHRoU2Vuc2luZ0VuYWJsZWQgJiYgZ2xCaW5kaW5nICkgewoKCQkJCQkJY29uc3QgZGVwdGhEYXRhID0gZ2xCaW5kaW5nLmdldERlcHRoSW5mb3JtYXRpb24oIHZpZXdzWyAwIF0gKTsKCgkJCQkJCWlmICggZGVwdGhEYXRhICYmIGRlcHRoRGF0YS5pc1ZhbGlkICYmIGRlcHRoRGF0YS50ZXh0dXJlICkgewoKCQkJCQkJCWRlcHRoU2Vuc2luZy5pbml0KCByZW5kZXJlciwgZGVwdGhEYXRhLCBzZXNzaW9uLnJlbmRlclN0YXRlICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8KCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGlucHV0U291cmNlID0gY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdOwoJCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaSBdOwoKCQkJCQlpZiAoIGlucHV0U291cmNlICE9PSBudWxsICYmIGNvbnRyb2xsZXIgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNvbnRyb2xsZXIudXBkYXRlKCBpbnB1dFNvdXJjZSwgZnJhbWUsIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUsIGZyYW1lICk7CgoJCQkJaWYgKCBmcmFtZS5kZXRlY3RlZFBsYW5lcyApIHsKCgkJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAncGxhbmVzZGV0ZWN0ZWQnLCBkYXRhOiBmcmFtZSB9ICk7CgoJCQkJfQoKCQkJCXhyRnJhbWUgPSBudWxsOwoKCQkJfQoKCQkJY29uc3QgYW5pbWF0aW9uID0gbmV3IFdlYkdMQW5pbWF0aW9uKCk7CgoJCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKCQkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJCX07CgoJCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7fTsKCgkJfQoKCX0KCgljb25zdCBfZTEgPSAvKkBfX1BVUkVfXyovIG5ldyBFdWxlcigpOwoJY29uc3QgX20xID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKCWZ1bmN0aW9uIFdlYkdMTWF0ZXJpYWxzKCByZW5kZXJlciwgcHJvcGVydGllcyApIHsKCgkJZnVuY3Rpb24gcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hcCwgdW5pZm9ybSApIHsKCgkJCWlmICggbWFwLm1hdHJpeEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJbWFwLnVwZGF0ZU1hdHJpeCgpOwoKCQkJfQoKCQkJdW5pZm9ybS52YWx1ZS5jb3B5KCBtYXAubWF0cml4ICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaEZvZ1VuaWZvcm1zKCB1bmlmb3JtcywgZm9nICkgewoKCQkJZm9nLmNvbG9yLmdldFJHQiggdW5pZm9ybXMuZm9nQ29sb3IudmFsdWUsIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgKTsKCgkJCWlmICggZm9nLmlzRm9nICkgewoKCQkJCXVuaWZvcm1zLmZvZ05lYXIudmFsdWUgPSBmb2cubmVhcjsKCQkJCXVuaWZvcm1zLmZvZ0Zhci52YWx1ZSA9IGZvZy5mYXI7CgoJCQl9IGVsc2UgaWYgKCBmb2cuaXNGb2dFeHAyICkgewoKCQkJCXVuaWZvcm1zLmZvZ0RlbnNpdHkudmFsdWUgPSBmb2cuZGVuc2l0eTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCgkJCWlmICggbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTGFtYmVydE1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJCXJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQkJcmVmcmVzaFVuaWZvcm1zUGhvbmcoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQkJcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCWlmICggbWF0ZXJpYWwuaXNNZXNoUGh5c2ljYWxNYXRlcmlhbCApIHsKCgkJCQkJcmVmcmVzaFVuaWZvcm1zUGh5c2ljYWwoIHVuaWZvcm1zLCBtYXRlcmlhbCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTWF0Y2FwTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJCXJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEZXB0aE1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEaXN0YW5jZU1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgkJCQlyZWZyZXNoVW5pZm9ybXNEaXN0YW5jZSggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hOb3JtYWxNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNMaW5lQmFzaWNNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNMaW5lKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQlpZiAoIG1hdGVyaWFsLmlzTGluZURhc2hlZE1hdGVyaWFsICkgewoKCQkJCQlyZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1BvaW50c01hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc1BvaW50cyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQgKTsKCgkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU3ByaXRlTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1NoYWRvd01hdGVyaWFsICkgewoKCQkJCXVuaWZvcm1zLmNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CgkJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCgkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7IC8vICMxNTU4MQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgoJCQlpZiAoIG1hdGVyaWFsLmNvbG9yICkgewoKCQkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZW1pc3NpdmUgKSB7CgoJCQkJdW5pZm9ybXMuZW1pc3NpdmUudmFsdWUuY29weSggbWF0ZXJpYWwuZW1pc3NpdmUgKS5tdWx0aXBseVNjYWxhciggbWF0ZXJpYWwuZW1pc3NpdmVJbnRlbnNpdHkgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmJ1bXBNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmJ1bXBNYXAsIHVuaWZvcm1zLmJ1bXBNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgPSBtYXRlcmlhbC5idW1wU2NhbGU7CgoJCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCgkJCQkJdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlICo9IC0xOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubm9ybWFsTWFwICkgewoKCQkJCXVuaWZvcm1zLm5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLm5vcm1hbE1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubm9ybWFsTWFwLCB1bmlmb3Jtcy5ub3JtYWxNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5ub3JtYWxTY2FsZSApOwoKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgoJCQkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwLCB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmVtaXNzaXZlTWFwICkgewoKCQkJCXVuaWZvcm1zLmVtaXNzaXZlTWFwLnZhbHVlID0gbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmVtaXNzaXZlTWFwLCB1bmlmb3Jtcy5lbWlzc2l2ZU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhck1hcCApIHsKCgkJCQl1bmlmb3Jtcy5zcGVjdWxhck1hcC52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFyTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhck1hcCwgdW5pZm9ybXMuc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHsKCgkJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgoJCQl9CgoJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCgkJCWNvbnN0IGVudk1hcCA9IG1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXA7CgkJCWNvbnN0IGVudk1hcFJvdGF0aW9uID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcFJvdGF0aW9uOwoKCQkJaWYgKCBlbnZNYXAgKSB7CgoJCQkJdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKCQkJCV9lMS5jb3B5KCBlbnZNYXBSb3RhdGlvbiApOwoKCQkJCS8vIGFjY29tbW9kYXRlIGxlZnQtaGFuZGVkIGZyYW1lCgkJCQlfZTEueCAqPSAtMTsgX2UxLnkgKj0gLTE7IF9lMS56ICo9IC0xOwoKCQkJCWlmICggZW52TWFwLmlzQ3ViZVRleHR1cmUgJiYgZW52TWFwLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSB7CgoJCQkJCS8vIGVudmlyb25tZW50IG1hcHMgd2hpY2ggYXJlIG5vdCBjdWJlIHJlbmRlciB0YXJnZXRzIG9yIFBNUkVNcyBmb2xsb3cgYSBkaWZmZXJlbnQgY29udmVudGlvbgoJCQkJCV9lMS55ICo9IC0xOwoJCQkJCV9lMS56ICo9IC0xOwoKCQkJCX0KCgkJCQl1bmlmb3Jtcy5lbnZNYXBSb3RhdGlvbi52YWx1ZS5zZXRGcm9tTWF0cml4NCggX20xLm1ha2VSb3RhdGlvbkZyb21FdWxlciggX2UxICkgKTsKCgkJCQl1bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBlbnZNYXAuaXNDdWJlVGV4dHVyZSAmJiBlbnZNYXAuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLTEgOiAxOwoKCQkJCXVuaWZvcm1zLnJlZmxlY3Rpdml0eS52YWx1ZSA9IG1hdGVyaWFsLnJlZmxlY3Rpdml0eTsKCQkJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsKCQkJCXVuaWZvcm1zLnJlZnJhY3Rpb25SYXRpby52YWx1ZSA9IG1hdGVyaWFsLnJlZnJhY3Rpb25SYXRpbzsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubGlnaHRNYXAgKSB7CgoJCQkJdW5pZm9ybXMubGlnaHRNYXAudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcDsKCQkJCXVuaWZvcm1zLmxpZ2h0TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmxpZ2h0TWFwLCB1bmlmb3Jtcy5saWdodE1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5hb01hcCApIHsKCgkJCQl1bmlmb3Jtcy5hb01hcC52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwOwoJCQkJdW5pZm9ybXMuYW9NYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5hb01hcEludGVuc2l0eTsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW9NYXAsIHVuaWZvcm1zLmFvTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTGluZSggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCgkJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQl1bmlmb3Jtcy5kYXNoU2l6ZS52YWx1ZSA9IG1hdGVyaWFsLmRhc2hTaXplOwoJCQl1bmlmb3Jtcy50b3RhbFNpemUudmFsdWUgPSBtYXRlcmlhbC5kYXNoU2l6ZSArIG1hdGVyaWFsLmdhcFNpemU7CgkJCXVuaWZvcm1zLnNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuc2NhbGU7CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUG9pbnRzKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCApIHsKCgkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgkJCXVuaWZvcm1zLnNpemUudmFsdWUgPSBtYXRlcmlhbC5zaXplICogcGl4ZWxSYXRpbzsKCQkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBoZWlnaHQgKiAwLjU7CgoJCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMudXZUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuYWxwaGFUZXN0LnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFUZXN0OwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Nwcml0ZXMoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgkJCXVuaWZvcm1zLnJvdGF0aW9uLnZhbHVlID0gbWF0ZXJpYWwucm90YXRpb247CgoJCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMubWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJCXVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFscGhhTWFwLCB1bmlmb3Jtcy5hbHBoYU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgewoKCQkJCXVuaWZvcm1zLmFscGhhVGVzdC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhVGVzdDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNQaG9uZyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuc3BlY3VsYXIudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXIgKTsKCQkJdW5pZm9ybXMuc2hpbmluZXNzLnZhbHVlID0gTWF0aC5tYXgoIG1hdGVyaWFsLnNoaW5pbmVzcywgMWUtNCApOyAvLyB0byBwcmV2ZW50IHBvdyggMC4wLCAwLjAgKQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCWlmICggbWF0ZXJpYWwuZ3JhZGllbnRNYXAgKSB7CgoJCQkJdW5pZm9ybXMuZ3JhZGllbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMubWV0YWxuZXNzLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzOwoKCQkJaWYgKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAgKSB7CgoJCQkJdW5pZm9ybXMubWV0YWxuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAsIHVuaWZvcm1zLm1ldGFsbmVzc01hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJdW5pZm9ybXMucm91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzOwoKCQkJaWYgKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAgKSB7CgoJCQkJdW5pZm9ybXMucm91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnJvdWdobmVzc01hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5lbnZNYXAgKSB7CgoJCQkJLy91bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXA7IC8vIHBhcnQgb2YgdW5pZm9ybXMgY29tbW9uCgoJCQkJdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwSW50ZW5zaXR5OwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BoeXNpY2FsKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCgkJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsgLy8gYWxzbyBwYXJ0IG9mIHVuaWZvcm1zIGNvbW1vbgoKCQkJaWYgKCBtYXRlcmlhbC5zaGVlbiA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuc2hlZW5Db2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zaGVlbkNvbG9yICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLnNoZWVuICk7CgoJCQkJdW5pZm9ybXMuc2hlZW5Sb3VnaG5lc3MudmFsdWUgPSBtYXRlcmlhbC5zaGVlblJvdWdobmVzczsKCgkJCQlpZiAoIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXAgKSB7CgoJCQkJCXVuaWZvcm1zLnNoZWVuQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Db2xvck1hcCwgdW5pZm9ybXMuc2hlZW5Db2xvck1hcFRyYW5zZm9ybSApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwICkgewoKCQkJCQl1bmlmb3Jtcy5zaGVlblJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXQgPiAwICkgewoKCQkJCXVuaWZvcm1zLmNsZWFyY29hdC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdDsKCQkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzczsKCgkJCQlpZiAoIG1hdGVyaWFsLmNsZWFyY29hdE1hcCApIHsKCgkJCQkJdW5pZm9ybXMuY2xlYXJjb2F0TWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXRNYXBUcmFuc2Zvcm0gKTsKCgkJCQl9CgoJCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgKSB7CgoJCQkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcCwgdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwICkgewoKCQkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXA7CgoJCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAsIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSApOwoKCQkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKCQkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKCQkJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmRpc3BlcnNpb24gPiAwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BlcnNpb24udmFsdWUgPSBtYXRlcmlhbC5kaXNwZXJzaW9uOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2UudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZTsKCQkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlSU9SLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1I7CgkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAwIF07CgkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAxIF07CgoJCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcCApIHsKCgkJCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VNYXAudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcDsKCgkJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwLCB1bmlmb3Jtcy5pcmlkZXNjZW5jZU1hcFRyYW5zZm9ybSApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICkgewoKCQkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAsIHVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwICkgewoKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbi52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbjsKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJNYXAudmFsdWUgPSB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQudGV4dHVyZTsKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJTaXplLnZhbHVlLnNldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LndpZHRoLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb25NYXAgKSB7CgoJCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbk1hcC52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKCgkJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCwgdW5pZm9ybXMudHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJCXVuaWZvcm1zLnRoaWNrbmVzcy52YWx1ZSA9IG1hdGVyaWFsLnRoaWNrbmVzczsKCgkJCQlpZiAoIG1hdGVyaWFsLnRoaWNrbmVzc01hcCApIHsKCgkJCQkJdW5pZm9ybXMudGhpY2tuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwudGhpY2tuZXNzTWFwLCB1bmlmb3Jtcy50aGlja25lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJCQl9CgoJCQkJdW5pZm9ybXMuYXR0ZW51YXRpb25EaXN0YW5jZS52YWx1ZSA9IG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2U7CgkJCQl1bmlmb3Jtcy5hdHRlbnVhdGlvbkNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYW5pc290cm9weSA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuYW5pc290cm9weVZlY3Rvci52YWx1ZS5zZXQoIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLmNvcyggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICksIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLnNpbiggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICkgKTsKCgkJCQlpZiAoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAgKSB7CgoJCQkJCXVuaWZvcm1zLmFuaXNvdHJvcHlNYXAudmFsdWUgPSBtYXRlcmlhbC5hbmlzb3Ryb3B5TWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW5pc290cm9weU1hcCwgdW5pZm9ybXMuYW5pc290cm9weU1hcFRyYW5zZm9ybSApOwoKCQkJCX0KCgkJCX0KCgkJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHk7CgkJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApOwoKCQkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwICkgewoKCQkJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLCB1bmlmb3Jtcy5zcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwICkgewoKCQkJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5TWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwLCB1bmlmb3Jtcy5zcGVjdWxhckludGVuc2l0eU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJaWYgKCBtYXRlcmlhbC5tYXRjYXAgKSB7CgoJCQkJdW5pZm9ybXMubWF0Y2FwLnZhbHVlID0gbWF0ZXJpYWwubWF0Y2FwOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQljb25zdCBsaWdodCA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmxpZ2h0OwoKCQkJdW5pZm9ybXMucmVmZXJlbmNlUG9zaXRpb24udmFsdWUuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQl1bmlmb3Jtcy5uZWFyRGlzdGFuY2UudmFsdWUgPSBsaWdodC5zaGFkb3cuY2FtZXJhLm5lYXI7CgkJCXVuaWZvcm1zLmZhckRpc3RhbmNlLnZhbHVlID0gbGlnaHQuc2hhZG93LmNhbWVyYS5mYXI7CgoJCX0KCgkJcmV0dXJuIHsKCQkJcmVmcmVzaEZvZ1VuaWZvcm1zOiByZWZyZXNoRm9nVW5pZm9ybXMsCgkJCXJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zOiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcwoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMVW5pZm9ybXNHcm91cHMoIGdsLCBpbmZvLCBjYXBhYmlsaXRpZXMsIHN0YXRlICkgewoKCQlsZXQgYnVmZmVycyA9IHt9OwoJCWxldCB1cGRhdGVMaXN0ID0ge307CgkJbGV0IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMgPSBbXTsKCgkJY29uc3QgbWF4QmluZGluZ1BvaW50cyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1VOSUZPUk1fQlVGRkVSX0JJTkRJTkdTICk7IC8vIGJpbmRpbmcgcG9pbnRzIGFyZSBnbG9iYWwgd2hlcmVhcyBibG9jayBpbmRpY2VzIGFyZSBwZXIgc2hhZGVyIHByb2dyYW0KCgkJZnVuY3Rpb24gYmluZCggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJCWNvbnN0IHdlYmdsUHJvZ3JhbSA9IHByb2dyYW0ucHJvZ3JhbTsKCQkJc3RhdGUudW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgd2ViZ2xQcm9ncmFtICk7CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKCQkJbGV0IGJ1ZmZlciA9IGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXTsKCgkJCWlmICggYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKTsKCgkJCQlidWZmZXIgPSBjcmVhdGVCdWZmZXIoIHVuaWZvcm1zR3JvdXAgKTsKCQkJCWJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXSA9IGJ1ZmZlcjsKCgkJCQl1bmlmb3Jtc0dyb3VwLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25Vbmlmb3Jtc0dyb3Vwc0Rpc3Bvc2UgKTsKCgkJCX0KCgkJCS8vIGVuc3VyZSB0byB1cGRhdGUgdGhlIGJpbmRpbmcgcG9pbnRzL2Jsb2NrIGluZGljZXMgbWFwcGluZyBmb3IgdGhpcyBwcm9ncmFtCgoJCQljb25zdCB3ZWJnbFByb2dyYW0gPSBwcm9ncmFtLnByb2dyYW07CgkJCXN0YXRlLnVwZGF0ZVVCT01hcHBpbmcoIHVuaWZvcm1zR3JvdXAsIHdlYmdsUHJvZ3JhbSApOwoKCQkJLy8gdXBkYXRlIFVCTyBvbmNlIHBlciBmcmFtZQoKCQkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJCWlmICggdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdICE9PSBmcmFtZSApIHsKCgkJCQl1cGRhdGVCdWZmZXJEYXRhKCB1bmlmb3Jtc0dyb3VwICk7CgoJCQkJdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdID0gZnJhbWU7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY3JlYXRlQnVmZmVyKCB1bmlmb3Jtc0dyb3VwICkgewoKCQkJLy8gdGhlIHNldHVwIG9mIGFuIFVCTyBpcyBpbmRlcGVuZGVudCBvZiBhIHBhcnRpY3VsYXIgc2hhZGVyIHByb2dyYW0gYnV0IGdsb2JhbAoKCQkJY29uc3QgYmluZGluZ1BvaW50SW5kZXggPSBhbGxvY2F0ZUJpbmRpbmdQb2ludEluZGV4KCk7CgkJCXVuaWZvcm1zR3JvdXAuX19iaW5kaW5nUG9pbnRJbmRleCA9IGJpbmRpbmdQb2ludEluZGV4OwoKCQkJY29uc3QgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCWNvbnN0IHNpemUgPSB1bmlmb3Jtc0dyb3VwLl9fc2l6ZTsKCQkJY29uc3QgdXNhZ2UgPSB1bmlmb3Jtc0dyb3VwLnVzYWdlOwoKCQkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIGJ1ZmZlciApOwoJCQlnbC5idWZmZXJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgc2l6ZSwgdXNhZ2UgKTsKCQkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCQkJZ2wuYmluZEJ1ZmZlckJhc2UoIGdsLlVOSUZPUk1fQlVGRkVSLCBiaW5kaW5nUG9pbnRJbmRleCwgYnVmZmVyICk7CgoJCQlyZXR1cm4gYnVmZmVyOwoKCQl9CgoJCWZ1bmN0aW9uIGFsbG9jYXRlQmluZGluZ1BvaW50SW5kZXgoKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXhCaW5kaW5nUG9pbnRzOyBpICsrICkgewoKCQkJCWlmICggYWxsb2NhdGVkQmluZGluZ1BvaW50cy5pbmRleE9mKCBpICkgPT09IC0xICkgewoKCQkJCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLnB1c2goIGkgKTsKCQkJCQlyZXR1cm4gaTsKCgkJCQl9CgoJCQl9CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogTWF4aW11bSBudW1iZXIgb2Ygc2ltdWx0YW5lb3VzbHkgdXNhYmxlIHVuaWZvcm1zIGdyb3VwcyByZWFjaGVkLicgKTsKCgkJCXJldHVybiAwOwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlckRhdGEoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCQljb25zdCBidWZmZXIgPSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgkJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCQkJY29uc3QgY2FjaGUgPSB1bmlmb3Jtc0dyb3VwLl9fY2FjaGU7CgoJCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgYnVmZmVyICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdW5pZm9ybXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgdW5pZm9ybUFycmF5ID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybXNbIGkgXSApID8gdW5pZm9ybXNbIGkgXSA6IFsgdW5pZm9ybXNbIGkgXSBdOwoKCQkJCWZvciAoIGxldCBqID0gMCwgamwgPSB1bmlmb3JtQXJyYXkubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm0gPSB1bmlmb3JtQXJyYXlbIGogXTsKCgkJCQkJaWYgKCBoYXNVbmlmb3JtQ2hhbmdlZCggdW5pZm9ybSwgaSwgaiwgY2FjaGUgKSA9PT0gdHJ1ZSApIHsKCgkJCQkJCWNvbnN0IG9mZnNldCA9IHVuaWZvcm0uX19vZmZzZXQ7CgoJCQkJCQljb25zdCB2YWx1ZXMgPSBBcnJheS5pc0FycmF5KCB1bmlmb3JtLnZhbHVlICkgPyB1bmlmb3JtLnZhbHVlIDogWyB1bmlmb3JtLnZhbHVlIF07CgoJCQkJCQlsZXQgYXJyYXlPZmZzZXQgPSAwOwoKCQkJCQkJZm9yICggbGV0IGsgPSAwOyBrIDwgdmFsdWVzLmxlbmd0aDsgayArKyApIHsKCgkJCQkJCQljb25zdCB2YWx1ZSA9IHZhbHVlc1sgayBdOwoKCQkJCQkJCWNvbnN0IGluZm8gPSBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKTsKCgkJCQkJCQkvLyBUT0RPIGFkZCBpbnRlZ2VyIGFuZCBzdHJ1Y3Qgc3VwcG9ydAoJCQkJCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMCBdID0gdmFsdWU7CgkJCQkJCQkJZ2wuYnVmZmVyU3ViRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIG9mZnNldCArIGFycmF5T2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKCQkJCQkJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4MyApIHsKCgkJCQkJCQkJLy8gbWFudWFsbHkgY29udmVydGluZyAzeDMgdG8gM3g0CgoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZS5lbGVtZW50c1sgMCBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxIF0gPSB2YWx1ZS5lbGVtZW50c1sgMSBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAyIF0gPSB2YWx1ZS5lbGVtZW50c1sgMiBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAzIF0gPSAwOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA0IF0gPSB2YWx1ZS5lbGVtZW50c1sgMyBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA1IF0gPSB2YWx1ZS5lbGVtZW50c1sgNCBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA2IF0gPSB2YWx1ZS5lbGVtZW50c1sgNSBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA3IF0gPSAwOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA4IF0gPSB2YWx1ZS5lbGVtZW50c1sgNiBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA5IF0gPSB2YWx1ZS5lbGVtZW50c1sgNyBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxMCBdID0gdmFsdWUuZWxlbWVudHNbIDggXTsKCQkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMTEgXSA9IDA7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJdmFsdWUudG9BcnJheSggdW5pZm9ybS5fX2RhdGEsIGFycmF5T2Zmc2V0ICk7CgoJCQkJCQkJCWFycmF5T2Zmc2V0ICs9IGluZm8uc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCQlnbC5idWZmZXJTdWJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgb2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYXNVbmlmb3JtQ2hhbmdlZCggdW5pZm9ybSwgaW5kZXgsIGluZGV4QXJyYXksIGNhY2hlICkgewoKCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoJCQljb25zdCBpbmRleFN0cmluZyA9IGluZGV4ICsgJ18nICsgaW5kZXhBcnJheTsKCgkJCWlmICggY2FjaGVbIGluZGV4U3RyaW5nIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBjYWNoZSBlbnRyeSBkb2VzIG5vdCBleGlzdCBzbyBmYXIKCgkJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgoJCQkJCWNhY2hlWyBpbmRleFN0cmluZyBdID0gdmFsdWU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY2FjaGVbIGluZGV4U3RyaW5nIF0gPSB2YWx1ZS5jbG9uZSgpOwoKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgY2FjaGVkT2JqZWN0ID0gY2FjaGVbIGluZGV4U3RyaW5nIF07CgoJCQkJLy8gY29tcGFyZSBjdXJyZW50IHZhbHVlIHdpdGggY2FjaGVkIGVudHJ5CgoJCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJCQlpZiAoIGNhY2hlZE9iamVjdCAhPT0gdmFsdWUgKSB7CgoJCQkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlOwoJCQkJCQlyZXR1cm4gdHJ1ZTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggY2FjaGVkT2JqZWN0LmVxdWFscyggdmFsdWUgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCQljYWNoZWRPYmplY3QuY29weSggdmFsdWUgKTsKCQkJCQkJcmV0dXJuIHRydWU7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJZnVuY3Rpb24gcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCQkvLyBkZXRlcm1pbmUgdG90YWwgYnVmZmVyIHNpemUgYWNjb3JkaW5nIHRvIHRoZSBTVEQxNDAgbGF5b3V0CgkJCS8vIEhpbnQ6IFNURDE0MCBpcyB0aGUgb25seSBzdXBwb3J0ZWQgbGF5b3V0IGluIFdlYkdMIDIKCgkJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCgkJCWxldCBvZmZzZXQgPSAwOyAvLyBnbG9iYWwgYnVmZmVyIG9mZnNldCBpbiBieXRlcwoJCQljb25zdCBjaHVua1NpemUgPSAxNjsgLy8gc2l6ZSBvZiBhIGNodW5rIGluIGJ5dGVzCgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1bmlmb3Jtcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IHVuaWZvcm1BcnJheSA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm1zWyBpIF0gKSA/IHVuaWZvcm1zWyBpIF0gOiBbIHVuaWZvcm1zWyBpIF0gXTsKCgkJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gdW5pZm9ybUFycmF5Lmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQljb25zdCB1bmlmb3JtID0gdW5pZm9ybUFycmF5WyBqIF07CgoJCQkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm0udmFsdWUgKSA/IHVuaWZvcm0udmFsdWUgOiBbIHVuaWZvcm0udmFsdWUgXTsKCgkJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IHZhbHVlcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCgkJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBrIF07CgoJCQkJCQljb25zdCBpbmZvID0gZ2V0VW5pZm9ybVNpemUoIHZhbHVlICk7CgoJCQkJCQljb25zdCBjaHVua09mZnNldCA9IG9mZnNldCAlIGNodW5rU2l6ZTsgLy8gb2Zmc2V0IGluIHRoZSBjdXJyZW50IGNodW5rCgkJCQkJCWNvbnN0IGNodW5rUGFkZGluZyA9IGNodW5rT2Zmc2V0ICUgaW5mby5ib3VuZGFyeTsgLy8gcmVxdWlyZWQgcGFkZGluZyB0byBtYXRjaCBib3VuZGFyeQoJCQkJCQljb25zdCBjaHVua1N0YXJ0ID0gY2h1bmtPZmZzZXQgKyBjaHVua1BhZGRpbmc7IC8vIHRoZSBzdGFydCBwb3NpdGlvbiBpbiB0aGUgY3VycmVudCBjaHVuayBmb3IgdGhlIGRhdGEKCgkJCQkJCW9mZnNldCArPSBjaHVua1BhZGRpbmc7CgoJCQkJCQkvLyBDaGVjayBmb3IgY2h1bmsgb3ZlcmZsb3cKCQkJCQkJaWYgKCBjaHVua1N0YXJ0ICE9PSAwICYmICggY2h1bmtTaXplIC0gY2h1bmtTdGFydCApIDwgaW5mby5zdG9yYWdlICkgewoKCQkJCQkJCS8vIEFkZCBwYWRkaW5nIGFuZCBhZGp1c3Qgb2Zmc2V0CgkJCQkJCQlvZmZzZXQgKz0gKCBjaHVua1NpemUgLSBjaHVua1N0YXJ0ICk7CgoJCQkJCQl9CgoJCQkJCQkvLyB0aGUgZm9sbG93aW5nIHR3byBwcm9wZXJ0aWVzIHdpbGwgYmUgdXNlZCBmb3IgcGFydGlhbCBidWZmZXIgdXBkYXRlcwoJCQkJCQl1bmlmb3JtLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoIGluZm8uc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCApOwoJCQkJCQl1bmlmb3JtLl9fb2Zmc2V0ID0gb2Zmc2V0OwoKCQkJCQkJLy8gVXBkYXRlIHRoZSBnbG9iYWwgb2Zmc2V0CgkJCQkJCW9mZnNldCArPSBpbmZvLnN0b3JhZ2U7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvLyBlbnN1cmUgY29ycmVjdCBmaW5hbCBwYWRkaW5nCgoJCQljb25zdCBjaHVua09mZnNldCA9IG9mZnNldCAlIGNodW5rU2l6ZTsKCgkJCWlmICggY2h1bmtPZmZzZXQgPiAwICkgb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXQgKTsKCgkJCS8vCgoJCQl1bmlmb3Jtc0dyb3VwLl9fc2l6ZSA9IG9mZnNldDsKCQkJdW5pZm9ybXNHcm91cC5fX2NhY2hlID0ge307CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlmdW5jdGlvbiBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKSB7CgoJCQljb25zdCBpbmZvID0gewoJCQkJYm91bmRhcnk6IDAsIC8vIGJ5dGVzCgkJCQlzdG9yYWdlOiAwIC8vIGJ5dGVzCgkJCX07CgoJCQkvLyBkZXRlcm1pbmUgc2l6ZXMgYWNjb3JkaW5nIHRvIFNURDE0MAoKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJCS8vIGZsb2F0L2ludC9ib29sCgoJCQkJaW5mby5ib3VuZGFyeSA9IDQ7CgkJCQlpbmZvLnN0b3JhZ2UgPSA0OwoKCQkJfSBlbHNlIGlmICggdmFsdWUuaXNWZWN0b3IyICkgewoKCQkJCS8vIHZlYzIKCgkJCQlpbmZvLmJvdW5kYXJ5ID0gODsKCQkJCWluZm8uc3RvcmFnZSA9IDg7CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1ZlY3RvcjMgfHwgdmFsdWUuaXNDb2xvciApIHsKCgkJCQkvLyB2ZWMzCgoJCQkJaW5mby5ib3VuZGFyeSA9IDE2OwoJCQkJaW5mby5zdG9yYWdlID0gMTI7IC8vIGV2aWw6IHZlYzMgbXVzdCBzdGFydCBvbiBhIDE2LWJ5dGUgYm91bmRhcnkgYnV0IGl0IG9ubHkgY29uc3VtZXMgMTIgYnl0ZXMKCgkJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVmVjdG9yNCApIHsKCgkJCQkvLyB2ZWM0CgoJCQkJaW5mby5ib3VuZGFyeSA9IDE2OwoJCQkJaW5mby5zdG9yYWdlID0gMTY7CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDMgKSB7CgoJCQkJLy8gbWF0MyAoaW4gU1REMTQwIGEgM3gzIG1hdHJpeCBpcyByZXByZXNlbnRlZCBhcyAzeDQpCgoJCQkJaW5mby5ib3VuZGFyeSA9IDQ4OwoJCQkJaW5mby5zdG9yYWdlID0gNDg7CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDQgKSB7CgoJCQkJLy8gbWF0NAoKCQkJCWluZm8uYm91bmRhcnkgPSA2NDsKCQkJCWluZm8uc3RvcmFnZSA9IDY0OwoKCQkJfSBlbHNlIGlmICggdmFsdWUuaXNUZXh0dXJlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgc2FtcGxlcnMgY2FuIG5vdCBiZSBwYXJ0IG9mIGFuIHVuaWZvcm1zIGdyb3VwLicgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5zdXBwb3J0ZWQgdW5pZm9ybSB2YWx1ZSB0eXBlLicsIHZhbHVlICk7CgoJCQl9CgoJCQlyZXR1cm4gaW5mbzsKCgkJfQoKCQlmdW5jdGlvbiBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB1bmlmb3Jtc0dyb3VwID0gZXZlbnQudGFyZ2V0OwoKCQkJdW5pZm9ybXNHcm91cC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVW5pZm9ybXNHcm91cHNEaXNwb3NlICk7CgoJCQljb25zdCBpbmRleCA9IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMuaW5kZXhPZiggdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ICk7CgkJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMuc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF0gKTsKCgkJCWRlbGV0ZSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgkJCWRlbGV0ZSB1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF07CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCWZvciAoIGNvbnN0IGlkIGluIGJ1ZmZlcnMgKSB7CgoJCQkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyBpZCBdICk7CgoJCQl9CgoJCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzID0gW107CgkJCWJ1ZmZlcnMgPSB7fTsKCQkJdXBkYXRlTGlzdCA9IHt9OwoKCQl9CgoJCXJldHVybiB7CgoJCQliaW5kOiBiaW5kLAoJCQl1cGRhdGU6IHVwZGF0ZSwKCgkJCWRpc3Bvc2U6IGRpc3Bvc2UKCgkJfTsKCgl9CgoJLyoqCgkgKiBUaGlzIHJlbmRlcmVyIHVzZXMgV2ViR0wgMiB0byBkaXNwbGF5IHNjZW5lcy4KCSAqCgkgKiBXZWJHTCAxIGlzIG5vdCBzdXBwb3J0ZWQgc2luY2UgYHIxNjNgLgoJICovCgljbGFzcyBXZWJHTFJlbmRlcmVyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBXZWJHTCByZW5kZXJlci4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn5PcHRpb25zfSBbcGFyYW1ldGVyc10gLSBUaGUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIuCgkJICovCgkJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgPSB7fSApIHsKCgkJCWNvbnN0IHsKCQkJCWNhbnZhcyA9IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKSwKCQkJCWNvbnRleHQgPSBudWxsLAoJCQkJZGVwdGggPSB0cnVlLAoJCQkJc3RlbmNpbCA9IGZhbHNlLAoJCQkJYWxwaGEgPSBmYWxzZSwKCQkJCWFudGlhbGlhcyA9IGZhbHNlLAoJCQkJcHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZSwKCQkJCXByZXNlcnZlRHJhd2luZ0J1ZmZlciA9IGZhbHNlLAoJCQkJcG93ZXJQcmVmZXJlbmNlID0gJ2RlZmF1bHQnLAoJCQkJZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCA9IGZhbHNlLAoJCQkJcmV2ZXJzZURlcHRoQnVmZmVyID0gZmFsc2UsCgkJCX0gPSBwYXJhbWV0ZXJzOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNXZWJHTFJlbmRlcmVyID0gdHJ1ZTsKCgkJCWxldCBfYWxwaGE7CgoJCQlpZiAoIGNvbnRleHQgIT09IG51bGwgKSB7CgoJCQkJaWYgKCB0eXBlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICE9PSAndW5kZWZpbmVkJyAmJiBjb250ZXh0IGluc3RhbmNlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICkgewoKCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBXZWJHTCAxIGlzIG5vdCBzdXBwb3J0ZWQgc2luY2UgcjE2My4nICk7CgoJCQkJfQoKCQkJCV9hbHBoYSA9IGNvbnRleHQuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKS5hbHBoYTsKCgkJCX0gZWxzZSB7CgoJCQkJX2FscGhhID0gYWxwaGE7CgoJCQl9CgoJCQljb25zdCB1aW50Q2xlYXJDb2xvciA9IG5ldyBVaW50MzJBcnJheSggNCApOwoJCQljb25zdCBpbnRDbGVhckNvbG9yID0gbmV3IEludDMyQXJyYXkoIDQgKTsKCgkJCWxldCBjdXJyZW50UmVuZGVyTGlzdCA9IG51bGw7CgkJCWxldCBjdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkJLy8gcmVuZGVyKCkgY2FuIGJlIGNhbGxlZCBmcm9tIHdpdGhpbiBhIGNhbGxiYWNrIHRyaWdnZXJlZCBieSBhbm90aGVyIHJlbmRlci4KCQkJLy8gV2UgdHJhY2sgdGhpcyBzbyB0aGF0IHRoZSBuZXN0ZWQgcmVuZGVyIGNhbGwgZ2V0cyBpdHMgbGlzdCBhbmQgc3RhdGUgaXNvbGF0ZWQgZnJvbSB0aGUgcGFyZW50IHJlbmRlciBjYWxsLgoKCQkJY29uc3QgcmVuZGVyTGlzdFN0YWNrID0gW107CgkJCWNvbnN0IHJlbmRlclN0YXRlU3RhY2sgPSBbXTsKCgkJCS8vIHB1YmxpYyBwcm9wZXJ0aWVzCgoJCQkvKioKCQkJICogQSBjYW52YXMgd2hlcmUgdGhlIHJlbmRlcmVyIGRyYXdzIGl0cyBvdXRwdXQuVGhpcyBpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgYnkgdGhlIHJlbmRlcmVyCgkJCSAqIGluIHRoZSBjb25zdHJ1Y3RvciAoaWYgbm90IHByb3ZpZGVkIGFscmVhZHkpOyB5b3UganVzdCBuZWVkIHRvIGFkZCBpdCB0byB5b3VyIHBhZ2UgbGlrZSBzbzoKCQkJICogYGBganMKCQkJICogZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggcmVuZGVyZXIuZG9tRWxlbWVudCApOwoJCQkgKiBgYGAKCQkJICoKCQkJICogQHR5cGUge0RPTUVsZW1lbnR9CgkJCSAqLwoJCQl0aGlzLmRvbUVsZW1lbnQgPSBjYW52YXM7CgoJCQkvKioKCQkJICogQSBvYmplY3Qgd2l0aCBkZWJ1ZyBjb25maWd1cmF0aW9uIHNldHRpbmdzLgoJCQkgKgoJCQkgKiAtIGBjaGVja1NoYWRlckVycm9yc2A6IElmIGl0IGlzIGB0cnVlYCwgZGVmaW5lcyB3aGV0aGVyIG1hdGVyaWFsIHNoYWRlciBwcm9ncmFtcyBhcmUKCQkJICogY2hlY2tlZCBmb3IgZXJyb3JzIGR1cmluZyBjb21waWxhdGlvbiBhbmQgbGlua2FnZSBwcm9jZXNzLiBJdCBtYXkgYmUgdXNlZnVsIHRvIGRpc2FibGUKCQkJICogdGhpcyBjaGVjayBpbiBwcm9kdWN0aW9uIGZvciBwZXJmb3JtYW5jZSBnYWluLiBJdCBpcyBzdHJvbmdseSByZWNvbW1lbmRlZCB0byBrZWVwIHRoZXNlCgkJCSAqIGNoZWNrcyBlbmFibGVkIGR1cmluZyBkZXZlbG9wbWVudC4gSWYgdGhlIHNoYWRlciBkb2VzIG5vdCBjb21waWxlIGFuZCBsaW5rIC0gaXQgd2lsbCBub3QKCQkJICogd29yayBhbmQgYXNzb2NpYXRlZCBtYXRlcmlhbCB3aWxsIG5vdCByZW5kZXIuCgkJCSAqIC0gYG9uU2hhZGVyRXJyb3IoZ2wsIHByb2dyYW0sIGdsVmVydGV4U2hhZGVyLGdsRnJhZ21lbnRTaGFkZXIpYDogQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0CgkJCSAqIGNhbiBiZSB1c2VkIGZvciBjdXN0b20gZXJyb3IgcmVwb3J0aW5nLiBUaGUgY2FsbGJhY2sgcmVjZWl2ZXMgdGhlIFdlYkdMIGNvbnRleHQsIGFuIGluc3RhbmNlCgkJCSAqIG9mIFdlYkdMUHJvZ3JhbSBhcyB3ZWxsIHR3byBpbnN0YW5jZXMgb2YgV2ViR0xTaGFkZXIgcmVwcmVzZW50aW5nIHRoZSB2ZXJ0ZXggYW5kIGZyYWdtZW50IHNoYWRlci4KCQkJICogQXNzaWduaW5nIGEgY3VzdG9tIGZ1bmN0aW9uIGRpc2FibGVzIHRoZSBkZWZhdWx0IGVycm9yIHJlcG9ydGluZy4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMuZGVidWcgPSB7CgoJCQkJLyoqCgkJCQkgKiBFbmFibGVzIGVycm9yIGNoZWNraW5nIGFuZCByZXBvcnRpbmcgd2hlbiBzaGFkZXIgcHJvZ3JhbXMgYXJlIGJlaW5nIGNvbXBpbGVkLgoJCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCQkgKi8KCQkJCWNoZWNrU2hhZGVyRXJyb3JzOiB0cnVlLAoJCQkJLyoqCgkJCQkgKiBDYWxsYmFjayBmb3IgY3VzdG9tIGVycm9yIHJlcG9ydGluZy4KCQkJCSAqIEB0eXBlIHs/RnVuY3Rpb259CgkJCQkgKi8KCQkJCW9uU2hhZGVyRXJyb3I6IG51bGwKCQkJfTsKCgkJCS8vIGNsZWFyaW5nCgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGF1dG9tYXRpY2FsbHkgY2xlYXIgaXRzIG91dHB1dCBiZWZvcmUgcmVuZGVyaW5nIGEgZnJhbWUgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5hdXRvQ2xlYXIgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIElmIHtAbGluayBXZWJHTFJlbmRlcmVyI2F1dG9DbGVhcn0gc2V0IHRvIGB0cnVlYCwgd2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGNsZWFyCgkJCSAqIHRoZSBjb2xvciBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5hdXRvQ2xlYXJDb2xvciA9IHRydWU7CgoJCQkvKioKCQkJICogSWYge0BsaW5rIFdlYkdMUmVuZGVyZXIjYXV0b0NsZWFyfSBzZXQgdG8gYHRydWVgLCB3aGV0aGVyIHRoZSByZW5kZXJlciBzaG91bGQgY2xlYXIKCQkJICogdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmF1dG9DbGVhckRlcHRoID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBJZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNhdXRvQ2xlYXJ9IHNldCB0byBgdHJ1ZWAsIHdoZXRoZXIgdGhlIHJlbmRlcmVyIHNob3VsZCBjbGVhcgoJCQkgKiB0aGUgc3RlbmNpbCBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5hdXRvQ2xlYXJTdGVuY2lsID0gdHJ1ZTsKCgkJCS8vIHNjZW5lIGdyYXBoCgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIHNvcnQgb2JqZWN0cyBvciBub3QuCgkJCSAqCgkJCSAqIE5vdGU6IFNvcnRpbmcgaXMgdXNlZCB0byBhdHRlbXB0IHRvIHByb3Blcmx5IHJlbmRlciBvYmplY3RzIHRoYXQgaGF2ZSBzb21lCgkJCSAqIGRlZ3JlZSBvZiB0cmFuc3BhcmVuY3kuIEJ5IGRlZmluaXRpb24sIHNvcnRpbmcgb2JqZWN0cyBtYXkgbm90IHdvcmsgaW4gYWxsCgkJCSAqIGNhc2VzLiBEZXBlbmRpbmcgb24gdGhlIG5lZWRzIG9mIGFwcGxpY2F0aW9uLCBpdCBtYXkgYmUgbmVjZXNzYXJ5IHRvIHR1cm4KCQkJICogb2ZmIHNvcnRpbmcgYW5kIHVzZSBvdGhlciBtZXRob2RzIHRvIGRlYWwgd2l0aCB0cmFuc3BhcmVuY3kgcmVuZGVyaW5nIGUuZy4KCQkJICogbWFudWFsbHkgZGV0ZXJtaW5pbmcgZWFjaCBvYmplY3QncyByZW5kZXJpbmcgb3JkZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLnNvcnRPYmplY3RzID0gdHJ1ZTsKCgkJCS8vIHVzZXItZGVmaW5lZCBjbGlwcGluZwoKCQkJLyoqCgkJCSAqIFVzZXItZGVmaW5lZCBjbGlwcGluZyBwbGFuZXMgc3BlY2lmaWVkIGluIHdvcmxkIHNwYWNlLiBUaGVzZSBwbGFuZXMgYXBwbHkgZ2xvYmFsbHkuCgkJCSAqIFBvaW50cyBpbiBzcGFjZSB3aG9zZSBkb3QgcHJvZHVjdCB3aXRoIHRoZSBwbGFuZSBpcyBuZWdhdGl2ZSBhcmUgY3V0IGF3YXkuCgkJCSAqCgkJCSAqIEB0eXBlIHtBcnJheTxQbGFuZT59CgkJCSAqLwoJCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gW107CgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgcmVzcGVjdHMgb2JqZWN0LWxldmVsIGNsaXBwaW5nIHBsYW5lcyBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwoKCQkJLy8gdG9uZSBtYXBwaW5nCgoJCQkvKioKCQkJICogVGhlIHRvbmUgbWFwcGluZyB0ZWNobmlxdWUgb2YgdGhlIHJlbmRlcmVyLgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5vVG9uZU1hcHBpbmd8TGluZWFyVG9uZU1hcHBpbmd8UmVpbmhhcmRUb25lTWFwcGluZ3xDaW5lb25Ub25lTWFwcGluZ3xBQ0VTRmlsbWljVG9uZU1hcHBpbmd8Q3VzdG9tVG9uZU1hcHBpbmd8QWdYVG9uZU1hcHBpbmd8TmV1dHJhbFRvbmVNYXBwaW5nKX0KCQkJICogQGRlZmF1bHQgTm9Ub25lTWFwcGluZwoJCQkgKi8KCQkJdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQkvKioKCQkJICogRXhwb3N1cmUgbGV2ZWwgb2YgdG9uZSBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnRvbmVNYXBwaW5nRXhwb3N1cmUgPSAxLjA7CgoJCQkvLyB0cmFuc21pc3Npb24KCgkJCS8qKgoJCQkgKiBUaGUgbm9ybWFsaXplZCByZXNvbHV0aW9uIHNjYWxlIGZvciB0aGUgdHJhbnNtaXNzaW9uIHJlbmRlciB0YXJnZXQsIG1lYXN1cmVkIGluIHBlcmNlbnRhZ2UKCQkJICogb2Ygdmlld3BvcnQgZGltZW5zaW9ucy4gTG93ZXJpbmcgdGhpcyB2YWx1ZSBjYW4gcmVzdWx0IGluIHNpZ25pZmljYW50IHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cwoJCQkgKiB3aGVuIHVzaW5nIHtAbGluayBNZXNoUGh5c2ljYWxNYXRlcmlhbCN0cmFuc21pc3Npb259LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnRyYW5zbWlzc2lvblJlc29sdXRpb25TY2FsZSA9IDEuMDsKCgkJCS8vIGludGVybmFsIHByb3BlcnRpZXMKCgkJCWNvbnN0IF90aGlzID0gdGhpczsKCgkJCWxldCBfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKCQkJLy8gaW50ZXJuYWwgc3RhdGUgY2FjaGUKCgkJCXRoaXMuX291dHB1dENvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZTsKCgkJCWxldCBfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gMDsKCQkJbGV0IF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoJCQlsZXQgX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwoJCQlsZXQgX2N1cnJlbnRNYXRlcmlhbElkID0gLTE7CgoJCQlsZXQgX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKCQkJY29uc3QgX2N1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgkJCWNvbnN0IF9jdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCk7CgkJCWxldCBfY3VycmVudFNjaXNzb3JUZXN0ID0gbnVsbDsKCgkJCWNvbnN0IF9jdXJyZW50Q2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQkJbGV0IF9jdXJyZW50Q2xlYXJBbHBoYSA9IDA7CgoJCQkvLwoKCQkJbGV0IF93aWR0aCA9IGNhbnZhcy53aWR0aDsKCQkJbGV0IF9oZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwoKCQkJbGV0IF9waXhlbFJhdGlvID0gMTsKCQkJbGV0IF9vcGFxdWVTb3J0ID0gbnVsbDsKCQkJbGV0IF90cmFuc3BhcmVudFNvcnQgPSBudWxsOwoKCQkJY29uc3QgX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoIDAsIDAsIF93aWR0aCwgX2hlaWdodCApOwoJCQljb25zdCBfc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCBfd2lkdGgsIF9oZWlnaHQgKTsKCQkJbGV0IF9zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQkJLy8gZnJ1c3R1bQoKCQkJY29uc3QgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKCQkJLy8gY2xpcHBpbmcKCgkJCWxldCBfY2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CgkJCWxldCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZTsKCgkJCS8vIGNhbWVyYSBtYXRyaWNlcyBjYWNoZQoKCQkJY29uc3QgX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQkJY29uc3QgX3Byb2pTY3JlZW5NYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKCQkJY29uc3QgX3ZlY3RvcjMgPSBuZXcgVmVjdG9yMygpOwoKCQkJY29uc3QgX3ZlY3RvcjQgPSBuZXcgVmVjdG9yNCgpOwoKCQkJY29uc3QgX2VtcHR5U2NlbmUgPSB7IGJhY2tncm91bmQ6IG51bGwsIGZvZzogbnVsbCwgZW52aXJvbm1lbnQ6IG51bGwsIG92ZXJyaWRlTWF0ZXJpYWw6IG51bGwsIGlzU2NlbmU6IHRydWUgfTsKCgkJCWxldCBfcmVuZGVyQmFja2dyb3VuZCA9IGZhbHNlOwoKCQkJZnVuY3Rpb24gZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpIHsKCgkJCQlyZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfcGl4ZWxSYXRpbyA6IDE7CgoJCQl9CgoJCQkvLyBpbml0aWFsaXplCgoJCQlsZXQgX2dsID0gY29udGV4dDsKCgkJCWZ1bmN0aW9uIGdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApIHsKCgkJCQlyZXR1cm4gY2FudmFzLmdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApOwoKCQkJfQoKCQkJdHJ5IHsKCgkJCQljb25zdCBjb250ZXh0QXR0cmlidXRlcyA9IHsKCQkJCQlhbHBoYTogdHJ1ZSwKCQkJCQlkZXB0aCwKCQkJCQlzdGVuY2lsLAoJCQkJCWFudGlhbGlhcywKCQkJCQlwcmVtdWx0aXBsaWVkQWxwaGEsCgkJCQkJcHJlc2VydmVEcmF3aW5nQnVmZmVyLAoJCQkJCXBvd2VyUHJlZmVyZW5jZSwKCQkJCQlmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0LAoJCQkJfTsKCgkJCQkvLyBPZmZzY3JlZW5DYW52YXMgZG9lcyBub3QgaGF2ZSBzZXRBdHRyaWJ1dGUsIHNlZSAjMjI4MTEKCQkJCWlmICggJ3NldEF0dHJpYnV0ZScgaW4gY2FudmFzICkgY2FudmFzLnNldEF0dHJpYnV0ZSggJ2RhdGEtZW5naW5lJywgYHRocmVlLmpzIHIke1JFVklTSU9OfWAgKTsKCgkJCQkvLyBldmVudCBsaXN0ZW5lcnMgbXVzdCBiZSByZWdpc3RlcmVkIGJlZm9yZSBXZWJHTCBjb250ZXh0IGlzIGNyZWF0ZWQsIHNlZSAjMTI3NTMKCQkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0bG9zdCcsIG9uQ29udGV4dExvc3QsIGZhbHNlICk7CgkJCQljYW52YXMuYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKCQkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0Y3JlYXRpb25lcnJvcicsIG9uQ29udGV4dENyZWF0aW9uRXJyb3IsIGZhbHNlICk7CgoJCQkJaWYgKCBfZ2wgPT09IG51bGwgKSB7CgoJCQkJCWNvbnN0IGNvbnRleHROYW1lID0gJ3dlYmdsMic7CgoJCQkJCV9nbCA9IGdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApOwoKCQkJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCgkJCQkJCWlmICggZ2V0Q29udGV4dCggY29udGV4dE5hbWUgKSApIHsKCgkJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0IHdpdGggeW91ciBzZWxlY3RlZCBhdHRyaWJ1dGVzLicgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4nICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6ICcgKyBlcnJvci5tZXNzYWdlICk7CgkJCQl0aHJvdyBlcnJvcjsKCgkJCX0KCgkJCWxldCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIHN0YXRlLCBpbmZvOwoJCQlsZXQgcHJvcGVydGllcywgdGV4dHVyZXMsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBhdHRyaWJ1dGVzLCBnZW9tZXRyaWVzLCBvYmplY3RzOwoJCQlsZXQgcHJvZ3JhbUNhY2hlLCBtYXRlcmlhbHMsIHJlbmRlckxpc3RzLCByZW5kZXJTdGF0ZXMsIGNsaXBwaW5nLCBzaGFkb3dNYXA7CgoJCQlsZXQgYmFja2dyb3VuZCwgbW9ycGh0YXJnZXRzLCBidWZmZXJSZW5kZXJlciwgaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwoKCQkJbGV0IHV0aWxzLCBiaW5kaW5nU3RhdGVzLCB1bmlmb3Jtc0dyb3VwczsKCgkJCWZ1bmN0aW9uIGluaXRHTENvbnRleHQoKSB7CgoJCQkJZXh0ZW5zaW9ucyA9IG5ldyBXZWJHTEV4dGVuc2lvbnMoIF9nbCApOwoJCQkJZXh0ZW5zaW9ucy5pbml0KCk7CgoJCQkJdXRpbHMgPSBuZXcgV2ViR0xVdGlscyggX2dsLCBleHRlbnNpb25zICk7CgoJCQkJY2FwYWJpbGl0aWVzID0gbmV3IFdlYkdMQ2FwYWJpbGl0aWVzKCBfZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHV0aWxzICk7CgoJCQkJc3RhdGUgPSBuZXcgV2ViR0xTdGF0ZSggX2dsLCBleHRlbnNpb25zICk7CgoJCQkJaWYgKCBjYXBhYmlsaXRpZXMucmV2ZXJzZURlcHRoQnVmZmVyICYmIHJldmVyc2VEZXB0aEJ1ZmZlciApIHsKCgkJCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRSZXZlcnNlZCggdHJ1ZSApOwoKCQkJCX0KCgkJCQlpbmZvID0gbmV3IFdlYkdMSW5mbyggX2dsICk7CgkJCQlwcm9wZXJ0aWVzID0gbmV3IFdlYkdMUHJvcGVydGllcygpOwoJCQkJdGV4dHVyZXMgPSBuZXcgV2ViR0xUZXh0dXJlcyggX2dsLCBleHRlbnNpb25zLCBzdGF0ZSwgcHJvcGVydGllcywgY2FwYWJpbGl0aWVzLCB1dGlscywgaW5mbyApOwoJCQkJY3ViZW1hcHMgPSBuZXcgV2ViR0xDdWJlTWFwcyggX3RoaXMgKTsKCQkJCWN1YmV1dm1hcHMgPSBuZXcgV2ViR0xDdWJlVVZNYXBzKCBfdGhpcyApOwoJCQkJYXR0cmlidXRlcyA9IG5ldyBXZWJHTEF0dHJpYnV0ZXMoIF9nbCApOwoJCQkJYmluZGluZ1N0YXRlcyA9IG5ldyBXZWJHTEJpbmRpbmdTdGF0ZXMoIF9nbCwgYXR0cmlidXRlcyApOwoJCQkJZ2VvbWV0cmllcyA9IG5ldyBXZWJHTEdlb21ldHJpZXMoIF9nbCwgYXR0cmlidXRlcywgaW5mbywgYmluZGluZ1N0YXRlcyApOwoJCQkJb2JqZWN0cyA9IG5ldyBXZWJHTE9iamVjdHMoIF9nbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApOwoJCQkJbW9ycGh0YXJnZXRzID0gbmV3IFdlYkdMTW9ycGh0YXJnZXRzKCBfZ2wsIGNhcGFiaWxpdGllcywgdGV4dHVyZXMgKTsKCQkJCWNsaXBwaW5nID0gbmV3IFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKTsKCQkJCXByb2dyYW1DYWNoZSA9IG5ldyBXZWJHTFByb2dyYW1zKCBfdGhpcywgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcgKTsKCQkJCW1hdGVyaWFscyA9IG5ldyBXZWJHTE1hdGVyaWFscyggX3RoaXMsIHByb3BlcnRpZXMgKTsKCQkJCXJlbmRlckxpc3RzID0gbmV3IFdlYkdMUmVuZGVyTGlzdHMoKTsKCQkJCXJlbmRlclN0YXRlcyA9IG5ldyBXZWJHTFJlbmRlclN0YXRlcyggZXh0ZW5zaW9ucyApOwoJCQkJYmFja2dyb3VuZCA9IG5ldyBXZWJHTEJhY2tncm91bmQoIF90aGlzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgc3RhdGUsIG9iamVjdHMsIF9hbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgkJCQlzaGFkb3dNYXAgPSBuZXcgV2ViR0xTaGFkb3dNYXAoIF90aGlzLCBvYmplY3RzLCBjYXBhYmlsaXRpZXMgKTsKCQkJCXVuaWZvcm1zR3JvdXBzID0gbmV3IFdlYkdMVW5pZm9ybXNHcm91cHMoIF9nbCwgaW5mbywgY2FwYWJpbGl0aWVzLCBzdGF0ZSApOwoKCQkJCWJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMQnVmZmVyUmVuZGVyZXIoIF9nbCwgZXh0ZW5zaW9ucywgaW5mbyApOwoJCQkJaW5kZXhlZEJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKCBfZ2wsIGV4dGVuc2lvbnMsIGluZm8gKTsKCgkJCQlpbmZvLnByb2dyYW1zID0gcHJvZ3JhbUNhY2hlLnByb2dyYW1zOwoKCQkJCS8qKgoJCQkJICogSG9sZHMgZGV0YWlscyBhYm91dCB0aGUgY2FwYWJpbGl0aWVzIG9mIHRoZSBjdXJyZW50IHJlbmRlcmluZyBjb250ZXh0LgoJCQkJICoKCQkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjY2FwYWJpbGl0aWVzCgkJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5DYXBhYmlsaXRpZXN9CgkJCQkgKi8KCQkJCV90aGlzLmNhcGFiaWxpdGllcyA9IGNhcGFiaWxpdGllczsKCgkJCQkvKioKCQkJCSAqIFByb3ZpZGVzIG1ldGhvZHMgZm9yIHJldHJpZXZpbmcgYW5kIHRlc3RpbmcgV2ViR0wgZXh0ZW5zaW9ucy4KCQkJCSAqCgkJCQkgKiAtIGBnZXQoZXh0ZW5zaW9uTmFtZTpzdHJpbmcpYDogVXNlZCB0byBjaGVjayB3aGV0aGVyIGEgV2ViR0wgZXh0ZW5zaW9uIGlzIHN1cHBvcnRlZAoJCQkJICogYW5kIHJldHVybiB0aGUgZXh0ZW5zaW9uIG9iamVjdCBpZiBhdmFpbGFibGUuCgkJCQkgKiAtIGBoYXMoZXh0ZW5zaW9uTmFtZTpzdHJpbmcpYDogcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGV4dGVuc2lvbiBpcyBzdXBwb3J0ZWQuCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNleHRlbnNpb25zCgkJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkJICovCgkJCQlfdGhpcy5leHRlbnNpb25zID0gZXh0ZW5zaW9uczsKCgkJCQkvKioKCQkJCSAqIFVzZWQgdG8gdHJhY2sgcHJvcGVydGllcyBvZiBvdGhlciBvYmplY3RzIGxpa2UgbmF0aXZlIFdlYkdMIG9iamVjdHMuCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNwcm9wZXJ0aWVzCgkJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkJICovCgkJCQlfdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKCgkJCQkvKioKCQkJCSAqIE1hbmFnZXMgdGhlIHJlbmRlciBsaXN0cyBvZiB0aGUgcmVuZGVyZXIuCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNyZW5kZXJMaXN0cwoJCQkJICogQHR5cGUge09iamVjdH0KCQkJCSAqLwoJCQkJX3RoaXMucmVuZGVyTGlzdHMgPSByZW5kZXJMaXN0czsKCgoKCQkJCS8qKgoJCQkJICogSW50ZXJmYWNlIGZvciBtYW5hZ2luZyBzaGFkb3dzLgoJCQkJICoKCQkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjc2hhZG93TWFwCgkJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5TaGFkb3dNYXB9CgkJCQkgKi8KCQkJCV90aGlzLnNoYWRvd01hcCA9IHNoYWRvd01hcDsKCgkJCQkvKioKCQkJCSAqIEludGVyZmFjZSBmb3IgbWFuYWdpbmcgdGhlIFdlYkdMIHN0YXRlLgoJCQkJICoKCQkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjc3RhdGUKCQkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCQkgKi8KCQkJCV90aGlzLnN0YXRlID0gc3RhdGU7CgoJCQkJLyoqCgkJCQkgKiBIb2xkcyBhIHNlcmllcyBvZiBzdGF0aXN0aWNhbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgR1BVIG1lbW9yeQoJCQkJICogYW5kIHRoZSByZW5kZXJpbmcgcHJvY2Vzcy4gVXNlZnVsIGZvciBkZWJ1Z2dpbmcgYW5kIG1vbml0b3JpbmcuCgkJCQkgKgoJCQkJICogQnkgZGVmYXVsdCB0aGVzZSBkYXRhIGFyZSByZXNldCBhdCBlYWNoIHJlbmRlciBjYWxsIGJ1dCB3aGVuIGhhdmluZwoJCQkJICogbXVsdGlwbGUgcmVuZGVyIHBhc3NlcyBwZXIgZnJhbWUgKGUuZy4gd2hlbiB1c2luZyBwb3N0IHByb2Nlc3NpbmcpIGl0IGNhbgoJCQkJICogYmUgcHJlZmVycmVkIHRvIHJlc2V0IHdpdGggYSBjdXN0b20gcGF0dGVybi4gRmlyc3QsIHNldCBgYXV0b1Jlc2V0YCB0bwoJCQkJICogYGZhbHNlYC4KCQkJCSAqIGBgYGpzCgkJCQkgKiByZW5kZXJlci5pbmZvLmF1dG9SZXNldCA9IGZhbHNlOwoJCQkJICogYGBgCgkJCQkgKiBDYWxsIGByZXNldCgpYCB3aGVuZXZlciB5b3UgaGF2ZSBmaW5pc2hlZCB0byByZW5kZXIgYSBzaW5nbGUgZnJhbWUuCgkJCQkgKiBgYGBqcwoJCQkJICogcmVuZGVyZXIuaW5mby5yZXNldCgpOwoJCQkJICogYGBgCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNpbmZvCgkJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5JbmZvfQoJCQkJICovCgkJCQlfdGhpcy5pbmZvID0gaW5mbzsKCgkJCX0KCgkJCWluaXRHTENvbnRleHQoKTsKCgkJCS8vIHhyCgoJCQljb25zdCB4ciA9IG5ldyBXZWJYUk1hbmFnZXIoIF90aGlzLCBfZ2wgKTsKCgkJCS8qKgoJCQkgKiBBIHJlZmVyZW5jZSB0byB0aGUgWFIgbWFuYWdlci4KCQkJICoKCQkJICogQHR5cGUge1dlYlhSTWFuYWdlcn0KCQkJICovCgkJCXRoaXMueHIgPSB4cjsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSByZW5kZXJpbmcgY29udGV4dC4KCQkJICoKCQkJICogQHJldHVybiB7V2ViR0wyUmVuZGVyaW5nQ29udGV4dH0gVGhlIHJlbmRlcmluZyBjb250ZXh0LgoJCQkgKi8KCQkJdGhpcy5nZXRDb250ZXh0ID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBfZ2w7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIHJlbmRlcmluZyBjb250ZXh0IGF0dHJpYnV0ZXMuCgkJCSAqCgkJCSAqIEByZXR1cm4ge1dlYkdMQ29udGV4dEF0dHJpYnV0ZXN9IFRoZSByZW5kZXJpbmcgY29udGV4dCBhdHRyaWJ1dGVzLgoJCQkgKi8KCQkJdGhpcy5nZXRDb250ZXh0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gX2dsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNpbXVsYXRlcyBhIGxvc3Mgb2YgdGhlIFdlYkdMIGNvbnRleHQuIFRoaXMgcmVxdWlyZXMgc3VwcG9ydCBmb3IgdGhlIGBXRUJHTF9sb3NlX2NvbnRleHRgIGV4dGVuc2lvbi4KCQkJICovCgkJCXRoaXMuZm9yY2VDb250ZXh0TG9zcyA9IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKCQkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLmxvc2VDb250ZXh0KCk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNpbXVsYXRlcyBhIHJlc3RvcmUgb2YgdGhlIFdlYkdMIGNvbnRleHQuIFRoaXMgcmVxdWlyZXMgc3VwcG9ydCBmb3IgdGhlIGBXRUJHTF9sb3NlX2NvbnRleHRgIGV4dGVuc2lvbi4KCQkJICovCgkJCXRoaXMuZm9yY2VDb250ZXh0UmVzdG9yZSA9IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKCQkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLnJlc3RvcmVDb250ZXh0KCk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIHBpeGVsIHJhdGlvLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBwaXhlbCByYXRpby4KCQkJICovCgkJCXRoaXMuZ2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gX3BpeGVsUmF0aW87CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIGdpdmVuIHBpeGVsIHJhdGlvIGFuZCByZXNpemVzIHRoZSBjYW52YXMgaWYgbmVjZXNzYXJ5LgoJCQkgKgoJCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgcGl4ZWwgcmF0aW8uCgkJCSAqLwoJCQl0aGlzLnNldFBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJCQlfcGl4ZWxSYXRpbyA9IHZhbHVlOwoKCQkJCXRoaXMuc2V0U2l6ZSggX3dpZHRoLCBfaGVpZ2h0LCBmYWxzZSApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSByZW5kZXJlcidzIHNpemUgaW4gbG9naWNhbCBwaXhlbHMuIFRoaXMgbWV0aG9kIGRvZXMgbm90IGhvbm9yIHRoZSBwaXhlbCByYXRpby4KCQkJICoKCQkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KCQkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIHJlbmRlcmVyJ3Mgc2l6ZSBpbiBsb2dpY2FsIHBpeGVscy4KCQkJICovCgkJCXRoaXMuZ2V0U2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGgsIF9oZWlnaHQgKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmVzaXplcyB0aGUgb3V0cHV0IGNhbnZhcyB0byAod2lkdGgsIGhlaWdodCkgd2l0aCBkZXZpY2UgcGl4ZWwgcmF0aW8gdGFrZW4KCQkJICogaW50byBhY2NvdW50LCBhbmQgYWxzbyBzZXRzIHRoZSB2aWV3cG9ydCB0byBmaXQgdGhhdCBzaXplLCBzdGFydGluZyBpbiAoMCwKCQkJICogMCkuIFNldHRpbmcgYHVwZGF0ZVN0eWxlYCB0byBmYWxzZSBwcmV2ZW50cyBhbnkgc3R5bGUgY2hhbmdlcyB0byB0aGUgb3V0cHV0IGNhbnZhcy4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIGluIGxvZ2ljYWwgcGl4ZWxzLgoJCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBpbiBsb2dpY2FsIHBpeGVscy4KCQkJICogQHBhcmFtIHtib29sZWFufSBbdXBkYXRlU3R5bGU9dHJ1ZV0gLSBXaGV0aGVyIHRvIHVwZGF0ZSB0aGUgYHN0eWxlYCBhdHRyaWJ1dGUgb2YgdGhlIGNhbnZhcyBvciBub3QuCgkJCSAqLwoJCQl0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQsIHVwZGF0ZVN0eWxlID0gdHJ1ZSApIHsKCgkJCQlpZiAoIHhyLmlzUHJlc2VudGluZyApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ2FuXCd0IGNoYW5nZSBzaXplIHdoaWxlIFZSIGRldmljZSBpcyBwcmVzZW50aW5nLicgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCV93aWR0aCA9IHdpZHRoOwoJCQkJX2hlaWdodCA9IGhlaWdodDsKCgkJCQljYW52YXMud2lkdGggPSBNYXRoLmZsb29yKCB3aWR0aCAqIF9waXhlbFJhdGlvICk7CgkJCQljYW52YXMuaGVpZ2h0ID0gTWF0aC5mbG9vciggaGVpZ2h0ICogX3BpeGVsUmF0aW8gKTsKCgkJCQlpZiAoIHVwZGF0ZVN0eWxlID09PSB0cnVlICkgewoKCQkJCQljYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7CgkJCQkJY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CgoJCQkJfQoKCQkJCXRoaXMuc2V0Vmlld3BvcnQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgZHJhd2luZyBidWZmZXIgc2l6ZSBpbiBwaHlzaWNhbCBwaXhlbHMuIFRoaXMgbWV0aG9kIGhvbm9ycyB0aGUgcGl4ZWwgcmF0aW8uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCgkJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IFRoZSBkcmF3aW5nIGJ1ZmZlciBzaXplLgoJCQkgKi8KCQkJdGhpcy5nZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGggKiBfcGl4ZWxSYXRpbywgX2hlaWdodCAqIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCgkJCX07CgoJCQkvKioKCQkJICogVGhpcyBtZXRob2QgYWxsb3dzIHRvIGRlZmluZSB0aGUgZHJhd2luZyBidWZmZXIgc2l6ZSBieSBzcGVjaWZ5aW5nCgkJCSAqIHdpZHRoLCBoZWlnaHQgYW5kIHBpeGVsIHJhdGlvIGFsbCBhdCBvbmNlLiBUaGUgc2l6ZSBvZiB0aGUgZHJhd2luZwoJCQkgKiBidWZmZXIgaXMgY29tcHV0ZWQgd2l0aCB0aGlzIGZvcm11bGE6CgkJCSAqIGBgYGpzCgkJCSAqIHNpemUueCA9IHdpZHRoICogcGl4ZWxSYXRpbzsKCQkJICogc2l6ZS55ID0gaGVpZ2h0ICogcGl4ZWxSYXRpbzsKCQkJICogYGBgCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBpbiBsb2dpY2FsIHBpeGVscy4KCQkJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgaW4gbG9naWNhbCBwaXhlbHMuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBwaXhlbFJhdGlvIC0gVGhlIHBpeGVsIHJhdGlvLgoJCQkgKi8KCQkJdGhpcy5zZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgcGl4ZWxSYXRpbyApIHsKCgkJCQlfd2lkdGggPSB3aWR0aDsKCQkJCV9oZWlnaHQgPSBoZWlnaHQ7CgoJCQkJX3BpeGVsUmF0aW8gPSBwaXhlbFJhdGlvOwoKCQkJCWNhbnZhcy53aWR0aCA9IE1hdGguZmxvb3IoIHdpZHRoICogcGl4ZWxSYXRpbyApOwoJCQkJY2FudmFzLmhlaWdodCA9IE1hdGguZmxvb3IoIGhlaWdodCAqIHBpeGVsUmF0aW8gKTsKCgkJCQl0aGlzLnNldFZpZXdwb3J0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmlld3BvcnQgZGVmaW5pdGlvbi4KCQkJICoKCQkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KCQkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIGN1cnJlbnQgdmlld3BvcnQgZGVmaW5pdGlvbi4KCQkJICovCgkJCXRoaXMuZ2V0Q3VycmVudFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfY3VycmVudFZpZXdwb3J0ICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIHZpZXdwb3J0IGRlZmluaXRpb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCgkJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IFRoZSB2aWV3cG9ydCBkZWZpbml0aW9uLgoJCQkgKi8KCQkJdGhpcy5nZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuY29weSggX3ZpZXdwb3J0ICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIHZpZXdwb3J0IHRvIHJlbmRlciBmcm9tIGAoeCwgeSlgIHRvIGAoeCArIHdpZHRoLCB5ICsgaGVpZ2h0KWAuCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyIHwgVmVjdG9yNH0geCAtIFRoZSBob3Jpem9udGFsIGNvb3JkaW5hdGUgZm9yIHRoZSBsb3dlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlld3BvcnQgb3JpZ2luIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KCQkJICogT3IgYWx0ZXJuYXRpdmVseSBhIGZvdXItY29tcG9uZW50IHZlY3RvciBzcGVjaWZ5aW5nIGFsbCB0aGUgcGFyYW1ldGVycyBvZiB0aGUgdmlld3BvcnQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZlcnRpY2FsIGNvb3JkaW5hdGUgZm9yIHRoZSBsb3dlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlld3BvcnQgb3JpZ2luICBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdmlld3BvcnQgaW4gbG9naWNhbCBwaXhlbCB1bml0LgoJCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdmlld3BvcnQgaW4gbG9naWNhbCBwaXhlbCB1bml0LgoJCQkgKi8KCQkJdGhpcy5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCgkJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKCQkJCQlfdmlld3BvcnQuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfdmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLnJvdW5kKCkgKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgc2Npc3NvciByZWdpb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCgkJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IFRoZSBzY2lzc29yIHJlZ2lvbi4KCQkJICovCgkJCXRoaXMuZ2V0U2Npc3NvciA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuY29weSggX3NjaXNzb3IgKTsKCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgc2Npc3NvciByZWdpb24gdG8gcmVuZGVyIGZyb20gYCh4LCB5KWAgdG8gYCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQpYC4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXIgfCBWZWN0b3I0fSB4IC0gVGhlIGhvcml6b250YWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBvcmlnaW4gaW4gbG9naWNhbCBwaXhlbCB1bml0LgoJCQkgKiBPciBhbHRlcm5hdGl2ZWx5IGEgZm91ci1jb21wb25lbnQgdmVjdG9yIHNwZWNpZnlpbmcgYWxsIHRoZSBwYXJhbWV0ZXJzIG9mIHRoZSBzY2lzc29yIHJlZ2lvbi4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBvcmlnaW4gIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCgkJCSAqLwoJCQl0aGlzLnNldFNjaXNzb3IgPSBmdW5jdGlvbiAoIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQkJaWYgKCB4LmlzVmVjdG9yNCApIHsKCgkJCQkJX3NjaXNzb3Iuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfc2Npc3Nvci5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQl9CgoJCQkJc3RhdGUuc2Npc3NvciggX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkucm91bmQoKSApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc2Npc3NvciB0ZXN0IGlzIGVuYWJsZWQuCgkJCSAqCgkJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBpcyBlbmFibGVkIG9yIG5vdC4KCQkJICovCgkJCXRoaXMuZ2V0U2Npc3NvclRlc3QgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIF9zY2lzc29yVGVzdDsKCgkJCX07CgoJCQkvKioKCQkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHNjaXNzb3IgdGVzdC4gV2hlbiB0aGlzIGlzIGVuYWJsZWQsIG9ubHkgdGhlIHBpeGVscwoJCQkgKiB3aXRoaW4gdGhlIGRlZmluZWQgc2Npc3NvciBhcmVhIHdpbGwgYmUgYWZmZWN0ZWQgYnkgZnVydGhlciByZW5kZXJlcgoJCQkgKiBhY3Rpb25zLgoJCQkgKgoJCQkgKiBAcGFyYW0ge2Jvb2xlYW59IGJvb2xlYW4gLSBXaGV0aGVyIHRoZSBzY2lzc29yIHRlc3QgaXMgZW5hYmxlZCBvciBub3QuCgkJCSAqLwoJCQl0aGlzLnNldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCBib29sZWFuICkgewoKCQkJCXN0YXRlLnNldFNjaXNzb3JUZXN0KCBfc2Npc3NvclRlc3QgPSBib29sZWFuICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgYSBjdXN0b20gb3BhcXVlIHNvcnQgZnVuY3Rpb24gZm9yIHRoZSByZW5kZXIgbGlzdHMuIFBhc3MgYG51bGxgCgkJCSAqIHRvIHVzZSB0aGUgZGVmYXVsdCBgcGFpbnRlclNvcnRTdGFibGVgIGZ1bmN0aW9uLgoJCQkgKgoJCQkgKiBAcGFyYW0gez9GdW5jdGlvbn0gbWV0aG9kIC0gVGhlIG9wYXF1ZSBzb3J0IGZ1bmN0aW9uLgoJCQkgKi8KCQkJdGhpcy5zZXRPcGFxdWVTb3J0ID0gZnVuY3Rpb24gKCBtZXRob2QgKSB7CgoJCQkJX29wYXF1ZVNvcnQgPSBtZXRob2Q7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgYSBjdXN0b20gdHJhbnNwYXJlbnQgc29ydCBmdW5jdGlvbiBmb3IgdGhlIHJlbmRlciBsaXN0cy4gUGFzcyBgbnVsbGAKCQkJICogdG8gdXNlIHRoZSBkZWZhdWx0IGByZXZlcnNlUGFpbnRlclNvcnRTdGFibGVgIGZ1bmN0aW9uLgoJCQkgKgoJCQkgKiBAcGFyYW0gez9GdW5jdGlvbn0gbWV0aG9kIC0gVGhlIG9wYXF1ZSBzb3J0IGZ1bmN0aW9uLgoJCQkgKi8KCQkJdGhpcy5zZXRUcmFuc3BhcmVudFNvcnQgPSBmdW5jdGlvbiAoIG1ldGhvZCApIHsKCgkJCQlfdHJhbnNwYXJlbnRTb3J0ID0gbWV0aG9kOwoKCQkJfTsKCgkJCS8vIENsZWFyaW5nCgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgY2xlYXIgY29sb3IuCgkJCSAqCgkJCSAqIEBwYXJhbSB7Q29sb3J9IHRhcmdldCAtIFRoZSBtZXRob2Qgd3JpdGVzIHRoZSByZXN1bHQgaW4gdGhpcyB0YXJnZXQgb2JqZWN0LgoJCQkgKiBAcmV0dXJuIHtDb2xvcn0gVGhlIGNsZWFyIGNvbG9yLgoJCQkgKi8KCQkJdGhpcy5nZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKSApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBTZXRzIHRoZSBjbGVhciBjb2xvciBhbmQgYWxwaGEuCgkJCSAqCgkJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNsZWFyIGNvbG9yLgoJCQkgKiBAcGFyYW0ge251bWJlcn0gW2FscGhhPTFdIC0gVGhlIGNsZWFyIGFscGhhLgoJCQkgKi8KCQkJdGhpcy5zZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKCQkJCWJhY2tncm91bmQuc2V0Q2xlYXJDb2xvciggLi4uYXJndW1lbnRzICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGNsZWFyIGFscGhhLiBSYW5nZXMgd2l0aGluIGBbMCwxXWAuCgkJCSAqCgkJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNsZWFyIGFscGhhLgoJCQkgKi8KCQkJdGhpcy5nZXRDbGVhckFscGhhID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgY2xlYXIgYWxwaGEuCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBjbGVhciBhbHBoYS4KCQkJICovCgkJCXRoaXMuc2V0Q2xlYXJBbHBoYSA9IGZ1bmN0aW9uICgpIHsKCgkJCQliYWNrZ3JvdW5kLnNldENsZWFyQWxwaGEoIC4uLmFyZ3VtZW50cyApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBUZWxscyB0aGUgcmVuZGVyZXIgdG8gY2xlYXIgaXRzIGNvbG9yLCBkZXB0aCBvciBzdGVuY2lsIGRyYXdpbmcgYnVmZmVyKHMpLgoJCQkgKiBUaGlzIG1ldGhvZCBpbml0aWFsaXplcyB0aGUgYnVmZmVycyB0byB0aGUgY3VycmVudCBjbGVhciBjb2xvciB2YWx1ZXMuCgkJCSAqCgkJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NvbG9yPXRydWVdIC0gV2hldGhlciB0aGUgY29sb3IgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KCQkJICogQHBhcmFtIHtib29sZWFufSBbZGVwdGg9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBkZXB0aCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgoJCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtzdGVuY2lsPXRydWVdIC0gV2hldGhlciB0aGUgc3RlbmNpbCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgoJCQkgKi8KCQkJdGhpcy5jbGVhciA9IGZ1bmN0aW9uICggY29sb3IgPSB0cnVlLCBkZXB0aCA9IHRydWUsIHN0ZW5jaWwgPSB0cnVlICkgewoKCQkJCWxldCBiaXRzID0gMDsKCgkJCQlpZiAoIGNvbG9yICkgewoKCQkJCQkvLyBjaGVjayBpZiB3ZSdyZSB0cnlpbmcgdG8gY2xlYXIgYW4gaW50ZWdlciB0YXJnZXQKCQkJCQlsZXQgaXNJbnRlZ2VyRm9ybWF0ID0gZmFsc2U7CgkJCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApIHsKCgkJCQkJCWNvbnN0IHRhcmdldEZvcm1hdCA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuZm9ybWF0OwoJCQkJCQlpc0ludGVnZXJGb3JtYXQgPSB0YXJnZXRGb3JtYXQgPT09IFJHQkFJbnRlZ2VyRm9ybWF0IHx8CgkJCQkJCQl0YXJnZXRGb3JtYXQgPT09IFJHSW50ZWdlckZvcm1hdCB8fAoJCQkJCQkJdGFyZ2V0Rm9ybWF0ID09PSBSZWRJbnRlZ2VyRm9ybWF0OwoKCQkJCQl9CgoJCQkJCS8vIHVzZSB0aGUgYXBwcm9wcmlhdGUgY2xlYXIgZnVuY3Rpb25zIHRvIGNsZWFyIHRoZSB0YXJnZXQgaWYgaXQncyBhIHNpZ25lZAoJCQkJCS8vIG9yIHVuc2lnbmVkIGludGVnZXIgdGFyZ2V0CgkJCQkJaWYgKCBpc0ludGVnZXJGb3JtYXQgKSB7CgoJCQkJCQljb25zdCB0YXJnZXRUeXBlID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS50eXBlOwoJCQkJCQljb25zdCBpc1Vuc2lnbmVkVHlwZSA9IHRhcmdldFR5cGUgPT09IFVuc2lnbmVkQnl0ZVR5cGUgfHwKCQkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fAoJCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgfHwKCQkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSB8fAoJCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlIHx8CgkJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGU7CgoJCQkJCQljb25zdCBjbGVhckNvbG9yID0gYmFja2dyb3VuZC5nZXRDbGVhckNvbG9yKCk7CgkJCQkJCWNvbnN0IGEgPSBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKCQkJCQkJY29uc3QgciA9IGNsZWFyQ29sb3IucjsKCQkJCQkJY29uc3QgZyA9IGNsZWFyQ29sb3IuZzsKCQkJCQkJY29uc3QgYiA9IGNsZWFyQ29sb3IuYjsKCgkJCQkJCWlmICggaXNVbnNpZ25lZFR5cGUgKSB7CgoJCQkJCQkJdWludENsZWFyQ29sb3JbIDAgXSA9IHI7CgkJCQkJCQl1aW50Q2xlYXJDb2xvclsgMSBdID0gZzsKCQkJCQkJCXVpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwoJCQkJCQkJdWludENsZWFyQ29sb3JbIDMgXSA9IGE7CgkJCQkJCQlfZ2wuY2xlYXJCdWZmZXJ1aXYoIF9nbC5DT0xPUiwgMCwgdWludENsZWFyQ29sb3IgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaW50Q2xlYXJDb2xvclsgMCBdID0gcjsKCQkJCQkJCWludENsZWFyQ29sb3JbIDEgXSA9IGc7CgkJCQkJCQlpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwoJCQkJCQkJaW50Q2xlYXJDb2xvclsgMyBdID0gYTsKCQkJCQkJCV9nbC5jbGVhckJ1ZmZlcml2KCBfZ2wuQ09MT1IsIDAsIGludENsZWFyQ29sb3IgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWJpdHMgfD0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBkZXB0aCApIHsKCgkJCQkJYml0cyB8PSBfZ2wuREVQVEhfQlVGRkVSX0JJVDsKCgkJCQl9CgoJCQkJaWYgKCBzdGVuY2lsICkgewoKCQkJCQliaXRzIHw9IF9nbC5TVEVOQ0lMX0JVRkZFUl9CSVQ7CgkJCQkJdGhpcy5zdGF0ZS5idWZmZXJzLnN0ZW5jaWwuc2V0TWFzayggMHhmZmZmZmZmZiApOwoKCQkJCX0KCgkJCQlfZ2wuY2xlYXIoIGJpdHMgKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2xlYXJzIHRoZSBjb2xvciBidWZmZXIuIEVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVuZGVyZXIuY2xlYXIoIHRydWUsIGZhbHNlLCBmYWxzZSApYC4KCQkJICovCgkJCXRoaXMuY2xlYXJDb2xvciA9IGZ1bmN0aW9uICgpIHsKCgkJCQl0aGlzLmNsZWFyKCB0cnVlLCBmYWxzZSwgZmFsc2UgKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2xlYXJzIHRoZSBkZXB0aCBidWZmZXIuIEVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVuZGVyZXIuY2xlYXIoIGZhbHNlLCB0cnVlLCBmYWxzZSApYC4KCQkJICovCgkJCXRoaXMuY2xlYXJEZXB0aCA9IGZ1bmN0aW9uICgpIHsKCgkJCQl0aGlzLmNsZWFyKCBmYWxzZSwgdHJ1ZSwgZmFsc2UgKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2xlYXJzIHRoZSBzdGVuY2lsIGJ1ZmZlci4gRXF1aXZhbGVudCB0byBjYWxsaW5nIGByZW5kZXJlci5jbGVhciggZmFsc2UsIGZhbHNlLCB0cnVlIClgLgoJCQkgKi8KCQkJdGhpcy5jbGVhclN0ZW5jaWwgPSBmdW5jdGlvbiAoKSB7CgoJCQkJdGhpcy5jbGVhciggZmFsc2UsIGZhbHNlLCB0cnVlICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwoJCQkgKiBtZXRob2Qgd2hlbmV2ZXIgdGhpcyBpbnN0YW5jZSBpcyBubyBsb25nZXIgdXNlZCBpbiB5b3VyIGFwcC4KCQkJICovCgkJCXRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKCgkJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGxvc3QnLCBvbkNvbnRleHRMb3N0LCBmYWxzZSApOwoJCQkJY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRyZXN0b3JlZCcsIG9uQ29udGV4dFJlc3RvcmUsIGZhbHNlICk7CgkJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGNyZWF0aW9uZXJyb3InLCBvbkNvbnRleHRDcmVhdGlvbkVycm9yLCBmYWxzZSApOwoKCQkJCWJhY2tncm91bmQuZGlzcG9zZSgpOwoJCQkJcmVuZGVyTGlzdHMuZGlzcG9zZSgpOwoJCQkJcmVuZGVyU3RhdGVzLmRpc3Bvc2UoKTsKCQkJCXByb3BlcnRpZXMuZGlzcG9zZSgpOwoJCQkJY3ViZW1hcHMuZGlzcG9zZSgpOwoJCQkJY3ViZXV2bWFwcy5kaXNwb3NlKCk7CgkJCQlvYmplY3RzLmRpc3Bvc2UoKTsKCQkJCWJpbmRpbmdTdGF0ZXMuZGlzcG9zZSgpOwoJCQkJdW5pZm9ybXNHcm91cHMuZGlzcG9zZSgpOwoJCQkJcHJvZ3JhbUNhY2hlLmRpc3Bvc2UoKTsKCgkJCQl4ci5kaXNwb3NlKCk7CgoJCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKCQkJCXhyLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCgkJCQlhbmltYXRpb24uc3RvcCgpOwoKCQkJfTsKCgkJCS8vIEV2ZW50cwoKCQkJZnVuY3Rpb24gb25Db250ZXh0TG9zdCggZXZlbnQgKSB7CgoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQljb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IENvbnRleHQgTG9zdC4nICk7CgoJCQkJX2lzQ29udGV4dExvc3QgPSB0cnVlOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25Db250ZXh0UmVzdG9yZSggLyogZXZlbnQgKi8gKSB7CgoJCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IFJlc3RvcmVkLicgKTsKCgkJCQlfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKCQkJCWNvbnN0IGluZm9BdXRvUmVzZXQgPSBpbmZvLmF1dG9SZXNldDsKCQkJCWNvbnN0IHNoYWRvd01hcEVuYWJsZWQgPSBzaGFkb3dNYXAuZW5hYmxlZDsKCQkJCWNvbnN0IHNoYWRvd01hcEF1dG9VcGRhdGUgPSBzaGFkb3dNYXAuYXV0b1VwZGF0ZTsKCQkJCWNvbnN0IHNoYWRvd01hcE5lZWRzVXBkYXRlID0gc2hhZG93TWFwLm5lZWRzVXBkYXRlOwoJCQkJY29uc3Qgc2hhZG93TWFwVHlwZSA9IHNoYWRvd01hcC50eXBlOwoKCQkJCWluaXRHTENvbnRleHQoKTsKCgkJCQlpbmZvLmF1dG9SZXNldCA9IGluZm9BdXRvUmVzZXQ7CgkJCQlzaGFkb3dNYXAuZW5hYmxlZCA9IHNoYWRvd01hcEVuYWJsZWQ7CgkJCQlzaGFkb3dNYXAuYXV0b1VwZGF0ZSA9IHNoYWRvd01hcEF1dG9VcGRhdGU7CgkJCQlzaGFkb3dNYXAubmVlZHNVcGRhdGUgPSBzaGFkb3dNYXBOZWVkc1VwZGF0ZTsKCQkJCXNoYWRvd01hcC50eXBlID0gc2hhZG93TWFwVHlwZTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uQ29udGV4dENyZWF0aW9uRXJyb3IoIGV2ZW50ICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBIFdlYkdMIGNvbnRleHQgY291bGQgbm90IGJlIGNyZWF0ZWQuIFJlYXNvbjogJywgZXZlbnQuc3RhdHVzTWVzc2FnZSApOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25NYXRlcmlhbERpc3Bvc2UoIGV2ZW50ICkgewoKCQkJCWNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwoKCQkJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCQlkZWFsbG9jYXRlTWF0ZXJpYWwoIG1hdGVyaWFsICk7CgoJCQl9CgoJCQkvLyBCdWZmZXIgZGVhbGxvY2F0aW9uCgoJCQlmdW5jdGlvbiBkZWFsbG9jYXRlTWF0ZXJpYWwoIG1hdGVyaWFsICkgewoKCQkJCXJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApOwoKCQkJCXByb3BlcnRpZXMucmVtb3ZlKCBtYXRlcmlhbCApOwoKCQkJfQoKCgkJCWZ1bmN0aW9uIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApIHsKCgkJCQljb25zdCBwcm9ncmFtcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLnByb2dyYW1zOwoKCQkJCWlmICggcHJvZ3JhbXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcHJvZ3JhbXMuZm9yRWFjaCggZnVuY3Rpb24gKCBwcm9ncmFtICkgewoKCQkJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VQcm9ncmFtKCBwcm9ncmFtICk7CgoJCQkJCX0gKTsKCgkJCQkJaWYgKCBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICkgewoKCQkJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VTaGFkZXJDYWNoZSggbWF0ZXJpYWwgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vIEJ1ZmZlciByZW5kZXJpbmcKCgkJCXRoaXMucmVuZGVyQnVmZmVyRGlyZWN0ID0gZnVuY3Rpb24gKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKSB7CgoJCQkJaWYgKCBzY2VuZSA9PT0gbnVsbCApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHJlbmRlckJ1ZmZlckRpcmVjdCBzZWNvbmQgcGFyYW1ldGVyIHVzZWQgdG8gYmUgZm9nIChjb3VsZCBiZSBudWxsKQoKCQkJCWNvbnN0IGZyb250RmFjZUNXID0gKCBvYmplY3QuaXNNZXNoICYmIG9iamVjdC5tYXRyaXhXb3JsZC5kZXRlcm1pbmFudCgpIDwgMCApOwoKCQkJCWNvbnN0IHByb2dyYW0gPSBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApOwoKCQkJCXN0YXRlLnNldE1hdGVyaWFsKCBtYXRlcmlhbCwgZnJvbnRGYWNlQ1cgKTsKCgkJCQkvLwoKCQkJCWxldCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCQkJbGV0IHJhbmdlRmFjdG9yID0gMTsKCgkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJaW5kZXggPSBnZW9tZXRyaWVzLmdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJaWYgKCBpbmRleCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJCQlyYW5nZUZhY3RvciA9IDI7CgoJCQkJfQoKCQkJCS8vCgoJCQkJY29uc3QgZHJhd1JhbmdlID0gZ2VvbWV0cnkuZHJhd1JhbmdlOwoJCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJCWxldCBkcmF3U3RhcnQgPSBkcmF3UmFuZ2Uuc3RhcnQgKiByYW5nZUZhY3RvcjsKCQkJCWxldCBkcmF3RW5kID0gKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSAqIHJhbmdlRmFjdG9yOwoKCQkJCWlmICggZ3JvdXAgIT09IG51bGwgKSB7CgoJCQkJCWRyYXdTdGFydCA9IE1hdGgubWF4KCBkcmF3U3RhcnQsIGdyb3VwLnN0YXJ0ICogcmFuZ2VGYWN0b3IgKTsKCQkJCQlkcmF3RW5kID0gTWF0aC5taW4oIGRyYXdFbmQsICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApICogcmFuZ2VGYWN0b3IgKTsKCgkJCQl9CgoJCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgMCApOwoJCQkJCWRyYXdFbmQgPSBNYXRoLm1pbiggZHJhd0VuZCwgaW5kZXguY291bnQgKTsKCgkJCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICYmIHBvc2l0aW9uICE9PSBudWxsICkgewoKCQkJCQlkcmF3U3RhcnQgPSBNYXRoLm1heCggZHJhd1N0YXJ0LCAwICk7CgkJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCBwb3NpdGlvbi5jb3VudCApOwoKCQkJCX0KCgkJCQljb25zdCBkcmF3Q291bnQgPSBkcmF3RW5kIC0gZHJhd1N0YXJ0OwoKCQkJCWlmICggZHJhd0NvdW50IDwgMCB8fCBkcmF3Q291bnQgPT09IEluZmluaXR5ICkgcmV0dXJuOwoKCQkJCS8vCgoJCQkJYmluZGluZ1N0YXRlcy5zZXR1cCggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnksIGluZGV4ICk7CgoJCQkJbGV0IGF0dHJpYnV0ZTsKCQkJCWxldCByZW5kZXJlciA9IGJ1ZmZlclJlbmRlcmVyOwoKCQkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJCWF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApOwoKCQkJCQlyZW5kZXJlciA9IGluZGV4ZWRCdWZmZXJSZW5kZXJlcjsKCQkJCQlyZW5kZXJlci5zZXRJbmRleCggYXR0cmlidXRlICk7CgoJCQkJfQoKCQkJCS8vCgoJCQkJaWYgKCBvYmplY3QuaXNNZXNoICkgewoKCQkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgkJCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5MSU5FUyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlRSSUFOR0xFUyApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZSApIHsKCgkJCQkJbGV0IGxpbmVXaWR0aCA9IG1hdGVyaWFsLmxpbmV3aWR0aDsKCgkJCQkJaWYgKCBsaW5lV2lkdGggPT09IHVuZGVmaW5lZCApIGxpbmVXaWR0aCA9IDE7IC8vIE5vdCB1c2luZyBMaW5lKk1hdGVyaWFsCgoJCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbGluZVdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgoJCQkJCWlmICggb2JqZWN0LmlzTGluZVNlZ21lbnRzICkgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVTICk7CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpbmVMb29wICkgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfTE9PUCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfU1RSSVAgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1BvaW50cyApIHsKCgkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlBPSU5UUyApOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1Nwcml0ZSApIHsKCgkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlRSSUFOR0xFUyApOwoKCQkJCX0KCgkJCQlpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICkgewoKCQkJCQlpZiAoIG9iamVjdC5fbXVsdGlEcmF3SW5zdGFuY2VzICE9PSBudWxsICkgewoKCQkJCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNzQKCQkJCQkJd2Fybk9uY2UoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMgaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHIxODQuIEFwcGVuZCB0byByZW5kZXJNdWx0aURyYXcgYXJndW1lbnRzIGFuZCB1c2UgaW5kaXJlY3Rpb24uJyApOwoJCQkJCQlyZW5kZXJlci5yZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMoIG9iamVjdC5fbXVsdGlEcmF3U3RhcnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudCwgb2JqZWN0Ll9tdWx0aURyYXdJbnN0YW5jZXMgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggISBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICkgKSB7CgoJCQkJCQkJY29uc3Qgc3RhcnRzID0gb2JqZWN0Ll9tdWx0aURyYXdTdGFydHM7CgkJCQkJCQljb25zdCBjb3VudHMgPSBvYmplY3QuX211bHRpRHJhd0NvdW50czsKCQkJCQkJCWNvbnN0IGRyYXdDb3VudCA9IG9iamVjdC5fbXVsdGlEcmF3Q291bnQ7CgkJCQkJCQljb25zdCBieXRlc1BlckVsZW1lbnQgPSBpbmRleCA/IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApLmJ5dGVzUGVyRWxlbWVudCA6IDE7CgkJCQkJCQljb25zdCB1bmlmb3JtcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmN1cnJlbnRQcm9ncmFtLmdldFVuaWZvcm1zKCk7CgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgoJCQkJCQkJCXVuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdfZ2xfRHJhd0lEJywgaSApOwoJCQkJCQkJCXJlbmRlcmVyLnJlbmRlciggc3RhcnRzWyBpIF0gLyBieXRlc1BlckVsZW1lbnQsIGNvdW50c1sgaSBdICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlyZW5kZXJlci5yZW5kZXJNdWx0aURyYXcoIG9iamVjdC5fbXVsdGlEcmF3U3RhcnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCApIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVySW5zdGFuY2VzKCBkcmF3U3RhcnQsIGRyYXdDb3VudCwgb2JqZWN0LmNvdW50ICk7CgoJCQkJfSBlbHNlIGlmICggZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSApIHsKCgkJCQkJY29uc3QgbWF4SW5zdGFuY2VDb3VudCA9IGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ICE9PSB1bmRlZmluZWQgPyBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA6IEluZmluaXR5OwoJCQkJCWNvbnN0IGluc3RhbmNlQ291bnQgPSBNYXRoLm1pbiggZ2VvbWV0cnkuaW5zdGFuY2VDb3VudCwgbWF4SW5zdGFuY2VDb3VudCApOwoKCQkJCQlyZW5kZXJlci5yZW5kZXJJbnN0YW5jZXMoIGRyYXdTdGFydCwgZHJhd0NvdW50LCBpbnN0YW5jZUNvdW50ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVyKCBkcmF3U3RhcnQsIGRyYXdDb3VudCApOwoKCQkJCX0KCgkJCX07CgoJCQkvLyBDb21waWxlCgoJCQlmdW5jdGlvbiBwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICkgewoKCQkJCWlmICggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IHRydWUgJiYgbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSAmJiBtYXRlcmlhbC5mb3JjZVNpbmdsZVBhc3MgPT09IGZhbHNlICkgewoKCQkJCQltYXRlcmlhbC5zaWRlID0gQmFja1NpZGU7CgkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBGcm9udFNpZGU7CgkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBEb3VibGVTaWRlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJfQoKCQkJfQoKCQkJLyoqCgkJCSAqIENvbXBpbGVzIGFsbCBtYXRlcmlhbHMgaW4gdGhlIHNjZW5lIHdpdGggdGhlIGNhbWVyYS4gVGhpcyBpcyB1c2VmdWwgdG8gcHJlY29tcGlsZSBzaGFkZXJzCgkJCSAqIGJlZm9yZSB0aGUgZmlyc3QgcmVuZGVyaW5nLiBJZiB5b3Ugd2FudCB0byBhZGQgYSAzRCBvYmplY3QgdG8gYW4gZXhpc3Rpbmcgc2NlbmUsIHVzZSB0aGUgdGhpcmQKCQkJICogb3B0aW9uYWwgcGFyYW1ldGVyIGZvciBhcHBseWluZyB0aGUgdGFyZ2V0IHNjZW5lLgoJCQkgKgoJCQkgKiBOb3RlIHRoYXQgdGhlICh0YXJnZXQpIHNjZW5lJ3MgbGlnaHRpbmcgYW5kIGVudmlyb25tZW50IG11c3QgYmUgY29uZmlndXJlZCBiZWZvcmUgY2FsbGluZyB0aGlzIG1ldGhvZC4KCQkJICoKCQkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgb3IgYW5vdGhlciB0eXBlIG9mIDNEIG9iamVjdCB0byBwcmVjb21waWxlLgoJCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkJICogQHBhcmFtIHs/U2NlbmV9IFt0YXJnZXRTY2VuZT1udWxsXSAtIFRoZSB0YXJnZXQgc2NlbmUuCgkJCSAqIEByZXR1cm4ge1NldDxNYXRlcmlhbD59IFRoZSBwcmVjb21waWxlZCBtYXRlcmlhbHMuCgkJCSAqLwoJCQl0aGlzLmNvbXBpbGUgPSBmdW5jdGlvbiAoIHNjZW5lLCBjYW1lcmEsIHRhcmdldFNjZW5lID0gbnVsbCApIHsKCgkJCQlpZiAoIHRhcmdldFNjZW5lID09PSBudWxsICkgdGFyZ2V0U2NlbmUgPSBzY2VuZTsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCB0YXJnZXRTY2VuZSApOwoJCQkJY3VycmVudFJlbmRlclN0YXRlLmluaXQoIGNhbWVyYSApOwoKCQkJCXJlbmRlclN0YXRlU3RhY2sucHVzaCggY3VycmVudFJlbmRlclN0YXRlICk7CgoJCQkJLy8gZ2F0aGVyIGxpZ2h0cyBmcm9tIGJvdGggdGhlIHRhcmdldCBzY2VuZSBhbmQgdGhlIG5ldyBvYmplY3QgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBzY2VuZS4KCgkJCQl0YXJnZXRTY2VuZS50cmF2ZXJzZVZpc2libGUoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJCQlpZiAoIG9iamVjdC5pc0xpZ2h0ICYmIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgoJCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKCQkJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoU2hhZG93KCBvYmplY3QgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gKTsKCgkJCQlpZiAoIHNjZW5lICE9PSB0YXJnZXRTY2VuZSApIHsKCgkJCQkJc2NlbmUudHJhdmVyc2VWaXNpYmxlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQkJCWlmICggb2JqZWN0LmlzTGlnaHQgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgoJCQkJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyApIHsKCgkJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSApOwoKCQkJCX0KCgkJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoKTsKCgkJCQkvLyBPbmx5IGluaXRpYWxpemUgbWF0ZXJpYWxzIGluIHRoZSBuZXcgc2NlbmUsIG5vdCB0aGUgdGFyZ2V0U2NlbmUuCgoJCQkJY29uc3QgbWF0ZXJpYWxzID0gbmV3IFNldCgpOwoKCQkJCXNjZW5lLnRyYXZlcnNlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQkJaWYgKCAhICggb2JqZWN0LmlzTWVzaCB8fCBvYmplY3QuaXNQb2ludHMgfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNTcHJpdGUgKSApIHsKCgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJaWYgKCBtYXRlcmlhbCApIHsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXRlcmlhbC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQkJCWNvbnN0IG1hdGVyaWFsMiA9IG1hdGVyaWFsWyBpIF07CgoJCQkJCQkJCXByZXBhcmVNYXRlcmlhbCggbWF0ZXJpYWwyLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CgkJCQkJCQkJbWF0ZXJpYWxzLmFkZCggbWF0ZXJpYWwyICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CgkJCQkJCQltYXRlcmlhbHMuYWRkKCBtYXRlcmlhbCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSApOwoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2sucG9wKCk7CgoJCQkJcmV0dXJuIG1hdGVyaWFsczsKCgkJCX07CgoJCQkvLyBjb21waWxlQXN5bmMKCgkJCS8qKgoJCQkgKiBBc3luY2hyb25vdXMgdmVyc2lvbiBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNjb21waWxlfS4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgbWFrZXMgdXNlIG9mIHRoZSBgS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlYCBXZWJHTCBleHRlbnNpb24uIEhlbmNlLAoJCQkgKiBpdCBpcyByZWNvbW1lbmRlZCB0byB1c2UgdGhpcyB2ZXJzaW9uIG9mIGBjb21waWxlKClgIHdoZW5ldmVyIHBvc3NpYmxlLgoJCQkgKgoJCQkgKiBAYXN5bmMKCQkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgb3IgYW5vdGhlciB0eXBlIG9mIDNEIG9iamVjdCB0byBwcmVjb21waWxlLgoJCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkJICogQHBhcmFtIHs/U2NlbmV9IFt0YXJnZXRTY2VuZT1udWxsXSAtIFRoZSB0YXJnZXQgc2NlbmUuCgkJCSAqIEByZXR1cm4ge1Byb21pc2V9IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGdpdmVuIHNjZW5lIGNhbiBiZSByZW5kZXJlZCB3aXRob3V0IHVubmVjZXNzYXJ5IHN0YWxsaW5nIGR1ZSB0byBzaGFkZXIgY29tcGlsYXRpb24uCgkJCSAqLwoJCQl0aGlzLmNvbXBpbGVBc3luYyA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgPSBudWxsICkgewoKCQkJCWNvbnN0IG1hdGVyaWFscyA9IHRoaXMuY29tcGlsZSggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgKTsKCgkJCQkvLyBXYWl0IGZvciBhbGwgdGhlIG1hdGVyaWFscyBpbiB0aGUgbmV3IG9iamVjdCB0byBpbmRpY2F0ZSB0aGF0IHRoZXkncmUKCQkJCS8vIHJlYWR5IHRvIGJlIHVzZWQgYmVmb3JlIHJlc29sdmluZyB0aGUgcHJvbWlzZS4KCgkJCQlyZXR1cm4gbmV3IFByb21pc2UoICggcmVzb2x2ZSApID0+IHsKCgkJCQkJZnVuY3Rpb24gY2hlY2tNYXRlcmlhbHNSZWFkeSgpIHsKCgkJCQkJCW1hdGVyaWFscy5mb3JFYWNoKCBmdW5jdGlvbiAoIG1hdGVyaWFsICkgewoKCQkJCQkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoJCQkJCQkJY29uc3QgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCgkJCQkJCQlpZiAoIHByb2dyYW0uaXNSZWFkeSgpICkgewoKCQkJCQkJCQkvLyByZW1vdmUgYW55IHByb2dyYW1zIHRoYXQgcmVwb3J0IHRoZXkncmUgcmVhZHkgdG8gdXNlIGZyb20gdGhlIGxpc3QKCQkJCQkJCQltYXRlcmlhbHMuZGVsZXRlKCBtYXRlcmlhbCApOwoKCQkJCQkJCX0KCgkJCQkJCX0gKTsKCgkJCQkJCS8vIG9uY2UgdGhlIGxpc3Qgb2YgY29tcGlsaW5nIG1hdGVyaWFscyBpcyBlbXB0eSwgY2FsbCB0aGUgY2FsbGJhY2sKCgkJCQkJCWlmICggbWF0ZXJpYWxzLnNpemUgPT09IDAgKSB7CgoJCQkJCQkJcmVzb2x2ZSggc2NlbmUgKTsKCQkJCQkJCXJldHVybjsKCgkJCQkJCX0KCgkJCQkJCS8vIGlmIHNvbWUgbWF0ZXJpYWxzIGFyZSBzdGlsbCBub3QgcmVhZHksIHdhaXQgYSBiaXQgYW5kIGNoZWNrIGFnYWluCgoJCQkJCQlzZXRUaW1lb3V0KCBjaGVja01hdGVyaWFsc1JlYWR5LCAxMCApOwoKCQkJCQl9CgoJCQkJCWlmICggZXh0ZW5zaW9ucy5nZXQoICdLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUnICkgIT09IG51bGwgKSB7CgoJCQkJCQkvLyBJZiB3ZSBjYW4gY2hlY2sgdGhlIGNvbXBpbGF0aW9uIHN0YXR1cyBvZiB0aGUgbWF0ZXJpYWxzIHdpdGhvdXQKCQkJCQkJLy8gYmxvY2tpbmcgdGhlbiBkbyBzbyByaWdodCBhd2F5LgoKCQkJCQkJY2hlY2tNYXRlcmlhbHNSZWFkeSgpOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gT3RoZXJ3aXNlIHN0YXJ0IGJ5IHdhaXRpbmcgYSBiaXQgdG8gZ2l2ZSB0aGUgbWF0ZXJpYWxzIHdlIGp1c3QKCQkJCQkJLy8gaW5pdGlhbGl6ZWQgYSBjaGFuY2UgdG8gZmluaXNoLgoKCQkJCQkJc2V0VGltZW91dCggY2hlY2tNYXRlcmlhbHNSZWFkeSwgMTAgKTsKCgkJCQkJfQoKCQkJCX0gKTsKCgkJCX07CgoJCQkvLyBBbmltYXRpb24gTG9vcAoKCQkJbGV0IG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IG51bGw7CgoJCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lICkgewoKCQkJCWlmICggb25BbmltYXRpb25GcmFtZUNhbGxiYWNrICkgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKCB0aW1lICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvblhSU2Vzc2lvblN0YXJ0KCkgewoKCQkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvblhSU2Vzc2lvbkVuZCgpIHsKCgkJCQlhbmltYXRpb24uc3RhcnQoKTsKCgkJCX0KCgkJCWNvbnN0IGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwoJCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKCQkJaWYgKCB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgKSBhbmltYXRpb24uc2V0Q29udGV4dCggc2VsZiApOwoKCQkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCQkJCXhyLnNldEFuaW1hdGlvbkxvb3AoIGNhbGxiYWNrICk7CgoJCQkJKCBjYWxsYmFjayA9PT0gbnVsbCApID8gYW5pbWF0aW9uLnN0b3AoKSA6IGFuaW1hdGlvbi5zdGFydCgpOwoKCQkJfTsKCgkJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uc3RhcnQnLCBvblhSU2Vzc2lvblN0YXJ0ICk7CgkJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCgkJCS8vIFJlbmRlcmluZwoKCQkJLyoqCgkJCSAqIFJlbmRlcnMgdGhlIGdpdmVuIHNjZW5lIChvciBvdGhlciB0eXBlIG9mIDNEIG9iamVjdCkgdXNpbmcgdGhlIGdpdmVuIGNhbWVyYS4KCQkJICoKCQkJICogVGhlIHJlbmRlciBpcyBkb25lIHRvIGEgcHJldmlvdXNseSBzcGVjaWZpZWQgcmVuZGVyIHRhcmdldCBzZXQgYnkgY2FsbGluZyB7QGxpbmsgV2ViR0xSZW5kZXJlciNzZXRSZW5kZXJUYXJnZXR9CgkJCSAqIG9yIHRvIHRoZSBjYW52YXMgYXMgdXN1YWwuCgkJCSAqCgkJCSAqIEJ5IGRlZmF1bHQgcmVuZGVyIGJ1ZmZlcnMgYXJlIGNsZWFyZWQgYmVmb3JlIHJlbmRlcmluZyBidXQgeW91IGNhbiBwcmV2ZW50CgkJCSAqIHRoaXMgYnkgc2V0dGluZyB0aGUgcHJvcGVydHkgYGF1dG9DbGVhcmAgdG8gYGZhbHNlYC4gSWYgeW91IHdhbnQgdG8gcHJldmVudAoJCQkgKiBvbmx5IGNlcnRhaW4gYnVmZmVycyBiZWluZyBjbGVhcmVkIHlvdSBjYW4gYGF1dG9DbGVhckNvbG9yYCwgYGF1dG9DbGVhckRlcHRoYAoJCQkgKiBvciBgYXV0b0NsZWFyU3RlbmNpbGAgdG8gYGZhbHNlYC4gVG8gZm9yY2UgYSBjbGVhciwgdXNlIHtAbGluayBXZWJHTFJlbmRlcmVyI2NsZWFyfS4KCQkJICoKCQkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgdG8gcmVuZGVyLgoJCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkJICovCgkJCXRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCWlmICggY2FtZXJhICE9PSB1bmRlZmluZWQgJiYgY2FtZXJhLmlzQ2FtZXJhICE9PSB0cnVlICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZW5kZXI6IGNhbWVyYSBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuQ2FtZXJhLicgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCWlmICggX2lzQ29udGV4dExvc3QgPT09IHRydWUgKSByZXR1cm47CgoJCQkJLy8gdXBkYXRlIHNjZW5lIGdyYXBoCgoJCQkJaWYgKCBzY2VuZS5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJCS8vIHVwZGF0ZSBjYW1lcmEgbWF0cmljZXMgYW5kIGZydXN0dW0KCgkJCQlpZiAoIGNhbWVyYS5wYXJlbnQgPT09IG51bGwgJiYgY2FtZXJhLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgoJCQkJCWlmICggeHIuY2FtZXJhQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHhyLnVwZGF0ZUNhbWVyYSggY2FtZXJhICk7CgoJCQkJCWNhbWVyYSA9IHhyLmdldENhbWVyYSgpOyAvLyB1c2UgWFIgY2FtZXJhIGZvciByZW5kZXJpbmcKCgkJCQl9CgoJCQkJLy8KCQkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggKTsKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5pbml0KCBjYW1lcmEgKTsKCgkJCQlyZW5kZXJTdGF0ZVN0YWNrLnB1c2goIGN1cnJlbnRSZW5kZXJTdGF0ZSApOwoKCQkJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJCQlfZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQlfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSB0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkOwoJCQkJX2NsaXBwaW5nRW5hYmxlZCA9IGNsaXBwaW5nLmluaXQoIHRoaXMuY2xpcHBpbmdQbGFuZXMsIF9sb2NhbENsaXBwaW5nRW5hYmxlZCApOwoKCQkJCWN1cnJlbnRSZW5kZXJMaXN0ID0gcmVuZGVyTGlzdHMuZ2V0KCBzY2VuZSwgcmVuZGVyTGlzdFN0YWNrLmxlbmd0aCApOwoJCQkJY3VycmVudFJlbmRlckxpc3QuaW5pdCgpOwoKCQkJCXJlbmRlckxpc3RTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyTGlzdCApOwoKCQkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgoJCQkJCWNvbnN0IGRlcHRoU2Vuc2luZ01lc2ggPSBfdGhpcy54ci5nZXREZXB0aFNlbnNpbmdNZXNoKCk7CgoJCQkJCWlmICggZGVwdGhTZW5zaW5nTWVzaCAhPT0gbnVsbCApIHsKCgkJCQkJCXByb2plY3RPYmplY3QoIGRlcHRoU2Vuc2luZ01lc2gsIGNhbWVyYSwgLSBJbmZpbml0eSwgX3RoaXMuc29ydE9iamVjdHMgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlwcm9qZWN0T2JqZWN0KCBzY2VuZSwgY2FtZXJhLCAwLCBfdGhpcy5zb3J0T2JqZWN0cyApOwoKCQkJCWN1cnJlbnRSZW5kZXJMaXN0LmZpbmlzaCgpOwoKCQkJCWlmICggX3RoaXMuc29ydE9iamVjdHMgPT09IHRydWUgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnNvcnQoIF9vcGFxdWVTb3J0LCBfdHJhbnNwYXJlbnRTb3J0ICk7CgoJCQkJfQoKCQkJCV9yZW5kZXJCYWNrZ3JvdW5kID0geHIuZW5hYmxlZCA9PT0gZmFsc2UgfHwgeHIuaXNQcmVzZW50aW5nID09PSBmYWxzZSB8fCB4ci5oYXNEZXB0aFNlbnNpbmcoKSA9PT0gZmFsc2U7CgkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgewoKCQkJCQliYWNrZ3JvdW5kLmFkZFRvUmVuZGVyTGlzdCggY3VycmVudFJlbmRlckxpc3QsIHNjZW5lICk7CgoJCQkJfQoKCQkJCS8vCgoJCQkJdGhpcy5pbmZvLnJlbmRlci5mcmFtZSArKzsKCgkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5iZWdpblNoYWRvd3MoKTsKCgkJCQljb25zdCBzaGFkb3dzQXJyYXkgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUuc2hhZG93c0FycmF5OwoKCQkJCXNoYWRvd01hcC5yZW5kZXIoIHNoYWRvd3NBcnJheSwgc2NlbmUsIGNhbWVyYSApOwoKCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLmVuZFNoYWRvd3MoKTsKCgkJCQkvLwoKCQkJCWlmICggdGhpcy5pbmZvLmF1dG9SZXNldCA9PT0gdHJ1ZSApIHRoaXMuaW5mby5yZXNldCgpOwoKCQkJCS8vIHJlbmRlciBzY2VuZQoKCQkJCWNvbnN0IG9wYXF1ZU9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC5vcGFxdWU7CgkJCQljb25zdCB0cmFuc21pc3NpdmVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNtaXNzaXZlOwoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cygpOwoKCQkJCWlmICggY2FtZXJhLmlzQXJyYXlDYW1lcmEgKSB7CgoJCQkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmEuY2FtZXJhczsKCgkJCQkJaWYgKCB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjYW1lcmFzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJCQlyZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhMiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWlmICggX3JlbmRlckJhY2tncm91bmQgKSBiYWNrZ3JvdW5kLnJlbmRlciggc2NlbmUgKTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2FtZXJhcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYTIsIGNhbWVyYTIudmlld3BvcnQgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyVHJhbnNtaXNzaW9uUGFzcyggb3BhcXVlT2JqZWN0cywgdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgYmFja2dyb3VuZC5yZW5kZXIoIHNjZW5lICk7CgoJCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApOwoKCQkJCX0KCgkJCQkvLwoKCQkJCWlmICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgIT09IG51bGwgJiYgX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9PT0gMCApIHsKCgkJCQkJLy8gcmVzb2x2ZSBtdWx0aXNhbXBsZSByZW5kZXJidWZmZXJzIHRvIGEgc2luZ2xlLXNhbXBsZSB0ZXh0dXJlIGlmIG5lY2Vzc2FyeQoKCQkJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCQkJLy8gR2VuZXJhdGUgbWlwbWFwIGlmIHdlJ3JlIHVzaW5nIGFueSBraW5kIG9mIG1pcG1hcCBmaWx0ZXJpbmcKCgkJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKCQkJCX0KCgkJCQkvLwoKCQkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhICk7CgoJCQkJLy8gX2dsLmZpbmlzaCgpOwoKCQkJCWJpbmRpbmdTdGF0ZXMucmVzZXREZWZhdWx0U3RhdGUoKTsKCQkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0xOwoJCQkJX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKCQkJCXJlbmRlclN0YXRlU3RhY2sucG9wKCk7CgoJCQkJaWYgKCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCA+IDAgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2tbIHJlbmRlclN0YXRlU3RhY2subGVuZ3RoIC0gMSBdOwoKCQkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5zZXRHbG9iYWxTdGF0ZSggX3RoaXMuY2xpcHBpbmdQbGFuZXMsIGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5jYW1lcmEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkJCX0KCgkJCQlyZW5kZXJMaXN0U3RhY2sucG9wKCk7CgoJCQkJaWYgKCByZW5kZXJMaXN0U3RhY2subGVuZ3RoID4gMCApIHsKCgkJCQkJY3VycmVudFJlbmRlckxpc3QgPSByZW5kZXJMaXN0U3RhY2tbIHJlbmRlckxpc3RTdGFjay5sZW5ndGggLSAxIF07CgoJCQkJfSBlbHNlIHsKCgkJCQkJY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwoKCQkJCX0KCgkJCX07CgoJCQlmdW5jdGlvbiBwcm9qZWN0T2JqZWN0KCBvYmplY3QsIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMgKSB7CgoJCQkJaWYgKCBvYmplY3QudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJY29uc3QgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKCQkJCWlmICggdmlzaWJsZSApIHsKCgkJCQkJaWYgKCBvYmplY3QuaXNHcm91cCApIHsKCgkJCQkJCWdyb3VwT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xPRCApIHsKCgkJCQkJCWlmICggb2JqZWN0LmF1dG9VcGRhdGUgPT09IHRydWUgKSBvYmplY3QudXBkYXRlKCBjYW1lcmEgKTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGlnaHQgKSB7CgoJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KCBvYmplY3QgKTsKCgkJCQkJCWlmICggb2JqZWN0LmNhc3RTaGFkb3cgKSB7CgoJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTcHJpdGUgKSB7CgoJCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c1Nwcml0ZSggb2JqZWN0ICkgKSB7CgoJCQkJCQkJaWYgKCBzb3J0T2JqZWN0cyApIHsKCgkJCQkJCQkJX3ZlY3RvcjQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBvYmplY3QubWF0cml4V29ybGQgKQoJCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKCQkJCQkJCX0KCgkJCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKCQkJCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKCQkJCQkJCWlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQkJY3VycmVudFJlbmRlckxpc3QucHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3I0LnosIG51bGwgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSB7CgoJCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c09iamVjdCggb2JqZWN0ICkgKSB7CgoJCQkJCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CgkJCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKCQkJCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBvYmplY3QuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgkJCQkJCQkJCV92ZWN0b3I0LmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCQkJCQkJCQkJX3ZlY3RvcjQuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUuY2VudGVyICk7CgoJCQkJCQkJCX0KCgkJCQkJCQkJX3ZlY3RvcjQKCQkJCQkJCQkJLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICkKCQkJCQkJCQkJLmFwcGx5TWF0cml4NCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJCQljb25zdCBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQkJCQlpZiAoIGdyb3VwTWF0ZXJpYWwgJiYgZ3JvdXBNYXRlcmlhbC52aXNpYmxlICkgewoKCQkJCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIGdyb3VwTWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3I0LnosIGdyb3VwICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0KCgkJCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKCQkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjQueiwgbnVsbCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQlwcm9qZWN0T2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIGdyb3VwT3JkZXIsIHNvcnRPYmplY3RzICk7CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhLCB2aWV3cG9ydCApIHsKCgkJCQljb25zdCBvcGFxdWVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3Qub3BhcXVlOwoJCQkJY29uc3QgdHJhbnNtaXNzaXZlT2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zbWlzc2l2ZTsKCQkJCWNvbnN0IHRyYW5zcGFyZW50T2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zcGFyZW50OwoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApOwoKCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLnNldEdsb2JhbFN0YXRlKCBfdGhpcy5jbGlwcGluZ1BsYW5lcywgY2FtZXJhICk7CgoJCQkJaWYgKCB2aWV3cG9ydCApIHN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICkgKTsKCgkJCQlpZiAoIG9wYXF1ZU9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCQkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyT2JqZWN0cyggdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoJCQkJaWYgKCB0cmFuc3BhcmVudE9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIHRyYW5zcGFyZW50T2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJCS8vIEVuc3VyZSBkZXB0aCBidWZmZXIgd3JpdGluZyBpcyBlbmFibGVkIHNvIGl0IGNhbiBiZSBjbGVhcmVkIG9uIG5leHQgcmVuZGVyCgoJCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRUZXN0KCB0cnVlICk7CgkJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldE1hc2soIHRydWUgKTsKCQkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0TWFzayggdHJ1ZSApOwoKCQkJCXN0YXRlLnNldFBvbHlnb25PZmZzZXQoIGZhbHNlICk7CgoJCQl9CgoJCQlmdW5jdGlvbiByZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCWNvbnN0IG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA6IG51bGw7CgoJCQkJaWYgKCBvdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgewoKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCWlmICggY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIDEsIDEsIHsKCQkJCQkJZ2VuZXJhdGVNaXBtYXBzOiB0cnVlLAoJCQkJCQl0eXBlOiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApID8gSGFsZkZsb2F0VHlwZSA6IFVuc2lnbmVkQnl0ZVR5cGUsCgkJCQkJCW1pbkZpbHRlcjogTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyLAoJCQkJCQlzYW1wbGVzOiA0LAoJCQkJCQlzdGVuY2lsQnVmZmVyOiBzdGVuY2lsLAoJCQkJCQlyZXNvbHZlRGVwdGhCdWZmZXI6IGZhbHNlLAoJCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogZmFsc2UsCgkJCQkJCWNvbG9yU3BhY2U6IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSwKCQkJCQl9ICk7CgoJCQkJCS8vIGRlYnVnCgoJCQkJCS8qCgkJCQkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeSgpOwoJCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IG1hcDogX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldC50ZXh0dXJlIH0gKTsKCgkJCQkJY29uc3QgbWVzaCA9IG5ldyBNZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCQkJCQlzY2VuZS5hZGQoIG1lc2ggKTsKCQkJCQkqLwoKCQkJCX0KCgkJCQljb25zdCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUudHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0WyBjYW1lcmEuaWQgXTsKCgkJCQljb25zdCBhY3RpdmVWaWV3cG9ydCA9IGNhbWVyYS52aWV3cG9ydCB8fCBfY3VycmVudFZpZXdwb3J0OwoJCQkJdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnNldFNpemUoIGFjdGl2ZVZpZXdwb3J0LnogKiBfdGhpcy50cmFuc21pc3Npb25SZXNvbHV0aW9uU2NhbGUsIGFjdGl2ZVZpZXdwb3J0LncgKiBfdGhpcy50cmFuc21pc3Npb25SZXNvbHV0aW9uU2NhbGUgKTsKCgkJCQkvLwoKCQkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSBfdGhpcy5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJCWNvbnN0IGN1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IF90aGlzLmdldEFjdGl2ZUN1YmVGYWNlKCk7CgkJCQljb25zdCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSBfdGhpcy5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQkJCV90aGlzLnNldFJlbmRlclRhcmdldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQkJX3RoaXMuZ2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yICk7CgkJCQlfY3VycmVudENsZWFyQWxwaGEgPSBfdGhpcy5nZXRDbGVhckFscGhhKCk7CgkJCQlpZiAoIF9jdXJyZW50Q2xlYXJBbHBoYSA8IDEgKSBfdGhpcy5zZXRDbGVhckNvbG9yKCAweGZmZmZmZiwgMC41ICk7CgoJCQkJX3RoaXMuY2xlYXIoKTsKCgkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgYmFja2dyb3VuZC5yZW5kZXIoIHNjZW5lICk7CgoJCQkJLy8gVHVybiBvZmYgdGhlIGZlYXR1cmVzIHdoaWNoIGNhbiBhZmZlY3QgdGhlIGZyYWcgY29sb3IgZm9yIG9wYXF1ZSBvYmplY3RzIHBhc3MuCgkJCQkvLyBPdGhlcndpc2UgdGhleSBhcmUgYXBwbGllZCB0d2ljZSBpbiBvcGFxdWUgb2JqZWN0cyBwYXNzIGFuZCB0cmFuc21pc3Npb24gb2JqZWN0cyBwYXNzLgoJCQkJY29uc3QgY3VycmVudFRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CgkJCQlfdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQkJLy8gUmVtb3ZlIHZpZXdwb3J0IGZyb20gY2FtZXJhIHRvIGF2b2lkIG5lc3RlZCByZW5kZXIgY2FsbHMgcmVzZXR0aW5nIHZpZXdwb3J0IHRvIGl0IChlLmcgUmVmbGVjdG9yKS4KCQkJCS8vIFRyYW5zbWlzc2lvbiByZW5kZXIgcGFzcyByZXF1aXJlcyB2aWV3cG9ydCB0byBtYXRjaCB0aGUgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LgoJCQkJY29uc3QgY3VycmVudENhbWVyYVZpZXdwb3J0ID0gY2FtZXJhLnZpZXdwb3J0OwoJCQkJaWYgKCBjYW1lcmEudmlld3BvcnQgIT09IHVuZGVmaW5lZCApIGNhbWVyYS52aWV3cG9ydCA9IHVuZGVmaW5lZDsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKTsKCgkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5zZXRHbG9iYWxTdGF0ZSggX3RoaXMuY2xpcHBpbmdQbGFuZXMsIGNhbWVyYSApOwoKCQkJCXJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgkJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IGZhbHNlICkgeyAvLyBzZWUgIzI4MTMxCgoJCQkJCWxldCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQljb25zdCByZW5kZXJJdGVtID0gdHJhbnNtaXNzaXZlT2JqZWN0c1sgaSBdOwoKCQkJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQkJCWNvbnN0IGdlb21ldHJ5ID0gcmVuZGVySXRlbS5nZW9tZXRyeTsKCQkJCQkJY29uc3QgbWF0ZXJpYWwgPSByZW5kZXJJdGVtLm1hdGVyaWFsOwoJCQkJCQljb25zdCBncm91cCA9IHJlbmRlckl0ZW0uZ3JvdXA7CgoJCQkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCQkJY29uc3QgY3VycmVudFNpZGUgPSBtYXRlcmlhbC5zaWRlOwoKCQkJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJCQlyZW5kZXJPYmplY3QoIG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKCQkJCQkJCW1hdGVyaWFsLnNpZGUgPSBjdXJyZW50U2lkZTsKCQkJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJCQlyZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJaWYgKCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCQkJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlfdGhpcy5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQsIGN1cnJlbnRBY3RpdmVDdWJlRmFjZSwgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsICk7CgoJCQkJX3RoaXMuc2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yLCBfY3VycmVudENsZWFyQWxwaGEgKTsKCgkJCQlpZiAoIGN1cnJlbnRDYW1lcmFWaWV3cG9ydCAhPT0gdW5kZWZpbmVkICkgY2FtZXJhLnZpZXdwb3J0ID0gY3VycmVudENhbWVyYVZpZXdwb3J0OwoKCQkJCV90aGlzLnRvbmVNYXBwaW5nID0gY3VycmVudFRvbmVNYXBwaW5nOwoKCQkJfQoKCQkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0cyggcmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApIHsKCgkJCQljb25zdCBvdmVycmlkZU1hdGVyaWFsID0gc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSA/IHNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgOiBudWxsOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHJlbmRlckxpc3QubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckxpc3RbIGkgXTsKCgkJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQkJY29uc3QgZ2VvbWV0cnkgPSByZW5kZXJJdGVtLmdlb21ldHJ5OwoJCQkJCWNvbnN0IGdyb3VwID0gcmVuZGVySXRlbS5ncm91cDsKCQkJCQlsZXQgbWF0ZXJpYWwgPSByZW5kZXJJdGVtLm1hdGVyaWFsOwoKCQkJCQlpZiAoIG1hdGVyaWFsLmFsbG93T3ZlcnJpZGUgPT09IHRydWUgJiYgb3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCApIHsKCgkJCQkJCW1hdGVyaWFsID0gb3ZlcnJpZGVNYXRlcmlhbDsKCgkJCQkJfQoKCQkJCQlpZiAoIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKCQkJCQkJcmVuZGVyT2JqZWN0KCBvYmplY3QsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICkgewoKCQkJCW9iamVjdC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJCQlvYmplY3QubW9kZWxWaWV3TWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoJCQkJb2JqZWN0Lm5vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIG9iamVjdC5tb2RlbFZpZXdNYXRyaXggKTsKCgkJCQltYXRlcmlhbC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICk7CgoJCQkJaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlICYmIG1hdGVyaWFsLmZvcmNlU2luZ2xlUGFzcyA9PT0gZmFsc2UgKSB7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQl9CgoJCQkJb2JqZWN0Lm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApIHsKCgkJCQlpZiAoIHNjZW5lLmlzU2NlbmUgIT09IHRydWUgKSBzY2VuZSA9IF9lbXB0eVNjZW5lOyAvLyBzY2VuZSBjb3VsZCBiZSBhIE1lc2gsIExpbmUsIFBvaW50cywgLi4uCgoJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgoJCQkJY29uc3QgbGlnaHRzID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLmxpZ2h0czsKCQkJCWNvbnN0IHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgoJCQkJY29uc3QgbGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzLnN0YXRlLnZlcnNpb247CgoJCQkJY29uc3QgcGFyYW1ldGVycyA9IHByb2dyYW1DYWNoZS5nZXRQYXJhbWV0ZXJzKCBtYXRlcmlhbCwgbGlnaHRzLnN0YXRlLCBzaGFkb3dzQXJyYXksIHNjZW5lLCBvYmplY3QgKTsKCQkJCWNvbnN0IHByb2dyYW1DYWNoZUtleSA9IHByb2dyYW1DYWNoZS5nZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKTsKCgkJCQlsZXQgcHJvZ3JhbXMgPSBtYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbXM7CgoJCQkJLy8gYWx3YXlzIHVwZGF0ZSBlbnZpcm9ubWVudCBhbmQgZm9nIC0gY2hhbmdpbmcgdGhlc2UgdHJpZ2dlciBhbiBnZXRQcm9ncmFtIGNhbGwsIGJ1dCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHByb2dyYW0gZG9lc24ndCBjaGFuZ2UKCgkJCQltYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyA9IHNjZW5lLmZvZzsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBtYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgKTsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXBSb3RhdGlvbiA9ICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudmlyb25tZW50ICE9PSBudWxsICYmIG1hdGVyaWFsLmVudk1hcCA9PT0gbnVsbCApID8gc2NlbmUuZW52aXJvbm1lbnRSb3RhdGlvbiA6IG1hdGVyaWFsLmVudk1hcFJvdGF0aW9uOwoKCQkJCWlmICggcHJvZ3JhbXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gbmV3IG1hdGVyaWFsCgoJCQkJCW1hdGVyaWFsLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCQkJcHJvZ3JhbXMgPSBuZXcgTWFwKCk7CgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW1zID0gcHJvZ3JhbXM7CgoJCQkJfQoKCQkJCWxldCBwcm9ncmFtID0gcHJvZ3JhbXMuZ2V0KCBwcm9ncmFtQ2FjaGVLZXkgKTsKCgkJCQlpZiAoIHByb2dyYW0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gZWFybHkgb3V0IGlmIHByb2dyYW0gYW5kIGxpZ2h0IHN0YXRlIGlzIGlkZW50aWNhbAoKCQkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9PT0gcHJvZ3JhbSAmJiBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID09PSBsaWdodHNTdGF0ZVZlcnNpb24gKSB7CgoJCQkJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgoJCQkJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCXBhcmFtZXRlcnMudW5pZm9ybXMgPSBwcm9ncmFtQ2FjaGUuZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICk7CgoJCQkJCW1hdGVyaWFsLm9uQmVmb3JlQ29tcGlsZSggcGFyYW1ldGVycywgX3RoaXMgKTsKCgkJCQkJcHJvZ3JhbSA9IHByb2dyYW1DYWNoZS5hY3F1aXJlUHJvZ3JhbSggcGFyYW1ldGVycywgcHJvZ3JhbUNhY2hlS2V5ICk7CgkJCQkJcHJvZ3JhbXMuc2V0KCBwcm9ncmFtQ2FjaGVLZXksIHByb2dyYW0gKTsKCgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zID0gcGFyYW1ldGVycy51bmlmb3JtczsKCgkJCQl9CgoJCQkJY29uc3QgdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgoJCQkJaWYgKCAoICEgbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiAhIG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgKSB8fCBtYXRlcmlhbC5jbGlwcGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJdW5pZm9ybXMuY2xpcHBpbmdQbGFuZXMgPSBjbGlwcGluZy51bmlmb3JtOwoKCQkJCX0KCgkJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgoJCQkJLy8gc3RvcmUgdGhlIGxpZ2h0IHNldHVwIGl0IHdhcyBjcmVhdGVkIGZvcgoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyA9IG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICk7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzU3RhdGVWZXJzaW9uOwoKCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICkgewoKCQkJCQkvLyB3aXJlIHVwIHRoZSBtYXRlcmlhbCB0byB0aGlzIHJlbmRlcmVyJ3MgbGlnaHRpbmcgc3RhdGUKCgkJCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IudmFsdWUgPSBsaWdodHMuc3RhdGUuYW1iaWVudDsKCQkJCQl1bmlmb3Jtcy5saWdodFByb2JlLnZhbHVlID0gbGlnaHRzLnN0YXRlLnByb2JlOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93OwoJCQkJCXVuaWZvcm1zLnNwb3RMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdDsKCQkJCQl1bmlmb3Jtcy5zcG90TGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RTaGFkb3c7CgkJCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWE7CgkJCQkJdW5pZm9ybXMubHRjXzEudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWFMVEMxOwoJCQkJCXVuaWZvcm1zLmx0Y18yLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhTFRDMjsKCQkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludDsKCQkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvdzsKCQkJCQl1bmlmb3Jtcy5oZW1pc3BoZXJlTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmhlbWk7CgoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWFwLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4OwoJCQkJCXVuaWZvcm1zLnNwb3RTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvd01hcDsKCQkJCQl1bmlmb3Jtcy5zcG90TGlnaHRNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdExpZ2h0TWF0cml4OwoJCQkJCXVuaWZvcm1zLnNwb3RMaWdodE1hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90TGlnaHRNYXA7CgkJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXA7CgkJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXRyaXg7CgkJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IGFkZCBhcmVhIGxpZ2h0cyBzaGFkb3cgaW5mbyB0byB1bmlmb3JtcwoKCQkJCX0KCgkJCQltYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW0gPSBwcm9ncmFtOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9IG51bGw7CgoJCQkJcmV0dXJuIHByb2dyYW07CgoJCQl9CgoJCQlmdW5jdGlvbiBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICkgewoKCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9PT0gbnVsbCApIHsKCgkJCQkJY29uc3QgcHJvZ1VuaWZvcm1zID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtLmdldFVuaWZvcm1zKCk7CgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9IFdlYkdMVW5pZm9ybXMuc2VxV2l0aFZhbHVlKCBwcm9nVW5pZm9ybXMuc2VxLCBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXMgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3Q7CgoJCQl9CgoJCQlmdW5jdGlvbiB1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICkgewoKCQkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlID0gcGFyYW1ldGVycy5vdXRwdXRDb2xvclNwYWNlOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID0gcGFyYW1ldGVycy5iYXRjaGluZzsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZ0NvbG9yID0gcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmc7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ0NvbG9yID0gcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3I7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ01vcnBoID0gcGFyYW1ldGVycy5pbnN0YW5jaW5nTW9ycGg7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPSBwYXJhbWV0ZXJzLnNraW5uaW5nOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0cyA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoTm9ybWFscyA9IHBhcmFtZXRlcnMubW9ycGhOb3JtYWxzOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoQ29sb3JzID0gcGFyYW1ldGVycy5tb3JwaENvbG9yczsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQ7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgPSBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUludGVyc2VjdGlvbiA9IHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbjsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgPSBwYXJhbWV0ZXJzLnZlcnRleEFscGhhczsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyA9IHBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHM7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMudG9uZU1hcHBpbmcgPSBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nOwoKCQkJfQoKCQkJZnVuY3Rpb24gc2V0UHJvZ3JhbSggY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QgKSB7CgoJCQkJaWYgKCBzY2VuZS5pc1NjZW5lICE9PSB0cnVlICkgc2NlbmUgPSBfZW1wdHlTY2VuZTsgLy8gc2NlbmUgY291bGQgYmUgYSBNZXNoLCBMaW5lLCBQb2ludHMsIC4uLgoKCQkJCXRleHR1cmVzLnJlc2V0VGV4dHVyZVVuaXRzKCk7CgoJCQkJY29uc3QgZm9nID0gc2NlbmUuZm9nOwoJCQkJY29uc3QgZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoJCQkJY29uc3QgY29sb3JTcGFjZSA9ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgKSA/IF90aGlzLm91dHB1dENvbG9yU3BhY2UgOiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApOwoJCQkJY29uc3QgZW52TWFwID0gKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQgKTsKCQkJCWNvbnN0IHZlcnRleEFscGhhcyA9IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQ7CgkJCQljb25zdCB2ZXJ0ZXhUYW5nZW50cyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudGFuZ2VudCAmJiAoICEhIG1hdGVyaWFsLm5vcm1hbE1hcCB8fCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApOwoJCQkJY29uc3QgbW9ycGhUYXJnZXRzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQkJY29uc3QgbW9ycGhOb3JtYWxzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbDsKCQkJCWNvbnN0IG1vcnBoQ29sb3JzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoKCQkJCWxldCB0b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQkJaWYgKCBtYXRlcmlhbC50b25lTWFwcGVkICkgewoKCQkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKSB7CgoJCQkJCQl0b25lTWFwcGluZyA9IF90aGlzLnRvbmVNYXBwaW5nOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoJCQkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgoJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgkJCQljb25zdCBsaWdodHMgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUubGlnaHRzOwoKCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIHsKCgkJCQkJaWYgKCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgfHwgY2FtZXJhICE9PSBfY3VycmVudENhbWVyYSApIHsKCgkJCQkJCWNvbnN0IHVzZUNhY2hlID0KCQkJCQkJCWNhbWVyYSA9PT0gX2N1cnJlbnRDYW1lcmEgJiYKCQkJCQkJCW1hdGVyaWFsLmlkID09PSBfY3VycmVudE1hdGVyaWFsSWQ7CgoJCQkJCQkvLyB3ZSBtaWdodCB3YW50IHRvIGNhbGwgdGhpcyBmdW5jdGlvbiB3aXRoIHNvbWUgQ2xpcHBpbmdHcm91cAoJCQkJCQkvLyBvYmplY3QgaW5zdGVhZCBvZiB0aGUgbWF0ZXJpYWwsIG9uY2UgaXQgYmVjb21lcyBmZWFzaWJsZQoJCQkJCQkvLyAoIzg0NjUsICM4Mzc5KQoJCQkJCQljbGlwcGluZy5zZXRTdGF0ZSggbWF0ZXJpYWwsIGNhbWVyYSwgdXNlQ2FjaGUgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLwoKCQkJCWxldCBuZWVkc1Byb2dyYW1DaGFuZ2UgPSBmYWxzZTsKCgkJCQlpZiAoIG1hdGVyaWFsLnZlcnNpb24gPT09IG1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gKSB7CgoJCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICYmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiAhPT0gbGlnaHRzLnN0YXRlLnZlcnNpb24gKSApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlICE9PSBjb2xvclNwYWNlICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID09PSBmYWxzZSApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoICEgb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID09PSB0cnVlICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nQ29sb3IgPT09IHRydWUgJiYgb2JqZWN0LmNvbG9yVGV4dHVyZSA9PT0gbnVsbCApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZ0NvbG9yID09PSBmYWxzZSAmJiBvYmplY3QuY29sb3JUZXh0dXJlICE9PSBudWxsICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gZmFsc2UgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCAhIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPT09IHRydWUgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IGZhbHNlICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IHRydWUgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IHRydWUgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgPT09IG51bGwgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IGZhbHNlICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ01vcnBoID09PSB0cnVlICYmIG9iamVjdC5tb3JwaFRleHR1cmUgPT09IG51bGwgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nTW9ycGggPT09IGZhbHNlICYmIG9iamVjdC5tb3JwaFRleHR1cmUgIT09IG51bGwgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMuZW52TWFwICE9PSBlbnZNYXAgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5mb2cgPT09IHRydWUgJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyAhPT0gZm9nICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUNsaXBwaW5nUGxhbmVzICE9PSB1bmRlZmluZWQgJiYKCQkJCQkJKCBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IGNsaXBwaW5nLm51bVBsYW5lcyB8fAoJCQkJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtSW50ZXJzZWN0aW9uICE9PSBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24gKSApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgIT09IHZlcnRleEFscGhhcyApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyAhPT0gdmVydGV4VGFuZ2VudHMgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhUYXJnZXRzICE9PSBtb3JwaFRhcmdldHMgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzICE9PSBtb3JwaE5vcm1hbHMgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhDb2xvcnMgIT09IG1vcnBoQ29sb3JzICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnRvbmVNYXBwaW5nICE9PSB0b25lTWFwcGluZyApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCAhPT0gbW9ycGhUYXJnZXRzQ291bnQgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCQkJCQltYXRlcmlhbFByb3BlcnRpZXMuX192ZXJzaW9uID0gbWF0ZXJpYWwudmVyc2lvbjsKCgkJCQl9CgoJCQkJLy8KCgkJCQlsZXQgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCgkJCQlpZiAoIG5lZWRzUHJvZ3JhbUNoYW5nZSA9PT0gdHJ1ZSApIHsKCgkJCQkJcHJvZ3JhbSA9IGdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJfQoKCQkJCWxldCByZWZyZXNoUHJvZ3JhbSA9IGZhbHNlOwoJCQkJbGV0IHJlZnJlc2hNYXRlcmlhbCA9IGZhbHNlOwoJCQkJbGV0IHJlZnJlc2hMaWdodHMgPSBmYWxzZTsKCgkJCQljb25zdCBwX3VuaWZvcm1zID0gcHJvZ3JhbS5nZXRVbmlmb3JtcygpLAoJCQkJCW1fdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgoJCQkJaWYgKCBzdGF0ZS51c2VQcm9ncmFtKCBwcm9ncmFtLnByb2dyYW0gKSApIHsKCgkJCQkJcmVmcmVzaFByb2dyYW0gPSB0cnVlOwoJCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgkJCQkJcmVmcmVzaExpZ2h0cyA9IHRydWU7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuaWQgIT09IF9jdXJyZW50TWF0ZXJpYWxJZCApIHsKCgkJCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gbWF0ZXJpYWwuaWQ7CgoJCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgoJCQkJfQoKCQkJCWlmICggcmVmcmVzaFByb2dyYW0gfHwgX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCgkJCQkJLy8gY29tbW9uIGNhbWVyYSB1bmlmb3JtcwoKCQkJCQljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSBzdGF0ZS5idWZmZXJzLmRlcHRoLmdldFJldmVyc2VkKCk7CgoJCQkJCWlmICggcmV2ZXJzZURlcHRoQnVmZmVyICkgewoKCQkJCQkJX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkJCQl0b05vcm1hbGl6ZWRQcm9qZWN0aW9uTWF0cml4KCBfY3VycmVudFByb2plY3Rpb25NYXRyaXggKTsKCQkJCQkJdG9SZXZlcnNlZFByb2plY3Rpb25NYXRyaXgoIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwoKCQkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncHJvamVjdGlvbk1hdHJpeCcsIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncHJvamVjdGlvbk1hdHJpeCcsIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkJCX0KCgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAndmlld01hdHJpeCcsIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJCQkJY29uc3QgdUNhbVBvcyA9IHBfdW5pZm9ybXMubWFwLmNhbWVyYVBvc2l0aW9uOwoKCQkJCQlpZiAoIHVDYW1Qb3MgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXVDYW1Qb3Muc2V0VmFsdWUoIF9nbCwgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKSApOwoKCQkJCQl9CgoJCQkJCWlmICggY2FwYWJpbGl0aWVzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgKSB7CgoJCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdsb2dEZXB0aEJ1ZkZDJywKCQkJCQkJCTIuMCAvICggTWF0aC5sb2coIGNhbWVyYS5mYXIgKyAxLjAgKSAvIE1hdGguTE4yICkgKTsKCgkJCQkJfQoKCQkJCQkvLyBjb25zaWRlciBtb3ZpbmcgaXNPcnRob2dyYXBoaWMgdG8gVW5pZm9ybUxpYiBhbmQgV2ViR0xNYXRlcmlhbHMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjY0NjcjaXNzdWVjb21tZW50LTE2NDUxODUwNjcKCgkJCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsIHx8CgkJCQkJCW1hdGVyaWFsLmlzTWVzaFRvb25NYXRlcmlhbCB8fAoJCQkJCQltYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwKCQkJCQkJbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCB8fAoJCQkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8CgkJCQkJCW1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdpc09ydGhvZ3JhcGhpYycsIGNhbWVyYS5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9PT0gdHJ1ZSApOwoKCQkJCQl9CgoJCQkJCWlmICggX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCgkJCQkJCV9jdXJyZW50Q2FtZXJhID0gY2FtZXJhOwoKCQkJCQkJLy8gbGlnaHRpbmcgdW5pZm9ybXMgZGVwZW5kIG9uIHRoZSBjYW1lcmEgc28gZW5mb3JjZSBhbiB1cGRhdGUKCQkJCQkJLy8gbm93LCBpbiBjYXNlIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgbGlnaHRzIC0gb3IgbGF0ZXIsIHdoZW4KCQkJCQkJLy8gdGhlIG5leHQgbWF0ZXJpYWwgdGhhdCBkb2VzIGdldHMgYWN0aXZhdGVkOgoKCQkJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsJCS8vIHNldCB0byB0cnVlIG9uIG1hdGVyaWFsIGNoYW5nZQoJCQkJCQlyZWZyZXNoTGlnaHRzID0gdHJ1ZTsJCS8vIHJlbWFpbnMgc2V0IHVudGlsIHVwZGF0ZSBkb25lCgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gc2tpbm5pbmcgYW5kIG1vcnBoIHRhcmdldCB1bmlmb3JtcyBtdXN0IGJlIHNldCBldmVuIGlmIG1hdGVyaWFsIGRpZG4ndCBjaGFuZ2UKCQkJCS8vIGF1dG8tc2V0dGluZyBvZiB0ZXh0dXJlIHVuaXQgZm9yIGJvbmUgYW5kIG1vcnBoIHRleHR1cmUgbXVzdCBnbyBiZWZvcmUgb3RoZXIgdGV4dHVyZXMKCQkJCS8vIG90aGVyd2lzZSB0ZXh0dXJlcyB1c2VkIGZvciBza2lubmluZyBhbmQgbW9ycGhpbmcgY2FuIHRha2Ugb3ZlciB0ZXh0dXJlIHVuaXRzIHJlc2VydmVkIGZvciBvdGhlciBtYXRlcmlhbCB0ZXh0dXJlcwoKCQkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeCcgKTsKCQkJCQlwX3VuaWZvcm1zLnNldE9wdGlvbmFsKCBfZ2wsIG9iamVjdCwgJ2JpbmRNYXRyaXhJbnZlcnNlJyApOwoKCQkJCQljb25zdCBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCgkJCQkJaWYgKCBza2VsZXRvbiApIHsKCgkJCQkJCWlmICggc2tlbGV0b24uYm9uZVRleHR1cmUgPT09IG51bGwgKSBza2VsZXRvbi5jb21wdXRlQm9uZVRleHR1cmUoKTsKCgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JvbmVUZXh0dXJlJywgc2tlbGV0b24uYm9uZVRleHR1cmUsIHRleHR1cmVzICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBvYmplY3QuaXNCYXRjaGVkTWVzaCApIHsKCgkJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ1RleHR1cmUnICk7CgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdUZXh0dXJlJywgb2JqZWN0Ll9tYXRyaWNlc1RleHR1cmUsIHRleHR1cmVzICk7CgoJCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmF0Y2hpbmdJZFRleHR1cmUnICk7CgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdJZFRleHR1cmUnLCBvYmplY3QuX2luZGlyZWN0VGV4dHVyZSwgdGV4dHVyZXMgKTsKCgkJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ0NvbG9yVGV4dHVyZScgKTsKCQkJCQlpZiAoIG9iamVjdC5fY29sb3JzVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JhdGNoaW5nQ29sb3JUZXh0dXJlJywgb2JqZWN0Ll9jb2xvcnNUZXh0dXJlLCB0ZXh0dXJlcyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCgkJCQlpZiAoIG1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkIHx8IG1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCB8fCAoIG1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgKSB7CgoJCQkJCW1vcnBodGFyZ2V0cy51cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKTsKCgkJCQl9CgoJCQkJaWYgKCByZWZyZXNoTWF0ZXJpYWwgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgIT09IG9iamVjdC5yZWNlaXZlU2hhZG93ICkgewoKCQkJCQltYXRlcmlhbFByb3BlcnRpZXMucmVjZWl2ZVNoYWRvdyA9IG9iamVjdC5yZWNlaXZlU2hhZG93OwoJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3JlY2VpdmVTaGFkb3cnLCBvYmplY3QucmVjZWl2ZVNoYWRvdyApOwoKCQkJCX0KCgkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjQ0NjcjaXNzdWVjb21tZW50LTEyMDkwMzE1MTIKCgkJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaEdvdXJhdWRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgIT09IG51bGwgKSB7CgoJCQkJCW1fdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKCQkJCQltX3VuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSAoIGVudk1hcC5pc0N1YmVUZXh0dXJlICYmIGVudk1hcC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgPT09IG51bGwgJiYgc2NlbmUuZW52aXJvbm1lbnQgIT09IG51bGwgKSB7CgoJCQkJCW1fdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuZW52aXJvbm1lbnRJbnRlbnNpdHk7CgoJCQkJfQoKCQkJCWlmICggcmVmcmVzaE1hdGVyaWFsICkgewoKCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICd0b25lTWFwcGluZ0V4cG9zdXJlJywgX3RoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSApOwoKCQkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyApIHsKCgkJCQkJCS8vIHRoZSBjdXJyZW50IG1hdGVyaWFsIHJlcXVpcmVzIGxpZ2h0aW5nIGluZm8KCgkJCQkJCS8vIG5vdGU6IGFsbCBsaWdodGluZyB1bmlmb3JtcyBhcmUgYWx3YXlzIHNldCBjb3JyZWN0bHkKCQkJCQkJLy8gdGhleSBzaW1wbHkgcmVmZXJlbmNlIHRoZSByZW5kZXJlcidzIHN0YXRlIGZvciB0aGVpcgoJCQkJCQkvLyB2YWx1ZXMKCQkJCQkJLy8KCQkJCQkJLy8gdXNlIHRoZSBjdXJyZW50IG1hdGVyaWFsJ3MgLm5lZWRzVXBkYXRlIGZsYWdzIHRvIHNldAoJCQkJCQkvLyB0aGUgR0wgc3RhdGUgd2hlbiByZXF1aXJlZAoKCQkJCQkJbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUoIG1fdW5pZm9ybXMsIHJlZnJlc2hMaWdodHMgKTsKCgkJCQkJfQoKCQkJCQkvLyByZWZyZXNoIHVuaWZvcm1zIGNvbW1vbiB0byBzZXZlcmFsIG1hdGVyaWFscwoKCQkJCQlpZiAoIGZvZyAmJiBtYXRlcmlhbC5mb2cgPT09IHRydWUgKSB7CgoJCQkJCQltYXRlcmlhbHMucmVmcmVzaEZvZ1VuaWZvcm1zKCBtX3VuaWZvcm1zLCBmb2cgKTsKCgkJCQkJfQoKCQkJCQltYXRlcmlhbHMucmVmcmVzaE1hdGVyaWFsVW5pZm9ybXMoIG1fdW5pZm9ybXMsIG1hdGVyaWFsLCBfcGl4ZWxSYXRpbywgX2hlaWdodCwgY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gKTsKCgkJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgZ2V0VW5pZm9ybUxpc3QoIG1hdGVyaWFsUHJvcGVydGllcyApLCBtX3VuaWZvcm1zLCB0ZXh0dXJlcyApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQlXZWJHTFVuaWZvcm1zLnVwbG9hZCggX2dsLCBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICksIG1fdW5pZm9ybXMsIHRleHR1cmVzICk7CgkJCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuaXNTcHJpdGVNYXRlcmlhbCApIHsKCgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnY2VudGVyJywgb2JqZWN0LmNlbnRlciApOwoKCQkJCX0KCgkJCQkvLyBjb21tb24gbWF0cmljZXMKCgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbFZpZXdNYXRyaXgnLCBvYmplY3QubW9kZWxWaWV3TWF0cml4ICk7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdub3JtYWxNYXRyaXgnLCBvYmplY3Qubm9ybWFsTWF0cml4ICk7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbE1hdHJpeCcsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCS8vIFVCT3MKCgkJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCgkJCQkJY29uc3QgZ3JvdXBzID0gbWF0ZXJpYWwudW5pZm9ybXNHcm91cHM7CgoJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCgkJCQkJCXVuaWZvcm1zR3JvdXBzLnVwZGF0ZSggZ3JvdXAsIHByb2dyYW0gKTsKCQkJCQkJdW5pZm9ybXNHcm91cHMuYmluZCggZ3JvdXAsIHByb2dyYW0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJCX0KCgkJCS8vIElmIHVuaWZvcm1zIGFyZSBtYXJrZWQgYXMgY2xlYW4sIHRoZXkgZG9uJ3QgbmVlZCB0byBiZSBsb2FkZWQgdG8gdGhlIEdQVS4KCgkJCWZ1bmN0aW9uIG1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKCB1bmlmb3JtcywgdmFsdWUgKSB7CgoJCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJCXVuaWZvcm1zLmxpZ2h0UHJvYmUubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodFNoYWRvd3MubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJCXVuaWZvcm1zLnBvaW50TGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMuc3BvdExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMuc3BvdExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJCXVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICkgewoKCQkJCXJldHVybiBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgfHwKCQkJCQkoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwubGlnaHRzID09PSB0cnVlICk7CgoJCQl9CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgYWN0aXZlIGN1YmUgZmFjZS4KCQkJICoKCQkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgYWN0aXZlIGN1YmUgZmFjZS4KCQkJICovCgkJCXRoaXMuZ2V0QWN0aXZlQ3ViZUZhY2UgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIF9jdXJyZW50QWN0aXZlQ3ViZUZhY2U7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGFjdGl2ZSBtaXBtYXAgbGV2ZWwuCgkJCSAqCgkJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFjdGl2ZSBtaXBtYXAgbGV2ZWwuCgkJCSAqLwoJCQl0aGlzLmdldEFjdGl2ZU1pcG1hcExldmVsID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBhY3RpdmUgcmVuZGVyIHRhcmdldC4KCQkJICoKCQkJICogQHJldHVybiB7P1dlYkdMUmVuZGVyVGFyZ2V0fSBUaGUgYWN0aXZlIHJlbmRlciB0YXJnZXQuIFJldHVybnMgYG51bGxgIGlmIG5vIHJlbmRlciB0YXJnZXQKCQkJICogaXMgY3VycmVudGx5IHNldC4KCQkJICovCgkJCXRoaXMuZ2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBfY3VycmVudFJlbmRlclRhcmdldDsKCgkJCX07CgoJCQl0aGlzLnNldFJlbmRlclRhcmdldFRleHR1cmVzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGNvbG9yVGV4dHVyZSwgZGVwdGhUZXh0dXJlICkgewoKCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2F1dG9BbGxvY2F0ZURlcHRoQnVmZmVyID0gcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2U7CgkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgKSB7CgoJCQkJCS8vIFRoZSBtdWx0aXNhbXBsZV9yZW5kZXJfdG9fdGV4dHVyZSBleHRlbnNpb24gZG9lc24ndCB3b3JrIHByb3Blcmx5IGlmIHRoZXJlCgkJCQkJLy8gYXJlIG1pZGZyYW1lIGZsdXNoZXMgYW5kIGFuIGV4dGVybmFsIGRlcHRoIGJ1ZmZlci4gRGlzYWJsZSB1c2Ugb2YgdGhlIGV4dGVuc2lvbi4KCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlUmVuZGVyVG9UZXh0dXJlID0gZmFsc2U7CgoJCQkJfQoKCQkJCXByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlID0gY29sb3JUZXh0dXJlOwoJCQkJcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA/IHVuZGVmaW5lZCA6IGRlcHRoVGV4dHVyZTsKCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faGFzRXh0ZXJuYWxUZXh0dXJlcyA9IHRydWU7CgoJCQl9OwoKCQkJdGhpcy5zZXRSZW5kZXJUYXJnZXRGcmFtZWJ1ZmZlciA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBkZWZhdWx0RnJhbWVidWZmZXIgKSB7CgoJCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gZGVmYXVsdEZyYW1lYnVmZmVyOwoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciA9IGRlZmF1bHRGcmFtZWJ1ZmZlciA9PT0gdW5kZWZpbmVkOwoKCQkJfTsKCgkJCWNvbnN0IF9zY3JhdGNoRnJhbWVCdWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCgkJCS8qKgoJCQkgKiBTZXRzIHRoZSBhY3RpdmUgcmVuZGVydGFyZ2V0LgoJCQkgKgoJCQkgKiBAcGFyYW0gez9XZWJHTFJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG8gc2V0LiBXaGVuIGBudWxsYCBpcyBnaXZlbiwKCQkJICogdGhlIGNhbnZhcyBpcyBzZXQgYXMgdGhlIGFjdGl2ZSByZW5kZXIgdGFyZ2V0IGluc3RlYWQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWN0aXZlQ3ViZUZhY2U9MF0gLSBUaGUgYWN0aXZlIGN1YmUgZmFjZSB3aGVuIHVzaW5nIGEgY3ViZSByZW5kZXIgdGFyZ2V0LgoJCQkgKiBJbmRpY2F0ZXMgdGhlIHogbGF5ZXIgdG8gcmVuZGVyIGluIHRvIHdoZW4gdXNpbmcgM0Qgb3IgYXJyYXkgcmVuZGVyIHRhcmdldHMuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWN0aXZlTWlwbWFwTGV2ZWw9MF0gLSBUaGUgYWN0aXZlIG1pcG1hcCBsZXZlbC4KCQkJICovCgkJCXRoaXMuc2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGFjdGl2ZUN1YmVGYWNlID0gMCwgYWN0aXZlTWlwbWFwTGV2ZWwgPSAwICkgewoKCQkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoJCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IGFjdGl2ZUN1YmVGYWNlOwoJCQkJX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IGFjdGl2ZU1pcG1hcExldmVsOwoKCQkJCWxldCB1c2VEZWZhdWx0RnJhbWVidWZmZXIgPSB0cnVlOwoJCQkJbGV0IGZyYW1lYnVmZmVyID0gbnVsbDsKCQkJCWxldCBpc0N1YmUgPSBmYWxzZTsKCQkJCWxldCBpc1JlbmRlclRhcmdldDNEID0gZmFsc2U7CgoJCQkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJLy8gV2UgbmVlZCB0byBtYWtlIHN1cmUgdG8gcmViaW5kIHRoZSBmcmFtZWJ1ZmZlci4KCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJCQkJdXNlRGVmYXVsdEZyYW1lYnVmZmVyID0gZmFsc2U7CgoJCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQl0ZXh0dXJlcy5zZXR1cFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJCQkJLy8gQ29sb3IgYW5kIGRlcHRoIHRleHR1cmUgbXVzdCBiZSByZWJvdW5kIGluIG9yZGVyIGZvciB0aGUgc3dhcGNoYWluIHRvIHVwZGF0ZS4KCQkJCQkJdGV4dHVyZXMucmViaW5kVGV4dHVyZXMoIHJlbmRlclRhcmdldCwgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkuX193ZWJnbFRleHR1cmUgKTsKCgkJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKCQkJCQkJLy8gY2hlY2sgaWYgdGhlIGRlcHRoIHRleHR1cmUgaXMgYWxyZWFkeSBib3VuZCB0byB0aGUgZnJhbWUgYnVmZmVyIGFuZCB0aGF0IGl0J3MgYmVlbiBpbml0aWFsaXplZAoJCQkJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwoJCQkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19ib3VuZERlcHRoVGV4dHVyZSAhPT0gZGVwdGhUZXh0dXJlICkgewoKCQkJCQkJCS8vIGNoZWNrIGlmIHRoZSBkZXB0aCB0ZXh0dXJlIGlzIGNvbXBhdGlibGUKCQkJCQkJCWlmICgKCQkJCQkJCQlkZXB0aFRleHR1cmUgIT09IG51bGwgJiYKCQkJCQkJCQlwcm9wZXJ0aWVzLmhhcyggZGVwdGhUZXh0dXJlICkgJiYKCQkJCQkJCQkoIHJlbmRlclRhcmdldC53aWR0aCAhPT0gZGVwdGhUZXh0dXJlLmltYWdlLndpZHRoIHx8IHJlbmRlclRhcmdldC5oZWlnaHQgIT09IGRlcHRoVGV4dHVyZS5pbWFnZS5oZWlnaHQgKQoJCQkJCQkJKSB7CgoJCQkJCQkJCXRocm93IG5ldyBFcnJvciggJ1dlYkdMUmVuZGVyVGFyZ2V0OiBBdHRhY2hlZCBEZXB0aFRleHR1cmUgaXMgaW5pdGlhbGl6ZWQgdG8gdGhlIGluY29ycmVjdCBzaXplLicgKTsKCgkJCQkJCQl9CgoJCQkJCQkJLy8gU3dhcCB0aGUgZGVwdGggYnVmZmVyIHRvIHRoZSBjdXJyZW50bHkgYXR0YWNoZWQgb25lCgkJCQkJCQl0ZXh0dXJlcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJCWlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgfHwgdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCQlpc1JlbmRlclRhcmdldDNEID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQljb25zdCBfX3dlYmdsRnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApIHsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdICkgKSB7CgoJCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF1bIGFjdGl2ZU1pcG1hcExldmVsIF07CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdOwoKCQkJCQkJfQoKCQkJCQkJaXNDdWJlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggKCByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB0ZXh0dXJlcy51c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCgkJCQkJCWZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlcjsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgoJCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZU1pcG1hcExldmVsIF07CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCV9jdXJyZW50Vmlld3BvcnQuY29weSggcmVuZGVyVGFyZ2V0LnZpZXdwb3J0ICk7CgkJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIHJlbmRlclRhcmdldC5zY2lzc29yICk7CgkJCQkJX2N1cnJlbnRTY2lzc29yVGVzdCA9IHJlbmRlclRhcmdldC5zY2lzc29yVGVzdDsKCgkJCQl9IGVsc2UgewoKCQkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLmZsb29yKCk7CgkJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCQkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gX3NjaXNzb3JUZXN0OwoKCQkJCX0KCgkJCQkvLyBVc2UgYSBzY3JhdGNoIGZyYW1lIGJ1ZmZlciBpZiByZW5kZXJpbmcgdG8gYSBtaXAgbGV2ZWwgdG8gYXZvaWQgZGVwdGggYnVmZmVycwoJCQkJLy8gYmVpbmcgYm91bmQgdGhhdCBhcmUgZGlmZmVyZW50IHNpemVzLgoJCQkJaWYgKCBhY3RpdmVNaXBtYXBMZXZlbCAhPT0gMCApIHsKCgkJCQkJZnJhbWVidWZmZXIgPSBfc2NyYXRjaEZyYW1lQnVmZmVyOwoKCQkJCX0KCgkJCQljb25zdCBmcmFtZWJ1ZmZlckJvdW5kID0gc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCQkJaWYgKCBmcmFtZWJ1ZmZlckJvdW5kICYmIHVzZURlZmF1bHRGcmFtZWJ1ZmZlciApIHsKCgkJCQkJc3RhdGUuZHJhd0J1ZmZlcnMoIHJlbmRlclRhcmdldCwgZnJhbWVidWZmZXIgKTsKCgkJCQl9CgoJCQkJc3RhdGUudmlld3BvcnQoIF9jdXJyZW50Vmlld3BvcnQgKTsKCQkJCXN0YXRlLnNjaXNzb3IoIF9jdXJyZW50U2Npc3NvciApOwoJCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9jdXJyZW50U2Npc3NvclRlc3QgKTsKCgkJCQlpZiAoIGlzQ3ViZSApIHsKCgkJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgYWN0aXZlQ3ViZUZhY2UsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBhY3RpdmVNaXBtYXBMZXZlbCApOwoKCQkJCX0gZWxzZSBpZiAoIGlzUmVuZGVyVGFyZ2V0M0QgKSB7CgoJCQkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgkJCQkJY29uc3QgbGF5ZXIgPSBhY3RpdmVDdWJlRmFjZTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgYWN0aXZlTWlwbWFwTGV2ZWwsIGxheWVyICk7CgoJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0ICE9PSBudWxsICYmIGFjdGl2ZU1pcG1hcExldmVsICE9PSAwICkgewoKCQkJCQkvLyBPbmx5IGJpbmQgdGhlIGZyYW1lIGJ1ZmZlciBpZiB3ZSBhcmUgdXNpbmcgYSBzY3JhdGNoIGZyYW1lIGJ1ZmZlciB0byByZW5kZXIgdG8gYSBtaXBtYXAuCgkJCQkJLy8gSWYgd2UgcmViaW5kIHRoZSB0ZXh0dXJlIHdoZW4gdXNpbmcgYSBtdWx0aSBzYW1wbGUgYnVmZmVyIHRoZW4gYW4gZXJyb3IgYWJvdXQgaW5jb25zaXN0ZW50IHNhbXBsZXMgd2lsbCBiZSB0aHJvd24uCgkJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJCQkJfQoKCQkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0xOyAvLyByZXNldCBjdXJyZW50IG1hdGVyaWFsIHRvIGVuc3VyZSBjb3JyZWN0IHVuaWZvcm0gYmluZGluZ3MKCgkJCX07CgoJCQkvKioKCQkJICogUmVhZHMgdGhlIHBpeGVsIGRhdGEgZnJvbSB0aGUgZ2l2ZW4gcmVuZGVyIHRhcmdldCBpbnRvIHRoZSBnaXZlbiBidWZmZXIuCgkJCSAqCgkJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHJlYWQgZnJvbS4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYHhgIGNvb3JkaW5hdGUgb2YgdGhlIGNvcHkgcmVnaW9uJ3Mgb3JpZ2luLgoJCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBgeWAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgY29weSByZWdpb24uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjb3B5IHJlZ2lvbi4KCQkJICogQHBhcmFtIHtUeXBlZEFycmF5fSBidWZmZXIgLSBUaGUgcmVzdWx0IGJ1ZmZlci4KCQkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZUluZGV4XSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIGluZGV4LgoJCQkgKiBAcGFyYW0ge251bWJlcn0gW3RleHR1cmVJbmRleD0wXSAtIFRoZSB0ZXh0dXJlIGluZGV4IG9mIGFuIE1SVCByZW5kZXIgdGFyZ2V0LgoJCQkgKi8KCQkJdGhpcy5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGJ1ZmZlciwgYWN0aXZlQ3ViZUZhY2VJbmRleCwgdGV4dHVyZUluZGV4ID0gMCApIHsKCgkJCQlpZiAoICEgKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXQgKSApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQlsZXQgZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICYmIGFjdGl2ZUN1YmVGYWNlSW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJZnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2VJbmRleCBdOwoKCQkJCX0KCgkJCQlpZiAoIGZyYW1lYnVmZmVyICkgewoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCQkJdHJ5IHsKCgkJCQkJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZXNbIHRleHR1cmVJbmRleCBdOwoJCQkJCQljb25zdCB0ZXh0dXJlRm9ybWF0ID0gdGV4dHVyZS5mb3JtYXQ7CgkJCQkJCWNvbnN0IHRleHR1cmVUeXBlID0gdGV4dHVyZS50eXBlOwoKCQkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSApIHsKCgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IGluIFJHQkEgb3IgaW1wbGVtZW50YXRpb24gZGVmaW5lZCBmb3JtYXQuJyApOwoJCQkJCQkJcmV0dXJuOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlVHlwZVJlYWRhYmxlKCB0ZXh0dXJlVHlwZSApICkgewoKCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwoJCQkJCQkJcmV0dXJuOwoKCQkJCQkJfQoKCQkJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQoKCQkJCQkJaWYgKCAoIHggPj0gMCAmJiB4IDw9ICggcmVuZGVyVGFyZ2V0LndpZHRoIC0gd2lkdGggKSApICYmICggeSA+PSAwICYmIHkgPD0gKCByZW5kZXJUYXJnZXQuaGVpZ2h0IC0gaGVpZ2h0ICkgKSApIHsKCgkJCQkJCQkvLyB3aGVuIHVzaW5nIE1SVCwgc2VsZWN0IHRoZSBjb3JyZWN0IGNvbG9yIGJ1ZmZlciBmb3IgdGhlIHN1YnNlcXVlbnQgcmVhZCBjb21tYW5kCgoJCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQudGV4dHVyZXMubGVuZ3RoID4gMSApIF9nbC5yZWFkQnVmZmVyKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyB0ZXh0dXJlSW5kZXggKTsKCgkJCQkJCQlfZ2wucmVhZFBpeGVscyggeCwgeSwgd2lkdGgsIGhlaWdodCwgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApLCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApLCBidWZmZXIgKTsKCgkJCQkJCX0KCgkJCQkJfSBmaW5hbGx5IHsKCgkJCQkJCS8vIHJlc3RvcmUgZnJhbWVidWZmZXIgb2YgY3VycmVudCByZW5kZXIgdGFyZ2V0IGlmIG5lY2Vzc2FyeQoKCQkJCQkJY29uc3QgZnJhbWVidWZmZXIgPSAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgPyBwcm9wZXJ0aWVzLmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgOiBudWxsOwoJCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogQXN5bmNocm9ub3VzLCBub24tYmxvY2tpbmcgdmVyc2lvbiBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNyZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzfS4KCQkJICoKCQkJICogSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoaXMgdmVyc2lvbiBvZiBgcmVhZFJlbmRlclRhcmdldFBpeGVscygpYCB3aGVuZXZlciBwb3NzaWJsZS4KCQkJICoKCQkJICogQGFzeW5jCgkJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHJlYWQgZnJvbS4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYHhgIGNvb3JkaW5hdGUgb2YgdGhlIGNvcHkgcmVnaW9uJ3Mgb3JpZ2luLgoJCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBgeWAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgY29weSByZWdpb24uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjb3B5IHJlZ2lvbi4KCQkJICogQHBhcmFtIHtUeXBlZEFycmF5fSBidWZmZXIgLSBUaGUgcmVzdWx0IGJ1ZmZlci4KCQkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZUluZGV4XSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIGluZGV4LgoJCQkgKiBAcGFyYW0ge251bWJlcn0gW3RleHR1cmVJbmRleD0wXSAtIFRoZSB0ZXh0dXJlIGluZGV4IG9mIGFuIE1SVCByZW5kZXIgdGFyZ2V0LgoJCQkgKiBAcmV0dXJuIHtQcm9taXNlPFR5cGVkQXJyYXk+fSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSByZWFkIGhhcyBiZWVuIGZpbmlzaGVkLiBUaGUgcmVzb2x2ZSBwcm92aWRlcyB0aGUgcmVhZCBkYXRhIGFzIGEgdHlwZWQgYXJyYXkuCgkJCSAqLwoJCQl0aGlzLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHNBc3luYyA9IGFzeW5jIGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBidWZmZXIsIGFjdGl2ZUN1YmVGYWNlSW5kZXgsIHRleHR1cmVJbmRleCA9IDAgKSB7CgoJCQkJaWYgKCAhICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CgoJCQkJfQoKCQkJCWxldCBmcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CgkJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCAmJiBhY3RpdmVDdWJlRmFjZUluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlSW5kZXggXTsKCgkJCQl9CgoJCQkJaWYgKCBmcmFtZWJ1ZmZlciApIHsKCgkJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQoJCQkJCWlmICggKCB4ID49IDAgJiYgeCA8PSAoIHJlbmRlclRhcmdldC53aWR0aCAtIHdpZHRoICkgKSAmJiAoIHkgPj0gMCAmJiB5IDw9ICggcmVuZGVyVGFyZ2V0LmhlaWdodCAtIGhlaWdodCApICkgKSB7CgoJCQkJCQkvLyBzZXQgdGhlIGFjdGl2ZSBmcmFtZSBidWZmZXIgdG8gdGhlIG9uZSB3ZSB3YW50IHRvIHJlYWQKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCQkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzWyB0ZXh0dXJlSW5kZXggXTsKCQkJCQkJY29uc3QgdGV4dHVyZUZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwoJCQkJCQljb25zdCB0ZXh0dXJlVHlwZSA9IHRleHR1cmUudHlwZTsKCgkJCQkJCWlmICggISBjYXBhYmlsaXRpZXMudGV4dHVyZUZvcm1hdFJlYWRhYmxlKCB0ZXh0dXJlRm9ybWF0ICkgKSB7CgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gUkdCQSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIGZvcm1hdC4nICk7CgoJCQkJCQl9CgoJCQkJCQlpZiAoICEgY2FwYWJpbGl0aWVzLnRleHR1cmVUeXBlUmVhZGFibGUoIHRleHR1cmVUeXBlICkgKSB7CgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwoKCQkJCQkJfQoKCQkJCQkJY29uc3QgZ2xCdWZmZXIgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCQkJCV9nbC5iaW5kQnVmZmVyKCBfZ2wuUElYRUxfUEFDS19CVUZGRVIsIGdsQnVmZmVyICk7CgkJCQkJCV9nbC5idWZmZXJEYXRhKCBfZ2wuUElYRUxfUEFDS19CVUZGRVIsIGJ1ZmZlci5ieXRlTGVuZ3RoLCBfZ2wuU1RSRUFNX1JFQUQgKTsKCgkJCQkJCS8vIHdoZW4gdXNpbmcgTVJULCBzZWxlY3QgdGhlIGNvcmVjdCBjb2xvciBidWZmZXIgZm9yIHRoZSBzdWJzZXF1ZW50IHJlYWQgY29tbWFuZAoKCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQudGV4dHVyZXMubGVuZ3RoID4gMSApIF9nbC5yZWFkQnVmZmVyKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyB0ZXh0dXJlSW5kZXggKTsKCgkJCQkJCV9nbC5yZWFkUGl4ZWxzKCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICksIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICksIDAgKTsKCgkJCQkJCS8vIHJlc2V0IHRoZSBmcmFtZSBidWZmZXIgdG8gdGhlIGN1cnJlbnRseSBzZXQgYnVmZmVyIGJlZm9yZSB3YWl0aW5nCgkJCQkJCWNvbnN0IGN1cnJGcmFtZWJ1ZmZlciA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsID8gcHJvcGVydGllcy5nZXQoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyIDogbnVsbDsKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGN1cnJGcmFtZWJ1ZmZlciApOwoKCQkJCQkJLy8gY2hlY2sgaWYgdGhlIGNvbW1hbmRzIGhhdmUgZmluaXNoZWQgZXZlcnkgOCBtcwoJCQkJCQljb25zdCBzeW5jID0gX2dsLmZlbmNlU3luYyggX2dsLlNZTkNfR1BVX0NPTU1BTkRTX0NPTVBMRVRFLCAwICk7CgoJCQkJCQlfZ2wuZmx1c2goKTsKCgkJCQkJCWF3YWl0IHByb2JlQXN5bmMoIF9nbCwgc3luYywgNCApOwoKCQkJCQkJLy8gcmVhZCB0aGUgZGF0YSBhbmQgZGVsZXRlIHRoZSBidWZmZXIKCQkJCQkJX2dsLmJpbmRCdWZmZXIoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgZ2xCdWZmZXIgKTsKCQkJCQkJX2dsLmdldEJ1ZmZlclN1YkRhdGEoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgMCwgYnVmZmVyICk7CgkJCQkJCV9nbC5kZWxldGVCdWZmZXIoIGdsQnVmZmVyICk7CgkJCQkJCV9nbC5kZWxldGVTeW5jKCBzeW5jICk7CgoJCQkJCQlyZXR1cm4gYnVmZmVyOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlcXVlc3RlZCByZWFkIGJvdW5kcyBhcmUgb3V0IG9mIHJhbmdlLicgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogQ29waWVzIHBpeGVscyBmcm9tIHRoZSBjdXJyZW50IGJvdW5kIGZyYW1lYnVmZmVyIGludG8gdGhlIGdpdmVuIHRleHR1cmUuCgkJCSAqCgkJCSAqIEBwYXJhbSB7RnJhbWVidWZmZXJUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIHRleHR1cmUuCgkJCSAqIEBwYXJhbSB7P1ZlY3RvcjJ9IFtwb3NpdGlvbj1udWxsXSAtIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgY29weSBvcGVyYXRpb24uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbGV2ZWw9MF0gLSBUaGUgbWlwIGxldmVsLiBUaGUgZGVmYXVsdCByZXByZXNlbnRzIHRoZSBiYXNlIG1pcC4KCQkJICovCgkJCXRoaXMuY29weUZyYW1lYnVmZmVyVG9UZXh0dXJlID0gZnVuY3Rpb24gKCB0ZXh0dXJlLCBwb3NpdGlvbiA9IG51bGwsIGxldmVsID0gMCApIHsKCgkJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gbGV2ZWwgKTsKCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggdGV4dHVyZS5pbWFnZS53aWR0aCAqIGxldmVsU2NhbGUgKTsKCQkJCWNvbnN0IGhlaWdodCA9IE1hdGguZmxvb3IoIHRleHR1cmUuaW1hZ2UuaGVpZ2h0ICogbGV2ZWxTY2FsZSApOwoKCQkJCWNvbnN0IHggPSBwb3NpdGlvbiAhPT0gbnVsbCA/IHBvc2l0aW9uLnggOiAwOwoJCQkJY29uc3QgeSA9IHBvc2l0aW9uICE9PSBudWxsID8gcG9zaXRpb24ueSA6IDA7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgoJCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWwsIDAsIDAsIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9OwoKCQkJY29uc3QgX3NyY0ZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgkJCWNvbnN0IF9kc3RGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJLyoqCgkJCSAqIENvcGllcyBkYXRhIG9mIHRoZSBnaXZlbiBzb3VyY2UgdGV4dHVyZSBpbnRvIGEgZGVzdGluYXRpb24gdGV4dHVyZS4KCQkJICoKCQkJICogV2hlbiB1c2luZyByZW5kZXIgdGFyZ2V0IHRleHR1cmVzIGFzIGBzcmNUZXh0dXJlYCBhbmQgYGRzdFRleHR1cmVgLCB5b3UgbXVzdCBtYWtlIHN1cmUgYm90aCByZW5kZXIgdGFyZ2V0cyBhcmUgaW5pdGlhbGl6ZWQKCQkJICoge0BsaW5rIFdlYkdMUmVuZGVyZXIjaW5pdFJlbmRlclRhcmdldH0uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VGV4dHVyZX0gc3JjVGV4dHVyZSAtIFRoZSBzb3VyY2UgdGV4dHVyZS4KCQkJICogQHBhcmFtIHtUZXh0dXJlfSBkc3RUZXh0dXJlIC0gVGhlIGRlc3RpbmF0aW9uIHRleHR1cmUuCgkJCSAqIEBwYXJhbSB7PyhCb3gyfEJveDMpfSBbc3JjUmVnaW9uPW51bGxdIC0gQSBib3VuZGluZyBib3ggd2hpY2ggZGVzY3JpYmVzIHRoZSBzb3VyY2UgcmVnaW9uLiBDYW4gYmUgdHdvIG9yIHRocmVlLWRpbWVuc2lvbmFsLgoJCQkgKiBAcGFyYW0gez8oVmVjdG9yMnxWZWN0b3IzKX0gW2RzdFBvc2l0aW9uPW51bGxdIC0gQSB2ZWN0b3IgdGhhdCByZXByZXNlbnRzIHRoZSBvcmlnaW4gb2YgdGhlIGRlc3RpbmF0aW9uIHJlZ2lvbi4gQ2FuIGJlIHR3byBvciB0aHJlZS1kaW1lbnNpb25hbC4KCQkJICogQHBhcmFtIHtudW1iZXJ9IFtzcmNMZXZlbD0wXSAtIFRoZSBzb3VyY2UgbWlwbWFwIGxldmVsIHRvIGNvcHkuCgkJCSAqIEBwYXJhbSB7P251bWJlcn0gW2RzdExldmVsPW51bGxdIC0gVGhlIGRlc3RpbmF0aW9uIG1pcG1hcCBsZXZlbC4KCQkJICovCgkJCXRoaXMuY29weVRleHR1cmVUb1RleHR1cmUgPSBmdW5jdGlvbiAoIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIHNyY1JlZ2lvbiA9IG51bGwsIGRzdFBvc2l0aW9uID0gbnVsbCwgc3JjTGV2ZWwgPSAwLCBkc3RMZXZlbCA9IG51bGwgKSB7CgoJCQkJLy8gc3VwcG9ydCB0aGUgcHJldmlvdXMgc2lnbmF0dXJlIHdpdGgganVzdCBhIHNpbmdsZSBkc3QgbWlwbWFwIGxldmVsCgkJCQlpZiAoIGRzdExldmVsID09PSBudWxsICkgewoKCQkJCQlpZiAoIHNyY0xldmVsICE9PSAwICkgewoKCQkJCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNzEKCQkJCQkJd2Fybk9uY2UoICdXZWJHTFJlbmRlcmVyOiBjb3B5VGV4dHVyZVRvVGV4dHVyZSBmdW5jdGlvbiBzaWduYXR1cmUgaGFzIGNoYW5nZWQgdG8gc3VwcG9ydCBzcmMgYW5kIGRzdCBtaXBtYXAgbGV2ZWxzLicgKTsKCQkJCQkJZHN0TGV2ZWwgPSBzcmNMZXZlbDsKCQkJCQkJc3JjTGV2ZWwgPSAwOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZHN0TGV2ZWwgPSAwOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGdhdGhlciB0aGUgbmVjZXNzYXJ5IGRpbWVuc2lvbnMgdG8gY29weQoJCQkJbGV0IHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBtaW5YLCBtaW5ZLCBtaW5aOwoJCQkJbGV0IGRzdFgsIGRzdFksIGRzdFo7CgkJCQljb25zdCBpbWFnZSA9IHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSA/IHNyY1RleHR1cmUubWlwbWFwc1sgZHN0TGV2ZWwgXSA6IHNyY1RleHR1cmUuaW1hZ2U7CgkJCQlpZiAoIHNyY1JlZ2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJd2lkdGggPSBzcmNSZWdpb24ubWF4LnggLSBzcmNSZWdpb24ubWluLng7CgkJCQkJaGVpZ2h0ID0gc3JjUmVnaW9uLm1heC55IC0gc3JjUmVnaW9uLm1pbi55OwoJCQkJCWRlcHRoID0gc3JjUmVnaW9uLmlzQm94MyA/IHNyY1JlZ2lvbi5tYXgueiAtIHNyY1JlZ2lvbi5taW4ueiA6IDE7CgkJCQkJbWluWCA9IHNyY1JlZ2lvbi5taW4ueDsKCQkJCQltaW5ZID0gc3JjUmVnaW9uLm1pbi55OwoJCQkJCW1pblogPSBzcmNSZWdpb24uaXNCb3gzID8gc3JjUmVnaW9uLm1pbi56IDogMDsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gc3JjTGV2ZWwgKTsKCQkJCQl3aWR0aCA9IE1hdGguZmxvb3IoIGltYWdlLndpZHRoICogbGV2ZWxTY2FsZSApOwoJCQkJCWhlaWdodCA9IE1hdGguZmxvb3IoIGltYWdlLmhlaWdodCAqIGxldmVsU2NhbGUgKTsKCQkJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlICkgewoKCQkJCQkJZGVwdGggPSBpbWFnZS5kZXB0aDsKCgkJCQkJfSBlbHNlIGlmICggc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJCQlkZXB0aCA9IE1hdGguZmxvb3IoIGltYWdlLmRlcHRoICogbGV2ZWxTY2FsZSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZGVwdGggPSAxOwoKCQkJCQl9CgoJCQkJCW1pblggPSAwOwoJCQkJCW1pblkgPSAwOwoJCQkJCW1pblogPSAwOwoKCQkJCX0KCgkJCQlpZiAoIGRzdFBvc2l0aW9uICE9PSBudWxsICkgewoKCQkJCQlkc3RYID0gZHN0UG9zaXRpb24ueDsKCQkJCQlkc3RZID0gZHN0UG9zaXRpb24ueTsKCQkJCQlkc3RaID0gZHN0UG9zaXRpb24uejsKCgkJCQl9IGVsc2UgewoKCQkJCQlkc3RYID0gMDsKCQkJCQlkc3RZID0gMDsKCQkJCQlkc3RaID0gMDsKCgkJCQl9CgoJCQkJLy8gU2V0IHVwIHRoZSBkZXN0aW5hdGlvbiB0YXJnZXQKCQkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS5mb3JtYXQgKTsKCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIGRzdFRleHR1cmUudHlwZSApOwoJCQkJbGV0IGdsVGFyZ2V0OwoKCQkJCWlmICggZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJCXRleHR1cmVzLnNldFRleHR1cmUzRCggZHN0VGV4dHVyZSwgMCApOwoJCQkJCWdsVGFyZ2V0ID0gX2dsLlRFWFRVUkVfM0Q7CgoJCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgZHN0VGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCBkc3RUZXh0dXJlLCAwICk7CgkJCQkJZ2xUYXJnZXQgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIGRzdFRleHR1cmUsIDAgKTsKCQkJCQlnbFRhcmdldCA9IF9nbC5URVhUVVJFXzJEOwoKCQkJCX0KCgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBkc3RUZXh0dXJlLmZsaXBZICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGRzdFRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgZHN0VGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCgkJCQkvLyB1c2VkIGZvciBjb3B5aW5nIGRhdGEgZnJvbSBjcHUKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tSb3dMZW4gPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEggKTsKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tJbWFnZUhlaWdodCA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfSU1BR0VfSEVJR0hUICk7CgkJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CgkJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcEltYWdlcyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMgKTsKCgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgaW1hZ2Uud2lkdGggKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQsIGltYWdlLmhlaWdodCApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCBtaW5YICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTLCBtaW5ZICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIG1pblogKTsKCgkJCQkvLyBzZXQgdXAgdGhlIHNyYyB0ZXh0dXJlCgkJCQljb25zdCBpc1NyYzNEID0gc3JjVGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmU7CgkJCQljb25zdCBpc0RzdDNEID0gZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmU7CgkJCQlpZiAoIHNyY1RleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJCWNvbnN0IHNyY1RleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHNyY1RleHR1cmUgKTsKCQkJCQljb25zdCBkc3RUZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBkc3RUZXh0dXJlICk7CgkJCQkJY29uc3Qgc3JjUmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlUHJvcGVydGllcy5fX3JlbmRlclRhcmdldCApOwoJCQkJCWNvbnN0IGRzdFJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZVByb3BlcnRpZXMuX19yZW5kZXJUYXJnZXQgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBzcmNSZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIGRzdFJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRlcHRoOyBpICsrICkgewoKCQkJCQkJLy8gaWYgdGhlIHNvdXJjZSBvciBkZXN0aW5hdGlvbiBhcmUgYSAzZCB0YXJnZXQgdGhlbiBhIGxheWVyIG5lZWRzIHRvIGJlIGJvdW5kCgkJCQkJCWlmICggaXNTcmMzRCApIHsKCgkJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIHNyY0xldmVsLCBtaW5aICsgaSApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlLCBkc3RMZXZlbCwgZHN0WiArIGkgKTsKCgkJCQkJCX0KCgkJCQkJCV9nbC5ibGl0RnJhbWVidWZmZXIoIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIF9nbC5ERVBUSF9CVUZGRVJfQklULCBfZ2wuTkVBUkVTVCApOwoKCQkJCQl9CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgoJCQkJfSBlbHNlIGlmICggc3JjTGV2ZWwgIT09IDAgfHwgc3JjVGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgfHwgcHJvcGVydGllcy5oYXMoIHNyY1RleHR1cmUgKSApIHsKCgkJCQkJLy8gZ2V0IHRoZSBhcHByb3ByaWF0ZSBmcmFtZSBidWZmZXJzCgkJCQkJY29uc3Qgc3JjVGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc3JjVGV4dHVyZSApOwoJCQkJCWNvbnN0IGRzdFRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGRzdFRleHR1cmUgKTsKCgkJCQkJLy8gYmluZCB0aGUgZnJhbWUgYnVmZmVyIHRhcmdldHMKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfc3JjRnJhbWVidWZmZXIgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZHN0RnJhbWVidWZmZXIgKTsKCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGVwdGg7IGkgKysgKSB7CgoJCQkJCQkvLyBhc3NpZ24gdGhlIGNvcnJlY3QgbGF5ZXJzIGFuZCBtaXAgbWFwcyB0byB0aGUgZnJhbWUgYnVmZmVycwoJCQkJCQlpZiAoIGlzU3JjM0QgKSB7CgoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBzcmNUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgc3JjTGV2ZWwsIG1pblogKyBpICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLlJFQURfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHNyY1RleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBzcmNMZXZlbCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBpc0RzdDNEICkgewoKCQkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmVMYXllciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZHN0VGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGRzdExldmVsLCBkc3RaICsgaSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFXzJELCBkc3RUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgZHN0TGV2ZWwgKTsKCgkJCQkJCX0KCgkJCQkJCS8vIGNvcHkgdGhlIGRhdGEgdXNpbmcgdGhlIGZhc3Rlc3QgZnVuY3Rpb24gdGhhdCBjYW4gYWNoaWV2ZSB0aGUgY29weQoJCQkJCQlpZiAoIHNyY0xldmVsICE9PSAwICkgewoKCQkJCQkJCV9nbC5ibGl0RnJhbWVidWZmZXIoIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIF9nbC5DT0xPUl9CVUZGRVJfQklULCBfZ2wuTkVBUkVTVCApOwoKCQkJCQkJfSBlbHNlIGlmICggaXNEc3QzRCApIHsKCgkJCQkJCQlfZ2wuY29weVRleFN1YkltYWdlM0QoIGdsVGFyZ2V0LCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgZHN0WiArIGksIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQkvLyB1bmJpbmQgcmVhZCwgZHJhdyBidWZmZXJzCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIGlzRHN0M0QgKSB7CgoJCQkJCQkvLyBjb3B5IGRhdGEgaW50byB0aGUgM2QgdGV4dHVyZQoJCQkJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhVGV4dHVyZSB8fCBzcmNUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCQkJX2dsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIGRzdFosIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBnbEZvcm1hdCwgaW1hZ2UuZGF0YSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGNvcHkgZGF0YSBpbnRvIHRoZSAyZCB0ZXh0dXJlCgkJCQkJCWlmICggc3JjVGV4dHVyZS5pc0RhdGFUZXh0dXJlICkgewoKCQkJCQkJCV9nbC50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSBpZiAoIHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQkJCQlfZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgZ2xGb3JtYXQsIGltYWdlLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJX2dsLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyByZXNldCB2YWx1ZXMKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19ST1dfTEVOR1RILCBjdXJyZW50VW5wYWNrUm93TGVuICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfSU1BR0VfSEVJR0hULCBjdXJyZW50VW5wYWNrSW1hZ2VIZWlnaHQgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgY3VycmVudFVucGFja1NraXBQaXhlbHMgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIGN1cnJlbnRVbnBhY2tTa2lwUm93cyApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfSU1BR0VTLCBjdXJyZW50VW5wYWNrU2tpcEltYWdlcyApOwoKCQkJCS8vIEdlbmVyYXRlIG1pcG1hcHMgb25seSB3aGVuIGNvcHlpbmcgbGV2ZWwgMAoJCQkJaWYgKCBkc3RMZXZlbCA9PT0gMCAmJiBkc3RUZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyApIHsKCgkJCQkJX2dsLmdlbmVyYXRlTWlwbWFwKCBnbFRhcmdldCApOwoKCQkJCX0KCgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9OwoKCQkJdGhpcy5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEID0gZnVuY3Rpb24gKCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBzcmNSZWdpb24gPSBudWxsLCBkc3RQb3NpdGlvbiA9IG51bGwsIGxldmVsID0gMCApIHsKCgkJCQkvLyBAZGVwcmVjYXRlZCwgcjE3MAoJCQkJd2Fybk9uY2UoICdXZWJHTFJlbmRlcmVyOiBjb3B5VGV4dHVyZVRvVGV4dHVyZTNEIGZ1bmN0aW9uIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAiY29weVRleHR1cmVUb1RleHR1cmUiIGluc3RlYWQuJyApOwoKCQkJCXJldHVybiB0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlKCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBzcmNSZWdpb24sIGRzdFBvc2l0aW9uLCBsZXZlbCApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBJbml0aWFsaXplcyB0aGUgZ2l2ZW4gV2ViR0xSZW5kZXJUYXJnZXQgbWVtb3J5LiBVc2VmdWwgZm9yIGluaXRpYWxpemluZyBhIHJlbmRlciB0YXJnZXQgc28gZGF0YQoJCQkgKiBjYW4gYmUgY29waWVkIGludG8gaXQgdXNpbmcge0BsaW5rIFdlYkdMUmVuZGVyZXIjY29weVRleHR1cmVUb1RleHR1cmV9IGJlZm9yZSBpdCBoYXMgYmVlbgoJCQkgKiByZW5kZXJlZCB0by4KCQkJICoKCQkJICogQHBhcmFtIHtXZWJHTFJlbmRlclRhcmdldH0gdGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQuCgkJCSAqLwoJCQl0aGlzLmluaXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCQlpZiAoIHByb3BlcnRpZXMuZ2V0KCB0YXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGV4dHVyZXMuc2V0dXBSZW5kZXJUYXJnZXQoIHRhcmdldCApOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogSW5pdGlhbGl6ZXMgdGhlIGdpdmVuIHRleHR1cmUuIFVzZWZ1bCBmb3IgcHJlbG9hZGluZyBhIHRleHR1cmUgcmF0aGVyIHRoYW4gd2FpdGluZyB1bnRpbCBmaXJzdAoJCQkgKiByZW5kZXIgKHdoaWNoIGNhbiBjYXVzZSBub3RpY2VhYmxlIGxhZ3MgZHVlIHRvIGRlY29kZSBhbmQgR1BVIHVwbG9hZCBvdmVyaGVhZCkuCgkJCSAqCgkJCSAqIEBwYXJhbSB7VGV4dHVyZX0gdGV4dHVyZSAtIFRoZSB0ZXh0dXJlLgoJCQkgKi8KCQkJdGhpcy5pbml0VGV4dHVyZSA9IGZ1bmN0aW9uICggdGV4dHVyZSApIHsKCgkJCQlpZiAoIHRleHR1cmUuaXNDdWJlVGV4dHVyZSApIHsKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIDAgKTsKCgkJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB0ZXh0dXJlLCAwICk7CgoJCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB0ZXh0dXJlLCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgoJCQkJfQoKCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2FuIGJlIHVzZWQgdG8gcmVzZXQgdGhlIGludGVybmFsIFdlYkdMIHN0YXRlLiBUaGlzIG1ldGhvZCBpcyBtb3N0bHkKCQkJICogcmVsZXZhbnQgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBzaGFyZSBhIHNpbmdsZSBXZWJHTCBjb250ZXh0IGFjcm9zcwoJCQkgKiBtdWx0aXBsZSBXZWJHTCBsaWJyYXJpZXMuCgkJCSAqLwoJCQl0aGlzLnJlc2V0U3RhdGUgPSBmdW5jdGlvbiAoKSB7CgoJCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IDA7CgkJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKCQkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCQlzdGF0ZS5yZXNldCgpOwoJCQkJYmluZGluZ1N0YXRlcy5yZXNldCgpOwoKCQkJfTsKCgkJCWlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBEZWZpbmVzIHRoZSBjb29yZGluYXRlIHN5c3RlbSBvZiB0aGUgcmVuZGVyZXIuCgkJICoKCQkgKiBJbiBgV2ViR0xSZW5kZXJlcmAsIHRoZSB2YWx1ZSBpcyBhbHdheXMgYFdlYkdMQ29vcmRpbmF0ZVN5c3RlbWAuCgkJICoKCQkgKiBAdHlwZSB7V2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW19CgkJICogQGRlZmF1bHQgV2ViR0xDb29yZGluYXRlU3lzdGVtCgkJICogQHJlYWRvbmx5CgkJICovCgkJZ2V0IGNvb3JkaW5hdGVTeXN0ZW0oKSB7CgoJCQlyZXR1cm4gV2ViR0xDb29yZGluYXRlU3lzdGVtOwoKCQl9CgoJCS8qKgoJCSAqIERlZmluZXMgdGhlIG91dHB1dCBjb2xvciBzcGFjZSBvZiB0aGUgcmVuZGVyZXIuCgkJICoKCQkgKiBAdHlwZSB7U1JHQkNvbG9yU3BhY2V8TGluZWFyU1JHQkNvbG9yU3BhY2V9CgkJICogQGRlZmF1bHQgU1JHQkNvbG9yU3BhY2UKCQkgKi8KCQlnZXQgb3V0cHV0Q29sb3JTcGFjZSgpIHsKCgkJCXJldHVybiB0aGlzLl9vdXRwdXRDb2xvclNwYWNlOwoKCQl9CgoJCXNldCBvdXRwdXRDb2xvclNwYWNlKCBjb2xvclNwYWNlICkgewoKCQkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgoJCQljb25zdCBnbCA9IHRoaXMuZ2V0Q29udGV4dCgpOwoJCQlnbC5kcmF3aW5nQnVmZmVyQ29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC5fZ2V0RHJhd2luZ0J1ZmZlckNvbG9yU3BhY2UoIGNvbG9yU3BhY2UgKTsKCQkJZ2wudW5wYWNrQ29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC5fZ2V0VW5wYWNrQ29sb3JTcGFjZSgpOwoKCQl9CgoJfQoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldERlZmF1bHRFeHBvcnRGcm9tQ2pzICh4KSB7CgkJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKCX0KCgl2YXIgd2VidnJQb2x5ZmlsbCQxID0ge2V4cG9ydHM6IHt9fTsKCgkvKioKCSAqIEBsaWNlbnNlCgkgKiB3ZWJ2ci1wb2x5ZmlsbAoJICogQ29weXJpZ2h0IChjKSAyMDE1LTIwMTcgR29vZ2xlCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgd2VidnJQb2x5ZmlsbCA9IHdlYnZyUG9seWZpbGwkMS5leHBvcnRzOwoKCXZhciBoYXNSZXF1aXJlZFdlYnZyUG9seWZpbGw7CgoJZnVuY3Rpb24gcmVxdWlyZVdlYnZyUG9seWZpbGwgKCkgewoJCWlmIChoYXNSZXF1aXJlZFdlYnZyUG9seWZpbGwpIHJldHVybiB3ZWJ2clBvbHlmaWxsJDEuZXhwb3J0czsKCQloYXNSZXF1aXJlZFdlYnZyUG9seWZpbGwgPSAxOwoJCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiBjYXJkYm9hcmQtdnItZGlzcGxheQoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKCQkJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkJCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCQkJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkJCSAqCgkJCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCQkgKgoJCQkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkJCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkJCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJCQkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkJCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJCQkgKi8KCgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiB3ZWJ2ci1wb2x5ZmlsbC1kcGRiIAoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTcgR29vZ2xlCgkJCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJCQkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkJCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJCQkgKgoJCQkgKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCQkJICoKCQkJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJCQkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJCQkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCQkJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJCQkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCQkJICovCgoJCQkvKioKCQkJICogQGxpY2Vuc2UKCQkJICogd2dsdS1wcmVzZXJ2ZS1zdGF0ZQoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTYsIEJyYW5kb24gSm9uZXMuCgkJCSAqCgkJCSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKCQkJICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKCQkJICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwoJCQkgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCgkJCSAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoJCQkgKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoJCQkgKgoJCQkgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgoJCQkgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCQkJICoKCQkJICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKCQkJICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCgkJCSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQoJCQkgKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCgkJCSAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCgkJCSAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KCQkJICogVEhFIFNPRlRXQVJFLgoJCQkgKi8KCgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiBub3NsZWVwLmpzCgkJCSAqIENvcHlyaWdodCAoYykgMjAxNywgUmljaCBUaWJiZXR0CgkJCSAqCgkJCSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKCQkJICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKCQkJICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwoJCQkgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCgkJCSAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoJCQkgKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoJCQkgKgoJCQkgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgoJCQkgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCQkJICoKCQkJICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKCQkJICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCgkJCSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQoJCQkgKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCgkJCSAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCgkJCSAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KCQkJICogVEhFIFNPRlRXQVJFLgoJCQkgKi8KCgkJCShmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CgkJCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA7CgkJCX0od2VidnJQb2x5ZmlsbCwgKGZ1bmN0aW9uICgpIHsKCQkJdmFyIGNvbW1vbmpzR2xvYmFsJDEgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBjb21tb25qc0dsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBjb21tb25qc0dsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB7fTsKCgoKCQkJZnVuY3Rpb24gdW53cmFwRXhwb3J0cyAoeCkgewoJCQkJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKCQkJfQoKCQkJZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUoZm4sIG1vZHVsZSkgewoJCQkJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwoJCQl9CgoJCQl2YXIgaXNNb2JpbGUgPSBmdW5jdGlvbiBpc01vYmlsZSgpIHsKCQkJICByZXR1cm4gKC9BbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSB8fCAvaVBob25lfGlQYWR8aVBvZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkKCQkJICApOwoJCQl9OwoJCQl2YXIgY29weUFycmF5ID0gZnVuY3Rpb24gY29weUFycmF5KHNvdXJjZSwgZGVzdCkgewoJCQkgIGZvciAodmFyIGkgPSAwLCBuID0gc291cmNlLmxlbmd0aDsgaSA8IG47IGkrKykgewoJCQkgICAgZGVzdFtpXSA9IHNvdXJjZVtpXTsKCQkJICB9CgkJCX07CgkJCXZhciBleHRlbmQgPSBmdW5jdGlvbiBleHRlbmQoZGVzdCwgc3JjKSB7CgkJCSAgZm9yICh2YXIga2V5IGluIHNyYykgewoJCQkgICAgaWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkJCSAgICAgIGRlc3Rba2V5XSA9IHNyY1trZXldOwoJCQkgICAgfQoJCQkgIH0KCQkJICByZXR1cm4gZGVzdDsKCQkJfTsKCgkJCXZhciBjYXJkYm9hcmRWckRpc3BsYXkgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiBjYXJkYm9hcmQtdnItZGlzcGxheQoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKCQkJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkJCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCQkJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkJCSAqCgkJCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCQkgKgoJCQkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkJCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkJCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJCQkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkJCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJCQkgKi8KCQkJLyoqCgkJCSAqIEBsaWNlbnNlCgkJCSAqIGdsLXByZXNlcnZlLXN0YXRlCgkJCSAqIENvcHlyaWdodCAoYykgMjAxNiwgQnJhbmRvbiBKb25lcy4KCQkJICoKCQkJICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQoJCQkgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAoJCQkgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCgkJCSAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKCQkJICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCgkJCSAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgkJCSAqCgkJCSAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCgkJCSAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoJCQkgKgoJCQkgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgoJCQkgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKCQkJICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCgkJCSAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKCQkJICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKCQkJICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgoJCQkgKiBUSEUgU09GVFdBUkUuCgkJCSAqLwoJCQkvKioKCQkJICogQGxpY2Vuc2UKCQkJICogd2VidnItcG9seWZpbGwtZHBkYgoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKCQkJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkJCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCQkJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkJCSAqCgkJCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCQkgKgoJCQkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkJCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkJCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJCQkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkJCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJCQkgKi8KCQkJLyoqCgkJCSAqIEBsaWNlbnNlCgkJCSAqIG5vc2xlZXAuanMKCQkJICogQ29weXJpZ2h0IChjKSAyMDE3LCBSaWNoIFRpYmJldHQKCQkJICoKCQkJICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQoJCQkgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAoJCQkgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCgkJCSAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKCQkJICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCgkJCSAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgkJCSAqCgkJCSAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCgkJCSAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoJCQkgKgoJCQkgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgoJCQkgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKCQkJICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCgkJCSAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKCQkJICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKCQkJICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgoJCQkgKiBUSEUgU09GVFdBUkUuCgkJCSAqLwoJCQkoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewoJCQkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CgkJCX0oY29tbW9uanNHbG9iYWwkMSwgKGZ1bmN0aW9uICgpIHsgdmFyIGNsYXNzQ2FsbENoZWNrID0gZnVuY3Rpb24gKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewoJCQkgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CgkJCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKCQkJICB9CgkJCX07CgkJCXZhciBjcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsKCQkJICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKCQkJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKCQkJICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKCQkJICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwoJCQkgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CgkJCSAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwoJCQkgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CgkJCSAgICB9CgkJCSAgfQoJCQkgIHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CgkJCSAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwoJCQkgICAgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CgkJCSAgICByZXR1cm4gQ29uc3RydWN0b3I7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgc2xpY2VkVG9BcnJheSA9IGZ1bmN0aW9uICgpIHsKCQkJICBmdW5jdGlvbiBzbGljZUl0ZXJhdG9yKGFyciwgaSkgewoJCQkgICAgdmFyIF9hcnIgPSBbXTsKCQkJICAgIHZhciBfbiA9IHRydWU7CgkJCSAgICB2YXIgX2QgPSBmYWxzZTsKCQkJICAgIHZhciBfZSA9IHVuZGVmaW5lZDsKCQkJICAgIHRyeSB7CgkJCSAgICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKCQkJICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoJCQkgICAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKCQkJICAgICAgfQoJCQkgICAgfSBjYXRjaCAoZXJyKSB7CgkJCSAgICAgIF9kID0gdHJ1ZTsKCQkJICAgICAgX2UgPSBlcnI7CgkJCSAgICB9IGZpbmFsbHkgewoJCQkgICAgICB0cnkgewoJCQkgICAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdKSBfaVsicmV0dXJuIl0oKTsKCQkJICAgICAgfSBmaW5hbGx5IHsKCQkJICAgICAgICBpZiAoX2QpIHRocm93IF9lOwoJCQkgICAgICB9CgkJCSAgICB9CgkJCSAgICByZXR1cm4gX2FycjsKCQkJICB9CgkJCSAgcmV0dXJuIGZ1bmN0aW9uIChhcnIsIGkpIHsKCQkJICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKCQkJICAgICAgcmV0dXJuIGFycjsKCQkJICAgIH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7CgkJCSAgICAgIHJldHVybiBzbGljZUl0ZXJhdG9yKGFyciwgaSk7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7CgkJCSAgICB9CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgTUlOX1RJTUVTVEVQID0gMC4wMDE7CgkJCXZhciBNQVhfVElNRVNURVAgPSAxOwoJCQl2YXIgZGF0YVVyaSA9IGZ1bmN0aW9uIGRhdGFVcmkobWltZVR5cGUsIHN2ZykgewoJCQkgIHJldHVybiAnZGF0YTonICsgbWltZVR5cGUgKyAnLCcgKyBlbmNvZGVVUklDb21wb25lbnQoc3ZnKTsKCQkJfTsKCQkJdmFyIGxlcnAgPSBmdW5jdGlvbiBsZXJwKGEsIGIsIHQpIHsKCQkJICByZXR1cm4gYSArIChiIC0gYSkgKiB0OwoJCQl9OwoJCQl2YXIgaXNJT1MgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGlzSU9TID0gL2lQYWR8aVBob25lfGlQb2QvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKTsKCQkJICByZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkgICAgcmV0dXJuIGlzSU9TOwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGlzV2ViVmlld0FuZHJvaWQgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGlzV2ViVmlld0FuZHJvaWQgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1ZlcnNpb24nKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdBbmRyb2lkJykgIT09IC0xICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgIT09IC0xOwoJCQkgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJCSAgICByZXR1cm4gaXNXZWJWaWV3QW5kcm9pZDsKCQkJICB9OwoJCQl9KCk7CgkJCXZhciBpc1NhZmFyaSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaXNTYWZhcmkgPSAvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwoJCQkgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJCSAgICByZXR1cm4gaXNTYWZhcmk7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgaXNGaXJlZm94QW5kcm9pZCA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaXNGaXJlZm94QW5kcm9pZCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpICE9PSAtMSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FuZHJvaWQnKSAhPT0gLTE7CgkJCSAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJICAgIHJldHVybiBpc0ZpcmVmb3hBbmRyb2lkOwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGdldENocm9tZVZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIG1hdGNoID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvLipDaHJvbWVcLyhbMC05XSspLyk7CgkJCSAgdmFyIHZhbHVlID0gbWF0Y2ggPyBwYXJzZUludChtYXRjaFsxXSwgMTApIDogbnVsbDsKCQkJICByZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkgICAgcmV0dXJuIHZhbHVlOwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGlzU2FmYXJpV2l0aG91dERldmljZU1vdGlvbiA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgdmFsdWUgPSBmYWxzZTsKCQkJICB2YWx1ZSA9IGlzSU9TKCkgJiYgaXNTYWZhcmkoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJzEzXzQnKSAhPT0gLTE7CgkJCSAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJICAgIHJldHVybiB2YWx1ZTsKCQkJICB9OwoJCQl9KCk7CgkJCXZhciBpc0Nocm9tZVdpdGhvdXREZXZpY2VNb3Rpb24gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHZhbHVlID0gZmFsc2U7CgkJCSAgaWYgKGdldENocm9tZVZlcnNpb24oKSA9PT0gNjUpIHsKCQkJICAgIHZhciBtYXRjaCA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLy4qQ2hyb21lXC8oWzAtOVwuXSopLyk7CgkJCSAgICBpZiAobWF0Y2gpIHsKCQkJICAgICAgdmFyIF9tYXRjaCQxJHNwbGl0ID0gbWF0Y2hbMV0uc3BsaXQoJy4nKSwKCQkJICAgICAgICAgIF9tYXRjaCQxJHNwbGl0MiA9IHNsaWNlZFRvQXJyYXkoX21hdGNoJDEkc3BsaXQsIDQpOwoJCQkgICAgICAgICAgX21hdGNoJDEkc3BsaXQyWzBdOwoJCQkgICAgICAgICAgX21hdGNoJDEkc3BsaXQyWzFdOwoJCQkgICAgICAgICAgdmFyIGJyYW5jaCA9IF9tYXRjaCQxJHNwbGl0MlsyXSwKCQkJICAgICAgICAgIGJ1aWxkID0gX21hdGNoJDEkc3BsaXQyWzNdOwoJCQkgICAgICB2YWx1ZSA9IHBhcnNlSW50KGJyYW5jaCwgMTApID09PSAzMzI1ICYmIHBhcnNlSW50KGJ1aWxkLCAxMCkgPCAxNDg7CgkJCSAgICB9CgkJCSAgfQoJCQkgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJCSAgICByZXR1cm4gdmFsdWU7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgaXNSNyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaXNSNyA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignUjcgQnVpbGQnKSAhPT0gLTE7CgkJCSAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJICAgIHJldHVybiBpc1I3OwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGlzTGFuZHNjYXBlTW9kZSA9IGZ1bmN0aW9uIGlzTGFuZHNjYXBlTW9kZSgpIHsKCQkJICB2YXIgcnRuID0gd2luZG93Lm9yaWVudGF0aW9uID09IDkwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PSAtOTA7CgkJCSAgcmV0dXJuIGlzUjcoKSA/ICFydG4gOiBydG47CgkJCX07CgkJCXZhciBpc1RpbWVzdGFtcERlbHRhVmFsaWQgPSBmdW5jdGlvbiBpc1RpbWVzdGFtcERlbHRhVmFsaWQodGltZXN0YW1wRGVsdGFTKSB7CgkJCSAgaWYgKGlzTmFOKHRpbWVzdGFtcERlbHRhUykpIHsKCQkJICAgIHJldHVybiBmYWxzZTsKCQkJICB9CgkJCSAgaWYgKHRpbWVzdGFtcERlbHRhUyA8PSBNSU5fVElNRVNURVApIHsKCQkJICAgIHJldHVybiBmYWxzZTsKCQkJICB9CgkJCSAgaWYgKHRpbWVzdGFtcERlbHRhUyA+IE1BWF9USU1FU1RFUCkgewoJCQkgICAgcmV0dXJuIGZhbHNlOwoJCQkgIH0KCQkJICByZXR1cm4gdHJ1ZTsKCQkJfTsKCQkJdmFyIGdldFNjcmVlbldpZHRoID0gZnVuY3Rpb24gZ2V0U2NyZWVuV2lkdGgoKSB7CgkJCSAgcmV0dXJuIE1hdGgubWF4KHdpbmRvdy5zY3JlZW4ud2lkdGgsIHdpbmRvdy5zY3JlZW4uaGVpZ2h0KSAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwoJCQl9OwoJCQl2YXIgZ2V0U2NyZWVuSGVpZ2h0ID0gZnVuY3Rpb24gZ2V0U2NyZWVuSGVpZ2h0KCkgewoJCQkgIHJldHVybiBNYXRoLm1pbih3aW5kb3cuc2NyZWVuLndpZHRoLCB3aW5kb3cuc2NyZWVuLmhlaWdodCkgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKCQkJfTsKCQkJdmFyIHJlcXVlc3RGdWxsc2NyZWVuID0gZnVuY3Rpb24gcmVxdWVzdEZ1bGxzY3JlZW4oZWxlbWVudCkgewoJCQkgIHJldHVybiB0cnVlOwoJCQl9OwoJCQl2YXIgZXhpdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiBleGl0RnVsbHNjcmVlbigpIHsKCQkJICBpZiAoZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4pIHsKCQkJICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CgkJCSAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbikgewoJCQkgICAgZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsKCQkJICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHsKCQkJICAgIGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4oKTsKCQkJICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4pIHsKCQkJICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTsKCQkJICB9IGVsc2UgewoJCQkgICAgcmV0dXJuIGZhbHNlOwoJCQkgIH0KCQkJICByZXR1cm4gdHJ1ZTsKCQkJfTsKCQkJdmFyIGdldEZ1bGxzY3JlZW5FbGVtZW50ID0gZnVuY3Rpb24gZ2V0RnVsbHNjcmVlbkVsZW1lbnQoKSB7CgkJCSAgcmV0dXJuIGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVsZW1lbnQ7CgkJCX07CgkJCXZhciBsaW5rUHJvZ3JhbSA9IGZ1bmN0aW9uIGxpbmtQcm9ncmFtKGdsLCB2ZXJ0ZXhTb3VyY2UsIGZyYWdtZW50U291cmNlLCBhdHRyaWJMb2NhdGlvbk1hcCkgewoJCQkgIHZhciB2ZXJ0ZXhTaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUik7CgkJCSAgZ2wuc2hhZGVyU291cmNlKHZlcnRleFNoYWRlciwgdmVydGV4U291cmNlKTsKCQkJICBnbC5jb21waWxlU2hhZGVyKHZlcnRleFNoYWRlcik7CgkJCSAgdmFyIGZyYWdtZW50U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7CgkJCSAgZ2wuc2hhZGVyU291cmNlKGZyYWdtZW50U2hhZGVyLCBmcmFnbWVudFNvdXJjZSk7CgkJCSAgZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CgkJCSAgdmFyIHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7CgkJCSAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleFNoYWRlcik7CgkJCSAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKCQkJICBmb3IgKHZhciBhdHRyaWJOYW1lIGluIGF0dHJpYkxvY2F0aW9uTWFwKSB7CgkJCSAgICBnbC5iaW5kQXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgYXR0cmliTG9jYXRpb25NYXBbYXR0cmliTmFtZV0sIGF0dHJpYk5hbWUpOwoJCQkgIH1nbC5saW5rUHJvZ3JhbShwcm9ncmFtKTsKCQkJICBnbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTsKCQkJICBnbC5kZWxldGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpOwoJCQkgIHJldHVybiBwcm9ncmFtOwoJCQl9OwoJCQl2YXIgZ2V0UHJvZ3JhbVVuaWZvcm1zID0gZnVuY3Rpb24gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCBwcm9ncmFtKSB7CgkJCSAgdmFyIHVuaWZvcm1zID0ge307CgkJCSAgdmFyIHVuaWZvcm1Db3VudCA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuQUNUSVZFX1VOSUZPUk1TKTsKCQkJICB2YXIgdW5pZm9ybU5hbWUgPSAnJzsKCQkJICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaWZvcm1Db3VudDsgaSsrKSB7CgkJCSAgICB2YXIgdW5pZm9ybUluZm8gPSBnbC5nZXRBY3RpdmVVbmlmb3JtKHByb2dyYW0sIGkpOwoJCQkgICAgdW5pZm9ybU5hbWUgPSB1bmlmb3JtSW5mby5uYW1lLnJlcGxhY2UoJ1swXScsICcnKTsKCQkJICAgIHVuaWZvcm1zW3VuaWZvcm1OYW1lXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCB1bmlmb3JtTmFtZSk7CgkJCSAgfQoJCQkgIHJldHVybiB1bmlmb3JtczsKCQkJfTsKCQkJdmFyIG9ydGhvTWF0cml4ID0gZnVuY3Rpb24gb3J0aG9NYXRyaXgob3V0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcikgewoJCQkgIHZhciBsciA9IDEgLyAobGVmdCAtIHJpZ2h0KSwKCQkJICAgICAgYnQgPSAxIC8gKGJvdHRvbSAtIHRvcCksCgkJCSAgICAgIG5mID0gMSAvIChuZWFyIC0gZmFyKTsKCQkJICBvdXRbMF0gPSAtMiAqIGxyOwoJCQkgIG91dFsxXSA9IDA7CgkJCSAgb3V0WzJdID0gMDsKCQkJICBvdXRbM10gPSAwOwoJCQkgIG91dFs0XSA9IDA7CgkJCSAgb3V0WzVdID0gLTIgKiBidDsKCQkJICBvdXRbNl0gPSAwOwoJCQkgIG91dFs3XSA9IDA7CgkJCSAgb3V0WzhdID0gMDsKCQkJICBvdXRbOV0gPSAwOwoJCQkgIG91dFsxMF0gPSAyICogbmY7CgkJCSAgb3V0WzExXSA9IDA7CgkJCSAgb3V0WzEyXSA9IChsZWZ0ICsgcmlnaHQpICogbHI7CgkJCSAgb3V0WzEzXSA9ICh0b3AgKyBib3R0b20pICogYnQ7CgkJCSAgb3V0WzE0XSA9IChmYXIgKyBuZWFyKSAqIG5mOwoJCQkgIG91dFsxNV0gPSAxOwoJCQkgIHJldHVybiBvdXQ7CgkJCX07CgkJCXZhciBpc01vYmlsZSA9IGZ1bmN0aW9uIGlzTW9iaWxlKCkgewoJCQkgIHZhciBjaGVjayA9IGZhbHNlOwoJCQkgIChmdW5jdGlvbiAoYSkgewoJCQkgICAgaWYgKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSkgfHwgLzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHNcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1wtKG58dSl8YzU1XC98Y2FwaXxjY3dhfGNkbVwtfGNlbGx8Y2h0bXxjbGRjfGNtZFwtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFwtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmXC01fGdcLW1vfGdvKFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZFwtKG18cHx0KXxoZWlcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXC1jfGh0KGMoXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XC18XC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XC8pfGtsb258a3B0IHxrd2NcLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XC8oa3xsfHUpfDUwfDU0fFwtW2Etd10pfGxpYnd8bHlueHxtMVwtd3xtM2dhfG01MFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKVwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblwtMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0XC1nfHFhXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFwtWzItN118aVwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXC18b298cFwtKXxzZGtcL3xzZShjKFwtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaFwtfHNoYXJ8c2llKFwtfG0pfHNrXC0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGhcLXx2XC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcLXx0ZGdcLXx0ZWwoaXxtKXx0aW1cLXx0XC1tb3x0byhwbHxzaCl8dHMoNzB8bVwtfG0zfG01KXx0eFwtOXx1cChcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcLXx5b3VyfHpldG98enRlXC0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlOwoJCQkgIH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpOwoJCQkgIHJldHVybiBjaGVjazsKCQkJfTsKCQkJdmFyIGV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZChkZXN0LCBzcmMpIHsKCQkJICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7CgkJCSAgICBpZiAoc3JjLmhhc093blByb3BlcnR5KGtleSkpIHsKCQkJICAgICAgZGVzdFtrZXldID0gc3JjW2tleV07CgkJCSAgICB9CgkJCSAgfQoJCQkgIHJldHVybiBkZXN0OwoJCQl9OwoJCQl2YXIgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQgPSBmdW5jdGlvbiBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpIHsKCQkJICBpZiAoaXNJT1MoKSkgewoJCQkgICAgdmFyIHdpZHRoID0gY2FudmFzLnN0eWxlLndpZHRoOwoJCQkgICAgdmFyIGhlaWdodCA9IGNhbnZhcy5zdHlsZS5oZWlnaHQ7CgkJCSAgICBjYW52YXMuc3R5bGUud2lkdGggPSBwYXJzZUludCh3aWR0aCkgKyAxICsgJ3B4JzsKCQkJICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQpICsgJ3B4JzsKCQkJICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aDsKCQkJICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKCQkJICAgIH0sIDEwMCk7CgkJCSAgfQoJCQkgIHdpbmRvdy5jYW52YXMgPSBjYW52YXM7CgkJCX07CgkJCXZhciBmcmFtZURhdGFGcm9tUG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgcGlPdmVyMTgwID0gTWF0aC5QSSAvIDE4MC4wOwoJCQkgIHZhciByYWQ0NSA9IE1hdGguUEkgKiAwLjI1OwoJCQkgIGZ1bmN0aW9uIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcob3V0LCBmb3YsIG5lYXIsIGZhcikgewoJCQkgICAgdmFyIHVwVGFuID0gTWF0aC50YW4oZm92ID8gZm92LnVwRGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKCQkJICAgICAgICBkb3duVGFuID0gTWF0aC50YW4oZm92ID8gZm92LmRvd25EZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAoJCQkgICAgICAgIGxlZnRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YubGVmdERlZ3JlZXMgKiBwaU92ZXIxODAgOiByYWQ0NSksCgkJCSAgICAgICAgcmlnaHRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YucmlnaHREZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAoJCQkgICAgICAgIHhTY2FsZSA9IDIuMCAvIChsZWZ0VGFuICsgcmlnaHRUYW4pLAoJCQkgICAgICAgIHlTY2FsZSA9IDIuMCAvICh1cFRhbiArIGRvd25UYW4pOwoJCQkgICAgb3V0WzBdID0geFNjYWxlOwoJCQkgICAgb3V0WzFdID0gMC4wOwoJCQkgICAgb3V0WzJdID0gMC4wOwoJCQkgICAgb3V0WzNdID0gMC4wOwoJCQkgICAgb3V0WzRdID0gMC4wOwoJCQkgICAgb3V0WzVdID0geVNjYWxlOwoJCQkgICAgb3V0WzZdID0gMC4wOwoJCQkgICAgb3V0WzddID0gMC4wOwoJCQkgICAgb3V0WzhdID0gLSgobGVmdFRhbiAtIHJpZ2h0VGFuKSAqIHhTY2FsZSAqIDAuNSk7CgkJCSAgICBvdXRbOV0gPSAodXBUYW4gLSBkb3duVGFuKSAqIHlTY2FsZSAqIDAuNTsKCQkJICAgIG91dFsxMF0gPSBmYXIgLyAobmVhciAtIGZhcik7CgkJCSAgICBvdXRbMTFdID0gLTE7CgkJCSAgICBvdXRbMTJdID0gMC4wOwoJCQkgICAgb3V0WzEzXSA9IDAuMDsKCQkJICAgIG91dFsxNF0gPSBmYXIgKiBuZWFyIC8gKG5lYXIgLSBmYXIpOwoJCQkgICAgb3V0WzE1XSA9IDAuMDsKCQkJICAgIHJldHVybiBvdXQ7CgkJCSAgfQoJCQkgIGZ1bmN0aW9uIG1hdDRfZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24ob3V0LCBxLCB2KSB7CgkJCSAgICB2YXIgeCA9IHFbMF0sCgkJCSAgICAgICAgeSA9IHFbMV0sCgkJCSAgICAgICAgeiA9IHFbMl0sCgkJCSAgICAgICAgdyA9IHFbM10sCgkJCSAgICAgICAgeDIgPSB4ICsgeCwKCQkJICAgICAgICB5MiA9IHkgKyB5LAoJCQkgICAgICAgIHoyID0geiArIHosCgkJCSAgICAgICAgeHggPSB4ICogeDIsCgkJCSAgICAgICAgeHkgPSB4ICogeTIsCgkJCSAgICAgICAgeHogPSB4ICogejIsCgkJCSAgICAgICAgeXkgPSB5ICogeTIsCgkJCSAgICAgICAgeXogPSB5ICogejIsCgkJCSAgICAgICAgenogPSB6ICogejIsCgkJCSAgICAgICAgd3ggPSB3ICogeDIsCgkJCSAgICAgICAgd3kgPSB3ICogeTIsCgkJCSAgICAgICAgd3ogPSB3ICogejI7CgkJCSAgICBvdXRbMF0gPSAxIC0gKHl5ICsgenopOwoJCQkgICAgb3V0WzFdID0geHkgKyB3ejsKCQkJICAgIG91dFsyXSA9IHh6IC0gd3k7CgkJCSAgICBvdXRbM10gPSAwOwoJCQkgICAgb3V0WzRdID0geHkgLSB3ejsKCQkJICAgIG91dFs1XSA9IDEgLSAoeHggKyB6eik7CgkJCSAgICBvdXRbNl0gPSB5eiArIHd4OwoJCQkgICAgb3V0WzddID0gMDsKCQkJICAgIG91dFs4XSA9IHh6ICsgd3k7CgkJCSAgICBvdXRbOV0gPSB5eiAtIHd4OwoJCQkgICAgb3V0WzEwXSA9IDEgLSAoeHggKyB5eSk7CgkJCSAgICBvdXRbMTFdID0gMDsKCQkJICAgIG91dFsxMl0gPSB2WzBdOwoJCQkgICAgb3V0WzEzXSA9IHZbMV07CgkJCSAgICBvdXRbMTRdID0gdlsyXTsKCQkJICAgIG91dFsxNV0gPSAxOwoJCQkgICAgcmV0dXJuIG91dDsKCQkJICB9CgkJCSAgZnVuY3Rpb24gbWF0NF90cmFuc2xhdGUob3V0LCBhLCB2KSB7CgkJCSAgICB2YXIgeCA9IHZbMF0sCgkJCSAgICAgICAgeSA9IHZbMV0sCgkJCSAgICAgICAgeiA9IHZbMl0sCgkJCSAgICAgICAgYTAwLAoJCQkgICAgICAgIGEwMSwKCQkJICAgICAgICBhMDIsCgkJCSAgICAgICAgYTAzLAoJCQkgICAgICAgIGExMCwKCQkJICAgICAgICBhMTEsCgkJCSAgICAgICAgYTEyLAoJCQkgICAgICAgIGExMywKCQkJICAgICAgICBhMjAsCgkJCSAgICAgICAgYTIxLAoJCQkgICAgICAgIGEyMiwKCQkJICAgICAgICBhMjM7CgkJCSAgICBpZiAoYSA9PT0gb3V0KSB7CgkJCSAgICAgIG91dFsxMl0gPSBhWzBdICogeCArIGFbNF0gKiB5ICsgYVs4XSAqIHogKyBhWzEyXTsKCQkJICAgICAgb3V0WzEzXSA9IGFbMV0gKiB4ICsgYVs1XSAqIHkgKyBhWzldICogeiArIGFbMTNdOwoJCQkgICAgICBvdXRbMTRdID0gYVsyXSAqIHggKyBhWzZdICogeSArIGFbMTBdICogeiArIGFbMTRdOwoJCQkgICAgICBvdXRbMTVdID0gYVszXSAqIHggKyBhWzddICogeSArIGFbMTFdICogeiArIGFbMTVdOwoJCQkgICAgfSBlbHNlIHsKCQkJICAgICAgYTAwID0gYVswXTthMDEgPSBhWzFdO2EwMiA9IGFbMl07YTAzID0gYVszXTsKCQkJICAgICAgYTEwID0gYVs0XTthMTEgPSBhWzVdO2ExMiA9IGFbNl07YTEzID0gYVs3XTsKCQkJICAgICAgYTIwID0gYVs4XTthMjEgPSBhWzldO2EyMiA9IGFbMTBdO2EyMyA9IGFbMTFdOwoJCQkgICAgICBvdXRbMF0gPSBhMDA7b3V0WzFdID0gYTAxO291dFsyXSA9IGEwMjtvdXRbM10gPSBhMDM7CgkJCSAgICAgIG91dFs0XSA9IGExMDtvdXRbNV0gPSBhMTE7b3V0WzZdID0gYTEyO291dFs3XSA9IGExMzsKCQkJICAgICAgb3V0WzhdID0gYTIwO291dFs5XSA9IGEyMTtvdXRbMTBdID0gYTIyO291dFsxMV0gPSBhMjM7CgkJCSAgICAgIG91dFsxMl0gPSBhMDAgKiB4ICsgYTEwICogeSArIGEyMCAqIHogKyBhWzEyXTsKCQkJICAgICAgb3V0WzEzXSA9IGEwMSAqIHggKyBhMTEgKiB5ICsgYTIxICogeiArIGFbMTNdOwoJCQkgICAgICBvdXRbMTRdID0gYTAyICogeCArIGExMiAqIHkgKyBhMjIgKiB6ICsgYVsxNF07CgkJCSAgICAgIG91dFsxNV0gPSBhMDMgKiB4ICsgYTEzICogeSArIGEyMyAqIHogKyBhWzE1XTsKCQkJICAgIH0KCQkJICAgIHJldHVybiBvdXQ7CgkJCSAgfQoJCQkgIGZ1bmN0aW9uIG1hdDRfaW52ZXJ0KG91dCwgYSkgewoJCQkgICAgdmFyIGEwMCA9IGFbMF0sCgkJCSAgICAgICAgYTAxID0gYVsxXSwKCQkJICAgICAgICBhMDIgPSBhWzJdLAoJCQkgICAgICAgIGEwMyA9IGFbM10sCgkJCSAgICAgICAgYTEwID0gYVs0XSwKCQkJICAgICAgICBhMTEgPSBhWzVdLAoJCQkgICAgICAgIGExMiA9IGFbNl0sCgkJCSAgICAgICAgYTEzID0gYVs3XSwKCQkJICAgICAgICBhMjAgPSBhWzhdLAoJCQkgICAgICAgIGEyMSA9IGFbOV0sCgkJCSAgICAgICAgYTIyID0gYVsxMF0sCgkJCSAgICAgICAgYTIzID0gYVsxMV0sCgkJCSAgICAgICAgYTMwID0gYVsxMl0sCgkJCSAgICAgICAgYTMxID0gYVsxM10sCgkJCSAgICAgICAgYTMyID0gYVsxNF0sCgkJCSAgICAgICAgYTMzID0gYVsxNV0sCgkJCSAgICAgICAgYjAwID0gYTAwICogYTExIC0gYTAxICogYTEwLAoJCQkgICAgICAgIGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMCwKCQkJICAgICAgICBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTAsCgkJCSAgICAgICAgYjAzID0gYTAxICogYTEyIC0gYTAyICogYTExLAoJCQkgICAgICAgIGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMSwKCQkJICAgICAgICBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTIsCgkJCSAgICAgICAgYjA2ID0gYTIwICogYTMxIC0gYTIxICogYTMwLAoJCQkgICAgICAgIGIwNyA9IGEyMCAqIGEzMiAtIGEyMiAqIGEzMCwKCQkJICAgICAgICBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzAsCgkJCSAgICAgICAgYjA5ID0gYTIxICogYTMyIC0gYTIyICogYTMxLAoJCQkgICAgICAgIGIxMCA9IGEyMSAqIGEzMyAtIGEyMyAqIGEzMSwKCQkJICAgICAgICBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzIsCgkJCSAgICBkZXQgPSBiMDAgKiBiMTEgLSBiMDEgKiBiMTAgKyBiMDIgKiBiMDkgKyBiMDMgKiBiMDggLSBiMDQgKiBiMDcgKyBiMDUgKiBiMDY7CgkJCSAgICBpZiAoIWRldCkgewoJCQkgICAgICByZXR1cm4gbnVsbDsKCQkJICAgIH0KCQkJICAgIGRldCA9IDEuMCAvIGRldDsKCQkJICAgIG91dFswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0OwoJCQkgICAgb3V0WzFdID0gKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQ7CgkJCSAgICBvdXRbMl0gPSAoYTMxICogYjA1IC0gYTMyICogYjA0ICsgYTMzICogYjAzKSAqIGRldDsKCQkJICAgIG91dFszXSA9IChhMjIgKiBiMDQgLSBhMjEgKiBiMDUgLSBhMjMgKiBiMDMpICogZGV0OwoJCQkgICAgb3V0WzRdID0gKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQ7CgkJCSAgICBvdXRbNV0gPSAoYTAwICogYjExIC0gYTAyICogYjA4ICsgYTAzICogYjA3KSAqIGRldDsKCQkJICAgIG91dFs2XSA9IChhMzIgKiBiMDIgLSBhMzAgKiBiMDUgLSBhMzMgKiBiMDEpICogZGV0OwoJCQkgICAgb3V0WzddID0gKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQ7CgkJCSAgICBvdXRbOF0gPSAoYTEwICogYjEwIC0gYTExICogYjA4ICsgYTEzICogYjA2KSAqIGRldDsKCQkJICAgIG91dFs5XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0OwoJCQkgICAgb3V0WzEwXSA9IChhMzAgKiBiMDQgLSBhMzEgKiBiMDIgKyBhMzMgKiBiMDApICogZGV0OwoJCQkgICAgb3V0WzExXSA9IChhMjEgKiBiMDIgLSBhMjAgKiBiMDQgLSBhMjMgKiBiMDApICogZGV0OwoJCQkgICAgb3V0WzEyXSA9IChhMTEgKiBiMDcgLSBhMTAgKiBiMDkgLSBhMTIgKiBiMDYpICogZGV0OwoJCQkgICAgb3V0WzEzXSA9IChhMDAgKiBiMDkgLSBhMDEgKiBiMDcgKyBhMDIgKiBiMDYpICogZGV0OwoJCQkgICAgb3V0WzE0XSA9IChhMzEgKiBiMDEgLSBhMzAgKiBiMDMgLSBhMzIgKiBiMDApICogZGV0OwoJCQkgICAgb3V0WzE1XSA9IChhMjAgKiBiMDMgLSBhMjEgKiBiMDEgKyBhMjIgKiBiMDApICogZGV0OwoJCQkgICAgcmV0dXJuIG91dDsKCQkJICB9CgkJCSAgdmFyIGRlZmF1bHRPcmllbnRhdGlvbiA9IG5ldyBGbG9hdDMyQXJyYXkoWzAsIDAsIDAsIDFdKTsKCQkJICB2YXIgZGVmYXVsdFBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgMF0pOwoJCQkgIGZ1bmN0aW9uIHVwZGF0ZUV5ZU1hdHJpY2VzKHByb2plY3Rpb24sIHZpZXcsIHBvc2UsIGZvdiwgb2Zmc2V0LCB2ckRpc3BsYXkpIHsKCQkJICAgIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcocHJvamVjdGlvbiwgZm92IHx8IG51bGwsIHZyRGlzcGxheS5kZXB0aE5lYXIsIHZyRGlzcGxheS5kZXB0aEZhcik7CgkJCSAgICB2YXIgb3JpZW50YXRpb24gPSBwb3NlLm9yaWVudGF0aW9uIHx8IGRlZmF1bHRPcmllbnRhdGlvbjsKCQkJICAgIHZhciBwb3NpdGlvbiA9IHBvc2UucG9zaXRpb24gfHwgZGVmYXVsdFBvc2l0aW9uOwoJCQkgICAgbWF0NF9mcm9tUm90YXRpb25UcmFuc2xhdGlvbih2aWV3LCBvcmllbnRhdGlvbiwgcG9zaXRpb24pOwoJCQkgICAgaWYgKG9mZnNldCkgbWF0NF90cmFuc2xhdGUodmlldywgdmlldywgb2Zmc2V0KTsKCQkJICAgIG1hdDRfaW52ZXJ0KHZpZXcsIHZpZXcpOwoJCQkgIH0KCQkJICByZXR1cm4gZnVuY3Rpb24gKGZyYW1lRGF0YSwgcG9zZSwgdnJEaXNwbGF5KSB7CgkJCSAgICBpZiAoIWZyYW1lRGF0YSB8fCAhcG9zZSkgcmV0dXJuIGZhbHNlOwoJCQkgICAgZnJhbWVEYXRhLnBvc2UgPSBwb3NlOwoJCQkgICAgZnJhbWVEYXRhLnRpbWVzdGFtcCA9IHBvc2UudGltZXN0YW1wOwoJCQkgICAgdXBkYXRlRXllTWF0cmljZXMoZnJhbWVEYXRhLmxlZnRQcm9qZWN0aW9uTWF0cml4LCBmcmFtZURhdGEubGVmdFZpZXdNYXRyaXgsIHBvc2UsIHZyRGlzcGxheS5fZ2V0RmllbGRPZlZpZXcoImxlZnQiKSwgdnJEaXNwbGF5Ll9nZXRFeWVPZmZzZXQoImxlZnQiKSwgdnJEaXNwbGF5KTsKCQkJICAgIHVwZGF0ZUV5ZU1hdHJpY2VzKGZyYW1lRGF0YS5yaWdodFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgsIHBvc2UsIHZyRGlzcGxheS5fZ2V0RmllbGRPZlZpZXcoInJpZ2h0IiksIHZyRGlzcGxheS5fZ2V0RXllT2Zmc2V0KCJyaWdodCIpLCB2ckRpc3BsYXkpOwoJCQkgICAgcmV0dXJuIHRydWU7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgaXNJbnNpZGVDcm9zc09yaWdpbklGcmFtZSA9IGZ1bmN0aW9uIGlzSW5zaWRlQ3Jvc3NPcmlnaW5JRnJhbWUoKSB7CgkJCSAgdmFyIGlzRnJhbWVkID0gd2luZG93LnNlbGYgIT09IHdpbmRvdy50b3A7CgkJCSAgdmFyIHJlZk9yaWdpbiA9IGdldE9yaWdpbkZyb21VcmwoZG9jdW1lbnQucmVmZXJyZXIpOwoJCQkgIHZhciB0aGlzT3JpZ2luID0gZ2V0T3JpZ2luRnJvbVVybCh3aW5kb3cubG9jYXRpb24uaHJlZik7CgkJCSAgcmV0dXJuIGlzRnJhbWVkICYmIHJlZk9yaWdpbiAhPT0gdGhpc09yaWdpbjsKCQkJfTsKCQkJdmFyIGdldE9yaWdpbkZyb21VcmwgPSBmdW5jdGlvbiBnZXRPcmlnaW5Gcm9tVXJsKHVybCkgewoJCQkgIHZhciBkb21haW5JZHg7CgkJCSAgdmFyIHByb3RvU2VwSWR4ID0gdXJsLmluZGV4T2YoIjovLyIpOwoJCQkgIGlmIChwcm90b1NlcElkeCAhPT0gLTEpIHsKCQkJICAgIGRvbWFpbklkeCA9IHByb3RvU2VwSWR4ICsgMzsKCQkJICB9IGVsc2UgewoJCQkgICAgZG9tYWluSWR4ID0gMDsKCQkJICB9CgkJCSAgdmFyIGRvbWFpbkVuZElkeCA9IHVybC5pbmRleE9mKCcvJywgZG9tYWluSWR4KTsKCQkJICBpZiAoZG9tYWluRW5kSWR4ID09PSAtMSkgewoJCQkgICAgZG9tYWluRW5kSWR4ID0gdXJsLmxlbmd0aDsKCQkJICB9CgkJCSAgcmV0dXJuIHVybC5zdWJzdHJpbmcoMCwgZG9tYWluRW5kSWR4KTsKCQkJfTsKCQkJdmFyIGdldFF1YXRlcm5pb25BbmdsZSA9IGZ1bmN0aW9uIGdldFF1YXRlcm5pb25BbmdsZShxdWF0KSB7CgkJCSAgaWYgKHF1YXQudyA+IDEpIHsKCQkJICAgIGNvbnNvbGUud2FybignZ2V0UXVhdGVybmlvbkFuZ2xlOiB3ID4gMScpOwoJCQkgICAgcmV0dXJuIDA7CgkJCSAgfQoJCQkgIHZhciBhbmdsZSA9IDIgKiBNYXRoLmFjb3MocXVhdC53KTsKCQkJICByZXR1cm4gYW5nbGU7CgkJCX07CgkJCXZhciB3YXJuT25jZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgb2JzZXJ2ZWRXYXJuaW5ncyA9IHt9OwoJCQkgIHJldHVybiBmdW5jdGlvbiAoa2V5LCBtZXNzYWdlKSB7CgkJCSAgICBpZiAob2JzZXJ2ZWRXYXJuaW5nc1trZXldID09PSB1bmRlZmluZWQpIHsKCQkJICAgICAgY29uc29sZS53YXJuKCd3ZWJ2ci1wb2x5ZmlsbDogJyArIG1lc3NhZ2UpOwoJCQkgICAgICBvYnNlcnZlZFdhcm5pbmdzW2tleV0gPSB0cnVlOwoJCQkgICAgfQoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGRlcHJlY2F0ZVdhcm5pbmcgPSBmdW5jdGlvbiBkZXByZWNhdGVXYXJuaW5nKGRlcHJlY2F0ZWQsIHN1Z2dlc3RlZCkgewoJCQkgIHZhciBhbHRlcm5hdGl2ZSA9IHN1Z2dlc3RlZCA/ICdQbGVhc2UgdXNlICcgKyBzdWdnZXN0ZWQgKyAnIGluc3RlYWQuJyA6ICcnOwoJCQkgIHdhcm5PbmNlKGRlcHJlY2F0ZWQsIGRlcHJlY2F0ZWQgKyAnIGhhcyBiZWVuIGRlcHJlY2F0ZWQuICcgKyAnVGhpcyBtYXkgbm90IHdvcmsgb24gbmF0aXZlIFdlYlZSIGRpc3BsYXlzLiAnICsgYWx0ZXJuYXRpdmUpOwoJCQl9OwoJCQlmdW5jdGlvbiBXR0xVUHJlc2VydmVHTFN0YXRlKGdsLCBiaW5kaW5ncywgY2FsbGJhY2spIHsKCQkJICBpZiAoIWJpbmRpbmdzKSB7CgkJCSAgICBjYWxsYmFjayhnbCk7CgkJCSAgICByZXR1cm47CgkJCSAgfQoJCQkgIHZhciBib3VuZFZhbHVlcyA9IFtdOwoJCQkgIHZhciBhY3RpdmVUZXh0dXJlID0gbnVsbDsKCQkJICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmRpbmdzLmxlbmd0aDsgKytpKSB7CgkJCSAgICB2YXIgYmluZGluZyA9IGJpbmRpbmdzW2ldOwoJCQkgICAgc3dpdGNoIChiaW5kaW5nKSB7CgkJCSAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HXzJEOgoJCQkgICAgICBjYXNlIGdsLlRFWFRVUkVfQklORElOR19DVUJFX01BUDoKCQkJICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwoJCQkgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKSB7CgkJCSAgICAgICAgICBjb25zb2xlLmVycm9yKCJURVhUVVJFX0JJTkRJTkdfMkQgb3IgVEVYVFVSRV9CSU5ESU5HX0NVQkVfTUFQIG11c3QgYmUgZm9sbG93ZWQgYnkgYSB2YWxpZCB0ZXh0dXJlIHVuaXQiKTsKCQkJICAgICAgICAgIGJvdW5kVmFsdWVzLnB1c2gobnVsbCwgbnVsbCk7CgkJCSAgICAgICAgICBicmVhazsKCQkJICAgICAgICB9CgkJCSAgICAgICAgaWYgKCFhY3RpdmVUZXh0dXJlKSB7CgkJCSAgICAgICAgICBhY3RpdmVUZXh0dXJlID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkFDVElWRV9URVhUVVJFKTsKCQkJICAgICAgICB9CgkJCSAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CgkJCSAgICAgICAgYm91bmRWYWx1ZXMucHVzaChnbC5nZXRQYXJhbWV0ZXIoYmluZGluZyksIG51bGwpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLkFDVElWRV9URVhUVVJFOgoJCQkgICAgICAgIGFjdGl2ZVRleHR1cmUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQUNUSVZFX1RFWFRVUkUpOwoJCQkgICAgICAgIGJvdW5kVmFsdWVzLnB1c2gobnVsbCk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGRlZmF1bHQ6CgkJCSAgICAgICAgYm91bmRWYWx1ZXMucHVzaChnbC5nZXRQYXJhbWV0ZXIoYmluZGluZykpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgfQoJCQkgIH0KCQkJICBjYWxsYmFjayhnbCk7CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW5kaW5ncy5sZW5ndGg7ICsraSkgewoJCQkgICAgdmFyIGJpbmRpbmcgPSBiaW5kaW5nc1tpXTsKCQkJICAgIHZhciBib3VuZFZhbHVlID0gYm91bmRWYWx1ZXNbaV07CgkJCSAgICBzd2l0Y2ggKGJpbmRpbmcpIHsKCQkJICAgICAgY2FzZSBnbC5BQ1RJVkVfVEVYVFVSRToKCQkJICAgICAgICBicmVhazsKCQkJICAgICAgY2FzZSBnbC5BUlJBWV9CVUZGRVJfQklORElORzoKCQkJICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgYm91bmRWYWx1ZSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQ09MT1JfQ0xFQVJfVkFMVUU6CgkJCSAgICAgICAgZ2wuY2xlYXJDb2xvcihib3VuZFZhbHVlWzBdLCBib3VuZFZhbHVlWzFdLCBib3VuZFZhbHVlWzJdLCBib3VuZFZhbHVlWzNdKTsKCQkJICAgICAgICBicmVhazsKCQkJICAgICAgY2FzZSBnbC5DT0xPUl9XUklURU1BU0s6CgkJCSAgICAgICAgZ2wuY29sb3JNYXNrKGJvdW5kVmFsdWVbMF0sIGJvdW5kVmFsdWVbMV0sIGJvdW5kVmFsdWVbMl0sIGJvdW5kVmFsdWVbM10pOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLkNVUlJFTlRfUFJPR1JBTToKCQkJICAgICAgICBnbC51c2VQcm9ncmFtKGJvdW5kVmFsdWUpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkc6CgkJCSAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYm91bmRWYWx1ZSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuRlJBTUVCVUZGRVJfQklORElORzoKCQkJICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGJvdW5kVmFsdWUpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLlJFTkRFUkJVRkZFUl9CSU5ESU5HOgoJCQkgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBib3VuZFZhbHVlKTsKCQkJICAgICAgICBicmVhazsKCQkJICAgICAgY2FzZSBnbC5URVhUVVJFX0JJTkRJTkdfMkQ6CgkJCSAgICAgICAgdmFyIHRleHR1cmVVbml0ID0gYmluZGluZ3NbKytpXTsKCQkJICAgICAgICBpZiAodGV4dHVyZVVuaXQgPCBnbC5URVhUVVJFMCB8fCB0ZXh0dXJlVW5pdCA+IGdsLlRFWFRVUkUzMSkKCQkJICAgICAgICAgIGJyZWFrOwoJCQkgICAgICAgIGdsLmFjdGl2ZVRleHR1cmUodGV4dHVyZVVuaXQpOwoJCQkgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIGJvdW5kVmFsdWUpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLlRFWFRVUkVfQklORElOR19DVUJFX01BUDoKCQkJICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwoJCQkgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKQoJCQkgICAgICAgICAgYnJlYWs7CgkJCSAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CgkJCSAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgYm91bmRWYWx1ZSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuVklFV1BPUlQ6CgkJCSAgICAgICAgZ2wudmlld3BvcnQoYm91bmRWYWx1ZVswXSwgYm91bmRWYWx1ZVsxXSwgYm91bmRWYWx1ZVsyXSwgYm91bmRWYWx1ZVszXSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQkxFTkQ6CgkJCSAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgoJCQkgICAgICBjYXNlIGdsLkRFUFRIX1RFU1Q6CgkJCSAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgoJCQkgICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKCQkJICAgICAgICBpZiAoYm91bmRWYWx1ZSkgewoJCQkgICAgICAgICAgZ2wuZW5hYmxlKGJpbmRpbmcpOwoJCQkgICAgICAgIH0gZWxzZSB7CgkJCSAgICAgICAgICBnbC5kaXNhYmxlKGJpbmRpbmcpOwoJCQkgICAgICAgIH0KCQkJICAgICAgICBicmVhazsKCQkJICAgICAgZGVmYXVsdDoKCQkJICAgICAgICBjb25zb2xlLmxvZygiTm8gR0wgcmVzdG9yZSBiZWhhdmlvciBmb3IgMHgiICsgYmluZGluZy50b1N0cmluZygxNikpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgfQoJCQkgICAgaWYgKGFjdGl2ZVRleHR1cmUpIHsKCQkJICAgICAgZ2wuYWN0aXZlVGV4dHVyZShhY3RpdmVUZXh0dXJlKTsKCQkJICAgIH0KCQkJICB9CgkJCX0KCQkJdmFyIGdsUHJlc2VydmVTdGF0ZSA9IFdHTFVQcmVzZXJ2ZUdMU3RhdGU7CgkJCXZhciBkaXN0b3J0aW9uVlMgPSBbJ2F0dHJpYnV0ZSB2ZWMyIHBvc2l0aW9uOycsICdhdHRyaWJ1dGUgdmVjMyB0ZXhDb29yZDsnLCAndmFyeWluZyB2ZWMyIHZUZXhDb29yZDsnLCAndW5pZm9ybSB2ZWM0IHZpZXdwb3J0T2Zmc2V0U2NhbGVbMl07JywgJ3ZvaWQgbWFpbigpIHsnLCAnICB2ZWM0IHZpZXdwb3J0ID0gdmlld3BvcnRPZmZzZXRTY2FsZVtpbnQodGV4Q29vcmQueildOycsICcgIHZUZXhDb29yZCA9ICh0ZXhDb29yZC54eSAqIHZpZXdwb3J0Lnp3KSArIHZpZXdwb3J0Lnh5OycsICcgIGdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24sIDEuMCwgMS4wICk7JywgJ30nXS5qb2luKCdcbicpOwoJCQl2YXIgZGlzdG9ydGlvbkZTID0gWydwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLCAndW5pZm9ybSBzYW1wbGVyMkQgZGlmZnVzZTsnLCAndmFyeWluZyB2ZWMyIHZUZXhDb29yZDsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChkaWZmdXNlLCB2VGV4Q29vcmQpOycsICd9J10uam9pbignXG4nKTsKCQkJZnVuY3Rpb24gQ2FyZGJvYXJkRGlzdG9ydGVyKGdsLCBjYXJkYm9hcmRVSSwgYnVmZmVyU2NhbGUsIGRpcnR5U3VibWl0RnJhbWVCaW5kaW5ncykgewoJCQkgIHRoaXMuZ2wgPSBnbDsKCQkJICB0aGlzLmNhcmRib2FyZFVJID0gY2FyZGJvYXJkVUk7CgkJCSAgdGhpcy5idWZmZXJTY2FsZSA9IGJ1ZmZlclNjYWxlOwoJCQkgIHRoaXMuZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzID0gZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzOwoJCQkgIHRoaXMuY3R4QXR0cmlicyA9IGdsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgkJCSAgdGhpcy5pbnN0YW5jZUV4dCA9IGdsLmdldEV4dGVuc2lvbignQU5HTEVfaW5zdGFuY2VkX2FycmF5cycpOwoJCQkgIHRoaXMubWVzaFdpZHRoID0gMjA7CgkJCSAgdGhpcy5tZXNoSGVpZ2h0ID0gMjA7CgkJCSAgdGhpcy5idWZmZXJXaWR0aCA9IGdsLmRyYXdpbmdCdWZmZXJXaWR0aDsKCQkJICB0aGlzLmJ1ZmZlckhlaWdodCA9IGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQ7CgkJCSAgdGhpcy5yZWFsQmluZEZyYW1lYnVmZmVyID0gZ2wuYmluZEZyYW1lYnVmZmVyOwoJCQkgIHRoaXMucmVhbEVuYWJsZSA9IGdsLmVuYWJsZTsKCQkJICB0aGlzLnJlYWxEaXNhYmxlID0gZ2wuZGlzYWJsZTsKCQkJICB0aGlzLnJlYWxDb2xvck1hc2sgPSBnbC5jb2xvck1hc2s7CgkJCSAgdGhpcy5yZWFsQ2xlYXJDb2xvciA9IGdsLmNsZWFyQ29sb3I7CgkJCSAgdGhpcy5yZWFsVmlld3BvcnQgPSBnbC52aWV3cG9ydDsKCQkJICBpZiAoIWlzSU9TKCkpIHsKCQkJICAgIHRoaXMucmVhbENhbnZhc1dpZHRoID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihnbC5jYW52YXMuX19wcm90b19fLCAnd2lkdGgnKTsKCQkJICAgIHRoaXMucmVhbENhbnZhc0hlaWdodCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZ2wuY2FudmFzLl9fcHJvdG9fXywgJ2hlaWdodCcpOwoJCQkgIH0KCQkJICB0aGlzLmlzUGF0Y2hlZCA9IGZhbHNlOwoJCQkgIHRoaXMubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBudWxsOwoJCQkgIHRoaXMuY3VsbEZhY2UgPSBmYWxzZTsKCQkJICB0aGlzLmRlcHRoVGVzdCA9IGZhbHNlOwoJCQkgIHRoaXMuYmxlbmQgPSBmYWxzZTsKCQkJICB0aGlzLnNjaXNzb3JUZXN0ID0gZmFsc2U7CgkJCSAgdGhpcy5zdGVuY2lsVGVzdCA9IGZhbHNlOwoJCQkgIHRoaXMudmlld3BvcnQgPSBbMCwgMCwgMCwgMF07CgkJCSAgdGhpcy5jb2xvck1hc2sgPSBbdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZV07CgkJCSAgdGhpcy5jbGVhckNvbG9yID0gWzAsIDAsIDAsIDBdOwoJCQkgIHRoaXMuYXR0cmlicyA9IHsKCQkJICAgIHBvc2l0aW9uOiAwLAoJCQkgICAgdGV4Q29vcmQ6IDEKCQkJICB9OwoJCQkgIHRoaXMucHJvZ3JhbSA9IGxpbmtQcm9ncmFtKGdsLCBkaXN0b3J0aW9uVlMsIGRpc3RvcnRpb25GUywgdGhpcy5hdHRyaWJzKTsKCQkJICB0aGlzLnVuaWZvcm1zID0gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCB0aGlzLnByb2dyYW0pOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZSA9IG5ldyBGbG9hdDMyQXJyYXkoOCk7CgkJCSAgdGhpcy5zZXRUZXh0dXJlQm91bmRzKCk7CgkJCSAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCQkJICB0aGlzLmluZGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCSAgdGhpcy5pbmRleENvdW50ID0gMDsKCQkJICB0aGlzLnJlbmRlclRhcmdldCA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKCQkJICB0aGlzLmZyYW1lYnVmZmVyID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCQkJICB0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlciA9IG51bGw7CgkJCSAgdGhpcy5kZXB0aEJ1ZmZlciA9IG51bGw7CgkJCSAgdGhpcy5zdGVuY2lsQnVmZmVyID0gbnVsbDsKCQkJICBpZiAodGhpcy5jdHhBdHRyaWJzLmRlcHRoICYmIHRoaXMuY3R4QXR0cmlicy5zdGVuY2lsKSB7CgkJCSAgICB0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlciA9IGdsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkgIH0gZWxzZSBpZiAodGhpcy5jdHhBdHRyaWJzLmRlcHRoKSB7CgkJCSAgICB0aGlzLmRlcHRoQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCSAgfSBlbHNlIGlmICh0aGlzLmN0eEF0dHJpYnMuc3RlbmNpbCkgewoJCQkgICAgdGhpcy5zdGVuY2lsQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCSAgfQoJCQkgIHRoaXMucGF0Y2goKTsKCQkJICB0aGlzLm9uUmVzaXplKCk7CgkJCX0KCQkJQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdGhpcy51bnBhdGNoKCk7CgkJCSAgZ2wuZGVsZXRlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwoJCQkgIGdsLmRlbGV0ZUJ1ZmZlcih0aGlzLnZlcnRleEJ1ZmZlcik7CgkJCSAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMuaW5kZXhCdWZmZXIpOwoJCQkgIGdsLmRlbGV0ZVRleHR1cmUodGhpcy5yZW5kZXJUYXJnZXQpOwoJCQkgIGdsLmRlbGV0ZUZyYW1lYnVmZmVyKHRoaXMuZnJhbWVidWZmZXIpOwoJCQkgIGlmICh0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlcikgewoJCQkgICAgZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHRoaXMuZGVwdGhTdGVuY2lsQnVmZmVyKTsKCQkJICB9CgkJCSAgaWYgKHRoaXMuZGVwdGhCdWZmZXIpIHsKCQkJICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLmRlcHRoQnVmZmVyKTsKCQkJICB9CgkJCSAgaWYgKHRoaXMuc3RlbmNpbEJ1ZmZlcikgewoJCQkgICAgZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHRoaXMuc3RlbmNpbEJ1ZmZlcik7CgkJCSAgfQoJCQkgIGlmICh0aGlzLmNhcmRib2FyZFVJKSB7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJLmRlc3Ryb3koKTsKCQkJICB9CgkJCX07CgkJCUNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGdsID0gdGhpcy5nbDsKCQkJICB2YXIgc2VsZiA9IHRoaXM7CgkJCSAgdmFyIGdsU3RhdGUgPSBbZ2wuUkVOREVSQlVGRkVSX0JJTkRJTkcsIGdsLlRFWFRVUkVfQklORElOR18yRCwgZ2wuVEVYVFVSRTBdOwoJCQkgIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CgkJCSAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwoJCQkgICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKCQkJICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TQ0lTU09SX1RFU1QpOwoJCQkgICAgfQoJCQkgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHRydWUsIHRydWUsIHRydWUsIHRydWUpOwoJCQkgICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKCQkJICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMSk7CgkJCSAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTsKCQkJICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5mcmFtZWJ1ZmZlcik7CgkJCSAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCk7CgkJCSAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIHNlbGYuY3R4QXR0cmlicy5hbHBoYSA/IGdsLlJHQkEgOiBnbC5SR0IsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0LCAwLCBzZWxmLmN0eEF0dHJpYnMuYWxwaGEgPyBnbC5SR0JBIDogZ2wuUkdCLCBnbC5VTlNJR05FRF9CWVRFLCBudWxsKTsKCQkJICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpOwoJCQkgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7CgkJCSAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTsKCQkJICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpOwoJCQkgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCwgMCk7CgkJCSAgICBpZiAoc2VsZi5jdHhBdHRyaWJzLmRlcHRoICYmIHNlbGYuY3R4QXR0cmlicy5zdGVuY2lsKSB7CgkJCSAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoU3RlbmNpbEJ1ZmZlcik7CgkJCSAgICAgIGdsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoZ2wuUkVOREVSQlVGRkVSLCBnbC5ERVBUSF9TVEVOQ0lMLCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCk7CgkJCSAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5kZXB0aFN0ZW5jaWxCdWZmZXIpOwoJCQkgICAgfSBlbHNlIGlmIChzZWxmLmN0eEF0dHJpYnMuZGVwdGgpIHsKCQkJICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhCdWZmZXIpOwoJCQkgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuREVQVEhfQ09NUE9ORU5UMTYsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0KTsKCQkJICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5kZXB0aEJ1ZmZlcik7CgkJCSAgICB9IGVsc2UgaWYgKHNlbGYuY3R4QXR0cmlicy5zdGVuY2lsKSB7CgkJCSAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLnN0ZW5jaWxCdWZmZXIpOwoJCQkgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuU1RFTkNJTF9JTkRFWDgsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0KTsKCQkJICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLlNURU5DSUxfQVRUQUNITUVOVCwgZ2wuUkVOREVSQlVGRkVSLCBzZWxmLnN0ZW5jaWxCdWZmZXIpOwoJCQkgICAgfQoJCQkgICAgaWYgKCFnbC5jaGVja0ZyYW1lYnVmZmVyU3RhdHVzKGdsLkZSQU1FQlVGRkVSKSA9PT0gZ2wuRlJBTUVCVUZGRVJfQ09NUExFVEUpIHsKCQkJICAgICAgY29uc29sZS5lcnJvcignRnJhbWVidWZmZXIgaW5jb21wbGV0ZSEnKTsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CgkJCSAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU0NJU1NPUl9URVNUKTsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbENvbG9yTWFzay5hcHBseShnbCwgc2VsZi5jb2xvck1hc2spOwoJCQkgICAgc2VsZi5yZWFsVmlld3BvcnQuYXBwbHkoZ2wsIHNlbGYudmlld3BvcnQpOwoJCQkgICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5hcHBseShnbCwgc2VsZi5jbGVhckNvbG9yKTsKCQkJICB9KTsKCQkJICBpZiAodGhpcy5jYXJkYm9hcmRVSSkgewoJCQkgICAgdGhpcy5jYXJkYm9hcmRVSS5vblJlc2l6ZSgpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5wYXRjaCA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5pc1BhdGNoZWQpIHsKCQkJICAgIHJldHVybjsKCQkJICB9CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIGlmICghaXNJT1MoKSkgewoJCQkgICAgY2FudmFzLndpZHRoID0gZ2V0U2NyZWVuV2lkdGgoKSAqIHRoaXMuYnVmZmVyU2NhbGU7CgkJCSAgICBjYW52YXMuaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCkgKiB0aGlzLmJ1ZmZlclNjYWxlOwoJCQkgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ3dpZHRoJywgewoJCQkgICAgICBjb25maWd1cmFibGU6IHRydWUsCgkJCSAgICAgIGVudW1lcmFibGU6IHRydWUsCgkJCSAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkgICAgICAgIHJldHVybiBzZWxmLmJ1ZmZlcldpZHRoOwoJCQkgICAgICB9LAoJCQkgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewoJCQkgICAgICAgIHNlbGYuYnVmZmVyV2lkdGggPSB2YWx1ZTsKCQkJICAgICAgICBzZWxmLnJlYWxDYW52YXNXaWR0aC5zZXQuY2FsbChjYW52YXMsIHZhbHVlKTsKCQkJICAgICAgICBzZWxmLm9uUmVzaXplKCk7CgkJCSAgICAgIH0KCQkJICAgIH0pOwoJCQkgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ2hlaWdodCcsIHsKCQkJICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJCQkgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJCQkgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJICAgICAgICByZXR1cm4gc2VsZi5idWZmZXJIZWlnaHQ7CgkJCSAgICAgIH0sCgkJCSAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkJCSAgICAgICAgc2VsZi5idWZmZXJIZWlnaHQgPSB2YWx1ZTsKCQkJICAgICAgICBzZWxmLnJlYWxDYW52YXNIZWlnaHQuc2V0LmNhbGwoY2FudmFzLCB2YWx1ZSk7CgkJCSAgICAgICAgc2VsZi5vblJlc2l6ZSgpOwoJCQkgICAgICB9CgkJCSAgICB9KTsKCQkJICB9CgkJCSAgdGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IGdsLmdldFBhcmFtZXRlcihnbC5GUkFNRUJVRkZFUl9CSU5ESU5HKTsKCQkJICBpZiAodGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9PSBudWxsKSB7CgkJCSAgICB0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID0gdGhpcy5mcmFtZWJ1ZmZlcjsKCQkJICAgIHRoaXMuZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCB0aGlzLmZyYW1lYnVmZmVyKTsKCQkJICB9CgkJCSAgdGhpcy5nbC5iaW5kRnJhbWVidWZmZXIgPSBmdW5jdGlvbiAodGFyZ2V0LCBmcmFtZWJ1ZmZlcikgewoJCQkgICAgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IGZyYW1lYnVmZmVyID8gZnJhbWVidWZmZXIgOiBzZWxmLmZyYW1lYnVmZmVyOwoJCQkgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIHRhcmdldCwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CgkJCSAgfTsKCQkJICB0aGlzLmN1bGxGYWNlID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNVTExfRkFDRSk7CgkJCSAgdGhpcy5kZXB0aFRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuREVQVEhfVEVTVCk7CgkJCSAgdGhpcy5ibGVuZCA9IGdsLmdldFBhcmFtZXRlcihnbC5CTEVORCk7CgkJCSAgdGhpcy5zY2lzc29yVGVzdCA9IGdsLmdldFBhcmFtZXRlcihnbC5TQ0lTU09SX1RFU1QpOwoJCQkgIHRoaXMuc3RlbmNpbFRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuU1RFTkNJTF9URVNUKTsKCQkJICBnbC5lbmFibGUgPSBmdW5jdGlvbiAocG5hbWUpIHsKCQkJICAgIHN3aXRjaCAocG5hbWUpIHsKCQkJICAgICAgY2FzZSBnbC5DVUxMX0ZBQ0U6CgkJCSAgICAgICAgc2VsZi5jdWxsRmFjZSA9IHRydWU7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuREVQVEhfVEVTVDoKCQkJICAgICAgICBzZWxmLmRlcHRoVGVzdCA9IHRydWU7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQkxFTkQ6CgkJCSAgICAgICAgc2VsZi5ibGVuZCA9IHRydWU7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgoJCQkgICAgICAgIHNlbGYuc2Npc3NvclRlc3QgPSB0cnVlO2JyZWFrOwoJCQkgICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKCQkJICAgICAgICBzZWxmLnN0ZW5jaWxUZXN0ID0gdHJ1ZTticmVhazsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBwbmFtZSk7CgkJCSAgfTsKCQkJICBnbC5kaXNhYmxlID0gZnVuY3Rpb24gKHBuYW1lKSB7CgkJCSAgICBzd2l0Y2ggKHBuYW1lKSB7CgkJCSAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgoJCQkgICAgICAgIHNlbGYuY3VsbEZhY2UgPSBmYWxzZTticmVhazsKCQkJICAgICAgY2FzZSBnbC5ERVBUSF9URVNUOgoJCQkgICAgICAgIHNlbGYuZGVwdGhUZXN0ID0gZmFsc2U7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQkxFTkQ6CgkJCSAgICAgICAgc2VsZi5ibGVuZCA9IGZhbHNlO2JyZWFrOwoJCQkgICAgICBjYXNlIGdsLlNDSVNTT1JfVEVTVDoKCQkJICAgICAgICBzZWxmLnNjaXNzb3JUZXN0ID0gZmFsc2U7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuU1RFTkNJTF9URVNUOgoJCQkgICAgICAgIHNlbGYuc3RlbmNpbFRlc3QgPSBmYWxzZTticmVhazsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgcG5hbWUpOwoJCQkgIH07CgkJCSAgdGhpcy5jb2xvck1hc2sgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQ09MT1JfV1JJVEVNQVNLKTsKCQkJICBnbC5jb2xvck1hc2sgPSBmdW5jdGlvbiAociwgZywgYiwgYSkgewoJCQkgICAgc2VsZi5jb2xvck1hc2tbMF0gPSByOwoJCQkgICAgc2VsZi5jb2xvck1hc2tbMV0gPSBnOwoJCQkgICAgc2VsZi5jb2xvck1hc2tbMl0gPSBiOwoJCQkgICAgc2VsZi5jb2xvck1hc2tbM10gPSBhOwoJCQkgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHIsIGcsIGIsIGEpOwoJCQkgIH07CgkJCSAgdGhpcy5jbGVhckNvbG9yID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNPTE9SX0NMRUFSX1ZBTFVFKTsKCQkJICBnbC5jbGVhckNvbG9yID0gZnVuY3Rpb24gKHIsIGcsIGIsIGEpIHsKCQkJICAgIHNlbGYuY2xlYXJDb2xvclswXSA9IHI7CgkJCSAgICBzZWxmLmNsZWFyQ29sb3JbMV0gPSBnOwoJCQkgICAgc2VsZi5jbGVhckNvbG9yWzJdID0gYjsKCQkJICAgIHNlbGYuY2xlYXJDb2xvclszXSA9IGE7CgkJCSAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIHIsIGcsIGIsIGEpOwoJCQkgIH07CgkJCSAgdGhpcy52aWV3cG9ydCA9IGdsLmdldFBhcmFtZXRlcihnbC5WSUVXUE9SVCk7CgkJCSAgZ2wudmlld3BvcnQgPSBmdW5jdGlvbiAoeCwgeSwgdywgaCkgewoJCQkgICAgc2VsZi52aWV3cG9ydFswXSA9IHg7CgkJCSAgICBzZWxmLnZpZXdwb3J0WzFdID0geTsKCQkJICAgIHNlbGYudmlld3BvcnRbMl0gPSB3OwoJCQkgICAgc2VsZi52aWV3cG9ydFszXSA9IGg7CgkJCSAgICBzZWxmLnJlYWxWaWV3cG9ydC5jYWxsKGdsLCB4LCB5LCB3LCBoKTsKCQkJICB9OwoJCQkgIHRoaXMuaXNQYXRjaGVkID0gdHJ1ZTsKCQkJICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpOwoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnVucGF0Y2ggPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKCF0aGlzLmlzUGF0Y2hlZCkgewoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKCQkJICBpZiAoIWlzSU9TKCkpIHsKCQkJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICd3aWR0aCcsIHRoaXMucmVhbENhbnZhc1dpZHRoKTsKCQkJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICdoZWlnaHQnLCB0aGlzLnJlYWxDYW52YXNIZWlnaHQpOwoJCQkgIH0KCQkJICBjYW52YXMud2lkdGggPSB0aGlzLmJ1ZmZlcldpZHRoOwoJCQkgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLmJ1ZmZlckhlaWdodDsKCQkJICBnbC5iaW5kRnJhbWVidWZmZXIgPSB0aGlzLnJlYWxCaW5kRnJhbWVidWZmZXI7CgkJCSAgZ2wuZW5hYmxlID0gdGhpcy5yZWFsRW5hYmxlOwoJCQkgIGdsLmRpc2FibGUgPSB0aGlzLnJlYWxEaXNhYmxlOwoJCQkgIGdsLmNvbG9yTWFzayA9IHRoaXMucmVhbENvbG9yTWFzazsKCQkJICBnbC5jbGVhckNvbG9yID0gdGhpcy5yZWFsQ2xlYXJDb2xvcjsKCQkJICBnbC52aWV3cG9ydCA9IHRoaXMucmVhbFZpZXdwb3J0OwoJCQkgIGlmICh0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID09IHRoaXMuZnJhbWVidWZmZXIpIHsKCQkJICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7CgkJCSAgfQoJCQkgIHRoaXMuaXNQYXRjaGVkID0gZmFsc2U7CgkJCSAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCSAgICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpOwoJCQkgIH0sIDEpOwoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnNldFRleHR1cmVCb3VuZHMgPSBmdW5jdGlvbiAobGVmdEJvdW5kcywgcmlnaHRCb3VuZHMpIHsKCQkJICBpZiAoIWxlZnRCb3VuZHMpIHsKCQkJICAgIGxlZnRCb3VuZHMgPSBbMCwgMCwgMC41LCAxXTsKCQkJICB9CgkJCSAgaWYgKCFyaWdodEJvdW5kcykgewoJCQkgICAgcmlnaHRCb3VuZHMgPSBbMC41LCAwLCAwLjUsIDFdOwoJCQkgIH0KCQkJICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbMF0gPSBsZWZ0Qm91bmRzWzBdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVsxXSA9IGxlZnRCb3VuZHNbMV07CgkJCSAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzJdID0gbGVmdEJvdW5kc1syXTsKCQkJICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbM10gPSBsZWZ0Qm91bmRzWzNdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs0XSA9IHJpZ2h0Qm91bmRzWzBdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs1XSA9IHJpZ2h0Qm91bmRzWzFdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs2XSA9IHJpZ2h0Qm91bmRzWzJdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs3XSA9IHJpZ2h0Qm91bmRzWzNdOwoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBnbFN0YXRlID0gW107CgkJCSAgaWYgKCF0aGlzLmRpcnR5U3VibWl0RnJhbWVCaW5kaW5ncykgewoJCQkgICAgZ2xTdGF0ZS5wdXNoKGdsLkNVUlJFTlRfUFJPR1JBTSwgZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLlRFWFRVUkVfQklORElOR18yRCwgZ2wuVEVYVFVSRTApOwoJCQkgIH0KCQkJICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewoJCQkgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKCQkJICAgIHZhciBwb3NpdGlvbkRpdmlzb3IgPSAwOwoJCQkgICAgdmFyIHRleENvb3JkRGl2aXNvciA9IDA7CgkJCSAgICBpZiAoc2VsZi5pbnN0YW5jZUV4dCkgewoJCQkgICAgICBwb3NpdGlvbkRpdmlzb3IgPSBnbC5nZXRWZXJ0ZXhBdHRyaWIoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCBzZWxmLmluc3RhbmNlRXh0LlZFUlRFWF9BVFRSSUJfQVJSQVlfRElWSVNPUl9BTkdMRSk7CgkJCSAgICAgIHRleENvb3JkRGl2aXNvciA9IGdsLmdldFZlcnRleEF0dHJpYihzZWxmLmF0dHJpYnMudGV4Q29vcmQsIHNlbGYuaW5zdGFuY2VFeHQuVkVSVEVYX0FUVFJJQl9BUlJBWV9ESVZJU09SX0FOR0xFKTsKCQkJICAgIH0KCQkJICAgIGlmIChzZWxmLmN1bGxGYWNlKSB7CgkJCSAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuQ1VMTF9GQUNFKTsKCQkJICAgIH0KCQkJICAgIGlmIChzZWxmLmRlcHRoVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLkRFUFRIX1RFU1QpOwoJCQkgICAgfQoJCQkgICAgaWYgKHNlbGYuYmxlbmQpIHsKCQkJICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5CTEVORCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5zdGVuY2lsVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLlNURU5DSUxfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBzZWxmLnJlYWxDb2xvck1hc2suY2FsbChnbCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7CgkJCSAgICBzZWxmLnJlYWxWaWV3cG9ydC5jYWxsKGdsLCAwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwoJCQkgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5hbHBoYSB8fCBpc0lPUygpKSB7CgkJCSAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMSk7CgkJCSAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpOwoJCQkgICAgfQoJCQkgICAgZ2wudXNlUHJvZ3JhbShzZWxmLnByb2dyYW0pOwoJCQkgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgc2VsZi5pbmRleEJ1ZmZlcik7CgkJCSAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgc2VsZi52ZXJ0ZXhCdWZmZXIpOwoJCQkgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoc2VsZi5hdHRyaWJzLnBvc2l0aW9uKTsKCQkJICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNlbGYuYXR0cmlicy50ZXhDb29yZCk7CgkJCSAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHNlbGYuYXR0cmlicy5wb3NpdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAyMCwgMCk7CgkJCSAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgMywgZ2wuRkxPQVQsIGZhbHNlLCAyMCwgOCk7CgkJCSAgICBpZiAoc2VsZi5pbnN0YW5jZUV4dCkgewoJCQkgICAgICBpZiAocG9zaXRpb25EaXZpc29yICE9IDApIHsKCQkJICAgICAgICBzZWxmLmluc3RhbmNlRXh0LnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShzZWxmLmF0dHJpYnMucG9zaXRpb24sIDApOwoJCQkgICAgICB9CgkJCSAgICAgIGlmICh0ZXhDb29yZERpdmlzb3IgIT0gMCkgewoJCQkgICAgICAgIHNlbGYuaW5zdGFuY2VFeHQudmVydGV4QXR0cmliRGl2aXNvckFOR0xFKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgMCk7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApOwoJCQkgICAgZ2wudW5pZm9ybTFpKHNlbGYudW5pZm9ybXMuZGlmZnVzZSwgMCk7CgkJCSAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCk7CgkJCSAgICBnbC51bmlmb3JtNGZ2KHNlbGYudW5pZm9ybXMudmlld3BvcnRPZmZzZXRTY2FsZSwgc2VsZi52aWV3cG9ydE9mZnNldFNjYWxlKTsKCQkJICAgIGdsLmRyYXdFbGVtZW50cyhnbC5UUklBTkdMRVMsIHNlbGYuaW5kZXhDb3VudCwgZ2wuVU5TSUdORURfU0hPUlQsIDApOwoJCQkgICAgaWYgKHNlbGYuY2FyZGJvYXJkVUkpIHsKCQkJICAgICAgc2VsZi5jYXJkYm9hcmRVSS5yZW5kZXJOb1N0YXRlKCk7CgkJCSAgICB9CgkJCSAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChzZWxmLmdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5mcmFtZWJ1ZmZlcik7CgkJCSAgICBpZiAoIXNlbGYuY3R4QXR0cmlicy5wcmVzZXJ2ZURyYXdpbmdCdWZmZXIpIHsKCQkJICAgICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5jYWxsKGdsLCAwLCAwLCAwLCAwKTsKCQkJICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoIXNlbGYuZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzKSB7CgkJCSAgICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5jdWxsRmFjZSkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuQ1VMTF9GQUNFKTsKCQkJICAgIH0KCQkJICAgIGlmIChzZWxmLmRlcHRoVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuREVQVEhfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5ibGVuZCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuQkxFTkQpOwoJCQkgICAgfQoJCQkgICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKCQkJICAgICAgc2VsZi5yZWFsRW5hYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5zdGVuY2lsVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU1RFTkNJTF9URVNUKTsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbENvbG9yTWFzay5hcHBseShnbCwgc2VsZi5jb2xvck1hc2spOwoJCQkgICAgc2VsZi5yZWFsVmlld3BvcnQuYXBwbHkoZ2wsIHNlbGYudmlld3BvcnQpOwoJCQkgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5hbHBoYSB8fCAhc2VsZi5jdHhBdHRyaWJzLnByZXNlcnZlRHJhd2luZ0J1ZmZlcikgewoJCQkgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmFwcGx5KGdsLCBzZWxmLmNsZWFyQ29sb3IpOwoJCQkgICAgfQoJCQkgICAgaWYgKHNlbGYuaW5zdGFuY2VFeHQpIHsKCQkJICAgICAgaWYgKHBvc2l0aW9uRGl2aXNvciAhPSAwKSB7CgkJCSAgICAgICAgc2VsZi5pbnN0YW5jZUV4dC52ZXJ0ZXhBdHRyaWJEaXZpc29yQU5HTEUoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCBwb3NpdGlvbkRpdmlzb3IpOwoJCQkgICAgICB9CgkJCSAgICAgIGlmICh0ZXhDb29yZERpdmlzb3IgIT0gMCkgewoJCQkgICAgICAgIHNlbGYuaW5zdGFuY2VFeHQudmVydGV4QXR0cmliRGl2aXNvckFOR0xFKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgdGV4Q29vcmREaXZpc29yKTsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgIH0pOwoJCQkgIGlmIChpc0lPUygpKSB7CgkJCSAgICB2YXIgY2FudmFzID0gZ2wuY2FudmFzOwoJCQkgICAgaWYgKGNhbnZhcy53aWR0aCAhPSBzZWxmLmJ1ZmZlcldpZHRoIHx8IGNhbnZhcy5oZWlnaHQgIT0gc2VsZi5idWZmZXJIZWlnaHQpIHsKCQkJICAgICAgc2VsZi5idWZmZXJXaWR0aCA9IGNhbnZhcy53aWR0aDsKCQkJICAgICAgc2VsZi5idWZmZXJIZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwoJCQkgICAgICBzZWxmLm9uUmVzaXplKCk7CgkJCSAgICB9CgkJCSAgfQoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnVwZGF0ZURldmljZUluZm8gPSBmdW5jdGlvbiAoZGV2aWNlSW5mbykgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBnbFN0YXRlID0gW2dsLkFSUkFZX0JVRkZFUl9CSU5ESU5HLCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUl9CSU5ESU5HXTsKCQkJICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewoJCQkgICAgdmFyIHZlcnRpY2VzID0gc2VsZi5jb21wdXRlTWVzaFZlcnRpY2VzXyhzZWxmLm1lc2hXaWR0aCwgc2VsZi5tZXNoSGVpZ2h0LCBkZXZpY2VJbmZvKTsKCQkJICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBzZWxmLnZlcnRleEJ1ZmZlcik7CgkJCSAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdmVydGljZXMsIGdsLlNUQVRJQ19EUkFXKTsKCQkJICAgIGlmICghc2VsZi5pbmRleENvdW50KSB7CgkJCSAgICAgIHZhciBpbmRpY2VzID0gc2VsZi5jb21wdXRlTWVzaEluZGljZXNfKHNlbGYubWVzaFdpZHRoLCBzZWxmLm1lc2hIZWlnaHQpOwoJCQkgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBzZWxmLmluZGV4QnVmZmVyKTsKCQkJICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaW5kaWNlcywgZ2wuU1RBVElDX0RSQVcpOwoJCQkgICAgICBzZWxmLmluZGV4Q291bnQgPSBpbmRpY2VzLmxlbmd0aDsKCQkJICAgIH0KCQkJICB9KTsKCQkJfTsKCQkJQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5jb21wdXRlTWVzaFZlcnRpY2VzXyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBkZXZpY2VJbmZvKSB7CgkJCSAgdmFyIHZlcnRpY2VzID0gbmV3IEZsb2F0MzJBcnJheSgyICogd2lkdGggKiBoZWlnaHQgKiA1KTsKCQkJICB2YXIgbGVuc0ZydXN0dW0gPSBkZXZpY2VJbmZvLmdldExlZnRFeWVWaXNpYmxlVGFuQW5nbGVzKCk7CgkJCSAgdmFyIG5vTGVuc0ZydXN0dW0gPSBkZXZpY2VJbmZvLmdldExlZnRFeWVOb0xlbnNUYW5BbmdsZXMoKTsKCQkJICB2YXIgdmlld3BvcnQgPSBkZXZpY2VJbmZvLmdldExlZnRFeWVWaXNpYmxlU2NyZWVuUmVjdChub0xlbnNGcnVzdHVtKTsKCQkJICB2YXIgdmlkeCA9IDA7CgkJCSAgZm9yICh2YXIgZSA9IDA7IGUgPCAyOyBlKyspIHsKCQkJICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGVpZ2h0OyBqKyspIHsKCQkJICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrLCB2aWR4KyspIHsKCQkJICAgICAgICB2YXIgdSA9IGkgLyAod2lkdGggLSAxKTsKCQkJICAgICAgICB2YXIgdiA9IGogLyAoaGVpZ2h0IC0gMSk7CgkJCSAgICAgICAgdmFyIHMgPSB1OwoJCQkgICAgICAgIHZhciB0ID0gdjsKCQkJICAgICAgICB2YXIgeCA9IGxlcnAobGVuc0ZydXN0dW1bMF0sIGxlbnNGcnVzdHVtWzJdLCB1KTsKCQkJICAgICAgICB2YXIgeSA9IGxlcnAobGVuc0ZydXN0dW1bM10sIGxlbnNGcnVzdHVtWzFdLCB2KTsKCQkJICAgICAgICB2YXIgZCA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTsKCQkJICAgICAgICB2YXIgciA9IGRldmljZUluZm8uZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShkKTsKCQkJICAgICAgICB2YXIgcCA9IHggKiByIC8gZDsKCQkJICAgICAgICB2YXIgcSA9IHkgKiByIC8gZDsKCQkJICAgICAgICB1ID0gKHAgLSBub0xlbnNGcnVzdHVtWzBdKSAvIChub0xlbnNGcnVzdHVtWzJdIC0gbm9MZW5zRnJ1c3R1bVswXSk7CgkJCSAgICAgICAgdiA9IChxIC0gbm9MZW5zRnJ1c3R1bVszXSkgLyAobm9MZW5zRnJ1c3R1bVsxXSAtIG5vTGVuc0ZydXN0dW1bM10pOwoJCQkgICAgICAgIHUgPSAodmlld3BvcnQueCArIHUgKiB2aWV3cG9ydC53aWR0aCAtIDAuNSkgKiAyLjA7CgkJCSAgICAgICAgdiA9ICh2aWV3cG9ydC55ICsgdiAqIHZpZXdwb3J0LmhlaWdodCAtIDAuNSkgKiAyLjA7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAwXSA9IHU7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAxXSA9IHY7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAyXSA9IHM7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAzXSA9IHQ7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyA0XSA9IGU7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICAgIHZhciB3ID0gbGVuc0ZydXN0dW1bMl0gLSBsZW5zRnJ1c3R1bVswXTsKCQkJICAgIGxlbnNGcnVzdHVtWzBdID0gLSh3ICsgbGVuc0ZydXN0dW1bMF0pOwoJCQkgICAgbGVuc0ZydXN0dW1bMl0gPSB3IC0gbGVuc0ZydXN0dW1bMl07CgkJCSAgICB3ID0gbm9MZW5zRnJ1c3R1bVsyXSAtIG5vTGVuc0ZydXN0dW1bMF07CgkJCSAgICBub0xlbnNGcnVzdHVtWzBdID0gLSh3ICsgbm9MZW5zRnJ1c3R1bVswXSk7CgkJCSAgICBub0xlbnNGcnVzdHVtWzJdID0gdyAtIG5vTGVuc0ZydXN0dW1bMl07CgkJCSAgICB2aWV3cG9ydC54ID0gMSAtICh2aWV3cG9ydC54ICsgdmlld3BvcnQud2lkdGgpOwoJCQkgIH0KCQkJICByZXR1cm4gdmVydGljZXM7CgkJCX07CgkJCUNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuY29tcHV0ZU1lc2hJbmRpY2VzXyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7CgkJCSAgdmFyIGluZGljZXMgPSBuZXcgVWludDE2QXJyYXkoMiAqICh3aWR0aCAtIDEpICogKGhlaWdodCAtIDEpICogNik7CgkJCSAgdmFyIGhhbGZ3aWR0aCA9IHdpZHRoIC8gMjsKCQkJICB2YXIgaGFsZmhlaWdodCA9IGhlaWdodCAvIDI7CgkJCSAgdmFyIHZpZHggPSAwOwoJCQkgIHZhciBpaWR4ID0gMDsKCQkJICBmb3IgKHZhciBlID0gMDsgZSA8IDI7IGUrKykgewoJCQkgICAgZm9yICh2YXIgaiA9IDA7IGogPCBoZWlnaHQ7IGorKykgewoJCQkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdpZHRoOyBpKyssIHZpZHgrKykgewoJCQkgICAgICAgIGlmIChpID09IDAgfHwgaiA9PSAwKSBjb250aW51ZTsKCQkJICAgICAgICBpZiAoaSA8PSBoYWxmd2lkdGggPT0gaiA8PSBoYWxmaGVpZ2h0KSB7CgkJCSAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aCAtIDE7CgkJCSAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIDE7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoOwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeDsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKCQkJICAgICAgICB9CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICB9CgkJCSAgcmV0dXJuIGluZGljZXM7CgkJCX07CgkJCUNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yXyA9IGZ1bmN0aW9uIChwcm90bywgYXR0ck5hbWUpIHsKCQkJICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG8sIGF0dHJOYW1lKTsKCQkJICBpZiAoZGVzY3JpcHRvci5nZXQgPT09IHVuZGVmaW5lZCB8fCBkZXNjcmlwdG9yLnNldCA9PT0gdW5kZWZpbmVkKSB7CgkJCSAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CgkJCSAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlOwoJCQkgICAgZGVzY3JpcHRvci5nZXQgPSBmdW5jdGlvbiAoKSB7CgkJCSAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZShhdHRyTmFtZSk7CgkJCSAgICB9OwoJCQkgICAgZGVzY3JpcHRvci5zZXQgPSBmdW5jdGlvbiAodmFsKSB7CgkJCSAgICAgIHRoaXMuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCB2YWwpOwoJCQkgICAgfTsKCQkJICB9CgkJCSAgcmV0dXJuIGRlc2NyaXB0b3I7CgkJCX07CgkJCXZhciB1aVZTID0gWydhdHRyaWJ1dGUgdmVjMiBwb3NpdGlvbjsnLCAndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXQ7JywgJ3ZvaWQgbWFpbigpIHsnLCAnICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXQgKiB2ZWM0KCBwb3NpdGlvbiwgLTEuMCwgMS4wICk7JywgJ30nXS5qb2luKCdcbicpOwoJCQl2YXIgdWlGUyA9IFsncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7JywgJ3VuaWZvcm0gdmVjNCBjb2xvcjsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX0ZyYWdDb2xvciA9IGNvbG9yOycsICd9J10uam9pbignXG4nKTsKCQkJdmFyIERFRzJSQUQgPSBNYXRoLlBJIC8gMTgwLjA7CgkJCXZhciBrQW5nbGVQZXJHZWFyU2VjdGlvbiA9IDYwOwoJCQl2YXIga091dGVyUmltRW5kQW5nbGUgPSAxMjsKCQkJdmFyIGtJbm5lclJpbUJlZ2luQW5nbGUgPSAyMDsKCQkJdmFyIGtPdXRlclJhZGl1cyA9IDE7CgkJCXZhciBrTWlkZGxlUmFkaXVzID0gMC43NTsKCQkJdmFyIGtJbm5lclJhZGl1cyA9IDAuMzEyNTsKCQkJdmFyIGtDZW50ZXJMaW5lVGhpY2tuZXNzRHAgPSA0OwoJCQl2YXIga0J1dHRvbldpZHRoRHAgPSAyODsKCQkJdmFyIGtUb3VjaFNsb3BGYWN0b3IgPSAxLjU7CgkJCWZ1bmN0aW9uIENhcmRib2FyZFVJKGdsKSB7CgkJCSAgdGhpcy5nbCA9IGdsOwoJCQkgIHRoaXMuYXR0cmlicyA9IHsKCQkJICAgIHBvc2l0aW9uOiAwCgkJCSAgfTsKCQkJICB0aGlzLnByb2dyYW0gPSBsaW5rUHJvZ3JhbShnbCwgdWlWUywgdWlGUywgdGhpcy5hdHRyaWJzKTsKCQkJICB0aGlzLnVuaWZvcm1zID0gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCB0aGlzLnByb2dyYW0pOwoJCQkgIHRoaXMudmVydGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCSAgdGhpcy5nZWFyT2Zmc2V0ID0gMDsKCQkJICB0aGlzLmdlYXJWZXJ0ZXhDb3VudCA9IDA7CgkJCSAgdGhpcy5hcnJvd09mZnNldCA9IDA7CgkJCSAgdGhpcy5hcnJvd1ZlcnRleENvdW50ID0gMDsKCQkJICB0aGlzLnByb2pNYXQgPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKCQkJICB0aGlzLmxpc3RlbmVyID0gbnVsbDsKCQkJICB0aGlzLm9uUmVzaXplKCk7CgkJCX0KCQkJQ2FyZGJvYXJkVUkucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGdsID0gdGhpcy5nbDsKCQkJICBpZiAodGhpcy5saXN0ZW5lcikgewoJCQkgICAgZ2wuY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5saXN0ZW5lciwgZmFsc2UpOwoJCQkgIH0KCQkJICBnbC5kZWxldGVQcm9ncmFtKHRoaXMucHJvZ3JhbSk7CgkJCSAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMudmVydGV4QnVmZmVyKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVUkucHJvdG90eXBlLmxpc3RlbiA9IGZ1bmN0aW9uIChvcHRpb25zQ2FsbGJhY2ssIGJhY2tDYWxsYmFjaykgewoJCQkgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKCQkJICB0aGlzLmxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkJCSAgICB2YXIgbWlkbGluZSA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIDI7CgkJCSAgICB2YXIgYnV0dG9uU2l6ZSA9IGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvcjsKCQkJICAgIGlmIChldmVudC5jbGllbnRYID4gbWlkbGluZSAtIGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WCA8IG1pZGxpbmUgKyBidXR0b25TaXplICYmIGV2ZW50LmNsaWVudFkgPiBjYW52YXMuY2xpZW50SGVpZ2h0IC0gYnV0dG9uU2l6ZSkgewoJCQkgICAgICBvcHRpb25zQ2FsbGJhY2soZXZlbnQpOwoJCQkgICAgfQoJCQkgICAgZWxzZSBpZiAoZXZlbnQuY2xpZW50WCA8IGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WSA8IGJ1dHRvblNpemUpIHsKCQkJICAgICAgICBiYWNrQ2FsbGJhY2soZXZlbnQpOwoJCQkgICAgICB9CgkJCSAgfTsKCQkJICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmxpc3RlbmVyLCBmYWxzZSk7CgkJCX07CgkJCUNhcmRib2FyZFVJLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIHZhciBzZWxmID0gdGhpczsKCQkJICB2YXIgZ2xTdGF0ZSA9IFtnbC5BUlJBWV9CVUZGRVJfQklORElOR107CgkJCSAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKCQkJICAgIHZhciB2ZXJ0aWNlcyA9IFtdOwoJCQkgICAgdmFyIG1pZGxpbmUgPSBnbC5kcmF3aW5nQnVmZmVyV2lkdGggLyAyOwoJCQkgICAgdmFyIHBoeXNpY2FsUGl4ZWxzID0gTWF0aC5tYXgoc2NyZWVuLndpZHRoLCBzY3JlZW4uaGVpZ2h0KSAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwoJCQkgICAgdmFyIHNjYWxpbmdSYXRpbyA9IGdsLmRyYXdpbmdCdWZmZXJXaWR0aCAvIHBoeXNpY2FsUGl4ZWxzOwoJCQkgICAgdmFyIGRwcyA9IHNjYWxpbmdSYXRpbyAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwoJCQkgICAgdmFyIGxpbmVXaWR0aCA9IGtDZW50ZXJMaW5lVGhpY2tuZXNzRHAgKiBkcHMgLyAyOwoJCQkgICAgdmFyIGJ1dHRvblNpemUgPSBrQnV0dG9uV2lkdGhEcCAqIGtUb3VjaFNsb3BGYWN0b3IgKiBkcHM7CgkJCSAgICB2YXIgYnV0dG9uU2NhbGUgPSBrQnV0dG9uV2lkdGhEcCAqIGRwcyAvIDI7CgkJCSAgICB2YXIgYnV0dG9uQm9yZGVyID0gKGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvciAtIGtCdXR0b25XaWR0aERwKSAqIGRwczsKCQkJICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSAtIGxpbmVXaWR0aCwgYnV0dG9uU2l6ZSk7CgkJCSAgICB2ZXJ0aWNlcy5wdXNoKG1pZGxpbmUgLSBsaW5lV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwoJCQkgICAgdmVydGljZXMucHVzaChtaWRsaW5lICsgbGluZVdpZHRoLCBidXR0b25TaXplKTsKCQkJICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSArIGxpbmVXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CgkJCSAgICBzZWxmLmdlYXJPZmZzZXQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyOwoJCQkgICAgZnVuY3Rpb24gYWRkR2VhclNlZ21lbnQodGhldGEsIHIpIHsKCQkJICAgICAgdmFyIGFuZ2xlID0gKDkwIC0gdGhldGEpICogREVHMlJBRDsKCQkJICAgICAgdmFyIHggPSBNYXRoLmNvcyhhbmdsZSk7CgkJCSAgICAgIHZhciB5ID0gTWF0aC5zaW4oYW5nbGUpOwoJCQkgICAgICB2ZXJ0aWNlcy5wdXNoKGtJbm5lclJhZGl1cyAqIHggKiBidXR0b25TY2FsZSArIG1pZGxpbmUsIGtJbm5lclJhZGl1cyAqIHkgKiBidXR0b25TY2FsZSArIGJ1dHRvblNjYWxlKTsKCQkJICAgICAgdmVydGljZXMucHVzaChyICogeCAqIGJ1dHRvblNjYWxlICsgbWlkbGluZSwgciAqIHkgKiBidXR0b25TY2FsZSArIGJ1dHRvblNjYWxlKTsKCQkJICAgIH0KCQkJICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDY7IGkrKykgewoJCQkgICAgICB2YXIgc2VnbWVudFRoZXRhID0gaSAqIGtBbmdsZVBlckdlYXJTZWN0aW9uOwoJCQkgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEsIGtPdXRlclJhZGl1cyk7CgkJCSAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIGtPdXRlclJpbUVuZEFuZ2xlLCBrT3V0ZXJSYWRpdXMpOwoJCQkgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyBrSW5uZXJSaW1CZWdpbkFuZ2xlLCBrTWlkZGxlUmFkaXVzKTsKCQkJICAgICAgYWRkR2VhclNlZ21lbnQoc2VnbWVudFRoZXRhICsgKGtBbmdsZVBlckdlYXJTZWN0aW9uIC0ga0lubmVyUmltQmVnaW5BbmdsZSksIGtNaWRkbGVSYWRpdXMpOwoJCQkgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyAoa0FuZ2xlUGVyR2VhclNlY3Rpb24gLSBrT3V0ZXJSaW1FbmRBbmdsZSksIGtPdXRlclJhZGl1cyk7CgkJCSAgICB9CgkJCSAgICBzZWxmLmdlYXJWZXJ0ZXhDb3VudCA9IHZlcnRpY2VzLmxlbmd0aCAvIDIgLSBzZWxmLmdlYXJPZmZzZXQ7CgkJCSAgICBzZWxmLmFycm93T2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMjsKCQkJICAgIGZ1bmN0aW9uIGFkZEFycm93VmVydGV4KHgsIHkpIHsKCQkJICAgICAgdmVydGljZXMucHVzaChidXR0b25Cb3JkZXIgKyB4LCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0IC0gYnV0dG9uQm9yZGVyIC0geSk7CgkJCSAgICB9CgkJCSAgICB2YXIgYW5nbGVkTGluZVdpZHRoID0gbGluZVdpZHRoIC8gTWF0aC5zaW4oNDUgKiBERUcyUkFEKTsKCQkJICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlLCAwKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlICsgYW5nbGVkTGluZVdpZHRoLCBhbmdsZWRMaW5lV2lkdGgpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSArIGFuZ2xlZExpbmVXaWR0aCk7CgkJCSAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlIC0gYW5nbGVkTGluZVdpZHRoKTsKCQkJICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlLCBidXR0b25TY2FsZSAqIDIpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUgKyBhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlICogMiAtIGFuZ2xlZExpbmVXaWR0aCk7CgkJCSAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlIC0gYW5nbGVkTGluZVdpZHRoKTsKCQkJICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgLSBsaW5lV2lkdGgpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoa0J1dHRvbldpZHRoRHAgKiBkcHMsIGJ1dHRvblNjYWxlIC0gbGluZVdpZHRoKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgKyBsaW5lV2lkdGgpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoa0J1dHRvbldpZHRoRHAgKiBkcHMsIGJ1dHRvblNjYWxlICsgbGluZVdpZHRoKTsKCQkJICAgIHNlbGYuYXJyb3dWZXJ0ZXhDb3VudCA9IHZlcnRpY2VzLmxlbmd0aCAvIDIgLSBzZWxmLmFycm93T2Zmc2V0OwoJCQkgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHNlbGYudmVydGV4QnVmZmVyKTsKCQkJICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKSwgZ2wuU1RBVElDX0RSQVcpOwoJCQkgIH0pOwoJCQl9OwoJCQlDYXJkYm9hcmRVSS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBnbFN0YXRlID0gW2dsLkNVTExfRkFDRSwgZ2wuREVQVEhfVEVTVCwgZ2wuQkxFTkQsIGdsLlNDSVNTT1JfVEVTVCwgZ2wuU1RFTkNJTF9URVNULCBnbC5DT0xPUl9XUklURU1BU0ssIGdsLlZJRVdQT1JULCBnbC5DVVJSRU5UX1BST0dSQU0sIGdsLkFSUkFZX0JVRkZFUl9CSU5ESU5HXTsKCQkJICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewoJCQkgICAgZ2wuZGlzYWJsZShnbC5DVUxMX0ZBQ0UpOwoJCQkgICAgZ2wuZGlzYWJsZShnbC5ERVBUSF9URVNUKTsKCQkJICAgIGdsLmRpc2FibGUoZ2wuQkxFTkQpOwoJCQkgICAgZ2wuZGlzYWJsZShnbC5TQ0lTU09SX1RFU1QpOwoJCQkgICAgZ2wuZGlzYWJsZShnbC5TVEVOQ0lMX1RFU1QpOwoJCQkgICAgZ2wuY29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpOwoJCQkgICAgZ2wudmlld3BvcnQoMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKCQkJICAgIHNlbGYucmVuZGVyTm9TdGF0ZSgpOwoJCQkgIH0pOwoJCQl9OwoJCQlDYXJkYm9hcmRVSS5wcm90b3R5cGUucmVuZGVyTm9TdGF0ZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIGdsLnVzZVByb2dyYW0odGhpcy5wcm9ncmFtKTsKCQkJICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy52ZXJ0ZXhCdWZmZXIpOwoJCQkgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuYXR0cmlicy5wb3NpdGlvbik7CgkJCSAgZ2wudmVydGV4QXR0cmliUG9pbnRlcih0aGlzLmF0dHJpYnMucG9zaXRpb24sIDIsIGdsLkZMT0FULCBmYWxzZSwgOCwgMCk7CgkJCSAgZ2wudW5pZm9ybTRmKHRoaXMudW5pZm9ybXMuY29sb3IsIDEuMCwgMS4wLCAxLjAsIDEuMCk7CgkJCSAgb3J0aG9NYXRyaXgodGhpcy5wcm9qTWF0LCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIDAsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQsIDAuMSwgMTAyNC4wKTsKCQkJICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMudW5pZm9ybXMucHJvamVjdGlvbk1hdCwgZmFsc2UsIHRoaXMucHJvak1hdCk7CgkJCSAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgMCwgNCk7CgkJCSAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgdGhpcy5nZWFyT2Zmc2V0LCB0aGlzLmdlYXJWZXJ0ZXhDb3VudCk7CgkJCSAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgdGhpcy5hcnJvd09mZnNldCwgdGhpcy5hcnJvd1ZlcnRleENvdW50KTsKCQkJfTsKCQkJZnVuY3Rpb24gRGlzdG9ydGlvbihjb2VmZmljaWVudHMpIHsKCQkJICB0aGlzLmNvZWZmaWNpZW50cyA9IGNvZWZmaWNpZW50czsKCQkJfQoJCQlEaXN0b3J0aW9uLnByb3RvdHlwZS5kaXN0b3J0SW52ZXJzZSA9IGZ1bmN0aW9uIChyYWRpdXMpIHsKCQkJICB2YXIgcjAgPSAwOwoJCQkgIHZhciByMSA9IDE7CgkJCSAgdmFyIGRyMCA9IHJhZGl1cyAtIHRoaXMuZGlzdG9ydChyMCk7CgkJCSAgd2hpbGUgKE1hdGguYWJzKHIxIC0gcjApID4gMC4wMDAxICAgICAgICAgICAgICkgewoJCQkgICAgdmFyIGRyMSA9IHJhZGl1cyAtIHRoaXMuZGlzdG9ydChyMSk7CgkJCSAgICB2YXIgcjIgPSByMSAtIGRyMSAqICgocjEgLSByMCkgLyAoZHIxIC0gZHIwKSk7CgkJCSAgICByMCA9IHIxOwoJCQkgICAgcjEgPSByMjsKCQkJICAgIGRyMCA9IGRyMTsKCQkJICB9CgkJCSAgcmV0dXJuIHIxOwoJCQl9OwoJCQlEaXN0b3J0aW9uLnByb3RvdHlwZS5kaXN0b3J0ID0gZnVuY3Rpb24gKHJhZGl1cykgewoJCQkgIHZhciByMiA9IHJhZGl1cyAqIHJhZGl1czsKCQkJICB2YXIgcmV0ID0gMDsKCQkJICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29lZmZpY2llbnRzLmxlbmd0aDsgaSsrKSB7CgkJCSAgICByZXQgPSByMiAqIChyZXQgKyB0aGlzLmNvZWZmaWNpZW50c1tpXSk7CgkJCSAgfQoJCQkgIHJldHVybiAocmV0ICsgMSkgKiByYWRpdXM7CgkJCX07CgkJCXZhciBkZWdUb1JhZCA9IE1hdGguUEkgLyAxODA7CgkJCXZhciByYWRUb0RlZyA9IDE4MCAvIE1hdGguUEk7CgkJCXZhciBWZWN0b3IzID0gZnVuY3Rpb24gVmVjdG9yMyh4LCB5LCB6KSB7CgkJCSAgdGhpcy54ID0geCB8fCAwOwoJCQkgIHRoaXMueSA9IHkgfHwgMDsKCQkJICB0aGlzLnogPSB6IHx8IDA7CgkJCX07CgkJCVZlY3RvcjMucHJvdG90eXBlID0gewoJCQkgIGNvbnN0cnVjdG9yOiBWZWN0b3IzLAoJCQkgIHNldDogZnVuY3Rpb24gc2V0KHgsIHksIHopIHsKCQkJICAgIHRoaXMueCA9IHg7CgkJCSAgICB0aGlzLnkgPSB5OwoJCQkgICAgdGhpcy56ID0gejsKCQkJICAgIHJldHVybiB0aGlzOwoJCQkgIH0sCgkJCSAgY29weTogZnVuY3Rpb24gY29weSh2KSB7CgkJCSAgICB0aGlzLnggPSB2Lng7CgkJCSAgICB0aGlzLnkgPSB2Lnk7CgkJCSAgICB0aGlzLnogPSB2Lno7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIGxlbmd0aDogZnVuY3Rpb24gbGVuZ3RoKCkgewoJCQkgICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnopOwoJCQkgIH0sCgkJCSAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUoKSB7CgkJCSAgICB2YXIgc2NhbGFyID0gdGhpcy5sZW5ndGgoKTsKCQkJICAgIGlmIChzY2FsYXIgIT09IDApIHsKCQkJICAgICAgdmFyIGludlNjYWxhciA9IDEgLyBzY2FsYXI7CgkJCSAgICAgIHRoaXMubXVsdGlwbHlTY2FsYXIoaW52U2NhbGFyKTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMueCA9IDA7CgkJCSAgICAgIHRoaXMueSA9IDA7CgkJCSAgICAgIHRoaXMueiA9IDA7CgkJCSAgICB9CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbiBtdWx0aXBseVNjYWxhcihzY2FsYXIpIHsKCQkJICAgIHRoaXMueCAqPSBzY2FsYXI7CgkJCSAgICB0aGlzLnkgKj0gc2NhbGFyOwoJCQkgICAgdGhpcy56ICo9IHNjYWxhcjsKCQkJICB9LAoJCQkgIGFwcGx5UXVhdGVybmlvbjogZnVuY3Rpb24gYXBwbHlRdWF0ZXJuaW9uKHEpIHsKCQkJICAgIHZhciB4ID0gdGhpcy54OwoJCQkgICAgdmFyIHkgPSB0aGlzLnk7CgkJCSAgICB2YXIgeiA9IHRoaXMuejsKCQkJICAgIHZhciBxeCA9IHEueDsKCQkJICAgIHZhciBxeSA9IHEueTsKCQkJICAgIHZhciBxeiA9IHEuejsKCQkJICAgIHZhciBxdyA9IHEudzsKCQkJICAgIHZhciBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKCQkJICAgIHZhciBpeSA9IHF3ICogeSArIHF6ICogeCAtIHF4ICogejsKCQkJICAgIHZhciBpeiA9IHF3ICogeiArIHF4ICogeSAtIHF5ICogeDsKCQkJICAgIHZhciBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CgkJCSAgICB0aGlzLnggPSBpeCAqIHF3ICsgaXcgKiAtcXggKyBpeSAqIC1xeiAtIGl6ICogLXF5OwoJCQkgICAgdGhpcy55ID0gaXkgKiBxdyArIGl3ICogLXF5ICsgaXogKiAtcXggLSBpeCAqIC1xejsKCQkJICAgIHRoaXMueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIGRvdDogZnVuY3Rpb24gZG90KHYpIHsKCQkJICAgIHJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2Lno7CgkJCSAgfSwKCQkJICBjcm9zc1ZlY3RvcnM6IGZ1bmN0aW9uIGNyb3NzVmVjdG9ycyhhLCBiKSB7CgkJCSAgICB2YXIgYXggPSBhLngsCgkJCSAgICAgICAgYXkgPSBhLnksCgkJCSAgICAgICAgYXogPSBhLno7CgkJCSAgICB2YXIgYnggPSBiLngsCgkJCSAgICAgICAgYnkgPSBiLnksCgkJCSAgICAgICAgYnogPSBiLno7CgkJCSAgICB0aGlzLnggPSBheSAqIGJ6IC0gYXogKiBieTsKCQkJICAgIHRoaXMueSA9IGF6ICogYnggLSBheCAqIGJ6OwoJCQkgICAgdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9CgkJCX07CgkJCXZhciBRdWF0ZXJuaW9uID0gZnVuY3Rpb24gUXVhdGVybmlvbih4LCB5LCB6LCB3KSB7CgkJCSAgdGhpcy54ID0geCB8fCAwOwoJCQkgIHRoaXMueSA9IHkgfHwgMDsKCQkJICB0aGlzLnogPSB6IHx8IDA7CgkJCSAgdGhpcy53ID0gdyAhPT0gdW5kZWZpbmVkID8gdyA6IDE7CgkJCX07CgkJCVF1YXRlcm5pb24ucHJvdG90eXBlID0gewoJCQkgIGNvbnN0cnVjdG9yOiBRdWF0ZXJuaW9uLAoJCQkgIHNldDogZnVuY3Rpb24gc2V0KHgsIHksIHosIHcpIHsKCQkJICAgIHRoaXMueCA9IHg7CgkJCSAgICB0aGlzLnkgPSB5OwoJCQkgICAgdGhpcy56ID0gejsKCQkJICAgIHRoaXMudyA9IHc7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIGNvcHk6IGZ1bmN0aW9uIGNvcHkocXVhdGVybmlvbikgewoJCQkgICAgdGhpcy54ID0gcXVhdGVybmlvbi54OwoJCQkgICAgdGhpcy55ID0gcXVhdGVybmlvbi55OwoJCQkgICAgdGhpcy56ID0gcXVhdGVybmlvbi56OwoJCQkgICAgdGhpcy53ID0gcXVhdGVybmlvbi53OwoJCQkgICAgcmV0dXJuIHRoaXM7CgkJCSAgfSwKCQkJICBzZXRGcm9tRXVsZXJYWVo6IGZ1bmN0aW9uIHNldEZyb21FdWxlclhZWih4LCB5LCB6KSB7CgkJCSAgICB2YXIgYzEgPSBNYXRoLmNvcyh4IC8gMik7CgkJCSAgICB2YXIgYzIgPSBNYXRoLmNvcyh5IC8gMik7CgkJCSAgICB2YXIgYzMgPSBNYXRoLmNvcyh6IC8gMik7CgkJCSAgICB2YXIgczEgPSBNYXRoLnNpbih4IC8gMik7CgkJCSAgICB2YXIgczIgPSBNYXRoLnNpbih5IC8gMik7CgkJCSAgICB2YXIgczMgPSBNYXRoLnNpbih6IC8gMik7CgkJCSAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCSAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCSAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCSAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIHNldEZyb21FdWxlcllYWjogZnVuY3Rpb24gc2V0RnJvbUV1bGVyWVhaKHgsIHksIHopIHsKCQkJICAgIHZhciBjMSA9IE1hdGguY29zKHggLyAyKTsKCQkJICAgIHZhciBjMiA9IE1hdGguY29zKHkgLyAyKTsKCQkJICAgIHZhciBjMyA9IE1hdGguY29zKHogLyAyKTsKCQkJICAgIHZhciBzMSA9IE1hdGguc2luKHggLyAyKTsKCQkJICAgIHZhciBzMiA9IE1hdGguc2luKHkgLyAyKTsKCQkJICAgIHZhciBzMyA9IE1hdGguc2luKHogLyAyKTsKCQkJICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKCQkJICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCQkJICAgIHJldHVybiB0aGlzOwoJCQkgIH0sCgkJCSAgc2V0RnJvbUF4aXNBbmdsZTogZnVuY3Rpb24gc2V0RnJvbUF4aXNBbmdsZShheGlzLCBhbmdsZSkgewoJCQkgICAgdmFyIGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwKCQkJICAgICAgICBzID0gTWF0aC5zaW4oaGFsZkFuZ2xlKTsKCQkJICAgIHRoaXMueCA9IGF4aXMueCAqIHM7CgkJCSAgICB0aGlzLnkgPSBheGlzLnkgKiBzOwoJCQkgICAgdGhpcy56ID0gYXhpcy56ICogczsKCQkJICAgIHRoaXMudyA9IE1hdGguY29zKGhhbGZBbmdsZSk7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIG11bHRpcGx5OiBmdW5jdGlvbiBtdWx0aXBseShxKSB7CgkJCSAgICByZXR1cm4gdGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMsIHEpOwoJCQkgIH0sCgkJCSAgbXVsdGlwbHlRdWF0ZXJuaW9uczogZnVuY3Rpb24gbXVsdGlwbHlRdWF0ZXJuaW9ucyhhLCBiKSB7CgkJCSAgICB2YXIgcWF4ID0gYS54LAoJCQkgICAgICAgIHFheSA9IGEueSwKCQkJICAgICAgICBxYXogPSBhLnosCgkJCSAgICAgICAgcWF3ID0gYS53OwoJCQkgICAgdmFyIHFieCA9IGIueCwKCQkJICAgICAgICBxYnkgPSBiLnksCgkJCSAgICAgICAgcWJ6ID0gYi56LAoJCQkgICAgICAgIHFidyA9IGIudzsKCQkJICAgIHRoaXMueCA9IHFheCAqIHFidyArIHFhdyAqIHFieCArIHFheSAqIHFieiAtIHFheiAqIHFieTsKCQkJICAgIHRoaXMueSA9IHFheSAqIHFidyArIHFhdyAqIHFieSArIHFheiAqIHFieCAtIHFheCAqIHFiejsKCQkJICAgIHRoaXMueiA9IHFheiAqIHFidyArIHFhdyAqIHFieiArIHFheCAqIHFieSAtIHFheSAqIHFieDsKCQkJICAgIHRoaXMudyA9IHFhdyAqIHFidyAtIHFheCAqIHFieCAtIHFheSAqIHFieSAtIHFheiAqIHFiejsKCQkJICAgIHJldHVybiB0aGlzOwoJCQkgIH0sCgkJCSAgaW52ZXJzZTogZnVuY3Rpb24gaW52ZXJzZSgpIHsKCQkJICAgIHRoaXMueCAqPSAtMTsKCQkJICAgIHRoaXMueSAqPSAtMTsKCQkJICAgIHRoaXMueiAqPSAtMTsKCQkJICAgIHRoaXMubm9ybWFsaXplKCk7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIG5vcm1hbGl6ZTogZnVuY3Rpb24gbm9ybWFsaXplKCkgewoJCQkgICAgdmFyIGwgPSBNYXRoLnNxcnQodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KTsKCQkJICAgIGlmIChsID09PSAwKSB7CgkJCSAgICAgIHRoaXMueCA9IDA7CgkJCSAgICAgIHRoaXMueSA9IDA7CgkJCSAgICAgIHRoaXMueiA9IDA7CgkJCSAgICAgIHRoaXMudyA9IDE7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICBsID0gMSAvIGw7CgkJCSAgICAgIHRoaXMueCA9IHRoaXMueCAqIGw7CgkJCSAgICAgIHRoaXMueSA9IHRoaXMueSAqIGw7CgkJCSAgICAgIHRoaXMueiA9IHRoaXMueiAqIGw7CgkJCSAgICAgIHRoaXMudyA9IHRoaXMudyAqIGw7CgkJCSAgICB9CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIHNsZXJwOiBmdW5jdGlvbiBzbGVycChxYiwgdCkgewoJCQkgICAgaWYgKHQgPT09IDApIHJldHVybiB0aGlzOwoJCQkgICAgaWYgKHQgPT09IDEpIHJldHVybiB0aGlzLmNvcHkocWIpOwoJCQkgICAgdmFyIHggPSB0aGlzLngsCgkJCSAgICAgICAgeSA9IHRoaXMueSwKCQkJICAgICAgICB6ID0gdGhpcy56LAoJCQkgICAgICAgIHcgPSB0aGlzLnc7CgkJCSAgICB2YXIgY29zSGFsZlRoZXRhID0gdyAqIHFiLncgKyB4ICogcWIueCArIHkgKiBxYi55ICsgeiAqIHFiLno7CgkJCSAgICBpZiAoY29zSGFsZlRoZXRhIDwgMCkgewoJCQkgICAgICB0aGlzLncgPSAtcWIudzsKCQkJICAgICAgdGhpcy54ID0gLXFiLng7CgkJCSAgICAgIHRoaXMueSA9IC1xYi55OwoJCQkgICAgICB0aGlzLnogPSAtcWIuejsKCQkJICAgICAgY29zSGFsZlRoZXRhID0gLWNvc0hhbGZUaGV0YTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMuY29weShxYik7CgkJCSAgICB9CgkJCSAgICBpZiAoY29zSGFsZlRoZXRhID49IDEuMCkgewoJCQkgICAgICB0aGlzLncgPSB3OwoJCQkgICAgICB0aGlzLnggPSB4OwoJCQkgICAgICB0aGlzLnkgPSB5OwoJCQkgICAgICB0aGlzLnogPSB6OwoJCQkgICAgICByZXR1cm4gdGhpczsKCQkJICAgIH0KCQkJICAgIHZhciBoYWxmVGhldGEgPSBNYXRoLmFjb3MoY29zSGFsZlRoZXRhKTsKCQkJICAgIHZhciBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoMS4wIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhKTsKCQkJICAgIGlmIChNYXRoLmFicyhzaW5IYWxmVGhldGEpIDwgMC4wMDEpIHsKCQkJICAgICAgdGhpcy53ID0gMC41ICogKHcgKyB0aGlzLncpOwoJCQkgICAgICB0aGlzLnggPSAwLjUgKiAoeCArIHRoaXMueCk7CgkJCSAgICAgIHRoaXMueSA9IDAuNSAqICh5ICsgdGhpcy55KTsKCQkJICAgICAgdGhpcy56ID0gMC41ICogKHogKyB0aGlzLnopOwoJCQkgICAgICByZXR1cm4gdGhpczsKCQkJICAgIH0KCQkJICAgIHZhciByYXRpb0EgPSBNYXRoLnNpbigoMSAtIHQpICogaGFsZlRoZXRhKSAvIHNpbkhhbGZUaGV0YSwKCQkJICAgICAgICByYXRpb0IgPSBNYXRoLnNpbih0ICogaGFsZlRoZXRhKSAvIHNpbkhhbGZUaGV0YTsKCQkJICAgIHRoaXMudyA9IHcgKiByYXRpb0EgKyB0aGlzLncgKiByYXRpb0I7CgkJCSAgICB0aGlzLnggPSB4ICogcmF0aW9BICsgdGhpcy54ICogcmF0aW9COwoJCQkgICAgdGhpcy55ID0geSAqIHJhdGlvQSArIHRoaXMueSAqIHJhdGlvQjsKCQkJICAgIHRoaXMueiA9IHogKiByYXRpb0EgKyB0aGlzLnogKiByYXRpb0I7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIHNldEZyb21Vbml0VmVjdG9yczogZnVuY3Rpb24gKCkgewoJCQkgICAgdmFyIHYxLCByOwoJCQkgICAgdmFyIEVQUyA9IDAuMDAwMDAxOwoJCQkgICAgcmV0dXJuIGZ1bmN0aW9uICh2RnJvbSwgdlRvKSB7CgkJCSAgICAgIGlmICh2MSA9PT0gdW5kZWZpbmVkKSB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgICAgIHIgPSB2RnJvbS5kb3QodlRvKSArIDE7CgkJCSAgICAgIGlmIChyIDwgRVBTKSB7CgkJCSAgICAgICAgciA9IDA7CgkJCSAgICAgICAgaWYgKE1hdGguYWJzKHZGcm9tLngpID4gTWF0aC5hYnModkZyb20ueikpIHsKCQkJICAgICAgICAgIHYxLnNldCgtdkZyb20ueSwgdkZyb20ueCwgMCk7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIHYxLnNldCgwLCAtdkZyb20ueiwgdkZyb20ueSk7CgkJCSAgICAgICAgfQoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIHYxLmNyb3NzVmVjdG9ycyh2RnJvbSwgdlRvKTsKCQkJICAgICAgfQoJCQkgICAgICB0aGlzLnggPSB2MS54OwoJCQkgICAgICB0aGlzLnkgPSB2MS55OwoJCQkgICAgICB0aGlzLnogPSB2MS56OwoJCQkgICAgICB0aGlzLncgPSByOwoJCQkgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwoJCQkgICAgICByZXR1cm4gdGhpczsKCQkJICAgIH07CgkJCSAgfSgpCgkJCX07CgkJCWZ1bmN0aW9uIERldmljZShwYXJhbXMpIHsKCQkJICB0aGlzLndpZHRoID0gcGFyYW1zLndpZHRoIHx8IGdldFNjcmVlbldpZHRoKCk7CgkJCSAgdGhpcy5oZWlnaHQgPSBwYXJhbXMuaGVpZ2h0IHx8IGdldFNjcmVlbkhlaWdodCgpOwoJCQkgIHRoaXMud2lkdGhNZXRlcnMgPSBwYXJhbXMud2lkdGhNZXRlcnM7CgkJCSAgdGhpcy5oZWlnaHRNZXRlcnMgPSBwYXJhbXMuaGVpZ2h0TWV0ZXJzOwoJCQkgIHRoaXMuYmV2ZWxNZXRlcnMgPSBwYXJhbXMuYmV2ZWxNZXRlcnM7CgkJCX0KCQkJdmFyIERFRkFVTFRfQU5EUk9JRCA9IG5ldyBEZXZpY2UoewoJCQkgIHdpZHRoTWV0ZXJzOiAwLjExMCwKCQkJICBoZWlnaHRNZXRlcnM6IDAuMDYyLAoJCQkgIGJldmVsTWV0ZXJzOiAwLjAwNAoJCQl9KTsKCQkJdmFyIERFRkFVTFRfSU9TID0gbmV3IERldmljZSh7CgkJCSAgd2lkdGhNZXRlcnM6IDAuMTAzOCwKCQkJICBoZWlnaHRNZXRlcnM6IDAuMDU4NCwKCQkJICBiZXZlbE1ldGVyczogMC4wMDQKCQkJfSk7CgkJCXZhciBWaWV3ZXJzID0gewoJCQkgIENhcmRib2FyZFYxOiBuZXcgQ2FyZGJvYXJkVmlld2VyKHsKCQkJICAgIGlkOiAnQ2FyZGJvYXJkVjEnLAoJCQkgICAgbGFiZWw6ICdDYXJkYm9hcmQgSS9PIDIwMTQnLAoJCQkgICAgZm92OiA0MCwKCQkJICAgIGludGVyTGVuc0Rpc3RhbmNlOiAwLjA2MCwKCQkJICAgIGJhc2VsaW5lTGVuc0Rpc3RhbmNlOiAwLjAzNSwKCQkJICAgIHNjcmVlbkxlbnNEaXN0YW5jZTogMC4wNDIsCgkJCSAgICBkaXN0b3J0aW9uQ29lZmZpY2llbnRzOiBbMC40NDEsIDAuMTU2XSwKCQkJICAgIGludmVyc2VDb2VmZmljaWVudHM6IFstMC40NDEwMDM1LCAwLjQyNzU2MTU1LCAtMC40ODA0NDM5LCAwLjU0NjAxMzksIC0wLjU4ODIxMTgzLCAwLjU3MzM5MzgsIC0wLjQ4MzAzMjAyLCAwLjMzMjk5MDgzLCAtMC4xNzU3Mzg0MSwgMC4wNjUxNzcyLCAtMC4wMTQ4ODk2MywgMC4wMDE1NTk4MzRdCgkJCSAgfSksCgkJCSAgQ2FyZGJvYXJkVjI6IG5ldyBDYXJkYm9hcmRWaWV3ZXIoewoJCQkgICAgaWQ6ICdDYXJkYm9hcmRWMicsCgkJCSAgICBsYWJlbDogJ0NhcmRib2FyZCBJL08gMjAxNScsCgkJCSAgICBmb3Y6IDYwLAoJCQkgICAgaW50ZXJMZW5zRGlzdGFuY2U6IDAuMDY0LAoJCQkgICAgYmFzZWxpbmVMZW5zRGlzdGFuY2U6IDAuMDM1LAoJCQkgICAgc2NyZWVuTGVuc0Rpc3RhbmNlOiAwLjAzOSwKCQkJICAgIGRpc3RvcnRpb25Db2VmZmljaWVudHM6IFswLjM0LCAwLjU1XSwKCQkJICAgIGludmVyc2VDb2VmZmljaWVudHM6IFstMC4zMzgzNjcwNCwgLTAuMTgxNjIxODUsIDAuODYyNjU1LCAtMS4yNDYyMDUxLCAxLjA1NjA2MDIsIC0wLjU4MjA4MzE3LCAwLjIxNjA5MDc4LCAtMC4wNTQ0NDgyMywgMC4wMDkxNzc5NTYsIC05OTA0MTY5ZS0xMCwgNi4xODM1MzVFLTUsIC0xNjk4MTgwM2UtMTNdCgkJCSAgfSkKCQkJfTsKCQkJZnVuY3Rpb24gRGV2aWNlSW5mbyhkZXZpY2VQYXJhbXMsIGFkZGl0aW9uYWxWaWV3ZXJzKSB7CgkJCSAgdGhpcy52aWV3ZXIgPSBWaWV3ZXJzLkNhcmRib2FyZFYyOwoJCQkgIHRoaXMudXBkYXRlRGV2aWNlUGFyYW1zKGRldmljZVBhcmFtcyk7CgkJCSAgdGhpcy5kaXN0b3J0aW9uID0gbmV3IERpc3RvcnRpb24odGhpcy52aWV3ZXIuZGlzdG9ydGlvbkNvZWZmaWNpZW50cyk7CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZGRpdGlvbmFsVmlld2Vycy5sZW5ndGg7IGkrKykgewoJCQkgICAgdmFyIHZpZXdlciA9IGFkZGl0aW9uYWxWaWV3ZXJzW2ldOwoJCQkgICAgVmlld2Vyc1t2aWV3ZXIuaWRdID0gbmV3IENhcmRib2FyZFZpZXdlcih2aWV3ZXIpOwoJCQkgIH0KCQkJfQoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS51cGRhdGVEZXZpY2VQYXJhbXMgPSBmdW5jdGlvbiAoZGV2aWNlUGFyYW1zKSB7CgkJCSAgdGhpcy5kZXZpY2UgPSB0aGlzLmRldGVybWluZURldmljZV8oZGV2aWNlUGFyYW1zKSB8fCB0aGlzLmRldmljZTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RGV2aWNlID0gZnVuY3Rpb24gKCkgewoJCQkgIHJldHVybiB0aGlzLmRldmljZTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuc2V0Vmlld2VyID0gZnVuY3Rpb24gKHZpZXdlcikgewoJCQkgIHRoaXMudmlld2VyID0gdmlld2VyOwoJCQkgIHRoaXMuZGlzdG9ydGlvbiA9IG5ldyBEaXN0b3J0aW9uKHRoaXMudmlld2VyLmRpc3RvcnRpb25Db2VmZmljaWVudHMpOwoJCQl9OwoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS5kZXRlcm1pbmVEZXZpY2VfID0gZnVuY3Rpb24gKGRldmljZVBhcmFtcykgewoJCQkgIGlmICghZGV2aWNlUGFyYW1zKSB7CgkJCSAgICBpZiAoaXNJT1MoKSkgewoJCQkgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGZhbGxiYWNrIGlPUyBkZXZpY2UgbWVhc3VyZW1lbnRzLicpOwoJCQkgICAgICByZXR1cm4gREVGQVVMVF9JT1M7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGZhbGxiYWNrIEFuZHJvaWQgZGV2aWNlIG1lYXN1cmVtZW50cy4nKTsKCQkJICAgICAgcmV0dXJuIERFRkFVTFRfQU5EUk9JRDsKCQkJICAgIH0KCQkJICB9CgkJCSAgdmFyIE1FVEVSU19QRVJfSU5DSCA9IDAuMDI1NDsKCQkJICB2YXIgbWV0ZXJzUGVyUGl4ZWxYID0gTUVURVJTX1BFUl9JTkNIIC8gZGV2aWNlUGFyYW1zLnhkcGk7CgkJCSAgdmFyIG1ldGVyc1BlclBpeGVsWSA9IE1FVEVSU19QRVJfSU5DSCAvIGRldmljZVBhcmFtcy55ZHBpOwoJCQkgIHZhciB3aWR0aCA9IGdldFNjcmVlbldpZHRoKCk7CgkJCSAgdmFyIGhlaWdodCA9IGdldFNjcmVlbkhlaWdodCgpOwoJCQkgIHJldHVybiBuZXcgRGV2aWNlKHsKCQkJICAgIHdpZHRoTWV0ZXJzOiBtZXRlcnNQZXJQaXhlbFggKiB3aWR0aCwKCQkJICAgIGhlaWdodE1ldGVyczogbWV0ZXJzUGVyUGl4ZWxZICogaGVpZ2h0LAoJCQkgICAgYmV2ZWxNZXRlcnM6IGRldmljZVBhcmFtcy5iZXZlbE1tICogMC4wMDEKCQkJICB9KTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RGlzdG9ydGVkRmllbGRPZlZpZXdMZWZ0RXllID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKCQkJICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CgkJCSAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CgkJCSAgdmFyIGV5ZVRvU2NyZWVuRGlzdGFuY2UgPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwoJCQkgIHZhciBvdXRlckRpc3QgPSAoZGV2aWNlLndpZHRoTWV0ZXJzIC0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlKSAvIDI7CgkJCSAgdmFyIGlubmVyRGlzdCA9IHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSAvIDI7CgkJCSAgdmFyIGJvdHRvbURpc3QgPSB2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnM7CgkJCSAgdmFyIHRvcERpc3QgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC0gYm90dG9tRGlzdDsKCQkJICB2YXIgb3V0ZXJBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydChvdXRlckRpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CgkJCSAgdmFyIGlubmVyQW5nbGUgPSByYWRUb0RlZyAqIE1hdGguYXRhbihkaXN0b3J0aW9uLmRpc3RvcnQoaW5uZXJEaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwoJCQkgIHZhciBib3R0b21BbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydChib3R0b21EaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwoJCQkgIHZhciB0b3BBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydCh0b3BEaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwoJCQkgIHJldHVybiB7CgkJCSAgICBsZWZ0RGVncmVlczogTWF0aC5taW4ob3V0ZXJBbmdsZSwgdmlld2VyLmZvdiksCgkJCSAgICByaWdodERlZ3JlZXM6IE1hdGgubWluKGlubmVyQW5nbGUsIHZpZXdlci5mb3YpLAoJCQkgICAgZG93bkRlZ3JlZXM6IE1hdGgubWluKGJvdHRvbUFuZ2xlLCB2aWV3ZXIuZm92KSwKCQkJICAgIHVwRGVncmVlczogTWF0aC5taW4odG9wQW5nbGUsIHZpZXdlci5mb3YpCgkJCSAgfTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0TGVmdEV5ZVZpc2libGVUYW5BbmdsZXMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwoJCQkgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKCQkJICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKCQkJICB2YXIgZm92TGVmdCA9IE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpOwoJCQkgIHZhciBmb3ZUb3AgPSBNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpOwoJCQkgIHZhciBmb3ZSaWdodCA9IE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdik7CgkJCSAgdmFyIGZvdkJvdHRvbSA9IE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpOwoJCQkgIHZhciBoYWxmV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyA0OwoJCQkgIHZhciBoYWxmSGVpZ2h0ID0gZGV2aWNlLmhlaWdodE1ldGVycyAvIDI7CgkJCSAgdmFyIHZlcnRpY2FsTGVuc09mZnNldCA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVycyAtIGhhbGZIZWlnaHQ7CgkJCSAgdmFyIGNlbnRlclggPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC0gaGFsZldpZHRoOwoJCQkgIHZhciBjZW50ZXJZID0gLXZlcnRpY2FsTGVuc09mZnNldDsKCQkJICB2YXIgY2VudGVyWiA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CgkJCSAgdmFyIHNjcmVlbkxlZnQgPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclggLSBoYWxmV2lkdGgpIC8gY2VudGVyWik7CgkJCSAgdmFyIHNjcmVlblRvcCA9IGRpc3RvcnRpb24uZGlzdG9ydCgoY2VudGVyWSArIGhhbGZIZWlnaHQpIC8gY2VudGVyWik7CgkJCSAgdmFyIHNjcmVlblJpZ2h0ID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJYICsgaGFsZldpZHRoKSAvIGNlbnRlclopOwoJCQkgIHZhciBzY3JlZW5Cb3R0b20gPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclkgLSBoYWxmSGVpZ2h0KSAvIGNlbnRlclopOwoJCQkgIHZhciByZXN1bHQgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwoJCQkgIHJlc3VsdFswXSA9IE1hdGgubWF4KGZvdkxlZnQsIHNjcmVlbkxlZnQpOwoJCQkgIHJlc3VsdFsxXSA9IE1hdGgubWluKGZvdlRvcCwgc2NyZWVuVG9wKTsKCQkJICByZXN1bHRbMl0gPSBNYXRoLm1pbihmb3ZSaWdodCwgc2NyZWVuUmlnaHQpOwoJCQkgIHJlc3VsdFszXSA9IE1hdGgubWF4KGZvdkJvdHRvbSwgc2NyZWVuQm90dG9tKTsKCQkJICByZXR1cm4gcmVzdWx0OwoJCQl9OwoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRMZWZ0RXllTm9MZW5zVGFuQW5nbGVzID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKCQkJICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CgkJCSAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CgkJCSAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CgkJCSAgdmFyIGZvdkxlZnQgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKCQkJICB2YXIgZm92VG9wID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKCQkJICB2YXIgZm92UmlnaHQgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdikpOwoJCQkgIHZhciBmb3ZCb3R0b20gPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKCQkJICB2YXIgaGFsZldpZHRoID0gZGV2aWNlLndpZHRoTWV0ZXJzIC8gNDsKCQkJICB2YXIgaGFsZkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyAyOwoJCQkgIHZhciB2ZXJ0aWNhbExlbnNPZmZzZXQgPSB2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnMgLSBoYWxmSGVpZ2h0OwoJCQkgIHZhciBjZW50ZXJYID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMiAtIGhhbGZXaWR0aDsKCQkJICB2YXIgY2VudGVyWSA9IC12ZXJ0aWNhbExlbnNPZmZzZXQ7CgkJCSAgdmFyIGNlbnRlclogPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwoJCQkgIHZhciBzY3JlZW5MZWZ0ID0gKGNlbnRlclggLSBoYWxmV2lkdGgpIC8gY2VudGVyWjsKCQkJICB2YXIgc2NyZWVuVG9wID0gKGNlbnRlclkgKyBoYWxmSGVpZ2h0KSAvIGNlbnRlclo7CgkJCSAgdmFyIHNjcmVlblJpZ2h0ID0gKGNlbnRlclggKyBoYWxmV2lkdGgpIC8gY2VudGVyWjsKCQkJICB2YXIgc2NyZWVuQm90dG9tID0gKGNlbnRlclkgLSBoYWxmSGVpZ2h0KSAvIGNlbnRlclo7CgkJCSAgcmVzdWx0WzBdID0gTWF0aC5tYXgoZm92TGVmdCwgc2NyZWVuTGVmdCk7CgkJCSAgcmVzdWx0WzFdID0gTWF0aC5taW4oZm92VG9wLCBzY3JlZW5Ub3ApOwoJCQkgIHJlc3VsdFsyXSA9IE1hdGgubWluKGZvdlJpZ2h0LCBzY3JlZW5SaWdodCk7CgkJCSAgcmVzdWx0WzNdID0gTWF0aC5tYXgoZm92Qm90dG9tLCBzY3JlZW5Cb3R0b20pOwoJCQkgIHJldHVybiByZXN1bHQ7CgkJCX07CgkJCURldmljZUluZm8ucHJvdG90eXBlLmdldExlZnRFeWVWaXNpYmxlU2NyZWVuUmVjdCA9IGZ1bmN0aW9uICh1bmRpc3RvcnRlZEZydXN0dW0pIHsKCQkJICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CgkJCSAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwoJCQkgIHZhciBkaXN0ID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKCQkJICB2YXIgZXllWCA9IChkZXZpY2Uud2lkdGhNZXRlcnMgLSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UpIC8gMjsKCQkJICB2YXIgZXllWSA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVyczsKCQkJICB2YXIgbGVmdCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMF0gKiBkaXN0ICsgZXllWCkgLyBkZXZpY2Uud2lkdGhNZXRlcnM7CgkJCSAgdmFyIHRvcCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMV0gKiBkaXN0ICsgZXllWSkgLyBkZXZpY2UuaGVpZ2h0TWV0ZXJzOwoJCQkgIHZhciByaWdodCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMl0gKiBkaXN0ICsgZXllWCkgLyBkZXZpY2Uud2lkdGhNZXRlcnM7CgkJCSAgdmFyIGJvdHRvbSA9ICh1bmRpc3RvcnRlZEZydXN0dW1bM10gKiBkaXN0ICsgZXllWSkgLyBkZXZpY2UuaGVpZ2h0TWV0ZXJzOwoJCQkgIHJldHVybiB7CgkJCSAgICB4OiBsZWZ0LAoJCQkgICAgeTogYm90dG9tLAoJCQkgICAgd2lkdGg6IHJpZ2h0IC0gbGVmdCwKCQkJICAgIGhlaWdodDogdG9wIC0gYm90dG9tCgkJCSAgfTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RmllbGRPZlZpZXdMZWZ0RXllID0gZnVuY3Rpb24gKG9wdF9pc1VuZGlzdG9ydGVkKSB7CgkJCSAgcmV0dXJuIG9wdF9pc1VuZGlzdG9ydGVkID8gdGhpcy5nZXRVbmRpc3RvcnRlZEZpZWxkT2ZWaWV3TGVmdEV5ZSgpIDogdGhpcy5nZXREaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUoKTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RmllbGRPZlZpZXdSaWdodEV5ZSA9IGZ1bmN0aW9uIChvcHRfaXNVbmRpc3RvcnRlZCkgewoJCQkgIHZhciBmb3YgPSB0aGlzLmdldEZpZWxkT2ZWaWV3TGVmdEV5ZShvcHRfaXNVbmRpc3RvcnRlZCk7CgkJCSAgcmV0dXJuIHsKCQkJICAgIGxlZnREZWdyZWVzOiBmb3YucmlnaHREZWdyZWVzLAoJCQkgICAgcmlnaHREZWdyZWVzOiBmb3YubGVmdERlZ3JlZXMsCgkJCSAgICB1cERlZ3JlZXM6IGZvdi51cERlZ3JlZXMsCgkJCSAgICBkb3duRGVncmVlczogZm92LmRvd25EZWdyZWVzCgkJCSAgfTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0VW5kaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHAgPSB0aGlzLmdldFVuZGlzdG9ydGVkUGFyYW1zXygpOwoJCQkgIHJldHVybiB7CgkJCSAgICBsZWZ0RGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC5vdXRlckRpc3QpLAoJCQkgICAgcmlnaHREZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLmlubmVyRGlzdCksCgkJCSAgICBkb3duRGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC5ib3R0b21EaXN0KSwKCQkJICAgIHVwRGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC50b3BEaXN0KQoJCQkgIH07CgkJCX07CgkJCURldmljZUluZm8ucHJvdG90eXBlLmdldFVuZGlzdG9ydGVkVmlld3BvcnRMZWZ0RXllID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBwID0gdGhpcy5nZXRVbmRpc3RvcnRlZFBhcmFtc18oKTsKCQkJICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CgkJCSAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwoJCQkgIHZhciBleWVUb1NjcmVlbkRpc3RhbmNlID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKCQkJICB2YXIgc2NyZWVuV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwoJCQkgIHZhciBzY3JlZW5IZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKCQkJICB2YXIgeFB4UGVyVGFuQW5nbGUgPSBkZXZpY2Uud2lkdGggLyBzY3JlZW5XaWR0aDsKCQkJICB2YXIgeVB4UGVyVGFuQW5nbGUgPSBkZXZpY2UuaGVpZ2h0IC8gc2NyZWVuSGVpZ2h0OwoJCQkgIHZhciB4ID0gTWF0aC5yb3VuZCgocC5leWVQb3NYIC0gcC5vdXRlckRpc3QpICogeFB4UGVyVGFuQW5nbGUpOwoJCQkgIHZhciB5ID0gTWF0aC5yb3VuZCgocC5leWVQb3NZIC0gcC5ib3R0b21EaXN0KSAqIHlQeFBlclRhbkFuZ2xlKTsKCQkJICByZXR1cm4gewoJCQkgICAgeDogeCwKCQkJICAgIHk6IHksCgkJCSAgICB3aWR0aDogTWF0aC5yb3VuZCgocC5leWVQb3NYICsgcC5pbm5lckRpc3QpICogeFB4UGVyVGFuQW5nbGUpIC0geCwKCQkJICAgIGhlaWdodDogTWF0aC5yb3VuZCgocC5leWVQb3NZICsgcC50b3BEaXN0KSAqIHlQeFBlclRhbkFuZ2xlKSAtIHkKCQkJICB9OwoJCQl9OwoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRVbmRpc3RvcnRlZFBhcmFtc18gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwoJCQkgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKCQkJICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKCQkJICB2YXIgZXllVG9TY3JlZW5EaXN0YW5jZSA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CgkJCSAgdmFyIGhhbGZMZW5zRGlzdGFuY2UgPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKCQkJICB2YXIgc2NyZWVuV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwoJCQkgIHZhciBzY3JlZW5IZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKCQkJICB2YXIgZXllUG9zWCA9IHNjcmVlbldpZHRoIC8gMiAtIGhhbGZMZW5zRGlzdGFuY2U7CgkJCSAgdmFyIGV5ZVBvc1kgPSAodmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzKSAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CgkJCSAgdmFyIG1heEZvdiA9IHZpZXdlci5mb3Y7CgkJCSAgdmFyIHZpZXdlck1heCA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oZGVnVG9SYWQgKiBtYXhGb3YpKTsKCQkJICB2YXIgb3V0ZXJEaXN0ID0gTWF0aC5taW4oZXllUG9zWCwgdmlld2VyTWF4KTsKCQkJICB2YXIgaW5uZXJEaXN0ID0gTWF0aC5taW4oaGFsZkxlbnNEaXN0YW5jZSwgdmlld2VyTWF4KTsKCQkJICB2YXIgYm90dG9tRGlzdCA9IE1hdGgubWluKGV5ZVBvc1ksIHZpZXdlck1heCk7CgkJCSAgdmFyIHRvcERpc3QgPSBNYXRoLm1pbihzY3JlZW5IZWlnaHQgLSBleWVQb3NZLCB2aWV3ZXJNYXgpOwoJCQkgIHJldHVybiB7CgkJCSAgICBvdXRlckRpc3Q6IG91dGVyRGlzdCwKCQkJICAgIGlubmVyRGlzdDogaW5uZXJEaXN0LAoJCQkgICAgdG9wRGlzdDogdG9wRGlzdCwKCQkJICAgIGJvdHRvbURpc3Q6IGJvdHRvbURpc3QsCgkJCSAgICBleWVQb3NYOiBleWVQb3NYLAoJCQkgICAgZXllUG9zWTogZXllUG9zWQoJCQkgIH07CgkJCX07CgkJCWZ1bmN0aW9uIENhcmRib2FyZFZpZXdlcihwYXJhbXMpIHsKCQkJICB0aGlzLmlkID0gcGFyYW1zLmlkOwoJCQkgIHRoaXMubGFiZWwgPSBwYXJhbXMubGFiZWw7CgkJCSAgdGhpcy5mb3YgPSBwYXJhbXMuZm92OwoJCQkgIHRoaXMuaW50ZXJMZW5zRGlzdGFuY2UgPSBwYXJhbXMuaW50ZXJMZW5zRGlzdGFuY2U7CgkJCSAgdGhpcy5iYXNlbGluZUxlbnNEaXN0YW5jZSA9IHBhcmFtcy5iYXNlbGluZUxlbnNEaXN0YW5jZTsKCQkJICB0aGlzLnNjcmVlbkxlbnNEaXN0YW5jZSA9IHBhcmFtcy5zY3JlZW5MZW5zRGlzdGFuY2U7CgkJCSAgdGhpcy5kaXN0b3J0aW9uQ29lZmZpY2llbnRzID0gcGFyYW1zLmRpc3RvcnRpb25Db2VmZmljaWVudHM7CgkJCSAgdGhpcy5pbnZlcnNlQ29lZmZpY2llbnRzID0gcGFyYW1zLmludmVyc2VDb2VmZmljaWVudHM7CgkJCX0KCQkJRGV2aWNlSW5mby5WaWV3ZXJzID0gVmlld2VyczsKCQkJdmFyIGZvcm1hdCA9IDE7CgkJCXZhciBsYXN0X3VwZGF0ZWQgPSAiMjAxOS0xMS0wOVQxNzozNjoxNFoiOwoJCQl2YXIgZGV2aWNlcyA9IFt7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJhc3VzLyovTmV4dXMgNy8qIn0seyJ1YSI6Ik5leHVzIDcifV0sImRwaSI6WzMyMC44LDMyM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJhc3VzLyovQVNVU19YMDBQRC8qIn0seyJ1YSI6IkFTVVNfWDAwUEQifV0sImRwaSI6MjQ1LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiYXN1cy8qL0FTVVNfWDAwOEQvKiJ9LHsidWEiOiJBU1VTX1gwMDhEIn1dLCJkcGkiOjI4MiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9BU1VTX1owMEFELyoifSx7InVhIjoiQVNVU19aMDBBRCJ9XSwiZHBpIjpbNDAzLDQwNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAyIFhMLyoifSx7InVhIjoiUGl4ZWwgMiBYTCJ9XSwiZHBpIjo1MzcuOSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAzIFhMLyoifSx7InVhIjoiUGl4ZWwgMyBYTCJ9XSwiZHBpIjpbNTU4LjUsNTUzLjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIFhMLyoifSx7InVhIjoiUGl4ZWwgWEwifV0sImRwaSI6WzUzNy45LDUzM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMy8qIn0seyJ1YSI6IlBpeGVsIDMifV0sImRwaSI6NDQyLjQsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMi8qIn0seyJ1YSI6IlBpeGVsIDIifV0sImRwaSI6NDQxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwvKiJ9LHsidWEiOiJQaXhlbCJ9XSwiZHBpIjpbNDMyLjYsNDM2LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQzY0MzVMVlcvKiJ9LHsidWEiOiJIVEM2NDM1TFZXIn1dLCJkcGkiOls0NDkuNyw0NDMuM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZSBYTC8qIn0seyJ1YSI6IkhUQyBPbmUgWEwifV0sImRwaSI6WzMxNS4zLDMxNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJodGMvKi9OZXh1cyA5LyoifSx7InVhIjoiTmV4dXMgOSJ9XSwiZHBpIjoyODksImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEMgT25lIE05LyoifSx7InVhIjoiSFRDIE9uZSBNOSJ9XSwiZHBpIjpbNDQyLjUsNDQzLjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZV9NOC8qIn0seyJ1YSI6IkhUQyBPbmVfTTgifV0sImRwaSI6WzQ0OS43LDQ0Ny40XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQyBPbmUvKiJ9LHsidWEiOiJIVEMgT25lIn1dLCJkcGkiOjQ3Mi44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikh1YXdlaS8qL05leHVzIDZQLyoifSx7InVhIjoiTmV4dXMgNlAifV0sImRwaSI6WzUxNS4xLDUxOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSHVhd2VpLyovQkxOLUwyNC8qIn0seyJ1YSI6IkhPTk9SQkxOLUwyNCJ9XSwiZHBpIjo0ODAsImJ3Ijo0LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9CS0wtTDA5LyoifSx7InVhIjoiQktMLUwwOSJ9XSwiZHBpIjo0MDMsImJ3IjozLjQ3LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMRU5PVk8vKi9MZW5vdm8gUEIyLTY5MFkvKiJ9LHsidWEiOiJMZW5vdm8gUEIyLTY5MFkifV0sImRwaSI6WzQ1Ny4yLDQ1NC43MTNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTmV4dXMgNVgvKiJ9LHsidWEiOiJOZXh1cyA1WCJ9XSwiZHBpIjpbNDIyLDQxOS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR01TMzQ1LyoifSx7InVhIjoiTEdNUzM0NSJ9XSwiZHBpIjpbMjIxLjcsMjE5LjFdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEctRDgwMC8qIn0seyJ1YSI6IkxHLUQ4MDAifV0sImRwaSI6WzQyMiw0MjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MRy1EODUwLyoifSx7InVhIjoiTEctRDg1MCJ9XSwiZHBpIjpbNTM3LjksNTQxLjldLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovVlM5ODUgNEcvKiJ9LHsidWEiOiJWUzk4NSA0RyJ9XSwiZHBpIjpbNTM3LjksNTM1LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL05leHVzIDUvKiJ9LHsidWEiOiJOZXh1cyA1IEIifV0sImRwaSI6WzQ0Mi40LDQ0NC44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9OZXh1cyA0LyoifSx7InVhIjoiTmV4dXMgNCJ9XSwiZHBpIjpbMzE5LjgsMzE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHLVA3NjkvKiJ9LHsidWEiOiJMRy1QNzY5In1dLCJkcGkiOlsyNDAuNiwyNDcuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEdNUzMyMy8qIn0seyJ1YSI6IkxHTVMzMjMifV0sImRwaSI6WzIwNi42LDIwNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR0xTOTk2LyoifSx7InVhIjoiTEdMUzk5NiJ9XSwiZHBpIjpbNDAzLjQsNDAxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik1pY3JvbWF4LyovNDU2ME1NWC8qIn0seyJ1YSI6IjQ1NjBNTVgifV0sImRwaSI6WzI0MCwyMTkuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTWljcm9tYXgvKi9BMjUwLyoifSx7InVhIjoiTWljcm9tYXggQTI1MCJ9XSwiZHBpIjpbNDgwLDQ0Ni40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJNaWNyb21heC8qL01pY3JvbWF4IEFRNDUwMS8qIn0seyJ1YSI6Ik1pY3JvbWF4IEFRNDUwMSJ9XSwiZHBpIjoyNDAsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0c1LyoifSx7InVhIjoiTW90byBHICg1KSBQbHVzIn1dLCJkcGkiOls0MDMuNCw0MDNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovRFJPSUQgUkFaUi8qIn0seyJ1YSI6IkRST0lEIFJBWlIifV0sImRwaSI6WzM2OC4xLDI1Ni43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUODMwQy8qIn0seyJ1YSI6IlhUODMwQyJ9XSwiZHBpIjpbMjU0LDI1NS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAyMS8qIn0seyJ1YSI6IlhUMTAyMSJ9XSwiZHBpIjpbMjU0LDI1Ni43XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDIzLyoifSx7InVhIjoiWFQxMDIzIn1dLCJkcGkiOlsyNTQsMjU2LjddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwMjgvKiJ9LHsidWEiOiJYVDEwMjgifV0sImRwaSI6WzMyNi42LDMyNy42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAzNC8qIn0seyJ1YSI6IlhUMTAzNCJ9XSwiZHBpIjpbMzI2LjYsMzI4LjRdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwNTMvKiJ9LHsidWEiOiJYVDEwNTMifV0sImRwaSI6WzMxNS4zLDMxNi4xXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTU2Mi8qIn0seyJ1YSI6IlhUMTU2MiJ9XSwiZHBpIjpbNDAzLjQsNDAyLjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovTmV4dXMgNi8qIn0seyJ1YSI6Ik5leHVzIDYgQiJ9XSwiZHBpIjpbNDk0LjMsNDg5LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDYzLyoifSx7InVhIjoiWFQxMDYzIn1dLCJkcGkiOlsyOTUsMjk2LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDY0LyoifSx7InVhIjoiWFQxMDY0In1dLCJkcGkiOlsyOTUsMjk1LjZdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwOTIvKiJ9LHsidWEiOiJYVDEwOTIifV0sImRwaSI6WzQyMiw0MjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA5NS8qIn0seyJ1YSI6IlhUMTA5NSJ9XSwiZHBpIjpbNDIyLDQyMy40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0c0LyoifSx7InVhIjoiTW90byBHICg0KSJ9XSwiZHBpIjo0MDEsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL0EwMDAxLyoifSx7InVhIjoiQTAwMDEifV0sImRwaSI6WzQwMy40LDQwMV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBFMTAwMS8qIn0seyJ1YSI6Ik9ORSBFMTAwMSJ9XSwiZHBpIjpbNDQyLjQsNDQxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgRTEwMDMvKiJ9LHsidWEiOiJPTkUgRTEwMDMifV0sImRwaSI6WzQ0Mi40LDQ0MS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEUxMDA1LyoifSx7InVhIjoiT05FIEUxMDA1In1dLCJkcGkiOls0NDIuNCw0NDEuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBBMjAwMS8qIn0seyJ1YSI6Ik9ORSBBMjAwMSJ9XSwiZHBpIjpbMzkxLjksNDA1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTIwMDMvKiJ9LHsidWEiOiJPTkUgQTIwMDMifV0sImRwaSI6WzM5MS45LDQwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEEyMDA1LyoifSx7InVhIjoiT05FIEEyMDA1In1dLCJkcGkiOlszOTEuOSw0MDUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTMwMDAvKiJ9LHsidWEiOiJPTkVQTFVTIEEzMDAwIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEEzMDAzLyoifSx7InVhIjoiT05FUExVUyBBMzAwMyJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBMzAxMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTMwMTAifV0sImRwaSI6NDAxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTUwMDAvKiJ9LHsidWEiOiJPTkVQTFVTIEE1MDAwICJ9XSwiZHBpIjpbNDAzLjQxMSwzOTkuNzM3XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEE1MDEwLyoifSx7InVhIjoiT05FUExVUyBBNTAxMCJ9XSwiZHBpIjpbNDAzLDQwMF0sImJ3IjoyLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTYwMDAvKiJ9LHsidWEiOiJPTkVQTFVTIEE2MDAwIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEE2MDAzLyoifSx7InVhIjoiT05FUExVUyBBNjAwMyJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNjAxMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTYwMTAifV0sImRwaSI6NDAxLCJidyI6MiwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTYwMTMvKiJ9LHsidWEiOiJPTkVQTFVTIEE2MDEzIn1dLCJkcGkiOjQwMSwiYnciOjIsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9QUE8vKi9YOTA5LyoifSx7InVhIjoiWDkwOSJ9XSwiZHBpIjpbNDQyLjQsNDQ0LjFdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTA4Mi8qIn0seyJ1YSI6IkdULUk5MDgyIn1dLCJkcGkiOlsxODQuNywxODUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUczNjBQLyoifSx7InVhIjoiU00tRzM2MFAifV0sImRwaSI6WzE5Ni43LDIwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovTmV4dXMgUy8qIn0seyJ1YSI6Ik5leHVzIFMifV0sImRwaSI6WzIzNC41LDIyOS44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkzMDAvKiJ9LHsidWEiOiJHVC1JOTMwMCJ9XSwiZHBpIjpbMzA0LjgsMzAzLjldLCJidyI6NSwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLVQyMzBOVS8qIn0seyJ1YSI6IlNNLVQyMzBOVSJ9XSwiZHBpIjoyMTYsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0dILVQzOTkvKiJ9LHsidWEiOiJTR0gtVDM5OSJ9XSwiZHBpIjpbMjE3LjcsMjMxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TR0gtTTkxOS8qIn0seyJ1YSI6IlNHSC1NOTE5In1dLCJkcGkiOls0NDAuOCw0MzcuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MDA1LyoifSx7InVhIjoiU00tTjkwMDUifV0sImRwaSI6WzM4Ni40LDM4N10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0FNU1VORy1TTS1OOTAwQS8qIn0seyJ1YSI6IlNBTVNVTkctU00tTjkwMEEifV0sImRwaSI6WzM4Ni40LDM4Ny43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTk1MDAvKiJ9LHsidWEiOiJHVC1JOTUwMCJ9XSwiZHBpIjpbNDQyLjUsNDQzLjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5NTA1LyoifSx7InVhIjoiR1QtSTk1MDUifV0sImRwaSI6NDM5LjQsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MDBGLyoifSx7InVhIjoiU00tRzkwMEYifV0sImRwaSI6WzQxNS42LDQzMS42XSwiYnciOjUsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkwME0vKiJ9LHsidWEiOiJTTS1HOTAwTSJ9XSwiZHBpIjpbNDE1LjYsNDMxLjZdLCJidyI6NSwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HODAwRi8qIn0seyJ1YSI6IlNNLUc4MDBGIn1dLCJkcGkiOjMyNi44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTA2Uy8qIn0seyJ1YSI6IlNNLUc5MDZTIn1dLCJkcGkiOls1NjIuNyw1NzIuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MzAwLyoifSx7InVhIjoiR1QtSTkzMDAifV0sImRwaSI6WzMwNi43LDMwNC44XSwiYnciOjUsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tVDUzNS8qIn0seyJ1YSI6IlNNLVQ1MzUifV0sImRwaSI6WzE0Mi42LDEzNi40XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTIwQy8qIn0seyJ1YSI6IlNNLU45MjBDIn1dLCJkcGkiOls1MTUuMSw1MTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MjBQLyoifSx7InVhIjoiU00tTjkyMFAifV0sImRwaSI6WzM4Ni4zNjU1LDM5MC4xNDRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTIwVzgvKiJ9LHsidWEiOiJTTS1OOTIwVzgifV0sImRwaSI6WzUxNS4xLDUxOC40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkzMDBJLyoifSx7InVhIjoiR1QtSTkzMDBJIn1dLCJkcGkiOlszMDQuOCwzMDUuOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MTk1LyoifSx7InVhIjoiR1QtSTkxOTUifV0sImRwaSI6WzI0OS40LDI1Ni43XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TUEgtTDUyMC8qIn0seyJ1YSI6IlNQSC1MNTIwIn1dLCJkcGkiOlsyNDkuNCwyNTUuOV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NBTVNVTkctU0dILUk3MTcvKiJ9LHsidWEiOiJTQU1TVU5HLVNHSC1JNzE3In1dLCJkcGkiOjI4NS44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TUEgtRDcxMC8qIn0seyJ1YSI6IlNQSC1ENzEwIn1dLCJkcGkiOlsyMTcuNywyMDQuMl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULU43MTAwLyoifSx7InVhIjoiR1QtTjcxMDAifV0sImRwaSI6MjY1LjEsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NDSC1JNjA1LyoifSx7InVhIjoiU0NILUk2MDUifV0sImRwaSI6MjY1LjEsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dhbGF4eSBOZXh1cy8qIn0seyJ1YSI6IkdhbGF4eSBOZXh1cyJ9XSwiZHBpIjpbMzE1LjMsMzE0LjJdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTEwSC8qIn0seyJ1YSI6IlNNLU45MTBIIn1dLCJkcGkiOls1MTUuMSw1MThdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTEwQy8qIn0seyJ1YSI6IlNNLU45MTBDIn1dLCJkcGkiOls1MTUuMiw1MjAuMl0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzEzME0vKiJ9LHsidWEiOiJTTS1HMTMwTSJ9XSwiZHBpIjpbMTY1LjksMTY0LjhdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjhJLyoifSx7InVhIjoiU00tRzkyOEkifV0sImRwaSI6WzUxNS4xLDUxOC40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyMEYvKiJ9LHsidWEiOiJTTS1HOTIwRiJ9XSwiZHBpIjo1ODAuNiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTIwUC8qIn0seyJ1YSI6IlNNLUc5MjBQIn1dLCJkcGkiOls1MjIuNSw1NzddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTI1Ri8qIn0seyJ1YSI6IlNNLUc5MjVGIn1dLCJkcGkiOjU4MC42LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjVWLyoifSx7InVhIjoiU00tRzkyNVYifV0sImRwaSI6WzUyMi41LDU3Ni42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkzMEYvKiJ9LHsidWEiOiJTTS1HOTMwRiJ9XSwiZHBpIjo1NzYuNiwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkzNUYvKiJ9LHsidWEiOiJTTS1HOTM1RiJ9XSwiZHBpIjo1MzMsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk1MEYvKiJ9LHsidWEiOiJTTS1HOTUwRiJ9XSwiZHBpIjpbNTYyLjcwNyw1NjUuMjkzXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTU1VS8qIn0seyJ1YSI6IlNNLUc5NTVVIn1dLCJkcGkiOls1MjIuNTE0LDUyNS43NjJdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NTVGLyoifSx7InVhIjoiU00tRzk1NUYifV0sImRwaSI6WzUyMi41MTQsNTI1Ljc2Ml0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MEYvKiJ9LHsidWEiOiJTTS1HOTYwRiJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjAwLyoifSx7InVhIjoiU00tRzk2MDAifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwVC8qIn0seyJ1YSI6IlNNLUc5NjBUIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2ME4vKiJ9LHsidWEiOiJTTS1HOTYwTiJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBVLyoifSx7InVhIjoiU00tRzk2MFUifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwOC8qIn0seyJ1YSI6IlNNLUc5NjA4In1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MEZELyoifSx7InVhIjoiU00tRzk2MEZEIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MFcvKiJ9LHsidWEiOiJTTS1HOTYwVyJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjVGLyoifSx7InVhIjoiU00tRzk2NUYifV0sImRwaSI6NTI5LCJidyI6MiwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9DNjkwMy8qIn0seyJ1YSI6IkM2OTAzIn1dLCJkcGkiOls0NDIuNSw0NDMuM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovRDY2NTMvKiJ9LHsidWEiOiJENjY1MyJ9XSwiZHBpIjpbNDI4LjYsNDI3LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9FNjY1My8qIn0seyJ1YSI6IkU2NjUzIn1dLCJkcGkiOls0MjguNiw0MjUuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0U2ODUzLyoifSx7InVhIjoiRTY4NTMifV0sImRwaSI6WzQwMy40LDQwMS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovU0dQMzIxLyoifSx7InVhIjoiU0dQMzIxIn1dLCJkcGkiOlsyMjQuNywyMjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJUQ1QvKi9BTENBVEVMIE9ORSBUT1VDSCBGaWVyY2UvKiJ9LHsidWEiOiJBTENBVEVMIE9ORSBUT1VDSCBGaWVyY2UifV0sImRwaSI6WzI0MCwyNDcuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiVEhMLyovdGhsIDUwMDAvKiJ9LHsidWEiOiJ0aGwgNTAwMCJ9XSwiZHBpIjpbNDgwLDQ0My4zXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJGbHkvKi9JUTQ0MTIvKiJ9LHsidWEiOiJJUTQ0MTIifV0sImRwaSI6MzA3LjksImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiWlRFLyovWlRFIEJsYWRlIEwyLyoifSx7InVhIjoiWlRFIEJsYWRlIEwyIn1dLCJkcGkiOjI0MCwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkJFTkVWRS8qL1ZSNTE4LyoifSx7InVhIjoiVlI1MTgifV0sImRwaSI6NDgwLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzY0MCw5NjBdfV0sImRwaSI6WzMyNS4xLDMyOC40XSwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbNjQwLDExMzZdfV0sImRwaSI6WzMxNy4xLDMyMC4yXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbNzUwLDEzMzRdfV0sImRwaSI6MzI2LjQsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzEyNDIsMjIwOF19XSwiZHBpIjpbNDUzLjYsNDU4LjRdLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMTI1LDIwMDFdfV0sImRwaSI6WzQxMC45LDQxNS40XSwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbMTEyNSwyNDM2XX1dLCJkcGkiOjQ1OCwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9FTUwtTDI5LyoifSx7InVhIjoiRU1MLUwyOSJ9XSwiZHBpIjo0MjgsImJ3IjozLjQ1LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJOb2tpYS8qL05va2lhIDcuMS8qIn0seyJ1YSI6Ik5va2lhIDcuMSJ9XSwiZHBpIjpbNDMyLDQzMS45XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMjQyLDI2ODhdfV0sImRwaSI6NDU4LCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HNTcwTS8qIn0seyJ1YSI6IlNNLUc1NzBNIn1dLCJkcGkiOjMyMCwiYnciOjMuNjg0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NzBGLyoifSx7InVhIjoiU00tRzk3MEYifV0sImRwaSI6NDM4LCJidyI6Mi4yODEsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTczRi8qIn0seyJ1YSI6IlNNLUc5NzNGIn1dLCJkcGkiOjU1MCwiYnciOjIuMDAyLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk3NUYvKiJ9LHsidWEiOiJTTS1HOTc1RiJ9XSwiZHBpIjo1MjIsImJ3IjoyLjA1NCwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NzdGLyoifSx7InVhIjoiU00tRzk3N0YifV0sImRwaSI6NTA1LCJidyI6Mi4zMzQsImFjIjo1MDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls4MjgsMTc5Ml19XSwiZHBpIjozMjYsImJ3Ijo1LCJhYyI6NTAwfV07CgkJCXZhciBEUERCX0NBQ0hFID0gewoJCQkJZm9ybWF0OiBmb3JtYXQsCgkJCQlsYXN0X3VwZGF0ZWQ6IGxhc3RfdXBkYXRlZCwKCQkJCWRldmljZXM6IGRldmljZXMKCQkJfTsKCQkJZnVuY3Rpb24gRHBkYih1cmwsIG9uRGV2aWNlUGFyYW1zVXBkYXRlZCkgewoJCQkgIHRoaXMuZHBkYiA9IERQREJfQ0FDSEU7CgkJCSAgdGhpcy5yZWNhbGN1bGF0ZURldmljZVBhcmFtc18oKTsKCQkJICBpZiAodXJsKSB7CgkJCSAgICB0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCA9IG9uRGV2aWNlUGFyYW1zVXBkYXRlZDsKCQkJICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQkJICAgIHZhciBvYmogPSB0aGlzOwoJCQkgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CgkJCSAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHsKCQkJICAgICAgb2JqLmxvYWRpbmcgPSBmYWxzZTsKCQkJICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPD0gMjk5KSB7CgkJCSAgICAgICAgb2JqLmRwZGIgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7CgkJCSAgICAgICAgb2JqLnJlY2FsY3VsYXRlRGV2aWNlUGFyYW1zXygpOwoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgb25saW5lIERQREIhJyk7CgkJCSAgICAgIH0KCQkJICAgIH0pOwoJCQkgICAgeGhyLnNlbmQoKTsKCQkJICB9CgkJCX0KCQkJRHBkYi5wcm90b3R5cGUuZ2V0RGV2aWNlUGFyYW1zID0gZnVuY3Rpb24gKCkgewoJCQkgIHJldHVybiB0aGlzLmRldmljZVBhcmFtczsKCQkJfTsKCQkJRHBkYi5wcm90b3R5cGUucmVjYWxjdWxhdGVEZXZpY2VQYXJhbXNfID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBuZXdEZXZpY2VQYXJhbXMgPSB0aGlzLmNhbGNEZXZpY2VQYXJhbXNfKCk7CgkJCSAgaWYgKG5ld0RldmljZVBhcmFtcykgewoJCQkgICAgdGhpcy5kZXZpY2VQYXJhbXMgPSBuZXdEZXZpY2VQYXJhbXM7CgkJCSAgICBpZiAodGhpcy5vbkRldmljZVBhcmFtc1VwZGF0ZWQpIHsKCQkJICAgICAgdGhpcy5vbkRldmljZVBhcmFtc1VwZGF0ZWQodGhpcy5kZXZpY2VQYXJhbXMpOwoJCQkgICAgfQoJCQkgIH0gZWxzZSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcmVjYWxjdWxhdGUgZGV2aWNlIHBhcmFtZXRlcnMuJyk7CgkJCSAgfQoJCQl9OwoJCQlEcGRiLnByb3RvdHlwZS5jYWxjRGV2aWNlUGFyYW1zXyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZGIgPSB0aGlzLmRwZGI7CgkJCSAgaWYgKCFkYikgewoJCQkgICAgY29uc29sZS5lcnJvcignRFBEQiBub3QgYXZhaWxhYmxlLicpOwoJCQkgICAgcmV0dXJuIG51bGw7CgkJCSAgfQoJCQkgIGlmIChkYi5mb3JtYXQgIT0gMSkgewoJCQkgICAgY29uc29sZS5lcnJvcignRFBEQiBoYXMgdW5leHBlY3RlZCBmb3JtYXQgdmVyc2lvbi4nKTsKCQkJICAgIHJldHVybiBudWxsOwoJCQkgIH0KCQkJICBpZiAoIWRiLmRldmljZXMgfHwgIWRiLmRldmljZXMubGVuZ3RoKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdEUERCIGRvZXMgbm90IGhhdmUgYSBkZXZpY2VzIHNlY3Rpb24uJyk7CgkJCSAgICByZXR1cm4gbnVsbDsKCQkJICB9CgkJCSAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7CgkJCSAgdmFyIHdpZHRoID0gZ2V0U2NyZWVuV2lkdGgoKTsKCQkJICB2YXIgaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCk7CgkJCSAgaWYgKCFkYi5kZXZpY2VzKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdEUERCIGhhcyBubyBkZXZpY2VzIHNlY3Rpb24uJyk7CgkJCSAgICByZXR1cm4gbnVsbDsKCQkJICB9CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYi5kZXZpY2VzLmxlbmd0aDsgaSsrKSB7CgkJCSAgICB2YXIgZGV2aWNlID0gZGIuZGV2aWNlc1tpXTsKCQkJICAgIGlmICghZGV2aWNlLnJ1bGVzKSB7CgkJCSAgICAgIGNvbnNvbGUud2FybignRGV2aWNlWycgKyBpICsgJ10gaGFzIG5vIHJ1bGVzIHNlY3Rpb24uJyk7CgkJCSAgICAgIGNvbnRpbnVlOwoJCQkgICAgfQoJCQkgICAgaWYgKGRldmljZS50eXBlICE9ICdpb3MnICYmIGRldmljZS50eXBlICE9ICdhbmRyb2lkJykgewoJCQkgICAgICBjb25zb2xlLndhcm4oJ0RldmljZVsnICsgaSArICddIGhhcyBpbnZhbGlkIHR5cGUuJyk7CgkJCSAgICAgIGNvbnRpbnVlOwoJCQkgICAgfQoJCQkgICAgaWYgKGlzSU9TKCkgIT0gKGRldmljZS50eXBlID09ICdpb3MnKSkgY29udGludWU7CgkJCSAgICB2YXIgbWF0Y2hlZCA9IGZhbHNlOwoJCQkgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkZXZpY2UucnVsZXMubGVuZ3RoOyBqKyspIHsKCQkJICAgICAgdmFyIHJ1bGUgPSBkZXZpY2UucnVsZXNbal07CgkJCSAgICAgIGlmICh0aGlzLnJ1bGVNYXRjaGVzXyhydWxlLCB1c2VyQWdlbnQsIHdpZHRoLCBoZWlnaHQpKSB7CgkJCSAgICAgICAgbWF0Y2hlZCA9IHRydWU7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICAgIGlmICghbWF0Y2hlZCkgY29udGludWU7CgkJCSAgICB2YXIgeGRwaSA9IGRldmljZS5kcGlbMF0gfHwgZGV2aWNlLmRwaTsKCQkJICAgIHZhciB5ZHBpID0gZGV2aWNlLmRwaVsxXSB8fCBkZXZpY2UuZHBpOwoJCQkgICAgcmV0dXJuIG5ldyBEZXZpY2VQYXJhbXMoeyB4ZHBpOiB4ZHBpLCB5ZHBpOiB5ZHBpLCBiZXZlbE1tOiBkZXZpY2UuYncgfSk7CgkJCSAgfQoJCQkgIGNvbnNvbGUud2FybignTm8gRFBEQiBkZXZpY2UgbWF0Y2guJyk7CgkJCSAgcmV0dXJuIG51bGw7CgkJCX07CgkJCURwZGIucHJvdG90eXBlLnJ1bGVNYXRjaGVzXyA9IGZ1bmN0aW9uIChydWxlLCB1YSwgc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgewoJCQkgIGlmICghcnVsZS51YSAmJiAhcnVsZS5yZXMpIHJldHVybiBmYWxzZTsKCQkJICBpZiAocnVsZS51YSAmJiBydWxlLnVhLnN1YnN0cmluZygwLCAyKSA9PT0gJ1NNJykgcnVsZS51YSA9IHJ1bGUudWEuc3Vic3RyaW5nKDAsIDcpOwoJCQkgIGlmIChydWxlLnVhICYmIHVhLmluZGV4T2YocnVsZS51YSkgPCAwKSByZXR1cm4gZmFsc2U7CgkJCSAgaWYgKHJ1bGUucmVzKSB7CgkJCSAgICBpZiAoIXJ1bGUucmVzWzBdIHx8ICFydWxlLnJlc1sxXSkgcmV0dXJuIGZhbHNlOwoJCQkgICAgdmFyIHJlc1ggPSBydWxlLnJlc1swXTsKCQkJICAgIHZhciByZXNZID0gcnVsZS5yZXNbMV07CgkJCSAgICBpZiAoTWF0aC5taW4oc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgIT0gTWF0aC5taW4ocmVzWCwgcmVzWSkgfHwgTWF0aC5tYXgoc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgIT0gTWF0aC5tYXgocmVzWCwgcmVzWSkpIHsKCQkJICAgICAgcmV0dXJuIGZhbHNlOwoJCQkgICAgfQoJCQkgIH0KCQkJICByZXR1cm4gdHJ1ZTsKCQkJfTsKCQkJZnVuY3Rpb24gRGV2aWNlUGFyYW1zKHBhcmFtcykgewoJCQkgIHRoaXMueGRwaSA9IHBhcmFtcy54ZHBpOwoJCQkgIHRoaXMueWRwaSA9IHBhcmFtcy55ZHBpOwoJCQkgIHRoaXMuYmV2ZWxNbSA9IHBhcmFtcy5iZXZlbE1tOwoJCQl9CgkJCWZ1bmN0aW9uIFNlbnNvclNhbXBsZShzYW1wbGUsIHRpbWVzdGFtcFMpIHsKCQkJICB0aGlzLnNldChzYW1wbGUsIHRpbWVzdGFtcFMpOwoJCQl9CgkJCVNlbnNvclNhbXBsZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKHNhbXBsZSwgdGltZXN0YW1wUykgewoJCQkgIHRoaXMuc2FtcGxlID0gc2FtcGxlOwoJCQkgIHRoaXMudGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CgkJCX07CgkJCVNlbnNvclNhbXBsZS5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIChzZW5zb3JTYW1wbGUpIHsKCQkJICB0aGlzLnNldChzZW5zb3JTYW1wbGUuc2FtcGxlLCBzZW5zb3JTYW1wbGUudGltZXN0YW1wUyk7CgkJCX07CgkJCWZ1bmN0aW9uIENvbXBsZW1lbnRhcnlGaWx0ZXIoa0ZpbHRlciwgaXNEZWJ1ZykgewoJCQkgIHRoaXMua0ZpbHRlciA9IGtGaWx0ZXI7CgkJCSAgdGhpcy5pc0RlYnVnID0gaXNEZWJ1ZzsKCQkJICB0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwoJCQkgIHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudCA9IG5ldyBTZW5zb3JTYW1wbGUoKTsKCQkJICB0aGlzLnByZXZpb3VzR3lyb01lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwoJCQkgIGlmIChpc0lPUygpKSB7CgkJCSAgICB0aGlzLmZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigtMSwgMCwgMCwgMSk7CgkJCSAgfSBlbHNlIHsKCQkJICAgIHRoaXMuZmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKDEsIDAsIDAsIDEpOwoJCQkgIH0KCQkJICB0aGlzLnByZXZpb3VzRmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgdGhpcy5wcmV2aW91c0ZpbHRlclEuY29weSh0aGlzLmZpbHRlclEpOwoJCQkgIHRoaXMuYWNjZWxRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCA9IGZhbHNlOwoJCQkgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eSA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgdGhpcy5tZWFzdXJlZEdyYXZpdHkgPSBuZXcgVmVjdG9yMygpOwoJCQkgIHRoaXMuZ3lyb0ludGVncmFsUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCX0KCQkJQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuYWRkQWNjZWxNZWFzdXJlbWVudCA9IGZ1bmN0aW9uICh2ZWN0b3IsIHRpbWVzdGFtcFMpIHsKCQkJICB0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50LnNldCh2ZWN0b3IsIHRpbWVzdGFtcFMpOwoJCQl9OwoJCQlDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5hZGRHeXJvTWVhc3VyZW1lbnQgPSBmdW5jdGlvbiAodmVjdG9yLCB0aW1lc3RhbXBTKSB7CgkJCSAgdGhpcy5jdXJyZW50R3lyb01lYXN1cmVtZW50LnNldCh2ZWN0b3IsIHRpbWVzdGFtcFMpOwoJCQkgIHZhciBkZWx0YVQgPSB0aW1lc3RhbXBTIC0gdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudC50aW1lc3RhbXBTOwoJCQkgIGlmIChpc1RpbWVzdGFtcERlbHRhVmFsaWQoZGVsdGFUKSkgewoJCQkgICAgdGhpcy5ydW5fKCk7CgkJCSAgfQoJCQkgIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQuY29weSh0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQpOwoJCQl9OwoJCQlDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5ydW5fID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICghdGhpcy5pc09yaWVudGF0aW9uSW5pdGlhbGl6ZWQpIHsKCQkJICAgIHRoaXMuYWNjZWxRID0gdGhpcy5hY2NlbFRvUXVhdGVybmlvbl8odGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudC5zYW1wbGUpOwoJCQkgICAgdGhpcy5wcmV2aW91c0ZpbHRlclEuY29weSh0aGlzLmFjY2VsUSk7CgkJCSAgICB0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCA9IHRydWU7CgkJCSAgICByZXR1cm47CgkJCSAgfQoJCQkgIHZhciBkZWx0YVQgPSB0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUyAtIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUzsKCQkJICB2YXIgZ3lyb0RlbHRhUSA9IHRoaXMuZ3lyb1RvUXVhdGVybmlvbkRlbHRhXyh0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQuc2FtcGxlLCBkZWx0YVQpOwoJCQkgIHRoaXMuZ3lyb0ludGVncmFsUS5tdWx0aXBseShneXJvRGVsdGFRKTsKCQkJICB0aGlzLmZpbHRlclEuY29weSh0aGlzLnByZXZpb3VzRmlsdGVyUSk7CgkJCSAgdGhpcy5maWx0ZXJRLm11bHRpcGx5KGd5cm9EZWx0YVEpOwoJCQkgIHZhciBpbnZGaWx0ZXJRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICBpbnZGaWx0ZXJRLmNvcHkodGhpcy5maWx0ZXJRKTsKCQkJICBpbnZGaWx0ZXJRLmludmVyc2UoKTsKCQkJICB0aGlzLmVzdGltYXRlZEdyYXZpdHkuc2V0KDAsIDAsIC0xKTsKCQkJICB0aGlzLmVzdGltYXRlZEdyYXZpdHkuYXBwbHlRdWF0ZXJuaW9uKGludkZpbHRlclEpOwoJCQkgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5ub3JtYWxpemUoKTsKCQkJICB0aGlzLm1lYXN1cmVkR3Jhdml0eS5jb3B5KHRoaXMuY3VycmVudEFjY2VsTWVhc3VyZW1lbnQuc2FtcGxlKTsKCQkJICB0aGlzLm1lYXN1cmVkR3Jhdml0eS5ub3JtYWxpemUoKTsKCQkJICB2YXIgZGVsdGFRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICBkZWx0YVEuc2V0RnJvbVVuaXRWZWN0b3JzKHRoaXMuZXN0aW1hdGVkR3Jhdml0eSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkpOwoJCQkgIGRlbHRhUS5pbnZlcnNlKCk7CgkJCSAgaWYgKHRoaXMuaXNEZWJ1ZykgewoJCQkgICAgY29uc29sZS5sb2coJ0RlbHRhOiAlZCBkZWcsIEdfZXN0OiAoJXMsICVzLCAlcyksIEdfbWVhczogKCVzLCAlcywgJXMpJywgcmFkVG9EZWcgKiBnZXRRdWF0ZXJuaW9uQW5nbGUoZGVsdGFRKSwgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LngudG9GaXhlZCgxKSwgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LnkudG9GaXhlZCgxKSwgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LnoudG9GaXhlZCgxKSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkueC50b0ZpeGVkKDEpLCB0aGlzLm1lYXN1cmVkR3Jhdml0eS55LnRvRml4ZWQoMSksIHRoaXMubWVhc3VyZWRHcmF2aXR5LnoudG9GaXhlZCgxKSk7CgkJCSAgfQoJCQkgIHZhciB0YXJnZXRRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0YXJnZXRRLmNvcHkodGhpcy5maWx0ZXJRKTsKCQkJICB0YXJnZXRRLm11bHRpcGx5KGRlbHRhUSk7CgkJCSAgdGhpcy5maWx0ZXJRLnNsZXJwKHRhcmdldFEsIDEgLSB0aGlzLmtGaWx0ZXIpOwoJCQkgIHRoaXMucHJldmlvdXNGaWx0ZXJRLmNvcHkodGhpcy5maWx0ZXJRKTsKCQkJfTsKCQkJQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuZ2V0T3JpZW50YXRpb24gPSBmdW5jdGlvbiAoKSB7CgkJCSAgcmV0dXJuIHRoaXMuZmlsdGVyUTsKCQkJfTsKCQkJQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuYWNjZWxUb1F1YXRlcm5pb25fID0gZnVuY3Rpb24gKGFjY2VsKSB7CgkJCSAgdmFyIG5vcm1BY2NlbCA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgbm9ybUFjY2VsLmNvcHkoYWNjZWwpOwoJCQkgIG5vcm1BY2NlbC5ub3JtYWxpemUoKTsKCQkJICB2YXIgcXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgcXVhdC5zZXRGcm9tVW5pdFZlY3RvcnMobmV3IFZlY3RvcjMoMCwgMCwgLTEpLCBub3JtQWNjZWwpOwoJCQkgIHF1YXQuaW52ZXJzZSgpOwoJCQkgIHJldHVybiBxdWF0OwoJCQl9OwoJCQlDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5neXJvVG9RdWF0ZXJuaW9uRGVsdGFfID0gZnVuY3Rpb24gKGd5cm8sIGR0KSB7CgkJCSAgdmFyIHF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIHZhciBheGlzID0gbmV3IFZlY3RvcjMoKTsKCQkJICBheGlzLmNvcHkoZ3lybyk7CgkJCSAgYXhpcy5ub3JtYWxpemUoKTsKCQkJICBxdWF0LnNldEZyb21BeGlzQW5nbGUoYXhpcywgZ3lyby5sZW5ndGgoKSAqIGR0KTsKCQkJICByZXR1cm4gcXVhdDsKCQkJfTsKCQkJZnVuY3Rpb24gUG9zZVByZWRpY3RvcihwcmVkaWN0aW9uVGltZVMsIGlzRGVidWcpIHsKCQkJICB0aGlzLnByZWRpY3Rpb25UaW1lUyA9IHByZWRpY3Rpb25UaW1lUzsKCQkJICB0aGlzLmlzRGVidWcgPSBpc0RlYnVnOwoJCQkgIHRoaXMucHJldmlvdXNRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IG51bGw7CgkJCSAgdGhpcy5kZWx0YVEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIHRoaXMub3V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCX0KCQkJUG9zZVByZWRpY3Rvci5wcm90b3R5cGUuZ2V0UHJlZGljdGlvbiA9IGZ1bmN0aW9uIChjdXJyZW50USwgZ3lybywgdGltZXN0YW1wUykgewoJCQkgIGlmICghdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMpIHsKCQkJICAgIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwoJCQkgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwoJCQkgICAgcmV0dXJuIGN1cnJlbnRROwoJCQkgIH0KCQkJICB2YXIgYXhpcyA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgYXhpcy5jb3B5KGd5cm8pOwoJCQkgIGF4aXMubm9ybWFsaXplKCk7CgkJCSAgdmFyIGFuZ3VsYXJTcGVlZCA9IGd5cm8ubGVuZ3RoKCk7CgkJCSAgaWYgKGFuZ3VsYXJTcGVlZCA8IGRlZ1RvUmFkICogMjApIHsKCQkJICAgIGlmICh0aGlzLmlzRGVidWcpIHsKCQkJICAgICAgY29uc29sZS5sb2coJ01vdmluZyBzbG93bHksIGF0ICVzIGRlZy9zOiBubyBwcmVkaWN0aW9uJywgKHJhZFRvRGVnICogYW5ndWxhclNwZWVkKS50b0ZpeGVkKDEpKTsKCQkJICAgIH0KCQkJICAgIHRoaXMub3V0US5jb3B5KGN1cnJlbnRRKTsKCQkJICAgIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwoJCQkgICAgcmV0dXJuIHRoaXMub3V0UTsKCQkJICB9CgkJCSAgdmFyIHByZWRpY3RBbmdsZSA9IGFuZ3VsYXJTcGVlZCAqIHRoaXMucHJlZGljdGlvblRpbWVTOwoJCQkgIHRoaXMuZGVsdGFRLnNldEZyb21BeGlzQW5nbGUoYXhpcywgcHJlZGljdEFuZ2xlKTsKCQkJICB0aGlzLm91dFEuY29weSh0aGlzLnByZXZpb3VzUSk7CgkJCSAgdGhpcy5vdXRRLm11bHRpcGx5KHRoaXMuZGVsdGFRKTsKCQkJICB0aGlzLnByZXZpb3VzUS5jb3B5KGN1cnJlbnRRKTsKCQkJICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CgkJCSAgcmV0dXJuIHRoaXMub3V0UTsKCQkJfTsKCQkJZnVuY3Rpb24gRnVzaW9uUG9zZVNlbnNvcihrRmlsdGVyLCBwcmVkaWN0aW9uVGltZSwgeWF3T25seSwgaXNEZWJ1ZykgewoJCQkgIHRoaXMueWF3T25seSA9IHlhd09ubHk7CgkJCSAgdGhpcy5hY2NlbGVyb21ldGVyID0gbmV3IFZlY3RvcjMoKTsKCQkJICB0aGlzLmd5cm9zY29wZSA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgdGhpcy5maWx0ZXIgPSBuZXcgQ29tcGxlbWVudGFyeUZpbHRlcihrRmlsdGVyLCBpc0RlYnVnKTsKCQkJICB0aGlzLnBvc2VQcmVkaWN0b3IgPSBuZXcgUG9zZVByZWRpY3RvcihwcmVkaWN0aW9uVGltZSwgaXNEZWJ1Zyk7CgkJCSAgdGhpcy5pc0ZpcmVmb3hBbmRyb2lkID0gaXNGaXJlZm94QW5kcm9pZCgpOwoJCQkgIHRoaXMuaXNJT1MgPSBpc0lPUygpOwoJCQkgIHZhciBjaHJvbWVWZXJzaW9uID0gZ2V0Q2hyb21lVmVyc2lvbigpOwoJCQkgIHRoaXMuaXNEZXZpY2VNb3Rpb25JblJhZGlhbnMgPSAhdGhpcy5pc0lPUyAmJiBjaHJvbWVWZXJzaW9uICYmIGNocm9tZVZlcnNpb24gPCA2NjsKCQkJICB0aGlzLmlzV2l0aG91dERldmljZU1vdGlvbiA9IGlzQ2hyb21lV2l0aG91dERldmljZU1vdGlvbigpIHx8IGlzU2FmYXJpV2l0aG91dERldmljZU1vdGlvbigpOwoJCQkgIHRoaXMuZmlsdGVyVG9Xb3JsZFEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIGlmIChpc0lPUygpKSB7CgkJCSAgICB0aGlzLmZpbHRlclRvV29ybGRRLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMSwgMCwgMCksIE1hdGguUEkgLyAyKTsKCQkJICB9IGVsc2UgewoJCQkgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDEsIDAsIDApLCAtTWF0aC5QSSAvIDIpOwoJCQkgIH0KCQkJICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgdGhpcy53b3JsZFRvU2NyZWVuUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgdGhpcy5vcmlnaW5hbFBvc2VBZGp1c3RRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLm9yaWdpbmFsUG9zZUFkanVzdFEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgLXdpbmRvdy5vcmllbnRhdGlvbiAqIE1hdGguUEkgLyAxODApOwoJCQkgIHRoaXMuc2V0U2NyZWVuVHJhbnNmb3JtXygpOwoJCQkgIGlmIChpc0xhbmRzY2FwZU1vZGUoKSkgewoJCQkgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5tdWx0aXBseSh0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSk7CgkJCSAgfQoJCQkgIHRoaXMucmVzZXRRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLm9yaWVudGF0aW9uT3V0XyA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CgkJCSAgdGhpcy5zdGFydCgpOwoJCQl9CgkJCUZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLmdldFBvc2l0aW9uID0gZnVuY3Rpb24gKCkgewoJCQkgIHJldHVybiBudWxsOwoJCQl9OwoJCQlGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5nZXRPcmllbnRhdGlvbiA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgb3JpZW50YXRpb24gPSB2b2lkIDA7CgkJCSAgaWYgKHRoaXMuaXNXaXRob3V0RGV2aWNlTW90aW9uICYmIHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSkgewoJCQkgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpeFEgPSB0aGlzLmRldmljZU9yaWVudGF0aW9uRml4USB8fCBmdW5jdGlvbiAoKSB7CgkJCSAgICAgIHZhciB6ID0gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIC0xKSwgMCk7CgkJCSAgICAgIHZhciB5ID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICAgICAgaWYgKHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gLTkwKSB7CgkJCSAgICAgICAgeS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDEsIDApLCBNYXRoLlBJIC8gLTIpOwoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIHkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAxLCAwKSwgTWF0aC5QSSAvIDIpOwoJCQkgICAgICB9CgkJCSAgICAgIHJldHVybiB6Lm11bHRpcGx5KHkpOwoJCQkgICAgfSgpOwoJCQkgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpbHRlclRvV29ybGRRID0gdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpbHRlclRvV29ybGRRIHx8IGZ1bmN0aW9uICgpIHsKCQkJICAgICAgdmFyIHEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgICAgICBxLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMSwgMCwgMCksIC1NYXRoLlBJIC8gMik7CgkJCSAgICAgIHJldHVybiBxOwoJCQkgICAgfSgpOwoJCQkgICAgb3JpZW50YXRpb24gPSB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblE7CgkJCSAgICB2YXIgb3V0ID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICAgIG91dC5jb3B5KG9yaWVudGF0aW9uKTsKCQkJICAgIG91dC5tdWx0aXBseSh0aGlzLmRldmljZU9yaWVudGF0aW9uRmlsdGVyVG9Xb3JsZFEpOwoJCQkgICAgb3V0Lm11bHRpcGx5KHRoaXMucmVzZXRRKTsKCQkJICAgIG91dC5tdWx0aXBseSh0aGlzLndvcmxkVG9TY3JlZW5RKTsKCQkJICAgIG91dC5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaXhRLCBvdXQpOwoJCQkgICAgaWYgKHRoaXMueWF3T25seSkgewoJCQkgICAgICBvdXQueCA9IDA7CgkJCSAgICAgIG91dC56ID0gMDsKCQkJICAgICAgb3V0Lm5vcm1hbGl6ZSgpOwoJCQkgICAgfQoJCQkgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMF0gPSBvdXQueDsKCQkJICAgIHRoaXMub3JpZW50YXRpb25PdXRfWzFdID0gb3V0Lnk7CgkJCSAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1syXSA9IG91dC56OwoJCQkgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bM10gPSBvdXQudzsKCQkJICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uT3V0XzsKCQkJICB9IGVsc2UgewoJCQkgICAgdmFyIGZpbHRlck9yaWVudGF0aW9uID0gdGhpcy5maWx0ZXIuZ2V0T3JpZW50YXRpb24oKTsKCQkJICAgIG9yaWVudGF0aW9uID0gdGhpcy5wb3NlUHJlZGljdG9yLmdldFByZWRpY3Rpb24oZmlsdGVyT3JpZW50YXRpb24sIHRoaXMuZ3lyb3Njb3BlLCB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyk7CgkJCSAgfQoJCQkgIHZhciBvdXQgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIG91dC5jb3B5KHRoaXMuZmlsdGVyVG9Xb3JsZFEpOwoJCQkgIG91dC5tdWx0aXBseSh0aGlzLnJlc2V0USk7CgkJCSAgb3V0Lm11bHRpcGx5KG9yaWVudGF0aW9uKTsKCQkJICBvdXQubXVsdGlwbHkodGhpcy53b3JsZFRvU2NyZWVuUSk7CgkJCSAgaWYgKHRoaXMueWF3T25seSkgewoJCQkgICAgb3V0LnggPSAwOwoJCQkgICAgb3V0LnogPSAwOwoJCQkgICAgb3V0Lm5vcm1hbGl6ZSgpOwoJCQkgIH0KCQkJICB0aGlzLm9yaWVudGF0aW9uT3V0X1swXSA9IG91dC54OwoJCQkgIHRoaXMub3JpZW50YXRpb25PdXRfWzFdID0gb3V0Lnk7CgkJCSAgdGhpcy5vcmllbnRhdGlvbk91dF9bMl0gPSBvdXQuejsKCQkJICB0aGlzLm9yaWVudGF0aW9uT3V0X1szXSA9IG91dC53OwoJCQkgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uT3V0XzsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUucmVzZXRQb3NlID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMucmVzZXRRLmNvcHkodGhpcy5maWx0ZXIuZ2V0T3JpZW50YXRpb24oKSk7CgkJCSAgdGhpcy5yZXNldFEueCA9IDA7CgkJCSAgdGhpcy5yZXNldFEueSA9IDA7CgkJCSAgdGhpcy5yZXNldFEueiAqPSAtMTsKCQkJICB0aGlzLnJlc2V0US5ub3JtYWxpemUoKTsKCQkJICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkpIHsKCQkJICAgIHRoaXMucmVzZXRRLm11bHRpcGx5KHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RKTsKCQkJICB9CgkJCSAgdGhpcy5yZXNldFEubXVsdGlwbHkodGhpcy5vcmlnaW5hbFBvc2VBZGp1c3RRKTsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25EZXZpY2VPcmllbnRhdGlvbl8gPSBmdW5jdGlvbiAoZSkgewoJCQkgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSA9IHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSB8fCBuZXcgUXVhdGVybmlvbigpOwoJCQkgIHZhciBhbHBoYSA9IGUuYWxwaGEsCgkJCSAgICAgIGJldGEgPSBlLmJldGEsCgkJCSAgICAgIGdhbW1hID0gZS5nYW1tYTsKCQkJICBhbHBoYSA9IChhbHBoYSB8fCAwKSAqIE1hdGguUEkgLyAxODA7CgkJCSAgYmV0YSA9IChiZXRhIHx8IDApICogTWF0aC5QSSAvIDE4MDsKCQkJICBnYW1tYSA9IChnYW1tYSB8fCAwKSAqIE1hdGguUEkgLyAxODA7CgkJCSAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25RLnNldEZyb21FdWxlcllYWihiZXRhLCBhbHBoYSwgLWdhbW1hKTsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25EZXZpY2VNb3Rpb25fID0gZnVuY3Rpb24gKGRldmljZU1vdGlvbikgewoJCQkgIHRoaXMudXBkYXRlRGV2aWNlTW90aW9uXyhkZXZpY2VNb3Rpb24pOwoJCQl9OwoJCQlGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS51cGRhdGVEZXZpY2VNb3Rpb25fID0gZnVuY3Rpb24gKGRldmljZU1vdGlvbikgewoJCQkgIHZhciBhY2NHcmF2aXR5ID0gZGV2aWNlTW90aW9uLmFjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHk7CgkJCSAgdmFyIHJvdFJhdGUgPSBkZXZpY2VNb3Rpb24ucm90YXRpb25SYXRlOwoJCQkgIHZhciB0aW1lc3RhbXBTID0gZGV2aWNlTW90aW9uLnRpbWVTdGFtcCAvIDEwMDA7CgkJCSAgdmFyIGRlbHRhUyA9IHRpbWVzdGFtcFMgLSB0aGlzLnByZXZpb3VzVGltZXN0YW1wUzsKCQkJICBpZiAoZGVsdGFTIDwgMCkgewoJCQkgICAgd2Fybk9uY2UoJ2Z1c2lvbi1wb3NlLXNlbnNvcjppbnZhbGlkOm5vbi1tb25vdG9uaWMnLCAnSW52YWxpZCB0aW1lc3RhbXBzIGRldGVjdGVkOiBub24tbW9ub3RvbmljIHRpbWVzdGFtcCBmcm9tIGRldmljZW1vdGlvbicpOwoJCQkgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwoJCQkgICAgcmV0dXJuOwoJCQkgIH0gZWxzZSBpZiAoZGVsdGFTIDw9IE1JTl9USU1FU1RFUCB8fCBkZWx0YVMgPiBNQVhfVElNRVNURVApIHsKCQkJICAgIHdhcm5PbmNlKCdmdXNpb24tcG9zZS1zZW5zb3I6aW52YWxpZDpvdXRzaWRlLXRocmVzaG9sZCcsICdJbnZhbGlkIHRpbWVzdGFtcHMgZGV0ZWN0ZWQ6IFRpbWVzdGFtcCBmcm9tIGRldmljZW1vdGlvbiBvdXRzaWRlIGV4cGVjdGVkIHJhbmdlLicpOwoJCQkgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB0aGlzLmFjY2VsZXJvbWV0ZXIuc2V0KC1hY2NHcmF2aXR5LngsIC1hY2NHcmF2aXR5LnksIC1hY2NHcmF2aXR5LnopOwoJCQkgIGlmIChyb3RSYXRlKSB7CgkJCSAgICBpZiAoaXNSNygpKSB7CgkJCSAgICAgIHRoaXMuZ3lyb3Njb3BlLnNldCgtcm90UmF0ZS5iZXRhLCByb3RSYXRlLmFscGhhLCByb3RSYXRlLmdhbW1hKTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMuZ3lyb3Njb3BlLnNldChyb3RSYXRlLmFscGhhLCByb3RSYXRlLmJldGEsIHJvdFJhdGUuZ2FtbWEpOwoJCQkgICAgfQoJCQkgICAgaWYgKCF0aGlzLmlzRGV2aWNlTW90aW9uSW5SYWRpYW5zKSB7CgkJCSAgICAgIHRoaXMuZ3lyb3Njb3BlLm11bHRpcGx5U2NhbGFyKE1hdGguUEkgLyAxODApOwoJCQkgICAgfQoJCQkgICAgdGhpcy5maWx0ZXIuYWRkR3lyb01lYXN1cmVtZW50KHRoaXMuZ3lyb3Njb3BlLCB0aW1lc3RhbXBTKTsKCQkJICB9CgkJCSAgdGhpcy5maWx0ZXIuYWRkQWNjZWxNZWFzdXJlbWVudCh0aGlzLmFjY2VsZXJvbWV0ZXIsIHRpbWVzdGFtcFMpOwoJCQkgIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gdGltZXN0YW1wUzsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25PcmllbnRhdGlvbkNoYW5nZV8gPSBmdW5jdGlvbiAoc2NyZWVuT3JpZW50YXRpb24pIHsKCQkJICB0aGlzLnNldFNjcmVlblRyYW5zZm9ybV8oKTsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25NZXNzYWdlXyA9IGZ1bmN0aW9uIChldmVudCkgewoJCQkgIHZhciBtZXNzYWdlID0gZXZlbnQuZGF0YTsKCQkJICBpZiAoIW1lc3NhZ2UgfHwgIW1lc3NhZ2UudHlwZSkgewoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB2YXIgdHlwZSA9IG1lc3NhZ2UudHlwZS50b0xvd2VyQ2FzZSgpOwoJCQkgIGlmICh0eXBlICE9PSAnZGV2aWNlbW90aW9uJykgewoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB0aGlzLnVwZGF0ZURldmljZU1vdGlvbl8obWVzc2FnZS5kZXZpY2VNb3Rpb25FdmVudCk7CgkJCX07CgkJCUZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnNldFNjcmVlblRyYW5zZm9ybV8gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdGhpcy53b3JsZFRvU2NyZWVuUS5zZXQoMCwgMCwgMCwgMSk7CgkJCSAgc3dpdGNoICh3aW5kb3cub3JpZW50YXRpb24pIHsKCQkJICAgIGNhc2UgMDoKCQkJICAgICAgYnJlYWs7CgkJCSAgICBjYXNlIDkwOgoJCQkgICAgICB0aGlzLndvcmxkVG9TY3JlZW5RLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMCwgMCwgMSksIC1NYXRoLlBJIC8gMik7CgkJCSAgICAgIGJyZWFrOwoJCQkgICAgY2FzZSAtOTA6CgkJCSAgICAgIHRoaXMud29ybGRUb1NjcmVlblEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgTWF0aC5QSSAvIDIpOwoJCQkgICAgICBicmVhazsKCQkJICB9CgkJCSAgdGhpcy5pbnZlcnNlV29ybGRUb1NjcmVlblEuY29weSh0aGlzLndvcmxkVG9TY3JlZW5RKTsKCQkJICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUS5pbnZlcnNlKCk7CgkJCX07CgkJCUZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMub25EZXZpY2VNb3Rpb25DYWxsYmFja18gPSB0aGlzLm9uRGV2aWNlTW90aW9uXy5iaW5kKHRoaXMpOwoJCQkgIHRoaXMub25PcmllbnRhdGlvbkNoYW5nZUNhbGxiYWNrXyA9IHRoaXMub25PcmllbnRhdGlvbkNoYW5nZV8uYmluZCh0aGlzKTsKCQkJICB0aGlzLm9uTWVzc2FnZUNhbGxiYWNrXyA9IHRoaXMub25NZXNzYWdlXy5iaW5kKHRoaXMpOwoJCQkgIHRoaXMub25EZXZpY2VPcmllbnRhdGlvbkNhbGxiYWNrXyA9IHRoaXMub25EZXZpY2VPcmllbnRhdGlvbl8uYmluZCh0aGlzKTsKCQkJICBpZiAoaXNJT1MoKSAmJiBpc0luc2lkZUNyb3NzT3JpZ2luSUZyYW1lKCkpIHsKCQkJICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbk1lc3NhZ2VDYWxsYmFja18pOwoJCQkgIH0KCQkJICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VDYWxsYmFja18pOwoJCQkgIGlmICh0aGlzLmlzV2l0aG91dERldmljZU1vdGlvbikgewoJCQkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfKTsKCQkJICB9IGVsc2UgewoJCQkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW1vdGlvbicsIHRoaXMub25EZXZpY2VNb3Rpb25DYWxsYmFja18pOwoJCQkgIH0KCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHsKCQkJICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyk7CgkJCSAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfKTsKCQkJICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VDYWxsYmFja18pOwoJCQkgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbk1lc3NhZ2VDYWxsYmFja18pOwoJCQl9OwoJCQl2YXIgU0VOU09SX0ZSRVFVRU5DWSA9IDYwOwoJCQl2YXIgWF9BWElTID0gbmV3IFZlY3RvcjMoMSwgMCwgMCk7CgkJCXZhciBaX0FYSVMgPSBuZXcgVmVjdG9yMygwLCAwLCAxKTsKCQkJdmFyIFNFTlNPUl9UT19WUiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCVNFTlNPUl9UT19WUi5zZXRGcm9tQXhpc0FuZ2xlKFhfQVhJUywgLU1hdGguUEkgLyAyKTsKCQkJU0VOU09SX1RPX1ZSLm11bHRpcGx5KG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShaX0FYSVMsIE1hdGguUEkgLyAyKSk7CgkJCXZhciBQb3NlU2Vuc29yID0gZnVuY3Rpb24gKCkgewoJCQkgIGZ1bmN0aW9uIFBvc2VTZW5zb3IoY29uZmlnKSB7CgkJCSAgICBjbGFzc0NhbGxDaGVjayh0aGlzLCBQb3NlU2Vuc29yKTsKCQkJICAgIHRoaXMuY29uZmlnID0gY29uZmlnOwoJCQkgICAgdGhpcy5zZW5zb3IgPSBudWxsOwoJCQkgICAgdGhpcy5mdXNpb25TZW5zb3IgPSBudWxsOwoJCQkgICAgdGhpcy5fb3V0ID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKCQkJICAgIHRoaXMuYXBpID0gbnVsbDsKCQkJICAgIHRoaXMuZXJyb3JzID0gW107CgkJCSAgICB0aGlzLl9zZW5zb3JRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICAgIHRoaXMuX291dFEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgICAgdGhpcy5fb25TZW5zb3JSZWFkID0gdGhpcy5fb25TZW5zb3JSZWFkLmJpbmQodGhpcyk7CgkJCSAgICB0aGlzLl9vblNlbnNvckVycm9yID0gdGhpcy5fb25TZW5zb3JFcnJvci5iaW5kKHRoaXMpOwoJCQkgICAgdGhpcy5pbml0KCk7CgkJCSAgfQoJCQkgIGNyZWF0ZUNsYXNzKFBvc2VTZW5zb3IsIFt7CgkJCSAgICBrZXk6ICdpbml0JywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KCkgewoJCQkgICAgICB2YXIgc2Vuc29yID0gbnVsbDsKCQkJICAgICAgdHJ5IHsKCQkJICAgICAgICBzZW5zb3IgPSBuZXcgUmVsYXRpdmVPcmllbnRhdGlvblNlbnNvcih7CgkJCSAgICAgICAgICBmcmVxdWVuY3k6IFNFTlNPUl9GUkVRVUVOQ1ksCgkJCSAgICAgICAgICByZWZlcmVuY2VGcmFtZTogJ3NjcmVlbicKCQkJICAgICAgICB9KTsKCQkJICAgICAgICBzZW5zb3IuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLl9vblNlbnNvckVycm9yKTsKCQkJICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKCQkJICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGVycm9yKTsKCQkJICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1NlY3VyaXR5RXJyb3InKSB7CgkJCSAgICAgICAgICBjb25zb2xlLmVycm9yKCdDYW5ub3QgY29uc3RydWN0IHNlbnNvcnMgZHVlIHRvIHRoZSBGZWF0dXJlIFBvbGljeScpOwoJCQkgICAgICAgICAgY29uc29sZS53YXJuKCdBdHRlbXB0aW5nIHRvIGZhbGwgYmFjayB1c2luZyAiZGV2aWNlbW90aW9uIjsgaG93ZXZlciB0aGlzIHdpbGwgJyArICdmYWlsIGluIHRoZSBmdXR1cmUgd2l0aG91dCBjb3JyZWN0IHBlcm1pc3Npb25zLicpOwoJCQkgICAgICAgICAgdGhpcy51c2VEZXZpY2VNb3Rpb24oKTsKCQkJICAgICAgICB9IGVsc2UgaWYgKGVycm9yLm5hbWUgPT09ICdSZWZlcmVuY2VFcnJvcicpIHsKCQkJICAgICAgICAgIHRoaXMudXNlRGV2aWNlTW90aW9uKCk7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkgICAgICAgIH0KCQkJICAgICAgfQoJCQkgICAgICBpZiAoc2Vuc29yKSB7CgkJCSAgICAgICAgdGhpcy5hcGkgPSAnc2Vuc29yJzsKCQkJICAgICAgICB0aGlzLnNlbnNvciA9IHNlbnNvcjsKCQkJICAgICAgICB0aGlzLnNlbnNvci5hZGRFdmVudExpc3RlbmVyKCdyZWFkaW5nJywgdGhpcy5fb25TZW5zb3JSZWFkKTsKCQkJICAgICAgICB0aGlzLnNlbnNvci5zdGFydCgpOwoJCQkgICAgICB9CgkJCSAgICB9CgkJCSAgfSwgewoJCQkgICAga2V5OiAndXNlRGV2aWNlTW90aW9uJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiB1c2VEZXZpY2VNb3Rpb24oKSB7CgkJCSAgICAgIHRoaXMuYXBpID0gJ2RldmljZW1vdGlvbic7CgkJCSAgICAgIHRoaXMuZnVzaW9uU2Vuc29yID0gbmV3IEZ1c2lvblBvc2VTZW5zb3IodGhpcy5jb25maWcuS19GSUxURVIsIHRoaXMuY29uZmlnLlBSRURJQ1RJT05fVElNRV9TLCB0aGlzLmNvbmZpZy5ZQVdfT05MWSwgdGhpcy5jb25maWcuREVCVUcpOwoJCQkgICAgICBpZiAodGhpcy5zZW5zb3IpIHsKCQkJICAgICAgICB0aGlzLnNlbnNvci5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkaW5nJywgdGhpcy5fb25TZW5zb3JSZWFkKTsKCQkJICAgICAgICB0aGlzLnNlbnNvci5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMuX29uU2Vuc29yRXJyb3IpOwoJCQkgICAgICAgIHRoaXMuc2Vuc29yID0gbnVsbDsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgIH0sIHsKCQkJICAgIGtleTogJ2dldE9yaWVudGF0aW9uJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPcmllbnRhdGlvbigpIHsKCQkJICAgICAgaWYgKHRoaXMuZnVzaW9uU2Vuc29yKSB7CgkJCSAgICAgICAgcmV0dXJuIHRoaXMuZnVzaW9uU2Vuc29yLmdldE9yaWVudGF0aW9uKCk7CgkJCSAgICAgIH0KCQkJICAgICAgaWYgKCF0aGlzLnNlbnNvciB8fCAhdGhpcy5zZW5zb3IucXVhdGVybmlvbikgewoJCQkgICAgICAgIHRoaXMuX291dFswXSA9IHRoaXMuX291dFsxXSA9IHRoaXMuX291dFsyXSA9IDA7CgkJCSAgICAgICAgdGhpcy5fb3V0WzNdID0gMTsKCQkJICAgICAgICByZXR1cm4gdGhpcy5fb3V0OwoJCQkgICAgICB9CgkJCSAgICAgIHZhciBxID0gdGhpcy5zZW5zb3IucXVhdGVybmlvbjsKCQkJICAgICAgdGhpcy5fc2Vuc29yUS5zZXQocVswXSwgcVsxXSwgcVsyXSwgcVszXSk7CgkJCSAgICAgIHZhciBvdXQgPSB0aGlzLl9vdXRROwoJCQkgICAgICBvdXQuY29weShTRU5TT1JfVE9fVlIpOwoJCQkgICAgICBvdXQubXVsdGlwbHkodGhpcy5fc2Vuc29yUSk7CgkJCSAgICAgIGlmICh0aGlzLmNvbmZpZy5ZQVdfT05MWSkgewoJCQkgICAgICAgIG91dC54ID0gb3V0LnogPSAwOwoJCQkgICAgICAgIG91dC5ub3JtYWxpemUoKTsKCQkJICAgICAgfQoJCQkgICAgICB0aGlzLl9vdXRbMF0gPSBvdXQueDsKCQkJICAgICAgdGhpcy5fb3V0WzFdID0gb3V0Lnk7CgkJCSAgICAgIHRoaXMuX291dFsyXSA9IG91dC56OwoJCQkgICAgICB0aGlzLl9vdXRbM10gPSBvdXQudzsKCQkJICAgICAgcmV0dXJuIHRoaXMuX291dDsKCQkJICAgIH0KCQkJICB9LCB7CgkJCSAgICBrZXk6ICdfb25TZW5zb3JFcnJvcicsCgkJCSAgICB2YWx1ZTogZnVuY3Rpb24gX29uU2Vuc29yRXJyb3IoZXZlbnQpIHsKCQkJICAgICAgdGhpcy5lcnJvcnMucHVzaChldmVudC5lcnJvcik7CgkJCSAgICAgIGlmIChldmVudC5lcnJvci5uYW1lID09PSAnTm90QWxsb3dlZEVycm9yJykgewoJCQkgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Blcm1pc3Npb24gdG8gYWNjZXNzIHNlbnNvciB3YXMgZGVuaWVkJyk7CgkJCSAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZXJyb3IubmFtZSA9PT0gJ05vdFJlYWRhYmxlRXJyb3InKSB7CgkJCSAgICAgICAgY29uc29sZS5lcnJvcignU2Vuc29yIGNvdWxkIG5vdCBiZSByZWFkJyk7CgkJCSAgICAgIH0gZWxzZSB7CgkJCSAgICAgICAgY29uc29sZS5lcnJvcihldmVudC5lcnJvcik7CgkJCSAgICAgIH0KCQkJICAgICAgdGhpcy51c2VEZXZpY2VNb3Rpb24oKTsKCQkJICAgIH0KCQkJICB9LCB7CgkJCSAgICBrZXk6ICdfb25TZW5zb3JSZWFkJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBfb25TZW5zb3JSZWFkKCkge30KCQkJICB9XSk7CgkJCSAgcmV0dXJuIFBvc2VTZW5zb3I7CgkJCX0oKTsKCQkJdmFyIHJvdGF0ZUluc3RydWN0aW9uc0Fzc2V0ID0gIjxzdmcgd2lkdGg9JzE5OCcgaGVpZ2h0PScyNDAnIHZpZXdCb3g9JzAgMCAxOTggMjQwJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnPjxnIGZpbGw9J25vbmUnIGZpbGwtcnVsZT0nZXZlbm9kZCc+PHBhdGggZD0nTTE0OS42MjUgMTA5LjUyN2w2LjczNyAzLjg5MXYuODg2YzAgLjE3Ny4wMTMuMzYuMDM4LjU0OS4wMS4wODEuMDIuMTYyLjAyNy4yNDIuMTQgMS40MTUuOTc0IDIuOTk4IDIuMTA1IDMuOTk5bDUuNzIgNS4wNjIuMDgxLS4wOXM0LjM4Mi0yLjUzIDUuMjM1LTMuMDI0bDI1Ljk3IDE0Ljk5M3Y1NC4wMDFjMCAuNzcxLS4zODYgMS4yMTctLjk0OCAxLjIxNy0uMjMzIDAtLjQ5NS0uMDc2LS43NzItLjIzNmwtMjMuOTY3LTEzLjgzOC0uMDE0LjAyNC0yNy4zMjIgMTUuNzc1LS44NS0xLjMyM2MtNC43MzEtMS41MjktOS43NDgtMi43NC0xNC45NTEtMy42MWEuMjcuMjcgMCAwIDAtLjAwNy4wMjRsLTUuMDY3IDE2Ljk2MS03Ljg5MSA0LjU1Ni0uMDM3LS4wNjN2MjcuNTljMCAuNzcyLS4zODYgMS4yMTctLjk0OCAxLjIxNy0uMjMyIDAtLjQ5NS0uMDc2LS43NzItLjIzNmwtNDIuNDczLTI0LjUyMmMtLjk1LS41NDktMS43Mi0xLjg3Ny0xLjcyLTIuOTY3di0xLjAzNWwtLjAyMS4wNDdhNS4xMTEgNS4xMTEgMCAwIDAtMS44MTYtLjM5OSA1LjY4MiA1LjY4MiAwIDAgMC0uNTQ2LjAwMSAxMy43MjQgMTMuNzI0IDAgMCAxLTEuOTE4LS4wNDFjLTEuNjU1LS4xNTMtMy4yLS42LTQuNDA0LTEuMjk2bC00Ni41NzYtMjYuODkuMDA1LjAxMi0xMC4yNzgtMTguNzVjLTEuMDAxLTEuODI3LS4yNDEtNC4yMTYgMS42OTgtNS4zMzZsNTYuMDExLTMyLjM0NWE0LjE5NCA0LjE5NCAwIDAgMSAyLjA5OS0uNTcyYzEuMzI2IDAgMi41NzIuNjU5IDMuMjI3IDEuODUzbC4wMDUtLjAwMy4yMjcuNDEzLS4wMDYuMDA0YTkuNjMgOS42MyAwIDAgMCAxLjQ3NyAyLjAxOGwuMjc3LjI3YzEuOTE0IDEuODUgNC40NjggMi44MDEgNy4xMTMgMi44MDEgMS45NDkgMCAzLjk0OC0uNTE3IDUuNzc1LTEuNTcyLjAxMyAwIDcuMzE5LTQuMjE5IDcuMzE5LTQuMjE5YTQuMTk0IDQuMTk0IDAgMCAxIDIuMDk5LS41NzJjMS4zMjYgMCAyLjU3Mi42NTggMy4yMjYgMS44NTNsMy4yNSA1LjkyOC4wMjItLjAxOCA2Ljc4NSAzLjkxNy0uMTA1LS4xODIgNDYuODgxLTI2Ljk2NW0wLTEuNjM1Yy0uMjgyIDAtLjU2My4wNzMtLjgxNS4yMThsLTQ2LjE2OSAyNi41NTYtNS40MS0zLjEyNC0zLjAwNS01LjQ4MWMtLjkxMy0xLjY2Ny0yLjY5OS0yLjcwMi00LjY2LTIuNzAzLTEuMDExIDAtMi4wMi4yNzQtMi45MTcuNzkyYTM4MjUgMzgyNSAwIDAgMS03LjI3NSA0LjE5NWwtLjA0NC4wMjRhOS45MzcgOS45MzcgMCAwIDEtNC45NTcgMS4zNTNjLTIuMjkyIDAtNC40MTQtLjgzMi01Ljk3Ni0yLjM0MmwtLjI1Mi0uMjQ1YTcuOTkyIDcuOTkyIDAgMCAxLTEuMTM5LTEuNTM0IDEuMzc5IDEuMzc5IDAgMCAwLS4wNi0uMTIybC0uMjI3LS40MTRhMS43MTggMS43MTggMCAwIDAtLjA5NS0uMTU0Yy0uOTM4LTEuNTc0LTIuNjczLTIuNTQ1LTQuNTcxLTIuNTQ1LTEuMDExIDAtMi4wMi4yNzQtMi45MTcuNzkyTDMuMTI1IDE1NS41MDJjLTIuNjk5IDEuNTU5LTMuNzM4IDQuOTQtMi4zMTQgNy41MzhsMTAuMjc4IDE4Ljc1Yy4xNzcuMzIzLjQ0OC41NjMuNzYxLjcwNGw0Ni40MjYgMjYuODA0YzEuNDAzLjgxIDMuMTU3IDEuMzMyIDUuMDcyIDEuNTA4YTE1LjY2MSAxNS42NjEgMCAwIDAgMi4xNDYuMDQ2IDQuNzY2IDQuNzY2IDAgMCAxIC4zOTYgMGMuMDk2LjAwNC4xOS4wMTEuMjgzLjAyMi4xMDkgMS41OTMgMS4xNTkgMy4zMjMgMi41MjkgNC4xMTRsNDIuNDcyIDI0LjUyMmMuNTI0LjMwMiAxLjA1OC40NTUgMS41OS40NTUgMS40OTcgMCAyLjU4My0xLjIgMi41ODMtMi44NTJ2LTI2LjU2Mmw3LjExMS00LjEwNWExLjY0IDEuNjQgMCAwIDAgLjc0OS0uOTQ4bDQuNjU4LTE1LjU5M2M0LjQxNC43OTcgOC42OTIgMS44NDggMTIuNzQyIDMuMTI4bC41MzMuODI5YTEuNjM0IDEuNjM0IDAgMCAwIDIuMTkzLjUzMWwyNi41MzItMTUuMzE3TDE5MyAxOTIuNDMzYy41MjMuMzAyIDEuMDU4LjQ1NSAxLjU5LjQ1NSAxLjQ5NyAwIDIuNTgzLTEuMTk5IDIuNTgzLTIuODUydi01NC4wMDFjMC0uNTg0LS4zMTItMS4xMjQtLjgxOC0xLjQxNmwtMjUuOTctMTQuOTkzYTEuNjMzIDEuNjMzIDAgMCAwLTEuNjM2LjAwMWMtLjYwNi4zNTEtMi45OTMgMS43My00LjMyNSAyLjQ5OGwtNC44MDktNC4yNTVjLS44MTktLjcyNS0xLjQ2MS0xLjkzMy0xLjU2MS0yLjkzNmE3Ljc3NiA3Ljc3NiAwIDAgMC0uMDMzLS4yOTQgMi40ODcgMi40ODcgMCAwIDEtLjAyMy0uMzM2di0uODg2YzAtLjU4NC0uMzEyLTEuMTIzLS44MTctMS40MTZsLTYuNzM5LTMuODkxYTEuNjMzIDEuNjMzIDAgMCAwLS44MTctLjIxOScgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J005Ni4wMjcgMTMyLjYzNmw0Ni41NzYgMjYuODkxYzEuMjA0LjY5NSAxLjk3OSAxLjU4NyAyLjI0MiAyLjU0MWwtLjAxLjAwNy04MS4zNzQgNDYuOTgyaC0uMDAxYy0xLjY1NC0uMTUyLTMuMTk5LS42LTQuNDAzLTEuMjk1bC00Ni41NzYtMjYuODkxIDgzLjU0Ni00OC4yMzUnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNNjMuNDYxIDIwOS4xNzRjLS4wMDggMC0uMDE1IDAtLjAyMi0uMDAyLTEuNjkzLS4xNTYtMy4yMjgtLjYwOS00LjQ0MS0xLjMwOWwtNDYuNTc2LTI2Ljg5YS4xMTguMTE4IDAgMCAxIDAtLjIwM2w4My41NDYtNDguMjM1YS4xMTcuMTE3IDAgMCAxIC4xMTcgMGw0Ni41NzYgMjYuODkxYzEuMjI3LjcwOCAyLjAyMSAxLjYxMiAyLjI5NiAyLjYxMWEuMTE2LjExNiAwIDAgMS0uMDQyLjEyNGwtLjAyMS4wMTYtODEuMzc1IDQ2Ljk4MWEuMTEuMTEgMCAwIDEtLjA1OC4wMTZ6bS01MC43NDctMjguMzAzbDQ2LjQwMSAyNi43OWMxLjE3OC42OCAyLjY3MSAxLjEyMSA0LjMyIDEuMjc2bDgxLjI3Mi00Ni45MjJjLS4yNzktLjkwNy0xLjAyNS0xLjczLTIuMTYzLTIuMzg3bC00Ni41MTctMjYuODU3LTgzLjMxMyA0OC4xeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDguMzI3IDE2NS40NzFhNS44NSA1Ljg1IDAgMCAxLS41NDYuMDAxYy0xLjg5NC0uMDgzLTMuMzAyLTEuMDM4LTMuMTQ1LTIuMTMyYTIuNjkzIDIuNjkzIDAgMCAwLS4wNzItMS4xMDVsLTgxLjEwMyA0Ni44MjJjLjYyOC4wNTggMS4yNzIuMDczIDEuOTE4LjA0Mi4xODItLjAwOS4zNjQtLjAwOS41NDYtLjAwMSAxLjg5NC4wODMgMy4zMDIgMS4wMzggMy4xNDUgMi4xMzJsNzkuMjU3LTQ1Ljc1OScgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OS4wNyAyMTEuMzQ3YS4xMTguMTE4IDAgMCAxLS4xMTUtLjEzNGMuMDQ1LS4zMTctLjA1Ny0uNjM3LS4yOTctLjkyNS0uNTA1LS42MS0xLjU1NS0xLjAyMi0yLjczOC0xLjA3NGE1Ljk2NiA1Ljk2NiAwIDAgMC0uNTM1LjAwMSAxNC4wMyAxNC4wMyAwIDAgMS0xLjkzNS0uMDQxLjExNy4xMTcgMCAwIDEtLjEwMy0uMDkyLjExNi4xMTYgMCAwIDEgLjA1NS0uMTI2bDgxLjEwNC00Ni44MjJhLjExNy4xMTcgMCAwIDEgLjE3MS4wN2MuMTA0LjM4MS4xMjkuNzY4LjA3NCAxLjE1My0uMDQ1LjMxNi4wNTcuNjM3LjI5Ni45MjUuNTA2LjYxIDEuNTU1IDEuMDIxIDIuNzM5IDEuMDczLjE3OC4wMDguMzU3LjAwOC41MzUtLjAwMWEuMTE3LjExNyAwIDAgMSAuMDY0LjIxOGwtNzkuMjU2IDQ1Ljc1OWEuMTE0LjExNCAwIDAgMS0uMDU5LjAxNnptLTMuNDA1LTIuMzcyYy4wODkgMCAuMTc3LjAwMi4yNjUuMDA2IDEuMjY2LjA1NiAyLjM1My40ODggMi45MDggMS4xNTguMjI3LjI3NC4zNS41NzUuMzYuODgybDc4LjY4NS00NS40MjljLS4wMzYgMC0uMDcyLS4wMDEtLjEwNy0uMDAzLTEuMjY3LS4wNTYtMi4zNTQtLjQ4OS0yLjkwOS0xLjE1OC0uMjgyLS4zNC0uNDAyLS43MjQtLjM0Ny0xLjEwN2EyLjYwNCAyLjYwNCAwIDAgMC0uMDMyLS45MUw2My44NDYgMjA4Ljk3YTEzLjkxIDEzLjkxIDAgMCAwIDEuNTI4LjAxMmMuMDk3LS4wMDUuMTk0LS4wMDcuMjkxLS4wMDd6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTIuMjA4IDE2Mi4xMzRjLTEuMDAxLTEuODI3LS4yNDEtNC4yMTcgMS42OTgtNS4zMzdsNTYuMDExLTMyLjM0NGMxLjkzOS0xLjEyIDQuMzI0LS41NDYgNS4zMjYgMS4yODFsLjIzMi40MWE5LjM0NCA5LjM0NCAwIDAgMCAxLjQ3IDIuMDIxbC4yNzguMjdjMy4zMjUgMy4yMTQgOC41ODMgMy43MTYgMTIuODg4IDEuMjNsNy4zMTktNC4yMmMxLjk0LTEuMTE5IDQuMzI0LS41NDYgNS4zMjUgMS4yODJsMy4yNSA1LjkyOC04My41MTkgNDguMjI5LTEwLjI3OC0xOC43NXonIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTIuNDg2IDE4MS4wMDFhLjExMi4xMTIgMCAwIDEtLjAzMS0uMDA1LjExNC4xMTQgMCAwIDEtLjA3MS0uMDU2TDIuMTA2IDE2Mi4xOWMtMS4wMzEtMS44OC0uMjQ5LTQuMzQ1IDEuNzQyLTUuNDk0bDU2LjAxLTMyLjM0NGE0LjMyOCA0LjMyOCAwIDAgMSAyLjE1OC0uNTg4YzEuNDE1IDAgMi42NS43MDIgMy4zMTEgMS44ODIuMDEuMDA4LjAxOC4wMTcuMDI0LjAyOGwuMjI3LjQxNGEuMTIyLjEyMiAwIDAgMSAuMDEzLjAzOCA5LjUwOCA5LjUwOCAwIDAgMCAxLjQzOSAxLjk1OWwuMjc1LjI2NmMxLjg0NiAxLjc4NiA0LjM0NCAyLjc2OSA3LjAzMSAyLjc2OSAxLjk3NyAwIDMuOTU0LS41MzggNS43MTctMS41NTdhLjE0OC4xNDggMCAwIDEgLjAzNS0uMDEzbDcuMjg0LTQuMjA2YTQuMzIxIDQuMzIxIDAgMCAxIDIuMTU3LS41ODhjMS40MjcgMCAyLjY3Mi43MTYgMy4zMjkgMS45MTRsMy4yNDkgNS45MjlhLjExNi4xMTYgMCAwIDEtLjA0NC4xNTdsLTgzLjUxOCA0OC4yMjlhLjExNi4xMTYgMCAwIDEtLjA1OS4wMTZ6bTQ5LjUzLTU3LjAwNGMtLjcwNCAwLTEuNDEuMTkzLTIuMDQxLjU1N2wtNTYuMDEgMzIuMzQ1Yy0xLjg4MiAxLjA4Ni0yLjYyNCAzLjQwOS0xLjY1NSA1LjE3OWwxMC4yMjEgMTguNjQ1IDgzLjMxNy00OC4xMTItMy4xOTUtNS44MjljLS42MTUtMS4xMjItMS43ODMtMS43OTItMy4xMjQtMS43OTJhNC4wOCA0LjA4IDAgMCAwLTIuMDQuNTU3bC03LjMxNyA0LjIyNWEuMTQ4LjE0OCAwIDAgMS0uMDM1LjAxMyAxMS43IDExLjcgMCAwIDEtNS44MDEgMS41NjljLTIuNzQ4IDAtNS4zMDMtMS4wMDctNy4xOTQtMi44MzVsLS4yNzgtLjI3YTkuNzE2IDkuNzE2IDAgMCAxLTEuNDk3LTIuMDQ2LjA5Ni4wOTYgMCAwIDEtLjAxMy0uMDM3bC0uMTkxLS4zNDdhLjExLjExIDAgMCAxLS4wMjMtLjAyOWMtLjYxNS0xLjEyMy0xLjc4My0xLjc5My0zLjEyNC0xLjc5M3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNDIuNDM0IDE1NS44MDhjLTIuNTEtLjAwMS00LjY5Ny0xLjI1OC01Ljg1Mi0zLjM2NS0xLjgxMS0zLjMwNC0uNDM4LTcuNjM0IDMuMDU5LTkuNjU0bDEyLjI5MS03LjA5OGE3LjU5OSA3LjU5OSAwIDAgMSAzLjc4OS0xLjAzM2MyLjUxIDAgNC42OTcgMS4yNTggNS44NTIgMy4zNjUgMS44MTEgMy4zMDQuNDM5IDcuNjM0LTMuMDU5IDkuNjU0bC0xMi4yOTEgNy4wOThhNy42MDYgNy42MDYgMCAwIDEtMy43ODkgMS4wMzN6bTEzLjI4Ny0yMC42ODNhNy4xMjggNy4xMjggMCAwIDAtMy41NTUuOTcxbC0xMi4yOTEgNy4wOThjLTMuMjc5IDEuODkzLTQuNTczIDUuOTQyLTIuODgzIDkuMDI0IDEuMDcxIDEuOTU1IDMuMTA2IDMuMTIyIDUuNDQyIDMuMTIyYTcuMTMgNy4xMyAwIDAgMCAzLjU1Ni0uOTdsMTIuMjkxLTcuMDk4YzMuMjc5LTEuODkzIDQuNTcyLTUuOTQyIDIuODgzLTkuMDI0LTEuMDcyLTEuOTU1LTMuMTA2LTMuMTIzLTUuNDQzLTMuMTIzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDkuNTg4IDEwOS40MDdsNi43MzcgMy44OXYuODg3YzAgLjE3Ni4wMTMuMzYuMDM3LjU0OS4wMTEuMDgxLjAyLjE2MS4wMjguMjQyLjE0IDEuNDE1Ljk3MyAyLjk5OCAyLjEwNSAzLjk5OWw3LjM5NiA2LjU0NWMuMTc3LjE1Ni4zNTguMjk1LjU0MS40MTUgMS41NzkgMS4wNCAyLjk1LjQ2NiAzLjA2Mi0xLjI4Mi4wNDktLjc4NC4wNTctMS41OTUuMDIzLTIuNDI5bC0uMDAzLS4xNnYtMS4xNTFsMjUuOTg3IDE1LjAwM3Y1NGMwIDEuMDktLjc3IDEuNTMtMS43Mi45ODJsLTQyLjQ3My0yNC41MjNjLS45NS0uNTQ4LTEuNzItMS44NzctMS43Mi0yLjk2NnYtMzQuMDMzJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE5NC41NTMgMTkxLjI1Yy0uMjU3IDAtLjU0LS4wODUtLjgzMS0uMjUzbC00Mi40NzItMjQuNTIxYy0uOTgxLS41NjctMS43NzktMS45NDMtMS43NzktMy4wNjh2LTM0LjAzM2guMjM0djM0LjAzM2MwIDEuMDUxLjc0NSAyLjMzNiAxLjY2MSAyLjg2Nmw0Mi40NzMgMjQuNTIxYy40MjQuMjQ1LjgxNi4yODggMS4xMDMuMTIyLjI4NS0uMTY0LjQ0Mi0uNTIuNDQyLTEuMDAydi01My45MzNsLTI1Ljc1My0xNC44NjguMDAzIDEuMTA2Yy4wMzQuODMyLjAyNiAxLjY1NC0uMDI0IDIuNDM5LS4wNTQuODQ0LS4zOTYgMS40NjQtLjk2MyAxLjc0Ni0uNjE5LjMwOS0xLjQ1LjE3My0yLjI4LS4zNzNhNS4wMjMgNS4wMjMgMCAwIDEtLjU1My0uNDI2bC03LjM5Ny02LjU0NGMtMS4xNTgtMS4wMjYtMS45OTktMi42MjUtMi4xNDMtNC4wNzZhOS42MjQgOS42MjQgMCAwIDAtLjAyNy0uMjM4IDQuMjQxIDQuMjQxIDAgMCAxLS4wMzgtLjU2NHYtLjgybC02LjY4LTMuODU2LjExNy0uMjAyIDYuNzM4IDMuODkuMDU4LjAzNHYuOTU0YzAgLjE3MS4wMTIuMzUxLjAzNi41MzMuMDExLjA4My4wMjEuMTY1LjAyOS4yNDYuMTM4IDEuMzk1Ljk0OCAyLjkzNSAyLjA2NSAzLjkyM2w3LjM5NyA2LjU0NWMuMTczLjE1My4zNS4yODkuNTI3LjQwNi43NTguNDk5IDEuNTA0LjYzIDIuMDQ3LjM1OS40OS0uMjQzLjc4Ni0uNzk1LjgzNC0xLjU1MS4wNS0uNzc4LjA1Ny0xLjU5MS4wMjQtMi40MTdsLS4wMDQtLjE2M3YtMS4zNTVsLjE3NS4xIDI1Ljk4NyAxNS4wMDQuMDU5LjAzM3Y1NC4wNjhjMCAuNTY5LS4xOTguOTk2LS41NTkgMS4yMDRhMS4wMDIgMS4wMDIgMCAwIDEtLjUwNi4xMzEnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ1LjY4NSAxNjMuMTYxbDI0LjExNSAxMy45MjItMjUuOTc4IDE0Ljk5OC0xLjQ2Mi0uMzA3Yy02LjUzNC0yLjE3LTEzLjYyOC0zLjcyOC0yMS4wMTktNC42MTYtNC4zNjUtLjUyNC04LjY2MyAxLjA5Ni05LjU5OCAzLjYyYTIuNzQ2IDIuNzQ2IDAgMCAwLS4wMTEgMS45MjhjMS41MzggNC4yNjcgNC4yMzYgOC4zNjMgNy45OTUgMTIuMTM1bC41MzIuODQ1LTI1Ljk3NyAxNC45OTctMjQuMTE1LTEzLjkyMiA3NS41MTgtNDMuNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J005NC4yODIgMjIwLjgxOGwtLjA1OS0uMDMzLTI0LjI5LTE0LjAyNC4xNzUtLjEwMSA3NS41NzctNDMuNjM0LjA1OC4wMzMgMjQuMjkgMTQuMDI0LTI2LjE5MSAxNS4xMjItLjA0NS0uMDEtMS40NjEtLjMwN2MtNi41NDktMi4xNzQtMTMuNjEzLTMuNzI1LTIxLjAwOS00LjYxNGExMy43NDQgMTMuNzQ0IDAgMCAwLTEuNjM4LS4wOTdjLTMuNzU4IDAtNy4wNTQgMS41MzEtNy44MzcgMy42NDJhMi42MiAyLjYyIDAgMCAwLS4wMSAxLjg0OGMxLjUzNSA0LjI1OCA0LjIxNiA4LjMyNiA3Ljk2OCAxMi4wOTFsLjAxNi4wMjEuNTI2LjgzNS4wMDYuMDEuMDY0LjEwMi0uMTA1LjA2MS0yNS45NzcgMTQuOTk4LS4wNTguMDMzem0tMjMuODgxLTE0LjA1N2wyMy44ODEgMTMuNzg4IDI0LjgwMi0xNC4zMmMuNTQ2LS4zMTUuODQ2LS40ODkgMS4wMTctLjU3NWwtLjQ2Ni0uNzRjLTMuNzcxLTMuNzg3LTYuNDY3LTcuODgxLTguMDEzLTEyLjE2OGEyLjg1MSAyLjg1MSAwIDAgMSAuMDExLTIuMDA4Yy44MTUtMi4xOTkgNC4yMDMtMy43OTUgOC4wNTYtMy43OTUuNTU3IDAgMS4xMTcuMDMzIDEuNjY2LjA5OSA3LjQxMi44OTEgMTQuNDkxIDIuNDQ1IDIxLjA0MSA0LjYyMS44MzYuMTc1IDEuMjE1LjI1NCAxLjM5LjMwNGwyNS43OC0xNC44ODQtMjMuODgxLTEzLjc4OC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjcuMjMgMTI1Ljk3OXY1MC44NzFsLTI3LjMyMSAxNS43NzMtNi40NjEtMTQuMTY3Yy0uOTEtMS45OTYtMy40MjgtMS43MzgtNS42MjQuNTc0YTEwLjIzOCAxMC4yMzggMCAwIDAtMi4zMyA0LjAxOGwtNi40NiAyMS42MjgtMjcuMzIyIDE1Ljc3NHYtNTAuODcxbDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTkxLjcxMiAyMjAuNTY3YS4xMjcuMTI3IDAgMCAxLS4wNTktLjAxNi4xMTguMTE4IDAgMCAxLS4wNTgtLjEwMXYtNTAuODcxYzAtLjA0Mi4wMjMtLjA4LjA1OC0uMTAxbDc1LjUxOS00My42YS4xMTcuMTE3IDAgMCAxIC4xNzUuMTAxdjUwLjg3MWMwIC4wNDEtLjAyMy4wOC0uMDU5LjFsLTI3LjMyMSAxNS43NzVhLjExOC4xMTggMCAwIDEtLjA5NC4wMS4xMi4xMiAwIDAgMS0uMDcxLS4wNjNsLTYuNDYtMTQuMTY4Yy0uMzc1LS44MjItMS4wNjItMS4yNzUtMS45MzQtMS4yNzUtMS4wODkgMC0yLjM2NC42ODYtMy41IDEuODgxYTEwLjIwNiAxMC4yMDYgMCAwIDAtMi4zMDIgMy45NzJsLTYuNDYgMjEuNjI3YS4xMTguMTE4IDAgMCAxLS4wNTQuMDY4TDkxLjc3IDIyMC41NTFhLjEyLjEyIDAgMCAxLS4wNTguMDE2em0uMTE3LTUwLjkydjUwLjYwMWwyNy4xMDYtMTUuNjUgNi40NDctMjEuNTgzYTEwLjI4NiAxMC4yODYgMCAwIDEgMi4zNTctNC4wNjVjMS4xOC0xLjI0MiAyLjUxNy0xLjk1NCAzLjY2OS0xLjk1NC45NjkgMCAxLjczMS41MDEgMi4xNDYgMS40MTFsNi40MDcgMTQuMDUxIDI3LjE1Mi0xNS42NzZ2LTUwLjYwMWwtNzUuMjg0IDQzLjQ2NnonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTY4LjU0MyAxMjYuMjEzdjUwLjg3bC0yNy4zMjIgMTUuNzc0LTYuNDYtMTQuMTY4Yy0uOTEtMS45OTUtMy40MjgtMS43MzgtNS42MjQuNTc0YTEwLjI0OCAxMC4yNDggMCAwIDAtMi4zMyA0LjAxOWwtNi40NjEgMjEuNjI3LTI3LjMyMSAxNS43NzR2LTUwLjg3bDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTkzLjAyNSAyMjAuOGEuMTIzLjEyMyAwIDAgMS0uMDU5LS4wMTUuMTIuMTIgMCAwIDEtLjA1OC0uMTAxdi01MC44NzFjMC0uMDQyLjAyMy0uMDguMDU4LS4xMDFsNzUuNTE4LTQzLjZhLjExMi4xMTIgMCAwIDEgLjExNyAwYy4wMzYuMDIuMDU5LjA1OS4wNTkuMXY1MC44NzFhLjExNi4xMTYgMCAwIDEtLjA1OS4xMDFsLTI3LjMyMSAxNS43NzRhLjExMS4xMTEgMCAwIDEtLjA5NC4wMS4xMTUuMTE1IDAgMCAxLS4wNzEtLjA2MmwtNi40Ni0xNC4xNjhjLS4zNzUtLjgyMy0xLjA2Mi0xLjI3NS0xLjkzNS0xLjI3NS0xLjA4OCAwLTIuMzYzLjY4NS0zLjQ5OSAxLjg4MWExMC4xOSAxMC4xOSAwIDAgMC0yLjMwMiAzLjk3MWwtNi40NjEgMjEuNjI4YS4xMDguMTA4IDAgMCAxLS4wNTMuMDY3bC0yNy4zMjIgMTUuNzc1YS4xMi4xMiAwIDAgMS0uMDU4LjAxNXptLjExNy01MC45MTl2NTAuNmwyNy4xMDYtMTUuNjQ5IDYuNDQ3LTIxLjU4NGExMC4yOTMgMTAuMjkzIDAgMCAxIDIuMzU3LTQuMDY1YzEuMTc5LTEuMjQxIDIuNTE2LTEuOTU0IDMuNjY4LTEuOTU0Ljk2OSAwIDEuNzMyLjUwMiAyLjE0NyAxLjQxMmw2LjQwNyAxNC4wNTEgMjcuMTUyLTE1LjY3NnYtNTAuNjAxbC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjkuOCAxNzcuMDgzbC0yNy4zMjIgMTUuNzc0LTYuNDYtMTQuMTY4Yy0uOTEtMS45OTUtMy40MjgtMS43MzgtNS42MjUuNTc0YTEwLjI0NiAxMC4yNDYgMCAwIDAtMi4zMjkgNC4wMTlsLTYuNDYxIDIxLjYyNy0yNy4zMjEgMTUuNzc0di01MC44N2w3NS41MTgtNDMuNnY1MC44N3onIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNOTQuMjgyIDIyMC45MTdhLjIzNC4yMzQgMCAwIDEtLjIzNC0uMjMzdi01MC44NzFjMC0uMDgzLjA0NS0uMTYxLjExNy0uMjAybDc1LjUxOC00My42MDFhLjIzNC4yMzQgMCAxIDEgLjM1LjIwMnY1MC44NzFhLjIzMy4yMzMgMCAwIDEtLjExNi4yMDJsLTI3LjMyMiAxNS43NzVhLjIzMi4yMzIgMCAwIDEtLjMyOS0uMTA2bC02LjQ2MS0xNC4xNjhjLS4zNi0uNzg5LS45OTItMS4yMDYtMS44MjgtMS4yMDYtMS4wNTYgMC0yLjMwMS42NzItMy40MTUgMS44NDRhMTAuMDk5IDEwLjA5OSAwIDAgMC0yLjI3NSAzLjkyNGwtNi40NiAyMS42MjhhLjIzNS4yMzUgMCAwIDEtLjEwNy4xMzZsLTI3LjMyMiAxNS43NzRhLjIzLjIzIDAgMCAxLS4xMTYuMDMxem0uMjMzLTUwLjk2OXY1MC4zMzFsMjYuODkxLTE1LjUyNSA2LjQzNC0yMS41MzlhMTAuNDEgMTAuNDEgMCAwIDEgMi4zODQtNC4xMTJjMS4yMDEtMS4yNjUgMi41NjktMS45OTEgMy43NTMtMS45OTEgMS4wMTggMCAxLjgxOC41MjYgMi4yNTMgMS40OGw2LjM1NCAxMy45MzQgMjYuOTgyLTE1LjU3OHYtNTAuMzMxbC03NS4wNTEgNDMuMzMxeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMDkuODk0IDE5OS45NDNjLTEuNzc0IDAtMy4yNDEtLjcyNS00LjI0NC0yLjEyYS4yMjQuMjI0IDAgMCAxIC4wMjMtLjI5NC4yMzMuMjMzIDAgMCAxIC4zMDEtLjAyM2MuNzguNTQ3IDEuNzA1LjgyNyAyLjc1LjgyNyAxLjMyMyAwIDIuNzU0LS40MzkgNC4yNTYtMS4zMDYgNS4zMTEtMy4wNjcgOS42MzEtMTAuNTE4IDkuNjMxLTE2LjYxMSAwLTEuOTI3LS40NDItMy41Ni0xLjI3OC00LjcyNGEuMjMyLjIzMiAwIDAgMSAuMzIzLS4zMjdjMS42NzEgMS4xNzIgMi41OTEgMy4zODEgMi41OTEgNi4yMTkgMCA2LjI0Mi00LjQyNiAxMy44NjMtOS44NjUgMTcuMDAzLTEuNTc0LjkwOC0zLjA4NCAxLjM1Ni00LjQ4OCAxLjM1NnptLTIuOTY5LTEuNTQyYy44MTMuNjUxIDEuODIuODc3IDIuOTY4Ljg3N2guMDAxYzEuMzIxIDAgMi43NTMtLjMyNyA0LjI1NC0xLjE5NCA1LjMxMS0zLjA2NyA5LjYzMi0xMC40NjMgOS42MzItMTYuNTU2IDAtMS45NzktLjQ2My0zLjU5OS0xLjMyNi00Ljc2MS40MTEgMS4wMzUuNjI1IDIuMjc1LjYyNSAzLjYzNSAwIDYuMjQzLTQuNDI2IDEzLjg4My05Ljg2NSAxNy4wMjMtMS41NzQuOTA5LTMuMDg0IDEuMzE3LTQuNDkgMS4zMTctLjY0MSAwLTEuMjQzLS4xNDktMS43OTktLjM0MXonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTEzLjA5NyAxOTcuMjNjNS4zODQtMy4xMDggOS43NDgtMTAuNjM2IDkuNzQ4LTE2LjgxNCAwLTIuMDUxLS40ODMtMy42OTItMS4zMjMtNC44Ni0xLjc4NC0xLjI1Mi00LjM3NC0xLjE5NC03LjI1Ny40Ny01LjM4NCAzLjEwOC05Ljc0OCAxMC42MzYtOS43NDggMTYuODE0IDAgMi4wNTEuNDgzIDMuNjkyIDEuMzIzIDQuODYgMS43ODQgMS4yNTIgNC4zNzQgMS4xOTQgNy4yNTctLjQ3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTEwOC43MjQgMTk4LjYxNGMtMS4xNDIgMC0yLjE1OC0uMjEzLTMuMDE5LS44MTctLjAyMS0uMDE0LS4wNC4wMTQtLjA1NS0uMDA3LS44OTQtMS4yNDQtMS4zNjctMi45NDgtMS4zNjctNC45NzMgMC02LjI0MiA0LjQyNi0xMy44NjQgOS44NjUtMTcuMDA1IDEuNTc0LS45MDggMy4wODQtMS4zNjMgNC40OS0xLjM2MyAxLjE0MiAwIDIuMTU4LjMwOSAzLjAxOC45MTNhLjIzLjIzIDAgMCAxIC4wNTYuMDU2Yy44OTQgMS4yNDQgMS4zNjcgMi45NzIgMS4zNjcgNC45OTcgMCA2LjI0My00LjQyNiAxMy43ODMtOS44NjUgMTYuOTIzLTEuNTc0LjkwOS0zLjA4NCAxLjI3Ni00LjQ5IDEuMjc2em0tMi43MTgtMS4xMDljLjc3NC41MzIgMS42ODguNzc2IDIuNzE4Ljc3NiAxLjMyMyAwIDIuNzU0LS40MTMgNC4yNTYtMS4yOCA1LjMxMS0zLjA2NiA5LjYzMS0xMC41MDUgOS42MzEtMTYuNTk4IDAtMS45MDktLjQzNC0zLjUyMy0xLjI1NS00LjY4NS0uNzc0LS41MzMtMS42ODgtLjc5OS0yLjcxOC0uNzk5LTEuMzIzIDAtMi43NTUuNDQxLTQuMjU2IDEuMzA4LTUuMzExIDMuMDY2LTkuNjMxIDEwLjUwNi05LjYzMSAxNi41OTkgMCAxLjkwOS40MzQgMy41MTcgMS4yNTUgNC42Nzl6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OS4zMTggMTE0LjI2MmwtOS45ODQgOC44NzggMTUuODkzIDExLjAzMSA1LjU4OS02LjExMi0xMS40OTgtMTMuNzk3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE2OS42NzYgMTIwLjg0bC05Ljc0OCA1LjYyN2MtMy42NDIgMi4xMDMtOS41MjggMi4xMTMtMTMuMTQ3LjAyNC0zLjYyLTIuMDg5LTMuNjAxLTUuNDg4LjA0MS03LjU5MWw5LjQ5NS01LjYwOC02LjcyOS0zLjg4NS04MS44MzYgNDcuMDcxIDQ1LjkyMyAyNi41MTQgMy4wODEtMS43NzljLjYzMS0uMzY1Ljg2OS0uODk4LjYxOC0xLjM5LTIuMzU3LTQuNjMyLTIuNTkzLTkuNTQ2LS42ODMtMTQuMjYyIDUuNjM4LTEzLjkyIDI0LjUwOS0yNC44MTUgNDguNjE4LTI4LjA3IDguMTY5LTEuMTAzIDE2LjY4LS45NjcgMjQuNzA0LjM5NC44NTIuMTQ1IDEuNzc2LjAwOCAyLjQwNy0uMzU3bDMuMDgxLTEuNzc4LTI1LjgyNS0xNC45MScgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xMTMuNjc1IDE4My40NTlhLjQ3LjQ3IDAgMCAxLS4yMzMtLjA2MmwtNDUuOTI0LTI2LjUxNWEuNDY4LjQ2OCAwIDAgMSAuMDAxLS44MDlsODEuODM2LTQ3LjA3MWEuNDY3LjQ2NyAwIDAgMSAuNDY2IDBsNi43MjkgMy44ODVhLjQ2Ny40NjcgMCAwIDEtLjQ2Ny44MDlsLTYuNDk2LTMuNzUtODAuOSA0Ni41MzMgNDQuOTg4IDI1Ljk3MyAyLjg0OC0xLjY0NGMuMTkyLS4xMTEuNjItLjQwOS40MzUtLjc3My0yLjQxNi00Ljc0OC0yLjY1OC05LjgxNC0uNy0xNC42NSAyLjgwNi02LjkyNyA4Ljg4NS0xMy4yNDIgMTcuNTgyLTE4LjI2MyA4LjY1Ny00Ljk5OCAxOS41MTgtOC40ODkgMzEuNDA3LTEwLjA5NCA4LjE5OC0xLjEwNyAxNi43OS0uOTcgMjQuODQ0LjM5Ny43MzkuMTI1IDEuNTYxLjAwNyAyLjA5NS0uMzAxbDIuMzgxLTEuMzc0LTI1LjEyNS0xNC41MDZhLjQ2Ny40NjcgMCAwIDEgLjQ2Ny0uODA5bDI1LjgyNSAxNC45MWEuNDY3LjQ2NyAwIDAgMSAwIC44MDlsLTMuMDgxIDEuNzc5Yy0uNzIxLjQxNy0xLjc2My41NzUtMi43MTguNDEzLTcuOTYzLTEuMzUxLTE2LjQ1Ny0xLjQ4Ni0yNC41NjMtLjM5Mi0xMS43NyAxLjU4OS0yMi41MTIgNS4wMzktMzEuMDY1IDkuOTc3LTguNTE0IDQuOTE2LTE0LjQ1NiAxMS4wNzMtMTcuMTgzIDE3LjgwNS0xLjg1NCA0LjU3OC0xLjYyMyA5LjM3Ni42NjYgMTMuODc1LjM3LjcyNS4wNTUgMS41MTMtLjggMi4wMDZsLTMuMDgxIDEuNzhhLjQ3Ni40NzYgMCAwIDEtLjIzNC4wNjInIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNMTUzLjMxNiAxMjguMjc5Yy0yLjQxMyAwLTQuODIxLS41MjgtNi42NTItMS41ODYtMS44MTgtMS4wNDktMi44Mi0yLjQ2MS0yLjgyLTMuOTc1IDAtMS41MjcgMS4wMTYtMi45NTUgMi44NjEtNC4wMmw5LjQ5My01LjYwN2EuMjMzLjIzMyAwIDEgMSAuMjM4LjQwMmwtOS40OTYgNS42MDljLTEuNjk2Ljk3OS0yLjYyOCAyLjI2My0yLjYyOCAzLjYxNiAwIDEuMzQuOTE4IDIuNjA4IDIuNTg1IDMuNTcxIDMuNTQ5IDIuMDQ5IDkuMzQzIDIuMDM4IDEyLjkxNC0uMDI0bDkuNzQ4LTUuNjI4YS4yMzQuMjM0IDAgMCAxIC4yMzQuNDA1bC05Ljc0OCA1LjYyOGMtMS44NTggMS4wNzItNC4yOTYgMS42MDktNi43MjkgMS42MDknIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTEzLjY3NSAxODIuOTkybC00NS45MTMtMjYuNTA4TTExMy42NzUgMTgzLjM0MmEuMzQ2LjM0NiAwIDAgMS0uMTc1LS4wNDdsLTQ1LjkxMy0yNi41MDhhLjM1LjM1IDAgMSAxIC4zNS0uNjA3bDQ1LjkxMyAyNi41MDhhLjM1LjM1IDAgMCAxLS4xNzUuNjU0JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTY3Ljc2MiAxNTYuNDg0djU0LjAwMWMwIDEuMDkuNzcgMi40MTggMS43MiAyLjk2N2w0Mi40NzMgMjQuNTIxYy45NS41NDkgMS43Mi4xMSAxLjcyLS45OHYtNTQuMDAxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTExMi43MjcgMjM4LjU2MWMtLjI5NyAwLS42Mi0uMDk1LS45NDctLjI4NWwtNDIuNDczLTI0LjUyMWMtMS4wNjMtLjYxMy0xLjg5NS0yLjA1LTEuODk1LTMuMjd2LTU0LjAwMWEuMzUuMzUgMCAxIDEgLjcwMSAwdjU0LjAwMWMwIC45Ni43MDcgMi4xOCAxLjU0NCAyLjY2M2w0Mi40NzMgMjQuNTIyYy4zNDQuMTk4LjY2MS4yNDMuODcuMTIyLjIwNi0uMTE5LjMyNS0uNDExLjMyNS0uNzk5di01NC4wMDFhLjM1LjM1IDAgMSAxIC43IDB2NTQuMDAxYzAgLjY1NS0uMjM5IDEuMTU0LS42NzUgMS40MDZhMS4yMzUgMS4yMzUgMCAwIDEtLjYyMy4xNjInIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNMTEyLjg2IDE0Ny41MTJoLS4wMDFjLTIuMzE4IDAtNC40OTktLjUyMi02LjE0Mi0xLjQ3MS0xLjcwNS0uOTg0LTIuNjQzLTIuMzE1LTIuNjQzLTMuNzQ5IDAtMS40NDUuOTUyLTIuNzkxIDIuNjgtMy43ODhsMTIuMDQxLTYuOTUzYzEuNjY4LS45NjIgMy44NzQtMS40OTMgNi4yMTItMS40OTMgMi4zMTggMCA0LjQ5OS41MjMgNi4xNDMgMS40NzIgMS43MDQuOTg0IDIuNjQzIDIuMzE1IDIuNjQzIDMuNzQ4IDAgMS40NDYtLjk1MiAyLjc5MS0yLjY4IDMuNzg5bC0xMi4wNDIgNi45NTJjLTEuNjY4Ljk2My0zLjg3NCAxLjQ5My02LjIxMSAxLjQ5M3ptMTIuMTQ3LTE2Ljc1M2MtMi4yMTcgMC00LjI5OC40OTctNS44NjEgMS4zOTlsLTEyLjA0MiA2Ljk1MmMtMS41MDIuODY4LTIuMzMgMS45OTgtMi4zMyAzLjE4MiAwIDEuMTczLjgxNSAyLjI4OSAyLjI5MyAzLjE0MiAxLjUzOC44ODkgMy41OTYgMS4zNzggNS43OTIgMS4zNzhoLjAwMWMyLjIxNiAwIDQuMjk4LS40OTcgNS44NjEtMS4zOTlsMTIuMDQxLTYuOTUzYzEuNTAyLS44NjcgMi4zMy0xLjk5NyAyLjMzLTMuMTgyIDAtMS4xNzItLjgxNC0yLjI4OC0yLjI5Mi0zLjE0Mi0xLjUzOS0uODg4LTMuNTk2LTEuMzc3LTUuNzkzLTEuMzc3eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjUuNjMgMTIzLjIxOWwtNS43MzQgMy4zMTFjLTMuMTY3IDEuODI4LTguMjg2IDEuODM3LTExLjQzMy4wMi0zLjE0Ny0xLjgxNy0zLjEzMS00Ljc3Mi4wMzYtNi42MDFsNS43MzQtMy4zMSAxMS4zOTcgNi41OCcgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xNTQuMjMzIDExNy40NDhsOS45OTUgNS43NzEtNC42ODIgMi43MDRjLTEuNDM0LjgyNy0zLjM1MiAxLjI4My01LjM5OSAxLjI4My0yLjAyOSAwLTMuOTIzLS40NDktNS4zMzMtMS4yNjMtMS4yOS0uNzQ0LTItMS42OTQtMi0yLjY3NCAwLS45OTEuNzIzLTEuOTU1IDIuMDM2LTIuNzEzbDUuMzgzLTMuMTA4bTAtLjgwOWwtNS43MzQgMy4zMWMtMy4xNjcgMS44MjktMy4xODMgNC43ODQtLjAzNiA2LjYwMSAxLjU2OC45MDUgMy42MjMgMS4zNTcgNS42ODQgMS4zNTcgMi4wNzcgMCA0LjE1OS0uNDYgNS43NDktMS4zNzdsNS43MzQtMy4zMTEtMTEuMzk3LTYuNThNMTQ1LjQ0NSAxNzkuNjY3Yy0xLjc3MyAwLTMuMjQxLS44NS00LjI0My0yLjI0NS0uMDY3LS4wOTItLjA1Ny0uMjc1LjAyMy0uMzU2LjA4LS4wODEuMjA3LS4xMi4zLS4wNTUuNzgxLjU0OCAxLjcwNi44MTIgMi43NTEuODExIDEuMzIyIDAgMi43NTQtLjQ0NiA0LjI1Ni0xLjMxMyA1LjMxLTMuMDY2IDkuNjMxLTEwLjUyMiA5LjYzMS0xNi42MTUgMC0xLjkyNy0uNDQyLTMuNTYyLTEuMjc5LTQuNzI2YS4yMzUuMjM1IDAgMCAxIC4wMjQtLjMwMS4yMzIuMjMyIDAgMCAxIC4zLS4wMjdjMS42NyAxLjE3MiAyLjU5IDMuMzggMi41OSA2LjIxOSAwIDYuMjQyLTQuNDI1IDEzLjk4Ny05Ljg2NSAxNy4xMjctMS41NzMuOTA4LTMuMDgzIDEuNDgxLTQuNDg4IDEuNDgxek0xNDIuNDc2IDE3OGMuODE0LjY1MSAxLjgyIDEuMDAyIDIuOTY5IDEuMDAyIDEuMzIyIDAgMi43NTMtLjQ1MiA0LjI1NS0xLjMyIDUuMzEtMy4wNjUgOS42MzEtMTAuNTIzIDkuNjMxLTE2LjYxNyAwLTEuOTgtLjQ2My0zLjYzLTEuMzI1LTQuNzkzLjQxMSAxLjAzNS42MjQgMi4yNi42MjQgMy42MiAwIDYuMjQyLTQuNDI1IDEzLjg3NS05Ljg2NSAxNy4wMTUtMS41NzMuOTA5LTMuMDg0IDEuMzc2LTQuNDg5IDEuMzc2YTUuNDkgNS40OSAwIDAgMS0xLjgtLjI4M3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ4LjY0OCAxNzYuNzA0YzUuMzg0LTMuMTA4IDkuNzQ4LTEwLjYzNiA5Ljc0OC0xNi44MTMgMC0yLjA1Mi0uNDgzLTMuNjkzLTEuMzIyLTQuODYxLTEuNzg1LTEuMjUyLTQuMzc1LTEuMTk0LTcuMjU4LjQ3MS01LjM4MyAzLjEwOC05Ljc0OCAxMC42MzYtOS43NDggMTYuODEzIDAgMi4wNTEuNDg0IDMuNjkyIDEuMzIzIDQuODYgMS43ODUgMS4yNTMgNC4zNzQgMS4xOTUgNy4yNTctLjQ3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE0NC4yNzYgMTc4LjI3NmMtMS4xNDMgMC0yLjE1OC0uMzA3LTMuMDE5LS45MTFhLjIxNy4yMTcgMCAwIDEtLjA1NS0uMDU0Yy0uODk1LTEuMjQ0LTEuMzY3LTIuOTcyLTEuMzY3LTQuOTk3IDAtNi4yNDEgNC40MjUtMTMuODc1IDkuODY1LTE3LjAxNiAxLjU3My0uOTA4IDMuMDg0LTEuMzY5IDQuNDg5LTEuMzY5IDEuMTQzIDAgMi4xNTguMzA3IDMuMDE5LjkxYS4yNC4yNCAwIDAgMSAuMDU1LjA1NWMuODk0IDEuMjQ0IDEuMzY3IDIuOTcxIDEuMzY3IDQuOTk3IDAgNi4yNDEtNC40MjUgMTMuODc1LTkuODY1IDE3LjAxNi0xLjU3My45MDgtMy4wODQgMS4zNjktNC40ODkgMS4zNjl6bS0yLjcxOC0xLjE3MmMuNzczLjUzMyAxLjY4Ny45MDEgMi43MTguOTAxIDEuMzIyIDAgMi43NTQtLjUzOCA0LjI1Ni0xLjQwNSA1LjMxLTMuMDY2IDkuNjMxLTEwLjU2NyA5LjYzMS0xNi42NjEgMC0xLjkwOC0uNDM0LTMuNTU0LTEuMjU2LTQuNzE2LS43NzQtLjUzMi0xLjY4OC0uODE0LTIuNzE4LS44MTQtMS4zMjIgMC0yLjc1NC40MzMtNC4yNTYgMS4zLTUuMzEgMy4wNjYtOS42MzEgMTAuNTY0LTkuNjMxIDE2LjY1NyAwIDEuOTEuNDM0IDMuNTc2IDEuMjU2IDQuNzM4eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNTAuNzIgMTcyLjM2MWwtLjM2My0uMjk1YTI0LjEwNSAyNC4xMDUgMCAwIDAgMi4xNDgtMy4xMjggMjQuMDUgMjQuMDUgMCAwIDAgMS45NzctNC4zNzVsLjQ0My4xNDlhMjQuNTQgMjQuNTQgMCAwIDEtMi4wMTUgNC40NiAyNC42MSAyNC42MSAwIDAgMS0yLjE5IDMuMTg5TTExNS45MTcgMTkxLjUxNGwtLjM2My0uMjk0YTI0LjE3NCAyNC4xNzQgMCAwIDAgMi4xNDgtMy4xMjggMjQuMDM4IDI0LjAzOCAwIDAgMCAxLjk3Ni00LjM3NWwuNDQzLjE0OGEyNC40OCAyNC40OCAwIDAgMS0yLjAxNSA0LjQ2MSAyNC42NjIgMjQuNjYyIDAgMCAxLTIuMTg5IDMuMTg4TTExNCAyMzcuNDc2VjE4Mi41ODQgMjM3LjQ3NicgZmlsbD0nIzYwN0Q4QicvPjxnPjxwYXRoIGQ9J004MS44MjIgMzcuNDc0Yy4wMTctLjEzNS0uMDc1LS4yOC0uMjY3LS4zOTItLjMyNy0uMTg4LS44MjYtLjIxLTEuMTA5LS4wNDVsLTYuMDEyIDMuNDcxYy0uMTMxLjA3Ni0uMTk0LjE3OC0uMTkxLjI4NS4wMDIuMTMyLjAwMi40NjEuMDAyLjU3OHYuMDQzbC0uMDA3LjEyOC02LjU5MSAzLjc3OWMtLjAwMSAwLTIuMDc3IDEuMDQ2LTIuNzg3IDUuMTkyIDAgMC0uOTEyIDYuOTYxLS44OTggMTkuNzQ1LjAxNSAxMi41Ny42MDYgMTcuMDcgMS4xNjcgMjEuMzUxLjIyIDEuNjg0IDMuMDAxIDIuMTI1IDMuMDAxIDIuMTI1LjMzMS4wNC42OTgtLjAyNyAxLjA4LS4yNDhsNzUuMjczLTQzLjU1MWMxLjgwOC0xLjA2OSAyLjY2Ny0zLjcxOSAzLjA1Ni02LjI4NCAxLjIxMy03Ljk5IDEuNjc1LTMyLjk3OC0uMjc1LTM5Ljg3OC0uMTk2LS42OTMtLjUxLTEuMDgzLS44NjgtMS4yODJsLTIuMDg2LS43OWMtLjcyNy4wMjgtMS40MTYuNDY3LTEuNTM0LjUzNUw4Mi4wMzIgMzcuMDcybC0uMjEuNDAyJyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTE0NC4zMTEgMS43MDFsMi4wODUuNzljLjM1OC4xOTkuNjcyLjU4OS44NjggMS4yODIgMS45NDkgNi45IDEuNDg3IDMxLjg4Ny4yNzUgMzkuODc4LS4zOSAyLjU2NS0xLjI0OSA1LjIxNS0zLjA1NiA2LjI4NEw2OS4yMSA5My40ODZhMS43OCAxLjc4IDAgMCAxLS44OTYuMjU4bC0uMTgzLS4wMTFjMCAuMDAxLTIuNzgyLS40NC0zLjAwMy0yLjEyNC0uNTYtNC4yODItMS4xNTEtOC43ODEtMS4xNjUtMjEuMzUxLS4wMTUtMTIuNzg0Ljg5Ny0xOS43NDUuODk3LTE5Ljc0NS43MS00LjE0NiAyLjc4Ny01LjE5MiAyLjc4Ny01LjE5Mmw2LjU5MS0zLjc3OS4wMDctLjEyOHYtLjA0M2MwLS4xMTcgMC0uNDQ2LS4wMDItLjU3OC0uMDAzLS4xMDcuMDU5LS4yMS4xOTEtLjI4NWw2LjAxMi0zLjQ3MmEuOTguOTggMCAwIDEgLjQ4MS0uMTFjLjIxOCAwIC40NDkuMDUzLjYyNy4xNTYuMTkzLjExMi4yODUuMjU4LjI2OC4zOTJsLjIxMS0uNDAyIDYwLjc0NC0zNC44MzZjLjExNy0uMDY4LjgwNi0uNTA3IDEuNTM0LS41MzVtMC0uOTk3bC0uMDM5LjAwMWMtLjYxOC4wMjMtMS4yODMuMjQ0LTEuOTc0LjY1NmwtLjAyMS4wMTItNjAuNTE5IDM0LjcwNmEyLjM1OCAyLjM1OCAwIDAgMC0uODMxLS4xNWMtLjM2NSAwLS43MDQuMDg0LS45OC4yNDRsLTYuMDEyIDMuNDcxYy0uNDQyLjI1NS0uNjk5LjY5LS42ODkgMS4xNjZsLjAwMS4xNS02LjA4IDMuNDg3Yy0uMzczLjE5OS0yLjU0MiAxLjUzMS0zLjI5IDUuODk4bC0uMDA2LjAzOWMtLjAwOS4wNy0uOTIgNy4xNzMtLjkwNiAxOS44NzUuMDE0IDEyLjYyLjYwMyAxNy4xMTYgMS4xNzIgMjEuNDY1bC4wMDIuMDE1Yy4zMDggMi4zNTUgMy40NzUgMi45MjMgMy44MzYgMi45OGwuMDM0LjAwNGMuMTAxLjAxMy4yMDQuMDE5LjMwNS4wMTlhMi43NyAyLjc3IDAgMCAwIDEuMzk2LS4zOTJsNzUuMjczLTQzLjU1MmMxLjgxMS0xLjA3MSAyLjk5OS0zLjQyMyAzLjU0Mi02Ljk5NyAxLjE4Ni03LjgxNCAxLjczNC0zMy4wOTYtLjMwMS00MC4yOTktLjI1My0uODkzLS43MDQtMS41MjctMS4zNDMtMS44ODJsLS4xMzItLjA2Mi0yLjA4NS0uNzg5YS45NzMuOTczIDAgMCAwLS4zNTMtLjA2NScgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xMjguMjY3IDExLjU2NWwxLjQ5NS40MzQtNTYuMzM5IDMyLjMyNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J003NC4yMDIgOTAuNTQ1YS41LjUgMCAwIDEtLjI1LS45MzFsMTguNDM3LTEwLjY0NWEuNDk5LjQ5OSAwIDEgMSAuNDk5Ljg2NEw3NC40NTEgOTAuNDc4bC0uMjQ5LjA2N003NS43NjQgNDIuNjU0bC0uMTA4LS4wNjIuMDQ2LS4xNzEgNS4xMzUtMi45NjQuMTcuMDQ1LS4wNDUuMTcxLTUuMTM1IDIuOTY0LS4wNjMuMDE3TTcwLjUyIDkwLjM3NVY0Ni40MjFsLjA2My0uMDM2TDEzNy44NCA3LjU1NHY0My45NTRsLS4wNjIuMDM2TDcwLjUyIDkwLjM3NXptLjI1LTQzLjgxMXY0My4zOGw2Ni44MjEtMzguNTc5VjcuOTg1TDcwLjc3IDQ2LjU2NHonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNODYuOTg2IDgzLjE4MmMtLjIzLjE0OS0uNjEyLjM4NC0uODQ5LjUyM2wtMTEuNTA1IDYuNzAxYy0uMjM3LjEzOS0uMjA2LjI1Mi4wNjguMjUyaC41NjVjLjI3NSAwIC42OTMtLjExMy45My0uMjUyTDg3LjcgODMuNzA1Yy4yMzctLjEzOS40MjgtLjI1My40MjUtLjI1NmExMS4yOSAxMS4yOSAwIDAgMS0uMDA2LS41MDNjMC0uMjc0LS4xODgtLjM3Ny0uNDE4LS4yMjdsLS43MTUuNDYzJyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTc1LjI2NiA5MC43ODJINzQuN2MtLjIgMC0uMzE2LS4wNTYtLjM0Ni0uMTY2LS4wMy0uMTEuMDQzLS4yMTcuMjE1LS4zMTdsMTEuNTA1LTYuNzAyYy4yMzYtLjEzOC42MTUtLjM3MS44NDQtLjUxOWwuNzE1LS40NjRhLjQ4OC40ODggMCAwIDEgLjI2Ni0uMDg5Yy4xNzIgMCAuMzQ1LjEzLjM0NS40MjEgMCAuMjE0LjAwMS4zNjMuMDAzLjQzN2wuMDA2LjAwNC0uMDA0LjA2OWMtLjAwMy4wNzUtLjAwMy4wNzUtLjQ4Ni4zNTZsLTExLjUwNSA2LjcwMmEyLjI4MiAyLjI4MiAwIDAgMS0uOTkyLjI2OHptLS42LS4yNWwuMDM0LjAwMWguNTY2Yy4yNTIgMCAuNjQ5LS4xMDguODY2LS4yMzRsMTEuNTA1LTYuNzAyYy4xNjgtLjA5OC4yOTQtLjE3My4zNjEtLjIxNC0uMDA0LS4wODQtLjAwNC0uMjE4LS4wMDQtLjQzN2wtLjA5NS0uMTcxLS4xMzEuMDQ5LS43MTQuNDYzYy0uMjMyLjE1LS42MTYuMzg2LS44NTQuNTI1bC0xMS41MDUgNi43MDItLjAyOS4wMTh6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTc1LjI2NiA4OS44NzFINzQuN2MtLjIgMC0uMzE2LS4wNTYtLjM0Ni0uMTY2LS4wMy0uMTEuMDQzLS4yMTcuMjE1LS4zMTdsMTEuNTA1LTYuNzAyYy4yNTgtLjE1MS42OTQtLjI2OC45OTMtLjI2OGguNTY1Yy4yIDAgLjMxNi4wNTYuMzQ2LjE2Ni4wMy4xMS0uMDQzLjIxNy0uMjE1LjMxN2wtMTEuNTA1IDYuNzAyYTIuMjgyIDIuMjgyIDAgMCAxLS45OTIuMjY4em0tLjYtLjI1bC4wMzQuMDAxaC41NjZjLjI1MiAwIC42NDktLjEwNy44NjYtLjIzNGwxMS41MDUtNi43MDIuMDMtLjAxOC0uMDM1LS4wMDFoLS41NjVjLS4yNTIgMC0uNjQ5LjEwOC0uODY3LjIzNGwtMTEuNTA1IDYuNzAyLS4wMjkuMDE4ek03NC4zNyA5MC44MDF2LTEuMjQ3IDEuMjQ3JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTY4LjEzIDkzLjkwMWMtLjc1MS0uMDkzLTEuMzE0LS43MzctMS40MzktMS4zNzYtLjgzMS00LjIzOC0xLjE1MS04Ljc4Mi0xLjE2NS0yMS4zNTItLjAxNS0xMi43ODQuODk3LTE5Ljc0NS44OTctMTkuNzQ1LjcxMS00LjE0NiAyLjc4Ny01LjE5MiAyLjc4Ny01LjE5Mmw3NC44NTktNDMuMjE5Yy4yMjMtLjEyOSAyLjQ4Ny0xLjU4NCAzLjE5NS45MjMgMS45NSA2LjkgMS40ODggMzEuODg3LjI3NSAzOS44NzgtLjM4OSAyLjU2NS0xLjI0OCA1LjIxNS0zLjA1NiA2LjI4M0w2OS4yMSA5My42NTNjLS4zODIuMjIxLS43NDkuMjg4LTEuMDguMjQ4IDAgMC0yLjc4MS0uNDQxLTMuMDAxLTIuMTI1LS41NjEtNC4yODEtMS4xNTItOC43ODEtMS4xNjctMjEuMzUxLS4wMTQtMTIuNzg0Ljg5OC0xOS43NDUuODk4LTE5Ljc0NS43MS00LjE0NiAyLjc4Ny01LjE5MSAyLjc4Ny01LjE5MWw2LjU5OC0zLjgxLjg3MS0uMTE5IDYuNTk5LTMuODMuMDQ2LS40NjFMNjguMTMgOTMuOTAxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTY4LjMxNyA5NC4xNjFsLS4yMTUtLjAxM2gtLjAwMWwtLjI0NC0uMDQ3Yy0uNzE5LS4xNTYtMi43NzItLjczNi0yLjk3Ni0yLjI5Mi0uNTY4LTQuMzQtMS4xNTQtOC44MTMtMS4xNjgtMjEuMzg0LS4wMTQtMTIuNjU0Ljg5MS0xOS43MDcuOS0xOS43NzcuNzI1LTQuMjMxIDIuODMyLTUuMzM4IDIuOTIyLTUuMzgybDYuNjI4LTMuODI3Ljg3LS4xMTkgNi40NDYtMy43NDIuMDM0LS4zMzRhLjI0OC4yNDggMCAwIDEgLjI3My0uMjIzLjI0OC4yNDggMCAwIDEgLjIyMy4yNzJsLS4wNTkuNTg5LTYuNzUyIDMuOTE5LS44Ny4xMTgtNi41NTYgMy43ODVjLS4wMzEuMDE2LTEuOTkgMS4wNjgtMi42NjYgNS4wMTgtLjAwNy4wNi0uOTA4IDcuMDg2LS44OTQgMTkuNzAyLjAxNCAxMi41MzkuNTk3IDE2Ljk5NiAxLjE2MSAyMS4zMDUuMDkxLjY5MS42ODkgMS4xNTQgMS4zMDkgMS40NTJhMS45NSAxLjk1IDAgMCAxLS4yMzYtLjYwOWMtLjc4MS0zLjk4NC0xLjE1NS04LjIwMi0xLjE3LTIxLjM5OS0uMDE0LTEyLjY1My44OTEtMTkuNzA3LjktMTkuNzc3LjcyNS00LjIzMSAyLjgzMi01LjMzNyAyLjkyMi01LjM4Mi0uMDA0LjAwMSA3NC40NDQtNDIuOTggNzQuODQ2LTQzLjIxMmwuMDI4LS4wMTdjLjkwNC0uNTM4IDEuNzItLjY4OCAyLjM2LS40MzMuNTU1LjIyMS45NDkuNzMzIDEuMTcyIDEuNTIgMi4wMTQgNy4xMjggMS40NiAzMi4yMTkuMjgxIDM5Ljk4My0uNTA3IDMuMzQxLTEuNTc1IDUuNTE1LTMuMTc1IDYuNDYyTDY5LjMzNSA5My44NjlhMi4wMjMgMi4wMjMgMCAwIDEtMS4wMTguMjkyem0tLjE0Ny0uNTA3Yy4yOTMuMDM2LjYwNC0uMDM3LjkxNS0uMjE3bDc1LjI3My00My41NTFjMS44MjMtMS4wNzggMi42MDItMy45MTUgMi45MzQtNi4xMDYgMS4xNzQtNy43MzEgMS43MzEtMzIuNjk1LS4yNjgtMzkuNzcyLS4xNzgtLjYzMS0uNDczLTEuMDMyLS44NzYtMS4xOTItLjQ4NC0uMTkzLTEuMTY2LS4wNTItMS45MjEuMzk3bC0uMDM0LjAyMS03NC44NTggNDMuMjE4Yy0uMDMxLjAxNy0xLjk4OSAxLjA2OS0yLjY2NiA1LjAxOS0uMDA3LjA1OS0uOTA4IDcuMDg1LS44OTQgMTkuNzAyLjAxNSAxMy4xNTUuMzg2IDE3LjM1MSAxLjE2MSAyMS4zMDMuMDkuNDYxLjQ3Ni45ODMgMS4wMzcgMS4xMzkuMTE0LjAyNS4xODUuMDM3LjE5Ni4wMzloLjAwMXonIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNjkuMzE3IDY4Ljk4MmMuNDg5LS4yODEuODg1LS4wNTYuODg1LjUwNSAwIC41Ni0uMzk2IDEuMjQzLS44ODUgMS41MjUtLjQ4OC4yODItLjg4NC4wNTctLjg4NC0uNTA0IDAtLjU2LjM5Ni0xLjI0My44ODQtMS41MjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNNjguOTIgNzEuMTMzYy0uMjg5IDAtLjQ4Ny0uMjI4LS40ODctLjYyNSAwLS41Ni4zOTYtMS4yNDMuODg0LTEuNTI2YS44MTIuODEyIDAgMCAxIC4zOTctLjEyMWMuMjg5IDAgLjQ4OC4yMjkuNDg4LjYyNiAwIC41Ni0uMzk2IDEuMjQzLS44ODUgMS41MjVhLjgxMi44MTIgMCAwIDEtLjM5Ny4xMjFtLjc5NC0yLjQ1OWEuOTc2Ljk3NiAwIDAgMC0uNDkuMTQ3Yy0uNTQ4LjMxNy0uOTc4IDEuMDU4LS45NzggMS42ODcgMCAuNDg2LjI3MS44MTIuNjc0LjgxMmEuOTg1Ljk4NSAwIDAgMCAuNDkxLS4xNDZjLjU0OC0uMzE3Ljk3OC0xLjA1Ny45NzgtMS42ODcgMC0uNDg2LS4yNzItLjgxMy0uNjc1LS44MTMnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNNjguOTIgNzAuOTQ3Yy0uMjcxIDAtLjI5OS0uMzA3LS4yOTktLjQzOSAwLS40OTEuMzYxLTEuMTE2Ljc5LTEuMzYzYS42MzIuNjMyIDAgMCAxIC4zMDMtLjA5NmMuMjcyIDAgLjMwMS4zMDYuMzAxLjQzOCAwIC40OTEtLjM2MyAxLjExNi0uNzkxIDEuMzY0YS42MjkuNjI5IDAgMCAxLS4zMDQuMDk2bS43OTQtMi4wODZhLjgxMi44MTIgMCAwIDAtLjM5Ny4xMjFjLS40ODguMjgzLS44ODQuOTY2LS44ODQgMS41MjYgMCAuMzk3LjE5OC42MjUuNDg3LjYyNWEuODEyLjgxMiAwIDAgMCAuMzk3LS4xMjFjLjQ4OS0uMjgyLjg4NS0uOTY1Ljg4NS0xLjUyNSAwLS4zOTctLjE5OS0uNjI2LS40ODgtLjYyNicgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OS40NDQgODUuMzVjLjI2NC0uMTUyLjQ3Ny0uMDMxLjQ3Ny4yNzIgMCAuMzAzLS4yMTMuNjctLjQ3Ny44MjItLjI2My4xNTMtLjQ3Ny4wMzEtLjQ3Ny0uMjcxIDAtLjMwMi4yMTQtLjY3MS40NzctLjgyMycgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OS4yMyA4Ni41MWMtLjE1NiAwLS4yNjMtLjEyMy0uMjYzLS4zMzcgMC0uMzAyLjIxNC0uNjcxLjQ3Ny0uODIzYS40MzEuNDMxIDAgMCAxIC4yMTQtLjA2NmMuMTU2IDAgLjI2My4xMjQuMjYzLjMzOCAwIC4zMDMtLjIxMy42Ny0uNDc3LjgyMmEuNDMxLjQzMSAwIDAgMS0uMjE0LjA2Nm0uNDI4LTEuNDEyYy0uMSAwLS4yMDMuMDI5LS4zMDcuMDktLjMyLjE4NS0uNTcuNjE4LS41Ny45ODUgMCAuMzA5LjE4NS41MjQuNDQ5LjUyNGEuNjMuNjMgMCAwIDAgLjMwOC0uMDljLjMyLS4xODUuNTctLjYxOC41Ny0uOTg1IDAtLjMwOS0uMTg1LS41MjQtLjQ1LS41MjQnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNNjkuMjMgODYuMzIybC0uMDc2LS4xNDljMC0uMjM1LjE3OS0uNTQ0LjM4NC0uNjYxbC4xMi0uMDQxLjA3Ni4xNTFjMCAuMjM0LS4xNzkuNTQyLS4zODMuNjZsLS4xMjEuMDRtLjQyOC0xLjAzOGEuNDMxLjQzMSAwIDAgMC0uMjE0LjA2NmMtLjI2My4xNTItLjQ3Ny41MjEtLjQ3Ny44MjMgMCAuMjE0LjEwNy4zMzcuMjYzLjMzN2EuNDMxLjQzMSAwIDAgMCAuMjE0LS4wNjZjLjI2NC0uMTUyLjQ3Ny0uNTE5LjQ3Ny0uODIyIDAtLjIxNC0uMTA3LS4zMzgtLjI2My0uMzM4JyBmaWxsPScjODA5N0EyJy8+PHBhdGggZD0nTTEzOS4yNzggNy43Njl2NDMuNjY3TDcyLjIwOCA5MC4xNlY0Ni40OTNsNjcuMDctMzguNzI0JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTcyLjA4MyA5MC4zNzVWNDYuNDIxbC4wNjMtLjAzNiA2Ny4yNTctMzguODMxdjQzLjk1NGwtLjA2Mi4wMzYtNjcuMjU4IDM4LjgzMXptLjI1LTQzLjgxMXY0My4zOGw2Ni44MjEtMzguNTc5VjcuOTg1TDcyLjMzMyA0Ni41NjR6JyBmaWxsPScjNjA3RDhCJy8+PC9nPjxwYXRoIGQ9J00xMjUuNzM3IDg4LjY0N2wtNy42MzkgMy4zMzRWODRsLTExLjQ1OSA0LjcxM3Y4LjI2OUw5OSAxMDAuMzE1bDEzLjM2OSAzLjY0NiAxMy4zNjgtMTUuMzE0JyBmaWxsPScjNDU1QTY0Jy8+PC9nPjwvc3ZnPiI7CgkJCWZ1bmN0aW9uIFJvdGF0ZUluc3RydWN0aW9ucygpIHsKCQkJICB0aGlzLmxvYWRJY29uXygpOwoJCQkgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCSAgdmFyIHMgPSBvdmVybGF5LnN0eWxlOwoJCQkgIHMucG9zaXRpb24gPSAnZml4ZWQnOwoJCQkgIHMudG9wID0gMDsKCQkJICBzLnJpZ2h0ID0gMDsKCQkJICBzLmJvdHRvbSA9IDA7CgkJCSAgcy5sZWZ0ID0gMDsKCQkJICBzLmJhY2tncm91bmRDb2xvciA9ICdncmF5JzsKCQkJICBzLmZvbnRGYW1pbHkgPSAnc2Fucy1zZXJpZic7CgkJCSAgcy56SW5kZXggPSAxMDAwMDAwOwoJCQkgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCQkJICBpbWcuc3JjID0gdGhpcy5pY29uOwoJCQkgIHZhciBzID0gaW1nLnN0eWxlOwoJCQkgIHMubWFyZ2luTGVmdCA9ICcyNSUnOwoJCQkgIHMubWFyZ2luVG9wID0gJzI1JSc7CgkJCSAgcy53aWR0aCA9ICc1MCUnOwoJCQkgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoaW1nKTsKCQkJICB2YXIgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkgIHZhciBzID0gdGV4dC5zdHlsZTsKCQkJICBzLnRleHRBbGlnbiA9ICdjZW50ZXInOwoJCQkgIHMuZm9udFNpemUgPSAnMTZweCc7CgkJCSAgcy5saW5lSGVpZ2h0ID0gJzI0cHgnOwoJCQkgIHMubWFyZ2luID0gJzI0cHggMjUlJzsKCQkJICBzLndpZHRoID0gJzUwJSc7CgkJCSAgdGV4dC5pbm5lckhUTUwgPSAnUGxhY2UgeW91ciBwaG9uZSBpbnRvIHlvdXIgQ2FyZGJvYXJkIHZpZXdlci4nOwoJCQkgIG92ZXJsYXkuYXBwZW5kQ2hpbGQodGV4dCk7CgkJCSAgdmFyIHNuYWNrYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCSAgdmFyIHMgPSBzbmFja2Jhci5zdHlsZTsKCQkJICBzLmJhY2tncm91bmRDb2xvciA9ICcjQ0ZEOERDJzsKCQkJICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQkJICBzLmJvdHRvbSA9IDA7CgkJCSAgcy53aWR0aCA9ICcxMDAlJzsKCQkJICBzLmhlaWdodCA9ICc0OHB4JzsKCQkJICBzLnBhZGRpbmcgPSAnMTRweCAyNHB4JzsKCQkJICBzLmJveFNpemluZyA9ICdib3JkZXItYm94JzsKCQkJICBzLmNvbG9yID0gJyM2NTZBNkInOwoJCQkgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoc25hY2tiYXIpOwoJCQkgIHZhciBzbmFja2JhclRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICBzbmFja2JhclRleHQuc3R5bGUuZmxvYXQgPSAnbGVmdCc7CgkJCSAgc25hY2tiYXJUZXh0LmlubmVySFRNTCA9ICdObyBDYXJkYm9hcmQgdmlld2VyPyc7CgkJCSAgdmFyIHNuYWNrYmFyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkgIHNuYWNrYmFyQnV0dG9uLmhyZWYgPSAnaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9nZXQvY2FyZGJvYXJkL2dldC1jYXJkYm9hcmQvJzsKCQkJICBzbmFja2JhckJ1dHRvbi5pbm5lckhUTUwgPSAnZ2V0IG9uZSc7CgkJCSAgc25hY2tiYXJCdXR0b24udGFyZ2V0ID0gJ19ibGFuayc7CgkJCSAgdmFyIHMgPSBzbmFja2JhckJ1dHRvbi5zdHlsZTsKCQkJICBzLmZsb2F0ID0gJ3JpZ2h0JzsKCQkJICBzLmZvbnRXZWlnaHQgPSA2MDA7CgkJCSAgcy50ZXh0VHJhbnNmb3JtID0gJ3VwcGVyY2FzZSc7CgkJCSAgcy5ib3JkZXJMZWZ0ID0gJzFweCBzb2xpZCBncmF5JzsKCQkJICBzLnBhZGRpbmdMZWZ0ID0gJzI0cHgnOwoJCQkgIHMudGV4dERlY29yYXRpb24gPSAnbm9uZSc7CgkJCSAgcy5jb2xvciA9ICcjNjU2QTZCJzsKCQkJICBzbmFja2Jhci5hcHBlbmRDaGlsZChzbmFja2JhclRleHQpOwoJCQkgIHNuYWNrYmFyLmFwcGVuZENoaWxkKHNuYWNrYmFyQnV0dG9uKTsKCQkJICB0aGlzLm92ZXJsYXkgPSBvdmVybGF5OwoJCQkgIHRoaXMudGV4dCA9IHRleHQ7CgkJCSAgdGhpcy5oaWRlKCk7CgkJCX0KCQkJUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKHBhcmVudCkgewoJCQkgIGlmICghcGFyZW50ICYmICF0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudCkgewoJCQkgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm92ZXJsYXkpOwoJCQkgIH0gZWxzZSBpZiAocGFyZW50KSB7CgkJCSAgICBpZiAodGhpcy5vdmVybGF5LnBhcmVudEVsZW1lbnQgJiYgdGhpcy5vdmVybGF5LnBhcmVudEVsZW1lbnQgIT0gcGFyZW50KSB0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLm92ZXJsYXkpOwoJCQkgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMub3ZlcmxheSk7CgkJCSAgfQoJCQkgIHRoaXMub3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCQkJICB2YXIgaW1nID0gdGhpcy5vdmVybGF5LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpOwoJCQkgIHZhciBzID0gaW1nLnN0eWxlOwoJCQkgIGlmIChpc0xhbmRzY2FwZU1vZGUoKSkgewoJCQkgICAgcy53aWR0aCA9ICcyMCUnOwoJCQkgICAgcy5tYXJnaW5MZWZ0ID0gJzQwJSc7CgkJCSAgICBzLm1hcmdpblRvcCA9ICczJSc7CgkJCSAgfSBlbHNlIHsKCQkJICAgIHMud2lkdGggPSAnNTAlJzsKCQkJICAgIHMubWFyZ2luTGVmdCA9ICcyNSUnOwoJCQkgICAgcy5tYXJnaW5Ub3AgPSAnMjUlJzsKCQkJICB9CgkJCX07CgkJCVJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB0aGlzLm92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfTsKCQkJUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5zaG93VGVtcG9yYXJpbHkgPSBmdW5jdGlvbiAobXMsIHBhcmVudCkgewoJCQkgIHRoaXMuc2hvdyhwYXJlbnQpOwoJCQkgIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KHRoaXMuaGlkZS5iaW5kKHRoaXMpLCBtcyk7CgkJCX07CgkJCVJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuZGlzYWJsZVNob3dUZW1wb3JhcmlseSA9IGZ1bmN0aW9uICgpIHsKCQkJICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CgkJCX07CgkJCVJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMuZGlzYWJsZVNob3dUZW1wb3JhcmlseSgpOwoJCQkgIGlmICghaXNMYW5kc2NhcGVNb2RlKCkgJiYgaXNNb2JpbGUoKSkgewoJCQkgICAgdGhpcy5zaG93KCk7CgkJCSAgfSBlbHNlIHsKCQkJICAgIHRoaXMuaGlkZSgpOwoJCQkgIH0KCQkJfTsKCQkJUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5sb2FkSWNvbl8gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdGhpcy5pY29uID0gZGF0YVVyaSgnaW1hZ2Uvc3ZnK3htbCcsIHJvdGF0ZUluc3RydWN0aW9uc0Fzc2V0KTsKCQkJfTsKCQkJdmFyIERFRkFVTFRfVklFV0VSID0gJ0NhcmRib2FyZFYxJzsKCQkJdmFyIFZJRVdFUl9LRVkgPSAnV0VCVlJfQ0FSREJPQVJEX1ZJRVdFUic7CgkJCXZhciBDTEFTU19OQU1FID0gJ3dlYnZyLXBvbHlmaWxsLXZpZXdlci1zZWxlY3Rvcic7CgkJCWZ1bmN0aW9uIFZpZXdlclNlbGVjdG9yKGRlZmF1bHRWaWV3ZXIpIHsKCQkJICB0cnkgewoJCQkgICAgdGhpcy5zZWxlY3RlZEtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFZJRVdFUl9LRVkpOwoJCQkgIH0gY2F0Y2ggKGVycm9yKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCB2aWV3ZXIgcHJvZmlsZTogJXMnLCBlcnJvcik7CgkJCSAgfQoJCQkgIGlmICghdGhpcy5zZWxlY3RlZEtleSkgewoJCQkgICAgdGhpcy5zZWxlY3RlZEtleSA9IGRlZmF1bHRWaWV3ZXIgfHwgREVGQVVMVF9WSUVXRVI7CgkJCSAgfQoJCQkgIHRoaXMuZGlhbG9nID0gdGhpcy5jcmVhdGVEaWFsb2dfKERldmljZUluZm8uVmlld2Vycyk7CgkJCSAgdGhpcy5yb290ID0gbnVsbDsKCQkJICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXyA9IFtdOwoJCQl9CgkJCVZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKHJvb3QpIHsKCQkJICB0aGlzLnJvb3QgPSByb290OwoJCQkgIHJvb3QuYXBwZW5kQ2hpbGQodGhpcy5kaWFsb2cpOwoJCQkgIHZhciBzZWxlY3RlZCA9IHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGhpcy5zZWxlY3RlZEtleSk7CgkJCSAgc2VsZWN0ZWQuY2hlY2tlZCA9IHRydWU7CgkJCSAgdGhpcy5kaWFsb2cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgkJCX07CgkJCVZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICh0aGlzLnJvb3QgJiYgdGhpcy5yb290LmNvbnRhaW5zKHRoaXMuZGlhbG9nKSkgewoJCQkgICAgdGhpcy5yb290LnJlbW92ZUNoaWxkKHRoaXMuZGlhbG9nKTsKCQkJICB9CgkJCSAgdGhpcy5kaWFsb2cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmdldEN1cnJlbnRWaWV3ZXIgPSBmdW5jdGlvbiAoKSB7CgkJCSAgcmV0dXJuIERldmljZUluZm8uVmlld2Vyc1t0aGlzLnNlbGVjdGVkS2V5XTsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmdldFNlbGVjdGVkS2V5XyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaW5wdXQgPSB0aGlzLmRpYWxvZy5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPWZpZWxkXTpjaGVja2VkJyk7CgkJCSAgaWYgKGlucHV0KSB7CgkJCSAgICByZXR1cm4gaW5wdXQuaWQ7CgkJCSAgfQoJCQkgIHJldHVybiBudWxsOwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUub25DaGFuZ2UgPSBmdW5jdGlvbiAoY2IpIHsKCQkJICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXy5wdXNoKGNiKTsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmZpcmVPbkNoYW5nZV8gPSBmdW5jdGlvbiAodmlld2VyKSB7CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXy5sZW5ndGg7IGkrKykgewoJCQkgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrc19baV0odmlld2VyKTsKCQkJICB9CgkJCX07CgkJCVZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5vblNhdmVfID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMuc2VsZWN0ZWRLZXkgPSB0aGlzLmdldFNlbGVjdGVkS2V5XygpOwoJCQkgIGlmICghdGhpcy5zZWxlY3RlZEtleSB8fCAhRGV2aWNlSW5mby5WaWV3ZXJzW3RoaXMuc2VsZWN0ZWRLZXldKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdWaWV3ZXJTZWxlY3Rvci5vblNhdmVfOiB0aGlzIHNob3VsZCBuZXZlciBoYXBwZW4hJyk7CgkJCSAgICByZXR1cm47CgkJCSAgfQoJCQkgIHRoaXMuZmlyZU9uQ2hhbmdlXyhEZXZpY2VJbmZvLlZpZXdlcnNbdGhpcy5zZWxlY3RlZEtleV0pOwoJCQkgIHRyeSB7CgkJCSAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShWSUVXRVJfS0VZLCB0aGlzLnNlbGVjdGVkS2V5KTsKCQkJICB9IGNhdGNoIChlcnJvcikgewoJCQkgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgdmlld2VyIHByb2ZpbGU6ICVzJywgZXJyb3IpOwoJCQkgIH0KCQkJICB0aGlzLmhpZGUoKTsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmNyZWF0ZURpYWxvZ18gPSBmdW5jdGlvbiAob3B0aW9ucykgewoJCQkgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChDTEFTU19OQU1FKTsKCQkJICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkgIHZhciBzID0gb3ZlcmxheS5zdHlsZTsKCQkJICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQkJICBzLmxlZnQgPSAwOwoJCQkgIHMudG9wID0gMDsKCQkJICBzLndpZHRoID0gJzEwMCUnOwoJCQkgIHMuaGVpZ2h0ID0gJzEwMCUnOwoJCQkgIHMuYmFja2dyb3VuZCA9ICdyZ2JhKDAsIDAsIDAsIDAuMyknOwoJCQkgIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhpZGUuYmluZCh0aGlzKSk7CgkJCSAgdmFyIHdpZHRoID0gMjgwOwoJCQkgIHZhciBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICB2YXIgcyA9IGRpYWxvZy5zdHlsZTsKCQkJICBzLmJveFNpemluZyA9ICdib3JkZXItYm94JzsKCQkJICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQkJICBzLnRvcCA9ICcyNHB4JzsKCQkJICBzLmxlZnQgPSAnNTAlJzsKCQkJICBzLm1hcmdpbkxlZnQgPSAtd2lkdGggLyAyICsgJ3B4JzsKCQkJICBzLndpZHRoID0gd2lkdGggKyAncHgnOwoJCQkgIHMucGFkZGluZyA9ICcyNHB4JzsKCQkJICBzLm92ZXJmbG93ID0gJ2hpZGRlbic7CgkJCSAgcy5iYWNrZ3JvdW5kID0gJyNmYWZhZmEnOwoJCQkgIHMuZm9udEZhbWlseSA9ICInUm9ib3RvJywgc2Fucy1zZXJpZiI7CgkJCSAgcy5ib3hTaGFkb3cgPSAnMHB4IDVweCAyMHB4ICM2NjYnOwoJCQkgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUgxXygnU2VsZWN0IHlvdXIgdmlld2VyJykpOwoJCQkgIGZvciAodmFyIGlkIGluIG9wdGlvbnMpIHsKCQkJICAgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUNob2ljZV8oaWQsIG9wdGlvbnNbaWRdLmxhYmVsKSk7CgkJCSAgfQoJCQkgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUJ1dHRvbl8oJ1NhdmUnLCB0aGlzLm9uU2F2ZV8uYmluZCh0aGlzKSkpOwoJCQkgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChvdmVybGF5KTsKCQkJICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGlhbG9nKTsKCQkJICByZXR1cm4gY29udGFpbmVyOwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlSDFfID0gZnVuY3Rpb24gKG5hbWUpIHsKCQkJICB2YXIgaDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpOwoJCQkgIHZhciBzID0gaDEuc3R5bGU7CgkJCSAgcy5jb2xvciA9ICdibGFjayc7CgkJCSAgcy5mb250U2l6ZSA9ICcyMHB4JzsKCQkJICBzLmZvbnRXZWlnaHQgPSAnYm9sZCc7CgkJCSAgcy5tYXJnaW5Ub3AgPSAwOwoJCQkgIHMubWFyZ2luQm90dG9tID0gJzI0cHgnOwoJCQkgIGgxLmlubmVySFRNTCA9IG5hbWU7CgkJCSAgcmV0dXJuIGgxOwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlQ2hvaWNlXyA9IGZ1bmN0aW9uIChpZCwgbmFtZSkgewoJCQkgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICBkaXYuc3R5bGUubWFyZ2luVG9wID0gJzhweCc7CgkJCSAgZGl2LnN0eWxlLmNvbG9yID0gJ2JsYWNrJzsKCQkJICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCQkgIGlucHV0LnN0eWxlLmZvbnRTaXplID0gJzMwcHgnOwoJCQkgIGlucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBpZCk7CgkJCSAgaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3JhZGlvJyk7CgkJCSAgaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGlkKTsKCQkJICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZmllbGQnKTsKCQkJICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwoJCQkgIGxhYmVsLnN0eWxlLm1hcmdpbkxlZnQgPSAnNHB4JzsKCQkJICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGlkKTsKCQkJICBsYWJlbC5pbm5lckhUTUwgPSBuYW1lOwoJCQkgIGRpdi5hcHBlbmRDaGlsZChpbnB1dCk7CgkJCSAgZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKCQkJICByZXR1cm4gZGl2OwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlQnV0dG9uXyA9IGZ1bmN0aW9uIChsYWJlbCwgb25jbGljaykgewoJCQkgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKCQkJICBidXR0b24uaW5uZXJIVE1MID0gbGFiZWw7CgkJCSAgdmFyIHMgPSBidXR0b24uc3R5bGU7CgkJCSAgcy5mbG9hdCA9ICdyaWdodCc7CgkJCSAgcy50ZXh0VHJhbnNmb3JtID0gJ3VwcGVyY2FzZSc7CgkJCSAgcy5jb2xvciA9ICcjMTA5NGY3JzsKCQkJICBzLmZvbnRTaXplID0gJzE0cHgnOwoJCQkgIHMubGV0dGVyU3BhY2luZyA9IDA7CgkJCSAgcy5ib3JkZXIgPSAwOwoJCQkgIHMuYmFja2dyb3VuZCA9ICdub25lJzsKCQkJICBzLm1hcmdpblRvcCA9ICcxNnB4JzsKCQkJICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbmNsaWNrKTsKCQkJICByZXR1cm4gYnV0dG9uOwoJCQl9OwoJCQl2YXIgY29tbW9uanNHbG9iYWwkJDEgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBjb21tb25qc0dsb2JhbCQxICE9PSAndW5kZWZpbmVkJyA/IGNvbW1vbmpzR2xvYmFsJDEgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgkJCWZ1bmN0aW9uIHVud3JhcEV4cG9ydHMkJDEgKHgpIHsKCQkJCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CgkJCX0KCQkJZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUkJDEoZm4sIG1vZHVsZSkgewoJCQkJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwoJCQl9CgkJCXZhciBOb1NsZWVwID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkJDEoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCQkoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewoJCQkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CgkJCX0pKGNvbW1vbmpzR2xvYmFsJCQxLCBmdW5jdGlvbigpIHsKCQkJcmV0dXJuICAgICAgICAgIChmdW5jdGlvbihtb2R1bGVzKSB7CgkJCSAgICAgICAgIAl2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwoJCQkgICAgICAgICAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewoJCQkgICAgICAgICAJCWlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CgkJCSAgICAgICAgIAkJCXJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzOwoJCQkgICAgICAgICAJCX0KCQkJICAgICAgICAgCQl2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CgkJCSAgICAgICAgIAkJCWk6IG1vZHVsZUlkLAoJCQkgICAgICAgICAJCQlsOiBmYWxzZSwKCQkJICAgICAgICAgCQkJZXhwb3J0czoge30KCQkJICAgICAgICAgCQl9OwoJCQkgICAgICAgICAJCW1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOwoJCQkgICAgICAgICAJCW1vZHVsZS5sID0gdHJ1ZTsKCQkJICAgICAgICAgCQlyZXR1cm4gbW9kdWxlLmV4cG9ydHM7CgkJCSAgICAgICAgIAl9CgkJCSAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwoJCQkgICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewoJCQkgICAgICAgICAJCWlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsKCQkJICAgICAgICAgCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsKCQkJICAgICAgICAgCQkJCWNvbmZpZ3VyYWJsZTogZmFsc2UsCgkJCSAgICAgICAgIAkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkgICAgICAgICAJCQkJZ2V0OiBnZXR0ZXIKCQkJICAgICAgICAgCQkJfSk7CgkJCSAgICAgICAgIAkJfQoJCQkgICAgICAgICAJfTsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgewoJCQkgICAgICAgICAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwoJCQkgICAgICAgICAJCQlmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOgoJCQkgICAgICAgICAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9OwoJCQkgICAgICAgICAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsKCQkJICAgICAgICAgCQlyZXR1cm4gZ2V0dGVyOwoJCQkgICAgICAgICAJfTsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIiOwoJCQkgICAgICAgICAJcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7CgkJCSAgICAgICAgIH0pCgkJCSAgICAgICAgIChbCgkJCSAgICAgIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCQkJdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7CgkJCWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoJCQl2YXIgbWVkaWFGaWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCQkJdmFyIG9sZElPUyA9IHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIHBhcnNlRmxvYXQoKCcnICsgKC9DUFUuKk9TIChbMC05X117Myw0fSlbMC05X117MCwxfXwoQ1BVIGxpa2UpLipBcHBsZVdlYktpdC4qTW9iaWxlL2kuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KSB8fCBbMCwgJyddKVsxXSkucmVwbGFjZSgndW5kZWZpbmVkJywgJzNfMicpLnJlcGxhY2UoJ18nLCAnLicpLnJlcGxhY2UoJ18nLCAnJykpIDwgMTAgJiYgIXdpbmRvdy5NU1N0cmVhbTsKCQkJdmFyIE5vU2xlZXAgPSBmdW5jdGlvbiAoKSB7CgkJCSAgZnVuY3Rpb24gTm9TbGVlcCgpIHsKCQkJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOb1NsZWVwKTsKCQkJICAgIGlmIChvbGRJT1MpIHsKCQkJICAgICAgdGhpcy5ub1NsZWVwVGltZXIgPSBudWxsOwoJCQkgICAgfSBlbHNlIHsKCQkJICAgICAgdGhpcy5ub1NsZWVwVmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpOwoJCQkgICAgICB0aGlzLm5vU2xlZXBWaWRlby5zZXRBdHRyaWJ1dGUoJ3BsYXlzaW5saW5lJywgJycpOwoJCQkgICAgICB0aGlzLm5vU2xlZXBWaWRlby5zZXRBdHRyaWJ1dGUoJ3NyYycsIG1lZGlhRmlsZSk7CgkJCSAgICAgIHRoaXMubm9TbGVlcFZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCBmdW5jdGlvbiAoZSkgewoJCQkgICAgICAgIGlmICh0aGlzLm5vU2xlZXBWaWRlby5jdXJyZW50VGltZSA+IDAuNSkgewoJCQkgICAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uY3VycmVudFRpbWUgPSBNYXRoLnJhbmRvbSgpOwoJCQkgICAgICAgIH0KCQkJICAgICAgfS5iaW5kKHRoaXMpKTsKCQkJICAgIH0KCQkJICB9CgkJCSAgX2NyZWF0ZUNsYXNzKE5vU2xlZXAsIFt7CgkJCSAgICBrZXk6ICdlbmFibGUnLAoJCQkgICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKCQkJICAgICAgaWYgKG9sZElPUykgewoJCQkgICAgICAgIHRoaXMuZGlzYWJsZSgpOwoJCQkgICAgICAgIHRoaXMubm9TbGVlcFRpbWVyID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCQkJICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy8nOwoJCQkgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQod2luZG93LnN0b3AsIDApOwoJCQkgICAgICAgIH0sIDE1MDAwKTsKCQkJICAgICAgfSBlbHNlIHsKCQkJICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5wbGF5KCk7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICB9LCB7CgkJCSAgICBrZXk6ICdkaXNhYmxlJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewoJCQkgICAgICBpZiAob2xkSU9TKSB7CgkJCSAgICAgICAgaWYgKHRoaXMubm9TbGVlcFRpbWVyKSB7CgkJCSAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLm5vU2xlZXBUaW1lcik7CgkJCSAgICAgICAgICB0aGlzLm5vU2xlZXBUaW1lciA9IG51bGw7CgkJCSAgICAgICAgfQoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvLnBhdXNlKCk7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICB9XSk7CgkJCSAgcmV0dXJuIE5vU2xlZXA7CgkJCX0oKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBOb1NsZWVwOwoJCQkgICAgICB9KSwKCQkJICAgICAgKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoJCQltb2R1bGUuZXhwb3J0cyA9ICdkYXRhOnZpZGVvL21wNDtiYXNlNjQsQUFBQUlHWjBlWEJ0Y0RReUFBQUNBR2x6YjIxcGMyOHlZWFpqTVcxd05ERUFBQUFJWm5KbFpRQUFDS0J0WkdGMEFBQUM4d1lGLy8vdjNFWHB2ZWJaU0xlV0xOZ2cyU1B1NzNneU5qUWdMU0JqYjNKbElERTBNaUJ5TWpRM09TQmtaRGM1WVRZeElDMGdTQzR5TmpRdlRWQkZSeTAwSUVGV1F5QmpiMlJsWXlBdElFTnZjSGxzWldaMElESXdNRE10TWpBeE5DQXRJR2gwZEhBNkx5OTNkM2N1ZG1sa1pXOXNZVzR1YjNKbkwzZ3lOalF1YUhSdGJDQXRJRzl3ZEdsdmJuTTZJR05oWW1GalBURWdjbVZtUFRFZ1pHVmliRzlqYXoweE9qQTZNQ0JoYm1Gc2VYTmxQVEI0TVRvd2VERXhNU0J0WlQxb1pYZ2djM1ZpYldVOU1pQndjM2s5TVNCd2MzbGZjbVE5TVM0d01Eb3dMakF3SUcxcGVHVmtYM0psWmowd0lHMWxYM0poYm1kbFBURTJJR05vY205dFlWOXRaVDB4SUhSeVpXeHNhWE05TUNBNGVEaGtZM1E5TUNCamNXMDlNQ0JrWldGa2VtOXVaVDB5TVN3eE1TQm1ZWE4wWDNCemEybHdQVEVnWTJoeWIyMWhYM0Z3WDI5bVpuTmxkRDB3SUhSb2NtVmhaSE05TmlCc2IyOXJZV2hsWVdSZmRHaHlaV0ZrY3oweElITnNhV05sWkY5MGFISmxZV1J6UFRBZ2JuSTlNQ0JrWldOcGJXRjBaVDB4SUdsdWRHVnliR0ZqWldROU1DQmliSFZ5WVhsZlkyOXRjR0YwUFRBZ1kyOXVjM1J5WVdsdVpXUmZhVzUwY21FOU1DQmlabkpoYldWelBUTWdZbDl3ZVhKaGJXbGtQVElnWWw5aFpHRndkRDB4SUdKZlltbGhjejB3SUdScGNtVmpkRDB4SUhkbGFXZG9kR0k5TVNCdmNHVnVYMmR2Y0Qwd0lIZGxhV2RvZEhBOU1TQnJaWGxwYm5ROU16QXdJR3RsZVdsdWRGOXRhVzQ5TXpBZ2MyTmxibVZqZFhROU5EQWdhVzUwY21GZmNtVm1jbVZ6YUQwd0lISmpYMnh2YjJ0aGFHVmhaRDB4TUNCeVl6MWpjbVlnYldKMGNtVmxQVEVnWTNKbVBUSXdMakFnY1dOdmJYQTlNQzQyTUNCeGNHMXBiajB3SUhGd2JXRjRQVFk1SUhGd2MzUmxjRDAwSUhaaWRsOXRZWGh5WVhSbFBUSXdNREF3SUhaaWRsOWlkV1p6YVhwbFBUSTFNREF3SUdOeVpsOXRZWGc5TUM0d0lHNWhiRjlvY21ROWJtOXVaU0JtYVd4c1pYSTlNQ0JwY0Y5eVlYUnBiejB4TGpRd0lHRnhQVEU2TVM0d01BQ0FBQUFBT1dXSWhBQTMvL3ArQzd2OHRERFNUamY5N3c1NWkzU2JSUE80WlkraGtqRDVoYmtBa0wzenBKNmgvTFIxQ0FBQnpnQjFrcXF6VW9ybGhRQUFBQXhCbWlRWWhuLytxWllBRExnQUFBQUpRWjVDUWhYL0FBajVJUUFEUUdnY0lRQURRR2djQUFBQUNRR2VZVVFuL3dBTEtDRUFBMEJvSEFBQUFBa0JubU5FSi84QUN5a2hBQU5BYUJ3aEFBTkFhQndBQUFBTlFacG9ORXhEUC82cGxnQU11U0VBQTBCb0hBQUFBQXRCbm9aRkVTd3Ivd0FJK1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbnFWRUovOEFDeWtoQUFOQWFCd0FBQUFKQVo2blJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFEVUdhckRSTVF6LytxWllBRExnaEFBTkFhQndBQUFBTFFaN0tSUlVzSy84QUNQa2hBQU5BYUJ3QUFBQUpBWjdwUkNmL0FBc29JUUFEUUdnY0lRQURRR2djQUFBQUNRR2U2MFFuL3dBTEtDRUFBMEJvSEFBQUFBMUJtdkEwVEVNLy9xbVdBQXk1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDMEdmRGtVVkxDdi9BQWo1SVFBRFFHZ2NBQUFBQ1FHZkxVUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbnk5RUovOEFDeWdoQUFOQWFCd0FBQUFOUVpzME5FeERQLzZwbGdBTXVDRUFBMEJvSEFBQUFBdEJuMUpGRlN3ci93QUkrU0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuM0ZFSi84QUN5Z2hBQU5BYUJ3QUFBQUpBWjl6UkNmL0FBc29JUUFEUUdnY0lRQURRR2djQUFBQURVR2JlRFJNUXovK3FaWUFETGtoQUFOQWFCd0FBQUFMUVorV1JSVXNLLzhBQ1BnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVorMVJDZi9BQXNwSVFBRFFHZ2NBQUFBQ1FHZnQwUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQTFCbTd3MFRFTS8vcW1XQUF5NElRQURRR2djQUFBQUMwR2Yya1VWTEN2L0FBajVJUUFEUUdnY0FBQUFDUUdmK1VRbi93QUxLQ0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuL3RFSi84QUN5a2hBQU5BYUJ3QUFBQU5RWnZnTkV4RFAvNnBsZ0FNdVNFQUEwQm9IQ0VBQTBCb0hBQUFBQXRCbmg1RkZTd3Ivd0FJK0NFQUEwQm9IQUFBQUFrQm5qMUVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVo0L1JDZi9BQXNwSVFBRFFHZ2NBQUFBRFVHYUpEUk1Rei8rcVpZQURMZ2hBQU5BYUJ3QUFBQUxRWjVDUlJVc0svOEFDUGtoQUFOQWFCd2hBQU5BYUJ3QUFBQUpBWjVoUkNmL0FBc29JUUFEUUdnY0FBQUFDUUdlWTBRbi93QUxLU0VBQTBCb0hDRUFBMEJvSEFBQUFBMUJtbWcwVEVNLy9xbVdBQXk1SVFBRFFHZ2NBQUFBQzBHZWhrVVZMQ3YvQUFqNUlRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZXBVUW4vd0FMS1NFQUEwQm9IQUFBQUFrQm5xZEVKLzhBQ3lnaEFBTkFhQndBQUFBTlFacXNORXhEUC82cGxnQU11Q0VBQTBCb0hDRUFBMEJvSEFBQUFBdEJuc3BGRlN3ci93QUkrU0VBQTBCb0hBQUFBQWtCbnVsRUovOEFDeWdoQUFOQWFCd2hBQU5BYUJ3QUFBQUpBWjdyUkNmL0FBc29JUUFEUUdnY0FBQUFEVUdhOERSTVF6LytxWllBRExraEFBTkFhQndoQUFOQWFCd0FBQUFMUVo4T1JSVXNLLzhBQ1BraEFBTkFhQndBQUFBSkFaOHRSQ2YvQUFzcElRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZkwwUW4vd0FMS0NFQUEwQm9IQUFBQUExQm16UTBURU0vL3FtV0FBeTRJUUFEUUdnY0FBQUFDMEdmVWtVVkxDdi9BQWo1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdmY1VRbi93QUxLQ0VBQTBCb0hBQUFBQWtCbjNORUovOEFDeWdoQUFOQWFCd2hBQU5BYUJ3QUFBQU5RWnQ0TkV4Qy8vNnBsZ0FNdVNFQUEwQm9IQUFBQUF0Qm41WkZGU3dyL3dBSStDRUFBMEJvSENFQUEwQm9IQUFBQUFrQm43VkVKLzhBQ3lraEFBTkFhQndBQUFBSkFaKzNSQ2YvQUFzcElRQURRR2djQUFBQURVR2J1elJNUW4vK25oQUFZc0FoQUFOQWFCd2hBQU5BYUJ3QUFBQUpRWi9hUWhQL0FBc3BJUUFEUUdnY0FBQUFDUUdmK1VRbi93QUxLQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQUFBQ2lGdGIyOTJBQUFBYkcxMmFHUUFBQUFBMVlDQ1g5V0FnbDhBQUFQb0FBQUgvQUFCQUFBQkFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQURBQUFBR0dsdlpITUFBQUFBRUlDQWdBY0FULy8vL3Y3L0FBQUYrWFJ5WVdzQUFBQmNkR3RvWkFBQUFBUFZnSUpmMVlDQ1h3QUFBQUVBQUFBQUFBQUgwQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUF5Z0FBQU1vQUFBQUFBQ1JsWkhSekFBQUFIR1ZzYzNRQUFBQUFBQUFBQVFBQUI5QUFBQmR3QUFFQUFBQUFCWEZ0WkdsaEFBQUFJRzFrYUdRQUFBQUExWUNDWDlXQWdsOEFBVitRQUFLL0lGWEVBQUFBQUFBdGFHUnNjZ0FBQUFBQUFBQUFkbWxrWlFBQUFBQUFBQUFBQUFBQUFGWnBaR1Z2U0dGdVpHeGxjZ0FBQUFVY2JXbHVaZ0FBQUJSMmJXaGtBQUFBQVFBQUFBQUFBQUFBQUFBQUpHUnBibVlBQUFBY1pISmxaZ0FBQUFBQUFBQUJBQUFBREhWeWJDQUFBQUFCQUFBRTNITjBZbXdBQUFDWWMzUnpaQUFBQUFBQUFBQUJBQUFBaUdGMll6RUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQXlnREtBRWdBQUFCSUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFZLy84QUFBQXlZWFpqUXdGTlFDai80UUFiWjAxQUtPeWhvM3lTVFVCQVFGQUFBQU1BRUFBcjhnRHhneGxnQVFBRWFPK0c4Z0FBQUJoemRIUnpBQUFBQUFBQUFBRUFBQUE4QUFBTHVBQUFBQlJ6ZEhOekFBQUFBQUFBQUFFQUFBQUJBQUFCOEdOMGRITUFBQUFBQUFBQVBBQUFBQUVBQUJkd0FBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBRHFZQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUFFQUFBdTRBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBQzdnQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUJ4emRITmpBQUFBQUFBQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFFRWMzUnplZ0FBQUFBQUFBQUFBQUFBUEFBQUF6UUFBQUFRQUFBQURRQUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQVBBQUFBRFFBQUFBMEFBQUFSQUFBQUR3QUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBTkFBQUFEUUFBQVFCemRHTnZBQUFBQUFBQUFEd0FBQUF3QUFBRFpBQUFBM1FBQUFPTkFBQURvQUFBQTdrQUFBUFFBQUFENndBQUEvNEFBQVFYQUFBRUxnQUFCRU1BQUFSY0FBQUVid0FBQkl3QUFBU2hBQUFFdWdBQUJNMEFBQVRrQUFBRS93QUFCUklBQUFVckFBQUZRZ0FBQlYwQUFBVndBQUFGaVFBQUJhQUFBQVcxQUFBRnpnQUFCZUVBQUFYK0FBQUdFd0FBQml3QUFBWS9BQUFHVmdBQUJuRUFBQWFFQUFBR25RQUFCclFBQUFiUEFBQUc0Z0FBQnZVQUFBY1NBQUFISndBQUIwQUFBQWRUQUFBSGNBQUFCNFVBQUFlZUFBQUhzUUFBQjhnQUFBZmpBQUFIOWdBQUNBOEFBQWdtQUFBSVFRQUFDRlFBQUFobkFBQUloQUFBQ0pjQUFBTXNkSEpoYXdBQUFGeDBhMmhrQUFBQUE5V0FnbC9WZ0lKZkFBQUFBZ0FBQUFBQUFBZjhBQUFBQUFBQUFBQUFBQUFCQVFBQUFBQUJBQUFBQUFBQUFBQUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUNzbTFrYVdFQUFBQWdiV1JvWkFBQUFBRFZnSUpmMVlDQ1h3QUFyRVFBQVdBQVZjUUFBQUFBQUNkb1pHeHlBQUFBQUFBQUFBQnpiM1Z1QUFBQUFBQUFBQUFBQUFBQVUzUmxjbVZ2QUFBQUFtTnRhVzVtQUFBQUVITnRhR1FBQUFBQUFBQUFBQUFBQUNSa2FXNW1BQUFBSEdSeVpXWUFBQUFBQUFBQUFRQUFBQXgxY213Z0FBQUFBUUFBQWlkemRHSnNBQUFBWjNOMGMyUUFBQUFBQUFBQUFRQUFBRmR0Y0RSaEFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQ0FCQUFBQUFBckVRQUFBQUFBRE5sYzJSekFBQUFBQU9BZ0lBaUFBSUFCSUNBZ0JSQUZRQUFBQUFERFVBQUFBQUFCWUNBZ0FJU0VBYUFnSUFCQWdBQUFCaHpkSFJ6QUFBQUFBQUFBQUVBQUFCWUFBQUVBQUFBQUJ4emRITmpBQUFBQUFBQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFBVWMzUnplZ0FBQUFBQUFBQUdBQUFBV0FBQUFYQnpkR052QUFBQUFBQUFBRmdBQUFPQkFBQURod0FBQTVvQUFBT3RBQUFEc3dBQUE4b0FBQVBmQUFBRDVRQUFBL2dBQUFRTEFBQUVFUUFBQkNnQUFBUTlBQUFFVUFBQUJGWUFBQVJwQUFBRWdBQUFCSVlBQUFTYkFBQUVyZ0FBQkxRQUFBVEhBQUFFM2dBQUJQTUFBQVQ1QUFBRkRBQUFCUjhBQUFVbEFBQUZQQUFBQlZFQUFBVlhBQUFGYWdBQUJYMEFBQVdEQUFBRm1nQUFCYThBQUFYQ0FBQUZ5QUFBQmRzQUFBWHlBQUFGK0FBQUJnMEFBQVlnQUFBR0pnQUFCamtBQUFaUUFBQUdaUUFBQm1zQUFBWitBQUFHa1FBQUJwY0FBQWF1QUFBR3d3QUFCc2tBQUFiY0FBQUc3d0FBQndZQUFBY01BQUFISVFBQUJ6UUFBQWM2QUFBSFRRQUFCMlFBQUFkcUFBQUhmd0FBQjVJQUFBZVlBQUFIcXdBQUI4SUFBQWZYQUFBSDNRQUFCL0FBQUFnREFBQUlDUUFBQ0NBQUFBZzFBQUFJT3dBQUNFNEFBQWhoQUFBSWVBQUFDSDRBQUFpUkFBQUlwQUFBQ0tvQUFBaXdBQUFJdGdBQUNMd0FBQWpDQUFBQUZuVmtkR0VBQUFBT2JtRnRaVk4wWlhKbGJ3QUFBSEIxWkhSaEFBQUFhRzFsZEdFQUFBQUFBQUFBSVdoa2JISUFBQUFBQUFBQUFHMWthWEpoY0hCc0FBQUFBQUFBQUFBQUFBQUFPMmxzYzNRQUFBQXpxWFJ2YndBQUFDdGtZWFJoQUFBQUFRQUFBQUJJWVc1a1FuSmhhMlVnTUM0eE1DNHlJREl3TVRVd05qRXhNREE9JzsKCQkJICAgICAgfSkKCQkJICAgICAgICAgXSk7CgkJCX0pOwoJCQl9KTsKCQkJdmFyIE5vU2xlZXAkMSA9IHVud3JhcEV4cG9ydHMkJDEoTm9TbGVlcCk7CgkJCXZhciBuZXh0RGlzcGxheUlkID0gMTAwMDsKCQkJdmFyIGRlZmF1bHRMZWZ0Qm91bmRzID0gWzAsIDAsIDAuNSwgMV07CgkJCXZhciBkZWZhdWx0UmlnaHRCb3VuZHMgPSBbMC41LCAwLCAwLjUsIDFdOwoJCQl2YXIgcmFmID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsKCQkJdmFyIGNhZiA9IHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZTsKCQkJZnVuY3Rpb24gVlJGcmFtZURhdGEoKSB7CgkJCSAgdGhpcy5sZWZ0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwoJCQkgIHRoaXMubGVmdFZpZXdNYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKCQkJICB0aGlzLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwoJCQkgIHRoaXMucmlnaHRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CgkJCSAgdGhpcy5wb3NlID0gbnVsbDsKCQkJfQoJCQlmdW5jdGlvbiBWUkRpc3BsYXlDYXBhYmlsaXRpZXMoY29uZmlnKSB7CgkJCSAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewoJCQkgICAgaGFzUG9zaXRpb246IHsKCQkJICAgICAgd3JpdGFibGU6IGZhbHNlLCBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogY29uZmlnLmhhc1Bvc2l0aW9uCgkJCSAgICB9LAoJCQkgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiB7CgkJCSAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5oYXNFeHRlcm5hbERpc3BsYXkKCQkJICAgIH0sCgkJCSAgICBjYW5QcmVzZW50OiB7CgkJCSAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5jYW5QcmVzZW50CgkJCSAgICB9LAoJCQkgICAgbWF4TGF5ZXJzOiB7CgkJCSAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5tYXhMYXllcnMKCQkJICAgIH0sCgkJCSAgICBoYXNPcmllbnRhdGlvbjogewoJCQkgICAgICBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJICAgICAgICBkZXByZWNhdGVXYXJuaW5nKCdWUkRpc3BsYXlDYXBhYmlsaXRpZXMucHJvdG90eXBlLmhhc09yaWVudGF0aW9uJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CgkJCSAgICAgICAgcmV0dXJuIGNvbmZpZy5oYXNPcmllbnRhdGlvbjsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgIH0pOwoJCQl9CgkJCWZ1bmN0aW9uIFZSRGlzcGxheShjb25maWcpIHsKCQkJICBjb25maWcgPSBjb25maWcgfHwge307CgkJCSAgdmFyIFVTRV9XQUtFTE9DSyA9ICd3YWtlbG9jaycgaW4gY29uZmlnID8gY29uZmlnLndha2Vsb2NrIDogdHJ1ZTsKCQkJICB0aGlzLmlzUG9seWZpbGxlZCA9IHRydWU7CgkJCSAgdGhpcy5kaXNwbGF5SWQgPSBuZXh0RGlzcGxheUlkKys7CgkJCSAgdGhpcy5kaXNwbGF5TmFtZSA9ICcnOwoJCQkgIHRoaXMuZGVwdGhOZWFyID0gMC4wMTsKCQkJICB0aGlzLmRlcHRoRmFyID0gMTAwMDAuMDsKCQkJICB0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwoJCQkgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnaXNDb25uZWN0ZWQnLCB7CgkJCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5pc0Nvbm5lY3RlZCcsICdWUkRpc3BsYXlDYXBhYmlsaXRpZXMucHJvdG90eXBlLmhhc0V4dGVybmFsRGlzcGxheScpOwoJCQkgICAgICByZXR1cm4gZmFsc2U7CgkJCSAgICB9CgkJCSAgfSk7CgkJCSAgdGhpcy5jYXBhYmlsaXRpZXMgPSBuZXcgVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKHsKCQkJICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKCQkJICAgIGhhc09yaWVudGF0aW9uOiBmYWxzZSwKCQkJICAgIGhhc0V4dGVybmFsRGlzcGxheTogZmFsc2UsCgkJCSAgICBjYW5QcmVzZW50OiBmYWxzZSwKCQkJICAgIG1heExheWVyczogMQoJCQkgIH0pOwoJCQkgIHRoaXMuc3RhZ2VQYXJhbWV0ZXJzID0gbnVsbDsKCQkJICB0aGlzLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwoJCQkgIHRoaXMubGF5ZXJfID0gbnVsbDsKCQkJICB0aGlzLm9yaWdpbmFsUGFyZW50XyA9IG51bGw7CgkJCSAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8gPSBudWxsOwoJCQkgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBudWxsOwoJCQkgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKCQkJICBpZiAoVVNFX1dBS0VMT0NLICYmIGlzTW9iaWxlKCkpIHsKCQkJICAgIHRoaXMud2FrZWxvY2tfID0gbmV3IE5vU2xlZXAkMSgpOwoJCQkgIH0KCQkJfQoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmdldEZyYW1lRGF0YSA9IGZ1bmN0aW9uIChmcmFtZURhdGEpIHsKCQkJICByZXR1cm4gZnJhbWVEYXRhRnJvbVBvc2UoZnJhbWVEYXRhLCB0aGlzLl9nZXRQb3NlKCksIHRoaXMpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmdldFBvc2UgPSBmdW5jdGlvbiAoKSB7CgkJCSAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRQb3NlJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CgkJCSAgcmV0dXJuIHRoaXMuX2dldFBvc2UoKTsKCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5yZXNldFBvc2UgPSBmdW5jdGlvbiAoKSB7CgkJCSAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5yZXNldFBvc2UnKTsKCQkJICByZXR1cm4gdGhpcy5fcmVzZXRQb3NlKCk7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuZ2V0SW1tZWRpYXRlUG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkJICBkZXByZWNhdGVXYXJuaW5nKCdWUkRpc3BsYXkucHJvdG90eXBlLmdldEltbWVkaWF0ZVBvc2UnLCAnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEnKTsKCQkJICByZXR1cm4gdGhpcy5fZ2V0UG9zZSgpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewoJCQkgIHJldHVybiByYWYoY2FsbGJhY2spOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGlkKSB7CgkJCSAgcmV0dXJuIGNhZihpZCk7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUud3JhcEZvckZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoZWxlbWVudCkgewoJCQkgIHJldHVybiBlbGVtZW50OwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICghdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pIHsKCQkJICAgIHJldHVybjsKCQkJICB9CgkJCSAgdmFyIGVsZW1lbnQgPSB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XzsKCQkJICBpZiAodGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXykgewoJCQkgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyk7CgkJCSAgfSBlbHNlIHsKCQkJICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpOwoJCQkgIH0KCQkJICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XyA9IG51bGw7CgkJCSAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyA9IG51bGw7CgkJCSAgdmFyIHBhcmVudCA9IHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnBhcmVudEVsZW1lbnQ7CgkJCSAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8ucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CgkJCSAgaWYgKHRoaXMub3JpZ2luYWxQYXJlbnRfID09PSBwYXJlbnQpIHsKCQkJICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZWxlbWVudCwgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8pOwoJCQkgIH0KCQkJICBlbHNlIGlmICh0aGlzLm9yaWdpbmFsUGFyZW50XykgewoJCQkgICAgICB0aGlzLm9yaWdpbmFsUGFyZW50Xy5hcHBlbmRDaGlsZChlbGVtZW50KTsKCQkJICAgIH0KCQkJICBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8pOwoJCQkgIHJldHVybiBlbGVtZW50OwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlcXVlc3RQcmVzZW50ID0gZnVuY3Rpb24gKGxheWVycykgewoJCQkgIHZhciB3YXNQcmVzZW50aW5nID0gdGhpcy5pc1ByZXNlbnRpbmc7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIGlmICghKGxheWVycyBpbnN0YW5jZW9mIEFycmF5KSkgewoJCQkgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0UHJlc2VudCB3aXRoIG5vbi1hcnJheSBhcmd1bWVudCcsICdhbiBhcnJheSBvZiBWUkxheWVycyBhcyB0aGUgZmlyc3QgYXJndW1lbnQnKTsKCQkJICAgIGxheWVycyA9IFtsYXllcnNdOwoJCQkgIH0KCQkJICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoJCQkgICAgaWYgKCFzZWxmLmNhcGFiaWxpdGllcy5jYW5QcmVzZW50KSB7CgkJCSAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1ZSRGlzcGxheSBpcyBub3QgY2FwYWJsZSBvZiBwcmVzZW50aW5nLicpKTsKCQkJICAgICAgcmV0dXJuOwoJCQkgICAgfQoJCQkgICAgaWYgKGxheWVycy5sZW5ndGggPT0gMCB8fCBsYXllcnMubGVuZ3RoID4gc2VsZi5jYXBhYmlsaXRpZXMubWF4TGF5ZXJzKSB7CgkJCSAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0ludmFsaWQgbnVtYmVyIG9mIGxheWVycy4nKSk7CgkJCSAgICAgIHJldHVybjsKCQkJICAgIH0KCQkJICAgIHZhciBpbmNvbWluZ0xheWVyID0gbGF5ZXJzWzBdOwoJCQkgICAgaWYgKCFpbmNvbWluZ0xheWVyLnNvdXJjZSkgewoJCQkgICAgICByZXNvbHZlKCk7CgkJCSAgICAgIHJldHVybjsKCQkJICAgIH0KCQkJICAgIHZhciBsZWZ0Qm91bmRzID0gaW5jb21pbmdMYXllci5sZWZ0Qm91bmRzIHx8IGRlZmF1bHRMZWZ0Qm91bmRzOwoJCQkgICAgdmFyIHJpZ2h0Qm91bmRzID0gaW5jb21pbmdMYXllci5yaWdodEJvdW5kcyB8fCBkZWZhdWx0UmlnaHRCb3VuZHM7CgkJCSAgICBpZiAod2FzUHJlc2VudGluZykgewoJCQkgICAgICB2YXIgbGF5ZXIgPSBzZWxmLmxheWVyXzsKCQkJICAgICAgaWYgKGxheWVyLnNvdXJjZSAhPT0gaW5jb21pbmdMYXllci5zb3VyY2UpIHsKCQkJICAgICAgICBsYXllci5zb3VyY2UgPSBpbmNvbWluZ0xheWVyLnNvdXJjZTsKCQkJICAgICAgfQoJCQkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgewoJCQkgICAgICAgIGxheWVyLmxlZnRCb3VuZHNbaV0gPSBsZWZ0Qm91bmRzW2ldOwoJCQkgICAgICAgIGxheWVyLnJpZ2h0Qm91bmRzW2ldID0gcmlnaHRCb3VuZHNbaV07CgkJCSAgICAgIH0KCQkJICAgICAgc2VsZi53cmFwRm9yRnVsbHNjcmVlbihzZWxmLmxheWVyXy5zb3VyY2UpOwoJCQkgICAgICBzZWxmLnVwZGF0ZVByZXNlbnRfKCk7CgkJCSAgICAgIHJlc29sdmUoKTsKCQkJICAgICAgcmV0dXJuOwoJCQkgICAgfQoJCQkgICAgc2VsZi5sYXllcl8gPSB7CgkJCSAgICAgIHByZWRpc3RvcnRlZDogaW5jb21pbmdMYXllci5wcmVkaXN0b3J0ZWQsCgkJCSAgICAgIHNvdXJjZTogaW5jb21pbmdMYXllci5zb3VyY2UsCgkJCSAgICAgIGxlZnRCb3VuZHM6IGxlZnRCb3VuZHMuc2xpY2UoMCksCgkJCSAgICAgIHJpZ2h0Qm91bmRzOiByaWdodEJvdW5kcy5zbGljZSgwKQoJCQkgICAgfTsKCQkJICAgIHNlbGYud2FpdGluZ0ZvclByZXNlbnRfID0gZmFsc2U7CgkJCSAgICBpZiAoc2VsZi5sYXllcl8gJiYgc2VsZi5sYXllcl8uc291cmNlKSB7CgkJCSAgICAgIHZhciBmdWxsc2NyZWVuRWxlbWVudCA9IHNlbGYud3JhcEZvckZ1bGxzY3JlZW4oc2VsZi5sYXllcl8uc291cmNlKTsKCQkJICAgICAgdmFyIG9uRnVsbHNjcmVlbkNoYW5nZSA9IGZ1bmN0aW9uIG9uRnVsbHNjcmVlbkNoYW5nZSgpIHsKCQkJICAgICAgICB2YXIgYWN0dWFsRnVsbHNjcmVlbkVsZW1lbnQgPSBnZXRGdWxsc2NyZWVuRWxlbWVudCgpOwoJCQkgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gZnVsbHNjcmVlbkVsZW1lbnQgPT09IGFjdHVhbEZ1bGxzY3JlZW5FbGVtZW50OwoJCQkgICAgICAgIGlmIChzZWxmLmlzUHJlc2VudGluZykgewoJCQkgICAgICAgICAgaWYgKHNjcmVlbi5vcmllbnRhdGlvbiAmJiBzY3JlZW4ub3JpZW50YXRpb24ubG9jaykgewoJCQkgICAgICAgICAgICBzY3JlZW4ub3JpZW50YXRpb24ubG9jaygnbGFuZHNjYXBlLXByaW1hcnknKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzY3JlZW4ub3JpZW50YXRpb24ubG9jaygpIGZhaWxlZCBkdWUgdG8nLCBlcnJvci5tZXNzYWdlKTsKCQkJICAgICAgICAgICAgfSk7CgkJCSAgICAgICAgICB9CgkJCSAgICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwoJCQkgICAgICAgICAgc2VsZi5iZWdpblByZXNlbnRfKCk7CgkJCSAgICAgICAgICByZXNvbHZlKCk7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLnVubG9jaykgewoJCQkgICAgICAgICAgICBzY3JlZW4ub3JpZW50YXRpb24udW5sb2NrKCk7CgkJCSAgICAgICAgICB9CgkJCSAgICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyKCk7CgkJCSAgICAgICAgICBzZWxmLmRpc2FibGVXYWtlTG9jaygpOwoJCQkgICAgICAgICAgc2VsZi5lbmRQcmVzZW50XygpOwoJCQkgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwoJCQkgICAgICAgIH0KCQkJICAgICAgICBzZWxmLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXygpOwoJCQkgICAgICB9OwoJCQkgICAgICB2YXIgb25GdWxsc2NyZWVuRXJyb3IgPSBmdW5jdGlvbiBvbkZ1bGxzY3JlZW5FcnJvcigpIHsKCQkJICAgICAgICBpZiAoIXNlbGYud2FpdGluZ0ZvclByZXNlbnRfKSB7CgkJCSAgICAgICAgICByZXR1cm47CgkJCSAgICAgICAgfQoJCQkgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbldyYXBwZXIoKTsKCQkJICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfKCk7CgkJCSAgICAgICAgc2VsZi5kaXNhYmxlV2FrZUxvY2soKTsKCQkJICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwoJCQkgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gZmFsc2U7CgkJCSAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignVW5hYmxlIHRvIHByZXNlbnQuJykpOwoJCQkgICAgICB9OwoJCQkgICAgICBzZWxmLmFkZEZ1bGxzY3JlZW5MaXN0ZW5lcnNfKGZ1bGxzY3JlZW5FbGVtZW50LCBvbkZ1bGxzY3JlZW5DaGFuZ2UsIG9uRnVsbHNjcmVlbkVycm9yKTsKCQkJICAgICAgaWYgKHJlcXVlc3RGdWxsc2NyZWVuKCkpIHsKCQkJICAgICAgICBzZWxmLmVuYWJsZVdha2VMb2NrKCk7CgkJCSAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSB0cnVlOwoJCQkgICAgICB9IGVsc2UgaWYgKGlzSU9TKCkgfHwgaXNXZWJWaWV3QW5kcm9pZCgpKSB7CgkJCSAgICAgICAgc2VsZi5lbmFibGVXYWtlTG9jaygpOwoJCQkgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gdHJ1ZTsKCQkJICAgICAgICBzZWxmLmJlZ2luUHJlc2VudF8oKTsKCQkJICAgICAgICBzZWxmLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXygpOwoJCQkgICAgICAgIHJlc29sdmUoKTsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgICAgaWYgKCFzZWxmLndhaXRpbmdGb3JQcmVzZW50XyAmJiAhaXNJT1MoKSkgewoJCQkgICAgICBleGl0RnVsbHNjcmVlbigpOwoJCQkgICAgICByZWplY3QobmV3IEVycm9yKCdVbmFibGUgdG8gcHJlc2VudC4nKSk7CgkJCSAgICB9CgkJCSAgfSk7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuZXhpdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHdhc1ByZXNlbnRpbmcgPSB0aGlzLmlzUHJlc2VudGluZzsKCQkJICB2YXIgc2VsZiA9IHRoaXM7CgkJCSAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKCQkJICB0aGlzLmxheWVyXyA9IG51bGw7CgkJCSAgdGhpcy5kaXNhYmxlV2FrZUxvY2soKTsKCQkJICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoJCQkgICAgaWYgKHdhc1ByZXNlbnRpbmcpIHsKCQkJICAgICAgaWYgKCFleGl0RnVsbHNjcmVlbigpICYmIGlzSU9TKCkpIHsKCQkJICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CgkJCSAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKCQkJICAgICAgfQoJCQkgICAgICBpZiAoaXNXZWJWaWV3QW5kcm9pZCgpKSB7CgkJCSAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwoJCQkgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKCQkJICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CgkJCSAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKCQkJICAgICAgfQoJCQkgICAgICByZXNvbHZlKCk7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICByZWplY3QobmV3IEVycm9yKCdXYXMgbm90IHByZXNlbnRpbmcgdG8gVlJEaXNwbGF5LicpKTsKCQkJICAgIH0KCQkJICB9KTsKCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRMYXllcnMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKHRoaXMubGF5ZXJfKSB7CgkJCSAgICByZXR1cm4gW3RoaXMubGF5ZXJfXTsKCQkJICB9CgkJCSAgcmV0dXJuIFtdOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CgkJCSAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlDb25uZWN0XyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheWNvbm5lY3QnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CgkJCSAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmFkZEZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNoYW5nZUhhbmRsZXIsIGVycm9ySGFuZGxlcikgewoJCQkgIHRoaXMucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBlbGVtZW50OwoJCQkgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gY2hhbmdlSGFuZGxlcjsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gZXJyb3JIYW5kbGVyOwoJCQkgIGlmIChjaGFuZ2VIYW5kbGVyKSB7CgkJCSAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVuYWJsZWQpIHsKCQkJICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbmFibGVkKSB7CgkJCSAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVuYWJsZWQpIHsKCQkJICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9CgkJCSAgfQoJCQkgIGlmIChlcnJvckhhbmRsZXIpIHsKCQkJICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tb3pGdWxsU2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKCQkJICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNGdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9CgkJCSAgfQoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICghdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfKSByZXR1cm47CgkJCSAgdmFyIGVsZW1lbnQgPSB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF87CgkJCSAgaWYgKHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfKSB7CgkJCSAgICB2YXIgY2hhbmdlSGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKCQkJICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbXNmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgIH0KCQkJICBpZiAodGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXykgewoJCQkgICAgdmFyIGVycm9ySGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkVycm9ySGFuZGxlcl87CgkJCSAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKCQkJICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgIH0KCQkJICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBudWxsOwoJCQkgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5lbmFibGVXYWtlTG9jayA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy53YWtlbG9ja18pIHsKCQkJICAgIHRoaXMud2FrZWxvY2tfLmVuYWJsZSgpOwoJCQkgIH0KCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5kaXNhYmxlV2FrZUxvY2sgPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKHRoaXMud2FrZWxvY2tfKSB7CgkJCSAgICB0aGlzLndha2Vsb2NrXy5kaXNhYmxlKCk7CgkJCSAgfQoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmJlZ2luUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuZW5kUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKCQkJICByZXR1cm4gbnVsbDsKCQkJfTsKCQkJdmFyIGNvbmZpZyA9IHsKCQkJICBBRERJVElPTkFMX1ZJRVdFUlM6IFtdLAoJCQkgIERFRkFVTFRfVklFV0VSOiAnJywKCQkJICBNT0JJTEVfV0FLRV9MT0NLOiB0cnVlLAoJCQkgIERFQlVHOiBmYWxzZSwKCQkJICBEUERCX1VSTDogJ2h0dHBzOi8vZHBkYi53ZWJ2ci5yb2Nrcy9kcGRiLmpzb24nLAoJCQkgIEtfRklMVEVSOiAwLjk4LAoJCQkgIFBSRURJQ1RJT05fVElNRV9TOiAwLjA0MCwKCQkJICBDQVJEQk9BUkRfVUlfRElTQUJMRUQ6IGZhbHNlLAoJCQkgIFJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQ6IGZhbHNlLAoJCQkgIFlBV19PTkxZOiBmYWxzZSwKCQkJICBCVUZGRVJfU0NBTEU6IDAuNSwKCQkJICBESVJUWV9TVUJNSVRfRlJBTUVfQklORElOR1M6IGZhbHNlCgkJCX07CgkJCXZhciBFeWUgPSB7CgkJCSAgTEVGVDogJ2xlZnQnLAoJCQkgIFJJR0hUOiAncmlnaHQnCgkJCX07CgkJCWZ1bmN0aW9uIENhcmRib2FyZFZSRGlzcGxheShjb25maWckJDEpIHsKCQkJICB2YXIgZGVmYXVsdHMgPSBleHRlbmQoe30sIGNvbmZpZyk7CgkJCSAgY29uZmlnJCQxID0gZXh0ZW5kKGRlZmF1bHRzLCBjb25maWckJDEgfHwge30pOwoJCQkgIFZSRGlzcGxheS5jYWxsKHRoaXMsIHsKCQkJICAgIHdha2Vsb2NrOiBjb25maWckJDEuTU9CSUxFX1dBS0VfTE9DSwoJCQkgIH0pOwoJCQkgIHRoaXMuY29uZmlnID0gY29uZmlnJCQxOwoJCQkgIHRoaXMuZGlzcGxheU5hbWUgPSAnQ2FyZGJvYXJkIFZSRGlzcGxheSc7CgkJCSAgdGhpcy5jYXBhYmlsaXRpZXMgPSBuZXcgVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKHsKCQkJICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKCQkJICAgIGhhc09yaWVudGF0aW9uOiB0cnVlLAoJCQkgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiBmYWxzZSwKCQkJICAgIGNhblByZXNlbnQ6IHRydWUsCgkJCSAgICBtYXhMYXllcnM6IDEKCQkJICB9KTsKCQkJICB0aGlzLnN0YWdlUGFyYW1ldGVycyA9IG51bGw7CgkJCSAgdGhpcy5idWZmZXJTY2FsZV8gPSB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEU7CgkJCSAgdGhpcy5wb3NlU2Vuc29yXyA9IG5ldyBQb3NlU2Vuc29yKHRoaXMuY29uZmlnKTsKCQkJICB0aGlzLmRpc3RvcnRlcl8gPSBudWxsOwoJCQkgIHRoaXMuY2FyZGJvYXJkVUlfID0gbnVsbDsKCQkJICB0aGlzLmRwZGJfID0gbmV3IERwZGIodGhpcy5jb25maWcuRFBEQl9VUkwsIHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkXy5iaW5kKHRoaXMpKTsKCQkJICB0aGlzLmRldmljZUluZm9fID0gbmV3IERldmljZUluZm8odGhpcy5kcGRiXy5nZXREZXZpY2VQYXJhbXMoKSwgY29uZmlnJCQxLkFERElUSU9OQUxfVklFV0VSUyk7CgkJCSAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8gPSBuZXcgVmlld2VyU2VsZWN0b3IoY29uZmlnJCQxLkRFRkFVTFRfVklFV0VSKTsKCQkJICB0aGlzLnZpZXdlclNlbGVjdG9yXy5vbkNoYW5nZSh0aGlzLm9uVmlld2VyQ2hhbmdlZF8uYmluZCh0aGlzKSk7CgkJCSAgdGhpcy5kZXZpY2VJbmZvXy5zZXRWaWV3ZXIodGhpcy52aWV3ZXJTZWxlY3Rvcl8uZ2V0Q3VycmVudFZpZXdlcigpKTsKCQkJICBpZiAoIXRoaXMuY29uZmlnLlJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQpIHsKCQkJICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXyA9IG5ldyBSb3RhdGVJbnN0cnVjdGlvbnMoKTsKCQkJICB9CgkJCSAgaWYgKGlzSU9TKCkpIHsKCQkJICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplXy5iaW5kKHRoaXMpKTsKCQkJICB9CgkJCX0KCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVlJEaXNwbGF5LnByb3RvdHlwZSk7CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX2dldFBvc2UgPSBmdW5jdGlvbiAoKSB7CgkJCSAgcmV0dXJuIHsKCQkJICAgIHBvc2l0aW9uOiBudWxsLAoJCQkgICAgb3JpZW50YXRpb246IHRoaXMucG9zZVNlbnNvcl8uZ2V0T3JpZW50YXRpb24oKSwKCQkJICAgIGxpbmVhclZlbG9jaXR5OiBudWxsLAoJCQkgICAgbGluZWFyQWNjZWxlcmF0aW9uOiBudWxsLAoJCQkgICAgYW5ndWxhclZlbG9jaXR5OiBudWxsLAoJCQkgICAgYW5ndWxhckFjY2VsZXJhdGlvbjogbnVsbAoJCQkgIH07CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX3Jlc2V0UG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5wb3NlU2Vuc29yXy5yZXNldFBvc2UpIHsKCQkJICAgIHRoaXMucG9zZVNlbnNvcl8ucmVzZXRQb3NlKCk7CgkJCSAgfQoJCQl9OwoJCQlDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLl9nZXRGaWVsZE9mVmlldyA9IGZ1bmN0aW9uICh3aGljaEV5ZSkgewoJCQkgIHZhciBmaWVsZE9mVmlldzsKCQkJICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKCQkJICAgIGZpZWxkT2ZWaWV3ID0gdGhpcy5kZXZpY2VJbmZvXy5nZXRGaWVsZE9mVmlld0xlZnRFeWUoKTsKCQkJICB9IGVsc2UgaWYgKHdoaWNoRXllID09IEV5ZS5SSUdIVCkgewoJCQkgICAgZmllbGRPZlZpZXcgPSB0aGlzLmRldmljZUluZm9fLmdldEZpZWxkT2ZWaWV3UmlnaHRFeWUoKTsKCQkJICB9IGVsc2UgewoJCQkgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBleWUgcHJvdmlkZWQ6ICVzJywgd2hpY2hFeWUpOwoJCQkgICAgcmV0dXJuIG51bGw7CgkJCSAgfQoJCQkgIHJldHVybiBmaWVsZE9mVmlldzsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5fZ2V0RXllT2Zmc2V0ID0gZnVuY3Rpb24gKHdoaWNoRXllKSB7CgkJCSAgdmFyIG9mZnNldDsKCQkJICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKCQkJICAgIG9mZnNldCA9IFstdGhpcy5kZXZpY2VJbmZvXy52aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgKiAwLjUsIDAuMCwgMC4wXTsKCQkJICB9IGVsc2UgaWYgKHdoaWNoRXllID09IEV5ZS5SSUdIVCkgewoJCQkgICAgb2Zmc2V0ID0gW3RoaXMuZGV2aWNlSW5mb18udmlld2VyLmludGVyTGVuc0Rpc3RhbmNlICogMC41LCAwLjAsIDAuMF07CgkJCSAgfSBlbHNlIHsKCQkJICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgZXllIHByb3ZpZGVkOiAlcycsIHdoaWNoRXllKTsKCQkJICAgIHJldHVybiBudWxsOwoJCQkgIH0KCQkJICByZXR1cm4gb2Zmc2V0OwoJCQl9OwoJCQlDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKCQkJICB2YXIgb2Zmc2V0ID0gdGhpcy5fZ2V0RXllT2Zmc2V0KHdoaWNoRXllKTsKCQkJICB2YXIgZmllbGRPZlZpZXcgPSB0aGlzLl9nZXRGaWVsZE9mVmlldyh3aGljaEV5ZSk7CgkJCSAgdmFyIGV5ZVBhcmFtcyA9IHsKCQkJICAgIG9mZnNldDogb2Zmc2V0LAoJCQkgICAgcmVuZGVyV2lkdGg6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLndpZHRoICogMC41ICogdGhpcy5idWZmZXJTY2FsZV8sCgkJCSAgICByZW5kZXJIZWlnaHQ6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLmhlaWdodCAqIHRoaXMuYnVmZmVyU2NhbGVfCgkJCSAgfTsKCQkJICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXllUGFyYW1zLCAnZmllbGRPZlZpZXcnLCB7CgkJCSAgICBlbnVtZXJhYmxlOiB0cnVlLAoJCQkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkJCSAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRmllbGRPZlZpZXcnLCAnVlJGcmFtZURhdGFcJ3MgcHJvamVjdGlvbiBtYXRyaWNlcycpOwoJCQkgICAgICByZXR1cm4gZmllbGRPZlZpZXc7CgkJCSAgICB9CgkJCSAgfSk7CgkJCSAgcmV0dXJuIGV5ZVBhcmFtczsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbkRldmljZVBhcmFtc1VwZGF0ZWRfID0gZnVuY3Rpb24gKG5ld1BhcmFtcykgewoJCQkgIGlmICh0aGlzLmNvbmZpZy5ERUJVRykgewoJCQkgICAgY29uc29sZS5sb2coJ0RQREIgcmVwb3J0ZWQgdGhhdCBkZXZpY2UgcGFyYW1zIHdlcmUgdXBkYXRlZC4nKTsKCQkJICB9CgkJCSAgdGhpcy5kZXZpY2VJbmZvXy51cGRhdGVEZXZpY2VQYXJhbXMobmV3UGFyYW1zKTsKCQkJICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CgkJCSAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKCQkJICB9CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUudXBkYXRlQm91bmRzXyA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5sYXllcl8gJiYgdGhpcy5kaXN0b3J0ZXJfICYmICh0aGlzLmxheWVyXy5sZWZ0Qm91bmRzIHx8IHRoaXMubGF5ZXJfLnJpZ2h0Qm91bmRzKSkgewoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfLnNldFRleHR1cmVCb3VuZHModGhpcy5sYXllcl8ubGVmdEJvdW5kcywgdGhpcy5sYXllcl8ucmlnaHRCb3VuZHMpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5iZWdpblByZXNlbnRfID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbCcpOwoJCQkgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcpOwoJCQkgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwoJCQkgIGlmICghZ2wpIHJldHVybjsKCQkJICBpZiAodGhpcy5sYXllcl8ucHJlZGlzdG9ydGVkKSB7CgkJCSAgICBpZiAoIXRoaXMuY29uZmlnLkNBUkRCT0FSRF9VSV9ESVNBQkxFRCkgewoJCQkgICAgICBnbC5jYW52YXMud2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpICogdGhpcy5idWZmZXJTY2FsZV87CgkJCSAgICAgIGdsLmNhbnZhcy5oZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKSAqIHRoaXMuYnVmZmVyU2NhbGVfOwoJCQkgICAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG5ldyBDYXJkYm9hcmRVSShnbCk7CgkJCSAgICB9CgkJCSAgfSBlbHNlIHsKCQkJICAgIGlmICghdGhpcy5jb25maWcuQ0FSREJPQVJEX1VJX0RJU0FCTEVEKSB7CgkJCSAgICAgIHRoaXMuY2FyZGJvYXJkVUlfID0gbmV3IENhcmRib2FyZFVJKGdsKTsKCQkJICAgIH0KCQkJICAgIHRoaXMuZGlzdG9ydGVyXyA9IG5ldyBDYXJkYm9hcmREaXN0b3J0ZXIoZ2wsIHRoaXMuY2FyZGJvYXJkVUlfLCB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEUsIHRoaXMuY29uZmlnLkRJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUyk7CgkJCSAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKCQkJICB9CgkJCSAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJXy5saXN0ZW4oZnVuY3Rpb24gKGUpIHsKCQkJICAgICAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uc2hvdyh0aGlzLmxheWVyXy5zb3VyY2UucGFyZW50RWxlbWVudCk7CgkJCSAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCSAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCQkJICAgIH0uYmluZCh0aGlzKSwgZnVuY3Rpb24gKGUpIHsKCQkJICAgICAgdGhpcy5leGl0UHJlc2VudCgpOwoJCQkgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoJCQkgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgkJCSAgICB9LmJpbmQodGhpcykpOwoJCQkgIH0KCQkJICBpZiAodGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfKSB7CgkJCSAgICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkgJiYgaXNNb2JpbGUoKSkgewoJCQkgICAgICB0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18uc2hvd1RlbXBvcmFyaWx5KDMwMDAsIHRoaXMubGF5ZXJfLnNvdXJjZS5wYXJlbnRFbGVtZW50KTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKCQkJICAgIH0KCQkJICB9CgkJCSAgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIgPSB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VfLmJpbmQodGhpcyk7CgkJCSAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIpOwoJCQkgIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIgPSB0aGlzLnVwZGF0ZUJvdW5kc18uYmluZCh0aGlzKTsKCQkJICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIpOwoJCQkgIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5lbmRQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CgkJCSAgICB0aGlzLmRpc3RvcnRlcl8uZGVzdHJveSgpOwoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfID0gbnVsbDsKCQkJICB9CgkJCSAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJXy5kZXN0cm95KCk7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG51bGw7CgkJCSAgfQoJCQkgIGlmICh0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18pIHsKCQkJICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy5oaWRlKCk7CgkJCSAgfQoJCQkgIHRoaXMudmlld2VyU2VsZWN0b3JfLmhpZGUoKTsKCQkJICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9yaWVudGF0aW9uSGFuZGxlcik7CgkJCSAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB0aGlzLnZyZGlzcGxheXByZXNlbnRjaGFuZ2VIYW5kbGVyKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS51cGRhdGVQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKCQkJICB0aGlzLmVuZFByZXNlbnRfKCk7CgkJCSAgdGhpcy5iZWdpblByZXNlbnRfKCk7CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewoJCQkgIGlmICh0aGlzLmRpc3RvcnRlcl8pIHsKCQkJICAgIHRoaXMudXBkYXRlQm91bmRzXygpOwoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfLnN1Ym1pdEZyYW1lKCk7CgkJCSAgfSBlbHNlIGlmICh0aGlzLmNhcmRib2FyZFVJXyAmJiB0aGlzLmxheWVyXykgewoJCQkgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CgkJCSAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKCQkJICAgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwoJCQkgICAgdmFyIGNhbnZhcyA9IGdsLmNhbnZhczsKCQkJICAgIGlmIChjYW52YXMud2lkdGggIT0gdGhpcy5sYXN0V2lkdGggfHwgY2FudmFzLmhlaWdodCAhPSB0aGlzLmxhc3RIZWlnaHQpIHsKCQkJICAgICAgdGhpcy5jYXJkYm9hcmRVSV8ub25SZXNpemUoKTsKCQkJICAgIH0KCQkJICAgIHRoaXMubGFzdFdpZHRoID0gY2FudmFzLndpZHRoOwoJCQkgICAgdGhpcy5sYXN0SGVpZ2h0ID0gY2FudmFzLmhlaWdodDsKCQkJICAgIHRoaXMuY2FyZGJvYXJkVUlfLnJlbmRlcigpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbk9yaWVudGF0aW9uQ2hhbmdlXyA9IGZ1bmN0aW9uIChlKSB7CgkJCSAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uaGlkZSgpOwoJCQkgIGlmICh0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18pIHsKCQkJICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKCQkJICB9CgkJCSAgdGhpcy5vblJlc2l6ZV8oKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblJlc2l6ZV8gPSBmdW5jdGlvbiAoZSkgewoJCQkgIGlmICh0aGlzLmxheWVyXykgewoJCQkgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CgkJCSAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKCQkJICAgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwoJCQkgICAgdmFyIGNzc1Byb3BlcnRpZXMgPSBbJ3Bvc2l0aW9uOiBhYnNvbHV0ZScsICd0b3A6IDAnLCAnbGVmdDogMCcsCgkJCSAgICAnd2lkdGg6IDEwMHZ3JywgJ2hlaWdodDogMTAwdmgnLCAnYm9yZGVyOiAwJywgJ21hcmdpbjogMCcsCgkJCSAgICAncGFkZGluZzogMHB4JywgJ2JveC1zaXppbmc6IGNvbnRlbnQtYm94J107CgkJCSAgICBnbC5jYW52YXMuc2V0QXR0cmlidXRlKCdzdHlsZScsIGNzc1Byb3BlcnRpZXMuam9pbignOyAnKSArICc7Jyk7CgkJCSAgICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChnbC5jYW52YXMpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblZpZXdlckNoYW5nZWRfID0gZnVuY3Rpb24gKHZpZXdlcikgewoJCQkgIHRoaXMuZGV2aWNlSW5mb18uc2V0Vmlld2VyKHZpZXdlcik7CgkJCSAgaWYgKHRoaXMuZGlzdG9ydGVyXykgewoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfLnVwZGF0ZURldmljZUluZm8odGhpcy5kZXZpY2VJbmZvXyk7CgkJCSAgfQoJCQkgIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5maXJlVlJEaXNwbGF5RGV2aWNlUGFyYW1zQ2hhbmdlXyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheWRldmljZXBhcmFtc2NoYW5nZScsIHsKCQkJICAgIGRldGFpbDogewoJCQkgICAgICB2cmRpc3BsYXk6IHRoaXMsCgkJCSAgICAgIGRldmljZUluZm86IHRoaXMuZGV2aWNlSW5mb18KCQkJICAgIH0KCQkJICB9KTsKCQkJICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5WUkZyYW1lRGF0YSA9IFZSRnJhbWVEYXRhOwoJCQlDYXJkYm9hcmRWUkRpc3BsYXkuVlJEaXNwbGF5ID0gVlJEaXNwbGF5OwoJCQlyZXR1cm4gQ2FyZGJvYXJkVlJEaXNwbGF5OwoJCQl9KSkpOwoJCQl9KTsKCQkJdmFyIENhcmRib2FyZFZSRGlzcGxheSA9IHVud3JhcEV4cG9ydHMoY2FyZGJvYXJkVnJEaXNwbGF5KTsKCgkJCXZhciB2ZXJzaW9uID0gIjAuMTAuMTIiOwoKCQkJdmFyIERlZmF1bHRDb25maWcgPSB7CgkJCSAgQURESVRJT05BTF9WSUVXRVJTOiBbXSwKCQkJICBERUZBVUxUX1ZJRVdFUjogJycsCgkJCSAgUFJPVklERV9NT0JJTEVfVlJESVNQTEFZOiB0cnVlLAoJCQkgIE1PQklMRV9XQUtFX0xPQ0s6IHRydWUsCgkJCSAgREVCVUc6IGZhbHNlLAoJCQkgIERQREJfVVJMOiAnaHR0cHM6Ly9kcGRiLndlYnZyLnJvY2tzL2RwZGIuanNvbicsCgkJCSAgS19GSUxURVI6IDAuOTgsCgkJCSAgUFJFRElDVElPTl9USU1FX1M6IDAuMDQwLAoJCQkgIENBUkRCT0FSRF9VSV9ESVNBQkxFRDogZmFsc2UsCgkJCSAgUk9UQVRFX0lOU1RSVUNUSU9OU19ESVNBQkxFRDogZmFsc2UsCgkJCSAgWUFXX09OTFk6IGZhbHNlLAoJCQkgIEJVRkZFUl9TQ0FMRTogMC41LAoJCQkgIERJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUzogZmFsc2UKCQkJfTsKCgkJCWZ1bmN0aW9uIFdlYlZSUG9seWZpbGwoY29uZmlnKSB7CgkJCSAgY29uc29sZS5sb2coInBvbHlmaWxsIGN0b3IiKTsKCQkJICBjb25zb2xlLmxvZyhjb25maWcpOwoJCQkgIHRoaXMuY29uZmlnID0gZXh0ZW5kKGV4dGVuZCh7fSwgRGVmYXVsdENvbmZpZyksIGNvbmZpZyk7CgkJCSAgdGhpcy5wb2x5ZmlsbERpc3BsYXlzID0gW107CgkJCSAgdGhpcy5lbmFibGVkID0gZmFsc2U7CgkJCSAgdGhpcy5oYXNOYXRpdmUgPSAnZ2V0VlJEaXNwbGF5cycgaW4gbmF2aWdhdG9yOwoJCQkgIHRoaXMubmF0aXZlID0ge307CgkJCSAgdGhpcy5uYXRpdmUuZ2V0VlJEaXNwbGF5cyA9IG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzOwoJCQkgIHRoaXMubmF0aXZlLlZSRnJhbWVEYXRhID0gd2luZG93LlZSRnJhbWVEYXRhOwoJCQkgIHRoaXMubmF0aXZlLlZSRGlzcGxheSA9IHdpbmRvdy5WUkRpc3BsYXk7CgkJCSAgaWYgKCF0aGlzLmhhc05hdGl2ZSB8fCB0aGlzLmNvbmZpZy5QUk9WSURFX01PQklMRV9WUkRJU1BMQVkgJiYgaXNNb2JpbGUoKSkgewoJCQkgICAgdGhpcy5lbmFibGUoKTsKCQkJICAgIHRoaXMuZ2V0VlJEaXNwbGF5cygpLnRoZW4oZnVuY3Rpb24gKGRpc3BsYXlzKSB7CgkJCSAgICAgIGlmIChkaXNwbGF5cyAmJiBkaXNwbGF5c1swXSAmJiBkaXNwbGF5c1swXS5maXJlVlJEaXNwbGF5Q29ubmVjdF8pIHsKCQkJICAgICAgICBkaXNwbGF5c1swXS5maXJlVlJEaXNwbGF5Q29ubmVjdF8oKTsKCQkJICAgICAgfQoJCQkgICAgfSk7CgkJCSAgfQoJCQl9CgkJCVdlYlZSUG9seWZpbGwucHJvdG90eXBlLmdldFBvbHlmaWxsRGlzcGxheXMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKHRoaXMuX3BvbHlmaWxsRGlzcGxheXNQb3B1bGF0ZWQpIHsKCQkJICAgIHJldHVybiB0aGlzLnBvbHlmaWxsRGlzcGxheXM7CgkJCSAgfQoJCQkgIGlmIChpc01vYmlsZSgpKSB7CgkJCSAgICB2YXIgdnJEaXNwbGF5ID0gbmV3IENhcmRib2FyZFZSRGlzcGxheSh7CgkJCSAgICAgIEFERElUSU9OQUxfVklFV0VSUzogdGhpcy5jb25maWcuQURESVRJT05BTF9WSUVXRVJTLAoJCQkgICAgICBERUZBVUxUX1ZJRVdFUjogdGhpcy5jb25maWcuREVGQVVMVF9WSUVXRVIsCgkJCSAgICAgIE1PQklMRV9XQUtFX0xPQ0s6IHRoaXMuY29uZmlnLk1PQklMRV9XQUtFX0xPQ0ssCgkJCSAgICAgIERFQlVHOiB0aGlzLmNvbmZpZy5ERUJVRywKCQkJICAgICAgRFBEQl9VUkw6IHRoaXMuY29uZmlnLkRQREJfVVJMLAoJCQkgICAgICBDQVJEQk9BUkRfVUlfRElTQUJMRUQ6IHRoaXMuY29uZmlnLkNBUkRCT0FSRF9VSV9ESVNBQkxFRCwKCQkJICAgICAgS19GSUxURVI6IHRoaXMuY29uZmlnLktfRklMVEVSLAoJCQkgICAgICBQUkVESUNUSU9OX1RJTUVfUzogdGhpcy5jb25maWcuUFJFRElDVElPTl9USU1FX1MsCgkJCSAgICAgIFJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQ6IHRoaXMuY29uZmlnLlJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQsCgkJCSAgICAgIFlBV19PTkxZOiB0aGlzLmNvbmZpZy5ZQVdfT05MWSwKCQkJICAgICAgQlVGRkVSX1NDQUxFOiB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEUsCgkJCSAgICAgIERJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUzogdGhpcy5jb25maWcuRElSVFlfU1VCTUlUX0ZSQU1FX0JJTkRJTkdTCgkJCSAgICB9KTsKCQkJICAgIHRoaXMucG9seWZpbGxEaXNwbGF5cy5wdXNoKHZyRGlzcGxheSk7CgkJCSAgfQoJCQkgIHRoaXMuX3BvbHlmaWxsRGlzcGxheXNQb3B1bGF0ZWQgPSB0cnVlOwoJCQkgIHJldHVybiB0aGlzLnBvbHlmaWxsRGlzcGxheXM7CgkJCX07CgkJCVdlYlZSUG9seWZpbGwucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB0aGlzLmVuYWJsZWQgPSB0cnVlOwoJCQkgIGlmICh0aGlzLmhhc05hdGl2ZSAmJiB0aGlzLm5hdGl2ZS5WUkZyYW1lRGF0YSkgewoJCQkgICAgdmFyIE5hdGl2ZVZSRnJhbWVEYXRhID0gdGhpcy5uYXRpdmUuVlJGcmFtZURhdGE7CgkJCSAgICB2YXIgbmF0aXZlRnJhbWVEYXRhID0gbmV3IHRoaXMubmF0aXZlLlZSRnJhbWVEYXRhKCk7CgkJCSAgICB2YXIgbmF0aXZlR2V0RnJhbWVEYXRhID0gdGhpcy5uYXRpdmUuVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGE7CgkJCSAgICB3aW5kb3cuVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEgPSBmdW5jdGlvbiAoZnJhbWVEYXRhKSB7CgkJCSAgICAgIGlmIChmcmFtZURhdGEgaW5zdGFuY2VvZiBOYXRpdmVWUkZyYW1lRGF0YSkgewoJCQkgICAgICAgIG5hdGl2ZUdldEZyYW1lRGF0YS5jYWxsKHRoaXMsIGZyYW1lRGF0YSk7CgkJCSAgICAgICAgcmV0dXJuOwoJCQkgICAgICB9CgkJCSAgICAgIG5hdGl2ZUdldEZyYW1lRGF0YS5jYWxsKHRoaXMsIG5hdGl2ZUZyYW1lRGF0YSk7CgkJCSAgICAgIGZyYW1lRGF0YS5wb3NlID0gbmF0aXZlRnJhbWVEYXRhLnBvc2U7CgkJCSAgICAgIGNvcHlBcnJheShuYXRpdmVGcmFtZURhdGEubGVmdFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5sZWZ0UHJvamVjdGlvbk1hdHJpeCk7CgkJCSAgICAgIGNvcHlBcnJheShuYXRpdmVGcmFtZURhdGEucmlnaHRQcm9qZWN0aW9uTWF0cml4LCBmcmFtZURhdGEucmlnaHRQcm9qZWN0aW9uTWF0cml4KTsKCQkJICAgICAgY29weUFycmF5KG5hdGl2ZUZyYW1lRGF0YS5sZWZ0Vmlld01hdHJpeCwgZnJhbWVEYXRhLmxlZnRWaWV3TWF0cml4KTsKCQkJICAgICAgY29weUFycmF5KG5hdGl2ZUZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgsIGZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgpOwoJCQkgICAgfTsKCQkJICB9CgkJCSAgbmF2aWdhdG9yLmdldFZSRGlzcGxheXMgPSB0aGlzLmdldFZSRGlzcGxheXMuYmluZCh0aGlzKTsKCQkJICB3aW5kb3cuVlJEaXNwbGF5ID0gQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRGlzcGxheTsKCQkJICB3aW5kb3cuVlJGcmFtZURhdGEgPSBDYXJkYm9hcmRWUkRpc3BsYXkuVlJGcmFtZURhdGE7CgkJCX07CgkJCVdlYlZSUG9seWZpbGwucHJvdG90eXBlLmdldFZSRGlzcGxheXMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIF90aGlzID0gdGhpczsKCQkJICB0aGlzLmNvbmZpZzsKCQkJICBpZiAoIXRoaXMuaGFzTmF0aXZlKSB7CgkJCSAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuZ2V0UG9seWZpbGxEaXNwbGF5cygpKTsKCQkJICB9CgkJCSAgcmV0dXJuIHRoaXMubmF0aXZlLmdldFZSRGlzcGxheXMuY2FsbChuYXZpZ2F0b3IpLnRoZW4oZnVuY3Rpb24gKG5hdGl2ZURpc3BsYXlzKSB7CgkJCSAgICByZXR1cm4gbmF0aXZlRGlzcGxheXMubGVuZ3RoID4gMCA/IG5hdGl2ZURpc3BsYXlzIDogX3RoaXMuZ2V0UG9seWZpbGxEaXNwbGF5cygpOwoJCQkgIH0pOwoJCQl9OwoJCQlXZWJWUlBvbHlmaWxsLnZlcnNpb24gPSB2ZXJzaW9uOwoJCQlXZWJWUlBvbHlmaWxsLlZSRnJhbWVEYXRhID0gQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRnJhbWVEYXRhOwoJCQlXZWJWUlBvbHlmaWxsLlZSRGlzcGxheSA9IENhcmRib2FyZFZSRGlzcGxheS5WUkRpc3BsYXk7CgoKCQkJdmFyIHdlYnZyUG9seWZpbGwgPSBPYmplY3QuZnJlZXplKHsKCQkJCWRlZmF1bHQ6IFdlYlZSUG9seWZpbGwKCQkJfSk7CgoJCQl2YXIgcmVxdWlyZSQkMCA9ICggd2VidnJQb2x5ZmlsbCAmJiBXZWJWUlBvbHlmaWxsICkgfHwgd2VidnJQb2x5ZmlsbDsKCgkJCWlmICh0eXBlb2YgY29tbW9uanNHbG9iYWwkMSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tbW9uanNHbG9iYWwkMS53aW5kb3cpIHsKCQkJICBpZiAoIWNvbW1vbmpzR2xvYmFsJDEuZG9jdW1lbnQpIHsKCQkJICAgIGNvbW1vbmpzR2xvYmFsJDEuZG9jdW1lbnQgPSBjb21tb25qc0dsb2JhbCQxLndpbmRvdy5kb2N1bWVudDsKCQkJICB9CgkJCSAgaWYgKCFjb21tb25qc0dsb2JhbCQxLm5hdmlnYXRvcikgewoJCQkgICAgY29tbW9uanNHbG9iYWwkMS5uYXZpZ2F0b3IgPSBjb21tb25qc0dsb2JhbCQxLndpbmRvdy5uYXZpZ2F0b3I7CgkJCSAgfQoJCQl9CgkJCXZhciBzcmMgPSByZXF1aXJlJCQwOwoKCQkJcmV0dXJuIHNyYzsKCgkJCX0pKSk7IAoJCX0gKHdlYnZyUG9seWZpbGwkMSkpOwoJCXJldHVybiB3ZWJ2clBvbHlmaWxsJDEuZXhwb3J0czsKCX0KCgl2YXIgd2VidnJQb2x5ZmlsbEV4cG9ydHMgPSByZXF1aXJlV2VidnJQb2x5ZmlsbCgpOwoJdmFyIFdlYlZSUG9seWZpbGwgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMod2VidnJQb2x5ZmlsbEV4cG9ydHMpOwoKCS8qKg0KCSAqIEBhdXRob3IgZG1hcmNvcyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9kbWFyY29zDQoJICogQGF1dGhvciBtcmRvb2IgLyBodHRwOi8vbXJkb29iLmNvbQ0KCSAqDQoJICogV2ViVlIgU3BlYzogaHR0cDovL21venZyLmdpdGh1Yi5pby93ZWJ2ci1zcGVjL3dlYnZyLmh0bWwNCgkgKg0KCSAqIEZpcmVmb3g6IGh0dHA6Ly9tb3p2ci5jb20vZG93bmxvYWRzLw0KCSAqIENocm9taXVtOiBodHRwczovL3dlYnZyLmluZm8vZ2V0LWNocm9tZQ0KCSAqLw0KDQoNCgl2YXIgVlJFZmZlY3QgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBvbkVycm9yICkgew0KDQoJICAgIGNvbnNvbGUubG9nKCJbVlJFZmZlY3RdIEluaXQuIik7DQoNCgkgICAgdmFyIHZyRGlzcGxheSwgdnJEaXNwbGF5czsNCgkgICAgdmFyIGV5ZVRyYW5zbGF0aW9uTCA9IG5ldyBWZWN0b3IzKCk7DQoJICAgIHZhciBleWVUcmFuc2xhdGlvblIgPSBuZXcgVmVjdG9yMygpOw0KCSAgICB2YXIgcmVuZGVyUmVjdEwsIHJlbmRlclJlY3RSOw0KCSAgICB2YXIgaGVhZE1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7DQoJICAgIHZhciBleWVNYXRyaXhMID0gbmV3IE1hdHJpeDQoKTsNCgkgICAgdmFyIGV5ZU1hdHJpeFIgPSBuZXcgTWF0cml4NCgpOw0KDQoJICAgIHZhciBmcmFtZURhdGEgPSBudWxsOw0KDQoJICAgIGlmICggJ1ZSRnJhbWVEYXRhJyBpbiB3aW5kb3cgKSB7DQoNCgkgICAgICAgIGZyYW1lRGF0YSA9IG5ldyB3aW5kb3cuVlJGcmFtZURhdGEoKTsNCg0KCSAgICB9DQoNCgkgICAgZnVuY3Rpb24gZ290VlJEaXNwbGF5cyggZGlzcGxheXMgKSB7DQoNCgkgICAgICAgIHZyRGlzcGxheXMgPSBkaXNwbGF5czsNCg0KCSAgICAgICAgaWYgKCBkaXNwbGF5cy5sZW5ndGggPiAwICkgew0KDQoJICAgICAgICAgICAgdnJEaXNwbGF5ID0gZGlzcGxheXNbIDAgXTsNCg0KCSAgICAgICAgfSBlbHNlIHsNCg0KCSAgICAgICAgICAgIGlmICggb25FcnJvciApIG9uRXJyb3IoICdITUQgbm90IGF2YWlsYWJsZScgKTsNCg0KCSAgICAgICAgfQ0KDQoJICAgIH0NCg0KCSAgICBpZiAoIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzICkgew0KDQoJICAgICAgICBuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cygpLnRoZW4oIGdvdFZSRGlzcGxheXMgKS5jYXRjaCggZnVuY3Rpb24gKCkgew0KDQoJICAgICAgICAgICAgY29uc29sZS53YXJuKCAnVEhSRUUuVlJFZmZlY3Q6IFVuYWJsZSB0byBnZXQgVlIgRGlzcGxheXMnICk7DQoNCgkgICAgICAgIH0gKTsNCg0KCSAgICB9DQoNCgkgICAgLy8NCg0KCSAgICB0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOw0KDQoJICAgIHZhciBzY29wZSA9IHRoaXM7DQoNCgkgICAgdmFyIHJlbmRlcmVyU2l6ZSA9IG5ldyBWZWN0b3IyKCk7DQoJICAgIHJlbmRlcmVyU2l6ZSA9IHJlbmRlcmVyLmdldFNpemUocmVuZGVyZXJTaXplKTsNCgkgICAgdmFyIHJlbmRlcmVyVXBkYXRlU3R5bGUgPSBmYWxzZTsNCgkgICAgdmFyIHJlbmRlcmVyUGl4ZWxSYXRpbyA9IHJlbmRlcmVyLmdldFBpeGVsUmF0aW8oKTsNCg0KCSAgICB0aGlzLmdldFZSRGlzcGxheSA9IGZ1bmN0aW9uICgpIHsNCg0KCSAgICAgICAgcmV0dXJuIHZyRGlzcGxheTsNCg0KCSAgICB9Ow0KDQoJICAgIHRoaXMuc2V0VlJEaXNwbGF5ID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsNCg0KCSAgICAgICAgdnJEaXNwbGF5ID0gdmFsdWU7DQoNCgkgICAgfTsNCg0KCSAgICB0aGlzLmdldFZSRGlzcGxheXMgPSBmdW5jdGlvbiAoKSB7DQoNCgkgICAgICAgIGNvbnNvbGUud2FybiggJ1RIUkVFLlZSRWZmZWN0OiBnZXRWUkRpc3BsYXlzKCkgaXMgYmVpbmcgZGVwcmVjYXRlZC4nICk7DQoJICAgICAgICByZXR1cm4gdnJEaXNwbGF5czsNCg0KCSAgICB9Ow0KDQoJICAgIHRoaXMuc2V0U2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgdXBkYXRlU3R5bGUgKSB7DQoNCgkgICAgICAgIHJlbmRlcmVyU2l6ZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCB9Ow0KCSAgICAgICAgcmVuZGVyZXJVcGRhdGVTdHlsZSA9IHVwZGF0ZVN0eWxlOw0KDQoJICAgICAgICBpZiAoIHNjb3BlLmlzUHJlc2VudGluZyApIHsNCg0KCSAgICAgICAgICAgIHZhciBleWVQYXJhbXNMID0gdnJEaXNwbGF5LmdldEV5ZVBhcmFtZXRlcnMoICdsZWZ0JyApOw0KCSAgICAgICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIDEgKTsNCgkgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKCBleWVQYXJhbXNMLnJlbmRlcldpZHRoICogMiwgZXllUGFyYW1zTC5yZW5kZXJIZWlnaHQsIGZhbHNlICk7DQoNCgkgICAgICAgIH0gZWxzZSB7DQoNCgkgICAgICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKCByZW5kZXJlclBpeGVsUmF0aW8gKTsNCgkgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKCB3aWR0aCwgaGVpZ2h0LCB1cGRhdGVTdHlsZSApOw0KDQoJICAgICAgICB9DQoNCgkgICAgfTsNCg0KCSAgICAvLyBWUiBwcmVzZW50YXRpb24NCg0KCSAgICB2YXIgY2FudmFzID0gcmVuZGVyZXIuZG9tRWxlbWVudDsNCgkgICAgdmFyIGRlZmF1bHRMZWZ0Qm91bmRzID0gWyAwLjAsIDAuMCwgMC41LCAxLjAgXTsNCgkgICAgdmFyIGRlZmF1bHRSaWdodEJvdW5kcyA9IFsgMC41LCAwLjAsIDAuNSwgMS4wIF07DQoNCgkgICAgZnVuY3Rpb24gb25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlKCkgew0KDQoJICAgICAgICB2YXIgd2FzUHJlc2VudGluZyA9IHNjb3BlLmlzUHJlc2VudGluZzsNCgkgICAgICAgIHNjb3BlLmlzUHJlc2VudGluZyA9IHZyRGlzcGxheSAhPT0gdW5kZWZpbmVkICYmIHZyRGlzcGxheS5pc1ByZXNlbnRpbmc7DQoNCgkgICAgICAgIGlmICggc2NvcGUuaXNQcmVzZW50aW5nICkgew0KDQoJICAgICAgICAgICAgdmFyIGV5ZVBhcmFtc0wgPSB2ckRpc3BsYXkuZ2V0RXllUGFyYW1ldGVycyggJ2xlZnQnICk7DQoJICAgICAgICAgICAgdmFyIGV5ZVdpZHRoID0gZXllUGFyYW1zTC5yZW5kZXJXaWR0aDsNCgkgICAgICAgICAgICB2YXIgZXllSGVpZ2h0ID0gZXllUGFyYW1zTC5yZW5kZXJIZWlnaHQ7DQoNCgkgICAgICAgICAgICBpZiAoICEgd2FzUHJlc2VudGluZyApIHsNCg0KCSAgICAgICAgICAgICAgICByZW5kZXJlclBpeGVsUmF0aW8gPSByZW5kZXJlci5nZXRQaXhlbFJhdGlvKCk7DQoJICAgICAgICAgICAgICAgIHJlbmRlcmVyU2l6ZSA9IHJlbmRlcmVyLmdldFNpemUobmV3IFZlY3RvcjIoKSk7DQoNCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggMSApOw0KCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKCBleWVXaWR0aCAqIDIsIGV5ZUhlaWdodCwgZmFsc2UgKTsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgfSBlbHNlIGlmICggd2FzUHJlc2VudGluZyApIHsNCg0KCSAgICAgICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIHJlbmRlcmVyUGl4ZWxSYXRpbyApOw0KCSAgICAgICAgICAgIHJlbmRlcmVyLnNldFNpemUoIHJlbmRlcmVyU2l6ZS53aWR0aCwgcmVuZGVyZXJTaXplLmhlaWdodCwgcmVuZGVyZXJVcGRhdGVTdHlsZSApOw0KDQoJICAgICAgICB9DQoNCgkgICAgfQ0KDQoJICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSwgZmFsc2UgKTsNCg0KCSAgICB0aGlzLnNldEZ1bGxTY3JlZW4gPSBmdW5jdGlvbiAoIGJvb2xlYW4gKSB7DQoNCgkgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7DQoNCgkgICAgICAgICAgICBpZiAoIHZyRGlzcGxheSA9PT0gdW5kZWZpbmVkICkgew0KDQoJICAgICAgICAgICAgICAgIHJlamVjdCggbmV3IEVycm9yKCAnTm8gVlIgaGFyZHdhcmUgZm91bmQuJyApICk7DQoJICAgICAgICAgICAgICAgIHJldHVybjsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgICAgIGlmICggc2NvcGUuaXNQcmVzZW50aW5nID09PSBib29sZWFuICkgew0KDQoJICAgICAgICAgICAgICAgIHJlc29sdmUoKTsNCgkgICAgICAgICAgICAgICAgcmV0dXJuOw0KDQoJICAgICAgICAgICAgfQ0KDQoJICAgICAgICAgICAgaWYgKCBib29sZWFuICkgew0KDQoJICAgICAgICAgICAgICAgIHJlc29sdmUoIHZyRGlzcGxheS5yZXF1ZXN0UHJlc2VudCggWyB7IHNvdXJjZTogY2FudmFzIH0gXSApICk7DQoNCgkgICAgICAgICAgICB9IGVsc2Ugew0KDQoJICAgICAgICAgICAgICAgIHJlc29sdmUoIHZyRGlzcGxheS5leGl0UHJlc2VudCgpICk7DQoNCgkgICAgICAgICAgICB9DQoNCgkgICAgICAgIH0gKTsNCg0KCSAgICB9Ow0KDQoJICAgIHRoaXMucmVxdWVzdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7DQoNCgkgICAgICAgIHJldHVybiB0aGlzLnNldEZ1bGxTY3JlZW4oIHRydWUgKTsNCg0KCSAgICB9Ow0KDQoJICAgIHRoaXMuZXhpdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7DQoNCgkgICAgICAgIHJldHVybiB0aGlzLnNldEZ1bGxTY3JlZW4oIGZhbHNlICk7DQoNCgkgICAgfTsNCg0KCSAgICB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uICggZiApIHsNCg0KCSAgICAgICAgaWYgKCB2ckRpc3BsYXkgIT09IHVuZGVmaW5lZCApIHsNCg0KCSAgICAgICAgICAgIHJldHVybiB2ckRpc3BsYXkucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBmICk7DQoNCgkgICAgICAgIH0gZWxzZSB7DQoNCgkgICAgICAgICAgICByZXR1cm4gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSggZiApOw0KDQoJICAgICAgICB9DQoNCgkgICAgfTsNCg0KCSAgICB0aGlzLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKCBoICkgew0KDQoJICAgICAgICBpZiAoIHZyRGlzcGxheSAhPT0gdW5kZWZpbmVkICkgew0KDQoJICAgICAgICAgICAgdnJEaXNwbGF5LmNhbmNlbEFuaW1hdGlvbkZyYW1lKCBoICk7DQoNCgkgICAgICAgIH0gZWxzZSB7DQoNCgkgICAgICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUoIGggKTsNCg0KCSAgICAgICAgfQ0KDQoJICAgIH07DQoNCgkgICAgdGhpcy5zdWJtaXRGcmFtZSA9IGZ1bmN0aW9uICgpIHsNCg0KCSAgICAgICAgaWYgKCB2ckRpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pc1ByZXNlbnRpbmcgKSB7DQoNCgkgICAgICAgICAgICB2ckRpc3BsYXkuc3VibWl0RnJhbWUoKTsNCg0KCSAgICAgICAgfQ0KDQoJICAgIH07DQoNCgkgICAgdGhpcy5hdXRvU3VibWl0RnJhbWUgPSB0cnVlOw0KDQoJICAgIC8vIHJlbmRlcg0KDQoJICAgIHZhciBjYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7DQoJICAgIGNhbWVyYUwubGF5ZXJzLmVuYWJsZSggMSApOw0KDQoJICAgIHZhciBjYW1lcmFSID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7DQoJICAgIGNhbWVyYVIubGF5ZXJzLmVuYWJsZSggMiApOw0KDQoJICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhLCByZW5kZXJUYXJnZXQsIGZvcmNlQ2xlYXIgKSB7DQoNCgkgICAgICAgIGlmICggdnJEaXNwbGF5ICYmIHNjb3BlLmlzUHJlc2VudGluZyApIHsNCg0KCSAgICAgICAgICAgIHZhciBhdXRvVXBkYXRlID0gc2NlbmUuYXV0b1VwZGF0ZTsNCg0KCSAgICAgICAgICAgIGlmICggYXV0b1VwZGF0ZSApIHsNCg0KCSAgICAgICAgICAgICAgICBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpOw0KCSAgICAgICAgICAgICAgICBzY2VuZS5hdXRvVXBkYXRlID0gZmFsc2U7DQoNCgkgICAgICAgICAgICB9DQoNCgkgICAgICAgICAgICBpZiAoIEFycmF5LmlzQXJyYXkoIHNjZW5lICkgKSB7DQoNCgkgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCAnVEhSRUUuVlJFZmZlY3QucmVuZGVyKCkgbm8gbG9uZ2VyIHN1cHBvcnRzIGFycmF5cy4gVXNlIG9iamVjdC5sYXllcnMgaW5zdGVhZC4nICk7DQoJICAgICAgICAgICAgICAgIHNjZW5lID0gc2NlbmVbIDAgXTsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgICAgIC8vIFdoZW4gcmVuZGVyaW5nIHdlIGRvbid0IGNhcmUgd2hhdCB0aGUgcmVjb21tZW5kZWQgc2l6ZSBpcywgb25seSB3aGF0IHRoZSBhY3R1YWwgc2l6ZQ0KCSAgICAgICAgICAgIC8vIG9mIHRoZSBiYWNrYnVmZmVyIGlzLg0KCSAgICAgICAgICAgIHZhciBzaXplID0gcmVuZGVyZXIuZ2V0U2l6ZShuZXcgVmVjdG9yMigpKTsNCgkgICAgICAgICAgICB2YXIgbGF5ZXJzID0gdnJEaXNwbGF5LmdldExheWVycygpOw0KCSAgICAgICAgICAgIHZhciBsZWZ0Qm91bmRzOw0KCSAgICAgICAgICAgIHZhciByaWdodEJvdW5kczsNCg0KCSAgICAgICAgICAgIGlmICggbGF5ZXJzLmxlbmd0aCApIHsNCg0KCSAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSBsYXllcnNbIDAgXTsNCg0KCSAgICAgICAgICAgICAgICBsZWZ0Qm91bmRzID0gbGF5ZXIubGVmdEJvdW5kcyAhPT0gbnVsbCAmJiBsYXllci5sZWZ0Qm91bmRzLmxlbmd0aCA9PT0gNCA/IGxheWVyLmxlZnRCb3VuZHMgOiBkZWZhdWx0TGVmdEJvdW5kczsNCgkgICAgICAgICAgICAgICAgcmlnaHRCb3VuZHMgPSBsYXllci5yaWdodEJvdW5kcyAhPT0gbnVsbCAmJiBsYXllci5yaWdodEJvdW5kcy5sZW5ndGggPT09IDQgPyBsYXllci5yaWdodEJvdW5kcyA6IGRlZmF1bHRSaWdodEJvdW5kczsNCg0KCSAgICAgICAgICAgIH0gZWxzZSB7DQoNCgkgICAgICAgICAgICAgICAgbGVmdEJvdW5kcyA9IGRlZmF1bHRMZWZ0Qm91bmRzOw0KCSAgICAgICAgICAgICAgICByaWdodEJvdW5kcyA9IGRlZmF1bHRSaWdodEJvdW5kczsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgICAgIHJlbmRlclJlY3RMID0gew0KCSAgICAgICAgICAgICAgICB4OiBNYXRoLnJvdW5kKCBzaXplLndpZHRoICogbGVmdEJvdW5kc1sgMCBdICksDQoJICAgICAgICAgICAgICAgIHk6IE1hdGgucm91bmQoIHNpemUuaGVpZ2h0ICogbGVmdEJvdW5kc1sgMSBdICksDQoJICAgICAgICAgICAgICAgIHdpZHRoOiBNYXRoLnJvdW5kKCBzaXplLndpZHRoICogbGVmdEJvdW5kc1sgMiBdICksDQoJICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCggc2l6ZS5oZWlnaHQgKiBsZWZ0Qm91bmRzWyAzIF0gKQ0KCSAgICAgICAgICAgIH07DQoJICAgICAgICAgICAgcmVuZGVyUmVjdFIgPSB7DQoJICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQoIHNpemUud2lkdGggKiByaWdodEJvdW5kc1sgMCBdICksDQoJICAgICAgICAgICAgICAgIHk6IE1hdGgucm91bmQoIHNpemUuaGVpZ2h0ICogcmlnaHRCb3VuZHNbIDEgXSApLA0KCSAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZCggc2l6ZS53aWR0aCAqIHJpZ2h0Qm91bmRzWyAyIF0gKSwNCgkgICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKCBzaXplLmhlaWdodCAqIHJpZ2h0Qm91bmRzWyAzIF0gKQ0KCSAgICAgICAgICAgIH07DQoNCgkgICAgICAgICAgICBpZiAoIHJlbmRlclRhcmdldCApIHsNCg0KCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApOw0KCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSB0cnVlOw0KDQoJICAgICAgICAgICAgfSBlbHNlIHsNCg0KCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIG51bGwgKTsNCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2Npc3NvclRlc3QoIHRydWUgKTsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgICAgIGlmICggcmVuZGVyZXIuYXV0b0NsZWFyIHx8IGZvcmNlQ2xlYXIgKSByZW5kZXJlci5jbGVhcigpOw0KDQoJICAgICAgICAgICAgaWYgKCBjYW1lcmEucGFyZW50ID09PSBudWxsICkgY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7DQoNCgkgICAgICAgICAgICBjYW1lcmEubWF0cml4V29ybGQuZGVjb21wb3NlKCBjYW1lcmFMLnBvc2l0aW9uLCBjYW1lcmFMLnF1YXRlcm5pb24sIGNhbWVyYUwuc2NhbGUgKTsNCg0KCSAgICAgICAgICAgIGNhbWVyYVIucG9zaXRpb24uY29weSggY2FtZXJhTC5wb3NpdGlvbiApOw0KCSAgICAgICAgICAgIGNhbWVyYVIucXVhdGVybmlvbi5jb3B5KCBjYW1lcmFMLnF1YXRlcm5pb24gKTsNCgkgICAgICAgICAgICBjYW1lcmFSLnNjYWxlLmNvcHkoIGNhbWVyYUwuc2NhbGUgKTsNCg0KCSAgICAgICAgICAgIGlmICggdnJEaXNwbGF5LmdldEZyYW1lRGF0YSApIHsNCg0KCSAgICAgICAgICAgICAgICB2ckRpc3BsYXkuZGVwdGhOZWFyID0gY2FtZXJhLm5lYXI7DQoJICAgICAgICAgICAgICAgIHZyRGlzcGxheS5kZXB0aEZhciA9IGNhbWVyYS5mYXI7DQoNCgkgICAgICAgICAgICAgICAgdnJEaXNwbGF5LmdldEZyYW1lRGF0YSggZnJhbWVEYXRhICk7DQoNCgkgICAgICAgICAgICAgICAgY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzID0gZnJhbWVEYXRhLmxlZnRQcm9qZWN0aW9uTWF0cml4Ow0KCSAgICAgICAgICAgICAgICBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHMgPSBmcmFtZURhdGEucmlnaHRQcm9qZWN0aW9uTWF0cml4Ow0KDQoJICAgICAgICAgICAgICAgIGdldEV5ZU1hdHJpY2VzKCBmcmFtZURhdGEgKTsNCg0KCSAgICAgICAgICAgICAgICBjYW1lcmFMLnVwZGF0ZU1hdHJpeCgpOw0KCSAgICAgICAgICAgICAgICBjYW1lcmFMLm1hdHJpeC5tdWx0aXBseSggZXllTWF0cml4TCApOw0KCSAgICAgICAgICAgICAgICBjYW1lcmFMLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYUwucG9zaXRpb24sIGNhbWVyYUwucXVhdGVybmlvbiwgY2FtZXJhTC5zY2FsZSApOw0KDQoJICAgICAgICAgICAgICAgIGNhbWVyYVIudXBkYXRlTWF0cml4KCk7DQoJICAgICAgICAgICAgICAgIGNhbWVyYVIubWF0cml4Lm11bHRpcGx5KCBleWVNYXRyaXhSICk7DQoJICAgICAgICAgICAgICAgIGNhbWVyYVIubWF0cml4LmRlY29tcG9zZSggY2FtZXJhUi5wb3NpdGlvbiwgY2FtZXJhUi5xdWF0ZXJuaW9uLCBjYW1lcmFSLnNjYWxlICk7DQoNCgkgICAgICAgICAgICB9IGVsc2Ugew0KDQoJICAgICAgICAgICAgICAgIHZhciBleWVQYXJhbXNMID0gdnJEaXNwbGF5LmdldEV5ZVBhcmFtZXRlcnMoICdsZWZ0JyApOw0KCSAgICAgICAgICAgICAgICB2YXIgZXllUGFyYW1zUiA9IHZyRGlzcGxheS5nZXRFeWVQYXJhbWV0ZXJzKCAncmlnaHQnICk7DQoNCgkgICAgICAgICAgICAgICAgY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ID0gZm92VG9Qcm9qZWN0aW9uKCBleWVQYXJhbXNMLmZpZWxkT2ZWaWV3LCB0cnVlLCBjYW1lcmEubmVhciwgY2FtZXJhLmZhciApOw0KCSAgICAgICAgICAgICAgICBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXggPSBmb3ZUb1Byb2plY3Rpb24oIGV5ZVBhcmFtc1IuZmllbGRPZlZpZXcsIHRydWUsIGNhbWVyYS5uZWFyLCBjYW1lcmEuZmFyICk7DQoNCgkgICAgICAgICAgICAgICAgZXllVHJhbnNsYXRpb25MLmZyb21BcnJheSggZXllUGFyYW1zTC5vZmZzZXQgKTsNCgkgICAgICAgICAgICAgICAgZXllVHJhbnNsYXRpb25SLmZyb21BcnJheSggZXllUGFyYW1zUi5vZmZzZXQgKTsNCg0KCSAgICAgICAgICAgICAgICBjYW1lcmFMLnRyYW5zbGF0ZU9uQXhpcyggZXllVHJhbnNsYXRpb25MLCBjYW1lcmFMLnNjYWxlLnggKTsNCgkgICAgICAgICAgICAgICAgY2FtZXJhUi50cmFuc2xhdGVPbkF4aXMoIGV5ZVRyYW5zbGF0aW9uUiwgY2FtZXJhUi5zY2FsZS54ICk7DQoNCgkgICAgICAgICAgICB9DQoNCgkgICAgICAgICAgICAvLyByZW5kZXIgbGVmdCBleWUNCgkgICAgICAgICAgICBpZiAoIHJlbmRlclRhcmdldCApIHsNCg0KCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQudmlld3BvcnQuc2V0KCByZW5kZXJSZWN0TC54LCByZW5kZXJSZWN0TC55LCByZW5kZXJSZWN0TC53aWR0aCwgcmVuZGVyUmVjdEwuaGVpZ2h0ICk7DQoJICAgICAgICAgICAgICAgIHJlbmRlclRhcmdldC5zY2lzc29yLnNldCggcmVuZGVyUmVjdEwueCwgcmVuZGVyUmVjdEwueSwgcmVuZGVyUmVjdEwud2lkdGgsIHJlbmRlclJlY3RMLmhlaWdodCApOw0KDQoJICAgICAgICAgICAgfSBlbHNlIHsNCg0KCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRWaWV3cG9ydCggcmVuZGVyUmVjdEwueCwgcmVuZGVyUmVjdEwueSwgcmVuZGVyUmVjdEwud2lkdGgsIHJlbmRlclJlY3RMLmhlaWdodCApOw0KCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTY2lzc29yKCByZW5kZXJSZWN0TC54LCByZW5kZXJSZWN0TC55LCByZW5kZXJSZWN0TC53aWR0aCwgcmVuZGVyUmVjdEwuaGVpZ2h0ICk7DQoNCgkgICAgICAgICAgICB9DQoJICAgICAgICAgICAgcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTCwgcmVuZGVyVGFyZ2V0LCBmb3JjZUNsZWFyICk7DQoNCgkgICAgICAgICAgICAvLyByZW5kZXIgcmlnaHQgZXllDQoJICAgICAgICAgICAgaWYgKCByZW5kZXJUYXJnZXQgKSB7DQoNCgkgICAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0LnZpZXdwb3J0LnNldCggcmVuZGVyUmVjdFIueCwgcmVuZGVyUmVjdFIueSwgcmVuZGVyUmVjdFIud2lkdGgsIHJlbmRlclJlY3RSLmhlaWdodCApOw0KCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuc2Npc3Nvci5zZXQoIHJlbmRlclJlY3RSLngsIHJlbmRlclJlY3RSLnksIHJlbmRlclJlY3RSLndpZHRoLCByZW5kZXJSZWN0Ui5oZWlnaHQgKTsNCg0KCSAgICAgICAgICAgIH0gZWxzZSB7DQoNCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0Vmlld3BvcnQoIHJlbmRlclJlY3RSLngsIHJlbmRlclJlY3RSLnksIHJlbmRlclJlY3RSLndpZHRoLCByZW5kZXJSZWN0Ui5oZWlnaHQgKTsNCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2Npc3NvciggcmVuZGVyUmVjdFIueCwgcmVuZGVyUmVjdFIueSwgcmVuZGVyUmVjdFIud2lkdGgsIHJlbmRlclJlY3RSLmhlaWdodCApOw0KDQoJICAgICAgICAgICAgfQ0KCSAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVIsIHJlbmRlclRhcmdldCwgZm9yY2VDbGVhciApOw0KDQoJICAgICAgICAgICAgaWYgKCByZW5kZXJUYXJnZXQgKSB7DQoNCgkgICAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0LnZpZXdwb3J0LnNldCggMCwgMCwgc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQgKTsNCgkgICAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0LnNjaXNzb3Iuc2V0KCAwLCAwLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCApOw0KCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsNCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBudWxsICk7DQoNCgkgICAgICAgICAgICB9IGVsc2Ugew0KDQoJICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KCAwLCAwLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCApOw0KCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTY2lzc29yVGVzdCggZmFsc2UgKTsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgICAgIGlmICggYXV0b1VwZGF0ZSApIHsNCg0KCSAgICAgICAgICAgICAgICBzY2VuZS5hdXRvVXBkYXRlID0gdHJ1ZTsNCg0KCSAgICAgICAgICAgIH0NCg0KCSAgICAgICAgICAgIGlmICggc2NvcGUuYXV0b1N1Ym1pdEZyYW1lICkgew0KDQoJICAgICAgICAgICAgICAgIHNjb3BlLnN1Ym1pdEZyYW1lKCk7DQoNCgkgICAgICAgICAgICB9DQoNCgkgICAgICAgICAgICByZXR1cm47DQoNCgkgICAgICAgIH0NCg0KCSAgICAgICAgLy8gUmVndWxhciByZW5kZXIgbW9kZSBpZiBub3QgSE1EDQoNCgkgICAgICAgIHJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYSwgcmVuZGVyVGFyZ2V0LCBmb3JjZUNsZWFyICk7DQoNCgkgICAgfTsNCg0KCSAgICB0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQoNCgkgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCAndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSwgZmFsc2UgKTsNCg0KCSAgICB9Ow0KDQoJICAgIC8vDQoNCgkgICAgdmFyIHBvc2VPcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7DQoJICAgIHZhciBwb3NlUG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOw0KDQoJICAgIC8vIENvbXB1dGUgbW9kZWwgbWF0cmljZXMgb2YgdGhlIGV5ZXMgd2l0aCByZXNwZWN0IHRvIHRoZSBoZWFkLg0KCSAgICBmdW5jdGlvbiBnZXRFeWVNYXRyaWNlcyggZnJhbWVEYXRhICkgew0KDQoJICAgICAgICAvLyBDb21wdXRlIHRoZSBtYXRyaXggZm9yIHRoZSBwb3NpdGlvbiBvZiB0aGUgaGVhZCBiYXNlZCBvbiB0aGUgcG9zZQ0KCSAgICAgICAgaWYgKCBmcmFtZURhdGEucG9zZS5vcmllbnRhdGlvbiApIHsNCg0KCSAgICAgICAgICAgIHBvc2VPcmllbnRhdGlvbi5mcm9tQXJyYXkoIGZyYW1lRGF0YS5wb3NlLm9yaWVudGF0aW9uICk7DQoJICAgICAgICAgICAgaGVhZE1hdHJpeC5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcG9zZU9yaWVudGF0aW9uICk7DQoNCgkgICAgICAgIH0JZWxzZSB7DQoNCgkgICAgICAgICAgICBoZWFkTWF0cml4LmlkZW50aXR5KCk7DQoNCgkgICAgICAgIH0NCg0KCSAgICAgICAgaWYgKCBmcmFtZURhdGEucG9zZS5wb3NpdGlvbiApIHsNCg0KCSAgICAgICAgICAgIHBvc2VQb3NpdGlvbi5mcm9tQXJyYXkoIGZyYW1lRGF0YS5wb3NlLnBvc2l0aW9uICk7DQoJICAgICAgICAgICAgaGVhZE1hdHJpeC5zZXRQb3NpdGlvbiggcG9zZVBvc2l0aW9uICk7DQoNCgkgICAgICAgIH0NCg0KCSAgICAgICAgLy8gVGhlIHZpZXcgbWF0cml4IHRyYW5zZm9ybXMgdmVydGljZXMgZnJvbSBzaXR0aW5nIHNwYWNlIHRvIGV5ZSBzcGFjZS4gQXMgc3VjaCwgdGhlIHZpZXcgbWF0cml4IGNhbiBiZSB0aG91Z2h0IG9mIGFzIGEgcHJvZHVjdCBvZiB0d28gbWF0cmljZXM6DQoJICAgICAgICAvLyBoZWFkVG9FeWVNYXRyaXggKiBzaXR0aW5nVG9IZWFkTWF0cml4DQoNCgkgICAgICAgIC8vIFRoZSBoZWFkTWF0cml4IHRoYXQgd2UndmUgY2FsY3VsYXRlZCBhYm92ZSBpcyB0aGUgbW9kZWwgbWF0cml4IG9mIHRoZSBoZWFkIGluIHNpdHRpbmcgc3BhY2UsIHdoaWNoIGlzIHRoZSBpbnZlcnNlIG9mIHNpdHRpbmdUb0hlYWRNYXRyaXguDQoJICAgICAgICAvLyBTbyB3aGVuIHdlIG11bHRpcGx5IHRoZSB2aWV3IG1hdHJpeCB3aXRoIGhlYWRNYXRyaXgsIHdlJ3JlIGxlZnQgd2l0aCBoZWFkVG9FeWVNYXRyaXg6DQoJICAgICAgICAvLyB2aWV3TWF0cml4ICogaGVhZE1hdHJpeCA9IGhlYWRUb0V5ZU1hdHJpeCAqIHNpdHRpbmdUb0hlYWRNYXRyaXggKiBoZWFkTWF0cml4ID0gaGVhZFRvRXllTWF0cml4DQoNCgkgICAgICAgIGV5ZU1hdHJpeEwuZnJvbUFycmF5KCBmcmFtZURhdGEubGVmdFZpZXdNYXRyaXggKTsNCgkgICAgICAgIGV5ZU1hdHJpeEwubXVsdGlwbHkoIGhlYWRNYXRyaXggKTsNCgkgICAgICAgIGV5ZU1hdHJpeFIuZnJvbUFycmF5KCBmcmFtZURhdGEucmlnaHRWaWV3TWF0cml4ICk7DQoJICAgICAgICBleWVNYXRyaXhSLm11bHRpcGx5KCBoZWFkTWF0cml4ICk7DQoNCgkgICAgICAgIC8vIFRoZSBleWUncyBtb2RlbCBtYXRyaXggaW4gaGVhZCBzcGFjZSBpcyB0aGUgaW52ZXJzZSBvZiBoZWFkVG9FeWVNYXRyaXggd2UgY2FsY3VsYXRlZCBhYm92ZS4NCg0KCSAgICAgICAgZXllTWF0cml4TCA9IGV5ZU1hdHJpeEwuaW52ZXJ0KCk7DQoJICAgICAgICBleWVNYXRyaXhSID0gZXllTWF0cml4Ui5pbnZlcnQoKTsNCg0KCSAgICB9DQoNCgkgICAgZnVuY3Rpb24gZm92VG9ORENTY2FsZU9mZnNldCggZm92ICkgew0KDQoJICAgICAgICB2YXIgcHhzY2FsZSA9IDIuMCAvICggZm92LmxlZnRUYW4gKyBmb3YucmlnaHRUYW4gKTsNCgkgICAgICAgIHZhciBweG9mZnNldCA9ICggZm92LmxlZnRUYW4gLSBmb3YucmlnaHRUYW4gKSAqIHB4c2NhbGUgKiAwLjU7DQoJICAgICAgICB2YXIgcHlzY2FsZSA9IDIuMCAvICggZm92LnVwVGFuICsgZm92LmRvd25UYW4gKTsNCgkgICAgICAgIHZhciBweW9mZnNldCA9ICggZm92LnVwVGFuIC0gZm92LmRvd25UYW4gKSAqIHB5c2NhbGUgKiAwLjU7DQoJICAgICAgICByZXR1cm4geyBzY2FsZTogWyBweHNjYWxlLCBweXNjYWxlIF0sIG9mZnNldDogWyBweG9mZnNldCwgcHlvZmZzZXQgXSB9Ow0KDQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBmb3ZQb3J0VG9Qcm9qZWN0aW9uKCBmb3YsIHJpZ2h0SGFuZGVkLCB6TmVhciwgekZhciApIHsNCg0KCSAgICAgICAgcmlnaHRIYW5kZWQgPSByaWdodEhhbmRlZCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IHJpZ2h0SGFuZGVkOw0KCSAgICAgICAgek5lYXIgPSB6TmVhciA9PT0gdW5kZWZpbmVkID8gMC4wMSA6IHpOZWFyOw0KCSAgICAgICAgekZhciA9IHpGYXIgPT09IHVuZGVmaW5lZCA/IDEwMDAwLjAgOiB6RmFyOw0KDQoJICAgICAgICB2YXIgaGFuZGVkbmVzc1NjYWxlID0gcmlnaHRIYW5kZWQgPyAtMSA6IDEuMDsNCg0KCSAgICAgICAgLy8gc3RhcnQgd2l0aCBhbiBpZGVudGl0eSBtYXRyaXgNCgkgICAgICAgIHZhciBtb2JqID0gbmV3IE1hdHJpeDQoKTsNCgkgICAgICAgIHZhciBtID0gbW9iai5lbGVtZW50czsNCg0KCSAgICAgICAgLy8gYW5kIHdpdGggc2NhbGUvb2Zmc2V0IGluZm8gZm9yIG5vcm1hbGl6ZWQgZGV2aWNlIGNvb3Jkcw0KCSAgICAgICAgdmFyIHNjYWxlQW5kT2Zmc2V0ID0gZm92VG9ORENTY2FsZU9mZnNldCggZm92ICk7DQoNCgkgICAgICAgIC8vIFggcmVzdWx0LCBtYXAgY2xpcCBlZGdlcyB0byBbLXcsK3ddDQoJICAgICAgICBtWyAwICogNCArIDAgXSA9IHNjYWxlQW5kT2Zmc2V0LnNjYWxlWyAwIF07DQoJICAgICAgICBtWyAwICogNCArIDEgXSA9IDAuMDsNCgkgICAgICAgIG1bIDAgKiA0ICsgMiBdID0gc2NhbGVBbmRPZmZzZXQub2Zmc2V0WyAwIF0gKiBoYW5kZWRuZXNzU2NhbGU7DQoJICAgICAgICBtWyAwICogNCArIDMgXSA9IDAuMDsNCg0KCSAgICAgICAgLy8gWSByZXN1bHQsIG1hcCBjbGlwIGVkZ2VzIHRvIFstdywrd10NCgkgICAgICAgIC8vIFkgb2Zmc2V0IGlzIG5lZ2F0ZWQgYmVjYXVzZSB0aGlzIHByb2ogbWF0cml4IHRyYW5zZm9ybXMgZnJvbSB3b3JsZCBjb29yZHMgd2l0aCBZPXVwLA0KCSAgICAgICAgLy8gYnV0IHRoZSBOREMgc2NhbGluZyBoYXMgWT1kb3duICh0aGFua3MgRDNEPykNCgkgICAgICAgIG1bIDEgKiA0ICsgMCBdID0gMC4wOw0KCSAgICAgICAgbVsgMSAqIDQgKyAxIF0gPSBzY2FsZUFuZE9mZnNldC5zY2FsZVsgMSBdOw0KCSAgICAgICAgbVsgMSAqIDQgKyAyIF0gPSAtIHNjYWxlQW5kT2Zmc2V0Lm9mZnNldFsgMSBdICogaGFuZGVkbmVzc1NjYWxlOw0KCSAgICAgICAgbVsgMSAqIDQgKyAzIF0gPSAwLjA7DQoNCgkgICAgICAgIC8vIFogcmVzdWx0ICh1cCB0byB0aGUgYXBwKQ0KCSAgICAgICAgbVsgMiAqIDQgKyAwIF0gPSAwLjA7DQoJICAgICAgICBtWyAyICogNCArIDEgXSA9IDAuMDsNCgkgICAgICAgIG1bIDIgKiA0ICsgMiBdID0gekZhciAvICggek5lYXIgLSB6RmFyICkgKiAtIGhhbmRlZG5lc3NTY2FsZTsNCgkgICAgICAgIG1bIDIgKiA0ICsgMyBdID0gKCB6RmFyICogek5lYXIgKSAvICggek5lYXIgLSB6RmFyICk7DQoNCgkgICAgICAgIC8vIFcgcmVzdWx0ICg9IFogaW4pDQoJICAgICAgICBtWyAzICogNCArIDAgXSA9IDAuMDsNCgkgICAgICAgIG1bIDMgKiA0ICsgMSBdID0gMC4wOw0KCSAgICAgICAgbVsgMyAqIDQgKyAyIF0gPSBoYW5kZWRuZXNzU2NhbGU7DQoJICAgICAgICBtWyAzICogNCArIDMgXSA9IDAuMDsNCg0KCSAgICAgICAgbW9iai50cmFuc3Bvc2UoKTsNCgkgICAgICAgIHJldHVybiBtb2JqOw0KDQoJICAgIH0NCg0KCSAgICBmdW5jdGlvbiBmb3ZUb1Byb2plY3Rpb24oIGZvdiwgcmlnaHRIYW5kZWQsIHpOZWFyLCB6RmFyICkgew0KDQoJICAgICAgICB2YXIgREVHMlJBRCA9IE1hdGguUEkgLyAxODAuMDsNCg0KCSAgICAgICAgdmFyIGZvdlBvcnQgPSB7DQoJICAgICAgICAgICAgdXBUYW46IE1hdGgudGFuKCBmb3YudXBEZWdyZWVzICogREVHMlJBRCApLA0KCSAgICAgICAgICAgIGRvd25UYW46IE1hdGgudGFuKCBmb3YuZG93bkRlZ3JlZXMgKiBERUcyUkFEICksDQoJICAgICAgICAgICAgbGVmdFRhbjogTWF0aC50YW4oIGZvdi5sZWZ0RGVncmVlcyAqIERFRzJSQUQgKSwNCgkgICAgICAgICAgICByaWdodFRhbjogTWF0aC50YW4oIGZvdi5yaWdodERlZ3JlZXMgKiBERUcyUkFEICkNCgkgICAgICAgIH07DQoNCgkgICAgICAgIHJldHVybiBmb3ZQb3J0VG9Qcm9qZWN0aW9uKCBmb3ZQb3J0LCByaWdodEhhbmRlZCwgek5lYXIsIHpGYXIgKTsNCg0KCSAgICB9DQoNCgl9OwoKCWNsYXNzIFZpZGVvUHJvZ3Jlc3NCYXIgew0KCSAgICBjb25zdHJ1Y3Rvcih7DQoJICAgICAgICAgICAgICAgICAgICB2aWRlb0VsZW1lbnQsDQoJICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IDEuNiwNCgkgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IDAuMDUsDQoJICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IG5ldyBWZWN0b3IzKDAsIC0wLjEsIC0yKSwNCgkgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvciA9IDB4NDQ0NDQ0LA0KCSAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yID0gMHgwMGZmMDANCgkgICAgICAgICAgICAgICAgfSkgew0KCSAgICAgICAgdGhpcy52aWRlbyA9IHZpZGVvRWxlbWVudDsNCgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsNCg0KCSAgICAgICAgLy8gQmFja2dyb3VuZCBiYXINCgkgICAgICAgIGNvbnN0IGJnR2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeSh3aWR0aCwgaGVpZ2h0KTsNCgkgICAgICAgIGNvbnN0IGJnTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogYmFja2dyb3VuZENvbG9yIH0pOw0KCSAgICAgICAgdGhpcy5iZ0JhciA9IG5ldyBNZXNoKGJnR2VvbWV0cnksIGJnTWF0ZXJpYWwpOw0KCSAgICAgICAgdGhpcy5iZ0Jhci5wb3NpdGlvbi5jb3B5KHBvc2l0aW9uKTsNCg0KCSAgICAgICAgLy8gRmlsbCBiYXINCgkgICAgICAgIGNvbnN0IGZpbGxHZW9tZXRyeSA9IG5ldyBQbGFuZUdlb21ldHJ5KDEsIGhlaWdodCk7DQoJICAgICAgICBmaWxsR2VvbWV0cnkudHJhbnNsYXRlKDAuNSwgMCwgMCk7IC8vIEFuY2hvciBsZWZ0DQoJICAgICAgICBjb25zdCBmaWxsTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoeyBjb2xvcjogZmlsbENvbG9yIH0pOw0KCSAgICAgICAgdGhpcy5maWxsQmFyID0gbmV3IE1lc2goZmlsbEdlb21ldHJ5LCBmaWxsTWF0ZXJpYWwpOw0KDQoJICAgICAgICB0aGlzLmZpbGxCYXIucG9zaXRpb24uY29weShwb3NpdGlvbi5jbG9uZSgpKTsNCgkgICAgICAgIHRoaXMuZmlsbEJhci5wb3NpdGlvbi54IC09IHdpZHRoIC8gMjsgLy8gQWxpZ24gbGVmdCBlZGdlDQoJICAgICAgICB0aGlzLmZpbGxCYXIucG9zaXRpb24ueiArPSAwLjAxOyAvLyBBdm9pZCB6LWZpZ2h0aW5nDQoJICAgICAgICB0aGlzLmZpbGxCYXIuc2NhbGUuc2V0KDAsIDEsIDEpOyAvLyBTdGFydCBhdCAwJSBwcm9ncmVzcw0KCSAgICB9DQoNCgkgICAgdXBkYXRlUHJvZ3Jlc3MoKSB7DQoJICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHRoaXMudmlkZW8uY3VycmVudFRpbWUgLyB0aGlzLnZpZGVvLmR1cmF0aW9uIHx8IDA7DQoJICAgICAgICB0aGlzLmZpbGxCYXIuc2NhbGUueCA9IHByb2dyZXNzICogdGhpcy53aWR0aDsNCgkgICAgfQ0KCX0KCgl2YXIgcHJvZ3Jlc3NCYXIgPSBudWxsOw0KCXZhciBlZmZlY3QgPSBudWxsOw0KCXZhciBzY2VuZSA9IG51bGw7DQoJdmFyIGNhbWVyYSA9IG51bGw7DQoJdmFyIHJlbmRlcmVyID0gbnVsbDsNCgl2YXIgY2FudmFzID0gbnVsbDsNCg0KCWZ1bmN0aW9uIGxvZyhhcmcpew0KCSAgICBjb25zb2xlLmxvZyhgW1ZSIFZpZGVvIEluamVjdG9yXSAke2FyZ31gKTsNCgl9DQoNCglmdW5jdGlvbiBlbnRlckZ1bGxzY3JlZW4gKGVsKSB7DQoJICAgIGxvZygiVHJ5aW5nIHRvIGZ1bGxzY3JlZW4uLi4iKTsNCgkgICAgaWYgKGVsLnJlcXVlc3RGdWxsc2NyZWVuKSB7DQoJICAgICAgICBlbC5yZXF1ZXN0RnVsbHNjcmVlbigpOw0KCSAgICB9IGVsc2UgaWYgKGVsLm1velJlcXVlc3RGdWxsU2NyZWVuKSB7DQoJICAgICAgICBlbC5tb3pSZXF1ZXN0RnVsbFNjcmVlbigpOw0KCSAgICB9IGVsc2UgaWYgKGVsLndlYmtpdFJlcXVlc3RGdWxsc2NyZWVuKSB7DQoJICAgICAgICBlbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbigpOw0KCSAgICB9IGVsc2UgaWYgKGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4pIHsNCgkgICAgICAgIGVsLm1zUmVxdWVzdEZ1bGxzY3JlZW4oKTsNCgkgICAgfQ0KCX0NCg0KCXZhciBhbmltSUQgPSBudWxsOw0KDQoJY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOw0KCXN0eWxlLnRleHRDb250ZW50ID0gYA0KI3ZyLW92ZXJsYXktbW9kYWwgew0KICBwb3NpdGlvbjogZml4ZWQ7DQogIHotaW5kZXg6IDk5OTk5OTsNCiAgdG9wOiAwOyBsZWZ0OiAwOyByaWdodDogMDsgYm90dG9tOiAwOw0KICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuOTUpOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCn0NCiN2ci1jYW52YXMtY29udGFpbmVyIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KICB3aWR0aDogMTAwJTsNCiAgaGVpZ2h0OiAxMDAlOw0KfQ0KI3ZyLXN0YXJ0LWJ1dHRvbiB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgei1pbmRleDogMTAwMDAwMDsNCiAgdG9wOiAyMHB4Ow0KICBsZWZ0OiA1MCU7DQogIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsNCiAgcGFkZGluZzogMTJweCAyNHB4Ow0KICBmb250LXNpemU6IDE2cHg7DQogIGJhY2tncm91bmQtY29sb3I6ICMwMGNjODg7DQogIGNvbG9yOiB3aGl0ZTsNCiAgYm9yZGVyOiBub25lOw0KICBib3JkZXItcmFkaXVzOiA2cHg7DQogIGN1cnNvcjogcG9pbnRlcjsNCn0NCiN2ci1jbG9zZS1idXR0b24gew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMjBweDsNCiAgcmlnaHQ6IDIwcHg7DQogIHotaW5kZXg6IDEwMDAwMDA7DQogIHBhZGRpbmc6IDEwcHggMjBweDsNCiAgZm9udC1zaXplOiAxNHB4Ow0KICBiYWNrZ3JvdW5kLWNvbG9yOiAjY2MzMzMzOw0KICBjb2xvcjogd2hpdGU7DQogIGJvcmRlcjogbm9uZTsNCiAgYm9yZGVyLXJhZGl1czogNnB4Ow0KICBjdXJzb3I6IHBvaW50ZXI7DQp9DQpjYW52YXMud2ViZ2wgew0KICB3aWR0aDogMTAwJTsNCiAgaGVpZ2h0OiAxMDAlOw0KICBkaXNwbGF5OiBibG9jazsNCn0NCmA7DQoJbG9nKCJhZGRlZCBzdHlsZS4iKTsNCg0KCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOw0KDQoJdmFyIHZyRGlzcGxheTsNCg0KCS8vIEdldCB0aGUgZmlyc3QgdmlkZW8NCgljb25zdCB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3ZpZGVvJyk7DQoNCg0KCS8vIEVOVFJZIFBPSU5UDQoJaWYgKCF2aWRlbykgew0KCSAgICBhbGVydCgiTm8gdmlkZW8gZWxlbWVudCBmb3VuZCBvbiB0aGlzIHBhZ2UuIik7DQoJfWVsc2Ugew0KCSAgICBpbml0KCk7DQoJfQ0KDQoJZnVuY3Rpb24gaW5pdCgpew0KCSAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ211dGVkJywgdHJ1ZSk7DQoJICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgncGxheXNpbmxpbmUnLCB0cnVlKTsNCgkgICAgdmlkZW8uc2V0QXR0cmlidXRlKCdhdXRvcGxheScsIHRydWUpOw0KCSAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ2xvb3AnLCB0cnVlKTsNCgkvL3ZpZGVvLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQoJLy92aWRlby5wbGF5KCk7DQoJICAgIGxvZygiVmlkZW8gYXR0cnMgY2hhbmdlZC4iKTsNCg0KCS8vIFdlYlZSIFBvbHlmaWxsIGNvbmZpZw0KCSAgICBjb25zdCBjb25maWcgPSB3aW5kb3cuVlJfQ09ORklHOw0KDQoJICAgIGxvZygiQWRkaW5nIHBvbHlmaWxsIik7DQoJICAgIHZhciBwb2x5ZmlsbCA9IG5ldyBXZWJWUlBvbHlmaWxsKGNvbmZpZyk7DQoJICAgIGNvbnNvbGUubG9nKHBvbHlmaWxsKTsNCgkgICAgbG9nKCJXZWJWUlBvbHlmaWxsIGluc3RhbnRpYXRlZC4iKTsNCg0KCS8vLS0tIGNyZWF0ZSBvdmVybGF5DQoJICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgkgICAgb3ZlcmxheS5pZCA9ICd2ci1vdmVybGF5LW1vZGFsJzsNCg0KCSAgICBjb25zdCBjYW52YXNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsNCgkgICAgY2FudmFzQ29udGFpbmVyLmlkID0gJ3ZyLWNhbnZhcy1jb250YWluZXInOw0KDQoJICAgIGNvbnN0IHZyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7DQoJICAgIHZyQnV0dG9uLmlkID0gJ3ZyLXN0YXJ0LWJ1dHRvbic7DQoJICAgIHZyQnV0dG9uLnRleHRDb250ZW50ID0gJ0VudGVyIFZSJzsNCg0KCSAgICBjb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOw0KCSAgICBjbG9zZUJ1dHRvbi5pZCA9ICd2ci1jbG9zZS1idXR0b24nOw0KCSAgICBjbG9zZUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDbG9zZSB0aGlzIG92ZXJsYXknOw0KDQoJICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQodnJCdXR0b24pOw0KCSAgICBvdmVybGF5LmFwcGVuZENoaWxkKGNsb3NlQnV0dG9uKTsNCgkgICAgb3ZlcmxheS5hcHBlbmRDaGlsZChjYW52YXNDb250YWluZXIpOw0KCSAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpOw0KDQoJICAgIHZyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KCSAgICAgICAgbG9nKCJlbnRlcmluZyBWUiIpOw0KCSAgICAgICAgY29uc3QgY2FudmFzID0gcmVuZGVyZXIuZG9tRWxlbWVudDsNCg0KCSAgICAgICAgLy9lbnRlckZ1bGxzY3JlZW4oY2FudmFzKQ0KDQoJICAgICAgICAvLyBUaGUgcG9seWZpbGwgcHJvdmlkZXMgdGhpcyBpbiB0aGUgZXZlbnQgdGhpcyBicm93c2VyDQoJICAgICAgICAvLyBkb2VzIG5vdCBzdXBwb3J0IFdlYlZSIDEuMQ0KCSAgICAgICAgbmF2aWdhdG9yLmdldFZSRGlzcGxheXMoKS50aGVuKGZ1bmN0aW9uICh2ckRpc3BsYXlzKSB7DQoJICAgICAgICAgICAgbG9nKCJnZXRWUkRpc3BsYXlzKCkgc3RhcnQiKTsNCgkgICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgbmF0aXZlIGRpc3BsYXksIG9yIHdlIGhhdmUgYSBDYXJkYm9hcmRWUkRpc3BsYXkNCgkgICAgICAgICAgICAvLyBmcm9tIHRoZSBwb2x5ZmlsbCwgdXNlIGl0DQoJICAgICAgICAgICAgaWYgKHZyRGlzcGxheXMubGVuZ3RoKSB7DQoJICAgICAgICAgICAgICAgIHZyRGlzcGxheSA9IHZyRGlzcGxheXNbMF07DQoNCgkgICAgICAgICAgICAgICAgLy8gQXBwbHkgVlIgaGVhZHNldCBwb3NpdGlvbmFsIGRhdGEgdG8gY2FtZXJhLg0KCSAgICAgICAgICAgICAgICAvL2NvbnRyb2xzID0gbmV3IFRIUkVFLlZSQ29udHJvbHMoY2FtZXJhKTsNCg0KCSAgICAgICAgICAgICAgICAvLyBLaWNrIG9mZiB0aGUgcmVuZGVyIGxvb3AuDQoJICAgICAgICAgICAgICAgIGxvZygic3RhcnRpbmcgcmVuZGVyIGxvb3AgaW4gVlIgbW9kZSIpOw0KCSAgICAgICAgICAgICAgICBlbnRlckZ1bGxzY3JlZW4oY2FudmFzKTsNCgkgICAgICAgICAgICAgICAgdnJEaXNwbGF5LnJlcXVlc3RQcmVzZW50KFt7IHNvdXJjZTogcmVuZGVyZXIuZG9tRWxlbWVudCB9XSk7DQoJICAgICAgICAgICAgICAgIGFuaW1JRCA9IHZyRGlzcGxheS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7DQoJICAgICAgICAgICAgfQ0KCSAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UsIHdlJ3JlIG9uIGEgZGVza3RvcCBlbnZpcm9ubWVudCB3aXRoIG5vIG5hdGl2ZQ0KCSAgICAgICAgICAgIC8vIGRpc3BsYXlzLCBzbyBwcm92aWRlIGNvbnRyb2xzIGZvciBhIG1vbm9zY29waWMgZGVza3RvcCB2aWV3DQoJICAgICAgICAgICAgZWxzZSB7DQoJICAgICAgICAgICAgICAgIC8vY29udHJvbHMgPSBuZXcgVEhSRUUuT3JiaXRDb250cm9scyhjYW1lcmEpOw0KCSAgICAgICAgICAgICAgICAvL2NvbnRyb2xzLnRhcmdldC5zZXQoMCwgMCwgLTEpOw0KDQoJICAgICAgICAgICAgICAgIC8vIERpc2FibGUgdGhlICJFbnRlciBWUiIgYnV0dG9uDQoJICAgICAgICAgICAgICAgIC8vdnJEaXNwbGF5ID0gbmV3IENhcmRib2FyZFZSRGlzcGxheShjb25maWcpOw0KCSAgICAgICAgICAgICAgICAvL3ZhciBlbnRlclZSQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3ZyJyk7DQoJICAgICAgICAgICAgICAgIC8vZW50ZXJWUkJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7DQoNCgkgICAgICAgICAgICAgICAgLy8gS2ljayBvZmYgdGhlIHJlbmRlciBsb29wLg0KCSAgICAgICAgICAgICAgICBsb2coInN0YXJ0aW5nIHJlbmRlciBsb29wIGluIGRlc2t0b3AgbW9kZSIpOw0KCSAgICAgICAgICAgICAgICBhbmltSUQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7DQoJICAgICAgICAgICAgfQ0KCSAgICAgICAgfSk7DQoNCgkgICAgICAgIC8vIE9wdGlvbmFsOiBoaWRlIGJ1dHRvbiBhZnRlciBWUiBzdGFydHMNCgkgICAgICAgIHZyQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQoJICAgIH0pOw0KDQoJICAgIGNsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gew0KCSAgICAgICAgbG9nKCJsZWF2aW5nIFZSIik7DQoJICAgICAgICAvLyBFeGl0IFdlYlZSIHByZXNlbnRhdGlvbiBpZiBhY3RpdmUNCgkgICAgICAgIGlmIChuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cykgew0KCSAgICAgICAgICAgIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKCkudGhlbihkaXNwbGF5cyA9PiB7DQoJICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5cy5sZW5ndGggJiYgZGlzcGxheXNbMF0uaXNQcmVzZW50aW5nKSB7DQoJICAgICAgICAgICAgICAgICAgICBkaXNwbGF5c1swXS5leGl0UHJlc2VudCgpOw0KCSAgICAgICAgICAgICAgICB9DQoJICAgICAgICAgICAgfSk7DQoJICAgICAgICB9DQoNCgkgICAgICAgIC8vIEV4aXQgZnVsbHNjcmVlbg0KCSAgICAgICAgaWYgKGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50KSB7DQoJICAgICAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTsNCgkgICAgICAgIH0NCg0KCSAgICAgICAgLy8gUmVtb3ZlIG92ZXJsYXkNCgkgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7DQoNCgkgICAgICAgIC8vIE9wdGlvbmFsbHkgcmVzdG9yZSB2aWRlbyBlbGVtZW50IGFwcGVhcmFuY2UNCgkgICAgICAgIHZpZGVvLnN0eWxlLmRpc3BsYXkgPSAnJzsgLy8gcmVzdG9yZSBvcmlnaW5hbCBzdHlsaW5nDQoNCgkgICAgICAgIC8vIE9wdGlvbmFsbHkgc3RvcCBUaHJlZS5qcyBhbmltYXRpb24gbG9vcCAoaWYgeW91IHN0b3JlZCBhIHJlZmVyZW5jZSkNCgkgICAgICAgIGlmKGFuaW1JRCkNCgkgICAgICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShhbmltSUQpOw0KCSAgICB9KTsNCgkgICAgbG9nKCJvdmVybGF5IGNyZWF0ZWQuIik7DQoJLy8tLS0gZW5kIG92ZXJsYXkNCg0KCS8vLS0tIGluaXQgcmVuZGVyZXINCgkgICAgcmVuZGVyZXIgPSBuZXcgV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogZmFsc2UgfSk7DQoJICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pOw0KCSAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOw0KCSAgICByZW5kZXJlci5kb21FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3dlYmdsJyk7DQoNCgkvLyBBcHBlbmQgdGhlIGNhbnZhcyBpbnNpZGUgdGhlIG1vZGFsIGNvbnRhaW5lcg0KCSAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndnItY2FudmFzLWNvbnRhaW5lcicpLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpOw0KCSAgICBsb2coYFJlbmRlcmVyIGVsZW1lbnQgYWRkZWQgdG8gb3ZlcmxheTogJHtyZW5kZXJlci5kb21FbGVtZW50fWApOw0KDQoNCgkgICAgY2FudmFzID0gcmVuZGVyZXIuZG9tRWxlbWVudDsNCgkgICAgc2NlbmUgPSBuZXcgU2NlbmUoKTsNCgkgICAgY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKDc1LCB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodCwgMC4xLCAxMDAwMCk7DQoJICAgIHNjZW5lLmFkZChjYW1lcmEpOw0KDQoJICAgIGVmZmVjdCA9IG5ldyBWUkVmZmVjdChyZW5kZXJlcik7DQoJICAgIGNvbnNvbGUubG9nKGVmZmVjdCk7DQoJICAgIGVmZmVjdC5zZXRTaXplKGNhbnZhcy5jbGllbnRXaWR0aCwgY2FudmFzLmNsaWVudEhlaWdodCwgZmFsc2UpOw0KDQoJLy9jb25zdCBjb250cm9scyA9IG5ldyBUSFJFRS5WUkNvbnRyb2xzKGNhbWVyYSk7DQoJICAgIGxvZyhgVlJDb250cm9sbGVyIGluc3RhbnRpYXRlZC5gKTsNCg0KCS8vIFZpZGVvDQoNCgkgICAgdmlkZW8ucGF1c2UoKTsNCg0KCSAgICBjb25zdCB2aWRlb1RleHR1cmUgPSBuZXcgVmlkZW9UZXh0dXJlKHZpZGVvKTsNCgkgICAgdmlkZW9UZXh0dXJlLmNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZTsNCgkgICAgdmlkZW9UZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsNCgkgICAgdmlkZW9UZXh0dXJlLm1hZ0ZpbHRlciA9IExpbmVhckZpbHRlcjsNCgkgICAgdmlkZW9UZXh0dXJlLmZvcm1hdCA9IFJHQkFGb3JtYXQ7DQoJICAgIGNvbnN0IHZpZGVvTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoeyBtYXA6IHZpZGVvVGV4dHVyZSB9KTsNCg0KCSAgICBjb25zdCB2aWRlb1BsYW5lID0gbmV3IE1lc2gobmV3IFBsYW5lR2VvbWV0cnkoMS42LCAwLjkpLCB2aWRlb01hdGVyaWFsKTsNCgkgICAgdmlkZW9QbGFuZS5wb3NpdGlvbi5zZXQoMCwgMCwgLTEuNSk7DQoJICAgIHNjZW5lLmFkZCh2aWRlb1BsYW5lKTsNCg0KCSAgICBsb2codmlkZW8ucmVhZHlTdGF0ZSk7DQoNCgkgICAgdmlkZW8ucGxheSgpOw0KDQoJLy8gUHJvZ3Jlc3MgYmFyDQoJICAgIHByb2dyZXNzQmFyID0gbmV3IFZpZGVvUHJvZ3Jlc3NCYXIoew0KCSAgICAgICAgdmlkZW9FbGVtZW50OiB2aWRlbywNCgkgICAgICAgIHdpZHRoOiAxLjYsDQoJICAgICAgICBoZWlnaHQ6IDAuMDUsDQoJICAgICAgICBwb3NpdGlvbjogbmV3IFZlY3RvcjMoMCwgLTAuNiwgLTEuNDkpLA0KCSAgICAgICAgYmFja2dyb3VuZENvbG9yOiAweDIyMjIyMiwNCgkgICAgICAgIGZpbGxDb2xvcjogMHhmZjQ0NDQNCgkgICAgfSk7DQoJICAgIHNjZW5lLmFkZChwcm9ncmVzc0Jhci5iZ0Jhcik7DQoJICAgIHNjZW5lLmFkZChwcm9ncmVzc0Jhci5maWxsQmFyKTsNCg0KCS8vIFNreWJveA0KCSAgICBjb25zdCBsb2FkZXIgPSBuZXcgVGV4dHVyZUxvYWRlcigpOw0KCSAgICBsb2FkZXIubG9hZCgnYm94LnBuZycsIHRleHR1cmUgPT4gew0KCSAgICAgICAgdGV4dHVyZS53cmFwUyA9IHRleHR1cmUud3JhcFQgPSBSZXBlYXRXcmFwcGluZzsNCgkgICAgICAgIHRleHR1cmUucmVwZWF0LnNldCg1LCA1KTsNCgkgICAgICAgIGNvbnN0IHNreWJveCA9IG5ldyBNZXNoKA0KCSAgICAgICAgICAgIG5ldyBCb3hHZW9tZXRyeSg1LCA1LCA1KSwNCgkgICAgICAgICAgICBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoeyBtYXA6IHRleHR1cmUsIHNpZGU6IEJhY2tTaWRlIH0pDQoJICAgICAgICApOw0KCSAgICAgICAgc2NlbmUuYWRkKHNreWJveCk7DQoJICAgICAgICBsb2coIkFkZGVkIHNreWJveCIpOw0KCSAgICB9KTsNCgl9DQoJZnVuY3Rpb24gYW5pbWF0ZSh0aW1lc3RhbXApIHsNCg0KCSAgICBwcm9ncmVzc0Jhci51cGRhdGVQcm9ncmVzcygpOw0KDQoJICAgIC8vIFJlbmRlciB0aGUgc2NlbmUuDQoJICAgIGVmZmVjdC5yZW5kZXIoc2NlbmUsIGNhbWVyYSk7DQoNCgkgICAgLy8gS2VlcCBsb29waW5nOyBpZiB1c2luZyBhIFZSRGlzcGxheSwgY2FsbCBpdHMgcmVxdWVzdEFuaW1hdGlvbkZyYW1lLA0KCSAgICAvLyBvdGhlcndpc2UgY2FsbCB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLg0KCSAgICBpZiAodnJEaXNwbGF5KSB7DQoJICAgICAgICBhbmltSUQgPSB2ckRpc3BsYXkucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOw0KCSAgICB9IGVsc2Ugew0KCSAgICAgICAgYW5pbUlEID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOw0KCSAgICB9DQoJfQ0KDQoJZnVuY3Rpb24gb25SZXNpemUoKSB7DQoJICAgIC8vIFRoZSBkZWxheSBlbnN1cmVzIHRoZSBicm93c2VyIGhhcyBhIGNoYW5jZSB0byBsYXlvdXQNCgkgICAgLy8gdGhlIHBhZ2UgYW5kIHVwZGF0ZSB0aGUgY2xpZW50V2lkdGgvY2xpZW50SGVpZ2h0Lg0KCSAgICAvLyBUaGlzIHByb2JsZW0gcGFydGljdWxhcmx5IGNyb3BzIHVwIHVuZGVyIGlPUy4NCgkgICAgaWYgKCFvblJlc2l6ZS5yZXNpemVEZWxheSkgew0KCSAgICAgICAgb25SZXNpemUucmVzaXplRGVsYXkgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkgICAgICAgICAgICBvblJlc2l6ZS5yZXNpemVEZWxheSA9IG51bGw7DQoJICAgICAgICAgICAgbG9nKCdSZXNpemluZyB0byAlcyB4ICVzLicsIGNhbnZhcy5jbGllbnRXaWR0aCwgY2FudmFzLmNsaWVudEhlaWdodCk7DQoJICAgICAgICAgICAgZWZmZWN0LnNldFNpemUoY2FudmFzLmNsaWVudFdpZHRoLCBjYW52YXMuY2xpZW50SGVpZ2h0LCBmYWxzZSk7DQoJICAgICAgICAgICAgY2FtZXJhLmFzcGVjdCA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIGNhbnZhcy5jbGllbnRIZWlnaHQ7DQoJICAgICAgICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsNCgkgICAgICAgIH0sIDI1MCk7DQoJICAgIH0NCgl9DQoNCglmdW5jdGlvbiBvblZSRGlzcGxheVByZXNlbnRDaGFuZ2UoKSB7DQoJICAgIGxvZygnb25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlJyk7DQoJICAgIG9uUmVzaXplKCk7DQoJICAgIC8vYnV0dG9ucy5oaWRkZW4gPSB2ckRpc3BsYXkuaXNQcmVzZW50aW5nOw0KCX0NCg0KCWZ1bmN0aW9uIG9uVlJEaXNwbGF5Q29ubmVjdChlKSB7DQoJICAgIGxvZygnb25WUkRpc3BsYXlDb25uZWN0JywgKGUuZGlzcGxheSB8fCAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZGlzcGxheSkpKTsNCgl9DQoNCgkvLyBSZXNpemUgdGhlIFdlYkdMIGNhbnZhcyB3aGVuIHdlIHJlc2l6ZSBhbmQgYWxzbyB3aGVuIHdlIGNoYW5nZSBtb2Rlcy4NCgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25SZXNpemUpOw0KCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgb25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlKTsNCgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5Y29ubmVjdCcsIG9uVlJEaXNwbGF5Q29ubmVjdCk7Cgp9KSgpOwo=';

(function () {
    'use strict';

    function log(msg, module, obj){
        console.log(`[VR Video Injector${module ? ' / ' : ''}${module ? module : ''}] ${msg}`, obj ? obj : ' ');
    }

    function err(msg, module, obj){
        console.error(`[ERROR - VR Video Injector${module ? ' / ' : ''}${module ? module : ''}] ${msg}`, obj ? obj : ' ');
    }

    // --- Chrome Promisified Wrappers ---

    function queryTabs(queryOptions) {
        return new Promise((resolve, reject) => {
            chrome.tabs.query(queryOptions, (tabs) => {
                if (chrome.runtime.lastError) {
                    reject(chrome.runtime.lastError);
                } else {
                    resolve(tabs);
                }
            });
        });
    }

    function executeScriptPromise(tabId, details) {
        return new Promise((resolve, reject) => {
            chrome.tabs.executeScript(tabId, details, (result) => {
                if (chrome.runtime.lastError) {
                    reject(chrome.runtime.lastError);
                } else {
                    resolve(result);
                }
            });
        });
    }

    function getStorageValue(key) {
        return new Promise((resolve, reject) => {
            //let timeout = setTimeout(() => {
            //    console.warn("chrome.storage.local.get callback never fired");
            //    reject(new Error("storage timeout"));
            //}, 2000);

            chrome.storage.local.get(key, (result) => {
                //clearTimeout(timeout);
                if (chrome.runtime.lastError) {
                    reject(chrome.runtime.lastError);
                } else {
                    resolve(result[key]);
                }
            });
        });
    }


    // --- Helpers ---

    async function getCurrentTab() {
        try {
            const tabs = await queryTabs({ active: true, currentWindow: true });
            if (!tabs.length) {
                throw new Error('No active tab found');
            }
            log("Current tab found", "extHelper.js", tabs[0]);
            return tabs[0];
        } catch (e) {
            err("Could not find tab", "extHelper.js", e);
            throw e;
        }
    }

    function utf8ToBase64(str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_, p1) =>
            String.fromCharCode(parseInt(p1, 16))
        ));
    }

    async function injectB64ScriptTagIntoTab(tab, B64, scriptName) {
        log(`Trying to inject ${scriptName}`, "injectB64ScriptTagIntoTab");

        const code = `
    (function() {
      console.log("[VR Video Injector / chrome.tabs.executeScript] Injecting ${scriptName}");
      const s = document.createElement('script');
      s.src = "data:text/javascript;base64,${B64}";
      (document.head || document.documentElement).appendChild(s);
    })();
  `;

        try {
            await executeScriptPromise(tab.id, { code, runAt: 'document_idle' });
            log(`Injected ${scriptName} successfully`, "injectB64ScriptTagIntoTab");
        } catch (e) {
            err(`Failed to inject ${scriptName}`, "injectB64ScriptTagIntoTab", e.message);
        }
    }

    async function injectConfiguration(tab, type) {
        const cfg_key = type === 'webxr' ? 'webxr_conf' : 'webvr_conf';
        log("Injecting configuration...", "injectConfiguration", cfg_key);

        try {
            console.log("chrome.storage.local available?", typeof chrome.storage?.local);
            const config = await getStorageValue(cfg_key);
            log("storage result:", "injectConfiguration", config);

            const configJson = JSON.stringify(config || {});
            const base64 = utf8ToBase64(`window.VR_CONFIG = ${configJson};`);

            log("Found configuration. injecting into page...", "injectConfiguration");
            await injectB64ScriptTagIntoTab(tab, base64, cfg_key);
        } catch (e) {
            err("Failed to inject configuration", "injectConfiguration", e.message);
        }
    }

    async function injectPlugin(msg) {
        const B64 = msg.type === 'webxr' ? WEBXR_B64 :
            msg.type === 'webvr' ? WEBVR_B64 : null;
        if (!B64) return;

        try {
            log("Injecting: ", "injectPlugin", msg);
            const tab = await getCurrentTab();
            log("Got tab: ", "injectPlugin", tab);
            try {
                await injectConfiguration(tab, msg.type);
            } catch (e) {
                err("injectConfiguration() failed", "injectPlugin", e.message);
            }
            try {
                await injectB64ScriptTagIntoTab(tab, B64, `main script: ${msg.type}`);
            } catch (e) {
                err("injectB64ScriptTagIntoTab() failed", "injectPlugin", e.message);
            }
        } catch (e) {
            err("Failed to inject plugin", "injectPlugin", e.message);
        }
    }

    document.getElementById('btn-webxr').addEventListener('click', async () => {
        log("Injecting WebXR", "browserAction");
        await injectPlugin({type: 'webxr'});
        window.close();
    });

    document.getElementById('btn-webvr').addEventListener('click', async () => {
        log("Injecting WebVR", "browserAction");
        await injectPlugin({type: 'webvr'});
        window.close();
    });

})();
