const WEBXR_B64 = 'KGZ1bmN0aW9uICgpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICBmdW5jdGlvbiBsb2cobXNnLCBtb2R1bGUsIG9iail7CiAgICAgICAgY29uc29sZS5sb2coYFtWUiBWaWRlbyBJbmplY3RvciR7bW9kdWxlID8gJyAvICcgOiAnJ30ke21vZHVsZSA/IG1vZHVsZSA6ICcnfV0gJHttc2d9YCwgb2JqID8gb2JqIDogJyAnKTsKICAgIH0KCiAgICB2YXIgc3R5bGVzID0gIiN2ci1vdmVybGF5LW1vZGFsIHtcbiAgICBwb3NpdGlvbjogZml4ZWQ7XG4gICAgei1pbmRleDogOTk4O1xuICAgIHRvcDogMDsgbGVmdDogMDsgcmlnaHQ6IDA7IGJvdHRvbTogMDtcbiAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLDAuOTUpO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xufVxuI3ZyLWNhbnZhcy1jb250YWluZXIge1xuICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBoZWlnaHQ6IDEwMCU7XG59XG4jdnItc3RhcnQtYnV0dG9uIHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgei1pbmRleDogOTk5O1xuICAgIHRvcDogMjBweDtcbiAgICBsZWZ0OiA1MCU7XG4gICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC01MCUpO1xuICAgIHBhZGRpbmc6IDEycHggMjRweDtcbiAgICBmb250LXNpemU6IDE2cHg7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzAwY2M4ODtcbiAgICBjb2xvcjogd2hpdGU7XG4gICAgYm9yZGVyOiBub25lO1xuICAgIGJvcmRlci1yYWRpdXM6IDZweDtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG59XG4jdnItY2xvc2UtYnV0dG9uIHtcbiAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgdG9wOiAyMHB4O1xuICAgIHJpZ2h0OiAyMHB4O1xuICAgIHotaW5kZXg6IDk5OTtcbiAgICBwYWRkaW5nOiAxMHB4IDIwcHg7XG4gICAgZm9udC1zaXplOiAxNHB4O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNjYzMzMzM7XG4gICAgY29sb3I6IHdoaXRlO1xuICAgIGJvcmRlcjogbm9uZTtcbiAgICBib3JkZXItcmFkaXVzOiA2cHg7XG4gICAgY3Vyc29yOiBwb2ludGVyO1xufVxuY2FudmFzLndlYmdsIHtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgZGlzcGxheTogYmxvY2s7XG59IjsKCiAgICAvKioKICAgICAqIEBsaWNlbnNlCiAgICAgKiBDb3B5cmlnaHQgMjAxMC0yMDI1IFRocmVlLmpzIEF1dGhvcnMKICAgICAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKICAgICAqLwogICAgY29uc3QgUkVWSVNJT04gPSAnMTc4JzsKCiAgICAvKioKICAgICAqIERpc2FibGVzIGZhY2UgY3VsbGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEN1bGxGYWNlTm9uZSA9IDA7CgogICAgLyoqCiAgICAgKiBDdWxscyBiYWNrIGZhY2VzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3VsbEZhY2VCYWNrID0gMTsKCiAgICAvKioKICAgICAqIEN1bGxzIGZyb250IGZhY2VzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3VsbEZhY2VGcm9udCA9IDI7CgogICAgLyoqCiAgICAgKiBGaWx0ZXJzIHNoYWRvdyBtYXBzIHVzaW5nIHRoZSBQZXJjZW50YWdlLUNsb3NlciBGaWx0ZXJpbmcgKFBDRikgYWxnb3JpdGhtLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUENGU2hhZG93TWFwID0gMTsKCiAgICAvKioKICAgICAqIEZpbHRlcnMgc2hhZG93IG1hcHMgdXNpbmcgdGhlIFBlcmNlbnRhZ2UtQ2xvc2VyIEZpbHRlcmluZyAoUENGKSBhbGdvcml0aG0gd2l0aAogICAgICogYmV0dGVyIHNvZnQgc2hhZG93cyBlc3BlY2lhbGx5IHdoZW4gdXNpbmcgbG93LXJlc29sdXRpb24gc2hhZG93IG1hcHMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBQQ0ZTb2Z0U2hhZG93TWFwID0gMjsKCiAgICAvKioKICAgICAqIEZpbHRlcnMgc2hhZG93IG1hcHMgdXNpbmcgdGhlIFZhcmlhbmNlIFNoYWRvdyBNYXAgKFZTTSkgYWxnb3JpdGhtLgogICAgICogV2hlbiB1c2luZyBWU01TaGFkb3dNYXAgYWxsIHNoYWRvdyByZWNlaXZlcnMgd2lsbCBhbHNvIGNhc3Qgc2hhZG93cy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFZTTVNoYWRvd01hcCA9IDM7CgogICAgLyoqCiAgICAgKiBPbmx5IGZyb250IGZhY2VzIGFyZSByZW5kZXJlZC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEZyb250U2lkZSA9IDA7CgogICAgLyoqCiAgICAgKiBPbmx5IGJhY2sgZmFjZXMgYXJlIHJlbmRlcmVkLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQmFja1NpZGUgPSAxOwoKICAgIC8qKgogICAgICogQm90aCBmcm9udCBhbmQgYmFjayBmYWNlcyBhcmUgcmVuZGVyZWQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBEb3VibGVTaWRlID0gMjsKCiAgICAvKioKICAgICAqIE5vIGJsZW5kaW5nIGlzIHBlcmZvcm1lZCB3aGljaCBlZmZlY3RpdmVseSBkaXNhYmxlcwogICAgICogYWxwaGEgdHJhbnNwYXJlbmN5LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTm9CbGVuZGluZyA9IDA7CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBibGVuZGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5vcm1hbEJsZW5kaW5nID0gMTsKCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYWRkaXRpdmUgYmxlbmRpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBBZGRpdGl2ZUJsZW5kaW5nID0gMjsKCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgc3VidHJhY3RpdmUgYmxlbmRpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTdWJ0cmFjdGl2ZUJsZW5kaW5nID0gMzsKCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgbXVsdGlwbHkgYmxlbmRpbmcuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBNdWx0aXBseUJsZW5kaW5nID0gNDsKCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgY3VzdG9tIGJsZW5kaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3VzdG9tQmxlbmRpbmcgPSA1OwoKICAgIC8qKgogICAgICogQSBgc291cmNlICsgZGVzdGluYXRpb25gIGJsZW5kaW5nIGVxdWF0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQWRkRXF1YXRpb24gPSAxMDA7CgogICAgLyoqCiAgICAgKiBBIGBzb3VyY2UgLSBkZXN0aW5hdGlvbmAgYmxlbmRpbmcgZXF1YXRpb24uCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTdWJ0cmFjdEVxdWF0aW9uID0gMTAxOwoKICAgIC8qKgogICAgICogQSBgZGVzdGluYXRpb24gLSBzb3VyY2VgIGJsZW5kaW5nIGVxdWF0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUmV2ZXJzZVN1YnRyYWN0RXF1YXRpb24gPSAxMDI7CgogICAgLyoqCiAgICAgKiBBIGJsZW5kIGVxdWF0aW9uIHRoYXQgdXNlcyB0aGUgbWluaW11bSBvZiBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTWluRXF1YXRpb24gPSAxMDM7CgogICAgLyoqCiAgICAgKiBBIGJsZW5kIGVxdWF0aW9uIHRoYXQgdXNlcyB0aGUgbWF4aW11bSBvZiBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTWF4RXF1YXRpb24gPSAxMDQ7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYDBgLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgWmVyb0ZhY3RvciA9IDIwMDsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBPbmVGYWN0b3IgPSAyMDE7CgogICAgLyoqCiAgICAgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgdGhlIHNvdXJjZSBjb2xvcnMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTcmNDb2xvckZhY3RvciA9IDIwMjsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgZWFjaCBzb3VyY2UgY29sb3IuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBPbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gMjAzOwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTcmNBbHBoYUZhY3RvciA9IDIwNDsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSAxIG1pbnVzIHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBPbmVNaW51c1NyY0FscGhhRmFjdG9yID0gMjA1OwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBkZXN0aW5hdGlvbiBhbHBoYSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IERzdEFscGhhRmFjdG9yID0gMjA2OwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAxYCBtaW51cyB0aGUgZGVzdGluYXRpb24gYWxwaGEgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBPbmVNaW51c0RzdEFscGhhRmFjdG9yID0gMjA3OwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBkZXN0aW5hdGlvbiBjb2xvci4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IERzdENvbG9yRmFjdG9yID0gMjA4OwoKICAgIC8qKgogICAgICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAxYCBtaW51cyBlYWNoIGRlc3RpbmF0aW9uIGNvbG9yLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT25lTWludXNEc3RDb2xvckZhY3RvciA9IDIwOTsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgdGhlIFJHQiBjb2xvcnMgYnkgdGhlIHNtYWxsZXIgb2YgZWl0aGVyIHRoZSBzb3VyY2UgYWxwaGEKICAgICAqIHZhbHVlIG9yIHRoZSB2YWx1ZSBvZiBgMWAgbWludXMgdGhlIGRlc3RpbmF0aW9uIGFscGhhIHZhbHVlLiBUaGUgYWxwaGEKICAgICAqIHZhbHVlIGlzIG11bHRpcGxpZWQgYnkgYDFgLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciA9IDIxMDsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBhIGNvbnN0YW50IGNvbG9yLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ29uc3RhbnRDb2xvckZhY3RvciA9IDIxMTsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgYSBjb25zdGFudCBjb2xvci4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvciA9IDIxMjsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBhIGNvbnN0YW50IGFscGhhIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ29uc3RhbnRBbHBoYUZhY3RvciA9IDIxMzsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSAxIG1pbnVzIGEgY29uc3RhbnQgYWxwaGEgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBPbmVNaW51c0NvbnN0YW50QWxwaGFGYWN0b3IgPSAyMTQ7CgogICAgLyoqCiAgICAgKiBOZXZlciBwYXNzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTmV2ZXJEZXB0aCA9IDA7CgogICAgLyoqCiAgICAgKiBBbHdheXMgcGFzcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEFsd2F5c0RlcHRoID0gMTsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGVzc0RlcHRoID0gMjsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGVzc0VxdWFsRGVwdGggPSAzOwoKICAgIC8qKgogICAgICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgZXF1YWxzIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBFcXVhbERlcHRoID0gNDsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgR3JlYXRlckVxdWFsRGVwdGggPSA1OwoKICAgIC8qKgogICAgICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBHcmVhdGVyRGVwdGggPSA2OwoKICAgIC8qKgogICAgICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgbm90IGVxdWFsIHRvIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOb3RFcXVhbERlcHRoID0gNzsKCiAgICAvKioKICAgICAqIE11bHRpcGxpZXMgdGhlIGVudmlyb25tZW50IG1hcCBjb2xvciB3aXRoIHRoZSBzdXJmYWNlIGNvbG9yLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTXVsdGlwbHlPcGVyYXRpb24gPSAwOwoKICAgIC8qKgogICAgICogVXNlcyByZWZsZWN0aXZpdHkgdG8gYmxlbmQgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE1peE9wZXJhdGlvbiA9IDE7CgogICAgLyoqCiAgICAgKiBBZGRzIHRoZSB0d28gY29sb3JzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQWRkT3BlcmF0aW9uID0gMjsKCiAgICAvKioKICAgICAqIE5vIHRvbmUgbWFwcGluZyBpcyBhcHBsaWVkLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTm9Ub25lTWFwcGluZyA9IDA7CgogICAgLyoqCiAgICAgKiBMaW5lYXIgdG9uZSBtYXBwaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGluZWFyVG9uZU1hcHBpbmcgPSAxOwoKICAgIC8qKgogICAgICogUmVpbmhhcmQgdG9uZSBtYXBwaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUmVpbmhhcmRUb25lTWFwcGluZyA9IDI7CgogICAgLyoqCiAgICAgKiBDaW5lb24gdG9uZSBtYXBwaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ2luZW9uVG9uZU1hcHBpbmcgPSAzOwoKICAgIC8qKgogICAgICogQUNFUyBGaWxtaWMgdG9uZSBtYXBwaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nID0gNDsKCiAgICAvKioKICAgICAqIEN1c3RvbSB0b25lIG1hcHBpbmcuCiAgICAgKgogICAgICogRXhwZWN0cyBhIGN1c3RvbSBpbXBsZW1lbnRhdGlvbiBieSBtb2RpZnlpbmcgc2hhZGVyIGNvZGUgb2YgdGhlIG1hdGVyaWFsJ3MgZnJhZ21lbnQgc2hhZGVyLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3VzdG9tVG9uZU1hcHBpbmcgPSA1OwoKICAgIC8qKgogICAgICogQWdYIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEFnWFRvbmVNYXBwaW5nID0gNjsKCiAgICAvKioKICAgICAqIE5ldXRyYWwgdG9uZSBtYXBwaW5nLgogICAgICoKICAgICAqIEltcGxlbWVudGF0aW9uIGJhc2VkIG9uIHRoZSBLaHJvbm9zIDNEIENvbW1lcmNlIEdyb3VwIHN0YW5kYXJkIHRvbmUgbWFwcGluZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5ldXRyYWxUb25lTWFwcGluZyA9IDc7CgogICAgLyoqCiAgICAgKiBNYXBzIHRleHR1cmVzIHVzaW5nIHRoZSBnZW9tZXRyeSdzIFVWIGNvb3JkaW5hdGVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVVZNYXBwaW5nID0gMzAwOwoKICAgIC8qKgogICAgICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBjdWJlIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nID0gMzAxOwoKICAgIC8qKgogICAgICogUmVmcmFjdGlvbiBtYXBwaW5nIGZvciBjdWJlIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nID0gMzAyOwoKICAgIC8qKgogICAgICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyA9IDMwMzsKCiAgICAvKioKICAgICAqIFJlZnJhY3Rpb24gbWFwcGluZyBmb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgPSAzMDQ7CgogICAgLyoqCiAgICAgKiBSZWZsZWN0aW9uIG1hcHBpbmcgZm9yIFBNUkVNIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDY7CgogICAgLyoqCiAgICAgKiBUaGUgdGV4dHVyZSB3aWxsIHNpbXBseSByZXBlYXQgdG8gaW5maW5pdHkuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSZXBlYXRXcmFwcGluZyA9IDEwMDA7CgogICAgLyoqCiAgICAgKiBUaGUgbGFzdCBwaXhlbCBvZiB0aGUgdGV4dHVyZSBzdHJldGNoZXMgdG8gdGhlIGVkZ2Ugb2YgdGhlIG1lc2guCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBDbGFtcFRvRWRnZVdyYXBwaW5nID0gMTAwMTsKCiAgICAvKioKICAgICAqIFRoZSB0ZXh0dXJlIHdpbGwgcmVwZWF0cyB0byBpbmZpbml0eSwgbWlycm9yaW5nIG9uIGVhY2ggcmVwZWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTWlycm9yZWRSZXBlYXRXcmFwcGluZyA9IDEwMDI7CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgdGV4dHVyZSBlbGVtZW50IHRoYXQgaXMgbmVhcmVzdCAoaW4gTWFuaGF0dGFuIGRpc3RhbmNlKQogICAgICogdG8gdGhlIHNwZWNpZmllZCB0ZXh0dXJlIGNvb3JkaW5hdGVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTmVhcmVzdEZpbHRlciA9IDEwMDM7CgogICAgLyoqCiAgICAgKiBDaG9vc2VzIHRoZSBtaXBtYXAgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2hlcyB0aGUgc2l6ZSBvZiB0aGUgcGl4ZWwgYmVpbmcgdGV4dHVyZWQKICAgICAqIGFuZCB1c2VzIHRoZSBgTmVhcmVzdEZpbHRlcmAgY3JpdGVyaW9uICh0aGUgdGV4ZWwgbmVhcmVzdCB0byB0aGUgY2VudGVyIG9mIHRoZSBwaXhlbCkKICAgICAqIHRvIHByb2R1Y2UgYSB0ZXh0dXJlIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIgPSAxMDA0OwoKICAgIC8qKgogICAgICogQ2hvb3NlcyB0aGUgdHdvIG1pcG1hcHMgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2ggdGhlIHNpemUgb2YgdGhlIHBpeGVsIGJlaW5nIHRleHR1cmVkIGFuZAogICAgICogdXNlcyB0aGUgYE5lYXJlc3RGaWx0ZXJgIGNyaXRlcmlvbiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZSBmcm9tIGVhY2ggbWlwbWFwLgogICAgICogVGhlIGZpbmFsIHRleHR1cmUgdmFsdWUgaXMgYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRob3NlIHR3byB2YWx1ZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyID0gMTAwNTsKCiAgICAvKioKICAgICAqIFJldHVybnMgdGhlIHdlaWdodGVkIGF2ZXJhZ2Ugb2YgdGhlIGZvdXIgdGV4dHVyZSBlbGVtZW50cyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZSBzcGVjaWZpZWQKICAgICAqIHRleHR1cmUgY29vcmRpbmF0ZXMsIGFuZCBjYW4gaW5jbHVkZSBpdGVtcyB3cmFwcGVkIG9yIHJlcGVhdGVkIGZyb20gb3RoZXIgcGFydHMgb2YgYSB0ZXh0dXJlLAogICAgICogZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZXMgb2YgYHdyYXBTYCBhbmQgYHdyYXBUYCwgYW5kIG9uIHRoZSBleGFjdCBtYXBwaW5nLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGluZWFyRmlsdGVyID0gMTAwNjsKCiAgICAvKioKICAgICAqIENob29zZXMgdGhlIG1pcG1hcCB0aGF0IG1vc3QgY2xvc2VseSBtYXRjaGVzIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQgdXNlcwogICAgICogdGhlIGBMaW5lYXJGaWx0ZXJgIGNyaXRlcmlvbiAoYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRoZSBmb3VyIHRleGVscyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZQogICAgICogY2VudGVyIG9mIHRoZSBwaXhlbCkgdG8gcHJvZHVjZSBhIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyID0gMTAwNzsKCiAgICAvKioKICAgICAqIENob29zZXMgdGhlIHR3byBtaXBtYXBzIHRoYXQgbW9zdCBjbG9zZWx5IG1hdGNoIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQgdXNlcwogICAgICogdGhlIGBMaW5lYXJGaWx0ZXJgIGNyaXRlcmlvbiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZSBmcm9tIGVhY2ggbWlwbWFwLiBUaGUgZmluYWwgdGV4dHVyZSB2YWx1ZQogICAgICogaXMgYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRob3NlIHR3byB2YWx1ZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgPSAxMDA4OwoKICAgIC8qKgogICAgICogQW4gdW5zaWduZWQgYnl0ZSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVW5zaWduZWRCeXRlVHlwZSA9IDEwMDk7CgogICAgLyoqCiAgICAgKiBBIGJ5dGUgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEJ5dGVUeXBlID0gMTAxMDsKCiAgICAvKioKICAgICAqIEEgc2hvcnQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFNob3J0VHlwZSA9IDEwMTE7CgogICAgLyoqCiAgICAgKiBBbiB1bnNpZ25lZCBzaG9ydCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVW5zaWduZWRTaG9ydFR5cGUgPSAxMDEyOwoKICAgIC8qKgogICAgICogQW4gaW50IGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBJbnRUeXBlID0gMTAxMzsKCiAgICAvKioKICAgICAqIEFuIHVuc2lnbmVkIGludCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVW5zaWduZWRJbnRUeXBlID0gMTAxNDsKCiAgICAvKioKICAgICAqIEEgZmxvYXQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEZsb2F0VHlwZSA9IDEwMTU7CgogICAgLyoqCiAgICAgKiBBIGhhbGYgZmxvYXQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEhhbGZGbG9hdFR5cGUgPSAxMDE2OwoKICAgIC8qKgogICAgICogQW4gdW5zaWduZWQgc2hvcnQgNF80XzRfNCAocGFja2VkKSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gMTAxNzsKCiAgICAvKioKICAgICAqIEFuIHVuc2lnbmVkIHNob3J0IDVfNV81XzEgKHBhY2tlZCkgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZSA9IDEwMTg7CgogICAgLyoqCiAgICAgKiBBbiB1bnNpZ25lZCBpbnQgMjRfOCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVW5zaWduZWRJbnQyNDhUeXBlID0gMTAyMDsKCiAgICAvKioKICAgICAqIEFuIHVuc2lnbmVkIGludCA1XzlfOV85IChwYWNrZWQpIGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBVbnNpZ25lZEludDU5OTlUeXBlID0gMzU5MDI7CgogICAgLyoqCiAgICAgKiBEaXNjYXJkcyB0aGUgcmVkLCBncmVlbiBhbmQgYmx1ZSBjb21wb25lbnRzIGFuZCByZWFkcyBqdXN0IHRoZSBhbHBoYSBjb21wb25lbnQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBBbHBoYUZvcm1hdCA9IDEwMjE7CgogICAgLyoqCiAgICAgKiBEaXNjYXJkcyB0aGUgYWxwaGEgY29tcG9uZW50IGFuZCByZWFkcyB0aGUgcmVkLCBncmVlbiBhbmQgYmx1ZSBjb21wb25lbnQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JGb3JtYXQgPSAxMDIyOwoKICAgIC8qKgogICAgICogUmVhZHMgdGhlIHJlZCwgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBRm9ybWF0ID0gMTAyMzsKCiAgICAvKioKICAgICAqIFJlYWRzIGVhY2ggZWxlbWVudCBhcyBhIHNpbmdsZSBkZXB0aCB2YWx1ZSwgY29udmVydHMgaXQgdG8gZmxvYXRpbmcgcG9pbnQsIGFuZCBjbGFtcHMgdG8gdGhlIHJhbmdlIGBbMCwxXWAuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBEZXB0aEZvcm1hdCA9IDEwMjY7CgogICAgLyoqCiAgICAgKiBSZWFkcyBlYWNoIGVsZW1lbnQgaXMgYSBwYWlyIG9mIGRlcHRoIGFuZCBzdGVuY2lsIHZhbHVlcy4gVGhlIGRlcHRoIGNvbXBvbmVudCBvZiB0aGUgcGFpciBpcyBpbnRlcnByZXRlZCBhcwogICAgICogaW4gYERlcHRoRm9ybWF0YC4gVGhlIHN0ZW5jaWwgY29tcG9uZW50IGlzIGludGVycHJldGVkIGJhc2VkIG9uIHRoZSBkZXB0aCArIHN0ZW5jaWwgaW50ZXJuYWwgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgRGVwdGhTdGVuY2lsRm9ybWF0ID0gMTAyNzsKCiAgICAvKioKICAgICAqIERpc2NhcmRzIHRoZSBncmVlbiwgYmx1ZSBhbmQgYWxwaGEgY29tcG9uZW50cyBhbmQgcmVhZHMganVzdCB0aGUgcmVkIGNvbXBvbmVudC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJlZEZvcm1hdCA9IDEwMjg7CgogICAgLyoqCiAgICAgKiBEaXNjYXJkcyB0aGUgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMgYW5kIHJlYWRzIGp1c3QgdGhlIHJlZCBjb21wb25lbnQuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJlZEludGVnZXJGb3JtYXQgPSAxMDI5OwoKICAgIC8qKgogICAgICogRGlzY2FyZHMgdGhlIGFscGhhLCBhbmQgYmx1ZSBjb21wb25lbnRzIGFuZCByZWFkcyB0aGUgcmVkLCBhbmQgZ3JlZW4gY29tcG9uZW50cy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHRm9ybWF0ID0gMTAzMDsKCiAgICAvKioKICAgICAqIERpc2NhcmRzIHRoZSBhbHBoYSwgYW5kIGJsdWUgY29tcG9uZW50cyBhbmQgcmVhZHMgdGhlIHJlZCwgYW5kIGdyZWVuIGNvbXBvbmVudHMuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHSW50ZWdlckZvcm1hdCA9IDEwMzE7CgogICAgLyoqCiAgICAgKiBSZWFkcyB0aGUgcmVkLCBncmVlbiwgYmx1ZSBhbmQgYWxwaGEgY29tcG9uZW50cy4gVGhlIHRleGVscyBhcmUgcmVhZCBhcyBpbnRlZ2VycyBpbnN0ZWFkIG9mIGZsb2F0aW5nIHBvaW50LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQUludGVnZXJGb3JtYXQgPSAxMDMzOwoKICAgIC8qKgogICAgICogQSBEWFQxLWNvbXByZXNzZWQgaW1hZ2UgaW4gYW4gUkdCIGltYWdlIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQl9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3NzY7CgogICAgLyoqCiAgICAgKiBBIERYVDEtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0IgaW1hZ2UgZm9ybWF0IHdpdGggYSBzaW1wbGUgb24vb2ZmIGFscGhhIHZhbHVlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3Nzc7CgogICAgLyoqCiAgICAgKiBBIERYVDMtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0JBIGltYWdlIGZvcm1hdC4gQ29tcGFyZWQgdG8gYSAzMi1iaXQgUkdCQSB0ZXh0dXJlLCBpdCBvZmZlcnMgNDoxIGNvbXByZXNzaW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9TM1RDX0RYVDNfRm9ybWF0ID0gMzM3Nzg7CgogICAgLyoqCiAgICAgKiBBIERYVDUtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0JBIGltYWdlIGZvcm1hdC4gSXQgYWxzbyBwcm92aWRlcyBhIDQ6MSBjb21wcmVzc2lvbiwgYnV0IGRpZmZlcnMgdG8gdGhlIERYVDMKICAgICAqIGNvbXByZXNzaW9uIGluIGhvdyB0aGUgYWxwaGEgY29tcHJlc3Npb24gaXMgZG9uZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCA9IDMzNzc5OwoKICAgIC8qKgogICAgICogUFZSVEMgUkdCIGNvbXByZXNzaW9uIGluIDQtYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA0w5c0IHBpeGVscy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDA7CgogICAgLyoqCiAgICAgKiBQVlJUQyBSR0IgY29tcHJlc3Npb24gaW4gMi1iaXQgbW9kZS4gT25lIGJsb2NrIGZvciBlYWNoIDjDlzQgcGl4ZWxzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MTsKCiAgICAvKioKICAgICAqIFBWUlRDIFJHQkEgY29tcHJlc3Npb24gaW4gNC1iaXQgbW9kZS4gT25lIGJsb2NrIGZvciBlYWNoIDTDlzQgcGl4ZWxzLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDI7CgogICAgLyoqCiAgICAgKiBQVlJUQyBSR0JBIGNvbXByZXNzaW9uIGluIDItYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA4w5c0IHBpeGVscy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCA9IDM1ODQzOwoKICAgIC8qKgogICAgICogRVRDMSBSR0IgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCX0VUQzFfRm9ybWF0ID0gMzYxOTY7CgogICAgLyoqCiAgICAgKiBFVEMyIFJHQiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JfRVRDMl9Gb3JtYXQgPSAzNzQ5MjsKCiAgICAvKioKICAgICAqIEVUQzIgUkdCQSBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0VUQzJfRUFDX0Zvcm1hdCA9IDM3NDk2OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDR4NCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfNHg0X0Zvcm1hdCA9IDM3ODA4OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDV4NCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfNXg0X0Zvcm1hdCA9IDM3ODA5OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDV4NSBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfNXg1X0Zvcm1hdCA9IDM3ODEwOwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDZ4NSBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfNng1X0Zvcm1hdCA9IDM3ODExOwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDZ4NiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfNng2X0Zvcm1hdCA9IDM3ODEyOwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDh4NSBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfOHg1X0Zvcm1hdCA9IDM3ODEzOwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDh4NiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfOHg2X0Zvcm1hdCA9IDM3ODE0OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDh4OCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfOHg4X0Zvcm1hdCA9IDM3ODE1OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDEweDUgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzEweDVfRm9ybWF0ID0gMzc4MTY7CgogICAgLyoqCiAgICAgKiBBU1RDIFJHQkEgMTB4NiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgPSAzNzgxNzsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSAxMHg4IGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCA9IDM3ODE4OwoKICAgIC8qKgogICAgICogQVNUQyBSR0JBIDEweDEwIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSAzNzgxOTsKCiAgICAvKioKICAgICAqIEFTVEMgUkdCQSAxMngxMCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0ID0gMzc4MjA7CgogICAgLyoqCiAgICAgKiBBU1RDIFJHQkEgMTJ4MTIgZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCA9IDM3ODIxOwoKICAgIC8qKgogICAgICogQlBUQyBSR0JBIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFJHQkFfQlBUQ19Gb3JtYXQgPSAzNjQ5MjsKCiAgICAvKioKICAgICAqIEJQVEMgU2lnbmVkIFJHQiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JfQlBUQ19TSUdORURfRm9ybWF0ID0gMzY0OTQ7CgogICAgLyoqCiAgICAgKiBCUFRDIFVuc2lnbmVkIFJHQiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgPSAzNjQ5NTsKCiAgICAvKioKICAgICAqIFJHVEMxIFJlZCBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSRURfUkdUQzFfRm9ybWF0ID0gMzYyODM7CgogICAgLyoqCiAgICAgKiBSR1RDMSBTaWduZWQgUmVkIGZvcm1hdC4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFNJR05FRF9SRURfUkdUQzFfRm9ybWF0ID0gMzYyODQ7CgogICAgLyoqCiAgICAgKiBSR1RDMiBSZWQgR3JlZW4gZm9ybWF0LgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg1OwoKICAgIC8qKgogICAgICogUkdUQzIgU2lnbmVkIFJlZCBHcmVlbiBmb3JtYXQuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg2OwoKICAgIC8qKgogICAgICogQmFzaWMgZGVwdGggcGFja2luZy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEJhc2ljRGVwdGhQYWNraW5nID0gMzIwMDsKCiAgICAvKioKICAgICAqIEEgZGVwdGggdmFsdWUgaXMgcGFja2VkIGludG8gMzIgYml0IFJHQkEuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBSR0JBRGVwdGhQYWNraW5nID0gMzIwMTsKCiAgICAvKioKICAgICAqIE5vcm1hbCBpbmZvcm1hdGlvbiBpcyByZWxhdGl2ZSB0byB0aGUgdW5kZXJseWluZyBzdXJmYWNlLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgVGFuZ2VudFNwYWNlTm9ybWFsTWFwID0gMDsKCiAgICAvKioKICAgICAqIE5vcm1hbCBpbmZvcm1hdGlvbiBpcyByZWxhdGl2ZSB0byB0aGUgb2JqZWN0IG9yaWVudGF0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgT2JqZWN0U3BhY2VOb3JtYWxNYXAgPSAxOwoKICAgIC8vIENvbG9yIHNwYWNlIHN0cmluZyBpZGVudGlmaWVycywgbWF0Y2hpbmcgQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0IGFuZCBXZWJHUFUgbmFtZXMgd2hlcmUgYXZhaWxhYmxlLgoKICAgIC8qKgogICAgICogTm8gY29sb3Igc3BhY2UuCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOb0NvbG9yU3BhY2UgPSAnJzsKCiAgICAvKioKICAgICAqIHNSR0IgY29sb3Igc3BhY2UuCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTUkdCQ29sb3JTcGFjZSA9ICdzcmdiJzsKCiAgICAvKioKICAgICAqIHNSR0ItbGluZWFyIGNvbG9yIHNwYWNlLgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGluZWFyU1JHQkNvbG9yU3BhY2UgPSAnc3JnYi1saW5lYXInOwoKICAgIC8qKgogICAgICogTGluZWFyIHRyYW5zZmVyIGZ1bmN0aW9uLgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgTGluZWFyVHJhbnNmZXIgPSAnbGluZWFyJzsKCiAgICAvKioKICAgICAqIHNSR0IgdHJhbnNmZXIgZnVuY3Rpb24uCiAgICAgKgogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBTUkdCVHJhbnNmZXIgPSAnc3JnYic7CgogICAgLyoqCiAgICAgKiBLZWVwcyB0aGUgY3VycmVudCB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEtlZXBTdGVuY2lsT3AgPSA3NjgwOwoKICAgIC8qKgogICAgICogV2lsbCBhbHdheXMgcmV0dXJuIHRydWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBBbHdheXNTdGVuY2lsRnVuYyA9IDUxOTsKCiAgICAvKioKICAgICAqIE5ldmVyIHBhc3MuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBOZXZlckNvbXBhcmUgPSA1MTI7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBMZXNzQ29tcGFyZSA9IDUxMzsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGVxdWFscyB0aGUgdGV4dHVyZSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEVxdWFsQ29tcGFyZSA9IDUxNDsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IExlc3NFcXVhbENvbXBhcmUgPSA1MTU7CgogICAgLyoqCiAgICAgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRleHR1cmUgdmFsdWUuCiAgICAgKgogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBjb25zdGFudAogICAgICovCiAgICBjb25zdCBHcmVhdGVyQ29tcGFyZSA9IDUxNjsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIG5vdCBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IE5vdEVxdWFsQ29tcGFyZSA9IDUxNzsKCiAgICAvKioKICAgICAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEdyZWF0ZXJFcXVhbENvbXBhcmUgPSA1MTg7CgogICAgLyoqCiAgICAgKiBBbHdheXMgcGFzcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IEFsd2F5c0NvbXBhcmUgPSA1MTk7CgogICAgLyoqCiAgICAgKiBUaGUgY29udGVudHMgYXJlIGludGVuZGVkIHRvIGJlIHNwZWNpZmllZCBvbmNlIGJ5IHRoZSBhcHBsaWNhdGlvbiwgYW5kIHVzZWQgbWFueQogICAgICogdGltZXMgYXMgdGhlIHNvdXJjZSBmb3IgZHJhd2luZyBhbmQgaW1hZ2Ugc3BlY2lmaWNhdGlvbiBjb21tYW5kcy4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFN0YXRpY0RyYXdVc2FnZSA9IDM1MDQ0OwoKICAgIC8qKgogICAgICogR0xTTCAzIHNoYWRlciBjb2RlLgogICAgICoKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgR0xTTDMgPSAnMzAwIGVzJzsKCiAgICAvKioKICAgICAqIFdlYkdMIGNvb3JkaW5hdGUgc3lzdGVtLgogICAgICoKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAY29uc3RhbnQKICAgICAqLwogICAgY29uc3QgV2ViR0xDb29yZGluYXRlU3lzdGVtID0gMjAwMDsKCiAgICAvKioKICAgICAqIFdlYkdQVSBjb29yZGluYXRlIHN5c3RlbS4KICAgICAqCiAgICAgKiBAdHlwZSB7bnVtYmVyfQogICAgICogQGNvbnN0YW50CiAgICAgKi8KICAgIGNvbnN0IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gPSAyMDAxOwoKICAgIC8qKgogICAgICogVGhpcyB0eXBlIHJlcHJlc2VudHMgbW91c2UgYnV0dG9ucyBhbmQgaW50ZXJhY3Rpb24gdHlwZXMgaW4gY29udGV4dCBvZiBjb250cm9scy4KICAgICAqCiAgICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb25zdGFudHNNb3VzZQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IE1JRERMRSAtIFRoZSBsZWZ0IG1vdXNlIGJ1dHRvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBMRUZUIC0gVGhlIG1pZGRsZSBtb3VzZSBidXR0b24uCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gUklHSFQgLSBUaGUgcmlnaHQgbW91c2UgYnV0dG9uLgogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFJPVEFURSAtIEEgcm90YXRlIGludGVyYWN0aW9uLgogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IERPTExZIC0gQSBkb2xseSBpbnRlcmFjdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQQU4gLSBBIHBhbiBpbnRlcmFjdGlvbi4KICAgICAqKi8KCiAgICAvKioKICAgICAqIFRoaXMgdHlwZSByZXByZXNlbnRzIHRvdWNoIGludGVyYWN0aW9uIHR5cGVzIGluIGNvbnRleHQgb2YgY29udHJvbHMuCiAgICAgKgogICAgICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzVG91Y2gKICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBST1RBVEUgLSBBIHJvdGF0ZSBpbnRlcmFjdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQQU4gLSBBIHBhbiBpbnRlcmFjdGlvbi4KICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBET0xMWV9QQU4gLSBUaGUgZG9sbHktcGFuIGludGVyYWN0aW9uLgogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IERPTExZX1JPVEFURSAtIEEgZG9sbHktcm90YXRlIGludGVyYWN0aW9uLgogICAgICoqLwoKICAgIC8qKgogICAgICogVGhpcyB0eXBlIHJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCB0aW1lc3RhbXAgcXVlcnkgdHlwZXMuCiAgICAgKgogICAgICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzVGltZXN0YW1wUXVlcnkKICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDT01QVVRFIC0gQSBgY29tcHV0ZWAgdGltZXN0YW1wIHF1ZXJ5LgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFJFTkRFUiAtIEEgYHJlbmRlcmAgdGltZXN0YW1wIHF1ZXJ5LgogICAgICoqLwoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyB0aGUgZGlmZmVyZW50IGludGVycG9sYXRpb24gc2FtcGxpbmcgdHlwZXMuCiAgICAgKgogICAgICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzSW50ZXJwb2xhdGlvblNhbXBsaW5nVHlwZQogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFBFUlNQRUNUSVZFIC0gUGVyc3BlY3RpdmUtY29ycmVjdCBpbnRlcnBvbGF0aW9uLgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IExJTkVBUiAtIExpbmVhciBpbnRlcnBvbGF0aW9uLgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVQgLSBGbGF0IGludGVycG9sYXRpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCBpbnRlcnBvbGF0aW9uIHNhbXBsaW5nIG1vZGVzLgogICAgICoKICAgICAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnN0YW50c0ludGVycG9sYXRpb25TYW1wbGluZ01vZGUKICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBOT1JNQUwgLSBOb3JtYWwgc2FtcGxpbmcgbW9kZS4KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDRU5UUk9JRCAtIENlbnRyb2lkIHNhbXBsaW5nIG1vZGUuCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gU0FNUExFIC0gU2FtcGxlLXNwZWNpZmljIHNhbXBsaW5nIG1vZGUuCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gRkxBVF9GSVJTVCAtIEZsYXQgaW50ZXJwb2xhdGlvbiB1c2luZyB0aGUgZmlyc3QgdmVydGV4LgogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVRfRUlUSEVSIC0gRmxhdCBpbnRlcnBvbGF0aW9uIHVzaW5nIGVpdGhlciB2ZXJ0ZXguCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoaXMgbW9kdWxlcyBhbGxvd3MgdG8gZGlzcGF0Y2ggZXZlbnQgb2JqZWN0cyBvbiBjdXN0b20gSmF2YVNjcmlwdCBvYmplY3RzLgogICAgICoKICAgICAqIE1haW4gcmVwb3NpdG9yeTogW2V2ZW50ZGlzcGF0Y2hlci5qc117QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi9ldmVudGRpc3BhdGNoZXIuanMvfQogICAgICoKICAgICAqIENvZGUgRXhhbXBsZToKICAgICAqIGBgYGpzCiAgICAgKiBjbGFzcyBDYXIgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewogICAgICogCXN0YXJ0KCkgewogICAgICoJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc3RhcnQnLCBtZXNzYWdlOiAndnJvb20gdnJvb20hJyB9ICk7CiAgICAgKgl9CiAgICAgKn07CiAgICAgKgogICAgICogLy8gVXNpbmcgZXZlbnRzIHdpdGggdGhlIGN1c3RvbSBvYmplY3QKICAgICAqIGNvbnN0IGNhciA9IG5ldyBDYXIoKTsKICAgICAqIGNhci5hZGRFdmVudExpc3RlbmVyKCAnc3RhcnQnLCBmdW5jdGlvbiAoIGV2ZW50ICkgewogICAgICogCWFsZXJ0KCBldmVudC5tZXNzYWdlICk7CiAgICAgKiB9ICk7CiAgICAgKgogICAgICogY2FyLnN0YXJ0KCk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgRXZlbnREaXNwYXRjaGVyIHsKCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGdpdmVuIGV2ZW50IHR5cGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSB0eXBlIG9mIGV2ZW50IHRvIGxpc3RlbiB0by4KICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBmdW5jdGlvbiB0aGF0IGdldHMgY2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIGZpcmVkLgogICAgCSAqLwogICAgCWFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGxpc3RlbmVyICkgewoKICAgIAkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHRoaXMuX2xpc3RlbmVycyA9IHt9OwoKICAgIAkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgIAkJaWYgKCBsaXN0ZW5lcnNbIHR5cGUgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWxpc3RlbmVyc1sgdHlwZSBdID0gW107CgogICAgCQl9CgogICAgCQlpZiAoIGxpc3RlbmVyc1sgdHlwZSBdLmluZGV4T2YoIGxpc3RlbmVyICkgPT09IC0xICkgewoKICAgIAkJCWxpc3RlbmVyc1sgdHlwZSBdLnB1c2goIGxpc3RlbmVyICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGV2ZW50IGxpc3RlbmVyIGhhcyBiZWVuIGFkZGVkIHRvIHRoZSBnaXZlbiBldmVudCB0eXBlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudC4KICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBsaXN0ZW5lciB0byBjaGVjay4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBoYXMgYmVlbiBhZGRlZCB0byB0aGUgZ2l2ZW4gZXZlbnQgdHlwZS4KICAgIAkgKi8KICAgIAloYXNFdmVudExpc3RlbmVyKCB0eXBlLCBsaXN0ZW5lciApIHsKCiAgICAJCWNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAJCWlmICggbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSByZXR1cm4gZmFsc2U7CgogICAgCQlyZXR1cm4gbGlzdGVuZXJzWyB0eXBlIF0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApICE9PSAtMTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBmcm9tIHRoZSBnaXZlbiBldmVudCB0eXBlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudC4KICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBsaXN0ZW5lciB0byByZW1vdmUuCiAgICAJICovCiAgICAJcmVtb3ZlRXZlbnRMaXN0ZW5lciggdHlwZSwgbGlzdGVuZXIgKSB7CgogICAgCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgdHlwZSBdOwoKICAgIAkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY29uc3QgaW5kZXggPSBsaXN0ZW5lckFycmF5LmluZGV4T2YoIGxpc3RlbmVyICk7CgogICAgCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgogICAgCQkJCWxpc3RlbmVyQXJyYXkuc3BsaWNlKCBpbmRleCwgMSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEaXNwYXRjaGVzIGFuIGV2ZW50IG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAtIFRoZSBldmVudCB0aGF0IGdldHMgZmlyZWQuCiAgICAJICovCiAgICAJZGlzcGF0Y2hFdmVudCggZXZlbnQgKSB7CgogICAgCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgZXZlbnQudHlwZSBdOwoKICAgIAkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJZXZlbnQudGFyZ2V0ID0gdGhpczsKCiAgICAJCQkvLyBNYWtlIGEgY29weSwgaW4gY2FzZSBsaXN0ZW5lcnMgYXJlIHJlbW92ZWQgd2hpbGUgaXRlcmF0aW5nLgogICAgCQkJY29uc3QgYXJyYXkgPSBsaXN0ZW5lckFycmF5LnNsaWNlKCAwICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJYXJyYXlbIGkgXS5jYWxsKCB0aGlzLCBldmVudCApOwoKICAgIAkJCX0KCiAgICAJCQlldmVudC50YXJnZXQgPSBudWxsOwoKICAgIAkJfQoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF9sdXQgPSBbICcwMCcsICcwMScsICcwMicsICcwMycsICcwNCcsICcwNScsICcwNicsICcwNycsICcwOCcsICcwOScsICcwYScsICcwYicsICcwYycsICcwZCcsICcwZScsICcwZicsICcxMCcsICcxMScsICcxMicsICcxMycsICcxNCcsICcxNScsICcxNicsICcxNycsICcxOCcsICcxOScsICcxYScsICcxYicsICcxYycsICcxZCcsICcxZScsICcxZicsICcyMCcsICcyMScsICcyMicsICcyMycsICcyNCcsICcyNScsICcyNicsICcyNycsICcyOCcsICcyOScsICcyYScsICcyYicsICcyYycsICcyZCcsICcyZScsICcyZicsICczMCcsICczMScsICczMicsICczMycsICczNCcsICczNScsICczNicsICczNycsICczOCcsICczOScsICczYScsICczYicsICczYycsICczZCcsICczZScsICczZicsICc0MCcsICc0MScsICc0MicsICc0MycsICc0NCcsICc0NScsICc0NicsICc0NycsICc0OCcsICc0OScsICc0YScsICc0YicsICc0YycsICc0ZCcsICc0ZScsICc0ZicsICc1MCcsICc1MScsICc1MicsICc1MycsICc1NCcsICc1NScsICc1NicsICc1NycsICc1OCcsICc1OScsICc1YScsICc1YicsICc1YycsICc1ZCcsICc1ZScsICc1ZicsICc2MCcsICc2MScsICc2MicsICc2MycsICc2NCcsICc2NScsICc2NicsICc2NycsICc2OCcsICc2OScsICc2YScsICc2YicsICc2YycsICc2ZCcsICc2ZScsICc2ZicsICc3MCcsICc3MScsICc3MicsICc3MycsICc3NCcsICc3NScsICc3NicsICc3NycsICc3OCcsICc3OScsICc3YScsICc3YicsICc3YycsICc3ZCcsICc3ZScsICc3ZicsICc4MCcsICc4MScsICc4MicsICc4MycsICc4NCcsICc4NScsICc4NicsICc4NycsICc4OCcsICc4OScsICc4YScsICc4YicsICc4YycsICc4ZCcsICc4ZScsICc4ZicsICc5MCcsICc5MScsICc5MicsICc5MycsICc5NCcsICc5NScsICc5NicsICc5NycsICc5OCcsICc5OScsICc5YScsICc5YicsICc5YycsICc5ZCcsICc5ZScsICc5ZicsICdhMCcsICdhMScsICdhMicsICdhMycsICdhNCcsICdhNScsICdhNicsICdhNycsICdhOCcsICdhOScsICdhYScsICdhYicsICdhYycsICdhZCcsICdhZScsICdhZicsICdiMCcsICdiMScsICdiMicsICdiMycsICdiNCcsICdiNScsICdiNicsICdiNycsICdiOCcsICdiOScsICdiYScsICdiYicsICdiYycsICdiZCcsICdiZScsICdiZicsICdjMCcsICdjMScsICdjMicsICdjMycsICdjNCcsICdjNScsICdjNicsICdjNycsICdjOCcsICdjOScsICdjYScsICdjYicsICdjYycsICdjZCcsICdjZScsICdjZicsICdkMCcsICdkMScsICdkMicsICdkMycsICdkNCcsICdkNScsICdkNicsICdkNycsICdkOCcsICdkOScsICdkYScsICdkYicsICdkYycsICdkZCcsICdkZScsICdkZicsICdlMCcsICdlMScsICdlMicsICdlMycsICdlNCcsICdlNScsICdlNicsICdlNycsICdlOCcsICdlOScsICdlYScsICdlYicsICdlYycsICdlZCcsICdlZScsICdlZicsICdmMCcsICdmMScsICdmMicsICdmMycsICdmNCcsICdmNScsICdmNicsICdmNycsICdmOCcsICdmOScsICdmYScsICdmYicsICdmYycsICdmZCcsICdmZScsICdmZicgXTsKCgogICAgY29uc3QgREVHMlJBRCA9IE1hdGguUEkgLyAxODA7CiAgICBjb25zdCBSQUQyREVHID0gMTgwIC8gTWF0aC5QSTsKCiAgICAvKioKICAgICAqIEdlbmVyYXRlIGEgW1VVSURde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1VuaXZlcnNhbGx5X3VuaXF1ZV9pZGVudGlmaWVyfQogICAgICogKHVuaXZlcnNhbGx5IHVuaXF1ZSBpZGVudGlmaWVyKS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVVUlELgogICAgICovCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CgogICAgCS8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1MDM0L2hvdy10by1jcmVhdGUtYS1ndWlkLXV1aWQtaW4tamF2YXNjcmlwdC8yMTk2MzEzNiMyMTk2MzEzNgoKICAgIAljb25zdCBkMCA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKICAgIAljb25zdCBkMSA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKICAgIAljb25zdCBkMiA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKICAgIAljb25zdCBkMyA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKICAgIAljb25zdCB1dWlkID0gX2x1dFsgZDAgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiA4ICYgMHhmZiBdICsgX2x1dFsgZDAgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiAyNCAmIDB4ZmYgXSArICctJyArCiAgICAJCQlfbHV0WyBkMSAmIDB4ZmYgXSArIF9sdXRbIGQxID4+IDggJiAweGZmIF0gKyAnLScgKyBfbHV0WyBkMSA+PiAxNiAmIDB4MGYgfCAweDQwIF0gKyBfbHV0WyBkMSA+PiAyNCAmIDB4ZmYgXSArICctJyArCiAgICAJCQlfbHV0WyBkMiAmIDB4M2YgfCAweDgwIF0gKyBfbHV0WyBkMiA+PiA4ICYgMHhmZiBdICsgJy0nICsgX2x1dFsgZDIgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMiA+PiAyNCAmIDB4ZmYgXSArCiAgICAJCQlfbHV0WyBkMyAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDggJiAweGZmIF0gKyBfbHV0WyBkMyA+PiAxNiAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDI0ICYgMHhmZiBdOwoKICAgIAkvLyAudG9Mb3dlckNhc2UoKSBoZXJlIGZsYXR0ZW5zIGNvbmNhdGVuYXRlZCBzdHJpbmdzIHRvIHNhdmUgaGVhcCBtZW1vcnkgc3BhY2UuCiAgICAJcmV0dXJuIHV1aWQudG9Mb3dlckNhc2UoKTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBDbGFtcHMgdGhlIGdpdmVuIHZhbHVlIGJldHdlZW4gbWluIGFuZCBtYXguCiAgICAgKgogICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNsYW1wLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW4gdmFsdWUuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heCB2YWx1ZS4KICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNsYW1wZWQgdmFsdWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsYW1wKCB2YWx1ZSwgbWluLCBtYXggKSB7CgogICAgCXJldHVybiBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCB2YWx1ZSApICk7CgogICAgfQoKICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIEV1Y2xpZGVhbiBtb2R1bG8gb2YgdGhlIGdpdmVuIHBhcmFtZXRlcnMgdGhhdAogICAgICogaXMgYCggKCBuICUgbSApICsgbSApICUgbWAuCiAgICAgKgogICAgICogQHBhcmFtIHtudW1iZXJ9IG4gLSBUaGUgZmlyc3QgcGFyYW1ldGVyLgogICAgICogQHBhcmFtIHtudW1iZXJ9IG0gLSBUaGUgc2Vjb25kIHBhcmFtZXRlci4KICAgICAqIEByZXR1cm4ge251bWJlcn0gVGhlIEV1Y2xpZGVhbiBtb2R1bG8uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGV1Y2xpZGVhbk1vZHVsbyggbiwgbSApIHsKCiAgICAJLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTW9kdWxvX29wZXJhdGlvbgoKICAgIAlyZXR1cm4gKCAoIG4gJSBtICkgKyBtICkgJSBtOwoKICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybnMgYSB2YWx1ZSBsaW5lYXJseSBpbnRlcnBvbGF0ZWQgZnJvbSB0d28ga25vd24gcG9pbnRzIGJhc2VkIG9uIHRoZSBnaXZlbiBpbnRlcnZhbCAtCiAgICAgKiBgdCA9IDBgIHdpbGwgcmV0dXJuIGB4YCBhbmQgYHQgPSAxYCB3aWxsIHJldHVybiBgeWAuCiAgICAgKgogICAgICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgc3RhcnQgcG9pbnQKICAgICAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGVuZCBwb2ludC4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbnRlcnBvbGF0ZWQgdmFsdWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxlcnAoIHgsIHksIHQgKSB7CgogICAgCXJldHVybiAoIDEgLSB0ICkgKiB4ICsgdCAqIHk7CgogICAgfQoKICAgIC8qKgogICAgICogRGVub3JtYWxpemVzIHRoZSBnaXZlbiB2YWx1ZSBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHR5cGVkIGFycmF5LgogICAgICoKICAgICAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBkZW5vcm1hbGl6ZS4KICAgICAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgdHlwZWQgYXJyYXkgdGhhdCBkZWZpbmVzIHRoZSBkYXRhIHR5cGUgb2YgdGhlIHZhbHVlLgogICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGVub3JtYWxpemUgKGZsb2F0KSB2YWx1ZSBpbiB0aGUgcmFuZ2UgYFswLDFdYC4KICAgICAqLwogICAgZnVuY3Rpb24gZGVub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCiAgICAJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgogICAgCQljYXNlIEZsb2F0MzJBcnJheToKCiAgICAJCQlyZXR1cm4gdmFsdWU7CgogICAgCQljYXNlIFVpbnQzMkFycmF5OgoKICAgIAkJCXJldHVybiB2YWx1ZSAvIDQyOTQ5NjcyOTUuMDsKCiAgICAJCWNhc2UgVWludDE2QXJyYXk6CgogICAgCQkJcmV0dXJuIHZhbHVlIC8gNjU1MzUuMDsKCiAgICAJCWNhc2UgVWludDhBcnJheToKCiAgICAJCQlyZXR1cm4gdmFsdWUgLyAyNTUuMDsKCiAgICAJCWNhc2UgSW50MzJBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMjE0NzQ4MzY0Ny4wLCAtMSApOwoKICAgIAkJY2FzZSBJbnQxNkFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLm1heCggdmFsdWUgLyAzMjc2Ny4wLCAtMSApOwoKICAgIAkJY2FzZSBJbnQ4QXJyYXk6CgogICAgCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDEyNy4wLCAtMSApOwoKICAgIAkJZGVmYXVsdDoKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIE5vcm1hbGl6ZXMgdGhlIGdpdmVuIHZhbHVlIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gdHlwZWQgYXJyYXkuCiAgICAgKgogICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIGZsb2F0IHZhbHVlIGluIHRoZSByYW5nZSBgWzAsMV1gIHRvIG5vcm1hbGl6ZS4KICAgICAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgdHlwZWQgYXJyYXkgdGhhdCBkZWZpbmVzIHRoZSBkYXRhIHR5cGUgb2YgdGhlIHZhbHVlLgogICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgbm9ybWFsaXplIHZhbHVlLgogICAgICovCiAgICBmdW5jdGlvbiBub3JtYWxpemUkMyggdmFsdWUsIGFycmF5ICkgewoKICAgIAlzd2l0Y2ggKCBhcnJheS5jb25zdHJ1Y3RvciApIHsKCiAgICAJCWNhc2UgRmxvYXQzMkFycmF5OgoKICAgIAkJCXJldHVybiB2YWx1ZTsKCiAgICAJCWNhc2UgVWludDMyQXJyYXk6CgogICAgCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogNDI5NDk2NzI5NS4wICk7CgogICAgCQljYXNlIFVpbnQxNkFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDY1NTM1LjAgKTsKCiAgICAJCWNhc2UgVWludDhBcnJheToKCiAgICAJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAyNTUuMCApOwoKICAgIAkJY2FzZSBJbnQzMkFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDIxNDc0ODM2NDcuMCApOwoKICAgIAkJY2FzZSBJbnQxNkFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDMyNzY3LjAgKTsKCiAgICAJCWNhc2UgSW50OEFycmF5OgoKICAgIAkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDEyNy4wICk7CgogICAgCQlkZWZhdWx0OgoKICAgIAkJCXRocm93IG5ldyBFcnJvciggJ0ludmFsaWQgY29tcG9uZW50IHR5cGUuJyApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgMkQgdmVjdG9yLiBBIDJEIHZlY3RvciBpcyBhbiBvcmRlcmVkIHBhaXIgb2YgbnVtYmVycwogICAgICogKGxhYmVsZWQgeCBhbmQgeSksIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCBhIG51bWJlciBvZiB0aGluZ3MsIHN1Y2ggYXM6CiAgICAgKgogICAgICogLSBBIHBvaW50IGluIDJEIHNwYWNlIChpLmUuIGEgcG9zaXRpb24gb24gYSBwbGFuZSkuCiAgICAgKiAtIEEgZGlyZWN0aW9uIGFuZCBsZW5ndGggYWNyb3NzIGEgcGxhbmUuIEluIHRocmVlLmpzIHRoZSBsZW5ndGggd2lsbAogICAgICogYWx3YXlzIGJlIHRoZSBFdWNsaWRlYW4gZGlzdGFuY2Uoc3RyYWlnaHQtbGluZSBkaXN0YW5jZSkgZnJvbSBgKDAsIDApYCB0byBgKHgsIHkpYAogICAgICogYW5kIHRoZSBkaXJlY3Rpb24gaXMgYWxzbyBtZWFzdXJlZCBmcm9tIGAoMCwgMClgIHRvd2FyZHMgYCh4LCB5KWAuCiAgICAgKiAtIEFueSBhcmJpdHJhcnkgb3JkZXJlZCBwYWlyIG9mIG51bWJlcnMuCiAgICAgKgogICAgICogVGhlcmUgYXJlIG90aGVyIHRoaW5ncyBhIDJEIHZlY3RvciBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQsIHN1Y2ggYXMKICAgICAqIG1vbWVudHVtIHZlY3RvcnMsIGNvbXBsZXggbnVtYmVycyBhbmQgc28gb24sIGhvd2V2ZXIgdGhlc2UgYXJlIHRoZSBtb3N0CiAgICAgKiBjb21tb24gdXNlcyBpbiB0aHJlZS5qcy4KICAgICAqCiAgICAgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSlgIGluCiAgICAgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBhID0gbmV3IFRIUkVFLlZlY3RvcjIoIDAsIDEgKTsKICAgICAqCiAgICAgKiAvL25vIGFyZ3VtZW50czsgd2lsbCBiZSBpbml0aWFsaXNlZCB0byAoMCwgMCkKICAgICAqIGNvbnN0IGIgPSBuZXcgVEhSRUUuVmVjdG9yMiggKTsKICAgICAqCiAgICAgKiBjb25zdCBkID0gYS5kaXN0YW5jZVRvKCBiICk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgVmVjdG9yMiB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgMkQgdmVjdG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQlWZWN0b3IyLnByb3RvdHlwZS5pc1ZlY3RvcjIgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB4IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy54ID0geDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgeSB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMueSA9IHk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3IyI3h9LgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKi8KICAgIAlnZXQgd2lkdGgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy54OwoKICAgIAl9CgogICAgCXNldCB3aWR0aCggdmFsdWUgKSB7CgogICAgCQl0aGlzLnggPSB2YWx1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBbGlhcyBmb3Ige0BsaW5rIFZlY3RvcjIjeX0uCiAgICAJICoKICAgIAkgKiBAdHlwZSB7bnVtYmVyfQogICAgCSAqLwogICAgCWdldCBoZWlnaHQoKSB7CgogICAgCQlyZXR1cm4gdGhpcy55OwoKICAgIAl9CgogICAgCXNldCBoZWlnaHQoIHZhbHVlICkgewoKICAgIAkJdGhpcy55ID0gdmFsdWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSBvZiB0aGUgeCBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgb2YgdGhlIHkgY29tcG9uZW50LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldCggeCwgeSApIHsKCiAgICAJCXRoaXMueCA9IHg7CiAgICAJCXRoaXMueSA9IHk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2FtZSB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgdmFsdWUgdG8gc2V0IGZvciBhbGwgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnggPSBzY2FsYXI7CiAgICAJCXRoaXMueSA9IHNjYWxhcjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHggY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFgoIHggKSB7CgogICAgCQl0aGlzLnggPSB4OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yJ3MgeSBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0WSggeSApIHsKCiAgICAJCXRoaXMueSA9IHk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBbGxvd3MgdG8gc2V0IGEgdmVjdG9yIGNvbXBvbmVudCB3aXRoIGFuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbXBvbmVudCBpbmRleC4gYDBgIGVxdWFscyB0byB4LCBgMWAgZXF1YWxzIHRvIHkuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRDb21wb25lbnQoIGluZGV4LCB2YWx1ZSApIHsKCiAgICAJCXN3aXRjaCAoIGluZGV4ICkgewoKICAgIAkJCWNhc2UgMDogdGhpcy54ID0gdmFsdWU7IGJyZWFrOwogICAgCQkJY2FzZSAxOiB0aGlzLnkgPSB2YWx1ZTsgYnJlYWs7CiAgICAJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geS4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IEEgdmVjdG9yIGNvbXBvbmVudCB2YWx1ZS4KICAgIAkgKi8KICAgIAlnZXRDb21wb25lbnQoIGluZGV4ICkgewoKICAgIAkJc3dpdGNoICggaW5kZXggKSB7CgogICAgCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwogICAgCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwogICAgCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IHZlY3RvciB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLngsIHRoaXMueSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljb3B5KCB2ICkgewoKICAgIAkJdGhpcy54ID0gdi54OwogICAgCQl0aGlzLnkgPSB2Lnk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gYWRkLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZCggdiApIHsKCiAgICAJCXRoaXMueCArPSB2Lng7CiAgICAJCXRoaXMueSArPSB2Lnk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgdG8gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBhZGQuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkU2NhbGFyKCBzICkgewoKICAgIAkJdGhpcy54ICs9IHM7CiAgICAJCXRoaXMueSArPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkVmVjdG9ycyggYSwgYiApIHsKCiAgICAJCXRoaXMueCA9IGEueCArIGIueDsKICAgIAkJdGhpcy55ID0gYS55ICsgYi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHNjYWxlZCBieSB0aGUgZ2l2ZW4gZmFjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIGZhY3RvciB0aGF0IHNjYWxlcyBgdmAuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkU2NhbGVkVmVjdG9yKCB2LCBzICkgewoKICAgIAkJdGhpcy54ICs9IHYueCAqIHM7CiAgICAJCXRoaXMueSArPSB2LnkgKiBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiB2ZWN0b3IgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBzdWJ0cmFjdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzdWIoIHYgKSB7CgogICAgCQl0aGlzLnggLT0gdi54OwogICAgCQl0aGlzLnkgLT0gdi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgZnJvbSBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIHN1YnRyYWN0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXN1YlNjYWxhciggcyApIHsKCiAgICAJCXRoaXMueCAtPSBzOwogICAgCQl0aGlzLnkgLT0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc3ViVmVjdG9ycyggYSwgYiApIHsKCiAgICAJCXRoaXMueCA9IGEueCAtIGIueDsKICAgIAkJdGhpcy55ID0gYS55IC0gYi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbXVsdGlwbHkoIHYgKSB7CgogICAgCQl0aGlzLnggKj0gdi54OwogICAgCQl0aGlzLnkgKj0gdi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHdpdGggYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIG11bHRpcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnggKj0gc2NhbGFyOwogICAgCQl0aGlzLnkgKj0gc2NhbGFyOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGl2aWRlcyB0aGlzIGluc3RhbmNlIGJ5IHRoZSBnaXZlbiB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGRpdmlkZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlkaXZpZGUoIHYgKSB7CgogICAgCQl0aGlzLnggLz0gdi54OwogICAgCQl0aGlzLnkgLz0gdi55OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGl2aWRlcyB0aGlzIHZlY3RvciBieSB0aGUgZ2l2ZW4gc2NhbGFyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdG8gZGl2aWRlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWRpdmlkZVNjYWxhciggc2NhbGFyICkgewoKICAgIAkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoaXMgdmVjdG9yICh3aXRoIGFuIGltcGxpY2l0IDEgYXMgdGhlIDNyZCBjb21wb25lbnQpIGJ5CiAgICAJICogdGhlIGdpdmVuIDN4MyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIGFwcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4MyggbSApIHsKCiAgICAJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnk7CiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF07CiAgICAJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgNyBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4IG9yIHkKICAgIAkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWluIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltaW4oIHYgKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5taW4oIHRoaXMueSwgdi55ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHggb3IgeQogICAgCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtYXggdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1heCggdiApIHsKCiAgICAJCXRoaXMueCA9IE1hdGgubWF4KCB0aGlzLngsIHYueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLm1heCggdGhpcy55LCB2LnkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCBvciB5IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZlY3RvcidzIHggb3IgeQogICAgCSAqIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2ZWN0b3IncyB4IG9yIHkgdmFsdWUsCiAgICAJICogaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1pbiAtIFRoZSBtaW5pbXVtIHggYW5kIHkgdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gbWF4IC0gVGhlIG1heGltdW0geCBhbmQgeSB2YWx1ZXMgaW4gdGhlIGRlc2lyZWQgcmFuZ2UuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2xhbXAoIG1pbiwgbWF4ICkgewoKICAgIAkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCiAgICAJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pbi54LCBtYXgueCApOwogICAgCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW4ueSwgbWF4LnkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCBvciB5IHZhbHVlcyBhcmUgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIHRoZXkgYXJlCiAgICAJICogcmVwbGFjZWQgYnkgdGhlIG1heCB2YWx1ZS4KICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZXMgYXJlIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCB0aGV5IGFyZQogICAgCSAqIHJlcGxhY2VkIGJ5IHRoZSBtaW4gdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWluVmFsIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXhWYWwgLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKICAgIAkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluVmFsLCBtYXhWYWwgKTsKICAgIAkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluVmFsLCBtYXhWYWwgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieQogICAgCSAqIHRoZSBtYXggdmFsdWUuCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZQogICAgCSAqIG1pbiB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW4gLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1heCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljbGFtcExlbmd0aCggbWluLCBtYXggKSB7CgogICAgCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKICAgIAkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBjbGFtcCggbGVuZ3RoLCBtaW4sIG1heCApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJZmxvb3IoKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC5mbG9vciggdGhpcy55ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB1cCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2VpbCgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGguY2VpbCggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGguY2VpbCggdGhpcy55ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyb3VuZCgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLnJvdW5kKCB0aGlzLnkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIHRvd2FyZHMgemVybyAodXAgaWYgbmVnYXRpdmUsCiAgICAJICogZG93biBpZiBwb3NpdGl2ZSkgdG8gYW4gaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXJvdW5kVG9aZXJvKCkgewoKICAgIAkJdGhpcy54ID0gTWF0aC50cnVuYyggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW52ZXJ0cyB0aGlzIHZlY3RvciAtIGkuZS4gc2V0cyB4ID0gLXggYW5kIHkgPSAteS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW5lZ2F0ZSgpIHsKCiAgICAJCXRoaXMueCA9IC0gdGhpcy54OwogICAgCQl0aGlzLnkgPSAtIHRoaXMueTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCiAgICAJICovCiAgICAJZG90KCB2ICkgewoKICAgIAkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDYWxjdWxhdGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBjcm9zcyBwcm9kdWN0IHdpdGguCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIHRoZSBjcm9zcyBwcm9kdWN0LgogICAgCSAqLwogICAgCWNyb3NzKCB2ICkgewoKICAgIAkJcmV0dXJuIHRoaXMueCAqIHYueSAtIHRoaXMueSAqIHYueDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgc3F1YXJlIG9mIHRoZSBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbQogICAgCSAqICgwLCAwKSB0byAoeCwgeSkuIElmIHlvdSBhcmUgY29tcGFyaW5nIHRoZSBsZW5ndGhzIG9mIHZlY3RvcnMsIHlvdSBzaG91bGQKICAgIAkgKiBjb21wYXJlIHRoZSBsZW5ndGggc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbGVuZ3RoU3EoKSB7CgogICAgCQlyZXR1cm4gdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSAgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIGZyb20gKDAsIDApIHRvICh4LCB5KS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlsZW5ndGgoKSB7CgogICAgCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgTWFuaGF0dGFuIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltYW5oYXR0YW5MZW5ndGgoKSB7CgogICAgCQlyZXR1cm4gTWF0aC5hYnMoIHRoaXMueCApICsgTWF0aC5hYnMoIHRoaXMueSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbnZlcnRzIHRoaXMgdmVjdG9yIHRvIGEgdW5pdCB2ZWN0b3IgLSB0aGF0IGlzLCBzZXRzIGl0IGVxdWFsIHRvIGEgdmVjdG9yCiAgICAJICogd2l0aCB0aGUgc2FtZSBkaXJlY3Rpb24gYXMgdGhpcyBvbmUsIGJ1dCB3aXRoIGEgdmVjdG9yIGxlbmd0aCBvZiBgMWAuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlub3JtYWxpemUoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIHRoaXMubGVuZ3RoKCkgfHwgMSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBhbmdsZSBpbiByYWRpYW5zIG9mIHRoaXMgdmVjdG9yIHdpdGggcmVzcGVjdCB0byB0aGUgcG9zaXRpdmUgeC1heGlzLgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKi8KICAgIAlhbmdsZSgpIHsKCiAgICAJCWNvbnN0IGFuZ2xlID0gTWF0aC5hdGFuMiggLSB0aGlzLnksIC0gdGhpcy54ICkgKyBNYXRoLlBJOwoKICAgIAkJcmV0dXJuIGFuZ2xlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGFuZ2xlIGJldHdlZW4gdGhlIGdpdmVuIHZlY3RvciBhbmQgdGhpcyBpbnN0YW5jZSBpbiByYWRpYW5zLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBhbmdsZSB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICovCiAgICAJYW5nbGVUbyggdiApIHsKCiAgICAJCWNvbnN0IGRlbm9taW5hdG9yID0gTWF0aC5zcXJ0KCB0aGlzLmxlbmd0aFNxKCkgKiB2Lmxlbmd0aFNxKCkgKTsKCiAgICAJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSByZXR1cm4gTWF0aC5QSSAvIDI7CgogICAgCQljb25zdCB0aGV0YSA9IHRoaXMuZG90KCB2ICkgLyBkZW5vbWluYXRvcjsKCiAgICAJCS8vIGNsYW1wLCB0byBoYW5kbGUgbnVtZXJpY2FsIHByb2JsZW1zCgogICAgCQlyZXR1cm4gTWF0aC5hY29zKCBjbGFtcCggdGhldGEsIC0xLCAxICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlVG8oIHYgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgc3F1YXJlZCBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKiBJZiB5b3UgYXJlIGp1c3QgY29tcGFyaW5nIHRoZSBkaXN0YW5jZSB3aXRoIGFub3RoZXIgZGlzdGFuY2UsIHlvdSBzaG91bGQgY29tcGFyZQogICAgCSAqIHRoZSBkaXN0YW5jZSBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBzcXVhcmVkIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1NxdWFyZWQoIHYgKSB7CgogICAgCQljb25zdCBkeCA9IHRoaXMueCAtIHYueCwgZHkgPSB0aGlzLnkgLSB2Lnk7CiAgICAJCXJldHVybiBkeCAqIGR4ICsgZHkgKiBkeTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBNYW5oYXR0YW4gZGlzdGFuY2UgdG8uCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgTWFuaGF0dGFuIGRpc3RhbmNlLgogICAgCSAqLwogICAgCW1hbmhhdHRhbkRpc3RhbmNlVG8oIHYgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5hYnMoIHRoaXMueCAtIHYueCApICsgTWF0aC5hYnMoIHRoaXMueSAtIHYueSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyB2ZWN0b3IgdG8gYSB2ZWN0b3Igd2l0aCB0aGUgc2FtZSBkaXJlY3Rpb24gYXMgdGhpcyBvbmUsIGJ1dAogICAgCSAqIHdpdGggdGhlIHNwZWNpZmllZCBsZW5ndGguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIC0gVGhlIG5ldyBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0TGVuZ3RoKCBsZW5ndGggKSB7CgogICAgCQlyZXR1cm4gdGhpcy5ub3JtYWxpemUoKS5tdWx0aXBseVNjYWxhciggbGVuZ3RoICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIGJldHdlZW4gdGhlIGdpdmVuIHZlY3RvciBhbmQgdGhpcyBpbnN0YW5jZSwgd2hlcmUKICAgIAkgKiBhbHBoYSBpcyB0aGUgcGVyY2VudCBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIHRoaXMKICAgIAkgKiB2ZWN0b3IsIGFuZCBhbHBoYSA9IDEgd2lsbCBiZSB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBpbnRlcnBvbGF0ZSB0b3dhcmRzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciwgdHlwaWNhbGx5IGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbGVycCggdiwgYWxwaGEgKSB7CgogICAgCQl0aGlzLnggKz0gKCB2LnggLSB0aGlzLnggKSAqIGFscGhhOwogICAgCQl0aGlzLnkgKz0gKCB2LnkgLSB0aGlzLnkgKSAqIGFscGhhOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIGJldHdlZW4gdGhlIGdpdmVuIHZlY3RvcnMsIHdoZXJlIGFscGhhIGlzIHRoZSBwZXJjZW50CiAgICAJICogZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgLSBhbHBoYSA9IDAgd2lsbCBiZSBmaXJzdCB2ZWN0b3IsIGFuZCBhbHBoYSA9IDEgd2lsbAogICAgCSAqIGJlIHRoZSBzZWNvbmQgb25lLiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2MSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB2MiAtIFRoZSBzZWNvbmQgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciwgdHlwaWNhbGx5IGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbGVycFZlY3RvcnMoIHYxLCB2MiwgYWxwaGEgKSB7CgogICAgCQl0aGlzLnggPSB2MS54ICsgKCB2Mi54IC0gdjEueCApICogYWxwaGE7CiAgICAJCXRoaXMueSA9IHYxLnkgKyAoIHYyLnkgLSB2MS55ICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCB2ICkgewoKICAgIAkJcmV0dXJuICggKCB2LnggPT09IHRoaXMueCApICYmICggdi55ID09PSB0aGlzLnkgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyB2ZWN0b3IncyB4IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0IF1gIGFuZCB5CiAgICAJICogdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAxIF1gLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIHZlY3RvciBjb21wb25lbnQgdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKICAgIAkJdGhpcy54ID0gYXJyYXlbIG9mZnNldCBdOwogICAgCQl0aGlzLnkgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV3JpdGVzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICovCiAgICAJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMueDsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyB2ZWN0b3IgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYXR0cmlidXRlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgogICAgCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKICAgIAkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoaXMgdmVjdG9yIGFyb3VuZCB0aGUgZ2l2ZW4gY2VudGVyIGJ5IHRoZSBnaXZlbiBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gY2VudGVyIC0gVGhlIHBvaW50IGFyb3VuZCB3aGljaCB0byByb3RhdGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIHRvIHJvdGF0ZSwgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyb3RhdGVBcm91bmQoIGNlbnRlciwgYW5nbGUgKSB7CgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIGFuZ2xlICksIHMgPSBNYXRoLnNpbiggYW5nbGUgKTsKCiAgICAJCWNvbnN0IHggPSB0aGlzLnggLSBjZW50ZXIueDsKICAgIAkJY29uc3QgeSA9IHRoaXMueSAtIGNlbnRlci55OwoKICAgIAkJdGhpcy54ID0geCAqIGMgLSB5ICogcyArIGNlbnRlci54OwogICAgCQl0aGlzLnkgPSB4ICogcyArIHkgKiBjICsgY2VudGVyLnk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIGVhY2ggY29tcG9uZW50IG9mIHRoaXMgdmVjdG9yIHRvIGEgcHNldWRvLXJhbmRvbSB2YWx1ZSBiZXR3ZWVuIGAwYCBhbmQKICAgIAkgKiBgMWAsIGV4Y2x1ZGluZyBgMWAuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyYW5kb20oKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwogICAgCQl0aGlzLnkgPSBNYXRoLnJhbmRvbSgpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgogICAgCQl5aWVsZCB0aGlzLng7CiAgICAJCXlpZWxkIHRoaXMueTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENsYXNzIGZvciByZXByZXNlbnRpbmcgYSBRdWF0ZXJuaW9uLiBRdWF0ZXJuaW9ucyBhcmUgdXNlZCBpbiB0aHJlZS5qcyB0byByZXByZXNlbnQgcm90YXRpb25zLgogICAgICoKICAgICAqIEl0ZXJhdGluZyB0aHJvdWdoIGEgdmVjdG9yIGluc3RhbmNlIHdpbGwgeWllbGQgaXRzIGNvbXBvbmVudHMgYCh4LCB5LCB6LCB3KWAgaW4KICAgICAqIHRoZSBjb3JyZXNwb25kaW5nIG9yZGVyLgogICAgICoKICAgICAqIE5vdGUgdGhhdCB0aHJlZS5qcyBleHBlY3RzIFF1YXRlcm5pb25zIHRvIGJlIG5vcm1hbGl6ZWQuCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgcXVhdGVybmlvbiA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCk7CiAgICAgKiBxdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoIG5ldyBUSFJFRS5WZWN0b3IzKCAwLCAxLCAwICksIE1hdGguUEkgLyAyICk7CiAgICAgKgogICAgICogY29uc3QgdmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoIDEsIDAsIDAgKTsKICAgICAqIHZlY3Rvci5hcHBseVF1YXRlcm5pb24oIHF1YXRlcm5pb24gKTsKICAgICAqIGBgYAogICAgICovCiAgICBjbGFzcyBRdWF0ZXJuaW9uIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbeT0wXSAtIFRoZSB5IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3o9MF0gLSBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3PTFdIC0gVGhlIHcgdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAsIHogPSAwLCB3ID0gMSApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzUXVhdGVybmlvbiA9IHRydWU7CgogICAgCQl0aGlzLl94ID0geDsKICAgIAkJdGhpcy5feSA9IHk7CiAgICAJCXRoaXMuX3ogPSB6OwogICAgCQl0aGlzLl93ID0gdzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnRlcnBvbGF0ZXMgYmV0d2VlbiB0d28gcXVhdGVybmlvbnMgdmlhIFNMRVJQLiBUaGlzIGltcGxlbWVudGF0aW9uIGFzc3VtZXMgdGhlCiAgICAJICogcXVhdGVybmlvbiBkYXRhIGFyZSBtYW5hZ2VkICBpbiBmbGF0IGFycmF5cy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gZHN0IC0gVGhlIGRlc3RpbmF0aW9uIGFycmF5LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkc3RPZmZzZXQgLSBBbiBvZmZzZXQgaW50byB0aGUgZGVzdGluYXRpb24gYXJyYXkuCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBzcmMwIC0gVGhlIHNvdXJjZSBhcnJheSBvZiB0aGUgZmlyc3QgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MCAtIEFuIG9mZnNldCBpbnRvIHRoZSBmaXJzdCBzb3VyY2UgYXJyYXkuCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBzcmMxIC0gIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIHNlY29uZCBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzcmNPZmZzZXQxIC0gQW4gb2Zmc2V0IGludG8gdGhlIHNlY29uZCBzb3VyY2UgYXJyYXkuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHQgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IgaW4gdGhlIHJhbmdlIGBbMCwxXWAuCiAgICAJICogQHNlZSB7QGxpbmsgUXVhdGVybmlvbiNzbGVycH0KICAgIAkgKi8KICAgIAlzdGF0aWMgc2xlcnBGbGF0KCBkc3QsIGRzdE9mZnNldCwgc3JjMCwgc3JjT2Zmc2V0MCwgc3JjMSwgc3JjT2Zmc2V0MSwgdCApIHsKCiAgICAJCS8vIGZ1enotZnJlZSwgYXJyYXktYmFzZWQgUXVhdGVybmlvbiBTTEVSUCBvcGVyYXRpb24KCiAgICAJCWxldCB4MCA9IHNyYzBbIHNyY09mZnNldDAgKyAwIF0sCiAgICAJCQl5MCA9IHNyYzBbIHNyY09mZnNldDAgKyAxIF0sCiAgICAJCQl6MCA9IHNyYzBbIHNyY09mZnNldDAgKyAyIF0sCiAgICAJCQl3MCA9IHNyYzBbIHNyY09mZnNldDAgKyAzIF07CgogICAgCQljb25zdCB4MSA9IHNyYzFbIHNyY09mZnNldDEgKyAwIF0sCiAgICAJCQl5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF0sCiAgICAJCQl6MSA9IHNyYzFbIHNyY09mZnNldDEgKyAyIF0sCiAgICAJCQl3MSA9IHNyYzFbIHNyY09mZnNldDEgKyAzIF07CgogICAgCQlpZiAoIHQgPT09IDAgKSB7CgogICAgCQkJZHN0WyBkc3RPZmZzZXQgKyAwIF0gPSB4MDsKICAgIAkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTA7CiAgICAJCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHowOwogICAgCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MDsKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWlmICggdCA9PT0gMSApIHsKCiAgICAJCQlkc3RbIGRzdE9mZnNldCArIDAgXSA9IHgxOwogICAgCQkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MTsKICAgIAkJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejE7CiAgICAJCQlkc3RbIGRzdE9mZnNldCArIDMgXSA9IHcxOwogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJaWYgKCB3MCAhPT0gdzEgfHwgeDAgIT09IHgxIHx8IHkwICE9PSB5MSB8fCB6MCAhPT0gejEgKSB7CgogICAgCQkJbGV0IHMgPSAxIC0gdDsKICAgIAkJCWNvbnN0IGNvcyA9IHgwICogeDEgKyB5MCAqIHkxICsgejAgKiB6MSArIHcwICogdzEsCiAgICAJCQkJZGlyID0gKCBjb3MgPj0gMCA/IDEgOiAtMSApLAogICAgCQkJCXNxclNpbiA9IDEgLSBjb3MgKiBjb3M7CgogICAgCQkJLy8gU2tpcCB0aGUgU2xlcnAgZm9yIHRpbnkgc3RlcHMgdG8gYXZvaWQgbnVtZXJpYyBwcm9ibGVtczoKICAgIAkJCWlmICggc3FyU2luID4gTnVtYmVyLkVQU0lMT04gKSB7CgogICAgCQkJCWNvbnN0IHNpbiA9IE1hdGguc3FydCggc3FyU2luICksCiAgICAJCQkJCWxlbiA9IE1hdGguYXRhbjIoIHNpbiwgY29zICogZGlyICk7CgogICAgCQkJCXMgPSBNYXRoLnNpbiggcyAqIGxlbiApIC8gc2luOwogICAgCQkJCXQgPSBNYXRoLnNpbiggdCAqIGxlbiApIC8gc2luOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCB0RGlyID0gdCAqIGRpcjsKCiAgICAJCQl4MCA9IHgwICogcyArIHgxICogdERpcjsKICAgIAkJCXkwID0geTAgKiBzICsgeTEgKiB0RGlyOwogICAgCQkJejAgPSB6MCAqIHMgKyB6MSAqIHREaXI7CiAgICAJCQl3MCA9IHcwICogcyArIHcxICogdERpcjsKCiAgICAJCQkvLyBOb3JtYWxpemUgaW4gY2FzZSB3ZSBqdXN0IGRpZCBhIGxlcnA6CiAgICAJCQlpZiAoIHMgPT09IDEgLSB0ICkgewoKICAgIAkJCQljb25zdCBmID0gMSAvIE1hdGguc3FydCggeDAgKiB4MCArIHkwICogeTAgKyB6MCAqIHowICsgdzAgKiB3MCApOwoKICAgIAkJCQl4MCAqPSBmOwogICAgCQkJCXkwICo9IGY7CiAgICAJCQkJejAgKj0gZjsKICAgIAkJCQl3MCAqPSBmOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWRzdFsgZHN0T2Zmc2V0IF0gPSB4MDsKICAgIAkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MDsKICAgIAkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MDsKICAgIAkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHR3byBxdWF0ZXJuaW9ucy4gVGhpcyBpbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZSBxdWF0ZXJuaW9uIGRhdGEgYXJlIG1hbmFnZWQKICAgIAkgKiBpbiBmbGF0IGFycmF5cy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gZHN0IC0gVGhlIGRlc3RpbmF0aW9uIGFycmF5LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkc3RPZmZzZXQgLSBBbiBvZmZzZXQgaW50byB0aGUgZGVzdGluYXRpb24gYXJyYXkuCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBzcmMwIC0gVGhlIHNvdXJjZSBhcnJheSBvZiB0aGUgZmlyc3QgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MCAtIEFuIG9mZnNldCBpbnRvIHRoZSBmaXJzdCBzb3VyY2UgYXJyYXkuCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBzcmMxIC0gIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIHNlY29uZCBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzcmNPZmZzZXQxIC0gQW4gb2Zmc2V0IGludG8gdGhlIHNlY29uZCBzb3VyY2UgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIGRlc3RpbmF0aW9uIGFycmF5LgogICAgCSAqIEBzZWUge0BsaW5rIFF1YXRlcm5pb24jbXVsdGlwbHlRdWF0ZXJuaW9uc30uCiAgICAJICovCiAgICAJc3RhdGljIG11bHRpcGx5UXVhdGVybmlvbnNGbGF0KCBkc3QsIGRzdE9mZnNldCwgc3JjMCwgc3JjT2Zmc2V0MCwgc3JjMSwgc3JjT2Zmc2V0MSApIHsKCiAgICAJCWNvbnN0IHgwID0gc3JjMFsgc3JjT2Zmc2V0MCBdOwogICAgCQljb25zdCB5MCA9IHNyYzBbIHNyY09mZnNldDAgKyAxIF07CiAgICAJCWNvbnN0IHowID0gc3JjMFsgc3JjT2Zmc2V0MCArIDIgXTsKICAgIAkJY29uc3QgdzAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMyBdOwoKICAgIAkJY29uc3QgeDEgPSBzcmMxWyBzcmNPZmZzZXQxIF07CiAgICAJCWNvbnN0IHkxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDEgXTsKICAgIAkJY29uc3QgejEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMiBdOwogICAgCQljb25zdCB3MSA9IHNyYzFbIHNyY09mZnNldDEgKyAzIF07CgogICAgCQlkc3RbIGRzdE9mZnNldCBdID0geDAgKiB3MSArIHcwICogeDEgKyB5MCAqIHoxIC0gejAgKiB5MTsKICAgIAkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MCAqIHcxICsgdzAgKiB5MSArIHowICogeDEgLSB4MCAqIHoxOwogICAgCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHowICogdzEgKyB3MCAqIHoxICsgeDAgKiB5MSAtIHkwICogeDE7CiAgICAJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzAgKiB3MSAtIHgwICogeDEgLSB5MCAqIHkxIC0gejAgKiB6MTsKCiAgICAJCXJldHVybiBkc3Q7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIHggdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCAwCiAgICAJICovCiAgICAJZ2V0IHgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5feDsKCiAgICAJfQoKICAgIAlzZXQgeCggdmFsdWUgKSB7CgogICAgCQl0aGlzLl94ID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCiAgICAJICoKICAgIAkgKiBAdHlwZSB7bnVtYmVyfQogICAgCSAqIEBkZWZhdWx0IDAKICAgIAkgKi8KICAgIAlnZXQgeSgpIHsKCiAgICAJCXJldHVybiB0aGlzLl95OwoKICAgIAl9CgogICAgCXNldCB5KCB2YWx1ZSApIHsKCiAgICAJCXRoaXMuX3kgPSB2YWx1ZTsKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSB6IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJICogQGRlZmF1bHQgMAogICAgCSAqLwogICAgCWdldCB6KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3o7CgogICAgCX0KCiAgICAJc2V0IHooIHZhbHVlICkgewoKICAgIAkJdGhpcy5feiA9IHZhbHVlOwogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIHcgdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCAxCiAgICAJICovCiAgICAJZ2V0IHcoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fdzsKCiAgICAJfQoKICAgIAlzZXQgdyggdmFsdWUgKSB7CgogICAgCQl0aGlzLl93ID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudHMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB6IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdyAtIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJc2V0KCB4LCB5LCB6LCB3ICkgewoKICAgIAkJdGhpcy5feCA9IHg7CiAgICAJCXRoaXMuX3kgPSB5OwogICAgCQl0aGlzLl96ID0gejsKICAgIAkJdGhpcy5fdyA9IHc7CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IHF1YXRlcm5pb24gd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiwgdGhpcy5fdyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBxdWF0ZXJuaW9uIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHF1YXRlcm5pb24gLSBUaGUgcXVhdGVybmlvbiB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAljb3B5KCBxdWF0ZXJuaW9uICkgewoKICAgIAkJdGhpcy5feCA9IHF1YXRlcm5pb24ueDsKICAgIAkJdGhpcy5feSA9IHF1YXRlcm5pb24ueTsKICAgIAkJdGhpcy5feiA9IHF1YXRlcm5pb24uejsKICAgIAkJdGhpcy5fdyA9IHF1YXRlcm5pb24udzsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIGZyb20gdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieSB0aGUgZ2l2ZW4KICAgIAkgKiBFdWxlciBhbmdsZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbdXBkYXRlPXRydWVdIC0gV2hldGhlciB0aGUgaW50ZXJuYWwgYG9uQ2hhbmdlYCBjYWxsYmFjayBzaG91bGQgYmUgZXhlY3V0ZWQgb3Igbm90LgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlzZXRGcm9tRXVsZXIoIGV1bGVyLCB1cGRhdGUgPSB0cnVlICkgewoKICAgIAkJY29uc3QgeCA9IGV1bGVyLl94LCB5ID0gZXVsZXIuX3ksIHogPSBldWxlci5feiwgb3JkZXIgPSBldWxlci5fb3JkZXI7CgogICAgCQkvLyBodHRwOi8vd3d3Lm1hdGh3b3Jrcy5jb20vbWF0bGFiY2VudHJhbC9maWxlZXhjaGFuZ2UvCiAgICAJCS8vIAkyMDY5Ni1mdW5jdGlvbi10by1jb252ZXJ0LWJldHdlZW4tZGNtLWV1bGVyLWFuZ2xlcy1xdWF0ZXJuaW9ucy1hbmQtZXVsZXItdmVjdG9ycy8KICAgIAkJLy8JY29udGVudC9TcGluQ2FsYy5tCgogICAgCQljb25zdCBjb3MgPSBNYXRoLmNvczsKICAgIAkJY29uc3Qgc2luID0gTWF0aC5zaW47CgogICAgCQljb25zdCBjMSA9IGNvcyggeCAvIDIgKTsKICAgIAkJY29uc3QgYzIgPSBjb3MoIHkgLyAyICk7CiAgICAJCWNvbnN0IGMzID0gY29zKCB6IC8gMiApOwoKICAgIAkJY29uc3QgczEgPSBzaW4oIHggLyAyICk7CiAgICAJCWNvbnN0IHMyID0gc2luKCB5IC8gMiApOwogICAgCQljb25zdCBzMyA9IHNpbiggeiAvIDIgKTsKCiAgICAJCXN3aXRjaCAoIG9yZGVyICkgewoKICAgIAkJCWNhc2UgJ1hZWic6CiAgICAJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgIAkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlICdZWFonOgogICAgCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgIAkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWlhZJzoKICAgIAkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgIAkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1pZWCc6CiAgICAJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgIAkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlICdZWlgnOgogICAgCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgIAkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWFpZJzoKICAgIAkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgIAkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWRlZmF1bHQ6CiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuUXVhdGVybmlvbjogLnNldEZyb21FdWxlcigpIGVuY291bnRlcmVkIGFuIHVua25vd24gb3JkZXI6ICcgKyBvcmRlciApOwoKICAgIAkJfQoKICAgIAkJaWYgKCB1cGRhdGUgPT09IHRydWUgKSB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiBheGlzIGFuZCBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSBub3JtYWxpemVkIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICkgewoKICAgIAkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL2FuZ2xlVG9RdWF0ZXJuaW9uL2luZGV4Lmh0bQoKICAgIAkJY29uc3QgaGFsZkFuZ2xlID0gYW5nbGUgLyAyLCBzID0gTWF0aC5zaW4oIGhhbGZBbmdsZSApOwoKICAgIAkJdGhpcy5feCA9IGF4aXMueCAqIHM7CiAgICAJCXRoaXMuX3kgPSBheGlzLnkgKiBzOwogICAgCQl0aGlzLl96ID0gYXhpcy56ICogczsKICAgIAkJdGhpcy5fdyA9IE1hdGguY29zKCBoYWxmQW5nbGUgKTsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIGZyb20gdGhlIGdpdmVuIHJvdGF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEEgNHg0IG1hdHJpeCBvZiB3aGljaCB0aGUgdXBwZXIgM3gzIG9mIG1hdHJpeCBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUuIHVuc2NhbGVkKS4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtICkgewoKICAgIAkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL21hdHJpeFRvUXVhdGVybmlvbi9pbmRleC5odG0KCiAgICAJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgogICAgCQljb25zdCB0ZSA9IG0uZWxlbWVudHMsCgogICAgCQkJbTExID0gdGVbIDAgXSwgbTEyID0gdGVbIDQgXSwgbTEzID0gdGVbIDggXSwKICAgIAkJCW0yMSA9IHRlWyAxIF0sIG0yMiA9IHRlWyA1IF0sIG0yMyA9IHRlWyA5IF0sCiAgICAJCQltMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXSwKCiAgICAJCQl0cmFjZSA9IG0xMSArIG0yMiArIG0zMzsKCiAgICAJCWlmICggdHJhY2UgPiAwICkgewoKICAgIAkJCWNvbnN0IHMgPSAwLjUgLyBNYXRoLnNxcnQoIHRyYWNlICsgMS4wICk7CgogICAgCQkJdGhpcy5fdyA9IDAuMjUgLyBzOwogICAgCQkJdGhpcy5feCA9ICggbTMyIC0gbTIzICkgKiBzOwogICAgCQkJdGhpcy5feSA9ICggbTEzIC0gbTMxICkgKiBzOwogICAgCQkJdGhpcy5feiA9ICggbTIxIC0gbTEyICkgKiBzOwoKICAgIAkJfSBlbHNlIGlmICggbTExID4gbTIyICYmIG0xMSA+IG0zMyApIHsKCiAgICAJCQljb25zdCBzID0gMi4wICogTWF0aC5zcXJ0KCAxLjAgKyBtMTEgLSBtMjIgLSBtMzMgKTsKCiAgICAJCQl0aGlzLl93ID0gKCBtMzIgLSBtMjMgKSAvIHM7CiAgICAJCQl0aGlzLl94ID0gMC4yNSAqIHM7CiAgICAJCQl0aGlzLl95ID0gKCBtMTIgKyBtMjEgKSAvIHM7CiAgICAJCQl0aGlzLl96ID0gKCBtMTMgKyBtMzEgKSAvIHM7CgogICAgCQl9IGVsc2UgaWYgKCBtMjIgPiBtMzMgKSB7CgogICAgCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTIyIC0gbTExIC0gbTMzICk7CgogICAgCQkJdGhpcy5fdyA9ICggbTEzIC0gbTMxICkgLyBzOwogICAgCQkJdGhpcy5feCA9ICggbTEyICsgbTIxICkgLyBzOwogICAgCQkJdGhpcy5feSA9IDAuMjUgKiBzOwogICAgCQkJdGhpcy5feiA9ICggbTIzICsgbTMyICkgLyBzOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zdCBzID0gMi4wICogTWF0aC5zcXJ0KCAxLjAgKyBtMzMgLSBtMTEgLSBtMjIgKTsKCiAgICAJCQl0aGlzLl93ID0gKCBtMjEgLSBtMTIgKSAvIHM7CiAgICAJCQl0aGlzLl94ID0gKCBtMTMgKyBtMzEgKSAvIHM7CiAgICAJCQl0aGlzLl95ID0gKCBtMjMgKyBtMzIgKSAvIHM7CiAgICAJCQl0aGlzLl96ID0gMC4yNSAqIHM7CgogICAgCQl9CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiB0byB0aGUgcm90YXRpb24gcmVxdWlyZWQgdG8gcm90YXRlIHRoZSBkaXJlY3Rpb24gdmVjdG9yCiAgICAJICogYHZGcm9tYCB0byB0aGUgZGlyZWN0aW9uIHZlY3RvciBgdlRvYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdkZyb20gLSBUaGUgZmlyc3QgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2VG8gLSBUaGUgc2Vjb25kIChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlzZXRGcm9tVW5pdFZlY3RvcnMoIHZGcm9tLCB2VG8gKSB7CgogICAgCQkvLyBhc3N1bWVzIGRpcmVjdGlvbiB2ZWN0b3JzIHZGcm9tIGFuZCB2VG8gYXJlIG5vcm1hbGl6ZWQKCiAgICAJCWxldCByID0gdkZyb20uZG90KCB2VG8gKSArIDE7CgogICAgCQlpZiAoIHIgPCAxZS04ICkgeyAvLyB0aGUgZXBzaWxvbiB2YWx1ZSBoYXMgYmVlbiBkaXNjdXNzZWQgaW4gIzMxMjg2CgogICAgCQkJLy8gdkZyb20gYW5kIHZUbyBwb2ludCBpbiBvcHBvc2l0ZSBkaXJlY3Rpb25zCgogICAgCQkJciA9IDA7CgogICAgCQkJaWYgKCBNYXRoLmFicyggdkZyb20ueCApID4gTWF0aC5hYnMoIHZGcm9tLnogKSApIHsKCiAgICAJCQkJdGhpcy5feCA9IC0gdkZyb20ueTsKICAgIAkJCQl0aGlzLl95ID0gdkZyb20ueDsKICAgIAkJCQl0aGlzLl96ID0gMDsKICAgIAkJCQl0aGlzLl93ID0gcjsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl0aGlzLl94ID0gMDsKICAgIAkJCQl0aGlzLl95ID0gLSB2RnJvbS56OwogICAgCQkJCXRoaXMuX3ogPSB2RnJvbS55OwogICAgCQkJCXRoaXMuX3cgPSByOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJLy8gY3Jvc3NWZWN0b3JzKCB2RnJvbSwgdlRvICk7IC8vIGlubGluZWQgdG8gYXZvaWQgY3ljbGljIGRlcGVuZGVuY3kgb24gVmVjdG9yMwoKICAgIAkJCXRoaXMuX3ggPSB2RnJvbS55ICogdlRvLnogLSB2RnJvbS56ICogdlRvLnk7CiAgICAJCQl0aGlzLl95ID0gdkZyb20ueiAqIHZUby54IC0gdkZyb20ueCAqIHZUby56OwogICAgCQkJdGhpcy5feiA9IHZGcm9tLnggKiB2VG8ueSAtIHZGcm9tLnkgKiB2VG8ueDsKICAgIAkJCXRoaXMuX3cgPSByOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgYW5nbGUgYmV0d2VlbiB0aGlzIHF1YXRlcm5pb24gYW5kIHRoZSBnaXZlbiBvbmUgaW4gcmFkaWFucy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uIHRvIGNvbXB1dGUgdGhlIGFuZ2xlIHdpdGguCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKi8KICAgIAlhbmdsZVRvKCBxICkgewoKICAgIAkJcmV0dXJuIDIgKiBNYXRoLmFjb3MoIE1hdGguYWJzKCBjbGFtcCggdGhpcy5kb3QoIHEgKSwgLTEsIDEgKSApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGlzIHF1YXRlcm5pb24gYnkgYSBnaXZlbiBhbmd1bGFyIHN0ZXAgdG8gdGhlIGdpdmVuIHF1YXRlcm5pb24uCiAgICAJICogVGhlIG1ldGhvZCBlbnN1cmVzIHRoYXQgdGhlIGZpbmFsIHF1YXRlcm5pb24gd2lsbCBub3Qgb3ZlcnNob290IGBxYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3RlcCAtIFRoZSBhbmd1bGFyIHN0ZXAgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJcm90YXRlVG93YXJkcyggcSwgc3RlcCApIHsKCiAgICAJCWNvbnN0IGFuZ2xlID0gdGhpcy5hbmdsZVRvKCBxICk7CgogICAgCQlpZiAoIGFuZ2xlID09PSAwICkgcmV0dXJuIHRoaXM7CgogICAgCQljb25zdCB0ID0gTWF0aC5taW4oIDEsIHN0ZXAgLyBhbmdsZSApOwoKICAgIAkJdGhpcy5zbGVycCggcSwgdCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gdG8gdGhlIGlkZW50aXR5IHF1YXRlcm5pb247IHRoYXQgaXMsIHRvIHRoZQogICAgCSAqIHF1YXRlcm5pb24gdGhhdCByZXByZXNlbnRzICJubyByb3RhdGlvbiIuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJaWRlbnRpdHkoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDEgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnZlcnRzIHRoaXMgcXVhdGVybmlvbiB2aWEge0BsaW5rIFF1YXRlcm5pb24jY29uanVnYXRlfS4gVGhlCiAgICAJICogcXVhdGVybmlvbiBpcyBhc3N1bWVkIHRvIGhhdmUgdW5pdCBsZW5ndGguCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJaW52ZXJ0KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuY29uanVnYXRlKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgcm90YXRpb25hbCBjb25qdWdhdGUgb2YgdGhpcyBxdWF0ZXJuaW9uLiBUaGUgY29uanVnYXRlIG9mIGEKICAgIAkgKiBxdWF0ZXJuaW9uIHJlcHJlc2VudHMgdGhlIHNhbWUgcm90YXRpb24gaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiBhYm91dAogICAgCSAqIHRoZSByb3RhdGlvbmFsIGF4aXMuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJY29uanVnYXRlKCkgewoKICAgIAkJdGhpcy5feCAqPSAtMTsKICAgIAkJdGhpcy5feSAqPSAtMTsKICAgIAkJdGhpcy5feiAqPSAtMTsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoaXMgcXVhdGVybmlvbiBhbmQgdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gdiAtIFRoZSBxdWF0ZXJuaW9uIHRvIGNvbXB1dGUgdGhlIGRvdCBwcm9kdWN0IHdpdGguCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIHRoZSBkb3QgcHJvZHVjdC4KICAgIAkgKi8KICAgIAlkb3QoIHYgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5feCAqIHYuX3ggKyB0aGlzLl95ICogdi5feSArIHRoaXMuX3ogKiB2Ll96ICsgdGhpcy5fdyAqIHYuX3c7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIG9mIHRoaXMgcXVhdGVybmlvbiwKICAgIAkgKiBjb25zaWRlcmVkIGFzIGEgNCBkaW1lbnNpb25hbCB2ZWN0b3IuIFRoaXMgY2FuIGJlIHVzZWZ1bCBpZiB5b3UgYXJlIGNvbXBhcmluZyB0aGUKICAgIAkgKiBsZW5ndGhzIG9mIHR3byBxdWF0ZXJuaW9ucywgYXMgdGhpcyBpcyBhIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IGNhbGN1bGF0aW9uIHRoYW4KICAgIAkgKiB7QGxpbmsgUXVhdGVybmlvbiNsZW5ndGh9LgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlZCBFdWNsaWRlYW4gbGVuZ3RoLgogICAgCSAqLwogICAgCWxlbmd0aFNxKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgb2YgdGhpcyBxdWF0ZXJuaW9uLAogICAgCSAqIGNvbnNpZGVyZWQgYXMgYSA0IGRpbWVuc2lvbmFsIHZlY3Rvci4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIEV1Y2xpZGVhbiBsZW5ndGguCiAgICAJICovCiAgICAJbGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5feCAqIHRoaXMuX3ggKyB0aGlzLl95ICogdGhpcy5feSArIHRoaXMuX3ogKiB0aGlzLl96ICsgdGhpcy5fdyAqIHRoaXMuX3cgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBOb3JtYWxpemVzIHRoaXMgcXVhdGVybmlvbiAtIHRoYXQgaXMsIGNhbGN1bGF0ZWQgdGhlIHF1YXRlcm5pb24gdGhhdCBwZXJmb3JtcwogICAgCSAqIHRoZSBzYW1lIHJvdGF0aW9uIGFzIHRoaXMgb25lLCBidXQgaGFzIGEgbGVuZ3RoIGVxdWFsIHRvIGAxYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlub3JtYWxpemUoKSB7CgogICAgCQlsZXQgbCA9IHRoaXMubGVuZ3RoKCk7CgogICAgCQlpZiAoIGwgPT09IDAgKSB7CgogICAgCQkJdGhpcy5feCA9IDA7CiAgICAJCQl0aGlzLl95ID0gMDsKICAgIAkJCXRoaXMuX3ogPSAwOwogICAgCQkJdGhpcy5fdyA9IDE7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWwgPSAxIC8gbDsKCiAgICAJCQl0aGlzLl94ID0gdGhpcy5feCAqIGw7CiAgICAJCQl0aGlzLl95ID0gdGhpcy5feSAqIGw7CiAgICAJCQl0aGlzLl96ID0gdGhpcy5feiAqIGw7CiAgICAJCQl0aGlzLl93ID0gdGhpcy5fdyAqIGw7CgogICAgCQl9CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoaXMgcXVhdGVybmlvbiBieSB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIHF1YXRlcm5pb24uCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCW11bHRpcGx5KCBxICkgewoKICAgIAkJcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyggdGhpcywgcSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFByZS1tdWx0aXBsaWVzIHRoaXMgcXVhdGVybmlvbiBieSB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIHF1YXRlcm5pb24uCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXByZW11bHRpcGx5KCBxICkgewoKICAgIAkJcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyggcSwgdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHF1YXRlcm5pb25zIGFuZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBhIC0gVGhlIGZpcnN0IHF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBiIC0gVGhlIHNlY29uZCBxdWF0ZXJuaW9uLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAltdWx0aXBseVF1YXRlcm5pb25zKCBhLCBiICkgewoKICAgIAkJLy8gZnJvbSBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL3JlYWxOb3JtZWRBbGdlYnJhL3F1YXRlcm5pb25zL2NvZGUvaW5kZXguaHRtCgogICAgCQljb25zdCBxYXggPSBhLl94LCBxYXkgPSBhLl95LCBxYXogPSBhLl96LCBxYXcgPSBhLl93OwogICAgCQljb25zdCBxYnggPSBiLl94LCBxYnkgPSBiLl95LCBxYnogPSBiLl96LCBxYncgPSBiLl93OwoKICAgIAkJdGhpcy5feCA9IHFheCAqIHFidyArIHFhdyAqIHFieCArIHFheSAqIHFieiAtIHFheiAqIHFieTsKICAgIAkJdGhpcy5feSA9IHFheSAqIHFidyArIHFhdyAqIHFieSArIHFheiAqIHFieCAtIHFheCAqIHFiejsKICAgIAkJdGhpcy5feiA9IHFheiAqIHFidyArIHFhdyAqIHFieiArIHFheCAqIHFieSAtIHFheSAqIHFieDsKICAgIAkJdGhpcy5fdyA9IHFhdyAqIHFidyAtIHFheCAqIHFieCAtIHFheSAqIHFieSAtIHFheiAqIHFiejsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFBlcmZvcm1zIGEgc3BoZXJpY2FsIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gcXVhdGVybmlvbnMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHFiIC0gVGhlIHRhcmdldCBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXNsZXJwKCBxYiwgdCApIHsKCiAgICAJCWlmICggdCA9PT0gMCApIHJldHVybiB0aGlzOwogICAgCQlpZiAoIHQgPT09IDEgKSByZXR1cm4gdGhpcy5jb3B5KCBxYiApOwoKICAgIAkJY29uc3QgeCA9IHRoaXMuX3gsIHkgPSB0aGlzLl95LCB6ID0gdGhpcy5feiwgdyA9IHRoaXMuX3c7CgogICAgCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL3JlYWxOb3JtZWRBbGdlYnJhL3F1YXRlcm5pb25zL3NsZXJwLwoKICAgIAkJbGV0IGNvc0hhbGZUaGV0YSA9IHcgKiBxYi5fdyArIHggKiBxYi5feCArIHkgKiBxYi5feSArIHogKiBxYi5fejsKCiAgICAJCWlmICggY29zSGFsZlRoZXRhIDwgMCApIHsKCiAgICAJCQl0aGlzLl93ID0gLSBxYi5fdzsKICAgIAkJCXRoaXMuX3ggPSAtIHFiLl94OwogICAgCQkJdGhpcy5feSA9IC0gcWIuX3k7CiAgICAJCQl0aGlzLl96ID0gLSBxYi5fejsKCiAgICAJCQljb3NIYWxmVGhldGEgPSAtIGNvc0hhbGZUaGV0YTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhpcy5jb3B5KCBxYiApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBjb3NIYWxmVGhldGEgPj0gMS4wICkgewoKICAgIAkJCXRoaXMuX3cgPSB3OwogICAgCQkJdGhpcy5feCA9IHg7CiAgICAJCQl0aGlzLl95ID0geTsKICAgIAkJCXRoaXMuX3ogPSB6OwoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJY29uc3Qgc3FyU2luSGFsZlRoZXRhID0gMS4wIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhOwoKICAgIAkJaWYgKCBzcXJTaW5IYWxmVGhldGEgPD0gTnVtYmVyLkVQU0lMT04gKSB7CgogICAgCQkJY29uc3QgcyA9IDEgLSB0OwogICAgCQkJdGhpcy5fdyA9IHMgKiB3ICsgdCAqIHRoaXMuX3c7CiAgICAJCQl0aGlzLl94ID0gcyAqIHggKyB0ICogdGhpcy5feDsKICAgIAkJCXRoaXMuX3kgPSBzICogeSArIHQgKiB0aGlzLl95OwogICAgCQkJdGhpcy5feiA9IHMgKiB6ICsgdCAqIHRoaXMuX3o7CgogICAgCQkJdGhpcy5ub3JtYWxpemUoKTsgLy8gbm9ybWFsaXplIGNhbGxzIF9vbkNoYW5nZUNhbGxiYWNrKCkKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHNpbkhhbGZUaGV0YSA9IE1hdGguc3FydCggc3FyU2luSGFsZlRoZXRhICk7CiAgICAJCWNvbnN0IGhhbGZUaGV0YSA9IE1hdGguYXRhbjIoIHNpbkhhbGZUaGV0YSwgY29zSGFsZlRoZXRhICk7CiAgICAJCWNvbnN0IHJhdGlvQSA9IE1hdGguc2luKCAoIDEgLSB0ICkgKiBoYWxmVGhldGEgKSAvIHNpbkhhbGZUaGV0YSwKICAgIAkJCXJhdGlvQiA9IE1hdGguc2luKCB0ICogaGFsZlRoZXRhICkgLyBzaW5IYWxmVGhldGE7CgogICAgCQl0aGlzLl93ID0gKCB3ICogcmF0aW9BICsgdGhpcy5fdyAqIHJhdGlvQiApOwogICAgCQl0aGlzLl94ID0gKCB4ICogcmF0aW9BICsgdGhpcy5feCAqIHJhdGlvQiApOwogICAgCQl0aGlzLl95ID0gKCB5ICogcmF0aW9BICsgdGhpcy5feSAqIHJhdGlvQiApOwogICAgCQl0aGlzLl96ID0gKCB6ICogcmF0aW9BICsgdGhpcy5feiAqIHJhdGlvQiApOwoKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUGVyZm9ybXMgYSBzcGhlcmljYWwgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0aGUgZ2l2ZW4gcXVhdGVybmlvbnMKICAgIAkgKiBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYSAtIFRoZSBzb3VyY2UgcXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHFiIC0gVGhlIHRhcmdldCBxdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCiAgICAJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgCSAqLwogICAgCXNsZXJwUXVhdGVybmlvbnMoIHFhLCBxYiwgdCApIHsKCiAgICAJCXJldHVybiB0aGlzLmNvcHkoIHFhICkuc2xlcnAoIHFiLCB0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gdG8gYSB1bmlmb3JtbHkgcmFuZG9tLCBub3JtYWxpemVkIHF1YXRlcm5pb24uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJcmFuZG9tKCkgewoKICAgIAkJLy8gS2VuIFNob2VtYWtlCiAgICAJCS8vIFVuaWZvcm0gcmFuZG9tIHJvdGF0aW9ucwogICAgCQkvLyBELiBLaXJrLCBlZGl0b3IsIEdyYXBoaWNzIEdlbXMgSUlJLCBwYWdlcyAxMjQtMTMyLiBBY2FkZW1pYyBQcmVzcywgTmV3IFlvcmssIDE5OTIuCgogICAgCQljb25zdCB0aGV0YTEgPSAyICogTWF0aC5QSSAqIE1hdGgucmFuZG9tKCk7CiAgICAJCWNvbnN0IHRoZXRhMiA9IDIgKiBNYXRoLlBJICogTWF0aC5yYW5kb20oKTsKCiAgICAJCWNvbnN0IHgwID0gTWF0aC5yYW5kb20oKTsKICAgIAkJY29uc3QgcjEgPSBNYXRoLnNxcnQoIDEgLSB4MCApOwogICAgCQljb25zdCByMiA9IE1hdGguc3FydCggeDAgKTsKCiAgICAJCXJldHVybiB0aGlzLnNldCgKICAgIAkJCXIxICogTWF0aC5zaW4oIHRoZXRhMSApLAogICAgCQkJcjEgKiBNYXRoLmNvcyggdGhldGExICksCiAgICAJCQlyMiAqIE1hdGguc2luKCB0aGV0YTIgKSwKICAgIAkJCXIyICogTWF0aC5jb3MoIHRoZXRhMiApLAogICAgCQkpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcXVhdGVybmlvbiBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHF1YXRlcm5pb24gLSBUaGUgcXVhdGVybmlvbiB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcXVhdGVybmlvbiBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCBxdWF0ZXJuaW9uICkgewoKICAgIAkJcmV0dXJuICggcXVhdGVybmlvbi5feCA9PT0gdGhpcy5feCApICYmICggcXVhdGVybmlvbi5feSA9PT0gdGhpcy5feSApICYmICggcXVhdGVybmlvbi5feiA9PT0gdGhpcy5feiApICYmICggcXVhdGVybmlvbi5fdyA9PT0gdGhpcy5fdyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uJ3MgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBhcnJheS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudCB2YWx1ZXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBUaGUgb2Zmc2V0IGludG8gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKICAgIAkJdGhpcy5feCA9IGFycmF5WyBvZmZzZXQgXTsKICAgIAkJdGhpcy5feSA9IGFycmF5WyBvZmZzZXQgKyAxIF07CiAgICAJCXRoaXMuX3ogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwogICAgCQl0aGlzLl93ID0gYXJyYXlbIG9mZnNldCArIDMgXTsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHF1YXRlcm5pb24gdG8gdGhlIGdpdmVuIGFycmF5LiBJZiBubyBhcnJheSBpcyBwcm92aWRlZCwKICAgIAkgKiB0aGUgbWV0aG9kIHJldHVybnMgYSBuZXcgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IFthcnJheT1bXV0gLSBUaGUgdGFyZ2V0IGFycmF5IGhvbGRpbmcgdGhlIHF1YXRlcm5pb24gY29tcG9uZW50cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgcXVhdGVybmlvbiBjb21wb25lbnRzLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLl94OwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGhpcy5feTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuX3o7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLl93OwoKICAgIAkJcmV0dXJuIGFycmF5OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGNvbXBvbmVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyBxdWF0ZXJuaW9uIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAJICovCiAgICAJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCiAgICAJCXRoaXMuX3ggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKICAgIAkJdGhpcy5feSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwogICAgCQl0aGlzLl96ID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CiAgICAJCXRoaXMuX3cgPSBhdHRyaWJ1dGUuZ2V0VyggaW5kZXggKTsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoaXMgbWV0aG9kcyBkZWZpbmVzIHRoZSBzZXJpYWxpemF0aW9uIHJlc3VsdCBvZiB0aGlzIGNsYXNzLiBSZXR1cm5zIHRoZQogICAgCSAqIG51bWVyaWNhbCBlbGVtZW50cyBvZiB0aGlzIHF1YXRlcm5pb24gaW4gYW4gYXJyYXkgb2YgZm9ybWF0IGBbeCwgeSwgeiwgd11gLgogICAgCSAqCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHNlcmlhbGl6ZWQgcXVhdGVybmlvbi4KICAgIAkgKi8KICAgIAl0b0pTT04oKSB7CgogICAgCQlyZXR1cm4gdGhpcy50b0FycmF5KCk7CgogICAgCX0KCiAgICAJX29uQ2hhbmdlKCBjYWxsYmFjayApIHsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCV9vbkNoYW5nZUNhbGxiYWNrKCkge30KCiAgICAJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgogICAgCQl5aWVsZCB0aGlzLl94OwogICAgCQl5aWVsZCB0aGlzLl95OwogICAgCQl5aWVsZCB0aGlzLl96OwogICAgCQl5aWVsZCB0aGlzLl93OwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgM0QgdmVjdG9yLiBBIDNEIHZlY3RvciBpcyBhbiBvcmRlcmVkIHRyaXBsZXQgb2YgbnVtYmVycwogICAgICogKGxhYmVsZWQgeCwgeSBhbmQgeiksIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCBhIG51bWJlciBvZiB0aGluZ3MsIHN1Y2ggYXM6CiAgICAgKgogICAgICogLSBBIHBvaW50IGluIDNEIHNwYWNlLgogICAgICogLSBBIGRpcmVjdGlvbiBhbmQgbGVuZ3RoIGluIDNEIHNwYWNlLiBJbiB0aHJlZS5qcyB0aGUgbGVuZ3RoIHdpbGwKICAgICAqIGFsd2F5cyBiZSB0aGUgRXVjbGlkZWFuIGRpc3RhbmNlKHN0cmFpZ2h0LWxpbmUgZGlzdGFuY2UpIGZyb20gYCgwLCAwLCAwKWAgdG8gYCh4LCB5LCB6KWAKICAgICAqIGFuZCB0aGUgZGlyZWN0aW9uIGlzIGFsc28gbWVhc3VyZWQgZnJvbSBgKDAsIDAsIDApYCB0b3dhcmRzIGAoeCwgeSwgeilgLgogICAgICogLSBBbnkgYXJiaXRyYXJ5IG9yZGVyZWQgdHJpcGxldCBvZiBudW1iZXJzLgogICAgICoKICAgICAqIFRoZXJlIGFyZSBvdGhlciB0aGluZ3MgYSAzRCB2ZWN0b3IgY2FuIGJlIHVzZWQgdG8gcmVwcmVzZW50LCBzdWNoIGFzCiAgICAgKiBtb21lbnR1bSB2ZWN0b3JzIGFuZCBzbyBvbiwgaG93ZXZlciB0aGVzZSBhcmUgdGhlIG1vc3QKICAgICAqIGNvbW1vbiB1c2VzIGluIHRocmVlLmpzLgogICAgICoKICAgICAqIEl0ZXJhdGluZyB0aHJvdWdoIGEgdmVjdG9yIGluc3RhbmNlIHdpbGwgeWllbGQgaXRzIGNvbXBvbmVudHMgYCh4LCB5LCB6KWAgaW4KICAgICAqIHRoZSBjb3JyZXNwb25kaW5nIG9yZGVyLgogICAgICogYGBganMKICAgICAqIGNvbnN0IGEgPSBuZXcgVEhSRUUuVmVjdG9yMyggMCwgMSwgMCApOwogICAgICoKICAgICAqIC8vbm8gYXJndW1lbnRzOyB3aWxsIGJlIGluaXRpYWxpc2VkIHRvICgwLCAwLCAwKQogICAgICogY29uc3QgYiA9IG5ldyBUSFJFRS5WZWN0b3IzKCApOwogICAgICoKICAgICAqIGNvbnN0IGQgPSBhLmRpc3RhbmNlVG8oIGIgKTsKICAgICAqIGBgYAogICAgICovCiAgICBjbGFzcyBWZWN0b3IzIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyAzRCB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3g9MF0gLSBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3o9MF0gLSBUaGUgeiB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQlWZWN0b3IzLnByb3RvdHlwZS5pc1ZlY3RvcjMgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB4IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy54ID0geDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgeSB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMueSA9IHk7CgogICAgCQkvKioKICAgIAkJICogVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLnogPSB6OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBvZiB0aGUgeiBjb21wb25lbnQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0KCB4LCB5LCB6ICkgewoKICAgIAkJaWYgKCB6ID09PSB1bmRlZmluZWQgKSB6ID0gdGhpcy56OyAvLyBzcHJpdGUuc2NhbGUuc2V0KHgseSkKCiAgICAJCXRoaXMueCA9IHg7CiAgICAJCXRoaXMueSA9IHk7CiAgICAJCXRoaXMueiA9IHo7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2FtZSB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgdmFsdWUgdG8gc2V0IGZvciBhbGwgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnggPSBzY2FsYXI7CiAgICAJCXRoaXMueSA9IHNjYWxhcjsKICAgIAkJdGhpcy56ID0gc2NhbGFyOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yJ3MgeCBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0WCggeCApIHsKCiAgICAJCXRoaXMueCA9IHg7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IncyB5IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRZKCB5ICkgewoKICAgIAkJdGhpcy55ID0geTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHogY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFooIHogKSB7CgogICAgCQl0aGlzLnogPSB6OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxsb3dzIHRvIHNldCBhIHZlY3RvciBjb21wb25lbnQgd2l0aCBhbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LCBgMmAgZXF1YWxzIHRvIHouCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRDb21wb25lbnQoIGluZGV4LCB2YWx1ZSApIHsKCiAgICAJCXN3aXRjaCAoIGluZGV4ICkgewoKICAgIAkJCWNhc2UgMDogdGhpcy54ID0gdmFsdWU7IGJyZWFrOwogICAgCQkJY2FzZSAxOiB0aGlzLnkgPSB2YWx1ZTsgYnJlYWs7CiAgICAJCQljYXNlIDI6IHRoaXMueiA9IHZhbHVlOyBicmVhazsKICAgIAkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgdmVjdG9yIGNvbXBvbmVudCB3aGljaCBtYXRjaGVzIHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LCBgMmAgZXF1YWxzIHRvIHouCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBBIHZlY3RvciBjb21wb25lbnQgdmFsdWUuCiAgICAJICovCiAgICAJZ2V0Q29tcG9uZW50KCBpbmRleCApIHsKCiAgICAJCXN3aXRjaCAoIGluZGV4ICkgewoKICAgIAkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKICAgIAkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKICAgIAkJCWNhc2UgMjogcmV0dXJuIHRoaXMuejsKICAgIAkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyB2ZWN0b3Igd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnksIHRoaXMueiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljb3B5KCB2ICkgewoKICAgIAkJdGhpcy54ID0gdi54OwogICAgCQl0aGlzLnkgPSB2Lnk7CiAgICAJCXRoaXMueiA9IHYuejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBhZGQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkKCB2ICkgewoKICAgIAkJdGhpcy54ICs9IHYueDsKICAgIAkJdGhpcy55ICs9IHYueTsKICAgIAkJdGhpcy56ICs9IHYuejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB0byBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIGFkZC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhZGRTY2FsYXIoIHMgKSB7CgogICAgCQl0aGlzLnggKz0gczsKICAgIAkJdGhpcy55ICs9IHM7CiAgICAJCXRoaXMueiArPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkVmVjdG9ycyggYSwgYiApIHsKCiAgICAJCXRoaXMueCA9IGEueCArIGIueDsKICAgIAkJdGhpcy55ID0gYS55ICsgYi55OwogICAgCQl0aGlzLnogPSBhLnogKyBiLno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3Igc2NhbGVkIGJ5IHRoZSBnaXZlbiBmYWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM3xWZWN0b3I0fSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBmYWN0b3IgdGhhdCBzY2FsZXMgYHZgLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCiAgICAJCXRoaXMueCArPSB2LnggKiBzOwogICAgCQl0aGlzLnkgKz0gdi55ICogczsKICAgIAkJdGhpcy56ICs9IHYueiAqIHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvciBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIHN1YnRyYWN0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXN1YiggdiApIHsKCiAgICAJCXRoaXMueCAtPSB2Lng7CiAgICAJCXRoaXMueSAtPSB2Lnk7CiAgICAJCXRoaXMueiAtPSB2Lno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSBmcm9tIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gc3VidHJhY3QuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc3ViU2NhbGFyKCBzICkgewoKICAgIAkJdGhpcy54IC09IHM7CiAgICAJCXRoaXMueSAtPSBzOwogICAgCQl0aGlzLnogLT0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc3ViVmVjdG9ycyggYSwgYiApIHsKCiAgICAJCXRoaXMueCA9IGEueCAtIGIueDsKICAgIAkJdGhpcy55ID0gYS55IC0gYi55OwogICAgCQl0aGlzLnogPSBhLnogLSBiLno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBtdWx0aXBseS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltdWx0aXBseSggdiApIHsKCiAgICAJCXRoaXMueCAqPSB2Lng7CiAgICAJCXRoaXMueSAqPSB2Lnk7CiAgICAJCXRoaXMueiAqPSB2Lno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgd2l0aCBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdG8gbXVsdGlwbHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbXVsdGlwbHlTY2FsYXIoIHNjYWxhciApIHsKCiAgICAJCXRoaXMueCAqPSBzY2FsYXI7CiAgICAJCXRoaXMueSAqPSBzY2FsYXI7CiAgICAJCXRoaXMueiAqPSBzY2FsYXI7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoZSBnaXZlbiB2ZWN0b3JzIGFuZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAltdWx0aXBseVZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQl0aGlzLnggPSBhLnggKiBiLng7CiAgICAJCXRoaXMueSA9IGEueSAqIGIueTsKICAgIAkJdGhpcy56ID0gYS56ICogYi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gRXVsZXIgcm90YXRpb24gdG8gdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYXBwbHlFdWxlciggZXVsZXIgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uJDQuc2V0RnJvbUV1bGVyKCBldWxlciApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyBhIHJvdGF0aW9uIHNwZWNpZmllZCBieSBhbiBheGlzIGFuZCBhbiBhbmdsZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIEEgbm9ybWFsaXplZCB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSByb3RhdGlvbiBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5QXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCiAgICAJCXJldHVybiB0aGlzLmFwcGx5UXVhdGVybmlvbiggX3F1YXRlcm5pb24kNC5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGlzIHZlY3RvciB3aXRoIHRoZSBnaXZlbiAzeDMgbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXgzKCBtICkgewoKICAgIAkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKICAgIAkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgogICAgCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgMyBdICogeSArIGVbIDYgXSAqIHo7CiAgICAJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgNyBdICogejsKICAgIAkJdGhpcy56ID0gZVsgMiBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA4IF0gKiB6OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGlzIHZlY3RvciBieSB0aGUgZ2l2ZW4gbm9ybWFsIG1hdHJpeCBhbmQgbm9ybWFsaXplcwogICAgCSAqIHRoZSByZXN1bHQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbm9ybWFsIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhcHBseU5vcm1hbE1hdHJpeCggbSApIHsKCiAgICAJCXJldHVybiB0aGlzLmFwcGx5TWF0cml4MyggbSApLm5vcm1hbGl6ZSgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3IgKHdpdGggYW4gaW1wbGljaXQgMSBpbiB0aGUgNHRoIGRpbWVuc2lvbikgYnkgbSwgYW5kCiAgICAJICogZGl2aWRlcyBieSBwZXJzcGVjdGl2ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtICkgewoKICAgIAkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKICAgIAkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgogICAgCQljb25zdCB3ID0gMSAvICggZVsgMyBdICogeCArIGVbIDcgXSAqIHkgKyBlWyAxMSBdICogeiArIGVbIDE1IF0gKTsKCiAgICAJCXRoaXMueCA9ICggZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6ICsgZVsgMTIgXSApICogdzsKICAgIAkJdGhpcy55ID0gKCBlWyAxIF0gKiB4ICsgZVsgNSBdICogeSArIGVbIDkgXSAqIHogKyBlWyAxMyBdICkgKiB3OwogICAgCQl0aGlzLnogPSAoIGVbIDIgXSAqIHggKyBlWyA2IF0gKiB5ICsgZVsgMTAgXSAqIHogKyBlWyAxNCBdICkgKiB3OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gUXVhdGVybmlvbiB0byB0aGlzIHZlY3Rvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBRdWF0ZXJuaW9uLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFwcGx5UXVhdGVybmlvbiggcSApIHsKCiAgICAJCS8vIHF1YXRlcm5pb24gcSBpcyBhc3N1bWVkIHRvIGhhdmUgdW5pdCBsZW5ndGgKCiAgICAJCWNvbnN0IHZ4ID0gdGhpcy54LCB2eSA9IHRoaXMueSwgdnogPSB0aGlzLno7CiAgICAJCWNvbnN0IHF4ID0gcS54LCBxeSA9IHEueSwgcXogPSBxLnosIHF3ID0gcS53OwoKICAgIAkJLy8gdCA9IDIgKiBjcm9zcyggcS54eXosIHYgKTsKICAgIAkJY29uc3QgdHggPSAyICogKCBxeSAqIHZ6IC0gcXogKiB2eSApOwogICAgCQljb25zdCB0eSA9IDIgKiAoIHF6ICogdnggLSBxeCAqIHZ6ICk7CiAgICAJCWNvbnN0IHR6ID0gMiAqICggcXggKiB2eSAtIHF5ICogdnggKTsKCiAgICAJCS8vIHYgKyBxLncgKiB0ICsgY3Jvc3MoIHEueHl6LCB0ICk7CiAgICAJCXRoaXMueCA9IHZ4ICsgcXcgKiB0eCArIHF5ICogdHogLSBxeiAqIHR5OwogICAgCQl0aGlzLnkgPSB2eSArIHF3ICogdHkgKyBxeiAqIHR4IC0gcXggKiB0ejsKICAgIAkJdGhpcy56ID0gdnogKyBxdyAqIHR6ICsgcXggKiB0eSAtIHF5ICogdHg7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQcm9qZWN0cyB0aGlzIHZlY3RvciBmcm9tIHdvcmxkIHNwYWNlIGludG8gdGhlIGNhbWVyYSdzIG5vcm1hbGl6ZWQKICAgIAkgKiBkZXZpY2UgY29vcmRpbmF0ZSAoTkRDKSBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXByb2plY3QoIGNhbWVyYSApIHsKCiAgICAJCXJldHVybiB0aGlzLmFwcGx5TWF0cml4NCggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSApLmFwcGx5TWF0cml4NCggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBVbnByb2plY3RzIHRoaXMgdmVjdG9yIGZyb20gdGhlIGNhbWVyYSdzIG5vcm1hbGl6ZWQgZGV2aWNlIGNvb3JkaW5hdGUgKE5EQykKICAgIAkgKiBzcGFjZSBpbnRvIHdvcmxkIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJdW5wcm9qZWN0KCBjYW1lcmEgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApLmFwcGx5TWF0cml4NCggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNmb3JtcyB0aGUgZGlyZWN0aW9uIG9mIHRoaXMgdmVjdG9yIGJ5IGEgbWF0cml4ICh0aGUgdXBwZXIgbGVmdCAzIHggMwogICAgCSAqIHN1YnNldCBvZiB0aGUgZ2l2ZW4gNHg0IG1hdHJpeCBhbmQgdGhlbiBub3JtYWxpemVzIHRoZSByZXN1bHQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXRyYW5zZm9ybURpcmVjdGlvbiggbSApIHsKCiAgICAJCS8vIGlucHV0OiBUSFJFRS5NYXRyaXg0IGFmZmluZSBtYXRyaXgKICAgIAkJLy8gdmVjdG9yIGludGVycHJldGVkIGFzIGEgZGlyZWN0aW9uCgogICAgCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55LCB6ID0gdGhpcy56OwogICAgCQljb25zdCBlID0gbS5lbGVtZW50czsKCiAgICAJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgOCBdICogejsKICAgIAkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6OwogICAgCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6OwoKICAgIAkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGl2aWRlcyB0aGlzIGluc3RhbmNlIGJ5IHRoZSBnaXZlbiB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGRpdmlkZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlkaXZpZGUoIHYgKSB7CgogICAgCQl0aGlzLnggLz0gdi54OwogICAgCQl0aGlzLnkgLz0gdi55OwogICAgCQl0aGlzLnogLz0gdi56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGl2aWRlcyB0aGlzIHZlY3RvciBieSB0aGUgZ2l2ZW4gc2NhbGFyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdG8gZGl2aWRlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWRpdmlkZVNjYWxhciggc2NhbGFyICkgewoKICAgIAkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHgsIHkgb3IgegogICAgCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtaW4gdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1pbiggdiApIHsKCiAgICAJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5taW4oIHRoaXMueiwgdi56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHgsIHkgb3IgegogICAgCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtYXggdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1heCggdiApIHsKCiAgICAJCXRoaXMueCA9IE1hdGgubWF4KCB0aGlzLngsIHYueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLm1heCggdGhpcy55LCB2LnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5tYXgoIHRoaXMueiwgdi56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2ZWN0b3IncyB4LCB5IG9yIHoKICAgIAkgKiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlLAogICAgCSAqIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBtaW4gLSBUaGUgbWluaW11bSB4LCB5IGFuZCB6IHZhbHVlcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IG1heCAtIFRoZSBtYXhpbXVtIHgsIHkgYW5kIHogdmFsdWVzIGluIHRoZSBkZXNpcmVkIHJhbmdlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNsYW1wKCBtaW4sIG1heCApIHsKCiAgICAJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgogICAgCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW4ueCwgbWF4LnggKTsKICAgIAkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluLnksIG1heC55ICk7CiAgICAJCXRoaXMueiA9IGNsYW1wKCB0aGlzLnosIG1pbi56LCBtYXgueiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWVzIGFyZSBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgdGhleSBhcmUKICAgIAkgKiByZXBsYWNlZCBieSB0aGUgbWF4IHZhbHVlLgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlcyBhcmUgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIHRoZXkgYXJlCiAgICAJICogcmVwbGFjZWQgYnkgdGhlIG1pbiB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW5WYWwgLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1heFZhbCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgogICAgCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW5WYWwsIG1heFZhbCApOwogICAgCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW5WYWwsIG1heFZhbCApOwogICAgCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW5WYWwsIG1heFZhbCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5CiAgICAJICogdGhlIG1heCB2YWx1ZS4KICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlCiAgICAJICogbWluIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNsYW1wTGVuZ3RoKCBtaW4sIG1heCApIHsKCiAgICAJCWNvbnN0IGxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7CgogICAgCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIGNsYW1wKCBsZW5ndGgsIG1pbiwgbWF4ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCBkb3duIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmbG9vcigpIHsKCiAgICAJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLmZsb29yKCB0aGlzLnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5mbG9vciggdGhpcy56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB1cCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2VpbCgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGguY2VpbCggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGguY2VpbCggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGguY2VpbCggdGhpcy56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyb3VuZCgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLnJvdW5kKCB0aGlzLnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5yb3VuZCggdGhpcy56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0b3dhcmRzIHplcm8gKHVwIGlmIG5lZ2F0aXZlLAogICAgCSAqIGRvd24gaWYgcG9zaXRpdmUpIHRvIGFuIGludGVnZXIgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyb3VuZFRvWmVybygpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLnRydW5jKCB0aGlzLnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC50cnVuYyggdGhpcy56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnZlcnRzIHRoaXMgdmVjdG9yIC0gaS5lLiBzZXRzIHggPSAteCwgeSA9IC15IGFuZCB6ID0gLXouCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAluZWdhdGUoKSB7CgogICAgCQl0aGlzLnggPSAtIHRoaXMueDsKICAgIAkJdGhpcy55ID0gLSB0aGlzLnk7CiAgICAJCXRoaXMueiA9IC0gdGhpcy56OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2FsY3VsYXRlcyB0aGUgZG90IHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGRvdCBwcm9kdWN0IHdpdGguCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIHRoZSBkb3QgcHJvZHVjdC4KICAgIAkgKi8KICAgIAlkb3QoIHYgKSB7CgogICAgCQlyZXR1cm4gdGhpcy54ICogdi54ICsgdGhpcy55ICogdi55ICsgdGhpcy56ICogdi56OwoKICAgIAl9CgogICAgCS8vIFRPRE8gbGVuZ3RoU3F1YXJlZD8KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHNxdWFyZSBvZiB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIGZyb20KICAgIAkgKiAoMCwgMCwgMCkgdG8gKHgsIHksIHopLiBJZiB5b3UgYXJlIGNvbXBhcmluZyB0aGUgbGVuZ3RocyBvZiB2ZWN0b3JzLCB5b3Ugc2hvdWxkCiAgICAJICogY29tcGFyZSB0aGUgbGVuZ3RoIHNxdWFyZWQgaW5zdGVhZCBhcyBpdCBpcyBzbGlnaHRseSBtb3JlIGVmZmljaWVudCB0byBjYWxjdWxhdGUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlbmd0aFNxKCkgewoKICAgIAkJcmV0dXJuIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMuejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tICgwLCAwLCAwKSB0byAoeCwgeSwgeikuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbWFuaGF0dGFuTGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKSArIE1hdGguYWJzKCB0aGlzLnogKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGlzIHZlY3RvciB0byBhIHVuaXQgdmVjdG9yIC0gdGhhdCBpcywgc2V0cyBpdCBlcXVhbCB0byBhIHZlY3RvcgogICAgCSAqIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQgd2l0aCBhIHZlY3RvciBsZW5ndGggb2YgYDFgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbm9ybWFsaXplKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdmVjdG9yIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQKICAgIAkgKiB3aXRoIHRoZSBzcGVjaWZpZWQgbGVuZ3RoLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCAtIFRoZSBuZXcgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldExlbmd0aCggbGVuZ3RoICkgewoKICAgIAkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UsIHdoZXJlCiAgICAJICogYWxwaGEgaXMgdGhlIHBlcmNlbnQgZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgLSBhbHBoYSA9IDAgd2lsbCBiZSB0aGlzCiAgICAJICogdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwgYmUgdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gaW50ZXJwb2xhdGUgdG93YXJkcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlcnAoIHYsIGFscGhhICkgewoKICAgIAkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKICAgIAkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKICAgIAkJdGhpcy56ICs9ICggdi56IC0gdGhpcy56ICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3JzLCB3aGVyZSBhbHBoYSBpcyB0aGUgcGVyY2VudAogICAgCSAqIGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgZmlyc3QgdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwKICAgIAkgKiBiZSB0aGUgc2Vjb25kIG9uZS4gVGhlIHJlc3VsdCBpcyBzdG9yZWQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKICAgIAkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwogICAgCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CiAgICAJCXRoaXMueiA9IHYxLnogKyAoIHYyLnogLSB2MS56ICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGNyb3NzIHByb2R1Y3Qgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgcmVzdWx0IG9mIHRoZSBjcm9zcyBwcm9kdWN0LgogICAgCSAqLwogICAgCWNyb3NzKCB2ICkgewoKICAgIAkJcmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKCB0aGlzLCB2ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2FsY3VsYXRlcyB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQKICAgIAkgKiBpbiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljcm9zc1ZlY3RvcnMoIGEsIGIgKSB7CgogICAgCQljb25zdCBheCA9IGEueCwgYXkgPSBhLnksIGF6ID0gYS56OwogICAgCQljb25zdCBieCA9IGIueCwgYnkgPSBiLnksIGJ6ID0gYi56OwoKICAgIAkJdGhpcy54ID0gYXkgKiBieiAtIGF6ICogYnk7CiAgICAJCXRoaXMueSA9IGF6ICogYnggLSBheCAqIGJ6OwogICAgCQl0aGlzLnogPSBheCAqIGJ5IC0gYXkgKiBieDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFByb2plY3RzIHRoaXMgdmVjdG9yIG9udG8gdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gcHJvamVjdCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlwcm9qZWN0T25WZWN0b3IoIHYgKSB7CgogICAgCQljb25zdCBkZW5vbWluYXRvciA9IHYubGVuZ3RoU3EoKTsKCiAgICAJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAgKTsKCiAgICAJCWNvbnN0IHNjYWxhciA9IHYuZG90KCB0aGlzICkgLyBkZW5vbWluYXRvcjsKCiAgICAJCXJldHVybiB0aGlzLmNvcHkoIHYgKS5tdWx0aXBseVNjYWxhciggc2NhbGFyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJvamVjdHMgdGhpcyB2ZWN0b3Igb250byBhIHBsYW5lIGJ5IHN1YnRyYWN0aW5nIHRoaXMKICAgIAkgKiB2ZWN0b3IgcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lJ3Mgbm9ybWFsIGZyb20gdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBsYW5lTm9ybWFsIC0gVGhlIHBsYW5lIG5vcm1hbC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlwcm9qZWN0T25QbGFuZSggcGxhbmVOb3JtYWwgKSB7CgogICAgCQlfdmVjdG9yJGMuY29weSggdGhpcyApLnByb2plY3RPblZlY3RvciggcGxhbmVOb3JtYWwgKTsKCiAgICAJCXJldHVybiB0aGlzLnN1YiggX3ZlY3RvciRjICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVmbGVjdHMgdGhpcyB2ZWN0b3Igb2ZmIGEgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZ2l2ZW4gbm9ybWFsIHZlY3Rvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gbm9ybWFsIC0gVGhlIChub3JtYWxpemVkKSBub3JtYWwgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXJlZmxlY3QoIG5vcm1hbCApIHsKCiAgICAJCXJldHVybiB0aGlzLnN1YiggX3ZlY3RvciRjLmNvcHkoIG5vcm1hbCApLm11bHRpcGx5U2NhbGFyKCAyICogdGhpcy5kb3QoIG5vcm1hbCApICkgKTsKCiAgICAJfQogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGFuZ2xlIGJldHdlZW4gdGhlIGdpdmVuIHZlY3RvciBhbmQgdGhpcyBpbnN0YW5jZSBpbiByYWRpYW5zLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBhbmdsZSB3aXRoLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICovCiAgICAJYW5nbGVUbyggdiApIHsKCiAgICAJCWNvbnN0IGRlbm9taW5hdG9yID0gTWF0aC5zcXJ0KCB0aGlzLmxlbmd0aFNxKCkgKiB2Lmxlbmd0aFNxKCkgKTsKCiAgICAJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSByZXR1cm4gTWF0aC5QSSAvIDI7CgogICAgCQljb25zdCB0aGV0YSA9IHRoaXMuZG90KCB2ICkgLyBkZW5vbWluYXRvcjsKCiAgICAJCS8vIGNsYW1wLCB0byBoYW5kbGUgbnVtZXJpY2FsIHByb2JsZW1zCgogICAgCQlyZXR1cm4gTWF0aC5hY29zKCBjbGFtcCggdGhldGEsIC0xLCAxICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlVG8oIHYgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgc3F1YXJlZCBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKiBJZiB5b3UgYXJlIGp1c3QgY29tcGFyaW5nIHRoZSBkaXN0YW5jZSB3aXRoIGFub3RoZXIgZGlzdGFuY2UsIHlvdSBzaG91bGQgY29tcGFyZQogICAgCSAqIHRoZSBkaXN0YW5jZSBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBzcXVhcmVkIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1NxdWFyZWQoIHYgKSB7CgogICAgCQljb25zdCBkeCA9IHRoaXMueCAtIHYueCwgZHkgPSB0aGlzLnkgLSB2LnksIGR6ID0gdGhpcy56IC0gdi56OwoKICAgIAkJcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5ICsgZHogKiBkejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBNYW5oYXR0YW4gZGlzdGFuY2UgdG8uCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgTWFuaGF0dGFuIGRpc3RhbmNlLgogICAgCSAqLwogICAgCW1hbmhhdHRhbkRpc3RhbmNlVG8oIHYgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5hYnMoIHRoaXMueCAtIHYueCApICsgTWF0aC5hYnMoIHRoaXMueSAtIHYueSApICsgTWF0aC5hYnMoIHRoaXMueiAtIHYueiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIHNwaGVyaWNhbCBjb29yZGluYXRlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJpY2FsfSBzIC0gVGhlIHNwaGVyaWNhbCBjb29yZGluYXRlcy4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tU3BoZXJpY2FsKCBzICkgewoKICAgIAkJcmV0dXJuIHRoaXMuc2V0RnJvbVNwaGVyaWNhbENvb3Jkcyggcy5yYWRpdXMsIHMucGhpLCBzLnRoZXRhICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gc3BoZXJpY2FsIGNvb3JkaW5hdGVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHJhZGl1cyAtIFRoZSByYWRpdXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHBoaSAtIFRoZSBwaGkgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgdGhldGEgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tU3BoZXJpY2FsQ29vcmRzKCByYWRpdXMsIHBoaSwgdGhldGEgKSB7CgogICAgCQljb25zdCBzaW5QaGlSYWRpdXMgPSBNYXRoLnNpbiggcGhpICkgKiByYWRpdXM7CgogICAgCQl0aGlzLnggPSBzaW5QaGlSYWRpdXMgKiBNYXRoLnNpbiggdGhldGEgKTsKICAgIAkJdGhpcy55ID0gTWF0aC5jb3MoIHBoaSApICogcmFkaXVzOwogICAgCQl0aGlzLnogPSBzaW5QaGlSYWRpdXMgKiBNYXRoLmNvcyggdGhldGEgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIGN5bGluZHJpY2FsIGNvb3JkaW5hdGVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDeWxpbmRyaWNhbH0gYyAtIFRoZSBjeWxpbmRyaWNhbCBjb29yZGluYXRlcy4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tQ3lsaW5kcmljYWwoIGMgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zZXRGcm9tQ3lsaW5kcmljYWxDb29yZHMoIGMucmFkaXVzLCBjLnRoZXRhLCBjLnkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBjeWxpbmRyaWNhbCBjb29yZGluYXRlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgLSBUaGUgcmFkaXVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSB0aGV0YSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHkgdmFsdWUuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKCByYWRpdXMsIHRoZXRhLCB5ICkgewoKICAgIAkJdGhpcy54ID0gcmFkaXVzICogTWF0aC5zaW4oIHRoZXRhICk7CiAgICAJCXRoaXMueSA9IHk7CiAgICAJCXRoaXMueiA9IHJhZGl1cyAqIE1hdGguY29zKCB0aGV0YSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHBvc2l0aW9uIGVsZW1lbnRzIG9mIHRoZQogICAgCSAqIGdpdmVuIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEZyb21NYXRyaXhQb3NpdGlvbiggbSApIHsKCiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy54ID0gZVsgMTIgXTsKICAgIAkJdGhpcy55ID0gZVsgMTMgXTsKICAgIAkJdGhpcy56ID0gZVsgMTQgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBzY2FsZSBlbGVtZW50cyBvZiB0aGUKICAgIAkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4U2NhbGUoIG0gKSB7CgogICAgCQljb25zdCBzeCA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMCApLmxlbmd0aCgpOwogICAgCQljb25zdCBzeSA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMSApLmxlbmd0aCgpOwogICAgCQljb25zdCBzeiA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMiApLmxlbmd0aCgpOwoKICAgIAkJdGhpcy54ID0gc3g7CiAgICAJCXRoaXMueSA9IHN5OwogICAgCQl0aGlzLnogPSBzejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIHNwZWNpZmllZCBtYXRyaXggY29sdW1uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIDR4NCBtYXRyaXguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbHVtbiBpbmRleC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4Q29sdW1uKCBtLCBpbmRleCApIHsKCiAgICAJCXJldHVybiB0aGlzLmZyb21BcnJheSggbS5lbGVtZW50cywgaW5kZXggKiA0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgc3BlY2lmaWVkIG1hdHJpeCBjb2x1bW4uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgM3gzIG1hdHJpeC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29sdW1uIGluZGV4LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEZyb21NYXRyaXgzQ29sdW1uKCBtLCBpbmRleCApIHsKCiAgICAJCXJldHVybiB0aGlzLmZyb21BcnJheSggbS5lbGVtZW50cywgaW5kZXggKiAzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gRXVsZXIgYW5nbGVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtFdWxlcn0gZSAtIFRoZSBFdWxlciBhbmdsZXMgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEZyb21FdWxlciggZSApIHsKCiAgICAJCXRoaXMueCA9IGUuX3g7CiAgICAJCXRoaXMueSA9IGUuX3k7CiAgICAJCXRoaXMueiA9IGUuX3o7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBSR0IgY29tcG9uZW50cyBvZiB0aGUKICAgIAkgKiBnaXZlbiBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGMgLSBUaGUgY29sb3IgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEZyb21Db2xvciggYyApIHsKCiAgICAJCXRoaXMueCA9IGMucjsKICAgIAkJdGhpcy55ID0gYy5nOwogICAgCQl0aGlzLnogPSBjLmI7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggdiApIHsKCiAgICAJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgJiYgKCB2LnogPT09IHRoaXMueiApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIHZlY3RvcidzIHggdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgXWAsIHkgdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAxIF1gCiAgICAJICogYW5kIHogdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAyIF1gLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIHZlY3RvciBjb21wb25lbnQgdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKICAgIAkJdGhpcy54ID0gYXJyYXlbIG9mZnNldCBdOwogICAgCQl0aGlzLnkgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwogICAgCQl0aGlzLnogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV3JpdGVzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICovCiAgICAJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMueDsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuejsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyB2ZWN0b3IgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYXR0cmlidXRlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgogICAgCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKICAgIAkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CiAgICAJCXRoaXMueiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyBlYWNoIGNvbXBvbmVudCBvZiB0aGlzIHZlY3RvciB0byBhIHBzZXVkby1yYW5kb20gdmFsdWUgYmV0d2VlbiBgMGAgYW5kCiAgICAJICogYDFgLCBleGNsdWRpbmcgYDFgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcmFuZG9tKCkgewoKICAgIAkJdGhpcy54ID0gTWF0aC5yYW5kb20oKTsKICAgIAkJdGhpcy55ID0gTWF0aC5yYW5kb20oKTsKICAgIAkJdGhpcy56ID0gTWF0aC5yYW5kb20oKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyB2ZWN0b3IgdG8gYSB1bmlmb3JtbHkgcmFuZG9tIHBvaW50IG9uIGEgdW5pdCBzcGhlcmUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyYW5kb21EaXJlY3Rpb24oKSB7CgogICAgCQkvLyBodHRwczovL21hdGh3b3JsZC53b2xmcmFtLmNvbS9TcGhlcmVQb2ludFBpY2tpbmcuaHRtbAoKICAgIAkJY29uc3QgdGhldGEgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDI7CiAgICAJCWNvbnN0IHUgPSBNYXRoLnJhbmRvbSgpICogMiAtIDE7CiAgICAJCWNvbnN0IGMgPSBNYXRoLnNxcnQoIDEgLSB1ICogdSApOwoKICAgIAkJdGhpcy54ID0gYyAqIE1hdGguY29zKCB0aGV0YSApOwogICAgCQl0aGlzLnkgPSB1OwogICAgCQl0aGlzLnogPSBjICogTWF0aC5zaW4oIHRoZXRhICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCiAgICAJCXlpZWxkIHRoaXMueDsKICAgIAkJeWllbGQgdGhpcy55OwogICAgCQl5aWVsZCB0aGlzLno7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX3ZlY3RvciRjID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3F1YXRlcm5pb24kNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYSAzeDMgbWF0cml4LgogICAgICoKICAgICAqIEEgTm90ZSBvbiBSb3ctTWFqb3IgYW5kIENvbHVtbi1NYWpvciBPcmRlcmluZzoKICAgICAqCiAgICAgKiBUaGUgY29uc3RydWN0b3IgYW5kIHtAbGluayBNYXRyaXgzI3NldH0gbWV0aG9kIHRha2UgYXJndW1lbnRzIGluCiAgICAgKiBbcm93LW1ham9yXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3ctX2FuZF9jb2x1bW4tbWFqb3Jfb3JkZXIjQ29sdW1uLW1ham9yX29yZGVyfQogICAgICogb3JkZXIsIHdoaWxlIGludGVybmFsbHkgdGhleSBhcmUgc3RvcmVkIGluIHRoZSB7QGxpbmsgTWF0cml4MyNlbGVtZW50c30gYXJyYXkgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgICogVGhpcyBtZWFucyB0aGF0IGNhbGxpbmc6CiAgICAgKiBgYGBqcwogICAgICogY29uc3QgbSA9IG5ldyBUSFJFRS5NYXRyaXgoKTsKICAgICAqIG0uc2V0KCAxMSwgMTIsIDEzLAogICAgICogICAgICAgIDIxLCAyMiwgMjMsCiAgICAgKiAgICAgICAgMzEsIDMyLCAzMyApOwogICAgICogYGBgCiAgICAgKiB3aWxsIHJlc3VsdCBpbiB0aGUgZWxlbWVudHMgYXJyYXkgY29udGFpbmluZzoKICAgICAqIGBgYGpzCiAgICAgKiBtLmVsZW1lbnRzID0gWyAxMSwgMjEsIDMxLAogICAgICogICAgICAgICAgICAgICAgMTIsIDIyLCAzMiwKICAgICAqICAgICAgICAgICAgICAgIDEzLCAyMywgMzMgXTsKICAgICAqIGBgYAogICAgICogYW5kIGludGVybmFsbHkgYWxsIGNhbGN1bGF0aW9ucyBhcmUgcGVyZm9ybWVkIHVzaW5nIGNvbHVtbi1tYWpvciBvcmRlcmluZy4KICAgICAqIEhvd2V2ZXIsIGFzIHRoZSBhY3R1YWwgb3JkZXJpbmcgbWFrZXMgbm8gZGlmZmVyZW5jZSBtYXRoZW1hdGljYWxseSBhbmQKICAgICAqIG1vc3QgcGVvcGxlIGFyZSB1c2VkIHRvIHRoaW5raW5nIGFib3V0IG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlciwgdGhlCiAgICAgKiB0aHJlZS5qcyBkb2N1bWVudGF0aW9uIHNob3dzIG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlci4gSnVzdCBiZWFyIGluCiAgICAgKiBtaW5kIHRoYXQgaWYgeW91IGFyZSByZWFkaW5nIHRoZSBzb3VyY2UgY29kZSwgeW91J2xsIGhhdmUgdG8gdGFrZSB0aGUKICAgICAqIHRyYW5zcG9zZSBvZiBhbnkgbWF0cmljZXMgb3V0bGluZWQgaGVyZSB0byBtYWtlIHNlbnNlIG9mIHRoZSBjYWxjdWxhdGlvbnMuCiAgICAgKi8KICAgIGNsYXNzIE1hdHJpeDMgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IDN4MyBtYXRyaXguIFRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCiAgICAJICogaW4gcm93LW1ham9yIG9yZGVyLiBJZiBubyBhcmd1bWVudHMgYXJlIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0b3IKICAgIAkgKiBpbml0aWFsaXplcyB0aGUgbWF0cml4IGFzIGFuIGlkZW50aXR5IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjExXSAtIDEtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xMl0gLSAxLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTNdIC0gMS0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIxXSAtIDItMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yMl0gLSAyLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjNdIC0gMi0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMxXSAtIDMtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zMl0gLSAzLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzNdIC0gMy0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCU1hdHJpeDMucHJvdG90eXBlLmlzTWF0cml4MyA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogQSBjb2x1bW4tbWFqb3IgbGlzdCBvZiBtYXRyaXggdmFsdWVzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPn0KICAgIAkJICovCiAgICAJCXRoaXMuZWxlbWVudHMgPSBbCgogICAgCQkJMSwgMCwgMCwKICAgIAkJCTAsIDEsIDAsCiAgICAJCQkwLCAwLCAxCgogICAgCQldOwoKICAgIAkJaWYgKCBuMTEgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl0aGlzLnNldCggbjExLCBuMTIsIG4xMywgbjIxLCBuMjIsIG4yMywgbjMxLCBuMzIsIG4zMyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtYXRyaXguVGhlIGFyZ3VtZW50cyBhcmUgc3VwcG9zZWQgdG8gYmUKICAgIAkgKiBpbiByb3ctbWFqb3Igb3JkZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zMV0gLSAzLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzJdIC0gMy0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMzXSAtIDMtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzZXQoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQl0ZVsgMCBdID0gbjExOyB0ZVsgMSBdID0gbjIxOyB0ZVsgMiBdID0gbjMxOwogICAgCQl0ZVsgMyBdID0gbjEyOyB0ZVsgNCBdID0gbjIyOyB0ZVsgNSBdID0gbjMyOwogICAgCQl0ZVsgNiBdID0gbjEzOyB0ZVsgNyBdID0gbjIzOyB0ZVsgOCBdID0gbjMzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgM3gzIGlkZW50aXR5IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWlkZW50aXR5KCkgewoKICAgIAkJdGhpcy5zZXQoCgogICAgCQkJMSwgMCwgMCwKICAgIAkJCTAsIDEsIDAsCiAgICAJCQkwLCAwLCAxCgogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIG1hdHJpeCB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWNvcHkoIG0gKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCiAgICAJCXRlWyAwIF0gPSBtZVsgMCBdOyB0ZVsgMSBdID0gbWVbIDEgXTsgdGVbIDIgXSA9IG1lWyAyIF07CiAgICAJCXRlWyAzIF0gPSBtZVsgMyBdOyB0ZVsgNCBdID0gbWVbIDQgXTsgdGVbIDUgXSA9IG1lWyA1IF07CiAgICAJCXRlWyA2IF0gPSBtZVsgNiBdOyB0ZVsgNyBdID0gbWVbIDcgXTsgdGVbIDggXSA9IG1lWyA4IF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHRyYWN0cyB0aGUgYmFzaXMgb2YgdGhpcyBtYXRyaXggaW50byB0aGUgdGhyZWUgYXhpcyB2ZWN0b3JzIHByb3ZpZGVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB4QXhpcyAtIFRoZSBiYXNpcydzIHggYXhpcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHlBeGlzIC0gVGhlIGJhc2lzJ3MgeSBheGlzLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gekF4aXMgLSBUaGUgYmFzaXMncyB6IGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJZXh0cmFjdEJhc2lzKCB4QXhpcywgeUF4aXMsIHpBeGlzICkgewoKICAgIAkJeEF4aXMuc2V0RnJvbU1hdHJpeDNDb2x1bW4oIHRoaXMsIDAgKTsKICAgIAkJeUF4aXMuc2V0RnJvbU1hdHJpeDNDb2x1bW4oIHRoaXMsIDEgKTsKICAgIAkJekF4aXMuc2V0RnJvbU1hdHJpeDNDb2x1bW4oIHRoaXMsIDIgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldCB0aGlzIG1hdHJpeCB0byB0aGUgdXBwZXIgM3gzIG1hdHJpeCBvZiB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCXNldEZyb21NYXRyaXg0KCBtICkgewoKICAgIAkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy5zZXQoCgogICAgCQkJbWVbIDAgXSwgbWVbIDQgXSwgbWVbIDggXSwKICAgIAkJCW1lWyAxIF0sIG1lWyA1IF0sIG1lWyA5IF0sCiAgICAJCQltZVsgMiBdLCBtZVsgNiBdLCBtZVsgMTAgXQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFBvc3QtbXVsdGlwbGllcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gM3gzIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSBtYXRyaXggdG8gbXVsdGlwbHkgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltdWx0aXBseSggbSApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIHRoaXMsIG0gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQcmUtbXVsdGlwbGllcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gM3gzIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSBtYXRyaXggdG8gbXVsdGlwbHkgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlwcmVtdWx0aXBseSggbSApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIG0sIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsZXMgdGhlIGdpdmVuIDN4MyBtYXRyaWNlcyBhbmQgc3RvcmVzIHRoZSByZXN1bHQKICAgIAkgKiBpbiB0aGlzIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gYSAtIFRoZSBmaXJzdCBtYXRyaXguCiAgICAJICogQHBhcmFtIHtNYXRyaXgzfSBiIC0gVGhlIHNlY29uZCBtYXRyaXguCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbXVsdGlwbHlNYXRyaWNlcyggYSwgYiApIHsKCiAgICAJCWNvbnN0IGFlID0gYS5lbGVtZW50czsKICAgIAkJY29uc3QgYmUgPSBiLmVsZW1lbnRzOwogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQljb25zdCBhMTEgPSBhZVsgMCBdLCBhMTIgPSBhZVsgMyBdLCBhMTMgPSBhZVsgNiBdOwogICAgCQljb25zdCBhMjEgPSBhZVsgMSBdLCBhMjIgPSBhZVsgNCBdLCBhMjMgPSBhZVsgNyBdOwogICAgCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNSBdLCBhMzMgPSBhZVsgOCBdOwoKICAgIAkJY29uc3QgYjExID0gYmVbIDAgXSwgYjEyID0gYmVbIDMgXSwgYjEzID0gYmVbIDYgXTsKICAgIAkJY29uc3QgYjIxID0gYmVbIDEgXSwgYjIyID0gYmVbIDQgXSwgYjIzID0gYmVbIDcgXTsKICAgIAkJY29uc3QgYjMxID0gYmVbIDIgXSwgYjMyID0gYmVbIDUgXSwgYjMzID0gYmVbIDggXTsKCiAgICAJCXRlWyAwIF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzE7CiAgICAJCXRlWyAzIF0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzI7CiAgICAJCXRlWyA2IF0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzM7CgogICAgCQl0ZVsgMSBdID0gYTIxICogYjExICsgYTIyICogYjIxICsgYTIzICogYjMxOwogICAgCQl0ZVsgNCBdID0gYTIxICogYjEyICsgYTIyICogYjIyICsgYTIzICogYjMyOwogICAgCQl0ZVsgNyBdID0gYTIxICogYjEzICsgYTIyICogYjIzICsgYTIzICogYjMzOwoKICAgIAkJdGVbIDIgXSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgIAkJdGVbIDUgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgIAkJdGVbIDggXSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11bHRpcGxpZXMgZXZlcnkgY29tcG9uZW50IG9mIHRoZSBtYXRyaXggYnkgdGhlIGdpdmVuIHNjYWxhci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhci4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltdWx0aXBseVNjYWxhciggcyApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCXRlWyAwIF0gKj0gczsgdGVbIDMgXSAqPSBzOyB0ZVsgNiBdICo9IHM7CiAgICAJCXRlWyAxIF0gKj0gczsgdGVbIDQgXSAqPSBzOyB0ZVsgNyBdICo9IHM7CiAgICAJCXRlWyAyIF0gKj0gczsgdGVbIDUgXSAqPSBzOyB0ZVsgOCBdICo9IHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyBhbmQgcmV0dXJucyB0aGUgZGV0ZXJtaW5hbnQgb2YgdGhpcyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkZXRlcm1pbmFudC4KICAgIAkgKi8KICAgIAlkZXRlcm1pbmFudCgpIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWNvbnN0IGEgPSB0ZVsgMCBdLCBiID0gdGVbIDEgXSwgYyA9IHRlWyAyIF0sCiAgICAJCQlkID0gdGVbIDMgXSwgZSA9IHRlWyA0IF0sIGYgPSB0ZVsgNSBdLAogICAgCQkJZyA9IHRlWyA2IF0sIGggPSB0ZVsgNyBdLCBpID0gdGVbIDggXTsKCiAgICAJCXJldHVybiBhICogZSAqIGkgLSBhICogZiAqIGggLSBiICogZCAqIGkgKyBiICogZiAqIGcgKyBjICogZCAqIGggLSBjICogZSAqIGc7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW52ZXJ0cyB0aGlzIG1hdHJpeCwgdXNpbmcgdGhlIFthbmFseXRpYyBtZXRob2Rde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVydGlibGVfbWF0cml4I0FuYWx5dGljX3NvbHV0aW9ufS4KICAgIAkgKiBZb3UgY2FuIG5vdCBpbnZlcnQgd2l0aCBhIGRldGVybWluYW50IG9mIHplcm8uIElmIHlvdSBhdHRlbXB0IHRoaXMsIHRoZSBtZXRob2QgcHJvZHVjZXMKICAgIAkgKiBhIHplcm8gbWF0cml4IGluc3RlYWQuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlpbnZlcnQoKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsCgogICAgCQkJbjExID0gdGVbIDAgXSwgbjIxID0gdGVbIDEgXSwgbjMxID0gdGVbIDIgXSwKICAgIAkJCW4xMiA9IHRlWyAzIF0sIG4yMiA9IHRlWyA0IF0sIG4zMiA9IHRlWyA1IF0sCiAgICAJCQluMTMgPSB0ZVsgNiBdLCBuMjMgPSB0ZVsgNyBdLCBuMzMgPSB0ZVsgOCBdLAoKICAgIAkJCXQxMSA9IG4zMyAqIG4yMiAtIG4zMiAqIG4yMywKICAgIAkJCXQxMiA9IG4zMiAqIG4xMyAtIG4zMyAqIG4xMiwKICAgIAkJCXQxMyA9IG4yMyAqIG4xMiAtIG4yMiAqIG4xMywKCiAgICAJCQlkZXQgPSBuMTEgKiB0MTEgKyBuMjEgKiB0MTIgKyBuMzEgKiB0MTM7CgogICAgCQlpZiAoIGRldCA9PT0gMCApIHJldHVybiB0aGlzLnNldCggMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCApOwoKICAgIAkJY29uc3QgZGV0SW52ID0gMSAvIGRldDsKCiAgICAJCXRlWyAwIF0gPSB0MTEgKiBkZXRJbnY7CiAgICAJCXRlWyAxIF0gPSAoIG4zMSAqIG4yMyAtIG4zMyAqIG4yMSApICogZGV0SW52OwogICAgCQl0ZVsgMiBdID0gKCBuMzIgKiBuMjEgLSBuMzEgKiBuMjIgKSAqIGRldEludjsKCiAgICAJCXRlWyAzIF0gPSB0MTIgKiBkZXRJbnY7CiAgICAJCXRlWyA0IF0gPSAoIG4zMyAqIG4xMSAtIG4zMSAqIG4xMyApICogZGV0SW52OwogICAgCQl0ZVsgNSBdID0gKCBuMzEgKiBuMTIgLSBuMzIgKiBuMTEgKSAqIGRldEludjsKCiAgICAJCXRlWyA2IF0gPSB0MTMgKiBkZXRJbnY7CiAgICAJCXRlWyA3IF0gPSAoIG4yMSAqIG4xMyAtIG4yMyAqIG4xMSApICogZGV0SW52OwogICAgCQl0ZVsgOCBdID0gKCBuMjIgKiBuMTEgLSBuMjEgKiBuMTIgKSAqIGRldEludjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zcG9zZXMgdGhpcyBtYXRyaXggaW4gcGxhY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAl0cmFuc3Bvc2UoKSB7CgogICAgCQlsZXQgdG1wOwogICAgCQljb25zdCBtID0gdGhpcy5lbGVtZW50czsKCiAgICAJCXRtcCA9IG1bIDEgXTsgbVsgMSBdID0gbVsgMyBdOyBtWyAzIF0gPSB0bXA7CiAgICAJCXRtcCA9IG1bIDIgXTsgbVsgMiBdID0gbVsgNiBdOyBtWyA2IF0gPSB0bXA7CiAgICAJCXRtcCA9IG1bIDUgXTsgbVsgNSBdID0gbVsgNyBdOyBtWyA3IF0gPSB0bXA7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIG1hdHJpeCB3aGljaCBpcyB0aGUgaW52ZXJzZSB0cmFuc3Bvc2Ugb2YgdGhlIHVwcGVyCiAgICAJICogbGVmdCAzeDMgcG9ydGlvbiBvZiB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4NCAtIFRoZSA0eDQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWdldE5vcm1hbE1hdHJpeCggbWF0cml4NCApIHsKCiAgICAJCXJldHVybiB0aGlzLnNldEZyb21NYXRyaXg0KCBtYXRyaXg0ICkuaW52ZXJ0KCkudHJhbnNwb3NlKCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNwb3NlcyB0aGlzIG1hdHJpeCBpbnRvIHRoZSBzdXBwbGllZCBhcnJheSwgYW5kIHJldHVybnMgaXRzZWxmIHVuY2hhbmdlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gciAtIEFuIGFycmF5IHRvIHN0b3JlIHRoZSB0cmFuc3Bvc2VkIG1hdHJpeCBlbGVtZW50cy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAl0cmFuc3Bvc2VJbnRvQXJyYXkoIHIgKSB7CgogICAgCQljb25zdCBtID0gdGhpcy5lbGVtZW50czsKCiAgICAJCXJbIDAgXSA9IG1bIDAgXTsKICAgIAkJclsgMSBdID0gbVsgMyBdOwogICAgCQlyWyAyIF0gPSBtWyA2IF07CiAgICAJCXJbIDMgXSA9IG1bIDEgXTsKICAgIAkJclsgNCBdID0gbVsgNCBdOwogICAgCQlyWyA1IF0gPSBtWyA3IF07CiAgICAJCXJbIDYgXSA9IG1bIDIgXTsKICAgIAkJclsgNyBdID0gbVsgNSBdOwogICAgCQlyWyA4IF0gPSBtWyA4IF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBVViB0cmFuc2Zvcm0gbWF0cml4IGZyb20gb2Zmc2V0LCByZXBlYXQsIHJvdGF0aW9uLCBhbmQgY2VudGVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHR4IC0gT2Zmc2V0IHguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHR5IC0gT2Zmc2V0IHkuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN4IC0gUmVwZWF0IHguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN5IC0gUmVwZWF0IHkuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHJvdGF0aW9uIC0gUm90YXRpb24sIGluIHJhZGlhbnMuIFBvc2l0aXZlIHZhbHVlcyByb3RhdGUgY291bnRlcmNsb2Nrd2lzZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gY3ggLSBDZW50ZXIgeCBvZiByb3RhdGlvbi4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gY3kgLSBDZW50ZXIgeSBvZiByb3RhdGlvbgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCXNldFV2VHJhbnNmb3JtKCB0eCwgdHksIHN4LCBzeSwgcm90YXRpb24sIGN4LCBjeSApIHsKCiAgICAJCWNvbnN0IGMgPSBNYXRoLmNvcyggcm90YXRpb24gKTsKICAgIAkJY29uc3QgcyA9IE1hdGguc2luKCByb3RhdGlvbiApOwoKICAgIAkJdGhpcy5zZXQoCiAgICAJCQlzeCAqIGMsIHN4ICogcywgLSBzeCAqICggYyAqIGN4ICsgcyAqIGN5ICkgKyBjeCArIHR4LAogICAgCQkJLSBzeSAqIHMsIHN5ICogYywgLSBzeSAqICggLSBzICogY3ggKyBjICogY3kgKSArIGN5ICsgdHksCiAgICAJCQkwLCAwLCAxCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTY2FsZXMgdGhpcyBtYXRyaXggd2l0aCB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzeCAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFggYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3kgLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBZIGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJc2NhbGUoIHN4LCBzeSApIHsKCiAgICAJCXRoaXMucHJlbXVsdGlwbHkoIF9tMy5tYWtlU2NhbGUoIHN4LCBzeSApICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoaXMgbWF0cml4IGJ5IHRoZSBnaXZlbiBhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCXJvdGF0ZSggdGhldGEgKSB7CgogICAgCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVJvdGF0aW9uKCAtIHRoZXRhICkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdHggLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgWCBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0eSAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBZIGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJdHJhbnNsYXRlKCB0eCwgdHkgKSB7CgogICAgCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVRyYW5zbGF0aW9uKCB0eCwgdHkgKSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLy8gZm9yIDJEIFRyYW5zZm9ybXMKCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIDJEIHRyYW5zbGF0aW9uIHRyYW5zZm9ybS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfFZlY3RvcjJ9IHggLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgWCBheGlzIG9yIGFsdGVybmF0aXZlbHkgYSB0cmFuc2xhdGlvbiB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgWSBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VUcmFuc2xhdGlvbiggeCwgeSApIHsKCiAgICAJCWlmICggeC5pc1ZlY3RvcjIgKSB7CgogICAgCQkJdGhpcy5zZXQoCgogICAgCQkJCTEsIDAsIHgueCwKICAgIAkJCQkwLCAxLCB4LnksCiAgICAJCQkJMCwgMCwgMQoKICAgIAkJCSk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMuc2V0KAoKICAgIAkJCQkxLCAwLCB4LAogICAgCQkJCTAsIDEsIHksCiAgICAJCQkJMCwgMCwgMQoKICAgIAkJCSk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgMkQgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VSb3RhdGlvbiggdGhldGEgKSB7CgogICAgCQkvLyBjb3VudGVyY2xvY2t3aXNlCgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIHRoZXRhICk7CiAgICAJCWNvbnN0IHMgPSBNYXRoLnNpbiggdGhldGEgKTsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCWMsIC0gcywgMCwKICAgIAkJCXMsIGMsIDAsCiAgICAJCQkwLCAwLCAxCgogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIDJEIHNjYWxlIHRyYW5zZm9ybS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWCBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VTY2FsZSggeCwgeSApIHsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCXgsIDAsIDAsCiAgICAJCQkwLCB5LCAwLAogICAgCQkJMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gbWF0cml4IC0gVGhlIG1hdHJpeCB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIG1hdHJpeCApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgIAkJY29uc3QgbWUgPSBtYXRyaXguZWxlbWVudHM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKICAgIAkJCWlmICggdGVbIGkgXSAhPT0gbWVbIGkgXSApIHJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0cnVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gYXJyYXkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGFycmF5IC0gVGhlIG1hdHJpeCBlbGVtZW50cyBpbiBjb2x1bW4tbWFqb3Igb3JkZXIuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgogICAgCQkJdGhpcy5lbGVtZW50c1sgaSBdID0gYXJyYXlbIGkgKyBvZmZzZXQgXTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFdyaXRlcyB0aGUgZWxlbWVudHMgb2YgdGhpcyBtYXRyaXggdG8gdGhlIGdpdmVuIGFycmF5LiBJZiBubyBhcnJheSBpcyBwcm92aWRlZCwKICAgIAkgKiB0aGUgbWV0aG9kIHJldHVybnMgYSBuZXcgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IFthcnJheT1bXV0gLSBUaGUgdGFyZ2V0IGFycmF5IGhvbGRpbmcgdGhlIG1hdHJpeCBlbGVtZW50cyBpbiBjb2x1bW4tbWFqb3Igb3JkZXIuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIG1hdHJpeCBlbGVtZW50cyBpbiBjb2x1bW4tbWFqb3Igb3JkZXIuCiAgICAJICovCiAgICAJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWFycmF5WyBvZmZzZXQgXSA9IHRlWyAwIF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0ZVsgMSBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGVbIDIgXTsKCiAgICAJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0ZVsgMyBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgNCBdID0gdGVbIDQgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDUgXSA9IHRlWyA1IF07CgogICAgCQlhcnJheVsgb2Zmc2V0ICsgNiBdID0gdGVbIDYgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDcgXSA9IHRlWyA3IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyA4IF0gPSB0ZVsgOCBdOwoKICAgIAkJcmV0dXJuIGFycmF5OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBtYXRyaXggd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmZyb21BcnJheSggdGhpcy5lbGVtZW50cyApOwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF9tMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKTsKCiAgICBmdW5jdGlvbiBhcnJheU5lZWRzVWludDMyKCBhcnJheSApIHsKCiAgICAJLy8gYXNzdW1lcyBsYXJnZXIgdmFsdWVzIHVzdWFsbHkgb24gbGFzdAoKICAgIAlmb3IgKCBsZXQgaSA9IGFycmF5Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS0gaSApIHsKCiAgICAJCWlmICggYXJyYXlbIGkgXSA+PSA2NTUzNSApIHJldHVybiB0cnVlOyAvLyBhY2NvdW50IGZvciBQUklNSVRJVkVfUkVTVEFSVF9GSVhFRF9JTkRFWCwgIzI0NTY1CgogICAgCX0KCiAgICAJcmV0dXJuIGZhbHNlOwoKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50TlMoIG5hbWUgKSB7CgogICAgCXJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJywgbmFtZSApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVDYW52YXNFbGVtZW50KCkgewoKICAgIAljb25zdCBjYW52YXMgPSBjcmVhdGVFbGVtZW50TlMoICdjYW52YXMnICk7CiAgICAJY2FudmFzLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgCXJldHVybiBjYW52YXM7CgogICAgfQoKICAgIGNvbnN0IF9jYWNoZSA9IHt9OwoKICAgIGZ1bmN0aW9uIHdhcm5PbmNlKCBtZXNzYWdlICkgewoKICAgIAlpZiAoIG1lc3NhZ2UgaW4gX2NhY2hlICkgcmV0dXJuOwoKICAgIAlfY2FjaGVbIG1lc3NhZ2UgXSA9IHRydWU7CgogICAgCWNvbnNvbGUud2FybiggbWVzc2FnZSApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBwcm9iZUFzeW5jKCBnbCwgc3luYywgaW50ZXJ2YWwgKSB7CgogICAgCXJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7CgogICAgCQlmdW5jdGlvbiBwcm9iZSgpIHsKCiAgICAJCQlzd2l0Y2ggKCBnbC5jbGllbnRXYWl0U3luYyggc3luYywgZ2wuU1lOQ19GTFVTSF9DT01NQU5EU19CSVQsIDAgKSApIHsKCiAgICAJCQkJY2FzZSBnbC5XQUlUX0ZBSUxFRDoKICAgIAkJCQkJcmVqZWN0KCk7CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlIGdsLlRJTUVPVVRfRVhQSVJFRDoKICAgIAkJCQkJc2V0VGltZW91dCggcHJvYmUsIGludGVydmFsICk7CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQlkZWZhdWx0OgogICAgCQkJCQlyZXNvbHZlKCk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJc2V0VGltZW91dCggcHJvYmUsIGludGVydmFsICk7CgogICAgCX0gKTsKCiAgICB9CgogICAgZnVuY3Rpb24gdG9Ob3JtYWxpemVkUHJvamVjdGlvbk1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApIHsKCiAgICAJY29uc3QgbSA9IHByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgogICAgCS8vIENvbnZlcnQgWy0xLCAxXSB0byBbMCwgMV0gcHJvamVjdGlvbiBtYXRyaXgKICAgIAltWyAyIF0gPSAwLjUgKiBtWyAyIF0gKyAwLjUgKiBtWyAzIF07CiAgICAJbVsgNiBdID0gMC41ICogbVsgNiBdICsgMC41ICogbVsgNyBdOwogICAgCW1bIDEwIF0gPSAwLjUgKiBtWyAxMCBdICsgMC41ICogbVsgMTEgXTsKICAgIAltWyAxNCBdID0gMC41ICogbVsgMTQgXSArIDAuNSAqIG1bIDE1IF07CgogICAgfQoKICAgIGZ1bmN0aW9uIHRvUmV2ZXJzZWRQcm9qZWN0aW9uTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICkgewoKICAgIAljb25zdCBtID0gcHJvamVjdGlvbk1hdHJpeC5lbGVtZW50czsKICAgIAljb25zdCBpc1BlcnNwZWN0aXZlTWF0cml4ID0gbVsgMTEgXSA9PT0gLTE7CgogICAgCS8vIFJldmVyc2UgWzAsIDFdIHByb2plY3Rpb24gbWF0cml4CiAgICAJaWYgKCBpc1BlcnNwZWN0aXZlTWF0cml4ICkgewoKICAgIAkJbVsgMTAgXSA9IC0gbVsgMTAgXSAtIDE7CiAgICAJCW1bIDE0IF0gPSAtIG1bIDE0IF07CgogICAgCX0gZWxzZSB7CgogICAgCQltWyAxMCBdID0gLSBtWyAxMCBdOwogICAgCQltWyAxNCBdID0gLSBtWyAxNCBdICsgMTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBMSU5FQVJfUkVDNzA5X1RPX1hZWiA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKS5zZXQoCiAgICAJMC40MTIzOTA4LCAwLjM1NzU4NDMsIDAuMTgwNDgwOCwKICAgIAkwLjIxMjYzOTAsIDAuNzE1MTY4NywgMC4wNzIxOTIzLAogICAgCTAuMDE5MzMwOCwgMC4xMTkxOTQ4LCAwLjk1MDUzMjIKICAgICk7CgogICAgY29uc3QgWFlaX1RPX0xJTkVBUl9SRUM3MDkgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkuc2V0KAogICAgCTMuMjQwOTY5OSwgLTEuNTM3MzgzMiwgLTAuNDk4NjEwOCwKICAgIAktMC45NjkyNDM2LCAxLjg3NTk2NzUsIDAuMDQxNTU1MSwKICAgIAkwLjA1NTYzMDEsIC0wLjIwMzk3NywgMS4wNTY5NzE1CiAgICApOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbG9yTWFuYWdlbWVudCgpIHsKCiAgICAJY29uc3QgQ29sb3JNYW5hZ2VtZW50ID0gewoKICAgIAkJZW5hYmxlZDogdHJ1ZSwKCiAgICAJCXdvcmtpbmdDb2xvclNwYWNlOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSwKCiAgICAJCS8qKgogICAgCQkgKiBJbXBsZW1lbnRhdGlvbnMgb2Ygc3VwcG9ydGVkIGNvbG9yIHNwYWNlcy4KICAgIAkJICoKICAgIAkJICogUmVxdWlyZWQ6CiAgICAJCSAqCS0gcHJpbWFyaWVzOiBjaHJvbWF0aWNpdHkgY29vcmRpbmF0ZXMgWyByeCByeSBneCBneSBieCBieSBdCiAgICAJCSAqCS0gd2hpdGVQb2ludDogcmVmZXJlbmNlIHdoaXRlIFsgeCB5IF0KICAgIAkJICoJLSB0cmFuc2ZlcjogdHJhbnNmZXIgZnVuY3Rpb24gKHByZS1kZWZpbmVkKQogICAgCQkgKgktIHRvWFlaOiBNYXRyaXgzIFJHQiB0byBYWVogdHJhbnNmb3JtCiAgICAJCSAqCS0gZnJvbVhZWjogTWF0cml4MyBYWVogdG8gUkdCIHRyYW5zZm9ybQogICAgCQkgKgktIGx1bWluYW5jZUNvZWZmaWNpZW50czogUkdCIGx1bWluYW5jZSBjb2VmZmljaWVudHMKICAgIAkJICoKICAgIAkJICogT3B0aW9uYWw6CiAgICAJCSAqICAtIG91dHB1dENvbG9yU3BhY2VDb25maWc6IHsgZHJhd2luZ0J1ZmZlckNvbG9yU3BhY2U6IENvbG9yU3BhY2UgfQogICAgCQkgKiAgLSB3b3JraW5nQ29sb3JTcGFjZUNvbmZpZzogeyB1bnBhY2tDb2xvclNwYWNlOiBDb2xvclNwYWNlIH0KICAgIAkJICoKICAgIAkJICogUmVmZXJlbmNlOgogICAgCQkgKiAtIGh0dHBzOi8vd3d3LnJ1c3NlbGxjb3R0cmVsbC5jb20vcGhvdG8vbWF0cml4Q2FsY3VsYXRvci5odG0KICAgIAkJICovCiAgICAJCXNwYWNlczoge30sCgogICAgCQljb252ZXJ0OiBmdW5jdGlvbiAoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlLCB0YXJnZXRDb2xvclNwYWNlICkgewoKICAgIAkJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSB8fCBzb3VyY2VDb2xvclNwYWNlID09PSB0YXJnZXRDb2xvclNwYWNlIHx8ICEgc291cmNlQ29sb3JTcGFjZSB8fCAhIHRhcmdldENvbG9yU3BhY2UgKSB7CgogICAgCQkJCXJldHVybiBjb2xvcjsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0aGlzLnNwYWNlc1sgc291cmNlQ29sb3JTcGFjZSBdLnRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSB7CgogICAgCQkJCWNvbG9yLnIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLnIgKTsKICAgIAkJCQljb2xvci5nID0gU1JHQlRvTGluZWFyKCBjb2xvci5nICk7CiAgICAJCQkJY29sb3IuYiA9IFNSR0JUb0xpbmVhciggY29sb3IuYiApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHRoaXMuc3BhY2VzWyBzb3VyY2VDb2xvclNwYWNlIF0ucHJpbWFyaWVzICE9PSB0aGlzLnNwYWNlc1sgdGFyZ2V0Q29sb3JTcGFjZSBdLnByaW1hcmllcyApIHsKCiAgICAJCQkJY29sb3IuYXBwbHlNYXRyaXgzKCB0aGlzLnNwYWNlc1sgc291cmNlQ29sb3JTcGFjZSBdLnRvWFlaICk7CiAgICAJCQkJY29sb3IuYXBwbHlNYXRyaXgzKCB0aGlzLnNwYWNlc1sgdGFyZ2V0Q29sb3JTcGFjZSBdLmZyb21YWVogKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0aGlzLnNwYWNlc1sgdGFyZ2V0Q29sb3JTcGFjZSBdLnRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSB7CgogICAgCQkJCWNvbG9yLnIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLnIgKTsKICAgIAkJCQljb2xvci5nID0gTGluZWFyVG9TUkdCKCBjb2xvci5nICk7CiAgICAJCQkJY29sb3IuYiA9IExpbmVhclRvU1JHQiggY29sb3IuYiApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gY29sb3I7CgogICAgCQl9LAoKICAgIAkJd29ya2luZ1RvQ29sb3JTcGFjZTogZnVuY3Rpb24gKCBjb2xvciwgdGFyZ2V0Q29sb3JTcGFjZSApIHsKCiAgICAJCQlyZXR1cm4gdGhpcy5jb252ZXJ0KCBjb2xvciwgdGhpcy53b3JraW5nQ29sb3JTcGFjZSwgdGFyZ2V0Q29sb3JTcGFjZSApOwoKICAgIAkJfSwKCiAgICAJCWNvbG9yU3BhY2VUb1dvcmtpbmc6IGZ1bmN0aW9uICggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UgKSB7CgogICAgCQkJcmV0dXJuIHRoaXMuY29udmVydCggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UsIHRoaXMud29ya2luZ0NvbG9yU3BhY2UgKTsKCiAgICAJCX0sCgogICAgCQlnZXRQcmltYXJpZXM6IGZ1bmN0aW9uICggY29sb3JTcGFjZSApIHsKCiAgICAJCQlyZXR1cm4gdGhpcy5zcGFjZXNbIGNvbG9yU3BhY2UgXS5wcmltYXJpZXM7CgogICAgCQl9LAoKICAgIAkJZ2V0VHJhbnNmZXI6IGZ1bmN0aW9uICggY29sb3JTcGFjZSApIHsKCiAgICAJCQlpZiAoIGNvbG9yU3BhY2UgPT09IE5vQ29sb3JTcGFjZSApIHJldHVybiBMaW5lYXJUcmFuc2ZlcjsKCiAgICAJCQlyZXR1cm4gdGhpcy5zcGFjZXNbIGNvbG9yU3BhY2UgXS50cmFuc2ZlcjsKCiAgICAJCX0sCgogICAgCQlnZXRMdW1pbmFuY2VDb2VmZmljaWVudHM6IGZ1bmN0aW9uICggdGFyZ2V0LCBjb2xvclNwYWNlID0gdGhpcy53b3JraW5nQ29sb3JTcGFjZSApIHsKCiAgICAJCQlyZXR1cm4gdGFyZ2V0LmZyb21BcnJheSggdGhpcy5zcGFjZXNbIGNvbG9yU3BhY2UgXS5sdW1pbmFuY2VDb2VmZmljaWVudHMgKTsKCiAgICAJCX0sCgogICAgCQlkZWZpbmU6IGZ1bmN0aW9uICggY29sb3JTcGFjZXMgKSB7CgogICAgCQkJT2JqZWN0LmFzc2lnbiggdGhpcy5zcGFjZXMsIGNvbG9yU3BhY2VzICk7CgogICAgCQl9LAoKICAgIAkJLy8gSW50ZXJuYWwgQVBJcwoKICAgIAkJX2dldE1hdHJpeDogZnVuY3Rpb24gKCB0YXJnZXRNYXRyaXgsIHNvdXJjZUNvbG9yU3BhY2UsIHRhcmdldENvbG9yU3BhY2UgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldE1hdHJpeAogICAgCQkJCS5jb3B5KCB0aGlzLnNwYWNlc1sgc291cmNlQ29sb3JTcGFjZSBdLnRvWFlaICkKICAgIAkJCQkubXVsdGlwbHkoIHRoaXMuc3BhY2VzWyB0YXJnZXRDb2xvclNwYWNlIF0uZnJvbVhZWiApOwoKICAgIAkJfSwKCiAgICAJCV9nZXREcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogZnVuY3Rpb24gKCBjb2xvclNwYWNlICkgewoKICAgIAkJCXJldHVybiB0aGlzLnNwYWNlc1sgY29sb3JTcGFjZSBdLm91dHB1dENvbG9yU3BhY2VDb25maWcuZHJhd2luZ0J1ZmZlckNvbG9yU3BhY2U7CgogICAgCQl9LAoKICAgIAkJX2dldFVucGFja0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3JTcGFjZSA9IHRoaXMud29ya2luZ0NvbG9yU3BhY2UgKSB7CgogICAgCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ud29ya2luZ0NvbG9yU3BhY2VDb25maWcudW5wYWNrQ29sb3JTcGFjZTsKCiAgICAJCX0sCgogICAgCQkvLyBEZXByZWNhdGVkCgogICAgCQlmcm9tV29ya2luZ0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3IsIHRhcmdldENvbG9yU3BhY2UgKSB7CgogICAgCQkJd2Fybk9uY2UoICdUSFJFRS5Db2xvck1hbmFnZW1lbnQ6IC5mcm9tV29ya2luZ0NvbG9yU3BhY2UoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC53b3JraW5nVG9Db2xvclNwYWNlKCkuJyApOyAvLyBAZGVwcmVjYXRlZCwgcjE3NwoKICAgIAkJCXJldHVybiBDb2xvck1hbmFnZW1lbnQud29ya2luZ1RvQ29sb3JTcGFjZSggY29sb3IsIHRhcmdldENvbG9yU3BhY2UgKTsKCiAgICAJCX0sCgogICAgCQl0b1dvcmtpbmdDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlICkgewoKICAgIAkJCXdhcm5PbmNlKCAnVEhSRUUuQ29sb3JNYW5hZ2VtZW50OiAudG9Xb3JraW5nQ29sb3JTcGFjZSgpIGhhcyBiZWVuIHJlbmFtZWQgdG8gLmNvbG9yU3BhY2VUb1dvcmtpbmcoKS4nICk7IC8vIEBkZXByZWNhdGVkLCByMTc3CgogICAgCQkJcmV0dXJuIENvbG9yTWFuYWdlbWVudC5jb2xvclNwYWNlVG9Xb3JraW5nKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSApOwoKICAgIAkJfSwKCiAgICAJfTsKCiAgICAJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgCSAqIHNSR0IgZGVmaW5pdGlvbnMKICAgIAkgKi8KCiAgICAJY29uc3QgUkVDNzA5X1BSSU1BUklFUyA9IFsgMC42NDAsIDAuMzMwLCAwLjMwMCwgMC42MDAsIDAuMTUwLCAwLjA2MCBdOwogICAgCWNvbnN0IFJFQzcwOV9MVU1JTkFOQ0VfQ09FRkZJQ0lFTlRTID0gWyAwLjIxMjYsIDAuNzE1MiwgMC4wNzIyIF07CiAgICAJY29uc3QgRDY1ID0gWyAwLjMxMjcsIDAuMzI5MCBdOwoKICAgIAlDb2xvck1hbmFnZW1lbnQuZGVmaW5lKCB7CgogICAgCQlbIExpbmVhclNSR0JDb2xvclNwYWNlIF06IHsKICAgIAkJCXByaW1hcmllczogUkVDNzA5X1BSSU1BUklFUywKICAgIAkJCXdoaXRlUG9pbnQ6IEQ2NSwKICAgIAkJCXRyYW5zZmVyOiBMaW5lYXJUcmFuc2ZlciwKICAgIAkJCXRvWFlaOiBMSU5FQVJfUkVDNzA5X1RPX1hZWiwKICAgIAkJCWZyb21YWVo6IFhZWl9UT19MSU5FQVJfUkVDNzA5LAogICAgCQkJbHVtaW5hbmNlQ29lZmZpY2llbnRzOiBSRUM3MDlfTFVNSU5BTkNFX0NPRUZGSUNJRU5UUywKICAgIAkJCXdvcmtpbmdDb2xvclNwYWNlQ29uZmlnOiB7IHVucGFja0NvbG9yU3BhY2U6IFNSR0JDb2xvclNwYWNlIH0sCiAgICAJCQlvdXRwdXRDb2xvclNwYWNlQ29uZmlnOiB7IGRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOiBTUkdCQ29sb3JTcGFjZSB9CiAgICAJCX0sCgogICAgCQlbIFNSR0JDb2xvclNwYWNlIF06IHsKICAgIAkJCXByaW1hcmllczogUkVDNzA5X1BSSU1BUklFUywKICAgIAkJCXdoaXRlUG9pbnQ6IEQ2NSwKICAgIAkJCXRyYW5zZmVyOiBTUkdCVHJhbnNmZXIsCiAgICAJCQl0b1hZWjogTElORUFSX1JFQzcwOV9UT19YWVosCiAgICAJCQlmcm9tWFlaOiBYWVpfVE9fTElORUFSX1JFQzcwOSwKICAgIAkJCWx1bWluYW5jZUNvZWZmaWNpZW50czogUkVDNzA5X0xVTUlOQU5DRV9DT0VGRklDSUVOVFMsCiAgICAJCQlvdXRwdXRDb2xvclNwYWNlQ29uZmlnOiB7IGRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOiBTUkdCQ29sb3JTcGFjZSB9CiAgICAJCX0sCgogICAgCX0gKTsKCiAgICAJcmV0dXJuIENvbG9yTWFuYWdlbWVudDsKCiAgICB9CgogICAgY29uc3QgQ29sb3JNYW5hZ2VtZW50ID0gLypAX19QVVJFX18qLyBjcmVhdGVDb2xvck1hbmFnZW1lbnQoKTsKCiAgICBmdW5jdGlvbiBTUkdCVG9MaW5lYXIoIGMgKSB7CgogICAgCXJldHVybiAoIGMgPCAwLjA0MDQ1ICkgPyBjICogMC4wNzczOTkzODA4IDogTWF0aC5wb3coIGMgKiAwLjk0Nzg2NzI5ODYgKyAwLjA1MjEzMjcwMTQsIDIuNCApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBMaW5lYXJUb1NSR0IoIGMgKSB7CgogICAgCXJldHVybiAoIGMgPCAwLjAwMzEzMDggKSA/IGMgKiAxMi45MiA6IDEuMDU1ICogKCBNYXRoLnBvdyggYywgMC40MTY2NiApICkgLSAwLjA1NTsKCiAgICB9CgogICAgbGV0IF9jYW52YXM7CgogICAgLyoqCiAgICAgKiBBIGNsYXNzIGNvbnRhaW5pbmcgdXRpbGl0eSBmdW5jdGlvbnMgZm9yIGltYWdlcy4KICAgICAqCiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNsYXNzIEltYWdlVXRpbHMgewoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgZGF0YSBVUkkgY29udGFpbmluZyBhIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBpbWFnZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7KEhUTUxJbWFnZUVsZW1lbnR8SFRNTENhbnZhc0VsZW1lbnQpfSBpbWFnZSAtIFRoZSBpbWFnZSBvYmplY3QuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFt0eXBlPSdpbWFnZS9wbmcnXSAtIEluZGljYXRlcyB0aGUgaW1hZ2UgZm9ybWF0LgogICAgCSAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGRhdGEgVVJJLgogICAgCSAqLwogICAgCXN0YXRpYyBnZXREYXRhVVJMKCBpbWFnZSwgdHlwZSA9ICdpbWFnZS9wbmcnICkgewoKICAgIAkJaWYgKCAvXmRhdGE6L2kudGVzdCggaW1hZ2Uuc3JjICkgKSB7CgogICAgCQkJcmV0dXJuIGltYWdlLnNyYzsKCiAgICAJCX0KCiAgICAJCWlmICggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ID09PSAndW5kZWZpbmVkJyApIHsKCiAgICAJCQlyZXR1cm4gaW1hZ2Uuc3JjOwoKICAgIAkJfQoKICAgIAkJbGV0IGNhbnZhczsKCiAgICAJCWlmICggaW1hZ2UgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCApIHsKCiAgICAJCQljYW52YXMgPSBpbWFnZTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJaWYgKCBfY2FudmFzID09PSB1bmRlZmluZWQgKSBfY2FudmFzID0gY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwoKICAgIAkJCV9jYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgIAkJCV9jYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKICAgIAkJCWNvbnN0IGNvbnRleHQgPSBfY2FudmFzLmdldENvbnRleHQoICcyZCcgKTsKCiAgICAJCQlpZiAoIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VEYXRhICkgewoKICAgIAkJCQljb250ZXh0LnB1dEltYWdlRGF0YSggaW1hZ2UsIDAsIDAgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljb250ZXh0LmRyYXdJbWFnZSggaW1hZ2UsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCiAgICAJCQl9CgogICAgCQkJY2FudmFzID0gX2NhbnZhczsKCiAgICAJCX0KCiAgICAJCXJldHVybiBjYW52YXMudG9EYXRhVVJMKCB0eXBlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhlIGdpdmVuIHNSR0IgaW1hZ2UgZGF0YSB0byBsaW5lYXIgY29sb3Igc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhIVE1MSW1hZ2VFbGVtZW50fEhUTUxDYW52YXNFbGVtZW50fEltYWdlQml0bWFwfE9iamVjdCl9IGltYWdlIC0gVGhlIGltYWdlIG9iamVjdC4KICAgIAkgKiBAcmV0dXJuIHtIVE1MQ2FudmFzRWxlbWVudHxPYmplY3R9IFRoZSBjb252ZXJ0ZWQgaW1hZ2UuCiAgICAJICovCiAgICAJc3RhdGljIHNSR0JUb0xpbmVhciggaW1hZ2UgKSB7CgogICAgCQlpZiAoICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHx8CiAgICAJCQkoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCApIHx8CiAgICAJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKICAgIAkJCWNvbnN0IGNhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCiAgICAJCQljYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgIAkJCWNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgogICAgCQkJY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CiAgICAJCQljb250ZXh0LmRyYXdJbWFnZSggaW1hZ2UsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCiAgICAJCQljb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSggMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwogICAgCQkJY29uc3QgZGF0YSA9IGltYWdlRGF0YS5kYXRhOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQlkYXRhWyBpIF0gPSBTUkdCVG9MaW5lYXIoIGRhdGFbIGkgXSAvIDI1NSApICogMjU1OwoKICAgIAkJCX0KCiAgICAJCQljb250ZXh0LnB1dEltYWdlRGF0YSggaW1hZ2VEYXRhLCAwLCAwICk7CgogICAgCQkJcmV0dXJuIGNhbnZhczsKCiAgICAJCX0gZWxzZSBpZiAoIGltYWdlLmRhdGEgKSB7CgogICAgCQkJY29uc3QgZGF0YSA9IGltYWdlLmRhdGEuc2xpY2UoIDAgKTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJaWYgKCBkYXRhIGluc3RhbmNlb2YgVWludDhBcnJheSB8fCBkYXRhIGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXkgKSB7CgogICAgCQkJCQlkYXRhWyBpIF0gPSBNYXRoLmZsb29yKCBTUkdCVG9MaW5lYXIoIGRhdGFbIGkgXSAvIDI1NSApICogMjU1ICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQkvLyBhc3N1bWluZyBmbG9hdAoKICAgIAkJCQkJZGF0YVsgaSBdID0gU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gewogICAgCQkJCWRhdGE6IGRhdGEsCiAgICAJCQkJd2lkdGg6IGltYWdlLndpZHRoLAogICAgCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0CiAgICAJCQl9OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5JbWFnZVV0aWxzLnNSR0JUb0xpbmVhcigpOiBVbnN1cHBvcnRlZCBpbWFnZSB0eXBlLiBObyBjb2xvciBzcGFjZSBjb252ZXJzaW9uIGFwcGxpZWQuJyApOwogICAgCQkJcmV0dXJuIGltYWdlOwoKICAgIAkJfQoKICAgIAl9CgogICAgfQoKICAgIGxldCBfc291cmNlSWQgPSAwOwoKICAgIC8qKgogICAgICogUmVwcmVzZW50cyB0aGUgZGF0YSBzb3VyY2Ugb2YgYSB0ZXh0dXJlLgogICAgICoKICAgICAqIFRoZSBtYWluIHB1cnBvc2Ugb2YgdGhpcyBjbGFzcyBpcyB0byBkZWNvdXBsZSB0aGUgZGF0YSBkZWZpbml0aW9uIGZyb20gdGhlIHRleHR1cmUKICAgICAqIGRlZmluaXRpb24gc28gdGhlIHNhbWUgZGF0YSBjYW4gYmUgdXNlZCB3aXRoIG11bHRpcGxlIHRleHR1cmUgaW5zdGFuY2VzLgogICAgICovCiAgICBjbGFzcyBTb3VyY2UgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHZpZGVvIHRleHR1cmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge2FueX0gW2RhdGE9bnVsbF0gLSBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggZGF0YSA9IG51bGwgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1NvdXJjZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIElEIG9mIHRoZSBzb3VyY2UuCiAgICAJCSAqCiAgICAJCSAqIEBuYW1lIFNvdXJjZSNpZAogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX3NvdXJjZUlkICsrIH0gKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgVVVJRCBvZiB0aGUgc291cmNlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkYXRhIGRlZmluaXRpb24gb2YgYSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7YW55fQogICAgCQkgKi8KICAgIAkJdGhpcy5kYXRhID0gZGF0YTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIHByb3BlcnR5IGlzIG9ubHkgcmVsZXZhbnQgd2hlbiB7QGxpbmsgU291cmNlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgIGFuZAogICAgCQkgKiBwcm92aWRlcyBtb3JlIGNvbnRyb2wgb24gaG93IHRleHR1cmUgZGF0YSBzaG91bGQgYmUgcHJvY2Vzc2VkLiBXaGVuIGBkYXRhUmVhZHlgIGlzIHNldAogICAgCQkgKiB0byBgZmFsc2VgLCB0aGUgZW5naW5lIHBlcmZvcm1zIHRoZSBtZW1vcnkgYWxsb2NhdGlvbiAoaWYgbmVjZXNzYXJ5KSBidXQgZG9lcyBub3QgdHJhbnNmZXIKICAgIAkJICogdGhlIGRhdGEgaW50byB0aGUgR1BVIG1lbW9yeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuZGF0YVJlYWR5ID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIHN0YXJ0cyBhdCBgMGAgYW5kIGNvdW50cyBob3cgbWFueSB0aW1lcyB7QGxpbmsgU291cmNlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy52ZXJzaW9uID0gMDsKCiAgICAJfQoKICAgIAlnZXRTaXplKCB0YXJnZXQgKSB7CgogICAgCQljb25zdCBkYXRhID0gdGhpcy5kYXRhOwoKICAgIAkJaWYgKCBkYXRhIGluc3RhbmNlb2YgSFRNTFZpZGVvRWxlbWVudCApIHsKCiAgICAJCQl0YXJnZXQuc2V0KCBkYXRhLnZpZGVvV2lkdGgsIGRhdGEudmlkZW9IZWlnaHQgKTsKCiAgICAJCX0gZWxzZSBpZiAoIGRhdGEgIT09IG51bGwgKSB7CgogICAgCQkJdGFyZ2V0LnNldCggZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQsIGRhdGEuZGVwdGggfHwgMCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0YXJnZXQuc2V0KCAwLCAwLCAwICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFdoZW4gdGhlIHByb3BlcnR5IGlzIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYWxsb2NhdGVzIHRoZSBtZW1vcnkKICAgIAkgKiBmb3IgdGhlIHRleHR1cmUgKGlmIG5lY2Vzc2FyeSkgYW5kIHRyaWdnZXJzIHRoZSBhY3R1YWwgdGV4dHVyZSB1cGxvYWQKICAgIAkgKiB0byB0aGUgR1BVIG5leHQgdGltZSB0aGUgc291cmNlIGlzIHVzZWQuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkgKiBAZGVmYXVsdCBmYWxzZQogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICAgIAkgKi8KICAgIAlzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKICAgIAkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHRoaXMudmVyc2lvbiArKzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXJpYWxpemVzIHRoZSBzb3VyY2UgaW50byBKU09OLgogICAgCSAqCiAgICAJICogQHBhcmFtIHs/KE9iamVjdHxzdHJpbmcpfSBtZXRhIC0gQW4gb3B0aW9uYWwgdmFsdWUgaG9sZGluZyBtZXRhIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzZXJpYWxpemF0aW9uLgogICAgCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgc291cmNlLgogICAgCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KICAgIAkgKi8KICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCiAgICAJCWlmICggISBpc1Jvb3RPYmplY3QgJiYgbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcmV0dXJuIG1ldGEuaW1hZ2VzWyB0aGlzLnV1aWQgXTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IG91dHB1dCA9IHsKICAgIAkJCXV1aWQ6IHRoaXMudXVpZCwKICAgIAkJCXVybDogJycKICAgIAkJfTsKCiAgICAJCWNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgCQlpZiAoIGRhdGEgIT09IG51bGwgKSB7CgogICAgCQkJbGV0IHVybDsKCiAgICAJCQlpZiAoIEFycmF5LmlzQXJyYXkoIGRhdGEgKSApIHsKCiAgICAJCQkJLy8gY3ViZSB0ZXh0dXJlCgogICAgCQkJCXVybCA9IFtdOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBkYXRhLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQlpZiAoIGRhdGFbIGkgXS5pc0RhdGFUZXh0dXJlICkgewoKICAgIAkJCQkJCXVybC5wdXNoKCBzZXJpYWxpemVJbWFnZSggZGF0YVsgaSBdLmltYWdlICkgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJdXJsLnB1c2goIHNlcmlhbGl6ZUltYWdlKCBkYXRhWyBpIF0gKSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJLy8gdGV4dHVyZQoKICAgIAkJCQl1cmwgPSBzZXJpYWxpemVJbWFnZSggZGF0YSApOwoKICAgIAkJCX0KCiAgICAJCQlvdXRwdXQudXJsID0gdXJsOwoKICAgIAkJfQoKICAgIAkJaWYgKCAhIGlzUm9vdE9iamVjdCApIHsKCiAgICAJCQltZXRhLmltYWdlc1sgdGhpcy51dWlkIF0gPSBvdXRwdXQ7CgogICAgCQl9CgogICAgCQlyZXR1cm4gb3V0cHV0OwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZUltYWdlKCBpbWFnZSApIHsKCiAgICAJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAogICAgCQkoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCApIHx8CiAgICAJCSggdHlwZW9mIEltYWdlQml0bWFwICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEltYWdlQml0bWFwICkgKSB7CgogICAgCQkvLyBkZWZhdWx0IGltYWdlcwoKICAgIAkJcmV0dXJuIEltYWdlVXRpbHMuZ2V0RGF0YVVSTCggaW1hZ2UgKTsKCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggaW1hZ2UuZGF0YSApIHsKCiAgICAJCQkvLyBpbWFnZXMgb2YgRGF0YVRleHR1cmUKCiAgICAJCQlyZXR1cm4gewogICAgCQkJCWRhdGE6IEFycmF5LmZyb20oIGltYWdlLmRhdGEgKSwKICAgIAkJCQl3aWR0aDogaW1hZ2Uud2lkdGgsCiAgICAJCQkJaGVpZ2h0OiBpbWFnZS5oZWlnaHQsCiAgICAJCQkJdHlwZTogaW1hZ2UuZGF0YS5jb25zdHJ1Y3Rvci5uYW1lCiAgICAJCQl9OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5UZXh0dXJlOiBVbmFibGUgdG8gc2VyaWFsaXplIFRleHR1cmUuJyApOwogICAgCQkJcmV0dXJuIHt9OwoKICAgIAkJfQoKICAgIAl9CgogICAgfQoKICAgIGxldCBfdGV4dHVyZUlkID0gMDsKCiAgICBjb25zdCBfdGVtcFZlYzMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgLyoqCiAgICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgdGV4dHVyZXMuCiAgICAgKgogICAgICogTm90ZTogQWZ0ZXIgdGhlIGluaXRpYWwgdXNlIG9mIGEgdGV4dHVyZSwgaXRzIGRpbWVuc2lvbnMsIGZvcm1hdCwgYW5kIHR5cGUKICAgICAqIGNhbm5vdCBiZSBjaGFuZ2VkLiBJbnN0ZWFkLCBjYWxsIHtAbGluayBUZXh0dXJlI2Rpc3Bvc2V9IG9uIHRoZSB0ZXh0dXJlIGFuZCBpbnN0YW50aWF0ZSBhIG5ldyBvbmUuCiAgICAgKgogICAgICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgogICAgICovCiAgICBjbGFzcyBUZXh0dXJlIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHs/T2JqZWN0fSBbaW1hZ2U9VGV4dHVyZS5ERUZBVUxUX0lNQUdFXSAtIFRoZSBpbWFnZSBob2xkaW5nIHRoZSB0ZXh0dXJlIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPVRleHR1cmUuREVGQVVMVF9NQVBQSU5HXSAtIFRoZSB0ZXh0dXJlIG1hcHBpbmcuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwUz1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwUyB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBUPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBUIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFnRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWFnIGZpbHRlciB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21pbkZpbHRlcj1MaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXJdIC0gVGhlIG1pbiBmaWx0ZXIgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtmb3JtYXQ9UkdCQUZvcm1hdF0gLSBUaGUgdGV4dHVyZSBmb3JtYXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt0eXBlPVVuc2lnbmVkQnl0ZVR5cGVdIC0gVGhlIHRleHR1cmUgdHlwZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2FuaXNvdHJvcHk9VGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFldIC0gVGhlIGFuaXNvdHJvcHkgdmFsdWUuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPU5vQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGltYWdlID0gVGV4dHVyZS5ERUZBVUxUX0lNQUdFLCBtYXBwaW5nID0gVGV4dHVyZS5ERUZBVUxUX01BUFBJTkcsIHdyYXBTID0gQ2xhbXBUb0VkZ2VXcmFwcGluZywgd3JhcFQgPSBDbGFtcFRvRWRnZVdyYXBwaW5nLCBtYWdGaWx0ZXIgPSBMaW5lYXJGaWx0ZXIsIG1pbkZpbHRlciA9IExpbmVhck1pcG1hcExpbmVhckZpbHRlciwgZm9ybWF0ID0gUkdCQUZvcm1hdCwgdHlwZSA9IFVuc2lnbmVkQnl0ZVR5cGUsIGFuaXNvdHJvcHkgPSBUZXh0dXJlLkRFRkFVTFRfQU5JU09UUk9QWSwgY29sb3JTcGFjZSA9IE5vQ29sb3JTcGFjZSApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1RleHR1cmUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBJRCBvZiB0aGUgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQG5hbWUgVGV4dHVyZSNpZAogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX3RleHR1cmVJZCArKyB9ICk7CgogICAgCQkvKioKICAgIAkJICogVGhlIFVVSUQgb2YgdGhlIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBuYW1lIG9mIHRoZSBtYXRlcmlhbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMubmFtZSA9ICcnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkYXRhIGRlZmluaXRpb24gb2YgYSB0ZXh0dXJlLiBBIHJlZmVyZW5jZSB0byB0aGUgZGF0YSBzb3VyY2UgY2FuIGJlCiAgICAJCSAqIHNoYXJlZCBhY3Jvc3MgdGV4dHVyZXMuIFRoaXMgaXMgb2Z0ZW4gdXNlZnVsIGluIGNvbnRleHQgb2Ygc3ByaXRlc2hlZXRzCiAgICAJCSAqIHdoZXJlIG11bHRpcGxlIHRleHR1cmVzIHJlbmRlciB0aGUgc2FtZSBkYXRhIGJ1dCB3aXRoIGRpZmZlcmVudCB0ZXh0dXJlCiAgICAJCSAqIHRyYW5zZm9ybWF0aW9ucy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1NvdXJjZX0KICAgIAkJICovCiAgICAJCXRoaXMuc291cmNlID0gbmV3IFNvdXJjZSggaW1hZ2UgKTsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBhcnJheSBob2xkaW5nIHVzZXItZGVmaW5lZCBtaXBtYXBzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0Pn0KICAgIAkJICovCiAgICAJCXRoaXMubWlwbWFwcyA9IFtdOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyB0aGUgdGV4dHVyZSBpcyBhcHBsaWVkIHRvIHRoZSBvYmplY3QuIFRoZSB2YWx1ZSBgVVZNYXBwaW5nYAogICAgCQkgKiBpcyB0aGUgZGVmYXVsdCwgd2hlcmUgdGV4dHVyZSBvciB1diBjb29yZGluYXRlcyBhcmUgdXNlZCB0byBhcHBseSB0aGUgbWFwLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFVWTWFwcGluZ3xDdWJlUmVmbGVjdGlvbk1hcHBpbmd8Q3ViZVJlZnJhY3Rpb25NYXBwaW5nfEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nfEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nfEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nKX0KICAgIAkJICogQGRlZmF1bHQgVVZNYXBwaW5nCiAgICAJCSovCiAgICAJCXRoaXMubWFwcGluZyA9IG1hcHBpbmc7CgogICAgCQkvKioKICAgIAkJICogTGV0cyB5b3Ugc2VsZWN0IHRoZSB1diBhdHRyaWJ1dGUgdG8gbWFwIHRoZSB0ZXh0dXJlIHRvLiBgMGAgZm9yIGB1dmAsCiAgICAJCSAqIGAxYCBmb3IgYHV2MWAsIGAyYCBmb3IgYHV2MmAgYW5kIGAzYCBmb3IgYHV2M2AuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuY2hhbm5lbCA9IDA7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGhvcml6b250YWxseSBhbmQgY29ycmVzcG9uZHMgdG8KICAgIAkJICogKlUqIGluIFVWIG1hcHBpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoUmVwZWF0V3JhcHBpbmd8Q2xhbXBUb0VkZ2VXcmFwcGluZ3xNaXJyb3JlZFJlcGVhdFdyYXBwaW5nKX0KICAgIAkJICogQGRlZmF1bHQgQ2xhbXBUb0VkZ2VXcmFwcGluZwogICAgCQkgKi8KICAgIAkJdGhpcy53cmFwUyA9IHdyYXBTOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZGVmaW5lcyBob3cgdGhlIHRleHR1cmUgaXMgd3JhcHBlZCBob3Jpem9udGFsbHkgYW5kIGNvcnJlc3BvbmRzIHRvCiAgICAJCSAqICpWKiBpbiBVViBtYXBwaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CiAgICAJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKICAgIAkJICovCiAgICAJCXRoaXMud3JhcFQgPSB3cmFwVDsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgc2FtcGxlZCB3aGVuIGEgdGV4ZWwgY292ZXJzIG1vcmUgdGhhbiBvbmUgcGl4ZWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyfExpbmVhckZpbHRlcnxMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyfExpbmVhck1pcG1hcExpbmVhckZpbHRlcil9CiAgICAJCSAqIEBkZWZhdWx0IExpbmVhckZpbHRlcgogICAgCQkgKi8KICAgIAkJdGhpcy5tYWdGaWx0ZXIgPSBtYWdGaWx0ZXI7CgogICAgCQkvKioKICAgIAkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQogICAgCQkgKiBAZGVmYXVsdCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIKICAgIAkJICovCiAgICAJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBudW1iZXIgb2Ygc2FtcGxlcyB0YWtlbiBhbG9uZyB0aGUgYXhpcyB0aHJvdWdoIHRoZSBwaXhlbCB0aGF0IGhhcyB0aGUKICAgIAkJICogaGlnaGVzdCBkZW5zaXR5IG9mIHRleGVscy4gQnkgZGVmYXVsdCwgdGhpcyB2YWx1ZSBpcyBgMWAuIEEgaGlnaGVyIHZhbHVlCiAgICAJCSAqIGdpdmVzIGEgbGVzcyBibHVycnkgcmVzdWx0IHRoYW4gYSBiYXNpYyBtaXBtYXAsIGF0IHRoZSBjb3N0IG9mIG1vcmUKICAgIAkJICogdGV4dHVyZSBzYW1wbGVzIGJlaW5nIHVzZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuYW5pc290cm9weSA9IGFuaXNvdHJvcHk7CgogICAgCQkvKioKICAgIAkJICogVGhlIGZvcm1hdCBvZiB0aGUgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgUkdCQUZvcm1hdAogICAgCQkgKi8KICAgIAkJdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CgogICAgCQkvKioKICAgIAkJICogVGhlIGRlZmF1bHQgaW50ZXJuYWwgZm9ybWF0IGlzIGRlcml2ZWQgZnJvbSB7QGxpbmsgVGV4dHVyZSNmb3JtYXR9IGFuZCB7QGxpbmsgVGV4dHVyZSN0eXBlfSBhbmQKICAgIAkJICogZGVmaW5lcyBob3cgdGhlIHRleHR1cmUgZGF0YSBpcyBnb2luZyB0byBiZSBzdG9yZWQgb24gdGhlIEdQVS4KICAgIAkJICoKICAgIAkJICogVGhpcyBwcm9wZXJ0eSBhbGxvd3MgdG8gb3ZlcndyaXRlIHRoZSBkZWZhdWx0IGZvcm1hdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9zdHJpbmd9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuaW50ZXJuYWxGb3JtYXQgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkYXRhIHR5cGUgb2YgdGhlIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IFVuc2lnbmVkQnl0ZVR5cGUKICAgIAkJICovCiAgICAJCXRoaXMudHlwZSA9IHR5cGU7CgogICAgCQkvKioKICAgIAkJICogSG93IG11Y2ggYSBzaW5nbGUgcmVwZXRpdGlvbiBvZiB0aGUgdGV4dHVyZSBpcyBvZmZzZXQgZnJvbSB0aGUgYmVnaW5uaW5nLAogICAgCQkgKiBpbiBlYWNoIGRpcmVjdGlvbiBVIGFuZCBWLiBUeXBpY2FsIHJhbmdlIGlzIGAwLjBgIHRvIGAxLjBgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yMn0KICAgIAkJICogQGRlZmF1bHQgKDAsMCkKICAgIAkJICovCiAgICAJCXRoaXMub2Zmc2V0ID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgbWFueSB0aW1lcyB0aGUgdGV4dHVyZSBpcyByZXBlYXRlZCBhY3Jvc3MgdGhlIHN1cmZhY2UsIGluIGVhY2gKICAgIAkJICogZGlyZWN0aW9uIFUgYW5kIFYuIElmIHJlcGVhdCBpcyBzZXQgZ3JlYXRlciB0aGFuIGAxYCBpbiBlaXRoZXIgZGlyZWN0aW9uLAogICAgCQkgKiB0aGUgY29ycmVzcG9uZGluZyB3cmFwIHBhcmFtZXRlciBzaG91bGQgYWxzbyBiZSBzZXQgdG8gYFJlcGVhdFdyYXBwaW5nYAogICAgCQkgKiBvciBgTWlycm9yZWRSZXBlYXRXcmFwcGluZ2AgdG8gYWNoaWV2ZSB0aGUgZGVzaXJlZCB0aWxpbmcgZWZmZWN0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yMn0KICAgIAkJICogQGRlZmF1bHQgKDEsMSkKICAgIAkJICovCiAgICAJCXRoaXMucmVwZWF0ID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgcG9pbnQgYXJvdW5kIHdoaWNoIHJvdGF0aW9uIG9jY3Vycy4gQSB2YWx1ZSBvZiBgKDAuNSwgMC41KWAgY29ycmVzcG9uZHMKICAgIAkJICogdG8gdGhlIGNlbnRlciBvZiB0aGUgdGV4dHVyZS4gRGVmYXVsdCBpcyBgKDAsIDApYCwgdGhlIGxvd2VyIGxlZnQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtWZWN0b3IyfQogICAgCQkgKiBAZGVmYXVsdCAoMCwwKQogICAgCQkgKi8KICAgIAkJdGhpcy5jZW50ZXIgPSBuZXcgVmVjdG9yMiggMCwgMCApOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyBtdWNoIHRoZSB0ZXh0dXJlIGlzIHJvdGF0ZWQgYXJvdW5kIHRoZSBjZW50ZXIgcG9pbnQsIGluIHJhZGlhbnMuCiAgICAJCSAqIFBvc2l0aXZlIHZhbHVlcyBhcmUgY291bnRlci1jbG9ja3dpc2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMucm90YXRpb24gPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gdXBkYXRlIHRoZSB0ZXh0dXJlJ3MgdXYtdHJhbnNmb3JtYXRpb24ge0BsaW5rIFRleHR1cmUjbWF0cml4fQogICAgCQkgKiBmcm9tIHRoZSBwcm9wZXJ0aWVzIHtAbGluayBUZXh0dXJlI29mZnNldH0sIHtAbGluayBUZXh0dXJlI3JlcGVhdH0sCiAgICAJCSAqIHtAbGluayBUZXh0dXJlI3JvdGF0aW9ufSwgYW5kIHtAbGluayBUZXh0dXJlI2NlbnRlcn0uCiAgICAJCSAqCiAgICAJCSAqIFNldCB0aGlzIHRvIGBmYWxzZWAgaWYgeW91IGFyZSBzcGVjaWZ5aW5nIHRoZSB1di10cmFuc2Zvcm0gbWF0cml4IGRpcmVjdGx5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgdXYtdHJhbnNmb3JtYXRpb24gbWF0cml4IG9mIHRoZSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TWF0cml4M30KICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4ID0gbmV3IE1hdHJpeDMoKTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIG1pcG1hcHMgKGlmIHBvc3NpYmxlKSBmb3IgYSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBTZXQgdGhpcyB0byBgZmFsc2VgIGlmIHlvdSBhcmUgY3JlYXRpbmcgbWlwbWFwcyBtYW51YWxseS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgYWxwaGEgY2hhbm5lbCwgaWYgcHJlc2VudCwgaXMgbXVsdGlwbGllZCBpbnRvIHRoZQogICAgCQkgKiBjb2xvciBjaGFubmVscyB3aGVuIHRoZSB0ZXh0dXJlIGlzIHVwbG9hZGVkIHRvIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIE5vdGUgdGhhdCB0aGlzIHByb3BlcnR5IGhhcyBubyBlZmZlY3Qgd2hlbiB1c2luZyBgSW1hZ2VCaXRtYXBgLiBZb3UgbmVlZCB0bwogICAgCQkgKiBjb25maWd1cmUgcHJlbXVsdGlwbHkgYWxwaGEgb24gYml0bWFwIGNyZWF0aW9uIGluc3RlYWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5wcmVtdWx0aXBseUFscGhhID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCiAgICAJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIE5vdGUgdGhhdCB0aGlzIHByb3BlcnR5IGhhcyBubyBlZmZlY3Qgd2hlbiB1c2luZyBgSW1hZ2VCaXRtYXBgLiBZb3UgbmVlZCB0bwogICAgCQkgKiBjb25maWd1cmUgdGhlIGZsaXAgb24gYml0bWFwIGNyZWF0aW9uIGluc3RlYWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmZsaXBZID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCiAgICAJCSAqIFRoZSBhbGxvd2FibGUgdmFsdWVzIGFyZSBgMWAgKGJ5dGUtYWxpZ25tZW50KSwgYDJgIChyb3dzIGFsaWduZWQgdG8gZXZlbi1udW1iZXJlZCBieXRlcyksCiAgICAJCSAqIGA0YCAod29yZC1hbGlnbm1lbnQpLCBhbmQgYDhgIChyb3dzIHN0YXJ0IG9uIGRvdWJsZS13b3JkIGJvdW5kYXJpZXMpLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCA0CiAgICAJCSAqLwogICAgCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDQ7CS8vIHZhbGlkIHZhbHVlczogMSwgMiwgNCwgOCAoc2VlIGh0dHA6Ly93d3cua2hyb25vcy5vcmcvb3BlbmdsZXMvc2RrL2RvY3MvbWFuL3hodG1sL2dsUGl4ZWxTdG9yZWkueG1sKQoKICAgIAkJLyoqCiAgICAJCSAqIFRleHR1cmVzIGNvbnRhaW5pbmcgY29sb3IgZGF0YSBzaG91bGQgYmUgYW5ub3RhdGVkIHdpdGggYFNSR0JDb2xvclNwYWNlYCBvciBgTGluZWFyU1JHQkNvbG9yU3BhY2VgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAZGVmYXVsdCBOb0NvbG9yU3BhY2UKICAgIAkJICovCiAgICAJCXRoaXMuY29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgogICAgCQkvKioKICAgIAkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIHRleHR1cmUuIEl0CiAgICAJCSAqIHNob3VsZCBub3QgaG9sZCByZWZlcmVuY2VzIHRvIGZ1bmN0aW9ucyBhcyB0aGVzZSB3aWxsIG5vdCBiZSBjbG9uZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLnVzZXJEYXRhID0ge307CgogICAgCQkvKioKICAgIAkJICogVGhpcyBjYW4gYmUgdXNlZCB0byBvbmx5IHVwZGF0ZSBhIHN1YnJlZ2lvbiBvciBzcGVjaWZpYyByb3dzIG9mIHRoZSB0ZXh0dXJlIChmb3IgZXhhbXBsZSwganVzdCB0aGUKICAgIAkJICogZmlyc3QgMyByb3dzKS4gVXNlIHRoZSBgYWRkVXBkYXRlUmFuZ2UoKWAgZnVuY3Rpb24gdG8gYWRkIHJhbmdlcyB0byB0aGlzIGFycmF5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0Pn0KICAgIAkJICovCiAgICAJCXRoaXMudXBkYXRlUmFuZ2VzID0gW107CgogICAgCQkvKioKICAgIAkJICogVGhpcyBzdGFydHMgYXQgYDBgIGFuZCBjb3VudHMgaG93IG1hbnkgdGltZXMge0BsaW5rIFRleHR1cmUjbmVlZHNVcGRhdGV9IGlzIHNldCB0byBgdHJ1ZWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnZlcnNpb24gPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgY2FsbGJhY2sgZnVuY3Rpb24sIGNhbGxlZCB3aGVuIHRoZSB0ZXh0dXJlIGlzIHVwZGF0ZWQgKGUuZy4sIHdoZW4KICAgIAkJICoge0BsaW5rIFRleHR1cmUjbmVlZHNVcGRhdGV9IGhhcyBiZWVuIHNldCB0byB0cnVlIGFuZCB0aGVuIHRoZSB0ZXh0dXJlIGlzIHVzZWQpLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P0Z1bmN0aW9ufQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLm9uVXBkYXRlID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBvcHRpb25hbCBiYWNrIHJlZmVyZW5jZSB0byB0aGUgdGV4dHVyZXMgcmVuZGVyIHRhcmdldC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oUmVuZGVyVGFyZ2V0fFdlYkdMUmVuZGVyVGFyZ2V0KX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5yZW5kZXJUYXJnZXQgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEluZGljYXRlcyB3aGV0aGVyIGEgdGV4dHVyZSBiZWxvbmdzIHRvIGEgcmVuZGVyIHRhcmdldCBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogSW5kaWNhdGVzIGlmIGEgdGV4dHVyZSBzaG91bGQgYmUgaGFuZGxlZCBsaWtlIGEgdGV4dHVyZSBhcnJheS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0FycmF5VGV4dHVyZSA9IGltYWdlICYmIGltYWdlLmRlcHRoICYmIGltYWdlLmRlcHRoID4gMSA/IHRydWUgOiBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGlzIHRleHR1cmUgc2hvdWxkIGJlIHByb2Nlc3NlZCBieSBgUE1SRU1HZW5lcmF0b3JgIG9yIG5vdAogICAgCQkgKiAob25seSByZWxldmFudCBmb3IgcmVuZGVyIHRhcmdldCB0ZXh0dXJlcykuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnBtcmVtVmVyc2lvbiA9IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlIGluIHBpeGVscy4KICAgIAkgKi8KICAgIAlnZXQgd2lkdGgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zb3VyY2UuZ2V0U2l6ZSggX3RlbXBWZWMzICkueDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgaGVpZ2h0IG9mIHRoZSB0ZXh0dXJlIGluIHBpeGVscy4KICAgIAkgKi8KICAgIAlnZXQgaGVpZ2h0KCkgewoKICAgIAkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLnk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlIGluIHBpeGVscy4KICAgIAkgKi8KICAgIAlnZXQgZGVwdGgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zb3VyY2UuZ2V0U2l6ZSggX3RlbXBWZWMzICkuejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgaW1hZ2Ugb2JqZWN0IGhvbGRpbmcgdGhlIHRleHR1cmUgZGF0YS4KICAgIAkgKgogICAgCSAqIEB0eXBlIHs/T2JqZWN0fQogICAgCSAqLwogICAgCWdldCBpbWFnZSgpIHsKCiAgICAJCXJldHVybiB0aGlzLnNvdXJjZS5kYXRhOwoKICAgIAl9CgogICAgCXNldCBpbWFnZSggdmFsdWUgPSBudWxsICkgewoKICAgIAkJdGhpcy5zb3VyY2UuZGF0YSA9IHZhbHVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFVwZGF0ZXMgdGhlIHRleHR1cmUgdHJhbnNmb3JtYXRpb24gbWF0cml4IGZyb20gdGhlIGZyb20gdGhlIHByb3BlcnRpZXMge0BsaW5rIFRleHR1cmUjb2Zmc2V0fSwKICAgIAkgKiB7QGxpbmsgVGV4dHVyZSNyZXBlYXR9LCB7QGxpbmsgVGV4dHVyZSNyb3RhdGlvbn0sIGFuZCB7QGxpbmsgVGV4dHVyZSNjZW50ZXJ9LgogICAgCSAqLwogICAgCXVwZGF0ZU1hdHJpeCgpIHsKCiAgICAJCXRoaXMubWF0cml4LnNldFV2VHJhbnNmb3JtKCB0aGlzLm9mZnNldC54LCB0aGlzLm9mZnNldC55LCB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55LCB0aGlzLnJvdGF0aW9uLCB0aGlzLmNlbnRlci54LCB0aGlzLmNlbnRlci55ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyBhIHJhbmdlIG9mIGRhdGEgaW4gdGhlIGRhdGEgdGV4dHVyZSB0byBiZSB1cGRhdGVkIG9uIHRoZSBHUFUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgLSBQb3NpdGlvbiBhdCB3aGljaCB0byBzdGFydCB1cGRhdGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IC0gVGhlIG51bWJlciBvZiBjb21wb25lbnRzIHRvIHVwZGF0ZS4KICAgIAkgKi8KICAgIAlhZGRVcGRhdGVSYW5nZSggc3RhcnQsIGNvdW50ICkgewoKICAgIAkJdGhpcy51cGRhdGVSYW5nZXMucHVzaCggeyBzdGFydCwgY291bnQgfSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENsZWFycyB0aGUgdXBkYXRlIHJhbmdlcy4KICAgIAkgKi8KICAgIAljbGVhclVwZGF0ZVJhbmdlcygpIHsKCiAgICAJCXRoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aCA9IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyB0ZXh0dXJlIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtUZXh0dXJlfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIHRleHR1cmUgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VGV4dHVyZX0gc291cmNlIC0gVGhlIHRleHR1cmUgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtUZXh0dXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKICAgIAkJdGhpcy5zb3VyY2UgPSBzb3VyY2Uuc291cmNlOwogICAgCQl0aGlzLm1pcG1hcHMgPSBzb3VyY2UubWlwbWFwcy5zbGljZSggMCApOwoKICAgIAkJdGhpcy5tYXBwaW5nID0gc291cmNlLm1hcHBpbmc7CiAgICAJCXRoaXMuY2hhbm5lbCA9IHNvdXJjZS5jaGFubmVsOwoKICAgIAkJdGhpcy53cmFwUyA9IHNvdXJjZS53cmFwUzsKICAgIAkJdGhpcy53cmFwVCA9IHNvdXJjZS53cmFwVDsKCiAgICAJCXRoaXMubWFnRmlsdGVyID0gc291cmNlLm1hZ0ZpbHRlcjsKICAgIAkJdGhpcy5taW5GaWx0ZXIgPSBzb3VyY2UubWluRmlsdGVyOwoKICAgIAkJdGhpcy5hbmlzb3Ryb3B5ID0gc291cmNlLmFuaXNvdHJvcHk7CgogICAgCQl0aGlzLmZvcm1hdCA9IHNvdXJjZS5mb3JtYXQ7CiAgICAJCXRoaXMuaW50ZXJuYWxGb3JtYXQgPSBzb3VyY2UuaW50ZXJuYWxGb3JtYXQ7CiAgICAJCXRoaXMudHlwZSA9IHNvdXJjZS50eXBlOwoKICAgIAkJdGhpcy5vZmZzZXQuY29weSggc291cmNlLm9mZnNldCApOwogICAgCQl0aGlzLnJlcGVhdC5jb3B5KCBzb3VyY2UucmVwZWF0ICk7CiAgICAJCXRoaXMuY2VudGVyLmNvcHkoIHNvdXJjZS5jZW50ZXIgKTsKICAgIAkJdGhpcy5yb3RhdGlvbiA9IHNvdXJjZS5yb3RhdGlvbjsKCiAgICAJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhBdXRvVXBkYXRlOwogICAgCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CgogICAgCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHNvdXJjZS5nZW5lcmF0ZU1pcG1hcHM7CiAgICAJCXRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBseUFscGhhOwogICAgCQl0aGlzLmZsaXBZID0gc291cmNlLmZsaXBZOwogICAgCQl0aGlzLnVucGFja0FsaWdubWVudCA9IHNvdXJjZS51bnBhY2tBbGlnbm1lbnQ7CiAgICAJCXRoaXMuY29sb3JTcGFjZSA9IHNvdXJjZS5jb2xvclNwYWNlOwoKICAgIAkJdGhpcy5yZW5kZXJUYXJnZXQgPSBzb3VyY2UucmVuZGVyVGFyZ2V0OwogICAgCQl0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IHNvdXJjZS5pc1JlbmRlclRhcmdldFRleHR1cmU7CiAgICAJCXRoaXMuaXNBcnJheVRleHR1cmUgPSBzb3VyY2UuaXNBcnJheVRleHR1cmU7CgogICAgCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgogICAgCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyB0ZXh0dXJlJ3MgcHJvcGVydGllcyBiYXNlZCBvbiBgdmFsdWVzYC4KICAgIAkgKiBAcGFyYW0ge09iamVjdH0gdmFsdWVzIC0gQSBjb250YWluZXIgd2l0aCB0ZXh0dXJlIHBhcmFtZXRlcnMuCiAgICAJICovCiAgICAJc2V0VmFsdWVzKCB2YWx1ZXMgKSB7CgogICAgCQlmb3IgKCBjb25zdCBrZXkgaW4gdmFsdWVzICkgewoKICAgIAkJCWNvbnN0IG5ld1ZhbHVlID0gdmFsdWVzWyBrZXkgXTsKCiAgICAJCQlpZiAoIG5ld1ZhbHVlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLlRleHR1cmUuc2V0VmFsdWVzKCk6IHBhcmFtZXRlciAnJHsga2V5IH0nIGhhcyB2YWx1ZSBvZiB1bmRlZmluZWQuYCApOwogICAgCQkJCWNvbnRpbnVlOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCBjdXJyZW50VmFsdWUgPSB0aGlzWyBrZXkgXTsKCiAgICAJCQlpZiAoIGN1cnJlbnRWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5UZXh0dXJlLnNldFZhbHVlcygpOiBwcm9wZXJ0eSAnJHsga2V5IH0nIGRvZXMgbm90IGV4aXN0LmAgKTsKICAgIAkJCQljb250aW51ZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCAoIGN1cnJlbnRWYWx1ZSAmJiBuZXdWYWx1ZSApICYmICggY3VycmVudFZhbHVlLmlzVmVjdG9yMiAmJiBuZXdWYWx1ZS5pc1ZlY3RvcjIgKSApIHsKCiAgICAJCQkJY3VycmVudFZhbHVlLmNvcHkoIG5ld1ZhbHVlICk7CgogICAgCQkJfSBlbHNlIGlmICggKCBjdXJyZW50VmFsdWUgJiYgbmV3VmFsdWUgKSAmJiAoIGN1cnJlbnRWYWx1ZS5pc1ZlY3RvcjMgJiYgbmV3VmFsdWUuaXNWZWN0b3IzICkgKSB7CgogICAgCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKICAgIAkJCX0gZWxzZSBpZiAoICggY3VycmVudFZhbHVlICYmIG5ld1ZhbHVlICkgJiYgKCBjdXJyZW50VmFsdWUuaXNNYXRyaXgzICYmIG5ld1ZhbHVlLmlzTWF0cml4MyApICkgewoKICAgIAkJCQljdXJyZW50VmFsdWUuY29weSggbmV3VmFsdWUgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl0aGlzWyBrZXkgXSA9IG5ld1ZhbHVlOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXJpYWxpemVzIHRoZSB0ZXh0dXJlIGludG8gSlNPTi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIHRleHR1cmUuCiAgICAJICogQHNlZSB7QGxpbmsgT2JqZWN0TG9hZGVyI3BhcnNlfQogICAgCSAqLwogICAgCXRvSlNPTiggbWV0YSApIHsKCiAgICAJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKICAgIAkJaWYgKCAhIGlzUm9vdE9iamVjdCAmJiBtZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXJldHVybiBtZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IG91dHB1dCA9IHsKCiAgICAJCQltZXRhZGF0YTogewogICAgCQkJCXZlcnNpb246IDQuNywKICAgIAkJCQl0eXBlOiAnVGV4dHVyZScsCiAgICAJCQkJZ2VuZXJhdG9yOiAnVGV4dHVyZS50b0pTT04nCiAgICAJCQl9LAoKICAgIAkJCXV1aWQ6IHRoaXMudXVpZCwKICAgIAkJCW5hbWU6IHRoaXMubmFtZSwKCiAgICAJCQlpbWFnZTogdGhpcy5zb3VyY2UudG9KU09OKCBtZXRhICkudXVpZCwKCiAgICAJCQltYXBwaW5nOiB0aGlzLm1hcHBpbmcsCiAgICAJCQljaGFubmVsOiB0aGlzLmNoYW5uZWwsCgogICAgCQkJcmVwZWF0OiBbIHRoaXMucmVwZWF0LngsIHRoaXMucmVwZWF0LnkgXSwKICAgIAkJCW9mZnNldDogWyB0aGlzLm9mZnNldC54LCB0aGlzLm9mZnNldC55IF0sCiAgICAJCQljZW50ZXI6IFsgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSBdLAogICAgCQkJcm90YXRpb246IHRoaXMucm90YXRpb24sCgogICAgCQkJd3JhcDogWyB0aGlzLndyYXBTLCB0aGlzLndyYXBUIF0sCgogICAgCQkJZm9ybWF0OiB0aGlzLmZvcm1hdCwKICAgIAkJCWludGVybmFsRm9ybWF0OiB0aGlzLmludGVybmFsRm9ybWF0LAogICAgCQkJdHlwZTogdGhpcy50eXBlLAogICAgCQkJY29sb3JTcGFjZTogdGhpcy5jb2xvclNwYWNlLAoKICAgIAkJCW1pbkZpbHRlcjogdGhpcy5taW5GaWx0ZXIsCiAgICAJCQltYWdGaWx0ZXI6IHRoaXMubWFnRmlsdGVyLAogICAgCQkJYW5pc290cm9weTogdGhpcy5hbmlzb3Ryb3B5LAoKICAgIAkJCWZsaXBZOiB0aGlzLmZsaXBZLAoKICAgIAkJCWdlbmVyYXRlTWlwbWFwczogdGhpcy5nZW5lcmF0ZU1pcG1hcHMsCiAgICAJCQlwcmVtdWx0aXBseUFscGhhOiB0aGlzLnByZW11bHRpcGx5QWxwaGEsCiAgICAJCQl1bnBhY2tBbGlnbm1lbnQ6IHRoaXMudW5wYWNrQWxpZ25tZW50CgogICAgCQl9OwoKICAgIAkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBvdXRwdXQudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKICAgIAkJaWYgKCAhIGlzUm9vdE9iamVjdCApIHsKCiAgICAJCQltZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXSA9IG91dHB1dDsKCiAgICAJCX0KCiAgICAJCXJldHVybiBvdXRwdXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRnJlZXMgdGhlIEdQVS1yZWxhdGVkIHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzCiAgICAJICogbWV0aG9kIHdoZW5ldmVyIHRoaXMgaW5zdGFuY2UgaXMgbm8gbG9uZ2VyIHVzZWQgaW4geW91ciBhcHAuCiAgICAJICoKICAgIAkgKiBAZmlyZXMgVGV4dHVyZSNkaXNwb3NlCiAgICAJICovCiAgICAJZGlzcG9zZSgpIHsKCiAgICAJCS8qKgogICAgCQkgKiBGaXJlcyB3aGVuIHRoZSB0ZXh0dXJlIGhhcyBiZWVuIGRpc3Bvc2VkIG9mLgogICAgCQkgKgogICAgCQkgKiBAZXZlbnQgVGV4dHVyZSNkaXNwb3NlCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2Zvcm1zIHRoZSBnaXZlbiB1diB2ZWN0b3Igd2l0aCB0aGUgdGV4dHVyZXMgdXYgdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IyfSB1diAtIFRoZSB1diB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIHRyYW5zZm9ybWVkIHV2IHZlY3Rvci4KICAgIAkgKi8KICAgIAl0cmFuc2Zvcm1VdiggdXYgKSB7CgogICAgCQlpZiAoIHRoaXMubWFwcGluZyAhPT0gVVZNYXBwaW5nICkgcmV0dXJuIHV2OwoKICAgIAkJdXYuYXBwbHlNYXRyaXgzKCB0aGlzLm1hdHJpeCApOwoKICAgIAkJaWYgKCB1di54IDwgMCB8fCB1di54ID4gMSApIHsKCiAgICAJCQlzd2l0Y2ggKCB0aGlzLndyYXBTICkgewoKICAgIAkJCQljYXNlIFJlcGVhdFdyYXBwaW5nOgoKICAgIAkJCQkJdXYueCA9IHV2LnggLSBNYXRoLmZsb29yKCB1di54ICk7CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlIENsYW1wVG9FZGdlV3JhcHBpbmc6CgogICAgCQkJCQl1di54ID0gdXYueCA8IDAgPyAwIDogMTsKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJCWNhc2UgTWlycm9yZWRSZXBlYXRXcmFwcGluZzoKCiAgICAJCQkJCWlmICggTWF0aC5hYnMoIE1hdGguZmxvb3IoIHV2LnggKSAlIDIgKSA9PT0gMSApIHsKCiAgICAJCQkJCQl1di54ID0gTWF0aC5jZWlsKCB1di54ICkgLSB1di54OwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQl1di54ID0gdXYueCAtIE1hdGguZmxvb3IoIHV2LnggKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggdXYueSA8IDAgfHwgdXYueSA+IDEgKSB7CgogICAgCQkJc3dpdGNoICggdGhpcy53cmFwVCApIHsKCiAgICAJCQkJY2FzZSBSZXBlYXRXcmFwcGluZzoKCiAgICAJCQkJCXV2LnkgPSB1di55IC0gTWF0aC5mbG9vciggdXYueSApOwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSBDbGFtcFRvRWRnZVdyYXBwaW5nOgoKICAgIAkJCQkJdXYueSA9IHV2LnkgPCAwID8gMCA6IDE7CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6CgogICAgCQkJCQlpZiAoIE1hdGguYWJzKCBNYXRoLmZsb29yKCB1di55ICkgJSAyICkgPT09IDEgKSB7CgogICAgCQkJCQkJdXYueSA9IE1hdGguY2VpbCggdXYueSApIC0gdXYueTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJdXYueSA9IHV2LnkgLSBNYXRoLmZsb29yKCB1di55ICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlicmVhazsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuZmxpcFkgKSB7CgogICAgCQkJdXYueSA9IDEgLSB1di55OwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHV2OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHRpbmcgdGhpcyBwcm9wZXJ0eSB0byBgdHJ1ZWAgaW5kaWNhdGVzIHRoZSBlbmdpbmUgdGhlIHRleHR1cmUKICAgIAkgKiBtdXN0IGJlIHVwZGF0ZWQgaW4gdGhlIG5leHQgcmVuZGVyLiBUaGlzIHRyaWdnZXJzIGEgdGV4dHVyZSB1cGxvYWQKICAgIAkgKiB0byB0aGUgR1BVIGFuZCBlbnN1cmVzIGNvcnJlY3QgdGV4dHVyZSBwYXJhbWV0ZXIgY29uZmlndXJhdGlvbi4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtib29sZWFufQogICAgCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQogICAgCSAqLwogICAgCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgogICAgCQlpZiAoIHZhbHVlID09PSB0cnVlICkgewoKICAgIAkJCXRoaXMudmVyc2lvbiArKzsKICAgIAkJCXRoaXMuc291cmNlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXR0aW5nIHRoaXMgcHJvcGVydHkgdG8gYHRydWVgIGluZGljYXRlcyB0aGUgZW5naW5lIHRoZSBQTVJFTQogICAgCSAqIG11c3QgYmUgcmVnZW5lcmF0ZWQuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkgKiBAZGVmYXVsdCBmYWxzZQogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICAgIAkgKi8KICAgIAlzZXQgbmVlZHNQTVJFTVVwZGF0ZSggdmFsdWUgKSB7CgogICAgCQlpZiAoIHZhbHVlID09PSB0cnVlICkgewoKICAgIAkJCXRoaXMucG1yZW1WZXJzaW9uICsrOwoKICAgIAkJfQoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgaW1hZ2UgZm9yIGFsbCB0ZXh0dXJlcy4KICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAdHlwZSB7P0ltYWdlfQogICAgICogQGRlZmF1bHQgbnVsbAogICAgICovCiAgICBUZXh0dXJlLkRFRkFVTFRfSU1BR0UgPSBudWxsOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbWFwcGluZyBmb3IgYWxsIHRleHR1cmVzLgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtudW1iZXJ9CiAgICAgKiBAZGVmYXVsdCBVVk1hcHBpbmcKICAgICAqLwogICAgVGV4dHVyZS5ERUZBVUxUX01BUFBJTkcgPSBVVk1hcHBpbmc7CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBhbmlzb3Ryb3B5IHZhbHVlIGZvciBhbGwgdGV4dHVyZXMuCiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQHR5cGUge251bWJlcn0KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwogICAgVGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFkgPSAxOwoKICAgIC8qKgogICAgICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgNEQgdmVjdG9yLiBBIDREIHZlY3RvciBpcyBhbiBvcmRlcmVkIHF1YWRydXBsZXQgb2YgbnVtYmVycwogICAgICogKGxhYmVsZWQgeCwgeSwgeiBhbmQgdyksIHdoaWNoIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCBhIG51bWJlciBvZiB0aGluZ3MsIHN1Y2ggYXM6CiAgICAgKgogICAgICogLSBBIHBvaW50IGluIDREIHNwYWNlLgogICAgICogLSBBIGRpcmVjdGlvbiBhbmQgbGVuZ3RoIGluIDREIHNwYWNlLiBJbiB0aHJlZS5qcyB0aGUgbGVuZ3RoIHdpbGwKICAgICAqIGFsd2F5cyBiZSB0aGUgRXVjbGlkZWFuIGRpc3RhbmNlKHN0cmFpZ2h0LWxpbmUgZGlzdGFuY2UpIGZyb20gYCgwLCAwLCAwLCAwKWAgdG8gYCh4LCB5LCB6LCB3KWAKICAgICAqIGFuZCB0aGUgZGlyZWN0aW9uIGlzIGFsc28gbWVhc3VyZWQgZnJvbSBgKDAsIDAsIDAsIDApYCB0b3dhcmRzIGAoeCwgeSwgeiwgdylgLgogICAgICogLSBBbnkgYXJiaXRyYXJ5IG9yZGVyZWQgcXVhZHJ1cGxldCBvZiBudW1iZXJzLgogICAgICoKICAgICAqIFRoZXJlIGFyZSBvdGhlciB0aGluZ3MgYSA0RCB2ZWN0b3IgY2FuIGJlIHVzZWQgdG8gcmVwcmVzZW50LCBob3dldmVyIHRoZXNlCiAgICAgKiBhcmUgdGhlIG1vc3QgY29tbW9uIHVzZXMgaW4gKnRocmVlLmpzKi4KICAgICAqCiAgICAgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeiwgdylgIGluCiAgICAgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBhID0gbmV3IFRIUkVFLlZlY3RvcjQoIDAsIDEsIDAsIDAgKTsKICAgICAqCiAgICAgKiAvL25vIGFyZ3VtZW50czsgd2lsbCBiZSBpbml0aWFsaXNlZCB0byAoMCwgMCwgMCwgMSkKICAgICAqIGNvbnN0IGIgPSBuZXcgVEhSRUUuVmVjdG9yNCggKTsKICAgICAqCiAgICAgKiBjb25zdCBkID0gYS5kb3QoIGIgKTsKICAgICAqIGBgYAogICAgICovCiAgICBjbGFzcyBWZWN0b3I0IHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyA0RCB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3g9MF0gLSBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3o9MF0gLSBUaGUgeiB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3c9MV0gLSBUaGUgdyB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCwgdyA9IDEgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJVmVjdG9yNC5wcm90b3R5cGUuaXNWZWN0b3I0ID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMueCA9IHg7CgogICAgCQkvKioKICAgIAkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLnkgPSB5OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB6IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy56ID0gejsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgdyB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMudyA9IHc7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3I0I3p9LgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKi8KICAgIAlnZXQgd2lkdGgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy56OwoKICAgIAl9CgogICAgCXNldCB3aWR0aCggdmFsdWUgKSB7CgogICAgCQl0aGlzLnogPSB2YWx1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBbGlhcyBmb3Ige0BsaW5rIFZlY3RvcjQjd30uCiAgICAJICoKICAgIAkgKiBAdHlwZSB7bnVtYmVyfQogICAgCSAqLwogICAgCWdldCBoZWlnaHQoKSB7CgogICAgCQlyZXR1cm4gdGhpcy53OwoKICAgIAl9CgogICAgCXNldCBoZWlnaHQoIHZhbHVlICkgewoKICAgIAkJdGhpcy53ID0gdmFsdWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSBvZiB0aGUgeCBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgb2YgdGhlIHkgY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIG9mIHRoZSB6IGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdyAtIFRoZSB2YWx1ZSBvZiB0aGUgdyBjb21wb25lbnQuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0KCB4LCB5LCB6LCB3ICkgewoKICAgIAkJdGhpcy54ID0geDsKICAgIAkJdGhpcy55ID0geTsKICAgIAkJdGhpcy56ID0gejsKICAgIAkJdGhpcy53ID0gdzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBzYW1lIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSB2YWx1ZSB0byBzZXQgZm9yIGFsbCB2ZWN0b3IgY29tcG9uZW50cy4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRTY2FsYXIoIHNjYWxhciApIHsKCiAgICAJCXRoaXMueCA9IHNjYWxhcjsKICAgIAkJdGhpcy55ID0gc2NhbGFyOwogICAgCQl0aGlzLnogPSBzY2FsYXI7CiAgICAJCXRoaXMudyA9IHNjYWxhcjsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHggY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFgoIHggKSB7CgogICAgCQl0aGlzLnggPSB4OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yJ3MgeSBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0WSggeSApIHsKCiAgICAJCXRoaXMueSA9IHk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2ZWN0b3IncyB6IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRaKCB6ICkgewoKICAgIAkJdGhpcy56ID0gejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHZlY3RvcidzIHcgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldFcoIHcgKSB7CgogICAgCQl0aGlzLncgPSB3OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWxsb3dzIHRvIHNldCBhIHZlY3RvciBjb21wb25lbnQgd2l0aCBhbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LAogICAgCSAqIGAyYCBlcXVhbHMgdG8geiwgYDNgIGVxdWFscyB0byB3LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgogICAgCQlzd2l0Y2ggKCBpbmRleCApIHsKCiAgICAJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKICAgIAkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwogICAgCQkJY2FzZSAyOiB0aGlzLnogPSB2YWx1ZTsgYnJlYWs7CiAgICAJCQljYXNlIDM6IHRoaXMudyA9IHZhbHVlOyBicmVhazsKICAgIAkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgdmVjdG9yIGNvbXBvbmVudCB3aGljaCBtYXRjaGVzIHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LAogICAgCSAqIGAyYCBlcXVhbHMgdG8geiwgYDNgIGVxdWFscyB0byB3LgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gQSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlLgogICAgCSAqLwogICAgCWdldENvbXBvbmVudCggaW5kZXggKSB7CgogICAgCQlzd2l0Y2ggKCBpbmRleCApIHsKCiAgICAJCQljYXNlIDA6IHJldHVybiB0aGlzLng7CiAgICAJCQljYXNlIDE6IHJldHVybiB0aGlzLnk7CiAgICAJCQljYXNlIDI6IHJldHVybiB0aGlzLno7CiAgICAJCQljYXNlIDM6IHJldHVybiB0aGlzLnc7CiAgICAJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgdmVjdG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMudyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM3xWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNvcHkoIHYgKSB7CgogICAgCQl0aGlzLnggPSB2Lng7CiAgICAJCXRoaXMueSA9IHYueTsKICAgIAkJdGhpcy56ID0gdi56OwogICAgCQl0aGlzLncgPSAoIHYudyAhPT0gdW5kZWZpbmVkICkgPyB2LncgOiAxOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGFkZC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlhZGQoIHYgKSB7CgogICAgCQl0aGlzLnggKz0gdi54OwogICAgCQl0aGlzLnkgKz0gdi55OwogICAgCQl0aGlzLnogKz0gdi56OwogICAgCQl0aGlzLncgKz0gdi53OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFNjYWxhciggcyApIHsKCiAgICAJCXRoaXMueCArPSBzOwogICAgCQl0aGlzLnkgKz0gczsKICAgIAkJdGhpcy56ICs9IHM7CiAgICAJCXRoaXMudyArPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYWRkVmVjdG9ycyggYSwgYiApIHsKCiAgICAJCXRoaXMueCA9IGEueCArIGIueDsKICAgIAkJdGhpcy55ID0gYS55ICsgYi55OwogICAgCQl0aGlzLnogPSBhLnogKyBiLno7CiAgICAJCXRoaXMudyA9IGEudyArIGIudzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciBzY2FsZWQgYnkgdGhlIGdpdmVuIGZhY3RvciB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBmYWN0b3IgdGhhdCBzY2FsZXMgYHZgLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCiAgICAJCXRoaXMueCArPSB2LnggKiBzOwogICAgCQl0aGlzLnkgKz0gdi55ICogczsKICAgIAkJdGhpcy56ICs9IHYueiAqIHM7CiAgICAJCXRoaXMudyArPSB2LncgKiBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiB2ZWN0b3IgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBzdWJ0cmFjdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzdWIoIHYgKSB7CgogICAgCQl0aGlzLnggLT0gdi54OwogICAgCQl0aGlzLnkgLT0gdi55OwogICAgCQl0aGlzLnogLT0gdi56OwogICAgCQl0aGlzLncgLT0gdi53OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgZnJvbSBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIHN1YnRyYWN0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXN1YlNjYWxhciggcyApIHsKCiAgICAJCXRoaXMueCAtPSBzOwogICAgCQl0aGlzLnkgLT0gczsKICAgIAkJdGhpcy56IC09IHM7CiAgICAJCXRoaXMudyAtPSBzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU3VidHJhY3RzIHRoZSBnaXZlbiB2ZWN0b3JzIGFuZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSBhIC0gVGhlIGZpcnN0IHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IGIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzdWJWZWN0b3JzKCBhLCBiICkgewoKICAgIAkJdGhpcy54ID0gYS54IC0gYi54OwogICAgCQl0aGlzLnkgPSBhLnkgLSBiLnk7CiAgICAJCXRoaXMueiA9IGEueiAtIGIuejsKICAgIAkJdGhpcy53ID0gYS53IC0gYi53OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbXVsdGlwbHkoIHYgKSB7CgogICAgCQl0aGlzLnggKj0gdi54OwogICAgCQl0aGlzLnkgKj0gdi55OwogICAgCQl0aGlzLnogKj0gdi56OwogICAgCQl0aGlzLncgKj0gdi53OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHdpdGggYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIG11bHRpcGx5LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLnggKj0gc2NhbGFyOwogICAgCQl0aGlzLnkgKj0gc2NhbGFyOwogICAgCQl0aGlzLnogKj0gc2NhbGFyOwogICAgCQl0aGlzLncgKj0gc2NhbGFyOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGlzIHZlY3RvciB3aXRoIHRoZSBnaXZlbiA0eDQgbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIDR4NCBtYXRyaXguCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtICkgewoKICAgIAkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMueiwgdyA9IHRoaXMudzsKICAgIAkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgogICAgCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHogKyBlWyAxMiBdICogdzsKICAgIAkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSAqIHc7CiAgICAJCXRoaXMueiA9IGVbIDIgXSAqIHggKyBlWyA2IF0gKiB5ICsgZVsgMTAgXSAqIHogKyBlWyAxNCBdICogdzsKICAgIAkJdGhpcy53ID0gZVsgMyBdICogeCArIGVbIDcgXSAqIHkgKyBlWyAxMSBdICogeiArIGVbIDE1IF0gKiB3OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGl2aWRlcyB0aGlzIGluc3RhbmNlIGJ5IHRoZSBnaXZlbiB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGRpdmlkZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlkaXZpZGUoIHYgKSB7CgogICAgCQl0aGlzLnggLz0gdi54OwogICAgCQl0aGlzLnkgLz0gdi55OwogICAgCQl0aGlzLnogLz0gdi56OwogICAgCQl0aGlzLncgLz0gdi53OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGl2aWRlcyB0aGlzIHZlY3RvciBieSB0aGUgZ2l2ZW4gc2NhbGFyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdG8gZGl2aWRlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWRpdmlkZVNjYWxhciggc2NhbGFyICkgewoKICAgIAkJcmV0dXJuIHRoaXMubXVsdGlwbHlTY2FsYXIoIDEgLyBzY2FsYXIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB4LCB5IGFuZCB6IGNvbXBvbmVudHMgb2YgdGhpcwogICAgCSAqIHZlY3RvciB0byB0aGUgcXVhdGVybmlvbidzIGF4aXMgYW5kIHcgdG8gdGhlIGFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24gdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEF4aXNBbmdsZUZyb21RdWF0ZXJuaW9uKCBxICkgewoKICAgIAkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL3F1YXRlcm5pb25Ub0FuZ2xlL2luZGV4Lmh0bQoKICAgIAkJLy8gcSBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCiAgICAJCXRoaXMudyA9IDIgKiBNYXRoLmFjb3MoIHEudyApOwoKICAgIAkJY29uc3QgcyA9IE1hdGguc3FydCggMSAtIHEudyAqIHEudyApOwoKICAgIAkJaWYgKCBzIDwgMC4wMDAxICkgewoKICAgIAkJCXRoaXMueCA9IDE7CiAgICAJCQl0aGlzLnkgPSAwOwogICAgCQkJdGhpcy56ID0gMDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhpcy54ID0gcS54IC8gczsKICAgIAkJCXRoaXMueSA9IHEueSAvIHM7CiAgICAJCQl0aGlzLnogPSBxLnogLyBzOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeCwgeSBhbmQgeiBjb21wb25lbnRzIG9mIHRoaXMKICAgIAkgKiB2ZWN0b3IgdG8gdGhlIGF4aXMgb2Ygcm90YXRpb24gYW5kIHcgdG8gdGhlIGFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gQSA0eDQgbWF0cml4IG9mIHdoaWNoIHRoZSB1cHBlciBsZWZ0IDN4MyBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlzZXRBeGlzQW5nbGVGcm9tUm90YXRpb25NYXRyaXgoIG0gKSB7CgogICAgCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9nZW9tZXRyeS9yb3RhdGlvbnMvY29udmVyc2lvbnMvbWF0cml4VG9BbmdsZS9pbmRleC5odG0KCiAgICAJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgogICAgCQlsZXQgYW5nbGUsIHgsIHksIHo7IC8vIHZhcmlhYmxlcyBmb3IgcmVzdWx0CiAgICAJCWNvbnN0IGVwc2lsb24gPSAwLjAxLAkJLy8gbWFyZ2luIHRvIGFsbG93IGZvciByb3VuZGluZyBlcnJvcnMKICAgIAkJCWVwc2lsb24yID0gMC4xLAkJLy8gbWFyZ2luIHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gMCBhbmQgMTgwIGRlZ3JlZXMKCiAgICAJCQl0ZSA9IG0uZWxlbWVudHMsCgogICAgCQkJbTExID0gdGVbIDAgXSwgbTEyID0gdGVbIDQgXSwgbTEzID0gdGVbIDggXSwKICAgIAkJCW0yMSA9IHRlWyAxIF0sIG0yMiA9IHRlWyA1IF0sIG0yMyA9IHRlWyA5IF0sCiAgICAJCQltMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXTsKCiAgICAJCWlmICggKCBNYXRoLmFicyggbTEyIC0gbTIxICkgPCBlcHNpbG9uICkgJiYKICAgIAkJICAgICAoIE1hdGguYWJzKCBtMTMgLSBtMzEgKSA8IGVwc2lsb24gKSAmJgogICAgCQkgICAgICggTWF0aC5hYnMoIG0yMyAtIG0zMiApIDwgZXBzaWxvbiApICkgewoKICAgIAkJCS8vIHNpbmd1bGFyaXR5IGZvdW5kCiAgICAJCQkvLyBmaXJzdCBjaGVjayBmb3IgaWRlbnRpdHkgbWF0cml4IHdoaWNoIG11c3QgaGF2ZSArMSBmb3IgYWxsIHRlcm1zCiAgICAJCQkvLyBpbiBsZWFkaW5nIGRpYWdvbmFsIGFuZCB6ZXJvIGluIG90aGVyIHRlcm1zCgogICAgCQkJaWYgKCAoIE1hdGguYWJzKCBtMTIgKyBtMjEgKSA8IGVwc2lsb24yICkgJiYKICAgIAkJCSAgICAgKCBNYXRoLmFicyggbTEzICsgbTMxICkgPCBlcHNpbG9uMiApICYmCiAgICAJCQkgICAgICggTWF0aC5hYnMoIG0yMyArIG0zMiApIDwgZXBzaWxvbjIgKSAmJgogICAgCQkJICAgICAoIE1hdGguYWJzKCBtMTEgKyBtMjIgKyBtMzMgLSAzICkgPCBlcHNpbG9uMiApICkgewoKICAgIAkJCQkvLyB0aGlzIHNpbmd1bGFyaXR5IGlzIGlkZW50aXR5IG1hdHJpeCBzbyBhbmdsZSA9IDAKCiAgICAJCQkJdGhpcy5zZXQoIDEsIDAsIDAsIDAgKTsKCiAgICAJCQkJcmV0dXJuIHRoaXM7IC8vIHplcm8gYW5nbGUsIGFyYml0cmFyeSBheGlzCgogICAgCQkJfQoKICAgIAkJCS8vIG90aGVyd2lzZSB0aGlzIHNpbmd1bGFyaXR5IGlzIGFuZ2xlID0gMTgwCgogICAgCQkJYW5nbGUgPSBNYXRoLlBJOwoKICAgIAkJCWNvbnN0IHh4ID0gKCBtMTEgKyAxICkgLyAyOwogICAgCQkJY29uc3QgeXkgPSAoIG0yMiArIDEgKSAvIDI7CiAgICAJCQljb25zdCB6eiA9ICggbTMzICsgMSApIC8gMjsKICAgIAkJCWNvbnN0IHh5ID0gKCBtMTIgKyBtMjEgKSAvIDQ7CiAgICAJCQljb25zdCB4eiA9ICggbTEzICsgbTMxICkgLyA0OwogICAgCQkJY29uc3QgeXogPSAoIG0yMyArIG0zMiApIC8gNDsKCiAgICAJCQlpZiAoICggeHggPiB5eSApICYmICggeHggPiB6eiApICkgewoKICAgIAkJCQkvLyBtMTEgaXMgdGhlIGxhcmdlc3QgZGlhZ29uYWwgdGVybQoKICAgIAkJCQlpZiAoIHh4IDwgZXBzaWxvbiApIHsKCiAgICAJCQkJCXggPSAwOwogICAgCQkJCQl5ID0gMC43MDcxMDY3ODE7CiAgICAJCQkJCXogPSAwLjcwNzEwNjc4MTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXggPSBNYXRoLnNxcnQoIHh4ICk7CiAgICAJCQkJCXkgPSB4eSAvIHg7CiAgICAJCQkJCXogPSB4eiAvIHg7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCB5eSA+IHp6ICkgewoKICAgIAkJCQkvLyBtMjIgaXMgdGhlIGxhcmdlc3QgZGlhZ29uYWwgdGVybQoKICAgIAkJCQlpZiAoIHl5IDwgZXBzaWxvbiApIHsKCiAgICAJCQkJCXggPSAwLjcwNzEwNjc4MTsKICAgIAkJCQkJeSA9IDA7CiAgICAJCQkJCXogPSAwLjcwNzEwNjc4MTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXkgPSBNYXRoLnNxcnQoIHl5ICk7CiAgICAJCQkJCXggPSB4eSAvIHk7CiAgICAJCQkJCXogPSB5eiAvIHk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQkvLyBtMzMgaXMgdGhlIGxhcmdlc3QgZGlhZ29uYWwgdGVybSBzbyBiYXNlIHJlc3VsdCBvbiB0aGlzCgogICAgCQkJCWlmICggenogPCBlcHNpbG9uICkgewoKICAgIAkJCQkJeCA9IDAuNzA3MTA2NzgxOwogICAgCQkJCQl5ID0gMC43MDcxMDY3ODE7CiAgICAJCQkJCXogPSAwOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJeiA9IE1hdGguc3FydCggenogKTsKICAgIAkJCQkJeCA9IHh6IC8gejsKICAgIAkJCQkJeSA9IHl6IC8gejsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQl0aGlzLnNldCggeCwgeSwgeiwgYW5nbGUgKTsKCiAgICAJCQlyZXR1cm4gdGhpczsgLy8gcmV0dXJuIDE4MCBkZWcgcm90YXRpb24KCiAgICAJCX0KCiAgICAJCS8vIGFzIHdlIGhhdmUgcmVhY2hlZCBoZXJlIHRoZXJlIGFyZSBubyBzaW5ndWxhcml0aWVzIHNvIHdlIGNhbiBoYW5kbGUgbm9ybWFsbHkKCiAgICAJCWxldCBzID0gTWF0aC5zcXJ0KCAoIG0zMiAtIG0yMyApICogKCBtMzIgLSBtMjMgKSArCiAgICAJCQkoIG0xMyAtIG0zMSApICogKCBtMTMgLSBtMzEgKSArCiAgICAJCQkoIG0yMSAtIG0xMiApICogKCBtMjEgLSBtMTIgKSApOyAvLyB1c2VkIHRvIG5vcm1hbGl6ZQoKICAgIAkJaWYgKCBNYXRoLmFicyggcyApIDwgMC4wMDEgKSBzID0gMTsKCiAgICAJCS8vIHByZXZlbnQgZGl2aWRlIGJ5IHplcm8sIHNob3VsZCBub3QgaGFwcGVuIGlmIG1hdHJpeCBpcyBvcnRob2dvbmFsIGFuZCBzaG91bGQgYmUKICAgIAkJLy8gY2F1Z2h0IGJ5IHNpbmd1bGFyaXR5IHRlc3QgYWJvdmUsIGJ1dCBJJ3ZlIGxlZnQgaXQgaW4ganVzdCBpbiBjYXNlCgogICAgCQl0aGlzLnggPSAoIG0zMiAtIG0yMyApIC8gczsKICAgIAkJdGhpcy55ID0gKCBtMTMgLSBtMzEgKSAvIHM7CiAgICAJCXRoaXMueiA9ICggbTIxIC0gbTEyICkgLyBzOwogICAgCQl0aGlzLncgPSBNYXRoLmFjb3MoICggbTExICsgbTIyICsgbTMzIC0gMSApIC8gMiApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHBvc2l0aW9uIGVsZW1lbnRzIG9mIHRoZQogICAgCSAqIGdpdmVuIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldEZyb21NYXRyaXhQb3NpdGlvbiggbSApIHsKCiAgICAJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKICAgIAkJdGhpcy54ID0gZVsgMTIgXTsKICAgIAkJdGhpcy55ID0gZVsgMTMgXTsKICAgIAkJdGhpcy56ID0gZVsgMTQgXTsKICAgIAkJdGhpcy53ID0gZVsgMTUgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgZ2l2ZW4gdmVjdG9yJ3MgeCwgeSwgeiBvciB3CiAgICAJICogdmFsdWUsIHJlcGxhY2UgdGhhdCB2YWx1ZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIG1pbiB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbWluKCB2ICkgewoKICAgIAkJdGhpcy54ID0gTWF0aC5taW4oIHRoaXMueCwgdi54ICk7CiAgICAJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwogICAgCQl0aGlzLnogPSBNYXRoLm1pbiggdGhpcy56LCB2LnogKTsKICAgIAkJdGhpcy53ID0gTWF0aC5taW4oIHRoaXMudywgdi53ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHgsIHksIHogb3IgdwogICAgCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtYXggdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCW1heCggdiApIHsKCiAgICAJCXRoaXMueCA9IE1hdGgubWF4KCB0aGlzLngsIHYueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLm1heCggdGhpcy55LCB2LnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5tYXgoIHRoaXMueiwgdi56ICk7CiAgICAJCXRoaXMudyA9IE1hdGgubWF4KCB0aGlzLncsIHYudyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmVjdG9yJ3MgeCwgeSwgeiBvciB3CiAgICAJICogdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSwKICAgIAkgKiBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gbWluIC0gVGhlIG1pbmltdW0geCwgeSBhbmQgeiB2YWx1ZXMuCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSBtYXggLSBUaGUgbWF4aW11bSB4LCB5IGFuZCB6IHZhbHVlcyBpbiB0aGUgZGVzaXJlZCByYW5nZS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAljbGFtcCggbWluLCBtYXggKSB7CgogICAgCQkvLyBhc3N1bWVzIG1pbiA8IG1heCwgY29tcG9uZW50d2lzZQoKICAgIAkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluLngsIG1heC54ICk7CiAgICAJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pbi55LCBtYXgueSApOwogICAgCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW4ueiwgbWF4LnogKTsKICAgIAkJdGhpcy53ID0gY2xhbXAoIHRoaXMudywgbWluLncsIG1heC53ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZXMgYXJlIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCB0aGV5IGFyZQogICAgCSAqIHJlcGxhY2VkIGJ5IHRoZSBtYXggdmFsdWUuCiAgICAJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWVzIGFyZSBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgdGhleSBhcmUKICAgIAkgKiByZXBsYWNlZCBieSB0aGUgbWluIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG1pblZhbCAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWF4VmFsIC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWNsYW1wU2NhbGFyKCBtaW5WYWwsIG1heFZhbCApIHsKCiAgICAJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pblZhbCwgbWF4VmFsICk7CiAgICAJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pblZhbCwgbWF4VmFsICk7CiAgICAJCXRoaXMueiA9IGNsYW1wKCB0aGlzLnosIG1pblZhbCwgbWF4VmFsICk7CiAgICAJCXRoaXMudyA9IGNsYW1wKCB0aGlzLncsIG1pblZhbCwgbWF4VmFsICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkKICAgIAkgKiB0aGUgbWF4IHZhbHVlLgogICAgCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUKICAgIAkgKiBtaW4gdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbWluIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXggLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKICAgIAkJY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCiAgICAJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggY2xhbXAoIGxlbmd0aCwgbWluLCBtYXggKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWZsb29yKCkgewoKICAgIAkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwogICAgCQl0aGlzLnogPSBNYXRoLmZsb29yKCB0aGlzLnogKTsKICAgIAkJdGhpcy53ID0gTWF0aC5mbG9vciggdGhpcy53ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB1cCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJY2VpbCgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGguY2VpbCggdGhpcy54ICk7CiAgICAJCXRoaXMueSA9IE1hdGguY2VpbCggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGguY2VpbCggdGhpcy56ICk7CiAgICAJCXRoaXMudyA9IE1hdGguY2VpbCggdGhpcy53ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlyb3VuZCgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwogICAgCQl0aGlzLnkgPSBNYXRoLnJvdW5kKCB0aGlzLnkgKTsKICAgIAkJdGhpcy56ID0gTWF0aC5yb3VuZCggdGhpcy56ICk7CiAgICAJCXRoaXMudyA9IE1hdGgucm91bmQoIHRoaXMudyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG93YXJkcyB6ZXJvICh1cCBpZiBuZWdhdGl2ZSwKICAgIAkgKiBkb3duIGlmIHBvc2l0aXZlKSB0byBhbiBpbnRlZ2VyIHZhbHVlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJcm91bmRUb1plcm8oKSB7CgogICAgCQl0aGlzLnggPSBNYXRoLnRydW5jKCB0aGlzLnggKTsKICAgIAkJdGhpcy55ID0gTWF0aC50cnVuYyggdGhpcy55ICk7CiAgICAJCXRoaXMueiA9IE1hdGgudHJ1bmMoIHRoaXMueiApOwogICAgCQl0aGlzLncgPSBNYXRoLnRydW5jKCB0aGlzLncgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludmVydHMgdGhpcyB2ZWN0b3IgLSBpLmUuIHNldHMgeCA9IC14LCB5ID0gLXksIHogPSAteiwgdyA9IC13LgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbmVnYXRlKCkgewoKICAgIAkJdGhpcy54ID0gLSB0aGlzLng7CiAgICAJCXRoaXMueSA9IC0gdGhpcy55OwogICAgCQl0aGlzLnogPSAtIHRoaXMuejsKICAgIAkJdGhpcy53ID0gLSB0aGlzLnc7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgZG90IHByb2R1Y3Qgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgdGhlIGRvdCBwcm9kdWN0LgogICAgCSAqLwogICAgCWRvdCggdiApIHsKCiAgICAJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2LnogKyB0aGlzLncgKiB2Lnc7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHNxdWFyZSBvZiB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIGZyb20KICAgIAkgKiAoMCwgMCwgMCwgMCkgdG8gKHgsIHksIHosIHcpLiBJZiB5b3UgYXJlIGNvbXBhcmluZyB0aGUgbGVuZ3RocyBvZiB2ZWN0b3JzLCB5b3Ugc2hvdWxkCiAgICAJICogY29tcGFyZSB0aGUgbGVuZ3RoIHNxdWFyZWQgaW5zdGVhZCBhcyBpdCBpcyBzbGlnaHRseSBtb3JlIGVmZmljaWVudCB0byBjYWxjdWxhdGUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlbmd0aFNxKCkgewoKICAgIAkJcmV0dXJuIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tICgwLCAwLCAwLCAwKSB0byAoeCwgeSwgeiwgdykuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbWFuaGF0dGFuTGVuZ3RoKCkgewoKICAgIAkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKSArIE1hdGguYWJzKCB0aGlzLnogKSArIE1hdGguYWJzKCB0aGlzLncgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGlzIHZlY3RvciB0byBhIHVuaXQgdmVjdG9yIC0gdGhhdCBpcywgc2V0cyBpdCBlcXVhbCB0byBhIHZlY3RvcgogICAgCSAqIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQgd2l0aCBhIHZlY3RvciBsZW5ndGggb2YgYDFgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAJICovCiAgICAJbm9ybWFsaXplKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdmVjdG9yIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQKICAgIAkgKiB3aXRoIHRoZSBzcGVjaWZpZWQgbGVuZ3RoLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCAtIFRoZSBuZXcgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXNldExlbmd0aCggbGVuZ3RoICkgewoKICAgIAkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UsIHdoZXJlCiAgICAJICogYWxwaGEgaXMgdGhlIHBlcmNlbnQgZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgLSBhbHBoYSA9IDAgd2lsbCBiZSB0aGlzCiAgICAJICogdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwgYmUgdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gaW50ZXJwb2xhdGUgdG93YXJkcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlcnAoIHYsIGFscGhhICkgewoKICAgIAkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKICAgIAkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKICAgIAkJdGhpcy56ICs9ICggdi56IC0gdGhpcy56ICkgKiBhbHBoYTsKICAgIAkJdGhpcy53ICs9ICggdi53IC0gdGhpcy53ICkgKiBhbHBoYTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3JzLCB3aGVyZSBhbHBoYSBpcyB0aGUgcGVyY2VudAogICAgCSAqIGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgZmlyc3QgdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwKICAgIAkgKiBiZSB0aGUgc2Vjb25kIG9uZS4gVGhlIHJlc3VsdCBpcyBzdG9yZWQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdjEgLSBUaGUgZmlyc3QgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yNH0gdjIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKICAgIAkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwogICAgCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CiAgICAJCXRoaXMueiA9IHYxLnogKyAoIHYyLnogLSB2MS56ICkgKiBhbHBoYTsKICAgIAkJdGhpcy53ID0gdjEudyArICggdjIudyAtIHYxLncgKSAqIGFscGhhOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIHYgKSB7CgogICAgCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSAmJiAoIHYudyA9PT0gdGhpcy53ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgdmVjdG9yJ3MgeCB2YWx1ZSB0byBiZSBgYXJyYXlbIG9mZnNldCBdYCwgeSB2YWx1ZSB0byBiZSBgYXJyYXlbIG9mZnNldCArIDEgXWAsCiAgICAJICogeiB2YWx1ZSB0byBiZSBgYXJyYXlbIG9mZnNldCArIDIgXWAsIHcgdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAzIF1gLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIHZlY3RvciBjb21wb25lbnQgdmFsdWVzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KICAgIAkgKi8KICAgIAlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKICAgIAkJdGhpcy54ID0gYXJyYXlbIG9mZnNldCBdOwogICAgCQl0aGlzLnkgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwogICAgCQl0aGlzLnogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwogICAgCQl0aGlzLncgPSBhcnJheVsgb2Zmc2V0ICsgMyBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogV3JpdGVzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgdmVjdG9yIGNvbXBvbmVudHMuCiAgICAJICovCiAgICAJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMueDsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuejsKICAgIAkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRoaXMudzsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyB2ZWN0b3IgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYXR0cmlidXRlLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgogICAgCQl0aGlzLnggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKICAgIAkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CiAgICAJCXRoaXMueiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwogICAgCQl0aGlzLncgPSBhdHRyaWJ1dGUuZ2V0VyggaW5kZXggKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgZWFjaCBjb21wb25lbnQgb2YgdGhpcyB2ZWN0b3IgdG8gYSBwc2V1ZG8tcmFuZG9tIHZhbHVlIGJldHdlZW4gYDBgIGFuZAogICAgCSAqIGAxYCwgZXhjbHVkaW5nIGAxYC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCXJhbmRvbSgpIHsKCiAgICAJCXRoaXMueCA9IE1hdGgucmFuZG9tKCk7CiAgICAJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CiAgICAJCXRoaXMueiA9IE1hdGgucmFuZG9tKCk7CiAgICAJCXRoaXMudyA9IE1hdGgucmFuZG9tKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCiAgICAJCXlpZWxkIHRoaXMueDsKICAgIAkJeWllbGQgdGhpcy55OwogICAgCQl5aWVsZCB0aGlzLno7CiAgICAJCXlpZWxkIHRoaXMudzsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIEEgcmVuZGVyIHRhcmdldCBpcyBhIGJ1ZmZlciB3aGVyZSB0aGUgdmlkZW8gY2FyZCBkcmF3cyBwaXhlbHMgZm9yIGEgc2NlbmUKICAgICAqIHRoYXQgaXMgYmVpbmcgcmVuZGVyZWQgaW4gdGhlIGJhY2tncm91bmQuIEl0IGlzIHVzZWQgaW4gZGlmZmVyZW50IGVmZmVjdHMsCiAgICAgKiBzdWNoIGFzIGFwcGx5aW5nIHBvc3Rwcm9jZXNzaW5nIHRvIGEgcmVuZGVyZWQgaW1hZ2UgYmVmb3JlIGRpc3BsYXlpbmcgaXQKICAgICAqIG9uIHRoZSBzY3JlZW4uCiAgICAgKgogICAgICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgogICAgICovCiAgICBjbGFzcyBSZW5kZXJUYXJnZXQgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKICAgIAkvKioKICAgIAkgKiBSZW5kZXIgdGFyZ2V0IG9wdGlvbnMuCiAgICAJICoKICAgIAkgKiBAdHlwZWRlZiB7T2JqZWN0fSBSZW5kZXJUYXJnZXR+T3B0aW9ucwogICAgCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2dlbmVyYXRlTWlwbWFwcz1mYWxzZV0gLSBXaGV0aGVyIHRvIGdlbmVyYXRlIG1pcG1hcHMgb3Igbm90LgogICAgCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWFnRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWFnIGZpbHRlci4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW21pbkZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1pbiBmaWx0ZXIuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFtmb3JtYXQ9UkdCQUZvcm1hdF0gLSBUaGUgdGV4dHVyZSBmb3JtYXQuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFt0eXBlPVVuc2lnbmVkQnl0ZVR5cGVdIC0gVGhlIHRleHR1cmUgdHlwZS4KICAgIAkgKiBAcHJvcGVydHkgez9zdHJpbmd9IFtpbnRlcm5hbEZvcm1hdD1udWxsXSAtIFRoZSB0ZXh0dXJlJ3MgaW50ZXJuYWwgZm9ybWF0LgogICAgCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgdGV4dHVyZSdzIHV2IHdyYXBwaW5nIG1vZGUuCiAgICAJICogQHByb3BlcnR5IHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB0ZXh0dXJlJ3MgdXYgd3JhcHBpbmcgbW9kZS4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW2FuaXNvdHJvcHk9MV0gLSBUaGUgdGV4dHVyZSdzIGFuaXNvdHJvcHkgdmFsdWUuCiAgICAJICogQHByb3BlcnR5IHtzdHJpbmd9IFtjb2xvclNwYWNlPU5vQ29sb3JTcGFjZV0gLSBUaGUgdGV4dHVyZSdzIGNvbG9yIHNwYWNlLgogICAgCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW2RlcHRoQnVmZmVyPXRydWVdIC0gV2hldGhlciB0byBhbGxvY2F0ZSBhIGRlcHRoIGJ1ZmZlciBvciBub3QuCiAgICAJICogQHByb3BlcnR5IHtib29sZWFufSBbc3RlbmNpbEJ1ZmZlcj1mYWxzZV0gLSBXaGV0aGVyIHRvIGFsbG9jYXRlIGEgc3RlbmNpbCBidWZmZXIgb3Igbm90LgogICAgCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3Jlc29sdmVEZXB0aEJ1ZmZlcj10cnVlXSAtIFdoZXRoZXIgdG8gcmVzb2x2ZSB0aGUgZGVwdGggYnVmZmVyIG9yIG5vdC4KICAgIAkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtyZXNvbHZlU3RlbmNpbEJ1ZmZlcj10cnVlXSAtIFdoZXRoZXIgIHRvIHJlc29sdmUgdGhlIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KICAgIAkgKiBAcHJvcGVydHkgez9UZXh0dXJlfSBbZGVwdGhUZXh0dXJlPW51bGxdIC0gUmVmZXJlbmNlIHRvIGEgZGVwdGggdGV4dHVyZS4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW3NhbXBsZXM9MF0gLSBUaGUgTVNBQSBzYW1wbGVzIGNvdW50LgogICAgCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbY291bnQ9MV0gLSBEZWZpbmVzIHRoZSBudW1iZXIgb2YgY29sb3IgYXR0YWNobWVudHMgLiBNdXN0IGJlIGF0IGxlYXN0IGAxYC4KICAgIAkgKiBAcHJvcGVydHkge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIHRleHR1cmUgZGVwdGguCiAgICAJICogQHByb3BlcnR5IHtib29sZWFufSBbbXVsdGl2aWV3PWZhbHNlXSAtIFdoZXRoZXIgdGhpcyB0YXJnZXQgaXMgdXNlZCBmb3IgbXVsdGl2aWV3IHJlbmRlcmluZy4KICAgIAkgKi8KCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyByZW5kZXIgdGFyZ2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aCBvZiB0aGUgcmVuZGVyIHRhcmdldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQgb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJICogQHBhcmFtIHtSZW5kZXJUYXJnZXR+T3B0aW9uc30gW29wdGlvbnNdIC0gVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIG9wdGlvbnMgPSB7fSApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQlvcHRpb25zID0gT2JqZWN0LmFzc2lnbiggewogICAgCQkJZ2VuZXJhdGVNaXBtYXBzOiBmYWxzZSwKICAgIAkJCWludGVybmFsRm9ybWF0OiBudWxsLAogICAgCQkJbWluRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCiAgICAJCQlkZXB0aEJ1ZmZlcjogdHJ1ZSwKICAgIAkJCXN0ZW5jaWxCdWZmZXI6IGZhbHNlLAogICAgCQkJcmVzb2x2ZURlcHRoQnVmZmVyOiB0cnVlLAogICAgCQkJcmVzb2x2ZVN0ZW5jaWxCdWZmZXI6IHRydWUsCiAgICAJCQlkZXB0aFRleHR1cmU6IG51bGwsCiAgICAJCQlzYW1wbGVzOiAwLAogICAgCQkJY291bnQ6IDEsCiAgICAJCQlkZXB0aDogMSwKICAgIAkJCW11bHRpdmlldzogZmFsc2UKICAgIAkJfSwgb3B0aW9ucyApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNSZW5kZXJUYXJnZXQgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB3aWR0aCBvZiB0aGUgcmVuZGVyIHRhcmdldC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy53aWR0aCA9IHdpZHRoOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBoZWlnaHQgb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBkZXB0aCBvZiB0aGUgcmVuZGVyIHRhcmdldC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aCA9IG9wdGlvbnMuZGVwdGg7CgogICAgCQkvKioKICAgIAkJICogQSByZWN0YW5ndWxhciBhcmVhIGluc2lkZSB0aGUgcmVuZGVyIHRhcmdldCdzIHZpZXdwb3J0LiBGcmFnbWVudHMgdGhhdCBhcmUKICAgIAkJICogb3V0c2lkZSB0aGUgYXJlYSB3aWxsIGJlIGRpc2NhcmRlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjR9CiAgICAJCSAqIEBkZWZhdWx0ICgwLDAsd2lkdGgsaGVpZ2h0KQogICAgCQkgKi8KICAgIAkJdGhpcy5zY2lzc29yID0gbmV3IFZlY3RvcjQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCS8qKgogICAgCQkgKiBJbmRpY2F0ZXMgd2hldGhlciB0aGUgc2Npc3NvciB0ZXN0IHNob3VsZCBiZSBlbmFibGVkIHdoZW4gcmVuZGVyaW5nIGludG8KICAgIAkJICogdGhpcyByZW5kZXIgdGFyZ2V0IG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLnNjaXNzb3JUZXN0ID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogQSByZWN0YW5ndWxhciBhcmVhIHJlcHJlc2VudGluZyB0aGUgcmVuZGVyIHRhcmdldCdzIHZpZXdwb3J0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yNH0KICAgIAkJICogQGRlZmF1bHQgKDAsMCx3aWR0aCxoZWlnaHQpCiAgICAJCSAqLwogICAgCQl0aGlzLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCWNvbnN0IGltYWdlID0geyB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0LCBkZXB0aDogb3B0aW9ucy5kZXB0aCB9OwoKICAgIAkJY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKCBpbWFnZSApOwoKICAgIAkJLyoqCiAgICAJCSAqIEFuIGFycmF5IG9mIHRleHR1cmVzLiBFYWNoIGNvbG9yIGF0dGFjaG1lbnQgaXMgcmVwcmVzZW50ZWQgYXMgYSBzZXBhcmF0ZSB0ZXh0dXJlLgogICAgCQkgKiBIYXMgYXQgbGVhc3QgYSBzaW5nbGUgZW50cnkgZm9yIHRoZSBkZWZhdWx0IGNvbG9yIGF0dGFjaG1lbnQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxUZXh0dXJlPn0KICAgIAkJICovCiAgICAJCXRoaXMudGV4dHVyZXMgPSBbXTsKCiAgICAJCWNvbnN0IGNvdW50ID0gb3B0aW9ucy5jb3VudDsKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgogICAgCQkJdGhpcy50ZXh0dXJlc1sgaSBdID0gdGV4dHVyZS5jbG9uZSgpOwogICAgCQkJdGhpcy50ZXh0dXJlc1sgaSBdLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IHRydWU7CiAgICAJCQl0aGlzLnRleHR1cmVzWyBpIF0ucmVuZGVyVGFyZ2V0ID0gdGhpczsKCiAgICAJCX0KCiAgICAJCXRoaXMuX3NldFRleHR1cmVPcHRpb25zKCBvcHRpb25zICk7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBhbGxvY2F0ZSBhIGRlcHRoIGJ1ZmZlciBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmRlcHRoQnVmZmVyID0gb3B0aW9ucy5kZXB0aEJ1ZmZlcjsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIGFsbG9jYXRlIGEgc3RlbmNpbCBidWZmZXIgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IG9wdGlvbnMuc3RlbmNpbEJ1ZmZlcjsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLnJlc29sdmVEZXB0aEJ1ZmZlciA9IG9wdGlvbnMucmVzb2x2ZURlcHRoQnVmZmVyOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdG8gcmVzb2x2ZSB0aGUgc3RlbmNpbCBidWZmZXIgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5yZXNvbHZlU3RlbmNpbEJ1ZmZlciA9IG9wdGlvbnMucmVzb2x2ZVN0ZW5jaWxCdWZmZXI7CgogICAgCQl0aGlzLl9kZXB0aFRleHR1cmUgPSBudWxsOwogICAgCQl0aGlzLmRlcHRoVGV4dHVyZSA9IG9wdGlvbnMuZGVwdGhUZXh0dXJlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBudW1iZXIgb2YgTVNBQSBzYW1wbGVzLgogICAgCQkgKgogICAgCQkgKiBBIHZhbHVlIG9mIGAwYCBkaXNhYmxlcyBNU0FBLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnNhbXBsZXMgPSBvcHRpb25zLnNhbXBsZXM7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byB0aGlzIHRhcmdldCBpcyB1c2VkIGluIG11bHRpdmlldyByZW5kZXJpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5tdWx0aXZpZXcgPSBvcHRpb25zLm11bHRpdmlldzsKCiAgICAJfQoKICAgIAlfc2V0VGV4dHVyZU9wdGlvbnMoIG9wdGlvbnMgPSB7fSApIHsKCiAgICAJCWNvbnN0IHZhbHVlcyA9IHsKICAgIAkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAogICAgCQkJZ2VuZXJhdGVNaXBtYXBzOiBmYWxzZSwKICAgIAkJCWZsaXBZOiBmYWxzZSwKICAgIAkJCWludGVybmFsRm9ybWF0OiBudWxsCiAgICAJCX07CgogICAgCQlpZiAoIG9wdGlvbnMubWFwcGluZyAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLm1hcHBpbmcgPSBvcHRpb25zLm1hcHBpbmc7CiAgICAJCWlmICggb3B0aW9ucy53cmFwUyAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLndyYXBTID0gb3B0aW9ucy53cmFwUzsKICAgIAkJaWYgKCBvcHRpb25zLndyYXBUICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMud3JhcFQgPSBvcHRpb25zLndyYXBUOwogICAgCQlpZiAoIG9wdGlvbnMud3JhcFIgIT09IHVuZGVmaW5lZCApIHZhbHVlcy53cmFwUiA9IG9wdGlvbnMud3JhcFI7CiAgICAJCWlmICggb3B0aW9ucy5tYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5tYWdGaWx0ZXIgPSBvcHRpb25zLm1hZ0ZpbHRlcjsKICAgIAkJaWYgKCBvcHRpb25zLm1pbkZpbHRlciAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLm1pbkZpbHRlciA9IG9wdGlvbnMubWluRmlsdGVyOwogICAgCQlpZiAoIG9wdGlvbnMuZm9ybWF0ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQ7CiAgICAJCWlmICggb3B0aW9ucy50eXBlICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgIAkJaWYgKCBvcHRpb25zLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5hbmlzb3Ryb3B5ID0gb3B0aW9ucy5hbmlzb3Ryb3B5OwogICAgCQlpZiAoIG9wdGlvbnMuY29sb3JTcGFjZSAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLmNvbG9yU3BhY2UgPSBvcHRpb25zLmNvbG9yU3BhY2U7CiAgICAJCWlmICggb3B0aW9ucy5mbGlwWSAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLmZsaXBZID0gb3B0aW9ucy5mbGlwWTsKICAgIAkJaWYgKCBvcHRpb25zLmdlbmVyYXRlTWlwbWFwcyAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLmdlbmVyYXRlTWlwbWFwcyA9IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzOwogICAgCQlpZiAoIG9wdGlvbnMuaW50ZXJuYWxGb3JtYXQgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5pbnRlcm5hbEZvcm1hdCA9IG9wdGlvbnMuaW50ZXJuYWxGb3JtYXQ7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLnRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQljb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1sgaSBdOwogICAgCQkJdGV4dHVyZS5zZXRWYWx1ZXMoIHZhbHVlcyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoZSB0ZXh0dXJlIHJlcHJlc2VudGluZyB0aGUgZGVmYXVsdCBjb2xvciBhdHRhY2htZW50LgogICAgCSAqCiAgICAJICogQHR5cGUge1RleHR1cmV9CiAgICAJICovCiAgICAJZ2V0IHRleHR1cmUoKSB7CgogICAgCQlyZXR1cm4gdGhpcy50ZXh0dXJlc1sgMCBdOwoKICAgIAl9CgogICAgCXNldCB0ZXh0dXJlKCB2YWx1ZSApIHsKCiAgICAJCXRoaXMudGV4dHVyZXNbIDAgXSA9IHZhbHVlOwoKICAgIAl9CgogICAgCXNldCBkZXB0aFRleHR1cmUoIGN1cnJlbnQgKSB7CgogICAgCQlpZiAoIHRoaXMuX2RlcHRoVGV4dHVyZSAhPT0gbnVsbCApIHRoaXMuX2RlcHRoVGV4dHVyZS5yZW5kZXJUYXJnZXQgPSBudWxsOwogICAgCQlpZiAoIGN1cnJlbnQgIT09IG51bGwgKSBjdXJyZW50LnJlbmRlclRhcmdldCA9IHRoaXM7CgogICAgCQl0aGlzLl9kZXB0aFRleHR1cmUgPSBjdXJyZW50OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEluc3RlYWQgb2Ygc2F2aW5nIHRoZSBkZXB0aCBpbiBhIHJlbmRlcmJ1ZmZlciwgYSB0ZXh0dXJlCiAgICAJICogY2FuIGJlIHVzZWQgaW5zdGVhZCB3aGljaCBpcyB1c2VmdWwgZm9yIGZ1cnRoZXIgcHJvY2Vzc2luZwogICAgCSAqIGUuZy4gaW4gY29udGV4dCBvZiBwb3N0LXByb2Nlc3NpbmcuCiAgICAJICoKICAgIAkgKiBAdHlwZSB7P0RlcHRoVGV4dHVyZX0KICAgIAkgKiBAZGVmYXVsdCBudWxsCiAgICAJICovCiAgICAJZ2V0IGRlcHRoVGV4dHVyZSgpIHsKCiAgICAJCXJldHVybiB0aGlzLl9kZXB0aFRleHR1cmU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgc2l6ZSBvZiB0aGlzIHJlbmRlciB0YXJnZXQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSBkZXB0aC4KICAgIAkgKi8KICAgIAlzZXRTaXplKCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCA9IDEgKSB7CgogICAgCQlpZiAoIHRoaXMud2lkdGggIT09IHdpZHRoIHx8IHRoaXMuaGVpZ2h0ICE9PSBoZWlnaHQgfHwgdGhpcy5kZXB0aCAhPT0gZGVwdGggKSB7CgogICAgCQkJdGhpcy53aWR0aCA9IHdpZHRoOwogICAgCQkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAJCQl0aGlzLmRlcHRoID0gZGVwdGg7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRoaXMudGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS53aWR0aCA9IHdpZHRoOwogICAgCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5oZWlnaHQgPSBoZWlnaHQ7CiAgICAJCQkJdGhpcy50ZXh0dXJlc1sgaSBdLmltYWdlLmRlcHRoID0gZGVwdGg7CiAgICAJCQkJdGhpcy50ZXh0dXJlc1sgaSBdLmlzQXJyYXlUZXh0dXJlID0gdGhpcy50ZXh0dXJlc1sgaSBdLmltYWdlLmRlcHRoID4gMTsKCiAgICAJCQl9CgogICAgCQkJdGhpcy5kaXNwb3NlKCk7CgogICAgCQl9CgogICAgCQl0aGlzLnZpZXdwb3J0LnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwogICAgCQl0aGlzLnNjaXNzb3Iuc2V0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyByZW5kZXIgdGFyZ2V0IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtSZW5kZXJUYXJnZXR9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHNldHRpbmdzIG9mIHRoZSBnaXZlbiByZW5kZXIgdGFyZ2V0LiBUaGlzIGlzIGEgc3RydWN0dXJhbCBjb3B5IHNvCiAgICAJICogbm8gcmVzb3VyY2VzIGFyZSBzaGFyZWQgYmV0d2VlbiByZW5kZXIgdGFyZ2V0cyBhZnRlciB0aGUgY29weS4gVGhhdCBpbmNsdWRlcwogICAgCSAqIGFsbCBNUlQgdGV4dHVyZXMgYW5kIHRoZSBkZXB0aCB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtSZW5kZXJUYXJnZXR9IHNvdXJjZSAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7UmVuZGVyVGFyZ2V0fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXRoaXMud2lkdGggPSBzb3VyY2Uud2lkdGg7CiAgICAJCXRoaXMuaGVpZ2h0ID0gc291cmNlLmhlaWdodDsKICAgIAkJdGhpcy5kZXB0aCA9IHNvdXJjZS5kZXB0aDsKCiAgICAJCXRoaXMuc2Npc3Nvci5jb3B5KCBzb3VyY2Uuc2Npc3NvciApOwogICAgCQl0aGlzLnNjaXNzb3JUZXN0ID0gc291cmNlLnNjaXNzb3JUZXN0OwoKICAgIAkJdGhpcy52aWV3cG9ydC5jb3B5KCBzb3VyY2Uudmlld3BvcnQgKTsKCiAgICAJCXRoaXMudGV4dHVyZXMubGVuZ3RoID0gMDsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBzb3VyY2UudGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJdGhpcy50ZXh0dXJlc1sgaSBdID0gc291cmNlLnRleHR1cmVzWyBpIF0uY2xvbmUoKTsKICAgIAkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwogICAgCQkJdGhpcy50ZXh0dXJlc1sgaSBdLnJlbmRlclRhcmdldCA9IHRoaXM7CgogICAgCQkJLy8gZW5zdXJlIGltYWdlIG9iamVjdCBpcyBub3Qgc2hhcmVkLCBzZWUgIzIwMzI4CgogICAgCQkJY29uc3QgaW1hZ2UgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnRleHR1cmVzWyBpIF0uaW1hZ2UgKTsKICAgIAkJCXRoaXMudGV4dHVyZXNbIGkgXS5zb3VyY2UgPSBuZXcgU291cmNlKCBpbWFnZSApOwoKICAgIAkJfQoKICAgIAkJdGhpcy5kZXB0aEJ1ZmZlciA9IHNvdXJjZS5kZXB0aEJ1ZmZlcjsKICAgIAkJdGhpcy5zdGVuY2lsQnVmZmVyID0gc291cmNlLnN0ZW5jaWxCdWZmZXI7CgogICAgCQl0aGlzLnJlc29sdmVEZXB0aEJ1ZmZlciA9IHNvdXJjZS5yZXNvbHZlRGVwdGhCdWZmZXI7CiAgICAJCXRoaXMucmVzb2x2ZVN0ZW5jaWxCdWZmZXIgPSBzb3VyY2UucmVzb2x2ZVN0ZW5jaWxCdWZmZXI7CgogICAgCQlpZiAoIHNvdXJjZS5kZXB0aFRleHR1cmUgIT09IG51bGwgKSB0aGlzLmRlcHRoVGV4dHVyZSA9IHNvdXJjZS5kZXB0aFRleHR1cmUuY2xvbmUoKTsKCiAgICAJCXRoaXMuc2FtcGxlcyA9IHNvdXJjZS5zYW1wbGVzOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRnJlZXMgdGhlIEdQVS1yZWxhdGVkIHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzCiAgICAJICogbWV0aG9kIHdoZW5ldmVyIHRoaXMgaW5zdGFuY2UgaXMgbm8gbG9uZ2VyIHVzZWQgaW4geW91ciBhcHAuCiAgICAJICoKICAgIAkgKiBAZmlyZXMgUmVuZGVyVGFyZ2V0I2Rpc3Bvc2UKICAgIAkgKi8KICAgIAlkaXNwb3NlKCkgewoKICAgIAkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIHJlbmRlciB0YXJnZXQgdXNlZCBpbiBjb250ZXh0IG9mIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgUmVuZGVyVGFyZ2V0CiAgICAgKi8KICAgIGNsYXNzIFdlYkdMUmVuZGVyVGFyZ2V0IGV4dGVuZHMgUmVuZGVyVGFyZ2V0IHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyAzRCByZW5kZXIgdGFyZ2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aCBvZiB0aGUgcmVuZGVyIHRhcmdldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQgb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJICogQHBhcmFtIHtSZW5kZXJUYXJnZXR+T3B0aW9uc30gW29wdGlvbnNdIC0gVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIG9wdGlvbnMgPSB7fSApIHsKCiAgICAJCXN1cGVyKCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1dlYkdMUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYW4gYXJyYXkgb2YgdGV4dHVyZXMgZGlyZWN0bHkgZnJvbSByYXcgYnVmZmVyIGRhdGEuCiAgICAgKgogICAgICogQGF1Z21lbnRzIFRleHR1cmUKICAgICAqLwogICAgY2xhc3MgRGF0YUFycmF5VGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGRhdGEgYXJyYXkgdGV4dHVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7P1R5cGVkQXJyYXl9IFtkYXRhPW51bGxdIC0gVGhlIGJ1ZmZlciBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHRleHR1cmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGggb2YgdGhlIHRleHR1cmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCiAgICAJCXN1cGVyKCBudWxsICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0RhdGFBcnJheVRleHR1cmUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBpbWFnZSBkZWZpbml0aW9uIG9mIGEgZGF0YSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7e2RhdGE6VHlwZWRBcnJheSx3aWR0aDpudW1iZXIsaGVpZ2h0Om51bWJlcixkZXB0aDpudW1iZXJ9fQogICAgCQkgKi8KICAgIAkJdGhpcy5pbWFnZSA9IHsgZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggfTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgc2FtcGxlZCB3aGVuIGEgdGV4ZWwgY292ZXJzIG1vcmUgdGhhbiBvbmUgcGl4ZWwuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYE5lYXJlc3RGaWx0ZXJgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyfExpbmVhckZpbHRlcnxMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyfExpbmVhck1pcG1hcExpbmVhckZpbHRlcil9CiAgICAJCSAqIEBkZWZhdWx0IE5lYXJlc3RGaWx0ZXIKICAgIAkJICovCiAgICAJCXRoaXMubWFnRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgc2FtcGxlZCB3aGVuIGEgdGV4ZWwgY292ZXJzIGxlc3MgdGhhbiBvbmUgcGl4ZWwuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYE5lYXJlc3RGaWx0ZXJgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyfExpbmVhckZpbHRlcnxMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyfExpbmVhck1pcG1hcExpbmVhckZpbHRlcil9CiAgICAJCSAqIEBkZWZhdWx0IE5lYXJlc3RGaWx0ZXIKICAgIAkJICovCiAgICAJCXRoaXMubWluRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGlzIHdyYXBwZWQgaW4gdGhlIGRlcHRoIGFuZCBjb3JyZXNwb25kcyB0bwogICAgCQkgKiAqVyogaW4gVVZXIG1hcHBpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoUmVwZWF0V3JhcHBpbmd8Q2xhbXBUb0VkZ2VXcmFwcGluZ3xNaXJyb3JlZFJlcGVhdFdyYXBwaW5nKX0KICAgIAkJICogQGRlZmF1bHQgQ2xhbXBUb0VkZ2VXcmFwcGluZwogICAgCQkgKi8KICAgIAkJdGhpcy53cmFwUiA9IENsYW1wVG9FZGdlV3JhcHBpbmc7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgdGV4dHVyZSBpcyBmbGlwcGVkIGFsb25nIHRoZSB2ZXJ0aWNhbCBheGlzIHdoZW4KICAgIAkJICogdXBsb2FkZWQgdG8gdGhlIEdQVS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFNwZWNpZmllcyB0aGUgYWxpZ25tZW50IHJlcXVpcmVtZW50cyBmb3IgdGhlIHN0YXJ0IG9mIGVhY2ggcGl4ZWwgcm93IGluIG1lbW9yeS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgMWAgYnkgZGVmYXVsdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMudW5wYWNrQWxpZ25tZW50ID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBBIHNldCBvZiBhbGwgbGF5ZXJzIHdoaWNoIG5lZWQgdG8gYmUgdXBkYXRlZCBpbiB0aGUgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1NldDxudW1iZXI+fQogICAgCQkgKi8KICAgIAkJdGhpcy5sYXllclVwZGF0ZXMgPSBuZXcgU2V0KCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGVzY3JpYmVzIHRoYXQgYSBzcGVjaWZpYyBsYXllciBvZiB0aGUgdGV4dHVyZSBuZWVkcyB0byBiZSB1cGRhdGVkLgogICAgCSAqIE5vcm1hbGx5IHdoZW4ge0BsaW5rIFRleHR1cmUjbmVlZHNVcGRhdGV9IGlzIHNldCB0byBgdHJ1ZWAsIHRoZQogICAgCSAqIGVudGlyZSBkYXRhIHRleHR1cmUgYXJyYXkgaXMgc2VudCB0byB0aGUgR1BVLiBNYXJraW5nIHNwZWNpZmljCiAgICAJICogbGF5ZXJzIHdpbGwgb25seSB0cmFuc21pdCBzdWJzZXRzIG9mIGFsbCBtaXBtYXBzIGFzc29jaWF0ZWQgd2l0aCBhCiAgICAJICogc3BlY2lmaWMgZGVwdGggaW4gdGhlIGFycmF5IHdoaWNoIGlzIG9mdGVuIG11Y2ggbW9yZSBwZXJmb3JtYW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxheWVySW5kZXggLSBUaGUgbGF5ZXIgaW5kZXggdGhhdCBzaG91bGQgYmUgdXBkYXRlZC4KICAgIAkgKi8KICAgIAlhZGRMYXllclVwZGF0ZSggbGF5ZXJJbmRleCApIHsKCiAgICAJCXRoaXMubGF5ZXJVcGRhdGVzLmFkZCggbGF5ZXJJbmRleCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlc2V0cyB0aGUgbGF5ZXIgdXBkYXRlcyByZWdpc3RyeS4KICAgIAkgKi8KICAgIAljbGVhckxheWVyVXBkYXRlcygpIHsKCiAgICAJCXRoaXMubGF5ZXJVcGRhdGVzLmNsZWFyKCk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgdGhyZWUtZGltZW5zaW9uYWwgdGV4dHVyZSBmcm9tIHJhdyBkYXRhLCB3aXRoIHBhcmFtZXRlcnMgdG8KICAgICAqIGRpdmlkZSBpdCBpbnRvIHdpZHRoLCBoZWlnaHQsIGFuZCBkZXB0aC4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgVGV4dHVyZQogICAgICovCiAgICBjbGFzcyBEYXRhM0RUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgZGF0YSBhcnJheSB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHs/VHlwZWRBcnJheX0gW2RhdGE9bnVsbF0gLSBUaGUgYnVmZmVyIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQgb2YgdGhlIHRleHR1cmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSBkZXB0aCBvZiB0aGUgdGV4dHVyZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggZGF0YSA9IG51bGwsIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZGVwdGggPSAxICkgewoKICAgIAkJLy8gV2UncmUgZ29pbmcgdG8gYWRkIC5zZXRYWFgoKSBtZXRob2RzIGZvciBzZXR0aW5nIHByb3BlcnRpZXMgbGF0ZXIuCiAgICAJCS8vIFVzZXJzIGNhbiBzdGlsbCBzZXQgaW4gRGF0YTNEVGV4dHVyZSBkaXJlY3RseS4KICAgIAkJLy8KICAgIAkJLy8JY29uc3QgdGV4dHVyZSA9IG5ldyBUSFJFRS5EYXRhM0RUZXh0dXJlKCBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCApOwogICAgCQkvLyAJdGV4dHVyZS5hbmlzb3Ryb3B5ID0gMTY7CiAgICAJCS8vCiAgICAJCS8vIFNlZSAjMTQ4MzkKCiAgICAJCXN1cGVyKCBudWxsICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0RhdGEzRFRleHR1cmUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBpbWFnZSBkZWZpbml0aW9uIG9mIGEgZGF0YSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7e2RhdGE6VHlwZWRBcnJheSx3aWR0aDpudW1iZXIsaGVpZ2h0Om51bWJlcixkZXB0aDpudW1iZXJ9fQogICAgCQkgKi8KICAgIAkJdGhpcy5pbWFnZSA9IHsgZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggfTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgc2FtcGxlZCB3aGVuIGEgdGV4ZWwgY292ZXJzIG1vcmUgdGhhbiBvbmUgcGl4ZWwuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYE5lYXJlc3RGaWx0ZXJgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyfExpbmVhckZpbHRlcnxMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyfExpbmVhck1pcG1hcExpbmVhckZpbHRlcil9CiAgICAJCSAqIEBkZWZhdWx0IE5lYXJlc3RGaWx0ZXIKICAgIAkJICovCiAgICAJCXRoaXMubWFnRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgc2FtcGxlZCB3aGVuIGEgdGV4ZWwgY292ZXJzIGxlc3MgdGhhbiBvbmUgcGl4ZWwuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYE5lYXJlc3RGaWx0ZXJgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlcnxOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyfExpbmVhckZpbHRlcnxMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyfExpbmVhck1pcG1hcExpbmVhckZpbHRlcil9CiAgICAJCSAqIEBkZWZhdWx0IE5lYXJlc3RGaWx0ZXIKICAgIAkJICovCiAgICAJCXRoaXMubWluRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGlzIHdyYXBwZWQgaW4gdGhlIGRlcHRoIGFuZCBjb3JyZXNwb25kcyB0bwogICAgCQkgKiAqVyogaW4gVVZXIG1hcHBpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoUmVwZWF0V3JhcHBpbmd8Q2xhbXBUb0VkZ2VXcmFwcGluZ3xNaXJyb3JlZFJlcGVhdFdyYXBwaW5nKX0KICAgIAkJICogQGRlZmF1bHQgQ2xhbXBUb0VkZ2VXcmFwcGluZwogICAgCQkgKi8KICAgIAkJdGhpcy53cmFwUiA9IENsYW1wVG9FZGdlV3JhcHBpbmc7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgdGV4dHVyZSBpcyBmbGlwcGVkIGFsb25nIHRoZSB2ZXJ0aWNhbCBheGlzIHdoZW4KICAgIAkJICogdXBsb2FkZWQgdG8gdGhlIEdQVS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFNwZWNpZmllcyB0aGUgYWxpZ25tZW50IHJlcXVpcmVtZW50cyBmb3IgdGhlIHN0YXJ0IG9mIGVhY2ggcGl4ZWwgcm93IGluIG1lbW9yeS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgMWAgYnkgZGVmYXVsdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMudW5wYWNrQWxpZ25tZW50ID0gMTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFJlcHJlc2VudHMgYW4gYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveCAoQUFCQikgaW4gM0Qgc3BhY2UuCiAgICAgKi8KICAgIGNsYXNzIEJveDMgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW21pbj0oSW5maW5pdHksSW5maW5pdHksSW5maW5pdHkpXSAtIEEgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFttYXg9KC1JbmZpbml0eSwtSW5maW5pdHksLUluZmluaXR5KV0gLSBBIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIHVwcGVyIGJvdW5kYXJ5IG9mIHRoZSBib3guCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIG1pbiA9IG5ldyBWZWN0b3IzKCArIEluZmluaXR5LCArIEluZmluaXR5LCArIEluZmluaXR5ICksIG1heCA9IG5ldyBWZWN0b3IzKCAtIEluZmluaXR5LCAtIEluZmluaXR5LCAtIEluZmluaXR5ICkgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0JveDMgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBsb3dlciBib3VuZGFyeSBvZiB0aGUgYm94LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMubWluID0gbWluOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgYm94LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMubWF4ID0gbWF4OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGxvd2VyIGFuZCB1cHBlciBib3VuZGFyaWVzIG9mIHRoaXMgYm94LgogICAgCSAqIFBsZWFzZSBub3RlIHRoYXQgdGhpcyBtZXRob2Qgb25seSBjb3BpZXMgdGhlIHZhbHVlcyBmcm9tIHRoZSBnaXZlbiBvYmplY3RzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBtaW4gLSBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IG1heCAtIFRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgYm94LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCXNldCggbWluLCBtYXggKSB7CgogICAgCQl0aGlzLm1pbi5jb3B5KCBtaW4gKTsKICAgIAkJdGhpcy5tYXguY29weSggbWF4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB1cHBlciBhbmQgbG93ZXIgYm91bmRzIG9mIHRoaXMgYm94IHNvIGl0IGVuY2xvc2VzIHRoZSBwb3NpdGlvbiBkYXRhCiAgICAJICogaW4gdGhlIGdpdmVuIGFycmF5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgM0QgcG9zaXRpb24gZGF0YS4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlzZXRGcm9tQXJyYXkoIGFycmF5ICkgewoKICAgIAkJdGhpcy5tYWtlRW1wdHkoKTsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhcnJheS5sZW5ndGg7IGkgPCBpbDsgaSArPSAzICkgewoKICAgIAkJCXRoaXMuZXhwYW5kQnlQb2ludCggX3ZlY3RvciRiLmZyb21BcnJheSggYXJyYXksIGkgKSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJveCBzbyBpdCBlbmNsb3NlcyB0aGUgcG9zaXRpb24gZGF0YQogICAgCSAqIGluIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIEEgYnVmZmVyIGF0dHJpYnV0ZSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEuCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlICkgewoKICAgIAkJdGhpcy5tYWtlRW1wdHkoKTsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhdHRyaWJ1dGUuY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkgKSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJveCBzbyBpdCBlbmNsb3NlcyB0aGUgcG9zaXRpb24gZGF0YQogICAgCSAqIGluIHRoZSBnaXZlbiBhcnJheS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8VmVjdG9yMz59IHBvaW50cyAtIEFuIGFycmF5IGhvbGRpbmcgM0QgcG9zaXRpb24gZGF0YSBhcyBpbnN0YW5jZXMgb2Yge0BsaW5rIFZlY3RvcjN9LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCXNldEZyb21Qb2ludHMoIHBvaW50cyApIHsKCiAgICAJCXRoaXMubWFrZUVtcHR5KCk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCXRoaXMuZXhwYW5kQnlQb2ludCggcG9pbnRzWyBpIF0gKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENlbnRlcnMgdGhpcyBib3ggb24gdGhlIGdpdmVuIGNlbnRlciB2ZWN0b3IgYW5kIHNldHMgdGhpcyBib3gncyB3aWR0aCwgaGVpZ2h0IGFuZAogICAgCSAqIGRlcHRoIHRvIHRoZSBnaXZlbiBzaXplIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gY2VudGVyIC0gVGhlIGNlbnRlciBvZiB0aGUgYm94LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gc2l6ZSAtIFRoZSB4LCB5IGFuZCB6IGRpbWVuc2lvbnMgb2YgdGhlIGJveC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlzZXRGcm9tQ2VudGVyQW5kU2l6ZSggY2VudGVyLCBzaXplICkgewoKICAgIAkJY29uc3QgaGFsZlNpemUgPSBfdmVjdG9yJGIuY29weSggc2l6ZSApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCiAgICAJCXRoaXMubWluLmNvcHkoIGNlbnRlciApLnN1YiggaGFsZlNpemUgKTsKICAgIAkJdGhpcy5tYXguY29weSggY2VudGVyICkuYWRkKCBoYWxmU2l6ZSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHdvcmxkLWF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggZm9yIHRoZSBnaXZlbiAzRCBvYmplY3QKICAgIAkgKiAoaW5jbHVkaW5nIGl0cyBjaGlsZHJlbiksIGFjY291bnRpbmcgZm9yIHRoZSBvYmplY3QncywgYW5kIGNoaWxkcmVuJ3MsCiAgICAJICogd29ybGQgdHJhbnNmb3Jtcy4gVGhlIGZ1bmN0aW9uIG1heSByZXN1bHQgaW4gYSBsYXJnZXIgYm94IHRoYW4gc3RyaWN0bHkgbmVjZXNzYXJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0byBjb21wdXRlIHRoZSBib3VuZGluZyBib3ggZm9yLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3ByZWNpc2U9ZmFsc2VdIC0gSWYgc2V0IHRvIGB0cnVlYCwgdGhlIG1ldGhvZCBjb21wdXRlcyB0aGUgc21hbGxlc3QKICAgIAkgKiB3b3JsZC1heGlzLWFsaWduZWQgYm91bmRpbmcgYm94IGF0IHRoZSBleHBlbnNlIG9mIG1vcmUgY29tcHV0YXRpb24uCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJc2V0RnJvbU9iamVjdCggb2JqZWN0LCBwcmVjaXNlID0gZmFsc2UgKSB7CgogICAgCQl0aGlzLm1ha2VFbXB0eSgpOwoKICAgIAkJcmV0dXJuIHRoaXMuZXhwYW5kQnlPYmplY3QoIG9iamVjdCwgcHJlY2lzZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgYm94IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGJveCB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJY29weSggYm94ICkgewoKICAgIAkJdGhpcy5taW4uY29weSggYm94Lm1pbiApOwogICAgCQl0aGlzLm1heC5jb3B5KCBib3gubWF4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNYWtlcyB0aGlzIGJveCBlbXB0eSB3aGljaCBtZWFucyBpbiBlbmNsb3NlcyBhIHplcm8gc3BhY2UgaW4gM0QuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAltYWtlRW1wdHkoKSB7CgogICAgCQl0aGlzLm1pbi54ID0gdGhpcy5taW4ueSA9IHRoaXMubWluLnogPSArIEluZmluaXR5OwogICAgCQl0aGlzLm1heC54ID0gdGhpcy5tYXgueSA9IHRoaXMubWF4LnogPSAtIEluZmluaXR5OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYm94IGluY2x1ZGVzIHplcm8gcG9pbnRzIHdpdGhpbiBpdHMgYm91bmRzLgogICAgCSAqIE5vdGUgdGhhdCBhIGJveCB3aXRoIGVxdWFsIGxvd2VyIGFuZCB1cHBlciBib3VuZHMgc3RpbGwgaW5jbHVkZXMgb25lCiAgICAJICogcG9pbnQsIHRoZSBvbmUgYm90aCBib3VuZHMgc2hhcmUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm94IGlzIGVtcHR5IG9yIG5vdC4KICAgIAkgKi8KICAgIAlpc0VtcHR5KCkgewoKICAgIAkJLy8gdGhpcyBpcyBhIG1vcmUgcm9idXN0IGNoZWNrIGZvciBlbXB0eSB0aGFuICggdm9sdW1lIDw9IDAgKSBiZWNhdXNlIHZvbHVtZSBjYW4gZ2V0IHBvc2l0aXZlIHdpdGggdHdvIG5lZ2F0aXZlIGF4ZXMKCiAgICAJCXJldHVybiAoIHRoaXMubWF4LnggPCB0aGlzLm1pbi54ICkgfHwgKCB0aGlzLm1heC55IDwgdGhpcy5taW4ueSApIHx8ICggdGhpcy5tYXgueiA8IHRoaXMubWluLnogKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBjZW50ZXIgcG9pbnQgb2YgdGhpcyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjZW50ZXIgcG9pbnQuCiAgICAJICovCiAgICAJZ2V0Q2VudGVyKCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwLCAwICkgOiB0YXJnZXQuYWRkVmVjdG9ycyggdGhpcy5taW4sIHRoaXMubWF4ICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGRpbWVuc2lvbnMgb2YgdGhpcyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBzaXplLgogICAgCSAqLwogICAgCWdldFNpemUoIHRhcmdldCApIHsKCiAgICAJCXJldHVybiB0aGlzLmlzRW1wdHkoKSA/IHRhcmdldC5zZXQoIDAsIDAsIDAgKSA6IHRhcmdldC5zdWJWZWN0b3JzKCB0aGlzLm1heCwgdGhpcy5taW4gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHBhbmRzIHRoZSBib3VuZGFyaWVzIG9mIHRoaXMgYm94IHRvIGluY2x1ZGUgdGhlIGdpdmVuIHBvaW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0aGF0IHNob3VsZCBiZSBpbmNsdWRlZCBieSB0aGUgYm91bmRpbmcgYm94LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWV4cGFuZEJ5UG9pbnQoIHBvaW50ICkgewoKICAgIAkJdGhpcy5taW4ubWluKCBwb2ludCApOwogICAgCQl0aGlzLm1heC5tYXgoIHBvaW50ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHBhbmRzIHRoaXMgYm94IGVxdWlsYXRlcmFsbHkgYnkgdGhlIGdpdmVuIHZlY3Rvci4gVGhlIHdpZHRoIG9mIHRoaXMKICAgIAkgKiBib3ggd2lsbCBiZSBleHBhbmRlZCBieSB0aGUgeCBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBpbiBib3RoCiAgICAJICogZGlyZWN0aW9ucy4gVGhlIGhlaWdodCBvZiB0aGlzIGJveCB3aWxsIGJlIGV4cGFuZGVkIGJ5IHRoZSB5IGNvbXBvbmVudCBvZgogICAgCSAqIHRoZSB2ZWN0b3IgaW4gYm90aCBkaXJlY3Rpb25zLiBUaGUgZGVwdGggb2YgdGhpcyBib3ggd2lsbCBiZQogICAgCSAqIGV4cGFuZGVkIGJ5IHRoZSB6IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGluIGJvdGggZGlyZWN0aW9ucy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0aGF0IHNob3VsZCBleHBhbmQgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlleHBhbmRCeVZlY3RvciggdmVjdG9yICkgewoKICAgIAkJdGhpcy5taW4uc3ViKCB2ZWN0b3IgKTsKICAgIAkJdGhpcy5tYXguYWRkKCB2ZWN0b3IgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEV4cGFuZHMgZWFjaCBkaW1lbnNpb24gb2YgdGhlIGJveCBieSB0aGUgZ2l2ZW4gc2NhbGFyLiBJZiBuZWdhdGl2ZSwgdGhlCiAgICAJICogZGltZW5zaW9ucyBvZiB0aGUgYm94IHdpbGwgYmUgY29udHJhY3RlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHZhbHVlIHRoYXQgc2hvdWxkIGV4cGFuZCB0aGUgYm91bmRpbmcgYm94LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWV4cGFuZEJ5U2NhbGFyKCBzY2FsYXIgKSB7CgogICAgCQl0aGlzLm1pbi5hZGRTY2FsYXIoIC0gc2NhbGFyICk7CiAgICAJCXRoaXMubWF4LmFkZFNjYWxhciggc2NhbGFyICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHBhbmRzIHRoZSBib3VuZGFyaWVzIG9mIHRoaXMgYm94IHRvIGluY2x1ZGUgdGhlIGdpdmVuIDNEIG9iamVjdCBhbmQKICAgIAkgKiBpdHMgY2hpbGRyZW4sIGFjY291bnRpbmcgZm9yIHRoZSBvYmplY3QncywgYW5kIGNoaWxkcmVuJ3MsIHdvcmxkCiAgICAJICogdHJhbnNmb3Jtcy4gVGhlIGZ1bmN0aW9uIG1heSByZXN1bHQgaW4gYSBsYXJnZXIgYm94IHRoYW4gc3RyaWN0bHkKICAgIAkgKiBuZWNlc3NhcnkgKHVubGVzcyB0aGUgcHJlY2lzZSBwYXJhbWV0ZXIgaXMgc2V0IHRvIHRydWUpLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0aGF0IHNob3VsZCBleHBhbmQgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IHByZWNpc2UgLSBJZiBzZXQgdG8gYHRydWVgLCB0aGUgbWV0aG9kIGV4cGFuZHMgdGhlIGJvdW5kaW5nIGJveAogICAgCSAqIGFzIGxpdHRsZSBhcyBuZWNlc3NhcnkgYXQgdGhlIGV4cGVuc2Ugb2YgbW9yZSBjb21wdXRhdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlleHBhbmRCeU9iamVjdCggb2JqZWN0LCBwcmVjaXNlID0gZmFsc2UgKSB7CgogICAgCQkvLyBDb21wdXRlcyB0aGUgd29ybGQtYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveCBvZiBhbiBvYmplY3QgKGluY2x1ZGluZyBpdHMgY2hpbGRyZW4pLAogICAgCQkvLyBhY2NvdW50aW5nIGZvciBib3RoIHRoZSBvYmplY3QncywgYW5kIGNoaWxkcmVuJ3MsIHdvcmxkIHRyYW5zZm9ybXMKCiAgICAJCW9iamVjdC51cGRhdGVXb3JsZE1hdHJpeCggZmFsc2UsIGZhbHNlICk7CgogICAgCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKCiAgICAJCWlmICggZ2VvbWV0cnkgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKICAgIAkJCS8vIHByZWNpc2UgQUFCQiBjb21wdXRhdGlvbiBiYXNlZCBvbiB2ZXJ0ZXggZGF0YSByZXF1aXJlcyBhdCBsZWFzdCBhIHBvc2l0aW9uIGF0dHJpYnV0ZS4KICAgIAkJCS8vIGluc3RhbmNpbmcgaXNuJ3Qgc3VwcG9ydGVkIHNvIGZhciBhbmQgdXNlcyB0aGUgbm9ybWFsIChjb25zZXJ2YXRpdmUpIGNvZGUgcGF0aC4KCiAgICAJCQlpZiAoIHByZWNpc2UgPT09IHRydWUgJiYgcG9zaXRpb25BdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCAmJiBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICE9PSB0cnVlICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQlpZiAoIG9iamVjdC5pc01lc2ggPT09IHRydWUgKSB7CgogICAgCQkJCQkJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBpLCBfdmVjdG9yJGIgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJX3ZlY3RvciRiLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlfdmVjdG9yJGIuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKICAgIAkJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWlmICggb2JqZWN0LmJvdW5kaW5nQm94ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkvLyBvYmplY3QtbGV2ZWwgYm91bmRpbmcgYm94CgogICAgCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCiAgICAJCQkJCQlvYmplY3QuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgogICAgCQkJCQl9CgogICAgCQkJCQlfYm94JDQuY29weSggb2JqZWN0LmJvdW5kaW5nQm94ICk7CgoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gZ2VvbWV0cnktbGV2ZWwgYm91bmRpbmcgYm94CgogICAgCQkJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKICAgIAkJCQkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJX2JveCQ0LmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nQm94ICk7CgogICAgCQkJCX0KCiAgICAJCQkJX2JveCQ0LmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgogICAgCQkJCXRoaXMudW5pb24oIF9ib3gkNCApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWNvbnN0IGNoaWxkcmVuID0gb2JqZWN0LmNoaWxkcmVuOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQl0aGlzLmV4cGFuZEJ5T2JqZWN0KCBjaGlsZHJlblsgaSBdLCBwcmVjaXNlICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gcG9pbnQgbGllcyB3aXRoaW4gb3Igb24gdGhlIGJvdW5kYXJpZXMgb2YgdGhpcyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYm91bmRpbmcgYm94IGNvbnRhaW5zIHRoZSBnaXZlbiBwb2ludCBvciBub3QuCiAgICAJICovCiAgICAJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgogICAgCQlyZXR1cm4gcG9pbnQueCA+PSB0aGlzLm1pbi54ICYmIHBvaW50LnggPD0gdGhpcy5tYXgueCAmJgogICAgCQkJcG9pbnQueSA+PSB0aGlzLm1pbi55ICYmIHBvaW50LnkgPD0gdGhpcy5tYXgueSAmJgogICAgCQkJcG9pbnQueiA+PSB0aGlzLm1pbi56ICYmIHBvaW50LnogPD0gdGhpcy5tYXguejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGJvdW5kaW5nIGJveCBpbmNsdWRlcyB0aGUgZW50aXJldHkgb2YgdGhlIGdpdmVuIGJvdW5kaW5nIGJveC4KICAgIAkgKiBJZiB0aGlzIGJveCBhbmQgdGhlIGdpdmVuIG9uZSBhcmUgaWRlbnRpY2FsLCB0aGlzIGZ1bmN0aW9uIGFsc28gcmV0dXJucyBgdHJ1ZWAuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBib3ggY29udGFpbnMgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBvciBub3QuCiAgICAJICovCiAgICAJY29udGFpbnNCb3goIGJveCApIHsKCiAgICAJCXJldHVybiB0aGlzLm1pbi54IDw9IGJveC5taW4ueCAmJiBib3gubWF4LnggPD0gdGhpcy5tYXgueCAmJgogICAgCQkJdGhpcy5taW4ueSA8PSBib3gubWluLnkgJiYgYm94Lm1heC55IDw9IHRoaXMubWF4LnkgJiYKICAgIAkJCXRoaXMubWluLnogPD0gYm94Lm1pbi56ICYmIGJveC5tYXgueiA8PSB0aGlzLm1heC56OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBwb2ludCBhcyBhIHByb3BvcnRpb24gb2YgdGhpcyBib3gncyB3aWR0aCwgaGVpZ2h0IGFuZCBkZXB0aC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gQSBwb2ludCBhcyBhIHByb3BvcnRpb24gb2YgdGhpcyBib3gncyB3aWR0aCwgaGVpZ2h0IGFuZCBkZXB0aC4KICAgIAkgKi8KICAgIAlnZXRQYXJhbWV0ZXIoIHBvaW50LCB0YXJnZXQgKSB7CgogICAgCQkvLyBUaGlzIGNhbiBwb3RlbnRpYWxseSBoYXZlIGEgZGl2aWRlIGJ5IHplcm8gaWYgdGhlIGJveAogICAgCQkvLyBoYXMgYSBzaXplIGRpbWVuc2lvbiBvZiAwLgoKICAgIAkJcmV0dXJuIHRhcmdldC5zZXQoCiAgICAJCQkoIHBvaW50LnggLSB0aGlzLm1pbi54ICkgLyAoIHRoaXMubWF4LnggLSB0aGlzLm1pbi54ICksCiAgICAJCQkoIHBvaW50LnkgLSB0aGlzLm1pbi55ICkgLyAoIHRoaXMubWF4LnkgLSB0aGlzLm1pbi55ICksCiAgICAJCQkoIHBvaW50LnogLSB0aGlzLm1pbi56ICkgLyAoIHRoaXMubWF4LnogLSB0aGlzLm1pbi56ICkKICAgIAkJKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJvdW5kaW5nIGJveCB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0JveCggYm94ICkgewoKICAgIAkJLy8gdXNpbmcgNiBzcGxpdHRpbmcgcGxhbmVzIHRvIHJ1bGUgb3V0IGludGVyc2VjdGlvbnMuCiAgICAJCXJldHVybiBib3gubWF4LnggPj0gdGhpcy5taW4ueCAmJiBib3gubWluLnggPD0gdGhpcy5tYXgueCAmJgogICAgCQkJYm94Lm1heC55ID49IHRoaXMubWluLnkgJiYgYm94Lm1pbi55IDw9IHRoaXMubWF4LnkgJiYKICAgIAkJCWJveC5tYXgueiA+PSB0aGlzLm1pbi56ICYmIGJveC5taW4ueiA8PSB0aGlzLm1heC56OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBib3VuZGluZyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBib3VuZGluZyBzcGhlcmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCiAgICAJCS8vIEZpbmQgdGhlIHBvaW50IG9uIHRoZSBBQUJCIGNsb3Nlc3QgdG8gdGhlIHNwaGVyZSBjZW50ZXIuCiAgICAJCXRoaXMuY2xhbXBQb2ludCggc3BoZXJlLmNlbnRlciwgX3ZlY3RvciRiICk7CgogICAgCQkvLyBJZiB0aGF0IHBvaW50IGlzIGluc2lkZSB0aGUgc3BoZXJlLCB0aGUgQUFCQiBhbmQgc3BoZXJlIGludGVyc2VjdC4KICAgIAkJcmV0dXJuIF92ZWN0b3IkYi5kaXN0YW5jZVRvU3F1YXJlZCggc3BoZXJlLmNlbnRlciApIDw9ICggc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gcGxhbmUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBwbGFuZSBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJaW50ZXJzZWN0c1BsYW5lKCBwbGFuZSApIHsKCiAgICAJCS8vIFdlIGNvbXB1dGUgdGhlIG1pbmltdW0gYW5kIG1heGltdW0gZG90IHByb2R1Y3QgdmFsdWVzLiBJZiB0aG9zZSB2YWx1ZXMKICAgIAkJLy8gYXJlIG9uIHRoZSBzYW1lIHNpZGUgKGJhY2sgb3IgZnJvbnQpIG9mIHRoZSBwbGFuZSwgdGhlbiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24uCgogICAgCQlsZXQgbWluLCBtYXg7CgogICAgCQlpZiAoIHBsYW5lLm5vcm1hbC54ID4gMCApIHsKCiAgICAJCQltaW4gPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWluLng7CiAgICAJCQltYXggPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWF4Lng7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCW1pbiA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKICAgIAkJCW1heCA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5taW4ueDsKCiAgICAJCX0KCiAgICAJCWlmICggcGxhbmUubm9ybWFsLnkgPiAwICkgewoKICAgIAkJCW1pbiArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWluLnk7CiAgICAJCQltYXggKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1heC55OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQltaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1heC55OwogICAgCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5taW4ueTsKCiAgICAJCX0KCiAgICAJCWlmICggcGxhbmUubm9ybWFsLnogPiAwICkgewoKICAgIAkJCW1pbiArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CiAgICAJCQltYXggKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1heC56OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQltaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1heC56OwogICAgCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5taW4uejsKCiAgICAJCX0KCiAgICAJCXJldHVybiAoIG1pbiA8PSAtIHBsYW5lLmNvbnN0YW50ICYmIG1heCA+PSAtIHBsYW5lLmNvbnN0YW50ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHRyaWFuZ2xlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VHJpYW5nbGV9IHRyaWFuZ2xlIC0gVGhlIHRyaWFuZ2xlIHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gdHJpYW5nbGUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWludGVyc2VjdHNUcmlhbmdsZSggdHJpYW5nbGUgKSB7CgogICAgCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKICAgIAkJCXJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJCS8vIGNvbXB1dGUgYm94IGNlbnRlciBhbmQgZXh0ZW50cwogICAgCQl0aGlzLmdldENlbnRlciggX2NlbnRlciApOwogICAgCQlfZXh0ZW50cy5zdWJWZWN0b3JzKCB0aGlzLm1heCwgX2NlbnRlciApOwoKICAgIAkJLy8gdHJhbnNsYXRlIHRyaWFuZ2xlIHRvIGFhYmIgb3JpZ2luCiAgICAJCV92MCQyLnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmEsIF9jZW50ZXIgKTsKICAgIAkJX3YxJDcuc3ViVmVjdG9ycyggdHJpYW5nbGUuYiwgX2NlbnRlciApOwogICAgCQlfdjIkNC5zdWJWZWN0b3JzKCB0cmlhbmdsZS5jLCBfY2VudGVyICk7CgogICAgCQkvLyBjb21wdXRlIGVkZ2UgdmVjdG9ycyBmb3IgdHJpYW5nbGUKICAgIAkJX2YwLnN1YlZlY3RvcnMoIF92MSQ3LCBfdjAkMiApOwogICAgCQlfZjEuc3ViVmVjdG9ycyggX3YyJDQsIF92MSQ3ICk7CiAgICAJCV9mMi5zdWJWZWN0b3JzKCBfdjAkMiwgX3YyJDQgKTsKCiAgICAJCS8vIHRlc3QgYWdhaW5zdCBheGVzIHRoYXQgYXJlIGdpdmVuIGJ5IGNyb3NzIHByb2R1Y3QgY29tYmluYXRpb25zIG9mIHRoZSBlZGdlcyBvZiB0aGUgdHJpYW5nbGUgYW5kIHRoZSBlZGdlcyBvZiB0aGUgYWFiYgogICAgCQkvLyBtYWtlIGFuIGF4aXMgdGVzdGluZyBvZiBlYWNoIG9mIHRoZSAzIHNpZGVzIG9mIHRoZSBhYWJiIGFnYWluc3QgZWFjaCBvZiB0aGUgMyBzaWRlcyBvZiB0aGUgdHJpYW5nbGUgPSA5IGF4aXMgb2Ygc2VwYXJhdGlvbgogICAgCQkvLyBheGlzX2lqID0gdV9pIHggZl9qICh1MCwgdTEsIHUyID0gZmFjZSBub3JtYWxzIG9mIGFhYmIgPSB4LHkseiBheGVzIHZlY3RvcnMgc2luY2UgYWFiYiBpcyBheGlzIGFsaWduZWQpCiAgICAJCWxldCBheGVzID0gWwogICAgCQkJMCwgLSBfZjAueiwgX2YwLnksIDAsIC0gX2YxLnosIF9mMS55LCAwLCAtIF9mMi56LCBfZjIueSwKICAgIAkJCV9mMC56LCAwLCAtIF9mMC54LCBfZjEueiwgMCwgLSBfZjEueCwgX2YyLnosIDAsIC0gX2YyLngsCiAgICAJCQktIF9mMC55LCBfZjAueCwgMCwgLSBfZjEueSwgX2YxLngsIDAsIC0gX2YyLnksIF9mMi54LCAwCiAgICAJCV07CiAgICAJCWlmICggISBzYXRGb3JBeGVzKCBheGVzLCBfdjAkMiwgX3YxJDcsIF92MiQ0LCBfZXh0ZW50cyApICkgewoKICAgIAkJCXJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJCS8vIHRlc3QgMyBmYWNlIG5vcm1hbHMgZnJvbSB0aGUgYWFiYgogICAgCQlheGVzID0gWyAxLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAxIF07CiAgICAJCWlmICggISBzYXRGb3JBeGVzKCBheGVzLCBfdjAkMiwgX3YxJDcsIF92MiQ0LCBfZXh0ZW50cyApICkgewoKICAgIAkJCXJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJCS8vIGZpbmFsbHkgdGVzdGluZyB0aGUgZmFjZSBub3JtYWwgb2YgdGhlIHRyaWFuZ2xlCiAgICAJCS8vIHVzZSBhbHJlYWR5IGV4aXN0aW5nIHRyaWFuZ2xlIGVkZ2UgdmVjdG9ycyBoZXJlCiAgICAJCV90cmlhbmdsZU5vcm1hbC5jcm9zc1ZlY3RvcnMoIF9mMCwgX2YxICk7CiAgICAJCWF4ZXMgPSBbIF90cmlhbmdsZU5vcm1hbC54LCBfdHJpYW5nbGVOb3JtYWwueSwgX3RyaWFuZ2xlTm9ybWFsLnogXTsKCiAgICAJCXJldHVybiBzYXRGb3JBeGVzKCBheGVzLCBfdjAkMiwgX3YxJDcsIF92MiQ0LCBfZXh0ZW50cyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENsYW1wcyB0aGUgZ2l2ZW4gcG9pbnQgd2l0aGluIHRoZSBib3VuZHMgb2YgdGhpcyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIGNsYW1wLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsYW1wZWQgcG9pbnQuCiAgICAJICovCiAgICAJY2xhbXBQb2ludCggcG9pbnQsIHRhcmdldCApIHsKCiAgICAJCXJldHVybiB0YXJnZXQuY29weSggcG9pbnQgKS5jbGFtcCggdGhpcy5taW4sIHRoaXMubWF4ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgZXVjbGlkZWFuIGRpc3RhbmNlIGZyb20gYW55IGVkZ2Ugb2YgdGhpcyBib3ggdG8gdGhlIHNwZWNpZmllZCBwb2ludC4gSWYKICAgIAkgKiB0aGUgZ2l2ZW4gcG9pbnQgbGllcyBpbnNpZGUgb2YgdGhpcyBib3gsIHRoZSBkaXN0YW5jZSB3aWxsIGJlIGAwYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgdG8uCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZXVjbGlkZWFuIGRpc3RhbmNlLgogICAgCSAqLwogICAgCWRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5jbGFtcFBvaW50KCBwb2ludCwgX3ZlY3RvciRiICkuZGlzdGFuY2VUbyggcG9pbnQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgYm91bmRpbmcgc3BoZXJlIHRoYXQgZW5jbG9zZXMgdGhpcyBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gdGFyZ2V0IC0gVGhlIHRhcmdldCBzcGhlcmUgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBUaGUgYm91bmRpbmcgc3BoZXJlIHRoYXQgZW5jbG9zZXMgdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJZ2V0Qm91bmRpbmdTcGhlcmUoIHRhcmdldCApIHsKCiAgICAJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgogICAgCQkJdGFyZ2V0Lm1ha2VFbXB0eSgpOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aGlzLmdldENlbnRlciggdGFyZ2V0LmNlbnRlciApOwoKICAgIAkJCXRhcmdldC5yYWRpdXMgPSB0aGlzLmdldFNpemUoIF92ZWN0b3IkYiApLmxlbmd0aCgpICogMC41OwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRhcmdldDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgaW50ZXJzZWN0aW9uIG9mIHRoaXMgYm91bmRpbmcgYm94IGFuZCB0aGUgZ2l2ZW4gb25lLCBzZXR0aW5nIHRoZSB1cHBlcgogICAgCSAqIGJvdW5kIG9mIHRoaXMgYm94IHRvIHRoZSBsZXNzZXIgb2YgdGhlIHR3byBib3hlcycgdXBwZXIgYm91bmRzIGFuZCB0aGUKICAgIAkgKiBsb3dlciBib3VuZCBvZiB0aGlzIGJveCB0byB0aGUgZ3JlYXRlciBvZiB0aGUgdHdvIGJveGVzJyBsb3dlciBib3VuZHMuIElmCiAgICAJICogdGhlcmUncyBubyBvdmVybGFwLCBtYWtlcyB0aGlzIGJveCBlbXB0eS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJvdW5kaW5nIGJveCB0byBpbnRlcnNlY3Qgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3QoIGJveCApIHsKCiAgICAJCXRoaXMubWluLm1heCggYm94Lm1pbiApOwogICAgCQl0aGlzLm1heC5taW4oIGJveC5tYXggKTsKCiAgICAJCS8vIGVuc3VyZSB0aGF0IGlmIHRoZXJlIGlzIG5vIG92ZXJsYXAsIHRoZSByZXN1bHQgaXMgZnVsbHkgZW1wdHksIG5vdCBzbGlnaHRseSBlbXB0eSB3aXRoIG5vbi1pbmYvK2luZiB2YWx1ZXMgdGhhdCB3aWxsIGNhdXNlIHN1YnNlcXVlbmNlIGludGVyc2VjdHMgdG8gZXJyb25lb3VzbHkgcmV0dXJuIHZhbGlkIHZhbHVlcy4KICAgIAkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHRoaXMubWFrZUVtcHR5KCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgdW5pb24gb2YgdGhpcyBib3ggYW5kIGFub3RoZXIgYW5kIHRoZSBnaXZlbiBvbmUsIHNldHRpbmcgdGhlIHVwcGVyCiAgICAJICogYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGdyZWF0ZXIgb2YgdGhlIHR3byBib3hlcycgdXBwZXIgYm91bmRzIGFuZCB0aGUKICAgIAkgKiBsb3dlciBib3VuZCBvZiB0aGlzIGJveCB0byB0aGUgbGVzc2VyIG9mIHRoZSB0d28gYm94ZXMnIGxvd2VyIGJvdW5kcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJvdW5kaW5nIGJveCB0aGF0IHdpbGwgYmUgdW5pb25lZCB3aXRoIHRoaXMgaW5zdGFuY2UuCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJdW5pb24oIGJveCApIHsKCiAgICAJCXRoaXMubWluLm1pbiggYm94Lm1pbiApOwogICAgCQl0aGlzLm1heC5tYXgoIGJveC5tYXggKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zZm9ybXMgdGhpcyBib3VuZGluZyBib3ggYnkgdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgogICAgCQkvLyB0cmFuc2Zvcm0gb2YgZW1wdHkgYm94IGlzIGFuIGVtcHR5IGJveC4KICAgIAkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHJldHVybiB0aGlzOwoKICAgIAkJLy8gTk9URTogSSBhbSB1c2luZyBhIGJpbmFyeSBwYXR0ZXJuIHRvIHNwZWNpZnkgYWxsIDJeMyBjb21iaW5hdGlvbnMgYmVsb3cKICAgIAkJX3BvaW50c1sgMCBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAwMAogICAgCQlfcG9pbnRzWyAxIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDAxCiAgICAJCV9wb2ludHNbIDIgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWF4LnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMTAKICAgIAkJX3BvaW50c1sgMyBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAxMQogICAgCQlfcG9pbnRzWyA0IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAwCiAgICAJCV9wb2ludHNbIDUgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWluLnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMDEKICAgIAkJX3BvaW50c1sgNiBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDExMAogICAgCQlfcG9pbnRzWyA3IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1heC55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTExCgogICAgCQl0aGlzLnNldEZyb21Qb2ludHMoIF9wb2ludHMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIG9mZnNldCB0byBib3RoIHRoZSB1cHBlciBhbmQgbG93ZXIgYm91bmRzIG9mIHRoaXMgYm91bmRpbmcgYm94LAogICAgCSAqIGVmZmVjdGl2ZWx5IG1vdmluZyBpdCBpbiAzRCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gb2Zmc2V0IC0gVGhlIG9mZnNldCB0aGF0IHNob3VsZCBiZSB1c2VkIHRvIHRyYW5zbGF0ZSB0aGUgYm91bmRpbmcgYm94LgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCXRyYW5zbGF0ZSggb2Zmc2V0ICkgewoKICAgIAkJdGhpcy5taW4uYWRkKCBvZmZzZXQgKTsKICAgIAkJdGhpcy5tYXguYWRkKCBvZmZzZXQgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgYm91bmRpbmcgYm94IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgYm94IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIGJveCApIHsKCiAgICAJCXJldHVybiBib3gubWluLmVxdWFscyggdGhpcy5taW4gKSAmJiBib3gubWF4LmVxdWFscyggdGhpcy5tYXggKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgc2VyaWFsaXplZCBzdHJ1Y3R1cmUgb2YgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge09iamVjdH0gU2VyaWFsaXplZCBzdHJ1Y3R1cmUgd2l0aCBmaWVsZHMgcmVwcmVzZW50aW5nIHRoZSBvYmplY3Qgc3RhdGUuCiAgICAJICovCiAgICAJdG9KU09OKCkgewoKICAgIAkJcmV0dXJuIHsKICAgIAkJCW1pbjogdGhpcy5taW4udG9BcnJheSgpLAogICAgCQkJbWF4OiB0aGlzLm1heC50b0FycmF5KCkKICAgIAkJfTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgc2VyaWFsaXplZCBzdHJ1Y3R1cmUgb2YgdGhlIGJvdW5kaW5nIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBqc29uIC0gVGhlIHNlcmlhbGl6ZWQganNvbiB0byBzZXQgdGhlIGJveCBmcm9tLgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgogICAgCSAqLwogICAgCWZyb21KU09OKCBqc29uICkgewoKICAgIAkJdGhpcy5taW4uZnJvbUFycmF5KCBqc29uLm1pbiApOwogICAgCQl0aGlzLm1heC5mcm9tQXJyYXkoIGpzb24ubWF4ICk7CiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF9wb2ludHMgPSBbCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKQogICAgXTsKCiAgICBjb25zdCBfdmVjdG9yJGIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX2JveCQ0ID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwoKICAgIC8vIHRyaWFuZ2xlIGNlbnRlcmVkIHZlcnRpY2VzCgogICAgY29uc3QgX3YwJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdjEkNyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92MiQ0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIC8vIHRyaWFuZ2xlIGVkZ2UgdmVjdG9ycwoKICAgIGNvbnN0IF9mMCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9mMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9mMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfY2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX2V4dGVudHMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdHJpYW5nbGVOb3JtYWwgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdGVzdEF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgZnVuY3Rpb24gc2F0Rm9yQXhlcyggYXhlcywgdjAsIHYxLCB2MiwgZXh0ZW50cyApIHsKCiAgICAJZm9yICggbGV0IGkgPSAwLCBqID0gYXhlcy5sZW5ndGggLSAzOyBpIDw9IGo7IGkgKz0gMyApIHsKCiAgICAJCV90ZXN0QXhpcy5mcm9tQXJyYXkoIGF4ZXMsIGkgKTsKICAgIAkJLy8gcHJvamVjdCB0aGUgYWFiYiBvbnRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKICAgIAkJY29uc3QgciA9IGV4dGVudHMueCAqIE1hdGguYWJzKCBfdGVzdEF4aXMueCApICsgZXh0ZW50cy55ICogTWF0aC5hYnMoIF90ZXN0QXhpcy55ICkgKyBleHRlbnRzLnogKiBNYXRoLmFicyggX3Rlc3RBeGlzLnogKTsKICAgIAkJLy8gcHJvamVjdCBhbGwgMyB2ZXJ0aWNlcyBvZiB0aGUgdHJpYW5nbGUgb250byB0aGUgc2VwYXJhdGluZyBheGlzCiAgICAJCWNvbnN0IHAwID0gdjAuZG90KCBfdGVzdEF4aXMgKTsKICAgIAkJY29uc3QgcDEgPSB2MS5kb3QoIF90ZXN0QXhpcyApOwogICAgCQljb25zdCBwMiA9IHYyLmRvdCggX3Rlc3RBeGlzICk7CiAgICAJCS8vIGFjdHVhbCB0ZXN0LCBiYXNpY2FsbHkgc2VlIGlmIGVpdGhlciBvZiB0aGUgbW9zdCBleHRyZW1lIG9mIHRoZSB0cmlhbmdsZSBwb2ludHMgaW50ZXJzZWN0cyByCiAgICAJCWlmICggTWF0aC5tYXgoIC0gTWF0aC5tYXgoIHAwLCBwMSwgcDIgKSwgTWF0aC5taW4oIHAwLCBwMSwgcDIgKSApID4gciApIHsKCiAgICAJCQkvLyBwb2ludHMgb2YgdGhlIHByb2plY3RlZCB0cmlhbmdsZSBhcmUgb3V0c2lkZSB0aGUgcHJvamVjdGVkIGhhbGYtbGVuZ3RoIG9mIHRoZSBhYWJiCiAgICAJCQkvLyB0aGUgYXhpcyBpcyBzZXBhcmF0aW5nIGFuZCB3ZSBjYW4gZXhpdAogICAgCQkJcmV0dXJuIGZhbHNlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiB0cnVlOwoKICAgIH0KCiAgICBjb25zdCBfYm94JDMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CiAgICBjb25zdCBfdjEkNiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92MiQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIC8qKgogICAgICogQW4gYW5hbHl0aWNhbCAzRCBzcGhlcmUgZGVmaW5lZCBieSBhIGNlbnRlciBhbmQgcmFkaXVzLiBUaGlzIGNsYXNzIGlzIG1haW5seQogICAgICogdXNlZCBhcyBhIEJvdW5kaW5nIFNwaGVyZSBmb3IgM0Qgb2JqZWN0cy4KICAgICAqLwogICAgY2xhc3MgU3BoZXJlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBzcGhlcmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtjZW50ZXI9KDAsMCwwKV0gLSBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3JhZGl1cz0tMV0gLSBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGNlbnRlciA9IG5ldyBWZWN0b3IzKCksIHJhZGl1cyA9IC0xICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNTcGhlcmUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZQogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMuY2VudGVyID0gY2VudGVyOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICovCiAgICAJCXRoaXMucmFkaXVzID0gcmFkaXVzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHNwaGVyZSdzIGNvbXBvbmVudHMgYnkgY29weWluZyB0aGUgZ2l2ZW4gdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBjZW50ZXIgLSBUaGUgY2VudGVyLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgLSBUaGUgcmFkaXVzLgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJc2V0KCBjZW50ZXIsIHJhZGl1cyApIHsKCiAgICAJCXRoaXMuY2VudGVyLmNvcHkoIGNlbnRlciApOwogICAgCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBtaW5pbXVtIGJvdW5kaW5nIHNwaGVyZSBmb3IgbGlzdCBvZiBwb2ludHMuCiAgICAJICogSWYgdGhlIG9wdGlvbmFsIGNlbnRlciBwb2ludCBpcyBnaXZlbiwgaXQgaXMgdXNlZCBhcyB0aGUgc3BoZXJlJ3MKICAgIAkgKiBjZW50ZXIuIE90aGVyd2lzZSwgdGhlIGNlbnRlciBvZiB0aGUgYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveAogICAgCSAqIGVuY29tcGFzc2luZyB0aGUgcG9pbnRzIGlzIGNhbGN1bGF0ZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBIGxpc3Qgb2YgcG9pbnRzIGluIDNEIHNwYWNlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW29wdGlvbmFsQ2VudGVyXSAtIFRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZS4KICAgIAkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgogICAgCSAqLwogICAgCXNldEZyb21Qb2ludHMoIHBvaW50cywgb3B0aW9uYWxDZW50ZXIgKSB7CgogICAgCQljb25zdCBjZW50ZXIgPSB0aGlzLmNlbnRlcjsKCiAgICAJCWlmICggb3B0aW9uYWxDZW50ZXIgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQljZW50ZXIuY29weSggb3B0aW9uYWxDZW50ZXIgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJX2JveCQzLnNldEZyb21Qb2ludHMoIHBvaW50cyApLmdldENlbnRlciggY2VudGVyICk7CgogICAgCQl9CgogICAgCQlsZXQgbWF4UmFkaXVzU3EgPSAwOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQltYXhSYWRpdXNTcSA9IE1hdGgubWF4KCBtYXhSYWRpdXNTcSwgY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBwb2ludHNbIGkgXSApICk7CgogICAgCQl9CgogICAgCQl0aGlzLnJhZGl1cyA9IE1hdGguc3FydCggbWF4UmFkaXVzU3EgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBzcGhlcmUgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgc3BoZXJlIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KICAgIAkgKi8KICAgIAljb3B5KCBzcGhlcmUgKSB7CgogICAgCQl0aGlzLmNlbnRlci5jb3B5KCBzcGhlcmUuY2VudGVyICk7CiAgICAJCXRoaXMucmFkaXVzID0gc3BoZXJlLnJhZGl1czsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBzcGhlcmUgaXMgZW1wdHkgKHRoZSByYWRpdXMgc2V0IHRvIGEgbmVnYXRpdmUgbnVtYmVyKS4KICAgIAkgKgogICAgCSAqIFNwaGVyZXMgd2l0aCBhIHJhZGl1cyBvZiBgMGAgY29udGFpbiBvbmx5IHRoZWlyIGNlbnRlciBwb2ludCBhbmQgYXJlIG5vdAogICAgCSAqIGNvbnNpZGVyZWQgdG8gYmUgZW1wdHkuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGlzIGVtcHR5IG9yIG5vdC4KICAgIAkgKi8KICAgIAlpc0VtcHR5KCkgewoKICAgIAkJcmV0dXJuICggdGhpcy5yYWRpdXMgPCAwICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTWFrZXMgdGhpcyBzcGhlcmUgZW1wdHkgd2hpY2ggbWVhbnMgaW4gZW5jbG9zZXMgYSB6ZXJvIHNwYWNlIGluIDNELgogICAgCSAqCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KICAgIAkgKi8KICAgIAltYWtlRW1wdHkoKSB7CgogICAgCQl0aGlzLmNlbnRlci5zZXQoIDAsIDAsIDAgKTsKICAgIAkJdGhpcy5yYWRpdXMgPSAtMTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGNvbnRhaW5zIHRoZSBnaXZlbiBwb2ludCBpbmNsdXNpdmUgb2YKICAgIAkgKiB0aGUgc3VyZmFjZSBvZiB0aGUgc3BoZXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjaGVjay4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGNvbnRhaW5zIHRoZSBnaXZlbiBwb2ludCBvciBub3QuCiAgICAJICovCiAgICAJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgogICAgCQlyZXR1cm4gKCBwb2ludC5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGNsb3Nlc3QgZGlzdGFuY2UgZnJvbSB0aGUgYm91bmRhcnkgb2YgdGhlIHNwaGVyZSB0byB0aGUKICAgIAkgKiBnaXZlbiBwb2ludC4gSWYgdGhlIHNwaGVyZSBjb250YWlucyB0aGUgcG9pbnQsIHRoZSBkaXN0YW5jZSB3aWxsCiAgICAJICogYmUgbmVnYXRpdmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRpc3RhbmNlIHRvIHRoZSBwb2ludC4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKICAgIAkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUbyggdGhpcy5jZW50ZXIgKSAtIHRoaXMucmFkaXVzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBvbmUgb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCiAgICAJCWNvbnN0IHJhZGl1c1N1bSA9IHRoaXMucmFkaXVzICsgc3BoZXJlLnJhZGl1czsKCiAgICAJCXJldHVybiBzcGhlcmUuY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCB0aGlzLmNlbnRlciApIDw9ICggcmFkaXVzU3VtICogcmFkaXVzU3VtICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBib3guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94IG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzQm94KCBib3ggKSB7CgogICAgCQlyZXR1cm4gYm94LmludGVyc2VjdHNTcGhlcmUoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUgb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNQbGFuZSggcGxhbmUgKSB7CgogICAgCQlyZXR1cm4gTWF0aC5hYnMoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5jZW50ZXIgKSApIDw9IHRoaXMucmFkaXVzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENsYW1wcyBhIHBvaW50IHdpdGhpbiB0aGUgc3BoZXJlLiBJZiB0aGUgcG9pbnQgaXMgb3V0c2lkZSB0aGUgc3BoZXJlLCBpdAogICAgCSAqIHdpbGwgY2xhbXAgaXQgdG8gdGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIGVkZ2Ugb2YgdGhlIHNwaGVyZS4gUG9pbnRzCiAgICAJICogYWxyZWFkeSBpbnNpZGUgdGhlIHNwaGVyZSB3aWxsIG5vdCBiZSBhZmZlY3RlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcGxhbmUgdG8gY2xhbXAuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2xhbXBlZCBwb2ludC4KICAgIAkgKi8KICAgIAljbGFtcFBvaW50KCBwb2ludCwgdGFyZ2V0ICkgewoKICAgIAkJY29uc3QgZGVsdGFMZW5ndGhTcSA9IHRoaXMuY2VudGVyLmRpc3RhbmNlVG9TcXVhcmVkKCBwb2ludCApOwoKICAgIAkJdGFyZ2V0LmNvcHkoIHBvaW50ICk7CgogICAgCQlpZiAoIGRlbHRhTGVuZ3RoU3EgPiAoIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgKSApIHsKCiAgICAJCQl0YXJnZXQuc3ViKCB0aGlzLmNlbnRlciApLm5vcm1hbGl6ZSgpOwogICAgCQkJdGFyZ2V0Lm11bHRpcGx5U2NhbGFyKCB0aGlzLnJhZGl1cyApLmFkZCggdGhpcy5jZW50ZXIgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIGJvdW5kaW5nIGJveCB0aGF0IGVuY2xvc2VzIHRoaXMgc3BoZXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IGJveCB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtCb3gzfSBUaGUgYm91bmRpbmcgYm94IHRoYXQgZW5jbG9zZXMgdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJZ2V0Qm91bmRpbmdCb3goIHRhcmdldCApIHsKCiAgICAJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgogICAgCQkJLy8gRW1wdHkgc3BoZXJlIHByb2R1Y2VzIGVtcHR5IGJvdW5kaW5nIGJveAogICAgCQkJdGFyZ2V0Lm1ha2VFbXB0eSgpOwogICAgCQkJcmV0dXJuIHRhcmdldDsKCiAgICAJCX0KCiAgICAJCXRhcmdldC5zZXQoIHRoaXMuY2VudGVyLCB0aGlzLmNlbnRlciApOwogICAgCQl0YXJnZXQuZXhwYW5kQnlTY2FsYXIoIHRoaXMucmFkaXVzICk7CgogICAgCQlyZXR1cm4gdGFyZ2V0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zZm9ybXMgdGhpcyBzcGhlcmUgd2l0aCB0aGUgZ2l2ZW4gNHg0IHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKICAgIAkJdGhpcy5jZW50ZXIuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKICAgIAkJdGhpcy5yYWRpdXMgPSB0aGlzLnJhZGl1cyAqIG1hdHJpeC5nZXRNYXhTY2FsZU9uQXhpcygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNsYXRlcyB0aGUgc3BoZXJlJ3MgY2VudGVyIGJ5IHRoZSBnaXZlbiBvZmZzZXQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQuCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGUoIG9mZnNldCApIHsKCiAgICAJCXRoaXMuY2VudGVyLmFkZCggb2Zmc2V0ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHBhbmRzIHRoZSBib3VuZGFyaWVzIG9mIHRoaXMgc3BoZXJlIHRvIGluY2x1ZGUgdGhlIGdpdmVuIHBvaW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBpbmNsdWRlLgogICAgCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCiAgICAJICovCiAgICAJZXhwYW5kQnlQb2ludCggcG9pbnQgKSB7CgogICAgCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKICAgIAkJCXRoaXMuY2VudGVyLmNvcHkoIHBvaW50ICk7CgogICAgCQkJdGhpcy5yYWRpdXMgPSAwOwoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJX3YxJDYuc3ViVmVjdG9ycyggcG9pbnQsIHRoaXMuY2VudGVyICk7CgogICAgCQljb25zdCBsZW5ndGhTcSA9IF92MSQ2Lmxlbmd0aFNxKCk7CgogICAgCQlpZiAoIGxlbmd0aFNxID4gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKSB7CgogICAgCQkJLy8gY2FsY3VsYXRlIHRoZSBtaW5pbWFsIHNwaGVyZQoKICAgIAkJCWNvbnN0IGxlbmd0aCA9IE1hdGguc3FydCggbGVuZ3RoU3EgKTsKCiAgICAJCQljb25zdCBkZWx0YSA9ICggbGVuZ3RoIC0gdGhpcy5yYWRpdXMgKSAqIDAuNTsKCiAgICAJCQl0aGlzLmNlbnRlci5hZGRTY2FsZWRWZWN0b3IoIF92MSQ2LCBkZWx0YSAvIGxlbmd0aCApOwoKICAgIAkJCXRoaXMucmFkaXVzICs9IGRlbHRhOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRXhwYW5kcyB0aGlzIHNwaGVyZSB0byBlbmNsb3NlIGJvdGggdGhlIG9yaWdpbmFsIHNwaGVyZSBhbmQgdGhlIGdpdmVuIHNwaGVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgc3BoZXJlIHRvIGluY2x1ZGUuCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KICAgIAkgKi8KICAgIAl1bmlvbiggc3BoZXJlICkgewoKICAgIAkJaWYgKCBzcGhlcmUuaXNFbXB0eSgpICkgewoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCiAgICAJCQl0aGlzLmNvcHkoIHNwaGVyZSApOwoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmNlbnRlci5lcXVhbHMoIHNwaGVyZS5jZW50ZXIgKSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkgdGhpcy5yYWRpdXMgPSBNYXRoLm1heCggdGhpcy5yYWRpdXMsIHNwaGVyZS5yYWRpdXMgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJX3YyJDMuc3ViVmVjdG9ycyggc3BoZXJlLmNlbnRlciwgdGhpcy5jZW50ZXIgKS5zZXRMZW5ndGgoIHNwaGVyZS5yYWRpdXMgKTsKCiAgICAJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92MSQ2LmNvcHkoIHNwaGVyZS5jZW50ZXIgKS5hZGQoIF92MiQzICkgKTsKCiAgICAJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92MSQ2LmNvcHkoIHNwaGVyZS5jZW50ZXIgKS5zdWIoIF92MiQzICkgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgc3BoZXJlIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBib3VuZGluZyBzcGhlcmUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggc3BoZXJlICkgewoKICAgIAkJcmV0dXJuIHNwaGVyZS5jZW50ZXIuZXF1YWxzKCB0aGlzLmNlbnRlciApICYmICggc3BoZXJlLnJhZGl1cyA9PT0gdGhpcy5yYWRpdXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IHNwaGVyZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7U3BoZXJlfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBzcGhlcmUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtPYmplY3R9IFNlcmlhbGl6ZWQgc3RydWN0dXJlIHdpdGggZmllbGRzIHJlcHJlc2VudGluZyB0aGUgb2JqZWN0IHN0YXRlLgogICAgCSAqLwogICAgCXRvSlNPTigpIHsKCiAgICAJCXJldHVybiB7CiAgICAJCQlyYWRpdXM6IHRoaXMucmFkaXVzLAogICAgCQkJY2VudGVyOiB0aGlzLmNlbnRlci50b0FycmF5KCkKICAgIAkJfTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgc2VyaWFsaXplZCBzdHJ1Y3R1cmUgb2YgdGhlIGJvdW5kaW5nIHNwaGVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBqc29uIC0gVGhlIHNlcmlhbGl6ZWQganNvbiB0byBzZXQgdGhlIHNwaGVyZSBmcm9tLgogICAgCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgc3BoZXJlLgogICAgCSAqLwogICAgCWZyb21KU09OKCBqc29uICkgewoKICAgIAkJdGhpcy5yYWRpdXMgPSBqc29uLnJhZGl1czsKICAgIAkJdGhpcy5jZW50ZXIuZnJvbUFycmF5KCBqc29uLmNlbnRlciApOwogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfdmVjdG9yJGEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfc2VnQ2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3NlZ0RpciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9kaWZmID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGNvbnN0IF9lZGdlMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9lZGdlMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9ub3JtYWwkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICAvKioKICAgICAqIEEgcmF5IHRoYXQgZW1pdHMgZnJvbSBhbiBvcmlnaW4gaW4gYSBjZXJ0YWluIGRpcmVjdGlvbi4gVGhlIGNsYXNzIGlzIHVzZWQgYnkKICAgICAqIHtAbGluayBSYXljYXN0ZXJ9IHRvIGFzc2lzdCB3aXRoIHJheWNhc3RpbmcuIFJheWNhc3RpbmcgaXMgdXNlZCBmb3IKICAgICAqIG1vdXNlIHBpY2tpbmcgKHdvcmtpbmcgb3V0IHdoYXQgb2JqZWN0cyBpbiB0aGUgM0Qgc3BhY2UgdGhlIG1vdXNlIGlzIG92ZXIpCiAgICAgKiBhbW9uZ3N0IG90aGVyIHRoaW5ncy4KICAgICAqLwogICAgY2xhc3MgUmF5IHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyByYXkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcmlnaW49KDAsMCwwKV0gLSBUaGUgb3JpZ2luIG9mIHRoZSByYXkuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbZGlyZWN0aW9uPSgwLDAsLTEpXSAtIFRoZSAobm9ybWFsaXplZCkgZGlyZWN0aW9uIG9mIHRoZSByYXkuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIG9yaWdpbiA9IG5ldyBWZWN0b3IzKCksIGRpcmVjdGlvbiA9IG5ldyBWZWN0b3IzKCAwLCAwLCAtMSApICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBvcmlnaW4gb2YgdGhlIHJheS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLm9yaWdpbiA9IG9yaWdpbjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiBvZiB0aGUgcmF5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMuZGlyZWN0aW9uID0gZGlyZWN0aW9uOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHJheSdzIGNvbXBvbmVudHMgYnkgY29weWluZyB0aGUgZ2l2ZW4gdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBvcmlnaW4gLSBUaGUgb3JpZ2luLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gZGlyZWN0aW9uIC0gVGhlIGRpcmVjdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtSYXl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcmF5LgogICAgCSAqLwogICAgCXNldCggb3JpZ2luLCBkaXJlY3Rpb24gKSB7CgogICAgCQl0aGlzLm9yaWdpbi5jb3B5KCBvcmlnaW4gKTsKICAgIAkJdGhpcy5kaXJlY3Rpb24uY29weSggZGlyZWN0aW9uICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcmF5IHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1JheX0gcmF5IC0gVGhlIHJheSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge1JheX0gQSByZWZlcmVuY2UgdG8gdGhpcyByYXkuCiAgICAJICovCiAgICAJY29weSggcmF5ICkgewoKICAgIAkJdGhpcy5vcmlnaW4uY29weSggcmF5Lm9yaWdpbiApOwogICAgCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCByYXkuZGlyZWN0aW9uICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgdmVjdG9yIHRoYXQgaXMgbG9jYXRlZCBhdCBhIGdpdmVuIGRpc3RhbmNlIGFsb25nIHRoaXMgcmF5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHQgLSBUaGUgZGlzdGFuY2UgYWxvbmcgdGhlIHJheSB0byByZXRyaWV2ZSBhIHBvc2l0aW9uIGZvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcG9zaXRpb24gb24gdGhlIHJheS4KICAgIAkgKi8KICAgIAlhdCggdCwgdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIHRhcmdldC5jb3B5KCB0aGlzLm9yaWdpbiApLmFkZFNjYWxlZFZlY3RvciggdGhpcy5kaXJlY3Rpb24sIHQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGp1c3RzIHRoZSBkaXJlY3Rpb24gb2YgdGhlIHJheSB0byBwb2ludCBhdCB0aGUgZ2l2ZW4gdmVjdG9yIGluIHdvcmxkIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHRhcmdldCBwb3NpdGlvbi4KICAgIAkgKiBAcmV0dXJuIHtSYXl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcmF5LgogICAgCSAqLwogICAgCWxvb2tBdCggdiApIHsKCiAgICAJCXRoaXMuZGlyZWN0aW9uLmNvcHkoIHYgKS5zdWIoIHRoaXMub3JpZ2luICkubm9ybWFsaXplKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTaGlmdCB0aGUgb3JpZ2luIG9mIHRoaXMgcmF5IGFsb25nIGl0cyBkaXJlY3Rpb24gYnkgdGhlIGdpdmVuIGRpc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHQgLSBUaGUgZGlzdGFuY2UgYWxvbmcgdGhlIHJheSB0byBpbnRlcnBvbGF0ZS4KICAgIAkgKiBAcmV0dXJuIHtSYXl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcmF5LgogICAgCSAqLwogICAgCXJlY2FzdCggdCApIHsKCiAgICAJCXRoaXMub3JpZ2luLmNvcHkoIHRoaXMuYXQoIHQsIF92ZWN0b3IkYSApICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBwb2ludCBhbG9uZyB0aGlzIHJheSB0aGF0IGlzIGNsb3Nlc3QgdG8gdGhlIGdpdmVuIHBvaW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIEEgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gZ2V0IHRoZSBjbG9zZXQgbG9jYXRpb24gb24gdGhlIHJheSBmb3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2xvc2VzdCBwb2ludCBvbiB0aGlzIHJheS4KICAgIAkgKi8KICAgIAljbG9zZXN0UG9pbnRUb1BvaW50KCBwb2ludCwgdGFyZ2V0ICkgewoKICAgIAkJdGFyZ2V0LnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLm9yaWdpbiApOwoKICAgIAkJY29uc3QgZGlyZWN0aW9uRGlzdGFuY2UgPSB0YXJnZXQuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKICAgIAkJaWYgKCBkaXJlY3Rpb25EaXN0YW5jZSA8IDAgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCB0aGlzLm9yaWdpbiApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRhcmdldC5jb3B5KCB0aGlzLm9yaWdpbiApLmFkZFNjYWxlZFZlY3RvciggdGhpcy5kaXJlY3Rpb24sIGRpcmVjdGlvbkRpc3RhbmNlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgZGlzdGFuY2Ugb2YgdGhlIGNsb3Nlc3QgYXBwcm9hY2ggYmV0d2VlbiB0aGlzIHJheSBhbmQgdGhlIGdpdmVuIHBvaW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIEEgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgdG8uCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCiAgICAJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuZGlzdGFuY2VTcVRvUG9pbnQoIHBvaW50ICkgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBzcXVhcmVkIGRpc3RhbmNlIG9mIHRoZSBjbG9zZXN0IGFwcHJvYWNoIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBwb2ludC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VTcVRvUG9pbnQoIHBvaW50ICkgewoKICAgIAkJY29uc3QgZGlyZWN0aW9uRGlzdGFuY2UgPSBfdmVjdG9yJGEuc3ViVmVjdG9ycyggcG9pbnQsIHRoaXMub3JpZ2luICkuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKICAgIAkJLy8gcG9pbnQgYmVoaW5kIHRoZSByYXkKCiAgICAJCWlmICggZGlyZWN0aW9uRGlzdGFuY2UgPCAwICkgewoKICAgIAkJCXJldHVybiB0aGlzLm9yaWdpbi5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCiAgICAJCX0KCiAgICAJCV92ZWN0b3IkYS5jb3B5KCB0aGlzLm9yaWdpbiApLmFkZFNjYWxlZFZlY3RvciggdGhpcy5kaXJlY3Rpb24sIGRpcmVjdGlvbkRpc3RhbmNlICk7CgogICAgCQlyZXR1cm4gX3ZlY3RvciRhLmRpc3RhbmNlVG9TcXVhcmVkKCBwb2ludCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgYmV0d2VlbiB0aGlzIHJheSBhbmQgdGhlIGdpdmVuIGxpbmUgc2VnbWVudC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjAgLSBUaGUgc3RhcnQgcG9pbnQgb2YgdGhlIGxpbmUgc2VnbWVudC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVGhlIGVuZCBwb2ludCBvZiB0aGUgbGluZSBzZWdtZW50LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW29wdGlvbmFsUG9pbnRPblJheV0gLSBXaGVuIHByb3ZpZGVkLCBpdCByZWNlaXZlcyB0aGUgcG9pbnQgb24gdGhpcyByYXkgdGhhdCBpcyBjbG9zZXN0IHRvIHRoZSBzZWdtZW50LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW29wdGlvbmFsUG9pbnRPblNlZ21lbnRdIC0gV2hlbiBwcm92aWRlZCwgaXQgcmVjZWl2ZXMgdGhlIHBvaW50IG9uIHRoZSBsaW5lIHNlZ21lbnQgdGhhdCBpcyBjbG9zZXN0IHRvIHRoaXMgcmF5LgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgZGlzdGFuY2UuCiAgICAJICovCiAgICAJZGlzdGFuY2VTcVRvU2VnbWVudCggdjAsIHYxLCBvcHRpb25hbFBvaW50T25SYXksIG9wdGlvbmFsUG9pbnRPblNlZ21lbnQgKSB7CgogICAgCQkvLyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9wbWpvbmlhay9HZW9tZXRyaWNUb29scy9ibG9iL21hc3Rlci9HVEVuZ2luZS9JbmNsdWRlL01hdGhlbWF0aWNzL0d0ZURpc3RSYXlTZWdtZW50LmgKICAgIAkJLy8gSXQgcmV0dXJucyB0aGUgbWluIGRpc3RhbmNlIGJldHdlZW4gdGhlIHJheSBhbmQgdGhlIHNlZ21lbnQKICAgIAkJLy8gZGVmaW5lZCBieSB2MCBhbmQgdjEKICAgIAkJLy8gSXQgY2FuIGFsc28gc2V0IHR3byBvcHRpb25hbCB0YXJnZXRzIDoKICAgIAkJLy8gLSBUaGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgcmF5CiAgICAJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNlZ21lbnQKCiAgICAJCV9zZWdDZW50ZXIuY29weSggdjAgKS5hZGQoIHYxICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwogICAgCQlfc2VnRGlyLmNvcHkoIHYxICkuc3ViKCB2MCApLm5vcm1hbGl6ZSgpOwogICAgCQlfZGlmZi5jb3B5KCB0aGlzLm9yaWdpbiApLnN1YiggX3NlZ0NlbnRlciApOwoKICAgIAkJY29uc3Qgc2VnRXh0ZW50ID0gdjAuZGlzdGFuY2VUbyggdjEgKSAqIDAuNTsKICAgIAkJY29uc3QgYTAxID0gLSB0aGlzLmRpcmVjdGlvbi5kb3QoIF9zZWdEaXIgKTsKICAgIAkJY29uc3QgYjAgPSBfZGlmZi5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CiAgICAJCWNvbnN0IGIxID0gLSBfZGlmZi5kb3QoIF9zZWdEaXIgKTsKICAgIAkJY29uc3QgYyA9IF9kaWZmLmxlbmd0aFNxKCk7CiAgICAJCWNvbnN0IGRldCA9IE1hdGguYWJzKCAxIC0gYTAxICogYTAxICk7CiAgICAJCWxldCBzMCwgczEsIHNxckRpc3QsIGV4dERldDsKCiAgICAJCWlmICggZGV0ID4gMCApIHsKCiAgICAJCQkvLyBUaGUgcmF5IGFuZCBzZWdtZW50IGFyZSBub3QgcGFyYWxsZWwuCgogICAgCQkJczAgPSBhMDEgKiBiMSAtIGIwOwogICAgCQkJczEgPSBhMDEgKiBiMCAtIGIxOwogICAgCQkJZXh0RGV0ID0gc2VnRXh0ZW50ICogZGV0OwoKICAgIAkJCWlmICggczAgPj0gMCApIHsKCiAgICAJCQkJaWYgKCBzMSA+PSAtIGV4dERldCApIHsKCiAgICAJCQkJCWlmICggczEgPD0gZXh0RGV0ICkgewoKICAgIAkJCQkJCS8vIHJlZ2lvbiAwCiAgICAJCQkJCQkvLyBNaW5pbXVtIGF0IGludGVyaW9yIHBvaW50cyBvZiByYXkgYW5kIHNlZ21lbnQuCgogICAgCQkJCQkJY29uc3QgaW52RGV0ID0gMSAvIGRldDsKICAgIAkJCQkJCXMwICo9IGludkRldDsKICAgIAkJCQkJCXMxICo9IGludkRldDsKICAgIAkJCQkJCXNxckRpc3QgPSBzMCAqICggczAgKyBhMDEgKiBzMSArIDIgKiBiMCApICsgczEgKiAoIGEwMSAqIHMwICsgczEgKyAyICogYjEgKSArIGM7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCS8vIHJlZ2lvbiAxCgogICAgCQkJCQkJczEgPSBzZWdFeHRlbnQ7CiAgICAJCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CiAgICAJCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gcmVnaW9uIDUKCiAgICAJCQkJCXMxID0gLSBzZWdFeHRlbnQ7CiAgICAJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCBhMDEgKiBzMSArIGIwICkgKTsKICAgIAkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWlmICggczEgPD0gLSBleHREZXQgKSB7CgogICAgCQkJCQkvLyByZWdpb24gNAoKICAgIAkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIC0gYTAxICogc2VnRXh0ZW50ICsgYjAgKSApOwogICAgCQkJCQlzMSA9ICggczAgPiAwICkgPyAtIHNlZ0V4dGVudCA6IE1hdGgubWluKCBNYXRoLm1heCggLSBzZWdFeHRlbnQsIC0gYjEgKSwgc2VnRXh0ZW50ICk7CiAgICAJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgogICAgCQkJCX0gZWxzZSBpZiAoIHMxIDw9IGV4dERldCApIHsKCiAgICAJCQkJCS8vIHJlZ2lvbiAzCgogICAgCQkJCQlzMCA9IDA7CiAgICAJCQkJCXMxID0gTWF0aC5taW4oIE1hdGgubWF4KCAtIHNlZ0V4dGVudCwgLSBiMSApLCBzZWdFeHRlbnQgKTsKICAgIAkJCQkJc3FyRGlzdCA9IHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCS8vIHJlZ2lvbiAyCgogICAgCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogc2VnRXh0ZW50ICsgYjAgKSApOwogICAgCQkJCQlzMSA9ICggczAgPiAwICkgPyBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwogICAgCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQkvLyBSYXkgYW5kIHNlZ21lbnQgYXJlIHBhcmFsbGVsLgoKICAgIAkJCXMxID0gKCBhMDEgPiAwICkgPyAtIHNlZ0V4dGVudCA6IHNlZ0V4dGVudDsKICAgIAkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCBhMDEgKiBzMSArIGIwICkgKTsKICAgIAkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgogICAgCQl9CgogICAgCQlpZiAoIG9wdGlvbmFsUG9pbnRPblJheSApIHsKCiAgICAJCQlvcHRpb25hbFBvaW50T25SYXkuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBzMCApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBvcHRpb25hbFBvaW50T25TZWdtZW50ICkgewoKICAgIAkJCW9wdGlvbmFsUG9pbnRPblNlZ21lbnQuY29weSggX3NlZ0NlbnRlciApLmFkZFNjYWxlZFZlY3RvciggX3NlZ0RpciwgczEgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBzcXJEaXN0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gc3BoZXJlLCByZXR1cm5pbmcgdGhlIGludGVyc2VjdGlvbgogICAgCSAqIHBvaW50IG9yIGBudWxsYCBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbnRlcnNlY3QuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVyc2VjdGlvbiBwb2ludC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RTcGhlcmUoIHNwaGVyZSwgdGFyZ2V0ICkgewoKICAgIAkJX3ZlY3RvciRhLnN1YlZlY3RvcnMoIHNwaGVyZS5jZW50ZXIsIHRoaXMub3JpZ2luICk7CiAgICAJCWNvbnN0IHRjYSA9IF92ZWN0b3IkYS5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CiAgICAJCWNvbnN0IGQyID0gX3ZlY3RvciRhLmRvdCggX3ZlY3RvciRhICkgLSB0Y2EgKiB0Y2E7CiAgICAJCWNvbnN0IHJhZGl1czIgPSBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1czsKCiAgICAJCWlmICggZDIgPiByYWRpdXMyICkgcmV0dXJuIG51bGw7CgogICAgCQljb25zdCB0aGMgPSBNYXRoLnNxcnQoIHJhZGl1czIgLSBkMiApOwoKICAgIAkJLy8gdDAgPSBmaXJzdCBpbnRlcnNlY3QgcG9pbnQgLSBlbnRyYW5jZSBvbiBmcm9udCBvZiBzcGhlcmUKICAgIAkJY29uc3QgdDAgPSB0Y2EgLSB0aGM7CgogICAgCQkvLyB0MSA9IHNlY29uZCBpbnRlcnNlY3QgcG9pbnQgLSBleGl0IHBvaW50IG9uIGJhY2sgb2Ygc3BoZXJlCiAgICAJCWNvbnN0IHQxID0gdGNhICsgdGhjOwoKICAgIAkJLy8gdGVzdCB0byBzZWUgaWYgdDEgaXMgYmVoaW5kIHRoZSByYXkgLSBpZiBzbywgcmV0dXJuIG51bGwKICAgIAkJaWYgKCB0MSA8IDAgKSByZXR1cm4gbnVsbDsKCiAgICAJCS8vIHRlc3QgdG8gc2VlIGlmIHQwIGlzIGJlaGluZCB0aGUgcmF5OgogICAgCQkvLyBpZiBpdCBpcywgdGhlIHJheSBpcyBpbnNpZGUgdGhlIHNwaGVyZSwgc28gcmV0dXJuIHRoZSBzZWNvbmQgZXhpdCBwb2ludCBzY2FsZWQgYnkgdDEsCiAgICAJCS8vIGluIG9yZGVyIHRvIGFsd2F5cyByZXR1cm4gYW4gaW50ZXJzZWN0IHBvaW50IHRoYXQgaXMgaW4gZnJvbnQgb2YgdGhlIHJheS4KICAgIAkJaWYgKCB0MCA8IDAgKSByZXR1cm4gdGhpcy5hdCggdDEsIHRhcmdldCApOwoKICAgIAkJLy8gZWxzZSB0MCBpcyBpbiBmcm9udCBvZiB0aGUgcmF5LCBzbyByZXR1cm4gdGhlIGZpcnN0IGNvbGxpc2lvbiBwb2ludCBzY2FsZWQgYnkgdDAKICAgIAkJcmV0dXJuIHRoaXMuYXQoIHQwLCB0YXJnZXQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgc3BoZXJlIHRvIGludGVyc2VjdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gc3BoZXJlIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgogICAgCQlpZiAoIHNwaGVyZS5yYWRpdXMgPCAwICkgcmV0dXJuIGZhbHNlOyAvLyBoYW5kbGUgZW1wdHkgc3BoZXJlcywgc2VlICMzMTE4NwoKICAgIAkJcmV0dXJuIHRoaXMuZGlzdGFuY2VTcVRvUG9pbnQoIHNwaGVyZS5jZW50ZXIgKSA8PSAoIHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIHJheSdzIG9yaWdpbiB0byB0aGUgZ2l2ZW4gcGxhbmUuIFJldHVybnMgYG51bGxgIGlmIHRoZSByYXkKICAgIAkgKiBkb2VzIG5vdCBpbnRlcnNlY3Qgd2l0aCB0aGUgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KICAgIAkgKiBAcmV0dXJuIHs/bnVtYmVyfSBXaGV0aGVyIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gc3BoZXJlIG9yIG5vdC4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvUGxhbmUoIHBsYW5lICkgewoKICAgIAkJY29uc3QgZGVub21pbmF0b3IgPSBwbGFuZS5ub3JtYWwuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKICAgIAkJaWYgKCBkZW5vbWluYXRvciA9PT0gMCApIHsKCiAgICAJCQkvLyBsaW5lIGlzIGNvcGxhbmFyLCByZXR1cm4gb3JpZ2luCiAgICAJCQlpZiAoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5vcmlnaW4gKSA9PT0gMCApIHsKCiAgICAJCQkJcmV0dXJuIDA7CgogICAgCQkJfQoKICAgIAkJCS8vIE51bGwgaXMgcHJlZmVyYWJsZSB0byB1bmRlZmluZWQgc2luY2UgdW5kZWZpbmVkIG1lYW5zLi4uLiBpdCBpcyB1bmRlZmluZWQKCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHQgPSAtICggdGhpcy5vcmlnaW4uZG90KCBwbGFuZS5ub3JtYWwgKSArIHBsYW5lLmNvbnN0YW50ICkgLyBkZW5vbWluYXRvcjsKCiAgICAJCS8vIFJldHVybiBpZiB0aGUgcmF5IG5ldmVyIGludGVyc2VjdHMgdGhlIHBsYW5lCgogICAgCQlyZXR1cm4gdCA+PSAwID8gdCA6IG51bGw7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW50ZXJzZWN0cyB0aGlzIHJheSB3aXRoIHRoZSBnaXZlbiBwbGFuZSwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KICAgIAkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gaW50ZXJzZWN0LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCiAgICAJICovCiAgICAJaW50ZXJzZWN0UGxhbmUoIHBsYW5lLCB0YXJnZXQgKSB7CgogICAgCQljb25zdCB0ID0gdGhpcy5kaXN0YW5jZVRvUGxhbmUoIHBsYW5lICk7CgogICAgCQlpZiAoIHQgPT09IG51bGwgKSB7CgogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpcy5hdCggdCwgdGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGludGVyc2VjdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUgb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNQbGFuZSggcGxhbmUgKSB7CgogICAgCQkvLyBjaGVjayBpZiB0aGUgcmF5IGxpZXMgb24gdGhlIHBsYW5lIGZpcnN0CgogICAgCQljb25zdCBkaXN0VG9Qb2ludCA9IHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5vcmlnaW4gKTsKCiAgICAJCWlmICggZGlzdFRvUG9pbnQgPT09IDAgKSB7CgogICAgCQkJcmV0dXJuIHRydWU7CgogICAgCQl9CgogICAgCQljb25zdCBkZW5vbWluYXRvciA9IHBsYW5lLm5vcm1hbC5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgogICAgCQlpZiAoIGRlbm9taW5hdG9yICogZGlzdFRvUG9pbnQgPCAwICkgewoKICAgIAkJCXJldHVybiB0cnVlOwoKICAgIAkJfQoKICAgIAkJLy8gcmF5IG9yaWdpbiBpcyBiZWhpbmQgdGhlIHBsYW5lIChhbmQgaXMgcG9pbnRpbmcgYmVoaW5kIGl0KQoKICAgIAkJcmV0dXJuIGZhbHNlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94LCByZXR1cm5pbmcgdGhlIGludGVyc2VjdGlvbgogICAgCSAqIHBvaW50IG9yIGBudWxsYCBpZiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gaW50ZXJzZWN0LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCiAgICAJICovCiAgICAJaW50ZXJzZWN0Qm94KCBib3gsIHRhcmdldCApIHsKCiAgICAJCWxldCB0bWluLCB0bWF4LCB0eW1pbiwgdHltYXgsIHR6bWluLCB0em1heDsKCiAgICAJCWNvbnN0IGludmRpcnggPSAxIC8gdGhpcy5kaXJlY3Rpb24ueCwKICAgIAkJCWludmRpcnkgPSAxIC8gdGhpcy5kaXJlY3Rpb24ueSwKICAgIAkJCWludmRpcnogPSAxIC8gdGhpcy5kaXJlY3Rpb24uejsKCiAgICAJCWNvbnN0IG9yaWdpbiA9IHRoaXMub3JpZ2luOwoKICAgIAkJaWYgKCBpbnZkaXJ4ID49IDAgKSB7CgogICAgCQkJdG1pbiA9ICggYm94Lm1pbi54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CiAgICAJCQl0bWF4ID0gKCBib3gubWF4LnggLSBvcmlnaW4ueCApICogaW52ZGlyeDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdG1pbiA9ICggYm94Lm1heC54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CiAgICAJCQl0bWF4ID0gKCBib3gubWluLnggLSBvcmlnaW4ueCApICogaW52ZGlyeDsKCiAgICAJCX0KCiAgICAJCWlmICggaW52ZGlyeSA+PSAwICkgewoKICAgIAkJCXR5bWluID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKICAgIAkJCXR5bWF4ID0gKCBib3gubWF4LnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdHltaW4gPSAoIGJveC5tYXgueSAtIG9yaWdpbi55ICkgKiBpbnZkaXJ5OwogICAgCQkJdHltYXggPSAoIGJveC5taW4ueSAtIG9yaWdpbi55ICkgKiBpbnZkaXJ5OwoKICAgIAkJfQoKICAgIAkJaWYgKCAoIHRtaW4gPiB0eW1heCApIHx8ICggdHltaW4gPiB0bWF4ICkgKSByZXR1cm4gbnVsbDsKCiAgICAJCWlmICggdHltaW4gPiB0bWluIHx8IGlzTmFOKCB0bWluICkgKSB0bWluID0gdHltaW47CgogICAgCQlpZiAoIHR5bWF4IDwgdG1heCB8fCBpc05hTiggdG1heCApICkgdG1heCA9IHR5bWF4OwoKICAgIAkJaWYgKCBpbnZkaXJ6ID49IDAgKSB7CgogICAgCQkJdHptaW4gPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwogICAgCQkJdHptYXggPSAoIGJveC5tYXgueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0em1pbiA9ICggYm94Lm1heC56IC0gb3JpZ2luLnogKSAqIGludmRpcno7CiAgICAJCQl0em1heCA9ICggYm94Lm1pbi56IC0gb3JpZ2luLnogKSAqIGludmRpcno7CgogICAgCQl9CgogICAgCQlpZiAoICggdG1pbiA+IHR6bWF4ICkgfHwgKCB0em1pbiA+IHRtYXggKSApIHJldHVybiBudWxsOwoKICAgIAkJaWYgKCB0em1pbiA+IHRtaW4gfHwgdG1pbiAhPT0gdG1pbiApIHRtaW4gPSB0em1pbjsKCiAgICAJCWlmICggdHptYXggPCB0bWF4IHx8IHRtYXggIT09IHRtYXggKSB0bWF4ID0gdHptYXg7CgogICAgCQkvL3JldHVybiBwb2ludCBjbG9zZXN0IHRvIHRoZSByYXkgKHBvc2l0aXZlIHNpZGUpCgogICAgCQlpZiAoIHRtYXggPCAwICkgcmV0dXJuIG51bGw7CgogICAgCQlyZXR1cm4gdGhpcy5hdCggdG1pbiA+PSAwID8gdG1pbiA6IHRtYXgsIHRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIGludGVyc2VjdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94IG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzQm94KCBib3ggKSB7CgogICAgCQlyZXR1cm4gdGhpcy5pbnRlcnNlY3RCb3goIGJveCwgX3ZlY3RvciRhICkgIT09IG51bGw7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW50ZXJzZWN0cyB0aGlzIHJheSB3aXRoIHRoZSBnaXZlbiB0cmlhbmdsZSwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KICAgIAkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IHZlcnRleCBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZXJ0ZXggb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCB2ZXJ0ZXggb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gYmFja2ZhY2VDdWxsaW5nIC0gV2hldGhlciB0byB1c2UgYmFja2ZhY2UgY3VsbGluZyBvciBub3QuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVyc2VjdGlvbiBwb2ludC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RUcmlhbmdsZSggYSwgYiwgYywgYmFja2ZhY2VDdWxsaW5nLCB0YXJnZXQgKSB7CgogICAgCQkvLyBDb21wdXRlIHRoZSBvZmZzZXQgb3JpZ2luLCBlZGdlcywgYW5kIG5vcm1hbC4KCiAgICAJCS8vIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL3Btam9uaWFrL0dlb21ldHJpY1Rvb2xzL2Jsb2IvbWFzdGVyL0dURW5naW5lL0luY2x1ZGUvTWF0aGVtYXRpY3MvR3RlSW50clJheTNUcmlhbmdsZTMuaAoKICAgIAkJX2VkZ2UxLnN1YlZlY3RvcnMoIGIsIGEgKTsKICAgIAkJX2VkZ2UyLnN1YlZlY3RvcnMoIGMsIGEgKTsKICAgIAkJX25vcm1hbCQxLmNyb3NzVmVjdG9ycyggX2VkZ2UxLCBfZWRnZTIgKTsKCiAgICAJCS8vIFNvbHZlIFEgKyB0KkQgPSBiMSpFMSArIGIyKkUyIChRID0ga0RpZmYsIEQgPSByYXkgZGlyZWN0aW9uLAogICAgCQkvLyBFMSA9IGtFZGdlMSwgRTIgPSBrRWRnZTIsIE4gPSBDcm9zcyhFMSxFMikpIGJ5CiAgICAJCS8vICAgfERvdChELE4pfCpiMSA9IHNpZ24oRG90KEQsTikpKkRvdChELENyb3NzKFEsRTIpKQogICAgCQkvLyAgIHxEb3QoRCxOKXwqYjIgPSBzaWduKERvdChELE4pKSpEb3QoRCxDcm9zcyhFMSxRKSkKICAgIAkJLy8gICB8RG90KEQsTil8KnQgPSAtc2lnbihEb3QoRCxOKSkqRG90KFEsTikKICAgIAkJbGV0IERkTiA9IHRoaXMuZGlyZWN0aW9uLmRvdCggX25vcm1hbCQxICk7CiAgICAJCWxldCBzaWduOwoKICAgIAkJaWYgKCBEZE4gPiAwICkgewoKICAgIAkJCWlmICggYmFja2ZhY2VDdWxsaW5nICkgcmV0dXJuIG51bGw7CiAgICAJCQlzaWduID0gMTsKCiAgICAJCX0gZWxzZSBpZiAoIERkTiA8IDAgKSB7CgogICAgCQkJc2lnbiA9IC0xOwogICAgCQkJRGROID0gLSBEZE47CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJX2RpZmYuc3ViVmVjdG9ycyggdGhpcy5vcmlnaW4sIGEgKTsKICAgIAkJY29uc3QgRGRReEUyID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UyLmNyb3NzVmVjdG9ycyggX2RpZmYsIF9lZGdlMiApICk7CgogICAgCQkvLyBiMSA8IDAsIG5vIGludGVyc2VjdGlvbgogICAgCQlpZiAoIERkUXhFMiA8IDAgKSB7CgogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9CgogICAgCQljb25zdCBEZEUxeFEgPSBzaWduICogdGhpcy5kaXJlY3Rpb24uZG90KCBfZWRnZTEuY3Jvc3MoIF9kaWZmICkgKTsKCiAgICAJCS8vIGIyIDwgMCwgbm8gaW50ZXJzZWN0aW9uCiAgICAJCWlmICggRGRFMXhRIDwgMCApIHsKCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCS8vIGIxK2IyID4gMSwgbm8gaW50ZXJzZWN0aW9uCiAgICAJCWlmICggRGRReEUyICsgRGRFMXhRID4gRGROICkgewoKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJLy8gTGluZSBpbnRlcnNlY3RzIHRyaWFuZ2xlLCBjaGVjayBpZiByYXkgZG9lcy4KICAgIAkJY29uc3QgUWROID0gLSBzaWduICogX2RpZmYuZG90KCBfbm9ybWFsJDEgKTsKCiAgICAJCS8vIHQgPCAwLCBubyBpbnRlcnNlY3Rpb24KICAgIAkJaWYgKCBRZE4gPCAwICkgewoKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJLy8gUmF5IGludGVyc2VjdHMgdHJpYW5nbGUuCiAgICAJCXJldHVybiB0aGlzLmF0KCBRZE4gLyBEZE4sIHRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zZm9ybXMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gNHg0IHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4NCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KICAgIAkgKi8KICAgIAlhcHBseU1hdHJpeDQoIG1hdHJpeDQgKSB7CgogICAgCQl0aGlzLm9yaWdpbi5hcHBseU1hdHJpeDQoIG1hdHJpeDQgKTsKICAgIAkJdGhpcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCBtYXRyaXg0ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHJheSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1JheX0gcmF5IC0gVGhlIHJheSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcmF5IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKi8KICAgIAllcXVhbHMoIHJheSApIHsKCiAgICAJCXJldHVybiByYXkub3JpZ2luLmVxdWFscyggdGhpcy5vcmlnaW4gKSAmJiByYXkuZGlyZWN0aW9uLmVxdWFscyggdGhpcy5kaXJlY3Rpb24gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IHJheSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UmF5fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBSZXByZXNlbnRzIGEgNHg0IG1hdHJpeC4KICAgICAqCiAgICAgKiBUaGUgbW9zdCBjb21tb24gdXNlIG9mIGEgNHg0IG1hdHJpeCBpbiAzRCBjb21wdXRlciBncmFwaGljcyBpcyBhcyBhIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KICAgICAqIEZvciBhbiBpbnRyb2R1Y3Rpb24gdG8gdHJhbnNmb3JtYXRpb24gbWF0cmljZXMgYXMgdXNlZCBpbiBXZWJHTCwgY2hlY2sgb3V0IFt0aGlzIHR1dG9yaWFsXXtAbGluayBodHRwczovL3d3dy5vcGVuZ2wtdHV0b3JpYWwub3JnL2JlZ2lubmVycy10dXRvcmlhbHMvdHV0b3JpYWwtMy1tYXRyaWNlc30KICAgICAqCiAgICAgKiBUaGlzIGFsbG93cyBhIDNEIHZlY3RvciByZXByZXNlbnRpbmcgYSBwb2ludCBpbiAzRCBzcGFjZSB0byB1bmRlcmdvCiAgICAgKiB0cmFuc2Zvcm1hdGlvbnMgc3VjaCBhcyB0cmFuc2xhdGlvbiwgcm90YXRpb24sIHNoZWFyLCBzY2FsZSwgcmVmbGVjdGlvbiwKICAgICAqIG9ydGhvZ29uYWwgb3IgcGVyc3BlY3RpdmUgcHJvamVjdGlvbiBhbmQgc28gb24sIGJ5IGJlaW5nIG11bHRpcGxpZWQgYnkgdGhlCiAgICAgKiBtYXRyaXguIFRoaXMgaXMga25vd24gYXMgYGFwcGx5aW5nYCB0aGUgbWF0cml4IHRvIHRoZSB2ZWN0b3IuCiAgICAgKgogICAgICogQSBOb3RlIG9uIFJvdy1NYWpvciBhbmQgQ29sdW1uLU1ham9yIE9yZGVyaW5nOgogICAgICoKICAgICAqIFRoZSBjb25zdHJ1Y3RvciBhbmQge0BsaW5rIE1hdHJpeDMjc2V0fSBtZXRob2QgdGFrZSBhcmd1bWVudHMgaW4KICAgICAqIFtyb3ctbWFqb3Jde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1Jvdy1fYW5kX2NvbHVtbi1tYWpvcl9vcmRlciNDb2x1bW4tbWFqb3Jfb3JkZXJ9CiAgICAgKiBvcmRlciwgd2hpbGUgaW50ZXJuYWxseSB0aGV5IGFyZSBzdG9yZWQgaW4gdGhlIHtAbGluayBNYXRyaXgzI2VsZW1lbnRzfSBhcnJheSBpbiBjb2x1bW4tbWFqb3Igb3JkZXIuCiAgICAgKiBUaGlzIG1lYW5zIHRoYXQgY2FsbGluZzoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBtID0gbmV3IFRIUkVFLk1hdHJpeDQoKTsKICAgICAqIG0uc2V0KCAxMSwgMTIsIDEzLCAxNCwKICAgICAqICAgICAgICAyMSwgMjIsIDIzLCAyNCwKICAgICAqICAgICAgICAzMSwgMzIsIDMzLCAzNCwKICAgICAqICAgICAgICA0MSwgNDIsIDQzLCA0NCApOwogICAgICogYGBgCiAgICAgKiB3aWxsIHJlc3VsdCBpbiB0aGUgZWxlbWVudHMgYXJyYXkgY29udGFpbmluZzoKICAgICAqIGBgYGpzCiAgICAgKiBtLmVsZW1lbnRzID0gWyAxMSwgMjEsIDMxLCA0MSwKICAgICAqICAgICAgICAgICAgICAgIDEyLCAyMiwgMzIsIDQyLAogICAgICogICAgICAgICAgICAgICAgMTMsIDIzLCAzMywgNDMsCiAgICAgKiAgICAgICAgICAgICAgICAxNCwgMjQsIDM0LCA0NCBdOwogICAgICogYGBgCiAgICAgKiBhbmQgaW50ZXJuYWxseSBhbGwgY2FsY3VsYXRpb25zIGFyZSBwZXJmb3JtZWQgdXNpbmcgY29sdW1uLW1ham9yIG9yZGVyaW5nLgogICAgICogSG93ZXZlciwgYXMgdGhlIGFjdHVhbCBvcmRlcmluZyBtYWtlcyBubyBkaWZmZXJlbmNlIG1hdGhlbWF0aWNhbGx5IGFuZAogICAgICogbW9zdCBwZW9wbGUgYXJlIHVzZWQgdG8gdGhpbmtpbmcgYWJvdXQgbWF0cmljZXMgaW4gcm93LW1ham9yIG9yZGVyLCB0aGUKICAgICAqIHRocmVlLmpzIGRvY3VtZW50YXRpb24gc2hvd3MgbWF0cmljZXMgaW4gcm93LW1ham9yIG9yZGVyLiBKdXN0IGJlYXIgaW4KICAgICAqIG1pbmQgdGhhdCBpZiB5b3UgYXJlIHJlYWRpbmcgdGhlIHNvdXJjZSBjb2RlLCB5b3UnbGwgaGF2ZSB0byB0YWtlIHRoZQogICAgICogdHJhbnNwb3NlIG9mIGFueSBtYXRyaWNlcyBvdXRsaW5lZCBoZXJlIHRvIG1ha2Ugc2Vuc2Ugb2YgdGhlIGNhbGN1bGF0aW9ucy4KICAgICAqLwogICAgY2xhc3MgTWF0cml4NCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgNHg0IG1hdHJpeC4gVGhlIGFyZ3VtZW50cyBhcmUgc3VwcG9zZWQgdG8gYmUKICAgIAkgKiBpbiByb3ctbWFqb3Igb3JkZXIuIElmIG5vIGFyZ3VtZW50cyBhcmUgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3RvcgogICAgCSAqIGluaXRpYWxpemVzIHRoZSBtYXRyaXggYXMgYW4gaWRlbnRpdHkgbWF0cml4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTFdIC0gMS0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEyXSAtIDEtMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xM10gLSAxLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTRdIC0gMS00IG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIxXSAtIDItMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yMl0gLSAyLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjNdIC0gMi0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjI0XSAtIDItNCBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zMV0gLSAzLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzJdIC0gMy0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMzXSAtIDMtMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zNF0gLSAzLTQgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuNDFdIC0gNC0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQyXSAtIDQtMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW240M10gLSA0LTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuNDRdIC0gNC00IG1hdHJpeCBlbGVtZW50LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBuMTEsIG4xMiwgbjEzLCBuMTQsIG4yMSwgbjIyLCBuMjMsIG4yNCwgbjMxLCBuMzIsIG4zMywgbjM0LCBuNDEsIG40MiwgbjQzLCBuNDQgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJTWF0cml4NC5wcm90b3R5cGUuaXNNYXRyaXg0ID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBBIGNvbHVtbi1tYWpvciBsaXN0IG9mIG1hdHJpeCB2YWx1ZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxudW1iZXI+fQogICAgCQkgKi8KICAgIAkJdGhpcy5lbGVtZW50cyA9IFsKCiAgICAJCQkxLCAwLCAwLCAwLAogICAgCQkJMCwgMSwgMCwgMCwKICAgIAkJCTAsIDAsIDEsIDAsCiAgICAJCQkwLCAwLCAwLCAxCgogICAgCQldOwoKICAgIAkJaWYgKCBuMTEgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl0aGlzLnNldCggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZWxlbWVudHMgb2YgdGhlIG1hdHJpeC5UaGUgYXJndW1lbnRzIGFyZSBzdXBwb3NlZCB0byBiZQogICAgCSAqIGluIHJvdy1tYWpvciBvcmRlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjExXSAtIDEtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24xMl0gLSAxLTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMTNdIC0gMS0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjE0XSAtIDEtNCBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24yNF0gLSAyLTQgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuMzRdIC0gMy00IG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQxXSAtIDQtMSBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW240Ml0gLSA0LTIgbWF0cml4IGVsZW1lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuNDNdIC0gNC0zIG1hdHJpeCBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQ0XSAtIDQtNCBtYXRyaXggZWxlbWVudC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzZXQoIG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCXRlWyAwIF0gPSBuMTE7IHRlWyA0IF0gPSBuMTI7IHRlWyA4IF0gPSBuMTM7IHRlWyAxMiBdID0gbjE0OwogICAgCQl0ZVsgMSBdID0gbjIxOyB0ZVsgNSBdID0gbjIyOyB0ZVsgOSBdID0gbjIzOyB0ZVsgMTMgXSA9IG4yNDsKICAgIAkJdGVbIDIgXSA9IG4zMTsgdGVbIDYgXSA9IG4zMjsgdGVbIDEwIF0gPSBuMzM7IHRlWyAxNCBdID0gbjM0OwogICAgCQl0ZVsgMyBdID0gbjQxOyB0ZVsgNyBdID0gbjQyOyB0ZVsgMTEgXSA9IG40MzsgdGVbIDE1IF0gPSBuNDQ7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IHRvIHRoZSA0eDQgaWRlbnRpdHkgbWF0cml4LgogICAgCSAqCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJaWRlbnRpdHkoKSB7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQkxLCAwLCAwLCAwLAogICAgCQkJMCwgMSwgMCwgMCwKICAgIAkJCTAsIDAsIDEsIDAsCiAgICAJCQkwLCAwLCAwLCAxCgogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG1hdHJpeCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyBNYXRyaXg0KCkuZnJvbUFycmF5KCB0aGlzLmVsZW1lbnRzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIG1hdHJpeCB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWNvcHkoIG0gKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCiAgICAJCXRlWyAwIF0gPSBtZVsgMCBdOyB0ZVsgMSBdID0gbWVbIDEgXTsgdGVbIDIgXSA9IG1lWyAyIF07IHRlWyAzIF0gPSBtZVsgMyBdOwogICAgCQl0ZVsgNCBdID0gbWVbIDQgXTsgdGVbIDUgXSA9IG1lWyA1IF07IHRlWyA2IF0gPSBtZVsgNiBdOyB0ZVsgNyBdID0gbWVbIDcgXTsKICAgIAkJdGVbIDggXSA9IG1lWyA4IF07IHRlWyA5IF0gPSBtZVsgOSBdOyB0ZVsgMTAgXSA9IG1lWyAxMCBdOyB0ZVsgMTEgXSA9IG1lWyAxMSBdOwogICAgCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOyB0ZVsgMTMgXSA9IG1lWyAxMyBdOyB0ZVsgMTQgXSA9IG1lWyAxNCBdOyB0ZVsgMTUgXSA9IG1lWyAxNSBdOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB0cmFuc2xhdGlvbiBjb21wb25lbnQgb2YgdGhlIGdpdmVuIG1hdHJpeAogICAgCSAqIGludG8gdGhpcyBtYXRyaXgncyB0cmFuc2xhdGlvbiBjb21wb25lbnQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIGNvcHkgdGhlIHRyYW5zbGF0aW9uIGNvbXBvbmVudC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAljb3B5UG9zaXRpb24oIG0gKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsIG1lID0gbS5lbGVtZW50czsKCiAgICAJCXRlWyAxMiBdID0gbWVbIDEyIF07CiAgICAJCXRlWyAxMyBdID0gbWVbIDEzIF07CiAgICAJCXRlWyAxNCBdID0gbWVbIDE0IF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXQgdGhlIHVwcGVyIDN4MyBlbGVtZW50cyBvZiB0aGlzIG1hdHJpeCB0byB0aGUgdmFsdWVzIG9mIGdpdmVuIDN4MyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgM3gzIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzZXRGcm9tTWF0cml4MyggbSApIHsKCiAgICAJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCW1lWyAwIF0sIG1lWyAzIF0sIG1lWyA2IF0sIDAsCiAgICAJCQltZVsgMSBdLCBtZVsgNCBdLCBtZVsgNyBdLCAwLAogICAgCQkJbWVbIDIgXSwgbWVbIDUgXSwgbWVbIDggXSwgMCwKICAgIAkJCTAsIDAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBFeHRyYWN0cyB0aGUgYmFzaXMgb2YgdGhpcyBtYXRyaXggaW50byB0aGUgdGhyZWUgYXhpcyB2ZWN0b3JzIHByb3ZpZGVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB4QXhpcyAtIFRoZSBiYXNpcydzIHggYXhpcy4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHlBeGlzIC0gVGhlIGJhc2lzJ3MgeSBheGlzLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gekF4aXMgLSBUaGUgYmFzaXMncyB6IGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJZXh0cmFjdEJhc2lzKCB4QXhpcywgeUF4aXMsIHpBeGlzICkgewoKICAgIAkJeEF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMCApOwogICAgCQl5QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAxICk7CiAgICAJCXpBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDIgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIGJhc2lzIHZlY3RvcnMgdG8gdGhpcyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHhBeGlzIC0gVGhlIGJhc2lzJ3MgeCBheGlzLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30geUF4aXMgLSBUaGUgYmFzaXMncyB5IGF4aXMuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB6QXhpcyAtIFRoZSBiYXNpcydzIHogYXhpcy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlQmFzaXMoIHhBeGlzLCB5QXhpcywgekF4aXMgKSB7CgogICAgCQl0aGlzLnNldCgKICAgIAkJCXhBeGlzLngsIHlBeGlzLngsIHpBeGlzLngsIDAsCiAgICAJCQl4QXhpcy55LCB5QXhpcy55LCB6QXhpcy55LCAwLAogICAgCQkJeEF4aXMueiwgeUF4aXMueiwgekF4aXMueiwgMCwKICAgIAkJCTAsIDAsIDAsIDEKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEV4dHJhY3RzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgb2YgdGhlIGdpdmVuIG1hdHJpeAogICAgCSAqIGludG8gdGhpcyBtYXRyaXgncyByb3RhdGlvbiBjb21wb25lbnQuCiAgICAJICoKICAgIAkgKiBOb3RlOiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHJlZmxlY3Rpb24gbWF0cmljZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4LgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWV4dHJhY3RSb3RhdGlvbiggbSApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgIAkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoKICAgIAkJY29uc3Qgc2NhbGVYID0gMSAvIF92MSQ1LnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDAgKS5sZW5ndGgoKTsKICAgIAkJY29uc3Qgc2NhbGVZID0gMSAvIF92MSQ1LnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKICAgIAkJY29uc3Qgc2NhbGVaID0gMSAvIF92MSQ1LnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDIgKS5sZW5ndGgoKTsKCiAgICAJCXRlWyAwIF0gPSBtZVsgMCBdICogc2NhbGVYOwogICAgCQl0ZVsgMSBdID0gbWVbIDEgXSAqIHNjYWxlWDsKICAgIAkJdGVbIDIgXSA9IG1lWyAyIF0gKiBzY2FsZVg7CiAgICAJCXRlWyAzIF0gPSAwOwoKICAgIAkJdGVbIDQgXSA9IG1lWyA0IF0gKiBzY2FsZVk7CiAgICAJCXRlWyA1IF0gPSBtZVsgNSBdICogc2NhbGVZOwogICAgCQl0ZVsgNiBdID0gbWVbIDYgXSAqIHNjYWxlWTsKICAgIAkJdGVbIDcgXSA9IDA7CgogICAgCQl0ZVsgOCBdID0gbWVbIDggXSAqIHNjYWxlWjsKICAgIAkJdGVbIDkgXSA9IG1lWyA5IF0gKiBzY2FsZVo7CiAgICAJCXRlWyAxMCBdID0gbWVbIDEwIF0gKiBzY2FsZVo7CiAgICAJCXRlWyAxMSBdID0gMDsKCiAgICAJCXRlWyAxMiBdID0gMDsKICAgIAkJdGVbIDEzIF0gPSAwOwogICAgCQl0ZVsgMTQgXSA9IDA7CiAgICAJCXRlWyAxNSBdID0gMTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHJvdGF0aW9uIGNvbXBvbmVudCAodGhlIHVwcGVyIGxlZnQgM3gzIG1hdHJpeCkgb2YgdGhpcyBtYXRyaXggdG8KICAgIAkgKiB0aGUgcm90YXRpb24gc3BlY2lmaWVkIGJ5IHRoZSBnaXZlbiBFdWxlciBhbmdsZXMuIFRoZSByZXN0IG9mCiAgICAJICogdGhlIG1hdHJpeCBpcyBzZXQgdG8gdGhlIGlkZW50aXR5LiBEZXBlbmRpbmcgb24gdGhlIHtAbGluayBFdWxlciNvcmRlcn0sCiAgICAJICogdGhlcmUgYXJlIHNpeCBwb3NzaWJsZSBvdXRjb21lcy4gU2VlIFt0aGlzIHBhZ2Vde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0V1bGVyX2FuZ2xlcyNSb3RhdGlvbl9tYXRyaXh9CiAgICAJICogZm9yIGEgY29tcGxldGUgbGlzdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7RXVsZXJ9IGV1bGVyIC0gVGhlIEV1bGVyIGFuZ2xlcy4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlUm90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJY29uc3QgeCA9IGV1bGVyLngsIHkgPSBldWxlci55LCB6ID0gZXVsZXIuejsKICAgIAkJY29uc3QgYSA9IE1hdGguY29zKCB4ICksIGIgPSBNYXRoLnNpbiggeCApOwogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIHkgKSwgZCA9IE1hdGguc2luKCB5ICk7CiAgICAJCWNvbnN0IGUgPSBNYXRoLmNvcyggeiApLCBmID0gTWF0aC5zaW4oIHogKTsKCiAgICAJCWlmICggZXVsZXIub3JkZXIgPT09ICdYWVonICkgewoKICAgIAkJCWNvbnN0IGFlID0gYSAqIGUsIGFmID0gYSAqIGYsIGJlID0gYiAqIGUsIGJmID0gYiAqIGY7CgogICAgCQkJdGVbIDAgXSA9IGMgKiBlOwogICAgCQkJdGVbIDQgXSA9IC0gYyAqIGY7CiAgICAJCQl0ZVsgOCBdID0gZDsKCiAgICAJCQl0ZVsgMSBdID0gYWYgKyBiZSAqIGQ7CiAgICAJCQl0ZVsgNSBdID0gYWUgLSBiZiAqIGQ7CiAgICAJCQl0ZVsgOSBdID0gLSBiICogYzsKCiAgICAJCQl0ZVsgMiBdID0gYmYgLSBhZSAqIGQ7CiAgICAJCQl0ZVsgNiBdID0gYmUgKyBhZiAqIGQ7CiAgICAJCQl0ZVsgMTAgXSA9IGEgKiBjOwoKICAgIAkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWFonICkgewoKICAgIAkJCWNvbnN0IGNlID0gYyAqIGUsIGNmID0gYyAqIGYsIGRlID0gZCAqIGUsIGRmID0gZCAqIGY7CgogICAgCQkJdGVbIDAgXSA9IGNlICsgZGYgKiBiOwogICAgCQkJdGVbIDQgXSA9IGRlICogYiAtIGNmOwogICAgCQkJdGVbIDggXSA9IGEgKiBkOwoKICAgIAkJCXRlWyAxIF0gPSBhICogZjsKICAgIAkJCXRlWyA1IF0gPSBhICogZTsKICAgIAkJCXRlWyA5IF0gPSAtIGI7CgogICAgCQkJdGVbIDIgXSA9IGNmICogYiAtIGRlOwogICAgCQkJdGVbIDYgXSA9IGRmICsgY2UgKiBiOwogICAgCQkJdGVbIDEwIF0gPSBhICogYzsKCiAgICAJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWlhZJyApIHsKCiAgICAJCQljb25zdCBjZSA9IGMgKiBlLCBjZiA9IGMgKiBmLCBkZSA9IGQgKiBlLCBkZiA9IGQgKiBmOwoKICAgIAkJCXRlWyAwIF0gPSBjZSAtIGRmICogYjsKICAgIAkJCXRlWyA0IF0gPSAtIGEgKiBmOwogICAgCQkJdGVbIDggXSA9IGRlICsgY2YgKiBiOwoKICAgIAkJCXRlWyAxIF0gPSBjZiArIGRlICogYjsKICAgIAkJCXRlWyA1IF0gPSBhICogZTsKICAgIAkJCXRlWyA5IF0gPSBkZiAtIGNlICogYjsKCiAgICAJCQl0ZVsgMiBdID0gLSBhICogZDsKICAgIAkJCXRlWyA2IF0gPSBiOwogICAgCQkJdGVbIDEwIF0gPSBhICogYzsKCiAgICAJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWllYJyApIHsKCiAgICAJCQljb25zdCBhZSA9IGEgKiBlLCBhZiA9IGEgKiBmLCBiZSA9IGIgKiBlLCBiZiA9IGIgKiBmOwoKICAgIAkJCXRlWyAwIF0gPSBjICogZTsKICAgIAkJCXRlWyA0IF0gPSBiZSAqIGQgLSBhZjsKICAgIAkJCXRlWyA4IF0gPSBhZSAqIGQgKyBiZjsKCiAgICAJCQl0ZVsgMSBdID0gYyAqIGY7CiAgICAJCQl0ZVsgNSBdID0gYmYgKiBkICsgYWU7CiAgICAJCQl0ZVsgOSBdID0gYWYgKiBkIC0gYmU7CgogICAgCQkJdGVbIDIgXSA9IC0gZDsKICAgIAkJCXRlWyA2IF0gPSBiICogYzsKICAgIAkJCXRlWyAxMCBdID0gYSAqIGM7CgogICAgCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1laWCcgKSB7CgogICAgCQkJY29uc3QgYWMgPSBhICogYywgYWQgPSBhICogZCwgYmMgPSBiICogYywgYmQgPSBiICogZDsKCiAgICAJCQl0ZVsgMCBdID0gYyAqIGU7CiAgICAJCQl0ZVsgNCBdID0gYmQgLSBhYyAqIGY7CiAgICAJCQl0ZVsgOCBdID0gYmMgKiBmICsgYWQ7CgogICAgCQkJdGVbIDEgXSA9IGY7CiAgICAJCQl0ZVsgNSBdID0gYSAqIGU7CiAgICAJCQl0ZVsgOSBdID0gLSBiICogZTsKCiAgICAJCQl0ZVsgMiBdID0gLSBkICogZTsKICAgIAkJCXRlWyA2IF0gPSBhZCAqIGYgKyBiYzsKICAgIAkJCXRlWyAxMCBdID0gYWMgLSBiZCAqIGY7CgogICAgCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1haWScgKSB7CgogICAgCQkJY29uc3QgYWMgPSBhICogYywgYWQgPSBhICogZCwgYmMgPSBiICogYywgYmQgPSBiICogZDsKCiAgICAJCQl0ZVsgMCBdID0gYyAqIGU7CiAgICAJCQl0ZVsgNCBdID0gLSBmOwogICAgCQkJdGVbIDggXSA9IGQgKiBlOwoKICAgIAkJCXRlWyAxIF0gPSBhYyAqIGYgKyBiZDsKICAgIAkJCXRlWyA1IF0gPSBhICogZTsKICAgIAkJCXRlWyA5IF0gPSBhZCAqIGYgLSBiYzsKCiAgICAJCQl0ZVsgMiBdID0gYmMgKiBmIC0gYWQ7CiAgICAJCQl0ZVsgNiBdID0gYiAqIGU7CiAgICAJCQl0ZVsgMTAgXSA9IGJkICogZiArIGFjOwoKICAgIAkJfQoKICAgIAkJLy8gYm90dG9tIHJvdwogICAgCQl0ZVsgMyBdID0gMDsKICAgIAkJdGVbIDcgXSA9IDA7CiAgICAJCXRlWyAxMSBdID0gMDsKCiAgICAJCS8vIGxhc3QgY29sdW1uCiAgICAJCXRlWyAxMiBdID0gMDsKICAgIAkJdGVbIDEzIF0gPSAwOwogICAgCQl0ZVsgMTQgXSA9IDA7CiAgICAJCXRlWyAxNSBdID0gMTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHJvdGF0aW9uIGNvbXBvbmVudCBvZiB0aGlzIG1hdHJpeCB0byB0aGUgcm90YXRpb24gc3BlY2lmaWVkIGJ5CiAgICAJICogdGhlIGdpdmVuIFF1YXRlcm5pb24gYXMgb3V0bGluZWQgW2hlcmVde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1JvdGF0aW9uX21hdHJpeCNRdWF0ZXJuaW9ufQogICAgCSAqIFRoZSByZXN0IG9mIHRoZSBtYXRyaXggaXMgc2V0IHRvIHRoZSBpZGVudGl0eS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBRdWF0ZXJuaW9uLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKICAgIAkJcmV0dXJuIHRoaXMuY29tcG9zZSggX3plcm8sIHEsIF9vbmUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgb2YgdGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCwgbG9va2luZyBmcm9tIGBleWVgIHRvd2FyZHMKICAgIAkgKiBgdGFyZ2V0YCwgYW5kIG9yaWVudGVkIGJ5IHRoZSB1cC1kaXJlY3Rpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGV5ZSAtIFRoZSBleWUgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB1cCAtIFRoZSB1cCB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbG9va0F0KCBleWUsIHRhcmdldCwgdXAgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQlfei5zdWJWZWN0b3JzKCBleWUsIHRhcmdldCApOwoKICAgIAkJaWYgKCBfei5sZW5ndGhTcSgpID09PSAwICkgewoKICAgIAkJCS8vIGV5ZSBhbmQgdGFyZ2V0IGFyZSBpbiB0aGUgc2FtZSBwb3NpdGlvbgoKICAgIAkJCV96LnogPSAxOwoKICAgIAkJfQoKICAgIAkJX3oubm9ybWFsaXplKCk7CiAgICAJCV94LmNyb3NzVmVjdG9ycyggdXAsIF96ICk7CgogICAgCQlpZiAoIF94Lmxlbmd0aFNxKCkgPT09IDAgKSB7CgogICAgCQkJLy8gdXAgYW5kIHogYXJlIHBhcmFsbGVsCgogICAgCQkJaWYgKCBNYXRoLmFicyggdXAueiApID09PSAxICkgewoKICAgIAkJCQlfei54ICs9IDAuMDAwMTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfei56ICs9IDAuMDAwMTsKCiAgICAJCQl9CgogICAgCQkJX3oubm9ybWFsaXplKCk7CiAgICAJCQlfeC5jcm9zc1ZlY3RvcnMoIHVwLCBfeiApOwoKICAgIAkJfQoKICAgIAkJX3gubm9ybWFsaXplKCk7CiAgICAJCV95LmNyb3NzVmVjdG9ycyggX3osIF94ICk7CgogICAgCQl0ZVsgMCBdID0gX3gueDsgdGVbIDQgXSA9IF95Lng7IHRlWyA4IF0gPSBfei54OwogICAgCQl0ZVsgMSBdID0gX3gueTsgdGVbIDUgXSA9IF95Lnk7IHRlWyA5IF0gPSBfei55OwogICAgCQl0ZVsgMiBdID0gX3guejsgdGVbIDYgXSA9IF95Lno7IHRlWyAxMCBdID0gX3ouejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFBvc3QtbXVsdGlwbGllcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gbXVsdGlwbHkgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltdWx0aXBseSggbSApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIHRoaXMsIG0gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBQcmUtbXVsdGlwbGllcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gbXVsdGlwbHkgd2l0aC4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlwcmVtdWx0aXBseSggbSApIHsKCiAgICAJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIG0sIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsZXMgdGhlIGdpdmVuIDR4NCBtYXRyaWNlcyBhbmQgc3RvcmVzIHRoZSByZXN1bHQKICAgIAkgKiBpbiB0aGlzIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gYSAtIFRoZSBmaXJzdCBtYXRyaXguCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBiIC0gVGhlIHNlY29uZCBtYXRyaXguCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbXVsdGlwbHlNYXRyaWNlcyggYSwgYiApIHsKCiAgICAJCWNvbnN0IGFlID0gYS5lbGVtZW50czsKICAgIAkJY29uc3QgYmUgPSBiLmVsZW1lbnRzOwogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQljb25zdCBhMTEgPSBhZVsgMCBdLCBhMTIgPSBhZVsgNCBdLCBhMTMgPSBhZVsgOCBdLCBhMTQgPSBhZVsgMTIgXTsKICAgIAkJY29uc3QgYTIxID0gYWVbIDEgXSwgYTIyID0gYWVbIDUgXSwgYTIzID0gYWVbIDkgXSwgYTI0ID0gYWVbIDEzIF07CiAgICAJCWNvbnN0IGEzMSA9IGFlWyAyIF0sIGEzMiA9IGFlWyA2IF0sIGEzMyA9IGFlWyAxMCBdLCBhMzQgPSBhZVsgMTQgXTsKICAgIAkJY29uc3QgYTQxID0gYWVbIDMgXSwgYTQyID0gYWVbIDcgXSwgYTQzID0gYWVbIDExIF0sIGE0NCA9IGFlWyAxNSBdOwoKICAgIAkJY29uc3QgYjExID0gYmVbIDAgXSwgYjEyID0gYmVbIDQgXSwgYjEzID0gYmVbIDggXSwgYjE0ID0gYmVbIDEyIF07CiAgICAJCWNvbnN0IGIyMSA9IGJlWyAxIF0sIGIyMiA9IGJlWyA1IF0sIGIyMyA9IGJlWyA5IF0sIGIyNCA9IGJlWyAxMyBdOwogICAgCQljb25zdCBiMzEgPSBiZVsgMiBdLCBiMzIgPSBiZVsgNiBdLCBiMzMgPSBiZVsgMTAgXSwgYjM0ID0gYmVbIDE0IF07CiAgICAJCWNvbnN0IGI0MSA9IGJlWyAzIF0sIGI0MiA9IGJlWyA3IF0sIGI0MyA9IGJlWyAxMSBdLCBiNDQgPSBiZVsgMTUgXTsKCiAgICAJCXRlWyAwIF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzEgKyBhMTQgKiBiNDE7CiAgICAJCXRlWyA0IF0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzIgKyBhMTQgKiBiNDI7CiAgICAJCXRlWyA4IF0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzMgKyBhMTQgKiBiNDM7CiAgICAJCXRlWyAxMiBdID0gYTExICogYjE0ICsgYTEyICogYjI0ICsgYTEzICogYjM0ICsgYTE0ICogYjQ0OwoKICAgIAkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMSArIGEyNCAqIGI0MTsKICAgIAkJdGVbIDUgXSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMiArIGEyNCAqIGI0MjsKICAgIAkJdGVbIDkgXSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMyArIGEyNCAqIGI0MzsKICAgIAkJdGVbIDEzIF0gPSBhMjEgKiBiMTQgKyBhMjIgKiBiMjQgKyBhMjMgKiBiMzQgKyBhMjQgKiBiNDQ7CgogICAgCQl0ZVsgMiBdID0gYTMxICogYjExICsgYTMyICogYjIxICsgYTMzICogYjMxICsgYTM0ICogYjQxOwogICAgCQl0ZVsgNiBdID0gYTMxICogYjEyICsgYTMyICogYjIyICsgYTMzICogYjMyICsgYTM0ICogYjQyOwogICAgCQl0ZVsgMTAgXSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMyArIGEzNCAqIGI0MzsKICAgIAkJdGVbIDE0IF0gPSBhMzEgKiBiMTQgKyBhMzIgKiBiMjQgKyBhMzMgKiBiMzQgKyBhMzQgKiBiNDQ7CgogICAgCQl0ZVsgMyBdID0gYTQxICogYjExICsgYTQyICogYjIxICsgYTQzICogYjMxICsgYTQ0ICogYjQxOwogICAgCQl0ZVsgNyBdID0gYTQxICogYjEyICsgYTQyICogYjIyICsgYTQzICogYjMyICsgYTQ0ICogYjQyOwogICAgCQl0ZVsgMTEgXSA9IGE0MSAqIGIxMyArIGE0MiAqIGIyMyArIGE0MyAqIGIzMyArIGE0NCAqIGI0MzsKICAgIAkJdGVbIDE1IF0gPSBhNDEgKiBiMTQgKyBhNDIgKiBiMjQgKyBhNDMgKiBiMzQgKyBhNDQgKiBiNDQ7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIGV2ZXJ5IGNvbXBvbmVudCBvZiB0aGUgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQl0ZVsgMCBdICo9IHM7IHRlWyA0IF0gKj0gczsgdGVbIDggXSAqPSBzOyB0ZVsgMTIgXSAqPSBzOwogICAgCQl0ZVsgMSBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDkgXSAqPSBzOyB0ZVsgMTMgXSAqPSBzOwogICAgCQl0ZVsgMiBdICo9IHM7IHRlWyA2IF0gKj0gczsgdGVbIDEwIF0gKj0gczsgdGVbIDE0IF0gKj0gczsKICAgIAkJdGVbIDMgXSAqPSBzOyB0ZVsgNyBdICo9IHM7IHRlWyAxMSBdICo9IHM7IHRlWyAxNSBdICo9IHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyBhbmQgcmV0dXJucyB0aGUgZGV0ZXJtaW5hbnQgb2YgdGhpcyBtYXRyaXguCiAgICAJICoKICAgIAkgKiBCYXNlZCBvbiB0aGUgbWV0aG9kIG91dGxpbmVkIFtoZXJlXXtAbGluayBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL21hdHJpeC9mdW5jdGlvbnMvaW52ZXJzZS9mb3VyRC9pbmRleC5odG1sfS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRldGVybWluYW50LgogICAgCSAqLwogICAgCWRldGVybWluYW50KCkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJY29uc3QgbjExID0gdGVbIDAgXSwgbjEyID0gdGVbIDQgXSwgbjEzID0gdGVbIDggXSwgbjE0ID0gdGVbIDEyIF07CiAgICAJCWNvbnN0IG4yMSA9IHRlWyAxIF0sIG4yMiA9IHRlWyA1IF0sIG4yMyA9IHRlWyA5IF0sIG4yNCA9IHRlWyAxMyBdOwogICAgCQljb25zdCBuMzEgPSB0ZVsgMiBdLCBuMzIgPSB0ZVsgNiBdLCBuMzMgPSB0ZVsgMTAgXSwgbjM0ID0gdGVbIDE0IF07CiAgICAJCWNvbnN0IG40MSA9IHRlWyAzIF0sIG40MiA9IHRlWyA3IF0sIG40MyA9IHRlWyAxMSBdLCBuNDQgPSB0ZVsgMTUgXTsKCiAgICAJCS8vVE9ETzogbWFrZSB0aGlzIG1vcmUgZWZmaWNpZW50CgogICAgCQlyZXR1cm4gKAogICAgCQkJbjQxICogKAogICAgCQkJCSsgbjE0ICogbjIzICogbjMyCiAgICAJCQkJIC0gbjEzICogbjI0ICogbjMyCiAgICAJCQkJIC0gbjE0ICogbjIyICogbjMzCiAgICAJCQkJICsgbjEyICogbjI0ICogbjMzCiAgICAJCQkJICsgbjEzICogbjIyICogbjM0CiAgICAJCQkJIC0gbjEyICogbjIzICogbjM0CiAgICAJCQkpICsKICAgIAkJCW40MiAqICgKICAgIAkJCQkrIG4xMSAqIG4yMyAqIG4zNAogICAgCQkJCSAtIG4xMSAqIG4yNCAqIG4zMwogICAgCQkJCSArIG4xNCAqIG4yMSAqIG4zMwogICAgCQkJCSAtIG4xMyAqIG4yMSAqIG4zNAogICAgCQkJCSArIG4xMyAqIG4yNCAqIG4zMQogICAgCQkJCSAtIG4xNCAqIG4yMyAqIG4zMQogICAgCQkJKSArCiAgICAJCQluNDMgKiAoCiAgICAJCQkJKyBuMTEgKiBuMjQgKiBuMzIKICAgIAkJCQkgLSBuMTEgKiBuMjIgKiBuMzQKICAgIAkJCQkgLSBuMTQgKiBuMjEgKiBuMzIKICAgIAkJCQkgKyBuMTIgKiBuMjEgKiBuMzQKICAgIAkJCQkgKyBuMTQgKiBuMjIgKiBuMzEKICAgIAkJCQkgLSBuMTIgKiBuMjQgKiBuMzEKICAgIAkJCSkgKwogICAgCQkJbjQ0ICogKAogICAgCQkJCS0gbjEzICogbjIyICogbjMxCiAgICAJCQkJIC0gbjExICogbjIzICogbjMyCiAgICAJCQkJICsgbjExICogbjIyICogbjMzCiAgICAJCQkJICsgbjEzICogbjIxICogbjMyCiAgICAJCQkJIC0gbjEyICogbjIxICogbjMzCiAgICAJCQkJICsgbjEyICogbjIzICogbjMxCiAgICAJCQkpCgogICAgCQkpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zcG9zZXMgdGhpcyBtYXRyaXggaW4gcGxhY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAl0cmFuc3Bvc2UoKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWxldCB0bXA7CgogICAgCQl0bXAgPSB0ZVsgMSBdOyB0ZVsgMSBdID0gdGVbIDQgXTsgdGVbIDQgXSA9IHRtcDsKICAgIAkJdG1wID0gdGVbIDIgXTsgdGVbIDIgXSA9IHRlWyA4IF07IHRlWyA4IF0gPSB0bXA7CiAgICAJCXRtcCA9IHRlWyA2IF07IHRlWyA2IF0gPSB0ZVsgOSBdOyB0ZVsgOSBdID0gdG1wOwoKICAgIAkJdG1wID0gdGVbIDMgXTsgdGVbIDMgXSA9IHRlWyAxMiBdOyB0ZVsgMTIgXSA9IHRtcDsKICAgIAkJdG1wID0gdGVbIDcgXTsgdGVbIDcgXSA9IHRlWyAxMyBdOyB0ZVsgMTMgXSA9IHRtcDsKICAgIAkJdG1wID0gdGVbIDExIF07IHRlWyAxMSBdID0gdGVbIDE0IF07IHRlWyAxNCBdID0gdG1wOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgcG9zaXRpb24gY29tcG9uZW50IGZvciB0aGlzIG1hdHJpeCBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IsCiAgICAJICogd2l0aG91dCBhZmZlY3RpbmcgdGhlIHJlc3Qgb2YgdGhlIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfFZlY3RvcjN9IHggLSBUaGUgeCBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBvciBhbHRlcm5hdGl2ZWx5IHRoZSB2ZWN0b3Igb2JqZWN0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAlzZXRQb3NpdGlvbiggeCwgeSwgeiApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCiAgICAJCWlmICggeC5pc1ZlY3RvcjMgKSB7CgogICAgCQkJdGVbIDEyIF0gPSB4Lng7CiAgICAJCQl0ZVsgMTMgXSA9IHgueTsKICAgIAkJCXRlWyAxNCBdID0geC56OwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0ZVsgMTIgXSA9IHg7CiAgICAJCQl0ZVsgMTMgXSA9IHk7CiAgICAJCQl0ZVsgMTQgXSA9IHo7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBJbnZlcnRzIHRoaXMgbWF0cml4LCB1c2luZyB0aGUgW2FuYWx5dGljIG1ldGhvZF17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSW52ZXJ0aWJsZV9tYXRyaXgjQW5hbHl0aWNfc29sdXRpb259LgogICAgCSAqIFlvdSBjYW4gbm90IGludmVydCB3aXRoIGEgZGV0ZXJtaW5hbnQgb2YgemVyby4gSWYgeW91IGF0dGVtcHQgdGhpcywgdGhlIG1ldGhvZCBwcm9kdWNlcwogICAgCSAqIGEgemVybyBtYXRyaXggaW5zdGVhZC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWludmVydCgpIHsKCiAgICAJCS8vIGJhc2VkIG9uIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2FsZ2VicmEvbWF0cml4L2Z1bmN0aW9ucy9pbnZlcnNlL2ZvdXJEL2luZGV4Lmh0bQogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsCgogICAgCQkJbjExID0gdGVbIDAgXSwgbjIxID0gdGVbIDEgXSwgbjMxID0gdGVbIDIgXSwgbjQxID0gdGVbIDMgXSwKICAgIAkJCW4xMiA9IHRlWyA0IF0sIG4yMiA9IHRlWyA1IF0sIG4zMiA9IHRlWyA2IF0sIG40MiA9IHRlWyA3IF0sCiAgICAJCQluMTMgPSB0ZVsgOCBdLCBuMjMgPSB0ZVsgOSBdLCBuMzMgPSB0ZVsgMTAgXSwgbjQzID0gdGVbIDExIF0sCiAgICAJCQluMTQgPSB0ZVsgMTIgXSwgbjI0ID0gdGVbIDEzIF0sIG4zNCA9IHRlWyAxNCBdLCBuNDQgPSB0ZVsgMTUgXSwKCiAgICAJCQl0MTEgPSBuMjMgKiBuMzQgKiBuNDIgLSBuMjQgKiBuMzMgKiBuNDIgKyBuMjQgKiBuMzIgKiBuNDMgLSBuMjIgKiBuMzQgKiBuNDMgLSBuMjMgKiBuMzIgKiBuNDQgKyBuMjIgKiBuMzMgKiBuNDQsCiAgICAJCQl0MTIgPSBuMTQgKiBuMzMgKiBuNDIgLSBuMTMgKiBuMzQgKiBuNDIgLSBuMTQgKiBuMzIgKiBuNDMgKyBuMTIgKiBuMzQgKiBuNDMgKyBuMTMgKiBuMzIgKiBuNDQgLSBuMTIgKiBuMzMgKiBuNDQsCiAgICAJCQl0MTMgPSBuMTMgKiBuMjQgKiBuNDIgLSBuMTQgKiBuMjMgKiBuNDIgKyBuMTQgKiBuMjIgKiBuNDMgLSBuMTIgKiBuMjQgKiBuNDMgLSBuMTMgKiBuMjIgKiBuNDQgKyBuMTIgKiBuMjMgKiBuNDQsCiAgICAJCQl0MTQgPSBuMTQgKiBuMjMgKiBuMzIgLSBuMTMgKiBuMjQgKiBuMzIgLSBuMTQgKiBuMjIgKiBuMzMgKyBuMTIgKiBuMjQgKiBuMzMgKyBuMTMgKiBuMjIgKiBuMzQgLSBuMTIgKiBuMjMgKiBuMzQ7CgogICAgCQljb25zdCBkZXQgPSBuMTEgKiB0MTEgKyBuMjEgKiB0MTIgKyBuMzEgKiB0MTMgKyBuNDEgKiB0MTQ7CgogICAgCQlpZiAoIGRldCA9PT0gMCApIHJldHVybiB0aGlzLnNldCggMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCApOwoKICAgIAkJY29uc3QgZGV0SW52ID0gMSAvIGRldDsKCiAgICAJCXRlWyAwIF0gPSB0MTEgKiBkZXRJbnY7CiAgICAJCXRlWyAxIF0gPSAoIG4yNCAqIG4zMyAqIG40MSAtIG4yMyAqIG4zNCAqIG40MSAtIG4yNCAqIG4zMSAqIG40MyArIG4yMSAqIG4zNCAqIG40MyArIG4yMyAqIG4zMSAqIG40NCAtIG4yMSAqIG4zMyAqIG40NCApICogZGV0SW52OwogICAgCQl0ZVsgMiBdID0gKCBuMjIgKiBuMzQgKiBuNDEgLSBuMjQgKiBuMzIgKiBuNDEgKyBuMjQgKiBuMzEgKiBuNDIgLSBuMjEgKiBuMzQgKiBuNDIgLSBuMjIgKiBuMzEgKiBuNDQgKyBuMjEgKiBuMzIgKiBuNDQgKSAqIGRldEludjsKICAgIAkJdGVbIDMgXSA9ICggbjIzICogbjMyICogbjQxIC0gbjIyICogbjMzICogbjQxIC0gbjIzICogbjMxICogbjQyICsgbjIxICogbjMzICogbjQyICsgbjIyICogbjMxICogbjQzIC0gbjIxICogbjMyICogbjQzICkgKiBkZXRJbnY7CgogICAgCQl0ZVsgNCBdID0gdDEyICogZGV0SW52OwogICAgCQl0ZVsgNSBdID0gKCBuMTMgKiBuMzQgKiBuNDEgLSBuMTQgKiBuMzMgKiBuNDEgKyBuMTQgKiBuMzEgKiBuNDMgLSBuMTEgKiBuMzQgKiBuNDMgLSBuMTMgKiBuMzEgKiBuNDQgKyBuMTEgKiBuMzMgKiBuNDQgKSAqIGRldEludjsKICAgIAkJdGVbIDYgXSA9ICggbjE0ICogbjMyICogbjQxIC0gbjEyICogbjM0ICogbjQxIC0gbjE0ICogbjMxICogbjQyICsgbjExICogbjM0ICogbjQyICsgbjEyICogbjMxICogbjQ0IC0gbjExICogbjMyICogbjQ0ICkgKiBkZXRJbnY7CiAgICAJCXRlWyA3IF0gPSAoIG4xMiAqIG4zMyAqIG40MSAtIG4xMyAqIG4zMiAqIG40MSArIG4xMyAqIG4zMSAqIG40MiAtIG4xMSAqIG4zMyAqIG40MiAtIG4xMiAqIG4zMSAqIG40MyArIG4xMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKICAgIAkJdGVbIDggXSA9IHQxMyAqIGRldEludjsKICAgIAkJdGVbIDkgXSA9ICggbjE0ICogbjIzICogbjQxIC0gbjEzICogbjI0ICogbjQxIC0gbjE0ICogbjIxICogbjQzICsgbjExICogbjI0ICogbjQzICsgbjEzICogbjIxICogbjQ0IC0gbjExICogbjIzICogbjQ0ICkgKiBkZXRJbnY7CiAgICAJCXRlWyAxMCBdID0gKCBuMTIgKiBuMjQgKiBuNDEgLSBuMTQgKiBuMjIgKiBuNDEgKyBuMTQgKiBuMjEgKiBuNDIgLSBuMTEgKiBuMjQgKiBuNDIgLSBuMTIgKiBuMjEgKiBuNDQgKyBuMTEgKiBuMjIgKiBuNDQgKSAqIGRldEludjsKICAgIAkJdGVbIDExIF0gPSAoIG4xMyAqIG4yMiAqIG40MSAtIG4xMiAqIG4yMyAqIG40MSAtIG4xMyAqIG4yMSAqIG40MiArIG4xMSAqIG4yMyAqIG40MiArIG4xMiAqIG4yMSAqIG40MyAtIG4xMSAqIG4yMiAqIG40MyApICogZGV0SW52OwoKICAgIAkJdGVbIDEyIF0gPSB0MTQgKiBkZXRJbnY7CiAgICAJCXRlWyAxMyBdID0gKCBuMTMgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjMgKiBuMzEgKyBuMTQgKiBuMjEgKiBuMzMgLSBuMTEgKiBuMjQgKiBuMzMgLSBuMTMgKiBuMjEgKiBuMzQgKyBuMTEgKiBuMjMgKiBuMzQgKSAqIGRldEludjsKICAgIAkJdGVbIDE0IF0gPSAoIG4xNCAqIG4yMiAqIG4zMSAtIG4xMiAqIG4yNCAqIG4zMSAtIG4xNCAqIG4yMSAqIG4zMiArIG4xMSAqIG4yNCAqIG4zMiArIG4xMiAqIG4yMSAqIG4zNCAtIG4xMSAqIG4yMiAqIG4zNCApICogZGV0SW52OwogICAgCQl0ZVsgMTUgXSA9ICggbjEyICogbjIzICogbjMxIC0gbjEzICogbjIyICogbjMxICsgbjEzICogbjIxICogbjMyIC0gbjExICogbjIzICogbjMyIC0gbjEyICogbjIxICogbjMzICsgbjExICogbjIyICogbjMzICkgKiBkZXRJbnY7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoZSBjb2x1bW5zIG9mIHRoaXMgbWF0cml4IGJ5IHRoZSBnaXZlbiB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgc2NhbGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCXNjYWxlKCB2ICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgCQljb25zdCB4ID0gdi54LCB5ID0gdi55LCB6ID0gdi56OwoKICAgIAkJdGVbIDAgXSAqPSB4OyB0ZVsgNCBdICo9IHk7IHRlWyA4IF0gKj0gejsKICAgIAkJdGVbIDEgXSAqPSB4OyB0ZVsgNSBdICo9IHk7IHRlWyA5IF0gKj0gejsKICAgIAkJdGVbIDIgXSAqPSB4OyB0ZVsgNiBdICo9IHk7IHRlWyAxMCBdICo9IHo7CiAgICAJCXRlWyAzIF0gKj0geDsgdGVbIDcgXSAqPSB5OyB0ZVsgMTEgXSAqPSB6OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogR2V0cyB0aGUgbWF4aW11bSBzY2FsZSB2YWx1ZSBvZiB0aGUgdGhyZWUgYXhlcy4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIG1heGltdW0gc2NhbGUuCiAgICAJICovCiAgICAJZ2V0TWF4U2NhbGVPbkF4aXMoKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQljb25zdCBzY2FsZVhTcSA9IHRlWyAwIF0gKiB0ZVsgMCBdICsgdGVbIDEgXSAqIHRlWyAxIF0gKyB0ZVsgMiBdICogdGVbIDIgXTsKICAgIAkJY29uc3Qgc2NhbGVZU3EgPSB0ZVsgNCBdICogdGVbIDQgXSArIHRlWyA1IF0gKiB0ZVsgNSBdICsgdGVbIDYgXSAqIHRlWyA2IF07CiAgICAJCWNvbnN0IHNjYWxlWlNxID0gdGVbIDggXSAqIHRlWyA4IF0gKyB0ZVsgOSBdICogdGVbIDkgXSArIHRlWyAxMCBdICogdGVbIDEwIF07CgogICAgCQlyZXR1cm4gTWF0aC5zcXJ0KCBNYXRoLm1heCggc2NhbGVYU3EsIHNjYWxlWVNxLCBzY2FsZVpTcSApICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIHRyYW5zbGF0aW9uIHRyYW5zZm9ybSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IzfSB4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcyBvciBhbHRlcm5hdGl2ZWx5IGEgdHJhbnNsYXRpb24gdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFkgYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSB6IGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVRyYW5zbGF0aW9uKCB4LCB5LCB6ICkgewoKICAgIAkJaWYgKCB4LmlzVmVjdG9yMyApIHsKCiAgICAJCQl0aGlzLnNldCgKCiAgICAJCQkJMSwgMCwgMCwgeC54LAogICAgCQkJCTAsIDEsIDAsIHgueSwKICAgIAkJCQkwLCAwLCAxLCB4LnosCiAgICAJCQkJMCwgMCwgMCwgMQoKICAgIAkJCSk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMuc2V0KAoKICAgIAkJCQkxLCAwLCAwLCB4LAogICAgCQkJCTAsIDEsIDAsIHksCiAgICAJCQkJMCwgMCwgMSwgeiwKICAgIAkJCQkwLCAwLCAwLCAxCgogICAgCQkJKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSByb3RhdGlvbmFsIHRyYW5zZm9ybWF0aW9uIGFyb3VuZCB0aGUgWCBheGlzIGJ5CiAgICAJICogdGhlIGdpdmVuIGFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHRoZXRhIC0gVGhlIHJvdGF0aW9uIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVJvdGF0aW9uWCggdGhldGEgKSB7CgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIHRoZXRhICksIHMgPSBNYXRoLnNpbiggdGhldGEgKTsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCTEsIDAsIDAsIDAsCiAgICAJCQkwLCBjLCAtIHMsIDAsCiAgICAJCQkwLCBzLCBjLCAwLAogICAgCQkJMCwgMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSByb3RhdGlvbmFsIHRyYW5zZm9ybWF0aW9uIGFyb3VuZCB0aGUgWSBheGlzIGJ5CiAgICAJICogdGhlIGdpdmVuIGFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHRoZXRhIC0gVGhlIHJvdGF0aW9uIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVJvdGF0aW9uWSggdGhldGEgKSB7CgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIHRoZXRhICksIHMgPSBNYXRoLnNpbiggdGhldGEgKTsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCSBjLCAwLCBzLCAwLAogICAgCQkJIDAsIDEsIDAsIDAsCiAgICAJCQktIHMsIDAsIGMsIDAsCiAgICAJCQkgMCwgMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSByb3RhdGlvbmFsIHRyYW5zZm9ybWF0aW9uIGFyb3VuZCB0aGUgWiBheGlzIGJ5CiAgICAJICogdGhlIGdpdmVuIGFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHRoZXRhIC0gVGhlIHJvdGF0aW9uIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVJvdGF0aW9uWiggdGhldGEgKSB7CgogICAgCQljb25zdCBjID0gTWF0aC5jb3MoIHRoZXRhICksIHMgPSBNYXRoLnNpbiggdGhldGEgKTsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCWMsIC0gcywgMCwgMCwKICAgIAkJCXMsIGMsIDAsIDAsCiAgICAJCQkwLCAwLCAxLCAwLAogICAgCQkJMCwgMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSByb3RhdGlvbmFsIHRyYW5zZm9ybWF0aW9uIGFyb3VuZCB0aGUgZ2l2ZW4gYXhpcyBieQogICAgCSAqIHRoZSBnaXZlbiBhbmdsZS4KICAgIAkgKgogICAgCSAqIFRoaXMgaXMgYSBzb21ld2hhdCBjb250cm92ZXJzaWFsIGJ1dCBtYXRoZW1hdGljYWxseSBzb3VuZCBhbHRlcm5hdGl2ZSB0bwogICAgCSAqIHJvdGF0aW5nIHZpYSBRdWF0ZXJuaW9ucy4gU2VlIHRoZSBkaXNjdXNzaW9uIFtoZXJlXXtAbGluayBodHRwczovL3d3dy5nYW1lZGV2Lm5ldC9hcnRpY2xlcy9wcm9ncmFtbWluZy9tYXRoLWFuZC1waHlzaWNzL2RvLXdlLXJlYWxseS1uZWVkLXF1YXRlcm5pb25zLXIxMTk5fS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSBub3JtYWxpemVkIHJvdGF0aW9uIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIHJvdGF0aW9uIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVJvdGF0aW9uQXhpcyggYXhpcywgYW5nbGUgKSB7CgogICAgCQkvLyBCYXNlZCBvbiBodHRwOi8vd3d3LmdhbWVkZXYubmV0L3JlZmVyZW5jZS9hcnRpY2xlcy9hcnRpY2xlMTE5OS5hc3AKCiAgICAJCWNvbnN0IGMgPSBNYXRoLmNvcyggYW5nbGUgKTsKICAgIAkJY29uc3QgcyA9IE1hdGguc2luKCBhbmdsZSApOwogICAgCQljb25zdCB0ID0gMSAtIGM7CiAgICAJCWNvbnN0IHggPSBheGlzLngsIHkgPSBheGlzLnksIHogPSBheGlzLno7CiAgICAJCWNvbnN0IHR4ID0gdCAqIHgsIHR5ID0gdCAqIHk7CgogICAgCQl0aGlzLnNldCgKCiAgICAJCQl0eCAqIHggKyBjLCB0eCAqIHkgLSBzICogeiwgdHggKiB6ICsgcyAqIHksIDAsCiAgICAJCQl0eCAqIHkgKyBzICogeiwgdHkgKiB5ICsgYywgdHkgKiB6IC0gcyAqIHgsIDAsCiAgICAJCQl0eCAqIHogLSBzICogeSwgdHkgKiB6ICsgcyAqIHgsIHQgKiB6ICogeiArIGMsIDAsCiAgICAJCQkwLCAwLCAwLCAxCgogICAgCQkpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIHNjYWxlIHRyYW5zZm9ybWF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBYIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBZIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBaIGF4aXMuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJbWFrZVNjYWxlKCB4LCB5LCB6ICkgewoKICAgIAkJdGhpcy5zZXQoCgogICAgCQkJeCwgMCwgMCwgMCwKICAgIAkJCTAsIHksIDAsIDAsCiAgICAJCQkwLCAwLCB6LCAwLAogICAgCQkJMCwgMCwgMCwgMQoKICAgIAkJKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSBzaGVhciB0cmFuc2Zvcm1hdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4eSAtIFRoZSBhbW91bnQgdG8gc2hlYXIgWCBieSBZLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4eiAtIFRoZSBhbW91bnQgdG8gc2hlYXIgWCBieSBaLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5eCAtIFRoZSBhbW91bnQgdG8gc2hlYXIgWSBieSBYLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5eiAtIFRoZSBhbW91bnQgdG8gc2hlYXIgWSBieSBaLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6eCAtIFRoZSBhbW91bnQgdG8gc2hlYXIgWiBieSBYLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6eSAtIFRoZSBhbW91bnQgdG8gc2hlYXIgWiBieSBZLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VTaGVhciggeHksIHh6LCB5eCwgeXosIHp4LCB6eSApIHsKCiAgICAJCXRoaXMuc2V0KAoKICAgIAkJCTEsIHl4LCB6eCwgMCwKICAgIAkJCXh5LCAxLCB6eSwgMCwKICAgIAkJCXh6LCB5eiwgMSwgMCwKICAgIAkJCTAsIDAsIDAsIDEKCiAgICAJCSk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgbWF0cml4IHRvIHRoZSB0cmFuc2Zvcm1hdGlvbiBjb21wb3NlZCBvZiB0aGUgZ2l2ZW4gcG9zaXRpb24sCiAgICAJICogcm90YXRpb24gKFF1YXRlcm5pb24pIGFuZCBzY2FsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9zaXRpb24gLSBUaGUgcG9zaXRpb24gdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcXVhdGVybmlvbiAtIFRoZSByb3RhdGlvbiBhcyBhIFF1YXRlcm5pb24uCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBzY2FsZSAtIFRoZSBzY2FsZSB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJY29tcG9zZSggcG9zaXRpb24sIHF1YXRlcm5pb24sIHNjYWxlICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJY29uc3QgeCA9IHF1YXRlcm5pb24uX3gsIHkgPSBxdWF0ZXJuaW9uLl95LCB6ID0gcXVhdGVybmlvbi5feiwgdyA9IHF1YXRlcm5pb24uX3c7CiAgICAJCWNvbnN0IHgyID0geCArIHgsCXkyID0geSArIHksIHoyID0geiArIHo7CiAgICAJCWNvbnN0IHh4ID0geCAqIHgyLCB4eSA9IHggKiB5MiwgeHogPSB4ICogejI7CiAgICAJCWNvbnN0IHl5ID0geSAqIHkyLCB5eiA9IHkgKiB6MiwgenogPSB6ICogejI7CiAgICAJCWNvbnN0IHd4ID0gdyAqIHgyLCB3eSA9IHcgKiB5Miwgd3ogPSB3ICogejI7CgogICAgCQljb25zdCBzeCA9IHNjYWxlLngsIHN5ID0gc2NhbGUueSwgc3ogPSBzY2FsZS56OwoKICAgIAkJdGVbIDAgXSA9ICggMSAtICggeXkgKyB6eiApICkgKiBzeDsKICAgIAkJdGVbIDEgXSA9ICggeHkgKyB3eiApICogc3g7CiAgICAJCXRlWyAyIF0gPSAoIHh6IC0gd3kgKSAqIHN4OwogICAgCQl0ZVsgMyBdID0gMDsKCiAgICAJCXRlWyA0IF0gPSAoIHh5IC0gd3ogKSAqIHN5OwogICAgCQl0ZVsgNSBdID0gKCAxIC0gKCB4eCArIHp6ICkgKSAqIHN5OwogICAgCQl0ZVsgNiBdID0gKCB5eiArIHd4ICkgKiBzeTsKICAgIAkJdGVbIDcgXSA9IDA7CgogICAgCQl0ZVsgOCBdID0gKCB4eiArIHd5ICkgKiBzejsKICAgIAkJdGVbIDkgXSA9ICggeXogLSB3eCApICogc3o7CiAgICAJCXRlWyAxMCBdID0gKCAxIC0gKCB4eCArIHl5ICkgKSAqIHN6OwogICAgCQl0ZVsgMTEgXSA9IDA7CgogICAgCQl0ZVsgMTIgXSA9IHBvc2l0aW9uLng7CiAgICAJCXRlWyAxMyBdID0gcG9zaXRpb24ueTsKICAgIAkJdGVbIDE0IF0gPSBwb3NpdGlvbi56OwogICAgCQl0ZVsgMTUgXSA9IDE7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEZWNvbXBvc2VzIHRoaXMgbWF0cml4IGludG8gaXRzIHBvc2l0aW9uLCByb3RhdGlvbiBhbmQgc2NhbGUgY29tcG9uZW50cwogICAgCSAqIGFuZCBwcm92aWRlcyB0aGUgcmVzdWx0IGluIHRoZSBnaXZlbiBvYmplY3RzLgogICAgCSAqCiAgICAJICogTm90ZTogTm90IGFsbCBtYXRyaWNlcyBhcmUgZGVjb21wb3NhYmxlIGluIHRoaXMgd2F5LiBGb3IgZXhhbXBsZSwgaWYgYW4KICAgIAkgKiBvYmplY3QgaGFzIGEgbm9uLXVuaWZvcm1seSBzY2FsZWQgcGFyZW50LCB0aGVuIHRoZSBvYmplY3QncyB3b3JsZCBtYXRyaXgKICAgIAkgKiBtYXkgbm90IGJlIGRlY29tcG9zYWJsZSwgYW5kIHRoaXMgbWV0aG9kIG1heSBub3QgYmUgYXBwcm9wcmlhdGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvc2l0aW9uIC0gVGhlIHBvc2l0aW9uIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHF1YXRlcm5pb24gLSBUaGUgcm90YXRpb24gYXMgYSBRdWF0ZXJuaW9uLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gc2NhbGUgLSBUaGUgc2NhbGUgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCWRlY29tcG9zZSggcG9zaXRpb24sIHF1YXRlcm5pb24sIHNjYWxlICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKICAgIAkJbGV0IHN4ID0gX3YxJDUuc2V0KCB0ZVsgMCBdLCB0ZVsgMSBdLCB0ZVsgMiBdICkubGVuZ3RoKCk7CiAgICAJCWNvbnN0IHN5ID0gX3YxJDUuc2V0KCB0ZVsgNCBdLCB0ZVsgNSBdLCB0ZVsgNiBdICkubGVuZ3RoKCk7CiAgICAJCWNvbnN0IHN6ID0gX3YxJDUuc2V0KCB0ZVsgOCBdLCB0ZVsgOSBdLCB0ZVsgMTAgXSApLmxlbmd0aCgpOwoKICAgIAkJLy8gaWYgZGV0ZXJtaW5lIGlzIG5lZ2F0aXZlLCB3ZSBuZWVkIHRvIGludmVydCBvbmUgc2NhbGUKICAgIAkJY29uc3QgZGV0ID0gdGhpcy5kZXRlcm1pbmFudCgpOwogICAgCQlpZiAoIGRldCA8IDAgKSBzeCA9IC0gc3g7CgogICAgCQlwb3NpdGlvbi54ID0gdGVbIDEyIF07CiAgICAJCXBvc2l0aW9uLnkgPSB0ZVsgMTMgXTsKICAgIAkJcG9zaXRpb24ueiA9IHRlWyAxNCBdOwoKICAgIAkJLy8gc2NhbGUgdGhlIHJvdGF0aW9uIHBhcnQKICAgIAkJX20xJDIuY29weSggdGhpcyApOwoKICAgIAkJY29uc3QgaW52U1ggPSAxIC8gc3g7CiAgICAJCWNvbnN0IGludlNZID0gMSAvIHN5OwogICAgCQljb25zdCBpbnZTWiA9IDEgLyBzejsKCiAgICAJCV9tMSQyLmVsZW1lbnRzWyAwIF0gKj0gaW52U1g7CiAgICAJCV9tMSQyLmVsZW1lbnRzWyAxIF0gKj0gaW52U1g7CiAgICAJCV9tMSQyLmVsZW1lbnRzWyAyIF0gKj0gaW52U1g7CgogICAgCQlfbTEkMi5lbGVtZW50c1sgNCBdICo9IGludlNZOwogICAgCQlfbTEkMi5lbGVtZW50c1sgNSBdICo9IGludlNZOwogICAgCQlfbTEkMi5lbGVtZW50c1sgNiBdICo9IGludlNZOwoKICAgIAkJX20xJDIuZWxlbWVudHNbIDggXSAqPSBpbnZTWjsKICAgIAkJX20xJDIuZWxlbWVudHNbIDkgXSAqPSBpbnZTWjsKICAgIAkJX20xJDIuZWxlbWVudHNbIDEwIF0gKj0gaW52U1o7CgogICAgCQlxdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX20xJDIgKTsKCiAgICAJCXNjYWxlLnggPSBzeDsKICAgIAkJc2NhbGUueSA9IHN5OwogICAgCQlzY2FsZS56ID0gc3o7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDcmVhdGVzIGEgcGVyc3BlY3RpdmUgcHJvamVjdGlvbiBtYXRyaXguIFRoaXMgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5CiAgICAJICoge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI3VwZGF0ZVByb2plY3Rpb25NYXRyaXh9LgoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbGVmdCAtIExlZnQgYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcmlnaHQgLSBSaWdodCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB0b3AgLSBUb3AgYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYm90dG9tIC0gQm90dG9tIGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG5lYXIgLSBUaGUgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhIHRvIHRoZSBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBmYXIgLSBUaGUgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhIHRvIHRoZSBmYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHsoV2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0pfSBbY29vcmRpbmF0ZVN5c3RlbT1XZWJHTENvb3JkaW5hdGVTeXN0ZW1dIC0gVGhlIGNvb3JkaW5hdGUgc3lzdGVtLgogICAgCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgogICAgCSAqLwogICAgCW1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIsIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CiAgICAJCWNvbnN0IHggPSAyICogbmVhciAvICggcmlnaHQgLSBsZWZ0ICk7CiAgICAJCWNvbnN0IHkgPSAyICogbmVhciAvICggdG9wIC0gYm90dG9tICk7CgogICAgCQljb25zdCBhID0gKCByaWdodCArIGxlZnQgKSAvICggcmlnaHQgLSBsZWZ0ICk7CiAgICAJCWNvbnN0IGIgPSAoIHRvcCArIGJvdHRvbSApIC8gKCB0b3AgLSBib3R0b20gKTsKCiAgICAJCWxldCBjLCBkOwoKICAgIAkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQkJYyA9IC0gKCBmYXIgKyBuZWFyICkgLyAoIGZhciAtIG5lYXIgKTsKICAgIAkJCWQgPSAoIC0yICogZmFyICogbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgogICAgCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCWMgPSAtIGZhciAvICggZmFyIC0gbmVhciApOwogICAgCQkJZCA9ICggLSBmYXIgKiBuZWFyICkgLyAoIGZhciAtIG5lYXIgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuTWF0cml4NC5tYWtlUGVyc3BlY3RpdmUoKTogSW52YWxpZCBjb29yZGluYXRlIHN5c3RlbTogJyArIGNvb3JkaW5hdGVTeXN0ZW0gKTsKCiAgICAJCX0KCiAgICAJCXRlWyAwIF0gPSB4Owl0ZVsgNCBdID0gMDsJdGVbIDggXSA9IGE7IAl0ZVsgMTIgXSA9IDA7CiAgICAJCXRlWyAxIF0gPSAwOwl0ZVsgNSBdID0geTsJdGVbIDkgXSA9IGI7IAl0ZVsgMTMgXSA9IDA7CiAgICAJCXRlWyAyIF0gPSAwOwl0ZVsgNiBdID0gMDsJdGVbIDEwIF0gPSBjOyAJdGVbIDE0IF0gPSBkOwogICAgCQl0ZVsgMyBdID0gMDsJdGVbIDcgXSA9IDA7CXRlWyAxMSBdID0gLTE7CXRlWyAxNSBdID0gMDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENyZWF0ZXMgYSBvcnRob2dyYXBoaWMgcHJvamVjdGlvbiBtYXRyaXguIFRoaXMgaXMgdXNlZCBpbnRlcm5hbGx5IGJ5CiAgICAJICoge0BsaW5rIE9ydGhvZ3JhcGhpY0NhbWVyYSN1cGRhdGVQcm9qZWN0aW9uTWF0cml4fS4KCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgLSBMZWZ0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHJpZ2h0IC0gUmlnaHQgYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gdG9wIC0gVG9wIGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbSAtIEJvdHRvbSBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBuZWFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgZmFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0gW2Nvb3JkaW5hdGVTeXN0ZW09V2ViR0xDb29yZGluYXRlU3lzdGVtXSAtIFRoZSBjb29yZGluYXRlIHN5c3RlbS4KICAgIAkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KICAgIAkgKi8KICAgIAltYWtlT3J0aG9ncmFwaGljKCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhciwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCiAgICAJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKICAgIAkJY29uc3QgdyA9IDEuMCAvICggcmlnaHQgLSBsZWZ0ICk7CiAgICAJCWNvbnN0IGggPSAxLjAgLyAoIHRvcCAtIGJvdHRvbSApOwogICAgCQljb25zdCBwID0gMS4wIC8gKCBmYXIgLSBuZWFyICk7CgogICAgCQljb25zdCB4ID0gKCByaWdodCArIGxlZnQgKSAqIHc7CiAgICAJCWNvbnN0IHkgPSAoIHRvcCArIGJvdHRvbSApICogaDsKCiAgICAJCWxldCB6LCB6SW52OwoKICAgIAkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQkJeiA9ICggZmFyICsgbmVhciApICogcDsKICAgIAkJCXpJbnYgPSAtMiAqIHA7CgogICAgCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCXogPSBuZWFyICogcDsKICAgIAkJCXpJbnYgPSAtMSAqIHA7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLk1hdHJpeDQubWFrZU9ydGhvZ3JhcGhpYygpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKICAgIAkJfQoKICAgIAkJdGVbIDAgXSA9IDIgKiB3Owl0ZVsgNCBdID0gMDsJCXRlWyA4IF0gPSAwOyAJCXRlWyAxMiBdID0gLSB4OwogICAgCQl0ZVsgMSBdID0gMDsgCQl0ZVsgNSBdID0gMiAqIGg7CXRlWyA5IF0gPSAwOyAJCXRlWyAxMyBdID0gLSB5OwogICAgCQl0ZVsgMiBdID0gMDsgCQl0ZVsgNiBdID0gMDsJCXRlWyAxMCBdID0gekludjsJdGVbIDE0IF0gPSAtIHo7CiAgICAJCXRlWyAzIF0gPSAwOyAJCXRlWyA3IF0gPSAwOwkJdGVbIDExIF0gPSAwOwkJdGVbIDE1IF0gPSAxOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBtYXRyaXggaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgbWF0cml4IHRvIHRlc3QgZm9yIGVxdWFsaXR5LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBtYXRyaXggaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggbWF0cml4ICkgewoKICAgIAkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwogICAgCQljb25zdCBtZSA9IG1hdHJpeC5lbGVtZW50czsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDE2OyBpICsrICkgewoKICAgIAkJCWlmICggdGVbIGkgXSAhPT0gbWVbIGkgXSApIHJldHVybiBmYWxzZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0cnVlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gYXJyYXkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGFycmF5IC0gVGhlIG1hdHJpeCBlbGVtZW50cyBpbiBjb2x1bW4tbWFqb3Igb3JkZXIuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCiAgICAJICovCiAgICAJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDE2OyBpICsrICkgewoKICAgIAkJCXRoaXMuZWxlbWVudHNbIGkgXSA9IGFycmF5WyBpICsgb2Zmc2V0IF07CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXcml0ZXMgdGhlIGVsZW1lbnRzIG9mIHRoaXMgbWF0cml4IHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCiAgICAJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgogICAgCSAqLwogICAgCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgogICAgCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgogICAgCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGVbIDEgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRlWyAyIF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0ZVsgMyBdOwoKICAgIAkJYXJyYXlbIG9mZnNldCArIDQgXSA9IHRlWyA0IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyA1IF0gPSB0ZVsgNSBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgNiBdID0gdGVbIDYgXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDcgXSA9IHRlWyA3IF07CgogICAgCQlhcnJheVsgb2Zmc2V0ICsgOCBdID0gdGVbIDggXTsKICAgIAkJYXJyYXlbIG9mZnNldCArIDkgXSA9IHRlWyA5IF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxMCBdID0gdGVbIDEwIF07CiAgICAJCWFycmF5WyBvZmZzZXQgKyAxMSBdID0gdGVbIDExIF07CgogICAgCQlhcnJheVsgb2Zmc2V0ICsgMTIgXSA9IHRlWyAxMiBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMTMgXSA9IHRlWyAxMyBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMTQgXSA9IHRlWyAxNCBdOwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMTUgXSA9IHRlWyAxNSBdOwoKICAgIAkJcmV0dXJuIGFycmF5OwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF92MSQ1ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX20xJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CiAgICBjb25zdCBfemVybyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDAsIDAgKTsKICAgIGNvbnN0IF9vbmUgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAxLCAxLCAxICk7CiAgICBjb25zdCBfeCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF95ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ogPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX21hdHJpeCQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwogICAgY29uc3QgX3F1YXRlcm5pb24kMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAvKioKICAgICAqIEEgY2xhc3MgcmVwcmVzZW50aW5nIEV1bGVyIGFuZ2xlcy4KICAgICAqCiAgICAgKiBFdWxlciBhbmdsZXMgZGVzY3JpYmUgYSByb3RhdGlvbmFsIHRyYW5zZm9ybWF0aW9uIGJ5IHJvdGF0aW5nIGFuIG9iamVjdCBvbgogICAgICogaXRzIHZhcmlvdXMgYXhlcyBpbiBzcGVjaWZpZWQgYW1vdW50cyBwZXIgYXhpcywgYW5kIGEgc3BlY2lmaWVkIGF4aXMKICAgICAqIG9yZGVyLgogICAgICoKICAgICAqIEl0ZXJhdGluZyB0aHJvdWdoIGFuIGluc3RhbmNlIHdpbGwgeWllbGQgaXRzIGNvbXBvbmVudHMgKHgsIHksIHosCiAgICAgKiBvcmRlcikgaW4gdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGEgPSBuZXcgVEhSRUUuRXVsZXIoIDAsIDEsIDEuNTcsICdYWVonICk7CiAgICAgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjMoIDEsIDAsIDEgKTsKICAgICAqIGIuYXBwbHlFdWxlcihhKTsKICAgICAqIGBgYAogICAgICovCiAgICBjbGFzcyBFdWxlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgZXVsZXIgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3g9MF0gLSBUaGUgYW5nbGUgb2YgdGhlIHggYXhpcyBpbiByYWRpYW5zLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbeT0wXSAtIFRoZSBhbmdsZSBvZiB0aGUgeSBheGlzIGluIHJhZGlhbnMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIGFuZ2xlIG9mIHRoZSB6IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW29yZGVyPUV1bGVyLkRFRkFVTFRfT1JERVJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAsIG9yZGVyID0gRXVsZXIuREVGQVVMVF9PUkRFUiApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzRXVsZXIgPSB0cnVlOwoKICAgIAkJdGhpcy5feCA9IHg7CiAgICAJCXRoaXMuX3kgPSB5OwogICAgCQl0aGlzLl96ID0gejsKICAgIAkJdGhpcy5fb3JkZXIgPSBvcmRlcjsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgYW5nbGUgb2YgdGhlIHggYXhpcyBpbiByYWRpYW5zLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCAwCiAgICAJICovCiAgICAJZ2V0IHgoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5feDsKCiAgICAJfQoKICAgIAlzZXQgeCggdmFsdWUgKSB7CgogICAgCQl0aGlzLl94ID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgYW5nbGUgb2YgdGhlIHkgYXhpcyBpbiByYWRpYW5zLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCAwCiAgICAJICovCiAgICAJZ2V0IHkoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5feTsKCiAgICAJfQoKICAgIAlzZXQgeSggdmFsdWUgKSB7CgogICAgCQl0aGlzLl95ID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGUgYW5nbGUgb2YgdGhlIHogYXhpcyBpbiByYWRpYW5zLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCAwCiAgICAJICovCiAgICAJZ2V0IHooKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fejsKCiAgICAJfQoKICAgIAlzZXQgeiggdmFsdWUgKSB7CgogICAgCQl0aGlzLl96ID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJICogQGRlZmF1bHQgJ1hZWicKICAgIAkgKi8KICAgIAlnZXQgb3JkZXIoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fb3JkZXI7CgogICAgCX0KCiAgICAJc2V0IG9yZGVyKCB2YWx1ZSApIHsKCiAgICAJCXRoaXMuX29yZGVyID0gdmFsdWU7CiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBFdWxlciBjb21wb25lbnRzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYW5nbGUgb2YgdGhlIHggYXhpcyBpbiByYWRpYW5zLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFuZ2xlIG9mIHRoZSB5IGF4aXMgaW4gcmFkaWFucy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSBhbmdsZSBvZiB0aGUgeiBheGlzIGluIHJhZGlhbnMuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KICAgIAkgKiBAcmV0dXJuIHtFdWxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBFdWxlciBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXQoIHgsIHksIHosIG9yZGVyID0gdGhpcy5fb3JkZXIgKSB7CgogICAgCQl0aGlzLl94ID0geDsKICAgIAkJdGhpcy5feSA9IHk7CiAgICAJCXRoaXMuX3ogPSB6OwogICAgCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKICAgIAkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyBFdWxlciBpbnN0YW5jZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5feCwgdGhpcy5feSwgdGhpcy5feiwgdGhpcy5fb3JkZXIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gRXVsZXIgaW5zdGFuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7RXVsZXJ9IGV1bGVyIC0gVGhlIEV1bGVyIGluc3RhbmNlIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weSggZXVsZXIgKSB7CgogICAgCQl0aGlzLl94ID0gZXVsZXIuX3g7CiAgICAJCXRoaXMuX3kgPSBldWxlci5feTsKICAgIAkJdGhpcy5feiA9IGV1bGVyLl96OwogICAgCQl0aGlzLl9vcmRlciA9IGV1bGVyLl9vcmRlcjsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGFuZ2xlcyBvZiB0aGlzIEV1bGVyIGluc3RhbmNlIGZyb20gYSBwdXJlIHJvdGF0aW9uIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEEgNHg0IG1hdHJpeCBvZiB3aGljaCB0aGUgdXBwZXIgM3gzIG9mIG1hdHJpeCBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUuIHVuc2NhbGVkKS4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW29yZGVyXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZT10cnVlXSAtIFdoZXRoZXIgdGhlIGludGVybmFsIGBvbkNoYW5nZWAgY2FsbGJhY2sgc2hvdWxkIGJlIGV4ZWN1dGVkIG9yIG5vdC4KICAgIAkgKiBAcmV0dXJuIHtFdWxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBFdWxlciBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRGcm9tUm90YXRpb25NYXRyaXgoIG0sIG9yZGVyID0gdGhpcy5fb3JkZXIsIHVwZGF0ZSA9IHRydWUgKSB7CgogICAgCQljb25zdCB0ZSA9IG0uZWxlbWVudHM7CiAgICAJCWNvbnN0IG0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF07CiAgICAJCWNvbnN0IG0yMSA9IHRlWyAxIF0sIG0yMiA9IHRlWyA1IF0sIG0yMyA9IHRlWyA5IF07CiAgICAJCWNvbnN0IG0zMSA9IHRlWyAyIF0sIG0zMiA9IHRlWyA2IF0sIG0zMyA9IHRlWyAxMCBdOwoKICAgIAkJc3dpdGNoICggb3JkZXIgKSB7CgogICAgCQkJY2FzZSAnWFlaJzoKCiAgICAJCQkJdGhpcy5feSA9IE1hdGguYXNpbiggY2xhbXAoIG0xMywgLTEsIDEgKSApOwoKICAgIAkJCQlpZiAoIE1hdGguYWJzKCBtMTMgKSA8IDAuOTk5OTk5OSApIHsKCiAgICAJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCAtIG0yMywgbTMzICk7CiAgICAJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCAtIG0xMiwgbTExICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggbTMyLCBtMjIgKTsKICAgIAkJCQkJdGhpcy5feiA9IDA7CgogICAgCQkJCX0KCiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWVhaJzoKCiAgICAJCQkJdGhpcy5feCA9IE1hdGguYXNpbiggLSBjbGFtcCggbTIzLCAtMSwgMSApICk7CgogICAgCQkJCWlmICggTWF0aC5hYnMoIG0yMyApIDwgMC45OTk5OTk5ICkgewoKICAgIAkJCQkJdGhpcy5feSA9IE1hdGguYXRhbjIoIG0xMywgbTMzICk7CiAgICAJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0yMiApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5feSA9IE1hdGguYXRhbjIoIC0gbTMxLCBtMTEgKTsKICAgIAkJCQkJdGhpcy5feiA9IDA7CgogICAgCQkJCX0KCiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWlhZJzoKCiAgICAJCQkJdGhpcy5feCA9IE1hdGguYXNpbiggY2xhbXAoIG0zMiwgLTEsIDEgKSApOwoKICAgIAkJCQlpZiAoIE1hdGguYWJzKCBtMzIgKSA8IDAuOTk5OTk5OSApIHsKCiAgICAJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTMzICk7CiAgICAJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCAtIG0xMiwgbTIyICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl0aGlzLl95ID0gMDsKICAgIAkJCQkJdGhpcy5feiA9IE1hdGguYXRhbjIoIG0yMSwgbTExICk7CgogICAgCQkJCX0KCiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWllYJzoKCiAgICAJCQkJdGhpcy5feSA9IE1hdGguYXNpbiggLSBjbGFtcCggbTMxLCAtMSwgMSApICk7CgogICAgCQkJCWlmICggTWF0aC5hYnMoIG0zMSApIDwgMC45OTk5OTk5ICkgewoKICAgIAkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIG0zMiwgbTMzICk7CiAgICAJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5feCA9IDA7CiAgICAJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCAtIG0xMiwgbTIyICk7CgogICAgCQkJCX0KCiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWVpYJzoKCiAgICAJCQkJdGhpcy5feiA9IE1hdGguYXNpbiggY2xhbXAoIG0yMSwgLTEsIDEgKSApOwoKICAgIAkJCQlpZiAoIE1hdGguYWJzKCBtMjEgKSA8IDAuOTk5OTk5OSApIHsKCiAgICAJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCAtIG0yMywgbTIyICk7CiAgICAJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTExICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl0aGlzLl94ID0gMDsKICAgIAkJCQkJdGhpcy5feSA9IE1hdGguYXRhbjIoIG0xMywgbTMzICk7CgogICAgCQkJCX0KCiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnWFpZJzoKCiAgICAJCQkJdGhpcy5feiA9IE1hdGguYXNpbiggLSBjbGFtcCggbTEyLCAtMSwgMSApICk7CgogICAgCQkJCWlmICggTWF0aC5hYnMoIG0xMiApIDwgMC45OTk5OTk5ICkgewoKICAgIAkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIG0zMiwgbTIyICk7CiAgICAJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0xMSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIC0gbTIzLCBtMzMgKTsKICAgIAkJCQkJdGhpcy5feSA9IDA7CgogICAgCQkJCX0KCiAgICAJCQkJYnJlYWs7CgogICAgCQkJZGVmYXVsdDoKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuRXVsZXI6IC5zZXRGcm9tUm90YXRpb25NYXRyaXgoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMuX29yZGVyID0gb3JkZXI7CgogICAgCQlpZiAoIHVwZGF0ZSA9PT0gdHJ1ZSApIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGFuZ2xlcyBvZiB0aGlzIEV1bGVyIGluc3RhbmNlIGZyb20gYSBub3JtYWxpemVkIHF1YXRlcm5pb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBBIG5vcm1hbGl6ZWQgUXVhdGVybmlvbi4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW29yZGVyXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZT10cnVlXSAtIFdoZXRoZXIgdGhlIGludGVybmFsIGBvbkNoYW5nZWAgY2FsbGJhY2sgc2hvdWxkIGJlIGV4ZWN1dGVkIG9yIG5vdC4KICAgIAkgKiBAcmV0dXJuIHtFdWxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBFdWxlciBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRGcm9tUXVhdGVybmlvbiggcSwgb3JkZXIsIHVwZGF0ZSApIHsKCiAgICAJCV9tYXRyaXgkMi5tYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApOwoKICAgIAkJcmV0dXJuIHRoaXMuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBfbWF0cml4JDIsIG9yZGVyLCB1cGRhdGUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0RnJvbVZlY3RvcjMoIHYsIG9yZGVyID0gdGhpcy5fb3JkZXIgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5zZXQoIHYueCwgdi55LCB2LnosIG9yZGVyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVzZXRzIHRoZSBldWxlciBhbmdsZSB3aXRoIGEgbmV3IG9yZGVyIGJ5IGNyZWF0aW5nIGEgcXVhdGVybmlvbiBmcm9tIHRoaXMKICAgIAkgKiBldWxlciBhbmdsZSBhbmQgdGhlbiBzZXR0aW5nIHRoaXMgZXVsZXIgYW5nbGUgd2l0aCB0aGUgcXVhdGVybmlvbiBhbmQgdGhlCiAgICAJICogbmV3IG9yZGVyLgogICAgCSAqCiAgICAJICogV2FybmluZzogVGhpcyBkaXNjYXJkcyByZXZvbHV0aW9uIGluZm9ybWF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtuZXdPcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG5ldyBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCiAgICAJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcmVvcmRlciggbmV3T3JkZXIgKSB7CgogICAgCQlfcXVhdGVybmlvbiQzLnNldEZyb21FdWxlciggdGhpcyApOwoKICAgIAkJcmV0dXJuIHRoaXMuc2V0RnJvbVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uJDMsIG5ld09yZGVyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBFdWxlciBpbnN0YW5jZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBpbnN0YW5jZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgRXVsZXIgaW5zdGFuY2UgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggZXVsZXIgKSB7CgogICAgCQlyZXR1cm4gKCBldWxlci5feCA9PT0gdGhpcy5feCApICYmICggZXVsZXIuX3kgPT09IHRoaXMuX3kgKSAmJiAoIGV1bGVyLl96ID09PSB0aGlzLl96ICkgJiYgKCBldWxlci5fb3JkZXIgPT09IHRoaXMuX29yZGVyICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIEV1bGVyIGluc3RhbmNlJ3MgY29tcG9uZW50cyB0byB2YWx1ZXMgZnJvbSB0aGUgZ2l2ZW4gYXJyYXkuIFRoZSBmaXJzdCB0aHJlZQogICAgCSAqIGVudHJpZXMgb2YgdGhlIGFycmF5IGFyZSBhc3NpZ24gdG8gdGhlIHgseSBhbmQgeiBjb21wb25lbnRzLiBBbiBvcHRpb25hbCBmb3VydGggZW50cnkKICAgIAkgKiBkZWZpbmVzIHRoZSBFdWxlciBvcmRlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyLG51bWJlcixudW1iZXIsP3N0cmluZz59IGFycmF5IC0gQW4gYXJyYXkgaG9sZGluZyB0aGUgRXVsZXIgY29tcG9uZW50IHZhbHVlcy4KICAgIAkgKiBAcmV0dXJuIHtFdWxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBFdWxlciBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlmcm9tQXJyYXkoIGFycmF5ICkgewoKICAgIAkJdGhpcy5feCA9IGFycmF5WyAwIF07CiAgICAJCXRoaXMuX3kgPSBhcnJheVsgMSBdOwogICAgCQl0aGlzLl96ID0gYXJyYXlbIDIgXTsKICAgIAkJaWYgKCBhcnJheVsgMyBdICE9PSB1bmRlZmluZWQgKSB0aGlzLl9vcmRlciA9IGFycmF5WyAzIF07CgogICAgCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXcml0ZXMgdGhlIGNvbXBvbmVudHMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAogICAgCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyLG51bWJlcixudW1iZXIsc3RyaW5nPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgRXVsZXIgY29tcG9uZW50cy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KICAgIAkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXIsbnVtYmVyLG51bWJlcixzdHJpbmc+fSBUaGUgRXVsZXIgY29tcG9uZW50cy4KICAgIAkgKi8KICAgIAl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKICAgIAkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuX3k7CiAgICAJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwogICAgCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fb3JkZXI7CgogICAgCQlyZXR1cm4gYXJyYXk7CgogICAgCX0KCiAgICAJX29uQ2hhbmdlKCBjYWxsYmFjayApIHsKCiAgICAJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2sgPSBjYWxsYmFjazsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCV9vbkNoYW5nZUNhbGxiYWNrKCkge30KCiAgICAJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgogICAgCQl5aWVsZCB0aGlzLl94OwogICAgCQl5aWVsZCB0aGlzLl95OwogICAgCQl5aWVsZCB0aGlzLl96OwogICAgCQl5aWVsZCB0aGlzLl9vcmRlcjsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IEV1bGVyIGFuZ2xlIG9yZGVyLgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtzdHJpbmd9CiAgICAgKiBAZGVmYXVsdCAnWFlaJwogICAgICovCiAgICBFdWxlci5ERUZBVUxUX09SREVSID0gJ1hZWic7CgogICAgLyoqCiAgICAgKiBBIGxheWVycyBvYmplY3QgYXNzaWducyBhbiAzRCBvYmplY3QgdG8gMSBvciBtb3JlIG9mIDMyCiAgICAgKiBsYXllcnMgbnVtYmVyZWQgYDBgIHRvIGAzMWAgLSBpbnRlcm5hbGx5IHRoZSBsYXllcnMgYXJlIHN0b3JlZCBhcyBhCiAgICAgKiBiaXQgbWFza10sIGFuZCBieSBkZWZhdWx0IGFsbCAzRCBvYmplY3RzIGFyZSBhIG1lbWJlciBvZiBsYXllciBgMGAuCiAgICAgKgogICAgICogVGhpcyBjYW4gYmUgdXNlZCB0byBjb250cm9sIHZpc2liaWxpdHkgLSBhbiBvYmplY3QgbXVzdCBzaGFyZSBhIGxheWVyIHdpdGgKICAgICAqIGEgY2FtZXJhIHRvIGJlIHZpc2libGUgd2hlbiB0aGF0IGNhbWVyYSdzIHZpZXcgaXMKICAgICAqIHJlbmRlcmVkLgogICAgICoKICAgICAqIEFsbCBjbGFzc2VzIHRoYXQgaW5oZXJpdCBmcm9tIHtAbGluayBPYmplY3QzRH0gaGF2ZSBhbiBgbGF5ZXJzYCBwcm9wZXJ0eSB3aGljaAogICAgICogaXMgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcy4KICAgICAqLwogICAgY2xhc3MgTGF5ZXJzIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBsYXllcnMgaW5zdGFuY2UsIHdpdGggbWVtYmVyc2hpcAogICAgCSAqIGluaXRpYWxseSBzZXQgdG8gbGF5ZXIgYDBgLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCkgewoKICAgIAkJLyoqCiAgICAJCSAqIEEgYml0IG1hc2sgc3RvcmluZyB3aGljaCBvZiB0aGUgMzIgbGF5ZXJzIHRoaXMgbGF5ZXJzIG9iamVjdCBpcyBjdXJyZW50bHkKICAgIAkJICogYSBtZW1iZXIgb2YuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLm1hc2sgPSAxIHwgMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIG1lbWJlcnNoaXAgdG8gdGhlIGdpdmVuIGxheWVyLCBhbmQgcmVtb3ZlIG1lbWJlcnNoaXAgYWxsIG90aGVyIGxheWVycy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byBzZXQuCiAgICAJICovCiAgICAJc2V0KCBsYXllciApIHsKCiAgICAJCXRoaXMubWFzayA9ICggMSA8PCBsYXllciB8IDAgKSA+Pj4gMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIG1lbWJlcnNoaXAgb2YgdGhlIGdpdmVuIGxheWVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIGVuYWJsZS4KICAgIAkgKi8KICAgIAllbmFibGUoIGxheWVyICkgewoKICAgIAkJdGhpcy5tYXNrIHw9IDEgPDwgbGF5ZXIgfCAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgbWVtYmVyc2hpcCB0byBhbGwgbGF5ZXJzLgogICAgCSAqLwogICAgCWVuYWJsZUFsbCgpIHsKCiAgICAJCXRoaXMubWFzayA9IDB4ZmZmZmZmZmYgfCAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRvZ2dsZXMgdGhlIG1lbWJlcnNoaXAgb2YgdGhlIGdpdmVuIGxheWVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIHRvZ2dsZS4KICAgIAkgKi8KICAgIAl0b2dnbGUoIGxheWVyICkgewoKICAgIAkJdGhpcy5tYXNrIF49IDEgPDwgbGF5ZXIgfCAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlbW92ZXMgbWVtYmVyc2hpcCBvZiB0aGUgZ2l2ZW4gbGF5ZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbGF5ZXIgLSBUaGUgbGF5ZXIgdG8gZW5hYmxlLgogICAgCSAqLwogICAgCWRpc2FibGUoIGxheWVyICkgewoKICAgIAkJdGhpcy5tYXNrICY9IH4gKCAxIDw8IGxheWVyIHwgMCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlbW92ZXMgdGhlIG1lbWJlcnNoaXAgZnJvbSBhbGwgbGF5ZXJzLgogICAgCSAqLwogICAgCWRpc2FibGVBbGwoKSB7CgogICAgCQl0aGlzLm1hc2sgPSAwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgYW5kIHRoZSBnaXZlbiBsYXllcnMgb2JqZWN0IGhhdmUgYXQgbGVhc3Qgb25lCiAgICAJICogbGF5ZXIgaW4gY29tbW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtMYXllcnN9IGxheWVycyAtIFRoZSBsYXllcnMgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFuIH0gV2hldGhlciB0aGlzIGFuZCB0aGUgZ2l2ZW4gbGF5ZXJzIG9iamVjdCBoYXZlIGF0IGxlYXN0IG9uZSBsYXllciBpbiBjb21tb24gb3Igbm90LgogICAgCSAqLwogICAgCXRlc3QoIGxheWVycyApIHsKCiAgICAJCXJldHVybiAoIHRoaXMubWFzayAmIGxheWVycy5tYXNrICkgIT09IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGxheWVyIGlzIGVuYWJsZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gbGF5ZXIgLSBUaGUgbGF5ZXIgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFuIH0gV2hldGhlciB0aGUgZ2l2ZW4gbGF5ZXIgaXMgZW5hYmxlZCBvciBub3QuCiAgICAJICovCiAgICAJaXNFbmFibGVkKCBsYXllciApIHsKCiAgICAJCXJldHVybiAoIHRoaXMubWFzayAmICggMSA8PCBsYXllciB8IDAgKSApICE9PSAwOwoKICAgIAl9CgogICAgfQoKICAgIGxldCBfb2JqZWN0M0RJZCA9IDA7CgogICAgY29uc3QgX3YxJDQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfcTEgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CiAgICBjb25zdCBfbTEkMSQxID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwogICAgY29uc3QgX3RhcmdldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfcG9zaXRpb24kMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9zY2FsZSQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3F1YXRlcm5pb24kMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCiAgICBjb25zdCBfeEF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAxLCAwLCAwICk7CiAgICBjb25zdCBfeUF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAxLCAwICk7CiAgICBjb25zdCBfekF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAwLCAxICk7CgogICAgLyoqCiAgICAgKiBGaXJlcyB3aGVuIHRoZSBvYmplY3QgaGFzIGJlZW4gYWRkZWQgdG8gaXRzIHBhcmVudCBvYmplY3QuCiAgICAgKgogICAgICogQGV2ZW50IE9iamVjdDNEI2FkZGVkCiAgICAgKiBAdHlwZSB7T2JqZWN0fQogICAgICovCiAgICBjb25zdCBfYWRkZWRFdmVudCA9IHsgdHlwZTogJ2FkZGVkJyB9OwoKICAgIC8qKgogICAgICogRmlyZXMgd2hlbiB0aGUgb2JqZWN0IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBpdHMgcGFyZW50IG9iamVjdC4KICAgICAqCiAgICAgKiBAZXZlbnQgT2JqZWN0M0QjcmVtb3ZlZAogICAgICogQHR5cGUge09iamVjdH0KICAgICAqLwogICAgY29uc3QgX3JlbW92ZWRFdmVudCA9IHsgdHlwZTogJ3JlbW92ZWQnIH07CgogICAgLyoqCiAgICAgKiBGaXJlcyB3aGVuIGEgbmV3IGNoaWxkIG9iamVjdCBoYXMgYmVlbiBhZGRlZC4KICAgICAqCiAgICAgKiBAZXZlbnQgT2JqZWN0M0QjY2hpbGRhZGRlZAogICAgICogQHR5cGUge09iamVjdH0KICAgICAqLwogICAgY29uc3QgX2NoaWxkYWRkZWRFdmVudCA9IHsgdHlwZTogJ2NoaWxkYWRkZWQnLCBjaGlsZDogbnVsbCB9OwoKICAgIC8qKgogICAgICogRmlyZXMgd2hlbiBhIGNoaWxkIG9iamVjdCBoYXMgYmVlbiByZW1vdmVkLgogICAgICoKICAgICAqIEBldmVudCBPYmplY3QzRCNjaGlsZHJlbW92ZWQKICAgICAqIEB0eXBlIHtPYmplY3R9CiAgICAgKi8KICAgIGNvbnN0IF9jaGlsZHJlbW92ZWRFdmVudCA9IHsgdHlwZTogJ2NoaWxkcmVtb3ZlZCcsIGNoaWxkOiBudWxsIH07CgogICAgLyoqCiAgICAgKiBUaGlzIGlzIHRoZSBiYXNlIGNsYXNzIGZvciBtb3N0IG9iamVjdHMgaW4gdGhyZWUuanMgYW5kIHByb3ZpZGVzIGEgc2V0IG9mCiAgICAgKiBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIGZvciBtYW5pcHVsYXRpbmcgb2JqZWN0cyBpbiAzRCBzcGFjZS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgRXZlbnREaXNwYXRjaGVyCiAgICAgKi8KICAgIGNsYXNzIE9iamVjdDNEIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyAzRCBvYmplY3QuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNPYmplY3QzRCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIElEIG9mIHRoZSAzRCBvYmplY3QuCiAgICAJCSAqCiAgICAJCSAqIEBuYW1lIE9iamVjdDNEI2lkCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKi8KICAgIAkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfb2JqZWN0M0RJZCArKyB9ICk7CgogICAgCQkvKioKICAgIAkJICogVGhlIFVVSUQgb2YgdGhlIDNEIG9iamVjdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbmFtZSBvZiB0aGUgM0Qgb2JqZWN0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy5uYW1lID0gJyc7CgogICAgCQkvKioKICAgIAkJICogVGhlIHR5cGUgcHJvcGVydHkgaXMgdXNlZCBmb3IgZGV0ZWN0aW5nIHRoZSBvYmplY3QgdHlwZQogICAgCQkgKiBpbiBjb250ZXh0IG9mIHNlcmlhbGl6YXRpb24vZGVzZXJpYWxpemF0aW9uLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMudHlwZSA9ICdPYmplY3QzRCc7CgogICAgCQkvKioKICAgIAkJICogQSByZWZlcmVuY2UgdG8gdGhlIHBhcmVudCBvYmplY3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/T2JqZWN0M0R9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMucGFyZW50ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBhcnJheSBob2xkaW5nIHRoZSBjaGlsZCAzRCBvYmplY3RzIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxPYmplY3QzRD59CiAgICAJCSAqLwogICAgCQl0aGlzLmNoaWxkcmVuID0gW107CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgYHVwYCBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCB3aGljaCBpbmZsdWVuY2VzCiAgICAJCSAqIHRoZSBvcmllbnRhdGlvbiB2aWEgbWV0aG9kcyBsaWtlIHtAbGluayBPYmplY3QzRCNsb29rQXR9LgogICAgCQkgKgogICAgCQkgKiBUaGUgZGVmYXVsdCB2YWx1ZXMgZm9yIGFsbCAzRCBvYmplY3RzIGlzIGRlZmluZWQgYnkgYE9iamVjdDNELkRFRkFVTFRfVVBgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMudXAgPSBPYmplY3QzRC5ERUZBVUxUX1VQLmNsb25lKCk7CgogICAgCQljb25zdCBwb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCk7CiAgICAJCWNvbnN0IHJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CiAgICAJCWNvbnN0IHF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgCQljb25zdCBzY2FsZSA9IG5ldyBWZWN0b3IzKCAxLCAxLCAxICk7CgogICAgCQlmdW5jdGlvbiBvblJvdGF0aW9uQ2hhbmdlKCkgewoKICAgIAkJCXF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKCByb3RhdGlvbiwgZmFsc2UgKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIG9uUXVhdGVybmlvbkNoYW5nZSgpIHsKCiAgICAJCQlyb3RhdGlvbi5zZXRGcm9tUXVhdGVybmlvbiggcXVhdGVybmlvbiwgdW5kZWZpbmVkLCBmYWxzZSApOwoKICAgIAkJfQoKICAgIAkJcm90YXRpb24uX29uQ2hhbmdlKCBvblJvdGF0aW9uQ2hhbmdlICk7CiAgICAJCXF1YXRlcm5pb24uX29uQ2hhbmdlKCBvblF1YXRlcm5pb25DaGFuZ2UgKTsKCiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCB0aGlzLCB7CiAgICAJCQkvKioKICAgIAkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHBvc2l0aW9uLgogICAgCQkJICoKICAgIAkJCSAqIEBuYW1lIE9iamVjdDNEI3Bvc2l0aW9uCiAgICAJCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJCSAqIEBkZWZhdWx0ICgwLDAsMCkKICAgIAkJCSAqLwogICAgCQkJcG9zaXRpb246IHsKICAgIAkJCQljb25maWd1cmFibGU6IHRydWUsCiAgICAJCQkJZW51bWVyYWJsZTogdHJ1ZSwKICAgIAkJCQl2YWx1ZTogcG9zaXRpb24KICAgIAkJCX0sCiAgICAJCQkvKioKICAgIAkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHJvdGF0aW9uIGFzIEV1bGVyIGFuZ2xlcywgaW4gcmFkaWFucy4KICAgIAkJCSAqCiAgICAJCQkgKiBAbmFtZSBPYmplY3QzRCNyb3RhdGlvbgogICAgCQkJICogQHR5cGUge0V1bGVyfQogICAgCQkJICogQGRlZmF1bHQgKDAsMCwwKQogICAgCQkJICovCiAgICAJCQlyb3RhdGlvbjogewogICAgCQkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIAkJCQllbnVtZXJhYmxlOiB0cnVlLAogICAgCQkJCXZhbHVlOiByb3RhdGlvbgogICAgCQkJfSwKICAgIAkJCS8qKgogICAgCQkJICogUmVwcmVzZW50cyB0aGUgb2JqZWN0J3MgbG9jYWwgcm90YXRpb24gYXMgUXVhdGVybmlvbnMuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgT2JqZWN0M0QjcXVhdGVybmlvbgogICAgCQkJICogQHR5cGUge1F1YXRlcm5pb259CiAgICAJCQkgKi8KICAgIAkJCXF1YXRlcm5pb246IHsKICAgIAkJCQljb25maWd1cmFibGU6IHRydWUsCiAgICAJCQkJZW51bWVyYWJsZTogdHJ1ZSwKICAgIAkJCQl2YWx1ZTogcXVhdGVybmlvbgogICAgCQkJfSwKICAgIAkJCS8qKgogICAgCQkJICogUmVwcmVzZW50cyB0aGUgb2JqZWN0J3MgbG9jYWwgc2NhbGUuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgT2JqZWN0M0Qjc2NhbGUKICAgIAkJCSAqIEB0eXBlIHtWZWN0b3IzfQogICAgCQkJICogQGRlZmF1bHQgKDEsMSwxKQogICAgCQkJICovCiAgICAJCQlzY2FsZTogewogICAgCQkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIAkJCQllbnVtZXJhYmxlOiB0cnVlLAogICAgCQkJCXZhbHVlOiBzY2FsZQogICAgCQkJfSwKICAgIAkJCS8qKgogICAgCQkJICogUmVwcmVzZW50cyB0aGUgb2JqZWN0J3MgbW9kZWwtdmlldyBtYXRyaXguCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgT2JqZWN0M0QjbW9kZWxWaWV3TWF0cml4CiAgICAJCQkgKiBAdHlwZSB7TWF0cml4NH0KICAgIAkJCSAqLwogICAgCQkJbW9kZWxWaWV3TWF0cml4OiB7CiAgICAJCQkJdmFsdWU6IG5ldyBNYXRyaXg0KCkKICAgIAkJCX0sCiAgICAJCQkvKioKICAgIAkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIG5vcm1hbCBtYXRyaXguCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgT2JqZWN0M0Qjbm9ybWFsTWF0cml4CiAgICAJCQkgKiBAdHlwZSB7TWF0cml4M30KICAgIAkJCSAqLwogICAgCQkJbm9ybWFsTWF0cml4OiB7CiAgICAJCQkJdmFsdWU6IG5ldyBNYXRyaXgzKCkKICAgIAkJCX0KICAgIAkJfSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBpbiBsb2NhbCBzcGFjZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge01hdHJpeDR9CiAgICAJCSAqLwogICAgCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgogICAgCQkvKioKICAgIAkJICogUmVwcmVzZW50cyB0aGUgb2JqZWN0J3MgdHJhbnNmb3JtYXRpb24gbWF0cml4IGluIHdvcmxkIHNwYWNlLgogICAgCQkgKiBJZiB0aGUgM0Qgb2JqZWN0IGhhcyBubyBwYXJlbnQsIHRoZW4gaXQncyBpZGVudGljYWwgdG8gdGhlIGxvY2FsIHRyYW5zZm9ybWF0aW9uIG1hdHJpeAogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TWF0cml4NH0KICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4V29ybGQgPSBuZXcgTWF0cml4NCgpOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIGVuZ2luZSBhdXRvbWF0aWNhbGx5IGNvbXB1dGVzIHRoZSBsb2NhbCBtYXRyaXggZnJvbSBwb3NpdGlvbiwKICAgIAkJICogcm90YXRpb24gYW5kIHNjYWxlIGV2ZXJ5IGZyYW1lLgogICAgCQkgKgogICAgCQkgKiBUaGUgZGVmYXVsdCB2YWx1ZXMgZm9yIGFsbCAzRCBvYmplY3RzIGlzIGRlZmluZWQgYnkgYE9iamVjdDNELkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IE9iamVjdDNELkRFRkFVTFRfTUFUUklYX0FVVE9fVVBEQVRFOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIGVuZ2luZSBhdXRvbWF0aWNhbGx5IGNvbXB1dGVzIHRoZSB3b3JsZCBtYXRyaXggZnJvbSB0aGUgY3VycmVudCBsb2NhbAogICAgCQkgKiBtYXRyaXggYW5kIHRoZSBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBoaWVyYXJjaHkuCiAgICAJCSAqCiAgICAJCSAqIFRoZSBkZWZhdWx0IHZhbHVlcyBmb3IgYWxsIDNEIG9iamVjdHMgaXMgZGVmaW5lZCBieSBgT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfV09STERfQVVUT19VUERBVEVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9XT1JMRF9BVVRPX1VQREFURTsgLy8gY2hlY2tlZCBieSB0aGUgcmVuZGVyZXIKCiAgICAJCS8qKgogICAgCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIGl0IGNhbGN1bGF0ZXMgdGhlIHdvcmxkIG1hdHJpeCBpbiB0aGF0IGZyYW1lIGFuZCByZXNldHMgdGhpcyBwcm9wZXJ0eQogICAgCQkgKiB0byBgZmFsc2VgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBsYXllciBtZW1iZXJzaGlwIG9mIHRoZSAzRCBvYmplY3QuIFRoZSAzRCBvYmplY3QgaXMgb25seSB2aXNpYmxlIGlmIGl0IGhhcwogICAgCQkgKiBhdCBsZWFzdCBvbmUgbGF5ZXIgaW4gY29tbW9uIHdpdGggdGhlIGNhbWVyYSBpbiB1c2UuIFRoaXMgcHJvcGVydHkgY2FuIGFsc28gYmUKICAgIAkJICogdXNlZCB0byBmaWx0ZXIgb3V0IHVud2FudGVkIG9iamVjdHMgaW4gcmF5LWludGVyc2VjdGlvbiB0ZXN0cyB3aGVuIHVzaW5nIHtAbGluayBSYXljYXN0ZXJ9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TGF5ZXJzfQogICAgCQkgKi8KICAgIAkJdGhpcy5sYXllcnMgPSBuZXcgTGF5ZXJzKCk7CgogICAgCQkvKioKICAgIAkJICogV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgM0Qgb2JqZWN0IGdldHMgcmVuZGVyZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBnZXRzIHJlbmRlcmVkIGludG8gc2hhZG93IG1hcHMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5jYXN0U2hhZG93ID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogV2hlbiBzZXQgdG8gYHRydWVgLCB0aGUgM0Qgb2JqZWN0IGlzIGFmZmVjdGVkIGJ5IHNoYWRvd3MgaW4gdGhlIHNjZW5lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMucmVjZWl2ZVNoYWRvdyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBpcyBob25vcmVkIGJ5IHZpZXcgZnJ1c3R1bSBjdWxsaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5mcnVzdHVtQ3VsbGVkID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIHZhbHVlIGFsbG93cyB0aGUgZGVmYXVsdCByZW5kZXJpbmcgb3JkZXIgb2Ygc2NlbmUgZ3JhcGggb2JqZWN0cyB0byBiZQogICAgCQkgKiBvdmVycmlkZGVuIGFsdGhvdWdoIG9wYXF1ZSBhbmQgdHJhbnNwYXJlbnQgb2JqZWN0cyByZW1haW4gc29ydGVkIGluZGVwZW5kZW50bHkuCiAgICAJCSAqIFdoZW4gdGhpcyBwcm9wZXJ0eSBpcyBzZXQgZm9yIGFuIGluc3RhbmNlIG9mIHtAbGluayBHcm91cH0sYWxsIGRlc2NlbmRhbnRzCiAgICAJCSAqIG9iamVjdHMgd2lsbCBiZSBzb3J0ZWQgYW5kIHJlbmRlcmVkIHRvZ2V0aGVyLiBTb3J0aW5nIGlzIGZyb20gbG93ZXN0IHRvIGhpZ2hlc3QKICAgIAkJICogcmVuZGVyIG9yZGVyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnJlbmRlck9yZGVyID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBhcnJheSBob2xkaW5nIHRoZSBhbmltYXRpb24gY2xpcHMgb2YgdGhlIDNEIG9iamVjdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PEFuaW1hdGlvbkNsaXA+fQogICAgCQkgKi8KICAgIAkJdGhpcy5hbmltYXRpb25zID0gW107CgogICAgCQkvKioKICAgIAkJICogQ3VzdG9tIGRlcHRoIG1hdGVyaWFsIHRvIGJlIHVzZWQgd2hlbiByZW5kZXJpbmcgdG8gdGhlIGRlcHRoIG1hcC4gQ2FuIG9ubHkgYmUgdXNlZAogICAgCQkgKiBpbiBjb250ZXh0IG9mIG1lc2hlcy4gV2hlbiBzaGFkb3ctY2FzdGluZyB3aXRoIGEge0BsaW5rIERpcmVjdGlvbmFsTGlnaHR9IG9yIHtAbGluayBTcG90TGlnaHR9LAogICAgCQkgKiBpZiB5b3UgYXJlIG1vZGlmeWluZyB2ZXJ0ZXggcG9zaXRpb25zIGluIHRoZSB2ZXJ0ZXggc2hhZGVyIHlvdSBtdXN0IHNwZWNpZnkgYSBjdXN0b20gZGVwdGgKICAgIAkJICogbWF0ZXJpYWwgZm9yIHByb3BlciBzaGFkb3dzLgogICAgCQkgKgogICAgCQkgKiBPbmx5IHJlbGV2YW50IGluIGNvbnRleHQgb2Yge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE1hdGVyaWFsfHVuZGVmaW5lZCl9CiAgICAJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAogICAgCQkgKi8KICAgIAkJdGhpcy5jdXN0b21EZXB0aE1hdGVyaWFsID0gdW5kZWZpbmVkOwoKICAgIAkJLyoqCiAgICAJCSAqIFNhbWUgYXMge0BsaW5rIE9iamVjdDNEI2N1c3RvbURlcHRoTWF0ZXJpYWx9LCBidXQgdXNlZCB3aXRoIHtAbGluayBQb2ludExpZ2h0fS4KICAgIAkJICoKICAgIAkJICogT25seSByZWxldmFudCBpbiBjb250ZXh0IG9mIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhNYXRlcmlhbHx1bmRlZmluZWQpfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMuY3VzdG9tRGlzdGFuY2VNYXRlcmlhbCA9IHVuZGVmaW5lZDsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9yZSBjdXN0b20gZGF0YSBhYm91dCB0aGUgM0Qgb2JqZWN0LiBJdAogICAgCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy51c2VyRGF0YSA9IHt9OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgYSAzRCBvYmplY3QgaXMgcmVuZGVyZWQgdG8gYSBzaGFkb3cgbWFwLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtSZW5kZXJlcnxXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0LgogICAgCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhIHRoYXQgaXMgdXNlZCB0byByZW5kZXIgdGhlIHNjZW5lLgogICAgCSAqIEBwYXJhbSB7Q2FtZXJhfSBzaGFkb3dDYW1lcmEgLSBUaGUgc2hhZG93IGNhbWVyYS4KICAgIAkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBnZW9tZXRyeSAtIFRoZSAzRCBvYmplY3QncyBnZW9tZXRyeS4KICAgIAkgKiBAcGFyYW0ge01hdGVyaWFsfSBkZXB0aE1hdGVyaWFsIC0gVGhlIGRlcHRoIG1hdGVyaWFsLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBncm91cCAtIFRoZSBnZW9tZXRyeSBncm91cCBkYXRhLgogICAgCSAqLwogICAgCW9uQmVmb3JlU2hhZG93KCAvKiByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICovICkge30KCiAgICAJLyoqCiAgICAJICogQSBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGFmdGVyIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkIHRvIGEgc2hhZG93IG1hcC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UmVuZGVyZXJ8V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBzY2VuZS4KICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gc2hhZG93Q2FtZXJhIC0gVGhlIHNoYWRvdyBjYW1lcmEuCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCiAgICAJICogQHBhcmFtIHtNYXRlcmlhbH0gZGVwdGhNYXRlcmlhbCAtIFRoZSBkZXB0aCBtYXRlcmlhbC4KICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KICAgIAkgKi8KICAgIAlvbkFmdGVyU2hhZG93KCAvKiByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICovICkge30KCiAgICAJLyoqCiAgICAJICogQSBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGJlZm9yZSBhIDNEIG9iamVjdCBpcyByZW5kZXJlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UmVuZGVyZXJ8V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBzY2VuZS4KICAgIAkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBnZW9tZXRyeSAtIFRoZSAzRCBvYmplY3QncyBnZW9tZXRyeS4KICAgIAkgKiBAcGFyYW0ge01hdGVyaWFsfSBtYXRlcmlhbCAtIFRoZSAzRCBvYmplY3QncyBtYXRlcmlhbC4KICAgIAkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KICAgIAkgKi8KICAgIAlvbkJlZm9yZVJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKi8gKSB7fQoKICAgIAkvKioKICAgIAkgKiBBIGNhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgYSAzRCBvYmplY3QgaXMgcmVuZGVyZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCiAgICAJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCiAgICAJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCiAgICAJICogQHBhcmFtIHtNYXRlcmlhbH0gbWF0ZXJpYWwgLSBUaGUgM0Qgb2JqZWN0J3MgbWF0ZXJpYWwuCiAgICAJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCiAgICAJICovCiAgICAJb25BZnRlclJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKi8gKSB7fQoKICAgIAkvKioKICAgIAkgKiBBcHBsaWVzIHRoZSBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggdG8gdGhlIG9iamVjdCBhbmQgdXBkYXRlcyB0aGUgb2JqZWN0J3MgcG9zaXRpb24sCiAgICAJICogcm90YXRpb24gYW5kIHNjYWxlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgogICAgCSAqLwogICAgCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKICAgIAkJaWYgKCB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgKSB0aGlzLnVwZGF0ZU1hdHJpeCgpOwoKICAgIAkJdGhpcy5tYXRyaXgucHJlbXVsdGlwbHkoIG1hdHJpeCApOwoKICAgIAkJdGhpcy5tYXRyaXguZGVjb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBcHBsaWVzIGEgcm90YXRpb24gcmVwcmVzZW50ZWQgYnkgZ2l2ZW4gdGhlIHF1YXRlcm5pb24gdG8gdGhlIDNEIG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWFwcGx5UXVhdGVybmlvbiggcSApIHsKCiAgICAJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggcSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZ2l2ZW4gcm90YXRpb24gcmVwcmVzZW50ZWQgYXMgYW4gYXhpcy9hbmdsZSBjb3VwbGUgdG8gdGhlIDNEIG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSAobm9ybWFsaXplZCkgYXhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICovCiAgICAJc2V0Um90YXRpb25Gcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCiAgICAJCS8vIGFzc3VtZXMgYXhpcyBpcyBub3JtYWxpemVkCgogICAgCQl0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiByb3RhdGlvbiByZXByZXNlbnRlZCBhcyBFdWxlciBhbmdsZXMgdG8gdGhlIDNEIG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7RXVsZXJ9IGV1bGVyIC0gVGhlIEV1bGVyIGFuZ2xlcy4KICAgIAkgKi8KICAgIAlzZXRSb3RhdGlvbkZyb21FdWxlciggZXVsZXIgKSB7CgogICAgCQl0aGlzLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKCBldWxlciwgdHJ1ZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIHJvdGF0aW9uIG1hdHJpeCB0byB0aGUgM0Qgb2JqZWN0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gQWx0aG91Z2ggYSA0eDQgbWF0cml4IGlzIGV4cGVjdGVkLCB0aGUgdXBwZXIgM3gzIHBvcnRpb24gbXVzdCBiZQogICAgCSAqIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpLgogICAgCSAqLwogICAgCXNldFJvdGF0aW9uRnJvbU1hdHJpeCggbSApIHsKCiAgICAJCS8vIGFzc3VtZXMgdGhlIHVwcGVyIDN4MyBvZiBtIGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXggKGkuZSwgdW5zY2FsZWQpCgogICAgCQl0aGlzLnF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZ2l2ZW4gcm90YXRpb24gcmVwcmVzZW50ZWQgYXMgYSBRdWF0ZXJuaW9uIHRvIHRoZSAzRCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbgogICAgCSAqLwogICAgCXNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKSB7CgogICAgCQkvLyBhc3N1bWVzIHEgaXMgbm9ybWFsaXplZAoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHEgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYWxvbmcgYW4gYXhpcyBpbiBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSAobm9ybWFsaXplZCkgYXhpcyB2ZWN0b3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcm90YXRlT25BeGlzKCBheGlzLCBhbmdsZSApIHsKCiAgICAJCS8vIHJvdGF0ZSBvYmplY3Qgb24gYXhpcyBpbiBvYmplY3Qgc3BhY2UKICAgIAkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCiAgICAJCV9xMS5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApOwoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLm11bHRpcGx5KCBfcTEgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIDNEIG9iamVjdCBhbG9uZyBhbiBheGlzIGluIHdvcmxkIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBheGlzIC0gVGhlIChub3JtYWxpemVkKSBheGlzIHZlY3Rvci4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlyb3RhdGVPbldvcmxkQXhpcyggYXhpcywgYW5nbGUgKSB7CgogICAgCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gd29ybGQgc3BhY2UKICAgIAkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKICAgIAkJLy8gbWV0aG9kIGFzc3VtZXMgbm8gcm90YXRlZCBwYXJlbnQKCiAgICAJCV9xMS5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApOwoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KCBfcTEgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIDNEIG9iamVjdCBhcm91bmQgaXRzIFggYXhpcyBpbiBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJvdGF0ZVgoIGFuZ2xlICkgewoKICAgIAkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCBfeEF4aXMsIGFuZ2xlICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFyb3VuZCBpdHMgWSBheGlzIGluIGxvY2FsIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcm90YXRlWSggYW5nbGUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIF95QXhpcywgYW5nbGUgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYXJvdW5kIGl0cyBaIGF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlyb3RhdGVaKCBhbmdsZSApIHsKCiAgICAJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggX3pBeGlzLCBhbmdsZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZSB0aGUgM0Qgb2JqZWN0IGJ5IGEgZGlzdGFuY2UgYWxvbmcgdGhlIGdpdmVuIGF4aXMgaW4gbG9jYWwgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSBkaXN0YW5jZSBpbiB3b3JsZCB1bml0cy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGVPbkF4aXMoIGF4aXMsIGRpc3RhbmNlICkgewoKICAgIAkJLy8gdHJhbnNsYXRlIG9iamVjdCBieSBkaXN0YW5jZSBhbG9uZyBheGlzIGluIG9iamVjdCBzcGFjZQogICAgCQkvLyBheGlzIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoKICAgIAkJX3YxJDQuY29weSggYXhpcyApLmFwcGx5UXVhdGVybmlvbiggdGhpcy5xdWF0ZXJuaW9uICk7CgogICAgCQl0aGlzLnBvc2l0aW9uLmFkZCggX3YxJDQubXVsdGlwbHlTY2FsYXIoIGRpc3RhbmNlICkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZSB0aGUgM0Qgb2JqZWN0IGJ5IGEgZGlzdGFuY2UgYWxvbmcgaXRzIFgtYXhpcyBpbiBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSBkaXN0YW5jZSBpbiB3b3JsZCB1bml0cy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGVYKCBkaXN0YW5jZSApIHsKCiAgICAJCXJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyggX3hBeGlzLCBkaXN0YW5jZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZSB0aGUgM0Qgb2JqZWN0IGJ5IGEgZGlzdGFuY2UgYWxvbmcgaXRzIFktYXhpcyBpbiBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSBkaXN0YW5jZSBpbiB3b3JsZCB1bml0cy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGVZKCBkaXN0YW5jZSApIHsKCiAgICAJCXJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyggX3lBeGlzLCBkaXN0YW5jZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRyYW5zbGF0ZSB0aGUgM0Qgb2JqZWN0IGJ5IGEgZGlzdGFuY2UgYWxvbmcgaXRzIFotYXhpcyBpbiBsb2NhbCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSBkaXN0YW5jZSBpbiB3b3JsZCB1bml0cy4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAl0cmFuc2xhdGVaKCBkaXN0YW5jZSApIHsKCiAgICAJCXJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyggX3pBeGlzLCBkaXN0YW5jZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbnZlcnRzIHRoZSBnaXZlbiB2ZWN0b3IgZnJvbSB0aGlzIDNEIG9iamVjdCdzIGxvY2FsIHNwYWNlIHRvIHdvcmxkIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2ZWN0b3IgLSBUaGUgdmVjdG9yIHRvIGNvbnZlcnQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNvbnZlcnRlZCB2ZWN0b3IuCiAgICAJICovCiAgICAJbG9jYWxUb1dvcmxkKCB2ZWN0b3IgKSB7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJcmV0dXJuIHZlY3Rvci5hcHBseU1hdHJpeDQoIHRoaXMubWF0cml4V29ybGQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyAzRCBvYmplY3QncyB3b3JkIHNwYWNlIHRvIGxvY2FsIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2ZWN0b3IgLSBUaGUgdmVjdG9yIHRvIGNvbnZlcnQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNvbnZlcnRlZCB2ZWN0b3IuCiAgICAJICovCiAgICAJd29ybGRUb0xvY2FsKCB2ZWN0b3IgKSB7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJcmV0dXJuIHZlY3Rvci5hcHBseU1hdHJpeDQoIF9tMSQxJDEuY29weSggdGhpcy5tYXRyaXhXb3JsZCApLmludmVydCgpICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgb2JqZWN0IHRvIGZhY2UgYSBwb2ludCBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgb2JqZWN0cyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgcGFyZW50KHMpLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ8VmVjdG9yM30geCAtIFRoZSB4IGNvb3JkaW5hdGUgaW4gd29ybGQgc3BhY2UuIEFsdGVybmF0aXZlbHksIGEgdmVjdG9yIHJlcHJlc2VudGluZyBhIHBvc2l0aW9uIGluIHdvcmxkIHNwYWNlCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt5XSAtIFRoZSB5IGNvb3JkaW5hdGUgaW4gd29ybGQgc3BhY2UuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt6XSAtIFRoZSB6IGNvb3JkaW5hdGUgaW4gd29ybGQgc3BhY2UuCiAgICAJICovCiAgICAJbG9va0F0KCB4LCB5LCB6ICkgewoKICAgIAkJLy8gVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCBvYmplY3RzIGhhdmluZyBub24tdW5pZm9ybWx5LXNjYWxlZCBwYXJlbnQocykKCiAgICAJCWlmICggeC5pc1ZlY3RvcjMgKSB7CgogICAgCQkJX3RhcmdldC5jb3B5KCB4ICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCV90YXJnZXQuc2V0KCB4LCB5LCB6ICk7CgogICAgCQl9CgogICAgCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCiAgICAJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgogICAgCQlfcG9zaXRpb24kMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubWF0cml4V29ybGQgKTsKCiAgICAJCWlmICggdGhpcy5pc0NhbWVyYSB8fCB0aGlzLmlzTGlnaHQgKSB7CgogICAgCQkJX20xJDEkMS5sb29rQXQoIF9wb3NpdGlvbiQzLCBfdGFyZ2V0LCB0aGlzLnVwICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCV9tMSQxJDEubG9va0F0KCBfdGFyZ2V0LCBfcG9zaXRpb24kMywgdGhpcy51cCApOwoKICAgIAkJfQoKICAgIAkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX20xJDEkMSApOwoKICAgIAkJaWYgKCBwYXJlbnQgKSB7CgogICAgCQkJX20xJDEkMS5leHRyYWN0Um90YXRpb24oIHBhcmVudC5tYXRyaXhXb3JsZCApOwogICAgCQkJX3ExLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX20xJDEkMSApOwogICAgCQkJdGhpcy5xdWF0ZXJuaW9uLnByZW11bHRpcGx5KCBfcTEuaW52ZXJ0KCkgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgYSBjaGlsZCB0byB0aGlzIDNEIG9iamVjdC4gQW4gYXJiaXRyYXJ5IG51bWJlciBvZgogICAgCSAqIG9iamVjdHMgbWF5IGJlIGFkZGVkLiBBbnkgY3VycmVudCBwYXJlbnQgb24gYW4gb2JqZWN0IHBhc3NlZCBpbiBoZXJlIHdpbGwgYmUKICAgIAkgKiByZW1vdmVkLCBzaW5jZSBhbiBvYmplY3QgY2FuIGhhdmUgYXQgbW9zdCBvbmUgcGFyZW50LgogICAgCSAqCiAgICAJICogQGZpcmVzIE9iamVjdDNEI2FkZGVkCiAgICAJICogQGZpcmVzIE9iamVjdDNEI2NoaWxkYWRkZWQKICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIGFkZC4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlhZGQoIG9iamVjdCApIHsKCiAgICAJCWlmICggYXJndW1lbnRzLmxlbmd0aCA+IDEgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJdGhpcy5hZGQoIGFyZ3VtZW50c1sgaSBdICk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJaWYgKCBvYmplY3QgPT09IHRoaXMgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk9iamVjdDNELmFkZDogb2JqZWN0IGNhblwndCBiZSBhZGRlZCBhcyBhIGNoaWxkIG9mIGl0c2VsZi4nLCBvYmplY3QgKTsKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfQoKICAgIAkJaWYgKCBvYmplY3QgJiYgb2JqZWN0LmlzT2JqZWN0M0QgKSB7CgogICAgCQkJb2JqZWN0LnJlbW92ZUZyb21QYXJlbnQoKTsKICAgIAkJCW9iamVjdC5wYXJlbnQgPSB0aGlzOwogICAgCQkJdGhpcy5jaGlsZHJlbi5wdXNoKCBvYmplY3QgKTsKCiAgICAJCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggX2FkZGVkRXZlbnQgKTsKCiAgICAJCQlfY2hpbGRhZGRlZEV2ZW50LmNoaWxkID0gb2JqZWN0OwogICAgCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCBfY2hpbGRhZGRlZEV2ZW50ICk7CiAgICAJCQlfY2hpbGRhZGRlZEV2ZW50LmNoaWxkID0gbnVsbDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk9iamVjdDNELmFkZDogb2JqZWN0IG5vdCBhbiBpbnN0YW5jZSBvZiBUSFJFRS5PYmplY3QzRC4nLCBvYmplY3QgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlbW92ZXMgdGhlIGdpdmVuIDNEIG9iamVjdCBhcyBjaGlsZCBmcm9tIHRoaXMgM0Qgb2JqZWN0LgogICAgCSAqIEFuIGFyYml0cmFyeSBudW1iZXIgb2Ygb2JqZWN0cyBtYXkgYmUgcmVtb3ZlZC4KICAgIAkgKgogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNyZW1vdmVkCiAgICAJICogQGZpcmVzIE9iamVjdDNEI2NoaWxkcmVtb3ZlZAogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gcmVtb3ZlLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJlbW92ZSggb2JqZWN0ICkgewoKICAgIAkJaWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMSApIHsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQl0aGlzLnJlbW92ZSggYXJndW1lbnRzWyBpIF0gKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIHRoaXM7CgogICAgCQl9CgogICAgCQljb25zdCBpbmRleCA9IHRoaXMuY2hpbGRyZW4uaW5kZXhPZiggb2JqZWN0ICk7CgogICAgCQlpZiAoIGluZGV4ICE9PSAtMSApIHsKCiAgICAJCQlvYmplY3QucGFyZW50ID0gbnVsbDsKICAgIAkJCXRoaXMuY2hpbGRyZW4uc3BsaWNlKCBpbmRleCwgMSApOwoKICAgIAkJCW9iamVjdC5kaXNwYXRjaEV2ZW50KCBfcmVtb3ZlZEV2ZW50ICk7CgogICAgCQkJX2NoaWxkcmVtb3ZlZEV2ZW50LmNoaWxkID0gb2JqZWN0OwogICAgCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCBfY2hpbGRyZW1vdmVkRXZlbnQgKTsKICAgIAkJCV9jaGlsZHJlbW92ZWRFdmVudC5jaGlsZCA9IG51bGw7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIHRoaXMgM0Qgb2JqZWN0IGZyb20gaXRzIGN1cnJlbnQgcGFyZW50LgogICAgCSAqCiAgICAJICogQGZpcmVzIE9iamVjdDNEI3JlbW92ZWQKICAgIAkgKiBAZmlyZXMgT2JqZWN0M0QjY2hpbGRyZW1vdmVkCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcmVtb3ZlRnJvbVBhcmVudCgpIHsKCiAgICAJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKICAgIAkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgogICAgCQkJcGFyZW50LnJlbW92ZSggdGhpcyApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVtb3ZlcyBhbGwgY2hpbGQgb2JqZWN0cy4KICAgIAkgKgogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNyZW1vdmVkCiAgICAJICogQGZpcmVzIE9iamVjdDNEI2NoaWxkcmVtb3ZlZAogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsZWFyKCkgewoKICAgIAkJcmV0dXJuIHRoaXMucmVtb3ZlKCAuLi4gdGhpcy5jaGlsZHJlbiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgdGhlIGdpdmVuIDNEIG9iamVjdCBhcyBhIGNoaWxkIG9mIHRoaXMgM0Qgb2JqZWN0LCB3aGlsZSBtYWludGFpbmluZyB0aGUgb2JqZWN0J3Mgd29ybGQKICAgIAkgKiB0cmFuc2Zvcm0uIFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgc2NlbmUgZ3JhcGhzIGhhdmluZyBub24tdW5pZm9ybWx5LXNjYWxlZCBub2RlcyhzKS4KICAgIAkgKgogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNhZGRlZAogICAgCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZGFkZGVkCiAgICAJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0byBhdHRhY2guCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYXR0YWNoKCBvYmplY3QgKSB7CgogICAgCQkvLyBhZGRzIG9iamVjdCBhcyBhIGNoaWxkIG9mIHRoaXMsIHdoaWxlIG1haW50YWluaW5nIHRoZSBvYmplY3QncyB3b3JsZCB0cmFuc2Zvcm0KCiAgICAJCS8vIE5vdGU6IFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgc2NlbmUgZ3JhcGhzIGhhdmluZyBub24tdW5pZm9ybWx5LXNjYWxlZCBub2RlcyhzKQoKICAgIAkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCV9tMSQxJDEuY29weSggdGhpcy5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKICAgIAkJaWYgKCBvYmplY3QucGFyZW50ICE9PSBudWxsICkgewoKICAgIAkJCW9iamVjdC5wYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgogICAgCQkJX20xJDEkMS5tdWx0aXBseSggb2JqZWN0LnBhcmVudC5tYXRyaXhXb3JsZCApOwoKICAgIAkJfQoKICAgIAkJb2JqZWN0LmFwcGx5TWF0cml4NCggX20xJDEkMSApOwoKICAgIAkJb2JqZWN0LnJlbW92ZUZyb21QYXJlbnQoKTsKICAgIAkJb2JqZWN0LnBhcmVudCA9IHRoaXM7CiAgICAJCXRoaXMuY2hpbGRyZW4ucHVzaCggb2JqZWN0ICk7CgogICAgCQlvYmplY3QudXBkYXRlV29ybGRNYXRyaXgoIGZhbHNlLCB0cnVlICk7CgogICAgCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggX2FkZGVkRXZlbnQgKTsKCiAgICAJCV9jaGlsZGFkZGVkRXZlbnQuY2hpbGQgPSBvYmplY3Q7CiAgICAJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkYWRkZWRFdmVudCApOwogICAgCQlfY2hpbGRhZGRlZEV2ZW50LmNoaWxkID0gbnVsbDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKICAgIAkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIHRoZSBmaXJzdCB3aXRoIGEgbWF0Y2hpbmcgSUQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaWQgLSBUaGUgaWQuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R8dW5kZWZpbmVkfSBUaGUgZm91bmQgM0Qgb2JqZWN0LiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIG5vIDNEIG9iamVjdCBoYXMgYmVlbiBmb3VuZC4KICAgIAkgKi8KICAgIAlnZXRPYmplY3RCeUlkKCBpZCApIHsKCiAgICAJCXJldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoICdpZCcsIGlkICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VhcmNoZXMgdGhyb3VnaCB0aGUgM0Qgb2JqZWN0IGFuZCBpdHMgY2hpbGRyZW4sIHN0YXJ0aW5nIHdpdGggdGhlIDNEIG9iamVjdAogICAgCSAqIGl0c2VsZiwgYW5kIHJldHVybnMgdGhlIGZpcnN0IHdpdGggYSBtYXRjaGluZyBuYW1lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZS4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRHx1bmRlZmluZWR9IFRoZSBmb3VuZCAzRCBvYmplY3QuIFJldHVybnMgYHVuZGVmaW5lZGAgaWYgbm8gM0Qgb2JqZWN0IGhhcyBiZWVuIGZvdW5kLgogICAgCSAqLwogICAgCWdldE9iamVjdEJ5TmFtZSggbmFtZSApIHsKCiAgICAJCXJldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoICduYW1lJywgbmFtZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKICAgIAkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIHRoZSBmaXJzdCB3aXRoIGEgbWF0Y2hpbmcgcHJvcGVydHkgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBwcm9wZXJ0eS4KICAgIAkgKiBAcGFyYW0ge2FueX0gdmFsdWUgLSBUaGUgdmFsdWUuCiAgICAJICogQHJldHVybiB7T2JqZWN0M0R8dW5kZWZpbmVkfSBUaGUgZm91bmQgM0Qgb2JqZWN0LiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIG5vIDNEIG9iamVjdCBoYXMgYmVlbiBmb3VuZC4KICAgIAkgKi8KICAgIAlnZXRPYmplY3RCeVByb3BlcnR5KCBuYW1lLCB2YWx1ZSApIHsKCiAgICAJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJldHVybiB0aGlzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlblsgaSBdOwogICAgCQkJY29uc3Qgb2JqZWN0ID0gY2hpbGQuZ2V0T2JqZWN0QnlQcm9wZXJ0eSggbmFtZSwgdmFsdWUgKTsKCiAgICAJCQlpZiAoIG9iamVjdCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlyZXR1cm4gb2JqZWN0OwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB1bmRlZmluZWQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VhcmNoZXMgdGhyb3VnaCB0aGUgM0Qgb2JqZWN0IGFuZCBpdHMgY2hpbGRyZW4sIHN0YXJ0aW5nIHdpdGggdGhlIDNEIG9iamVjdAogICAgCSAqIGl0c2VsZiwgYW5kIHJldHVybnMgYWxsIDNEIG9iamVjdHMgd2l0aCBhIG1hdGNoaW5nIHByb3BlcnR5IHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkuCiAgICAJICogQHBhcmFtIHthbnl9IHZhbHVlIC0gVGhlIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0M0Q+fSByZXN1bHQgLSBUaGUgbWV0aG9kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8T2JqZWN0M0Q+fSBUaGUgZm91bmQgM0Qgb2JqZWN0cy4KICAgIAkgKi8KICAgIAlnZXRPYmplY3RzQnlQcm9wZXJ0eSggbmFtZSwgdmFsdWUsIHJlc3VsdCA9IFtdICkgewoKICAgIAkJaWYgKCB0aGlzWyBuYW1lIF0gPT09IHZhbHVlICkgcmVzdWx0LnB1c2goIHRoaXMgKTsKCiAgICAJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY2hpbGRyZW5bIGkgXS5nZXRPYmplY3RzQnlQcm9wZXJ0eSggbmFtZSwgdmFsdWUsIHJlc3VsdCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHJlc3VsdDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgcG9zaXRpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIHBvc2l0aW9uIGluIHdvcmxkIHNwYWNlLgogICAgCSAqLwogICAgCWdldFdvcmxkUG9zaXRpb24oIHRhcmdldCApIHsKCiAgICAJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgogICAgCQlyZXR1cm4gdGFyZ2V0LnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5tYXRyaXhXb3JsZCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBRdWF0ZXJuaW9uIHJlcHJlc2VudGluZyB0aGUgcG9zaXRpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gdGFyZ2V0IC0gVGhlIHRhcmdldCBRdWF0ZXJuaW9uIHRoZSByZXN1bHQgaXMgc3RvcmVkIHRvLgogICAgCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IFRoZSAzRCBvYmplY3QncyByb3RhdGlvbiBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKi8KICAgIAlnZXRXb3JsZFF1YXRlcm5pb24oIHRhcmdldCApIHsKCiAgICAJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgogICAgCQl0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggX3Bvc2l0aW9uJDMsIHRhcmdldCwgX3NjYWxlJDIgKTsKCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIHNjYWxlIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoZSByZXN1bHQgaXMgc3RvcmVkIHRvLgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSAzRCBvYmplY3QncyBzY2FsZSBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKi8KICAgIAlnZXRXb3JsZFNjYWxlKCB0YXJnZXQgKSB7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQzLCBfcXVhdGVybmlvbiQyLCB0YXJnZXQgKTsKCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIHZlY3RvciByZXByZXNlbnRpbmcgdGhlICgibG9vayIpIGRpcmVjdGlvbiBvZiB0aGUgM0Qgb2JqZWN0IGluIHdvcmxkIHNwYWNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgM0Qgb2JqZWN0J3MgZGlyZWN0aW9uIGluIHdvcmxkIHNwYWNlLgogICAgCSAqLwogICAgCWdldFdvcmxkRGlyZWN0aW9uKCB0YXJnZXQgKSB7CgogICAgCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKICAgIAkJY29uc3QgZSA9IHRoaXMubWF0cml4V29ybGQuZWxlbWVudHM7CgogICAgCQlyZXR1cm4gdGFyZ2V0LnNldCggZVsgOCBdLCBlWyA5IF0sIGVbIDEwIF0gKS5ub3JtYWxpemUoKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBYnN0cmFjdCBtZXRob2QgdG8gZ2V0IGludGVyc2VjdGlvbnMgYmV0d2VlbiBhIGNhc3RlZCByYXkgYW5kIHRoaXMKICAgIAkgKiAzRCBvYmplY3QuIFJlbmRlcmFibGUgM0Qgb2JqZWN0cyBzdWNoIGFzIHtAbGluayBNZXNofSwge0BsaW5rIExpbmV9IG9yIHtAbGluayBQb2ludHN9CiAgICAJICogaW1wbGVtZW50IHRoaXMgbWV0aG9kIGluIG9yZGVyIHRvIHVzZSByYXljYXN0aW5nLgogICAgCSAqCiAgICAJICogQGFic3RyYWN0CiAgICAJICogQHBhcmFtIHtSYXljYXN0ZXJ9IHJheWNhc3RlciAtIFRoZSByYXljYXN0ZXIuCiAgICAJICogQHBhcmFtIHtBcnJheTxPYmplY3Q+fSBpbnRlcnNlY3RzIC0gQW4gYXJyYXkgaG9sZGluZyB0aGUgcmVzdWx0IG9mIHRoZSBtZXRob2QuCiAgICAJICovCiAgICAJcmF5Y2FzdCggLyogcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICovICkge30KCiAgICAJLyoqCiAgICAJICogRXhlY3V0ZXMgdGhlIGNhbGxiYWNrIG9uIHRoaXMgM0Qgb2JqZWN0IGFuZCBhbGwgZGVzY2VuZGFudHMuCiAgICAJICoKICAgIAkgKiBOb3RlOiBNb2RpZnlpbmcgdGhlIHNjZW5lIGdyYXBoIGluc2lkZSB0aGUgY2FsbGJhY2sgaXMgZGlzY291cmFnZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIEEgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBhbGxvd3MgdG8gcHJvY2VzcyB0aGUgY3VycmVudCAzRCBvYmplY3QuCiAgICAJICovCiAgICAJdHJhdmVyc2UoIGNhbGxiYWNrICkgewoKICAgIAkJY2FsbGJhY2soIHRoaXMgKTsKCiAgICAJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY2hpbGRyZW5bIGkgXS50cmF2ZXJzZSggY2FsbGJhY2sgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaWtlIHtAbGluayBPYmplY3QzRCN0cmF2ZXJzZX0sIGJ1dCB0aGUgY2FsbGJhY2sgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGZvciB2aXNpYmxlIDNEIG9iamVjdHMuCiAgICAJICogRGVzY2VuZGFudHMgb2YgaW52aXNpYmxlIDNEIG9iamVjdHMgYXJlIG5vdCB0cmF2ZXJzZWQuCiAgICAJICoKICAgIAkgKiBOb3RlOiBNb2RpZnlpbmcgdGhlIHNjZW5lIGdyYXBoIGluc2lkZSB0aGUgY2FsbGJhY2sgaXMgZGlzY291cmFnZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIEEgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBhbGxvd3MgdG8gcHJvY2VzcyB0aGUgY3VycmVudCAzRCBvYmplY3QuCiAgICAJICovCiAgICAJdHJhdmVyc2VWaXNpYmxlKCBjYWxsYmFjayApIHsKCiAgICAJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCiAgICAJCWNhbGxiYWNrKCB0aGlzICk7CgogICAgCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCWNoaWxkcmVuWyBpIF0udHJhdmVyc2VWaXNpYmxlKCBjYWxsYmFjayApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIExpa2Uge0BsaW5rIE9iamVjdDNEI3RyYXZlcnNlfSwgYnV0IHRoZSBjYWxsYmFjayB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgZm9yIGFsbCBhbmNlc3RvcnMuCiAgICAJICoKICAgIAkgKiBOb3RlOiBNb2RpZnlpbmcgdGhlIHNjZW5lIGdyYXBoIGluc2lkZSB0aGUgY2FsbGJhY2sgaXMgZGlzY291cmFnZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIEEgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBhbGxvd3MgdG8gcHJvY2VzcyB0aGUgY3VycmVudCAzRCBvYmplY3QuCiAgICAJICovCiAgICAJdHJhdmVyc2VBbmNlc3RvcnMoIGNhbGxiYWNrICkgewoKICAgIAkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgogICAgCQlpZiAoIHBhcmVudCAhPT0gbnVsbCApIHsKCiAgICAJCQljYWxsYmFjayggcGFyZW50ICk7CgogICAgCQkJcGFyZW50LnRyYXZlcnNlQW5jZXN0b3JzKCBjYWxsYmFjayApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFVwZGF0ZXMgdGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBpbiBsb2NhbCBzcGFjZSBieSBjb21wdXRpbmcgaXQgZnJvbSB0aGUgY3VycmVudAogICAgCSAqIHBvc2l0aW9uLCByb3RhdGlvbiBhbmQgc2NhbGUgdmFsdWVzLgogICAgCSAqLwogICAgCXVwZGF0ZU1hdHJpeCgpIHsKCiAgICAJCXRoaXMubWF0cml4LmNvbXBvc2UoIHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgdGhpcy5zY2FsZSApOwoKICAgIAkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBVcGRhdGVzIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gd29ybGQgc3BhY2Ugb2YgdGhpcyAzRCBvYmplY3RzIGFuZCBpdHMgZGVzY2VuZGFudHMuCiAgICAJICoKICAgIAkgKiBUbyBlbnN1cmUgY29ycmVjdCByZXN1bHRzLCB0aGlzIG1ldGhvZCBhbHNvIHJlY29tcHV0ZXMgdGhlIDNEIG9iamVjdCdzIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBpbgogICAgCSAqIGxvY2FsIHNwYWNlLiBUaGUgY29tcHV0YXRpb24gb2YgdGhlIGxvY2FsIGFuZCB3b3JsZCBtYXRyaXggY2FuIGJlIGNvbnRyb2xsZWQgd2l0aCB0aGUKICAgIAkgKiB7QGxpbmsgT2JqZWN0M0QjbWF0cml4QXV0b1VwZGF0ZX0gYW5kIHtAbGluayBPYmplY3QzRCNtYXRyaXhXb3JsZEF1dG9VcGRhdGV9IGZsYWdzIHdoaWNoIGFyZSBib3RoCiAgICAJICogYHRydWVgIGJ5IGRlZmF1bHQuICBTZXQgdGhlc2UgZmxhZ3MgdG8gYGZhbHNlYCBpZiB5b3UgbmVlZCBtb3JlIGNvbnRyb2wgb3ZlciB0aGUgdXBkYXRlIG1hdHJpeCBwcm9jZXNzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbZm9yY2U9ZmFsc2VdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBhIHJlY29tcHV0YXRpb24gb2Ygd29ybGQgbWF0cmljZXMgaXMgZm9yY2VkIGV2ZW4KICAgIAkgKiB3aGVuIHtAbGluayBPYmplY3QzRCNtYXRyaXhXb3JsZEF1dG9VcGRhdGV9IGlzIHNldCB0byBgZmFsc2VgLgogICAgCSAqLwogICAgCXVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApIHsKCiAgICAJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCiAgICAJCWlmICggdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlIHx8IGZvcmNlICkgewoKICAgIAkJCWlmICggdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgogICAgCQkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgogICAgCQkJCQl0aGlzLm1hdHJpeFdvcmxkLmNvcHkoIHRoaXMubWF0cml4ICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAkJCWZvcmNlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCS8vIG1ha2Ugc3VyZSBkZXNjZW5kYW50cyBhcmUgdXBkYXRlZCBpZiByZXF1aXJlZAoKICAgIAkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQljb25zdCBjaGlsZCA9IGNoaWxkcmVuWyBpIF07CgogICAgCQkJY2hpbGQudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQW4gYWx0ZXJuYXRpdmUgdmVyc2lvbiBvZiB7QGxpbmsgT2JqZWN0M0QjdXBkYXRlTWF0cml4V29ybGR9IHdpdGggbW9yZSBjb250cm9sIG92ZXIgdGhlCiAgICAJICogdXBkYXRlIG9mIGFuY2VzdG9yIGFuZCBkZXNjZW5kYW50IG5vZGVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbdXBkYXRlUGFyZW50cz1mYWxzZV0gV2hldGhlciBhbmNlc3RvciBub2RlcyBzaG91bGQgYmUgdXBkYXRlZCBvciBub3QuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbdXBkYXRlQ2hpbGRyZW49ZmFsc2VdIFdoZXRoZXIgZGVzY2VuZGFudCBub2RlcyBzaG91bGQgYmUgdXBkYXRlZCBvciBub3QuCiAgICAJICovCiAgICAJdXBkYXRlV29ybGRNYXRyaXgoIHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuICkgewoKICAgIAkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgogICAgCQlpZiAoIHVwZGF0ZVBhcmVudHMgPT09IHRydWUgJiYgcGFyZW50ICE9PSBudWxsICkgewoKICAgIAkJCXBhcmVudC51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCiAgICAJCWlmICggdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgogICAgCQkJaWYgKCB0aGlzLnBhcmVudCA9PT0gbnVsbCApIHsKCiAgICAJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXRoaXMubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyggdGhpcy5wYXJlbnQubWF0cml4V29ybGQsIHRoaXMubWF0cml4ICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gbWFrZSBzdXJlIGRlc2NlbmRhbnRzIGFyZSB1cGRhdGVkCgogICAgCQlpZiAoIHVwZGF0ZUNoaWxkcmVuID09PSB0cnVlICkgewoKICAgIAkJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQljb25zdCBjaGlsZCA9IGNoaWxkcmVuWyBpIF07CgogICAgCQkJCWNoaWxkLnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgdHJ1ZSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXJpYWxpemVzIHRoZSAzRCBvYmplY3QgaW50byBKU09OLgogICAgCSAqCiAgICAJICogQHBhcmFtIHs/KE9iamVjdHxzdHJpbmcpfSBtZXRhIC0gQW4gb3B0aW9uYWwgdmFsdWUgaG9sZGluZyBtZXRhIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzZXJpYWxpemF0aW9uLgogICAgCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgM0Qgb2JqZWN0LgogICAgCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KICAgIAkgKi8KICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQkvLyBtZXRhIGlzIGEgc3RyaW5nIHdoZW4gY2FsbGVkIGZyb20gSlNPTi5zdHJpbmdpZnkKICAgIAkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgogICAgCQljb25zdCBvdXRwdXQgPSB7fTsKCiAgICAJCS8vIG1ldGEgaXMgYSBoYXNoIHVzZWQgdG8gY29sbGVjdCBnZW9tZXRyaWVzLCBtYXRlcmlhbHMuCiAgICAJCS8vIG5vdCBwcm92aWRpbmcgaXQgaW1wbGllcyB0aGF0IHRoaXMgaXMgdGhlIHJvb3Qgb2JqZWN0CiAgICAJCS8vIGJlaW5nIHNlcmlhbGl6ZWQuCiAgICAJCWlmICggaXNSb290T2JqZWN0ICkgewoKICAgIAkJCS8vIGluaXRpYWxpemUgbWV0YSBvYmoKICAgIAkJCW1ldGEgPSB7CiAgICAJCQkJZ2VvbWV0cmllczoge30sCiAgICAJCQkJbWF0ZXJpYWxzOiB7fSwKICAgIAkJCQl0ZXh0dXJlczoge30sCiAgICAJCQkJaW1hZ2VzOiB7fSwKICAgIAkJCQlzaGFwZXM6IHt9LAogICAgCQkJCXNrZWxldG9uczoge30sCiAgICAJCQkJYW5pbWF0aW9uczoge30sCiAgICAJCQkJbm9kZXM6IHt9CiAgICAJCQl9OwoKICAgIAkJCW91dHB1dC5tZXRhZGF0YSA9IHsKICAgIAkJCQl2ZXJzaW9uOiA0LjcsCiAgICAJCQkJdHlwZTogJ09iamVjdCcsCiAgICAJCQkJZ2VuZXJhdG9yOiAnT2JqZWN0M0QudG9KU09OJwogICAgCQkJfTsKCiAgICAJCX0KCiAgICAJCS8vIHN0YW5kYXJkIE9iamVjdDNEIHNlcmlhbGl6YXRpb24KCiAgICAJCWNvbnN0IG9iamVjdCA9IHt9OwoKICAgIAkJb2JqZWN0LnV1aWQgPSB0aGlzLnV1aWQ7CiAgICAJCW9iamVjdC50eXBlID0gdGhpcy50eXBlOwoKICAgIAkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgb2JqZWN0Lm5hbWUgPSB0aGlzLm5hbWU7CiAgICAJCWlmICggdGhpcy5jYXN0U2hhZG93ID09PSB0cnVlICkgb2JqZWN0LmNhc3RTaGFkb3cgPSB0cnVlOwogICAgCQlpZiAoIHRoaXMucmVjZWl2ZVNoYWRvdyA9PT0gdHJ1ZSApIG9iamVjdC5yZWNlaXZlU2hhZG93ID0gdHJ1ZTsKICAgIAkJaWYgKCB0aGlzLnZpc2libGUgPT09IGZhbHNlICkgb2JqZWN0LnZpc2libGUgPSBmYWxzZTsKICAgIAkJaWYgKCB0aGlzLmZydXN0dW1DdWxsZWQgPT09IGZhbHNlICkgb2JqZWN0LmZydXN0dW1DdWxsZWQgPSBmYWxzZTsKICAgIAkJaWYgKCB0aGlzLnJlbmRlck9yZGVyICE9PSAwICkgb2JqZWN0LnJlbmRlck9yZGVyID0gdGhpcy5yZW5kZXJPcmRlcjsKICAgIAkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBvYmplY3QudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKICAgIAkJb2JqZWN0LmxheWVycyA9IHRoaXMubGF5ZXJzLm1hc2s7CiAgICAJCW9iamVjdC5tYXRyaXggPSB0aGlzLm1hdHJpeC50b0FycmF5KCk7CiAgICAJCW9iamVjdC51cCA9IHRoaXMudXAudG9BcnJheSgpOwoKICAgIAkJaWYgKCB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPT09IGZhbHNlICkgb2JqZWN0Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCiAgICAJCS8vIG9iamVjdCBzcGVjaWZpYyBwcm9wZXJ0aWVzCgogICAgCQlpZiAoIHRoaXMuaXNJbnN0YW5jZWRNZXNoICkgewoKICAgIAkJCW9iamVjdC50eXBlID0gJ0luc3RhbmNlZE1lc2gnOwogICAgCQkJb2JqZWN0LmNvdW50ID0gdGhpcy5jb3VudDsKICAgIAkJCW9iamVjdC5pbnN0YW5jZU1hdHJpeCA9IHRoaXMuaW5zdGFuY2VNYXRyaXgudG9KU09OKCk7CiAgICAJCQlpZiAoIHRoaXMuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCApIG9iamVjdC5pbnN0YW5jZUNvbG9yID0gdGhpcy5pbnN0YW5jZUNvbG9yLnRvSlNPTigpOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLmlzQmF0Y2hlZE1lc2ggKSB7CgogICAgCQkJb2JqZWN0LnR5cGUgPSAnQmF0Y2hlZE1lc2gnOwogICAgCQkJb2JqZWN0LnBlck9iamVjdEZydXN0dW1DdWxsZWQgPSB0aGlzLnBlck9iamVjdEZydXN0dW1DdWxsZWQ7CiAgICAJCQlvYmplY3Quc29ydE9iamVjdHMgPSB0aGlzLnNvcnRPYmplY3RzOwoKICAgIAkJCW9iamVjdC5kcmF3UmFuZ2VzID0gdGhpcy5fZHJhd1JhbmdlczsKICAgIAkJCW9iamVjdC5yZXNlcnZlZFJhbmdlcyA9IHRoaXMuX3Jlc2VydmVkUmFuZ2VzOwoKICAgIAkJCW9iamVjdC5nZW9tZXRyeUluZm8gPSB0aGlzLl9nZW9tZXRyeUluZm8ubWFwKCBpbmZvID0+ICggewogICAgCQkJCS4uLmluZm8sCiAgICAJCQkJYm91bmRpbmdCb3g6IGluZm8uYm91bmRpbmdCb3ggPyBpbmZvLmJvdW5kaW5nQm94LnRvSlNPTigpIDogdW5kZWZpbmVkLAogICAgCQkJCWJvdW5kaW5nU3BoZXJlOiBpbmZvLmJvdW5kaW5nU3BoZXJlID8gaW5mby5ib3VuZGluZ1NwaGVyZS50b0pTT04oKSA6IHVuZGVmaW5lZAogICAgCQkJfSApICk7CiAgICAJCQlvYmplY3QuaW5zdGFuY2VJbmZvID0gdGhpcy5faW5zdGFuY2VJbmZvLm1hcCggaW5mbyA9PiAoIHsgLi4uaW5mbyB9ICkgKTsKCiAgICAJCQlvYmplY3QuYXZhaWxhYmxlSW5zdGFuY2VJZHMgPSB0aGlzLl9hdmFpbGFibGVJbnN0YW5jZUlkcy5zbGljZSgpOwogICAgCQkJb2JqZWN0LmF2YWlsYWJsZUdlb21ldHJ5SWRzID0gdGhpcy5fYXZhaWxhYmxlR2VvbWV0cnlJZHMuc2xpY2UoKTsKCiAgICAJCQlvYmplY3QubmV4dEluZGV4U3RhcnQgPSB0aGlzLl9uZXh0SW5kZXhTdGFydDsKICAgIAkJCW9iamVjdC5uZXh0VmVydGV4U3RhcnQgPSB0aGlzLl9uZXh0VmVydGV4U3RhcnQ7CiAgICAJCQlvYmplY3QuZ2VvbWV0cnlDb3VudCA9IHRoaXMuX2dlb21ldHJ5Q291bnQ7CgogICAgCQkJb2JqZWN0Lm1heEluc3RhbmNlQ291bnQgPSB0aGlzLl9tYXhJbnN0YW5jZUNvdW50OwogICAgCQkJb2JqZWN0Lm1heFZlcnRleENvdW50ID0gdGhpcy5fbWF4VmVydGV4Q291bnQ7CiAgICAJCQlvYmplY3QubWF4SW5kZXhDb3VudCA9IHRoaXMuX21heEluZGV4Q291bnQ7CgogICAgCQkJb2JqZWN0Lmdlb21ldHJ5SW5pdGlhbGl6ZWQgPSB0aGlzLl9nZW9tZXRyeUluaXRpYWxpemVkOwoKICAgIAkJCW9iamVjdC5tYXRyaWNlc1RleHR1cmUgPSB0aGlzLl9tYXRyaWNlc1RleHR1cmUudG9KU09OKCBtZXRhICk7CgogICAgCQkJb2JqZWN0LmluZGlyZWN0VGV4dHVyZSA9IHRoaXMuX2luZGlyZWN0VGV4dHVyZS50b0pTT04oIG1ldGEgKTsKCiAgICAJCQlpZiAoIHRoaXMuX2NvbG9yc1RleHR1cmUgIT09IG51bGwgKSB7CgogICAgCQkJCW9iamVjdC5jb2xvcnNUZXh0dXJlID0gdGhpcy5fY29sb3JzVGV4dHVyZS50b0pTT04oIG1ldGEgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlICE9PSBudWxsICkgewoKICAgIAkJCQlvYmplY3QuYm91bmRpbmdTcGhlcmUgPSB0aGlzLmJvdW5kaW5nU3BoZXJlLnRvSlNPTigpOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgogICAgCQkJCW9iamVjdC5ib3VuZGluZ0JveCA9IHRoaXMuYm91bmRpbmdCb3gudG9KU09OKCk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8KCiAgICAJCWZ1bmN0aW9uIHNlcmlhbGl6ZSggbGlicmFyeSwgZWxlbWVudCApIHsKCiAgICAJCQlpZiAoIGxpYnJhcnlbIGVsZW1lbnQudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWxpYnJhcnlbIGVsZW1lbnQudXVpZCBdID0gZWxlbWVudC50b0pTT04oIG1ldGEgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGVsZW1lbnQudXVpZDsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5pc1NjZW5lICkgewoKICAgIAkJCWlmICggdGhpcy5iYWNrZ3JvdW5kICkgewoKICAgIAkJCQlpZiAoIHRoaXMuYmFja2dyb3VuZC5pc0NvbG9yICkgewoKICAgIAkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCk7CgogICAgCQkJCX0gZWxzZSBpZiAoIHRoaXMuYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgogICAgCQkJCQlvYmplY3QuYmFja2dyb3VuZCA9IHRoaXMuYmFja2dyb3VuZC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWlmICggdGhpcy5lbnZpcm9ubWVudCAmJiB0aGlzLmVudmlyb25tZW50LmlzVGV4dHVyZSAmJiB0aGlzLmVudmlyb25tZW50LmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSAhPT0gdHJ1ZSApIHsKCiAgICAJCQkJb2JqZWN0LmVudmlyb25tZW50ID0gdGhpcy5lbnZpcm9ubWVudC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSBpZiAoIHRoaXMuaXNNZXNoIHx8IHRoaXMuaXNMaW5lIHx8IHRoaXMuaXNQb2ludHMgKSB7CgogICAgCQkJb2JqZWN0Lmdlb21ldHJ5ID0gc2VyaWFsaXplKCBtZXRhLmdlb21ldHJpZXMsIHRoaXMuZ2VvbWV0cnkgKTsKCiAgICAJCQljb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5nZW9tZXRyeS5wYXJhbWV0ZXJzOwoKICAgIAkJCWlmICggcGFyYW1ldGVycyAhPT0gdW5kZWZpbmVkICYmIHBhcmFtZXRlcnMuc2hhcGVzICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnN0IHNoYXBlcyA9IHBhcmFtZXRlcnMuc2hhcGVzOwoKICAgIAkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApICkgewoKICAgIAkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQkJY29uc3Qgc2hhcGUgPSBzaGFwZXNbIGkgXTsKCiAgICAJCQkJCQlzZXJpYWxpemUoIG1ldGEuc2hhcGVzLCBzaGFwZSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJc2VyaWFsaXplKCBtZXRhLnNoYXBlcywgc2hhcGVzICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuaXNTa2lubmVkTWVzaCApIHsKCiAgICAJCQlvYmplY3QuYmluZE1vZGUgPSB0aGlzLmJpbmRNb2RlOwogICAgCQkJb2JqZWN0LmJpbmRNYXRyaXggPSB0aGlzLmJpbmRNYXRyaXgudG9BcnJheSgpOwoKICAgIAkJCWlmICggdGhpcy5za2VsZXRvbiAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlzZXJpYWxpemUoIG1ldGEuc2tlbGV0b25zLCB0aGlzLnNrZWxldG9uICk7CgogICAgCQkJCW9iamVjdC5za2VsZXRvbiA9IHRoaXMuc2tlbGV0b24udXVpZDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMubWF0ZXJpYWwgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHRoaXMubWF0ZXJpYWwgKSApIHsKCiAgICAJCQkJY29uc3QgdXVpZHMgPSBbXTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5tYXRlcmlhbC5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQkJdXVpZHMucHVzaCggc2VyaWFsaXplKCBtZXRhLm1hdGVyaWFscywgdGhpcy5tYXRlcmlhbFsgaSBdICkgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlvYmplY3QubWF0ZXJpYWwgPSB1dWlkczsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlvYmplY3QubWF0ZXJpYWwgPSBzZXJpYWxpemUoIG1ldGEubWF0ZXJpYWxzLCB0aGlzLm1hdGVyaWFsICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8KCiAgICAJCWlmICggdGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwICkgewoKICAgIAkJCW9iamVjdC5jaGlsZHJlbiA9IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQlvYmplY3QuY2hpbGRyZW4ucHVzaCggdGhpcy5jaGlsZHJlblsgaSBdLnRvSlNPTiggbWV0YSApLm9iamVjdCApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQlpZiAoIHRoaXMuYW5pbWF0aW9ucy5sZW5ndGggPiAwICkgewoKICAgIAkJCW9iamVjdC5hbmltYXRpb25zID0gW107CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5hbmltYXRpb25zLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgYW5pbWF0aW9uID0gdGhpcy5hbmltYXRpb25zWyBpIF07CgogICAgCQkJCW9iamVjdC5hbmltYXRpb25zLnB1c2goIHNlcmlhbGl6ZSggbWV0YS5hbmltYXRpb25zLCBhbmltYXRpb24gKSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggaXNSb290T2JqZWN0ICkgewoKICAgIAkJCWNvbnN0IGdlb21ldHJpZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmdlb21ldHJpZXMgKTsKICAgIAkJCWNvbnN0IG1hdGVyaWFscyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEubWF0ZXJpYWxzICk7CiAgICAJCQljb25zdCB0ZXh0dXJlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEudGV4dHVyZXMgKTsKICAgIAkJCWNvbnN0IGltYWdlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuaW1hZ2VzICk7CiAgICAJCQljb25zdCBzaGFwZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLnNoYXBlcyApOwogICAgCQkJY29uc3Qgc2tlbGV0b25zID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5za2VsZXRvbnMgKTsKICAgIAkJCWNvbnN0IGFuaW1hdGlvbnMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmFuaW1hdGlvbnMgKTsKICAgIAkJCWNvbnN0IG5vZGVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5ub2RlcyApOwoKICAgIAkJCWlmICggZ2VvbWV0cmllcy5sZW5ndGggPiAwICkgb3V0cHV0Lmdlb21ldHJpZXMgPSBnZW9tZXRyaWVzOwogICAgCQkJaWYgKCBtYXRlcmlhbHMubGVuZ3RoID4gMCApIG91dHB1dC5tYXRlcmlhbHMgPSBtYXRlcmlhbHM7CiAgICAJCQlpZiAoIHRleHR1cmVzLmxlbmd0aCA+IDAgKSBvdXRwdXQudGV4dHVyZXMgPSB0ZXh0dXJlczsKICAgIAkJCWlmICggaW1hZ2VzLmxlbmd0aCA+IDAgKSBvdXRwdXQuaW1hZ2VzID0gaW1hZ2VzOwogICAgCQkJaWYgKCBzaGFwZXMubGVuZ3RoID4gMCApIG91dHB1dC5zaGFwZXMgPSBzaGFwZXM7CiAgICAJCQlpZiAoIHNrZWxldG9ucy5sZW5ndGggPiAwICkgb3V0cHV0LnNrZWxldG9ucyA9IHNrZWxldG9uczsKICAgIAkJCWlmICggYW5pbWF0aW9ucy5sZW5ndGggPiAwICkgb3V0cHV0LmFuaW1hdGlvbnMgPSBhbmltYXRpb25zOwogICAgCQkJaWYgKCBub2Rlcy5sZW5ndGggPiAwICkgb3V0cHV0Lm5vZGVzID0gbm9kZXM7CgogICAgCQl9CgogICAgCQlvdXRwdXQub2JqZWN0ID0gb2JqZWN0OwoKICAgIAkJcmV0dXJuIG91dHB1dDsKCiAgICAJCS8vIGV4dHJhY3QgZGF0YSBmcm9tIHRoZSBjYWNoZSBoYXNoCiAgICAJCS8vIHJlbW92ZSBtZXRhZGF0YSBvbiBlYWNoIGl0ZW0KICAgIAkJLy8gYW5kIHJldHVybiBhcyBhcnJheQogICAgCQlmdW5jdGlvbiBleHRyYWN0RnJvbUNhY2hlKCBjYWNoZSApIHsKCiAgICAJCQljb25zdCB2YWx1ZXMgPSBbXTsKICAgIAkJCWZvciAoIGNvbnN0IGtleSBpbiBjYWNoZSApIHsKCiAgICAJCQkJY29uc3QgZGF0YSA9IGNhY2hlWyBrZXkgXTsKICAgIAkJCQlkZWxldGUgZGF0YS5tZXRhZGF0YTsKICAgIAkJCQl2YWx1ZXMucHVzaCggZGF0YSApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdmFsdWVzOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgM0Qgb2JqZWN0IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZWN1cnNpdmU9dHJ1ZV0gLSBXaGVuIHNldCB0byBgdHJ1ZWAsIGRlc2NlbmRhbnRzIG9mIHRoZSAzRCBvYmplY3QgYXJlIGFsc28gY2xvbmVkLgogICAgCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoIHJlY3Vyc2l2ZSApIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMsIHJlY3Vyc2l2ZSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiAzRCBvYmplY3QgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0M0R9IHNvdXJjZSAtIFRoZSAzRCBvYmplY3QgdG8gY29weS4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZWN1cnNpdmU9dHJ1ZV0gLSBXaGVuIHNldCB0byBgdHJ1ZWAsIGRlc2NlbmRhbnRzIG9mIHRoZSAzRCBvYmplY3QgYXJlIGNsb25lZC4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSA9IHRydWUgKSB7CgogICAgCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCiAgICAJCXRoaXMudXAuY29weSggc291cmNlLnVwICk7CgogICAgCQl0aGlzLnBvc2l0aW9uLmNvcHkoIHNvdXJjZS5wb3NpdGlvbiApOwogICAgCQl0aGlzLnJvdGF0aW9uLm9yZGVyID0gc291cmNlLnJvdGF0aW9uLm9yZGVyOwogICAgCQl0aGlzLnF1YXRlcm5pb24uY29weSggc291cmNlLnF1YXRlcm5pb24gKTsKICAgIAkJdGhpcy5zY2FsZS5jb3B5KCBzb3VyY2Uuc2NhbGUgKTsKCiAgICAJCXRoaXMubWF0cml4LmNvcHkoIHNvdXJjZS5tYXRyaXggKTsKICAgIAkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCBzb3VyY2UubWF0cml4V29ybGQgKTsKCiAgICAJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhBdXRvVXBkYXRlOwoKICAgIAkJdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4V29ybGRBdXRvVXBkYXRlOwogICAgCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBzb3VyY2UubWF0cml4V29ybGROZWVkc1VwZGF0ZTsKCiAgICAJCXRoaXMubGF5ZXJzLm1hc2sgPSBzb3VyY2UubGF5ZXJzLm1hc2s7CiAgICAJCXRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwoKICAgIAkJdGhpcy5jYXN0U2hhZG93ID0gc291cmNlLmNhc3RTaGFkb3c7CiAgICAJCXRoaXMucmVjZWl2ZVNoYWRvdyA9IHNvdXJjZS5yZWNlaXZlU2hhZG93OwoKICAgIAkJdGhpcy5mcnVzdHVtQ3VsbGVkID0gc291cmNlLmZydXN0dW1DdWxsZWQ7CiAgICAJCXRoaXMucmVuZGVyT3JkZXIgPSBzb3VyY2UucmVuZGVyT3JkZXI7CgogICAgCQl0aGlzLmFuaW1hdGlvbnMgPSBzb3VyY2UuYW5pbWF0aW9ucy5zbGljZSgpOwoKICAgIAkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKICAgIAkJaWYgKCByZWN1cnNpdmUgPT09IHRydWUgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgc291cmNlLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgY2hpbGQgPSBzb3VyY2UuY2hpbGRyZW5bIGkgXTsKICAgIAkJCQl0aGlzLmFkZCggY2hpbGQuY2xvbmUoKSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgdXAgZGlyZWN0aW9uIGZvciBvYmplY3RzLCBhbHNvIHVzZWQgYXMgdGhlIGRlZmF1bHQKICAgICAqIHBvc2l0aW9uIGZvciB7QGxpbmsgRGlyZWN0aW9uYWxMaWdodH0gYW5kIHtAbGluayBIZW1pc3BoZXJlTGlnaHR9LgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtWZWN0b3IzfQogICAgICogQGRlZmF1bHQgKDAsMSwwKQogICAgICovCiAgICBPYmplY3QzRC5ERUZBVUxUX1VQID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgc2V0dGluZyBmb3Ige0BsaW5rIE9iamVjdDNEI21hdHJpeEF1dG9VcGRhdGV9IGZvcgogICAgICogbmV3bHkgY3JlYXRlZCAzRCBvYmplY3RzLgogICAgICoKICAgICAqIEBzdGF0aWMKICAgICAqIEB0eXBlIHtib29sZWFufQogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCiAgICBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURSA9IHRydWU7CgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBzZXR0aW5nIGZvciB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBmb3IKICAgICAqIG5ld2x5IGNyZWF0ZWQgM0Qgb2JqZWN0cy4KICAgICAqCiAgICAgKiBAc3RhdGljCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwogICAgT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfV09STERfQVVUT19VUERBVEUgPSB0cnVlOwoKICAgIGNvbnN0IF92MCQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3YxJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdjIkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92MyQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGNvbnN0IF92YWIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdmFjID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ZiYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92YXAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfdmJwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ZjcCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfdjQwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yNCgpOwogICAgY29uc3QgX3Y0MSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjQoKTsKICAgIGNvbnN0IF92NDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3I0KCk7CgogICAgLyoqCiAgICAgKiBBIGdlb21ldHJpYyB0cmlhbmdsZSBhcyBkZWZpbmVkIGJ5IHRocmVlIHZlY3RvcnMgcmVwcmVzZW50aW5nIGl0cyB0aHJlZSBjb3JuZXJzLgogICAgICovCiAgICBjbGFzcyBUcmlhbmdsZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgdHJpYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFthPSgwLDAsMCldIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBbYj0oMCwwLDApXSAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtjPSgwLDAsMCldIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGEgPSBuZXcgVmVjdG9yMygpLCBiID0gbmV3IFZlY3RvcjMoKSwgYyA9IG5ldyBWZWN0b3IzKCkgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtWZWN0b3IzfQogICAgCQkgKi8KICAgIAkJdGhpcy5hID0gYTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtWZWN0b3IzfQogICAgCQkgKi8KICAgIAkJdGhpcy5iID0gYjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1ZlY3RvcjN9CiAgICAJCSAqLwogICAgCQl0aGlzLmMgPSBjOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBub3JtYWwgdmVjdG9yIG9mIGEgdHJpYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgdHJpYW5nbGUncyBub3JtYWwuCiAgICAJICovCiAgICAJc3RhdGljIGdldE5vcm1hbCggYSwgYiwgYywgdGFyZ2V0ICkgewoKICAgIAkJdGFyZ2V0LnN1YlZlY3RvcnMoIGMsIGIgKTsKICAgIAkJX3YwJDEuc3ViVmVjdG9ycyggYSwgYiApOwogICAgCQl0YXJnZXQuY3Jvc3MoIF92MCQxICk7CgogICAgCQljb25zdCB0YXJnZXRMZW5ndGhTcSA9IHRhcmdldC5sZW5ndGhTcSgpOwogICAgCQlpZiAoIHRhcmdldExlbmd0aFNxID4gMCApIHsKCiAgICAJCQlyZXR1cm4gdGFyZ2V0Lm11bHRpcGx5U2NhbGFyKCAxIC8gTWF0aC5zcXJ0KCB0YXJnZXRMZW5ndGhTcSApICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGFyZ2V0LnNldCggMCwgMCwgMCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIGEgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIEEgcG9pbnQgaW4gM0Qgc3BhY2UuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyBmb3IgdGhlIGdpdmVuIHBvaW50CiAgICAJICovCiAgICAJc3RhdGljIGdldEJhcnljb29yZCggcG9pbnQsIGEsIGIsIGMsIHRhcmdldCApIHsKCiAgICAJCS8vIGJhc2VkIG9uOiBodHRwOi8vd3d3LmJsYWNrcGF3bi5jb20vdGV4dHMvcG9pbnRpbnBvbHkvZGVmYXVsdC5odG1sCgogICAgCQlfdjAkMS5zdWJWZWN0b3JzKCBjLCBhICk7CiAgICAJCV92MSQzLnN1YlZlY3RvcnMoIGIsIGEgKTsKICAgIAkJX3YyJDIuc3ViVmVjdG9ycyggcG9pbnQsIGEgKTsKCiAgICAJCWNvbnN0IGRvdDAwID0gX3YwJDEuZG90KCBfdjAkMSApOwogICAgCQljb25zdCBkb3QwMSA9IF92MCQxLmRvdCggX3YxJDMgKTsKICAgIAkJY29uc3QgZG90MDIgPSBfdjAkMS5kb3QoIF92MiQyICk7CiAgICAJCWNvbnN0IGRvdDExID0gX3YxJDMuZG90KCBfdjEkMyApOwogICAgCQljb25zdCBkb3QxMiA9IF92MSQzLmRvdCggX3YyJDIgKTsKCiAgICAJCWNvbnN0IGRlbm9tID0gKCBkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMSApOwoKICAgIAkJLy8gY29sbGluZWFyIG9yIHNpbmd1bGFyIHRyaWFuZ2xlCiAgICAJCWlmICggZGVub20gPT09IDAgKSB7CgogICAgCQkJdGFyZ2V0LnNldCggMCwgMCwgMCApOwogICAgCQkJcmV0dXJuIG51bGw7CgogICAgCQl9CgogICAgCQljb25zdCBpbnZEZW5vbSA9IDEgLyBkZW5vbTsKICAgIAkJY29uc3QgdSA9ICggZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIgKSAqIGludkRlbm9tOwogICAgCQljb25zdCB2ID0gKCBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMiApICogaW52RGVub207CgogICAgCQkvLyBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyBtdXN0IGFsd2F5cyBzdW0gdG8gMQogICAgCQlyZXR1cm4gdGFyZ2V0LnNldCggMSAtIHUgLSB2LCB2LCB1ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50LCB3aGVuIHByb2plY3RlZCBvbnRvIHRoZSBwbGFuZSBvZiB0aGUKICAgIAkgKiB0cmlhbmdsZSwgbGllcyB3aXRoaW4gdGhlIHRyaWFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCBpbiAzRCBzcGFjZSB0byB0ZXN0LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBwb2ludCwgd2hlbiBwcm9qZWN0ZWQgb250byB0aGUgcGxhbmUgb2YgdGhlCiAgICAJICogdHJpYW5nbGUsIGxpZXMgd2l0aGluIHRoZSB0cmlhbmdsZSBvciBub3QuCiAgICAJICovCiAgICAJc3RhdGljIGNvbnRhaW5zUG9pbnQoIHBvaW50LCBhLCBiLCBjICkgewoKICAgIAkJLy8gaWYgdGhlIHRyaWFuZ2xlIGlzIGRlZ2VuZXJhdGUgdGhlbiB3ZSBjYW4ndCBjb250YWluIGEgcG9pbnQKICAgIAkJaWYgKCB0aGlzLmdldEJhcnljb29yZCggcG9pbnQsIGEsIGIsIGMsIF92MyQyICkgPT09IG51bGwgKSB7CgogICAgCQkJcmV0dXJuIGZhbHNlOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuICggX3YzJDIueCA+PSAwICkgJiYgKCBfdjMkMi55ID49IDAgKSAmJiAoICggX3YzJDIueCArIF92MyQyLnkgKSA8PSAxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHZhbHVlIGJhcnljZW50cmljYWxseSBpbnRlcnBvbGF0ZWQgZm9yIHRoZSBnaXZlbiBwb2ludCBvbiB0aGUKICAgIAkgKiB0cmlhbmdsZS4gUmV0dXJucyBgbnVsbGAgaWYgdGhlIHRyaWFuZ2xlIGlzIGRlZ2VuZXJhdGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gUG9zaXRpb24gb2YgaW50ZXJwb2xhdGVkIHBvaW50LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcDEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAyIC0gVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcDMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgZmlyc3QgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjIgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiBzZWNvbmQgdmVydGV4LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjMgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiB0aGlyZCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVycG9sYXRlZCB2YWx1ZS4KICAgIAkgKi8KICAgIAlzdGF0aWMgZ2V0SW50ZXJwb2xhdGlvbiggcG9pbnQsIHAxLCBwMiwgcDMsIHYxLCB2MiwgdjMsIHRhcmdldCApIHsKCiAgICAJCWlmICggdGhpcy5nZXRCYXJ5Y29vcmQoIHBvaW50LCBwMSwgcDIsIHAzLCBfdjMkMiApID09PSBudWxsICkgewoKICAgIAkJCXRhcmdldC54ID0gMDsKICAgIAkJCXRhcmdldC55ID0gMDsKICAgIAkJCWlmICggJ3onIGluIHRhcmdldCApIHRhcmdldC56ID0gMDsKICAgIAkJCWlmICggJ3cnIGluIHRhcmdldCApIHRhcmdldC53ID0gMDsKICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJdGFyZ2V0LnNldFNjYWxhciggMCApOwogICAgCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB2MSwgX3YzJDIueCApOwogICAgCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB2MiwgX3YzJDIueSApOwogICAgCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB2MywgX3YzJDIueiApOwoKICAgIAkJcmV0dXJuIHRhcmdldDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgdmFsdWUgYmFyeWNlbnRyaWNhbGx5IGludGVycG9sYXRlZCBmb3IgdGhlIGdpdmVuIGF0dHJpYnV0ZSBhbmQgaW5kaWNlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyIC0gVGhlIGF0dHJpYnV0ZSB0byBpbnRlcnBvbGF0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaTEgLSBJbmRleCBvZiBmaXJzdCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkyIC0gSW5kZXggb2Ygc2Vjb25kIHZlcnRleC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaTMgLSBJbmRleCBvZiB0aGlyZCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiYXJ5Y29vcmQgLSBUaGUgYmFyeWNvb3JkaW5hdGUgdmFsdWUgdG8gdXNlIHRvIGludGVycG9sYXRlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGludGVycG9sYXRlZCBhdHRyaWJ1dGUgdmFsdWUuCiAgICAJICovCiAgICAJc3RhdGljIGdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggYXR0ciwgaTEsIGkyLCBpMywgYmFyeWNvb3JkLCB0YXJnZXQgKSB7CgogICAgCQlfdjQwLnNldFNjYWxhciggMCApOwogICAgCQlfdjQxLnNldFNjYWxhciggMCApOwogICAgCQlfdjQyLnNldFNjYWxhciggMCApOwoKICAgIAkJX3Y0MC5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyLCBpMSApOwogICAgCQlfdjQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHIsIGkyICk7CiAgICAJCV92NDIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0ciwgaTMgKTsKCiAgICAJCXRhcmdldC5zZXRTY2FsYXIoIDAgKTsKICAgIAkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggX3Y0MCwgYmFyeWNvb3JkLnggKTsKICAgIAkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggX3Y0MSwgYmFyeWNvb3JkLnkgKTsKICAgIAkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggX3Y0MiwgYmFyeWNvb3JkLnogKTsKCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IGRpcmVjdGlvbiAtIFRoZSAobm9ybWFsaXplZCkgZGlyZWN0aW9uIHZlY3Rvci4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSB0cmlhbmdsZSBpcyBvcmllbnRlZCB0b3dhcmRzIHRoZSBnaXZlbiBkaXJlY3Rpb24gb3Igbm90LgogICAgCSAqLwogICAgCXN0YXRpYyBpc0Zyb250RmFjaW5nKCBhLCBiLCBjLCBkaXJlY3Rpb24gKSB7CgogICAgCQlfdjAkMS5zdWJWZWN0b3JzKCBjLCBiICk7CiAgICAJCV92MSQzLnN1YlZlY3RvcnMoIGEsIGIgKTsKCiAgICAJCS8vIHN0cmljdGx5IGZyb250IGZhY2luZwogICAgCQlyZXR1cm4gKCBfdjAkMS5jcm9zcyggX3YxJDMgKS5kb3QoIGRpcmVjdGlvbiApIDwgMCApID8gdHJ1ZSA6IGZhbHNlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHRyaWFuZ2xlJ3MgdmVydGljZXMgYnkgY29weWluZyB0aGUgZ2l2ZW4gdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqIEByZXR1cm4ge1RyaWFuZ2xlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHRyaWFuZ2xlLgogICAgCSAqLwogICAgCXNldCggYSwgYiwgYyApIHsKCiAgICAJCXRoaXMuYS5jb3B5KCBhICk7CiAgICAJCXRoaXMuYi5jb3B5KCBiICk7CiAgICAJCXRoaXMuYy5jb3B5KCBjICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIGFycmF5IHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8VmVjdG9yMz59IHBvaW50cyAtIEFuIGFycmF5IHdpdGggM0QgcG9pbnRzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpMCAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gVGhlIGFycmF5IGluZGV4IHJlcHJlc2VudGluZyB0aGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkyIC0gVGhlIGFycmF5IGluZGV4IHJlcHJlc2VudGluZyB0aGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcmV0dXJuIHtUcmlhbmdsZX0gQSByZWZlcmVuY2UgdG8gdGhpcyB0cmlhbmdsZS4KICAgIAkgKi8KICAgIAlzZXRGcm9tUG9pbnRzQW5kSW5kaWNlcyggcG9pbnRzLCBpMCwgaTEsIGkyICkgewoKICAgIAkJdGhpcy5hLmNvcHkoIHBvaW50c1sgaTAgXSApOwogICAgCQl0aGlzLmIuY29weSggcG9pbnRzWyBpMSBdICk7CiAgICAJCXRoaXMuYy5jb3B5KCBwb2ludHNbIGkyIF0gKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHRyaWFuZ2xlJ3MgdmVydGljZXMgYnkgY29weWluZyB0aGUgZ2l2ZW4gYXR0cmlidXRlIHZhbHVlcy4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBBIGJ1ZmZlciBhdHRyaWJ1dGUgd2l0aCAzRCBwb2ludHMgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaTAgLSBUaGUgYXR0cmlidXRlIGluZGV4IHJlcHJlc2VudGluZyB0aGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaTEgLSBUaGUgYXR0cmlidXRlIGluZGV4IHJlcHJlc2VudGluZyB0aGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGkyIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCiAgICAJICovCiAgICAJc2V0RnJvbUF0dHJpYnV0ZUFuZEluZGljZXMoIGF0dHJpYnV0ZSwgaTAsIGkxLCBpMiApIHsKCiAgICAJCXRoaXMuYS5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkwICk7CiAgICAJCXRoaXMuYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkxICk7CiAgICAJCXRoaXMuYy5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkyICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgbmV3IHRyaWFuZ2xlIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtUcmlhbmdsZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNsb25lKCkgewoKICAgIAkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB0cmlhbmdsZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtUcmlhbmdsZX0gdHJpYW5nbGUgLSBUaGUgdHJpYW5nbGUgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtUcmlhbmdsZX0gQSByZWZlcmVuY2UgdG8gdGhpcyB0cmlhbmdsZS4KICAgIAkgKi8KICAgIAljb3B5KCB0cmlhbmdsZSApIHsKCiAgICAJCXRoaXMuYS5jb3B5KCB0cmlhbmdsZS5hICk7CiAgICAJCXRoaXMuYi5jb3B5KCB0cmlhbmdsZS5iICk7CiAgICAJCXRoaXMuYy5jb3B5KCB0cmlhbmdsZS5jICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgYXJlYSBvZiB0aGUgdHJpYW5nbGUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB0cmlhbmdsZSdzIGFyZWEuCiAgICAJICovCiAgICAJZ2V0QXJlYSgpIHsKCiAgICAJCV92MCQxLnN1YlZlY3RvcnMoIHRoaXMuYywgdGhpcy5iICk7CiAgICAJCV92MSQzLnN1YlZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICk7CgogICAgCQlyZXR1cm4gX3YwJDEuY3Jvc3MoIF92MSQzICkubGVuZ3RoKCkgKiAwLjU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIG1pZHBvaW50IG9mIHRoZSB0cmlhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3MgbWlkcG9pbnQuCiAgICAJICovCiAgICAJZ2V0TWlkcG9pbnQoIHRhcmdldCApIHsKCiAgICAJCXJldHVybiB0YXJnZXQuYWRkVmVjdG9ycyggdGhpcy5hLCB0aGlzLmIgKS5hZGQoIHRoaXMuYyApLm11bHRpcGx5U2NhbGFyKCAxIC8gMyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBub3JtYWwgb2YgdGhlIHRyaWFuZ2xlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgdHJpYW5nbGUncyBub3JtYWwuCiAgICAJICovCiAgICAJZ2V0Tm9ybWFsKCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gVHJpYW5nbGUuZ2V0Tm9ybWFsKCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB0YXJnZXQgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyBhIHBsYW5lIHRoZSB0cmlhbmdsZSBsaWVzIHdpdGhpbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBUaGUgcGxhbmUgdGhlIHRyaWFuZ2xlIGxpZXMgd2l0aGluLgogICAgCSAqLwogICAgCWdldFBsYW5lKCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGFyZ2V0LnNldEZyb21Db3BsYW5hclBvaW50cyggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIGEgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgogICAgCSAqIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIEEgcG9pbnQgaW4gM0Qgc3BhY2UuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZvciB0aGUgZ2l2ZW4gcG9pbnQKICAgIAkgKi8KICAgIAlnZXRCYXJ5Y29vcmQoIHBvaW50LCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gVHJpYW5nbGUuZ2V0QmFyeWNvb3JkKCBwb2ludCwgdGhpcy5hLCB0aGlzLmIsIHRoaXMuYywgdGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHZhbHVlIGJhcnljZW50cmljYWxseSBpbnRlcnBvbGF0ZWQgZm9yIHRoZSBnaXZlbiBwb2ludCBvbiB0aGUKICAgIAkgKiB0cmlhbmdsZS4gUmV0dXJucyBgbnVsbGAgaWYgdGhlIHRyaWFuZ2xlIGlzIGRlZ2VuZXJhdGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gUG9zaXRpb24gb2YgaW50ZXJwb2xhdGVkIHBvaW50LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdjEgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiBmaXJzdCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2MiAtIFZhbHVlIHRvIGludGVycG9sYXRlIG9mIHNlY29uZCB2ZXJ0ZXguCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB2MyAtIFZhbHVlIHRvIGludGVycG9sYXRlIG9mIHRoaXJkIHZlcnRleC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJwb2xhdGVkIHZhbHVlLgogICAgCSAqLwogICAgCWdldEludGVycG9sYXRpb24oIHBvaW50LCB2MSwgdjIsIHYzLCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gVHJpYW5nbGUuZ2V0SW50ZXJwb2xhdGlvbiggcG9pbnQsIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHYxLCB2MiwgdjMsIHRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBwb2ludCwgd2hlbiBwcm9qZWN0ZWQgb250byB0aGUgcGxhbmUgb2YgdGhlCiAgICAJICogdHJpYW5nbGUsIGxpZXMgd2l0aGluIHRoZSB0cmlhbmdsZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBwb2ludCwgd2hlbiBwcm9qZWN0ZWQgb250byB0aGUgcGxhbmUgb2YgdGhlCiAgICAJICogdHJpYW5nbGUsIGxpZXMgd2l0aGluIHRoZSB0cmlhbmdsZSBvciBub3QuCiAgICAJICovCiAgICAJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgogICAgCQlyZXR1cm4gVHJpYW5nbGUuY29udGFpbnNQb2ludCggcG9pbnQsIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgdHJpYW5nbGUgaXMgb3JpZW50ZWQgdG93YXJkcyB0aGUgZ2l2ZW4gZGlyZWN0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBkaXJlY3Rpb24gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdHJpYW5nbGUgaXMgb3JpZW50ZWQgdG93YXJkcyB0aGUgZ2l2ZW4gZGlyZWN0aW9uIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpc0Zyb250RmFjaW5nKCBkaXJlY3Rpb24gKSB7CgogICAgCQlyZXR1cm4gVHJpYW5nbGUuaXNGcm9udEZhY2luZyggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYywgZGlyZWN0aW9uICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBpbnRlcnNlY3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHRyaWFuZ2xlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94IG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzQm94KCBib3ggKSB7CgogICAgCQlyZXR1cm4gYm94LmludGVyc2VjdHNUcmlhbmdsZSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHRyaWFuZ2xlIHRvIHRoZSBnaXZlbiBwb2ludC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcCAtIFRoZSBwb2ludCB0byBjb21wdXRlIHRoZSBjbG9zZXN0IHBvaW50IGZvci4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSB0cmlhbmdsZS4KICAgIAkgKi8KICAgIAljbG9zZXN0UG9pbnRUb1BvaW50KCBwLCB0YXJnZXQgKSB7CgogICAgCQljb25zdCBhID0gdGhpcy5hLCBiID0gdGhpcy5iLCBjID0gdGhpcy5jOwogICAgCQlsZXQgdiwgdzsKCiAgICAJCS8vIGFsZ29yaXRobSB0aGFua3MgdG8gUmVhbC1UaW1lIENvbGxpc2lvbiBEZXRlY3Rpb24gYnkgQ2hyaXN0ZXIgRXJpY3NvbiwKICAgIAkJLy8gcHVibGlzaGVkIGJ5IE1vcmdhbiBLYXVmbWFubiBQdWJsaXNoZXJzLCAoYykgMjAwNSBFbHNldmllciBJbmMuLAogICAgCQkvLyB1bmRlciB0aGUgYWNjb21wYW55aW5nIGxpY2Vuc2U7IHNlZSBjaGFwdGVyIDUuMS41IGZvciBkZXRhaWxlZCBleHBsYW5hdGlvbi4KICAgIAkJLy8gYmFzaWNhbGx5LCB3ZSdyZSBkaXN0aW5ndWlzaGluZyB3aGljaCBvZiB0aGUgdm9yb25vaSByZWdpb25zIG9mIHRoZSB0cmlhbmdsZQogICAgCQkvLyB0aGUgcG9pbnQgbGllcyBpbiB3aXRoIHRoZSBtaW5pbXVtIGFtb3VudCBvZiByZWR1bmRhbnQgY29tcHV0YXRpb24uCgogICAgCQlfdmFiLnN1YlZlY3RvcnMoIGIsIGEgKTsKICAgIAkJX3ZhYy5zdWJWZWN0b3JzKCBjLCBhICk7CiAgICAJCV92YXAuc3ViVmVjdG9ycyggcCwgYSApOwogICAgCQljb25zdCBkMSA9IF92YWIuZG90KCBfdmFwICk7CiAgICAJCWNvbnN0IGQyID0gX3ZhYy5kb3QoIF92YXAgKTsKICAgIAkJaWYgKCBkMSA8PSAwICYmIGQyIDw9IDAgKSB7CgogICAgCQkJLy8gdmVydGV4IHJlZ2lvbiBvZiBBOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDEsIDAsIDApCiAgICAJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKTsKCiAgICAJCX0KCiAgICAJCV92YnAuc3ViVmVjdG9ycyggcCwgYiApOwogICAgCQljb25zdCBkMyA9IF92YWIuZG90KCBfdmJwICk7CiAgICAJCWNvbnN0IGQ0ID0gX3ZhYy5kb3QoIF92YnAgKTsKICAgIAkJaWYgKCBkMyA+PSAwICYmIGQ0IDw9IGQzICkgewoKICAgIAkJCS8vIHZlcnRleCByZWdpb24gb2YgQjsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAxLCAwKQogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiICk7CgogICAgCQl9CgogICAgCQljb25zdCB2YyA9IGQxICogZDQgLSBkMyAqIGQyOwogICAgCQlpZiAoIHZjIDw9IDAgJiYgZDEgPj0gMCAmJiBkMyA8PSAwICkgewoKICAgIAkJCXYgPSBkMSAvICggZDEgLSBkMyApOwogICAgCQkJLy8gZWRnZSByZWdpb24gb2YgQUI7IGJhcnljZW50cmljIGNvb3JkcyAoMS12LCB2LCAwKQogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFiLCB2ICk7CgogICAgCQl9CgogICAgCQlfdmNwLnN1YlZlY3RvcnMoIHAsIGMgKTsKICAgIAkJY29uc3QgZDUgPSBfdmFiLmRvdCggX3ZjcCApOwogICAgCQljb25zdCBkNiA9IF92YWMuZG90KCBfdmNwICk7CiAgICAJCWlmICggZDYgPj0gMCAmJiBkNSA8PSBkNiApIHsKCiAgICAJCQkvLyB2ZXJ0ZXggcmVnaW9uIG9mIEM7IGJhcnljZW50cmljIGNvb3JkcyAoMCwgMCwgMSkKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggYyApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgdmIgPSBkNSAqIGQyIC0gZDEgKiBkNjsKICAgIAkJaWYgKCB2YiA8PSAwICYmIGQyID49IDAgJiYgZDYgPD0gMCApIHsKCiAgICAJCQl3ID0gZDIgLyAoIGQyIC0gZDYgKTsKICAgIAkJCS8vIGVkZ2UgcmVnaW9uIG9mIEFDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDEtdywgMCwgdykKICAgIAkJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggX3ZhYywgdyApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgdmEgPSBkMyAqIGQ2IC0gZDUgKiBkNDsKICAgIAkJaWYgKCB2YSA8PSAwICYmICggZDQgLSBkMyApID49IDAgJiYgKCBkNSAtIGQ2ICkgPj0gMCApIHsKCiAgICAJCQlfdmJjLnN1YlZlY3RvcnMoIGMsIGIgKTsKICAgIAkJCXcgPSAoIGQ0IC0gZDMgKSAvICggKCBkNCAtIGQzICkgKyAoIGQ1IC0gZDYgKSApOwogICAgCQkJLy8gZWRnZSByZWdpb24gb2YgQkM7IGJhcnljZW50cmljIGNvb3JkcyAoMCwgMS13LCB3KQogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiICkuYWRkU2NhbGVkVmVjdG9yKCBfdmJjLCB3ICk7IC8vIGVkZ2UgcmVnaW9uIG9mIEJDCgogICAgCQl9CgogICAgCQkvLyBmYWNlIHJlZ2lvbgogICAgCQljb25zdCBkZW5vbSA9IDEgLyAoIHZhICsgdmIgKyB2YyApOwogICAgCQkvLyB1ID0gdmEgKiBkZW5vbQogICAgCQl2ID0gdmIgKiBkZW5vbTsKICAgIAkJdyA9IHZjICogZGVub207CgogICAgCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWIsIHYgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWMsIHcgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHRyaWFuZ2xlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VHJpYW5nbGV9IHRyaWFuZ2xlIC0gVGhlIHRyaWFuZ2xlIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB0cmlhbmdsZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCB0cmlhbmdsZSApIHsKCiAgICAJCXJldHVybiB0cmlhbmdsZS5hLmVxdWFscyggdGhpcy5hICkgJiYgdHJpYW5nbGUuYi5lcXVhbHMoIHRoaXMuYiApICYmIHRyaWFuZ2xlLmMuZXF1YWxzKCB0aGlzLmMgKTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfY29sb3JLZXl3b3JkcyA9IHsgJ2FsaWNlYmx1ZSc6IDB4RjBGOEZGLCAnYW50aXF1ZXdoaXRlJzogMHhGQUVCRDcsICdhcXVhJzogMHgwMEZGRkYsICdhcXVhbWFyaW5lJzogMHg3RkZGRDQsICdhenVyZSc6IDB4RjBGRkZGLAogICAgCSdiZWlnZSc6IDB4RjVGNURDLCAnYmlzcXVlJzogMHhGRkU0QzQsICdibGFjayc6IDB4MDAwMDAwLCAnYmxhbmNoZWRhbG1vbmQnOiAweEZGRUJDRCwgJ2JsdWUnOiAweDAwMDBGRiwgJ2JsdWV2aW9sZXQnOiAweDhBMkJFMiwKICAgIAknYnJvd24nOiAweEE1MkEyQSwgJ2J1cmx5d29vZCc6IDB4REVCODg3LCAnY2FkZXRibHVlJzogMHg1RjlFQTAsICdjaGFydHJldXNlJzogMHg3RkZGMDAsICdjaG9jb2xhdGUnOiAweEQyNjkxRSwgJ2NvcmFsJzogMHhGRjdGNTAsCiAgICAJJ2Nvcm5mbG93ZXJibHVlJzogMHg2NDk1RUQsICdjb3Juc2lsayc6IDB4RkZGOERDLCAnY3JpbXNvbic6IDB4REMxNDNDLCAnY3lhbic6IDB4MDBGRkZGLCAnZGFya2JsdWUnOiAweDAwMDA4QiwgJ2RhcmtjeWFuJzogMHgwMDhCOEIsCiAgICAJJ2Rhcmtnb2xkZW5yb2QnOiAweEI4ODYwQiwgJ2RhcmtncmF5JzogMHhBOUE5QTksICdkYXJrZ3JlZW4nOiAweDAwNjQwMCwgJ2RhcmtncmV5JzogMHhBOUE5QTksICdkYXJra2hha2knOiAweEJEQjc2QiwgJ2RhcmttYWdlbnRhJzogMHg4QjAwOEIsCiAgICAJJ2RhcmtvbGl2ZWdyZWVuJzogMHg1NTZCMkYsICdkYXJrb3JhbmdlJzogMHhGRjhDMDAsICdkYXJrb3JjaGlkJzogMHg5OTMyQ0MsICdkYXJrcmVkJzogMHg4QjAwMDAsICdkYXJrc2FsbW9uJzogMHhFOTk2N0EsICdkYXJrc2VhZ3JlZW4nOiAweDhGQkM4RiwKICAgIAknZGFya3NsYXRlYmx1ZSc6IDB4NDgzRDhCLCAnZGFya3NsYXRlZ3JheSc6IDB4MkY0RjRGLCAnZGFya3NsYXRlZ3JleSc6IDB4MkY0RjRGLCAnZGFya3R1cnF1b2lzZSc6IDB4MDBDRUQxLCAnZGFya3Zpb2xldCc6IDB4OTQwMEQzLAogICAgCSdkZWVwcGluayc6IDB4RkYxNDkzLCAnZGVlcHNreWJsdWUnOiAweDAwQkZGRiwgJ2RpbWdyYXknOiAweDY5Njk2OSwgJ2RpbWdyZXknOiAweDY5Njk2OSwgJ2RvZGdlcmJsdWUnOiAweDFFOTBGRiwgJ2ZpcmVicmljayc6IDB4QjIyMjIyLAogICAgCSdmbG9yYWx3aGl0ZSc6IDB4RkZGQUYwLCAnZm9yZXN0Z3JlZW4nOiAweDIyOEIyMiwgJ2Z1Y2hzaWEnOiAweEZGMDBGRiwgJ2dhaW5zYm9ybyc6IDB4RENEQ0RDLCAnZ2hvc3R3aGl0ZSc6IDB4RjhGOEZGLCAnZ29sZCc6IDB4RkZENzAwLAogICAgCSdnb2xkZW5yb2QnOiAweERBQTUyMCwgJ2dyYXknOiAweDgwODA4MCwgJ2dyZWVuJzogMHgwMDgwMDAsICdncmVlbnllbGxvdyc6IDB4QURGRjJGLCAnZ3JleSc6IDB4ODA4MDgwLCAnaG9uZXlkZXcnOiAweEYwRkZGMCwgJ2hvdHBpbmsnOiAweEZGNjlCNCwKICAgIAknaW5kaWFucmVkJzogMHhDRDVDNUMsICdpbmRpZ28nOiAweDRCMDA4MiwgJ2l2b3J5JzogMHhGRkZGRjAsICdraGFraSc6IDB4RjBFNjhDLCAnbGF2ZW5kZXInOiAweEU2RTZGQSwgJ2xhdmVuZGVyYmx1c2gnOiAweEZGRjBGNSwgJ2xhd25ncmVlbic6IDB4N0NGQzAwLAogICAgCSdsZW1vbmNoaWZmb24nOiAweEZGRkFDRCwgJ2xpZ2h0Ymx1ZSc6IDB4QUREOEU2LCAnbGlnaHRjb3JhbCc6IDB4RjA4MDgwLCAnbGlnaHRjeWFuJzogMHhFMEZGRkYsICdsaWdodGdvbGRlbnJvZHllbGxvdyc6IDB4RkFGQUQyLCAnbGlnaHRncmF5JzogMHhEM0QzRDMsCiAgICAJJ2xpZ2h0Z3JlZW4nOiAweDkwRUU5MCwgJ2xpZ2h0Z3JleSc6IDB4RDNEM0QzLCAnbGlnaHRwaW5rJzogMHhGRkI2QzEsICdsaWdodHNhbG1vbic6IDB4RkZBMDdBLCAnbGlnaHRzZWFncmVlbic6IDB4MjBCMkFBLCAnbGlnaHRza3libHVlJzogMHg4N0NFRkEsCiAgICAJJ2xpZ2h0c2xhdGVncmF5JzogMHg3Nzg4OTksICdsaWdodHNsYXRlZ3JleSc6IDB4Nzc4ODk5LCAnbGlnaHRzdGVlbGJsdWUnOiAweEIwQzRERSwgJ2xpZ2h0eWVsbG93JzogMHhGRkZGRTAsICdsaW1lJzogMHgwMEZGMDAsICdsaW1lZ3JlZW4nOiAweDMyQ0QzMiwKICAgIAknbGluZW4nOiAweEZBRjBFNiwgJ21hZ2VudGEnOiAweEZGMDBGRiwgJ21hcm9vbic6IDB4ODAwMDAwLCAnbWVkaXVtYXF1YW1hcmluZSc6IDB4NjZDREFBLCAnbWVkaXVtYmx1ZSc6IDB4MDAwMENELCAnbWVkaXVtb3JjaGlkJzogMHhCQTU1RDMsCiAgICAJJ21lZGl1bXB1cnBsZSc6IDB4OTM3MERCLCAnbWVkaXVtc2VhZ3JlZW4nOiAweDNDQjM3MSwgJ21lZGl1bXNsYXRlYmx1ZSc6IDB4N0I2OEVFLCAnbWVkaXVtc3ByaW5nZ3JlZW4nOiAweDAwRkE5QSwgJ21lZGl1bXR1cnF1b2lzZSc6IDB4NDhEMUNDLAogICAgCSdtZWRpdW12aW9sZXRyZWQnOiAweEM3MTU4NSwgJ21pZG5pZ2h0Ymx1ZSc6IDB4MTkxOTcwLCAnbWludGNyZWFtJzogMHhGNUZGRkEsICdtaXN0eXJvc2UnOiAweEZGRTRFMSwgJ21vY2Nhc2luJzogMHhGRkU0QjUsICduYXZham93aGl0ZSc6IDB4RkZERUFELAogICAgCSduYXZ5JzogMHgwMDAwODAsICdvbGRsYWNlJzogMHhGREY1RTYsICdvbGl2ZSc6IDB4ODA4MDAwLCAnb2xpdmVkcmFiJzogMHg2QjhFMjMsICdvcmFuZ2UnOiAweEZGQTUwMCwgJ29yYW5nZXJlZCc6IDB4RkY0NTAwLCAnb3JjaGlkJzogMHhEQTcwRDYsCiAgICAJJ3BhbGVnb2xkZW5yb2QnOiAweEVFRThBQSwgJ3BhbGVncmVlbic6IDB4OThGQjk4LCAncGFsZXR1cnF1b2lzZSc6IDB4QUZFRUVFLCAncGFsZXZpb2xldHJlZCc6IDB4REI3MDkzLCAncGFwYXlhd2hpcCc6IDB4RkZFRkQ1LCAncGVhY2hwdWZmJzogMHhGRkRBQjksCiAgICAJJ3BlcnUnOiAweENEODUzRiwgJ3BpbmsnOiAweEZGQzBDQiwgJ3BsdW0nOiAweEREQTBERCwgJ3Bvd2RlcmJsdWUnOiAweEIwRTBFNiwgJ3B1cnBsZSc6IDB4ODAwMDgwLCAncmViZWNjYXB1cnBsZSc6IDB4NjYzMzk5LCAncmVkJzogMHhGRjAwMDAsICdyb3N5YnJvd24nOiAweEJDOEY4RiwKICAgIAkncm95YWxibHVlJzogMHg0MTY5RTEsICdzYWRkbGVicm93bic6IDB4OEI0NTEzLCAnc2FsbW9uJzogMHhGQTgwNzIsICdzYW5keWJyb3duJzogMHhGNEE0NjAsICdzZWFncmVlbic6IDB4MkU4QjU3LCAnc2Vhc2hlbGwnOiAweEZGRjVFRSwKICAgIAknc2llbm5hJzogMHhBMDUyMkQsICdzaWx2ZXInOiAweEMwQzBDMCwgJ3NreWJsdWUnOiAweDg3Q0VFQiwgJ3NsYXRlYmx1ZSc6IDB4NkE1QUNELCAnc2xhdGVncmF5JzogMHg3MDgwOTAsICdzbGF0ZWdyZXknOiAweDcwODA5MCwgJ3Nub3cnOiAweEZGRkFGQSwKICAgIAknc3ByaW5nZ3JlZW4nOiAweDAwRkY3RiwgJ3N0ZWVsYmx1ZSc6IDB4NDY4MkI0LCAndGFuJzogMHhEMkI0OEMsICd0ZWFsJzogMHgwMDgwODAsICd0aGlzdGxlJzogMHhEOEJGRDgsICd0b21hdG8nOiAweEZGNjM0NywgJ3R1cnF1b2lzZSc6IDB4NDBFMEQwLAogICAgCSd2aW9sZXQnOiAweEVFODJFRSwgJ3doZWF0JzogMHhGNURFQjMsICd3aGl0ZSc6IDB4RkZGRkZGLCAnd2hpdGVzbW9rZSc6IDB4RjVGNUY1LCAneWVsbG93JzogMHhGRkZGMDAsICd5ZWxsb3dncmVlbic6IDB4OUFDRDMyIH07CgogICAgY29uc3QgX2hzbEEgPSB7IGg6IDAsIHM6IDAsIGw6IDAgfTsKICAgIGNvbnN0IF9oc2xCID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CgogICAgZnVuY3Rpb24gaHVlMnJnYiggcCwgcSwgdCApIHsKCiAgICAJaWYgKCB0IDwgMCApIHQgKz0gMTsKICAgIAlpZiAoIHQgPiAxICkgdCAtPSAxOwogICAgCWlmICggdCA8IDEgLyA2ICkgcmV0dXJuIHAgKyAoIHEgLSBwICkgKiA2ICogdDsKICAgIAlpZiAoIHQgPCAxIC8gMiApIHJldHVybiBxOwogICAgCWlmICggdCA8IDIgLyAzICkgcmV0dXJuIHAgKyAoIHEgLSBwICkgKiA2ICogKCAyIC8gMyAtIHQgKTsKICAgIAlyZXR1cm4gcDsKCiAgICB9CgogICAgLyoqCiAgICAgKiBBIENvbG9yIGluc3RhbmNlIGlzIHJlcHJlc2VudGVkIGJ5IFJHQiBjb21wb25lbnRzIGluIHRoZSBsaW5lYXIgPGk+d29ya2luZwogICAgICogY29sb3Igc3BhY2U8L2k+LCB3aGljaCBkZWZhdWx0cyB0byBgTGluZWFyU1JHQkNvbG9yU3BhY2VgLiBJbnB1dHMKICAgICAqIGNvbnZlbnRpb25hbGx5IHVzaW5nIGBTUkdCQ29sb3JTcGFjZWAgKHN1Y2ggYXMgaGV4YWRlY2ltYWxzIGFuZCBDU1MKICAgICAqIHN0cmluZ3MpIGFyZSBjb252ZXJ0ZWQgdG8gdGhlIHdvcmtpbmcgY29sb3Igc3BhY2UgYXV0b21hdGljYWxseS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogLy8gY29udmVydGVkIGF1dG9tYXRpY2FsbHkgZnJvbSBTUkdCQ29sb3JTcGFjZSB0byBMaW5lYXJTUkdCQ29sb3JTcGFjZQogICAgICogY29uc3QgY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoKS5zZXRIZXgoIDB4MTEyMjMzICk7CiAgICAgKiBgYGAKICAgICAqIFNvdXJjZSBjb2xvciBzcGFjZXMgbWF5IGJlIHNwZWNpZmllZCBleHBsaWNpdGx5LCB0byBlbnN1cmUgY29ycmVjdCBjb252ZXJzaW9ucy4KICAgICAqIGBgYGpzCiAgICAgKiAvLyBhc3N1bWVkIGFscmVhZHkgTGluZWFyU1JHQkNvbG9yU3BhY2U7IG5vIGNvbnZlcnNpb24KICAgICAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKCAwLjUsIDAuNSwgMC41ICk7CiAgICAgKgogICAgICogLy8gY29udmVydGVkIGV4cGxpY2l0bHkgZnJvbSBTUkdCQ29sb3JTcGFjZSB0byBMaW5lYXJTUkdCQ29sb3JTcGFjZQogICAgICogY29uc3QgY29sb3IgPSBuZXcgVEhSRUUuQ29sb3IoKS5zZXRSR0IoIDAuNSwgMC41LCAwLjUsIFNSR0JDb2xvclNwYWNlICk7CiAgICAgKiBgYGAKICAgICAqIElmIFRIUkVFLkNvbG9yTWFuYWdlbWVudCBpcyBkaXNhYmxlZCwgbm8gY29udmVyc2lvbnMgb2NjdXIuIEZvciBkZXRhaWxzLAogICAgICogc2VlIDxpPkNvbG9yIG1hbmFnZW1lbnQ8L2k+LiBJdGVyYXRpbmcgdGhyb3VnaCBhIENvbG9yIGluc3RhbmNlIHdpbGwgeWllbGQKICAgICAqIGl0cyBjb21wb25lbnRzIChyLCBnLCBiKSBpbiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4gQSBDb2xvciBjYW4gYmUgaW5pdGlhbGlzZWQKICAgICAqIGluIGFueSBvZiB0aGUgZm9sbG93aW5nIHdheXM6CiAgICAgKiBgYGBqcwogICAgICogLy9lbXB0eSBjb25zdHJ1Y3RvciAtIHdpbGwgZGVmYXVsdCB3aGl0ZQogICAgICogY29uc3QgY29sb3IxID0gbmV3IFRIUkVFLkNvbG9yKCk7CiAgICAgKgogICAgICogLy9IZXhhZGVjaW1hbCBjb2xvciAocmVjb21tZW5kZWQpCiAgICAgKiBjb25zdCBjb2xvcjIgPSBuZXcgVEhSRUUuQ29sb3IoIDB4ZmYwMDAwICk7CiAgICAgKgogICAgICogLy9SR0Igc3RyaW5nCiAgICAgKiBjb25zdCBjb2xvcjMgPSBuZXcgVEhSRUUuQ29sb3IoInJnYigyNTUsIDAsIDApIik7CiAgICAgKiBjb25zdCBjb2xvcjQgPSBuZXcgVEhSRUUuQ29sb3IoInJnYigxMDAlLCAwJSwgMCUpIik7CiAgICAgKgogICAgICogLy9YMTEgY29sb3IgbmFtZSAtIGFsbCAxNDAgY29sb3IgbmFtZXMgYXJlIHN1cHBvcnRlZC4KICAgICAqIC8vTm90ZSB0aGUgbGFjayBvZiBDYW1lbENhc2UgaW4gdGhlIG5hbWUKICAgICAqIGNvbnN0IGNvbG9yNSA9IG5ldyBUSFJFRS5Db2xvciggJ3NreWJsdWUnICk7CiAgICAgKiAvL0hTTCBzdHJpbmcKICAgICAqIGNvbnN0IGNvbG9yNiA9IG5ldyBUSFJFRS5Db2xvcigiaHNsKDAsIDEwMCUsIDUwJSkiKTsKICAgICAqCiAgICAgKiAvL1NlcGFyYXRlIFJHQiB2YWx1ZXMgYmV0d2VlbiAwIGFuZCAxCiAgICAgKiBjb25zdCBjb2xvcjcgPSBuZXcgVEhSRUUuQ29sb3IoIDEsIDAsIDAgKTsKICAgICAqIGBgYAogICAgICovCiAgICBjbGFzcyBDb2xvciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgY29sb3IuCiAgICAJICoKICAgIAkgKiBOb3RlIHRoYXQgc3RhbmRhcmQgbWV0aG9kIG9mIHNwZWNpZnlpbmcgY29sb3IgaW4gdGhyZWUuanMgaXMgd2l0aCBhIGhleGFkZWNpbWFsIHRyaXBsZXQsCiAgICAJICogYW5kIHRoYXQgbWV0aG9kIGlzIHVzZWQgdGhyb3VnaG91dCB0aGUgcmVzdCBvZiB0aGUgZG9jdW1lbnRhdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7KG51bWJlcnxzdHJpbmd8Q29sb3IpfSBbcl0gLSBUaGUgcmVkIGNvbXBvbmVudCBvZiB0aGUgY29sb3IuIElmIGBnYCBhbmQgYGJgIGFyZQogICAgCSAqIG5vdCBwcm92aWRlZCwgaXQgY2FuIGJlIGhleGFkZWNpbWFsIHRyaXBsZXQsIGEgQ1NTLXN0eWxlIHN0cmluZyBvciBhbm90aGVyIGBDb2xvcmAgaW5zdGFuY2UuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtnXSAtIFRoZSBncmVlbiBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtiXSAtIFRoZSBibHVlIGNvbXBvbmVudC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggciwgZywgYiApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzQ29sb3IgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSByZWQgY29tcG9uZW50LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnIgPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBncmVlbiBjb21wb25lbnQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuZyA9IDE7CgogICAgCQkvKioKICAgIAkJICogVGhlIGJsdWUgY29tcG9uZW50LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLmIgPSAxOwoKICAgIAkJcmV0dXJuIHRoaXMuc2V0KCByLCBnLCBiICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29sb3JzJ3MgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiB2YWx1ZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhudW1iZXJ8c3RyaW5nfENvbG9yKX0gW3JdIC0gVGhlIHJlZCBjb21wb25lbnQgb2YgdGhlIGNvbG9yLiBJZiBgZ2AgYW5kIGBiYCBhcmUKICAgIAkgKiBub3QgcHJvdmlkZWQsIGl0IGNhbiBiZSBoZXhhZGVjaW1hbCB0cmlwbGV0LCBhIENTUy1zdHlsZSBzdHJpbmcgb3IgYW5vdGhlciBgQ29sb3JgIGluc3RhbmNlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZ10gLSBUaGUgZ3JlZW4gY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbYl0gLSBUaGUgYmx1ZSBjb21wb25lbnQuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJc2V0KCByLCBnLCBiICkgewoKICAgIAkJaWYgKCBnID09PSB1bmRlZmluZWQgJiYgYiA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCS8vIHIgaXMgVEhSRUUuQ29sb3IsIGhleCBvciBzdHJpbmcKCiAgICAJCQljb25zdCB2YWx1ZSA9IHI7CgogICAgCQkJaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc0NvbG9yICkgewoKICAgIAkJCQl0aGlzLmNvcHkoIHZhbHVlICk7CgogICAgCQkJfSBlbHNlIGlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyApIHsKCiAgICAJCQkJdGhpcy5zZXRIZXgoIHZhbHVlICk7CgogICAgCQkJfSBlbHNlIGlmICggdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyApIHsKCiAgICAJCQkJdGhpcy5zZXRTdHlsZSggdmFsdWUgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMuc2V0UkdCKCByLCBnLCBiICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBjb2xvcnMncyBjb21wb25lbnRzIHRvIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB2YWx1ZS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlzZXRTY2FsYXIoIHNjYWxhciApIHsKCiAgICAJCXRoaXMuciA9IHNjYWxhcjsKICAgIAkJdGhpcy5nID0gc2NhbGFyOwogICAgCQl0aGlzLmIgPSBzY2FsYXI7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgY29sb3IgZnJvbSBhIGhleGFkZWNpbWFsIHZhbHVlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGhleCAtIFRoZSBoZXhhZGVjaW1hbCB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXNldEhleCggaGV4LCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgogICAgCQloZXggPSBNYXRoLmZsb29yKCBoZXggKTsKCiAgICAJCXRoaXMuciA9ICggaGV4ID4+IDE2ICYgMjU1ICkgLyAyNTU7CiAgICAJCXRoaXMuZyA9ICggaGV4ID4+IDggJiAyNTUgKSAvIDI1NTsKICAgIAkJdGhpcy5iID0gKCBoZXggJiAyNTUgKSAvIDI1NTsKCiAgICAJCUNvbG9yTWFuYWdlbWVudC5jb2xvclNwYWNlVG9Xb3JraW5nKCB0aGlzLCBjb2xvclNwYWNlICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgY29sb3IgZnJvbSBSR0IgdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHIgLSBSZWQgY2hhbm5lbCB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZyAtIEdyZWVuIGNoYW5uZWwgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGIgLSBCbHVlIGNoYW5uZWwgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPUNvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJc2V0UkdCKCByLCBnLCBiLCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKICAgIAkJdGhpcy5yID0gcjsKICAgIAkJdGhpcy5nID0gZzsKICAgIAkJdGhpcy5iID0gYjsKCiAgICAJCUNvbG9yTWFuYWdlbWVudC5jb2xvclNwYWNlVG9Xb3JraW5nKCB0aGlzLCBjb2xvclNwYWNlICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoaXMgY29sb3IgZnJvbSBSR0IgdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGggLSBIdWUgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBTYXR1cmF0aW9uIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsIC0gTGlnaHRuZXNzIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXNldEhTTCggaCwgcywgbCwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCiAgICAJCS8vIGgscyxsIHJhbmdlcyBhcmUgaW4gMC4wIC0gMS4wCiAgICAJCWggPSBldWNsaWRlYW5Nb2R1bG8oIGgsIDEgKTsKICAgIAkJcyA9IGNsYW1wKCBzLCAwLCAxICk7CiAgICAJCWwgPSBjbGFtcCggbCwgMCwgMSApOwoKICAgIAkJaWYgKCBzID09PSAwICkgewoKICAgIAkJCXRoaXMuciA9IHRoaXMuZyA9IHRoaXMuYiA9IGw7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnN0IHAgPSBsIDw9IDAuNSA/IGwgKiAoIDEgKyBzICkgOiBsICsgcyAtICggbCAqIHMgKTsKICAgIAkJCWNvbnN0IHEgPSAoIDIgKiBsICkgLSBwOwoKICAgIAkJCXRoaXMuciA9IGh1ZTJyZ2IoIHEsIHAsIGggKyAxIC8gMyApOwogICAgCQkJdGhpcy5nID0gaHVlMnJnYiggcSwgcCwgaCApOwogICAgCQkJdGhpcy5iID0gaHVlMnJnYiggcSwgcCwgaCAtIDEgLyAzICk7CgogICAgCQl9CgogICAgCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gYSBDU1Mtc3R5bGUgc3RyaW5nLiBGb3IgZXhhbXBsZSwgYHJnYigyNTAsIDAsMClgLAogICAgCSAqIGByZ2IoMTAwJSwgMCUsIDAlKWAsIGBoc2woMCwgMTAwJSwgNTAlKWAsIGAjZmYwMDAwYCwgYCNmMDBgLCBvciBgcmVkYCAoIG9yCiAgICAJICogYW55IFtYMTEgY29sb3IgbmFtZV17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvWDExX2NvbG9yX25hbWVzI0NvbG9yX25hbWVfY2hhcnR9IC0KICAgIAkgKiBhbGwgMTQwIGNvbG9yIG5hbWVzIGFyZSBzdXBwb3J0ZWQpLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlIC0gQ29sb3IgYXMgYSBDU1Mtc3R5bGUgc3RyaW5nLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1TUkdCQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJc2V0U3R5bGUoIHN0eWxlLCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgogICAgCQlmdW5jdGlvbiBoYW5kbGVBbHBoYSggc3RyaW5nICkgewoKICAgIAkJCWlmICggc3RyaW5nID09PSB1bmRlZmluZWQgKSByZXR1cm47CgogICAgCQkJaWYgKCBwYXJzZUZsb2F0KCBzdHJpbmcgKSA8IDEgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yOiBBbHBoYSBjb21wb25lbnQgb2YgJyArIHN0eWxlICsgJyB3aWxsIGJlIGlnbm9yZWQuJyApOwoKICAgIAkJCX0KCiAgICAJCX0KCgogICAgCQlsZXQgbTsKCiAgICAJCWlmICggbSA9IC9eKFx3KylcKChbXlwpXSopXCkvLmV4ZWMoIHN0eWxlICkgKSB7CgogICAgCQkJLy8gcmdiIC8gaHNsCgogICAgCQkJbGV0IGNvbG9yOwogICAgCQkJY29uc3QgbmFtZSA9IG1bIDEgXTsKICAgIAkJCWNvbnN0IGNvbXBvbmVudHMgPSBtWyAyIF07CgogICAgCQkJc3dpdGNoICggbmFtZSApIHsKCiAgICAJCQkJY2FzZSAncmdiJzoKICAgIAkJCQljYXNlICdyZ2JhJzoKCiAgICAJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCspXHMqLFxzKihcZCspXHMqLFxzKihcZCspXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKCBjb21wb25lbnRzICkgKSB7CgogICAgCQkJCQkJLy8gcmdiKDI1NSwwLDApIHJnYmEoMjU1LDAsMCwwLjUpCgogICAgCQkJCQkJaGFuZGxlQWxwaGEoIGNvbG9yWyA0IF0gKTsKCiAgICAJCQkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCiAgICAJCQkJCQkJTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAxIF0sIDEwICkgKSAvIDI1NSwKICAgIAkJCQkJCQlNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDIgXSwgMTAgKSApIC8gMjU1LAogICAgCQkJCQkJCU1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMyBdLCAxMCApICkgLyAyNTUsCiAgICAJCQkJCQkJY29sb3JTcGFjZQogICAgCQkJCQkJKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKCBjb21wb25lbnRzICkgKSB7CgogICAgCQkJCQkJLy8gcmdiKDEwMCUsMCUsMCUpIHJnYmEoMTAwJSwwJSwwJSwwLjUpCgogICAgCQkJCQkJaGFuZGxlQWxwaGEoIGNvbG9yWyA0IF0gKTsKCiAgICAJCQkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCiAgICAJCQkJCQkJTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAxIF0sIDEwICkgKSAvIDEwMCwKICAgIAkJCQkJCQlNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDIgXSwgMTAgKSApIC8gMTAwLAogICAgCQkJCQkJCU1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMyBdLCAxMCApICkgLyAxMDAsCiAgICAJCQkJCQkJY29sb3JTcGFjZQogICAgCQkJCQkJKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlICdoc2wnOgogICAgCQkJCWNhc2UgJ2hzbGEnOgoKICAgIAkJCQkJaWYgKCBjb2xvciA9IC9eXHMqKFxkKlwuP1xkKylccyosXHMqKFxkKlwuP1xkKylcJVxzKixccyooXGQqXC4/XGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKCBjb21wb25lbnRzICkgKSB7CgogICAgCQkJCQkJLy8gaHNsKDEyMCw1MCUsNTAlKSBoc2xhKDEyMCw1MCUsNTAlLDAuNSkKCiAgICAJCQkJCQloYW5kbGVBbHBoYSggY29sb3JbIDQgXSApOwoKICAgIAkJCQkJCXJldHVybiB0aGlzLnNldEhTTCgKICAgIAkJCQkJCQlwYXJzZUZsb2F0KCBjb2xvclsgMSBdICkgLyAzNjAsCiAgICAJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDIgXSApIC8gMTAwLAogICAgCQkJCQkJCXBhcnNlRmxvYXQoIGNvbG9yWyAzIF0gKSAvIDEwMCwKICAgIAkJCQkJCQljb2xvclNwYWNlCiAgICAJCQkJCQkpOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJCWRlZmF1bHQ6CgogICAgCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogVW5rbm93biBjb2xvciBtb2RlbCAnICsgc3R5bGUgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCBtID0gL15cIyhbQS1GYS1mXGRdKykkLy5leGVjKCBzdHlsZSApICkgewoKICAgIAkJCS8vIGhleCBjb2xvcgoKICAgIAkJCWNvbnN0IGhleCA9IG1bIDEgXTsKICAgIAkJCWNvbnN0IHNpemUgPSBoZXgubGVuZ3RoOwoKICAgIAkJCWlmICggc2l6ZSA9PT0gMyApIHsKCiAgICAJCQkJLy8gI2ZmMAogICAgCQkJCXJldHVybiB0aGlzLnNldFJHQigKICAgIAkJCQkJcGFyc2VJbnQoIGhleC5jaGFyQXQoIDAgKSwgMTYgKSAvIDE1LAogICAgCQkJCQlwYXJzZUludCggaGV4LmNoYXJBdCggMSApLCAxNiApIC8gMTUsCiAgICAJCQkJCXBhcnNlSW50KCBoZXguY2hhckF0KCAyICksIDE2ICkgLyAxNSwKICAgIAkJCQkJY29sb3JTcGFjZQogICAgCQkJCSk7CgogICAgCQkJfSBlbHNlIGlmICggc2l6ZSA9PT0gNiApIHsKCiAgICAJCQkJLy8gI2ZmMDAwMAogICAgCQkJCXJldHVybiB0aGlzLnNldEhleCggcGFyc2VJbnQoIGhleCwgMTYgKSwgY29sb3JTcGFjZSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yOiBJbnZhbGlkIGhleCBjb2xvciAnICsgc3R5bGUgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCBzdHlsZSAmJiBzdHlsZS5sZW5ndGggPiAwICkgewoKICAgIAkJCXJldHVybiB0aGlzLnNldENvbG9yTmFtZSggc3R5bGUsIGNvbG9yU3BhY2UgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBjb2xvciBmcm9tIGEgY29sb3IgbmFtZS4gRmFzdGVyIHRoYW4ge0BsaW5rIENvbG9yI3NldFN0eWxlfSBpZgogICAgCSAqIHlvdSBkb24ndCBuZWVkIHRoZSBvdGhlciBDU1Mtc3R5bGUgZm9ybWF0cy4KICAgIAkgKgogICAgCSAqIEZvciBjb252ZW5pZW5jZSwgdGhlIGxpc3Qgb2YgbmFtZXMgaXMgZXhwb3NlZCBpbiBgQ29sb3IuTkFNRVNgIGFzIGEgaGFzaC4KICAgIAkgKiBgYGBqcwogICAgCSAqIENvbG9yLk5BTUVTLmFsaWNlYmx1ZSAvLyByZXR1cm5zIDB4RjBGOEZGCiAgICAJICogYGBgCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gc3R5bGUgLSBUaGUgY29sb3IgbmFtZS4KICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCXNldENvbG9yTmFtZSggc3R5bGUsIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCiAgICAJCS8vIGNvbG9yIGtleXdvcmRzCiAgICAJCWNvbnN0IGhleCA9IF9jb2xvcktleXdvcmRzWyBzdHlsZS50b0xvd2VyQ2FzZSgpIF07CgogICAgCQlpZiAoIGhleCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCS8vIHJlZAogICAgCQkJdGhpcy5zZXRIZXgoIGhleCwgY29sb3JTcGFjZSApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQkvLyB1bmtub3duIGNvbG9yCiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogVW5rbm93biBjb2xvciAnICsgc3R5bGUgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgY29sb3Igd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuciwgdGhpcy5nLCB0aGlzLmIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3IgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJY29weSggY29sb3IgKSB7CgogICAgCQl0aGlzLnIgPSBjb2xvci5yOwogICAgCQl0aGlzLmcgPSBjb2xvci5nOwogICAgCQl0aGlzLmIgPSBjb2xvci5iOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSBnaXZlbiBjb2xvciBpbnRvIHRoaXMgY29sb3IsIGFuZCB0aGVuIGNvbnZlcnRzIHRoaXMgY29sb3IgZnJvbQogICAgCSAqIGBTUkdCQ29sb3JTcGFjZWAgdG8gYExpbmVhclNSR0JDb2xvclNwYWNlYC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvcHkvY29udmVydC4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAljb3B5U1JHQlRvTGluZWFyKCBjb2xvciApIHsKCiAgICAJCXRoaXMuciA9IFNSR0JUb0xpbmVhciggY29sb3IuciApOwogICAgCQl0aGlzLmcgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmcgKTsKICAgIAkJdGhpcy5iID0gU1JHQlRvTGluZWFyKCBjb2xvci5iICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIGdpdmVuIGNvbG9yIGludG8gdGhpcyBjb2xvciwgYW5kIHRoZW4gY29udmVydHMgdGhpcyBjb2xvciBmcm9tCiAgICAJICogYExpbmVhclNSR0JDb2xvclNwYWNlYCB0byBgU1JHQkNvbG9yU3BhY2VgLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gY29weS9jb252ZXJ0LgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWNvcHlMaW5lYXJUb1NSR0IoIGNvbG9yICkgewoKICAgIAkJdGhpcy5yID0gTGluZWFyVG9TUkdCKCBjb2xvci5yICk7CiAgICAJCXRoaXMuZyA9IExpbmVhclRvU1JHQiggY29sb3IuZyApOwogICAgCQl0aGlzLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbnZlcnRzIHRoaXMgY29sb3IgZnJvbSBgU1JHQkNvbG9yU3BhY2VgIHRvIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAljb252ZXJ0U1JHQlRvTGluZWFyKCkgewoKICAgIAkJdGhpcy5jb3B5U1JHQlRvTGluZWFyKCB0aGlzICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20gYExpbmVhclNSR0JDb2xvclNwYWNlYCB0byBgU1JHQkNvbG9yU3BhY2VgLgogICAgCSAqCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJY29udmVydExpbmVhclRvU1JHQigpIHsKCiAgICAJCXRoaXMuY29weUxpbmVhclRvU1JHQiggdGhpcyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgaGV4YWRlY2ltYWwgdmFsdWUgb2YgdGhpcyBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1TUkdCQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCiAgICAJICovCiAgICAJZ2V0SGV4KCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgogICAgCQlDb2xvck1hbmFnZW1lbnQud29ya2luZ1RvQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKICAgIAkJcmV0dXJuIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuciAqIDI1NSwgMCwgMjU1ICkgKSAqIDY1NTM2ICsgTWF0aC5yb3VuZCggY2xhbXAoIF9jb2xvci5nICogMjU1LCAwLCAyNTUgKSApICogMjU2ICsgTWF0aC5yb3VuZCggY2xhbXAoIF9jb2xvci5iICogMjU1LCAwLCAyNTUgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGhleGFkZWNpbWFsIHZhbHVlIG9mIHRoaXMgY29sb3IgYXMgYSBzdHJpbmcgKGZvciBleGFtcGxlLCAnRkZGRkZGJykuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGhleGFkZWNpbWFsIHZhbHVlIGFzIGEgc3RyaW5nLgogICAgCSAqLwogICAgCWdldEhleFN0cmluZyggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKICAgIAkJcmV0dXJuICggJzAwMDAwMCcgKyB0aGlzLmdldEhleCggY29sb3JTcGFjZSApLnRvU3RyaW5nKCAxNiApICkuc2xpY2UoIC02ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29udmVydHMgdGhlIGNvbG9ycyBSR0IgdmFsdWVzIGludG8gdGhlIEhTTCBmb3JtYXQgYW5kIHN0b3JlcyB0aGVtIGludG8gdGhlCiAgICAJICogZ2l2ZW4gdGFyZ2V0IG9iamVjdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7e2g6bnVtYmVyLHM6bnVtYmVyLGw6bnVtYmVyfX0gdGFyZ2V0IC0gVGhlIHRhcmdldCBvYmplY3QgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPUNvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCiAgICAJICogQHJldHVybiB7e2g6bnVtYmVyLHM6bnVtYmVyLGw6bnVtYmVyfX0gVGhlIEhTTCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWdldEhTTCggdGFyZ2V0LCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKICAgIAkJLy8gaCxzLGwgcmFuZ2VzIGFyZSBpbiAwLjAgLSAxLjAKCiAgICAJCUNvbG9yTWFuYWdlbWVudC53b3JraW5nVG9Db2xvclNwYWNlKCBfY29sb3IuY29weSggdGhpcyApLCBjb2xvclNwYWNlICk7CgogICAgCQljb25zdCByID0gX2NvbG9yLnIsIGcgPSBfY29sb3IuZywgYiA9IF9jb2xvci5iOwoKICAgIAkJY29uc3QgbWF4ID0gTWF0aC5tYXgoIHIsIGcsIGIgKTsKICAgIAkJY29uc3QgbWluID0gTWF0aC5taW4oIHIsIGcsIGIgKTsKCiAgICAJCWxldCBodWUsIHNhdHVyYXRpb247CiAgICAJCWNvbnN0IGxpZ2h0bmVzcyA9ICggbWluICsgbWF4ICkgLyAyLjA7CgogICAgCQlpZiAoIG1pbiA9PT0gbWF4ICkgewoKICAgIAkJCWh1ZSA9IDA7CiAgICAJCQlzYXR1cmF0aW9uID0gMDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc3QgZGVsdGEgPSBtYXggLSBtaW47CgogICAgCQkJc2F0dXJhdGlvbiA9IGxpZ2h0bmVzcyA8PSAwLjUgPyBkZWx0YSAvICggbWF4ICsgbWluICkgOiBkZWx0YSAvICggMiAtIG1heCAtIG1pbiApOwoKICAgIAkJCXN3aXRjaCAoIG1heCApIHsKCiAgICAJCQkJY2FzZSByOiBodWUgPSAoIGcgLSBiICkgLyBkZWx0YSArICggZyA8IGIgPyA2IDogMCApOyBicmVhazsKICAgIAkJCQljYXNlIGc6IGh1ZSA9ICggYiAtIHIgKSAvIGRlbHRhICsgMjsgYnJlYWs7CiAgICAJCQkJY2FzZSBiOiBodWUgPSAoIHIgLSBnICkgLyBkZWx0YSArIDQ7IGJyZWFrOwoKICAgIAkJCX0KCiAgICAJCQlodWUgLz0gNjsKCiAgICAJCX0KCiAgICAJCXRhcmdldC5oID0gaHVlOwogICAgCQl0YXJnZXQucyA9IHNhdHVyYXRpb247CiAgICAJCXRhcmdldC5sID0gbGlnaHRuZXNzOwoKICAgIAkJcmV0dXJuIHRhcmdldDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IgYW5kIHN0b3JlcyB0aGVtIGludG8gdGhlIGdpdmVuIHRhcmdldCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IGNvbG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBUaGUgUkdCIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJZ2V0UkdCKCB0YXJnZXQsIGNvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKSB7CgogICAgCQlDb2xvck1hbmFnZW1lbnQud29ya2luZ1RvQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKICAgIAkJdGFyZ2V0LnIgPSBfY29sb3IucjsKICAgIAkJdGFyZ2V0LmcgPSBfY29sb3IuZzsKICAgIAkJdGFyZ2V0LmIgPSBfY29sb3IuYjsKCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhpcyBjb2xvciBhcyBhIENTUyBzdHlsZSBzdHJpbmcuIEV4YW1wbGU6IGByZ2IoMjU1LDAsMClgLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KICAgIAkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBDU1MgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlnZXRTdHlsZSggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKICAgIAkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCiAgICAJCWNvbnN0IHIgPSBfY29sb3IuciwgZyA9IF9jb2xvci5nLCBiID0gX2NvbG9yLmI7CgogICAgCQlpZiAoIGNvbG9yU3BhY2UgIT09IFNSR0JDb2xvclNwYWNlICkgewoKICAgIAkJCS8vIFJlcXVpcmVzIENTUyBDb2xvciBNb2R1bGUgTGV2ZWwgNCAoaHR0cHM6Ly93d3cudzMub3JnL1RSL2Nzcy1jb2xvci00LykuCiAgICAJCQlyZXR1cm4gYGNvbG9yKCR7IGNvbG9yU3BhY2UgfSAkeyByLnRvRml4ZWQoIDMgKSB9ICR7IGcudG9GaXhlZCggMyApIH0gJHsgYi50b0ZpeGVkKCAzICkgfSlgOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGByZ2IoJHsgTWF0aC5yb3VuZCggciAqIDI1NSApIH0sJHsgTWF0aC5yb3VuZCggZyAqIDI1NSApIH0sJHsgTWF0aC5yb3VuZCggYiAqIDI1NSApIH0pYDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiBIU0wgdmFsdWVzIHRvIHRoaXMgY29sb3IncyB2YWx1ZXMuCiAgICAJICogSW50ZXJuYWxseSwgdGhpcyBjb252ZXJ0cyB0aGUgY29sb3IncyBSR0IgdmFsdWVzIHRvIEhTTCwgYWRkcyBIU0wKICAgIAkgKiBhbmQgdGhlbiBjb252ZXJ0cyB0aGUgY29sb3IgYmFjayB0byBSR0IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaCAtIEh1ZSB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFNhdHVyYXRpb24gdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGwgLSBMaWdodG5lc3MgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJb2Zmc2V0SFNMKCBoLCBzLCBsICkgewoKICAgIAkJdGhpcy5nZXRIU0woIF9oc2xBICk7CgogICAgCQlyZXR1cm4gdGhpcy5zZXRIU0woIF9oc2xBLmggKyBoLCBfaHNsQS5zICsgcywgX2hzbEEubCArIGwgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBSR0IgdmFsdWVzIG9mIHRoZSBnaXZlbiBjb2xvciB0byB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gYWRkLgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWFkZCggY29sb3IgKSB7CgogICAgCQl0aGlzLnIgKz0gY29sb3IucjsKICAgIAkJdGhpcy5nICs9IGNvbG9yLmc7CiAgICAJCXRoaXMuYiArPSBjb2xvci5iOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQWRkcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3JzIGFuZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IxIC0gVGhlIGZpcnN0IGNvbG9yLgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMiAtIFRoZSBzZWNvbmQgY29sb3IuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJYWRkQ29sb3JzKCBjb2xvcjEsIGNvbG9yMiApIHsKCiAgICAJCXRoaXMuciA9IGNvbG9yMS5yICsgY29sb3IyLnI7CiAgICAJCXRoaXMuZyA9IGNvbG9yMS5nICsgY29sb3IyLmc7CiAgICAJCXRoaXMuYiA9IGNvbG9yMS5iICsgY29sb3IyLmI7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgdG8gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBhZGQuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJYWRkU2NhbGFyKCBzICkgewoKICAgIAkJdGhpcy5yICs9IHM7CiAgICAJCXRoaXMuZyArPSBzOwogICAgCQl0aGlzLmIgKz0gczsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN1YnRyYWN0cyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3IgZnJvbSB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gc3VidHJhY3QuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJc3ViKCBjb2xvciApIHsKCiAgICAJCXRoaXMuciA9IE1hdGgubWF4KCAwLCB0aGlzLnIgLSBjb2xvci5yICk7CiAgICAJCXRoaXMuZyA9IE1hdGgubWF4KCAwLCB0aGlzLmcgLSBjb2xvci5nICk7CiAgICAJCXRoaXMuYiA9IE1hdGgubWF4KCAwLCB0aGlzLmIgLSBjb2xvci5iICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBNdWx0aXBsaWVzIHRoZSBSR0IgdmFsdWVzIG9mIHRoZSBnaXZlbiBjb2xvciB3aXRoIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBtdWx0aXBseS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAltdWx0aXBseSggY29sb3IgKSB7CgogICAgCQl0aGlzLnIgKj0gY29sb3IucjsKICAgIAkJdGhpcy5nICo9IGNvbG9yLmc7CiAgICAJCXRoaXMuYiAqPSBjb2xvci5iOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHdpdGggdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAltdWx0aXBseVNjYWxhciggcyApIHsKCiAgICAJCXRoaXMuciAqPSBzOwogICAgCQl0aGlzLmcgKj0gczsKICAgIAkJdGhpcy5iICo9IHM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgdGhpcyBjb2xvcidzIFJHQiB2YWx1ZXMgdG93YXJkIHRoZSBSR0IgdmFsdWVzIG9mIHRoZQogICAgCSAqIGdpdmVuIGNvbG9yLiBUaGUgYWxwaGEgYXJndW1lbnQgY2FuIGJlIHRob3VnaHQgb2YgYXMgdGhlIHJhdGlvIGJldHdlZW4KICAgIAkgKiB0aGUgdHdvIGNvbG9ycywgd2hlcmUgYDAuMGAgaXMgdGhpcyBjb2xvciBhbmQgYDEuMGAgaXMgdGhlIGZpcnN0IGFyZ3VtZW50LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gY29udmVyZ2Ugb24uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLDFdYC4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlsZXJwKCBjb2xvciwgYWxwaGEgKSB7CgogICAgCQl0aGlzLnIgKz0gKCBjb2xvci5yIC0gdGhpcy5yICkgKiBhbHBoYTsKICAgIAkJdGhpcy5nICs9ICggY29sb3IuZyAtIHRoaXMuZyApICogYWxwaGE7CiAgICAJCXRoaXMuYiArPSAoIGNvbG9yLmIgLSB0aGlzLmIgKSAqIGFscGhhOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIGJldHdlZW4gdGhlIGdpdmVuIGNvbG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KICAgIAkgKiBUaGUgYWxwaGEgYXJndW1lbnQgY2FuIGJlIHRob3VnaHQgb2YgYXMgdGhlIHJhdGlvIGJldHdlZW4gdGhlIHR3byBjb2xvcnMsIHdoZXJlIGAwLjBgCiAgICAJICogaXMgdGhlIGZpcnN0IGFuZCBgMS4wYCBpcyB0aGUgc2Vjb25kIGNvbG9yLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtDb2xvcn0gY29sb3IxIC0gVGhlIGZpcnN0IGNvbG9yLgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMiAtIFRoZSBzZWNvbmQgY29sb3IuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLDFdYC4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlsZXJwQ29sb3JzKCBjb2xvcjEsIGNvbG9yMiwgYWxwaGEgKSB7CgogICAgCQl0aGlzLnIgPSBjb2xvcjEuciArICggY29sb3IyLnIgLSBjb2xvcjEuciApICogYWxwaGE7CiAgICAJCXRoaXMuZyA9IGNvbG9yMS5nICsgKCBjb2xvcjIuZyAtIGNvbG9yMS5nICkgKiBhbHBoYTsKICAgIAkJdGhpcy5iID0gY29sb3IxLmIgKyAoIGNvbG9yMi5iIC0gY29sb3IxLmIgKSAqIGFscGhhOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIHRoaXMgY29sb3IncyBIU0wgdmFsdWVzIHRvd2FyZCB0aGUgSFNMIHZhbHVlcyBvZiB0aGUKICAgIAkgKiBnaXZlbiBjb2xvci4gSXQgZGlmZmVycyBmcm9tIHtAbGluayBDb2xvciNsZXJwfSBieSBub3QgaW50ZXJwb2xhdGluZyBzdHJhaWdodAogICAgCSAqIGZyb20gb25lIGNvbG9yIHRvIHRoZSBvdGhlciwgYnV0IGluc3RlYWQgZ29pbmcgdGhyb3VnaCBhbGwgdGhlIGh1ZXMgaW4gYmV0d2VlbgogICAgCSAqIHRob3NlIHR3byBjb2xvcnMuIFRoZSBhbHBoYSBhcmd1bWVudCBjYW4gYmUgdGhvdWdodCBvZiBhcyB0aGUgcmF0aW8gYmV0d2VlbgogICAgCSAqIHRoZSB0d28gY29sb3JzLCB3aGVyZSAwLjAgaXMgdGhpcyBjb2xvciBhbmQgMS4wIGlzIHRoZSBmaXJzdCBhcmd1bWVudC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvbnZlcmdlIG9uLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJbGVycEhTTCggY29sb3IsIGFscGhhICkgewoKICAgIAkJdGhpcy5nZXRIU0woIF9oc2xBICk7CiAgICAJCWNvbG9yLmdldEhTTCggX2hzbEIgKTsKCiAgICAJCWNvbnN0IGggPSBsZXJwKCBfaHNsQS5oLCBfaHNsQi5oLCBhbHBoYSApOwogICAgCQljb25zdCBzID0gbGVycCggX2hzbEEucywgX2hzbEIucywgYWxwaGEgKTsKICAgIAkJY29uc3QgbCA9IGxlcnAoIF9oc2xBLmwsIF9oc2xCLmwsIGFscGhhICk7CgogICAgCQl0aGlzLnNldEhTTCggaCwgcywgbCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgY29sb3IncyBSR0IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiAzRCB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlzZXRGcm9tVmVjdG9yMyggdiApIHsKCiAgICAJCXRoaXMuciA9IHYueDsKICAgIAkJdGhpcy5nID0gdi55OwogICAgCQl0aGlzLmIgPSB2Lno7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2Zvcm1zIHRoaXMgY29sb3Igd2l0aCB0aGUgZ2l2ZW4gM3gzIG1hdHJpeC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSBtYXRyaXguCiAgICAJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXgzKCBtICkgewoKICAgIAkJY29uc3QgciA9IHRoaXMuciwgZyA9IHRoaXMuZywgYiA9IHRoaXMuYjsKICAgIAkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgogICAgCQl0aGlzLnIgPSBlWyAwIF0gKiByICsgZVsgMyBdICogZyArIGVbIDYgXSAqIGI7CiAgICAJCXRoaXMuZyA9IGVbIDEgXSAqIHIgKyBlWyA0IF0gKiBnICsgZVsgNyBdICogYjsKICAgIAkJdGhpcy5iID0gZVsgMiBdICogciArIGVbIDUgXSAqIGcgKyBlWyA4IF0gKiBiOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBjb2xvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0NvbG9yfSBjIC0gVGhlIGNvbG9yIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBib3VuZGluZyBjb2xvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICovCiAgICAJZXF1YWxzKCBjICkgewoKICAgIAkJcmV0dXJuICggYy5yID09PSB0aGlzLnIgKSAmJiAoIGMuZyA9PT0gdGhpcy5nICkgJiYgKCBjLmIgPT09IHRoaXMuYiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhpcyBjb2xvcidzIFJHQiBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIGFycmF5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIFJHQiB2YWx1ZXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBUaGUgb2Zmc2V0IGludG8gdGhlIGFycmF5LgogICAgCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgogICAgCSAqLwogICAgCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgogICAgCQl0aGlzLnIgPSBhcnJheVsgb2Zmc2V0IF07CiAgICAJCXRoaXMuZyA9IGFycmF5WyBvZmZzZXQgKyAxIF07CiAgICAJCXRoaXMuYiA9IGFycmF5WyBvZmZzZXQgKyAyIF07CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXcml0ZXMgdGhlIFJHQiBjb21wb25lbnRzIG9mIHRoaXMgY29sb3IgdG8gdGhlIGdpdmVuIGFycmF5LiBJZiBubyBhcnJheSBpcyBwcm92aWRlZCwKICAgIAkgKiB0aGUgbWV0aG9kIHJldHVybnMgYSBuZXcgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IFthcnJheT1bXV0gLSBUaGUgdGFyZ2V0IGFycmF5IGhvbGRpbmcgdGhlIGNvbG9yIGNvbXBvbmVudHMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCiAgICAJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIGNvbG9yIGNvbXBvbmVudHMuCiAgICAJICovCiAgICAJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCiAgICAJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMucjsKICAgIAkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuZzsKICAgIAkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRoaXMuYjsKCiAgICAJCXJldHVybiBhcnJheTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgY29sb3IgZnJvbSB0aGUgZ2l2ZW4gYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBUaGUgYnVmZmVyIGF0dHJpYnV0ZSBob2xkaW5nIGNvbG9yIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KICAgIAkgKi8KICAgIAlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKICAgIAkJdGhpcy5yID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CiAgICAJCXRoaXMuZyA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwogICAgCQl0aGlzLmIgPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFRoaXMgbWV0aG9kcyBkZWZpbmVzIHRoZSBzZXJpYWxpemF0aW9uIHJlc3VsdCBvZiB0aGlzIGNsYXNzLiBSZXR1cm5zIHRoZSBjb2xvcgogICAgCSAqIGFzIGEgaGV4YWRlY2ltYWwgdmFsdWUuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBoZXhhZGVjaW1hbCB2YWx1ZS4KICAgIAkgKi8KICAgIAl0b0pTT04oKSB7CgogICAgCQlyZXR1cm4gdGhpcy5nZXRIZXgoKTsKCiAgICAJfQoKICAgIAkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCiAgICAJCXlpZWxkIHRoaXMucjsKICAgIAkJeWllbGQgdGhpcy5nOwogICAgCQl5aWVsZCB0aGlzLmI7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX2NvbG9yID0gLypAX19QVVJFX18qLyBuZXcgQ29sb3IoKTsKCiAgICAvKioKICAgICAqIEEgZGljdGlvbmFyeSB3aXRoIFgxMSBjb2xvciBuYW1lcy4KICAgICAqCiAgICAgKiBOb3RlIHRoYXQgbXVsdGlwbGUgd29yZHMgc3VjaCBhcyBEYXJrIE9yYW5nZSBiZWNvbWUgdGhlIHN0cmluZyAnZGFya29yYW5nZScuCiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQHR5cGUge09iamVjdH0KICAgICAqLwogICAgQ29sb3IuTkFNRVMgPSBfY29sb3JLZXl3b3JkczsKCiAgICBsZXQgX21hdGVyaWFsSWQgPSAwOwoKICAgIC8qKgogICAgICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgbWF0ZXJpYWxzLgogICAgICoKICAgICAqIE1hdGVyaWFscyBkZWZpbmUgdGhlIGFwcGVhcmFuY2Ugb2YgcmVuZGVyYWJsZSAzRCBvYmplY3RzLgogICAgICoKICAgICAqIEBhYnN0cmFjdAogICAgICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgogICAgICovCiAgICBjbGFzcyBNYXRlcmlhbCBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgbWF0ZXJpYWwuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNNYXRlcmlhbCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIElEIG9mIHRoZSBtYXRlcmlhbC4KICAgIAkJICoKICAgIAkJICogQG5hbWUgTWF0ZXJpYWwjaWQKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9tYXRlcmlhbElkICsrIH0gKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgVVVJRCBvZiB0aGUgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKi8KICAgIAkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgogICAgCQkvKioKICAgIAkJICogVGhlIG5hbWUgb2YgdGhlIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy5uYW1lID0gJyc7CgogICAgCQkvKioKICAgIAkJICogVGhlIHR5cGUgcHJvcGVydHkgaXMgdXNlZCBmb3IgZGV0ZWN0aW5nIHRoZSBvYmplY3QgdHlwZQogICAgCQkgKiBpbiBjb250ZXh0IG9mIHNlcmlhbGl6YXRpb24vZGVzZXJpYWxpemF0aW9uLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMudHlwZSA9ICdNYXRlcmlhbCc7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgdHlwZSBvZiB0aGUgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEl0IG11c3QgYmUgc2V0IHRvIGBDdXN0b21CbGVuZGluZ2AgaWYgY3VzdG9tIGJsZW5kaW5nIHByb3BlcnRpZXMgbGlrZQogICAgCQkgKiB7QGxpbmsgTWF0ZXJpYWwjYmxlbmRTcmN9LCB7QGxpbmsgTWF0ZXJpYWwjYmxlbmREc3R9IG9yIHtAbGluayBNYXRlcmlhbCNibGVuZEVxdWF0aW9ufQogICAgCQkgKiBzaG91bGQgaGF2ZSBhbnkgZWZmZWN0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE5vQmxlbmRpbmd8Tm9ybWFsQmxlbmRpbmd8QWRkaXRpdmVCbGVuZGluZ3xTdWJ0cmFjdGl2ZUJsZW5kaW5nfE11bHRpcGx5QmxlbmRpbmd8Q3VzdG9tQmxlbmRpbmcpfQogICAgCQkgKiBAZGVmYXVsdCBOb3JtYWxCbGVuZGluZwogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZGluZyA9IE5vcm1hbEJsZW5kaW5nOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hpY2ggc2lkZSBvZiBmYWNlcyB3aWxsIGJlIHJlbmRlcmVkIC0gZnJvbnQsIGJhY2sgb3IgYm90aC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhGcm9udFNpZGV8QmFja1NpZGV8RG91YmxlU2lkZSl9CiAgICAJCSAqIEBkZWZhdWx0IEZyb250U2lkZQogICAgCQkgKi8KICAgIAkJdGhpcy5zaWRlID0gRnJvbnRTaWRlOwoKICAgIAkJLyoqCiAgICAJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHZlcnRleCBjb2xvcnMgc2hvdWxkIGJlIHVzZWQuCiAgICAJCSAqCiAgICAJCSAqIFRoZSBlbmdpbmUgc3VwcG9ydHMgUkdCIGFuZCBSR0JBIHZlcnRleCBjb2xvcnMgZGVwZW5kaW5nIG9uIHdoZXRoZXIgYSB0aHJlZSAoUkdCKSBvcgogICAgCQkgKiBmb3VyIChSR0JBKSBjb21wb25lbnQgY29sb3IgYnVmZmVyIGF0dHJpYnV0ZSBpcyB1c2VkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMudmVydGV4Q29sb3JzID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyBob3cgdHJhbnNwYXJlbnQgdGhlIG1hdGVyaWFsIGlzLgogICAgCQkgKiBBIHZhbHVlIG9mIGAwLjBgIGluZGljYXRlcyBmdWxseSB0cmFuc3BhcmVudCwgYDEuMGAgaXMgZnVsbHkgb3BhcXVlLgogICAgCQkgKgogICAgCQkgKiBJZiB0aGUge0BsaW5rIE1hdGVyaWFsI3RyYW5zcGFyZW50fSBpcyBub3Qgc2V0IHRvIGB0cnVlYCwKICAgIAkJICogdGhlIG1hdGVyaWFsIHdpbGwgcmVtYWluIGZ1bGx5IG9wYXF1ZSBhbmQgdGhpcyB2YWx1ZSB3aWxsIG9ubHkgYWZmZWN0IGl0cyBjb2xvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5vcGFjaXR5ID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHdoZXRoZXIgdGhpcyBtYXRlcmlhbCBpcyB0cmFuc3BhcmVudC4gVGhpcyBoYXMgYW4gZWZmZWN0IG9uCiAgICAJCSAqIHJlbmRlcmluZyBhcyB0cmFuc3BhcmVudCBvYmplY3RzIG5lZWQgc3BlY2lhbCB0cmVhdG1lbnQgYW5kIGFyZSByZW5kZXJlZAogICAgCQkgKiBhZnRlciBub24tdHJhbnNwYXJlbnQgb2JqZWN0cy4KICAgIAkJICoKICAgIAkJICogV2hlbiBzZXQgdG8gdHJ1ZSwgdGhlIGV4dGVudCB0byB3aGljaCB0aGUgbWF0ZXJpYWwgaXMgdHJhbnNwYXJlbnQgaXMKICAgIAkJICogY29udHJvbGxlZCBieSB7QGxpbmsgTWF0ZXJpYWwjb3BhY2l0eX0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy50cmFuc3BhcmVudCA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIEVuYWJsZXMgYWxwaGEgaGFzaGVkIHRyYW5zcGFyZW5jeSwgYW4gYWx0ZXJuYXRpdmUgdG8ge0BsaW5rIE1hdGVyaWFsI3RyYW5zcGFyZW50fSBvcgogICAgCQkgKiB7QGxpbmsgTWF0ZXJpYWwjYWxwaGFUZXN0fS4gVGhlIG1hdGVyaWFsIHdpbGwgbm90IGJlIHJlbmRlcmVkIGlmIG9wYWNpdHkgaXMgbG93ZXIgdGhhbgogICAgCQkgKiBhIHJhbmRvbSB0aHJlc2hvbGQuIFJhbmRvbWl6YXRpb24gaW50cm9kdWNlcyBzb21lIGdyYWluIG9yIG5vaXNlLCBidXQgYXBwcm94aW1hdGVzIGFscGhhCiAgICAJCSAqIGJsZW5kaW5nIHdpdGhvdXQgdGhlIGFzc29jaWF0ZWQgcHJvYmxlbXMgb2Ygc29ydGluZy4gVXNpbmcgVEFBIGNhbiByZWR1Y2UgdGhlIHJlc3VsdGluZyBub2lzZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmFscGhhSGFzaCA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIHNvdXJjZSBmYWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoWmVyb0ZhY3RvcnxPbmVGYWN0b3J8U3JjQ29sb3JGYWN0b3J8T25lTWludXNTcmNDb2xvckZhY3RvcnxTcmNBbHBoYUZhY3RvcnxPbmVNaW51c1NyY0FscGhhRmFjdG9yfERzdEFscGhhRmFjdG9yfE9uZU1pbnVzRHN0QWxwaGFGYWN0b3J8RHN0Q29sb3JGYWN0b3J8T25lTWludXNEc3RDb2xvckZhY3RvcnxTcmNBbHBoYVNhdHVyYXRlRmFjdG9yfENvbnN0YW50Q29sb3JGYWN0b3J8T25lTWludXNDb25zdGFudENvbG9yRmFjdG9yfENvbnN0YW50QWxwaGFGYWN0b3J8T25lTWludXNDb25zdGFudEFscGhhRmFjdG9yKX0KICAgIAkJICogQGRlZmF1bHQgU3JjQWxwaGFGYWN0b3IKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmRTcmMgPSBTcmNBbHBoYUZhY3RvcjsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBkZXN0aW5hdGlvbiBmYWN0b3IuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoWmVyb0ZhY3RvcnxPbmVGYWN0b3J8U3JjQ29sb3JGYWN0b3J8T25lTWludXNTcmNDb2xvckZhY3RvcnxTcmNBbHBoYUZhY3RvcnxPbmVNaW51c1NyY0FscGhhRmFjdG9yfERzdEFscGhhRmFjdG9yfE9uZU1pbnVzRHN0QWxwaGFGYWN0b3J8RHN0Q29sb3JGYWN0b3J8T25lTWludXNEc3RDb2xvckZhY3RvcnxTcmNBbHBoYVNhdHVyYXRlRmFjdG9yfENvbnN0YW50Q29sb3JGYWN0b3J8T25lTWludXNDb25zdGFudENvbG9yRmFjdG9yfENvbnN0YW50QWxwaGFGYWN0b3J8T25lTWludXNDb25zdGFudEFscGhhRmFjdG9yKX0KICAgIAkJICogQGRlZmF1bHQgT25lTWludXNTcmNBbHBoYUZhY3RvcgogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZERzdCA9IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3I7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZXF1YXRpb24uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoQWRkRXF1YXRpb258U3VidHJhY3RFcXVhdGlvbnxSZXZlcnNlU3VidHJhY3RFcXVhdGlvbnxNaW5FcXVhdGlvbnxNYXhFcXVhdGlvbil9CiAgICAJCSAqIEBkZWZhdWx0IEFkZEVxdWF0aW9uCiAgICAJCSAqLwogICAgCQl0aGlzLmJsZW5kRXF1YXRpb24gPSBBZGRFcXVhdGlvbjsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBzb3VyY2UgYWxwaGEgZmFjdG9yLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7PyhaZXJvRmFjdG9yfE9uZUZhY3RvcnxTcmNDb2xvckZhY3RvcnxPbmVNaW51c1NyY0NvbG9yRmFjdG9yfFNyY0FscGhhRmFjdG9yfE9uZU1pbnVzU3JjQWxwaGFGYWN0b3J8RHN0QWxwaGFGYWN0b3J8T25lTWludXNEc3RBbHBoYUZhY3RvcnxEc3RDb2xvckZhY3RvcnxPbmVNaW51c0RzdENvbG9yRmFjdG9yfFNyY0FscGhhU2F0dXJhdGVGYWN0b3J8Q29uc3RhbnRDb2xvckZhY3RvcnxPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3J8Q29uc3RhbnRBbHBoYUZhY3RvcnxPbmVNaW51c0NvbnN0YW50QWxwaGFGYWN0b3IpfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmJsZW5kU3JjQWxwaGEgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIGRlc3RpbmF0aW9uIGFscGhhIGZhY3Rvci4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oWmVyb0ZhY3RvcnxPbmVGYWN0b3J8U3JjQ29sb3JGYWN0b3J8T25lTWludXNTcmNDb2xvckZhY3RvcnxTcmNBbHBoYUZhY3RvcnxPbmVNaW51c1NyY0FscGhhRmFjdG9yfERzdEFscGhhRmFjdG9yfE9uZU1pbnVzRHN0QWxwaGFGYWN0b3J8RHN0Q29sb3JGYWN0b3J8T25lTWludXNEc3RDb2xvckZhY3RvcnxTcmNBbHBoYVNhdHVyYXRlRmFjdG9yfENvbnN0YW50Q29sb3JGYWN0b3J8T25lTWludXNDb25zdGFudENvbG9yRmFjdG9yfENvbnN0YW50QWxwaGFGYWN0b3J8T25lTWludXNDb25zdGFudEFscGhhRmFjdG9yKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZERzdEFscGhhID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBlcXVhdGlvbiBvZiB0aGUgYWxwaGEgY2hhbm5lbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oQWRkRXF1YXRpb258U3VidHJhY3RFcXVhdGlvbnxSZXZlcnNlU3VidHJhY3RFcXVhdGlvbnxNaW5FcXVhdGlvbnxNYXhFcXVhdGlvbil9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBSZXByZXNlbnRzIHRoZSBSR0IgdmFsdWVzIG9mIHRoZSBjb25zdGFudCBibGVuZCBjb2xvci4KICAgIAkJICoKICAgIAkJICogVGhpcyBwcm9wZXJ0eSBoYXMgb25seSBhbiBlZmZlY3Qgd2hlbiB1c2luZyBjdXN0b20gYmxlbmRpbmcgd2l0aCBgQ29uc3RhbnRDb2xvcmAgb3IgYE9uZU1pbnVzQ29uc3RhbnRDb2xvcmAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtDb2xvcn0KICAgIAkJICogQGRlZmF1bHQgKDAsMCwwKQogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZENvbG9yID0gbmV3IENvbG9yKCAwLCAwLCAwICk7CgogICAgCQkvKioKICAgIAkJICogUmVwcmVzZW50cyB0aGUgYWxwaGEgdmFsdWUgb2YgdGhlIGNvbnN0YW50IGJsZW5kIGNvbG9yLgogICAgCQkgKgogICAgCQkgKiBUaGlzIHByb3BlcnR5IGhhcyBvbmx5IGFuIGVmZmVjdCB3aGVuIHVzaW5nIGN1c3RvbSBibGVuZGluZyB3aXRoIGBDb25zdGFudEFscGhhYCBvciBgT25lTWludXNDb25zdGFudEFscGhhYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5ibGVuZEFscGhhID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBkZXB0aCBmdW5jdGlvbi4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhOZXZlckRlcHRofEFsd2F5c0RlcHRofExlc3NEZXB0aHxMZXNzRXF1YWxEZXB0aHxFcXVhbERlcHRofEdyZWF0ZXJFcXVhbERlcHRofEdyZWF0ZXJEZXB0aHxOb3RFcXVhbERlcHRoKX0KICAgIAkJICogQGRlZmF1bHQgTGVzc0VxdWFsRGVwdGgKICAgIAkJICovCiAgICAJCXRoaXMuZGVwdGhGdW5jID0gTGVzc0VxdWFsRGVwdGg7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBoYXZlIGRlcHRoIHRlc3QgZW5hYmxlZCB3aGVuIHJlbmRlcmluZyB0aGlzIG1hdGVyaWFsLgogICAgCQkgKiBXaGVuIHRoZSBkZXB0aCB0ZXN0IGlzIGRpc2FibGVkLCB0aGUgZGVwdGggd3JpdGUgd2lsbCBhbHNvIGJlIGltcGxpY2l0bHkgZGlzYWJsZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmRlcHRoVGVzdCA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciByZW5kZXJpbmcgdGhpcyBtYXRlcmlhbCBoYXMgYW55IGVmZmVjdCBvbiB0aGUgZGVwdGggYnVmZmVyLgogICAgCQkgKgogICAgCQkgKiBXaGVuIGRyYXdpbmcgMkQgb3ZlcmxheXMgaXQgY2FuIGJlIHVzZWZ1bCB0byBkaXNhYmxlIHRoZSBkZXB0aCB3cml0aW5nIGluCiAgICAJCSAqIG9yZGVyIHRvIGxheWVyIHNldmVyYWwgdGhpbmdzIHRvZ2V0aGVyIHdpdGhvdXQgY3JlYXRpbmcgei1pbmRleCBhcnRpZmFjdHMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmRlcHRoV3JpdGUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBiaXQgbWFzayB0byB1c2Ugd2hlbiB3cml0aW5nIHRvIHRoZSBzdGVuY2lsIGJ1ZmZlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMHhmZgogICAgCQkgKi8KICAgIAkJdGhpcy5zdGVuY2lsV3JpdGVNYXNrID0gMHhmZjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgc3RlbmNpbCBjb21wYXJpc29uIGZ1bmN0aW9uIHRvIHVzZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge05ldmVyU3RlbmNpbEZ1bmN8TGVzc1N0ZW5jaWxGdW5jfEVxdWFsU3RlbmNpbEZ1bmN8TGVzc0VxdWFsU3RlbmNpbEZ1bmN8R3JlYXRlclN0ZW5jaWxGdW5jfE5vdEVxdWFsU3RlbmNpbEZ1bmN8R3JlYXRlckVxdWFsU3RlbmNpbEZ1bmN8QWx3YXlzU3RlbmNpbEZ1bmN9CiAgICAJCSAqIEBkZWZhdWx0IEFsd2F5c1N0ZW5jaWxGdW5jCiAgICAJCSAqLwogICAgCQl0aGlzLnN0ZW5jaWxGdW5jID0gQWx3YXlzU3RlbmNpbEZ1bmM7CgogICAgCQkvKioKICAgIAkJICogVGhlIHZhbHVlIHRvIHVzZSB3aGVuIHBlcmZvcm1pbmcgc3RlbmNpbCBjb21wYXJpc29ucyBvciBzdGVuY2lsIG9wZXJhdGlvbnMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbFJlZiA9IDA7CgogICAgCQkvKioKICAgIAkJICogVGhlIGJpdCBtYXNrIHRvIHVzZSB3aGVuIGNvbXBhcmluZyBhZ2FpbnN0IHRoZSBzdGVuY2lsIGJ1ZmZlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMHhmZgogICAgCQkgKi8KICAgIAkJdGhpcy5zdGVuY2lsRnVuY01hc2sgPSAweGZmOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoaWNoIHN0ZW5jaWwgb3BlcmF0aW9uIHRvIHBlcmZvcm0gd2hlbiB0aGUgY29tcGFyaXNvbiBmdW5jdGlvbiByZXR1cm5zIGBmYWxzZWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtaZXJvU3RlbmNpbE9wfEtlZXBTdGVuY2lsT3B8UmVwbGFjZVN0ZW5jaWxPcHxJbmNyZW1lbnRTdGVuY2lsT3B8RGVjcmVtZW50U3RlbmNpbE9wfEluY3JlbWVudFdyYXBTdGVuY2lsT3B8RGVjcmVtZW50V3JhcFN0ZW5jaWxPcHxJbnZlcnRTdGVuY2lsT3B9CiAgICAJCSAqIEBkZWZhdWx0IEtlZXBTdGVuY2lsT3AKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbEZhaWwgPSBLZWVwU3RlbmNpbE9wOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoaWNoIHN0ZW5jaWwgb3BlcmF0aW9uIHRvIHBlcmZvcm0gd2hlbiB0aGUgY29tcGFyaXNvbiBmdW5jdGlvbiByZXR1cm5zCiAgICAJCSAqIGB0cnVlYCBidXQgdGhlIGRlcHRoIHRlc3QgZmFpbHMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtaZXJvU3RlbmNpbE9wfEtlZXBTdGVuY2lsT3B8UmVwbGFjZVN0ZW5jaWxPcHxJbmNyZW1lbnRTdGVuY2lsT3B8RGVjcmVtZW50U3RlbmNpbE9wfEluY3JlbWVudFdyYXBTdGVuY2lsT3B8RGVjcmVtZW50V3JhcFN0ZW5jaWxPcHxJbnZlcnRTdGVuY2lsT3B9CiAgICAJCSAqIEBkZWZhdWx0IEtlZXBTdGVuY2lsT3AKICAgIAkJICovCiAgICAJCXRoaXMuc3RlbmNpbFpGYWlsID0gS2VlcFN0ZW5jaWxPcDsKCiAgICAJCS8qKgogICAgCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucwogICAgCQkgKiBgdHJ1ZWAgYW5kIHRoZSBkZXB0aCB0ZXN0IHBhc3Nlcy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1plcm9TdGVuY2lsT3B8S2VlcFN0ZW5jaWxPcHxSZXBsYWNlU3RlbmNpbE9wfEluY3JlbWVudFN0ZW5jaWxPcHxEZWNyZW1lbnRTdGVuY2lsT3B8SW5jcmVtZW50V3JhcFN0ZW5jaWxPcHxEZWNyZW1lbnRXcmFwU3RlbmNpbE9wfEludmVydFN0ZW5jaWxPcH0KICAgIAkJICogQGRlZmF1bHQgS2VlcFN0ZW5jaWxPcAogICAgCQkgKi8KICAgIAkJdGhpcy5zdGVuY2lsWlBhc3MgPSBLZWVwU3RlbmNpbE9wOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgc3RlbmNpbCBvcGVyYXRpb25zIGFyZSBwZXJmb3JtZWQgYWdhaW5zdCB0aGUgc3RlbmNpbCBidWZmZXIuIEluCiAgICAJCSAqIG9yZGVyIHRvIHBlcmZvcm0gd3JpdGVzIG9yIGNvbXBhcmlzb25zIGFnYWluc3QgdGhlIHN0ZW5jaWwgYnVmZmVyIHRoaXMKICAgIAkJICogdmFsdWUgbXVzdCBiZSBgdHJ1ZWAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5zdGVuY2lsV3JpdGUgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBVc2VyLWRlZmluZWQgY2xpcHBpbmcgcGxhbmVzIHNwZWNpZmllZCBhcyBUSFJFRS5QbGFuZSBvYmplY3RzIGluIHdvcmxkCiAgICAJCSAqIHNwYWNlLiBUaGVzZSBwbGFuZXMgYXBwbHkgdG8gdGhlIG9iamVjdHMgdGhpcyBtYXRlcmlhbCBpcyBhdHRhY2hlZCB0by4KICAgIAkJICogUG9pbnRzIGluIHNwYWNlIHdob3NlIHNpZ25lZCBkaXN0YW5jZSB0byB0aGUgcGxhbmUgaXMgbmVnYXRpdmUgYXJlIGNsaXBwZWQKICAgIAkJICogKG5vdCByZW5kZXJlZCkuIFRoaXMgcmVxdWlyZXMge0BsaW5rIFdlYkdMUmVuZGVyZXIjbG9jYWxDbGlwcGluZ0VuYWJsZWR9IHRvCiAgICAJCSAqIGJlIGB0cnVlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9BcnJheTxQbGFuZT59CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuY2xpcHBpbmdQbGFuZXMgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIENoYW5nZXMgdGhlIGJlaGF2aW9yIG9mIGNsaXBwaW5nIHBsYW5lcyBzbyB0aGF0IG9ubHkgdGhlaXIgaW50ZXJzZWN0aW9uIGlzCiAgICAJCSAqIGNsaXBwZWQsIHJhdGhlciB0aGFuIHRoZWlyIHVuaW9uLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuY2xpcEludGVyc2VjdGlvbiA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hldGhlciB0byBjbGlwIHNoYWRvd3MgYWNjb3JkaW5nIHRvIHRoZSBjbGlwcGluZyBwbGFuZXMgc3BlY2lmaWVkCiAgICAJCSAqIG9uIHRoaXMgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5jbGlwU2hhZG93cyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hpY2ggc2lkZSBvZiBmYWNlcyBjYXN0IHNoYWRvd3MuIElmIGBudWxsYCwgdGhlIHNpZGUgY2FzdGluZyBzaGFkb3dzCiAgICAJCSAqIGlzIGRldGVybWluZWQgYXMgZm9sbG93czoKICAgIAkJICoKICAgIAkJICogLSBXaGVuIHtAbGluayBNYXRlcmlhbCNzaWRlfSBpcyBzZXQgdG8gYEZyb250U2lkZWAsIHRoZSBiYWNrIHNpZGUgY2FzdCBzaGFkb3dzLgogICAgCQkgKiAtIFdoZW4ge0BsaW5rIE1hdGVyaWFsI3NpZGV9IGlzIHNldCB0byBgQmFja1NpZGVgLCB0aGUgZnJvbnQgc2lkZSBjYXN0IHNoYWRvd3MuCiAgICAJCSAqIC0gV2hlbiB7QGxpbmsgTWF0ZXJpYWwjc2lkZX0gaXMgc2V0IHRvIGBEb3VibGVTaWRlYCwgYm90aCBzaWRlcyBjYXN0IHNoYWRvd3MuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KEZyb250U2lkZXxCYWNrU2lkZXxEb3VibGVTaWRlKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5zaGFkb3dTaWRlID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIHJlbmRlciB0aGUgbWF0ZXJpYWwncyBjb2xvci4KICAgIAkJICoKICAgIAkJICogVGhpcyBjYW4gYmUgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIHtAbGluayBPYmplY3QzRCNyZW5kZXJPZGVyfSB0byBjcmVhdGUgaW52aXNpYmxlCiAgICAJCSAqIG9iamVjdHMgdGhhdCBvY2NsdWRlIG90aGVyIG9iamVjdHMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmNvbG9yV3JpdGUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIE92ZXJyaWRlIHRoZSByZW5kZXJlcidzIGRlZmF1bHQgcHJlY2lzaW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7PygnaGlnaHAnfCdtZWRpdW1wJ3wnbG93cCcpfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLnByZWNpc2lvbiA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byB1c2UgcG9seWdvbiBvZmZzZXQgb3Igbm90LiBXaGVuIGVuYWJsZWQsIGVhY2ggZnJhZ21lbnQncyBkZXB0aCB2YWx1ZSB3aWxsCiAgICAJCSAqIGJlIG9mZnNldCBhZnRlciBpdCBpcyBpbnRlcnBvbGF0ZWQgZnJvbSB0aGUgZGVwdGggdmFsdWVzIG9mIHRoZSBhcHByb3ByaWF0ZSB2ZXJ0aWNlcy4KICAgIAkJICogVGhlIG9mZnNldCBpcyBhZGRlZCBiZWZvcmUgdGhlIGRlcHRoIHRlc3QgaXMgcGVyZm9ybWVkIGFuZCBiZWZvcmUgdGhlIHZhbHVlIGlzIHdyaXR0ZW4KICAgIAkJICogaW50byB0aGUgZGVwdGggYnVmZmVyLgogICAgCQkgKgogICAgCQkgKiBDYW4gYmUgdXNlZnVsIGZvciByZW5kZXJpbmcgaGlkZGVuLWxpbmUgaW1hZ2VzLCBmb3IgYXBwbHlpbmcgZGVjYWxzIHRvIHN1cmZhY2VzLCBhbmQgZm9yCiAgICAJCSAqIHJlbmRlcmluZyBzb2xpZHMgd2l0aCBoaWdobGlnaHRlZCBlZGdlcy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLnBvbHlnb25PZmZzZXQgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBTcGVjaWZpZXMgYSBzY2FsZSBmYWN0b3IgdGhhdCBpcyB1c2VkIHRvIGNyZWF0ZSBhIHZhcmlhYmxlIGRlcHRoIG9mZnNldCBmb3IgZWFjaCBwb2x5Z29uLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgPSAwOwoKICAgIAkJLyoqCiAgICAJCSAqIElzIG11bHRpcGxpZWQgYnkgYW4gaW1wbGVtZW50YXRpb24tc3BlY2lmaWMgdmFsdWUgdG8gY3JlYXRlIGEgY29uc3RhbnQgZGVwdGggb2Zmc2V0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IDA7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0byBhcHBseSBkaXRoZXJpbmcgdG8gdGhlIGNvbG9yIHRvIHJlbW92ZSB0aGUgYXBwZWFyYW5jZSBvZiBiYW5kaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZGl0aGVyaW5nID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogV2hldGhlciBhbHBoYSB0byBjb3ZlcmFnZSBzaG91bGQgYmUgZW5hYmxlZCBvciBub3QuIENhbiBvbmx5IGJlIHVzZWQgd2l0aCBNU0FBLWVuYWJsZWQgY29udGV4dHMKICAgIAkJICogKG1lYW5pbmcgd2hlbiB0aGUgcmVuZGVyZXIgd2FzIGNyZWF0ZWQgd2l0aCAqYW50aWFsaWFzKiBwYXJhbWV0ZXIgc2V0IHRvIGB0cnVlYCkuIEVuYWJsaW5nIHRoaXMKICAgIAkJICogd2lsbCBzbW9vdGggYWxpYXNpbmcgb24gY2xpcCBwbGFuZSBlZGdlcyBhbmQgYWxwaGFUZXN0LWNsaXBwZWQgZWRnZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIHByZW11bHRpcGx5IHRoZSBhbHBoYSAodHJhbnNwYXJlbmN5KSB2YWx1ZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgZG91YmxlLXNpZGVkLCB0cmFuc3BhcmVudCBvYmplY3RzIHNob3VsZCBiZSByZW5kZXJlZCB3aXRoIGEgc2luZ2xlIHBhc3Mgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBUaGUgZW5naW5lIHJlbmRlcnMgZG91YmxlLXNpZGVkLCB0cmFuc3BhcmVudCBvYmplY3RzIHdpdGggdHdvIGRyYXcgY2FsbHMgKGJhY2sgZmFjZXMgZmlyc3QsCiAgICAJCSAqIHRoZW4gZnJvbnQgZmFjZXMpIHRvIG1pdGlnYXRlIHRyYW5zcGFyZW5jeSBhcnRpZmFjdHMuIFRoZXJlIGFyZSBzY2VuYXJpb3MgaG93ZXZlciB3aGVyZSB0aGlzCiAgICAJCSAqIGFwcHJvYWNoIHByb2R1Y2VzIG5vIHF1YWxpdHkgZ2FpbnMgYnV0IHN0aWxsIGRvdWJsZXMgZHJhdyBjYWxscyBlLmcuIHdoZW4gcmVuZGVyaW5nIGZsYXQKICAgIAkJICogdmVnZXRhdGlvbiBsaWtlIGdyYXNzIHNwcml0ZXMuIEluIHRoZXNlIGNhc2VzLCBzZXQgdGhlIGBmb3JjZVNpbmdsZVBhc3NgIGZsYWcgdG8gYHRydWVgIHRvCiAgICAJCSAqIGRpc2FibGUgdGhlIHR3byBwYXNzIHJlbmRlcmluZyB0byBhdm9pZCBwZXJmb3JtYW5jZSBpc3N1ZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5mb3JjZVNpbmdsZVBhc3MgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIGl0J3MgcG9zc2libGUgdG8gb3ZlcnJpZGUgdGhlIG1hdGVyaWFsIHdpdGgge0BsaW5rIFNjZW5lI292ZXJyaWRlTWF0ZXJpYWx9IG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuYWxsb3dPdmVycmlkZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB3aGV0aGVyIDNEIG9iamVjdHMgdXNpbmcgdGhpcyBtYXRlcmlhbCBhcmUgdmlzaWJsZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMudmlzaWJsZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgaXMgdG9uZSBtYXBwZWQgYWNjb3JkaW5nIHRvIHRoZSByZW5kZXJlcidzIHRvbmUgbWFwcGluZyBzZXR0aW5nLgogICAgCQkgKgogICAgCQkgKiBJdCBpcyBpZ25vcmVkIHdoZW4gcmVuZGVyaW5nIHRvIGEgcmVuZGVyIHRhcmdldCBvciB1c2luZyBwb3N0IHByb2Nlc3Npbmcgb3Igd2hlbiB1c2luZwogICAgCQkgKiBgV2ViR1BVUmVuZGVyZXJgLiBJbiBhbGwgdGhlc2UgY2FzZXMsIGFsbCBtYXRlcmlhbHMgYXJlIGhvbm9yZWQgYnkgdG9uZSBtYXBwaW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy50b25lTWFwcGVkID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9yZSBjdXN0b20gZGF0YSBhYm91dCB0aGUgTWF0ZXJpYWwuIEl0CiAgICAJCSAqIHNob3VsZCBub3QgaG9sZCByZWZlcmVuY2VzIHRvIGZ1bmN0aW9ucyBhcyB0aGVzZSB3aWxsIG5vdCBiZSBjbG9uZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLnVzZXJEYXRhID0ge307CgogICAgCQkvKioKICAgIAkJICogVGhpcyBzdGFydHMgYXQgYDBgIGFuZCBjb3VudHMgaG93IG1hbnkgdGltZXMge0BsaW5rIE1hdGVyaWFsI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy52ZXJzaW9uID0gMDsKCiAgICAJCXRoaXMuX2FscGhhVGVzdCA9IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgYWxwaGEgdmFsdWUgdG8gYmUgdXNlZCB3aGVuIHJ1bm5pbmcgYW4gYWxwaGEgdGVzdC4gVGhlIG1hdGVyaWFsCiAgICAJICogd2lsbCBub3QgYmUgcmVuZGVyZWQgaWYgdGhlIG9wYWNpdHkgaXMgbG93ZXIgdGhhbiB0aGlzIHZhbHVlLgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAcmVhZG9ubHkKICAgIAkgKiBAZGVmYXVsdCAwCiAgICAJICovCiAgICAJZ2V0IGFscGhhVGVzdCgpIHsKCiAgICAJCXJldHVybiB0aGlzLl9hbHBoYVRlc3Q7CgogICAgCX0KCiAgICAJc2V0IGFscGhhVGVzdCggdmFsdWUgKSB7CgogICAgCQlpZiAoIHRoaXMuX2FscGhhVGVzdCA+IDAgIT09IHZhbHVlID4gMCApIHsKCiAgICAJCQl0aGlzLnZlcnNpb24gKys7CgogICAgCQl9CgogICAgCQl0aGlzLl9hbHBoYVRlc3QgPSB2YWx1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBbiBvcHRpb25hbCBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGJlZm9yZSB0aGUgbWF0ZXJpYWwgaXMgdXNlZCB0byByZW5kZXIgYSAzRCBvYmplY3QuCiAgICAJICoKICAgIAkgKiBUaGlzIG1ldGhvZCBjYW4gb25seSBiZSB1c2VkIHdoZW4gcmVuZGVyaW5nIHdpdGgge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge1NjZW5lfSBzY2VuZSAtIFRoZSBzY2VuZS4KICAgIAkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBzY2VuZS4KICAgIAkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBnZW9tZXRyeSAtIFRoZSAzRCBvYmplY3QncyBnZW9tZXRyeS4KICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0LgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBncm91cCAtIFRoZSBnZW9tZXRyeSBncm91cCBkYXRhLgogICAgCSAqLwogICAgCW9uQmVmb3JlUmVuZGVyKCAvKiByZW5kZXJlciwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG9iamVjdCwgZ3JvdXAgKi8gKSB7fQoKICAgIAkvKioKICAgIAkgKiBBbiBvcHRpb25hbCBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGJlZm9yZSB0aGUgc2hhZGVyCiAgICAJICogcHJvZ3JhbSBpcyBjb21waWxlZC4gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgd2l0aCB0aGUgc2hhZGVyIHNvdXJjZSBjb2RlCiAgICAJICogYXMgYSBwYXJhbWV0ZXIuIFVzZWZ1bCBmb3IgdGhlIG1vZGlmaWNhdGlvbiBvZiBidWlsdC1pbiBtYXRlcmlhbHMuCiAgICAJICoKICAgIAkgKiBUaGlzIG1ldGhvZCBjYW4gb25seSBiZSB1c2VkIHdoZW4gcmVuZGVyaW5nIHdpdGgge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LiBUaGUKICAgIAkgKiByZWNvbW1lbmRlZCBhcHByb2FjaCB3aGVuIGN1c3RvbWl6aW5nIG1hdGVyaWFscyBpcyB0byB1c2UgYFdlYkdQVVJlbmRlcmVyYCB3aXRoIHRoZSBuZXcKICAgIAkgKiBOb2RlIE1hdGVyaWFsIHN5c3RlbSBhbmQgW1RTTF17QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy93aWtpL1RocmVlLmpzLVNoYWRpbmctTGFuZ3VhZ2V9LgogICAgCSAqCiAgICAJICogQHBhcmFtIHt7dmVydGV4U2hhZGVyOnN0cmluZyxmcmFnbWVudFNoYWRlcjpzdHJpbmcsdW5pZm9ybXM6T2JqZWN0fX0gc2hhZGVyb2JqZWN0IC0gVGhlIG9iamVjdCBob2xkcyB0aGUgdW5pZm9ybXMgYW5kIHRoZSB2ZXJ0ZXggYW5kIGZyYWdtZW50IHNoYWRlciBzb3VyY2UuCiAgICAJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIEEgcmVmZXJlbmNlIHRvIHRoZSByZW5kZXJlci4KICAgIAkgKi8KICAgIAlvbkJlZm9yZUNvbXBpbGUoIC8qIHNoYWRlcm9iamVjdCwgcmVuZGVyZXIgKi8gKSB7fQoKICAgIAkvKioKICAgIAkgKiBJbiBjYXNlIHtAbGluayBNYXRlcmlhbCNvbkJlZm9yZUNvbXBpbGV9IGlzIHVzZWQsIHRoaXMgY2FsbGJhY2sgY2FuIGJlIHVzZWQgdG8gaWRlbnRpZnkKICAgIAkgKiB2YWx1ZXMgb2Ygc2V0dGluZ3MgdXNlZCBpbiBgb25CZWZvcmVDb21waWxlKClgLCBzbyB0aHJlZS5qcyBjYW4gcmV1c2UgYSBjYWNoZWQKICAgIAkgKiBzaGFkZXIgb3IgcmVjb21waWxlIHRoZSBzaGFkZXIgZm9yIHRoaXMgbWF0ZXJpYWwgYXMgbmVlZGVkLgogICAgCSAqCiAgICAJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGN1c3RvbSBwcm9ncmFtIGNhY2hlIGtleS4KICAgIAkgKi8KICAgIAljdXN0b21Qcm9ncmFtQ2FjaGVLZXkoKSB7CgogICAgCQlyZXR1cm4gdGhpcy5vbkJlZm9yZUNvbXBpbGUudG9TdHJpbmcoKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byBzZXQgZGVmYXVsdCB2YWx1ZXMgZnJvbSBwYXJhbWV0ZXIgb2JqZWN0cy4KICAgIAkgKiBJdCBpcyBhIGdlbmVyaWMgaW1wbGVtZW50YXRpb24gc28gaXQgY2FuIGJlIHVzZWQgd2l0aCBkaWZmZXJlbnQgdHlwZXMKICAgIAkgKiBvZiBtYXRlcmlhbHMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0gW3ZhbHVlc10gLSBUaGUgbWF0ZXJpYWwgdmFsdWVzIHRvIHNldC4KICAgIAkgKi8KICAgIAlzZXRWYWx1ZXMoIHZhbHVlcyApIHsKCiAgICAJCWlmICggdmFsdWVzID09PSB1bmRlZmluZWQgKSByZXR1cm47CgogICAgCQlmb3IgKCBjb25zdCBrZXkgaW4gdmFsdWVzICkgewoKICAgIAkJCWNvbnN0IG5ld1ZhbHVlID0gdmFsdWVzWyBrZXkgXTsKCiAgICAJCQlpZiAoIG5ld1ZhbHVlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk1hdGVyaWFsOiBwYXJhbWV0ZXIgJyR7IGtleSB9JyBoYXMgdmFsdWUgb2YgdW5kZWZpbmVkLmAgKTsKICAgIAkJCQljb250aW51ZTsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgY3VycmVudFZhbHVlID0gdGhpc1sga2V5IF07CgogICAgCQkJaWYgKCBjdXJyZW50VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCBgVEhSRUUuTWF0ZXJpYWw6ICckeyBrZXkgfScgaXMgbm90IGEgcHJvcGVydHkgb2YgVEhSRUUuJHsgdGhpcy50eXBlIH0uYCApOwogICAgCQkJCWNvbnRpbnVlOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGN1cnJlbnRWYWx1ZSAmJiBjdXJyZW50VmFsdWUuaXNDb2xvciApIHsKCiAgICAJCQkJY3VycmVudFZhbHVlLnNldCggbmV3VmFsdWUgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCAoIGN1cnJlbnRWYWx1ZSAmJiBjdXJyZW50VmFsdWUuaXNWZWN0b3IzICkgJiYgKCBuZXdWYWx1ZSAmJiBuZXdWYWx1ZS5pc1ZlY3RvcjMgKSApIHsKCiAgICAJCQkJY3VycmVudFZhbHVlLmNvcHkoIG5ld1ZhbHVlICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJdGhpc1sga2V5IF0gPSBuZXdWYWx1ZTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2VyaWFsaXplcyB0aGUgbWF0ZXJpYWwgaW50byBKU09OLgogICAgCSAqCiAgICAJICogQHBhcmFtIHs/KE9iamVjdHxzdHJpbmcpfSBtZXRhIC0gQW4gb3B0aW9uYWwgdmFsdWUgaG9sZGluZyBtZXRhIGluZm9ybWF0aW9uIGFib3V0IHRoZSBzZXJpYWxpemF0aW9uLgogICAgCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgbWF0ZXJpYWwuCiAgICAJICogQHNlZSB7QGxpbmsgT2JqZWN0TG9hZGVyI3BhcnNlfQogICAgCSAqLwogICAgCXRvSlNPTiggbWV0YSApIHsKCiAgICAJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKICAgIAkJaWYgKCBpc1Jvb3RPYmplY3QgKSB7CgogICAgCQkJbWV0YSA9IHsKICAgIAkJCQl0ZXh0dXJlczoge30sCiAgICAJCQkJaW1hZ2VzOiB7fQogICAgCQkJfTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGRhdGEgPSB7CiAgICAJCQltZXRhZGF0YTogewogICAgCQkJCXZlcnNpb246IDQuNywKICAgIAkJCQl0eXBlOiAnTWF0ZXJpYWwnLAogICAgCQkJCWdlbmVyYXRvcjogJ01hdGVyaWFsLnRvSlNPTicKICAgIAkJCX0KICAgIAkJfTsKCiAgICAJCS8vIHN0YW5kYXJkIE1hdGVyaWFsIHNlcmlhbGl6YXRpb24KICAgIAkJZGF0YS51dWlkID0gdGhpcy51dWlkOwogICAgCQlkYXRhLnR5cGUgPSB0aGlzLnR5cGU7CgogICAgCQlpZiAoIHRoaXMubmFtZSAhPT0gJycgKSBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CgogICAgCQlpZiAoIHRoaXMuY29sb3IgJiYgdGhpcy5jb2xvci5pc0NvbG9yICkgZGF0YS5jb2xvciA9IHRoaXMuY29sb3IuZ2V0SGV4KCk7CgogICAgCQlpZiAoIHRoaXMucm91Z2huZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnJvdWdobmVzcyA9IHRoaXMucm91Z2huZXNzOwogICAgCQlpZiAoIHRoaXMubWV0YWxuZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLm1ldGFsbmVzcyA9IHRoaXMubWV0YWxuZXNzOwoKICAgIAkJaWYgKCB0aGlzLnNoZWVuICE9PSB1bmRlZmluZWQgKSBkYXRhLnNoZWVuID0gdGhpcy5zaGVlbjsKICAgIAkJaWYgKCB0aGlzLnNoZWVuQ29sb3IgJiYgdGhpcy5zaGVlbkNvbG9yLmlzQ29sb3IgKSBkYXRhLnNoZWVuQ29sb3IgPSB0aGlzLnNoZWVuQ29sb3IuZ2V0SGV4KCk7CiAgICAJCWlmICggdGhpcy5zaGVlblJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaGVlblJvdWdobmVzcyA9IHRoaXMuc2hlZW5Sb3VnaG5lc3M7CiAgICAJCWlmICggdGhpcy5lbWlzc2l2ZSAmJiB0aGlzLmVtaXNzaXZlLmlzQ29sb3IgKSBkYXRhLmVtaXNzaXZlID0gdGhpcy5lbWlzc2l2ZS5nZXRIZXgoKTsKICAgIAkJaWYgKCB0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAhPT0gMSApIGRhdGEuZW1pc3NpdmVJbnRlbnNpdHkgPSB0aGlzLmVtaXNzaXZlSW50ZW5zaXR5OwoKICAgIAkJaWYgKCB0aGlzLnNwZWN1bGFyICYmIHRoaXMuc3BlY3VsYXIuaXNDb2xvciApIGRhdGEuc3BlY3VsYXIgPSB0aGlzLnNwZWN1bGFyLmdldEhleCgpOwogICAgCQlpZiAoIHRoaXMuc3BlY3VsYXJJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuc3BlY3VsYXJJbnRlbnNpdHkgPSB0aGlzLnNwZWN1bGFySW50ZW5zaXR5OwogICAgCQlpZiAoIHRoaXMuc3BlY3VsYXJDb2xvciAmJiB0aGlzLnNwZWN1bGFyQ29sb3IuaXNDb2xvciApIGRhdGEuc3BlY3VsYXJDb2xvciA9IHRoaXMuc3BlY3VsYXJDb2xvci5nZXRIZXgoKTsKICAgIAkJaWYgKCB0aGlzLnNoaW5pbmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaGluaW5lc3MgPSB0aGlzLnNoaW5pbmVzczsKICAgIAkJaWYgKCB0aGlzLmNsZWFyY29hdCAhPT0gdW5kZWZpbmVkICkgZGF0YS5jbGVhcmNvYXQgPSB0aGlzLmNsZWFyY29hdDsKICAgIAkJaWYgKCB0aGlzLmNsZWFyY29hdFJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5jbGVhcmNvYXRSb3VnaG5lc3MgPSB0aGlzLmNsZWFyY29hdFJvdWdobmVzczsKCiAgICAJCWlmICggdGhpcy5jbGVhcmNvYXRNYXAgJiYgdGhpcy5jbGVhcmNvYXRNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuY2xlYXJjb2F0TWFwID0gdGhpcy5jbGVhcmNvYXRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgJiYgdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuY2xlYXJjb2F0Um91Z2huZXNzTWFwID0gdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAgJiYgdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuY2xlYXJjb2F0Tm9ybWFsTWFwID0gdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJCWRhdGEuY2xlYXJjb2F0Tm9ybWFsU2NhbGUgPSB0aGlzLmNsZWFyY29hdE5vcm1hbFNjYWxlLnRvQXJyYXkoKTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5kaXNwZXJzaW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmRpc3BlcnNpb24gPSB0aGlzLmRpc3BlcnNpb247CgogICAgCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2UgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2UgPSB0aGlzLmlyaWRlc2NlbmNlOwogICAgCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2VJT1IgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2VJT1IgPSB0aGlzLmlyaWRlc2NlbmNlSU9SOwogICAgCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlID0gdGhpcy5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlOwoKICAgIAkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlTWFwICYmIHRoaXMuaXJpZGVzY2VuY2VNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuaXJpZGVzY2VuY2VNYXAgPSB0aGlzLmlyaWRlc2NlbmNlTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgJiYgdGhpcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC5pc1RleHR1cmUgKSB7CgogICAgCQkJZGF0YS5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCA9IHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSBkYXRhLmFuaXNvdHJvcHkgPSB0aGlzLmFuaXNvdHJvcHk7CiAgICAJCWlmICggdGhpcy5hbmlzb3Ryb3B5Um90YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuYW5pc290cm9weVJvdGF0aW9uID0gdGhpcy5hbmlzb3Ryb3B5Um90YXRpb247CgogICAgCQlpZiAoIHRoaXMuYW5pc290cm9weU1hcCAmJiB0aGlzLmFuaXNvdHJvcHlNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuYW5pc290cm9weU1hcCA9IHRoaXMuYW5pc290cm9weU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLm1hcCAmJiB0aGlzLm1hcC5pc1RleHR1cmUgKSBkYXRhLm1hcCA9IHRoaXMubWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCWlmICggdGhpcy5tYXRjYXAgJiYgdGhpcy5tYXRjYXAuaXNUZXh0dXJlICkgZGF0YS5tYXRjYXAgPSB0aGlzLm1hdGNhcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQlpZiAoIHRoaXMuYWxwaGFNYXAgJiYgdGhpcy5hbHBoYU1hcC5pc1RleHR1cmUgKSBkYXRhLmFscGhhTWFwID0gdGhpcy5hbHBoYU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJaWYgKCB0aGlzLmxpZ2h0TWFwICYmIHRoaXMubGlnaHRNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEubGlnaHRNYXAgPSB0aGlzLmxpZ2h0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCQlkYXRhLmxpZ2h0TWFwSW50ZW5zaXR5ID0gdGhpcy5saWdodE1hcEludGVuc2l0eTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5hb01hcCAmJiB0aGlzLmFvTWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmFvTWFwID0gdGhpcy5hb01hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQkJZGF0YS5hb01hcEludGVuc2l0eSA9IHRoaXMuYW9NYXBJbnRlbnNpdHk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuYnVtcE1hcCAmJiB0aGlzLmJ1bXBNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuYnVtcE1hcCA9IHRoaXMuYnVtcE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQkJZGF0YS5idW1wU2NhbGUgPSB0aGlzLmJ1bXBTY2FsZTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5ub3JtYWxNYXAgJiYgdGhpcy5ub3JtYWxNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEubm9ybWFsTWFwID0gdGhpcy5ub3JtYWxNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJCWRhdGEubm9ybWFsTWFwVHlwZSA9IHRoaXMubm9ybWFsTWFwVHlwZTsKICAgIAkJCWRhdGEubm9ybWFsU2NhbGUgPSB0aGlzLm5vcm1hbFNjYWxlLnRvQXJyYXkoKTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5kaXNwbGFjZW1lbnRNYXAgJiYgdGhpcy5kaXNwbGFjZW1lbnRNYXAuaXNUZXh0dXJlICkgewoKICAgIAkJCWRhdGEuZGlzcGxhY2VtZW50TWFwID0gdGhpcy5kaXNwbGFjZW1lbnRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJCWRhdGEuZGlzcGxhY2VtZW50U2NhbGUgPSB0aGlzLmRpc3BsYWNlbWVudFNjYWxlOwogICAgCQkJZGF0YS5kaXNwbGFjZW1lbnRCaWFzID0gdGhpcy5kaXNwbGFjZW1lbnRCaWFzOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLnJvdWdobmVzc01hcCAmJiB0aGlzLnJvdWdobmVzc01hcC5pc1RleHR1cmUgKSBkYXRhLnJvdWdobmVzc01hcCA9IHRoaXMucm91Z2huZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCWlmICggdGhpcy5tZXRhbG5lc3NNYXAgJiYgdGhpcy5tZXRhbG5lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS5tZXRhbG5lc3NNYXAgPSB0aGlzLm1ldGFsbmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJaWYgKCB0aGlzLmVtaXNzaXZlTWFwICYmIHRoaXMuZW1pc3NpdmVNYXAuaXNUZXh0dXJlICkgZGF0YS5lbWlzc2l2ZU1hcCA9IHRoaXMuZW1pc3NpdmVNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJaWYgKCB0aGlzLnNwZWN1bGFyTWFwICYmIHRoaXMuc3BlY3VsYXJNYXAuaXNUZXh0dXJlICkgZGF0YS5zcGVjdWxhck1hcCA9IHRoaXMuc3BlY3VsYXJNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJaWYgKCB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwICYmIHRoaXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAuaXNUZXh0dXJlICkgZGF0YS5zcGVjdWxhckludGVuc2l0eU1hcCA9IHRoaXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAudG9KU09OKCBtZXRhICkudXVpZDsKICAgIAkJaWYgKCB0aGlzLnNwZWN1bGFyQ29sb3JNYXAgJiYgdGhpcy5zcGVjdWxhckNvbG9yTWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJDb2xvck1hcCA9IHRoaXMuc3BlY3VsYXJDb2xvck1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJaWYgKCB0aGlzLmVudk1hcCAmJiB0aGlzLmVudk1hcC5pc1RleHR1cmUgKSB7CgogICAgCQkJZGF0YS5lbnZNYXAgPSB0aGlzLmVudk1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJCWlmICggdGhpcy5jb21iaW5lICE9PSB1bmRlZmluZWQgKSBkYXRhLmNvbWJpbmUgPSB0aGlzLmNvbWJpbmU7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuZW52TWFwUm90YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuZW52TWFwUm90YXRpb24gPSB0aGlzLmVudk1hcFJvdGF0aW9uLnRvQXJyYXkoKTsKICAgIAkJaWYgKCB0aGlzLmVudk1hcEludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgZGF0YS5lbnZNYXBJbnRlbnNpdHkgPSB0aGlzLmVudk1hcEludGVuc2l0eTsKICAgIAkJaWYgKCB0aGlzLnJlZmxlY3Rpdml0eSAhPT0gdW5kZWZpbmVkICkgZGF0YS5yZWZsZWN0aXZpdHkgPSB0aGlzLnJlZmxlY3Rpdml0eTsKICAgIAkJaWYgKCB0aGlzLnJlZnJhY3Rpb25SYXRpbyAhPT0gdW5kZWZpbmVkICkgZGF0YS5yZWZyYWN0aW9uUmF0aW8gPSB0aGlzLnJlZnJhY3Rpb25SYXRpbzsKCiAgICAJCWlmICggdGhpcy5ncmFkaWVudE1hcCAmJiB0aGlzLmdyYWRpZW50TWFwLmlzVGV4dHVyZSApIHsKCiAgICAJCQlkYXRhLmdyYWRpZW50TWFwID0gdGhpcy5ncmFkaWVudE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKICAgIAkJfQoKICAgIAkJaWYgKCB0aGlzLnRyYW5zbWlzc2lvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS50cmFuc21pc3Npb24gPSB0aGlzLnRyYW5zbWlzc2lvbjsKICAgIAkJaWYgKCB0aGlzLnRyYW5zbWlzc2lvbk1hcCAmJiB0aGlzLnRyYW5zbWlzc2lvbk1hcC5pc1RleHR1cmUgKSBkYXRhLnRyYW5zbWlzc2lvbk1hcCA9IHRoaXMudHJhbnNtaXNzaW9uTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CiAgICAJCWlmICggdGhpcy50aGlja25lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEudGhpY2tuZXNzID0gdGhpcy50aGlja25lc3M7CiAgICAJCWlmICggdGhpcy50aGlja25lc3NNYXAgJiYgdGhpcy50aGlja25lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS50aGlja25lc3NNYXAgPSB0aGlzLnRoaWNrbmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwogICAgCQlpZiAoIHRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSAhPT0gSW5maW5pdHkgKSBkYXRhLmF0dGVudWF0aW9uRGlzdGFuY2UgPSB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2U7CiAgICAJCWlmICggdGhpcy5hdHRlbnVhdGlvbkNvbG9yICE9PSB1bmRlZmluZWQgKSBkYXRhLmF0dGVudWF0aW9uQ29sb3IgPSB0aGlzLmF0dGVudWF0aW9uQ29sb3IuZ2V0SGV4KCk7CgogICAgCQlpZiAoIHRoaXMuc2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaXplID0gdGhpcy5zaXplOwogICAgCQlpZiAoIHRoaXMuc2hhZG93U2lkZSAhPT0gbnVsbCApIGRhdGEuc2hhZG93U2lkZSA9IHRoaXMuc2hhZG93U2lkZTsKICAgIAkJaWYgKCB0aGlzLnNpemVBdHRlbnVhdGlvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaXplQXR0ZW51YXRpb24gPSB0aGlzLnNpemVBdHRlbnVhdGlvbjsKCiAgICAJCWlmICggdGhpcy5ibGVuZGluZyAhPT0gTm9ybWFsQmxlbmRpbmcgKSBkYXRhLmJsZW5kaW5nID0gdGhpcy5ibGVuZGluZzsKICAgIAkJaWYgKCB0aGlzLnNpZGUgIT09IEZyb250U2lkZSApIGRhdGEuc2lkZSA9IHRoaXMuc2lkZTsKICAgIAkJaWYgKCB0aGlzLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSApIGRhdGEudmVydGV4Q29sb3JzID0gdHJ1ZTsKCiAgICAJCWlmICggdGhpcy5vcGFjaXR5IDwgMSApIGRhdGEub3BhY2l0eSA9IHRoaXMub3BhY2l0eTsKICAgIAkJaWYgKCB0aGlzLnRyYW5zcGFyZW50ID09PSB0cnVlICkgZGF0YS50cmFuc3BhcmVudCA9IHRydWU7CgogICAgCQlpZiAoIHRoaXMuYmxlbmRTcmMgIT09IFNyY0FscGhhRmFjdG9yICkgZGF0YS5ibGVuZFNyYyA9IHRoaXMuYmxlbmRTcmM7CiAgICAJCWlmICggdGhpcy5ibGVuZERzdCAhPT0gT25lTWludXNTcmNBbHBoYUZhY3RvciApIGRhdGEuYmxlbmREc3QgPSB0aGlzLmJsZW5kRHN0OwogICAgCQlpZiAoIHRoaXMuYmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gKSBkYXRhLmJsZW5kRXF1YXRpb24gPSB0aGlzLmJsZW5kRXF1YXRpb247CiAgICAJCWlmICggdGhpcy5ibGVuZFNyY0FscGhhICE9PSBudWxsICkgZGF0YS5ibGVuZFNyY0FscGhhID0gdGhpcy5ibGVuZFNyY0FscGhhOwogICAgCQlpZiAoIHRoaXMuYmxlbmREc3RBbHBoYSAhPT0gbnVsbCApIGRhdGEuYmxlbmREc3RBbHBoYSA9IHRoaXMuYmxlbmREc3RBbHBoYTsKICAgIAkJaWYgKCB0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSAhPT0gbnVsbCApIGRhdGEuYmxlbmRFcXVhdGlvbkFscGhhID0gdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGE7CiAgICAJCWlmICggdGhpcy5ibGVuZENvbG9yICYmIHRoaXMuYmxlbmRDb2xvci5pc0NvbG9yICkgZGF0YS5ibGVuZENvbG9yID0gdGhpcy5ibGVuZENvbG9yLmdldEhleCgpOwogICAgCQlpZiAoIHRoaXMuYmxlbmRBbHBoYSAhPT0gMCApIGRhdGEuYmxlbmRBbHBoYSA9IHRoaXMuYmxlbmRBbHBoYTsKCiAgICAJCWlmICggdGhpcy5kZXB0aEZ1bmMgIT09IExlc3NFcXVhbERlcHRoICkgZGF0YS5kZXB0aEZ1bmMgPSB0aGlzLmRlcHRoRnVuYzsKICAgIAkJaWYgKCB0aGlzLmRlcHRoVGVzdCA9PT0gZmFsc2UgKSBkYXRhLmRlcHRoVGVzdCA9IHRoaXMuZGVwdGhUZXN0OwogICAgCQlpZiAoIHRoaXMuZGVwdGhXcml0ZSA9PT0gZmFsc2UgKSBkYXRhLmRlcHRoV3JpdGUgPSB0aGlzLmRlcHRoV3JpdGU7CiAgICAJCWlmICggdGhpcy5jb2xvcldyaXRlID09PSBmYWxzZSApIGRhdGEuY29sb3JXcml0ZSA9IHRoaXMuY29sb3JXcml0ZTsKCiAgICAJCWlmICggdGhpcy5zdGVuY2lsV3JpdGVNYXNrICE9PSAweGZmICkgZGF0YS5zdGVuY2lsV3JpdGVNYXNrID0gdGhpcy5zdGVuY2lsV3JpdGVNYXNrOwogICAgCQlpZiAoIHRoaXMuc3RlbmNpbEZ1bmMgIT09IEFsd2F5c1N0ZW5jaWxGdW5jICkgZGF0YS5zdGVuY2lsRnVuYyA9IHRoaXMuc3RlbmNpbEZ1bmM7CiAgICAJCWlmICggdGhpcy5zdGVuY2lsUmVmICE9PSAwICkgZGF0YS5zdGVuY2lsUmVmID0gdGhpcy5zdGVuY2lsUmVmOwogICAgCQlpZiAoIHRoaXMuc3RlbmNpbEZ1bmNNYXNrICE9PSAweGZmICkgZGF0YS5zdGVuY2lsRnVuY01hc2sgPSB0aGlzLnN0ZW5jaWxGdW5jTWFzazsKICAgIAkJaWYgKCB0aGlzLnN0ZW5jaWxGYWlsICE9PSBLZWVwU3RlbmNpbE9wICkgZGF0YS5zdGVuY2lsRmFpbCA9IHRoaXMuc3RlbmNpbEZhaWw7CiAgICAJCWlmICggdGhpcy5zdGVuY2lsWkZhaWwgIT09IEtlZXBTdGVuY2lsT3AgKSBkYXRhLnN0ZW5jaWxaRmFpbCA9IHRoaXMuc3RlbmNpbFpGYWlsOwogICAgCQlpZiAoIHRoaXMuc3RlbmNpbFpQYXNzICE9PSBLZWVwU3RlbmNpbE9wICkgZGF0YS5zdGVuY2lsWlBhc3MgPSB0aGlzLnN0ZW5jaWxaUGFzczsKICAgIAkJaWYgKCB0aGlzLnN0ZW5jaWxXcml0ZSA9PT0gdHJ1ZSApIGRhdGEuc3RlbmNpbFdyaXRlID0gdGhpcy5zdGVuY2lsV3JpdGU7CgogICAgCQkvLyByb3RhdGlvbiAoU3ByaXRlTWF0ZXJpYWwpCiAgICAJCWlmICggdGhpcy5yb3RhdGlvbiAhPT0gdW5kZWZpbmVkICYmIHRoaXMucm90YXRpb24gIT09IDAgKSBkYXRhLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKCiAgICAJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0ID09PSB0cnVlICkgZGF0YS5wb2x5Z29uT2Zmc2V0ID0gdHJ1ZTsKICAgIAkJaWYgKCB0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgIT09IDAgKSBkYXRhLnBvbHlnb25PZmZzZXRGYWN0b3IgPSB0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3I7CiAgICAJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgIT09IDAgKSBkYXRhLnBvbHlnb25PZmZzZXRVbml0cyA9IHRoaXMucG9seWdvbk9mZnNldFVuaXRzOwoKICAgIAkJaWYgKCB0aGlzLmxpbmV3aWR0aCAhPT0gdW5kZWZpbmVkICYmIHRoaXMubGluZXdpZHRoICE9PSAxICkgZGF0YS5saW5ld2lkdGggPSB0aGlzLmxpbmV3aWR0aDsKICAgIAkJaWYgKCB0aGlzLmRhc2hTaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLmRhc2hTaXplID0gdGhpcy5kYXNoU2l6ZTsKICAgIAkJaWYgKCB0aGlzLmdhcFNpemUgIT09IHVuZGVmaW5lZCApIGRhdGEuZ2FwU2l6ZSA9IHRoaXMuZ2FwU2l6ZTsKICAgIAkJaWYgKCB0aGlzLnNjYWxlICE9PSB1bmRlZmluZWQgKSBkYXRhLnNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAJCWlmICggdGhpcy5kaXRoZXJpbmcgPT09IHRydWUgKSBkYXRhLmRpdGhlcmluZyA9IHRydWU7CgogICAgCQlpZiAoIHRoaXMuYWxwaGFUZXN0ID4gMCApIGRhdGEuYWxwaGFUZXN0ID0gdGhpcy5hbHBoYVRlc3Q7CiAgICAJCWlmICggdGhpcy5hbHBoYUhhc2ggPT09IHRydWUgKSBkYXRhLmFscGhhSGFzaCA9IHRydWU7CiAgICAJCWlmICggdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSBkYXRhLmFscGhhVG9Db3ZlcmFnZSA9IHRydWU7CiAgICAJCWlmICggdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPT09IHRydWUgKSBkYXRhLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWU7CiAgICAJCWlmICggdGhpcy5mb3JjZVNpbmdsZVBhc3MgPT09IHRydWUgKSBkYXRhLmZvcmNlU2luZ2xlUGFzcyA9IHRydWU7CgogICAgCQlpZiAoIHRoaXMud2lyZWZyYW1lID09PSB0cnVlICkgZGF0YS53aXJlZnJhbWUgPSB0cnVlOwogICAgCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID4gMSApIGRhdGEud2lyZWZyYW1lTGluZXdpZHRoID0gdGhpcy53aXJlZnJhbWVMaW5ld2lkdGg7CiAgICAJCWlmICggdGhpcy53aXJlZnJhbWVMaW5lY2FwICE9PSAncm91bmQnICkgZGF0YS53aXJlZnJhbWVMaW5lY2FwID0gdGhpcy53aXJlZnJhbWVMaW5lY2FwOwogICAgCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWpvaW4gIT09ICdyb3VuZCcgKSBkYXRhLndpcmVmcmFtZUxpbmVqb2luID0gdGhpcy53aXJlZnJhbWVMaW5lam9pbjsKCiAgICAJCWlmICggdGhpcy5mbGF0U2hhZGluZyA9PT0gdHJ1ZSApIGRhdGEuZmxhdFNoYWRpbmcgPSB0cnVlOwoKICAgIAkJaWYgKCB0aGlzLnZpc2libGUgPT09IGZhbHNlICkgZGF0YS52aXNpYmxlID0gZmFsc2U7CgogICAgCQlpZiAoIHRoaXMudG9uZU1hcHBlZCA9PT0gZmFsc2UgKSBkYXRhLnRvbmVNYXBwZWQgPSBmYWxzZTsKCiAgICAJCWlmICggdGhpcy5mb2cgPT09IGZhbHNlICkgZGF0YS5mb2cgPSBmYWxzZTsKCiAgICAJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgZGF0YS51c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7CgogICAgCQkvLyBUT0RPOiBDb3BpZWQgZnJvbSBPYmplY3QzRC50b0pTT04KCiAgICAJCWZ1bmN0aW9uIGV4dHJhY3RGcm9tQ2FjaGUoIGNhY2hlICkgewoKICAgIAkJCWNvbnN0IHZhbHVlcyA9IFtdOwoKICAgIAkJCWZvciAoIGNvbnN0IGtleSBpbiBjYWNoZSApIHsKCiAgICAJCQkJY29uc3QgZGF0YSA9IGNhY2hlWyBrZXkgXTsKICAgIAkJCQlkZWxldGUgZGF0YS5tZXRhZGF0YTsKICAgIAkJCQl2YWx1ZXMucHVzaCggZGF0YSApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdmFsdWVzOwoKICAgIAkJfQoKICAgIAkJaWYgKCBpc1Jvb3RPYmplY3QgKSB7CgogICAgCQkJY29uc3QgdGV4dHVyZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLnRleHR1cmVzICk7CiAgICAJCQljb25zdCBpbWFnZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmltYWdlcyApOwoKICAgIAkJCWlmICggdGV4dHVyZXMubGVuZ3RoID4gMCApIGRhdGEudGV4dHVyZXMgPSB0ZXh0dXJlczsKICAgIAkJCWlmICggaW1hZ2VzLmxlbmd0aCA+IDAgKSBkYXRhLmltYWdlcyA9IGltYWdlczsKCiAgICAJCX0KCiAgICAJCXJldHVybiBkYXRhOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgbWF0ZXJpYWwgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge01hdGVyaWFsfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIG1hdGVyaWFsIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdGVyaWFsfSBzb3VyY2UgLSBUaGUgbWF0ZXJpYWwgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtNYXRlcmlhbH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCiAgICAJCXRoaXMuYmxlbmRpbmcgPSBzb3VyY2UuYmxlbmRpbmc7CiAgICAJCXRoaXMuc2lkZSA9IHNvdXJjZS5zaWRlOwogICAgCQl0aGlzLnZlcnRleENvbG9ycyA9IHNvdXJjZS52ZXJ0ZXhDb2xvcnM7CgogICAgCQl0aGlzLm9wYWNpdHkgPSBzb3VyY2Uub3BhY2l0eTsKICAgIAkJdGhpcy50cmFuc3BhcmVudCA9IHNvdXJjZS50cmFuc3BhcmVudDsKCiAgICAJCXRoaXMuYmxlbmRTcmMgPSBzb3VyY2UuYmxlbmRTcmM7CiAgICAJCXRoaXMuYmxlbmREc3QgPSBzb3VyY2UuYmxlbmREc3Q7CiAgICAJCXRoaXMuYmxlbmRFcXVhdGlvbiA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uOwogICAgCQl0aGlzLmJsZW5kU3JjQWxwaGEgPSBzb3VyY2UuYmxlbmRTcmNBbHBoYTsKICAgIAkJdGhpcy5ibGVuZERzdEFscGhhID0gc291cmNlLmJsZW5kRHN0QWxwaGE7CiAgICAJCXRoaXMuYmxlbmRFcXVhdGlvbkFscGhhID0gc291cmNlLmJsZW5kRXF1YXRpb25BbHBoYTsKICAgIAkJdGhpcy5ibGVuZENvbG9yLmNvcHkoIHNvdXJjZS5ibGVuZENvbG9yICk7CiAgICAJCXRoaXMuYmxlbmRBbHBoYSA9IHNvdXJjZS5ibGVuZEFscGhhOwoKICAgIAkJdGhpcy5kZXB0aEZ1bmMgPSBzb3VyY2UuZGVwdGhGdW5jOwogICAgCQl0aGlzLmRlcHRoVGVzdCA9IHNvdXJjZS5kZXB0aFRlc3Q7CiAgICAJCXRoaXMuZGVwdGhXcml0ZSA9IHNvdXJjZS5kZXB0aFdyaXRlOwoKICAgIAkJdGhpcy5zdGVuY2lsV3JpdGVNYXNrID0gc291cmNlLnN0ZW5jaWxXcml0ZU1hc2s7CiAgICAJCXRoaXMuc3RlbmNpbEZ1bmMgPSBzb3VyY2Uuc3RlbmNpbEZ1bmM7CiAgICAJCXRoaXMuc3RlbmNpbFJlZiA9IHNvdXJjZS5zdGVuY2lsUmVmOwogICAgCQl0aGlzLnN0ZW5jaWxGdW5jTWFzayA9IHNvdXJjZS5zdGVuY2lsRnVuY01hc2s7CiAgICAJCXRoaXMuc3RlbmNpbEZhaWwgPSBzb3VyY2Uuc3RlbmNpbEZhaWw7CiAgICAJCXRoaXMuc3RlbmNpbFpGYWlsID0gc291cmNlLnN0ZW5jaWxaRmFpbDsKICAgIAkJdGhpcy5zdGVuY2lsWlBhc3MgPSBzb3VyY2Uuc3RlbmNpbFpQYXNzOwogICAgCQl0aGlzLnN0ZW5jaWxXcml0ZSA9IHNvdXJjZS5zdGVuY2lsV3JpdGU7CgogICAgCQljb25zdCBzcmNQbGFuZXMgPSBzb3VyY2UuY2xpcHBpbmdQbGFuZXM7CiAgICAJCWxldCBkc3RQbGFuZXMgPSBudWxsOwoKICAgIAkJaWYgKCBzcmNQbGFuZXMgIT09IG51bGwgKSB7CgogICAgCQkJY29uc3QgbiA9IHNyY1BsYW5lcy5sZW5ndGg7CiAgICAJCQlkc3RQbGFuZXMgPSBuZXcgQXJyYXkoIG4gKTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG47ICsrIGkgKSB7CgogICAgCQkJCWRzdFBsYW5lc1sgaSBdID0gc3JjUGxhbmVzWyBpIF0uY2xvbmUoKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gZHN0UGxhbmVzOwogICAgCQl0aGlzLmNsaXBJbnRlcnNlY3Rpb24gPSBzb3VyY2UuY2xpcEludGVyc2VjdGlvbjsKICAgIAkJdGhpcy5jbGlwU2hhZG93cyA9IHNvdXJjZS5jbGlwU2hhZG93czsKCiAgICAJCXRoaXMuc2hhZG93U2lkZSA9IHNvdXJjZS5zaGFkb3dTaWRlOwoKICAgIAkJdGhpcy5jb2xvcldyaXRlID0gc291cmNlLmNvbG9yV3JpdGU7CgogICAgCQl0aGlzLnByZWNpc2lvbiA9IHNvdXJjZS5wcmVjaXNpb247CgogICAgCQl0aGlzLnBvbHlnb25PZmZzZXQgPSBzb3VyY2UucG9seWdvbk9mZnNldDsKICAgIAkJdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gc291cmNlLnBvbHlnb25PZmZzZXRGYWN0b3I7CiAgICAJCXRoaXMucG9seWdvbk9mZnNldFVuaXRzID0gc291cmNlLnBvbHlnb25PZmZzZXRVbml0czsKCiAgICAJCXRoaXMuZGl0aGVyaW5nID0gc291cmNlLmRpdGhlcmluZzsKCiAgICAJCXRoaXMuYWxwaGFUZXN0ID0gc291cmNlLmFscGhhVGVzdDsKICAgIAkJdGhpcy5hbHBoYUhhc2ggPSBzb3VyY2UuYWxwaGFIYXNoOwogICAgCQl0aGlzLmFscGhhVG9Db3ZlcmFnZSA9IHNvdXJjZS5hbHBoYVRvQ292ZXJhZ2U7CiAgICAJCXRoaXMucHJlbXVsdGlwbGllZEFscGhhID0gc291cmNlLnByZW11bHRpcGxpZWRBbHBoYTsKICAgIAkJdGhpcy5mb3JjZVNpbmdsZVBhc3MgPSBzb3VyY2UuZm9yY2VTaW5nbGVQYXNzOwoKICAgIAkJdGhpcy52aXNpYmxlID0gc291cmNlLnZpc2libGU7CgogICAgCQl0aGlzLnRvbmVNYXBwZWQgPSBzb3VyY2UudG9uZU1hcHBlZDsKCiAgICAJCXRoaXMudXNlckRhdGEgPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeSggc291cmNlLnVzZXJEYXRhICkgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwogICAgCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgogICAgCSAqCiAgICAJICogQGZpcmVzIE1hdGVyaWFsI2Rpc3Bvc2UKICAgIAkgKi8KICAgIAlkaXNwb3NlKCkgewoKICAgIAkJLyoqCiAgICAJCSAqIEZpcmVzIHdoZW4gdGhlIG1hdGVyaWFsIGhhcyBiZWVuIGRpc3Bvc2VkIG9mLgogICAgCQkgKgogICAgCQkgKiBAZXZlbnQgTWF0ZXJpYWwjZGlzcG9zZQogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0dGluZyB0aGlzIHByb3BlcnR5IHRvIGB0cnVlYCBpbmRpY2F0ZXMgdGhlIGVuZ2luZSB0aGUgbWF0ZXJpYWwKICAgIAkgKiBuZWVkcyB0byBiZSByZWNvbXBpbGVkLgogICAgCSAqCiAgICAJICogQHR5cGUge2Jvb2xlYW59CiAgICAJICogQGRlZmF1bHQgZmFsc2UKICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCiAgICAJICovCiAgICAJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCiAgICAJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIG1hdGVyaWFsIGZvciBkcmF3aW5nIGdlb21ldHJpZXMgaW4gYSBzaW1wbGUgc2hhZGVkIChmbGF0IG9yIHdpcmVmcmFtZSkgd2F5LgogICAgICoKICAgICAqIFRoaXMgbWF0ZXJpYWwgaXMgbm90IGFmZmVjdGVkIGJ5IGxpZ2h0cy4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgTWF0ZXJpYWwKICAgICAqLwogICAgY2xhc3MgTWVzaEJhc2ljTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgbWVzaCBiYXNpYyBtYXRlcmlhbC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCiAgICAJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAogICAgCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAogICAgCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCiAgICAJICogYnkge0BsaW5rIENvbG9yI3NldH0uCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNNZXNoQmFzaWNNYXRlcmlhbCA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnTWVzaEJhc2ljTWF0ZXJpYWwnOwoKICAgIAkJLyoqCiAgICAJCSAqIENvbG9yIG9mIHRoZSBtYXRlcmlhbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0NvbG9yfQogICAgCQkgKiBAZGVmYXVsdCAoMSwxLDEpCiAgICAJCSAqLwogICAgCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCAweGZmZmZmZiApOyAvLyBlbWlzc2l2ZQoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBjb2xvciBtYXAuIE1heSBvcHRpb25hbGx5IGluY2x1ZGUgYW4gYWxwaGEgY2hhbm5lbCwgdHlwaWNhbGx5IGNvbWJpbmVkCiAgICAJCSAqIHdpdGgge0BsaW5rIE1hdGVyaWFsI3RyYW5zcGFyZW50fSBvciB7QGxpbmsgTWF0ZXJpYWwjYWxwaGFUZXN0fS4gVGhlIHRleHR1cmUgbWFwCiAgICAJCSAqIGNvbG9yIGlzIG1vZHVsYXRlZCBieSB0aGUgZGlmZnVzZSBgY29sb3JgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMubWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbGlnaHQgbWFwLiBSZXF1aXJlcyBhIHNlY29uZCBzZXQgb2YgVVZzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMubGlnaHRNYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEludGVuc2l0eSBvZiB0aGUgYmFrZWQgbGlnaHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSAxLjA7CgogICAgCQkvKioKICAgIAkJICogVGhlIHJlZCBjaGFubmVsIG9mIHRoaXMgdGV4dHVyZSBpcyB1c2VkIGFzIHRoZSBhbWJpZW50IG9jY2x1c2lvbiBtYXAuCiAgICAJCSAqIFJlcXVpcmVzIGEgc2Vjb25kIHNldCBvZiBVVnMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5hb01hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogSW50ZW5zaXR5IG9mIHRoZSBhbWJpZW50IG9jY2x1c2lvbiBlZmZlY3QuIFJhbmdlIGlzIGBbMCwxXWAsIHdoZXJlIGAwYAogICAgCQkgKiBkaXNhYmxlcyBhbWJpZW50IG9jY2x1c2lvbi4gV2hlcmUgaW50ZW5zaXR5IGlzIGAxYCBhbmQgdGhlIEFPIG1hcCdzCiAgICAJCSAqIHJlZCBjaGFubmVsIGlzIGFsc28gYDFgLCBhbWJpZW50IGxpZ2h0IGlzIGZ1bGx5IG9jY2x1ZGVkIG9uIGEgc3VyZmFjZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5hb01hcEludGVuc2l0eSA9IDEuMDsKCiAgICAJCS8qKgogICAgCQkgKiBTcGVjdWxhciBtYXAgdXNlZCBieSB0aGUgbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5zcGVjdWxhck1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGFscGhhIG1hcCBpcyBhIGdyYXlzY2FsZSB0ZXh0dXJlIHRoYXQgY29udHJvbHMgdGhlIG9wYWNpdHkgYWNyb3NzIHRoZQogICAgCQkgKiBzdXJmYWNlIChibGFjazogZnVsbHkgdHJhbnNwYXJlbnQ7IHdoaXRlOiBmdWxseSBvcGFxdWUpLgogICAgCQkgKgogICAgCQkgKiBPbmx5IHRoZSBjb2xvciBvZiB0aGUgdGV4dHVyZSBpcyB1c2VkLCBpZ25vcmluZyB0aGUgYWxwaGEgY2hhbm5lbCBpZiBvbmUKICAgIAkJICogZXhpc3RzLiBGb3IgUkdCIGFuZCBSR0JBIHRleHR1cmVzLCB0aGUgcmVuZGVyZXIgd2lsbCB1c2UgdGhlIGdyZWVuIGNoYW5uZWwKICAgIAkJICogd2hlbiBzYW1wbGluZyB0aGlzIHRleHR1cmUgZHVlIHRvIHRoZSBleHRyYSBiaXQgb2YgcHJlY2lzaW9uIHByb3ZpZGVkIGZvcgogICAgCQkgKiBncmVlbiBpbiBEWFQtY29tcHJlc3NlZCBhbmQgdW5jb21wcmVzc2VkIFJHQiA1NjUgZm9ybWF0cy4gTHVtaW5hbmNlLW9ubHkgYW5kCiAgICAJCSAqIGx1bWluYW5jZS9hbHBoYSB0ZXh0dXJlcyB3aWxsIGFsc28gc3RpbGwgd29yayBhcyBleHBlY3RlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZW52aXJvbm1lbnQgbWFwLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuZW52TWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgcm90YXRpb24gb2YgdGhlIGVudmlyb25tZW50IG1hcCBpbiByYWRpYW5zLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7RXVsZXJ9CiAgICAJCSAqIEBkZWZhdWx0ICgwLDAsMCkKICAgIAkJICovCiAgICAJCXRoaXMuZW52TWFwUm90YXRpb24gPSBuZXcgRXVsZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBIb3cgdG8gY29tYmluZSB0aGUgcmVzdWx0IG9mIHRoZSBzdXJmYWNlJ3MgY29sb3Igd2l0aCB0aGUgZW52aXJvbm1lbnQgbWFwLCBpZiBhbnkuCiAgICAJCSAqCiAgICAJCSAqIFdoZW4gc2V0IHRvIGBNaXhPcGVyYXRpb25gLCB0aGUge0BsaW5rIE1lc2hCYXNpY01hdGVyaWFsI3JlZmxlY3Rpdml0eX0gaXMgdXNlZCB0bwogICAgCQkgKiBibGVuZCBiZXR3ZWVuIHRoZSB0d28gY29sb3JzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KE11bHRpcGx5T3BlcmF0aW9ufE1peE9wZXJhdGlvbnxBZGRPcGVyYXRpb24pfQogICAgCQkgKiBAZGVmYXVsdCBNdWx0aXBseU9wZXJhdGlvbgogICAgCQkgKi8KICAgIAkJdGhpcy5jb21iaW5lID0gTXVsdGlwbHlPcGVyYXRpb247CgogICAgCQkvKioKICAgIAkJICogSG93IG11Y2ggdGhlIGVudmlyb25tZW50IG1hcCBhZmZlY3RzIHRoZSBzdXJmYWNlLgogICAgCQkgKiBUaGUgdmFsaWQgcmFuZ2UgaXMgYmV0d2VlbiBgMGAgKG5vIHJlZmxlY3Rpb25zKSBhbmQgYDFgIChmdWxsIHJlZmxlY3Rpb25zKS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBpbmRleCBvZiByZWZyYWN0aW9uIChJT1IpIG9mIGFpciAoYXBwcm94aW1hdGVseSAxKSBkaXZpZGVkIGJ5IHRoZQogICAgCQkgKiBpbmRleCBvZiByZWZyYWN0aW9uIG9mIHRoZSBtYXRlcmlhbC4gSXQgaXMgdXNlZCB3aXRoIGVudmlyb25tZW50IG1hcHBpbmcKICAgIAkJICogbW9kZXMge0BsaW5rIEN1YmVSZWZyYWN0aW9uTWFwcGluZ30gYW5kIHtAbGluayBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZ30uCiAgICAJCSAqIFRoZSByZWZyYWN0aW9uIHJhdGlvIHNob3VsZCBub3QgZXhjZWVkIGAxYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMC45OAogICAgCQkgKi8KICAgIAkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwoKICAgIAkJLyoqCiAgICAJCSAqIFJlbmRlcnMgdGhlIGdlb21ldHJ5IGFzIGEgd2lyZWZyYW1lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogQ29udHJvbHMgdGhlIHRoaWNrbmVzcyBvZiB0aGUgd2lyZWZyYW1lLgogICAgCQkgKgogICAgCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFNWR1JlbmRlcmVyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgYXBwZWFyYW5jZSBvZiB3aXJlZnJhbWUgZW5kcy4KICAgIAkJICoKICAgIAkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoJ3JvdW5kJ3wnYmV2ZWwnfCdtaXRlcicpfQogICAgCQkgKiBAZGVmYXVsdCAncm91bmQnCiAgICAJCSAqLwogICAgCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgYXBwZWFyYW5jZSBvZiB3aXJlZnJhbWUgam9pbnRzLgogICAgCQkgKgogICAgCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFNWR1JlbmRlcmVyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeygncm91bmQnfCdiZXZlbCd8J21pdGVyJyl9CiAgICAJCSAqIEBkZWZhdWx0ICdyb3VuZCcKICAgIAkJICovCiAgICAJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdGhlIG1hdGVyaWFsIGlzIGFmZmVjdGVkIGJ5IGZvZyBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmZvZyA9IHRydWU7CgogICAgCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKICAgIAkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCiAgICAJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCiAgICAJCXRoaXMubGlnaHRNYXAgPSBzb3VyY2UubGlnaHRNYXA7CiAgICAJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSBzb3VyY2UubGlnaHRNYXBJbnRlbnNpdHk7CgogICAgCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwogICAgCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gc291cmNlLmFvTWFwSW50ZW5zaXR5OwoKICAgIAkJdGhpcy5zcGVjdWxhck1hcCA9IHNvdXJjZS5zcGVjdWxhck1hcDsKCiAgICAJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgogICAgCQl0aGlzLmVudk1hcCA9IHNvdXJjZS5lbnZNYXA7CiAgICAJCXRoaXMuZW52TWFwUm90YXRpb24uY29weSggc291cmNlLmVudk1hcFJvdGF0aW9uICk7CiAgICAJCXRoaXMuY29tYmluZSA9IHNvdXJjZS5jb21iaW5lOwogICAgCQl0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CiAgICAJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gc291cmNlLnJlZnJhY3Rpb25SYXRpbzsKCiAgICAJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKICAgIAkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwogICAgCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSBzb3VyY2Uud2lyZWZyYW1lTGluZWNhcDsKICAgIAkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9IHNvdXJjZS53aXJlZnJhbWVMaW5lam9pbjsKCiAgICAJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF92ZWN0b3IkOSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92ZWN0b3IyJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CgogICAgbGV0IF9pZCQyID0gMDsKCiAgICAvKioKICAgICAqIFRoaXMgY2xhc3Mgc3RvcmVzIGRhdGEgZm9yIGFuIGF0dHJpYnV0ZSAoc3VjaCBhcyB2ZXJ0ZXggcG9zaXRpb25zLCBmYWNlCiAgICAgKiBpbmRpY2VzLCBub3JtYWxzLCBjb2xvcnMsIFVWcywgYW5kIGFueSBjdXN0b20gYXR0cmlidXRlcyApIGFzc29jaWF0ZWQgd2l0aAogICAgICogYSBnZW9tZXRyeSwgd2hpY2ggYWxsb3dzIGZvciBtb3JlIGVmZmljaWVudCBwYXNzaW5nIG9mIGRhdGEgdG8gdGhlIEdQVS4KICAgICAqCiAgICAgKiBXaGVuIHdvcmtpbmcgd2l0aCB2ZWN0b3ItbGlrZSBkYXRhLCB0aGUgYGZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKWAKICAgICAqIGhlbHBlciBtZXRob2RzIG9uIHZlY3RvciBhbmQgY29sb3IgY2xhc3MgbWlnaHQgYmUgaGVscGZ1bC4gRS5nLiB7QGxpbmsgVmVjdG9yMyNmcm9tQnVmZmVyQXR0cmlidXRlfS4KICAgICAqLwogICAgY2xhc3MgQnVmZmVyQXR0cmlidXRlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtUeXBlZEFycmF5fSBhcnJheSAtIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaXRlbVNpemUgLSBUaGUgaXRlbSBzaXplLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW25vcm1hbGl6ZWQ9ZmFsc2VdIC0gV2hldGhlciB0aGUgZGF0YSBhcmUgbm9ybWFsaXplZCBvciBub3QuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCA9IGZhbHNlICkgewoKICAgIAkJaWYgKCBBcnJheS5pc0FycmF5KCBhcnJheSApICkgewoKICAgIAkJCXRocm93IG5ldyBUeXBlRXJyb3IoICdUSFJFRS5CdWZmZXJBdHRyaWJ1dGU6IGFycmF5IHNob3VsZCBiZSBhIFR5cGVkIEFycmF5LicgKTsKCiAgICAJCX0KCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgSUQgb2YgdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJCSAqCiAgICAJCSAqIEBuYW1lIEJ1ZmZlckF0dHJpYnV0ZSNpZAogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX2lkJDIgKysgfSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBuYW1lIG9mIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy5uYW1lID0gJyc7CgogICAgCQkvKioKICAgIAkJICogVGhlIGFycmF5IGhvbGRpbmcgdGhlIGF0dHJpYnV0ZSBkYXRhLiBJdCBzaG91bGQgaGF2ZSBgaXRlbVNpemUgKiBudW1WZXJ0aWNlc2AKICAgIAkJICogZWxlbWVudHMsIHdoZXJlIGBudW1WZXJ0aWNlc2AgaXMgdGhlIG51bWJlciBvZiB2ZXJ0aWNlcyBpbiB0aGUgYXNzb2NpYXRlZCBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1R5cGVkQXJyYXl9CiAgICAJCSAqLwogICAgCQl0aGlzLmFycmF5ID0gYXJyYXk7CgogICAgCQkvKioKICAgIAkJICogVGhlIG51bWJlciBvZiB2YWx1ZXMgb2YgdGhlIGFycmF5IHRoYXQgc2hvdWxkIGJlIGFzc29jaWF0ZWQgd2l0aCBhIHBhcnRpY3VsYXIgdmVydGV4LgogICAgCQkgKiBGb3IgaW5zdGFuY2UsIGlmIHRoaXMgYXR0cmlidXRlIGlzIHN0b3JpbmcgYSAzLWNvbXBvbmVudCB2ZWN0b3IgKHN1Y2ggYXMgYSBwb3NpdGlvbiwKICAgIAkJICogbm9ybWFsLCBvciBjb2xvciksIHRoZW4gdGhlIHZhbHVlIHNob3VsZCBiZSBgM2AuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CgogICAgCQkvKioKICAgIAkJICogUmVwcmVzZW50cyB0aGUgbnVtYmVyIG9mIGl0ZW1zIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZSBzdG9yZXMuIEl0IGlzIGludGVybmFsbHkgY29tcHV0ZWQKICAgIAkJICogYnkgZGl2aWRpbmcgdGhlIGBhcnJheWAgbGVuZ3RoIGJ5IHRoZSBgaXRlbVNpemVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICovCiAgICAJCXRoaXMuY291bnQgPSBhcnJheSAhPT0gdW5kZWZpbmVkID8gYXJyYXkubGVuZ3RoIC8gaXRlbVNpemUgOiAwOwoKICAgIAkJLyoqCiAgICAJCSAqIEFwcGxpZXMgdG8gaW50ZWdlciBkYXRhIG9ubHkuIEluZGljYXRlcyBob3cgdGhlIHVuZGVybHlpbmcgZGF0YSBpbiB0aGUgYnVmZmVyIG1hcHMgdG8KICAgIAkJICogdGhlIHZhbHVlcyBpbiB0aGUgR0xTTCBjb2RlLiBGb3IgaW5zdGFuY2UsIGlmIGBhcnJheWAgaXMgYW4gaW5zdGFuY2Ugb2YgYFVJbnQxNkFycmF5YCwKICAgIAkJICogYW5kIGBub3JtYWxpemVkYCBpcyBgdHJ1ZWAsIHRoZSB2YWx1ZXMgYDAgLSArNjU1MzVgIGluIHRoZSBhcnJheSBkYXRhIHdpbGwgYmUgbWFwcGVkIHRvCiAgICAJCSAqIGAwLjBmIC0gKzEuMGZgIGluIHRoZSBHTFNMIGF0dHJpYnV0ZS4gSWYgYG5vcm1hbGl6ZWRgIGlzIGBmYWxzZWAsIHRoZSB2YWx1ZXMgd2lsbCBiZSBjb252ZXJ0ZWQKICAgIAkJICogdG8gZmxvYXRzIHVubW9kaWZpZWQsIGkuZS4gYDY1NTM1YCBiZWNvbWVzIGA2NTUzNS4wZmAuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKi8KICAgIAkJdGhpcy5ub3JtYWxpemVkID0gbm9ybWFsaXplZDsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBpbnRlbmRlZCB1c2FnZSBwYXR0ZXJuIG9mIHRoZSBkYXRhIHN0b3JlIGZvciBvcHRpbWl6YXRpb24gcHVycG9zZXMuCiAgICAJCSAqCiAgICAJCSAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIGJ1ZmZlciwgaXRzIHVzYWdlIGNhbm5vdCBiZSBjaGFuZ2VkLiBJbnN0ZWFkLAogICAgCQkgKiBpbnN0YW50aWF0ZSBhIG5ldyBvbmUgYW5kIHNldCB0aGUgZGVzaXJlZCB1c2FnZSBiZWZvcmUgdGhlIG5leHQgcmVuZGVyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KFN0YXRpY0RyYXdVc2FnZXxEeW5hbWljRHJhd1VzYWdlfFN0cmVhbURyYXdVc2FnZXxTdGF0aWNSZWFkVXNhZ2V8RHluYW1pY1JlYWRVc2FnZXxTdHJlYW1SZWFkVXNhZ2V8U3RhdGljQ29weVVzYWdlfER5bmFtaWNDb3B5VXNhZ2V8U3RyZWFtQ29weVVzYWdlKX0KICAgIAkJICogQGRlZmF1bHQgU3RhdGljRHJhd1VzYWdlCiAgICAJCSAqLwogICAgCQl0aGlzLnVzYWdlID0gU3RhdGljRHJhd1VzYWdlOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gb25seSB1cGRhdGUgc29tZSBjb21wb25lbnRzIG9mIHN0b3JlZCB2ZWN0b3JzIChmb3IgZXhhbXBsZSwganVzdCB0aGUKICAgIAkJICogY29tcG9uZW50IHJlbGF0ZWQgdG8gY29sb3IpLiBVc2UgdGhlIGBhZGRVcGRhdGVSYW5nZSgpYCBmdW5jdGlvbiB0byBhZGQgcmFuZ2VzIHRvIHRoaXMgYXJyYXkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxPYmplY3Q+fQogICAgCQkgKi8KICAgIAkJdGhpcy51cGRhdGVSYW5nZXMgPSBbXTsKCiAgICAJCS8qKgogICAgCQkgKiBDb25maWd1cmVzIHRoZSBib3VuZCBHUFUgdHlwZSBmb3IgdXNlIGluIHNoYWRlcnMuCiAgICAJCSAqCiAgICAJCSAqIE5vdGU6IHRoaXMgb25seSBoYXMgYW4gZWZmZWN0IGZvciBpbnRlZ2VyIGFycmF5cyBhbmQgaXMgbm90IGNvbmZpZ3VyYWJsZSBmb3IgZmxvYXQgYXJyYXlzLgogICAgCQkgKiBGb3IgbG93ZXIgcHJlY2lzaW9uIGZsb2F0IHR5cGVzLCB1c2UgYEZsb2F0MTZCdWZmZXJBdHRyaWJ1dGVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7KEZsb2F0VHlwZXxJbnRUeXBlKX0KICAgIAkJICogQGRlZmF1bHQgRmxvYXRUeXBlCiAgICAJCSAqLwogICAgCQl0aGlzLmdwdVR5cGUgPSBGbG9hdFR5cGU7CgogICAgCQkvKioKICAgIAkJICogQSB2ZXJzaW9uIG51bWJlciwgaW5jcmVtZW50ZWQgZXZlcnkgdGltZSB0aGUgYG5lZWRzVXBkYXRlYCBpcyBzZXQgdG8gYHRydWVgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy52ZXJzaW9uID0gMDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgYWZ0ZXIgdGhlIHJlbmRlcmVyIGhhcyB0cmFuc2ZlcnJlZCB0aGUgYXR0cmlidXRlCiAgICAJICogYXJyYXkgZGF0YSB0byB0aGUgR1BVLgogICAgCSAqLwogICAgCW9uVXBsb2FkQ2FsbGJhY2soKSB7fQoKICAgIAkvKioKICAgIAkgKiBGbGFnIHRvIGluZGljYXRlIHRoYXQgdGhpcyBhdHRyaWJ1dGUgaGFzIGNoYW5nZWQgYW5kIHNob3VsZCBiZSByZS1zZW50IHRvCiAgICAJICogdGhlIEdQVS4gU2V0IHRoaXMgdG8gYHRydWVgIHdoZW4geW91IG1vZGlmeSB0aGUgdmFsdWUgb2YgdGhlIGFycmF5LgogICAgCSAqCiAgICAJICogQHR5cGUge251bWJlcn0KICAgIAkgKiBAZGVmYXVsdCBmYWxzZQogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKICAgIAkgKi8KICAgIAlzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKICAgIAkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHRoaXMudmVyc2lvbiArKzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB1c2FnZSBvZiB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhTdGF0aWNEcmF3VXNhZ2V8RHluYW1pY0RyYXdVc2FnZXxTdHJlYW1EcmF3VXNhZ2V8U3RhdGljUmVhZFVzYWdlfER5bmFtaWNSZWFkVXNhZ2V8U3RyZWFtUmVhZFVzYWdlfFN0YXRpY0NvcHlVc2FnZXxEeW5hbWljQ29weVVzYWdlfFN0cmVhbUNvcHlVc2FnZSl9IHZhbHVlIC0gVGhlIHVzYWdlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKi8KICAgIAlzZXRVc2FnZSggdmFsdWUgKSB7CgogICAgCQl0aGlzLnVzYWdlID0gdmFsdWU7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBZGRzIGEgcmFuZ2Ugb2YgZGF0YSBpbiB0aGUgZGF0YSBhcnJheSB0byBiZSB1cGRhdGVkIG9uIHRoZSBHUFUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgLSBQb3NpdGlvbiBhdCB3aGljaCB0byBzdGFydCB1cGRhdGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGNvdW50IC0gVGhlIG51bWJlciBvZiBjb21wb25lbnRzIHRvIHVwZGF0ZS4KICAgIAkgKi8KICAgIAlhZGRVcGRhdGVSYW5nZSggc3RhcnQsIGNvdW50ICkgewoKICAgIAkJdGhpcy51cGRhdGVSYW5nZXMucHVzaCggeyBzdGFydCwgY291bnQgfSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENsZWFycyB0aGUgdXBkYXRlIHJhbmdlcy4KICAgIAkgKi8KICAgIAljbGVhclVwZGF0ZVJhbmdlcygpIHsKCiAgICAJCXRoaXMudXBkYXRlUmFuZ2VzLmxlbmd0aCA9IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBzb3VyY2UgLSBUaGUgYnVmZmVyIGF0dHJpYnV0ZSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKICAgIAkJdGhpcy5hcnJheSA9IG5ldyBzb3VyY2UuYXJyYXkuY29uc3RydWN0b3IoIHNvdXJjZS5hcnJheSApOwogICAgCQl0aGlzLml0ZW1TaXplID0gc291cmNlLml0ZW1TaXplOwogICAgCQl0aGlzLmNvdW50ID0gc291cmNlLmNvdW50OwogICAgCQl0aGlzLm5vcm1hbGl6ZWQgPSBzb3VyY2Uubm9ybWFsaXplZDsKCiAgICAJCXRoaXMudXNhZ2UgPSBzb3VyY2UudXNhZ2U7CiAgICAJCXRoaXMuZ3B1VHlwZSA9IHNvdXJjZS5ncHVUeXBlOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIGEgdmVjdG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gdGhpcyBvbmUuIFRoZSBzdGFydAogICAgCSAqIGFuZCBkZXN0aW5hdGlvbiBwb3NpdGlvbiBpbiB0aGUgYXR0cmlidXRlIGJ1ZmZlcnMgYXJlIHJlcHJlc2VudGVkIGJ5IHRoZQogICAgCSAqIGdpdmVuIGluZGljZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXgxIC0gVGhlIGRlc3RpbmF0aW9uIGluZGV4IGludG8gdGhpcyBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBUaGUgYnVmZmVyIGF0dHJpYnV0ZSB0byBjb3B5IGZyb20uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4MiAtIFRoZSBzb3VyY2UgaW5kZXggaW50byB0aGUgZ2l2ZW4gYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY29weUF0KCBpbmRleDEsIGF0dHJpYnV0ZSwgaW5kZXgyICkgewoKICAgIAkJaW5kZXgxICo9IHRoaXMuaXRlbVNpemU7CiAgICAJCWluZGV4MiAqPSBhdHRyaWJ1dGUuaXRlbVNpemU7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLml0ZW1TaXplOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQl0aGlzLmFycmF5WyBpbmRleDEgKyBpIF0gPSBhdHRyaWJ1dGUuYXJyYXlbIGluZGV4MiArIGkgXTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvcGllcyB0aGUgZ2l2ZW4gYXJyYXkgZGF0YSBpbnRvIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7KFR5cGVkQXJyYXl8QXJyYXkpfSBhcnJheSAtIFRoZSBhcnJheSB0byBjb3B5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5QXJyYXkoIGFycmF5ICkgewoKICAgIAkJdGhpcy5hcnJheS5zZXQoIGFycmF5ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBcHBsaWVzIHRoZSBnaXZlbiAzeDMgbWF0cml4IHRvIHRoZSBnaXZlbiBhdHRyaWJ1dGUuIFdvcmtzIHdpdGgKICAgIAkgKiBpdGVtIHNpemUgYDJgIGFuZCBgM2AuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIGFwcGx5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlhcHBseU1hdHJpeDMoIG0gKSB7CgogICAgCQlpZiAoIHRoaXMuaXRlbVNpemUgPT09IDIgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCV92ZWN0b3IyJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwogICAgCQkJCV92ZWN0b3IyJDEuYXBwbHlNYXRyaXgzKCBtICk7CgogICAgCQkJCXRoaXMuc2V0WFkoIGksIF92ZWN0b3IyJDEueCwgX3ZlY3RvcjIkMS55ICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIGlmICggdGhpcy5pdGVtU2l6ZSA9PT0gMyApIHsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKICAgIAkJCQlfdmVjdG9yJDkuYXBwbHlNYXRyaXgzKCBtICk7CgogICAgCQkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKICAgIAkgKiBpdGVtIHNpemUgYDNgLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtICkgewoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCiAgICAJCQlfdmVjdG9yJDkuYXBwbHlNYXRyaXg0KCBtICk7CgogICAgCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkOS54LCBfdmVjdG9yJDkueSwgX3ZlY3RvciQ5LnogKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFwcGxpZXMgdGhlIGdpdmVuIDN4MyBub3JtYWwgbWF0cml4IHRvIHRoZSBnaXZlbiBhdHRyaWJ1dGUuIE9ubHkgd29ya3Mgd2l0aAogICAgCSAqIGl0ZW0gc2l6ZSBgM2AuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbm9ybWFsIG1hdHJpeCB0byBhcHBseS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYXBwbHlOb3JtYWxNYXRyaXgoIG0gKSB7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQlfdmVjdG9yJDkuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoKICAgIAkJCV92ZWN0b3IkOS5hcHBseU5vcm1hbE1hdHJpeCggbSApOwoKICAgIAkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBBcHBsaWVzIHRoZSBnaXZlbiA0eDQgbWF0cml4IHRvIHRoZSBnaXZlbiBhdHRyaWJ1dGUuIE9ubHkgd29ya3Mgd2l0aAogICAgCSAqIGl0ZW0gc2l6ZSBgM2AgYW5kIHdpdGggZGlyZWN0aW9uIHZlY3RvcnMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIGFwcGx5LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAl0cmFuc2Zvcm1EaXJlY3Rpb24oIG0gKSB7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQlfdmVjdG9yJDkuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoKICAgIAkJCV92ZWN0b3IkOS50cmFuc2Zvcm1EaXJlY3Rpb24oIG0gKTsKCiAgICAJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZ2l2ZW4gYXJyYXkgZGF0YSBpbiB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7KFR5cGVkQXJyYXl8QXJyYXkpfSB2YWx1ZSAtIFRoZSBhcnJheSBkYXRhIHRvIHNldC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW4gdGhpcyBidWZmZXIgYXR0cmlidXRlJ3MgYXJyYXkuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldCggdmFsdWUsIG9mZnNldCA9IDAgKSB7CgogICAgCQkvLyBNYXRjaGluZyBCdWZmZXJBdHRyaWJ1dGUgY29uc3RydWN0b3IsIGRvIG5vdCBub3JtYWxpemUgdGhlIGFycmF5LgogICAgCQl0aGlzLmFycmF5LnNldCggdmFsdWUsIG9mZnNldCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgZ2l2ZW4gY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGNvbXBvbmVudCAtIFRoZSBjb21wb25lbnQgaW5kZXguCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmV0dXJuZWQgdmFsdWUuCiAgICAJICovCiAgICAJZ2V0Q29tcG9uZW50KCBpbmRleCwgY29tcG9uZW50ICkgewoKICAgIAkJbGV0IHZhbHVlID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgY29tcG9uZW50IF07CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHZhbHVlID0gZGVub3JtYWxpemUoIHZhbHVlLCB0aGlzLmFycmF5ICk7CgogICAgCQlyZXR1cm4gdmFsdWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZ2l2ZW4gdmFsdWUgdG8gdGhlIGdpdmVuIGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBjb21wb25lbnQgLSBUaGUgY29tcG9uZW50IGluZGV4LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldENvbXBvbmVudCggaW5kZXgsIGNvbXBvbmVudCwgdmFsdWUgKSB7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHZhbHVlID0gbm9ybWFsaXplJDMoIHZhbHVlLCB0aGlzLmFycmF5ICk7CgogICAgCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyBjb21wb25lbnQgXSA9IHZhbHVlOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgeCBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB4IGNvbXBvbmVudC4KICAgIAkgKi8KICAgIAlnZXRYKCBpbmRleCApIHsKCiAgICAJCWxldCB4ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplIF07CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBkZW5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoKICAgIAkJcmV0dXJuIHg7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgeCBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB2YWx1ZSB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFgoIGluZGV4LCB4ICkgewoKICAgIAkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gbm9ybWFsaXplJDMoIHgsIHRoaXMuYXJyYXkgKTsKCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSBdID0geDsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgeSBjb21wb25lbnQuCiAgICAJICovCiAgICAJZ2V0WSggaW5kZXggKSB7CgogICAgCQlsZXQgeSA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXTsKCiAgICAJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IGRlbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgogICAgCQlyZXR1cm4geTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0WSggaW5kZXgsIHkgKSB7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBub3JtYWxpemUkMyggeSwgdGhpcy5hcnJheSApOwoKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMSBdID0geTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHogY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgeiBjb21wb25lbnQuCiAgICAJICovCiAgICAJZ2V0WiggaW5kZXggKSB7CgogICAgCQlsZXQgeiA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDIgXTsKCiAgICAJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeiA9IGRlbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgogICAgCQlyZXR1cm4gejsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB6IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0WiggaW5kZXgsIHogKSB7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBub3JtYWxpemUkMyggeiwgdGhpcy5hcnJheSApOwoKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdID0gejsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIHcgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgdyBjb21wb25lbnQuCiAgICAJICovCiAgICAJZ2V0VyggaW5kZXggKSB7CgogICAgCQlsZXQgdyA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDMgXTsKCiAgICAJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IGRlbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgogICAgCQlyZXR1cm4gdzsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB3IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIHZhbHVlIHRvIHNldC4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0VyggaW5kZXgsIHcgKSB7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBub3JtYWxpemUkMyggdywgdGhpcy5hcnJheSApOwoKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdID0gdzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHggYW5kIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFhZKCBpbmRleCwgeCwgeSApIHsKCiAgICAJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCiAgICAJCQl4ID0gbm9ybWFsaXplJDMoIHgsIHRoaXMuYXJyYXkgKTsKICAgIAkJCXkgPSBub3JtYWxpemUkMyggeSwgdGhpcy5hcnJheSApOwoKICAgIAkJfQoKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwogICAgCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB4LCB5IGFuZCB6IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIGZvciB0aGUgeCBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIGZvciB0aGUgeSBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIGZvciB0aGUgeiBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRYWVooIGluZGV4LCB4LCB5LCB6ICkgewoKICAgIAkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCiAgICAJCWlmICggdGhpcy5ub3JtYWxpemVkICkgewoKICAgIAkJCXggPSBub3JtYWxpemUkMyggeCwgdGhpcy5hcnJheSApOwogICAgCQkJeSA9IG5vcm1hbGl6ZSQzKCB5LCB0aGlzLmFycmF5ICk7CiAgICAJCQl6ID0gbm9ybWFsaXplJDMoIHosIHRoaXMuYXJyYXkgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwogICAgCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB4LCB5LCB6IGFuZCB3IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIGZvciB0aGUgeCBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIGZvciB0aGUgeSBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIGZvciB0aGUgeiBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIHZhbHVlIGZvciB0aGUgdyBjb21wb25lbnQgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRYWVpXKCBpbmRleCwgeCwgeSwgeiwgdyApIHsKCiAgICAJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgogICAgCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCiAgICAJCQl4ID0gbm9ybWFsaXplJDMoIHgsIHRoaXMuYXJyYXkgKTsKICAgIAkJCXkgPSBub3JtYWxpemUkMyggeSwgdGhpcy5hcnJheSApOwogICAgCQkJeiA9IG5vcm1hbGl6ZSQzKCB6LCB0aGlzLmFycmF5ICk7CiAgICAJCQl3ID0gbm9ybWFsaXplJDMoIHcsIHRoaXMuYXJyYXkgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKICAgIAkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwogICAgCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CiAgICAJCXRoaXMuYXJyYXlbIGluZGV4ICsgMyBdID0gdzsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgYWZ0ZXIgdGhlIFJlbmRlcmVyIGhhcyB0cmFuc2ZlcnJlZAogICAgCSAqIHRoZSBhdHRyaWJ1dGUgYXJyYXkgZGF0YSB0byB0aGUgR1BVLiBDYW4gYmUgdXNlZCB0byBwZXJmb3JtIGNsZWFuLXVwIG9wZXJhdGlvbnMgYWZ0ZXIKICAgIAkgKiB0aGUgdXBsb2FkIHdoZW4gYXR0cmlidXRlIGRhdGEgYXJlIG5vdCBuZWVkZWQgYW55bW9yZSBvbiB0aGUgQ1BVIHNpZGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIFRoZSBgb25VcGxvYWQoKWAgY2FsbGJhY2suCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCW9uVXBsb2FkKCBjYWxsYmFjayApIHsKCiAgICAJCXRoaXMub25VcGxvYWRDYWxsYmFjayA9IGNhbGxiYWNrOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyBidWZmZXIgYXR0cmlidXRlIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5hcnJheSwgdGhpcy5pdGVtU2l6ZSApLmNvcHkoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXJpYWxpemVzIHRoZSBidWZmZXIgYXR0cmlidXRlIGludG8gSlNPTi4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKi8KICAgIAl0b0pTT04oKSB7CgogICAgCQljb25zdCBkYXRhID0gewogICAgCQkJaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCiAgICAJCQl0eXBlOiB0aGlzLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCiAgICAJCQlhcnJheTogQXJyYXkuZnJvbSggdGhpcy5hcnJheSApLAogICAgCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCiAgICAJCX07CgogICAgCQlpZiAoIHRoaXMubmFtZSAhPT0gJycgKSBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CiAgICAJCWlmICggdGhpcy51c2FnZSAhPT0gU3RhdGljRHJhd1VzYWdlICkgZGF0YS51c2FnZSA9IHRoaXMudXNhZ2U7CgogICAgCQlyZXR1cm4gZGF0YTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENvbnZlbmllbnQgY2xhc3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIGEgYFVJbnQxNmAgYnVmZmVyIGF0dHJpYnV0ZSB3aXRoCiAgICAgKiBhIHBsYWluIGBBcnJheWAgaW5zdGFuY2UuCiAgICAgKgogICAgICogQGF1Z21lbnRzIEJ1ZmZlckF0dHJpYnV0ZQogICAgICovCiAgICBjbGFzcyBVaW50MTZCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fFVpbnQxNkFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgogICAgCQlzdXBlciggbmV3IFVpbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ29udmVuaWVudCBjbGFzcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgYSBgVUludDMyYCBidWZmZXIgYXR0cmlidXRlIHdpdGgKICAgICAqIGEgcGxhaW4gYEFycmF5YCBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgQnVmZmVyQXR0cmlidXRlCiAgICAgKi8KICAgIGNsYXNzIFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7KEFycmF5PG51bWJlcj58VWludDMyQXJyYXkpfSBhcnJheSAtIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaXRlbVNpemUgLSBUaGUgaXRlbSBzaXplLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW25vcm1hbGl6ZWQ9ZmFsc2VdIC0gV2hldGhlciB0aGUgZGF0YSBhcmUgbm9ybWFsaXplZCBvciBub3QuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCiAgICAJCXN1cGVyKCBuZXcgVWludDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZW5pZW50IGNsYXNzIHRoYXQgY2FuIGJlIHVzZWQgd2hlbiBjcmVhdGluZyBhIGBGbG9hdDMyYCBidWZmZXIgYXR0cmlidXRlIHdpdGgKICAgICAqIGEgcGxhaW4gYEFycmF5YCBpbnN0YW5jZS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgQnVmZmVyQXR0cmlidXRlCiAgICAgKi8KICAgIGNsYXNzIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fEZsb2F0MzJBcnJheSl9IGFycmF5IC0gVGhlIGFycmF5IGhvbGRpbmcgdGhlIGF0dHJpYnV0ZSBkYXRhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBpdGVtU2l6ZSAtIFRoZSBpdGVtIHNpemUuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbbm9ybWFsaXplZD1mYWxzZV0gLSBXaGV0aGVyIHRoZSBkYXRhIGFyZSBub3JtYWxpemVkIG9yIG5vdC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKICAgIAkJc3VwZXIoIG5ldyBGbG9hdDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgogICAgCX0KCiAgICB9CgogICAgbGV0IF9pZCQxID0gMDsKCiAgICBjb25zdCBfbTEkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKICAgIGNvbnN0IF9vYmogPSAvKkBfX1BVUkVfXyovIG5ldyBPYmplY3QzRCgpOwogICAgY29uc3QgX29mZnNldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9ib3gkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKICAgIGNvbnN0IF9ib3hNb3JwaFRhcmdldHMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CiAgICBjb25zdCBfdmVjdG9yJDggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgLyoqCiAgICAgKiBBIHJlcHJlc2VudGF0aW9uIG9mIG1lc2gsIGxpbmUsIG9yIHBvaW50IGdlb21ldHJ5LiBJbmNsdWRlcyB2ZXJ0ZXgKICAgICAqIHBvc2l0aW9ucywgZmFjZSBpbmRpY2VzLCBub3JtYWxzLCBjb2xvcnMsIFVWcywgYW5kIGN1c3RvbSBhdHRyaWJ1dGVzCiAgICAgKiB3aXRoaW4gYnVmZmVycywgcmVkdWNpbmcgdGhlIGNvc3Qgb2YgcGFzc2luZyBhbGwgdGhpcyBkYXRhIHRvIHRoZSBHUFUuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CiAgICAgKiAvLyBjcmVhdGUgYSBzaW1wbGUgc3F1YXJlIHNoYXBlLiBXZSBkdXBsaWNhdGUgdGhlIHRvcCBsZWZ0IGFuZCBib3R0b20gcmlnaHQKICAgICAqIC8vIHZlcnRpY2VzIGJlY2F1c2UgZWFjaCB2ZXJ0ZXggbmVlZHMgdG8gYXBwZWFyIG9uY2UgcGVyIHRyaWFuZ2xlLgogICAgICogY29uc3QgdmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KCBbCiAgICAgKiAJLTEuMCwgLTEuMCwgIDEuMCwgLy8gdjAKICAgICAqIAkgMS4wLCAtMS4wLCAgMS4wLCAvLyB2MQogICAgICogCSAxLjAsICAxLjAsICAxLjAsIC8vIHYyCiAgICAgKgogICAgICogCSAxLjAsICAxLjAsICAxLjAsIC8vIHYzCiAgICAgKiAJLTEuMCwgIDEuMCwgIDEuMCwgLy8gdjQKICAgICAqIAktMS4wLCAtMS4wLCAgMS4wICAvLyB2NQogICAgICogXSApOwogICAgICogLy8gaXRlbVNpemUgPSAzIGJlY2F1c2UgdGhlcmUgYXJlIDMgdmFsdWVzIChjb21wb25lbnRzKSBwZXIgdmVydGV4CiAgICAgKiBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKICAgICAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmMDAwMCB9ICk7CiAgICAgKiBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgogICAgICovCiAgICBjbGFzcyBCdWZmZXJHZW9tZXRyeSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgZ2VvbWV0cnkuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNCdWZmZXJHZW9tZXRyeSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhlIElEIG9mIHRoZSBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogQG5hbWUgQnVmZmVyR2VvbWV0cnkjaWQKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqLwogICAgCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQxICsrIH0gKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgVVVJRCBvZiB0aGUgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKi8KICAgIAkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgogICAgCQkvKioKICAgIAkJICogVGhlIG5hbWUgb2YgdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy5uYW1lID0gJyc7CiAgICAJCXRoaXMudHlwZSA9ICdCdWZmZXJHZW9tZXRyeSc7CgogICAgCQkvKioKICAgIAkJICogQWxsb3dzIGZvciB2ZXJ0aWNlcyB0byBiZSByZS11c2VkIGFjcm9zcyBtdWx0aXBsZSB0cmlhbmdsZXM7IHRoaXMgaXMKICAgIAkJICogY2FsbGVkIHVzaW5nICJpbmRleGVkIHRyaWFuZ2xlcyIuIEVhY2ggdHJpYW5nbGUgaXMgYXNzb2NpYXRlZCB3aXRoIHRoZQogICAgCQkgKiBpbmRpY2VzIG9mIHRocmVlIHZlcnRpY2VzLiBUaGlzIGF0dHJpYnV0ZSB0aGVyZWZvcmUgc3RvcmVzIHRoZSBpbmRleCBvZgogICAgCQkgKiBlYWNoIHZlcnRleCBmb3IgZWFjaCB0cmlhbmd1bGFyIGZhY2UuIElmIHRoaXMgYXR0cmlidXRlIGlzIG5vdCBzZXQsIHRoZQogICAgCQkgKiByZW5kZXJlciBhc3N1bWVzIHRoYXQgZWFjaCB0aHJlZSBjb250aWd1b3VzIHBvc2l0aW9ucyByZXByZXNlbnQgYSBzaW5nbGUgdHJpYW5nbGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/QnVmZmVyQXR0cmlidXRlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmluZGV4ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBBIChzdG9yYWdlKSBidWZmZXIgYXR0cmlidXRlIHdoaWNoIHdhcyBnZW5lcmF0ZWQgd2l0aCBhIGNvbXB1dGUgc2hhZGVyIGFuZAogICAgCQkgKiBub3cgZGVmaW5lcyBpbmRpcmVjdCBkcmF3IGNhbGxzLgogICAgCQkgKgogICAgCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdQVVJlbmRlcmVyfSBhbmQgYSBXZWJHUFUgYmFja2VuZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9CdWZmZXJBdHRyaWJ1dGV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuaW5kaXJlY3QgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZGljdGlvbmFyeSBoYXMgYXMgaWQgdGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byBiZSBzZXQgYW5kIGFzIHZhbHVlCiAgICAJCSAqIHRoZSBidWZmZXIgYXR0cmlidXRlIHRvIHNldCBpdCB0by4gUmF0aGVyIHRoYW4gYWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgZGlyZWN0bHksCiAgICAJCSAqIHVzZSBgc2V0QXR0cmlidXRlKClgIGFuZCBgZ2V0QXR0cmlidXRlKClgIHRvIGFjY2VzcyBhdHRyaWJ1dGVzIG9mIHRoaXMgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLChCdWZmZXJBdHRyaWJ1dGV8SW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUpPn0KICAgIAkJICovCiAgICAJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZGljdGlvbmFyeSBob2xkcyB0aGUgbW9ycGggdGFyZ2V0cyBvZiB0aGUgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIE5vdGU6IE9uY2UgdGhlIGdlb21ldHJ5IGhhcyBiZWVuIHJlbmRlcmVkLCB0aGUgbW9ycGggYXR0cmlidXRlIGRhdGEgY2Fubm90CiAgICAJCSAqIGJlIGNoYW5nZWQuIFlvdSB3aWxsIGhhdmUgdG8gY2FsbCBgZGlzcG9zZSgpPywgYW5kIGNyZWF0ZSBhIG5ldyBnZW9tZXRyeSBpbnN0YW5jZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdH0KICAgIAkJICovCiAgICAJCXRoaXMubW9ycGhBdHRyaWJ1dGVzID0ge307CgogICAgCQkvKioKICAgIAkJICogVXNlZCB0byBjb250cm9sIHRoZSBtb3JwaCB0YXJnZXQgYmVoYXZpb3I7IHdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIG1vcnBoCiAgICAJCSAqIHRhcmdldCBkYXRhIGlzIHRyZWF0ZWQgYXMgcmVsYXRpdmUgb2Zmc2V0cywgcmF0aGVyIHRoYW4gYXMgYWJzb2x1dGUKICAgIAkJICogcG9zaXRpb25zL25vcm1hbHMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFNwbGl0IHRoZSBnZW9tZXRyeSBpbnRvIGdyb3VwcywgZWFjaCBvZiB3aGljaCB3aWxsIGJlIHJlbmRlcmVkIGluIGEKICAgIAkJICogc2VwYXJhdGUgZHJhdyBjYWxsLiBUaGlzIGFsbG93cyBhbiBhcnJheSBvZiBtYXRlcmlhbHMgdG8gYmUgdXNlZCB3aXRoIHRoZSBnZW9tZXRyeS4KICAgIAkJICoKICAgIAkJICogVXNlIGBhZGRHcm91cCgpYCBhbmQgYGNsZWFyR3JvdXBzKClgIHRvIGVkaXQgZ3JvdXBzLCByYXRoZXIgdGhhbiBtb2RpZnlpbmcgdGhpcyBhcnJheSBkaXJlY3RseS4KICAgIAkJICoKICAgIAkJICogRXZlcnkgdmVydGV4IGFuZCBpbmRleCBtdXN0IGJlbG9uZyB0byBleGFjdGx5IG9uZSBncm91cCDigJQgZ3JvdXBzIG11c3Qgbm90IHNoYXJlIHZlcnRpY2VzIG9yCiAgICAJCSAqIGluZGljZXMsIGFuZCBtdXN0IG5vdCBsZWF2ZSB2ZXJ0aWNlcyBvciBpbmRpY2VzIHVudXNlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PE9iamVjdD59CiAgICAJCSAqLwogICAgCQl0aGlzLmdyb3VwcyA9IFtdOwoKICAgIAkJLyoqCiAgICAJCSAqIEJvdW5kaW5nIGJveCBmb3IgdGhlIGdlb21ldHJ5IHdoaWNoIGNhbiBiZSBjYWxjdWxhdGVkIHdpdGggYGNvbXB1dGVCb3VuZGluZ0JveCgpYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0JveDN9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEJvdW5kaW5nIHNwaGVyZSBmb3IgdGhlIGdlb21ldHJ5IHdoaWNoIGNhbiBiZSBjYWxjdWxhdGVkIHdpdGggYGNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge1NwaGVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogRGV0ZXJtaW5lcyB0aGUgcGFydCBvZiB0aGUgZ2VvbWV0cnkgdG8gcmVuZGVyLiBUaGlzIHNob3VsZCBub3QgYmUgc2V0IGRpcmVjdGx5LAogICAgCQkgKiBpbnN0ZWFkIHVzZSBgc2V0RHJhd1JhbmdlKClgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7e3N0YXJ0Om51bWJlcixjb3VudDpudW1iZXJ9fQogICAgCQkgKi8KICAgIAkJdGhpcy5kcmF3UmFuZ2UgPSB7IHN0YXJ0OiAwLCBjb3VudDogSW5maW5pdHkgfTsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9yZSBjdXN0b20gZGF0YSBhYm91dCB0aGUgZ2VvbWV0cnkuCiAgICAJCSAqIEl0IHNob3VsZCBub3QgaG9sZCByZWZlcmVuY2VzIHRvIGZ1bmN0aW9ucyBhcyB0aGVzZSB3aWxsIG5vdCBiZSBjbG9uZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLnVzZXJEYXRhID0ge307CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhpcyBnZW9tZXRyeS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4gez9CdWZmZXJBdHRyaWJ1dGV9IFRoZSBpbmRleC4gUmV0dXJucyBgbnVsbGAgaWYgbm8gaW5kZXggaXMgZGVmaW5lZC4KICAgIAkgKi8KICAgIAlnZXRJbmRleCgpIHsKCiAgICAJCXJldHVybiB0aGlzLmluZGV4OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIGluZGV4IHRvIHRoaXMgZ2VvbWV0cnkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj58QnVmZmVyQXR0cmlidXRlfSBpbmRleCAtIFRoZSBpbmRleCB0byBzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0SW5kZXgoIGluZGV4ICkgewoKICAgIAkJaWYgKCBBcnJheS5pc0FycmF5KCBpbmRleCApICkgewoKICAgIAkJCXRoaXMuaW5kZXggPSBuZXcgKCBhcnJheU5lZWRzVWludDMyKCBpbmRleCApID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGV4LCAxICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMuaW5kZXggPSBpbmRleDsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIGluZGlyZWN0IGF0dHJpYnV0ZSB0byB0aGlzIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGluZGlyZWN0IC0gVGhlIGF0dHJpYnV0ZSBob2xkaW5nIGluZGlyZWN0IGRyYXcgY2FsbHMuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0SW5kaXJlY3QoIGluZGlyZWN0ICkgewoKICAgIAkJdGhpcy5pbmRpcmVjdCA9IGluZGlyZWN0OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgaW5kaXJlY3QgYXR0cmlidXRlIG9mIHRoaXMgZ2VvbWV0cnkuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHs/QnVmZmVyQXR0cmlidXRlfSBUaGUgaW5kaXJlY3QgYXR0cmlidXRlLiBSZXR1cm5zIGBudWxsYCBpZiBubyBpbmRpcmVjdCBhdHRyaWJ1dGUgaXMgZGVmaW5lZC4KICAgIAkgKi8KICAgIAlnZXRJbmRpcmVjdCgpIHsKCiAgICAJCXJldHVybiB0aGlzLmluZGlyZWN0OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGJ1ZmZlciBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCiAgICAJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlfHVuZGVmaW5lZH0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCiAgICAJICogUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBub3QgYXR0cmlidXRlIGhhcyBiZWVuIGZvdW5kLgogICAgCSAqLwogICAgCWdldEF0dHJpYnV0ZSggbmFtZSApIHsKCiAgICAJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBnaXZlbiBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCiAgICAJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV8SW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBhdHRyaWJ1dGUgdG8gc2V0LgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldEF0dHJpYnV0ZSggbmFtZSwgYXR0cmlidXRlICkgewoKICAgIAkJdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF0gPSBhdHRyaWJ1dGU7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEZWxldGVzIHRoZSBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUgdG8gZGVsZXRlLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWRlbGV0ZUF0dHJpYnV0ZSggbmFtZSApIHsKCiAgICAJCWRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgZ2VvbWV0cnkgaGFzIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIG5hbWUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBhdHRyaWJ1dGUgbmFtZS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgZ2VvbWV0cnkgaGFzIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIG5hbWUgb3Igbm90LgogICAgCSAqLwogICAgCWhhc0F0dHJpYnV0ZSggbmFtZSApIHsKCiAgICAJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFkZHMgYSBncm91cCB0byB0aGlzIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gVGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhpcyBkcmF3IGNhbGwuIFRoYXQgaXMgdGhlIGZpcnN0CiAgICAJICogdmVydGV4IGZvciBub24taW5kZXhlZCBnZW9tZXRyeSwgb3RoZXJ3aXNlIHRoZSBmaXJzdCB0cmlhbmdsZSBpbmRleC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gY291bnQgLSBTcGVjaWZpZXMgaG93IG1hbnkgdmVydGljZXMgKG9yIGluZGljZXMpIGFyZSBwYXJ0IG9mIHRoaXMgZ3JvdXAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYXRlcmlhbEluZGV4PTBdIC0gVGhlIG1hdGVyaWFsIGFycmF5IGluZGV4IHRvIHVzZS4KICAgIAkgKi8KICAgIAlhZGRHcm91cCggc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ID0gMCApIHsKCiAgICAJCXRoaXMuZ3JvdXBzLnB1c2goIHsKCiAgICAJCQlzdGFydDogc3RhcnQsCiAgICAJCQljb3VudDogY291bnQsCiAgICAJCQltYXRlcmlhbEluZGV4OiBtYXRlcmlhbEluZGV4CgogICAgCQl9ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2xlYXJzIGFsbCBncm91cHMuCiAgICAJICovCiAgICAJY2xlYXJHcm91cHMoKSB7CgogICAgCQl0aGlzLmdyb3VwcyA9IFtdOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGRyYXcgcmFuZ2UgZm9yIHRoaXMgZ2VvbWV0cnkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgLSBUaGUgZmlyc3QgdmVydGV4IGZvciBub24taW5kZXhlZCBnZW9tZXRyeSwgb3RoZXJ3aXNlIHRoZSBmaXJzdCB0cmlhbmdsZSBpbmRleC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gY291bnQgLSBGb3Igbm9uLWluZGV4ZWQgQnVmZmVyR2VvbWV0cnksIGBjb3VudGAgaXMgdGhlIG51bWJlciBvZiB2ZXJ0aWNlcyB0byByZW5kZXIuCiAgICAJICogRm9yIGluZGV4ZWQgQnVmZmVyR2VvbWV0cnksIGBjb3VudGAgaXMgdGhlIG51bWJlciBvZiBpbmRpY2VzIHRvIHJlbmRlci4KICAgIAkgKi8KICAgIAlzZXREcmF3UmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCiAgICAJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc3RhcnQ7CiAgICAJCXRoaXMuZHJhd1JhbmdlLmNvdW50ID0gY291bnQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IHRyYW5zZm9ybWF0aW9uIG1hdHJpeCB0byB0aGUgZ2VvbWV0cnkuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgogICAgCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCiAgICAJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlwb3NpdGlvbi5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKICAgIAkJCXBvc2l0aW9uLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IG5vcm1hbCA9IHRoaXMuYXR0cmlidXRlcy5ub3JtYWw7CgogICAgCQlpZiAoIG5vcm1hbCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWNvbnN0IG5vcm1hbE1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCiAgICAJCQlub3JtYWwuYXBwbHlOb3JtYWxNYXRyaXgoIG5vcm1hbE1hdHJpeCApOwoKICAgIAkJCW5vcm1hbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCQljb25zdCB0YW5nZW50ID0gdGhpcy5hdHRyaWJ1dGVzLnRhbmdlbnQ7CgogICAgCQlpZiAoIHRhbmdlbnQgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl0YW5nZW50LnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4ICk7CgogICAgCQkJdGFuZ2VudC5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbGllcyB0aGUgcm90YXRpb24gcmVwcmVzZW50ZWQgYnkgdGhlIFF1YXRlcm5pb24gdG8gdGhlIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24gdG8gYXBwbHkuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJYXBwbHlRdWF0ZXJuaW9uKCBxICkgewoKICAgIAkJX20xJDMubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKTsKCiAgICAJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgYWJvdXQgdGhlIFggYXhpcy4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCiAgICAJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjcm90YXRpb259IGZvciB0eXBpY2FsCiAgICAJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlyb3RhdGVYKCBhbmdsZSApIHsKCiAgICAJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgeC1heGlzCgogICAgCQlfbTEkMy5tYWtlUm90YXRpb25YKCBhbmdsZSApOwoKICAgIAkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSQzICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSb3RhdGVzIHRoZSBnZW9tZXRyeSBhYm91dCB0aGUgWSBheGlzLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKICAgIAkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNyb3RhdGlvbn0gZm9yIHR5cGljYWwKICAgIAkgKiByZWFsLXRpbWUgbWVzaCByb3RhdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXJvdGF0ZVkoIGFuZ2xlICkgewoKICAgIAkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB5LWF4aXMKCiAgICAJCV9tMSQzLm1ha2VSb3RhdGlvblkoIGFuZ2xlICk7CgogICAgCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJvdGF0ZXMgdGhlIGdlb21ldHJ5IGFib3V0IHRoZSBaIGF4aXMuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQogICAgCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3JvdGF0aW9ufSBmb3IgdHlwaWNhbAogICAgCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJcm90YXRlWiggYW5nbGUgKSB7CgogICAgCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHotYXhpcwoKICAgIAkJX20xJDMubWFrZVJvdGF0aW9uWiggYW5nbGUgKTsKCiAgICAJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVHJhbnNsYXRlcyB0aGUgZ2VvbWV0cnkuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQogICAgCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3Bvc2l0aW9ufSBmb3IgdHlwaWNhbAogICAgCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCBvZmZzZXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgeSBvZmZzZXQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBvZmZzZXQuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJdHJhbnNsYXRlKCB4LCB5LCB6ICkgewoKICAgIAkJLy8gdHJhbnNsYXRlIGdlb21ldHJ5CgogICAgCQlfbTEkMy5tYWtlVHJhbnNsYXRpb24oIHgsIHksIHogKTsKCiAgICAJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2NhbGVzIHRoZSBnZW9tZXRyeS4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCiAgICAJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjc2NhbGV9IGZvciB0eXBpY2FsCiAgICAJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB4IHNjYWxlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHkgc2NhbGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBzY2FsZS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzY2FsZSggeCwgeSwgeiApIHsKCiAgICAJCS8vIHNjYWxlIGdlb21ldHJ5CgogICAgCQlfbTEkMy5tYWtlU2NhbGUoIHgsIHksIHogKTsKCiAgICAJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgdG8gZmFjZSBhIHBvaW50IGluIDNEIHNwYWNlLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKICAgIAkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNsb29rQXR9IGZvciB0eXBpY2FsCiAgICAJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZlY3RvciAtIFRoZSB0YXJnZXQgcG9pbnQuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJbG9va0F0KCB2ZWN0b3IgKSB7CgogICAgCQlfb2JqLmxvb2tBdCggdmVjdG9yICk7CgogICAgCQlfb2JqLnVwZGF0ZU1hdHJpeCgpOwoKICAgIAkJdGhpcy5hcHBseU1hdHJpeDQoIF9vYmoubWF0cml4ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDZW50ZXIgdGhlIGdlb21ldHJ5IGJhc2VkIG9uIGl0cyBib3VuZGluZyBib3guCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljZW50ZXIoKSB7CgogICAgCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKICAgIAkJdGhpcy5ib3VuZGluZ0JveC5nZXRDZW50ZXIoIF9vZmZzZXQgKS5uZWdhdGUoKTsKCiAgICAJCXRoaXMudHJhbnNsYXRlKCBfb2Zmc2V0LngsIF9vZmZzZXQueSwgX29mZnNldC56ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEZWZpbmVzIGEgZ2VvbWV0cnkgYnkgY3JlYXRpbmcgYSBgcG9zaXRpb25gIGF0dHJpYnV0ZSBiYXNlZCBvbiB0aGUgZ2l2ZW4gYXJyYXkgb2YgcG9pbnRzLiBUaGUgYXJyYXkKICAgIAkgKiBjYW4gaG9sZCAyRCBvciAzRCB2ZWN0b3JzLiBXaGVuIHVzaW5nIHR3by1kaW1lbnNpb25hbCBkYXRhLCB0aGUgYHpgIGNvb3JkaW5hdGUgZm9yIGFsbCB2ZXJ0aWNlcyBpcwogICAgCSAqIHNldCB0byBgMGAuCiAgICAJICoKICAgIAkgKiBJZiB0aGUgbWV0aG9kIGlzIHVzZWQgd2l0aCBhbiBleGlzdGluZyBgcG9zaXRpb25gIGF0dHJpYnV0ZSwgdGhlIHZlcnRleCBkYXRhIGFyZSBvdmVyd3JpdHRlbiB3aXRoIHRoZQogICAgCSAqIGRhdGEgZnJvbSB0aGUgYXJyYXkuIFRoZSBsZW5ndGggb2YgdGhlIGFycmF5IG11c3QgbWF0Y2ggdGhlIHZlcnRleCBjb3VudC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXk8VmVjdG9yMj58QXJyYXk8VmVjdG9yMz59IHBvaW50cyAtIFRoZSBwb2ludHMuCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0RnJvbVBvaW50cyggcG9pbnRzICkgewoKICAgIAkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKICAgIAkJaWYgKCBwb3NpdGlvbkF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWNvbnN0IHBvc2l0aW9uID0gW107CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IHBvaW50ID0gcG9pbnRzWyBpIF07CiAgICAJCQkJcG9zaXRpb24ucHVzaCggcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgogICAgCQkJfQoKICAgIAkJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIDMgKSApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zdCBsID0gTWF0aC5taW4oIHBvaW50cy5sZW5ndGgsIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICk7IC8vIG1ha2Ugc3VyZSBkYXRhIGRvIG5vdCBleGNlZWQgYnVmZmVyIHNpemUKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQljb25zdCBwb2ludCA9IHBvaW50c1sgaSBdOwogICAgCQkJCXBvc2l0aW9uQXR0cmlidXRlLnNldFhZWiggaSwgcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggcG9pbnRzLmxlbmd0aCA+IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogQnVmZmVyIHNpemUgdG9vIHNtYWxsIGZvciBwb2ludHMgZGF0YS4gVXNlIC5kaXNwb3NlKCkgYW5kIGNyZWF0ZSBhIG5ldyBnZW9tZXRyeS4nICk7CgogICAgCQkJfQoKICAgIAkJCXBvc2l0aW9uQXR0cmlidXRlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIGdlb21ldHJ5LCBhbmQgdXBkYXRlcyB0aGUgYGJvdW5kaW5nQm94YCBtZW1iZXIuCiAgICAJICogVGhlIGJvdW5kaW5nIGJveCBpcyBub3QgY29tcHV0ZWQgYnkgdGhlIGVuZ2luZTsgaXQgbXVzdCBiZSBjb21wdXRlZCBieSB5b3VyIGFwcC4KICAgIAkgKiBZb3UgbWF5IG5lZWQgdG8gcmVjb21wdXRlIHRoZSBib3VuZGluZyBib3ggaWYgdGhlIGdlb21ldHJ5IHZlcnRpY2VzIGFyZSBtb2RpZmllZC4KICAgIAkgKi8KICAgIAljb21wdXRlQm91bmRpbmdCb3goKSB7CgogICAgCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgogICAgCQl9CgogICAgCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgIAkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCiAgICAJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIGJveC4nLCB0aGlzICk7CgogICAgCQkJdGhpcy5ib3VuZGluZ0JveC5zZXQoCiAgICAJCQkJbmV3IFZlY3RvcjMoIC0gSW5maW5pdHksIC0gSW5maW5pdHksIC0gSW5maW5pdHkgKSwKICAgIAkJCQluZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApCiAgICAJCQkpOwoKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl0aGlzLmJvdW5kaW5nQm94LnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgogICAgCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCiAgICAJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CiAgICAJCQkJCV9ib3gkMi5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKICAgIAkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKICAgIAkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCB0aGlzLmJvdW5kaW5nQm94Lm1pbiwgX2JveCQyLm1pbiApOwogICAgCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDggKTsKCiAgICAJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggdGhpcy5ib3VuZGluZ0JveC5tYXgsIF9ib3gkMi5tYXggKTsKICAgIAkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ4ICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX2JveCQyLm1pbiApOwogICAgCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfYm94JDIubWF4ICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRoaXMuYm91bmRpbmdCb3gubWFrZUVtcHR5KCk7CgogICAgCQl9CgogICAgCQlpZiAoIGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi54ICkgfHwgaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnkgKSB8fCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueiApICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogQ29tcHV0ZWQgbWluL21heCBoYXZlIE5hTiB2YWx1ZXMuIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIG9mIHRoZSBnZW9tZXRyeSwgYW5kIHVwZGF0ZXMgdGhlIGBib3VuZGluZ1NwaGVyZWAgbWVtYmVyLgogICAgCSAqIFRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIHdoZW4gaXQgaXMgbmVlZGVkLCBlLmcuLCBmb3IgcmF5IGNhc3Rpbmcgb3IgdmlldyBmcnVzdHVtIGN1bGxpbmcuCiAgICAJICogWW91IG1heSBuZWVkIHRvIHJlY29tcHV0ZSB0aGUgYm91bmRpbmcgc3BoZXJlIGlmIHRoZSBnZW9tZXRyeSB2ZXJ0aWNlcyBhcmUgbW9kaWZpZWQuCiAgICAJICovCiAgICAJY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCkgewoKICAgIAkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKICAgIAkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgogICAgCQl9CgogICAgCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgIAkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCiAgICAJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIHNwaGVyZS4nLCB0aGlzICk7CgogICAgCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5zZXQoIG5ldyBWZWN0b3IzKCksIEluZmluaXR5ICk7CgogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJaWYgKCBwb3NpdGlvbiApIHsKCiAgICAJCQkvLyBmaXJzdCwgZmluZCB0aGUgY2VudGVyIG9mIHRoZSBib3VuZGluZyBzcGhlcmUKCiAgICAJCQljb25zdCBjZW50ZXIgPSB0aGlzLmJvdW5kaW5nU3BoZXJlLmNlbnRlcjsKCiAgICAJCQlfYm94JDIuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24gKTsKCiAgICAJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKICAgIAkJCWlmICggbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gKSB7CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKICAgIAkJCQkJX2JveE1vcnBoVGFyZ2V0cy5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKICAgIAkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKICAgIAkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWluLCBfYm94TW9ycGhUYXJnZXRzLm1pbiApOwogICAgCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKICAgIAkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWF4LCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwogICAgCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlfYm94JDIuZXhwYW5kQnlQb2ludCggX2JveE1vcnBoVGFyZ2V0cy5taW4gKTsKICAgIAkJCQkJCV9ib3gkMi5leHBhbmRCeVBvaW50KCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCV9ib3gkMi5nZXRDZW50ZXIoIGNlbnRlciApOwoKICAgIAkJCS8vIHNlY29uZCwgdHJ5IHRvIGZpbmQgYSBib3VuZGluZ1NwaGVyZSB3aXRoIGEgcmFkaXVzIHNtYWxsZXIgdGhhbiB0aGUKICAgIAkJCS8vIGJvdW5kaW5nU3BoZXJlIG9mIHRoZSBib3VuZGluZ0JveDogc3FydCgzKSBzbWFsbGVyIGluIHRoZSBiZXN0IGNhc2UKCiAgICAJCQlsZXQgbWF4UmFkaXVzU3EgPSAwOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb3NpdGlvbi5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGkgKTsKCiAgICAJCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggX3ZlY3RvciQ4ICkgKTsKCiAgICAJCQl9CgogICAgCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCiAgICAJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CiAgICAJCQkJCWNvbnN0IG1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCiAgICAJCQkJCWZvciAoIGxldCBqID0gMCwgamwgPSBtb3JwaEF0dHJpYnV0ZS5jb3VudDsgaiA8IGpsOyBqICsrICkgewoKICAgIAkJCQkJCV92ZWN0b3IkOC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgaiApOwoKICAgIAkJCQkJCWlmICggbW9ycGhUYXJnZXRzUmVsYXRpdmUgKSB7CgogICAgCQkJCQkJCV9vZmZzZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGogKTsKICAgIAkJCQkJCQlfdmVjdG9yJDguYWRkKCBfb2Zmc2V0ICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IkOCApICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgogICAgCQkJaWYgKCBpc05hTiggdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgKSApIHsKCiAgICAJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENhbGN1bGF0ZXMgYW5kIGFkZHMgYSB0YW5nZW50IGF0dHJpYnV0ZSB0byB0aGlzIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogVGhlIGNvbXB1dGF0aW9uIGlzIG9ubHkgc3VwcG9ydGVkIGZvciBpbmRleGVkIGdlb21ldHJpZXMgYW5kIGlmIHBvc2l0aW9uLCBub3JtYWwsIGFuZCB1diBhdHRyaWJ1dGVzCiAgICAJICogYXJlIGRlZmluZWQuIFdoZW4gdXNpbmcgYSB0YW5nZW50IHNwYWNlIG5vcm1hbCBtYXAsIHByZWZlciB0aGUgTWlra1RTcGFjZSBhbGdvcml0aG0gcHJvdmlkZWQgYnkKICAgIAkgKiB7QGxpbmsgQnVmZmVyR2VvbWV0cnlVdGlscyNjb21wdXRlTWlra1RTcGFjZVRhbmdlbnRzfSBpbnN0ZWFkLgogICAgCSAqLwogICAgCWNvbXB1dGVUYW5nZW50cygpIHsKCiAgICAJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKICAgIAkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCiAgICAJCS8vIGJhc2VkIG9uIGh0dHA6Ly93d3cudGVyYXRob24uY29tL2NvZGUvdGFuZ2VudC5odG1sCiAgICAJCS8vIChwZXIgdmVydGV4IHRhbmdlbnRzKQoKICAgIAkJaWYgKCBpbmRleCA9PT0gbnVsbCB8fAogICAgCQkJIGF0dHJpYnV0ZXMucG9zaXRpb24gPT09IHVuZGVmaW5lZCB8fAogICAgCQkJIGF0dHJpYnV0ZXMubm9ybWFsID09PSB1bmRlZmluZWQgfHwKICAgIAkJCSBhdHRyaWJ1dGVzLnV2ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY29tcHV0ZVRhbmdlbnRzKCkgZmFpbGVkLiBNaXNzaW5nIHJlcXVpcmVkIGF0dHJpYnV0ZXMgKGluZGV4LCBwb3NpdGlvbiwgbm9ybWFsIG9yIHV2KScgKTsKICAgIAkJCXJldHVybjsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgIAkJY29uc3Qgbm9ybWFsQXR0cmlidXRlID0gYXR0cmlidXRlcy5ub3JtYWw7CiAgICAJCWNvbnN0IHV2QXR0cmlidXRlID0gYXR0cmlidXRlcy51djsKCiAgICAJCWlmICggdGhpcy5oYXNBdHRyaWJ1dGUoICd0YW5nZW50JyApID09PSBmYWxzZSApIHsKCiAgICAJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3RhbmdlbnQnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBuZXcgRmxvYXQzMkFycmF5KCA0ICogcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKSwgNCApICk7CgogICAgCQl9CgogICAgCQljb25zdCB0YW5nZW50QXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICd0YW5nZW50JyApOwoKICAgIAkJY29uc3QgdGFuMSA9IFtdLCB0YW4yID0gW107CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSArKyApIHsKCiAgICAJCQl0YW4xWyBpIF0gPSBuZXcgVmVjdG9yMygpOwogICAgCQkJdGFuMlsgaSBdID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHZBID0gbmV3IFZlY3RvcjMoKSwKICAgIAkJCXZCID0gbmV3IFZlY3RvcjMoKSwKICAgIAkJCXZDID0gbmV3IFZlY3RvcjMoKSwKCiAgICAJCQl1dkEgPSBuZXcgVmVjdG9yMigpLAogICAgCQkJdXZCID0gbmV3IFZlY3RvcjIoKSwKICAgIAkJCXV2QyA9IG5ldyBWZWN0b3IyKCksCgogICAgCQkJc2RpciA9IG5ldyBWZWN0b3IzKCksCiAgICAJCQl0ZGlyID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCWZ1bmN0aW9uIGhhbmRsZVRyaWFuZ2xlKCBhLCBiLCBjICkgewoKICAgIAkJCXZBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBhICk7CiAgICAJCQl2Qi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgYiApOwogICAgCQkJdkMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGMgKTsKCiAgICAJCQl1dkEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXZBdHRyaWJ1dGUsIGEgKTsKICAgIAkJCXV2Qi5mcm9tQnVmZmVyQXR0cmlidXRlKCB1dkF0dHJpYnV0ZSwgYiApOwogICAgCQkJdXZDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2QXR0cmlidXRlLCBjICk7CgogICAgCQkJdkIuc3ViKCB2QSApOwogICAgCQkJdkMuc3ViKCB2QSApOwoKICAgIAkJCXV2Qi5zdWIoIHV2QSApOwogICAgCQkJdXZDLnN1YiggdXZBICk7CgogICAgCQkJY29uc3QgciA9IDEuMCAvICggdXZCLnggKiB1dkMueSAtIHV2Qy54ICogdXZCLnkgKTsKCiAgICAJCQkvLyBzaWxlbnRseSBpZ25vcmUgZGVnZW5lcmF0ZSB1diB0cmlhbmdsZXMgaGF2aW5nIGNvaW5jaWRlbnQgb3IgY29saW5lYXIgdmVydGljZXMKCiAgICAJCQlpZiAoICEgaXNGaW5pdGUoIHIgKSApIHJldHVybjsKCiAgICAJCQlzZGlyLmNvcHkoIHZCICkubXVsdGlwbHlTY2FsYXIoIHV2Qy55ICkuYWRkU2NhbGVkVmVjdG9yKCB2QywgLSB1dkIueSApLm11bHRpcGx5U2NhbGFyKCByICk7CiAgICAJCQl0ZGlyLmNvcHkoIHZDICkubXVsdGlwbHlTY2FsYXIoIHV2Qi54ICkuYWRkU2NhbGVkVmVjdG9yKCB2QiwgLSB1dkMueCApLm11bHRpcGx5U2NhbGFyKCByICk7CgogICAgCQkJdGFuMVsgYSBdLmFkZCggc2RpciApOwogICAgCQkJdGFuMVsgYiBdLmFkZCggc2RpciApOwogICAgCQkJdGFuMVsgYyBdLmFkZCggc2RpciApOwoKICAgIAkJCXRhbjJbIGEgXS5hZGQoIHRkaXIgKTsKICAgIAkJCXRhbjJbIGIgXS5hZGQoIHRkaXIgKTsKICAgIAkJCXRhbjJbIGMgXS5hZGQoIHRkaXIgKTsKCiAgICAJCX0KCiAgICAJCWxldCBncm91cHMgPSB0aGlzLmdyb3VwczsKCiAgICAJCWlmICggZ3JvdXBzLmxlbmd0aCA9PT0gMCApIHsKCiAgICAJCQlncm91cHMgPSBbIHsKICAgIAkJCQlzdGFydDogMCwKICAgIAkJCQljb3VudDogaW5kZXguY291bnQKICAgIAkJCX0gXTsKCiAgICAJCX0KCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgogICAgCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCiAgICAJCQljb25zdCBzdGFydCA9IGdyb3VwLnN0YXJ0OwogICAgCQkJY29uc3QgY291bnQgPSBncm91cC5jb3VudDsKCiAgICAJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IHN0YXJ0ICsgY291bnQ7IGogPCBqbDsgaiArPSAzICkgewoKICAgIAkJCQloYW5kbGVUcmlhbmdsZSgKICAgIAkJCQkJaW5kZXguZ2V0WCggaiArIDAgKSwKICAgIAkJCQkJaW5kZXguZ2V0WCggaiArIDEgKSwKICAgIAkJCQkJaW5kZXguZ2V0WCggaiArIDIgKQogICAgCQkJCSk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJY29uc3QgdG1wID0gbmV3IFZlY3RvcjMoKSwgdG1wMiA9IG5ldyBWZWN0b3IzKCk7CiAgICAJCWNvbnN0IG4gPSBuZXcgVmVjdG9yMygpLCBuMiA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQlmdW5jdGlvbiBoYW5kbGVWZXJ0ZXgoIHYgKSB7CgogICAgCQkJbi5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHYgKTsKICAgIAkJCW4yLmNvcHkoIG4gKTsKCiAgICAJCQljb25zdCB0ID0gdGFuMVsgdiBdOwoKICAgIAkJCS8vIEdyYW0tU2NobWlkdCBvcnRob2dvbmFsaXplCgogICAgCQkJdG1wLmNvcHkoIHQgKTsKICAgIAkJCXRtcC5zdWIoIG4ubXVsdGlwbHlTY2FsYXIoIG4uZG90KCB0ICkgKSApLm5vcm1hbGl6ZSgpOwoKICAgIAkJCS8vIENhbGN1bGF0ZSBoYW5kZWRuZXNzCgogICAgCQkJdG1wMi5jcm9zc1ZlY3RvcnMoIG4yLCB0ICk7CiAgICAJCQljb25zdCB0ZXN0ID0gdG1wMi5kb3QoIHRhbjJbIHYgXSApOwogICAgCQkJY29uc3QgdyA9ICggdGVzdCA8IDAuMCApID8gLTEgOiAxLjA7CgogICAgCQkJdGFuZ2VudEF0dHJpYnV0ZS5zZXRYWVpXKCB2LCB0bXAueCwgdG1wLnksIHRtcC56LCB3ICk7CgogICAgCQl9CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyArKyBpICkgewoKICAgIAkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgogICAgCQkJY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKICAgIAkJCWNvbnN0IGNvdW50ID0gZ3JvdXAuY291bnQ7CgogICAgCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMyApIHsKCiAgICAJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMCApICk7CiAgICAJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMSApICk7CiAgICAJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMiApICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIENvbXB1dGVzIHZlcnRleCBub3JtYWxzIGZvciB0aGUgZ2l2ZW4gdmVydGV4IGRhdGEuIEZvciBpbmRleGVkIGdlb21ldHJpZXMsIHRoZSBtZXRob2Qgc2V0cwogICAgCSAqIGVhY2ggdmVydGV4IG5vcm1hbCB0byBiZSB0aGUgYXZlcmFnZSBvZiB0aGUgZmFjZSBub3JtYWxzIG9mIHRoZSBmYWNlcyB0aGF0IHNoYXJlIHRoYXQgdmVydGV4LgogICAgCSAqIEZvciBub24taW5kZXhlZCBnZW9tZXRyaWVzLCB2ZXJ0aWNlcyBhcmUgbm90IHNoYXJlZCwgYW5kIHRoZSBtZXRob2Qgc2V0cyBlYWNoIHZlcnRleCBub3JtYWwKICAgIAkgKiB0byBiZSB0aGUgc2FtZSBhcyB0aGUgZmFjZSBub3JtYWwuCiAgICAJICovCiAgICAJY29tcHV0ZVZlcnRleE5vcm1hbHMoKSB7CgogICAgCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CiAgICAJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCiAgICAJCWlmICggcG9zaXRpb25BdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlsZXQgbm9ybWFsQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdub3JtYWwnICk7CgogICAgCQkJaWYgKCBub3JtYWxBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJbm9ybWFsQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKiAzICksIDMgKTsKICAgIAkJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5vcm1hbEF0dHJpYnV0ZSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCS8vIHJlc2V0IGV4aXN0aW5nIG5vcm1hbHMgdG8gemVybwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbm9ybWFsQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpLCAwLCAwLCAwICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJY29uc3QgcEEgPSBuZXcgVmVjdG9yMygpLCBwQiA9IG5ldyBWZWN0b3IzKCksIHBDID0gbmV3IFZlY3RvcjMoKTsKICAgIAkJCWNvbnN0IG5BID0gbmV3IFZlY3RvcjMoKSwgbkIgPSBuZXcgVmVjdG9yMygpLCBuQyA9IG5ldyBWZWN0b3IzKCk7CiAgICAJCQljb25zdCBjYiA9IG5ldyBWZWN0b3IzKCksIGFiID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCQkvLyBpbmRleGVkIGVsZW1lbnRzCgogICAgCQkJaWYgKCBpbmRleCApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGluZGV4LmNvdW50OyBpIDwgaWw7IGkgKz0gMyApIHsKCiAgICAJCQkJCWNvbnN0IHZBID0gaW5kZXguZ2V0WCggaSArIDAgKTsKICAgIAkJCQkJY29uc3QgdkIgPSBpbmRleC5nZXRYKCBpICsgMSApOwogICAgCQkJCQljb25zdCB2QyA9IGluZGV4LmdldFgoIGkgKyAyICk7CgogICAgCQkJCQlwQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgdkEgKTsKICAgIAkJCQkJcEIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZCICk7CiAgICAJCQkJCXBDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QyApOwoKICAgIAkJCQkJY2Iuc3ViVmVjdG9ycyggcEMsIHBCICk7CiAgICAJCQkJCWFiLnN1YlZlY3RvcnMoIHBBLCBwQiApOwogICAgCQkJCQljYi5jcm9zcyggYWIgKTsKCiAgICAJCQkJCW5BLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbEF0dHJpYnV0ZSwgdkEgKTsKICAgIAkJCQkJbkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2QiApOwogICAgCQkJCQluQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHZDICk7CgogICAgCQkJCQluQS5hZGQoIGNiICk7CiAgICAJCQkJCW5CLmFkZCggY2IgKTsKICAgIAkJCQkJbkMuYWRkKCBjYiApOwoKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkEsIG5BLngsIG5BLnksIG5BLnogKTsKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkIsIG5CLngsIG5CLnksIG5CLnogKTsKICAgIAkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkMsIG5DLngsIG5DLnksIG5DLnogKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCS8vIG5vbi1pbmRleGVkIGVsZW1lbnRzICh1bmNvbm5lY3RlZCB0cmlhbmdsZSBzb3VwKQoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBpbDsgaSArPSAzICkgewoKICAgIAkJCQkJcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAwICk7CiAgICAJCQkJCXBCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMSApOwogICAgCQkJCQlwQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDIgKTsKCiAgICAJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwogICAgCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKICAgIAkJCQkJY2IuY3Jvc3MoIGFiICk7CgogICAgCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMCwgY2IueCwgY2IueSwgY2IueiApOwogICAgCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMSwgY2IueCwgY2IueSwgY2IueiApOwogICAgCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMiwgY2IueCwgY2IueSwgY2IueiApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOwoKICAgIAkJCW5vcm1hbEF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRW5zdXJlcyBldmVyeSBub3JtYWwgdmVjdG9yIGluIGEgZ2VvbWV0cnkgd2lsbCBoYXZlIGEgbWFnbml0dWRlIG9mIGAxYC4gVGhpcyB3aWxsCiAgICAJICogY29ycmVjdCBsaWdodGluZyBvbiB0aGUgZ2VvbWV0cnkgc3VyZmFjZXMuCiAgICAJICovCiAgICAJbm9ybWFsaXplTm9ybWFscygpIHsKCiAgICAJCWNvbnN0IG5vcm1hbHMgPSB0aGlzLmF0dHJpYnV0ZXMubm9ybWFsOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5vcm1hbHMuY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgaSApOwoKICAgIAkJCV92ZWN0b3IkOC5ub3JtYWxpemUoKTsKCiAgICAJCQlub3JtYWxzLnNldFhZWiggaSwgX3ZlY3RvciQ4LngsIF92ZWN0b3IkOC55LCBfdmVjdG9yJDgueiApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybiBhIG5ldyBub24taW5kZXggdmVyc2lvbiBvZiB0aGlzIGluZGV4ZWQgZ2VvbWV0cnkuIElmIHRoZSBnZW9tZXRyeQogICAgCSAqIGlzIGFscmVhZHkgbm9uLWluZGV4ZWQsIHRoZSBtZXRob2QgaXMgYSBOT09QLgogICAgCSAqCiAgICAJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IFRoZSBub24taW5kZXhlZCB2ZXJzaW9uIG9mIHRoaXMgaW5kZXhlZCBnZW9tZXRyeS4KICAgIAkgKi8KICAgIAl0b05vbkluZGV4ZWQoKSB7CgogICAgCQlmdW5jdGlvbiBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKSB7CgogICAgCQkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CiAgICAJCQljb25zdCBpdGVtU2l6ZSA9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKICAgIAkJCWNvbnN0IG5vcm1hbGl6ZWQgPSBhdHRyaWJ1dGUubm9ybWFsaXplZDsKCiAgICAJCQljb25zdCBhcnJheTIgPSBuZXcgYXJyYXkuY29uc3RydWN0b3IoIGluZGljZXMubGVuZ3RoICogaXRlbVNpemUgKTsKCiAgICAJCQlsZXQgaW5kZXggPSAwLCBpbmRleDIgPSAwOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IGluZGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogYXR0cmlidXRlLmRhdGEuc3RyaWRlICsgYXR0cmlidXRlLm9mZnNldDsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogaXRlbVNpemU7CgogICAgCQkJCX0KCiAgICAJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgaXRlbVNpemU7IGogKysgKSB7CgogICAgCQkJCQlhcnJheTJbIGluZGV4MiArKyBdID0gYXJyYXlbIGluZGV4ICsrIF07CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGFycmF5MiwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCiAgICAJCX0KCiAgICAJCS8vCgogICAgCQlpZiAoIHRoaXMuaW5kZXggPT09IG51bGwgKSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuJyApOwogICAgCQkJcmV0dXJuIHRoaXM7CgogICAgCQl9CgogICAgCQljb25zdCBnZW9tZXRyeTIgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCiAgICAJCWNvbnN0IGluZGljZXMgPSB0aGlzLmluZGV4LmFycmF5OwogICAgCQljb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKICAgIAkJLy8gYXR0cmlidXRlcwoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBhdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCiAgICAJCQlnZW9tZXRyeTIuc2V0QXR0cmlidXRlKCBuYW1lLCBuZXdBdHRyaWJ1dGUgKTsKCiAgICAJCX0KCiAgICAJCS8vIG1vcnBoIGF0dHJpYnV0ZXMKCiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzOwoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgogICAgCQkJY29uc3QgbW9ycGhBcnJheSA9IFtdOwogICAgCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsgLy8gbW9ycGhBdHRyaWJ1dGU6IGFycmF5IG9mIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGVzCgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQljb25zdCBhdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZVsgaSBdOwoKICAgIAkJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCiAgICAJCQkJbW9ycGhBcnJheS5wdXNoKCBuZXdBdHRyaWJ1dGUgKTsKCiAgICAJCQl9CgogICAgCQkJZ2VvbWV0cnkyLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gbW9ycGhBcnJheTsKCiAgICAJCX0KCiAgICAJCWdlb21ldHJ5Mi5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgogICAgCQkvLyBncm91cHMKCiAgICAJCWNvbnN0IGdyb3VwcyA9IHRoaXMuZ3JvdXBzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKICAgIAkJCWdlb21ldHJ5Mi5hZGRHcm91cCggZ3JvdXAuc3RhcnQsIGdyb3VwLmNvdW50LCBncm91cC5tYXRlcmlhbEluZGV4ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gZ2VvbWV0cnkyOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNlcmlhbGl6ZXMgdGhlIGdlb21ldHJ5IGludG8gSlNPTi4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCiAgICAJICovCiAgICAJdG9KU09OKCkgewoKICAgIAkJY29uc3QgZGF0YSA9IHsKICAgIAkJCW1ldGFkYXRhOiB7CiAgICAJCQkJdmVyc2lvbjogNC43LAogICAgCQkJCXR5cGU6ICdCdWZmZXJHZW9tZXRyeScsCiAgICAJCQkJZ2VuZXJhdG9yOiAnQnVmZmVyR2VvbWV0cnkudG9KU09OJwogICAgCQkJfQogICAgCQl9OwoKICAgIAkJLy8gc3RhbmRhcmQgQnVmZmVyR2VvbWV0cnkgc2VyaWFsaXphdGlvbgoKICAgIAkJZGF0YS51dWlkID0gdGhpcy51dWlkOwogICAgCQlkYXRhLnR5cGUgPSB0aGlzLnR5cGU7CiAgICAJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKICAgIAkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBkYXRhLnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCiAgICAJCWlmICggdGhpcy5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKCiAgICAJCQlmb3IgKCBjb25zdCBrZXkgaW4gcGFyYW1ldGVycyApIHsKCiAgICAJCQkJaWYgKCBwYXJhbWV0ZXJzWyBrZXkgXSAhPT0gdW5kZWZpbmVkICkgZGF0YVsga2V5IF0gPSBwYXJhbWV0ZXJzWyBrZXkgXTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGRhdGE7CgogICAgCQl9CgogICAgCQkvLyBmb3Igc2ltcGxpY2l0eSB0aGUgY29kZSBhc3N1bWVzIGF0dHJpYnV0ZXMgYXJlIG5vdCBzaGFyZWQgYWNyb3NzIGdlb21ldHJpZXMsIHNlZSAjMTU4MTEKCiAgICAJCWRhdGEuZGF0YSA9IHsgYXR0cmlidXRlczoge30gfTsKCiAgICAJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCiAgICAJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJZGF0YS5kYXRhLmluZGV4ID0gewogICAgCQkJCXR5cGU6IGluZGV4LmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCiAgICAJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBpbmRleC5hcnJheSApCiAgICAJCQl9OwoKICAgIAkJfQoKICAgIAkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCiAgICAJCWZvciAoIGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoKICAgIAkJCWRhdGEuZGF0YS5hdHRyaWJ1dGVzWyBrZXkgXSA9IGF0dHJpYnV0ZS50b0pTT04oIGRhdGEuZGF0YSApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0ge307CiAgICAJCWxldCBoYXNNb3JwaEF0dHJpYnV0ZXMgPSBmYWxzZTsKCiAgICAJCWZvciAoIGNvbnN0IGtleSBpbiB0aGlzLm1vcnBoQXR0cmlidXRlcyApIHsKCiAgICAJCQljb25zdCBhdHRyaWJ1dGVBcnJheSA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzWyBrZXkgXTsKCiAgICAJCQljb25zdCBhcnJheSA9IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhdHRyaWJ1dGVBcnJheS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlQXJyYXlbIGkgXTsKCiAgICAJCQkJYXJyYXkucHVzaCggYXR0cmlidXRlLnRvSlNPTiggZGF0YS5kYXRhICkgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBhcnJheS5sZW5ndGggPiAwICkgewoKICAgIAkJCQltb3JwaEF0dHJpYnV0ZXNbIGtleSBdID0gYXJyYXk7CgogICAgCQkJCWhhc01vcnBoQXR0cmlidXRlcyA9IHRydWU7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBoYXNNb3JwaEF0dHJpYnV0ZXMgKSB7CgogICAgCQkJZGF0YS5kYXRhLm1vcnBoQXR0cmlidXRlcyA9IG1vcnBoQXR0cmlidXRlczsKICAgIAkJCWRhdGEuZGF0YS5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgogICAgCQl9CgogICAgCQljb25zdCBncm91cHMgPSB0aGlzLmdyb3VwczsKCiAgICAJCWlmICggZ3JvdXBzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJZGF0YS5kYXRhLmdyb3VwcyA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBncm91cHMgKSApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgYm91bmRpbmdTcGhlcmUgPSB0aGlzLmJvdW5kaW5nU3BoZXJlOwoKICAgIAkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQlkYXRhLmRhdGEuYm91bmRpbmdTcGhlcmUgPSBib3VuZGluZ1NwaGVyZS50b0pTT04oKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBkYXRhOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBuZXcgZ2VvbWV0cnkgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGdlb21ldHJ5IHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBzb3VyY2UgLSBUaGUgZ2VvbWV0cnkgdG8gY29weS4KICAgIAkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQkvLyByZXNldAoKICAgIAkJdGhpcy5pbmRleCA9IG51bGw7CiAgICAJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwogICAgCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwogICAgCQl0aGlzLmdyb3VwcyA9IFtdOwogICAgCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKICAgIAkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgogICAgCQkvLyB1c2VkIGZvciBzdG9yaW5nIGNsb25lZCwgc2hhcmVkIGRhdGEKCiAgICAJCWNvbnN0IGRhdGEgPSB7fTsKCiAgICAJCS8vIG5hbWUKCiAgICAJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKICAgIAkJLy8gaW5kZXgKCiAgICAJCWNvbnN0IGluZGV4ID0gc291cmNlLmluZGV4OwoKICAgIAkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLnNldEluZGV4KCBpbmRleC5jbG9uZSgpICk7CgogICAgCQl9CgogICAgCQkvLyBhdHRyaWJ1dGVzCgogICAgCQljb25zdCBhdHRyaWJ1dGVzID0gc291cmNlLmF0dHJpYnV0ZXM7CgogICAgCQlmb3IgKCBjb25zdCBuYW1lIGluIGF0dHJpYnV0ZXMgKSB7CgogICAgCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlc1sgbmFtZSBdOwogICAgCQkJdGhpcy5zZXRBdHRyaWJ1dGUoIG5hbWUsIGF0dHJpYnV0ZS5jbG9uZSggZGF0YSApICk7CgogICAgCQl9CgogICAgCQkvLyBtb3JwaCBhdHRyaWJ1dGVzCgogICAgCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBzb3VyY2UubW9ycGhBdHRyaWJ1dGVzOwoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgogICAgCQkJY29uc3QgYXJyYXkgPSBbXTsKICAgIAkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF07IC8vIG1vcnBoQXR0cmlidXRlOiBhcnJheSBvZiBGbG9hdDMyQnVmZmVyQXR0cmlidXRlcwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCWFycmF5LnB1c2goIG1vcnBoQXR0cmlidXRlWyBpIF0uY2xvbmUoIGRhdGEgKSApOwoKICAgIAkJCX0KCiAgICAJCQl0aGlzLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gYXJyYXk7CgogICAgCQl9CgogICAgCQl0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gc291cmNlLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKICAgIAkJLy8gZ3JvdXBzCgogICAgCQljb25zdCBncm91cHMgPSBzb3VyY2UuZ3JvdXBzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKICAgIAkJCXRoaXMuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKICAgIAkJfQoKICAgIAkJLy8gYm91bmRpbmcgYm94CgogICAgCQljb25zdCBib3VuZGluZ0JveCA9IHNvdXJjZS5ib3VuZGluZ0JveDsKCiAgICAJCWlmICggYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5ib3VuZGluZ0JveCA9IGJvdW5kaW5nQm94LmNsb25lKCk7CgogICAgCQl9CgogICAgCQkvLyBib3VuZGluZyBzcGhlcmUKCiAgICAJCWNvbnN0IGJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlOwoKICAgIAkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCiAgICAJCX0KCiAgICAJCS8vIGRyYXcgcmFuZ2UKCiAgICAJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc291cmNlLmRyYXdSYW5nZS5zdGFydDsKICAgIAkJdGhpcy5kcmF3UmFuZ2UuY291bnQgPSBzb3VyY2UuZHJhd1JhbmdlLmNvdW50OwoKICAgIAkJLy8gdXNlciBkYXRhCgogICAgCQl0aGlzLnVzZXJEYXRhID0gc291cmNlLnVzZXJEYXRhOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRnJlZXMgdGhlIEdQVS1yZWxhdGVkIHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzCiAgICAJICogbWV0aG9kIHdoZW5ldmVyIHRoaXMgaW5zdGFuY2UgaXMgbm8gbG9uZ2VyIHVzZWQgaW4geW91ciBhcHAuCiAgICAJICoKICAgIAkgKiBAZmlyZXMgQnVmZmVyR2VvbWV0cnkjZGlzcG9zZQogICAgCSAqLwogICAgCWRpc3Bvc2UoKSB7CgogICAgCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfaW52ZXJzZU1hdHJpeCQzID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwogICAgY29uc3QgX3JheSQzID0gLypAX19QVVJFX18qLyBuZXcgUmF5KCk7CiAgICBjb25zdCBfc3BoZXJlJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKICAgIGNvbnN0IF9zcGhlcmVIaXRBdCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfdkEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF92QiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ZDJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgY29uc3QgX3RlbXBBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX21vcnBoQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICBjb25zdCBfaW50ZXJzZWN0aW9uUG9pbnQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICAvKioKICAgICAqIENsYXNzIHJlcHJlc2VudGluZyB0cmlhbmd1bGFyIHBvbHlnb24gbWVzaCBiYXNlZCBvYmplY3RzLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMSwgMSwgMSApOwogICAgICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZjAwIH0gKTsKICAgICAqIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CiAgICAgKiBzY2VuZS5hZGQoIG1lc2ggKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBPYmplY3QzRAogICAgICovCiAgICBjbGFzcyBNZXNoIGV4dGVuZHMgT2JqZWN0M0QgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2guCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBbZ2VvbWV0cnldIC0gVGhlIG1lc2ggZ2VvbWV0cnkuCiAgICAJICogQHBhcmFtIHtNYXRlcmlhbHxBcnJheTxNYXRlcmlhbD59IFttYXRlcmlhbF0gLSBUaGUgbWVzaCBtYXRlcmlhbC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKSwgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoKSApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc01lc2ggPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ01lc2gnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBtZXNoIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QnVmZmVyR2VvbWV0cnl9CiAgICAJCSAqLwogICAgCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgogICAgCQkvKioKICAgIAkJICogVGhlIG1lc2ggbWF0ZXJpYWwuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtNYXRlcmlhbHxBcnJheTxNYXRlcmlhbD59CiAgICAJCSAqIEBkZWZhdWx0IE1lc2hCYXNpY01hdGVyaWFsCiAgICAJCSAqLwogICAgCQl0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgogICAgCQkvKioKICAgIAkJICogQSBkaWN0aW9uYXJ5IHJlcHJlc2VudGluZyB0aGUgbW9ycGggdGFyZ2V0cyBpbiB0aGUgZ2VvbWV0cnkuIFRoZSBrZXkgaXMgdGhlCiAgICAJCSAqIG1vcnBoIHRhcmdldHMgbmFtZSwgdGhlIHZhbHVlIGl0cyBhdHRyaWJ1dGUgaW5kZXguIFRoaXMgbWVtYmVyIGlzIGB1bmRlZmluZWRgCiAgICAJCSAqIGJ5IGRlZmF1bHQgYW5kIG9ubHkgc2V0IHdoZW4gbW9ycGggdGFyZ2V0cyBhcmUgZGV0ZWN0ZWQgaW4gdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0PFN0cmluZyxudW1iZXI+fHVuZGVmaW5lZH0KICAgIAkJICogQGRlZmF1bHQgdW5kZWZpbmVkCiAgICAJCSAqLwogICAgCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHVuZGVmaW5lZDsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBhcnJheSBvZiB3ZWlnaHRzIHR5cGljYWxseSBpbiB0aGUgcmFuZ2UgYFswLDFdYCB0aGF0IHNwZWNpZnkgaG93IG11Y2ggb2YgdGhlIG1vcnBoCiAgICAJCSAqIGlzIGFwcGxpZWQuIFRoaXMgbWVtYmVyIGlzIGB1bmRlZmluZWRgIGJ5IGRlZmF1bHQgYW5kIG9ubHkgc2V0IHdoZW4gbW9ycGggdGFyZ2V0cyBhcmUKICAgIAkJICogZGV0ZWN0ZWQgaW4gdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPnx1bmRlZmluZWR9CiAgICAJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAogICAgCQkgKi8KICAgIAkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSB1bmRlZmluZWQ7CgogICAgCQkvKioKICAgIAkJICogVGhlIG51bWJlciBvZiBpbnN0YW5jZXMgb2YgdGhpcyBtZXNoLgogICAgCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdQVVJlbmRlcmVyfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5jb3VudCA9IDE7CgogICAgCQl0aGlzLnVwZGF0ZU1vcnBoVGFyZ2V0cygpOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKICAgIAkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCiAgICAJCWlmICggc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5zbGljZSgpOwoKICAgIAkJfQoKICAgIAkJaWYgKCBzb3VyY2UubW9ycGhUYXJnZXREaWN0aW9uYXJ5ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSApOwoKICAgIAkJfQoKICAgIAkJdGhpcy5tYXRlcmlhbCA9IEFycmF5LmlzQXJyYXkoIHNvdXJjZS5tYXRlcmlhbCApID8gc291cmNlLm1hdGVyaWFsLnNsaWNlKCkgOiBzb3VyY2UubWF0ZXJpYWw7CiAgICAJCXRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSB2YWx1ZXMgb2Yge0BsaW5rIE1lc2gjbW9ycGhUYXJnZXREaWN0aW9uYXJ5fSBhbmQge0BsaW5rIE1lc2gjbW9ycGhUYXJnZXRJbmZsdWVuY2VzfQogICAgCSAqIHRvIG1ha2Ugc3VyZSBleGlzdGluZyBtb3JwaCB0YXJnZXRzIGNhbiBpbmZsdWVuY2UgdGhpcyAzRCBvYmplY3QuCiAgICAJICovCiAgICAJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKICAgIAkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwogICAgCQljb25zdCBrZXlzID0gT2JqZWN0LmtleXMoIG1vcnBoQXR0cmlidXRlcyApOwoKICAgIAkJaWYgKCBrZXlzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIGtleXNbIDAgXSBdOwoKICAgIAkJCWlmICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSBbXTsKICAgIAkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHt9OwoKICAgIAkJCQlmb3IgKCBsZXQgbSA9IDAsIG1sID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBtIDwgbWw7IG0gKysgKSB7CgogICAgCQkJCQljb25zdCBuYW1lID0gbW9ycGhBdHRyaWJ1dGVbIG0gXS5uYW1lIHx8IFN0cmluZyggbSApOwoKICAgIAkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMucHVzaCggMCApOwogICAgCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgbmFtZSBdID0gbTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBsb2NhbC1zcGFjZSBwb3NpdGlvbiBvZiB0aGUgdmVydGV4IGF0IHRoZSBnaXZlbiBpbmRleCwgdGFraW5nIGludG8KICAgIAkgKiBhY2NvdW50IHRoZSBjdXJyZW50IGFuaW1hdGlvbiBzdGF0ZSBvZiBib3RoIG1vcnBoIHRhcmdldHMgYW5kIHNraW5uaW5nLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIHZlcnRleCBpbmRleC4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgogICAgCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSB2ZXJ0ZXggcG9zaXRpb24gaW4gbG9jYWwgc3BhY2UuCiAgICAJICovCiAgICAJZ2V0VmVydGV4UG9zaXRpb24oIGluZGV4LCB0YXJnZXQgKSB7CgogICAgCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CiAgICAJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKICAgIAkJY29uc3QgbW9ycGhQb3NpdGlvbiA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKICAgIAkJY29uc3QgbW9ycGhUYXJnZXRzUmVsYXRpdmUgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCiAgICAJCXRhcmdldC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaW5kZXggKTsKCiAgICAJCWNvbnN0IG1vcnBoSW5mbHVlbmNlcyA9IHRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKICAgIAkJaWYgKCBtb3JwaFBvc2l0aW9uICYmIG1vcnBoSW5mbHVlbmNlcyApIHsKCiAgICAJCQlfbW9ycGhBLnNldCggMCwgMCwgMCApOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaFBvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQljb25zdCBpbmZsdWVuY2UgPSBtb3JwaEluZmx1ZW5jZXNbIGkgXTsKICAgIAkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoUG9zaXRpb25bIGkgXTsKCiAgICAJCQkJaWYgKCBpbmZsdWVuY2UgPT09IDAgKSBjb250aW51ZTsKCiAgICAJCQkJX3RlbXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQXR0cmlidXRlLCBpbmRleCApOwoKICAgIAkJCQlpZiAoIG1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKICAgIAkJCQkJX21vcnBoQS5hZGRTY2FsZWRWZWN0b3IoIF90ZW1wQSwgaW5mbHVlbmNlICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlfbW9ycGhBLmFkZFNjYWxlZFZlY3RvciggX3RlbXBBLnN1YiggdGFyZ2V0ICksIGluZmx1ZW5jZSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXRhcmdldC5hZGQoIF9tb3JwaEEgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0YXJnZXQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgaW50ZXJzZWN0aW9uIHBvaW50cyBiZXR3ZWVuIGEgY2FzdGVkIHJheSBhbmQgdGhpcyBsaW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtSYXljYXN0ZXJ9IHJheWNhc3RlciAtIFRoZSByYXljYXN0ZXIuCiAgICAJICogQHBhcmFtIHtBcnJheTxPYmplY3Q+fSBpbnRlcnNlY3RzIC0gVGhlIHRhcmdldCBhcnJheSB0aGF0IGhvbGRzIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnRzLgogICAgCSAqLwogICAgCXJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCiAgICAJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgIAkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgogICAgCQlpZiAoIG1hdGVyaWFsID09PSB1bmRlZmluZWQgKSByZXR1cm47CgogICAgCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgc3BoZXJlIGluIHdvcmxkIHNwYWNlCgogICAgCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgogICAgCQlfc3BoZXJlJDYuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKTsKICAgIAkJX3NwaGVyZSQ2LmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCiAgICAJCS8vIGNoZWNrIGRpc3RhbmNlIGZyb20gcmF5IG9yaWdpbiB0byBib3VuZGluZyBzcGhlcmUKCiAgICAJCV9yYXkkMy5jb3B5KCByYXljYXN0ZXIucmF5ICkucmVjYXN0KCByYXljYXN0ZXIubmVhciApOwoKICAgIAkJaWYgKCBfc3BoZXJlJDYuY29udGFpbnNQb2ludCggX3JheSQzLm9yaWdpbiApID09PSBmYWxzZSApIHsKCiAgICAJCQlpZiAoIF9yYXkkMy5pbnRlcnNlY3RTcGhlcmUoIF9zcGhlcmUkNiwgX3NwaGVyZUhpdEF0ICkgPT09IG51bGwgKSByZXR1cm47CgogICAgCQkJaWYgKCBfcmF5JDMub3JpZ2luLmRpc3RhbmNlVG9TcXVhcmVkKCBfc3BoZXJlSGl0QXQgKSA+ICggcmF5Y2FzdGVyLmZhciAtIHJheWNhc3Rlci5uZWFyICkgKiogMiApIHJldHVybjsKCiAgICAJCX0KCiAgICAJCS8vIGNvbnZlcnQgcmF5IHRvIGxvY2FsIHNwYWNlIG9mIG1lc2gKCiAgICAJCV9pbnZlcnNlTWF0cml4JDMuY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKICAgIAkJX3JheSQzLmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4JDMgKTsKCiAgICAJCS8vIHRlc3Qgd2l0aCBib3VuZGluZyBib3ggaW4gbG9jYWwgc3BhY2UKCiAgICAJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgogICAgCQkJaWYgKCBfcmF5JDMuaW50ZXJzZWN0c0JveCggZ2VvbWV0cnkuYm91bmRpbmdCb3ggKSA9PT0gZmFsc2UgKSByZXR1cm47CgogICAgCQl9CgogICAgCQkvLyB0ZXN0IGZvciBpbnRlcnNlY3Rpb25zIHdpdGggZ2VvbWV0cnkKCiAgICAJCXRoaXMuX2NvbXB1dGVJbnRlcnNlY3Rpb25zKCByYXljYXN0ZXIsIGludGVyc2VjdHMsIF9yYXkkMyApOwoKICAgIAl9CgogICAgCV9jb21wdXRlSW50ZXJzZWN0aW9ucyggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCByYXlMb2NhbFNwYWNlICkgewoKICAgIAkJbGV0IGludGVyc2VjdGlvbjsKCiAgICAJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKICAgIAkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoKICAgIAkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKICAgIAkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwogICAgCQljb25zdCB1diA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXY7CiAgICAJCWNvbnN0IHV2MSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYxOwogICAgCQljb25zdCBub3JtYWwgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLm5vcm1hbDsKICAgIAkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwogICAgCQljb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CgogICAgCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCS8vIGluZGV4ZWQgYnVmZmVyIGdlb21ldHJ5CgogICAgCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKICAgIAkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgogICAgCQkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCBncm91cC5zdGFydCwgZHJhd1JhbmdlLnN0YXJ0ICk7CiAgICAJCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBpbmRleC5jb3VudCwgTWF0aC5taW4oICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApLCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICkgKTsKCiAgICAJCQkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCiAgICAJCQkJCQljb25zdCBhID0gaW5kZXguZ2V0WCggaiApOwogICAgCQkJCQkJY29uc3QgYiA9IGluZGV4LmdldFgoIGogKyAxICk7CiAgICAJCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaiArIDIgKTsKCiAgICAJCQkJCQlpbnRlcnNlY3Rpb24gPSBjaGVja0dlb21ldHJ5SW50ZXJzZWN0aW9uKCB0aGlzLCBncm91cE1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKICAgIAkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKICAgIAkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaiAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIGluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwogICAgCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwogICAgCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggMCwgZHJhd1JhbmdlLnN0YXJ0ICk7CiAgICAJCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgogICAgCQkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKz0gMyApIHsKCiAgICAJCQkJCWNvbnN0IGEgPSBpbmRleC5nZXRYKCBpICk7CiAgICAJCQkJCWNvbnN0IGIgPSBpbmRleC5nZXRYKCBpICsgMSApOwogICAgCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaSArIDIgKTsKCiAgICAJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKICAgIAkJCQkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgogICAgCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBpbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKICAgIAkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCS8vIG5vbi1pbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKICAgIAkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CiAgICAJCQkJCWNvbnN0IGdyb3VwTWF0ZXJpYWwgPSBtYXRlcmlhbFsgZ3JvdXAubWF0ZXJpYWxJbmRleCBdOwoKICAgIAkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwogICAgCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsIE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApICk7CgogICAgCQkJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IGVuZDsgaiA8IGpsOyBqICs9IDMgKSB7CgogICAgCQkJCQkJY29uc3QgYSA9IGo7CiAgICAJCQkJCQljb25zdCBiID0gaiArIDE7CiAgICAJCQkJCQljb25zdCBjID0gaiArIDI7CgogICAgCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgZ3JvdXBNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCiAgICAJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCiAgICAJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGogLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBub24taW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCiAgICAJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2UubWF0ZXJpYWxJbmRleCA9IGdyb3VwLm1hdGVyaWFsSW5kZXg7CiAgICAJCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCBpbnRlcnNlY3Rpb24gKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKICAgIAkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSBzdGFydCwgaWwgPSBlbmQ7IGkgPCBpbDsgaSArPSAzICkgewoKICAgIAkJCQkJY29uc3QgYSA9IGk7CiAgICAJCQkJCWNvbnN0IGIgPSBpICsgMTsKICAgIAkJCQkJY29uc3QgYyA9IGkgKyAyOwoKICAgIAkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgogICAgCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCiAgICAJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaSAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIG5vbi1pbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKICAgIAkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tJbnRlcnNlY3Rpb24kMSggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHBBLCBwQiwgcEMsIHBvaW50ICkgewoKICAgIAlsZXQgaW50ZXJzZWN0OwoKICAgIAlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKICAgIAkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQywgcEIsIHBBLCB0cnVlLCBwb2ludCApOwoKICAgIAl9IGVsc2UgewoKICAgIAkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQSwgcEIsIHBDLCAoIG1hdGVyaWFsLnNpZGUgPT09IEZyb250U2lkZSApLCBwb2ludCApOwoKICAgIAl9CgogICAgCWlmICggaW50ZXJzZWN0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgogICAgCV9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmNvcHkoIHBvaW50ICk7CiAgICAJX2ludGVyc2VjdGlvblBvaW50V29ybGQuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCiAgICAJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCApOwoKICAgIAlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgcmV0dXJuIG51bGw7CgogICAgCXJldHVybiB7CiAgICAJCWRpc3RhbmNlOiBkaXN0YW5jZSwKICAgIAkJcG9pbnQ6IF9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmNsb25lKCksCiAgICAJCW9iamVjdDogb2JqZWN0CiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApIHsKCiAgICAJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBhLCBfdkEkMSApOwogICAgCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggYiwgX3ZCJDEgKTsKICAgIAlvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGMsIF92QyQxICk7CgogICAgCWNvbnN0IGludGVyc2VjdGlvbiA9IGNoZWNrSW50ZXJzZWN0aW9uJDEoIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfaW50ZXJzZWN0aW9uUG9pbnQgKTsKCiAgICAJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgogICAgCQljb25zdCBiYXJ5Y29vcmQgPSBuZXcgVmVjdG9yMygpOwogICAgCQlUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIF9pbnRlcnNlY3Rpb25Qb2ludCwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgYmFyeWNvb3JkICk7CgogICAgCQlpZiAoIHV2ICkgewoKICAgIAkJCWludGVyc2VjdGlvbi51diA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggdXYsIGEsIGIsIGMsIGJhcnljb29yZCwgbmV3IFZlY3RvcjIoKSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCB1djEgKSB7CgogICAgCQkJaW50ZXJzZWN0aW9uLnV2MSA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggdXYxLCBhLCBiLCBjLCBiYXJ5Y29vcmQsIG5ldyBWZWN0b3IyKCkgKTsKCiAgICAJCX0KCiAgICAJCWlmICggbm9ybWFsICkgewoKICAgIAkJCWludGVyc2VjdGlvbi5ub3JtYWwgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIG5vcm1hbCwgYSwgYiwgYywgYmFyeWNvb3JkLCBuZXcgVmVjdG9yMygpICk7CgogICAgCQkJaWYgKCBpbnRlcnNlY3Rpb24ubm9ybWFsLmRvdCggcmF5LmRpcmVjdGlvbiApID4gMCApIHsKCiAgICAJCQkJaW50ZXJzZWN0aW9uLm5vcm1hbC5tdWx0aXBseVNjYWxhciggLTEgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljb25zdCBmYWNlID0gewogICAgCQkJYTogYSwKICAgIAkJCWI6IGIsCiAgICAJCQljOiBjLAogICAgCQkJbm9ybWFsOiBuZXcgVmVjdG9yMygpLAogICAgCQkJbWF0ZXJpYWxJbmRleDogMAogICAgCQl9OwoKICAgIAkJVHJpYW5nbGUuZ2V0Tm9ybWFsKCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBmYWNlLm5vcm1hbCApOwoKICAgIAkJaW50ZXJzZWN0aW9uLmZhY2UgPSBmYWNlOwogICAgCQlpbnRlcnNlY3Rpb24uYmFyeWNvb3JkID0gYmFyeWNvb3JkOwoKICAgIAl9CgogICAgCXJldHVybiBpbnRlcnNlY3Rpb247CgogICAgfQoKICAgIC8qKgogICAgICogQSBnZW9tZXRyeSBjbGFzcyBmb3IgYSByZWN0YW5ndWxhciBjdWJvaWQgd2l0aCBhIGdpdmVuIHdpZHRoLCBoZWlnaHQsIGFuZCBkZXB0aC4KICAgICAqIE9uIGNyZWF0aW9uLCB0aGUgY3Vib2lkIGlzIGNlbnRyZWQgb24gdGhlIG9yaWdpbiwgd2l0aCBlYWNoIGVkZ2UgcGFyYWxsZWwgdG8gb25lCiAgICAgKiBvZiB0aGUgYXhlcy4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDEsIDEgKTsKICAgICAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweDAwZmYwMCB9ICk7CiAgICAgKiBjb25zdCBjdWJlID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwogICAgICogc2NlbmUuYWRkKCBjdWJlICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAYXVnbWVudHMgQnVmZmVyR2VvbWV0cnkKICAgICAqLwogICAgY2xhc3MgQm94R2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgYm94IGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aC4gVGhhdCBpcywgdGhlIGxlbmd0aCBvZiB0aGUgZWRnZXMgcGFyYWxsZWwgdG8gdGhlIFggYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQuIFRoYXQgaXMsIHRoZSBsZW5ndGggb2YgdGhlIGVkZ2VzIHBhcmFsbGVsIHRvIHRoZSBZIGF4aXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSBkZXB0aC4gVGhhdCBpcywgdGhlIGxlbmd0aCBvZiB0aGUgZWRnZXMgcGFyYWxsZWwgdG8gdGhlIFogYXhpcy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoU2VnbWVudHM9MV0gLSBOdW1iZXIgb2Ygc2VnbWVudGVkIHJlY3Rhbmd1bGFyIGZhY2VzIGFsb25nIHRoZSB3aWR0aCBvZiB0aGUgc2lkZXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHRTZWdtZW50cz0xXSAtIE51bWJlciBvZiBzZWdtZW50ZWQgcmVjdGFuZ3VsYXIgZmFjZXMgYWxvbmcgdGhlIGhlaWdodCBvZiB0aGUgc2lkZXMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aFNlZ21lbnRzPTFdIC0gTnVtYmVyIG9mIHNlZ21lbnRlZCByZWN0YW5ndWxhciBmYWNlcyBhbG9uZyB0aGUgZGVwdGggb2YgdGhlIHNpZGVzLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSwgZGVwdGhTZWdtZW50cyA9IDEgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJdGhpcy50eXBlID0gJ0JveEdlb21ldHJ5JzsKCiAgICAJCS8qKgogICAgCQkgKiBIb2xkcyB0aGUgY29uc3RydWN0b3IgcGFyYW1ldGVycyB0aGF0IGhhdmUgYmVlbgogICAgCQkgKiB1c2VkIHRvIGdlbmVyYXRlIHRoZSBnZW9tZXRyeS4gQW55IG1vZGlmaWNhdGlvbgogICAgCQkgKiBhZnRlciBpbnN0YW50aWF0aW9uIGRvZXMgbm90IGNoYW5nZSB0aGUgZ2VvbWV0cnkuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLnBhcmFtZXRlcnMgPSB7CiAgICAJCQl3aWR0aDogd2lkdGgsCiAgICAJCQloZWlnaHQ6IGhlaWdodCwKICAgIAkJCWRlcHRoOiBkZXB0aCwKICAgIAkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCiAgICAJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCiAgICAJCQlkZXB0aFNlZ21lbnRzOiBkZXB0aFNlZ21lbnRzCiAgICAJCX07CgogICAgCQljb25zdCBzY29wZSA9IHRoaXM7CgogICAgCQkvLyBzZWdtZW50cwoKICAgIAkJd2lkdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoIHdpZHRoU2VnbWVudHMgKTsKICAgIAkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApOwogICAgCQlkZXB0aFNlZ21lbnRzID0gTWF0aC5mbG9vciggZGVwdGhTZWdtZW50cyApOwoKICAgIAkJLy8gYnVmZmVycwoKICAgIAkJY29uc3QgaW5kaWNlcyA9IFtdOwogICAgCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgCQljb25zdCBub3JtYWxzID0gW107CiAgICAJCWNvbnN0IHV2cyA9IFtdOwoKICAgIAkJLy8gaGVscGVyIHZhcmlhYmxlcwoKICAgIAkJbGV0IG51bWJlck9mVmVydGljZXMgPSAwOwogICAgCQlsZXQgZ3JvdXBTdGFydCA9IDA7CgogICAgCQkvLyBidWlsZCBlYWNoIHNpZGUgb2YgdGhlIGJveCBnZW9tZXRyeQoKICAgIAkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgLTEsIC0xLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aCwgZGVwdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDAgKTsgLy8gcHgKICAgIAkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgMSwgLTEsIGRlcHRoLCBoZWlnaHQsIC0gd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAxICk7IC8vIG54CiAgICAJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIDEsIHdpZHRoLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAyICk7IC8vIHB5CiAgICAJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIC0xLCB3aWR0aCwgZGVwdGgsIC0gaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAzICk7IC8vIG55CiAgICAJCWJ1aWxkUGxhbmUoICd4JywgJ3knLCAneicsIDEsIC0xLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDQgKTsgLy8gcHoKICAgIAkJYnVpbGRQbGFuZSggJ3gnLCAneScsICd6JywgLTEsIC0xLCB3aWR0aCwgaGVpZ2h0LCAtIGRlcHRoLCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgNSApOyAvLyBuegoKICAgIAkJLy8gYnVpbGQgZ2VvbWV0cnkKCiAgICAJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKICAgIAkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CiAgICAJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwogICAgCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgogICAgCQlmdW5jdGlvbiBidWlsZFBsYW5lKCB1LCB2LCB3LCB1ZGlyLCB2ZGlyLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ3JpZFgsIGdyaWRZLCBtYXRlcmlhbEluZGV4ICkgewoKICAgIAkJCWNvbnN0IHNlZ21lbnRXaWR0aCA9IHdpZHRoIC8gZ3JpZFg7CiAgICAJCQljb25zdCBzZWdtZW50SGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgogICAgCQkJY29uc3Qgd2lkdGhIYWxmID0gd2lkdGggLyAyOwogICAgCQkJY29uc3QgaGVpZ2h0SGFsZiA9IGhlaWdodCAvIDI7CiAgICAJCQljb25zdCBkZXB0aEhhbGYgPSBkZXB0aCAvIDI7CgogICAgCQkJY29uc3QgZ3JpZFgxID0gZ3JpZFggKyAxOwogICAgCQkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKICAgIAkJCWxldCB2ZXJ0ZXhDb3VudGVyID0gMDsKICAgIAkJCWxldCBncm91cENvdW50ID0gMDsKCiAgICAJCQljb25zdCB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKICAgIAkJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCiAgICAJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgogICAgCQkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRIZWlnaHQgLSBoZWlnaHRIYWxmOwoKICAgIAkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYMTsgaXggKysgKSB7CgogICAgCQkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50V2lkdGggLSB3aWR0aEhhbGY7CgogICAgCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKICAgIAkJCQkJdmVjdG9yWyB1IF0gPSB4ICogdWRpcjsKICAgIAkJCQkJdmVjdG9yWyB2IF0gPSB5ICogdmRpcjsKICAgIAkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aEhhbGY7CgogICAgCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIHZlcnRleCBidWZmZXIKCiAgICAJCQkJCXZlcnRpY2VzLnB1c2goIHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnogKTsKCiAgICAJCQkJCS8vIHNldCB2YWx1ZXMgdG8gY29ycmVjdCB2ZWN0b3IgY29tcG9uZW50CgogICAgCQkJCQl2ZWN0b3JbIHUgXSA9IDA7CiAgICAJCQkJCXZlY3RvclsgdiBdID0gMDsKICAgIAkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aCA+IDAgPyAxIDogLTE7CgogICAgCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIG5vcm1hbCBidWZmZXIKCiAgICAJCQkJCW5vcm1hbHMucHVzaCggdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKICAgIAkJCQkJLy8gdXZzCgogICAgCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwogICAgCQkJCQl1dnMucHVzaCggMSAtICggaXkgLyBncmlkWSApICk7CgogICAgCQkJCQkvLyBjb3VudGVycwoKICAgIAkJCQkJdmVydGV4Q291bnRlciArPSAxOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIGluZGljZXMKCiAgICAJCQkvLyAxLiB5b3UgbmVlZCB0aHJlZSBpbmRpY2VzIHRvIGRyYXcgYSBzaW5nbGUgZmFjZQogICAgCQkJLy8gMi4gYSBzaW5nbGUgc2VnbWVudCBjb25zaXN0cyBvZiB0d28gZmFjZXMKICAgIAkJCS8vIDMuIHNvIHdlIG5lZWQgdG8gZ2VuZXJhdGUgc2l4ICgyKjMpIGluZGljZXMgcGVyIHNlZ21lbnQKCiAgICAJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCiAgICAJCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDsgaXggKysgKSB7CgogICAgCQkJCQljb25zdCBhID0gbnVtYmVyT2ZWZXJ0aWNlcyArIGl4ICsgZ3JpZFgxICogaXk7CiAgICAJCQkJCWNvbnN0IGIgPSBudW1iZXJPZlZlcnRpY2VzICsgaXggKyBncmlkWDEgKiAoIGl5ICsgMSApOwogICAgCQkJCQljb25zdCBjID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiAoIGl5ICsgMSApOwogICAgCQkJCQljb25zdCBkID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCiAgICAJCQkJCS8vIGZhY2VzCgogICAgCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKICAgIAkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgogICAgCQkJCQkvLyBpbmNyZWFzZSBjb3VudGVyCgogICAgCQkJCQlncm91cENvdW50ICs9IDY7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJLy8gYWRkIGEgZ3JvdXAgdG8gdGhlIGdlb21ldHJ5LiB0aGlzIHdpbGwgZW5zdXJlIG11bHRpIG1hdGVyaWFsIHN1cHBvcnQKCiAgICAJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgbWF0ZXJpYWxJbmRleCApOwoKICAgIAkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKICAgIAkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCiAgICAJCQkvLyB1cGRhdGUgdG90YWwgbnVtYmVyIG9mIHZlcnRpY2VzCgogICAgCQkJbnVtYmVyT2ZWZXJ0aWNlcyArPSB2ZXJ0ZXhDb3VudGVyOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKICAgIAkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBGYWN0b3J5IG1ldGhvZCBmb3IgY3JlYXRpbmcgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcyBmcm9tIHRoZSBnaXZlbgogICAgCSAqIEpTT04gb2JqZWN0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCBnZW9tZXRyeS4KICAgIAkgKiBAcmV0dXJuIHtCb3hHZW9tZXRyeX0gQSBuZXcgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKICAgIAkJcmV0dXJuIG5ldyBCb3hHZW9tZXRyeSggZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQsIGRhdGEuZGVwdGgsIGRhdGEud2lkdGhTZWdtZW50cywgZGF0YS5oZWlnaHRTZWdtZW50cywgZGF0YS5kZXB0aFNlZ21lbnRzICk7CgogICAgCX0KCiAgICB9CgogICAgLy8gVW5pZm9ybSBVdGlsaXRpZXMKCiAgICBmdW5jdGlvbiBjbG9uZVVuaWZvcm1zKCBzcmMgKSB7CgogICAgCWNvbnN0IGRzdCA9IHt9OwoKICAgIAlmb3IgKCBjb25zdCB1IGluIHNyYyApIHsKCiAgICAJCWRzdFsgdSBdID0ge307CgogICAgCQlmb3IgKCBjb25zdCBwIGluIHNyY1sgdSBdICkgewoKICAgIAkJCWNvbnN0IHByb3BlcnR5ID0gc3JjWyB1IF1bIHAgXTsKCiAgICAJCQlpZiAoIHByb3BlcnR5ICYmICggcHJvcGVydHkuaXNDb2xvciB8fAogICAgCQkJCXByb3BlcnR5LmlzTWF0cml4MyB8fCBwcm9wZXJ0eS5pc01hdHJpeDQgfHwKICAgIAkJCQlwcm9wZXJ0eS5pc1ZlY3RvcjIgfHwgcHJvcGVydHkuaXNWZWN0b3IzIHx8IHByb3BlcnR5LmlzVmVjdG9yNCB8fAogICAgCQkJCXByb3BlcnR5LmlzVGV4dHVyZSB8fCBwcm9wZXJ0eS5pc1F1YXRlcm5pb24gKSApIHsKCiAgICAJCQkJaWYgKCBwcm9wZXJ0eS5pc1JlbmRlclRhcmdldFRleHR1cmUgKSB7CgogICAgCQkJCQljb25zb2xlLndhcm4oICdVbmlmb3Jtc1V0aWxzOiBUZXh0dXJlcyBvZiByZW5kZXIgdGFyZ2V0cyBjYW5ub3QgYmUgY2xvbmVkIHZpYSBjbG9uZVVuaWZvcm1zKCkgb3IgbWVyZ2VVbmlmb3JtcygpLicgKTsKICAgIAkJCQkJZHN0WyB1IF1bIHAgXSA9IG51bGw7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHkuY2xvbmUoKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIHByb3BlcnR5ICkgKSB7CgogICAgCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eS5zbGljZSgpOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIGRzdDsKCiAgICB9CgogICAgZnVuY3Rpb24gbWVyZ2VVbmlmb3JtcyggdW5pZm9ybXMgKSB7CgogICAgCWNvbnN0IG1lcmdlZCA9IHt9OwoKICAgIAlmb3IgKCBsZXQgdSA9IDA7IHUgPCB1bmlmb3Jtcy5sZW5ndGg7IHUgKysgKSB7CgogICAgCQljb25zdCB0bXAgPSBjbG9uZVVuaWZvcm1zKCB1bmlmb3Jtc1sgdSBdICk7CgogICAgCQlmb3IgKCBjb25zdCBwIGluIHRtcCApIHsKCiAgICAJCQltZXJnZWRbIHAgXSA9IHRtcFsgcCBdOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiBtZXJnZWQ7CgogICAgfQoKICAgIGZ1bmN0aW9uIGNsb25lVW5pZm9ybXNHcm91cHMoIHNyYyApIHsKCiAgICAJY29uc3QgZHN0ID0gW107CgogICAgCWZvciAoIGxldCB1ID0gMDsgdSA8IHNyYy5sZW5ndGg7IHUgKysgKSB7CgogICAgCQlkc3QucHVzaCggc3JjWyB1IF0uY2xvbmUoKSApOwoKICAgIAl9CgogICAgCXJldHVybiBkc3Q7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgewoKICAgIAljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgogICAgCWlmICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApIHsKCiAgICAJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yMzkzNyNpc3N1ZWNvbW1lbnQtMTExMTA2NzM5OAogICAgCQlyZXR1cm4gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZTsKCiAgICAJfQoKICAgIAkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8yNzg2OAogICAgCWlmICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlICkgewoKICAgIAkJcmV0dXJuIGN1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS5jb2xvclNwYWNlOwoKICAgIAl9CgogICAgCXJldHVybiBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2U7CgogICAgfQoKICAgIC8vIExlZ2FjeQoKICAgIGNvbnN0IFVuaWZvcm1zVXRpbHMgPSB7IGNsb25lOiBjbG9uZVVuaWZvcm1zLCBtZXJnZTogbWVyZ2VVbmlmb3JtcyB9OwoKICAgIHZhciBkZWZhdWx0X3ZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbn0iOwoKICAgIHZhciBkZWZhdWx0X2ZyYWdtZW50ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggMS4wLCAwLjAsIDAuMCwgMS4wICk7XG59IjsKCiAgICAvKioKICAgICAqIEEgbWF0ZXJpYWwgcmVuZGVyZWQgd2l0aCBjdXN0b20gc2hhZGVycy4gQSBzaGFkZXIgaXMgYSBzbWFsbCBwcm9ncmFtIHdyaXR0ZW4gaW4gR0xTTC4KICAgICAqIHRoYXQgcnVucyBvbiB0aGUgR1BVLiBZb3UgbWF5IHdhbnQgdG8gdXNlIGEgY3VzdG9tIHNoYWRlciBpZiB5b3UgbmVlZCB0byBpbXBsZW1lbnQgYW4KICAgICAqIGVmZmVjdCBub3QgaW5jbHVkZWQgd2l0aCBhbnkgb2YgdGhlIGJ1aWx0LWluIG1hdGVyaWFscy4KICAgICAqCiAgICAgKiBUaGVyZSBhcmUgdGhlIGZvbGxvd2luZyBub3RlcyB0byBiZWFyIGluIG1pbmQgd2hlbiB1c2luZyBhIGBTaGFkZXJNYXRlcmlhbGA6CiAgICAgKgogICAgICogLSBgU2hhZGVyTWF0ZXJpYWxgIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCiAgICAgKiAtIEJ1aWx0IGluIGF0dHJpYnV0ZXMgYW5kIHVuaWZvcm1zIGFyZSBwYXNzZWQgdG8gdGhlIHNoYWRlcnMgYWxvbmcgd2l0aCB5b3VyIGNvZGUuIElmCiAgICAgKiB5b3UgZG9uJ3Qgd2FudCB0aGF0LCB1c2Uge0BsaW5rIFJhd1NoYWRlck1hdGVyaWFsfSBpbnN0ZWFkLgogICAgICogLSBZb3UgY2FuIHVzZSB0aGUgZGlyZWN0aXZlIGAjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0YCBhbmQgYCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kYAogICAgICogaW4gb3JkZXIgdG8gdW5yb2xsIGEgYGZvcmAgbG9vcCBpbiBHTFNMIGJ5IHRoZSBzaGFkZXIgcHJlcHJvY2Vzc29yLiBUaGUgZGlyZWN0aXZlIGhhcwogICAgICogdG8gYmUgcGxhY2VkIHJpZ2h0IGFib3ZlIHRoZSBsb29wLiBUaGUgbG9vcCBmb3JtYXR0aW5nIGhhcyB0byBjb3JyZXNwb25kIHRvIGEgZGVmaW5lZCBzdGFuZGFyZC4KICAgICAqICAgLSBUaGUgbG9vcCBoYXMgdG8gYmUgW25vcm1hbGl6ZWRde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL05vcm1hbGl6ZWRfbG9vcH0uCiAgICAgKiAgIC0gVGhlIGxvb3AgdmFyaWFibGUgaGFzIHRvIGJlICppKi4KICAgICAqICAgLSBUaGUgdmFsdWUgYFVOUk9MTEVEX0xPT1BfSU5ERVhgIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCB0aGUgZXhwbGljaXRseQogICAgICogdmFsdWUgb2YgKmkqIGZvciB0aGUgZ2l2ZW4gaXRlcmF0aW9uIGFuZCBjYW4gYmUgdXNlZCBpbiBwcmVwcm9jZXNzb3IKICAgICAqIHN0YXRlbWVudHMuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKCB7CiAgICAgKiAJdW5pZm9ybXM6IHsKICAgICAqIAkJdGltZTogeyB2YWx1ZTogMS4wIH0sCiAgICAgKiAJCXJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBUSFJFRS5WZWN0b3IyKCkgfQogICAgICogCX0sCiAgICAgKiAJdmVydGV4U2hhZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3ZlcnRleFNoYWRlcicgKS50ZXh0Q29udGVudCwKICAgICAqIAlmcmFnbWVudFNoYWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdmcmFnbWVudFNoYWRlcicgKS50ZXh0Q29udGVudAogICAgICogfSApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIE1hdGVyaWFsCiAgICAgKi8KICAgIGNsYXNzIFNoYWRlck1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHNoYWRlciBtYXRlcmlhbC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCiAgICAJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAogICAgCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAogICAgCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCiAgICAJICogYnkge0BsaW5rIENvbG9yI3NldH0uCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNTaGFkZXJNYXRlcmlhbCA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnU2hhZGVyTWF0ZXJpYWwnOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgY3VzdG9tIGNvbnN0YW50cyB1c2luZyBgI2RlZmluZWAgZGlyZWN0aXZlcyB3aXRoaW4gdGhlIEdMU0wgY29kZQogICAgCQkgKiBmb3IgYm90aCB0aGUgdmVydGV4IHNoYWRlciBhbmQgdGhlIGZyYWdtZW50IHNoYWRlcjsgZWFjaCBrZXkvdmFsdWUgcGFpcgogICAgCQkgKiB5aWVsZHMgYW5vdGhlciBkaXJlY3RpdmUuCiAgICAJCSAqIGBgYGpzCiAgICAJCSAqIGRlZmluZXM6IHsKICAgIAkJICogCUZPTzogMTUsCiAgICAJCSAqIAlCQVI6IHRydWUKICAgIAkJICogfQogICAgCQkgKiBgYGAKICAgIAkJICogWWllbGRzIHRoZSBsaW5lczoKICAgIAkJICogYGBgCiAgICAJCSAqICNkZWZpbmUgRk9PIDE1CiAgICAJCSAqICNkZWZpbmUgQkFSIHRydWUKICAgIAkJICogYGBgCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLmRlZmluZXMgPSB7fTsKCiAgICAJCS8qKgogICAgCQkgKiBBbiBvYmplY3Qgb2YgdGhlIGZvcm06CiAgICAJCSAqIGBgYGpzCiAgICAJCSAqIHsKICAgIAkJICogCSJ1bmlmb3JtMSI6IHsgdmFsdWU6IDEuMCB9LAogICAgCQkgKiAJInVuaWZvcm0yIjogeyB2YWx1ZTogMiB9CiAgICAJCSAqIH0KICAgIAkJICogYGBgCiAgICAJCSAqIHNwZWNpZnlpbmcgdGhlIHVuaWZvcm1zIHRvIGJlIHBhc3NlZCB0byB0aGUgc2hhZGVyIGNvZGU7IGtleXMgYXJlIHVuaWZvcm0KICAgIAkJICogbmFtZXMsIHZhbHVlcyBhcmUgZGVmaW5pdGlvbnMgb2YgdGhlIGZvcm0KICAgIAkJICogYGBgCiAgICAJCSAqIHsKICAgIAkJICogCXZhbHVlOiAxLjAKICAgIAkJICogfQogICAgCQkgKiBgYGAKICAgIAkJICogd2hlcmUgYHZhbHVlYCBpcyB0aGUgdmFsdWUgb2YgdGhlIHVuaWZvcm0uIE5hbWVzIG11c3QgbWF0Y2ggdGhlIG5hbWUgb2YKICAgIAkJICogdGhlIHVuaWZvcm0sIGFzIGRlZmluZWQgaW4gdGhlIEdMU0wgY29kZS4gTm90ZSB0aGF0IHVuaWZvcm1zIGFyZSByZWZyZXNoZWQKICAgIAkJICogb24gZXZlcnkgZnJhbWUsIHNvIHVwZGF0aW5nIHRoZSB2YWx1ZSBvZiB0aGUgdW5pZm9ybSB3aWxsIGltbWVkaWF0ZWx5CiAgICAJCSAqIHVwZGF0ZSB0aGUgdmFsdWUgYXZhaWxhYmxlIHRvIHRoZSBHTFNMIGNvZGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCSAqLwogICAgCQl0aGlzLnVuaWZvcm1zID0ge307CgogICAgCQkvKioKICAgIAkJICogQW4gYXJyYXkgaG9sZGluZyB1bmlmb3JtcyBncm91cHMgZm9yIGNvbmZpZ3VyaW5nIFVCT3MuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxVbmlmb3Jtc0dyb3VwPn0KICAgIAkJICovCiAgICAJCXRoaXMudW5pZm9ybXNHcm91cHMgPSBbXTsKCiAgICAJCS8qKgogICAgCQkgKiBWZXJ0ZXggc2hhZGVyIEdMU0wgY29kZS4gVGhpcyBpcyB0aGUgYWN0dWFsIGNvZGUgZm9yIHRoZSBzaGFkZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd9CiAgICAJCSAqLwogICAgCQl0aGlzLnZlcnRleFNoYWRlciA9IGRlZmF1bHRfdmVydGV4OwoKICAgIAkJLyoqCiAgICAJCSAqIEZyYWdtZW50IHNoYWRlciBHTFNMIGNvZGUuIFRoaXMgaXMgdGhlIGFjdHVhbCBjb2RlIGZvciB0aGUgc2hhZGVyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy5mcmFnbWVudFNoYWRlciA9IGRlZmF1bHRfZnJhZ21lbnQ7CgogICAgCQkvKioKICAgIAkJICogQ29udHJvbHMgbGluZSB0aGlja25lc3Mgb3IgbGluZXMuCiAgICAJCSAqCiAgICAJCSAqIFdlYkdMIGFuZCBXZWJHUFUgaWdub3JlIHRoaXMgc2V0dGluZyBhbmQgYWx3YXlzIHJlbmRlciBsaW5lIHByaW1pdGl2ZXMgd2l0aCBhCiAgICAJCSAqIHdpZHRoIG9mIG9uZSBwaXhlbC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5saW5ld2lkdGggPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFJlbmRlcnMgdGhlIGdlb21ldHJ5IGFzIGEgd2lyZWZyYW1lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogQ29udHJvbHMgdGhlIHRoaWNrbmVzcyBvZiB0aGUgd2lyZWZyYW1lLgogICAgCQkgKgogICAgCQkgKiBXZWJHTCBhbmQgV2ViR1BVIGlnbm9yZSB0aGlzIHByb3BlcnR5IGFuZCBhbHdheXMgcmVuZGVyCiAgICAJCSAqIDEgcGl4ZWwgd2lkZSBsaW5lcy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZSB3aGV0aGVyIHRoZSBtYXRlcmlhbCBjb2xvciBpcyBhZmZlY3RlZCBieSBnbG9iYWwgZm9nIHNldHRpbmdzOyBgdHJ1ZWAKICAgIAkJICogdG8gcGFzcyBmb2cgdW5pZm9ybXMgdG8gdGhlIHNoYWRlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmZvZyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIHVzZXMgbGlnaHRpbmc7IGB0cnVlYCB0byBwYXNzIHVuaWZvcm0gZGF0YQogICAgCQkgKiByZWxhdGVkIHRvIGxpZ2h0aW5nIHRvIHRoaXMgc2hhZGVyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMubGlnaHRzID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgY2xpcHBpbmc7IGB0cnVlYCB0byBsZXQgdGhlIHJlbmRlcmVyCiAgICAJCSAqIHBhc3MgdGhlIGNsaXBwaW5nUGxhbmVzIHVuaWZvcm0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5jbGlwcGluZyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYHRydWVgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmZvcmNlU2luZ2xlUGFzcyA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBvYmplY3QgYWxsb3dzIHRvIGVuYWJsZSBjZXJ0YWluIFdlYkdMIDIgZXh0ZW5zaW9ucy4KICAgIAkJICoKICAgIAkJICogLSBjbGlwQ3VsbERpc3RhbmNlOiBzZXQgdG8gYHRydWVgIHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIGNsaXBwaW5nCiAgICAJCSAqIC0gbXVsdGlEcmF3OiBzZXQgdG8gYHRydWVgIHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIG11bHRpX2RyYXcgLyBlbmFibGUgZ2xfRHJhd0lECiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHt7Y2xpcEN1bGxEaXN0YW5jZTpmYWxzZSxtdWx0aURyYXc6ZmFsc2V9fQogICAgCQkgKi8KICAgIAkJdGhpcy5leHRlbnNpb25zID0gewogICAgCQkJY2xpcEN1bGxEaXN0YW5jZTogZmFsc2UsIC8vIHNldCB0byB1c2UgdmVydGV4IHNoYWRlciBjbGlwcGluZwogICAgCQkJbXVsdGlEcmF3OiBmYWxzZSAvLyBzZXQgdG8gdXNlIHZlcnRleCBzaGFkZXIgbXVsdGlfZHJhdyAvIGVuYWJsZSBnbF9EcmF3SUQKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGVuIHRoZSByZW5kZXJlZCBnZW9tZXRyeSBkb2Vzbid0IGluY2x1ZGUgdGhlc2UgYXR0cmlidXRlcyBidXQgdGhlCiAgICAJCSAqIG1hdGVyaWFsIGRvZXMsIHRoZXNlIGRlZmF1bHQgdmFsdWVzIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBzaGFkZXJzLiBUaGlzCiAgICAJCSAqIGF2b2lkcyBlcnJvcnMgd2hlbiBidWZmZXIgZGF0YSBpcyBtaXNzaW5nLgogICAgCQkgKgogICAgCQkgKiAtIGNvbG9yOiBbIDEsIDEsIDEgXQogICAgCQkgKiAtIHV2OiBbIDAsIDAgXQogICAgCQkgKiAtIHV2MTogWyAwLCAwIF0KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdH0KICAgIAkJICovCiAgICAJCXRoaXMuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyA9IHsKICAgIAkJCSdjb2xvcic6IFsgMSwgMSwgMSBdLAogICAgCQkJJ3V2JzogWyAwLCAwIF0sCiAgICAJCQkndXYxJzogWyAwLCAwIF0KICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBzZXQsIHRoaXMgY2FsbHMgW2dsLmJpbmRBdHRyaWJMb2NhdGlvbl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dlYkdMUmVuZGVyaW5nQ29udGV4dC9iaW5kQXR0cmliTG9jYXRpb259CiAgICAJCSAqIHRvIGJpbmQgYSBnZW5lcmljIHZlcnRleCBpbmRleCB0byBhbiBhdHRyaWJ1dGUgdmFyaWFibGUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMuaW5kZXgwQXR0cmlidXRlTmFtZSA9IHVuZGVmaW5lZDsKCiAgICAJCS8qKgogICAgCQkgKiBDYW4gYmUgdXNlZCB0byBmb3JjZSBhIHVuaWZvcm0gdXBkYXRlIHdoaWxlIGNoYW5naW5nIHVuaWZvcm1zIGluCiAgICAJCSAqIHtAbGluayBPYmplY3QzRCNvbkJlZm9yZVJlbmRlcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBEZWZpbmVzIHRoZSBHTFNMIHZlcnNpb24gb2YgY3VzdG9tIHNoYWRlciBjb2RlLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7PyhHTFNMMXxHTFNMMyl9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuZ2xzbFZlcnNpb24gPSBudWxsOwoKICAgIAkJaWYgKCBwYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCiAgICAJCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBzb3VyY2UuZnJhZ21lbnRTaGFkZXI7CiAgICAJCXRoaXMudmVydGV4U2hhZGVyID0gc291cmNlLnZlcnRleFNoYWRlcjsKCiAgICAJCXRoaXMudW5pZm9ybXMgPSBjbG9uZVVuaWZvcm1zKCBzb3VyY2UudW5pZm9ybXMgKTsKICAgIAkJdGhpcy51bmlmb3Jtc0dyb3VwcyA9IGNsb25lVW5pZm9ybXNHcm91cHMoIHNvdXJjZS51bmlmb3Jtc0dyb3VwcyApOwoKICAgIAkJdGhpcy5kZWZpbmVzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5kZWZpbmVzICk7CgogICAgCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CiAgICAJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCiAgICAJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKICAgIAkJdGhpcy5saWdodHMgPSBzb3VyY2UubGlnaHRzOwogICAgCQl0aGlzLmNsaXBwaW5nID0gc291cmNlLmNsaXBwaW5nOwoKICAgIAkJdGhpcy5leHRlbnNpb25zID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5leHRlbnNpb25zICk7CgogICAgCQl0aGlzLmdsc2xWZXJzaW9uID0gc291cmNlLmdsc2xWZXJzaW9uOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJdG9KU09OKCBtZXRhICkgewoKICAgIAkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKICAgIAkJZGF0YS5nbHNsVmVyc2lvbiA9IHRoaXMuZ2xzbFZlcnNpb247CiAgICAJCWRhdGEudW5pZm9ybXMgPSB7fTsKCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gdGhpcy51bmlmb3JtcyApIHsKCiAgICAJCQljb25zdCB1bmlmb3JtID0gdGhpcy51bmlmb3Jtc1sgbmFtZSBdOwogICAgCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKICAgIAkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNUZXh0dXJlICkgewoKICAgIAkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CiAgICAJCQkJCXR5cGU6ICd0JywKICAgIAkJCQkJdmFsdWU6IHZhbHVlLnRvSlNPTiggbWV0YSApLnV1aWQKICAgIAkJCQl9OwoKICAgIAkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzQ29sb3IgKSB7CgogICAgCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKICAgIAkJCQkJdHlwZTogJ2MnLAogICAgCQkJCQl2YWx1ZTogdmFsdWUuZ2V0SGV4KCkKICAgIAkJCQl9OwoKICAgIAkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMiApIHsKCiAgICAJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewogICAgCQkJCQl0eXBlOiAndjInLAogICAgCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCiAgICAJCQkJfTsKCiAgICAJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjMgKSB7CgogICAgCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKICAgIAkJCQkJdHlwZTogJ3YzJywKICAgIAkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgCQkJCX07CgogICAgCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3I0ICkgewoKICAgIAkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CiAgICAJCQkJCXR5cGU6ICd2NCcsCiAgICAJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKICAgIAkJCQl9OwoKICAgIAkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzTWF0cml4MyApIHsKCiAgICAJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewogICAgCQkJCQl0eXBlOiAnbTMnLAogICAgCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCiAgICAJCQkJfTsKCiAgICAJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDQgKSB7CgogICAgCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKICAgIAkJCQkJdHlwZTogJ200JywKICAgIAkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQogICAgCQkJCX07CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewogICAgCQkJCQl2YWx1ZTogdmFsdWUKICAgIAkJCQl9OwoKICAgIAkJCQkvLyBub3RlOiB0aGUgYXJyYXkgdmFyaWFudHMgdjJ2LCB2M3YsIHY0diwgbTR2IGFuZCB0diBhcmUgbm90IHN1cHBvcnRlZCBzbyBmYXIKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLmRlZmluZXMgKS5sZW5ndGggPiAwICkgZGF0YS5kZWZpbmVzID0gdGhpcy5kZWZpbmVzOwoKICAgIAkJZGF0YS52ZXJ0ZXhTaGFkZXIgPSB0aGlzLnZlcnRleFNoYWRlcjsKICAgIAkJZGF0YS5mcmFnbWVudFNoYWRlciA9IHRoaXMuZnJhZ21lbnRTaGFkZXI7CgogICAgCQlkYXRhLmxpZ2h0cyA9IHRoaXMubGlnaHRzOwogICAgCQlkYXRhLmNsaXBwaW5nID0gdGhpcy5jbGlwcGluZzsKCiAgICAJCWNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKCiAgICAJCWZvciAoIGNvbnN0IGtleSBpbiB0aGlzLmV4dGVuc2lvbnMgKSB7CgogICAgCQkJaWYgKCB0aGlzLmV4dGVuc2lvbnNbIGtleSBdID09PSB0cnVlICkgZXh0ZW5zaW9uc1sga2V5IF0gPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJaWYgKCBPYmplY3Qua2V5cyggZXh0ZW5zaW9ucyApLmxlbmd0aCA+IDAgKSBkYXRhLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zOwoKICAgIAkJcmV0dXJuIGRhdGE7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBjYW1lcmFzLiBUaGlzIGNsYXNzIHNob3VsZCBhbHdheXMgYmUgaW5oZXJpdGVkCiAgICAgKiB3aGVuIHlvdSBidWlsZCBhIG5ldyBjYW1lcmEuCiAgICAgKgogICAgICogQGFic3RyYWN0CiAgICAgKiBAYXVnbWVudHMgT2JqZWN0M0QKICAgICAqLwogICAgY2xhc3MgQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0QgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGNhbWVyYS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvcigpIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0NhbWVyYSA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnQ2FtZXJhJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgaW52ZXJzZSBvZiB0aGUgY2FtZXJhJ3Mgd29ybGQgbWF0cml4LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7TWF0cml4NH0KICAgIAkJICovCiAgICAJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtNYXRyaXg0fQogICAgCQkgKi8KICAgIAkJdGhpcy5wcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgaW52ZXJzZSBvZiB0aGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtNYXRyaXg0fQogICAgCQkgKi8KICAgIAkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgogICAgCQkvKioKICAgIAkJICogVGhlIGNvb3JkaW5hdGUgc3lzdGVtIGluIHdoaWNoIHRoZSBjYW1lcmEgaXMgdXNlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9CiAgICAJCSAqLwogICAgCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW07CgogICAgCX0KCiAgICAJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgogICAgCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKICAgIAkJdGhpcy5tYXRyaXhXb3JsZEludmVyc2UuY29weSggc291cmNlLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoKICAgIAkJdGhpcy5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4ICk7CiAgICAJCXRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggc291cmNlLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgogICAgCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSBzb3VyY2UuY29vcmRpbmF0ZVN5c3RlbTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSAoImxvb2siKSBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKgogICAgCSAqIFRoaXMgbWV0aG9kIGlzIG92ZXJ3cml0dGVuIHNpbmNlIGNhbWVyYXMgaGF2ZSBhIGRpZmZlcmVudCBmb3J3YXJkIHZlY3RvciBjb21wYXJlZCB0byBvdGhlcgogICAgCSAqIDNEIG9iamVjdHMuIEEgY2FtZXJhIGxvb2tzIGRvd24gaXRzIGxvY2FsLCBuZWdhdGl2ZSB6LWF4aXMgYnkgZGVmYXVsdC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIGRpcmVjdGlvbiBpbiB3b3JsZCBzcGFjZS4KICAgIAkgKi8KICAgIAlnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKICAgIAkJcmV0dXJuIHN1cGVyLmdldFdvcmxkRGlyZWN0aW9uKCB0YXJnZXQgKS5uZWdhdGUoKTsKCiAgICAJfQoKICAgIAl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgogICAgCQlzdXBlci51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCiAgICAJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCiAgICAJfQoKICAgIAl1cGRhdGVXb3JsZE1hdHJpeCggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKSB7CgogICAgCQlzdXBlci51cGRhdGVXb3JsZE1hdHJpeCggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKTsKCiAgICAJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCiAgICAJfQoKICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfdjMkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKICAgIGNvbnN0IF9taW5UYXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CiAgICBjb25zdCBfbWF4VGFyZ2V0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKICAgIC8qKgogICAgICogQ2FtZXJhIHRoYXQgdXNlcyBbcGVyc3BlY3RpdmUgcHJvamVjdGlvbl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGVyc3BlY3RpdmVfKGdyYXBoaWNhbCl9LgogICAgICoKICAgICAqIFRoaXMgcHJvamVjdGlvbiBtb2RlIGlzIGRlc2lnbmVkIHRvIG1pbWljIHRoZSB3YXkgdGhlIGh1bWFuIGV5ZSBzZWVzLiBJdAogICAgICogaXMgdGhlIG1vc3QgY29tbW9uIHByb2plY3Rpb24gbW9kZSB1c2VkIGZvciByZW5kZXJpbmcgYSAzRCBzY2VuZS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA0NSwgd2lkdGggLyBoZWlnaHQsIDEsIDEwMDAgKTsKICAgICAqIHNjZW5lLmFkZCggY2FtZXJhICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAYXVnbWVudHMgQ2FtZXJhCiAgICAgKi8KICAgIGNsYXNzIFBlcnNwZWN0aXZlQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBwZXJzcGVjdGl2ZSBjYW1lcmEuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2Zvdj01MF0gLSBUaGUgdmVydGljYWwgZmllbGQgb2Ygdmlldy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2FzcGVjdD0xXSAtIFRoZSBhc3BlY3QgcmF0aW8uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtuZWFyPTAuMV0gLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2Zhcj0yMDAwXSAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIGZvdiA9IDUwLCBhc3BlY3QgPSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzUGVyc3BlY3RpdmVDYW1lcmEgPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ1BlcnNwZWN0aXZlQ2FtZXJhJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgdmVydGljYWwgZmllbGQgb2YgdmlldywgZnJvbSBib3R0b20gdG8gdG9wIG9mIHZpZXcsCiAgICAJCSAqIGluIGRlZ3JlZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDUwCiAgICAJCSAqLwogICAgCQl0aGlzLmZvdiA9IGZvdjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgem9vbSBmYWN0b3Igb2YgdGhlIGNhbWVyYS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy56b29tID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4gVGhlIHZhbGlkIHJhbmdlIGlzIGdyZWF0ZXIgdGhhbiBgMGAKICAgIAkJICogYW5kIGxlc3MgdGhhbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmFyfS4KICAgIAkJICoKICAgIAkJICogTm90ZSB0aGF0LCB1bmxpa2UgZm9yIHRoZSB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhfSwgYDBgIGlzIDxlbT5ub3Q8L2VtPiBhCiAgICAJCSAqIHZhbGlkIHZhbHVlIGZvciBhIHBlcnNwZWN0aXZlIGNhbWVyYSdzIG5lYXIgcGxhbmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAuMQogICAgCQkgKi8KICAgIAkJdGhpcy5uZWFyID0gbmVhcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY2FtZXJhJ3MgZmFyIHBsYW5lLiBNdXN0IGJlIGdyZWF0ZXIgdGhhbiB0aGUKICAgIAkJICogY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjbmVhcn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDIwMDAKICAgIAkJICovCiAgICAJCXRoaXMuZmFyID0gZmFyOwoKICAgIAkJLyoqCiAgICAJCSAqIE9iamVjdCBkaXN0YW5jZSB1c2VkIGZvciBzdGVyZW9zY29weSBhbmQgZGVwdGgtb2YtZmllbGQgZWZmZWN0cy4gVGhpcwogICAgCQkgKiBwYXJhbWV0ZXIgZG9lcyBub3QgaW5mbHVlbmNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCB1bmxlc3MgYQogICAgCQkgKiB7QGxpbmsgU3RlcmVvQ2FtZXJhfSBpcyBiZWluZyB1c2VkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxMAogICAgCQkgKi8KICAgIAkJdGhpcy5mb2N1cyA9IDEwOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBhc3BlY3QgcmF0aW8sIHVzdWFsbHkgdGhlIGNhbnZhcyB3aWR0aCAvIGNhbnZhcyBoZWlnaHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuYXNwZWN0ID0gYXNwZWN0OwoKICAgIAkJLyoqCiAgICAJCSAqIFJlcHJlc2VudHMgdGhlIGZydXN0dW0gd2luZG93IHNwZWNpZmljYXRpb24uIFRoaXMgcHJvcGVydHkgc2hvdWxkIG5vdCBiZSBlZGl0ZWQKICAgIAkJICogZGlyZWN0bHkgYnV0IHZpYSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0gYW5kIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNjbGVhclZpZXdPZmZzZXR9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P09iamVjdH0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy52aWV3ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBGaWxtIHNpemUgdXNlZCBmb3IgdGhlIGxhcmdlciBheGlzLiBEZWZhdWx0IGlzIGAzNWAgKG1pbGxpbWV0ZXJzKS4gVGhpcwogICAgCQkgKiBwYXJhbWV0ZXIgZG9lcyBub3QgaW5mbHVlbmNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCB1bmxlc3Mge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1PZmZzZXR9CiAgICAJCSAqIGlzIHNldCB0byBhIG5vbnplcm8gdmFsdWUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDM1CiAgICAJCSAqLwogICAgCQl0aGlzLmZpbG1HYXVnZSA9IDM1OwoKICAgIAkJLyoqCiAgICAJCSAqIEhvcml6b250YWwgb2ZmLWNlbnRlciBvZmZzZXQgaW4gdGhlIHNhbWUgdW5pdCBhcyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5maWxtT2Zmc2V0ID0gMDsKCiAgICAJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKICAgIAkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCiAgICAJCXRoaXMuZm92ID0gc291cmNlLmZvdjsKICAgIAkJdGhpcy56b29tID0gc291cmNlLnpvb207CgogICAgCQl0aGlzLm5lYXIgPSBzb3VyY2UubmVhcjsKICAgIAkJdGhpcy5mYXIgPSBzb3VyY2UuZmFyOwogICAgCQl0aGlzLmZvY3VzID0gc291cmNlLmZvY3VzOwoKICAgIAkJdGhpcy5hc3BlY3QgPSBzb3VyY2UuYXNwZWN0OwogICAgCQl0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnZpZXcgKTsKCiAgICAJCXRoaXMuZmlsbUdhdWdlID0gc291cmNlLmZpbG1HYXVnZTsKICAgIAkJdGhpcy5maWxtT2Zmc2V0ID0gc291cmNlLmZpbG1PZmZzZXQ7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBGT1YgYnkgZm9jYWwgbGVuZ3RoIGluIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCiAgICAJICoKICAgIAkgKiBUaGUgZGVmYXVsdCBmaWxtIGdhdWdlIGlzIDM1LCBzbyB0aGF0IHRoZSBmb2NhbCBsZW5ndGggY2FuIGJlIHNwZWNpZmllZCBmb3IKICAgIAkgKiBhIDM1bW0gKGZ1bGwgZnJhbWUpIGNhbWVyYS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBmb2NhbExlbmd0aCAtIFZhbHVlcyBmb3IgZm9jYWwgbGVuZ3RoIGFuZCBmaWxtIGdhdWdlIG11c3QgaGF2ZSB0aGUgc2FtZSB1bml0LgogICAgCSAqLwogICAgCXNldEZvY2FsTGVuZ3RoKCBmb2NhbExlbmd0aCApIHsKCiAgICAJCS8qKiBzZWUge0BsaW5rIGh0dHA6Ly93d3cuYm9iYXRraW5zLmNvbS9waG90b2dyYXBoeS90ZWNobmljYWwvZmllbGRfb2Zfdmlldy5odG1sfSAqLwogICAgCQljb25zdCB2RXh0ZW50U2xvcGUgPSAwLjUgKiB0aGlzLmdldEZpbG1IZWlnaHQoKSAvIGZvY2FsTGVuZ3RoOwoKICAgIAkJdGhpcy5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggdkV4dGVudFNsb3BlICk7CiAgICAJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGZvY2FsIGxlbmd0aCBmcm9tIHRoZSBjdXJyZW50IHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmb3Z9IGFuZAogICAgCSAqIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmaWxtR2F1Z2V9LgogICAgCSAqCiAgICAJICogQHJldHVybiB7bnVtYmVyfSBUaGUgY29tcHV0ZWQgZm9jYWwgbGVuZ3RoLgogICAgCSAqLwogICAgCWdldEZvY2FsTGVuZ3RoKCkgewoKICAgIAkJY29uc3QgdkV4dGVudFNsb3BlID0gTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApOwoKICAgIAkJcmV0dXJuIDAuNSAqIHRoaXMuZ2V0RmlsbUhlaWdodCgpIC8gdkV4dGVudFNsb3BlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmVydGljYWwgZmllbGQgb2YgdmlldyBhbmdsZSBpbiBkZWdyZWVzIGNvbnNpZGVyaW5nIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSN6b29tfS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGVmZmVjdGl2ZSBGT1YuCiAgICAJICovCiAgICAJZ2V0RWZmZWN0aXZlRk9WKCkgewoKICAgIAkJcmV0dXJuIFJBRDJERUcgKiAyICogTWF0aC5hdGFuKAogICAgCQkJTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApIC8gdGhpcy56b29tICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgd2lkdGggb2YgdGhlIGltYWdlIG9uIHRoZSBmaWxtLiBJZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjYXNwZWN0fSBpcyBncmVhdGVyIHRoYW4gb3IKICAgIAkgKiBlcXVhbCB0byBvbmUgKGxhbmRzY2FwZSBmb3JtYXQpLCB0aGUgcmVzdWx0IGVxdWFscyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGZpbG0gd2lkdGguCiAgICAJICovCiAgICAJZ2V0RmlsbVdpZHRoKCkgewoKICAgIAkJLy8gZmlsbSBub3QgY29tcGxldGVseSBjb3ZlcmVkIGluIHBvcnRyYWl0IGZvcm1hdCAoYXNwZWN0IDwgMSkKICAgIAkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4oIHRoaXMuYXNwZWN0LCAxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgaGVpZ2h0IG9mIHRoZSBpbWFnZSBvbiB0aGUgZmlsbS4gSWYge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2FzcGVjdH0gaXMgZ3JlYXRlciB0aGFuIG9yCiAgICAJICogZXF1YWwgdG8gb25lIChsYW5kc2NhcGUgZm9ybWF0KSwgdGhlIHJlc3VsdCBlcXVhbHMge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBmaWxtIHdpZHRoLgogICAgCSAqLwogICAgCWdldEZpbG1IZWlnaHQoKSB7CgogICAgCQkvLyBmaWxtIG5vdCBjb21wbGV0ZWx5IGNvdmVyZWQgaW4gbGFuZHNjYXBlIGZvcm1hdCAoYXNwZWN0ID4gMSkKICAgIAkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlIC8gTWF0aC5tYXgoIHRoaXMuYXNwZWN0LCAxICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIDJEIGJvdW5kcyBvZiB0aGUgY2FtZXJhJ3Mgdmlld2FibGUgcmVjdGFuZ2xlIGF0IGEgZ2l2ZW4gZGlzdGFuY2UgYWxvbmcgdGhlIHZpZXdpbmcgZGlyZWN0aW9uLgogICAgCSAqIFNldHMgYG1pblRhcmdldGAgYW5kIGBtYXhUYXJnZXRgIHRvIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgbG93ZXItbGVmdCBhbmQgdXBwZXItcmlnaHQgY29ybmVycyBvZiB0aGUgdmlldyByZWN0YW5nbGUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgdmlld2luZyBkaXN0YW5jZS4KICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1pblRhcmdldCAtIFRoZSBsb3dlci1sZWZ0IGNvcm5lciBvZiB0aGUgdmlldyByZWN0YW5nbGUgaXMgd3JpdHRlbiBpbnRvIHRoaXMgdmVjdG9yLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gbWF4VGFyZ2V0IC0gVGhlIHVwcGVyLXJpZ2h0IGNvcm5lciBvZiB0aGUgdmlldyByZWN0YW5nbGUgaXMgd3JpdHRlbiBpbnRvIHRoaXMgdmVjdG9yLgogICAgCSAqLwogICAgCWdldFZpZXdCb3VuZHMoIGRpc3RhbmNlLCBtaW5UYXJnZXQsIG1heFRhcmdldCApIHsKCiAgICAJCV92MyQxLnNldCggLTEsIC0xLCAwLjUgKS5hcHBseU1hdHJpeDQoIHRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCiAgICAJCW1pblRhcmdldC5zZXQoIF92MyQxLngsIF92MyQxLnkgKS5tdWx0aXBseVNjYWxhciggLSBkaXN0YW5jZSAvIF92MyQxLnogKTsKCiAgICAJCV92MyQxLnNldCggMSwgMSwgMC41ICkuYXBwbHlNYXRyaXg0KCB0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgogICAgCQltYXhUYXJnZXQuc2V0KCBfdjMkMS54LCBfdjMkMS55ICkubXVsdGlwbHlTY2FsYXIoIC0gZGlzdGFuY2UgLyBfdjMkMS56ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29tcHV0ZXMgdGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIGNhbWVyYSdzIHZpZXdhYmxlIHJlY3RhbmdsZSBhdCBhIGdpdmVuIGRpc3RhbmNlIGFsb25nIHRoZSB2aWV3aW5nIGRpcmVjdGlvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSB2aWV3aW5nIGRpc3RhbmNlLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yMn0gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHJlc3VsdCB3aGVyZSB4IGlzIHdpZHRoIGFuZCB5IGlzIGhlaWdodC4KICAgIAkgKiBAcmV0dXJucyB7VmVjdG9yMn0gVGhlIHZpZXcgc2l6ZS4KICAgIAkgKi8KICAgIAlnZXRWaWV3U2l6ZSggZGlzdGFuY2UsIHRhcmdldCApIHsKCiAgICAJCXRoaXMuZ2V0Vmlld0JvdW5kcyggZGlzdGFuY2UsIF9taW5UYXJnZXQsIF9tYXhUYXJnZXQgKTsKCiAgICAJCXJldHVybiB0YXJnZXQuc3ViVmVjdG9ycyggX21heFRhcmdldCwgX21pblRhcmdldCApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgYW4gb2Zmc2V0IGluIGEgbGFyZ2VyIGZydXN0dW0uIFRoaXMgaXMgdXNlZnVsIGZvciBtdWx0aS13aW5kb3cgb3IKICAgIAkgKiBtdWx0aS1tb25pdG9yL211bHRpLW1hY2hpbmUgc2V0dXBzLgogICAgCSAqCiAgICAJICogRm9yIGV4YW1wbGUsIGlmIHlvdSBoYXZlIDN4MiBtb25pdG9ycyBhbmQgZWFjaCBtb25pdG9yIGlzIDE5MjB4MTA4MCBhbmQKICAgIAkgKiB0aGUgbW9uaXRvcnMgYXJlIGluIGdyaWQgbGlrZSB0aGlzCiAgICAJICpgYGAKICAgIAkgKiAgICstLS0rLS0tKy0tLSsKICAgIAkgKiAgIHwgQSB8IEIgfCBDIHwKICAgIAkgKiAgICstLS0rLS0tKy0tLSsKICAgIAkgKiAgIHwgRCB8IEUgfCBGIHwKICAgIAkgKiAgICstLS0rLS0tKy0tLSsKICAgIAkgKmBgYAogICAgCSAqIHRoZW4gZm9yIGVhY2ggbW9uaXRvciB5b3Ugd291bGQgY2FsbCBpdCBsaWtlIHRoaXM6CiAgICAJICpgYGBqcwogICAgCSAqIGNvbnN0IHcgPSAxOTIwOwogICAgCSAqIGNvbnN0IGggPSAxMDgwOwogICAgCSAqIGNvbnN0IGZ1bGxXaWR0aCA9IHcgKiAzOwogICAgCSAqIGNvbnN0IGZ1bGxIZWlnaHQgPSBoICogMjsKICAgIAkgKgogICAgCSAqIC8vIC0tQS0tCiAgICAJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAwLCB3LCBoICk7CiAgICAJICogLy8gLS1CLS0KICAgIAkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDAsIHcsIGggKTsKICAgIAkgKiAvLyAtLUMtLQogICAgCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAyLCBoICogMCwgdywgaCApOwogICAgCSAqIC8vIC0tRC0tCiAgICAJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAxLCB3LCBoICk7CiAgICAJICogLy8gLS1FLS0KICAgIAkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDEsIHcsIGggKTsKICAgIAkgKiAvLyAtLUYtLQogICAgCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAyLCBoICogMSwgdywgaCApOwogICAgCSAqIGBgYAogICAgCSAqCiAgICAJICogTm90ZSB0aGVyZSBpcyBubyByZWFzb24gbW9uaXRvcnMgaGF2ZSB0byBiZSB0aGUgc2FtZSBzaXplIG9yIGluIGEgZ3JpZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsV2lkdGggLSBUaGUgZnVsbCB3aWR0aCBvZiBtdWx0aXZpZXcgc2V0dXAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxIZWlnaHQgLSBUaGUgZnVsbCBoZWlnaHQgb2YgbXVsdGl2aWV3IHNldHVwLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGhvcml6b250YWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHN1YmNhbWVyYS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiBzdWJjYW1lcmEuCiAgICAJICovCiAgICAJc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKICAgIAkJdGhpcy5hc3BlY3QgPSBmdWxsV2lkdGggLyBmdWxsSGVpZ2h0OwoKICAgIAkJaWYgKCB0aGlzLnZpZXcgPT09IG51bGwgKSB7CgogICAgCQkJdGhpcy52aWV3ID0gewogICAgCQkJCWVuYWJsZWQ6IHRydWUsCiAgICAJCQkJZnVsbFdpZHRoOiAxLAogICAgCQkJCWZ1bGxIZWlnaHQ6IDEsCiAgICAJCQkJb2Zmc2V0WDogMCwKICAgIAkJCQlvZmZzZXRZOiAwLAogICAgCQkJCXdpZHRoOiAxLAogICAgCQkJCWhlaWdodDogMQogICAgCQkJfTsKCiAgICAJCX0KCiAgICAJCXRoaXMudmlldy5lbmFibGVkID0gdHJ1ZTsKICAgIAkJdGhpcy52aWV3LmZ1bGxXaWR0aCA9IGZ1bGxXaWR0aDsKICAgIAkJdGhpcy52aWV3LmZ1bGxIZWlnaHQgPSBmdWxsSGVpZ2h0OwogICAgCQl0aGlzLnZpZXcub2Zmc2V0WCA9IHg7CiAgICAJCXRoaXMudmlldy5vZmZzZXRZID0geTsKICAgIAkJdGhpcy52aWV3LndpZHRoID0gd2lkdGg7CiAgICAJCXRoaXMudmlldy5oZWlnaHQgPSBoZWlnaHQ7CgogICAgCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIHRoZSB2aWV3IG9mZnNldCBmcm9tIHRoZSBwcm9qZWN0aW9uIG1hdHJpeC4KICAgIAkgKi8KICAgIAljbGVhclZpZXdPZmZzZXQoKSB7CgogICAgCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLnZpZXcuZW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJfQoKICAgIAkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVXBkYXRlcyB0aGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguIE11c3QgYmUgY2FsbGVkIGFmdGVyIGFueSBjaGFuZ2Ugb2YKICAgIAkgKiBjYW1lcmEgcHJvcGVydGllcy4KICAgIAkgKi8KICAgIAl1cGRhdGVQcm9qZWN0aW9uTWF0cml4KCkgewoKICAgIAkJY29uc3QgbmVhciA9IHRoaXMubmVhcjsKICAgIAkJbGV0IHRvcCA9IG5lYXIgKiBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICkgLyB0aGlzLnpvb207CiAgICAJCWxldCBoZWlnaHQgPSAyICogdG9wOwogICAgCQlsZXQgd2lkdGggPSB0aGlzLmFzcGVjdCAqIGhlaWdodDsKICAgIAkJbGV0IGxlZnQgPSAtMC41ICogd2lkdGg7CiAgICAJCWNvbnN0IHZpZXcgPSB0aGlzLnZpZXc7CgogICAgCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCiAgICAJCQljb25zdCBmdWxsV2lkdGggPSB2aWV3LmZ1bGxXaWR0aCwKICAgIAkJCQlmdWxsSGVpZ2h0ID0gdmlldy5mdWxsSGVpZ2h0OwoKICAgIAkJCWxlZnQgKz0gdmlldy5vZmZzZXRYICogd2lkdGggLyBmdWxsV2lkdGg7CiAgICAJCQl0b3AgLT0gdmlldy5vZmZzZXRZICogaGVpZ2h0IC8gZnVsbEhlaWdodDsKICAgIAkJCXdpZHRoICo9IHZpZXcud2lkdGggLyBmdWxsV2lkdGg7CiAgICAJCQloZWlnaHQgKj0gdmlldy5oZWlnaHQgLyBmdWxsSGVpZ2h0OwoKICAgIAkJfQoKICAgIAkJY29uc3Qgc2tldyA9IHRoaXMuZmlsbU9mZnNldDsKICAgIAkJaWYgKCBza2V3ICE9PSAwICkgbGVmdCArPSBuZWFyICogc2tldyAvIHRoaXMuZ2V0RmlsbVdpZHRoKCk7CgogICAgCQl0aGlzLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0LCBsZWZ0ICsgd2lkdGgsIHRvcCwgdG9wIC0gaGVpZ2h0LCBuZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgogICAgCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKICAgIAl9CgogICAgCXRvSlNPTiggbWV0YSApIHsKCiAgICAJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCiAgICAJCWRhdGEub2JqZWN0LmZvdiA9IHRoaXMuZm92OwogICAgCQlkYXRhLm9iamVjdC56b29tID0gdGhpcy56b29tOwoKICAgIAkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKICAgIAkJZGF0YS5vYmplY3QuZmFyID0gdGhpcy5mYXI7CiAgICAJCWRhdGEub2JqZWN0LmZvY3VzID0gdGhpcy5mb2N1czsKCiAgICAJCWRhdGEub2JqZWN0LmFzcGVjdCA9IHRoaXMuYXNwZWN0OwoKICAgIAkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSBkYXRhLm9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIHRoaXMudmlldyApOwoKICAgIAkJZGF0YS5vYmplY3QuZmlsbUdhdWdlID0gdGhpcy5maWxtR2F1Z2U7CiAgICAJCWRhdGEub2JqZWN0LmZpbG1PZmZzZXQgPSB0aGlzLmZpbG1PZmZzZXQ7CgogICAgCQlyZXR1cm4gZGF0YTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBmb3YgPSAtOTA7IC8vIG5lZ2F0aXZlIGZvdiBpcyBub3QgYW4gZXJyb3IKICAgIGNvbnN0IGFzcGVjdCA9IDE7CgogICAgLyoqCiAgICAgKiBBIHNwZWNpYWwgdHlwZSBvZiBjYW1lcmEgdGhhdCBpcyBwb3NpdGlvbmVkIGluIDNEIHNwYWNlIHRvIHJlbmRlciBpdHMgc3Vycm91bmRpbmdzIGludG8gYQogICAgICogY3ViZSByZW5kZXIgdGFyZ2V0LiBUaGUgcmVuZGVyIHRhcmdldCBjYW4gdGhlbiBiZSB1c2VkIGFzIGFuIGVudmlyb25tZW50IG1hcCBmb3IgcmVuZGVyaW5nCiAgICAgKiByZWFsdGltZSByZWZsZWN0aW9ucyBpbiB5b3VyIHNjZW5lLgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiAvLyBDcmVhdGUgY3ViZSByZW5kZXIgdGFyZ2V0CiAgICAgKiBjb25zdCBjdWJlUmVuZGVyVGFyZ2V0ID0gbmV3IFRIUkVFLldlYkdMQ3ViZVJlbmRlclRhcmdldCggMjU2LCB7IGdlbmVyYXRlTWlwbWFwczogdHJ1ZSwgbWluRmlsdGVyOiBUSFJFRS5MaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgfSApOwogICAgICoKICAgICAqIC8vIENyZWF0ZSBjdWJlIGNhbWVyYQogICAgICogY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBUSFJFRS5DdWJlQ2FtZXJhKCAxLCAxMDAwMDAsIGN1YmVSZW5kZXJUYXJnZXQgKTsKICAgICAqIHNjZW5lLmFkZCggY3ViZUNhbWVyYSApOwogICAgICoKICAgICAqIC8vIENyZWF0ZSBjYXIKICAgICAqIGNvbnN0IGNocm9tZU1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBlbnZNYXA6IGN1YmVSZW5kZXJUYXJnZXQudGV4dHVyZSB9ICk7CiAgICAgKiBjb25zdCBjYXIgPSBuZXcgVEhSRUUuTWVzaCggY2FyR2VvbWV0cnksIGNocm9tZU1hdGVyaWFsICk7CiAgICAgKiBzY2VuZS5hZGQoIGNhciApOwogICAgICoKICAgICAqIC8vIFVwZGF0ZSB0aGUgcmVuZGVyIHRhcmdldCBjdWJlCiAgICAgKiBjYXIudmlzaWJsZSA9IGZhbHNlOwogICAgICogY3ViZUNhbWVyYS5wb3NpdGlvbi5jb3B5KCBjYXIucG9zaXRpb24gKTsKICAgICAqIGN1YmVDYW1lcmEudXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKTsKICAgICAqCiAgICAgKiAvLyBSZW5kZXIgdGhlIHNjZW5lCiAgICAgKiBjYXIudmlzaWJsZSA9IHRydWU7CiAgICAgKiByZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmEgKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBPYmplY3QzRAogICAgICovCiAgICBjbGFzcyBDdWJlQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0QgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGN1YmUgY2FtZXJhLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IG5lYXIgLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4KICAgIAkgKiBAcGFyYW0ge1dlYkdMQ3ViZVJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIGN1YmUgcmVuZGVyIHRhcmdldC4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggbmVhciwgZmFyLCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJdGhpcy50eXBlID0gJ0N1YmVDYW1lcmEnOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBjdWJlIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtXZWJHTEN1YmVSZW5kZXJUYXJnZXR9CiAgICAJCSAqLwogICAgCQl0aGlzLnJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY3VycmVudCBhY3RpdmUgY29vcmRpbmF0ZSBzeXN0ZW0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY3VycmVudCBhY3RpdmUgbWlwbWFwIGxldmVsCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuYWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoKICAgIAkJY29uc3QgY2FtZXJhUFggPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKICAgIAkJY2FtZXJhUFgubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAJCXRoaXMuYWRkKCBjYW1lcmFQWCApOwoKICAgIAkJY29uc3QgY2FtZXJhTlggPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKICAgIAkJY2FtZXJhTlgubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAJCXRoaXMuYWRkKCBjYW1lcmFOWCApOwoKICAgIAkJY29uc3QgY2FtZXJhUFkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKICAgIAkJY2FtZXJhUFkubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAJCXRoaXMuYWRkKCBjYW1lcmFQWSApOwoKICAgIAkJY29uc3QgY2FtZXJhTlkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKICAgIAkJY2FtZXJhTlkubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAJCXRoaXMuYWRkKCBjYW1lcmFOWSApOwoKICAgIAkJY29uc3QgY2FtZXJhUFogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKICAgIAkJY2FtZXJhUFoubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAJCXRoaXMuYWRkKCBjYW1lcmFQWiApOwoKICAgIAkJY29uc3QgY2FtZXJhTlogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKICAgIAkJY2FtZXJhTloubGF5ZXJzID0gdGhpcy5sYXllcnM7CiAgICAJCXRoaXMuYWRkKCBjYW1lcmFOWiApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIE11c3QgYmUgY2FsbGVkIHdoZW4gdGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9mIHRoZSBjdWJlIGNhbWVyYSBpcyBjaGFuZ2VkLgogICAgCSAqLwogICAgCXVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CgogICAgCQljb25zdCBjb29yZGluYXRlU3lzdGVtID0gdGhpcy5jb29yZGluYXRlU3lzdGVtOwoKICAgIAkJY29uc3QgY2FtZXJhcyA9IHRoaXMuY2hpbGRyZW4uY29uY2F0KCk7CgogICAgCQljb25zdCBbIGNhbWVyYVBYLCBjYW1lcmFOWCwgY2FtZXJhUFksIGNhbWVyYU5ZLCBjYW1lcmFQWiwgY2FtZXJhTlogXSA9IGNhbWVyYXM7CgogICAgCQlmb3IgKCBjb25zdCBjYW1lcmEgb2YgY2FtZXJhcyApIHRoaXMucmVtb3ZlKCBjYW1lcmEgKTsKCiAgICAJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKICAgIAkJCWNhbWVyYVBYLnVwLnNldCggMCwgMSwgMCApOwogICAgCQkJY2FtZXJhUFgubG9va0F0KCAxLCAwLCAwICk7CgogICAgCQkJY2FtZXJhTlgudXAuc2V0KCAwLCAxLCAwICk7CiAgICAJCQljYW1lcmFOWC5sb29rQXQoIC0xLCAwLCAwICk7CgogICAgCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAtMSApOwogICAgCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgogICAgCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAxICk7CiAgICAJCQljYW1lcmFOWS5sb29rQXQoIDAsIC0xLCAwICk7CgogICAgCQkJY2FtZXJhUFoudXAuc2V0KCAwLCAxLCAwICk7CiAgICAJCQljYW1lcmFQWi5sb29rQXQoIDAsIDAsIDEgKTsKCiAgICAJCQljYW1lcmFOWi51cC5zZXQoIDAsIDEsIDAgKTsKICAgIAkJCWNhbWVyYU5aLmxvb2tBdCggMCwgMCwgLTEgKTsKCiAgICAJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQkJY2FtZXJhUFgudXAuc2V0KCAwLCAtMSwgMCApOwogICAgCQkJY2FtZXJhUFgubG9va0F0KCAtMSwgMCwgMCApOwoKICAgIAkJCWNhbWVyYU5YLnVwLnNldCggMCwgLTEsIDAgKTsKICAgIAkJCWNhbWVyYU5YLmxvb2tBdCggMSwgMCwgMCApOwoKICAgIAkJCWNhbWVyYVBZLnVwLnNldCggMCwgMCwgMSApOwogICAgCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgogICAgCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAtMSApOwogICAgCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtMSwgMCApOwoKICAgIAkJCWNhbWVyYVBaLnVwLnNldCggMCwgLTEsIDAgKTsKICAgIAkJCWNhbWVyYVBaLmxvb2tBdCggMCwgMCwgMSApOwoKICAgIAkJCWNhbWVyYU5aLnVwLnNldCggMCwgLTEsIDAgKTsKICAgIAkJCWNhbWVyYU5aLmxvb2tBdCggMCwgMCwgLTEgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuQ3ViZUNhbWVyYS51cGRhdGVDb29yZGluYXRlU3lzdGVtKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgogICAgCQl9CgogICAgCQlmb3IgKCBjb25zdCBjYW1lcmEgb2YgY2FtZXJhcyApIHsKCiAgICAJCQl0aGlzLmFkZCggY2FtZXJhICk7CgogICAgCQkJY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ2FsbGluZyB0aGlzIG1ldGhvZCB3aWxsIHJlbmRlciB0aGUgZ2l2ZW4gc2NlbmUgd2l0aCB0aGUgZ2l2ZW4gcmVuZGVyZXIKICAgIAkgKiBpbnRvIHRoZSBjdWJlIHJlbmRlciB0YXJnZXQgb2YgdGhlIGNhbWVyYS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7KFJlbmRlcmVyfFdlYkdMUmVuZGVyZXIpfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge1NjZW5lfSBzY2VuZSAtIFRoZSBzY2VuZSB0byByZW5kZXIuCiAgICAJICovCiAgICAJdXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKSB7CgogICAgCQlpZiAoIHRoaXMucGFyZW50ID09PSBudWxsICkgdGhpcy51cGRhdGVNYXRyaXhXb3JsZCgpOwoKICAgIAkJY29uc3QgeyByZW5kZXJUYXJnZXQsIGFjdGl2ZU1pcG1hcExldmVsIH0gPSB0aGlzOwoKICAgIAkJaWYgKCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gIT09IHJlbmRlcmVyLmNvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gcmVuZGVyZXIuY29vcmRpbmF0ZVN5c3RlbTsKCiAgICAJCQl0aGlzLnVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IFsgY2FtZXJhUFgsIGNhbWVyYU5YLCBjYW1lcmFQWSwgY2FtZXJhTlksIGNhbWVyYVBaLCBjYW1lcmFOWiBdID0gdGhpcy5jaGlsZHJlbjsKCiAgICAJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKICAgIAkJY29uc3QgY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKICAgIAkJY29uc3QgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCiAgICAJCWNvbnN0IGN1cnJlbnRYckVuYWJsZWQgPSByZW5kZXJlci54ci5lbmFibGVkOwoKICAgIAkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJY29uc3QgZ2VuZXJhdGVNaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKICAgIAkJcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKICAgIAkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhUFggKTsKCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCAxLCBhY3RpdmVNaXBtYXBMZXZlbCApOwogICAgCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWCApOwoKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDIsIGFjdGl2ZU1pcG1hcExldmVsICk7CiAgICAJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVBZICk7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMywgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKICAgIAkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlkgKTsKCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCA0LCBhY3RpdmVNaXBtYXBMZXZlbCApOwogICAgCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWiApOwoKICAgIAkJLy8gbWlwbWFwcyBhcmUgZ2VuZXJhdGVkIGR1cmluZyB0aGUgbGFzdCBjYWxsIG9mIHJlbmRlcigpCiAgICAJCS8vIGF0IHRoaXMgcG9pbnQsIGFsbCBzaWRlcyBvZiB0aGUgY3ViZSByZW5kZXIgdGFyZ2V0IGFyZSBkZWZpbmVkCgogICAgCQlyZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBnZW5lcmF0ZU1pcG1hcHM7CgogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgNSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKICAgIAkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlogKTsKCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgY3VycmVudEFjdGl2ZUN1YmVGYWNlLCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgKTsKCiAgICAJCXJlbmRlcmVyLnhyLmVuYWJsZWQgPSBjdXJyZW50WHJFbmFibGVkOwoKICAgIAkJcmVuZGVyVGFyZ2V0LnRleHR1cmUubmVlZHNQTVJFTVVwZGF0ZSA9IHRydWU7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGEgY3ViZSB0ZXh0dXJlIG1hZGUgdXAgb2Ygc2l4IGltYWdlcy4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLkN1YmVUZXh0dXJlTG9hZGVyKCk7CiAgICAgKiBsb2FkZXIuc2V0UGF0aCggJ3RleHR1cmVzL2N1YmUvcGlzYS8nICk7CiAgICAgKgogICAgICogY29uc3QgdGV4dHVyZUN1YmUgPSBsb2FkZXIubG9hZCggWwogICAgICogCSdweC5wbmcnLCAnbngucG5nJywgJ3B5LnBuZycsICdueS5wbmcnLCAncHoucG5nJywgJ256LnBuZycKICAgICAqIF0gKTsKICAgICAqCiAgICAgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmZmYsIGVudk1hcDogdGV4dHVyZUN1YmUgfSApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIFRleHR1cmUKICAgICAqLwogICAgY2xhc3MgQ3ViZVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBjdWJlIHRleHR1cmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PEltYWdlPn0gW2ltYWdlcz1bXV0gLSBBbiBhcnJheSBob2xkaW5nIGEgaW1hZ2UgZm9yIGVhY2ggc2lkZSBvZiBhIGN1YmUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPUN1YmVSZWZsZWN0aW9uTWFwcGluZ10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlIHZhbHVlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBpbWFnZXMgPSBbXSwgbWFwcGluZyA9IEN1YmVSZWZsZWN0aW9uTWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKICAgIAkJc3VwZXIoIGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0N1YmVUZXh0dXJlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgdGV4dHVyZSBpcyBmbGlwcGVkIGFsb25nIHRoZSB2ZXJ0aWNhbCBheGlzIHdoZW4KICAgIAkJICogdXBsb2FkZWQgdG8gdGhlIEdQVS4KICAgIAkJICoKICAgIAkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCBmYWxzZQogICAgCQkgKi8KICAgIAkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIEFsaWFzIGZvciB7QGxpbmsgQ3ViZVRleHR1cmUjaW1hZ2V9LgogICAgCSAqCiAgICAJICogQHR5cGUge0FycmF5PEltYWdlPn0KICAgIAkgKi8KICAgIAlnZXQgaW1hZ2VzKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuaW1hZ2U7CgogICAgCX0KCiAgICAJc2V0IGltYWdlcyggdmFsdWUgKSB7CgogICAgCQl0aGlzLmltYWdlID0gdmFsdWU7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIGN1YmUgcmVuZGVyIHRhcmdldCB1c2VkIGluIGNvbnRleHQgb2Yge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LgogICAgICoKICAgICAqIEBhdWdtZW50cyBXZWJHTFJlbmRlclRhcmdldAogICAgICovCiAgICBjbGFzcyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgY3ViZSByZW5kZXIgdGFyZ2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtzaXplPTFdIC0gVGhlIHNpemUgb2YgdGhlIHJlbmRlciB0YXJnZXQuCiAgICAJICogQHBhcmFtIHtSZW5kZXJUYXJnZXR+T3B0aW9uc30gW29wdGlvbnNdIC0gVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBzaXplID0gMSwgb3B0aW9ucyA9IHt9ICkgewoKICAgIAkJc3VwZXIoIHNpemUsIHNpemUsIG9wdGlvbnMgKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCiAgICAJCWNvbnN0IGltYWdlID0geyB3aWR0aDogc2l6ZSwgaGVpZ2h0OiBzaXplLCBkZXB0aDogMSB9OwogICAgCQljb25zdCBpbWFnZXMgPSBbIGltYWdlLCBpbWFnZSwgaW1hZ2UsIGltYWdlLCBpbWFnZSwgaW1hZ2UgXTsKCiAgICAJCS8qKgogICAgCQkgKiBPdmVyd3JpdHRlbiB3aXRoIGEgZGlmZmVyZW50IHRleHR1cmUgdHlwZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0RhdGFBcnJheVRleHR1cmV9CiAgICAJCSAqLwogICAgCQl0aGlzLnRleHR1cmUgPSBuZXcgQ3ViZVRleHR1cmUoIGltYWdlcyApOwogICAgCQl0aGlzLl9zZXRUZXh0dXJlT3B0aW9ucyggb3B0aW9ucyApOwoKICAgIAkJLy8gQnkgY29udmVudGlvbiAtLSBsaWtlbHkgYmFzZWQgb24gdGhlIFJlbmRlck1hbiBzcGVjIGZyb20gdGhlIDE5OTAncyAtLSBjdWJlIG1hcHMgYXJlIHNwZWNpZmllZCBieSBXZWJHTCAoYW5kIHRocmVlLmpzKQogICAgCQkvLyBpbiBhIGNvb3JkaW5hdGUgc3lzdGVtIGluIHdoaWNoIHBvc2l0aXZlLXggaXMgdG8gdGhlIHJpZ2h0IHdoZW4gbG9va2luZyB1cCB0aGUgcG9zaXRpdmUteiBheGlzIC0tIGluIG90aGVyIHdvcmRzLAogICAgCQkvLyBpbiBhIGxlZnQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBCeSBjb250aW51aW5nIHRoaXMgY29udmVudGlvbiwgcHJlZXhpc3RpbmcgY3ViZSBtYXBzIGNvbnRpbnVlZCB0byByZW5kZXIgY29ycmVjdGx5LgoKICAgIAkJLy8gdGhyZWUuanMgdXNlcyBhIHJpZ2h0LWhhbmRlZCBjb29yZGluYXRlIHN5c3RlbS4gU28gZW52aXJvbm1lbnQgbWFwcyB1c2VkIGluIHRocmVlLmpzIGFwcGVhciB0byBoYXZlIHB4IGFuZCBueCBzd2FwcGVkCiAgICAJCS8vIGFuZCB0aGUgZmxhZyBpc1JlbmRlclRhcmdldFRleHR1cmUgY29udHJvbHMgdGhpcyBjb252ZXJzaW9uLiBUaGUgZmxpcCBpcyBub3QgcmVxdWlyZWQgd2hlbiB1c2luZyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQudGV4dHVyZQogICAgCQkvLyBhcyBhIGN1YmUgdGV4dHVyZSAodGhpcyBpcyBkZXRlY3RlZCB3aGVuIGlzUmVuZGVyVGFyZ2V0VGV4dHVyZSBpcyBzZXQgdG8gdHJ1ZSBmb3IgY3ViZSB0ZXh0dXJlcykuCgogICAgCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmUgdG8gYSBjdWJlIG1hcC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlLgogICAgCSAqIEByZXR1cm4ge1dlYkdMQ3ViZVJlbmRlclRhcmdldH0gQSByZWZlcmVuY2UgdG8gdGhpcyBjdWJlIHJlbmRlciB0YXJnZXQuCiAgICAJICovCiAgICAJZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUoIHJlbmRlcmVyLCB0ZXh0dXJlICkgewoKICAgIAkJdGhpcy50ZXh0dXJlLnR5cGUgPSB0ZXh0dXJlLnR5cGU7CiAgICAJCXRoaXMudGV4dHVyZS5jb2xvclNwYWNlID0gdGV4dHVyZS5jb2xvclNwYWNlOwoKICAgIAkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwogICAgCQl0aGlzLnRleHR1cmUubWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CiAgICAJCXRoaXMudGV4dHVyZS5tYWdGaWx0ZXIgPSB0ZXh0dXJlLm1hZ0ZpbHRlcjsKCiAgICAJCWNvbnN0IHNoYWRlciA9IHsKCiAgICAJCQl1bmlmb3JtczogewogICAgCQkJCXRFcXVpcmVjdDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJfSwKCiAgICAJCQl2ZXJ0ZXhTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQkJdmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjsKCgkJCQl2ZWMzIHRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkgewoKCQkJCQlyZXR1cm4gbm9ybWFsaXplKCAoIG1hdHJpeCAqIHZlYzQoIGRpciwgMC4wICkgKS54eXogKTsKCgkJCQl9CgoJCQkJdm9pZCBtYWluKCkgewoKCQkJCQl2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApOwoKCQkJCQkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PgoJCQkJCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD4KCgkJCQl9CgkJCWAsCgogICAgCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQkJdW5pZm9ybSBzYW1wbGVyMkQgdEVxdWlyZWN0OwoKCQkJCXZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247CgoJCQkJI2luY2x1ZGUgPGNvbW1vbj4KCgkJCQl2b2lkIG1haW4oKSB7CgoJCQkJCXZlYzMgZGlyZWN0aW9uID0gbm9ybWFsaXplKCB2V29ybGREaXJlY3Rpb24gKTsKCgkJCQkJdmVjMiBzYW1wbGVVViA9IGVxdWlyZWN0VXYoIGRpcmVjdGlvbiApOwoKCQkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoIHRFcXVpcmVjdCwgc2FtcGxlVVYgKTsKCgkJCQl9CgkJCWAKICAgIAkJfTsKCiAgICAJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IEJveEdlb21ldHJ5KCA1LCA1LCA1ICk7CgogICAgCQljb25zdCBtYXRlcmlhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoKICAgIAkJCW5hbWU6ICdDdWJlbWFwRnJvbUVxdWlyZWN0JywKCiAgICAJCQl1bmlmb3JtczogY2xvbmVVbmlmb3Jtcyggc2hhZGVyLnVuaWZvcm1zICksCiAgICAJCQl2ZXJ0ZXhTaGFkZXI6IHNoYWRlci52ZXJ0ZXhTaGFkZXIsCiAgICAJCQlmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLAogICAgCQkJc2lkZTogQmFja1NpZGUsCiAgICAJCQlibGVuZGluZzogTm9CbGVuZGluZwoKICAgIAkJfSApOwoKICAgIAkJbWF0ZXJpYWwudW5pZm9ybXMudEVxdWlyZWN0LnZhbHVlID0gdGV4dHVyZTsKCiAgICAJCWNvbnN0IG1lc2ggPSBuZXcgTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgogICAgCQljb25zdCBjdXJyZW50TWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgogICAgCQkvLyBBdm9pZCBibHVycmVkIHBvbGVzCiAgICAJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgPT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHRleHR1cmUubWluRmlsdGVyID0gTGluZWFyRmlsdGVyOwoKICAgIAkJY29uc3QgY2FtZXJhID0gbmV3IEN1YmVDYW1lcmEoIDEsIDEwLCB0aGlzICk7CiAgICAJCWNhbWVyYS51cGRhdGUoIHJlbmRlcmVyLCBtZXNoICk7CgogICAgCQl0ZXh0dXJlLm1pbkZpbHRlciA9IGN1cnJlbnRNaW5GaWx0ZXI7CgogICAgCQltZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKICAgIAkJbWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDbGVhcnMgdGhpcyBjdWJlIHJlbmRlciB0YXJnZXQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NvbG9yPXRydWVdIC0gV2hldGhlciB0aGUgY29sb3IgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KICAgIAkgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZXB0aD10cnVlXSAtIFdoZXRoZXIgdGhlIGRlcHRoIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCiAgICAJICogQHBhcmFtIHtib29sZWFufSBbc3RlbmNpbD10cnVlXSAtIFdoZXRoZXIgdGhlIHN0ZW5jaWwgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KICAgIAkgKi8KICAgIAljbGVhciggcmVuZGVyZXIsIGNvbG9yID0gdHJ1ZSwgZGVwdGggPSB0cnVlLCBzdGVuY2lsID0gdHJ1ZSApIHsKCiAgICAJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCB0aGlzLCBpICk7CgogICAgCQkJcmVuZGVyZXIuY2xlYXIoIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCApOwoKICAgIAkJfQoKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBjdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGlzIGFsbW9zdCBpZGVudGljYWwgdG8gYW4ge0BsaW5rIE9iamVjdDNEfS4gSXRzIHB1cnBvc2UgaXMgdG8KICAgICAqIG1ha2Ugd29ya2luZyB3aXRoIGdyb3VwcyBvZiBvYmplY3RzIHN5bnRhY3RpY2FsbHkgY2xlYXJlci4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogLy8gQ3JlYXRlIGEgZ3JvdXAgYW5kIGFkZCB0aGUgdHdvIGN1YmVzLgogICAgICogLy8gVGhlc2UgY3ViZXMgY2FuIG5vdyBiZSByb3RhdGVkIC8gc2NhbGVkIGV0YyBhcyBhIGdyb3VwLgogICAgICogY29uc3QgZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKICAgICAqCiAgICAgKiBncm91cC5hZGQoIG1lc2hBICk7CiAgICAgKiBncm91cC5hZGQoIG1lc2hCICk7CiAgICAgKgogICAgICogc2NlbmUuYWRkKCBncm91cCApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIE9iamVjdDNECiAgICAgKi8KICAgIGNsYXNzIEdyb3VwIGV4dGVuZHMgT2JqZWN0M0QgewoKICAgIAljb25zdHJ1Y3RvcigpIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0dyb3VwID0gdHJ1ZTsKCiAgICAJCXRoaXMudHlwZSA9ICdHcm91cCc7CgogICAgCX0KCiAgICB9CgogICAgY29uc3QgX21vdmVFdmVudCA9IHsgdHlwZTogJ21vdmUnIH07CgogICAgLyoqCiAgICAgKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgWFIgY29udHJvbGxlciB3aXRoIGl0cwogICAgICogZGlmZmVyZW50IGNvb3JkaW5hdGUgc3lzdGVtcy4KICAgICAqCiAgICAgKiBAcHJpdmF0ZQogICAgICovCiAgICBjbGFzcyBXZWJYUkNvbnRyb2xsZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IFhSIGNvbnRyb2xsZXIuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQkvKioKICAgIAkJICogQSBncm91cCByZXByZXNlbnRpbmcgdGhlIHRhcmdldCByYXkgc3BhY2UKICAgIAkJICogb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJCSAqCiAgICAJCSAqIEBwcml2YXRlCiAgICAJCSAqIEB0eXBlIHs/R3JvdXB9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuX3RhcmdldFJheSA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGdyaXAgc3BhY2UKICAgIAkJICogb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJCSAqCiAgICAJCSAqIEBwcml2YXRlCiAgICAJCSAqIEB0eXBlIHs/R3JvdXB9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuX2dyaXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlCiAgICAJCSAqIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCQkgKgogICAgCQkgKiBAcHJpdmF0ZQogICAgCQkgKiBAdHlwZSB7P0dyb3VwfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLl9oYW5kID0gbnVsbDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCSAqCiAgICAJICogQHJldHVybiB7R3JvdXB9IEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCSAqLwogICAgCWdldEhhbmRTcGFjZSgpIHsKCiAgICAJCWlmICggdGhpcy5faGFuZCA9PT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLl9oYW5kID0gbmV3IEdyb3VwKCk7CiAgICAJCQl0aGlzLl9oYW5kLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgIAkJCXRoaXMuX2hhbmQudmlzaWJsZSA9IGZhbHNlOwoKICAgIAkJCXRoaXMuX2hhbmQuam9pbnRzID0ge307CiAgICAJCQl0aGlzLl9oYW5kLmlucHV0U3RhdGUgPSB7IHBpbmNoaW5nOiBmYWxzZSB9OwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXMuX2hhbmQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHJheSBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHJheSBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKi8KICAgIAlnZXRUYXJnZXRSYXlTcGFjZSgpIHsKCiAgICAJCWlmICggdGhpcy5fdGFyZ2V0UmF5ID09PSBudWxsICkgewoKICAgIAkJCXRoaXMuX3RhcmdldFJheSA9IG5ldyBHcm91cCgpOwogICAgCQkJdGhpcy5fdGFyZ2V0UmF5Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgIAkJCXRoaXMuX3RhcmdldFJheS52aXNpYmxlID0gZmFsc2U7CiAgICAJCQl0aGlzLl90YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKICAgIAkJCXRoaXMuX3RhcmdldFJheS5saW5lYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CiAgICAJCQl0aGlzLl90YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CiAgICAJCQl0aGlzLl90YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzLl90YXJnZXRSYXk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgZ3JpcCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgZ3JpcCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKi8KICAgIAlnZXRHcmlwU3BhY2UoKSB7CgogICAgCQlpZiAoIHRoaXMuX2dyaXAgPT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5fZ3JpcCA9IG5ldyBHcm91cCgpOwogICAgCQkJdGhpcy5fZ3JpcC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CiAgICAJCQl0aGlzLl9ncmlwLnZpc2libGUgPSBmYWxzZTsKICAgIAkJCXRoaXMuX2dyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKICAgIAkJCXRoaXMuX2dyaXAubGluZWFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwogICAgCQkJdGhpcy5fZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKICAgIAkJCXRoaXMuX2dyaXAuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzLl9ncmlwOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERpc3BhdGNoZXMgdGhlIGdpdmVuIGV2ZW50IHRvIHRoZSBncm91cHMgcmVwcmVzZW50aW5nCiAgICAJICogdGhlIGRpZmZlcmVudCBjb29yZGluYXRlIHNwYWNlcyBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAtIFRoZSBldmVudCB0byBkaXNwYXRjaC4KICAgIAkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJZGlzcGF0Y2hFdmVudCggZXZlbnQgKSB7CgogICAgCQlpZiAoIHRoaXMuX3RhcmdldFJheSAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLl90YXJnZXRSYXkuZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCiAgICAJCX0KCiAgICAJCWlmICggdGhpcy5fZ3JpcCAhPT0gbnVsbCApIHsKCiAgICAJCQl0aGlzLl9ncmlwLmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5faGFuZC5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29ubmVjdHMgdGhlIGNvbnRyb2xsZXIgd2l0aCB0aGUgZ2l2ZW4gWFIgaW5wdXQgc291cmNlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtYUklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIFRoZSBpbnB1dCBzb3VyY2UuCiAgICAJICogQHJldHVybiB7V2ViWFJDb250cm9sbGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCWNvbm5lY3QoIGlucHV0U291cmNlICkgewoKICAgIAkJaWYgKCBpbnB1dFNvdXJjZSAmJiBpbnB1dFNvdXJjZS5oYW5kICkgewoKICAgIAkJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKICAgIAkJCWlmICggaGFuZCApIHsKCiAgICAJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKICAgIAkJCQkJLy8gSW5pdGlhbGl6ZSBoYW5kIHdpdGggam9pbnRzIHdoZW4gY29ubmVjdGVkCiAgICAJCQkJCXRoaXMuX2dldEhhbmRKb2ludCggaGFuZCwgaW5wdXRqb2ludCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdjb25uZWN0ZWQnLCBkYXRhOiBpbnB1dFNvdXJjZSB9ICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEaXNjb25uZWN0cyB0aGUgY29udHJvbGxlciBmcm9tIHRoZSBnaXZlbiBYUiBpbnB1dCBzb3VyY2UuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gVGhlIGlucHV0IHNvdXJjZS4KICAgIAkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJZGlzY29ubmVjdCggaW5wdXRTb3VyY2UgKSB7CgogICAgCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc2Nvbm5lY3RlZCcsIGRhdGE6IGlucHV0U291cmNlIH0gKTsKCiAgICAJCWlmICggdGhpcy5fdGFyZ2V0UmF5ICE9PSBudWxsICkgewoKICAgIAkJCXRoaXMuX3RhcmdldFJheS52aXNpYmxlID0gZmFsc2U7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuX2dyaXAgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5fZ3JpcC52aXNpYmxlID0gZmFsc2U7CgogICAgCQl9CgogICAgCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5faGFuZC52aXNpYmxlID0gZmFsc2U7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBVcGRhdGVzIHRoZSBjb250cm9sbGVyIHdpdGggdGhlIGdpdmVuIGlucHV0IHNvdXJjZSwgWFIgZnJhbWUgYW5kIHJlZmVyZW5jZSBzcGFjZS4KICAgIAkgKiBUaGlzIHVwZGF0ZXMgdGhlIHRyYW5zZm9ybWF0aW9ucyBvZiB0aGUgZ3JvdXBzIHRoYXQgcmVwcmVzZW50IHRoZSBkaWZmZXJlbnQKICAgIAkgKiBjb29yZGluYXRlIHN5c3RlbXMgb2YgdGhlIGNvbnRyb2xsZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gVGhlIGlucHV0IHNvdXJjZS4KICAgIAkgKiBAcGFyYW0ge1hSRnJhbWV9IGZyYW1lIC0gVGhlIFhSIGZyYW1lLgogICAgCSAqIEBwYXJhbSB7WFJSZWZlcmVuY2VTcGFjZX0gcmVmZXJlbmNlU3BhY2UgLSBUaGUgcmVmZXJlbmNlIHNwYWNlLgogICAgCSAqIEByZXR1cm4ge1dlYlhSQ29udHJvbGxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAl1cGRhdGUoIGlucHV0U291cmNlLCBmcmFtZSwgcmVmZXJlbmNlU3BhY2UgKSB7CgogICAgCQlsZXQgaW5wdXRQb3NlID0gbnVsbDsKICAgIAkJbGV0IGdyaXBQb3NlID0gbnVsbDsKICAgIAkJbGV0IGhhbmRQb3NlID0gbnVsbDsKCiAgICAJCWNvbnN0IHRhcmdldFJheSA9IHRoaXMuX3RhcmdldFJheTsKICAgIAkJY29uc3QgZ3JpcCA9IHRoaXMuX2dyaXA7CiAgICAJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKICAgIAkJaWYgKCBpbnB1dFNvdXJjZSAmJiBmcmFtZS5zZXNzaW9uLnZpc2liaWxpdHlTdGF0ZSAhPT0gJ3Zpc2libGUtYmx1cnJlZCcgKSB7CgogICAgCQkJaWYgKCBoYW5kICYmIGlucHV0U291cmNlLmhhbmQgKSB7CgogICAgCQkJCWhhbmRQb3NlID0gdHJ1ZTsKCiAgICAJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKICAgIAkJCQkJLy8gVXBkYXRlIHRoZSBqb2ludHMgZ3JvdXBzIHdpdGggdGhlIFhSSm9pbnQgcG9zZXMKICAgIAkJCQkJY29uc3Qgam9pbnRQb3NlID0gZnJhbWUuZ2V0Sm9pbnRQb3NlKCBpbnB1dGpvaW50LCByZWZlcmVuY2VTcGFjZSApOwoKICAgIAkJCQkJLy8gVGhlIHRyYW5zZm9ybSBvZiB0aGlzIGpvaW50IHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRoZSBqb2ludCBwb3NlIG9uIGVhY2ggZnJhbWUKICAgIAkJCQkJY29uc3Qgam9pbnQgPSB0aGlzLl9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKTsKCiAgICAJCQkJCWlmICggam9pbnRQb3NlICE9PSBudWxsICkgewoKICAgIAkJCQkJCWpvaW50Lm1hdHJpeC5mcm9tQXJyYXkoIGpvaW50UG9zZS50cmFuc2Zvcm0ubWF0cml4ICk7CiAgICAJCQkJCQlqb2ludC5tYXRyaXguZGVjb21wb3NlKCBqb2ludC5wb3NpdGlvbiwgam9pbnQucm90YXRpb24sIGpvaW50LnNjYWxlICk7CiAgICAJCQkJCQlqb2ludC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIAkJCQkJCWpvaW50LmpvaW50UmFkaXVzID0gam9pbnRQb3NlLnJhZGl1czsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWpvaW50LnZpc2libGUgPSBqb2ludFBvc2UgIT09IG51bGw7CgogICAgCQkJCX0KCiAgICAJCQkJLy8gQ3VzdG9tIGV2ZW50cwoKICAgIAkJCQkvLyBDaGVjayBwaW5jaHoKICAgIAkJCQljb25zdCBpbmRleFRpcCA9IGhhbmQuam9pbnRzWyAnaW5kZXgtZmluZ2VyLXRpcCcgXTsKICAgIAkJCQljb25zdCB0aHVtYlRpcCA9IGhhbmQuam9pbnRzWyAndGh1bWItdGlwJyBdOwogICAgCQkJCWNvbnN0IGRpc3RhbmNlID0gaW5kZXhUaXAucG9zaXRpb24uZGlzdGFuY2VUbyggdGh1bWJUaXAucG9zaXRpb24gKTsKCiAgICAJCQkJY29uc3QgZGlzdGFuY2VUb1BpbmNoID0gMC4wMjsKICAgIAkJCQljb25zdCB0aHJlc2hvbGQgPSAwLjAwNTsKCiAgICAJCQkJaWYgKCBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgJiYgZGlzdGFuY2UgPiBkaXN0YW5jZVRvUGluY2ggKyB0aHJlc2hvbGQgKSB7CgogICAgCQkJCQloYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSBmYWxzZTsKICAgIAkJCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7CiAgICAJCQkJCQl0eXBlOiAncGluY2hlbmQnLAogICAgCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKICAgIAkJCQkJCXRhcmdldDogdGhpcwogICAgCQkJCQl9ICk7CgogICAgCQkJCX0gZWxzZSBpZiAoICEgaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlIDw9IGRpc3RhbmNlVG9QaW5jaCAtIHRocmVzaG9sZCApIHsKCiAgICAJCQkJCWhhbmQuaW5wdXRTdGF0ZS5waW5jaGluZyA9IHRydWU7CiAgICAJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggewogICAgCQkJCQkJdHlwZTogJ3BpbmNoc3RhcnQnLAogICAgCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKICAgIAkJCQkJCXRhcmdldDogdGhpcwogICAgCQkJCQl9ICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlpZiAoIGdyaXAgIT09IG51bGwgJiYgaW5wdXRTb3VyY2UuZ3JpcFNwYWNlICkgewoKICAgIAkJCQkJZ3JpcFBvc2UgPSBmcmFtZS5nZXRQb3NlKCBpbnB1dFNvdXJjZS5ncmlwU3BhY2UsIHJlZmVyZW5jZVNwYWNlICk7CgogICAgCQkJCQlpZiAoIGdyaXBQb3NlICE9PSBudWxsICkgewoKICAgIAkJCQkJCWdyaXAubWF0cml4LmZyb21BcnJheSggZ3JpcFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwogICAgCQkJCQkJZ3JpcC5tYXRyaXguZGVjb21wb3NlKCBncmlwLnBvc2l0aW9uLCBncmlwLnJvdGF0aW9uLCBncmlwLnNjYWxlICk7CiAgICAJCQkJCQlncmlwLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQkJCWlmICggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKSB7CgogICAgCQkJCQkJCWdyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwogICAgCQkJCQkJCWdyaXAubGluZWFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKTsKCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQlncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCWlmICggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICkgewoKICAgIAkJCQkJCQlncmlwLmhhc0FuZ3VsYXJWZWxvY2l0eSA9IHRydWU7CiAgICAJCQkJCQkJZ3JpcC5hbmd1bGFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICk7CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCB0YXJnZXRSYXkgIT09IG51bGwgKSB7CgogICAgCQkJCWlucHV0UG9zZSA9IGZyYW1lLmdldFBvc2UoIGlucHV0U291cmNlLnRhcmdldFJheVNwYWNlLCByZWZlcmVuY2VTcGFjZSApOwoKICAgIAkJCQkvLyBTb21lIHJ1bnRpbWVzIChuYW1lbHkgVml2ZSBDb3Ntb3Mgd2l0aCBWaXZlIE9wZW5YUiBSdW50aW1lKSBoYXZlIG9ubHkgZ3JpcCBzcGFjZSBhbmQgcmF5IHNwYWNlIGlzIGVxdWFsIHRvIGl0CiAgICAJCQkJaWYgKCBpbnB1dFBvc2UgPT09IG51bGwgJiYgZ3JpcFBvc2UgIT09IG51bGwgKSB7CgogICAgCQkJCQlpbnB1dFBvc2UgPSBncmlwUG9zZTsKCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIGlucHV0UG9zZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJCXRhcmdldFJheS5tYXRyaXguZnJvbUFycmF5KCBpbnB1dFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwogICAgCQkJCQl0YXJnZXRSYXkubWF0cml4LmRlY29tcG9zZSggdGFyZ2V0UmF5LnBvc2l0aW9uLCB0YXJnZXRSYXkucm90YXRpb24sIHRhcmdldFJheS5zY2FsZSApOwogICAgCQkJCQl0YXJnZXRSYXkubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQkJCQlpZiAoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApIHsKCiAgICAJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwogICAgCQkJCQkJdGFyZ2V0UmF5LmxpbmVhclZlbG9jaXR5LmNvcHkoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWlmICggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApIHsKCiAgICAJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gdHJ1ZTsKICAgIAkJCQkJCXRhcmdldFJheS5hbmd1bGFyVmVsb2NpdHkuY29weSggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgogICAgCQkJCQl9CgogICAgCQkJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIF9tb3ZlRXZlbnQgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCgogICAgCQl9CgogICAgCQlpZiAoIHRhcmdldFJheSAhPT0gbnVsbCApIHsKCiAgICAJCQl0YXJnZXRSYXkudmlzaWJsZSA9ICggaW5wdXRQb3NlICE9PSBudWxsICk7CgogICAgCQl9CgogICAgCQlpZiAoIGdyaXAgIT09IG51bGwgKSB7CgogICAgCQkJZ3JpcC52aXNpYmxlID0gKCBncmlwUG9zZSAhPT0gbnVsbCApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBoYW5kICE9PSBudWxsICkgewoKICAgIAkJCWhhbmQudmlzaWJsZSA9ICggaGFuZFBvc2UgIT09IG51bGwgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgam9pbnQgZm9yIHRoZSBnaXZlbiBpbnB1dCBqb2ludC4KICAgIAkgKgogICAgCSAqIEBwcml2YXRlCiAgICAJICogQHBhcmFtIHtHcm91cH0gaGFuZCAtIFRoZSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgc3BhY2UuCiAgICAJICogQHBhcmFtIHtYUkpvaW50U3BhY2V9IGlucHV0am9pbnQgLSBUaGUgaGFuZCBqb2ludCBkYXRhLgogICAgCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgaGFuZCBqb2ludCBmb3IgdGhlIGdpdmVuIGlucHV0IGpvaW50LgogICAgCSAqLwogICAgCV9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKSB7CgogICAgCQlpZiAoIGhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY29uc3Qgam9pbnQgPSBuZXcgR3JvdXAoKTsKICAgIAkJCWpvaW50Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKICAgIAkJCWpvaW50LnZpc2libGUgPSBmYWxzZTsKICAgIAkJCWhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID0gam9pbnQ7CgogICAgCQkJaGFuZC5hZGQoIGpvaW50ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gaGFuZC5qb2ludHNbIGlucHV0am9pbnQuam9pbnROYW1lIF07CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBTY2VuZXMgYWxsb3cgeW91IHRvIHNldCB1cCB3aGF0IGlzIHRvIGJlIHJlbmRlcmVkIGFuZCB3aGVyZSBieSB0aHJlZS5qcy4KICAgICAqIFRoaXMgaXMgd2hlcmUgeW91IHBsYWNlIDNEIG9iamVjdHMgbGlrZSBtZXNoZXMsIGxpbmVzIG9yIGxpZ2h0cy4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgT2JqZWN0M0QKICAgICAqLwogICAgY2xhc3MgU2NlbmUgZXh0ZW5kcyBPYmplY3QzRCB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgc2NlbmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNTY2VuZSA9IHRydWU7CgogICAgCQl0aGlzLnR5cGUgPSAnU2NlbmUnOwoKICAgIAkJLyoqCiAgICAJCSAqIERlZmluZXMgdGhlIGJhY2tncm91bmQgb2YgdGhlIHNjZW5lLiBWYWxpZCBpbnB1dHMgYXJlOgogICAgCQkgKgogICAgCQkgKiAtIEEgY29sb3IgZm9yIGRlZmluaW5nIGEgdW5pZm9ybSBjb2xvcmVkIGJhY2tncm91bmQuCiAgICAJCSAqIC0gQSB0ZXh0dXJlIGZvciBkZWZpbmluZyBhIChmbGF0KSB0ZXh0dXJlZCBiYWNrZ3JvdW5kLgogICAgCQkgKiAtIEN1YmUgdGV4dHVyZXMgb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzIGZvciBkZWZpbmluZyBhIHNreWJveC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oQ29sb3J8VGV4dHVyZSl9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuYmFja2dyb3VuZCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgZW52aXJvbm1lbnQgbWFwIGZvciBhbGwgcGh5c2ljYWwgbWF0ZXJpYWxzIGluIHRoZSBzY2VuZS4gSG93ZXZlciwKICAgIAkJICogaXQncyBub3QgcG9zc2libGUgdG8gb3ZlcndyaXRlIGFuIGV4aXN0aW5nIHRleHR1cmUgYXNzaWduZWQgdG8gdGhlIGBlbnZNYXBgCiAgICAJCSAqIG1hdGVyaWFsIHByb3BlcnR5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqIEBkZWZhdWx0IG51bGwKICAgIAkJICovCiAgICAJCXRoaXMuZW52aXJvbm1lbnQgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgZm9nIGluc3RhbmNlIGRlZmluaW5nIHRoZSB0eXBlIG9mIGZvZyB0aGF0IGFmZmVjdHMgZXZlcnl0aGluZwogICAgCQkgKiByZW5kZXJlZCBpbiB0aGUgc2NlbmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/KEZvZ3xGb2dFeHAyKX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5mb2cgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIGJsdXJyaW5lc3Mgb2YgdGhlIGJhY2tncm91bmQuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCiAgICAJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNiYWNrZ3JvdW5kfS4gVmFsaWQgaW5wdXQgaXMgYSBmbG9hdCBiZXR3ZWVuIGAwYAogICAgCQkgKiBhbmQgYDFgLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmJhY2tncm91bmRCbHVycmluZXNzID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBBdHRlbnVhdGVzIHRoZSBjb2xvciBvZiB0aGUgYmFja2dyb3VuZC4gT25seSBhcHBsaWVzIHRvIGJhY2tncm91bmQgdGV4dHVyZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMuYmFja2dyb3VuZEludGVuc2l0eSA9IDE7CgogICAgCQkvKioKICAgIAkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBiYWNrZ3JvdW5kIGluIHJhZGlhbnMuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCiAgICAJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNiYWNrZ3JvdW5kfS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0V1bGVyfQogICAgCQkgKiBAZGVmYXVsdCAoMCwwLDApCiAgICAJCSAqLwogICAgCQl0aGlzLmJhY2tncm91bmRSb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIEF0dGVudWF0ZXMgdGhlIGNvbG9yIG9mIHRoZSBlbnZpcm9ubWVudC4gT25seSBpbmZsdWVuY2VzIGVudmlyb25tZW50IG1hcHMKICAgIAkJICogYXNzaWduZWQgdG8ge0BsaW5rIFNjZW5lI2Vudmlyb25tZW50fS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy5lbnZpcm9ubWVudEludGVuc2l0eSA9IDE7CgogICAgCQkvKioKICAgIAkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBlbnZpcm9ubWVudCBtYXAgaW4gcmFkaWFucy4gT25seSBpbmZsdWVuY2VzIHBoeXNpY2FsIG1hdGVyaWFscwogICAgCQkgKiBpbiB0aGUgc2NlbmUgd2hlbiB7QGxpbmsgU2NlbmUjZW52aXJvbm1lbnR9IGlzIHVzZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtFdWxlcn0KICAgIAkJICogQGRlZmF1bHQgKDAsMCwwKQogICAgCQkgKi8KICAgIAkJdGhpcy5lbnZpcm9ubWVudFJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CgogICAgCQkvKioKICAgIAkJICogRm9yY2VzIGV2ZXJ5dGhpbmcgaW4gdGhlIHNjZW5lIHRvIGJlIHJlbmRlcmVkIHdpdGggdGhlIGRlZmluZWQgbWF0ZXJpYWwuIEl0IGlzIHBvc3NpYmxlCiAgICAJCSAqIHRvIGV4Y2x1ZGUgbWF0ZXJpYWxzIGZyb20gb3ZlcnJpZGUgYnkgc2V0dGluZyB7QGxpbmsgTWF0ZXJpYWwjYWxsb3dPdmVycmlkZX0gdG8gYGZhbHNlYC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9NYXRlcmlhbH0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5vdmVycmlkZU1hdGVyaWFsID0gbnVsbDsKCiAgICAJCWlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgogICAgCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgogICAgCQlpZiAoIHNvdXJjZS5iYWNrZ3JvdW5kICE9PSBudWxsICkgdGhpcy5iYWNrZ3JvdW5kID0gc291cmNlLmJhY2tncm91bmQuY2xvbmUoKTsKICAgIAkJaWYgKCBzb3VyY2UuZW52aXJvbm1lbnQgIT09IG51bGwgKSB0aGlzLmVudmlyb25tZW50ID0gc291cmNlLmVudmlyb25tZW50LmNsb25lKCk7CiAgICAJCWlmICggc291cmNlLmZvZyAhPT0gbnVsbCApIHRoaXMuZm9nID0gc291cmNlLmZvZy5jbG9uZSgpOwoKICAgIAkJdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHNvdXJjZS5iYWNrZ3JvdW5kQmx1cnJpbmVzczsKICAgIAkJdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gc291cmNlLmJhY2tncm91bmRJbnRlbnNpdHk7CiAgICAJCXRoaXMuYmFja2dyb3VuZFJvdGF0aW9uLmNvcHkoIHNvdXJjZS5iYWNrZ3JvdW5kUm90YXRpb24gKTsKCiAgICAJCXRoaXMuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSBzb3VyY2UuZW52aXJvbm1lbnRJbnRlbnNpdHk7CiAgICAJCXRoaXMuZW52aXJvbm1lbnRSb3RhdGlvbi5jb3B5KCBzb3VyY2UuZW52aXJvbm1lbnRSb3RhdGlvbiApOwoKICAgIAkJaWYgKCBzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMub3ZlcnJpZGVNYXRlcmlhbCA9IHNvdXJjZS5vdmVycmlkZU1hdGVyaWFsLmNsb25lKCk7CgogICAgCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCXRvSlNPTiggbWV0YSApIHsKCiAgICAJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCiAgICAJCWlmICggdGhpcy5mb2cgIT09IG51bGwgKSBkYXRhLm9iamVjdC5mb2cgPSB0aGlzLmZvZy50b0pTT04oKTsKCiAgICAJCWlmICggdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDAgKSBkYXRhLm9iamVjdC5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3M7CiAgICAJCWlmICggdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ICE9PSAxICkgZGF0YS5vYmplY3QuYmFja2dyb3VuZEludGVuc2l0eSA9IHRoaXMuYmFja2dyb3VuZEludGVuc2l0eTsKICAgIAkJZGF0YS5vYmplY3QuYmFja2dyb3VuZFJvdGF0aW9uID0gdGhpcy5iYWNrZ3JvdW5kUm90YXRpb24udG9BcnJheSgpOwoKICAgIAkJaWYgKCB0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5ICE9PSAxICkgZGF0YS5vYmplY3QuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSB0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5OwogICAgCQlkYXRhLm9iamVjdC5lbnZpcm9ubWVudFJvdGF0aW9uID0gdGhpcy5lbnZpcm9ubWVudFJvdGF0aW9uLnRvQXJyYXkoKTsKCiAgICAJCXJldHVybiBkYXRhOwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF92ZWN0b3IxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwogICAgY29uc3QgX3ZlY3RvcjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CiAgICBjb25zdCBfbm9ybWFsTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpOwoKICAgIC8qKgogICAgICogQSB0d28gZGltZW5zaW9uYWwgc3VyZmFjZSB0aGF0IGV4dGVuZHMgaW5maW5pdGVseSBpbiAzRCBzcGFjZSwgcmVwcmVzZW50ZWQKICAgICAqIGluIFtIZXNzaWFuIG5vcm1hbCBmb3JtXXtAbGluayBodHRwOi8vbWF0aHdvcmxkLndvbGZyYW0uY29tL0hlc3NpYW5Ob3JtYWxGb3JtLmh0bWx9CiAgICAgKiBieSBhIHVuaXQgbGVuZ3RoIG5vcm1hbCB2ZWN0b3IgYW5kIGEgY29uc3RhbnQuCiAgICAgKi8KICAgIGNsYXNzIFBsYW5lIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW25vcm1hbD0oMSwwLDApXSAtIEEgdW5pdCBsZW5ndGggdmVjdG9yIGRlZmluaW5nIHRoZSBub3JtYWwgb2YgdGhlIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbY29uc3RhbnQ9MF0gLSBUaGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIG9yaWdpbiB0byB0aGUgcGxhbmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCAxLCAwLCAwICksIGNvbnN0YW50ID0gMCApIHsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzUGxhbmUgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgdW5pdCBsZW5ndGggdmVjdG9yIGRlZmluaW5nIHRoZSBub3JtYWwgb2YgdGhlIHBsYW5lLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7VmVjdG9yM30KICAgIAkJICovCiAgICAJCXRoaXMubm9ybWFsID0gbm9ybWFsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBzaWduZWQgZGlzdGFuY2UgZnJvbSB0aGUgb3JpZ2luIHRvIHRoZSBwbGFuZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHBsYW5lIGNvbXBvbmVudHMgYnkgY29weWluZyB0aGUgZ2l2ZW4gdmFsdWVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBub3JtYWwgLSBUaGUgbm9ybWFsLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBjb25zdGFudCAtIFRoZSBjb25zdGFudC4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAlzZXQoIG5vcm1hbCwgY29uc3RhbnQgKSB7CgogICAgCQl0aGlzLm5vcm1hbC5jb3B5KCBub3JtYWwgKTsKICAgIAkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgcGxhbmUgY29tcG9uZW50cyBieSBkZWZpbmluZyBgeGAsIGB5YCwgYHpgIGFzIHRoZQogICAgCSAqIHBsYW5lIG5vcm1hbCBhbmQgYHdgIGFzIHRoZSBjb25zdGFudC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIGZvciB0aGUgbm9ybWFsJ3MgeCBjb21wb25lbnQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSBub3JtYWwncyB5IGNvbXBvbmVudC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBmb3IgdGhlIG5vcm1hbCdzIHogY29tcG9uZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIGNvbnN0YW50IHZhbHVlLgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCXNldENvbXBvbmVudHMoIHgsIHksIHosIHcgKSB7CgogICAgCQl0aGlzLm5vcm1hbC5zZXQoIHgsIHksIHogKTsKICAgIAkJdGhpcy5jb25zdGFudCA9IHc7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTZXRzIHRoZSBwbGFuZSBmcm9tIHRoZSBnaXZlbiBub3JtYWwgYW5kIGNvcGxhbmFyIHBvaW50ICh0aGF0IGlzIGEgcG9pbnQKICAgIAkgKiB0aGF0IGxpZXMgb250byB0aGUgcGxhbmUpLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBub3JtYWwgLSBUaGUgbm9ybWFsLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIGNvcGxhbmFyIHBvaW50LgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCXNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KCBub3JtYWwsIHBvaW50ICkgewoKICAgIAkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CiAgICAJCXRoaXMuY29uc3RhbnQgPSAtIHBvaW50LmRvdCggdGhpcy5ub3JtYWwgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIHBsYW5lIGZyb20gdGhyZWUgY29wbGFuYXIgcG9pbnRzLiBUaGUgd2luZGluZyBvcmRlciBpcwogICAgCSAqIGFzc3VtZWQgdG8gYmUgY291bnRlci1jbG9ja3dpc2UsIGFuZCBkZXRlcm1pbmVzIHRoZSBkaXJlY3Rpb24gb2YKICAgIAkgKiB0aGUgcGxhbmUgbm9ybWFsLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcGxhbmFyIHBvaW50LgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29wbGFuYXIgcG9pbnQuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcGxhbmFyIHBvaW50LgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCXNldEZyb21Db3BsYW5hclBvaW50cyggYSwgYiwgYyApIHsKCiAgICAJCWNvbnN0IG5vcm1hbCA9IF92ZWN0b3IxLnN1YlZlY3RvcnMoIGMsIGIgKS5jcm9zcyggX3ZlY3RvcjIuc3ViVmVjdG9ycyggYSwgYiApICkubm9ybWFsaXplKCk7CgogICAgCQkvLyBROiBzaG91bGQgYW4gZXJyb3IgYmUgdGhyb3duIGlmIG5vcm1hbCBpcyB6ZXJvIChlLmcuIGRlZ2VuZXJhdGUgcGxhbmUpPwoKICAgIAkJdGhpcy5zZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBhICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcGxhbmUgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCiAgICAJICovCiAgICAJY29weSggcGxhbmUgKSB7CgogICAgCQl0aGlzLm5vcm1hbC5jb3B5KCBwbGFuZS5ub3JtYWwgKTsKICAgIAkJdGhpcy5jb25zdGFudCA9IHBsYW5lLmNvbnN0YW50OwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogTm9ybWFsaXplcyB0aGUgcGxhbmUgbm9ybWFsIGFuZCBhZGp1c3RzIHRoZSBjb25zdGFudCBhY2NvcmRpbmdseS4KICAgIAkgKgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCW5vcm1hbGl6ZSgpIHsKCiAgICAJCS8vIE5vdGU6IHdpbGwgbGVhZCB0byBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBwbGFuZSBpcyBpbnZhbGlkLgoKICAgIAkJY29uc3QgaW52ZXJzZU5vcm1hbExlbmd0aCA9IDEuMCAvIHRoaXMubm9ybWFsLmxlbmd0aCgpOwogICAgCQl0aGlzLm5vcm1hbC5tdWx0aXBseVNjYWxhciggaW52ZXJzZU5vcm1hbExlbmd0aCApOwogICAgCQl0aGlzLmNvbnN0YW50ICo9IGludmVyc2VOb3JtYWxMZW5ndGg7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBOZWdhdGVzIGJvdGggdGhlIHBsYW5lIG5vcm1hbCBhbmQgdGhlIGNvbnN0YW50LgogICAgCSAqCiAgICAJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCiAgICAJICovCiAgICAJbmVnYXRlKCkgewoKICAgIAkJdGhpcy5jb25zdGFudCAqPSAtMTsKICAgIAkJdGhpcy5ub3JtYWwubmVnYXRlKCk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIHRoZSBzaWduZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gcG9pbnQgdG8gdGhpcyBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgZm9yLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNpZ25lZCBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKICAgIAkJcmV0dXJuIHRoaXMubm9ybWFsLmRvdCggcG9pbnQgKSArIHRoaXMuY29uc3RhbnQ7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyB0aGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHNwaGVyZSB0byB0aGlzIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgZm9yLgogICAgCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNpZ25lZCBkaXN0YW5jZS4KICAgIAkgKi8KICAgIAlkaXN0YW5jZVRvU3BoZXJlKCBzcGhlcmUgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQoIHNwaGVyZS5jZW50ZXIgKSAtIHNwaGVyZS5yYWRpdXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJvamVjdHMgYSB0aGUgZ2l2ZW4gcG9pbnQgb250byB0aGUgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIHByb2plY3QuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgcHJvamVjdGVkIHBvaW50IG9uIHRoZSBwbGFuZS4KICAgIAkgKi8KICAgIAlwcm9qZWN0UG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgogICAgCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLm5vcm1hbCwgLSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgdGhlIGludGVyc2VjdGlvbiBwb2ludCBvZiB0aGUgcGFzc2VkIGxpbmUgYW5kIHRoZSBwbGFuZS4gUmV0dXJucwogICAgCSAqIGBudWxsYCBpZiB0aGUgbGluZSBkb2VzIG5vdCBpbnRlcnNlY3QuIFJldHVybnMgdGhlIGxpbmUncyBzdGFydGluZyBwb2ludCBpZgogICAgCSAqIHRoZSBsaW5lIGlzIGNvcGxhbmFyIHdpdGggdGhlIHBsYW5lLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtMaW5lM30gbGluZSAtIFRoZSBsaW5lIHRvIGNvbXB1dGUgdGhlIGludGVyc2VjdGlvbiBmb3IuCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KICAgIAkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVyc2VjdGlvbiBwb2ludC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RMaW5lKCBsaW5lLCB0YXJnZXQgKSB7CgogICAgCQljb25zdCBkaXJlY3Rpb24gPSBsaW5lLmRlbHRhKCBfdmVjdG9yMSApOwoKICAgIAkJY29uc3QgZGVub21pbmF0b3IgPSB0aGlzLm5vcm1hbC5kb3QoIGRpcmVjdGlvbiApOwoKICAgIAkJaWYgKCBkZW5vbWluYXRvciA9PT0gMCApIHsKCiAgICAJCQkvLyBsaW5lIGlzIGNvcGxhbmFyLCByZXR1cm4gb3JpZ2luCiAgICAJCQlpZiAoIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICkgPT09IDAgKSB7CgogICAgCQkJCXJldHVybiB0YXJnZXQuY29weSggbGluZS5zdGFydCApOwoKICAgIAkJCX0KCiAgICAJCQkvLyBVbnN1cmUgaWYgdGhpcyBpcyB0aGUgY29ycmVjdCBtZXRob2QgdG8gaGFuZGxlIHRoaXMgY2FzZS4KICAgIAkJCXJldHVybiBudWxsOwoKICAgIAkJfQoKICAgIAkJY29uc3QgdCA9IC0gKCBsaW5lLnN0YXJ0LmRvdCggdGhpcy5ub3JtYWwgKSArIHRoaXMuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKICAgIAkJaWYgKCB0IDwgMCB8fCB0ID4gMSApIHsKCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX0KCiAgICAJCXJldHVybiB0YXJnZXQuY29weSggbGluZS5zdGFydCApLmFkZFNjYWxlZFZlY3RvciggZGlyZWN0aW9uLCB0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGxpbmUgc2VnbWVudCBpbnRlcnNlY3RzIHdpdGggKHBhc3NlcyB0aHJvdWdoKSB0aGUgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0xpbmUzfSBsaW5lIC0gVGhlIGxpbmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQgaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0xpbmUoIGxpbmUgKSB7CgogICAgCQkvLyBOb3RlOiB0aGlzIHRlc3RzIGlmIGEgbGluZSBpbnRlcnNlY3RzIHRoZSBwbGFuZSwgbm90IHdoZXRoZXIgaXQgKG9yIGl0cyBlbmQtcG9pbnRzKSBhcmUgY29wbGFuYXIgd2l0aCBpdC4KCiAgICAJCWNvbnN0IHN0YXJ0U2lnbiA9IHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICk7CiAgICAJCWNvbnN0IGVuZFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5lbmQgKTsKCiAgICAJCXJldHVybiAoIHN0YXJ0U2lnbiA8IDAgJiYgZW5kU2lnbiA+IDAgKSB8fCAoIGVuZFNpZ24gPCAwICYmIHN0YXJ0U2lnbiA+IDAgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0JveCggYm94ICkgewoKICAgIAkJcmV0dXJuIGJveC5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIGJvdW5kaW5nIHNwaGVyZSB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYW5lIG9yIG5vdC4KICAgIAkgKi8KICAgIAlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgogICAgCQlyZXR1cm4gc3BoZXJlLmludGVyc2VjdHNQbGFuZSggdGhpcyApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBjb3BsYW5hciB2ZWN0b3IgdG8gdGhlIHBsYW5lLCBieSBjYWxjdWxhdGluZyB0aGUKICAgIAkgKiBwcm9qZWN0aW9uIG9mIHRoZSBub3JtYWwgYXQgdGhlIG9yaWdpbiBvbnRvIHRoZSBwbGFuZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCiAgICAJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNvcGxhbmFyIHBvaW50LgogICAgCSAqLwogICAgCWNvcGxhbmFyUG9pbnQoIHRhcmdldCApIHsKCiAgICAJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5ub3JtYWwgKS5tdWx0aXBseVNjYWxhciggLSB0aGlzLmNvbnN0YW50ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQXBwbHkgYSA0eDQgbWF0cml4IHRvIHRoZSBwbGFuZS4gVGhlIG1hdHJpeCBtdXN0IGJlIGFuIGFmZmluZSwgaG9tb2dlbmVvdXMgdHJhbnNmb3JtLgogICAgCSAqCiAgICAJICogVGhlIG9wdGlvbmFsIG5vcm1hbCBtYXRyaXggY2FuIGJlIHByZS1jb21wdXRlZCBsaWtlIHNvOgogICAgCSAqIGBgYGpzCiAgICAJICogY29uc3Qgb3B0aW9uYWxOb3JtYWxNYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CiAgICAJICogYGBgCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCiAgICAJICogQHBhcmFtIHtNYXRyaXg0fSBbb3B0aW9uYWxOb3JtYWxNYXRyaXhdIC0gQSBwcmUtY29tcHV0ZWQgbm9ybWFsIG1hdHJpeC4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KICAgIAkgKi8KICAgIAlhcHBseU1hdHJpeDQoIG1hdHJpeCwgb3B0aW9uYWxOb3JtYWxNYXRyaXggKSB7CgogICAgCQljb25zdCBub3JtYWxNYXRyaXggPSBvcHRpb25hbE5vcm1hbE1hdHJpeCB8fCBfbm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgogICAgCQljb25zdCByZWZlcmVuY2VQb2ludCA9IHRoaXMuY29wbGFuYXJQb2ludCggX3ZlY3RvcjEgKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKICAgIAkJY29uc3Qgbm9ybWFsID0gdGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTsKCiAgICAJCXRoaXMuY29uc3RhbnQgPSAtIHJlZmVyZW5jZVBvaW50LmRvdCggbm9ybWFsICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUcmFuc2xhdGVzIHRoZSBwbGFuZSBieSB0aGUgZGlzdGFuY2UgZGVmaW5lZCBieSB0aGUgZ2l2ZW4gb2Zmc2V0IHZlY3Rvci4KICAgIAkgKiBOb3RlIHRoYXQgdGhpcyBvbmx5IGFmZmVjdHMgdGhlIHBsYW5lIGNvbnN0YW50IGFuZCB3aWxsIG5vdCBhZmZlY3QgdGhlIG5vcm1hbCB2ZWN0b3IuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQgdmVjdG9yLgogICAgCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgogICAgCSAqLwogICAgCXRyYW5zbGF0ZSggb2Zmc2V0ICkgewoKICAgIAkJdGhpcy5jb25zdGFudCAtPSBvZmZzZXQuZG90KCB0aGlzLm5vcm1hbCApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBwbGFuZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcGxhbmUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgogICAgCSAqLwogICAgCWVxdWFscyggcGxhbmUgKSB7CgogICAgCQlyZXR1cm4gcGxhbmUubm9ybWFsLmVxdWFscyggdGhpcy5ub3JtYWwgKSAmJiAoIHBsYW5lLmNvbnN0YW50ID09PSB0aGlzLmNvbnN0YW50ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyBwbGFuZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgogICAgCSAqCiAgICAJICogQHJldHVybiB7UGxhbmV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAljbG9uZSgpIHsKCiAgICAJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCBfc3BoZXJlJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKICAgIGNvbnN0IF9kZWZhdWx0U3ByaXRlQ2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMC41LCAwLjUgKTsKICAgIGNvbnN0IF92ZWN0b3IkNiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCiAgICAvKioKICAgICAqIEZydXN0dW1zIGFyZSB1c2VkIHRvIGRldGVybWluZSB3aGF0IGlzIGluc2lkZSB0aGUgY2FtZXJhJ3MgZmllbGQgb2Ygdmlldy4KICAgICAqIFRoZXkgaGVscCBzcGVlZCB1cCB0aGUgcmVuZGVyaW5nIHByb2Nlc3MgLSBvYmplY3RzIHdoaWNoIGxpZSBvdXRzaWRlIGEgY2FtZXJhJ3MKICAgICAqIGZydXN0dW0gY2FuIHNhZmVseSBiZSBleGNsdWRlZCBmcm9tIHJlbmRlcmluZy4KICAgICAqCiAgICAgKiBUaGlzIGNsYXNzIGlzIG1haW5seSBpbnRlbmRlZCBmb3IgdXNlIGludGVybmFsbHkgYnkgYSByZW5kZXJlci4KICAgICAqLwogICAgY2xhc3MgRnJ1c3R1bSB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgZnJ1c3R1bS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwMF0gLSBUaGUgZmlyc3QgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDFdIC0gVGhlIHNlY29uZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwMl0gLSBUaGUgdGhpcmQgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDNdIC0gVGhlIGZvdXJ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwNF0gLSBUaGUgZmlmdGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge1BsYW5lfSBbcDVdIC0gVGhlIHNpeHRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHAwID0gbmV3IFBsYW5lKCksIHAxID0gbmV3IFBsYW5lKCksIHAyID0gbmV3IFBsYW5lKCksIHAzID0gbmV3IFBsYW5lKCksIHA0ID0gbmV3IFBsYW5lKCksIHA1ID0gbmV3IFBsYW5lKCkgKSB7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBhcnJheSBob2xkcyB0aGUgcGxhbmVzIHRoYXQgZW5jbG9zZSB0aGUgZnJ1c3R1bS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PFBsYW5lPn0KICAgIAkJICovCiAgICAJCXRoaXMucGxhbmVzID0gWyBwMCwgcDEsIHAyLCBwMywgcDQsIHA1IF07CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZnJ1c3R1bSBwbGFuZXMgYnkgY29weWluZyB0aGUgZ2l2ZW4gcGxhbmVzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtQbGFuZX0gW3AwXSAtIFRoZSBmaXJzdCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwMV0gLSBUaGUgc2Vjb25kIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtQbGFuZX0gW3AyXSAtIFRoZSB0aGlyZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwM10gLSBUaGUgZm91cnRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtQbGFuZX0gW3A0XSAtIFRoZSBmaWZ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgogICAgCSAqIEBwYXJhbSB7UGxhbmV9IFtwNV0gLSBUaGUgc2l4dGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KICAgIAkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIHJlZmVyZW5jZSB0byB0aGlzIGZydXN0dW0uCiAgICAJICovCiAgICAJc2V0KCBwMCwgcDEsIHAyLCBwMywgcDQsIHA1ICkgewoKICAgIAkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgogICAgCQlwbGFuZXNbIDAgXS5jb3B5KCBwMCApOwogICAgCQlwbGFuZXNbIDEgXS5jb3B5KCBwMSApOwogICAgCQlwbGFuZXNbIDIgXS5jb3B5KCBwMiApOwogICAgCQlwbGFuZXNbIDMgXS5jb3B5KCBwMyApOwogICAgCQlwbGFuZXNbIDQgXS5jb3B5KCBwNCApOwogICAgCQlwbGFuZXNbIDUgXS5jb3B5KCBwNSApOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGZydXN0dW0gdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7RnJ1c3R1bX0gZnJ1c3R1bSAtIFRoZSBmcnVzdHVtIHRvIGNvcHkuCiAgICAJICogQHJldHVybiB7RnJ1c3R1bX0gQSByZWZlcmVuY2UgdG8gdGhpcyBmcnVzdHVtLgogICAgCSAqLwogICAgCWNvcHkoIGZydXN0dW0gKSB7CgogICAgCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJcGxhbmVzWyBpIF0uY29weSggZnJ1c3R1bS5wbGFuZXNbIGkgXSApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgZnJ1c3R1bSBwbGFuZXMgZnJvbSB0aGUgZ2l2ZW4gcHJvamVjdGlvbiBtYXRyaXguCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgcHJvamVjdGlvbiBtYXRyaXguCiAgICAJICogQHBhcmFtIHsoV2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0pfSBjb29yZGluYXRlU3lzdGVtIC0gVGhlIGNvb3JkaW5hdGUgc3lzdGVtLgogICAgCSAqIEByZXR1cm4ge0ZydXN0dW19IEEgcmVmZXJlbmNlIHRvIHRoaXMgZnJ1c3R1bS4KICAgIAkgKi8KICAgIAlzZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggbSwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCiAgICAJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwogICAgCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CiAgICAJCWNvbnN0IG1lMCA9IG1lWyAwIF0sIG1lMSA9IG1lWyAxIF0sIG1lMiA9IG1lWyAyIF0sIG1lMyA9IG1lWyAzIF07CiAgICAJCWNvbnN0IG1lNCA9IG1lWyA0IF0sIG1lNSA9IG1lWyA1IF0sIG1lNiA9IG1lWyA2IF0sIG1lNyA9IG1lWyA3IF07CiAgICAJCWNvbnN0IG1lOCA9IG1lWyA4IF0sIG1lOSA9IG1lWyA5IF0sIG1lMTAgPSBtZVsgMTAgXSwgbWUxMSA9IG1lWyAxMSBdOwogICAgCQljb25zdCBtZTEyID0gbWVbIDEyIF0sIG1lMTMgPSBtZVsgMTMgXSwgbWUxNCA9IG1lWyAxNCBdLCBtZTE1ID0gbWVbIDE1IF07CgogICAgCQlwbGFuZXNbIDAgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTAsIG1lNyAtIG1lNCwgbWUxMSAtIG1lOCwgbWUxNSAtIG1lMTIgKS5ub3JtYWxpemUoKTsKICAgIAkJcGxhbmVzWyAxIF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUwLCBtZTcgKyBtZTQsIG1lMTEgKyBtZTgsIG1lMTUgKyBtZTEyICkubm9ybWFsaXplKCk7CiAgICAJCXBsYW5lc1sgMiBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMSwgbWU3ICsgbWU1LCBtZTExICsgbWU5LCBtZTE1ICsgbWUxMyApLm5vcm1hbGl6ZSgpOwogICAgCQlwbGFuZXNbIDMgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTEsIG1lNyAtIG1lNSwgbWUxMSAtIG1lOSwgbWUxNSAtIG1lMTMgKS5ub3JtYWxpemUoKTsKICAgIAkJcGxhbmVzWyA0IF0uc2V0Q29tcG9uZW50cyggbWUzIC0gbWUyLCBtZTcgLSBtZTYsIG1lMTEgLSBtZTEwLCBtZTE1IC0gbWUxNCApLm5vcm1hbGl6ZSgpOwoKICAgIAkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgogICAgCQkJcGxhbmVzWyA1IF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUyLCBtZTcgKyBtZTYsIG1lMTEgKyBtZTEwLCBtZTE1ICsgbWUxNCApLm5vcm1hbGl6ZSgpOwoKICAgIAkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCiAgICAJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTIsIG1lNiwgbWUxMCwgbWUxNCApLm5vcm1hbGl6ZSgpOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5GcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgM0Qgb2JqZWN0J3MgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0uCiAgICAJICoKICAgIAkgKiBOb3RlIHRoYXQgdGhlIDNEIG9iamVjdCBtdXN0IGhhdmUgYSBnZW9tZXRyeSBzbyB0aGF0IHRoZSBib3VuZGluZyBzcGhlcmUgY2FuIGJlIGNhbGN1bGF0ZWQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIHRlc3QuCiAgICAJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgM0Qgb2JqZWN0J3MgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0gb3Igbm90LgogICAgCSAqLwogICAgCWludGVyc2VjdHNPYmplY3QoIG9iamVjdCApIHsKCiAgICAJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJaWYgKCBvYmplY3QuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBvYmplY3QuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgogICAgCQkJX3NwaGVyZSQzLmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSApLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoKICAgIAkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCiAgICAJCQlfc3BoZXJlJDMuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHNwcml0ZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcHJpdGV9IHNwcml0ZSAtIFRoZSBzcHJpdGUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBzcHJpdGUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c1Nwcml0ZSggc3ByaXRlICkgewoKICAgIAkJX3NwaGVyZSQzLmNlbnRlci5zZXQoIDAsIDAsIDAgKTsKCiAgICAJCWNvbnN0IG9mZnNldCA9IF9kZWZhdWx0U3ByaXRlQ2VudGVyLmRpc3RhbmNlVG8oIHNwcml0ZS5jZW50ZXIgKTsKCiAgICAJCV9zcGhlcmUkMy5yYWRpdXMgPSAwLjcwNzEwNjc4MTE4NjU0NzYgKyBvZmZzZXQ7CiAgICAJCV9zcGhlcmUkMy5hcHBseU1hdHJpeDQoIHNwcml0ZS5tYXRyaXhXb3JsZCApOwoKICAgIAkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBib3VuZGluZyBzcGhlcmUgdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBzcGhlcmUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKICAgIAkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CiAgICAJCWNvbnN0IGNlbnRlciA9IHNwaGVyZS5jZW50ZXI7CiAgICAJCWNvbnN0IG5lZ1JhZGl1cyA9IC0gc3BoZXJlLnJhZGl1czsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJY29uc3QgZGlzdGFuY2UgPSBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIGNlbnRlciApOwoKICAgIAkJCWlmICggZGlzdGFuY2UgPCBuZWdSYWRpdXMgKSB7CgogICAgCQkJCXJldHVybiBmYWxzZTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gdHJ1ZTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0uCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KICAgIAkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBib3ggaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCiAgICAJICovCiAgICAJaW50ZXJzZWN0c0JveCggYm94ICkgewoKICAgIAkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCWNvbnN0IHBsYW5lID0gcGxhbmVzWyBpIF07CgogICAgCQkJLy8gY29ybmVyIGF0IG1heCBkaXN0YW5jZQoKICAgIAkJCV92ZWN0b3IkNi54ID0gcGxhbmUubm9ybWFsLnggPiAwID8gYm94Lm1heC54IDogYm94Lm1pbi54OwogICAgCQkJX3ZlY3RvciQ2LnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CiAgICAJCQlfdmVjdG9yJDYueiA9IHBsYW5lLm5vcm1hbC56ID4gMCA/IGJveC5tYXgueiA6IGJveC5taW4uejsKCiAgICAJCQlpZiAoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggX3ZlY3RvciQ2ICkgPCAwICkgewoKICAgIAkJCQlyZXR1cm4gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRydWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50IGxpZXMgd2l0aGluIHRoZSBmcnVzdHVtLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byB0ZXN0LgogICAgCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHBvaW50IGxpZXMgd2l0aGluIHRoaXMgZnJ1c3R1bSBvciBub3QuCiAgICAJICovCiAgICAJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgogICAgCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJaWYgKCBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgPCAwICkgewoKICAgIAkJCQlyZXR1cm4gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRydWU7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmV0dXJucyBhIG5ldyBmcnVzdHVtIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCiAgICAJICoKICAgIAkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIHRleHR1cmUgZm9yIHVzZSB3aXRoIGEgdmlkZW8uCiAgICAgKgogICAgICogYGBganMKICAgICAqIC8vIGFzc3VtaW5nIHlvdSBoYXZlIGNyZWF0ZWQgYSBIVE1MIHZpZGVvIGVsZW1lbnQgd2l0aCBpZD0idmlkZW8iCiAgICAgKiBjb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAndmlkZW8nICk7CiAgICAgKiBjb25zdCB0ZXh0dXJlID0gbmV3IFRIUkVFLlZpZGVvVGV4dHVyZSggdmlkZW8gKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIHRleHR1cmUsIGl0cyBkaW1lbnNpb25zLCBmb3JtYXQsIGFuZCB0eXBlCiAgICAgKiBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwgY2FsbCB7QGxpbmsgVGV4dHVyZSNkaXNwb3NlfSBvbiB0aGUgdGV4dHVyZSBhbmQgaW5zdGFudGlhdGUgYSBuZXcgb25lLgogICAgICoKICAgICAqIEBhdWdtZW50cyBUZXh0dXJlCiAgICAgKi8KICAgIGNsYXNzIFZpZGVvVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHZpZGVvIHRleHR1cmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0hUTUxWaWRlb0VsZW1lbnR9IHZpZGVvIC0gVGhlIHZpZGVvIGVsZW1lbnQgdG8gdXNlIGFzIGEgZGF0YSBzb3VyY2UgZm9yIHRoZSB0ZXh0dXJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCB2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIgPSBMaW5lYXJGaWx0ZXIsIG1pbkZpbHRlciA9IExpbmVhckZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICkgewoKICAgIAkJc3VwZXIoIHZpZGVvLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzVmlkZW9UZXh0dXJlID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIG1pcG1hcHMgKGlmIHBvc3NpYmxlKSBmb3IgYSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKICAgIAkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKICAgIAkJZnVuY3Rpb24gdXBkYXRlVmlkZW8oKSB7CgogICAgCQkJc2NvcGUubmVlZHNVcGRhdGUgPSB0cnVlOwogICAgCQkJdmlkZW8ucmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjayggdXBkYXRlVmlkZW8gKTsKCiAgICAJCX0KCiAgICAJCWlmICggJ3JlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2snIGluIHZpZGVvICkgewoKICAgIAkJCXZpZGVvLnJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2soIHVwZGF0ZVZpZGVvICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJY2xvbmUoKSB7CgogICAgCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuaW1hZ2UgKS5jb3B5KCB0aGlzICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIGF1dG9tYXRpY2FsbHkgYnkgdGhlIHJlbmRlcmVyIGFuZCBzZXRzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfQogICAgCSAqIHRvIGB0cnVlYCBldmVyeSB0aW1lIGEgbmV3IGZyYW1lIGlzIGF2YWlsYWJsZS4KICAgIAkgKgogICAgCSAqIE9ubHkgcmVsZXZhbnQgaWYgYHJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2tgIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhlIGJyb3dzZXIuCiAgICAJICovCiAgICAJdXBkYXRlKCkgewoKICAgIAkJY29uc3QgdmlkZW8gPSB0aGlzLmltYWdlOwogICAgCQljb25zdCBoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPSAncmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjaycgaW4gdmlkZW87CgogICAgCQlpZiAoIGhhc1ZpZGVvRnJhbWVDYWxsYmFjayA9PT0gZmFsc2UgJiYgdmlkZW8ucmVhZHlTdGF0ZSA+PSB2aWRlby5IQVZFX0NVUlJFTlRfREFUQSApIHsKCiAgICAJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENyZWF0ZXMgYSB0ZXh0dXJlIGZyb20gYSBjYW52YXMgZWxlbWVudC4KICAgICAqCiAgICAgKiBUaGlzIGlzIGFsbW9zdCB0aGUgc2FtZSBhcyB0aGUgYmFzZSB0ZXh0dXJlIGNsYXNzLCBleGNlcHQgdGhhdCBpdCBzZXRzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfQogICAgICogdG8gYHRydWVgIGltbWVkaWF0ZWx5IHNpbmNlIGEgY2FudmFzIGNhbiBkaXJlY3RseSBiZSB1c2VkIGZvciByZW5kZXJpbmcuCiAgICAgKgogICAgICogQGF1Z21lbnRzIFRleHR1cmUKICAgICAqLwogICAgY2xhc3MgQ2FudmFzVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRleHR1cmUuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50fSBbY2FudmFzXSAtIFRoZSBIVE1MIGNhbnZhcyBlbGVtZW50LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBjYW52YXMsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApIHsKCiAgICAJCXN1cGVyKCBjYW52YXMsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuaXNDYW52YXNUZXh0dXJlID0gdHJ1ZTsKCiAgICAJCXRoaXMubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBjbGFzcyBjYW4gYmUgdXNlZCB0byBhdXRvbWF0aWNhbGx5IHNhdmUgdGhlIGRlcHRoIGluZm9ybWF0aW9uIG9mIGEKICAgICAqIHJlbmRlcmluZyBpbnRvIGEgdGV4dHVyZS4KICAgICAqCiAgICAgKiBAYXVnbWVudHMgVGV4dHVyZQogICAgICovCiAgICBjbGFzcyBEZXB0aFRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBkZXB0aCB0ZXh0dXJlLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSB0ZXh0dXJlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEludFR5cGVdIC0gVGhlIHRleHR1cmUgdHlwZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW21hcHBpbmc9VGV4dHVyZS5ERUZBVUxUX01BUFBJTkddIC0gVGhlIHRleHR1cmUgbWFwcGluZy4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBTIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFQgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFttYWdGaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtYWcgZmlsdGVyIHZhbHVlLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWluRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWluIGZpbHRlciB2YWx1ZS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2FuaXNvdHJvcHk9VGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFldIC0gVGhlIGFuaXNvdHJvcHkgdmFsdWUuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtmb3JtYXQ9RGVwdGhGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGggb2YgdGhlIHRleHR1cmUuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHdpZHRoLCBoZWlnaHQsIHR5cGUgPSBVbnNpZ25lZEludFR5cGUsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyID0gTmVhcmVzdEZpbHRlciwgbWluRmlsdGVyID0gTmVhcmVzdEZpbHRlciwgYW5pc290cm9weSwgZm9ybWF0ID0gRGVwdGhGb3JtYXQsIGRlcHRoID0gMSApIHsKCiAgICAJCWlmICggZm9ybWF0ICE9PSBEZXB0aEZvcm1hdCAmJiBmb3JtYXQgIT09IERlcHRoU3RlbmNpbEZvcm1hdCApIHsKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdEZXB0aFRleHR1cmUgZm9ybWF0IG11c3QgYmUgZWl0aGVyIFRIUkVFLkRlcHRoRm9ybWF0IG9yIFRIUkVFLkRlcHRoU3RlbmNpbEZvcm1hdCcgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGltYWdlID0geyB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0LCBkZXB0aDogZGVwdGggfTsKCiAgICAJCXN1cGVyKCBpbWFnZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc0RlcHRoVGV4dHVyZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCiAgICAJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCiAgICAJCSAqCiAgICAJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIG1pcG1hcHMgKGlmIHBvc3NpYmxlKSBmb3IgYSB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIENvZGUgY29ycmVzcG9uZGluZyB0byB0aGUgZGVwdGggY29tcGFyZSBmdW5jdGlvbi4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez8oTmV2ZXJDb21wYXJlfExlc3NDb21wYXJlfEVxdWFsQ29tcGFyZXxMZXNzRXF1YWxDb21wYXJlfEdyZWF0ZXJDb21wYXJlfE5vdEVxdWFsQ29tcGFyZXxHcmVhdGVyRXF1YWxDb21wYXJlfEFsd2F5c0NvbXBhcmUpfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmNvbXBhcmVGdW5jdGlvbiA9IG51bGw7CgogICAgCX0KCgogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKICAgIAkJdGhpcy5zb3VyY2UgPSBuZXcgU291cmNlKCBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLmltYWdlICkgKTsgLy8gc2VlICMzMDU0MAogICAgCQl0aGlzLmNvbXBhcmVGdW5jdGlvbiA9IHNvdXJjZS5jb21wYXJlRnVuY3Rpb247CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAl0b0pTT04oIG1ldGEgKSB7CgogICAgCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgogICAgCQlpZiAoIHRoaXMuY29tcGFyZUZ1bmN0aW9uICE9PSBudWxsICkgZGF0YS5jb21wYXJlRnVuY3Rpb24gPSB0aGlzLmNvbXBhcmVGdW5jdGlvbjsKCiAgICAJCXJldHVybiBkYXRhOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQSBnZW9tZXRyeSBjbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgcGxhbmUuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLlBsYW5lR2VvbWV0cnkoIDEsIDEgKTsKICAgICAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmYwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9ICk7CiAgICAgKiBjb25zdCBwbGFuZSA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKICAgICAqIHNjZW5lLmFkZCggcGxhbmUgKTsKICAgICAqIGBgYAogICAgICoKICAgICAqIEBhdWdtZW50cyBCdWZmZXJHZW9tZXRyeQogICAgICovCiAgICBjbGFzcyBQbGFuZUdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IHBsYW5lIGdlb21ldHJ5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aCBhbG9uZyB0aGUgWCBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0PTFdIC0gVGhlIGhlaWdodCBhbG9uZyB0aGUgWSBheGlzCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aFNlZ21lbnRzPTFdIC0gVGhlIG51bWJlciBvZiBzZWdtZW50cyBhbG9uZyB0aGUgWCBheGlzLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0U2VnbWVudHM9MV0gLSBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIGFsb25nIHRoZSBZIGF4aXMuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQl0aGlzLnR5cGUgPSAnUGxhbmVHZW9tZXRyeSc7CgogICAgCQkvKioKICAgIAkJICogSG9sZHMgdGhlIGNvbnN0cnVjdG9yIHBhcmFtZXRlcnMgdGhhdCBoYXZlIGJlZW4KICAgIAkJICogdXNlZCB0byBnZW5lcmF0ZSB0aGUgZ2VvbWV0cnkuIEFueSBtb2RpZmljYXRpb24KICAgIAkJICogYWZ0ZXIgaW5zdGFudGlhdGlvbiBkb2VzIG5vdCBjaGFuZ2UgdGhlIGdlb21ldHJ5LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy5wYXJhbWV0ZXJzID0gewogICAgCQkJd2lkdGg6IHdpZHRoLAogICAgCQkJaGVpZ2h0OiBoZWlnaHQsCiAgICAJCQl3aWR0aFNlZ21lbnRzOiB3aWR0aFNlZ21lbnRzLAogICAgCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzCiAgICAJCX07CgogICAgCQljb25zdCB3aWR0aF9oYWxmID0gd2lkdGggLyAyOwogICAgCQljb25zdCBoZWlnaHRfaGFsZiA9IGhlaWdodCAvIDI7CgogICAgCQljb25zdCBncmlkWCA9IE1hdGguZmxvb3IoIHdpZHRoU2VnbWVudHMgKTsKICAgIAkJY29uc3QgZ3JpZFkgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApOwoKICAgIAkJY29uc3QgZ3JpZFgxID0gZ3JpZFggKyAxOwogICAgCQljb25zdCBncmlkWTEgPSBncmlkWSArIDE7CgogICAgCQljb25zdCBzZWdtZW50X3dpZHRoID0gd2lkdGggLyBncmlkWDsKICAgIAkJY29uc3Qgc2VnbWVudF9oZWlnaHQgPSBoZWlnaHQgLyBncmlkWTsKCiAgICAJCS8vCgogICAgCQljb25zdCBpbmRpY2VzID0gW107CiAgICAJCWNvbnN0IHZlcnRpY2VzID0gW107CiAgICAJCWNvbnN0IG5vcm1hbHMgPSBbXTsKICAgIAkJY29uc3QgdXZzID0gW107CgogICAgCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgogICAgCQkJY29uc3QgeSA9IGl5ICogc2VnbWVudF9oZWlnaHQgLSBoZWlnaHRfaGFsZjsKCiAgICAJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYMTsgaXggKysgKSB7CgogICAgCQkJCWNvbnN0IHggPSBpeCAqIHNlZ21lbnRfd2lkdGggLSB3aWR0aF9oYWxmOwoKICAgIAkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAtIHksIDAgKTsKCiAgICAJCQkJbm9ybWFscy5wdXNoKCAwLCAwLCAxICk7CgogICAgCQkJCXV2cy5wdXNoKCBpeCAvIGdyaWRYICk7CiAgICAJCQkJdXZzLnB1c2goIDEgLSAoIGl5IC8gZ3JpZFkgKSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWZvciAoIGxldCBpeSA9IDA7IGl5IDwgZ3JpZFk7IGl5ICsrICkgewoKICAgIAkJCWZvciAoIGxldCBpeCA9IDA7IGl4IDwgZ3JpZFg7IGl4ICsrICkgewoKICAgIAkJCQljb25zdCBhID0gaXggKyBncmlkWDEgKiBpeTsKICAgIAkJCQljb25zdCBiID0gaXggKyBncmlkWDEgKiAoIGl5ICsgMSApOwogICAgCQkJCWNvbnN0IGMgPSAoIGl4ICsgMSApICsgZ3JpZFgxICogKCBpeSArIDEgKTsKICAgIAkJCQljb25zdCBkID0gKCBpeCArIDEgKSArIGdyaWRYMSAqIGl5OwoKICAgIAkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKICAgIAkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CiAgICAJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwogICAgCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKICAgIAkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKICAgIAkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBGYWN0b3J5IG1ldGhvZCBmb3IgY3JlYXRpbmcgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcyBmcm9tIHRoZSBnaXZlbgogICAgCSAqIEpTT04gb2JqZWN0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCBnZW9tZXRyeS4KICAgIAkgKiBAcmV0dXJuIHtQbGFuZUdlb21ldHJ5fSBBIG5ldyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgogICAgCQlyZXR1cm4gbmV3IFBsYW5lR2VvbWV0cnkoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLndpZHRoU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMgKTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIEEgbWF0ZXJpYWwgZm9yIGRyYXdpbmcgZ2VvbWV0cnkgYnkgZGVwdGguIERlcHRoIGlzIGJhc2VkIG9mZiBvZiB0aGUgY2FtZXJhCiAgICAgKiBuZWFyIGFuZCBmYXIgcGxhbmUuIFdoaXRlIGlzIG5lYXJlc3QsIGJsYWNrIGlzIGZhcnRoZXN0LgogICAgICoKICAgICAqIEBhdWdtZW50cyBNYXRlcmlhbAogICAgICovCiAgICBjbGFzcyBNZXNoRGVwdGhNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBtZXNoIGRlcHRoIG1hdGVyaWFsLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3R9IFtwYXJhbWV0ZXJzXSAtIEFuIG9iamVjdCB3aXRoIG9uZSBvciBtb3JlIHByb3BlcnRpZXMKICAgIAkgKiBkZWZpbmluZyB0aGUgbWF0ZXJpYWwncyBhcHBlYXJhbmNlLiBBbnkgcHJvcGVydHkgb2YgdGhlIG1hdGVyaWFsCiAgICAJICogKGluY2x1ZGluZyBhbnkgcHJvcGVydHkgZnJvbSBpbmhlcml0ZWQgbWF0ZXJpYWxzKSBjYW4gYmUgcGFzc2VkCiAgICAJICogaW4gaGVyZS4gQ29sb3IgdmFsdWVzIGNhbiBiZSBwYXNzZWQgYW55IHR5cGUgb2YgdmFsdWUgYWNjZXB0ZWQKICAgIAkgKiBieSB7QGxpbmsgQ29sb3Ijc2V0fS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCiAgICAJCXN1cGVyKCk7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc01lc2hEZXB0aE1hdGVyaWFsID0gdHJ1ZTsKCiAgICAJCXRoaXMudHlwZSA9ICdNZXNoRGVwdGhNYXRlcmlhbCc7CgogICAgCQkvKioKICAgIAkJICogVHlwZSBmb3IgZGVwdGggcGFja2luZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUgeyhCYXNpY0RlcHRoUGFja2luZ3xSR0JBRGVwdGhQYWNraW5nfFJHQkRlcHRoUGFja2luZ3xSR0RlcHRoUGFja2luZyl9CiAgICAJCSAqIEBkZWZhdWx0IEJhc2ljRGVwdGhQYWNraW5nCiAgICAJCSAqLwogICAgCQl0aGlzLmRlcHRoUGFja2luZyA9IEJhc2ljRGVwdGhQYWNraW5nOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBjb2xvciBtYXAuIE1heSBvcHRpb25hbGx5IGluY2x1ZGUgYW4gYWxwaGEgY2hhbm5lbCwgdHlwaWNhbGx5IGNvbWJpbmVkCiAgICAJCSAqIHdpdGgge0BsaW5rIE1hdGVyaWFsI3RyYW5zcGFyZW50fSBvciB7QGxpbmsgTWF0ZXJpYWwjYWxwaGFUZXN0fS4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLm1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGFscGhhIG1hcCBpcyBhIGdyYXlzY2FsZSB0ZXh0dXJlIHRoYXQgY29udHJvbHMgdGhlIG9wYWNpdHkgYWNyb3NzIHRoZQogICAgCQkgKiBzdXJmYWNlIChibGFjazogZnVsbHkgdHJhbnNwYXJlbnQ7IHdoaXRlOiBmdWxseSBvcGFxdWUpLgogICAgCQkgKgogICAgCQkgKiBPbmx5IHRoZSBjb2xvciBvZiB0aGUgdGV4dHVyZSBpcyB1c2VkLCBpZ25vcmluZyB0aGUgYWxwaGEgY2hhbm5lbCBpZiBvbmUKICAgIAkJICogZXhpc3RzLiBGb3IgUkdCIGFuZCBSR0JBIHRleHR1cmVzLCB0aGUgcmVuZGVyZXIgd2lsbCB1c2UgdGhlIGdyZWVuIGNoYW5uZWwKICAgIAkJICogd2hlbiBzYW1wbGluZyB0aGlzIHRleHR1cmUgZHVlIHRvIHRoZSBleHRyYSBiaXQgb2YgcHJlY2lzaW9uIHByb3ZpZGVkIGZvcgogICAgCQkgKiBncmVlbiBpbiBEWFQtY29tcHJlc3NlZCBhbmQgdW5jb21wcmVzc2VkIFJHQiA1NjUgZm9ybWF0cy4gTHVtaW5hbmNlLW9ubHkgYW5kCiAgICAJCSAqIGx1bWluYW5jZS9hbHBoYSB0ZXh0dXJlcyB3aWxsIGFsc28gc3RpbGwgd29yayBhcyBleHBlY3RlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgZGlzcGxhY2VtZW50IG1hcCBhZmZlY3RzIHRoZSBwb3NpdGlvbiBvZiB0aGUgbWVzaCdzIHZlcnRpY2VzLiBVbmxpa2UKICAgIAkJICogb3RoZXIgbWFwcyB3aGljaCBvbmx5IGFmZmVjdCB0aGUgbGlnaHQgYW5kIHNoYWRlIG9mIHRoZSBtYXRlcmlhbCB0aGUKICAgIAkJICogZGlzcGxhY2VkIHZlcnRpY2VzIGNhbiBjYXN0IHNoYWRvd3MsIGJsb2NrIG90aGVyIG9iamVjdHMsIGFuZCBvdGhlcndpc2UKICAgIAkJICogYWN0IGFzIHJlYWwgZ2VvbWV0cnkuIFRoZSBkaXNwbGFjZW1lbnQgdGV4dHVyZSBpcyBhbiBpbWFnZSB3aGVyZSB0aGUgdmFsdWUKICAgIAkJICogb2YgZWFjaCBwaXhlbCAod2hpdGUgYmVpbmcgdGhlIGhpZ2hlc3QpIGlzIG1hcHBlZCBhZ2FpbnN0LCBhbmQKICAgIAkJICogcmVwb3NpdGlvbnMsIHRoZSB2ZXJ0aWNlcyBvZiB0aGUgbWVzaC4KICAgIAkJICoKICAgIAkJICogQHR5cGUgez9UZXh0dXJlfQogICAgCQkgKiBAZGVmYXVsdCBudWxsCiAgICAJCSAqLwogICAgCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogSG93IG11Y2ggdGhlIGRpc3BsYWNlbWVudCBtYXAgYWZmZWN0cyB0aGUgbWVzaCAod2hlcmUgYmxhY2sgaXMgbm8KICAgIAkJICogZGlzcGxhY2VtZW50LCBhbmQgd2hpdGUgaXMgbWF4aW11bSBkaXNwbGFjZW1lbnQpLiBXaXRob3V0IGEgZGlzcGxhY2VtZW50CiAgICAJCSAqIG1hcCBzZXQsIHRoaXMgdmFsdWUgaXMgbm90IGFwcGxpZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBvZmZzZXQgb2YgdGhlIGRpc3BsYWNlbWVudCBtYXAncyB2YWx1ZXMgb24gdGhlIG1lc2gncyB2ZXJ0aWNlcy4KICAgIAkJICogVGhlIGJpYXMgaXMgYWRkZWQgdG8gdGhlIHNjYWxlZCBzYW1wbGUgb2YgdGhlIGRpc3BsYWNlbWVudCBtYXAuCiAgICAJCSAqIFdpdGhvdXQgYSBkaXNwbGFjZW1lbnQgbWFwIHNldCwgdGhpcyB2YWx1ZSBpcyBub3QgYXBwbGllZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMAogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCiAgICAJCS8qKgogICAgCQkgKiBSZW5kZXJzIHRoZSBnZW9tZXRyeSBhcyBhIHdpcmVmcmFtZS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIENvbnRyb2xzIHRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZS4KICAgIAkJICoKICAgIAkJICogV2ViR0wgYW5kIFdlYkdQVSBpZ25vcmUgdGhpcyBwcm9wZXJ0eSBhbmQgYWx3YXlzIHJlbmRlcgogICAgCQkgKiAxIHBpeGVsIHdpZGUgbGluZXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCiAgICAJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgogICAgCX0KCiAgICAJY29weSggc291cmNlICkgewoKICAgIAkJc3VwZXIuY29weSggc291cmNlICk7CgogICAgCQl0aGlzLmRlcHRoUGFja2luZyA9IHNvdXJjZS5kZXB0aFBhY2tpbmc7CgogICAgCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgogICAgCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwogICAgCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwogICAgCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKCiAgICAJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKICAgIAkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIG1hdGVyaWFsIHVzZWQgaW50ZXJuYWxseSBmb3IgaW1wbGVtZW50aW5nIHNoYWRvdyBtYXBwaW5nIHdpdGgKICAgICAqIHBvaW50IGxpZ2h0cy4KICAgICAqCiAgICAgKiBDYW4gYWxzbyBiZSB1c2VkIHRvIGN1c3RvbWl6ZSB0aGUgc2hhZG93IGNhc3Rpbmcgb2YgYW4gb2JqZWN0IGJ5IGFzc2lnbmluZwogICAgICogYW4gaW5zdGFuY2Ugb2YgYE1lc2hEaXN0YW5jZU1hdGVyaWFsYCB0byB7QGxpbmsgT2JqZWN0M0QjY3VzdG9tRGlzdGFuY2VNYXRlcmlhbH0uCiAgICAgKiBUaGUgZm9sbG93aW5nIGV4YW1wbGVzIGRlbW9uc3RyYXRlcyB0aGlzIGFwcHJvYWNoIGluIG9yZGVyIHRvIGVuc3VyZQogICAgICogdHJhbnNwYXJlbnQgcGFydHMgb2Ygb2JqZWN0cyBkbyBubyBjYXN0IHNoYWRvd3MuCiAgICAgKgogICAgICogQGF1Z21lbnRzIE1hdGVyaWFsCiAgICAgKi8KICAgIGNsYXNzIE1lc2hEaXN0YW5jZU1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2ggZGlzdGFuY2UgbWF0ZXJpYWwuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge09iamVjdH0gW3BhcmFtZXRlcnNdIC0gQW4gb2JqZWN0IHdpdGggb25lIG9yIG1vcmUgcHJvcGVydGllcwogICAgCSAqIGRlZmluaW5nIHRoZSBtYXRlcmlhbCdzIGFwcGVhcmFuY2UuIEFueSBwcm9wZXJ0eSBvZiB0aGUgbWF0ZXJpYWwKICAgIAkgKiAoaW5jbHVkaW5nIGFueSBwcm9wZXJ0eSBmcm9tIGluaGVyaXRlZCBtYXRlcmlhbHMpIGNhbiBiZSBwYXNzZWQKICAgIAkgKiBpbiBoZXJlLiBDb2xvciB2YWx1ZXMgY2FuIGJlIHBhc3NlZCBhbnkgdHlwZSBvZiB2YWx1ZSBhY2NlcHRlZAogICAgCSAqIGJ5IHtAbGluayBDb2xvciNzZXR9LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgPSB0cnVlOwoKICAgIAkJdGhpcy50eXBlID0gJ01lc2hEaXN0YW5jZU1hdGVyaWFsJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAogICAgCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5tYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKICAgIAkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KICAgIAkJICoKICAgIAkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCiAgICAJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCiAgICAJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKICAgIAkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAogICAgCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGRpc3BsYWNlbWVudCBtYXAgYWZmZWN0cyB0aGUgcG9zaXRpb24gb2YgdGhlIG1lc2gncyB2ZXJ0aWNlcy4gVW5saWtlCiAgICAJCSAqIG90aGVyIG1hcHMgd2hpY2ggb25seSBhZmZlY3QgdGhlIGxpZ2h0IGFuZCBzaGFkZSBvZiB0aGUgbWF0ZXJpYWwgdGhlCiAgICAJCSAqIGRpc3BsYWNlZCB2ZXJ0aWNlcyBjYW4gY2FzdCBzaGFkb3dzLCBibG9jayBvdGhlciBvYmplY3RzLCBhbmQgb3RoZXJ3aXNlCiAgICAJCSAqIGFjdCBhcyByZWFsIGdlb21ldHJ5LiBUaGUgZGlzcGxhY2VtZW50IHRleHR1cmUgaXMgYW4gaW1hZ2Ugd2hlcmUgdGhlIHZhbHVlCiAgICAJCSAqIG9mIGVhY2ggcGl4ZWwgKHdoaXRlIGJlaW5nIHRoZSBoaWdoZXN0KSBpcyBtYXBwZWQgYWdhaW5zdCwgYW5kCiAgICAJCSAqIHJlcG9zaXRpb25zLCB0aGUgdmVydGljZXMgb2YgdGhlIG1lc2guCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/VGV4dHVyZX0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEhvdyBtdWNoIHRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIG1lc2ggKHdoZXJlIGJsYWNrIGlzIG5vCiAgICAJCSAqIGRpc3BsYWNlbWVudCwgYW5kIHdoaXRlIGlzIG1heGltdW0gZGlzcGxhY2VtZW50KS4gV2l0aG91dCBhIGRpc3BsYWNlbWVudAogICAgCQkgKiBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAwCiAgICAJCSAqLwogICAgCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgb2Zmc2V0IG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwJ3MgdmFsdWVzIG9uIHRoZSBtZXNoJ3MgdmVydGljZXMuCiAgICAJCSAqIFRoZSBiaWFzIGlzIGFkZGVkIHRvIHRoZSBzY2FsZWQgc2FtcGxlIG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwLgogICAgCQkgKiBXaXRob3V0IGEgZGlzcGxhY2VtZW50IG1hcCBzZXQsIHRoaXMgdmFsdWUgaXMgbm90IGFwcGxpZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAKICAgIAkJICovCiAgICAJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgogICAgCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSApIHsKCiAgICAJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKICAgIAkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKICAgIAkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCiAgICAJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKICAgIAkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIEBjbGFzcwogICAgICogQGNsYXNzZGVzYyBBIHNpbXBsZSBjYWNoaW5nIHN5c3RlbSwgdXNlZCBpbnRlcm5hbGx5IGJ5IHtAbGluayBGaWxlTG9hZGVyfS4KICAgICAqIFRvIGVuYWJsZSBjYWNoaW5nIGFjcm9zcyBhbGwgbG9hZGVycyB0aGF0IHVzZSB7QGxpbmsgRmlsZUxvYWRlcn0sIGFkZCBgVEhSRUUuQ2FjaGUuZW5hYmxlZCA9IHRydWUuYCBvbmNlIGluIHlvdXIgYXBwLgogICAgICogQGhpZGVjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdCBDYWNoZSA9IHsKCiAgICAJLyoqCiAgICAJICogV2hldGhlciBjYWNoaW5nIGlzIGVuYWJsZWQgb3Igbm90LgogICAgCSAqCiAgICAJICogQHN0YXRpYwogICAgCSAqIEB0eXBlIHtib29sZWFufQogICAgCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJICovCiAgICAJZW5hYmxlZDogZmFsc2UsCgogICAgCS8qKgogICAgCSAqIEEgZGljdGlvbmFyeSB0aGF0IGhvbGRzIGNhY2hlZCBmaWxlcy4KICAgIAkgKgogICAgCSAqIEBzdGF0aWMKICAgIAkgKiBAdHlwZSB7T2JqZWN0PHN0cmluZyxPYmplY3Q+fQogICAgCSAqLwogICAgCWZpbGVzOiB7fSwKCiAgICAJLyoqCiAgICAJICogQWRkcyBhIGNhY2hlIGVudHJ5IHdpdGggYSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBmaWxlLiBJZiB0aGlzIGtleSBhbHJlYWR5CiAgICAJICogaG9sZHMgYSBmaWxlLCBpdCBpcyBvdmVyd3JpdHRlbi4KICAgIAkgKgogICAgCSAqIEBzdGF0aWMKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30ga2V5IC0gVGhlIGtleSB0byByZWZlcmVuY2UgdGhlIGNhY2hlZCBmaWxlLgogICAgCSAqIEBwYXJhbSB7T2JqZWN0fSBmaWxlIC0gIFRoZSBmaWxlIHRvIGJlIGNhY2hlZC4KICAgIAkgKi8KICAgIAlhZGQ6IGZ1bmN0aW9uICgga2V5LCBmaWxlICkgewoKICAgIAkJaWYgKCB0aGlzLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwoKICAgIAkJLy8gY29uc29sZS5sb2coICdUSFJFRS5DYWNoZScsICdBZGRpbmcga2V5OicsIGtleSApOwoKICAgIAkJdGhpcy5maWxlc1sga2V5IF0gPSBmaWxlOwoKICAgIAl9LAoKICAgIAkvKioKICAgIAkgKiBHZXRzIHRoZSBjYWNoZWQgdmFsdWUgZm9yIHRoZSBnaXZlbiBrZXkuCiAgICAJICoKICAgIAkgKiBAc3RhdGljCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KICAgIAkgKiBAcmV0dXJuIHtPYmplY3R8dW5kZWZpbmVkfSBUaGUgY2FjaGVkIGZpbGUuIElmIHRoZSBrZXkgZG9lcyBub3QgZXhpc3QgYHVuZGVmaW5lZGAgaXMgcmV0dXJuZWQuCiAgICAJICovCiAgICAJZ2V0OiBmdW5jdGlvbiAoIGtleSApIHsKCiAgICAJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCiAgICAJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQ2FjaGUnLCAnQ2hlY2tpbmcga2V5OicsIGtleSApOwoKICAgIAkJcmV0dXJuIHRoaXMuZmlsZXNbIGtleSBdOwoKICAgIAl9LAoKICAgIAkvKioKICAgIAkgKiBSZW1vdmVzIHRoZSBjYWNoZWQgZmlsZSBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIGtleS4KICAgIAkgKgogICAgCSAqIEBzdGF0aWMKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30ga2V5IC0gVGhlIGtleSB0byByZWZlcmVuY2UgdGhlIGNhY2hlZCBmaWxlLgogICAgCSAqLwogICAgCXJlbW92ZTogZnVuY3Rpb24gKCBrZXkgKSB7CgogICAgCQlkZWxldGUgdGhpcy5maWxlc1sga2V5IF07CgogICAgCX0sCgogICAgCS8qKgogICAgCSAqIFJlbW92ZSBhbGwgdmFsdWVzIGZyb20gdGhlIGNhY2hlLgogICAgCSAqCiAgICAJICogQHN0YXRpYwogICAgCSAqLwogICAgCWNsZWFyOiBmdW5jdGlvbiAoKSB7CgogICAgCQl0aGlzLmZpbGVzID0ge307CgogICAgCX0KCiAgICB9OwoKICAgIC8qKgogICAgICogSGFuZGxlcyBhbmQga2VlcHMgdHJhY2sgb2YgbG9hZGVkIGFuZCBwZW5kaW5nIGRhdGEuIEEgZGVmYXVsdCBnbG9iYWwKICAgICAqIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgaXMgY3JlYXRlZCBhbmQgdXNlZCBieSBsb2FkZXJzIGlmIG5vdCBzdXBwbGllZAogICAgICogbWFudWFsbHkuCiAgICAgKgogICAgICogSW4gZ2VuZXJhbCB0aGF0IHNob3VsZCBiZSBzdWZmaWNpZW50LCBob3dldmVyIHRoZXJlIGFyZSB0aW1lcyB3aGVuIGl0IGNhbgogICAgICogYmUgdXNlZnVsIHRvIGhhdmUgc2VwYXJhdGUgbG9hZGVycyAtIGZvciBleGFtcGxlIGlmIHlvdSB3YW50IHRvIHNob3cKICAgICAqIHNlcGFyYXRlIGxvYWRpbmcgYmFycyBmb3Igb2JqZWN0cyBhbmQgdGV4dHVyZXMuCiAgICAgKgogICAgICogYGBganMKICAgICAqIGNvbnN0IG1hbmFnZXIgPSBuZXcgVEhSRUUuTG9hZGluZ01hbmFnZXIoKTsKICAgICAqIG1hbmFnZXIub25Mb2FkID0gKCkgPT4gY29uc29sZS5sb2coICdMb2FkaW5nIGNvbXBsZXRlIScgKTsKICAgICAqCiAgICAgKiBjb25zdCBsb2FkZXIxID0gbmV3IE9CSkxvYWRlciggbWFuYWdlciApOwogICAgICogY29uc3QgbG9hZGVyMiA9IG5ldyBDb2xsYWRhTG9hZGVyKCBtYW5hZ2VyICk7CiAgICAgKiBgYGAKICAgICAqLwogICAgY2xhc3MgTG9hZGluZ01hbmFnZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGxvYWRpbmcgbWFuYWdlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7RnVuY3Rpb259IFtvbkxvYWRdIC0gRXhlY3V0ZXMgd2hlbiBhbGwgaXRlbXMgaGF2ZSBiZWVuIGxvYWRlZC4KICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlcyB3aGVuIHNpbmdsZSBpdGVtcyBoYXZlIGJlZW4gbG9hZGVkLgogICAgCSAqIEBwYXJhbSB7RnVuY3Rpb259IFtvbkVycm9yXSAtIEV4ZWN1dGVzIHdoZW4gYW4gZXJyb3Igb2NjdXJzLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgogICAgCQljb25zdCBzY29wZSA9IHRoaXM7CgogICAgCQlsZXQgaXNMb2FkaW5nID0gZmFsc2U7CiAgICAJCWxldCBpdGVtc0xvYWRlZCA9IDA7CiAgICAJCWxldCBpdGVtc1RvdGFsID0gMDsKICAgIAkJbGV0IHVybE1vZGlmaWVyID0gdW5kZWZpbmVkOwogICAgCQljb25zdCBoYW5kbGVycyA9IFtdOwoKICAgIAkJLy8gUmVmZXIgdG8gIzU2ODkgZm9yIHRoZSByZWFzb24gd2h5IHdlIGRvbid0IHNldCAub25TdGFydAogICAgCQkvLyBpbiB0aGUgY29uc3RydWN0b3IKCiAgICAJCS8qKgogICAgCQkgKiBFeGVjdXRlcyB3aGVuIGFuIGl0ZW0gc3RhcnRzIGxvYWRpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtGdW5jdGlvbnx1bmRlZmluZWR9CiAgICAJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAogICAgCQkgKi8KICAgIAkJdGhpcy5vblN0YXJ0ID0gdW5kZWZpbmVkOwoKICAgIAkJLyoqCiAgICAJCSAqIEV4ZWN1dGVzIHdoZW4gYWxsIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtGdW5jdGlvbnx1bmRlZmluZWR9CiAgICAJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAogICAgCQkgKi8KICAgIAkJdGhpcy5vbkxvYWQgPSBvbkxvYWQ7CgogICAgCQkvKioKICAgIAkJICogRXhlY3V0ZXMgd2hlbiBzaW5nbGUgaXRlbXMgaGF2ZSBiZWVuIGxvYWRlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0Z1bmN0aW9ufHVuZGVmaW5lZH0KICAgIAkJICogQGRlZmF1bHQgdW5kZWZpbmVkCiAgICAJCSAqLwogICAgCQl0aGlzLm9uUHJvZ3Jlc3MgPSBvblByb2dyZXNzOwoKICAgIAkJLyoqCiAgICAJCSAqIEV4ZWN1dGVzIHdoZW4gYW4gZXJyb3Igb2NjdXJzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQogICAgCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKICAgIAkJICovCiAgICAJCXRoaXMub25FcnJvciA9IG9uRXJyb3I7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCiAgICAJCSAqIHN0YXJ0cyBsb2FkaW5nIGFuIGl0ZW0uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIHRvIGxvYWQuCiAgICAJCSAqLwogICAgCQl0aGlzLml0ZW1TdGFydCA9IGZ1bmN0aW9uICggdXJsICkgewoKICAgIAkJCWl0ZW1zVG90YWwgKys7CgogICAgCQkJaWYgKCBpc0xvYWRpbmcgPT09IGZhbHNlICkgewoKICAgIAkJCQlpZiAoIHNjb3BlLm9uU3RhcnQgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCXNjb3BlLm9uU3RhcnQoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpc0xvYWRpbmcgPSB0cnVlOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYnkgYW55IGxvYWRlciB1c2luZyB0aGUgbWFuYWdlciB3aGVuIHRoZSBsb2FkZXIKICAgIAkJICogZW5kZWQgbG9hZGluZyBhbiBpdGVtLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCBvZiB0aGUgbG9hZGVkIGl0ZW0uCiAgICAJCSAqLwogICAgCQl0aGlzLml0ZW1FbmQgPSBmdW5jdGlvbiAoIHVybCApIHsKCiAgICAJCQlpdGVtc0xvYWRlZCArKzsKCiAgICAJCQlpZiAoIHNjb3BlLm9uUHJvZ3Jlc3MgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJc2NvcGUub25Qcm9ncmVzcyggdXJsLCBpdGVtc0xvYWRlZCwgaXRlbXNUb3RhbCApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGl0ZW1zTG9hZGVkID09PSBpdGVtc1RvdGFsICkgewoKICAgIAkJCQlpc0xvYWRpbmcgPSBmYWxzZTsKCiAgICAJCQkJaWYgKCBzY29wZS5vbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCXNjb3BlLm9uTG9hZCgpOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIHNob3VsZCBiZSBjYWxsZWQgYnkgYW55IGxvYWRlciB1c2luZyB0aGUgbWFuYWdlciB3aGVuIHRoZSBsb2FkZXIKICAgIAkJICogZW5jb3VudGVycyBhbiBlcnJvciB3aGVuIGxvYWRpbmcgYW4gaXRlbS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIGl0ZW0gdGhhdCBwcm9kdWNlcyBhbiBlcnJvci4KICAgIAkJICovCiAgICAJCXRoaXMuaXRlbUVycm9yID0gZnVuY3Rpb24gKCB1cmwgKSB7CgogICAgCQkJaWYgKCBzY29wZS5vbkVycm9yICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXNjb3BlLm9uRXJyb3IoIHVybCApOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogR2l2ZW4gYSBVUkwsIHVzZXMgdGhlIFVSTCBtb2RpZmllciBjYWxsYmFjayAoaWYgYW55KSBhbmQgcmV0dXJucyBhCiAgICAJCSAqIHJlc29sdmVkIFVSTC4gSWYgbm8gVVJMIG1vZGlmaWVyIGlzIHNldCwgcmV0dXJucyB0aGUgb3JpZ2luYWwgVVJMLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBsb2FkLgogICAgCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSByZXNvbHZlZCBVUkwuCiAgICAJCSAqLwogICAgCQl0aGlzLnJlc29sdmVVUkwgPSBmdW5jdGlvbiAoIHVybCApIHsKCiAgICAJCQlpZiAoIHVybE1vZGlmaWVyICkgewoKICAgIAkJCQlyZXR1cm4gdXJsTW9kaWZpZXIoIHVybCApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdXJsOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiBwcm92aWRlZCwgdGhlIGNhbGxiYWNrIHdpbGwgYmUgcGFzc2VkIGVhY2ggcmVzb3VyY2UgVVJMIGJlZm9yZSBhCiAgICAJCSAqIHJlcXVlc3QgaXMgc2VudC4gVGhlIGNhbGxiYWNrIG1heSByZXR1cm4gdGhlIG9yaWdpbmFsIFVSTCwgb3IgYSBuZXcgVVJMIHRvCiAgICAJCSAqIG92ZXJyaWRlIGxvYWRpbmcgYmVoYXZpb3IuIFRoaXMgYmVoYXZpb3IgY2FuIGJlIHVzZWQgdG8gbG9hZCBhc3NldHMgZnJvbQogICAgCQkgKiAuWklQIGZpbGVzLCBkcmFnLWFuZC1kcm9wIEFQSXMsIGFuZCBEYXRhIFVSSXMuCiAgICAJCSAqCiAgICAJCSAqIGBgYGpzCiAgICAJCSAqIGNvbnN0IGJsb2JzID0geydmaXNoLmdsdGYnOiBibG9iMSwgJ2RpZmZ1c2UucG5nJzogYmxvYjIsICdub3JtYWwucG5nJzogYmxvYjN9OwogICAgCQkgKgogICAgCQkgKiBjb25zdCBtYW5hZ2VyID0gbmV3IFRIUkVFLkxvYWRpbmdNYW5hZ2VyKCk7CiAgICAJCSAqCiAgICAJCSAqIC8vIEluaXRpYWxpemUgbG9hZGluZyBtYW5hZ2VyIHdpdGggVVJMIGNhbGxiYWNrLgogICAgCQkgKiBjb25zdCBvYmplY3RVUkxzID0gW107CiAgICAJCSAqIG1hbmFnZXIuc2V0VVJMTW9kaWZpZXIoICggdXJsICkgPT4gewogICAgCQkgKgogICAgCQkgKiAJdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTCggYmxvYnNbIHVybCBdICk7CiAgICAJCSAqIAlvYmplY3RVUkxzLnB1c2goIHVybCApOwogICAgCQkgKiAJcmV0dXJuIHVybDsKICAgIAkJICoKICAgIAkJICogfSApOwogICAgCQkgKgogICAgCQkgKiAvLyBMb2FkIGFzIHVzdWFsLCB0aGVuIHJldm9rZSB0aGUgYmxvYiBVUkxzLgogICAgCQkgKiBjb25zdCBsb2FkZXIgPSBuZXcgR0xURkxvYWRlciggbWFuYWdlciApOwogICAgCQkgKiBsb2FkZXIubG9hZCggJ2Zpc2guZ2x0ZicsIChnbHRmKSA9PiB7CiAgICAJCSAqCiAgICAJCSAqIAlzY2VuZS5hZGQoIGdsdGYuc2NlbmUgKTsKICAgIAkJICogCW9iamVjdFVSTHMuZm9yRWFjaCggKCB1cmwgKSA9PiBVUkwucmV2b2tlT2JqZWN0VVJMKCB1cmwgKSApOwogICAgCQkgKgogICAgCQkgKiB9ICk7CiAgICAJCSAqIGBgYAogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge2Z1bmN0aW9uKHN0cmluZyk6c3RyaW5nfSB0cmFuc2Zvcm0gLSBVUkwgbW9kaWZpZXIgY2FsbGJhY2suIENhbGxlZCB3aXRoIGFuIFVSTCBhbmQgbXVzdCByZXR1cm4gYSByZXNvbHZlZCBVUkwuCiAgICAJCSAqIEByZXR1cm4ge0xvYWRpbmdNYW5hZ2VyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGxvYWRpbmcgbWFuYWdlci4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0VVJMTW9kaWZpZXIgPSBmdW5jdGlvbiAoIHRyYW5zZm9ybSApIHsKCiAgICAJCQl1cmxNb2RpZmllciA9IHRyYW5zZm9ybTsKCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmVnaXN0ZXJzIGEgbG9hZGVyIHdpdGggdGhlIGdpdmVuIHJlZ3VsYXIgZXhwcmVzc2lvbi4gQ2FuIGJlIHVzZWQgdG8KICAgIAkJICogZGVmaW5lIHdoYXQgbG9hZGVyIHNob3VsZCBiZSB1c2VkIGluIG9yZGVyIHRvIGxvYWQgc3BlY2lmaWMgZmlsZXMuIEEKICAgIAkJICogdHlwaWNhbCB1c2UgY2FzZSBpcyB0byBvdmVyd3JpdGUgdGhlIGRlZmF1bHQgbG9hZGVyIGZvciB0ZXh0dXJlcy4KICAgIAkJICoKICAgIAkJICogYGBganMKICAgIAkJICogLy8gYWRkIGhhbmRsZXIgZm9yIFRHQSB0ZXh0dXJlcwogICAgCQkgKiBtYW5hZ2VyLmFkZEhhbmRsZXIoIC9cLnRnYSQvaSwgbmV3IFRHQUxvYWRlcigpICk7CiAgICAJCSAqIGBgYAogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge3N0cmluZ30gcmVnZXggLSBBIHJlZ3VsYXIgZXhwcmVzc2lvbi4KICAgIAkJICogQHBhcmFtIHtMb2FkZXJ9IGxvYWRlciAtIEEgbG9hZGVyIHRoYXQgc2hvdWxkIGhhbmRsZSBtYXRjaGVkIGNhc2VzLgogICAgCQkgKiBAcmV0dXJuIHtMb2FkaW5nTWFuYWdlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBsb2FkaW5nIG1hbmFnZXIuCiAgICAJCSAqLwogICAgCQl0aGlzLmFkZEhhbmRsZXIgPSBmdW5jdGlvbiAoIHJlZ2V4LCBsb2FkZXIgKSB7CgogICAgCQkJaGFuZGxlcnMucHVzaCggcmVnZXgsIGxvYWRlciApOwoKICAgIAkJCXJldHVybiB0aGlzOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZW1vdmVzIHRoZSBsb2FkZXIgZm9yIHRoZSBnaXZlbiByZWd1bGFyIGV4cHJlc3Npb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7c3RyaW5nfSByZWdleCAtIEEgcmVndWxhciBleHByZXNzaW9uLgogICAgCQkgKiBAcmV0dXJuIHtMb2FkaW5nTWFuYWdlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBsb2FkaW5nIG1hbmFnZXIuCiAgICAJCSAqLwogICAgCQl0aGlzLnJlbW92ZUhhbmRsZXIgPSBmdW5jdGlvbiAoIHJlZ2V4ICkgewoKICAgIAkJCWNvbnN0IGluZGV4ID0gaGFuZGxlcnMuaW5kZXhPZiggcmVnZXggKTsKCiAgICAJCQlpZiAoIGluZGV4ICE9PSAtMSApIHsKCiAgICAJCQkJaGFuZGxlcnMuc3BsaWNlKCBpbmRleCwgMiApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gdGhpczsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQ2FuIGJlIHVzZWQgdG8gcmV0cmlldmUgdGhlIHJlZ2lzdGVyZWQgbG9hZGVyIGZvciB0aGUgZ2l2ZW4gZmlsZSBwYXRoLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge3N0cmluZ30gZmlsZSAtIFRoZSBmaWxlIHBhdGguCiAgICAJCSAqIEByZXR1cm4gez9Mb2FkZXJ9IFRoZSByZWdpc3RlcmVkIGxvYWRlci4gUmV0dXJucyBgbnVsbGAgaWYgbm8gbG9hZGVyIHdhcyBmb3VuZC4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0SGFuZGxlciA9IGZ1bmN0aW9uICggZmlsZSApIHsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBoYW5kbGVycy5sZW5ndGg7IGkgPCBsOyBpICs9IDIgKSB7CgogICAgCQkJCWNvbnN0IHJlZ2V4ID0gaGFuZGxlcnNbIGkgXTsKICAgIAkJCQljb25zdCBsb2FkZXIgPSBoYW5kbGVyc1sgaSArIDEgXTsKCiAgICAJCQkJaWYgKCByZWdleC5nbG9iYWwgKSByZWdleC5sYXN0SW5kZXggPSAwOyAvLyBzZWUgIzE3OTIwCgogICAgCQkJCWlmICggcmVnZXgudGVzdCggZmlsZSApICkgewoKICAgIAkJCQkJcmV0dXJuIGxvYWRlcjsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gbnVsbDsKCiAgICAJCX07CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgZ2xvYmFsIGRlZmF1bHQgbG9hZGluZyBtYW5hZ2VyLgogICAgICoKICAgICAqIEBjb25zdGFudAogICAgICogQHR5cGUge0xvYWRpbmdNYW5hZ2VyfQogICAgICovCiAgICBjb25zdCBEZWZhdWx0TG9hZGluZ01hbmFnZXIgPSAvKkBfX1BVUkVfXyovIG5ldyBMb2FkaW5nTWFuYWdlcigpOwoKICAgIC8qKgogICAgICogQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgbG9hZGVycy4KICAgICAqCiAgICAgKiBAYWJzdHJhY3QKICAgICAqLwogICAgY2xhc3MgTG9hZGVyIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBsb2FkZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0xvYWRpbmdNYW5hZ2VyfSBbbWFuYWdlcl0gLSBUaGUgbG9hZGluZyBtYW5hZ2VyLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBsb2FkaW5nIG1hbmFnZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtMb2FkaW5nTWFuYWdlcn0KICAgIAkJICogQGRlZmF1bHQgRGVmYXVsdExvYWRpbmdNYW5hZ2VyCiAgICAJCSAqLwogICAgCQl0aGlzLm1hbmFnZXIgPSAoIG1hbmFnZXIgIT09IHVuZGVmaW5lZCApID8gbWFuYWdlciA6IERlZmF1bHRMb2FkaW5nTWFuYWdlcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY3Jvc3NPcmlnaW4gc3RyaW5nIHRvIGltcGxlbWVudCBDT1JTIGZvciBsb2FkaW5nIHRoZSB1cmwgZnJvbSBhCiAgICAJCSAqIGRpZmZlcmVudCBkb21haW4gdGhhdCBhbGxvd3MgQ09SUy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICogQGRlZmF1bHQgJ2Fub255bW91cycKICAgIAkJICovCiAgICAJCXRoaXMuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRoZSBYTUxIdHRwUmVxdWVzdCB1c2VzIGNyZWRlbnRpYWxzLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMud2l0aENyZWRlbnRpYWxzID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogVGhlIGJhc2UgcGF0aCBmcm9tIHdoaWNoIHRoZSBhc3NldCB3aWxsIGJlIGxvYWRlZC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge3N0cmluZ30KICAgIAkJICovCiAgICAJCXRoaXMucGF0aCA9ICcnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBiYXNlIHBhdGggZnJvbSB3aGljaCBhZGRpdGlvbmFsIHJlc291cmNlcyBsaWtlIHRleHR1cmVzIHdpbGwgYmUgbG9hZGVkLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7c3RyaW5nfQogICAgCQkgKi8KICAgIAkJdGhpcy5yZXNvdXJjZVBhdGggPSAnJzsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgW3JlcXVlc3QgaGVhZGVyXXtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL0dsb3NzYXJ5L1JlcXVlc3RfaGVhZGVyfQogICAgCQkgKiB1c2VkIGluIEhUVFAgcmVxdWVzdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge09iamVjdDxzdHJpbmcsIGFueT59CiAgICAJCSAqLwogICAgCQl0aGlzLnJlcXVlc3RIZWFkZXIgPSB7fTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGlzIG1ldGhvZCBuZWVkcyB0byBiZSBpbXBsZW1lbnRlZCBieSBhbGwgY29uY3JldGUgbG9hZGVycy4gSXQgaG9sZHMgdGhlCiAgICAJICogbG9naWMgZm9yIGxvYWRpbmcgYXNzZXRzIGZyb20gdGhlIGJhY2tlbmQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIHBhdGgvVVJMIG9mIHRoZSBmaWxlIHRvIGJlIGxvYWRlZC4KICAgIAkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkxvYWQgLSBFeGVjdXRlZCB3aGVuIHRoZSBsb2FkaW5nIHByb2Nlc3MgaGFzIGJlZW4gZmluaXNoZWQuCiAgICAJICogQHBhcmFtIHtvblByb2dyZXNzQ2FsbGJhY2t9IFtvblByb2dyZXNzXSAtIEV4ZWN1dGVkIHdoaWxlIHRoZSBsb2FkaW5nIGlzIGluIHByb2dyZXNzLgogICAgCSAqIEBwYXJhbSB7b25FcnJvckNhbGxiYWNrfSBbb25FcnJvcl0gLSBFeGVjdXRlZCB3aGVuIGVycm9ycyBvY2N1ci4KICAgIAkgKi8KICAgIAlsb2FkKCAvKiB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciAqLyApIHt9CgogICAgCS8qKgogICAgCSAqIEEgYXN5bmMgdmVyc2lvbiBvZiB7QGxpbmsgTG9hZGVyI2xvYWR9LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBwYXRoL1VSTCBvZiB0aGUgZmlsZSB0byBiZSBsb2FkZWQuCiAgICAJICogQHBhcmFtIHtvblByb2dyZXNzQ2FsbGJhY2t9IFtvblByb2dyZXNzXSAtIEV4ZWN1dGVkIHdoaWxlIHRoZSBsb2FkaW5nIGlzIGluIHByb2dyZXNzLgogICAgCSAqIEByZXR1cm4ge1Byb21pc2V9IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGFzc2V0IGhhcyBiZWVuIGxvYWRlZC4KICAgIAkgKi8KICAgIAlsb2FkQXN5bmMoIHVybCwgb25Qcm9ncmVzcyApIHsKCiAgICAJCWNvbnN0IHNjb3BlID0gdGhpczsKCiAgICAJCXJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7CgogICAgCQkJc2NvcGUubG9hZCggdXJsLCByZXNvbHZlLCBvblByb2dyZXNzLCByZWplY3QgKTsKCiAgICAJCX0gKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBUaGlzIG1ldGhvZCBuZWVkcyB0byBiZSBpbXBsZW1lbnRlZCBieSBhbGwgY29uY3JldGUgbG9hZGVycy4gSXQgaG9sZHMgdGhlCiAgICAJICogbG9naWMgZm9yIHBhcnNpbmcgdGhlIGFzc2V0IGludG8gdGhyZWUuanMgZW50aXRpZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge2FueX0gZGF0YSAtIFRoZSBkYXRhIHRvIHBhcnNlLgogICAgCSAqLwogICAgCXBhcnNlKCAvKiBkYXRhICovICkge30KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgYGNyb3NzT3JpZ2luYCBTdHJpbmcgdG8gaW1wbGVtZW50IENPUlMgZm9yIGxvYWRpbmcgdGhlIFVSTAogICAgCSAqIGZyb20gYSBkaWZmZXJlbnQgZG9tYWluIHRoYXQgYWxsb3dzIENPUlMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gY3Jvc3NPcmlnaW4gLSBUaGUgYGNyb3NzT3JpZ2luYCB2YWx1ZS4KICAgIAkgKiBAcmV0dXJuIHtMb2FkZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0Q3Jvc3NPcmlnaW4oIGNyb3NzT3JpZ2luICkgewoKICAgIAkJdGhpcy5jcm9zc09yaWdpbiA9IGNyb3NzT3JpZ2luOwogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBXaGV0aGVyIHRoZSBYTUxIdHRwUmVxdWVzdCB1c2VzIGNyZWRlbnRpYWxzIHN1Y2ggYXMgY29va2llcywgYXV0aG9yaXphdGlvbgogICAgCSAqIGhlYWRlcnMgb3IgVExTIGNsaWVudCBjZXJ0aWZpY2F0ZXMsIHNlZSBbWE1MSHR0cFJlcXVlc3Qud2l0aENyZWRlbnRpYWxzXXtAbGluayBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvWE1MSHR0cFJlcXVlc3Qvd2l0aENyZWRlbnRpYWxzfS4KICAgIAkgKgogICAgCSAqIE5vdGU6IFRoaXMgc2V0dGluZyBoYXMgbm8gZWZmZWN0IGlmIHlvdSBhcmUgbG9hZGluZyBmaWxlcyBsb2NhbGx5IG9yIGZyb20gdGhlIHNhbWUgZG9tYWluLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtib29sZWFufSB2YWx1ZSAtIFRoZSBgd2l0aENyZWRlbnRpYWxzYCB2YWx1ZS4KICAgIAkgKiBAcmV0dXJuIHtMb2FkZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0V2l0aENyZWRlbnRpYWxzKCB2YWx1ZSApIHsKCiAgICAJCXRoaXMud2l0aENyZWRlbnRpYWxzID0gdmFsdWU7CiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGJhc2UgcGF0aCBmb3IgdGhlIGFzc2V0LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSBUaGUgYmFzZSBwYXRoLgogICAgCSAqIEByZXR1cm4ge0xvYWRlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KICAgIAkgKi8KICAgIAlzZXRQYXRoKCBwYXRoICkgewoKICAgIAkJdGhpcy5wYXRoID0gcGF0aDsKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogU2V0cyB0aGUgYmFzZSBwYXRoIGZvciBkZXBlbmRlbnQgcmVzb3VyY2VzIGxpa2UgdGV4dHVyZXMuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge3N0cmluZ30gcmVzb3VyY2VQYXRoIC0gVGhlIHJlc291cmNlIHBhdGguCiAgICAJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgogICAgCSAqLwogICAgCXNldFJlc291cmNlUGF0aCggcmVzb3VyY2VQYXRoICkgewoKICAgIAkJdGhpcy5yZXNvdXJjZVBhdGggPSByZXNvdXJjZVBhdGg7CiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgdGhlIGdpdmVuIHJlcXVlc3QgaGVhZGVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtPYmplY3R9IHJlcXVlc3RIZWFkZXIgLSBBIFtyZXF1ZXN0IGhlYWRlcl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9HbG9zc2FyeS9SZXF1ZXN0X2hlYWRlcn0KICAgIAkgKiBmb3IgY29uZmlndXJpbmcgdGhlIEhUVFAgcmVxdWVzdC4KICAgIAkgKiBAcmV0dXJuIHtMb2FkZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCiAgICAJICovCiAgICAJc2V0UmVxdWVzdEhlYWRlciggcmVxdWVzdEhlYWRlciApIHsKCiAgICAJCXRoaXMucmVxdWVzdEhlYWRlciA9IHJlcXVlc3RIZWFkZXI7CiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZm9yIG9uUHJvZ3Jlc3MgaW4gbG9hZGVycy4KICAgICAqCiAgICAgKiBAY2FsbGJhY2sgb25Qcm9ncmVzc0NhbGxiYWNrCiAgICAgKiBAcGFyYW0ge1Byb2dyZXNzRXZlbnR9IGV2ZW50IC0gQW4gaW5zdGFuY2Ugb2YgYFByb2dyZXNzRXZlbnRgIHRoYXQgcmVwcmVzZW50cyB0aGUgY3VycmVudCBsb2FkaW5nIHN0YXR1cy4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZm9yIG9uRXJyb3IgaW4gbG9hZGVycy4KICAgICAqCiAgICAgKiBAY2FsbGJhY2sgb25FcnJvckNhbGxiYWNrCiAgICAgKiBAcGFyYW0ge0Vycm9yfSBlcnJvciAtIFRoZSBlcnJvciB3aGljaCBvY2N1cnJlZCBkdXJpbmcgdGhlIGxvYWRpbmcgcHJvY2Vzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbWF0ZXJpYWwgbmFtZSB0aGF0IGlzIHVzZWQgYnkgbG9hZGVycwogICAgICogd2hlbiBjcmVhdGluZyBtYXRlcmlhbHMgZm9yIGxvYWRlZCAzRCBvYmplY3RzLgogICAgICoKICAgICAqIE5vdGU6IE5vdCBhbGwgbG9hZGVycyBtaWdodCBob25vciB0aGlzIHNldHRpbmcuCiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQHR5cGUge3N0cmluZ30KICAgICAqIEBkZWZhdWx0ICdfX0RFRkFVTFQnCiAgICAgKi8KICAgIExvYWRlci5ERUZBVUxUX01BVEVSSUFMX05BTUUgPSAnX19ERUZBVUxUJzsKCiAgICBjb25zdCBfbG9hZGluZyA9IG5ldyBXZWFrTWFwKCk7CgogICAgLyoqCiAgICAgKiBBIGxvYWRlciBmb3IgbG9hZGluZyBpbWFnZXMuIFRoZSBjbGFzcyBsb2FkcyBpbWFnZXMgd2l0aCB0aGUgSFRNTCBgSW1hZ2VgIEFQSS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLkltYWdlTG9hZGVyKCk7CiAgICAgKiBjb25zdCBpbWFnZSA9IGF3YWl0IGxvYWRlci5sb2FkQXN5bmMoICdpbWFnZS5wbmcnICk7CiAgICAgKiBgYGAKICAgICAqIFBsZWFzZSBub3RlIHRoYXQgYEltYWdlTG9hZGVyYCBoYXMgZHJvcHBlZCBzdXBwb3J0IGZvciBwcm9ncmVzcwogICAgICogZXZlbnRzIGluIGByODRgLiBGb3IgYW4gYEltYWdlTG9hZGVyYCB0aGF0IHN1cHBvcnRzIHByb2dyZXNzIGV2ZW50cywgc2VlCiAgICAgKiBbdGhpcyB0aHJlYWRde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvaXNzdWVzLzEwNDM5I2lzc3VlY29tbWVudC0yNzU3ODU2Mzl9LgogICAgICoKICAgICAqIEBhdWdtZW50cyBMb2FkZXIKICAgICAqLwogICAgY2xhc3MgSW1hZ2VMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IGltYWdlIGxvYWRlci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7TG9hZGluZ01hbmFnZXJ9IFttYW5hZ2VyXSAtIFRoZSBsb2FkaW5nIG1hbmFnZXIuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgogICAgCQlzdXBlciggbWFuYWdlciApOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFN0YXJ0cyBsb2FkaW5nIGZyb20gdGhlIGdpdmVuIFVSTCBhbmQgcGFzc2VzIHRoZSBsb2FkZWQgaW1hZ2UKICAgIAkgKiB0byB0aGUgYG9uTG9hZCgpYCBjYWxsYmFjay4gVGhlIG1ldGhvZCBhbHNvIHJldHVybnMgYSBuZXcgYEltYWdlYCBvYmplY3Qgd2hpY2ggY2FuCiAgICAJICogZGlyZWN0bHkgYmUgdXNlZCBmb3IgdGV4dHVyZSBjcmVhdGlvbi4gSWYgeW91IGRvIGl0IHRoaXMgd2F5LCB0aGUgdGV4dHVyZQogICAgCSAqIG1heSBwb3AgdXAgaW4geW91ciBzY2VuZSBvbmNlIHRoZSByZXNwZWN0aXZlIGxvYWRpbmcgcHJvY2VzcyBpcyBmaW5pc2hlZC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLiBUaGlzIGNhbiBhbHNvIGJlIGEgZGF0YSBVUkkuCiAgICAJICogQHBhcmFtIHtmdW5jdGlvbihJbWFnZSl9IG9uTG9hZCAtIEV4ZWN1dGVkIHdoZW4gdGhlIGxvYWRpbmcgcHJvY2VzcyBoYXMgYmVlbiBmaW5pc2hlZC4KICAgIAkgKiBAcGFyYW0ge29uUHJvZ3Jlc3NDYWxsYmFja30gb25Qcm9ncmVzcyAtIFVuc3VwcG9ydGVkIGluIHRoaXMgbG9hZGVyLgogICAgCSAqIEBwYXJhbSB7b25FcnJvckNhbGxiYWNrfSBvbkVycm9yIC0gRXhlY3V0ZWQgd2hlbiBlcnJvcnMgb2NjdXIuCiAgICAJICogQHJldHVybiB7SW1hZ2V9IFRoZSBpbWFnZS4KICAgIAkgKi8KICAgIAlsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCiAgICAJCWlmICggdGhpcy5wYXRoICE9PSB1bmRlZmluZWQgKSB1cmwgPSB0aGlzLnBhdGggKyB1cmw7CgogICAgCQl1cmwgPSB0aGlzLm1hbmFnZXIucmVzb2x2ZVVSTCggdXJsICk7CgogICAgCQljb25zdCBzY29wZSA9IHRoaXM7CgogICAgCQljb25zdCBjYWNoZWQgPSBDYWNoZS5nZXQoIGBpbWFnZToke3VybH1gICk7CgogICAgCQlpZiAoIGNhY2hlZCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWlmICggY2FjaGVkLmNvbXBsZXRlID09PSB0cnVlICkgewoKICAgIAkJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgogICAgCQkJCXNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCBjYWNoZWQgKTsKCiAgICAJCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgogICAgCQkJCX0sIDAgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlsZXQgYXJyID0gX2xvYWRpbmcuZ2V0KCBjYWNoZWQgKTsKCiAgICAJCQkJaWYgKCBhcnIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCWFyciA9IFtdOwogICAgCQkJCQlfbG9hZGluZy5zZXQoIGNhY2hlZCwgYXJyICk7CgogICAgCQkJCX0KCiAgICAJCQkJYXJyLnB1c2goIHsgb25Mb2FkLCBvbkVycm9yIH0gKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGNhY2hlZDsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGltYWdlID0gY3JlYXRlRWxlbWVudE5TKCAnaW1nJyApOwoKICAgIAkJZnVuY3Rpb24gb25JbWFnZUxvYWQoKSB7CgogICAgCQkJcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKCiAgICAJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggdGhpcyApOwoKICAgIAkJCS8vCgogICAgCQkJY29uc3QgY2FsbGJhY2tzID0gX2xvYWRpbmcuZ2V0KCB0aGlzICkgfHwgW107CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgY2FsbGJhY2sgPSBjYWxsYmFja3NbIGkgXTsKICAgIAkJCQlpZiAoIGNhbGxiYWNrLm9uTG9hZCApIGNhbGxiYWNrLm9uTG9hZCggdGhpcyApOwoKICAgIAkJCX0KCiAgICAJCQlfbG9hZGluZy5kZWxldGUoIHRoaXMgKTsKCiAgICAJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gb25JbWFnZUVycm9yKCBldmVudCApIHsKCiAgICAJCQlyZW1vdmVFdmVudExpc3RlbmVycygpOwoKICAgIAkJCWlmICggb25FcnJvciApIG9uRXJyb3IoIGV2ZW50ICk7CgogICAgCQkJQ2FjaGUucmVtb3ZlKCBgaW1hZ2U6JHt1cmx9YCApOwoKICAgIAkJCS8vCgogICAgCQkJY29uc3QgY2FsbGJhY2tzID0gX2xvYWRpbmcuZ2V0KCB0aGlzICkgfHwgW107CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgY2FsbGJhY2sgPSBjYWxsYmFja3NbIGkgXTsKICAgIAkJCQlpZiAoIGNhbGxiYWNrLm9uRXJyb3IgKSBjYWxsYmFjay5vbkVycm9yKCBldmVudCApOwoKICAgIAkJCX0KCiAgICAJCQlfbG9hZGluZy5kZWxldGUoIHRoaXMgKTsKCgogICAgCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwogICAgCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkgewoKICAgIAkJCWltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdsb2FkJywgb25JbWFnZUxvYWQsIGZhbHNlICk7CiAgICAJCQlpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCBvbkltYWdlRXJyb3IsIGZhbHNlICk7CgogICAgCQl9CgogICAgCQlpbWFnZS5hZGRFdmVudExpc3RlbmVyKCAnbG9hZCcsIG9uSW1hZ2VMb2FkLCBmYWxzZSApOwogICAgCQlpbWFnZS5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCBvbkltYWdlRXJyb3IsIGZhbHNlICk7CgogICAgCQlpZiAoIHVybC5zbGljZSggMCwgNSApICE9PSAnZGF0YTonICkgewoKICAgIAkJCWlmICggdGhpcy5jcm9zc09yaWdpbiAhPT0gdW5kZWZpbmVkICkgaW1hZ2UuY3Jvc3NPcmlnaW4gPSB0aGlzLmNyb3NzT3JpZ2luOwoKICAgIAkJfQoKICAgIAkJQ2FjaGUuYWRkKCBgaW1hZ2U6JHt1cmx9YCwgaW1hZ2UgKTsKICAgIAkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKICAgIAkJaW1hZ2Uuc3JjID0gdXJsOwoKICAgIAkJcmV0dXJuIGltYWdlOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQ2xhc3MgZm9yIGxvYWRpbmcgdGV4dHVyZXMuIEltYWdlcyBhcmUgaW50ZXJuYWxseQogICAgICogbG9hZGVkIHZpYSB7QGxpbmsgSW1hZ2VMb2FkZXJ9LgogICAgICoKICAgICAqIGBgYGpzCiAgICAgKiBjb25zdCBsb2FkZXIgPSBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpOwogICAgICogY29uc3QgdGV4dHVyZSA9IGF3YWl0IGxvYWRlci5sb2FkQXN5bmMoICd0ZXh0dXJlcy9sYW5kX29jZWFuX2ljZV9jbG91ZF8yMDQ4LmpwZycgKTsKICAgICAqCiAgICAgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBtYXA6dGV4dHVyZSB9ICk7CiAgICAgKiBgYGAKICAgICAqIFBsZWFzZSBub3RlIHRoYXQgYFRleHR1cmVMb2FkZXJgIGhhcyBkcm9wcGVkIHN1cHBvcnQgZm9yIHByb2dyZXNzCiAgICAgKiBldmVudHMgaW4gYHI4NGAuIEZvciBhIGBUZXh0dXJlTG9hZGVyYCB0aGF0IHN1cHBvcnRzIHByb2dyZXNzIGV2ZW50cywgc2VlCiAgICAgKiBbdGhpcyB0aHJlYWRde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvaXNzdWVzLzEwNDM5I2lzc3VlY29tbWVudC0yOTMyNjAxNDV9LgogICAgICoKICAgICAqIEBhdWdtZW50cyBMb2FkZXIKICAgICAqLwogICAgY2xhc3MgVGV4dHVyZUxvYWRlciBleHRlbmRzIExvYWRlciB7CgogICAgCS8qKgogICAgCSAqIENvbnN0cnVjdHMgYSBuZXcgdGV4dHVyZSBsb2FkZXIuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0xvYWRpbmdNYW5hZ2VyfSBbbWFuYWdlcl0gLSBUaGUgbG9hZGluZyBtYW5hZ2VyLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKICAgIAkJc3VwZXIoIG1hbmFnZXIgKTsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBTdGFydHMgbG9hZGluZyBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIHBhc3MgdGhlIGZ1bGx5IGxvYWRlZCB0ZXh0dXJlCiAgICAJICogdG8gdGhlIGBvbkxvYWQoKWAgY2FsbGJhY2suIFRoZSBtZXRob2QgYWxzbyByZXR1cm5zIGEgbmV3IHRleHR1cmUgb2JqZWN0IHdoaWNoIGNhbgogICAgCSAqIGRpcmVjdGx5IGJlIHVzZWQgZm9yIG1hdGVyaWFsIGNyZWF0aW9uLiBJZiB5b3UgZG8gaXQgdGhpcyB3YXksIHRoZSB0ZXh0dXJlCiAgICAJICogbWF5IHBvcCB1cCBpbiB5b3VyIHNjZW5lIG9uY2UgdGhlIHJlc3BlY3RpdmUgbG9hZGluZyBwcm9jZXNzIGlzIGZpbmlzaGVkLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBwYXRoL1VSTCBvZiB0aGUgZmlsZSB0byBiZSBsb2FkZWQuIFRoaXMgY2FuIGFsc28gYmUgYSBkYXRhIFVSSS4KICAgIAkgKiBAcGFyYW0ge2Z1bmN0aW9uKFRleHR1cmUpfSBvbkxvYWQgLSBFeGVjdXRlZCB3aGVuIHRoZSBsb2FkaW5nIHByb2Nlc3MgaGFzIGJlZW4gZmluaXNoZWQuCiAgICAJICogQHBhcmFtIHtvblByb2dyZXNzQ2FsbGJhY2t9IG9uUHJvZ3Jlc3MgLSBVbnN1cHBvcnRlZCBpbiB0aGlzIGxvYWRlci4KICAgIAkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gb25FcnJvciAtIEV4ZWN1dGVkIHdoZW4gZXJyb3JzIG9jY3VyLgogICAgCSAqIEByZXR1cm4ge1RleHR1cmV9IFRoZSB0ZXh0dXJlLgogICAgCSAqLwogICAgCWxvYWQoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKICAgIAkJY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKCk7CgogICAgCQljb25zdCBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIHRoaXMubWFuYWdlciApOwogICAgCQlsb2FkZXIuc2V0Q3Jvc3NPcmlnaW4oIHRoaXMuY3Jvc3NPcmlnaW4gKTsKICAgIAkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoKICAgIAkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBpbWFnZSApIHsKCiAgICAJCQl0ZXh0dXJlLmltYWdlID0gaW1hZ2U7CiAgICAJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQlpZiAoIG9uTG9hZCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlvbkxvYWQoIHRleHR1cmUgKTsKCiAgICAJCQl9CgogICAgCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgogICAgCQlyZXR1cm4gdGV4dHVyZTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIENhbWVyYSB0aGF0IHVzZXMgW29ydGhvZ3JhcGhpYyBwcm9qZWN0aW9uXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9PcnRob2dyYXBoaWNfcHJvamVjdGlvbn0uCiAgICAgKgogICAgICogSW4gdGhpcyBwcm9qZWN0aW9uIG1vZGUsIGFuIG9iamVjdCdzIHNpemUgaW4gdGhlIHJlbmRlcmVkIGltYWdlIHN0YXlzCiAgICAgKiBjb25zdGFudCByZWdhcmRsZXNzIG9mIGl0cyBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEuIFRoaXMgY2FuIGJlIHVzZWZ1bAogICAgICogZm9yIHJlbmRlcmluZyAyRCBzY2VuZXMgYW5kIFVJIGVsZW1lbnRzLCBhbW9uZ3N0IG90aGVyIHRoaW5ncy4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogY29uc3QgY2FtZXJhID0gbmV3IFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYSggd2lkdGggLyAtIDIsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgaGVpZ2h0IC8gLSAyLCAxLCAxMDAwICk7CiAgICAgKiBzY2VuZS5hZGQoIGNhbWVyYSApOwogICAgICogYGBgCiAgICAgKgogICAgICogQGF1Z21lbnRzIENhbWVyYQogICAgICovCiAgICBjbGFzcyBPcnRob2dyYXBoaWNDYW1lcmEgZXh0ZW5kcyBDYW1lcmEgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IG9ydGhvZ3JhcGhpYyBjYW1lcmEuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW2xlZnQ9LTFdIC0gVGhlIGxlZnQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtyaWdodD0xXSAtIFRoZSByaWdodCBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW3RvcD0xXSAtIFRoZSB0b3AgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtib3R0b209LTFdIC0gVGhlIGJvdHRvbSBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gW25lYXI9MC4xXSAtIFRoZSBjYW1lcmEncyBuZWFyIHBsYW5lLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbZmFyPTIwMDBdIC0gVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggbGVmdCA9IC0xLCByaWdodCA9IDEsIHRvcCA9IDEsIGJvdHRvbSA9IC0xLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzT3J0aG9ncmFwaGljQ2FtZXJhID0gdHJ1ZTsKCiAgICAJCXRoaXMudHlwZSA9ICdPcnRob2dyYXBoaWNDYW1lcmEnOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSB6b29tIGZhY3RvciBvZiB0aGUgY2FtZXJhLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnpvb20gPSAxOwoKICAgIAkJLyoqCiAgICAJCSAqIFJlcHJlc2VudHMgdGhlIGZydXN0dW0gd2luZG93IHNwZWNpZmljYXRpb24uIFRoaXMgcHJvcGVydHkgc2hvdWxkIG5vdCBiZSBlZGl0ZWQKICAgIAkJICogZGlyZWN0bHkgYnV0IHZpYSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0gYW5kIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNjbGVhclZpZXdPZmZzZXR9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P09iamVjdH0KICAgIAkJICogQGRlZmF1bHQgbnVsbAogICAgCQkgKi8KICAgIAkJdGhpcy52aWV3ID0gbnVsbDsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgbGVmdCBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgLTEKICAgIAkJICovCiAgICAJCXRoaXMubGVmdCA9IGxlZnQ7CgogICAgCQkvKioKICAgIAkJICogVGhlIHJpZ2h0IHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAxCiAgICAJCSAqLwogICAgCQl0aGlzLnJpZ2h0ID0gcmlnaHQ7CgogICAgCQkvKioKICAgIAkJICogVGhlIHRvcCBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgMQogICAgCQkgKi8KICAgIAkJdGhpcy50b3AgPSB0b3A7CgogICAgCQkvKioKICAgIAkJICogVGhlIGJvdHRvbSBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge251bWJlcn0KICAgIAkJICogQGRlZmF1bHQgLTEKICAgIAkJICovCiAgICAJCXRoaXMuYm90dG9tID0gYm90dG9tOwoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBjYW1lcmEncyBuZWFyIHBsYW5lLiBUaGUgdmFsaWQgcmFuZ2UgaXMgZ3JlYXRlciB0aGFuIGAwYAogICAgCQkgKiBhbmQgbGVzcyB0aGFuIHRoZSBjdXJyZW50IHZhbHVlIG9mIHtAbGluayBPcnRob2dyYXBoaWNDYW1lcmEjZmFyfS4KICAgIAkJICoKICAgIAkJICogTm90ZSB0aGF0LCB1bmxpa2UgZm9yIHRoZSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmF9LCBgMGAgaXMgYQogICAgCQkgKiB2YWxpZCB2YWx1ZSBmb3IgYW4gb3J0aG9ncmFwaGljIGNhbWVyYSdzIG5lYXIgcGxhbmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDAuMQogICAgCQkgKi8KICAgIAkJdGhpcy5uZWFyID0gbmVhcjsKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgY2FtZXJhJ3MgZmFyIHBsYW5lLiBNdXN0IGJlIGdyZWF0ZXIgdGhhbiB0aGUKICAgIAkJICogY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhI25lYXJ9LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKiBAZGVmYXVsdCAyMDAwCiAgICAJCSAqLwogICAgCQl0aGlzLmZhciA9IGZhcjsKCiAgICAJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAl9CgogICAgCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKICAgIAkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCiAgICAJCXRoaXMubGVmdCA9IHNvdXJjZS5sZWZ0OwogICAgCQl0aGlzLnJpZ2h0ID0gc291cmNlLnJpZ2h0OwogICAgCQl0aGlzLnRvcCA9IHNvdXJjZS50b3A7CiAgICAJCXRoaXMuYm90dG9tID0gc291cmNlLmJvdHRvbTsKICAgIAkJdGhpcy5uZWFyID0gc291cmNlLm5lYXI7CiAgICAJCXRoaXMuZmFyID0gc291cmNlLmZhcjsKCiAgICAJCXRoaXMuem9vbSA9IHNvdXJjZS56b29tOwogICAgCQl0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnZpZXcgKTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFNldHMgYW4gb2Zmc2V0IGluIGEgbGFyZ2VyIGZydXN0dW0uIFRoaXMgaXMgdXNlZnVsIGZvciBtdWx0aS13aW5kb3cgb3IKICAgIAkgKiBtdWx0aS1tb25pdG9yL211bHRpLW1hY2hpbmUgc2V0dXBzLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxXaWR0aCAtIFRoZSBmdWxsIHdpZHRoIG9mIG11bHRpdmlldyBzZXR1cC4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gZnVsbEhlaWdodCAtIFRoZSBmdWxsIGhlaWdodCBvZiBtdWx0aXZpZXcgc2V0dXAuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgaG9yaXpvbnRhbCBvZmZzZXQgb2YgdGhlIHN1YmNhbWVyYS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2ZXJ0aWNhbCBvZmZzZXQgb2YgdGhlIHN1YmNhbWVyYS4KICAgIAkgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2Ygc3ViY2FtZXJhLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHN1YmNhbWVyYS4KICAgIAkgKiBAc2VlIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNzZXRWaWV3T2Zmc2V0fQogICAgCSAqLwogICAgCXNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCiAgICAJCWlmICggdGhpcy52aWV3ID09PSBudWxsICkgewoKICAgIAkJCXRoaXMudmlldyA9IHsKICAgIAkJCQllbmFibGVkOiB0cnVlLAogICAgCQkJCWZ1bGxXaWR0aDogMSwKICAgIAkJCQlmdWxsSGVpZ2h0OiAxLAogICAgCQkJCW9mZnNldFg6IDAsCiAgICAJCQkJb2Zmc2V0WTogMCwKICAgIAkJCQl3aWR0aDogMSwKICAgIAkJCQloZWlnaHQ6IDEKICAgIAkJCX07CgogICAgCQl9CgogICAgCQl0aGlzLnZpZXcuZW5hYmxlZCA9IHRydWU7CiAgICAJCXRoaXMudmlldy5mdWxsV2lkdGggPSBmdWxsV2lkdGg7CiAgICAJCXRoaXMudmlldy5mdWxsSGVpZ2h0ID0gZnVsbEhlaWdodDsKICAgIAkJdGhpcy52aWV3Lm9mZnNldFggPSB4OwogICAgCQl0aGlzLnZpZXcub2Zmc2V0WSA9IHk7CiAgICAJCXRoaXMudmlldy53aWR0aCA9IHdpZHRoOwogICAgCQl0aGlzLnZpZXcuaGVpZ2h0ID0gaGVpZ2h0OwoKICAgIAkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUmVtb3ZlcyB0aGUgdmlldyBvZmZzZXQgZnJvbSB0aGUgcHJvamVjdGlvbiBtYXRyaXguCiAgICAJICovCiAgICAJY2xlYXJWaWV3T2Zmc2V0KCkgewoKICAgIAkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSB7CgogICAgCQkJdGhpcy52aWV3LmVuYWJsZWQgPSBmYWxzZTsKCiAgICAJCX0KCiAgICAJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFVwZGF0ZXMgdGhlIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cml4LiBNdXN0IGJlIGNhbGxlZCBhZnRlciBhbnkgY2hhbmdlIG9mCiAgICAJICogY2FtZXJhIHByb3BlcnRpZXMuCiAgICAJICovCiAgICAJdXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpIHsKCiAgICAJCWNvbnN0IGR4ID0gKCB0aGlzLnJpZ2h0IC0gdGhpcy5sZWZ0ICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKICAgIAkJY29uc3QgZHkgPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvICggMiAqIHRoaXMuem9vbSApOwogICAgCQljb25zdCBjeCA9ICggdGhpcy5yaWdodCArIHRoaXMubGVmdCApIC8gMjsKICAgIAkJY29uc3QgY3kgPSAoIHRoaXMudG9wICsgdGhpcy5ib3R0b20gKSAvIDI7CgogICAgCQlsZXQgbGVmdCA9IGN4IC0gZHg7CiAgICAJCWxldCByaWdodCA9IGN4ICsgZHg7CiAgICAJCWxldCB0b3AgPSBjeSArIGR5OwogICAgCQlsZXQgYm90dG9tID0gY3kgLSBkeTsKCiAgICAJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICYmIHRoaXMudmlldy5lbmFibGVkICkgewoKICAgIAkJCWNvbnN0IHNjYWxlVyA9ICggdGhpcy5yaWdodCAtIHRoaXMubGVmdCApIC8gdGhpcy52aWV3LmZ1bGxXaWR0aCAvIHRoaXMuem9vbTsKICAgIAkJCWNvbnN0IHNjYWxlSCA9ICggdGhpcy50b3AgLSB0aGlzLmJvdHRvbSApIC8gdGhpcy52aWV3LmZ1bGxIZWlnaHQgLyB0aGlzLnpvb207CgogICAgCQkJbGVmdCArPSBzY2FsZVcgKiB0aGlzLnZpZXcub2Zmc2V0WDsKICAgIAkJCXJpZ2h0ID0gbGVmdCArIHNjYWxlVyAqIHRoaXMudmlldy53aWR0aDsKICAgIAkJCXRvcCAtPSBzY2FsZUggKiB0aGlzLnZpZXcub2Zmc2V0WTsKICAgIAkJCWJvdHRvbSA9IHRvcCAtIHNjYWxlSCAqIHRoaXMudmlldy5oZWlnaHQ7CgogICAgCQl9CgogICAgCQl0aGlzLnByb2plY3Rpb25NYXRyaXgubWFrZU9ydGhvZ3JhcGhpYyggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCB0aGlzLm5lYXIsIHRoaXMuZmFyLCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gKTsKCiAgICAJCXRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggdGhpcy5wcm9qZWN0aW9uTWF0cml4ICkuaW52ZXJ0KCk7CgogICAgCX0KCiAgICAJdG9KU09OKCBtZXRhICkgewoKICAgIAkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKICAgIAkJZGF0YS5vYmplY3Quem9vbSA9IHRoaXMuem9vbTsKICAgIAkJZGF0YS5vYmplY3QubGVmdCA9IHRoaXMubGVmdDsKICAgIAkJZGF0YS5vYmplY3QucmlnaHQgPSB0aGlzLnJpZ2h0OwogICAgCQlkYXRhLm9iamVjdC50b3AgPSB0aGlzLnRvcDsKICAgIAkJZGF0YS5vYmplY3QuYm90dG9tID0gdGhpcy5ib3R0b207CiAgICAJCWRhdGEub2JqZWN0Lm5lYXIgPSB0aGlzLm5lYXI7CiAgICAJCWRhdGEub2JqZWN0LmZhciA9IHRoaXMuZmFyOwoKICAgIAkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSBkYXRhLm9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIHRoaXMudmlldyApOwoKICAgIAkJcmV0dXJuIGRhdGE7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIHR5cGUgb2YgY2FtZXJhIGNhbiBiZSB1c2VkIGluIG9yZGVyIHRvIGVmZmljaWVudGx5IHJlbmRlciBhIHNjZW5lIHdpdGggYQogICAgICogcHJlZGVmaW5lZCBzZXQgb2YgY2FtZXJhcy4gVGhpcyBpcyBhbiBpbXBvcnRhbnQgcGVyZm9ybWFuY2UgYXNwZWN0IGZvcgogICAgICogcmVuZGVyaW5nIFZSIHNjZW5lcy4KICAgICAqCiAgICAgKiBBbiBpbnN0YW5jZSBvZiBgQXJyYXlDYW1lcmFgIGFsd2F5cyBoYXMgYW4gYXJyYXkgb2Ygc3ViIGNhbWVyYXMuIEl0J3MgbWFuZGF0b3J5CiAgICAgKiB0byBkZWZpbmUgZm9yIGVhY2ggc3ViIGNhbWVyYSB0aGUgYHZpZXdwb3J0YCBwcm9wZXJ0eSB3aGljaCBkZXRlcm1pbmVzIHRoZQogICAgICogcGFydCBvZiB0aGUgdmlld3BvcnQgdGhhdCBpcyByZW5kZXJlZCB3aXRoIHRoaXMgY2FtZXJhLgogICAgICoKICAgICAqIEBhdWdtZW50cyBQZXJzcGVjdGl2ZUNhbWVyYQogICAgICovCiAgICBjbGFzcyBBcnJheUNhbWVyYSBleHRlbmRzIFBlcnNwZWN0aXZlQ2FtZXJhIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBhcnJheSBjYW1lcmEuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge0FycmF5PFBlcnNwZWN0aXZlQ2FtZXJhPn0gW2FycmF5PVtdXSAtIEFuIGFycmF5IG9mIHBlcnNwZWN0aXZlIHN1YiBjYW1lcmFzLgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCBhcnJheSA9IFtdICkgewoKICAgIAkJc3VwZXIoKTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEByZWFkb25seQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzQXJyYXlDYW1lcmEgPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgdGhpcyBjYW1lcmEgaXMgdXNlZCB3aXRoIG11bHRpdmlldyByZW5kZXJpbmcgb3Igbm90LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQHJlYWRvbmx5CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmlzTXVsdGlWaWV3Q2FtZXJhID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogQW4gYXJyYXkgb2YgcGVyc3BlY3RpdmUgc3ViIGNhbWVyYXMuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtBcnJheTxQZXJzcGVjdGl2ZUNhbWVyYT59CiAgICAJCSAqLwogICAgCQl0aGlzLmNhbWVyYXMgPSBhcnJheTsKCiAgICAJfQoKICAgIH0KCiAgICAvKioKICAgICAqIERldGVybWluZXMgaG93IG1hbnkgYnl0ZXMgbXVzdCBiZSB1c2VkIHRvIHJlcHJlc2VudCB0aGUgdGV4dHVyZS4KICAgICAqCiAgICAgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHRleHR1cmUuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBmb3JtYXQgLSBUaGUgdGV4dHVyZSdzIGZvcm1hdC4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0eXBlIC0gVGhlIHRleHR1cmUncyB0eXBlLgogICAgICogQHJldHVybiB7bnVtYmVyfSBUaGUgYnl0ZSBsZW5ndGguCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldEJ5dGVMZW5ndGgoIHdpZHRoLCBoZWlnaHQsIGZvcm1hdCwgdHlwZSApIHsKCiAgICAJY29uc3QgdHlwZUJ5dGVMZW5ndGggPSBnZXRUZXh0dXJlVHlwZUJ5dGVMZW5ndGgoIHR5cGUgKTsKCiAgICAJc3dpdGNoICggZm9ybWF0ICkgewoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy9PcGVuR0wtUmVmcGFnZXMvZXMzLjAvaHRtbC9nbFRleEltYWdlMkQueGh0bWwKICAgIAkJY2FzZSBBbHBoYUZvcm1hdDoKICAgIAkJCXJldHVybiB3aWR0aCAqIGhlaWdodDsKICAgIAkJY2FzZSBSZWRGb3JtYXQ6CiAgICAJCQlyZXR1cm4gKCAoIHdpZHRoICogaGVpZ2h0ICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwogICAgCQljYXNlIFJlZEludGVnZXJGb3JtYXQ6CiAgICAJCQlyZXR1cm4gKCAoIHdpZHRoICogaGVpZ2h0ICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwogICAgCQljYXNlIFJHRm9ybWF0OgogICAgCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCAqIDIgKSAvIHR5cGVCeXRlTGVuZ3RoLmNvbXBvbmVudHMgKSAqIHR5cGVCeXRlTGVuZ3RoLmJ5dGVMZW5ndGg7CiAgICAJCWNhc2UgUkdJbnRlZ2VyRm9ybWF0OgogICAgCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCAqIDIgKSAvIHR5cGVCeXRlTGVuZ3RoLmNvbXBvbmVudHMgKSAqIHR5cGVCeXRlTGVuZ3RoLmJ5dGVMZW5ndGg7CiAgICAJCWNhc2UgUkdCRm9ybWF0OgogICAgCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCAqIDMgKSAvIHR5cGVCeXRlTGVuZ3RoLmNvbXBvbmVudHMgKSAqIHR5cGVCeXRlTGVuZ3RoLmJ5dGVMZW5ndGg7CiAgICAJCWNhc2UgUkdCQUZvcm1hdDoKICAgIAkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiA0ICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwogICAgCQljYXNlIFJHQkFJbnRlZ2VyRm9ybWF0OgogICAgCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCAqIDQgKSAvIHR5cGVCeXRlTGVuZ3RoLmNvbXBvbmVudHMgKSAqIHR5cGVCeXRlTGVuZ3RoLmJ5dGVMZW5ndGg7CgogICAgCQkvLyBodHRwczovL3JlZ2lzdHJ5Lmtocm9ub3Mub3JnL3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGNfc3JnYi8KICAgIAkJY2FzZSBSR0JfUzNUQ19EWFQxX0Zvcm1hdDoKICAgIAkJY2FzZSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDMgKSAvIDQgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgMyApIC8gNCApICogODsKICAgIAkJY2FzZSBSR0JBX1MzVENfRFhUM19Gb3JtYXQ6CiAgICAJCWNhc2UgUkdCQV9TM1RDX0RYVDVfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0Yy8KICAgIAkJY2FzZSBSR0JfUFZSVENfMkJQUFYxX0Zvcm1hdDoKICAgIAkJY2FzZSBSR0JBX1BWUlRDXzJCUFBWMV9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gKCBNYXRoLm1heCggd2lkdGgsIDE2ICkgKiBNYXRoLm1heCggaGVpZ2h0LCA4ICkgKSAvIDQ7CiAgICAJCWNhc2UgUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQ6CiAgICAJCWNhc2UgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0OgogICAgCQkJcmV0dXJuICggTWF0aC5tYXgoIHdpZHRoLCA4ICkgKiBNYXRoLm1heCggaGVpZ2h0LCA4ICkgKSAvIDI7CgogICAgCQkvLyBodHRwczovL3JlZ2lzdHJ5Lmtocm9ub3Mub3JnL3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2V0Yy8KICAgIAkJY2FzZSBSR0JfRVRDMV9Gb3JtYXQ6CiAgICAJCWNhc2UgUkdCX0VUQzJfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDg7CiAgICAJCWNhc2UgUkdCQV9FVEMyX0VBQ19Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDMgKSAvIDQgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgMyApIC8gNCApICogMTY7CgogICAgCQkvLyBodHRwczovL3JlZ2lzdHJ5Lmtocm9ub3Mub3JnL3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2FzdGMvCiAgICAJCWNhc2UgUkdCQV9BU1RDXzR4NF9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDMgKSAvIDQgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgMyApIC8gNCApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzV4NF9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDQgKSAvIDUgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgMyApIC8gNCApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzV4NV9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDQgKSAvIDUgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNCApIC8gNSApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzZ4NV9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDUgKSAvIDYgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNCApIC8gNSApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDUgKSAvIDYgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNSApIC8gNiApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzh4NV9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDcgKSAvIDggKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNCApIC8gNSApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzh4Nl9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDcgKSAvIDggKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNSApIC8gNiApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzh4OF9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDcgKSAvIDggKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNyApIC8gOCApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzEweDVfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA5ICkgLyAxMCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyA0ICkgLyA1ICkgKiAxNjsKICAgIAkJY2FzZSBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ18xMHg4X0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgOSApIC8gMTAgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNyApIC8gOCApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzEweDEwX0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgOSApIC8gMTAgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgOSApIC8gMTAgKSAqIDE2OwogICAgCQljYXNlIFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDExICkgLyAxMiApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyA5ICkgLyAxMCApICogMTY7CiAgICAJCWNhc2UgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMTEgKSAvIDEyICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDExICkgLyAxMiApICogMTY7CgogICAgCQkvLyBodHRwczovL3JlZ2lzdHJ5Lmtocm9ub3Mub3JnL3dlYmdsL2V4dGVuc2lvbnMvRVhUX3RleHR1cmVfY29tcHJlc3Npb25fYnB0Yy8KICAgIAkJY2FzZSBSR0JBX0JQVENfRm9ybWF0OgogICAgCQljYXNlIFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQ6CiAgICAJCWNhc2UgUkdCX0JQVENfVU5TSUdORURfRm9ybWF0OgogICAgCQkJcmV0dXJuIE1hdGguY2VpbCggd2lkdGggLyA0ICkgKiBNYXRoLmNlaWwoIGhlaWdodCAvIDQgKSAqIDE2OwoKICAgIAkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL0VYVF90ZXh0dXJlX2NvbXByZXNzaW9uX3JndGMvCiAgICAJCWNhc2UgUkVEX1JHVEMxX0Zvcm1hdDoKICAgIAkJY2FzZSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdDoKICAgIAkJCXJldHVybiBNYXRoLmNlaWwoIHdpZHRoIC8gNCApICogTWF0aC5jZWlsKCBoZWlnaHQgLyA0ICkgKiA4OwogICAgCQljYXNlIFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQ6CiAgICAJCWNhc2UgU0lHTkVEX1JFRF9HUkVFTl9SR1RDMl9Gb3JtYXQ6CiAgICAJCQlyZXR1cm4gTWF0aC5jZWlsKCB3aWR0aCAvIDQgKSAqIE1hdGguY2VpbCggaGVpZ2h0IC8gNCApICogMTY7CgogICAgCX0KCiAgICAJdGhyb3cgbmV3IEVycm9yKAogICAgCQlgVW5hYmxlIHRvIGRldGVybWluZSB0ZXh0dXJlIGJ5dGUgbGVuZ3RoIGZvciAke2Zvcm1hdH0gZm9ybWF0LmAsCiAgICAJKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGV4dHVyZVR5cGVCeXRlTGVuZ3RoKCB0eXBlICkgewoKICAgIAlzd2l0Y2ggKCB0eXBlICkgewoKICAgIAkJY2FzZSBVbnNpZ25lZEJ5dGVUeXBlOgogICAgCQljYXNlIEJ5dGVUeXBlOgogICAgCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogMSwgY29tcG9uZW50czogMSB9OwogICAgCQljYXNlIFVuc2lnbmVkU2hvcnRUeXBlOgogICAgCQljYXNlIFNob3J0VHlwZToKICAgIAkJY2FzZSBIYWxmRmxvYXRUeXBlOgogICAgCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogMiwgY29tcG9uZW50czogMSB9OwogICAgCQljYXNlIFVuc2lnbmVkU2hvcnQ0NDQ0VHlwZToKICAgIAkJY2FzZSBVbnNpZ25lZFNob3J0NTU1MVR5cGU6CiAgICAJCQlyZXR1cm4geyBieXRlTGVuZ3RoOiAyLCBjb21wb25lbnRzOiA0IH07CiAgICAJCWNhc2UgVW5zaWduZWRJbnRUeXBlOgogICAgCQljYXNlIEludFR5cGU6CiAgICAJCWNhc2UgRmxvYXRUeXBlOgogICAgCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogNCwgY29tcG9uZW50czogMSB9OwogICAgCQljYXNlIFVuc2lnbmVkSW50NTk5OVR5cGU6CiAgICAJCQlyZXR1cm4geyBieXRlTGVuZ3RoOiA0LCBjb21wb25lbnRzOiAzIH07CgogICAgCX0KCiAgICAJdGhyb3cgbmV3IEVycm9yKCBgVW5rbm93biB0ZXh0dXJlIHR5cGUgJHt0eXBlfS5gICk7CgogICAgfQoKICAgIGlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgogICAgCV9fVEhSRUVfREVWVE9PTFNfXy5kaXNwYXRjaEV2ZW50KCBuZXcgQ3VzdG9tRXZlbnQoICdyZWdpc3RlcicsIHsgZGV0YWlsOiB7CiAgICAJCXJldmlzaW9uOiBSRVZJU0lPTiwKICAgIAl9IH0gKSApOwoKICAgIH0KCiAgICBpZiAoIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICkgewoKICAgIAlpZiAoIHdpbmRvdy5fX1RIUkVFX18gKSB7CgogICAgCQljb25zb2xlLndhcm4oICdXQVJOSU5HOiBNdWx0aXBsZSBpbnN0YW5jZXMgb2YgVGhyZWUuanMgYmVpbmcgaW1wb3J0ZWQuJyApOwoKICAgIAl9IGVsc2UgewoKICAgIAkJd2luZG93Ll9fVEhSRUVfXyA9IFJFVklTSU9OOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogQGxpY2Vuc2UKICAgICAqIENvcHlyaWdodCAyMDEwLTIwMjUgVGhyZWUuanMgQXV0aG9ycwogICAgICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVAogICAgICovCgogICAgZnVuY3Rpb24gV2ViR0xBbmltYXRpb24oKSB7CgogICAgCWxldCBjb250ZXh0ID0gbnVsbDsKICAgIAlsZXQgaXNBbmltYXRpbmcgPSBmYWxzZTsKICAgIAlsZXQgYW5pbWF0aW9uTG9vcCA9IG51bGw7CiAgICAJbGV0IHJlcXVlc3RJZCA9IG51bGw7CgogICAgCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKICAgIAkJYW5pbWF0aW9uTG9vcCggdGltZSwgZnJhbWUgKTsKCiAgICAJCXJlcXVlc3RJZCA9IGNvbnRleHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBvbkFuaW1hdGlvbkZyYW1lICk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCXN0YXJ0OiBmdW5jdGlvbiAoKSB7CgogICAgCQkJaWYgKCBpc0FuaW1hdGluZyA9PT0gdHJ1ZSApIHJldHVybjsKICAgIAkJCWlmICggYW5pbWF0aW9uTG9vcCA9PT0gbnVsbCApIHJldHVybjsKCiAgICAJCQlyZXF1ZXN0SWQgPSBjb250ZXh0LnJlcXVlc3RBbmltYXRpb25GcmFtZSggb25BbmltYXRpb25GcmFtZSApOwoKICAgIAkJCWlzQW5pbWF0aW5nID0gdHJ1ZTsKCiAgICAJCX0sCgogICAgCQlzdG9wOiBmdW5jdGlvbiAoKSB7CgogICAgCQkJY29udGV4dC5jYW5jZWxBbmltYXRpb25GcmFtZSggcmVxdWVzdElkICk7CgogICAgCQkJaXNBbmltYXRpbmcgPSBmYWxzZTsKCiAgICAJCX0sCgogICAgCQlzZXRBbmltYXRpb25Mb29wOiBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKICAgIAkJCWFuaW1hdGlvbkxvb3AgPSBjYWxsYmFjazsKCiAgICAJCX0sCgogICAgCQlzZXRDb250ZXh0OiBmdW5jdGlvbiAoIHZhbHVlICkgewoKICAgIAkJCWNvbnRleHQgPSB2YWx1ZTsKCiAgICAJCX0KCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xBdHRyaWJ1dGVzKCBnbCApIHsKCiAgICAJY29uc3QgYnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCWZ1bmN0aW9uIGNyZWF0ZUJ1ZmZlciggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKICAgIAkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CiAgICAJCWNvbnN0IHVzYWdlID0gYXR0cmlidXRlLnVzYWdlOwogICAgCQljb25zdCBzaXplID0gYXJyYXkuYnl0ZUxlbmd0aDsKCiAgICAJCWNvbnN0IGJ1ZmZlciA9IGdsLmNyZWF0ZUJ1ZmZlcigpOwoKICAgIAkJZ2wuYmluZEJ1ZmZlciggYnVmZmVyVHlwZSwgYnVmZmVyICk7CiAgICAJCWdsLmJ1ZmZlckRhdGEoIGJ1ZmZlclR5cGUsIGFycmF5LCB1c2FnZSApOwoKICAgIAkJYXR0cmlidXRlLm9uVXBsb2FkQ2FsbGJhY2soKTsKCiAgICAJCWxldCB0eXBlOwoKICAgIAkJaWYgKCBhcnJheSBpbnN0YW5jZW9mIEZsb2F0MzJBcnJheSApIHsKCiAgICAJCQl0eXBlID0gZ2wuRkxPQVQ7CgogICAgCQl9IGVsc2UgaWYgKCB0eXBlb2YgRmxvYXQxNkFycmF5ICE9PSAndW5kZWZpbmVkJyAmJiBhcnJheSBpbnN0YW5jZW9mIEZsb2F0MTZBcnJheSApIHsKCiAgICAJCQl0eXBlID0gZ2wuSEFMRl9GTE9BVDsKCiAgICAJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgVWludDE2QXJyYXkgKSB7CgogICAgCQkJaWYgKCBhdHRyaWJ1dGUuaXNGbG9hdDE2QnVmZmVyQXR0cmlidXRlICkgewoKICAgIAkJCQl0eXBlID0gZ2wuSEFMRl9GTE9BVDsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl0eXBlID0gZ2wuVU5TSUdORURfU0hPUlQ7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBJbnQxNkFycmF5ICkgewoKICAgIAkJCXR5cGUgPSBnbC5TSE9SVDsKCiAgICAJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgVWludDMyQXJyYXkgKSB7CgogICAgCQkJdHlwZSA9IGdsLlVOU0lHTkVEX0lOVDsKCiAgICAJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50MzJBcnJheSApIHsKCiAgICAJCQl0eXBlID0gZ2wuSU5UOwoKICAgIAkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBJbnQ4QXJyYXkgKSB7CgogICAgCQkJdHlwZSA9IGdsLkJZVEU7CgogICAgCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgKSB7CgogICAgCQkJdHlwZSA9IGdsLlVOU0lHTkVEX0JZVEU7CgogICAgCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5ICkgewoKICAgIAkJCXR5cGUgPSBnbC5VTlNJR05FRF9CWVRFOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTEF0dHJpYnV0ZXM6IFVuc3VwcG9ydGVkIGJ1ZmZlciBkYXRhIGZvcm1hdDogJyArIGFycmF5ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gewogICAgCQkJYnVmZmVyOiBidWZmZXIsCiAgICAJCQl0eXBlOiB0eXBlLAogICAgCQkJYnl0ZXNQZXJFbGVtZW50OiBhcnJheS5CWVRFU19QRVJfRUxFTUVOVCwKICAgIAkJCXZlcnNpb246IGF0dHJpYnV0ZS52ZXJzaW9uLAogICAgCQkJc2l6ZTogc2l6ZQogICAgCQl9OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlciggYnVmZmVyLCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSB7CgogICAgCQljb25zdCBhcnJheSA9IGF0dHJpYnV0ZS5hcnJheTsKICAgIAkJY29uc3QgdXBkYXRlUmFuZ2VzID0gYXR0cmlidXRlLnVwZGF0ZVJhbmdlczsKCiAgICAJCWdsLmJpbmRCdWZmZXIoIGJ1ZmZlclR5cGUsIGJ1ZmZlciApOwoKICAgIAkJaWYgKCB1cGRhdGVSYW5nZXMubGVuZ3RoID09PSAwICkgewoKICAgIAkJCS8vIE5vdCB1c2luZyB1cGRhdGUgcmFuZ2VzCiAgICAJCQlnbC5idWZmZXJTdWJEYXRhKCBidWZmZXJUeXBlLCAwLCBhcnJheSApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQkvLyBCZWZvcmUgYXBwbHlpbmcgdXBkYXRlIHJhbmdlcywgd2UgbWVyZ2UgYW55IGFkamFjZW50IC8gb3ZlcmxhcHBpbmcKICAgIAkJCS8vIHJhbmdlcyB0byByZWR1Y2UgbG9hZCBvbiBgZ2wuYnVmZmVyU3ViRGF0YWAuIEVtcGlyaWNhbGx5LCB0aGlzIGhhcyBsZWQKICAgIAkJCS8vIHRvIHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cyBmb3IgYXBwbGljYXRpb25zIHdoaWNoIG1ha2UgaGVhdnkgdXNlIG9mCiAgICAJCQkvLyB1cGRhdGUgcmFuZ2VzLiBMaWtlbHkgZHVlIHRvIEdQVSBjb21tYW5kIG92ZXJoZWFkLgogICAgCQkJLy8KICAgIAkJCS8vIE5vdGUgdGhhdCB0byByZWR1Y2UgZ2FyYmFnZSBjb2xsZWN0aW9uIGJldHdlZW4gZnJhbWVzLCB3ZSBtZXJnZSB0aGUKICAgIAkJCS8vIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UuIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHRoaXMgbWV0aG9kIHdpbGwgY2xlYXIgdGhlCiAgICAJCQkvLyB1cGRhdGUgcmFuZ2VzIG9uY2UgdXBkYXRlZC4KCiAgICAJCQl1cGRhdGVSYW5nZXMuc29ydCggKCBhLCBiICkgPT4gYS5zdGFydCAtIGIuc3RhcnQgKTsKCiAgICAJCQkvLyBUbyBtZXJnZSB0aGUgdXBkYXRlIHJhbmdlcyBpbi1wbGFjZSwgd2Ugd29yayBmcm9tIGxlZnQgdG8gcmlnaHQgaW4gdGhlCiAgICAJCQkvLyBleGlzdGluZyB1cGRhdGVSYW5nZXMgYXJyYXksIG1lcmdpbmcgcmFuZ2VzLiBUaGlzIG1heSByZXN1bHQgaW4gYSBmaW5hbAogICAgCQkJLy8gYXJyYXkgd2hpY2ggaXMgc21hbGxlciB0aGFuIHRoZSBvcmlnaW5hbC4gVGhpcyBpbmRleCB0cmFja3MgdGhlIGxhc3QKICAgIAkJCS8vIGluZGV4IHJlcHJlc2VudGluZyBhIG1lcmdlZCByYW5nZSwgYW55IGRhdGEgYWZ0ZXIgdGhpcyBpbmRleCBjYW4gYmUKICAgIAkJCS8vIHRyaW1tZWQgb25jZSB0aGUgbWVyZ2UgYWxnb3JpdGhtIGlzIGNvbXBsZXRlZC4KICAgIAkJCWxldCBtZXJnZUluZGV4ID0gMDsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDE7IGkgPCB1cGRhdGVSYW5nZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQljb25zdCBwcmV2aW91c1JhbmdlID0gdXBkYXRlUmFuZ2VzWyBtZXJnZUluZGV4IF07CiAgICAJCQkJY29uc3QgcmFuZ2UgPSB1cGRhdGVSYW5nZXNbIGkgXTsKCiAgICAJCQkJLy8gV2UgYWRkIG9uZSBoZXJlIHRvIG1lcmdlIGFkamFjZW50IHJhbmdlcy4gVGhpcyBpcyBzYWZlIGJlY2F1c2UgcmFuZ2VzCiAgICAJCQkJLy8gb3BlcmF0ZSBvdmVyIHBvc2l0aXZlIGludGVnZXJzLgogICAgCQkJCWlmICggcmFuZ2Uuc3RhcnQgPD0gcHJldmlvdXNSYW5nZS5zdGFydCArIHByZXZpb3VzUmFuZ2UuY291bnQgKyAxICkgewoKICAgIAkJCQkJcHJldmlvdXNSYW5nZS5jb3VudCA9IE1hdGgubWF4KAogICAgCQkJCQkJcHJldmlvdXNSYW5nZS5jb3VudCwKICAgIAkJCQkJCXJhbmdlLnN0YXJ0ICsgcmFuZ2UuY291bnQgLSBwcmV2aW91c1JhbmdlLnN0YXJ0CiAgICAJCQkJCSk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQkrKyBtZXJnZUluZGV4OwogICAgCQkJCQl1cGRhdGVSYW5nZXNbIG1lcmdlSW5kZXggXSA9IHJhbmdlOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIFRyaW0gdGhlIGFycmF5IHRvIG9ubHkgY29udGFpbiB0aGUgbWVyZ2VkIHJhbmdlcy4KICAgIAkJCXVwZGF0ZVJhbmdlcy5sZW5ndGggPSBtZXJnZUluZGV4ICsgMTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1cGRhdGVSYW5nZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgcmFuZ2UgPSB1cGRhdGVSYW5nZXNbIGkgXTsKCiAgICAJCQkJZ2wuYnVmZmVyU3ViRGF0YSggYnVmZmVyVHlwZSwgcmFuZ2Uuc3RhcnQgKiBhcnJheS5CWVRFU19QRVJfRUxFTUVOVCwKICAgIAkJCQkJYXJyYXksIHJhbmdlLnN0YXJ0LCByYW5nZS5jb3VudCApOwoKICAgIAkJCX0KCiAgICAJCQlhdHRyaWJ1dGUuY2xlYXJVcGRhdGVSYW5nZXMoKTsKCiAgICAJCX0KCiAgICAJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgogICAgCX0KCiAgICAJLy8KCiAgICAJZnVuY3Rpb24gZ2V0KCBhdHRyaWJ1dGUgKSB7CgogICAgCQlpZiAoIGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgYXR0cmlidXRlID0gYXR0cmlidXRlLmRhdGE7CgogICAgCQlyZXR1cm4gYnVmZmVycy5nZXQoIGF0dHJpYnV0ZSApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbW92ZSggYXR0cmlidXRlICkgewoKICAgIAkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwoKICAgIAkJY29uc3QgZGF0YSA9IGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCiAgICAJCWlmICggZGF0YSApIHsKCiAgICAJCQlnbC5kZWxldGVCdWZmZXIoIGRhdGEuYnVmZmVyICk7CgogICAgCQkJYnVmZmVycy5kZWxldGUoIGF0dHJpYnV0ZSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZSggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKICAgIAkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwoKICAgIAkJaWYgKCBhdHRyaWJ1dGUuaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQljb25zdCBjYWNoZWQgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgogICAgCQkJaWYgKCAhIGNhY2hlZCB8fCBjYWNoZWQudmVyc2lvbiA8IGF0dHJpYnV0ZS52ZXJzaW9uICkgewoKICAgIAkJCQlidWZmZXJzLnNldCggYXR0cmlidXRlLCB7CiAgICAJCQkJCWJ1ZmZlcjogYXR0cmlidXRlLmJ1ZmZlciwKICAgIAkJCQkJdHlwZTogYXR0cmlidXRlLnR5cGUsCiAgICAJCQkJCWJ5dGVzUGVyRWxlbWVudDogYXR0cmlidXRlLmVsZW1lbnRTaXplLAogICAgCQkJCQl2ZXJzaW9uOiBhdHRyaWJ1dGUudmVyc2lvbgogICAgCQkJCX0gKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJY29uc3QgZGF0YSA9IGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCiAgICAJCWlmICggZGF0YSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWJ1ZmZlcnMuc2V0KCBhdHRyaWJ1dGUsIGNyZWF0ZUJ1ZmZlciggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgKTsKCiAgICAJCX0gZWxzZSBpZiAoIGRhdGEudmVyc2lvbiA8IGF0dHJpYnV0ZS52ZXJzaW9uICkgewoKICAgIAkJCWlmICggZGF0YS5zaXplICE9PSBhdHRyaWJ1dGUuYXJyYXkuYnl0ZUxlbmd0aCApIHsKCiAgICAJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBUaGUgc2l6ZSBvZiB0aGUgYnVmZmVyIGF0dHJpYnV0ZVwncyBhcnJheSBidWZmZXIgZG9lcyBub3QgbWF0Y2ggdGhlIG9yaWdpbmFsIHNpemUuIFJlc2l6aW5nIGJ1ZmZlciBhdHRyaWJ1dGVzIGlzIG5vdCBzdXBwb3J0ZWQuJyApOwoKICAgIAkJCX0KCiAgICAJCQl1cGRhdGVCdWZmZXIoIGRhdGEuYnVmZmVyLCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKTsKCiAgICAJCQlkYXRhLnZlcnNpb24gPSBhdHRyaWJ1dGUudmVyc2lvbjsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gewoKICAgIAkJZ2V0OiBnZXQsCiAgICAJCXJlbW92ZTogcmVtb3ZlLAogICAgCQl1cGRhdGU6IHVwZGF0ZQoKICAgIAl9OwoKICAgIH0KCiAgICB2YXIgYWxwaGFoYXNoX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdGlmICggZGlmZnVzZUNvbG9yLmEgPCBnZXRBbHBoYUhhc2hUaHJlc2hvbGQoIHZQb3NpdGlvbiApICkgZGlzY2FyZDtcbiNlbmRpZiI7CgogICAgdmFyIGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdGNvbnN0IGZsb2F0IEFMUEhBX0hBU0hfU0NBTEUgPSAwLjA1O1xuXHRmbG9hdCBoYXNoMkQoIHZlYzIgdmFsdWUgKSB7XG5cdFx0cmV0dXJuIGZyYWN0KCAxLjBlNCAqIHNpbiggMTcuMCAqIHZhbHVlLnggKyAwLjEgKiB2YWx1ZS55ICkgKiAoIDAuMSArIGFicyggc2luKCAxMy4wICogdmFsdWUueSArIHZhbHVlLnggKSApICkgKTtcblx0fVxuXHRmbG9hdCBoYXNoM0QoIHZlYzMgdmFsdWUgKSB7XG5cdFx0cmV0dXJuIGhhc2gyRCggdmVjMiggaGFzaDJEKCB2YWx1ZS54eSApLCB2YWx1ZS56ICkgKTtcblx0fVxuXHRmbG9hdCBnZXRBbHBoYUhhc2hUaHJlc2hvbGQoIHZlYzMgcG9zaXRpb24gKSB7XG5cdFx0ZmxvYXQgbWF4RGVyaXYgPSBtYXgoXG5cdFx0XHRsZW5ndGgoIGRGZHgoIHBvc2l0aW9uLnh5eiApICksXG5cdFx0XHRsZW5ndGgoIGRGZHkoIHBvc2l0aW9uLnh5eiApIClcblx0XHQpO1xuXHRcdGZsb2F0IHBpeFNjYWxlID0gMS4wIC8gKCBBTFBIQV9IQVNIX1NDQUxFICogbWF4RGVyaXYgKTtcblx0XHR2ZWMyIHBpeFNjYWxlcyA9IHZlYzIoXG5cdFx0XHRleHAyKCBmbG9vciggbG9nMiggcGl4U2NhbGUgKSApICksXG5cdFx0XHRleHAyKCBjZWlsKCBsb2cyKCBwaXhTY2FsZSApICkgKVxuXHRcdCk7XG5cdFx0dmVjMiBhbHBoYSA9IHZlYzIoXG5cdFx0XHRoYXNoM0QoIGZsb29yKCBwaXhTY2FsZXMueCAqIHBvc2l0aW9uLnh5eiApICksXG5cdFx0XHRoYXNoM0QoIGZsb29yKCBwaXhTY2FsZXMueSAqIHBvc2l0aW9uLnh5eiApIClcblx0XHQpO1xuXHRcdGZsb2F0IGxlcnBGYWN0b3IgPSBmcmFjdCggbG9nMiggcGl4U2NhbGUgKSApO1xuXHRcdGZsb2F0IHggPSAoIDEuMCAtIGxlcnBGYWN0b3IgKSAqIGFscGhhLnggKyBsZXJwRmFjdG9yICogYWxwaGEueTtcblx0XHRmbG9hdCBhID0gbWluKCBsZXJwRmFjdG9yLCAxLjAgLSBsZXJwRmFjdG9yICk7XG5cdFx0dmVjMyBjYXNlcyA9IHZlYzMoXG5cdFx0XHR4ICogeCAvICggMi4wICogYSAqICggMS4wIC0gYSApICksXG5cdFx0XHQoIHggLSAwLjUgKiBhICkgLyAoIDEuMCAtIGEgKSxcblx0XHRcdDEuMCAtICggKCAxLjAgLSB4ICkgKiAoIDEuMCAtIHggKSAvICggMi4wICogYSAqICggMS4wIC0gYSApICkgKVxuXHRcdCk7XG5cdFx0ZmxvYXQgdGhyZXNob2xkID0gKCB4IDwgKCAxLjAgLSBhICkgKVxuXHRcdFx0PyAoICggeCA8IGEgKSA/IGNhc2VzLnggOiBjYXNlcy55IClcblx0XHRcdDogY2FzZXMuejtcblx0XHRyZXR1cm4gY2xhbXAoIHRocmVzaG9sZCAsIDEuMGUtNiwgMS4wICk7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIGFscGhhbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdkFscGhhTWFwVXYgKS5nO1xuI2VuZGlmIjsKCiAgICB2YXIgYWxwaGFtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGFscGhhTWFwO1xuI2VuZGlmIjsKCiAgICB2YXIgYWxwaGF0ZXN0X2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFURVNUXG5cdCNpZmRlZiBBTFBIQV9UT19DT1ZFUkFHRVxuXHRkaWZmdXNlQ29sb3IuYSA9IHNtb290aHN0ZXAoIGFscGhhVGVzdCwgYWxwaGFUZXN0ICsgZndpZHRoKCBkaWZmdXNlQ29sb3IuYSApLCBkaWZmdXNlQ29sb3IuYSApO1xuXHRpZiAoIGRpZmZ1c2VDb2xvci5hID09IDAuMCApIGRpc2NhcmQ7XG5cdCNlbHNlXG5cdGlmICggZGlmZnVzZUNvbG9yLmEgPCBhbHBoYVRlc3QgKSBkaXNjYXJkO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFURVNUXG5cdHVuaWZvcm0gZmxvYXQgYWxwaGFUZXN0O1xuI2VuZGlmIjsKCiAgICB2YXIgYW9tYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHRmbG9hdCBhbWJpZW50T2NjbHVzaW9uID0gKCB0ZXh0dXJlMkQoIGFvTWFwLCB2QW9NYXBVdiApLnIgLSAxLjAgKSAqIGFvTWFwSW50ZW5zaXR5ICsgMS4wO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKj0gYW1iaWVudE9jY2x1c2lvbjtcblx0I2lmIGRlZmluZWQoIFVTRV9DTEVBUkNPQVQgKSBcblx0XHRjbGVhcmNvYXRTcGVjdWxhckluZGlyZWN0ICo9IGFtYmllbnRPY2NsdXNpb247XG5cdCNlbmRpZlxuXHQjaWYgZGVmaW5lZCggVVNFX1NIRUVOICkgXG5cdFx0c2hlZW5TcGVjdWxhckluZGlyZWN0ICo9IGFtYmllbnRPY2NsdXNpb247XG5cdCNlbmRpZlxuXHQjaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFNUQU5EQVJEIClcblx0XHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKj0gY29tcHV0ZVNwZWN1bGFyT2NjbHVzaW9uKCBkb3ROViwgYW1iaWVudE9jY2x1c2lvbiwgbWF0ZXJpYWwucm91Z2huZXNzICk7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgYW9tYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FPTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGFvTWFwO1xuXHR1bmlmb3JtIGZsb2F0IGFvTWFwSW50ZW5zaXR5O1xuI2VuZGlmIjsKCiAgICB2YXIgYmF0Y2hpbmdfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9CQVRDSElOR1xuXHQjaWYgISBkZWZpbmVkKCBHTF9BTkdMRV9tdWx0aV9kcmF3IClcblx0I2RlZmluZSBnbF9EcmF3SUQgX2dsX0RyYXdJRFxuXHR1bmlmb3JtIGludCBfZ2xfRHJhd0lEO1xuXHQjZW5kaWZcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYmF0Y2hpbmdUZXh0dXJlO1xuXHR1bmlmb3JtIGhpZ2hwIHVzYW1wbGVyMkQgYmF0Y2hpbmdJZFRleHR1cmU7XG5cdG1hdDQgZ2V0QmF0Y2hpbmdNYXRyaXgoIGNvbnN0IGluIGZsb2F0IGkgKSB7XG5cdFx0aW50IHNpemUgPSB0ZXh0dXJlU2l6ZSggYmF0Y2hpbmdUZXh0dXJlLCAwICkueDtcblx0XHRpbnQgaiA9IGludCggaSApICogNDtcblx0XHRpbnQgeCA9IGogJSBzaXplO1xuXHRcdGludCB5ID0gaiAvIHNpemU7XG5cdFx0dmVjNCB2MSA9IHRleGVsRmV0Y2goIGJhdGNoaW5nVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjIgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4ICsgMSwgeSApLCAwICk7XG5cdFx0dmVjNCB2MyA9IHRleGVsRmV0Y2goIGJhdGNoaW5nVGV4dHVyZSwgaXZlYzIoIHggKyAyLCB5ICksIDAgKTtcblx0XHR2ZWM0IHY0ID0gdGV4ZWxGZXRjaCggYmF0Y2hpbmdUZXh0dXJlLCBpdmVjMiggeCArIDMsIHkgKSwgMCApO1xuXHRcdHJldHVybiBtYXQ0KCB2MSwgdjIsIHYzLCB2NCApO1xuXHR9XG5cdGZsb2F0IGdldEluZGlyZWN0SW5kZXgoIGNvbnN0IGluIGludCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nSWRUZXh0dXJlLCAwICkueDtcblx0XHRpbnQgeCA9IGkgJSBzaXplO1xuXHRcdGludCB5ID0gaSAvIHNpemU7XG5cdFx0cmV0dXJuIGZsb2F0KCB0ZXhlbEZldGNoKCBiYXRjaGluZ0lkVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApLnIgKTtcblx0fVxuI2VuZGlmXG4jaWZkZWYgVVNFX0JBVENISU5HX0NPTE9SXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGJhdGNoaW5nQ29sb3JUZXh0dXJlO1xuXHR2ZWMzIGdldEJhdGNoaW5nQ29sb3IoIGNvbnN0IGluIGZsb2F0IGkgKSB7XG5cdFx0aW50IHNpemUgPSB0ZXh0dXJlU2l6ZSggYmF0Y2hpbmdDb2xvclRleHR1cmUsIDAgKS54O1xuXHRcdGludCBqID0gaW50KCBpICk7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHJldHVybiB0ZXhlbEZldGNoKCBiYXRjaGluZ0NvbG9yVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApLnJnYjtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgYmF0Y2hpbmdfdmVydGV4ID0gIiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0bWF0NCBiYXRjaGluZ01hdHJpeCA9IGdldEJhdGNoaW5nTWF0cml4KCBnZXRJbmRpcmVjdEluZGV4KCBnbF9EcmF3SUQgKSApO1xuI2VuZGlmIjsKCiAgICB2YXIgYmVnaW5fdmVydGV4ID0gInZlYzMgdHJhbnNmb3JtZWQgPSB2ZWMzKCBwb3NpdGlvbiApO1xuI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0dlBvc2l0aW9uID0gdmVjMyggcG9zaXRpb24gKTtcbiNlbmRpZiI7CgogICAgdmFyIGJlZ2lubm9ybWFsX3ZlcnRleCA9ICJ2ZWMzIG9iamVjdE5vcm1hbCA9IHZlYzMoIG5vcm1hbCApO1xuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHZlYzMgb2JqZWN0VGFuZ2VudCA9IHZlYzMoIHRhbmdlbnQueHl6ICk7XG4jZW5kaWYiOwoKICAgIHZhciBic2RmcyA9ICJmbG9hdCBHX0JsaW5uUGhvbmdfSW1wbGljaXQoICkge1xuXHRyZXR1cm4gMC4yNTtcbn1cbmZsb2F0IERfQmxpbm5QaG9uZyggY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzLCBjb25zdCBpbiBmbG9hdCBkb3ROSCApIHtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiAoIHNoaW5pbmVzcyAqIDAuNSArIDEuMCApICogcG93KCBkb3ROSCwgc2hpbmluZXNzICk7XG59XG52ZWMzIEJSREZfQmxpbm5QaG9uZyggY29uc3QgaW4gdmVjMyBsaWdodERpciwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzaGluaW5lc3MgKSB7XG5cdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0ZmxvYXQgZG90VkggPSBzYXR1cmF0ZSggZG90KCB2aWV3RGlyLCBoYWxmRGlyICkgKTtcblx0dmVjMyBGID0gRl9TY2hsaWNrKCBzcGVjdWxhckNvbG9yLCAxLjAsIGRvdFZIICk7XG5cdGZsb2F0IEcgPSBHX0JsaW5uUGhvbmdfSW1wbGljaXQoICk7XG5cdGZsb2F0IEQgPSBEX0JsaW5uUGhvbmcoIHNoaW5pbmVzcywgZG90TkggKTtcblx0cmV0dXJuIEYgKiAoIEcgKiBEICk7XG59IC8vIHZhbGlkYXRlZCI7CgogICAgdmFyIGlyaWRlc2NlbmNlX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0Y29uc3QgbWF0MyBYWVpfVE9fUkVDNzA5ID0gbWF0Myhcblx0XHQgMy4yNDA0NTQyLCAtMC45NjkyNjYwLCAgMC4wNTU2NDM0LFxuXHRcdC0xLjUzNzEzODUsICAxLjg3NjAxMDgsIC0wLjIwNDAyNTksXG5cdFx0LTAuNDk4NTMxNCwgIDAuMDQxNTU2MCwgIDEuMDU3MjI1MlxuXHQpO1xuXHR2ZWMzIEZyZXNuZWwwVG9Jb3IoIHZlYzMgZnJlc25lbDAgKSB7XG5cdFx0dmVjMyBzcXJ0RjAgPSBzcXJ0KCBmcmVzbmVsMCApO1xuXHRcdHJldHVybiAoIHZlYzMoIDEuMCApICsgc3FydEYwICkgLyAoIHZlYzMoIDEuMCApIC0gc3FydEYwICk7XG5cdH1cblx0dmVjMyBJb3JUb0ZyZXNuZWwwKCB2ZWMzIHRyYW5zbWl0dGVkSW9yLCBmbG9hdCBpbmNpZGVudElvciApIHtcblx0XHRyZXR1cm4gcG93MiggKCB0cmFuc21pdHRlZElvciAtIHZlYzMoIGluY2lkZW50SW9yICkgKSAvICggdHJhbnNtaXR0ZWRJb3IgKyB2ZWMzKCBpbmNpZGVudElvciApICkgKTtcblx0fVxuXHRmbG9hdCBJb3JUb0ZyZXNuZWwwKCBmbG9hdCB0cmFuc21pdHRlZElvciwgZmxvYXQgaW5jaWRlbnRJb3IgKSB7XG5cdFx0cmV0dXJuIHBvdzIoICggdHJhbnNtaXR0ZWRJb3IgLSBpbmNpZGVudElvciApIC8gKCB0cmFuc21pdHRlZElvciArIGluY2lkZW50SW9yICkpO1xuXHR9XG5cdHZlYzMgZXZhbFNlbnNpdGl2aXR5KCBmbG9hdCBPUEQsIHZlYzMgc2hpZnQgKSB7XG5cdFx0ZmxvYXQgcGhhc2UgPSAyLjAgKiBQSSAqIE9QRCAqIDEuMGUtOTtcblx0XHR2ZWMzIHZhbCA9IHZlYzMoIDUuNDg1NmUtMTMsIDQuNDIwMWUtMTMsIDUuMjQ4MWUtMTMgKTtcblx0XHR2ZWMzIHBvcyA9IHZlYzMoIDEuNjgxMGUrMDYsIDEuNzk1M2UrMDYsIDIuMjA4NGUrMDYgKTtcblx0XHR2ZWMzIHZhciA9IHZlYzMoIDQuMzI3OGUrMDksIDkuMzA0NmUrMDksIDYuNjEyMWUrMDkgKTtcblx0XHR2ZWMzIHh5eiA9IHZhbCAqIHNxcnQoIDIuMCAqIFBJICogdmFyICkgKiBjb3MoIHBvcyAqIHBoYXNlICsgc2hpZnQgKSAqIGV4cCggLSBwb3cyKCBwaGFzZSApICogdmFyICk7XG5cdFx0eHl6LnggKz0gOS43NDcwZS0xNCAqIHNxcnQoIDIuMCAqIFBJICogNC41MjgyZSswOSApICogY29zKCAyLjIzOTllKzA2ICogcGhhc2UgKyBzaGlmdFsgMCBdICkgKiBleHAoIC0gNC41MjgyZSswOSAqIHBvdzIoIHBoYXNlICkgKTtcblx0XHR4eXogLz0gMS4wNjg1ZS03O1xuXHRcdHZlYzMgcmdiID0gWFlaX1RPX1JFQzcwOSAqIHh5ejtcblx0XHRyZXR1cm4gcmdiO1xuXHR9XG5cdHZlYzMgZXZhbElyaWRlc2NlbmNlKCBmbG9hdCBvdXRzaWRlSU9SLCBmbG9hdCBldGEyLCBmbG9hdCBjb3NUaGV0YTEsIGZsb2F0IHRoaW5GaWxtVGhpY2tuZXNzLCB2ZWMzIGJhc2VGMCApIHtcblx0XHR2ZWMzIEk7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1IgPSBtaXgoIG91dHNpZGVJT1IsIGV0YTIsIHNtb290aHN0ZXAoIDAuMCwgMC4wMywgdGhpbkZpbG1UaGlja25lc3MgKSApO1xuXHRcdGZsb2F0IHNpblRoZXRhMlNxID0gcG93Miggb3V0c2lkZUlPUiAvIGlyaWRlc2NlbmNlSU9SICkgKiAoIDEuMCAtIHBvdzIoIGNvc1RoZXRhMSApICk7XG5cdFx0ZmxvYXQgY29zVGhldGEyU3EgPSAxLjAgLSBzaW5UaGV0YTJTcTtcblx0XHRpZiAoIGNvc1RoZXRhMlNxIDwgMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzMoIDEuMCApO1xuXHRcdH1cblx0XHRmbG9hdCBjb3NUaGV0YTIgPSBzcXJ0KCBjb3NUaGV0YTJTcSApO1xuXHRcdGZsb2F0IFIwID0gSW9yVG9GcmVzbmVsMCggaXJpZGVzY2VuY2VJT1IsIG91dHNpZGVJT1IgKTtcblx0XHRmbG9hdCBSMTIgPSBGX1NjaGxpY2soIFIwLCAxLjAsIGNvc1RoZXRhMSApO1xuXHRcdGZsb2F0IFQxMjEgPSAxLjAgLSBSMTI7XG5cdFx0ZmxvYXQgcGhpMTIgPSAwLjA7XG5cdFx0aWYgKCBpcmlkZXNjZW5jZUlPUiA8IG91dHNpZGVJT1IgKSBwaGkxMiA9IFBJO1xuXHRcdGZsb2F0IHBoaTIxID0gUEkgLSBwaGkxMjtcblx0XHR2ZWMzIGJhc2VJT1IgPSBGcmVzbmVsMFRvSW9yKCBjbGFtcCggYmFzZUYwLCAwLjAsIDAuOTk5OSApICk7XHRcdHZlYzMgUjEgPSBJb3JUb0ZyZXNuZWwwKCBiYXNlSU9SLCBpcmlkZXNjZW5jZUlPUiApO1xuXHRcdHZlYzMgUjIzID0gRl9TY2hsaWNrKCBSMSwgMS4wLCBjb3NUaGV0YTIgKTtcblx0XHR2ZWMzIHBoaTIzID0gdmVjMyggMC4wICk7XG5cdFx0aWYgKCBiYXNlSU9SWyAwIF0gPCBpcmlkZXNjZW5jZUlPUiApIHBoaTIzWyAwIF0gPSBQSTtcblx0XHRpZiAoIGJhc2VJT1JbIDEgXSA8IGlyaWRlc2NlbmNlSU9SICkgcGhpMjNbIDEgXSA9IFBJO1xuXHRcdGlmICggYmFzZUlPUlsgMiBdIDwgaXJpZGVzY2VuY2VJT1IgKSBwaGkyM1sgMiBdID0gUEk7XG5cdFx0ZmxvYXQgT1BEID0gMi4wICogaXJpZGVzY2VuY2VJT1IgKiB0aGluRmlsbVRoaWNrbmVzcyAqIGNvc1RoZXRhMjtcblx0XHR2ZWMzIHBoaSA9IHZlYzMoIHBoaTIxICkgKyBwaGkyMztcblx0XHR2ZWMzIFIxMjMgPSBjbGFtcCggUjEyICogUjIzLCAxZS01LCAwLjk5OTkgKTtcblx0XHR2ZWMzIHIxMjMgPSBzcXJ0KCBSMTIzICk7XG5cdFx0dmVjMyBScyA9IHBvdzIoIFQxMjEgKSAqIFIyMyAvICggdmVjMyggMS4wICkgLSBSMTIzICk7XG5cdFx0dmVjMyBDMCA9IFIxMiArIFJzO1xuXHRcdEkgPSBDMDtcblx0XHR2ZWMzIENtID0gUnMgLSBUMTIxO1xuXHRcdGZvciAoIGludCBtID0gMTsgbSA8PSAyOyArKyBtICkge1xuXHRcdFx0Q20gKj0gcjEyMztcblx0XHRcdHZlYzMgU20gPSAyLjAgKiBldmFsU2Vuc2l0aXZpdHkoIGZsb2F0KCBtICkgKiBPUEQsIGZsb2F0KCBtICkgKiBwaGkgKTtcblx0XHRcdEkgKz0gQ20gKiBTbTtcblx0XHR9XG5cdFx0cmV0dXJuIG1heCggSSwgdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgYnVtcG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQlVNUE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBidW1wTWFwO1xuXHR1bmlmb3JtIGZsb2F0IGJ1bXBTY2FsZTtcblx0dmVjMiBkSGR4eV9md2QoKSB7XG5cdFx0dmVjMiBkU1RkeCA9IGRGZHgoIHZCdW1wTWFwVXYgKTtcblx0XHR2ZWMyIGRTVGR5ID0gZEZkeSggdkJ1bXBNYXBVdiApO1xuXHRcdGZsb2F0IEhsbCA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdkJ1bXBNYXBVdiApLng7XG5cdFx0ZmxvYXQgZEJ4ID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2QnVtcE1hcFV2ICsgZFNUZHggKS54IC0gSGxsO1xuXHRcdGZsb2F0IGRCeSA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdkJ1bXBNYXBVdiArIGRTVGR5ICkueCAtIEhsbDtcblx0XHRyZXR1cm4gdmVjMiggZEJ4LCBkQnkgKTtcblx0fVxuXHR2ZWMzIHBlcnR1cmJOb3JtYWxBcmIoIHZlYzMgc3VyZl9wb3MsIHZlYzMgc3VyZl9ub3JtLCB2ZWMyIGRIZHh5LCBmbG9hdCBmYWNlRGlyZWN0aW9uICkge1xuXHRcdHZlYzMgdlNpZ21hWCA9IG5vcm1hbGl6ZSggZEZkeCggc3VyZl9wb3MueHl6ICkgKTtcblx0XHR2ZWMzIHZTaWdtYVkgPSBub3JtYWxpemUoIGRGZHkoIHN1cmZfcG9zLnh5eiApICk7XG5cdFx0dmVjMyB2TiA9IHN1cmZfbm9ybTtcblx0XHR2ZWMzIFIxID0gY3Jvc3MoIHZTaWdtYVksIHZOICk7XG5cdFx0dmVjMyBSMiA9IGNyb3NzKCB2TiwgdlNpZ21hWCApO1xuXHRcdGZsb2F0IGZEZXQgPSBkb3QoIHZTaWdtYVgsIFIxICkgKiBmYWNlRGlyZWN0aW9uO1xuXHRcdHZlYzMgdkdyYWQgPSBzaWduKCBmRGV0ICkgKiAoIGRIZHh5LnggKiBSMSArIGRIZHh5LnkgKiBSMiApO1xuXHRcdHJldHVybiBub3JtYWxpemUoIGFicyggZkRldCApICogc3VyZl9ub3JtIC0gdkdyYWQgKTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2ZWM0IHBsYW5lO1xuXHQjaWZkZWYgQUxQSEFfVE9fQ09WRVJBR0Vcblx0XHRmbG9hdCBkaXN0YW5jZVRvUGxhbmUsIGRpc3RhbmNlR3JhZGllbnQ7XG5cdFx0ZmxvYXQgY2xpcE9wYWNpdHkgPSAxLjA7XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IFVOSU9OX0NMSVBQSU5HX1BMQU5FUzsgaSArKyApIHtcblx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdGRpc3RhbmNlVG9QbGFuZSA9IC0gZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSArIHBsYW5lLnc7XG5cdFx0XHRkaXN0YW5jZUdyYWRpZW50ID0gZndpZHRoKCBkaXN0YW5jZVRvUGxhbmUgKSAvIDIuMDtcblx0XHRcdGNsaXBPcGFjaXR5ICo9IHNtb290aHN0ZXAoIC0gZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VUb1BsYW5lICk7XG5cdFx0XHRpZiAoIGNsaXBPcGFjaXR5ID09IDAuMCApIGRpc2NhcmQ7XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdFx0I2lmIFVOSU9OX0NMSVBQSU5HX1BMQU5FUyA8IE5VTV9DTElQUElOR19QTEFORVNcblx0XHRcdGZsb2F0IHVuaW9uQ2xpcE9wYWNpdHkgPSAxLjA7XG5cdFx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0XHRmb3IgKCBpbnQgaSA9IFVOSU9OX0NMSVBQSU5HX1BMQU5FUzsgaSA8IE5VTV9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdFx0ZGlzdGFuY2VUb1BsYW5lID0gLSBkb3QoIHZDbGlwUG9zaXRpb24sIHBsYW5lLnh5eiApICsgcGxhbmUudztcblx0XHRcdFx0ZGlzdGFuY2VHcmFkaWVudCA9IGZ3aWR0aCggZGlzdGFuY2VUb1BsYW5lICkgLyAyLjA7XG5cdFx0XHRcdHVuaW9uQ2xpcE9wYWNpdHkgKj0gMS4wIC0gc21vb3Roc3RlcCggLSBkaXN0YW5jZUdyYWRpZW50LCBkaXN0YW5jZUdyYWRpZW50LCBkaXN0YW5jZVRvUGxhbmUgKTtcblx0XHRcdH1cblx0XHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdFx0XHRjbGlwT3BhY2l0eSAqPSAxLjAgLSB1bmlvbkNsaXBPcGFjaXR5O1xuXHRcdCNlbmRpZlxuXHRcdGRpZmZ1c2VDb2xvci5hICo9IGNsaXBPcGFjaXR5O1xuXHRcdGlmICggZGlmZnVzZUNvbG9yLmEgPT0gMC4wICkgZGlzY2FyZDtcblx0I2Vsc2Vcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgVU5JT05fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0cGxhbmUgPSBjbGlwcGluZ1BsYW5lc1sgaSBdO1xuXHRcdFx0aWYgKCBkb3QoIHZDbGlwUG9zaXRpb24sIHBsYW5lLnh5eiApID4gcGxhbmUudyApIGRpc2NhcmQ7XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdFx0I2lmIFVOSU9OX0NMSVBQSU5HX1BMQU5FUyA8IE5VTV9DTElQUElOR19QTEFORVNcblx0XHRcdGJvb2wgY2xpcHBlZCA9IHRydWU7XG5cdFx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0XHRmb3IgKCBpbnQgaSA9IFVOSU9OX0NMSVBQSU5HX1BMQU5FUzsgaSA8IE5VTV9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdFx0Y2xpcHBlZCA9ICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSAmJiBjbGlwcGVkO1xuXHRcdFx0fVxuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0XHRcdGlmICggY2xpcHBlZCApIGRpc2NhcmQ7XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgY2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQgPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZhcnlpbmcgdmVjMyB2Q2xpcFBvc2l0aW9uO1xuXHR1bmlmb3JtIHZlYzQgY2xpcHBpbmdQbGFuZXNbIE5VTV9DTElQUElOR19QTEFORVMgXTtcbiNlbmRpZiI7CgogICAgdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmFyeWluZyB2ZWMzIHZDbGlwUG9zaXRpb247XG4jZW5kaWYiOwoKICAgIHZhciBjbGlwcGluZ19wbGFuZXNfdmVydGV4ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2Q2xpcFBvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbiNlbmRpZiI7CgogICAgdmFyIGNvbG9yX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHRkaWZmdXNlQ29sb3IgKj0gdkNvbG9yO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SIClcblx0ZGlmZnVzZUNvbG9yLnJnYiAqPSB2Q29sb3I7XG4jZW5kaWYiOwoKICAgIHZhciBjb2xvcl9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHR2YXJ5aW5nIHZlYzQgdkNvbG9yO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SIClcblx0dmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7CgogICAgdmFyIGNvbG9yX3BhcnNfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHR2YXJ5aW5nIHZlYzQgdkNvbG9yO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0lOU1RBTkNJTkdfQ09MT1IgKSB8fCBkZWZpbmVkKCBVU0VfQkFUQ0hJTkdfQ09MT1IgKVxuXHR2YXJ5aW5nIHZlYzMgdkNvbG9yO1xuI2VuZGlmIjsKCiAgICB2YXIgY29sb3JfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHR2Q29sb3IgPSB2ZWM0KCAxLjAgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0JBVENISU5HX0NPTE9SIClcblx0dkNvbG9yID0gdmVjMyggMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ09MT1Jcblx0dkNvbG9yICo9IGNvbG9yO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lOU1RBTkNJTkdfQ09MT1Jcblx0dkNvbG9yLnh5eiAqPSBpbnN0YW5jZUNvbG9yLnh5ejtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CQVRDSElOR19DT0xPUlxuXHR2ZWMzIGJhdGNoaW5nQ29sb3IgPSBnZXRCYXRjaGluZ0NvbG9yKCBnZXRJbmRpcmVjdEluZGV4KCBnbF9EcmF3SUQgKSApO1xuXHR2Q29sb3IueHl6ICo9IGJhdGNoaW5nQ29sb3IueHl6O1xuI2VuZGlmIjsKCiAgICB2YXIgY29tbW9uID0gIiNkZWZpbmUgUEkgMy4xNDE1OTI2NTM1ODk3OTNcbiNkZWZpbmUgUEkyIDYuMjgzMTg1MzA3MTc5NTg2XG4jZGVmaW5lIFBJX0hBTEYgMS41NzA3OTYzMjY3OTQ4OTY2XG4jZGVmaW5lIFJFQ0lQUk9DQUxfUEkgMC4zMTgzMDk4ODYxODM3OTA3XG4jZGVmaW5lIFJFQ0lQUk9DQUxfUEkyIDAuMTU5MTU0OTQzMDkxODk1MzVcbiNkZWZpbmUgRVBTSUxPTiAxZS02XG4jaWZuZGVmIHNhdHVyYXRlXG4jZGVmaW5lIHNhdHVyYXRlKCBhICkgY2xhbXAoIGEsIDAuMCwgMS4wIClcbiNlbmRpZlxuI2RlZmluZSB3aGl0ZUNvbXBsZW1lbnQoIGEgKSAoIDEuMCAtIHNhdHVyYXRlKCBhICkgKVxuZmxvYXQgcG93MiggY29uc3QgaW4gZmxvYXQgeCApIHsgcmV0dXJuIHgqeDsgfVxudmVjMyBwb3cyKCBjb25zdCBpbiB2ZWMzIHggKSB7IHJldHVybiB4Kng7IH1cbmZsb2F0IHBvdzMoIGNvbnN0IGluIGZsb2F0IHggKSB7IHJldHVybiB4KngqeDsgfVxuZmxvYXQgcG93NCggY29uc3QgaW4gZmxvYXQgeCApIHsgZmxvYXQgeDIgPSB4Kng7IHJldHVybiB4Mip4MjsgfVxuZmxvYXQgbWF4MyggY29uc3QgaW4gdmVjMyB2ICkgeyByZXR1cm4gbWF4KCBtYXgoIHYueCwgdi55ICksIHYueiApOyB9XG5mbG9hdCBhdmVyYWdlKCBjb25zdCBpbiB2ZWMzIHYgKSB7IHJldHVybiBkb3QoIHYsIHZlYzMoIDAuMzMzMzMzMyApICk7IH1cbmhpZ2hwIGZsb2F0IHJhbmQoIGNvbnN0IGluIHZlYzIgdXYgKSB7XG5cdGNvbnN0IGhpZ2hwIGZsb2F0IGEgPSAxMi45ODk4LCBiID0gNzguMjMzLCBjID0gNDM3NTguNTQ1Mztcblx0aGlnaHAgZmxvYXQgZHQgPSBkb3QoIHV2Lnh5LCB2ZWMyKCBhLGIgKSApLCBzbiA9IG1vZCggZHQsIFBJICk7XG5cdHJldHVybiBmcmFjdCggc2luKCBzbiApICogYyApO1xufVxuI2lmZGVmIEhJR0hfUFJFQ0lTSU9OXG5cdGZsb2F0IHByZWNpc2lvblNhZmVMZW5ndGgoIHZlYzMgdiApIHsgcmV0dXJuIGxlbmd0aCggdiApOyB9XG4jZWxzZVxuXHRmbG9hdCBwcmVjaXNpb25TYWZlTGVuZ3RoKCB2ZWMzIHYgKSB7XG5cdFx0ZmxvYXQgbWF4Q29tcG9uZW50ID0gbWF4MyggYWJzKCB2ICkgKTtcblx0XHRyZXR1cm4gbGVuZ3RoKCB2IC8gbWF4Q29tcG9uZW50ICkgKiBtYXhDb21wb25lbnQ7XG5cdH1cbiNlbmRpZlxuc3RydWN0IEluY2lkZW50TGlnaHQge1xuXHR2ZWMzIGNvbG9yO1xuXHR2ZWMzIGRpcmVjdGlvbjtcblx0Ym9vbCB2aXNpYmxlO1xufTtcbnN0cnVjdCBSZWZsZWN0ZWRMaWdodCB7XG5cdHZlYzMgZGlyZWN0RGlmZnVzZTtcblx0dmVjMyBkaXJlY3RTcGVjdWxhcjtcblx0dmVjMyBpbmRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgaW5kaXJlY3RTcGVjdWxhcjtcbn07XG4jaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHR2YXJ5aW5nIHZlYzMgdlBvc2l0aW9uO1xuI2VuZGlmXG52ZWMzIHRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkge1xuXHRyZXR1cm4gbm9ybWFsaXplKCAoIG1hdHJpeCAqIHZlYzQoIGRpciwgMC4wICkgKS54eXogKTtcbn1cbnZlYzMgaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkge1xuXHRyZXR1cm4gbm9ybWFsaXplKCAoIHZlYzQoIGRpciwgMC4wICkgKiBtYXRyaXggKS54eXogKTtcbn1cbm1hdDMgdHJhbnNwb3NlTWF0MyggY29uc3QgaW4gbWF0MyBtICkge1xuXHRtYXQzIHRtcDtcblx0dG1wWyAwIF0gPSB2ZWMzKCBtWyAwIF0ueCwgbVsgMSBdLngsIG1bIDIgXS54ICk7XG5cdHRtcFsgMSBdID0gdmVjMyggbVsgMCBdLnksIG1bIDEgXS55LCBtWyAyIF0ueSApO1xuXHR0bXBbIDIgXSA9IHZlYzMoIG1bIDAgXS56LCBtWyAxIF0ueiwgbVsgMiBdLnogKTtcblx0cmV0dXJuIHRtcDtcbn1cbmJvb2wgaXNQZXJzcGVjdGl2ZU1hdHJpeCggbWF0NCBtICkge1xuXHRyZXR1cm4gbVsgMiBdWyAzIF0gPT0gLSAxLjA7XG59XG52ZWMyIGVxdWlyZWN0VXYoIGluIHZlYzMgZGlyICkge1xuXHRmbG9hdCB1ID0gYXRhbiggZGlyLnosIGRpci54ICkgKiBSRUNJUFJPQ0FMX1BJMiArIDAuNTtcblx0ZmxvYXQgdiA9IGFzaW4oIGNsYW1wKCBkaXIueSwgLSAxLjAsIDEuMCApICkgKiBSRUNJUFJPQ0FMX1BJICsgMC41O1xuXHRyZXR1cm4gdmVjMiggdSwgdiApO1xufVxudmVjMyBCUkRGX0xhbWJlcnQoIGNvbnN0IGluIHZlYzMgZGlmZnVzZUNvbG9yICkge1xuXHRyZXR1cm4gUkVDSVBST0NBTF9QSSAqIGRpZmZ1c2VDb2xvcjtcbn1cbnZlYzMgRl9TY2hsaWNrKCBjb25zdCBpbiB2ZWMzIGYwLCBjb25zdCBpbiBmbG9hdCBmOTAsIGNvbnN0IGluIGZsb2F0IGRvdFZIICkge1xuXHRmbG9hdCBmcmVzbmVsID0gZXhwMiggKCAtIDUuNTU0NzMgKiBkb3RWSCAtIDYuOTgzMTYgKSAqIGRvdFZIICk7XG5cdHJldHVybiBmMCAqICggMS4wIC0gZnJlc25lbCApICsgKCBmOTAgKiBmcmVzbmVsICk7XG59XG5mbG9hdCBGX1NjaGxpY2soIGNvbnN0IGluIGZsb2F0IGYwLCBjb25zdCBpbiBmbG9hdCBmOTAsIGNvbnN0IGluIGZsb2F0IGRvdFZIICkge1xuXHRmbG9hdCBmcmVzbmVsID0gZXhwMiggKCAtIDUuNTU0NzMgKiBkb3RWSCAtIDYuOTgzMTYgKSAqIGRvdFZIICk7XG5cdHJldHVybiBmMCAqICggMS4wIC0gZnJlc25lbCApICsgKCBmOTAgKiBmcmVzbmVsICk7XG59IC8vIHZhbGlkYXRlZCI7CgogICAgdmFyIGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHQjZGVmaW5lIGN1YmVVVl9taW5NaXBMZXZlbCA0LjBcblx0I2RlZmluZSBjdWJlVVZfbWluVGlsZVNpemUgMTYuMFxuXHRmbG9hdCBnZXRGYWNlKCB2ZWMzIGRpcmVjdGlvbiApIHtcblx0XHR2ZWMzIGFic0RpcmVjdGlvbiA9IGFicyggZGlyZWN0aW9uICk7XG5cdFx0ZmxvYXQgZmFjZSA9IC0gMS4wO1xuXHRcdGlmICggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueiApIHtcblx0XHRcdGlmICggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueSApXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueCA+IDAuMCA/IDAuMCA6IDMuMDtcblx0XHRcdGVsc2Vcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi55ID4gMC4wID8gMS4wIDogNC4wO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoIGFic0RpcmVjdGlvbi56ID4gYWJzRGlyZWN0aW9uLnkgKVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnogPiAwLjAgPyAyLjAgOiA1LjA7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcblx0XHR9XG5cdFx0cmV0dXJuIGZhY2U7XG5cdH1cblx0dmVjMiBnZXRVViggdmVjMyBkaXJlY3Rpb24sIGZsb2F0IGZhY2UgKSB7XG5cdFx0dmVjMiB1djtcblx0XHRpZiAoIGZhY2UgPT0gMC4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCBkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnggKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDEuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgLSBkaXJlY3Rpb24ueiApIC8gYWJzKCBkaXJlY3Rpb24ueSApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gMi4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueiApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gMy4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi56LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueCApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueiApIC8gYWJzKCBkaXJlY3Rpb24ueSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR1diA9IHZlYzIoIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueiApO1xuXHRcdH1cblx0XHRyZXR1cm4gMC41ICogKCB1diArIDEuMCApO1xuXHR9XG5cdHZlYzMgYmlsaW5lYXJDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgZGlyZWN0aW9uLCBmbG9hdCBtaXBJbnQgKSB7XG5cdFx0ZmxvYXQgZmFjZSA9IGdldEZhY2UoIGRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGZpbHRlckludCA9IG1heCggY3ViZVVWX21pbk1pcExldmVsIC0gbWlwSW50LCAwLjAgKTtcblx0XHRtaXBJbnQgPSBtYXgoIG1pcEludCwgY3ViZVVWX21pbk1pcExldmVsICk7XG5cdFx0ZmxvYXQgZmFjZVNpemUgPSBleHAyKCBtaXBJbnQgKTtcblx0XHRoaWdocCB2ZWMyIHV2ID0gZ2V0VVYoIGRpcmVjdGlvbiwgZmFjZSApICogKCBmYWNlU2l6ZSAtIDIuMCApICsgMS4wO1xuXHRcdGlmICggZmFjZSA+IDIuMCApIHtcblx0XHRcdHV2LnkgKz0gZmFjZVNpemU7XG5cdFx0XHRmYWNlIC09IDMuMDtcblx0XHR9XG5cdFx0dXYueCArPSBmYWNlICogZmFjZVNpemU7XG5cdFx0dXYueCArPSBmaWx0ZXJJbnQgKiAzLjAgKiBjdWJlVVZfbWluVGlsZVNpemU7XG5cdFx0dXYueSArPSA0LjAgKiAoIGV4cDIoIENVQkVVVl9NQVhfTUlQICkgLSBmYWNlU2l6ZSApO1xuXHRcdHV2LnggKj0gQ1VCRVVWX1RFWEVMX1dJRFRIO1xuXHRcdHV2LnkgKj0gQ1VCRVVWX1RFWEVMX0hFSUdIVDtcblx0XHQjaWZkZWYgdGV4dHVyZTJER3JhZEVYVFxuXHRcdFx0cmV0dXJuIHRleHR1cmUyREdyYWRFWFQoIGVudk1hcCwgdXYsIHZlYzIoIDAuMCApLCB2ZWMyKCAwLjAgKSApLnJnYjtcblx0XHQjZWxzZVxuXHRcdFx0cmV0dXJuIHRleHR1cmUyRCggZW52TWFwLCB1diApLnJnYjtcblx0XHQjZW5kaWZcblx0fVxuXHQjZGVmaW5lIGN1YmVVVl9yMCAxLjBcblx0I2RlZmluZSBjdWJlVVZfbTAgLSAyLjBcblx0I2RlZmluZSBjdWJlVVZfcjEgMC44XG5cdCNkZWZpbmUgY3ViZVVWX20xIC0gMS4wXG5cdCNkZWZpbmUgY3ViZVVWX3I0IDAuNFxuXHQjZGVmaW5lIGN1YmVVVl9tNCAyLjBcblx0I2RlZmluZSBjdWJlVVZfcjUgMC4zMDVcblx0I2RlZmluZSBjdWJlVVZfbTUgMy4wXG5cdCNkZWZpbmUgY3ViZVVWX3I2IDAuMjFcblx0I2RlZmluZSBjdWJlVVZfbTYgNC4wXG5cdGZsb2F0IHJvdWdobmVzc1RvTWlwKCBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0ZmxvYXQgbWlwID0gMC4wO1xuXHRcdGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yMSApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3IwIC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tMSAtIGN1YmVVVl9tMCApIC8gKCBjdWJlVVZfcjAgLSBjdWJlVVZfcjEgKSArIGN1YmVVVl9tMDtcblx0XHR9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3I0ICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjEgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX200IC0gY3ViZVVWX20xICkgLyAoIGN1YmVVVl9yMSAtIGN1YmVVVl9yNCApICsgY3ViZVVWX20xO1xuXHRcdH0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjUgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yNCAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTUgLSBjdWJlVVZfbTQgKSAvICggY3ViZVVWX3I0IC0gY3ViZVVWX3I1ICkgKyBjdWJlVVZfbTQ7XG5cdFx0fSBlbHNlIGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yNiApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3I1IC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tNiAtIGN1YmVVVl9tNSApIC8gKCBjdWJlVVZfcjUgLSBjdWJlVVZfcjYgKSArIGN1YmVVVl9tNTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bWlwID0gLSAyLjAgKiBsb2cyKCAxLjE2ICogcm91Z2huZXNzICk7XHRcdH1cblx0XHRyZXR1cm4gbWlwO1xuXHR9XG5cdHZlYzQgdGV4dHVyZUN1YmVVViggc2FtcGxlcjJEIGVudk1hcCwgdmVjMyBzYW1wbGVEaXIsIGZsb2F0IHJvdWdobmVzcyApIHtcblx0XHRmbG9hdCBtaXAgPSBjbGFtcCggcm91Z2huZXNzVG9NaXAoIHJvdWdobmVzcyApLCBjdWJlVVZfbTAsIENVQkVVVl9NQVhfTUlQICk7XG5cdFx0ZmxvYXQgbWlwRiA9IGZyYWN0KCBtaXAgKTtcblx0XHRmbG9hdCBtaXBJbnQgPSBmbG9vciggbWlwICk7XG5cdFx0dmVjMyBjb2xvcjAgPSBiaWxpbmVhckN1YmVVViggZW52TWFwLCBzYW1wbGVEaXIsIG1pcEludCApO1xuXHRcdGlmICggbWlwRiA9PSAwLjAgKSB7XG5cdFx0XHRyZXR1cm4gdmVjNCggY29sb3IwLCAxLjAgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmVjMyBjb2xvcjEgPSBiaWxpbmVhckN1YmVVViggZW52TWFwLCBzYW1wbGVEaXIsIG1pcEludCArIDEuMCApO1xuXHRcdFx0cmV0dXJuIHZlYzQoIG1peCggY29sb3IwLCBjb2xvcjEsIG1pcEYgKSwgMS4wICk7XG5cdFx0fVxuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBkZWZhdWx0bm9ybWFsX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkTm9ybWFsID0gb2JqZWN0Tm9ybWFsO1xuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHZlYzMgdHJhbnNmb3JtZWRUYW5nZW50ID0gb2JqZWN0VGFuZ2VudDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CQVRDSElOR1xuXHRtYXQzIGJtID0gbWF0MyggYmF0Y2hpbmdNYXRyaXggKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgLz0gdmVjMyggZG90KCBibVsgMCBdLCBibVsgMCBdICksIGRvdCggYm1bIDEgXSwgYm1bIDEgXSApLCBkb3QoIGJtWyAyIF0sIGJtWyAyIF0gKSApO1xuXHR0cmFuc2Zvcm1lZE5vcm1hbCA9IGJtICogdHJhbnNmb3JtZWROb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHRyYW5zZm9ybWVkVGFuZ2VudCA9IGJtICogdHJhbnNmb3JtZWRUYW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9JTlNUQU5DSU5HXG5cdG1hdDMgaW0gPSBtYXQzKCBpbnN0YW5jZU1hdHJpeCApO1xuXHR0cmFuc2Zvcm1lZE5vcm1hbCAvPSB2ZWMzKCBkb3QoIGltWyAwIF0sIGltWyAwIF0gKSwgZG90KCBpbVsgMSBdLCBpbVsgMSBdICksIGRvdCggaW1bIDIgXSwgaW1bIDIgXSApICk7XG5cdHRyYW5zZm9ybWVkTm9ybWFsID0gaW0gKiB0cmFuc2Zvcm1lZE5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dHJhbnNmb3JtZWRUYW5nZW50ID0gaW0gKiB0cmFuc2Zvcm1lZFRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmXG50cmFuc2Zvcm1lZE5vcm1hbCA9IG5vcm1hbE1hdHJpeCAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuI2lmZGVmIEZMSVBfU0lERURcblx0dHJhbnNmb3JtZWROb3JtYWwgPSAtIHRyYW5zZm9ybWVkTm9ybWFsO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RBTkdFTlRcblx0dHJhbnNmb3JtZWRUYW5nZW50ID0gKCBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCB0cmFuc2Zvcm1lZFRhbmdlbnQsIDAuMCApICkueHl6O1xuXHQjaWZkZWYgRkxJUF9TSURFRFxuXHRcdHRyYW5zZm9ybWVkVGFuZ2VudCA9IC0gdHJhbnNmb3JtZWRUYW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBkaXNwbGFjZW1lbnRNYXA7XG5cdHVuaWZvcm0gZmxvYXQgZGlzcGxhY2VtZW50U2NhbGU7XG5cdHVuaWZvcm0gZmxvYXQgZGlzcGxhY2VtZW50QmlhcztcbiNlbmRpZiI7CgogICAgdmFyIGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dHJhbnNmb3JtZWQgKz0gbm9ybWFsaXplKCBvYmplY3ROb3JtYWwgKSAqICggdGV4dHVyZTJEKCBkaXNwbGFjZW1lbnRNYXAsIHZEaXNwbGFjZW1lbnRNYXBVdiApLnggKiBkaXNwbGFjZW1lbnRTY2FsZSArIGRpc3BsYWNlbWVudEJpYXMgKTtcbiNlbmRpZiI7CgogICAgdmFyIGVtaXNzaXZlbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dmVjNCBlbWlzc2l2ZUNvbG9yID0gdGV4dHVyZTJEKCBlbWlzc2l2ZU1hcCwgdkVtaXNzaXZlTWFwVXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFX0VNSVNTSVZFXG5cdFx0ZW1pc3NpdmVDb2xvciA9IHNSR0JUcmFuc2ZlckVPVEYoIGVtaXNzaXZlQ29sb3IgKTtcblx0I2VuZGlmXG5cdHRvdGFsRW1pc3NpdmVSYWRpYW5jZSAqPSBlbWlzc2l2ZUNvbG9yLnJnYjtcbiNlbmRpZiI7CgogICAgdmFyIGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbWlzc2l2ZU1hcDtcbiNlbmRpZiI7CgogICAgdmFyIGNvbG9yc3BhY2VfZnJhZ21lbnQgPSAiZ2xfRnJhZ0NvbG9yID0gbGluZWFyVG9PdXRwdXRUZXhlbCggZ2xfRnJhZ0NvbG9yICk7IjsKCiAgICB2YXIgY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50ID0gInZlYzQgTGluZWFyVHJhbnNmZXJPRVRGKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmFsdWU7XG59XG52ZWM0IHNSR0JUcmFuc2ZlckVPVEYoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCBtaXgoIHBvdyggdmFsdWUucmdiICogMC45NDc4NjcyOTg2ICsgdmVjMyggMC4wNTIxMzI3MDE0ICksIHZlYzMoIDIuNCApICksIHZhbHVlLnJnYiAqIDAuMDc3Mzk5MzgwOCwgdmVjMyggbGVzc1RoYW5FcXVhbCggdmFsdWUucmdiLCB2ZWMzKCAwLjA0MDQ1ICkgKSApICksIHZhbHVlLmEgKTtcbn1cbnZlYzQgc1JHQlRyYW5zZmVyT0VURiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZlYzQoIG1peCggcG93KCB2YWx1ZS5yZ2IsIHZlYzMoIDAuNDE2NjYgKSApICogMS4wNTUgLSB2ZWMzKCAwLjA1NSApLCB2YWx1ZS5yZ2IgKiAxMi45MiwgdmVjMyggbGVzc1RoYW5FcXVhbCggdmFsdWUucmdiLCB2ZWMzKCAwLjAwMzEzMDggKSApICkgKSwgdmFsdWUuYSApO1xufSI7CgogICAgdmFyIGVudm1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0dmVjMyBjYW1lcmFUb0ZyYWc7XG5cdFx0aWYgKCBpc09ydGhvZ3JhcGhpYyApIHtcblx0XHRcdGNhbWVyYVRvRnJhZyA9IG5vcm1hbGl6ZSggdmVjMyggLSB2aWV3TWF0cml4WyAwIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAxIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAyIF1bIDIgXSApICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhbWVyYVRvRnJhZyA9IG5vcm1hbGl6ZSggdldvcmxkUG9zaXRpb24gLSBjYW1lcmFQb3NpdGlvbiApO1xuXHRcdH1cblx0XHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdFx0I2lmZGVmIEVOVk1BUF9NT0RFX1JFRkxFQ1RJT05cblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZmxlY3QoIGNhbWVyYVRvRnJhZywgd29ybGROb3JtYWwgKTtcblx0XHQjZWxzZVxuXHRcdFx0dmVjMyByZWZsZWN0VmVjID0gcmVmcmFjdCggY2FtZXJhVG9GcmFnLCB3b3JsZE5vcm1hbCwgcmVmcmFjdGlvblJhdGlvICk7XG5cdFx0I2VuZGlmXG5cdCNlbHNlXG5cdFx0dmVjMyByZWZsZWN0VmVjID0gdlJlZmxlY3Q7XG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHRcdHZlYzQgZW52Q29sb3IgPSB0ZXh0dXJlQ3ViZSggZW52TWFwLCBlbnZNYXBSb3RhdGlvbiAqIHZlYzMoIGZsaXBFbnZNYXAgKiByZWZsZWN0VmVjLngsIHJlZmxlY3RWZWMueXogKSApO1xuXHQjZWxzZVxuXHRcdHZlYzQgZW52Q29sb3IgPSB2ZWM0KCAwLjAgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZNQVBfQkxFTkRJTkdfTVVMVElQTFlcblx0XHRvdXRnb2luZ0xpZ2h0ID0gbWl4KCBvdXRnb2luZ0xpZ2h0LCBvdXRnb2luZ0xpZ2h0ICogZW52Q29sb3IueHl6LCBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5ICk7XG5cdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9CTEVORElOR19NSVggKVxuXHRcdG91dGdvaW5nTGlnaHQgPSBtaXgoIG91dGdvaW5nTGlnaHQsIGVudkNvbG9yLnh5eiwgc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfQUREIClcblx0XHRvdXRnb2luZ0xpZ2h0ICs9IGVudkNvbG9yLnh5eiAqIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHk7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdHVuaWZvcm0gZmxvYXQgZW52TWFwSW50ZW5zaXR5O1xuXHR1bmlmb3JtIGZsb2F0IGZsaXBFbnZNYXA7XG5cdHVuaWZvcm0gbWF0MyBlbnZNYXBSb3RhdGlvbjtcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcblx0I2Vsc2Vcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG5cdCNlbmRpZlxuXHRcbiNlbmRpZiI7CgogICAgdmFyIGVudm1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdHVuaWZvcm0gZmxvYXQgcmVmbGVjdGl2aXR5O1xuXHQjaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggUEhPTkcgKSB8fCBkZWZpbmVkKCBMQU1CRVJUIClcblx0XHQjZGVmaW5lIEVOVl9XT1JMRFBPU1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcblx0XHR1bmlmb3JtIGZsb2F0IHJlZnJhY3Rpb25SYXRpbztcblx0I2Vsc2Vcblx0XHR2YXJ5aW5nIHZlYzMgdlJlZmxlY3Q7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgZW52bWFwX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApIHx8IGRlZmluZWQoIExBTUJFUlQgKVxuXHRcdCNkZWZpbmUgRU5WX1dPUkxEUE9TXG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0XG5cdFx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuXHQjZWxzZVxuXHRcdHZhcnlpbmcgdmVjMyB2UmVmbGVjdDtcblx0XHR1bmlmb3JtIGZsb2F0IHJlZnJhY3Rpb25SYXRpbztcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBlbnZtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24ueHl6O1xuXHQjZWxzZVxuXHRcdHZlYzMgY2FtZXJhVG9WZXJ0ZXg7XG5cdFx0aWYgKCBpc09ydGhvZ3JhcGhpYyApIHtcblx0XHRcdGNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB2ZWMzKCAtIHZpZXdNYXRyaXhbIDAgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDEgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDIgXVsgMiBdICkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2FtZXJhVG9WZXJ0ZXggPSBub3JtYWxpemUoIHdvcmxkUG9zaXRpb24ueHl6IC0gY2FtZXJhUG9zaXRpb24gKTtcblx0XHR9XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdFx0I2lmZGVmIEVOVk1BUF9NT0RFX1JFRkxFQ1RJT05cblx0XHRcdHZSZWZsZWN0ID0gcmVmbGVjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZSZWZsZWN0ID0gcmVmcmFjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsLCByZWZyYWN0aW9uUmF0aW8gKTtcblx0XHQjZW5kaWZcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBmb2dfdmVydGV4ID0gIiNpZmRlZiBVU0VfRk9HXG5cdHZGb2dEZXB0aCA9IC0gbXZQb3NpdGlvbi56O1xuI2VuZGlmIjsKCiAgICB2YXIgZm9nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfRk9HXG5cdHZhcnlpbmcgZmxvYXQgdkZvZ0RlcHRoO1xuI2VuZGlmIjsKCiAgICB2YXIgZm9nX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRk9HXG5cdCNpZmRlZiBGT0dfRVhQMlxuXHRcdGZsb2F0IGZvZ0ZhY3RvciA9IDEuMCAtIGV4cCggLSBmb2dEZW5zaXR5ICogZm9nRGVuc2l0eSAqIHZGb2dEZXB0aCAqIHZGb2dEZXB0aCApO1xuXHQjZWxzZVxuXHRcdGZsb2F0IGZvZ0ZhY3RvciA9IHNtb290aHN0ZXAoIGZvZ05lYXIsIGZvZ0ZhciwgdkZvZ0RlcHRoICk7XG5cdCNlbmRpZlxuXHRnbF9GcmFnQ29sb3IucmdiID0gbWl4KCBnbF9GcmFnQ29sb3IucmdiLCBmb2dDb2xvciwgZm9nRmFjdG9yICk7XG4jZW5kaWYiOwoKICAgIHZhciBmb2dfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR1bmlmb3JtIHZlYzMgZm9nQ29sb3I7XG5cdHZhcnlpbmcgZmxvYXQgdkZvZ0RlcHRoO1xuXHQjaWZkZWYgRk9HX0VYUDJcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ0RlbnNpdHk7XG5cdCNlbHNlXG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dOZWFyO1xuXHRcdHVuaWZvcm0gZmxvYXQgZm9nRmFyO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBncmFkaWVudE1hcDtcbiNlbmRpZlxudmVjMyBnZXRHcmFkaWVudElycmFkaWFuY2UoIHZlYzMgbm9ybWFsLCB2ZWMzIGxpZ2h0RGlyZWN0aW9uICkge1xuXHRmbG9hdCBkb3ROTCA9IGRvdCggbm9ybWFsLCBsaWdodERpcmVjdGlvbiApO1xuXHR2ZWMyIGNvb3JkID0gdmVjMiggZG90TkwgKiAwLjUgKyAwLjUsIDAuMCApO1xuXHQjaWZkZWYgVVNFX0dSQURJRU5UTUFQXG5cdFx0cmV0dXJuIHZlYzMoIHRleHR1cmUyRCggZ3JhZGllbnRNYXAsIGNvb3JkICkuciApO1xuXHQjZWxzZVxuXHRcdHZlYzIgZncgPSBmd2lkdGgoIGNvb3JkICkgKiAwLjU7XG5cdFx0cmV0dXJuIG1peCggdmVjMyggMC43ICksIHZlYzMoIDEuMCApLCBzbW9vdGhzdGVwKCAwLjcgLSBmdy54LCAwLjcgKyBmdy54LCBjb29yZC54ICkgKTtcblx0I2VuZGlmXG59IjsKCiAgICB2YXIgbGlnaHRtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGxpZ2h0TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGxpZ2h0TWFwSW50ZW5zaXR5O1xuI2VuZGlmIjsKCiAgICB2YXIgbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQgPSAiTGFtYmVydE1hdGVyaWFsIG1hdGVyaWFsO1xubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYjtcbm1hdGVyaWFsLnNwZWN1bGFyU3RyZW5ndGggPSBzcGVjdWxhclN0cmVuZ3RoOyI7CgogICAgdmFyIGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5zdHJ1Y3QgTGFtYmVydE1hdGVyaWFsIHtcblx0dmVjMyBkaWZmdXNlQ29sb3I7XG5cdGZsb2F0IHNwZWN1bGFyU3RyZW5ndGg7XG59O1xudm9pZCBSRV9EaXJlY3RfTGFtYmVydCggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gTGFtYmVydE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX0xhbWJlcnQoIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gTGFtYmVydE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9MYW1iZXJ0XG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfTGFtYmVydCI7CgogICAgdmFyIGxpZ2h0c19wYXJzX2JlZ2luID0gInVuaWZvcm0gYm9vbCByZWNlaXZlU2hhZG93O1xudW5pZm9ybSB2ZWMzIGFtYmllbnRMaWdodENvbG9yO1xuI2lmIGRlZmluZWQoIFVTRV9MSUdIVF9QUk9CRVMgKVxuXHR1bmlmb3JtIHZlYzMgbGlnaHRQcm9iZVsgOSBdO1xuI2VuZGlmXG52ZWMzIHNoR2V0SXJyYWRpYW5jZUF0KCBpbiB2ZWMzIG5vcm1hbCwgaW4gdmVjMyBzaENvZWZmaWNpZW50c1sgOSBdICkge1xuXHRmbG9hdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56O1xuXHR2ZWMzIHJlc3VsdCA9IHNoQ29lZmZpY2llbnRzWyAwIF0gKiAwLjg4NjIyNztcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyAxIF0gKiAyLjAgKiAwLjUxMTY2NCAqIHk7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMiBdICogMi4wICogMC41MTE2NjQgKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDMgXSAqIDIuMCAqIDAuNTExNjY0ICogeDtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA0IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHggKiB5O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDUgXSAqIDIuMCAqIDAuNDI5MDQzICogeSAqIHo7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNiBdICogKCAwLjc0MzEyNSAqIHogKiB6IC0gMC4yNDc3MDggKTtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA3IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHggKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDggXSAqIDAuNDI5MDQzICogKCB4ICogeCAtIHkgKiB5ICk7XG5cdHJldHVybiByZXN1bHQ7XG59XG52ZWMzIGdldExpZ2h0UHJvYmVJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIGxpZ2h0UHJvYmVbIDkgXSwgY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gc2hHZXRJcnJhZGlhbmNlQXQoIHdvcmxkTm9ybWFsLCBsaWdodFByb2JlICk7XG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxudmVjMyBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIGFtYmllbnRMaWdodENvbG9yICkge1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBhbWJpZW50TGlnaHRDb2xvcjtcblx0cmV0dXJuIGlycmFkaWFuY2U7XG59XG5mbG9hdCBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCBsaWdodERpc3RhbmNlLCBjb25zdCBpbiBmbG9hdCBjdXRvZmZEaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgZGVjYXlFeHBvbmVudCApIHtcblx0ZmxvYXQgZGlzdGFuY2VGYWxsb2ZmID0gMS4wIC8gbWF4KCBwb3coIGxpZ2h0RGlzdGFuY2UsIGRlY2F5RXhwb25lbnQgKSwgMC4wMSApO1xuXHRpZiAoIGN1dG9mZkRpc3RhbmNlID4gMC4wICkge1xuXHRcdGRpc3RhbmNlRmFsbG9mZiAqPSBwb3cyKCBzYXR1cmF0ZSggMS4wIC0gcG93NCggbGlnaHREaXN0YW5jZSAvIGN1dG9mZkRpc3RhbmNlICkgKSApO1xuXHR9XG5cdHJldHVybiBkaXN0YW5jZUZhbGxvZmY7XG59XG5mbG9hdCBnZXRTcG90QXR0ZW51YXRpb24oIGNvbnN0IGluIGZsb2F0IGNvbmVDb3NpbmUsIGNvbnN0IGluIGZsb2F0IHBlbnVtYnJhQ29zaW5lLCBjb25zdCBpbiBmbG9hdCBhbmdsZUNvc2luZSApIHtcblx0cmV0dXJuIHNtb290aHN0ZXAoIGNvbmVDb3NpbmUsIHBlbnVtYnJhQ29zaW5lLCBhbmdsZUNvc2luZSApO1xufVxuI2lmIE5VTV9ESVJfTElHSFRTID4gMFxuXHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodCB7XG5cdFx0dmVjMyBkaXJlY3Rpb247XG5cdFx0dmVjMyBjb2xvcjtcblx0fTtcblx0dW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHRzWyBOVU1fRElSX0xJR0hUUyBdO1xuXHR2b2lkIGdldERpcmVjdGlvbmFsTGlnaHRJbmZvKCBjb25zdCBpbiBEaXJlY3Rpb25hbExpZ2h0IGRpcmVjdGlvbmFsTGlnaHQsIG91dCBJbmNpZGVudExpZ2h0IGxpZ2h0ICkge1xuXHRcdGxpZ2h0LmNvbG9yID0gZGlyZWN0aW9uYWxMaWdodC5jb2xvcjtcblx0XHRsaWdodC5kaXJlY3Rpb24gPSBkaXJlY3Rpb25hbExpZ2h0LmRpcmVjdGlvbjtcblx0XHRsaWdodC52aXNpYmxlID0gdHJ1ZTtcblx0fVxuI2VuZGlmXG4jaWYgTlVNX1BPSU5UX0xJR0hUUyA+IDBcblx0c3RydWN0IFBvaW50TGlnaHQge1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBjb2xvcjtcblx0XHRmbG9hdCBkaXN0YW5jZTtcblx0XHRmbG9hdCBkZWNheTtcblx0fTtcblx0dW5pZm9ybSBQb2ludExpZ2h0IHBvaW50TGlnaHRzWyBOVU1fUE9JTlRfTElHSFRTIF07XG5cdHZvaWQgZ2V0UG9pbnRMaWdodEluZm8oIGNvbnN0IGluIFBvaW50TGlnaHQgcG9pbnRMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHR2ZWMzIGxWZWN0b3IgPSBwb2ludExpZ2h0LnBvc2l0aW9uIC0gZ2VvbWV0cnlQb3NpdGlvbjtcblx0XHRsaWdodC5kaXJlY3Rpb24gPSBub3JtYWxpemUoIGxWZWN0b3IgKTtcblx0XHRmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG5cdFx0bGlnaHQuY29sb3IgPSBwb2ludExpZ2h0LmNvbG9yO1xuXHRcdGxpZ2h0LmNvbG9yICo9IGdldERpc3RhbmNlQXR0ZW51YXRpb24oIGxpZ2h0RGlzdGFuY2UsIHBvaW50TGlnaHQuZGlzdGFuY2UsIHBvaW50TGlnaHQuZGVjYXkgKTtcblx0XHRsaWdodC52aXNpYmxlID0gKCBsaWdodC5jb2xvciAhPSB2ZWMzKCAwLjAgKSApO1xuXHR9XG4jZW5kaWZcbiNpZiBOVU1fU1BPVF9MSUdIVFMgPiAwXG5cdHN0cnVjdCBTcG90TGlnaHQge1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBkaXJlY3Rpb247XG5cdFx0dmVjMyBjb2xvcjtcblx0XHRmbG9hdCBkaXN0YW5jZTtcblx0XHRmbG9hdCBkZWNheTtcblx0XHRmbG9hdCBjb25lQ29zO1xuXHRcdGZsb2F0IHBlbnVtYnJhQ29zO1xuXHR9O1xuXHR1bmlmb3JtIFNwb3RMaWdodCBzcG90TGlnaHRzWyBOVU1fU1BPVF9MSUdIVFMgXTtcblx0dm9pZCBnZXRTcG90TGlnaHRJbmZvKCBjb25zdCBpbiBTcG90TGlnaHQgc3BvdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIG91dCBJbmNpZGVudExpZ2h0IGxpZ2h0ICkge1xuXHRcdHZlYzMgbFZlY3RvciA9IHNwb3RMaWdodC5wb3NpdGlvbiAtIGdlb21ldHJ5UG9zaXRpb247XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gbm9ybWFsaXplKCBsVmVjdG9yICk7XG5cdFx0ZmxvYXQgYW5nbGVDb3MgPSBkb3QoIGxpZ2h0LmRpcmVjdGlvbiwgc3BvdExpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IHNwb3RBdHRlbnVhdGlvbiA9IGdldFNwb3RBdHRlbnVhdGlvbiggc3BvdExpZ2h0LmNvbmVDb3MsIHNwb3RMaWdodC5wZW51bWJyYUNvcywgYW5nbGVDb3MgKTtcblx0XHRpZiAoIHNwb3RBdHRlbnVhdGlvbiA+IDAuMCApIHtcblx0XHRcdGZsb2F0IGxpZ2h0RGlzdGFuY2UgPSBsZW5ndGgoIGxWZWN0b3IgKTtcblx0XHRcdGxpZ2h0LmNvbG9yID0gc3BvdExpZ2h0LmNvbG9yICogc3BvdEF0dGVudWF0aW9uO1xuXHRcdFx0bGlnaHQuY29sb3IgKj0gZ2V0RGlzdGFuY2VBdHRlbnVhdGlvbiggbGlnaHREaXN0YW5jZSwgc3BvdExpZ2h0LmRpc3RhbmNlLCBzcG90TGlnaHQuZGVjYXkgKTtcblx0XHRcdGxpZ2h0LnZpc2libGUgPSAoIGxpZ2h0LmNvbG9yICE9IHZlYzMoIDAuMCApICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxpZ2h0LmNvbG9yID0gdmVjMyggMC4wICk7XG5cdFx0XHRsaWdodC52aXNpYmxlID0gZmFsc2U7XG5cdFx0fVxuXHR9XG4jZW5kaWZcbiNpZiBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDBcblx0c3RydWN0IFJlY3RBcmVhTGlnaHQge1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0dmVjMyBwb3NpdGlvbjtcblx0XHR2ZWMzIGhhbGZXaWR0aDtcblx0XHR2ZWMzIGhhbGZIZWlnaHQ7XG5cdH07XG5cdHVuaWZvcm0gc2FtcGxlcjJEIGx0Y18xO1x0dW5pZm9ybSBzYW1wbGVyMkQgbHRjXzI7XG5cdHVuaWZvcm0gUmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0c1sgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgXTtcbiNlbmRpZlxuI2lmIE5VTV9IRU1JX0xJR0hUUyA+IDBcblx0c3RydWN0IEhlbWlzcGhlcmVMaWdodCB7XG5cdFx0dmVjMyBkaXJlY3Rpb247XG5cdFx0dmVjMyBza3lDb2xvcjtcblx0XHR2ZWMzIGdyb3VuZENvbG9yO1xuXHR9O1xuXHR1bmlmb3JtIEhlbWlzcGhlcmVMaWdodCBoZW1pc3BoZXJlTGlnaHRzWyBOVU1fSEVNSV9MSUdIVFMgXTtcblx0dmVjMyBnZXRIZW1pc3BoZXJlTGlnaHRJcnJhZGlhbmNlKCBjb25zdCBpbiBIZW1pc3BoZXJlTGlnaHQgaGVtaUxpZ2h0LCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0XHRmbG9hdCBkb3ROTCA9IGRvdCggbm9ybWFsLCBoZW1pTGlnaHQuZGlyZWN0aW9uICk7XG5cdFx0ZmxvYXQgaGVtaURpZmZ1c2VXZWlnaHQgPSAwLjUgKiBkb3ROTCArIDAuNTtcblx0XHR2ZWMzIGlycmFkaWFuY2UgPSBtaXgoIGhlbWlMaWdodC5ncm91bmRDb2xvciwgaGVtaUxpZ2h0LnNreUNvbG9yLCBoZW1pRGlmZnVzZVdlaWdodCApO1xuXHRcdHJldHVybiBpcnJhZGlhbmNlO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR2ZWMzIGdldElCTElycmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHRcdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdFx0XHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCBlbnZNYXBSb3RhdGlvbiAqIHdvcmxkTm9ybWFsLCAxLjAgKTtcblx0XHRcdHJldHVybiBQSSAqIGVudk1hcENvbG9yLnJnYiAqIGVudk1hcEludGVuc2l0eTtcblx0XHQjZWxzZVxuXHRcdFx0cmV0dXJuIHZlYzMoIDAuMCApO1xuXHRcdCNlbmRpZlxuXHR9XG5cdHZlYzMgZ2V0SUJMUmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0dmVjMyByZWZsZWN0VmVjID0gcmVmbGVjdCggLSB2aWV3RGlyLCBub3JtYWwgKTtcblx0XHRcdHJlZmxlY3RWZWMgPSBub3JtYWxpemUoIG1peCggcmVmbGVjdFZlYywgbm9ybWFsLCByb3VnaG5lc3MgKiByb3VnaG5lc3MpICk7XG5cdFx0XHRyZWZsZWN0VmVjID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggcmVmbGVjdFZlYywgdmlld01hdHJpeCApO1xuXHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiByZWZsZWN0VmVjLCByb3VnaG5lc3MgKTtcblx0XHRcdHJldHVybiBlbnZNYXBDb2xvci5yZ2IgKiBlbnZNYXBJbnRlbnNpdHk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHQjZW5kaWZcblx0fVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHR2ZWMzIGdldElCTEFuaXNvdHJvcHlSYWRpYW5jZSggY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiB2ZWMzIGJpdGFuZ2VudCwgY29uc3QgaW4gZmxvYXQgYW5pc290cm9weSApIHtcblx0XHRcdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdFx0XHRcdHZlYzMgYmVudE5vcm1hbCA9IGNyb3NzKCBiaXRhbmdlbnQsIHZpZXdEaXIgKTtcblx0XHRcdFx0YmVudE5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGJlbnROb3JtYWwsIGJpdGFuZ2VudCApICk7XG5cdFx0XHRcdGJlbnROb3JtYWwgPSBub3JtYWxpemUoIG1peCggYmVudE5vcm1hbCwgbm9ybWFsLCBwb3cyKCBwb3cyKCAxLjAgLSBhbmlzb3Ryb3B5ICogKCAxLjAgLSByb3VnaG5lc3MgKSApICkgKSApO1xuXHRcdFx0XHRyZXR1cm4gZ2V0SUJMUmFkaWFuY2UoIHZpZXdEaXIsIGJlbnROb3JtYWwsIHJvdWdobmVzcyApO1xuXHRcdFx0I2Vsc2Vcblx0XHRcdFx0cmV0dXJuIHZlYzMoIDAuMCApO1xuXHRcdFx0I2VuZGlmXG5cdFx0fVxuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGxpZ2h0c190b29uX2ZyYWdtZW50ID0gIlRvb25NYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2I7IjsKCiAgICB2YXIgbGlnaHRzX3Rvb25fcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBUb29uTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcbn07XG52b2lkIFJFX0RpcmVjdF9Ub29uKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBUb29uTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBnZXRHcmFkaWVudElycmFkaWFuY2UoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBUb29uTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X1Rvb25cbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9Ub29uIjsKCiAgICB2YXIgbGlnaHRzX3Bob25nX2ZyYWdtZW50ID0gIkJsaW5uUGhvbmdNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5tYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gc3BlY3VsYXI7XG5tYXRlcmlhbC5zcGVjdWxhclNoaW5pbmVzcyA9IHNoaW5pbmVzcztcbm1hdGVyaWFsLnNwZWN1bGFyU3RyZW5ndGggPSBzcGVjdWxhclN0cmVuZ3RoOyI7CgogICAgdmFyIGxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50ID0gInZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuc3RydWN0IEJsaW5uUGhvbmdNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHR2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdGZsb2F0IHNwZWN1bGFyU2hpbmluZXNzO1xuXHRmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xufTtcbnZvaWQgUkVfRGlyZWN0X0JsaW5uUGhvbmcoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIEJsaW5uUGhvbmdNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGlycmFkaWFuY2UgKiBCUkRGX0JsaW5uUGhvbmcoIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciwgbWF0ZXJpYWwuc3BlY3VsYXJTaGluaW5lc3MgKSAqIG1hdGVyaWFsLnNwZWN1bGFyU3RyZW5ndGg7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9CbGlublBob25nKCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIEJsaW5uUGhvbmdNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfQmxpbm5QaG9uZ1xuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX0JsaW5uUGhvbmciOwoKICAgIHZhciBsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQgPSAiUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2IgKiAoIDEuMCAtIG1ldGFsbmVzc0ZhY3RvciApO1xudmVjMyBkeHkgPSBtYXgoIGFicyggZEZkeCggbm9uUGVydHVyYmVkTm9ybWFsICkgKSwgYWJzKCBkRmR5KCBub25QZXJ0dXJiZWROb3JtYWwgKSApICk7XG5mbG9hdCBnZW9tZXRyeVJvdWdobmVzcyA9IG1heCggbWF4KCBkeHkueCwgZHh5LnkgKSwgZHh5LnogKTtcbm1hdGVyaWFsLnJvdWdobmVzcyA9IG1heCggcm91Z2huZXNzRmFjdG9yLCAwLjA1MjUgKTttYXRlcmlhbC5yb3VnaG5lc3MgKz0gZ2VvbWV0cnlSb3VnaG5lc3M7XG5tYXRlcmlhbC5yb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLnJvdWdobmVzcywgMS4wICk7XG4jaWZkZWYgSU9SXG5cdG1hdGVyaWFsLmlvciA9IGlvcjtcblx0I2lmZGVmIFVTRV9TUEVDVUxBUlxuXHRcdGZsb2F0IHNwZWN1bGFySW50ZW5zaXR5RmFjdG9yID0gc3BlY3VsYXJJbnRlbnNpdHk7XG5cdFx0dmVjMyBzcGVjdWxhckNvbG9yRmFjdG9yID0gc3BlY3VsYXJDb2xvcjtcblx0XHQjaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdFx0XHRzcGVjdWxhckNvbG9yRmFjdG9yICo9IHRleHR1cmUyRCggc3BlY3VsYXJDb2xvck1hcCwgdlNwZWN1bGFyQ29sb3JNYXBVdiApLnJnYjtcblx0XHQjZW5kaWZcblx0XHQjaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHRcdFx0c3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IgKj0gdGV4dHVyZTJEKCBzcGVjdWxhckludGVuc2l0eU1hcCwgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXYgKS5hO1xuXHRcdCNlbmRpZlxuXHRcdG1hdGVyaWFsLnNwZWN1bGFyRjkwID0gbWl4KCBzcGVjdWxhckludGVuc2l0eUZhY3RvciwgMS4wLCBtZXRhbG5lc3NGYWN0b3IgKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBzcGVjdWxhckludGVuc2l0eUZhY3RvciA9IDEuMDtcblx0XHR2ZWMzIHNwZWN1bGFyQ29sb3JGYWN0b3IgPSB2ZWMzKCAxLjAgKTtcblx0XHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IDEuMDtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgPSBtaXgoIG1pbiggcG93MiggKCBtYXRlcmlhbC5pb3IgLSAxLjAgKSAvICggbWF0ZXJpYWwuaW9yICsgMS4wICkgKSAqIHNwZWN1bGFyQ29sb3JGYWN0b3IsIHZlYzMoIDEuMCApICkgKiBzcGVjdWxhckludGVuc2l0eUZhY3RvciwgZGlmZnVzZUNvbG9yLnJnYiwgbWV0YWxuZXNzRmFjdG9yICk7XG4jZWxzZVxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCB2ZWMzKCAwLjA0ICksIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuXHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IDEuMDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0bWF0ZXJpYWwuY2xlYXJjb2F0ID0gY2xlYXJjb2F0O1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBjbGVhcmNvYXRSb3VnaG5lc3M7XG5cdG1hdGVyaWFsLmNsZWFyY29hdEYwID0gdmVjMyggMC4wNCApO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRGOTAgPSAxLjA7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdFx0bWF0ZXJpYWwuY2xlYXJjb2F0ICo9IHRleHR1cmUyRCggY2xlYXJjb2F0TWFwLCB2Q2xlYXJjb2F0TWFwVXYgKS54O1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdFx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICo9IHRleHR1cmUyRCggY2xlYXJjb2F0Um91Z2huZXNzTWFwLCB2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgKS55O1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuY2xlYXJjb2F0ID0gc2F0dXJhdGUoIG1hdGVyaWFsLmNsZWFyY29hdCApO1x0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gbWF4KCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MsIDAuMDUyNSApO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKz0gZ2VvbWV0cnlSb3VnaG5lc3M7XG5cdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IG1pbiggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCAxLjAgKTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQRVJTSU9OXG5cdG1hdGVyaWFsLmRpc3BlcnNpb24gPSBkaXNwZXJzaW9uO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdG1hdGVyaWFsLmlyaWRlc2NlbmNlID0gaXJpZGVzY2VuY2U7XG5cdG1hdGVyaWFsLmlyaWRlc2NlbmNlSU9SID0gaXJpZGVzY2VuY2VJT1I7XG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSAqPSB0ZXh0dXJlMkQoIGlyaWRlc2NlbmNlTWFwLCB2SXJpZGVzY2VuY2VNYXBVdiApLnI7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUFxuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID0gKGlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bSAtIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bSkgKiB0ZXh0dXJlMkQoIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLCB2SXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiApLmcgKyBpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW07XG5cdCNlbHNlXG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3MgPSBpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW07XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOXG5cdG1hdGVyaWFsLnNoZWVuQ29sb3IgPSBzaGVlbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdFx0bWF0ZXJpYWwuc2hlZW5Db2xvciAqPSB0ZXh0dXJlMkQoIHNoZWVuQ29sb3JNYXAsIHZTaGVlbkNvbG9yTWFwVXYgKS5yZ2I7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5zaGVlblJvdWdobmVzcyA9IGNsYW1wKCBzaGVlblJvdWdobmVzcywgMC4wNywgMS4wICk7XG5cdCNpZmRlZiBVU0VfU0hFRU5fUk9VR0hORVNTTUFQXG5cdFx0bWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKj0gdGV4dHVyZTJEKCBzaGVlblJvdWdobmVzc01hcCwgdlNoZWVuUm91Z2huZXNzTWFwVXYgKS5hO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWU1BUFxuXHRcdG1hdDIgYW5pc290cm9weU1hdCA9IG1hdDIoIGFuaXNvdHJvcHlWZWN0b3IueCwgYW5pc290cm9weVZlY3Rvci55LCAtIGFuaXNvdHJvcHlWZWN0b3IueSwgYW5pc290cm9weVZlY3Rvci54ICk7XG5cdFx0dmVjMyBhbmlzb3Ryb3B5UG9sYXIgPSB0ZXh0dXJlMkQoIGFuaXNvdHJvcHlNYXAsIHZBbmlzb3Ryb3B5TWFwVXYgKS5yZ2I7XG5cdFx0dmVjMiBhbmlzb3Ryb3B5ViA9IGFuaXNvdHJvcHlNYXQgKiBub3JtYWxpemUoIDIuMCAqIGFuaXNvdHJvcHlQb2xhci5yZyAtIHZlYzIoIDEuMCApICkgKiBhbmlzb3Ryb3B5UG9sYXIuYjtcblx0I2Vsc2Vcblx0XHR2ZWMyIGFuaXNvdHJvcHlWID0gYW5pc290cm9weVZlY3Rvcjtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLmFuaXNvdHJvcHkgPSBsZW5ndGgoIGFuaXNvdHJvcHlWICk7XG5cdGlmKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID09IDAuMCApIHtcblx0XHRhbmlzb3Ryb3B5ViA9IHZlYzIoIDEuMCwgMC4wICk7XG5cdH0gZWxzZSB7XG5cdFx0YW5pc290cm9weVYgLz0gbWF0ZXJpYWwuYW5pc290cm9weTtcblx0XHRtYXRlcmlhbC5hbmlzb3Ryb3B5ID0gc2F0dXJhdGUoIG1hdGVyaWFsLmFuaXNvdHJvcHkgKTtcblx0fVxuXHRtYXRlcmlhbC5hbHBoYVQgPSBtaXgoIHBvdzIoIG1hdGVyaWFsLnJvdWdobmVzcyApLCAxLjAsIHBvdzIoIG1hdGVyaWFsLmFuaXNvdHJvcHkgKSApO1xuXHRtYXRlcmlhbC5hbmlzb3Ryb3B5VCA9IHRiblsgMCBdICogYW5pc290cm9weVYueCArIHRiblsgMSBdICogYW5pc290cm9weVYueTtcblx0bWF0ZXJpYWwuYW5pc290cm9weUIgPSB0Ym5bIDEgXSAqIGFuaXNvdHJvcHlWLnggLSB0Ym5bIDAgXSAqIGFuaXNvdHJvcHlWLnk7XG4jZW5kaWYiOwoKICAgIHZhciBsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudCA9ICJzdHJ1Y3QgUGh5c2ljYWxNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHRmbG9hdCByb3VnaG5lc3M7XG5cdHZlYzMgc3BlY3VsYXJDb2xvcjtcblx0ZmxvYXQgc3BlY3VsYXJGOTA7XG5cdGZsb2F0IGRpc3BlcnNpb247XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgY2xlYXJjb2F0O1xuXHRcdGZsb2F0IGNsZWFyY29hdFJvdWdobmVzcztcblx0XHR2ZWMzIGNsZWFyY29hdEYwO1xuXHRcdGZsb2F0IGNsZWFyY29hdEY5MDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0XHRmbG9hdCBpcmlkZXNjZW5jZTtcblx0XHRmbG9hdCBpcmlkZXNjZW5jZUlPUjtcblx0XHRmbG9hdCBpcmlkZXNjZW5jZVRoaWNrbmVzcztcblx0XHR2ZWMzIGlyaWRlc2NlbmNlRnJlc25lbDtcblx0XHR2ZWMzIGlyaWRlc2NlbmNlRjA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0dmVjMyBzaGVlbkNvbG9yO1xuXHRcdGZsb2F0IHNoZWVuUm91Z2huZXNzO1xuXHQjZW5kaWZcblx0I2lmZGVmIElPUlxuXHRcdGZsb2F0IGlvcjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdFx0ZmxvYXQgdHJhbnNtaXNzaW9uO1xuXHRcdGZsb2F0IHRyYW5zbWlzc2lvbkFscGhhO1xuXHRcdGZsb2F0IHRoaWNrbmVzcztcblx0XHRmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHRcdHZlYzMgYXR0ZW51YXRpb25Db2xvcjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdGZsb2F0IGFuaXNvdHJvcHk7XG5cdFx0ZmxvYXQgYWxwaGFUO1xuXHRcdHZlYzMgYW5pc290cm9weVQ7XG5cdFx0dmVjMyBhbmlzb3Ryb3B5Qjtcblx0I2VuZGlmXG59O1xudmVjMyBjbGVhcmNvYXRTcGVjdWxhckRpcmVjdCA9IHZlYzMoIDAuMCApO1xudmVjMyBjbGVhcmNvYXRTcGVjdWxhckluZGlyZWN0ID0gdmVjMyggMC4wICk7XG52ZWMzIHNoZWVuU3BlY3VsYXJEaXJlY3QgPSB2ZWMzKCAwLjAgKTtcbnZlYzMgc2hlZW5TcGVjdWxhckluZGlyZWN0ID0gdmVjMygwLjAgKTtcbnZlYzMgU2NobGlja190b19GMCggY29uc3QgaW4gdmVjMyBmLCBjb25zdCBpbiBmbG9hdCBmOTAsIGNvbnN0IGluIGZsb2F0IGRvdFZIICkge1xuICAgIGZsb2F0IHggPSBjbGFtcCggMS4wIC0gZG90VkgsIDAuMCwgMS4wICk7XG4gICAgZmxvYXQgeDIgPSB4ICogeDtcbiAgICBmbG9hdCB4NSA9IGNsYW1wKCB4ICogeDIgKiB4MiwgMC4wLCAwLjk5OTkgKTtcbiAgICByZXR1cm4gKCBmIC0gdmVjMyggZjkwICkgKiB4NSApIC8gKCAxLjAgLSB4NSApO1xufVxuZmxvYXQgVl9HR1hfU21pdGhDb3JyZWxhdGVkKCBjb25zdCBpbiBmbG9hdCBhbHBoYSwgY29uc3QgaW4gZmxvYXQgZG90TkwsIGNvbnN0IGluIGZsb2F0IGRvdE5WICkge1xuXHRmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG5cdGZsb2F0IGd2ID0gZG90TkwgKiBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5WICkgKTtcblx0ZmxvYXQgZ2wgPSBkb3ROViAqIHNxcnQoIGEyICsgKCAxLjAgLSBhMiApICogcG93MiggZG90TkwgKSApO1xuXHRyZXR1cm4gMC41IC8gbWF4KCBndiArIGdsLCBFUFNJTE9OICk7XG59XG5mbG9hdCBEX0dHWCggY29uc3QgaW4gZmxvYXQgYWxwaGEsIGNvbnN0IGluIGZsb2F0IGRvdE5IICkge1xuXHRmbG9hdCBhMiA9IHBvdzIoIGFscGhhICk7XG5cdGZsb2F0IGRlbm9tID0gcG93MiggZG90TkggKSAqICggYTIgLSAxLjAgKSArIDEuMDtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBhMiAvIHBvdzIoIGRlbm9tICk7XG59XG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0ZmxvYXQgVl9HR1hfU21pdGhDb3JyZWxhdGVkX0FuaXNvdHJvcGljKCBjb25zdCBpbiBmbG9hdCBhbHBoYVQsIGNvbnN0IGluIGZsb2F0IGFscGhhQiwgY29uc3QgaW4gZmxvYXQgZG90VFYsIGNvbnN0IGluIGZsb2F0IGRvdEJWLCBjb25zdCBpbiBmbG9hdCBkb3RUTCwgY29uc3QgaW4gZmxvYXQgZG90QkwsIGNvbnN0IGluIGZsb2F0IGRvdE5WLCBjb25zdCBpbiBmbG9hdCBkb3ROTCApIHtcblx0XHRmbG9hdCBndiA9IGRvdE5MICogbGVuZ3RoKCB2ZWMzKCBhbHBoYVQgKiBkb3RUViwgYWxwaGFCICogZG90QlYsIGRvdE5WICkgKTtcblx0XHRmbG9hdCBnbCA9IGRvdE5WICogbGVuZ3RoKCB2ZWMzKCBhbHBoYVQgKiBkb3RUTCwgYWxwaGFCICogZG90QkwsIGRvdE5MICkgKTtcblx0XHRmbG9hdCB2ID0gMC41IC8gKCBndiArIGdsICk7XG5cdFx0cmV0dXJuIHNhdHVyYXRlKHYpO1xuXHR9XG5cdGZsb2F0IERfR0dYX0FuaXNvdHJvcGljKCBjb25zdCBpbiBmbG9hdCBhbHBoYVQsIGNvbnN0IGluIGZsb2F0IGFscGhhQiwgY29uc3QgaW4gZmxvYXQgZG90TkgsIGNvbnN0IGluIGZsb2F0IGRvdFRILCBjb25zdCBpbiBmbG9hdCBkb3RCSCApIHtcblx0XHRmbG9hdCBhMiA9IGFscGhhVCAqIGFscGhhQjtcblx0XHRoaWdocCB2ZWMzIHYgPSB2ZWMzKCBhbHBoYUIgKiBkb3RUSCwgYWxwaGFUICogZG90QkgsIGEyICogZG90TkggKTtcblx0XHRoaWdocCBmbG9hdCB2MiA9IGRvdCggdiwgdiApO1xuXHRcdGZsb2F0IHcyID0gYTIgLyB2Mjtcblx0XHRyZXR1cm4gUkVDSVBST0NBTF9QSSAqIGEyICogcG93MiAoIHcyICk7XG5cdH1cbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0dmVjMyBCUkRGX0dHWF9DbGVhcmNvYXQoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwpIHtcblx0XHR2ZWMzIGYwID0gbWF0ZXJpYWwuY2xlYXJjb2F0RjA7XG5cdFx0ZmxvYXQgZjkwID0gbWF0ZXJpYWwuY2xlYXJjb2F0RjkwO1xuXHRcdGZsb2F0IHJvdWdobmVzcyA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcztcblx0XHRmbG9hdCBhbHBoYSA9IHBvdzIoIHJvdWdobmVzcyApO1xuXHRcdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdFx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0XHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdFx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRcdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdFx0dmVjMyBGID0gRl9TY2hsaWNrKCBmMCwgZjkwLCBkb3RWSCApO1xuXHRcdGZsb2F0IFYgPSBWX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGFscGhhLCBkb3ROTCwgZG90TlYgKTtcblx0XHRmbG9hdCBEID0gRF9HR1goIGFscGhhLCBkb3ROSCApO1xuXHRcdHJldHVybiBGICogKCBWICogRCApO1xuXHR9XG4jZW5kaWZcbnZlYzMgQlJERl9HR1goIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwgKSB7XG5cdHZlYzMgZjAgPSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yO1xuXHRmbG9hdCBmOTAgPSBtYXRlcmlhbC5zcGVjdWxhckY5MDtcblx0ZmxvYXQgcm91Z2huZXNzID0gbWF0ZXJpYWwucm91Z2huZXNzO1xuXHRmbG9hdCBhbHBoYSA9IHBvdzIoIHJvdWdobmVzcyApO1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgbGlnaHREaXIgKSApO1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0ZmxvYXQgZG90VkggPSBzYXR1cmF0ZSggZG90KCB2aWV3RGlyLCBoYWxmRGlyICkgKTtcblx0dmVjMyBGID0gRl9TY2hsaWNrKCBmMCwgZjkwLCBkb3RWSCApO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0RiA9IG1peCggRiwgbWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsLCBtYXRlcmlhbC5pcmlkZXNjZW5jZSApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdFx0ZmxvYXQgZG90VEwgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlULCBsaWdodERpciApO1xuXHRcdGZsb2F0IGRvdFRWID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgdmlld0RpciApO1xuXHRcdGZsb2F0IGRvdFRIID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgaGFsZkRpciApO1xuXHRcdGZsb2F0IGRvdEJMID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5QiwgbGlnaHREaXIgKTtcblx0XHRmbG9hdCBkb3RCViA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIHZpZXdEaXIgKTtcblx0XHRmbG9hdCBkb3RCSCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIGhhbGZEaXIgKTtcblx0XHRmbG9hdCBWID0gVl9HR1hfU21pdGhDb3JyZWxhdGVkX0FuaXNvdHJvcGljKCBtYXRlcmlhbC5hbHBoYVQsIGFscGhhLCBkb3RUViwgZG90QlYsIGRvdFRMLCBkb3RCTCwgZG90TlYsIGRvdE5MICk7XG5cdFx0ZmxvYXQgRCA9IERfR0dYX0FuaXNvdHJvcGljKCBtYXRlcmlhbC5hbHBoYVQsIGFscGhhLCBkb3ROSCwgZG90VEgsIGRvdEJIICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgViA9IFZfR0dYX1NtaXRoQ29ycmVsYXRlZCggYWxwaGEsIGRvdE5MLCBkb3ROViApO1xuXHRcdGZsb2F0IEQgPSBEX0dHWCggYWxwaGEsIGRvdE5IICk7XG5cdCNlbmRpZlxuXHRyZXR1cm4gRiAqICggViAqIEQgKTtcbn1cbnZlYzIgTFRDX1V2KCBjb25zdCBpbiB2ZWMzIE4sIGNvbnN0IGluIHZlYzMgViwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRjb25zdCBmbG9hdCBMVVRfU0laRSA9IDY0LjA7XG5cdGNvbnN0IGZsb2F0IExVVF9TQ0FMRSA9ICggTFVUX1NJWkUgLSAxLjAgKSAvIExVVF9TSVpFO1xuXHRjb25zdCBmbG9hdCBMVVRfQklBUyA9IDAuNSAvIExVVF9TSVpFO1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIE4sIFYgKSApO1xuXHR2ZWMyIHV2ID0gdmVjMiggcm91Z2huZXNzLCBzcXJ0KCAxLjAgLSBkb3ROViApICk7XG5cdHV2ID0gdXYgKiBMVVRfU0NBTEUgKyBMVVRfQklBUztcblx0cmV0dXJuIHV2O1xufVxuZmxvYXQgTFRDX0NsaXBwZWRTcGhlcmVGb3JtRmFjdG9yKCBjb25zdCBpbiB2ZWMzIGYgKSB7XG5cdGZsb2F0IGwgPSBsZW5ndGgoIGYgKTtcblx0cmV0dXJuIG1heCggKCBsICogbCArIGYueiApIC8gKCBsICsgMS4wICksIDAuMCApO1xufVxudmVjMyBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvbnN0IGluIHZlYzMgdjEsIGNvbnN0IGluIHZlYzMgdjIgKSB7XG5cdGZsb2F0IHggPSBkb3QoIHYxLCB2MiApO1xuXHRmbG9hdCB5ID0gYWJzKCB4ICk7XG5cdGZsb2F0IGEgPSAwLjg1NDM5ODUgKyAoIDAuNDk2NTE1NSArIDAuMDE0NTIwNiAqIHkgKSAqIHk7XG5cdGZsb2F0IGIgPSAzLjQxNzU5NDAgKyAoIDQuMTYxNjcyNCArIHkgKSAqIHk7XG5cdGZsb2F0IHYgPSBhIC8gYjtcblx0ZmxvYXQgdGhldGFfc2ludGhldGEgPSAoIHggPiAwLjAgKSA/IHYgOiAwLjUgKiBpbnZlcnNlc3FydCggbWF4KCAxLjAgLSB4ICogeCwgMWUtNyApICkgLSB2O1xuXHRyZXR1cm4gY3Jvc3MoIHYxLCB2MiApICogdGhldGFfc2ludGhldGE7XG59XG52ZWMzIExUQ19FdmFsdWF0ZSggY29uc3QgaW4gdmVjMyBOLCBjb25zdCBpbiB2ZWMzIFYsIGNvbnN0IGluIHZlYzMgUCwgY29uc3QgaW4gbWF0MyBtSW52LCBjb25zdCBpbiB2ZWMzIHJlY3RDb29yZHNbIDQgXSApIHtcblx0dmVjMyB2MSA9IHJlY3RDb29yZHNbIDEgXSAtIHJlY3RDb29yZHNbIDAgXTtcblx0dmVjMyB2MiA9IHJlY3RDb29yZHNbIDMgXSAtIHJlY3RDb29yZHNbIDAgXTtcblx0dmVjMyBsaWdodE5vcm1hbCA9IGNyb3NzKCB2MSwgdjIgKTtcblx0aWYoIGRvdCggbGlnaHROb3JtYWwsIFAgLSByZWN0Q29vcmRzWyAwIF0gKSA8IDAuMCApIHJldHVybiB2ZWMzKCAwLjAgKTtcblx0dmVjMyBUMSwgVDI7XG5cdFQxID0gbm9ybWFsaXplKCBWIC0gTiAqIGRvdCggViwgTiApICk7XG5cdFQyID0gLSBjcm9zcyggTiwgVDEgKTtcblx0bWF0MyBtYXQgPSBtSW52ICogdHJhbnNwb3NlTWF0MyggbWF0MyggVDEsIFQyLCBOICkgKTtcblx0dmVjMyBjb29yZHNbIDQgXTtcblx0Y29vcmRzWyAwIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDAgXSAtIFAgKTtcblx0Y29vcmRzWyAxIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDEgXSAtIFAgKTtcblx0Y29vcmRzWyAyIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDIgXSAtIFAgKTtcblx0Y29vcmRzWyAzIF0gPSBtYXQgKiAoIHJlY3RDb29yZHNbIDMgXSAtIFAgKTtcblx0Y29vcmRzWyAwIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMCBdICk7XG5cdGNvb3Jkc1sgMSBdID0gbm9ybWFsaXplKCBjb29yZHNbIDEgXSApO1xuXHRjb29yZHNbIDIgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAyIF0gKTtcblx0Y29vcmRzWyAzIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMyBdICk7XG5cdHZlYzMgdmVjdG9yRm9ybUZhY3RvciA9IHZlYzMoIDAuMCApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAwIF0sIGNvb3Jkc1sgMSBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDEgXSwgY29vcmRzWyAyIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMiBdLCBjb29yZHNbIDMgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAzIF0sIGNvb3Jkc1sgMCBdICk7XG5cdGZsb2F0IHJlc3VsdCA9IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggdmVjdG9yRm9ybUZhY3RvciApO1xuXHRyZXR1cm4gdmVjMyggcmVzdWx0ICk7XG59XG4jaWYgZGVmaW5lZCggVVNFX1NIRUVOIClcbmZsb2F0IERfQ2hhcmxpZSggZmxvYXQgcm91Z2huZXNzLCBmbG9hdCBkb3ROSCApIHtcblx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0ZmxvYXQgaW52QWxwaGEgPSAxLjAgLyBhbHBoYTtcblx0ZmxvYXQgY29zMmggPSBkb3ROSCAqIGRvdE5IO1xuXHRmbG9hdCBzaW4yaCA9IG1heCggMS4wIC0gY29zMmgsIDAuMDA3ODEyNSApO1xuXHRyZXR1cm4gKCAyLjAgKyBpbnZBbHBoYSApICogcG93KCBzaW4yaCwgaW52QWxwaGEgKiAwLjUgKSAvICggMi4wICogUEkgKTtcbn1cbmZsb2F0IFZfTmV1YmVsdCggZmxvYXQgZG90TlYsIGZsb2F0IGRvdE5MICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIDEuMCAvICggNC4wICogKCBkb3ROTCArIGRvdE5WIC0gZG90TkwgKiBkb3ROViApICkgKTtcbn1cbnZlYzMgQlJERl9TaGVlbiggY29uc3QgaW4gdmVjMyBsaWdodERpciwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgdmVjMyBzaGVlbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBzaGVlblJvdWdobmVzcyApIHtcblx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBsaWdodERpciArIHZpZXdEaXIgKTtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IEQgPSBEX0NoYXJsaWUoIHNoZWVuUm91Z2huZXNzLCBkb3ROSCApO1xuXHRmbG9hdCBWID0gVl9OZXViZWx0KCBkb3ROViwgZG90TkwgKTtcblx0cmV0dXJuIHNoZWVuQ29sb3IgKiAoIEQgKiBWICk7XG59XG4jZW5kaWZcbmZsb2F0IElCTFNoZWVuQlJERiggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdGZsb2F0IHIyID0gcm91Z2huZXNzICogcm91Z2huZXNzO1xuXHRmbG9hdCBhID0gcm91Z2huZXNzIDwgMC4yNSA/IC0zMzkuMiAqIHIyICsgMTYxLjQgKiByb3VnaG5lc3MgLSAyNS45IDogLTguNDggKiByMiArIDE0LjMgKiByb3VnaG5lc3MgLSA5Ljk1O1xuXHRmbG9hdCBiID0gcm91Z2huZXNzIDwgMC4yNSA/IDQ0LjAgKiByMiAtIDIzLjcgKiByb3VnaG5lc3MgKyAzLjI2IDogMS45NyAqIHIyIC0gMy4yNyAqIHJvdWdobmVzcyArIDAuNzI7XG5cdGZsb2F0IERHID0gZXhwKCBhICogZG90TlYgKyBiICkgKyAoIHJvdWdobmVzcyA8IDAuMjUgPyAwLjAgOiAwLjEgKiAoIHJvdWdobmVzcyAtIDAuMjUgKSApO1xuXHRyZXR1cm4gc2F0dXJhdGUoIERHICogUkVDSVBST0NBTF9QSSApO1xufVxudmVjMiBERkdBcHByb3goIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRjb25zdCB2ZWM0IGMwID0gdmVjNCggLSAxLCAtIDAuMDI3NSwgLSAwLjU3MiwgMC4wMjIgKTtcblx0Y29uc3QgdmVjNCBjMSA9IHZlYzQoIDEsIDAuMDQyNSwgMS4wNCwgLSAwLjA0ICk7XG5cdHZlYzQgciA9IHJvdWdobmVzcyAqIGMwICsgYzE7XG5cdGZsb2F0IGEwMDQgPSBtaW4oIHIueCAqIHIueCwgZXhwMiggLSA5LjI4ICogZG90TlYgKSApICogci54ICsgci55O1xuXHR2ZWMyIGZhYiA9IHZlYzIoIC0gMS4wNCwgMS4wNCApICogYTAwNCArIHIuenc7XG5cdHJldHVybiBmYWI7XG59XG52ZWMzIEVudmlyb25tZW50QlJERiggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHR2ZWMyIGZhYiA9IERGR0FwcHJveCggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0cmV0dXJuIHNwZWN1bGFyQ29sb3IgKiBmYWIueCArIHNwZWN1bGFyRjkwICogZmFiLnk7XG59XG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG52b2lkIGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmdJcmlkZXNjZW5jZSggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gZmxvYXQgaXJpZGVzY2VuY2UsIGNvbnN0IGluIHZlYzMgaXJpZGVzY2VuY2VGMCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBpbm91dCB2ZWMzIHNpbmdsZVNjYXR0ZXIsIGlub3V0IHZlYzMgbXVsdGlTY2F0dGVyICkge1xuI2Vsc2VcbnZvaWQgY29tcHV0ZU11bHRpc2NhdHRlcmluZyggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBzcGVjdWxhckNvbG9yLCBjb25zdCBpbiBmbG9hdCBzcGVjdWxhckY5MCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBpbm91dCB2ZWMzIHNpbmdsZVNjYXR0ZXIsIGlub3V0IHZlYzMgbXVsdGlTY2F0dGVyICkge1xuI2VuZGlmXG5cdHZlYzIgZmFiID0gREZHQXBwcm94KCBub3JtYWwsIHZpZXdEaXIsIHJvdWdobmVzcyApO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0dmVjMyBGciA9IG1peCggc3BlY3VsYXJDb2xvciwgaXJpZGVzY2VuY2VGMCwgaXJpZGVzY2VuY2UgKTtcblx0I2Vsc2Vcblx0XHR2ZWMzIEZyID0gc3BlY3VsYXJDb2xvcjtcblx0I2VuZGlmXG5cdHZlYzMgRnNzRXNzID0gRnIgKiBmYWIueCArIHNwZWN1bGFyRjkwICogZmFiLnk7XG5cdGZsb2F0IEVzcyA9IGZhYi54ICsgZmFiLnk7XG5cdGZsb2F0IEVtcyA9IDEuMCAtIEVzcztcblx0dmVjMyBGYXZnID0gRnIgKyAoIDEuMCAtIEZyICkgKiAwLjA0NzYxOTtcdHZlYzMgRm1zID0gRnNzRXNzICogRmF2ZyAvICggMS4wIC0gRW1zICogRmF2ZyApO1xuXHRzaW5nbGVTY2F0dGVyICs9IEZzc0Vzcztcblx0bXVsdGlTY2F0dGVyICs9IEZtcyAqIEVtcztcbn1cbiNpZiBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDBcblx0dm9pZCBSRV9EaXJlY3RfUmVjdEFyZWFfUGh5c2ljYWwoIGNvbnN0IGluIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdFx0dmVjMyBub3JtYWwgPSBnZW9tZXRyeU5vcm1hbDtcblx0XHR2ZWMzIHZpZXdEaXIgPSBnZW9tZXRyeVZpZXdEaXI7XG5cdFx0dmVjMyBwb3NpdGlvbiA9IGdlb21ldHJ5UG9zaXRpb247XG5cdFx0dmVjMyBsaWdodFBvcyA9IHJlY3RBcmVhTGlnaHQucG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGggPSByZWN0QXJlYUxpZ2h0LmhhbGZXaWR0aDtcblx0XHR2ZWMzIGhhbGZIZWlnaHQgPSByZWN0QXJlYUxpZ2h0LmhhbGZIZWlnaHQ7XG5cdFx0dmVjMyBsaWdodENvbG9yID0gcmVjdEFyZWFMaWdodC5jb2xvcjtcblx0XHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5yb3VnaG5lc3M7XG5cdFx0dmVjMyByZWN0Q29vcmRzWyA0IF07XG5cdFx0cmVjdENvb3Jkc1sgMCBdID0gbGlnaHRQb3MgKyBoYWxmV2lkdGggLSBoYWxmSGVpZ2h0O1x0XHRyZWN0Q29vcmRzWyAxIF0gPSBsaWdodFBvcyAtIGhhbGZXaWR0aCAtIGhhbGZIZWlnaHQ7XG5cdFx0cmVjdENvb3Jkc1sgMiBdID0gbGlnaHRQb3MgLSBoYWxmV2lkdGggKyBoYWxmSGVpZ2h0O1xuXHRcdHJlY3RDb29yZHNbIDMgXSA9IGxpZ2h0UG9zICsgaGFsZldpZHRoICsgaGFsZkhlaWdodDtcblx0XHR2ZWMyIHV2ID0gTFRDX1V2KCBub3JtYWwsIHZpZXdEaXIsIHJvdWdobmVzcyApO1xuXHRcdHZlYzQgdDEgPSB0ZXh0dXJlMkQoIGx0Y18xLCB1diApO1xuXHRcdHZlYzQgdDIgPSB0ZXh0dXJlMkQoIGx0Y18yLCB1diApO1xuXHRcdG1hdDMgbUludiA9IG1hdDMoXG5cdFx0XHR2ZWMzKCB0MS54LCAwLCB0MS55ICksXG5cdFx0XHR2ZWMzKCAgICAwLCAxLCAgICAwICksXG5cdFx0XHR2ZWMzKCB0MS56LCAwLCB0MS53IClcblx0XHQpO1xuXHRcdHZlYzMgZnJlc25lbCA9ICggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciAqIHQyLnggKyAoIHZlYzMoIDEuMCApIC0gbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApICogdDIueSApO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGxpZ2h0Q29sb3IgKiBmcmVzbmVsICogTFRDX0V2YWx1YXRlKCBub3JtYWwsIHZpZXdEaXIsIHBvc2l0aW9uLCBtSW52LCByZWN0Q29vcmRzICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBsaWdodENvbG9yICogbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogTFRDX0V2YWx1YXRlKCBub3JtYWwsIHZpZXdEaXIsIHBvc2l0aW9uLCBtYXQzKCAxLjAgKSwgcmVjdENvb3JkcyApO1xuXHR9XG4jZW5kaWZcbnZvaWQgUkVfRGlyZWN0X1BoeXNpY2FsKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRmbG9hdCBkb3ROTGNjID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdFx0dmVjMyBjY0lycmFkaWFuY2UgPSBkb3ROTGNjICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJEaXJlY3QgKz0gY2NJcnJhZGlhbmNlICogQlJERl9HR1hfQ2xlYXJjb2F0KCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0c2hlZW5TcGVjdWxhckRpcmVjdCArPSBpcnJhZGlhbmNlICogQlJERl9TaGVlbiggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbC5zaGVlbkNvbG9yLCBtYXRlcmlhbC5zaGVlblJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKz0gaXJyYWRpYW5jZSAqIEJSREZfR0dYKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsICk7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9QaHlzaWNhbCggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdFNwZWN1bGFyX1BoeXNpY2FsKCBjb25zdCBpbiB2ZWMzIHJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgY2xlYXJjb2F0UmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0KSB7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCArPSBjbGVhcmNvYXRSYWRpYW5jZSAqIEVudmlyb25tZW50QlJERiggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuY2xlYXJjb2F0RjAsIG1hdGVyaWFsLmNsZWFyY29hdEY5MCwgbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0c2hlZW5TcGVjdWxhckluZGlyZWN0ICs9IGlycmFkaWFuY2UgKiBtYXRlcmlhbC5zaGVlbkNvbG9yICogSUJMU2hlZW5CUkRGKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zaGVlblJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0dmVjMyBzaW5nbGVTY2F0dGVyaW5nID0gdmVjMyggMC4wICk7XG5cdHZlYzMgbXVsdGlTY2F0dGVyaW5nID0gdmVjMyggMC4wICk7XG5cdHZlYzMgY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlID0gaXJyYWRpYW5jZSAqIFJFQ0lQUk9DQUxfUEk7XG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0XHRjb21wdXRlTXVsdGlzY2F0dGVyaW5nSXJpZGVzY2VuY2UoIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyRjkwLCBtYXRlcmlhbC5pcmlkZXNjZW5jZSwgbWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsLCBtYXRlcmlhbC5yb3VnaG5lc3MsIHNpbmdsZVNjYXR0ZXJpbmcsIG11bHRpU2NhdHRlcmluZyApO1xuXHQjZWxzZVxuXHRcdGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmcoIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyRjkwLCBtYXRlcmlhbC5yb3VnaG5lc3MsIHNpbmdsZVNjYXR0ZXJpbmcsIG11bHRpU2NhdHRlcmluZyApO1xuXHQjZW5kaWZcblx0dmVjMyB0b3RhbFNjYXR0ZXJpbmcgPSBzaW5nbGVTY2F0dGVyaW5nICsgbXVsdGlTY2F0dGVyaW5nO1xuXHR2ZWMzIGRpZmZ1c2UgPSBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKiAoIDEuMCAtIG1heCggbWF4KCB0b3RhbFNjYXR0ZXJpbmcuciwgdG90YWxTY2F0dGVyaW5nLmcgKSwgdG90YWxTY2F0dGVyaW5nLmIgKSApO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICs9IHJhZGlhbmNlICogc2luZ2xlU2NhdHRlcmluZztcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSBtdWx0aVNjYXR0ZXJpbmcgKiBjb3NpbmVXZWlnaHRlZElycmFkaWFuY2U7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBkaWZmdXNlICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9QaHlzaWNhbFxuI2RlZmluZSBSRV9EaXJlY3RfUmVjdEFyZWFcdFx0UkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfUGh5c2ljYWxcbiNkZWZpbmUgUkVfSW5kaXJlY3RTcGVjdWxhclx0XHRSRV9JbmRpcmVjdFNwZWN1bGFyX1BoeXNpY2FsXG5mbG9hdCBjb21wdXRlU3BlY3VsYXJPY2NsdXNpb24oIGNvbnN0IGluIGZsb2F0IGRvdE5WLCBjb25zdCBpbiBmbG9hdCBhbWJpZW50T2NjbHVzaW9uLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdHJldHVybiBzYXR1cmF0ZSggcG93KCBkb3ROViArIGFtYmllbnRPY2NsdXNpb24sIGV4cDIoIC0gMTYuMCAqIHJvdWdobmVzcyAtIDEuMCApICkgLSAxLjAgKyBhbWJpZW50T2NjbHVzaW9uICk7XG59IjsKCiAgICB2YXIgbGlnaHRzX2ZyYWdtZW50X2JlZ2luID0gIlxudmVjMyBnZW9tZXRyeVBvc2l0aW9uID0gLSB2Vmlld1Bvc2l0aW9uO1xudmVjMyBnZW9tZXRyeU5vcm1hbCA9IG5vcm1hbDtcbnZlYzMgZ2VvbWV0cnlWaWV3RGlyID0gKCBpc09ydGhvZ3JhcGhpYyApID8gdmVjMyggMCwgMCwgMSApIDogbm9ybWFsaXplKCB2Vmlld1Bvc2l0aW9uICk7XG52ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsID0gdmVjMyggMC4wICk7XG4jaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCA9IGNsZWFyY29hdE5vcm1hbDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRmbG9hdCBkb3ROVmkgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGdlb21ldHJ5Vmlld0RpciApICk7XG5cdGlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3MgPT0gMC4wICkge1xuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlID0gMC4wO1xuXHR9IGVsc2Uge1xuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlID0gc2F0dXJhdGUoIG1hdGVyaWFsLmlyaWRlc2NlbmNlICk7XG5cdH1cblx0aWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSA+IDAuMCApIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZUZyZXNuZWwgPSBldmFsSXJpZGVzY2VuY2UoIDEuMCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1IsIGRvdE5WaSwgbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3MsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKTtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZUYwID0gU2NobGlja190b19GMCggbWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsLCAxLjAsIGRvdE5WaSApO1xuXHR9XG4jZW5kaWZcbkluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQ7XG4jaWYgKCBOVU1fUE9JTlRfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFBvaW50TGlnaHQgcG9pbnRMaWdodDtcblx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDBcblx0UG9pbnRMaWdodFNoYWRvdyBwb2ludExpZ2h0U2hhZG93O1xuXHQjZW5kaWZcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRTOyBpICsrICkge1xuXHRcdHBvaW50TGlnaHQgPSBwb2ludExpZ2h0c1sgaSBdO1xuXHRcdGdldFBvaW50TGlnaHRJbmZvKCBwb2ludExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBkaXJlY3RMaWdodCApO1xuXHRcdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgKCBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgKVxuXHRcdHBvaW50TGlnaHRTaGFkb3cgPSBwb2ludExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9ICggZGlyZWN0TGlnaHQudmlzaWJsZSAmJiByZWNlaXZlU2hhZG93ICkgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd0ludGVuc2l0eSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dCaWFzLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdlBvaW50U2hhZG93Q29vcmRbIGkgXSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFOZWFyLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd0NhbWVyYUZhciApIDogMS4wO1xuXHRcdCNlbmRpZlxuXHRcdFJFX0RpcmVjdCggZGlyZWN0TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgKCBOVU1fU1BPVF9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcblx0U3BvdExpZ2h0IHNwb3RMaWdodDtcblx0dmVjNCBzcG90Q29sb3I7XG5cdHZlYzMgc3BvdExpZ2h0Q29vcmQ7XG5cdGJvb2wgaW5TcG90TGlnaHRNYXA7XG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0U3BvdExpZ2h0U2hhZG93IHNwb3RMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRTOyBpICsrICkge1xuXHRcdHNwb3RMaWdodCA9IHNwb3RMaWdodHNbIGkgXTtcblx0XHRnZXRTcG90TGlnaHRJbmZvKCBzcG90TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1NfV0lUSF9NQVBTIClcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYIFVOUk9MTEVEX0xPT1BfSU5ERVhcblx0XHQjZWxpZiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYIE5VTV9TUE9UX0xJR0hUX01BUFNcblx0XHQjZWxzZVxuXHRcdCNkZWZpbmUgU1BPVF9MSUdIVF9NQVBfSU5ERVggKCBVTlJPTExFRF9MT09QX0lOREVYIC0gTlVNX1NQT1RfTElHSFRfU0hBRE9XUyArIE5VTV9TUE9UX0xJR0hUX1NIQURPV1NfV0lUSF9NQVBTIClcblx0XHQjZW5kaWZcblx0XHQjaWYgKCBTUE9UX0xJR0hUX01BUF9JTkRFWCA8IE5VTV9TUE9UX0xJR0hUX01BUFMgKVxuXHRcdFx0c3BvdExpZ2h0Q29vcmQgPSB2U3BvdExpZ2h0Q29vcmRbIGkgXS54eXogLyB2U3BvdExpZ2h0Q29vcmRbIGkgXS53O1xuXHRcdFx0aW5TcG90TGlnaHRNYXAgPSBhbGwoIGxlc3NUaGFuKCBhYnMoIHNwb3RMaWdodENvb3JkICogMi4gLSAxLiApLCB2ZWMzKCAxLjAgKSApICk7XG5cdFx0XHRzcG90Q29sb3IgPSB0ZXh0dXJlMkQoIHNwb3RMaWdodE1hcFsgU1BPVF9MSUdIVF9NQVBfSU5ERVggXSwgc3BvdExpZ2h0Q29vcmQueHkgKTtcblx0XHRcdGRpcmVjdExpZ2h0LmNvbG9yID0gaW5TcG90TGlnaHRNYXAgPyBkaXJlY3RMaWdodC5jb2xvciAqIHNwb3RDb2xvci5yZ2IgOiBkaXJlY3RMaWdodC5jb2xvcjtcblx0XHQjZW5kaWZcblx0XHQjdW5kZWYgU1BPVF9MSUdIVF9NQVBfSU5ERVhcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgKVxuXHRcdHNwb3RMaWdodFNoYWRvdyA9IHNwb3RMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSAoIGRpcmVjdExpZ2h0LnZpc2libGUgJiYgcmVjZWl2ZVNoYWRvdyApID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93SW50ZW5zaXR5LCBzcG90TGlnaHRTaGFkb3cuc2hhZG93Qmlhcywgc3BvdExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX0RJUl9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcblx0RGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0O1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0RGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93O1xuXHQjZW5kaWZcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUUzsgaSArKyApIHtcblx0XHRkaXJlY3Rpb25hbExpZ2h0ID0gZGlyZWN0aW9uYWxMaWdodHNbIGkgXTtcblx0XHRnZXREaXJlY3Rpb25hbExpZ2h0SW5mbyggZGlyZWN0aW9uYWxMaWdodCwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9ESVJfTElHSFRfU0hBRE9XUyApXG5cdFx0ZGlyZWN0aW9uYWxMaWdodFNoYWRvdyA9IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0U2hhZG93LnNoYWRvd0ludGVuc2l0eSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dCaWFzLCBkaXJlY3Rpb25hbExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSApIDogMS4wO1xuXHRcdCNlbmRpZlxuXHRcdFJFX0RpcmVjdCggZGlyZWN0TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgKCBOVU1fUkVDVF9BUkVBX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3RfUmVjdEFyZWEgKVxuXHRSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1JFQ1RfQVJFQV9MSUdIVFM7IGkgKysgKSB7XG5cdFx0cmVjdEFyZWFMaWdodCA9IHJlY3RBcmVhTGlnaHRzWyBpIF07XG5cdFx0UkVfRGlyZWN0X1JlY3RBcmVhKCByZWN0QXJlYUxpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdHZlYzMgaWJsSXJyYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBnZXRBbWJpZW50TGlnaHRJcnJhZGlhbmNlKCBhbWJpZW50TGlnaHRDb2xvciApO1xuXHQjaWYgZGVmaW5lZCggVVNFX0xJR0hUX1BST0JFUyApXG5cdFx0aXJyYWRpYW5jZSArPSBnZXRMaWdodFByb2JlSXJyYWRpYW5jZSggbGlnaHRQcm9iZSwgZ2VvbWV0cnlOb3JtYWwgKTtcblx0I2VuZGlmXG5cdCNpZiAoIE5VTV9IRU1JX0xJR0hUUyA+IDAgKVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fSEVNSV9MSUdIVFM7IGkgKysgKSB7XG5cdFx0XHRpcnJhZGlhbmNlICs9IGdldEhlbWlzcGhlcmVMaWdodElycmFkaWFuY2UoIGhlbWlzcGhlcmVMaWdodHNbIGkgXSwgZ2VvbWV0cnlOb3JtYWwgKTtcblx0XHR9XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdFNwZWN1bGFyIClcblx0dmVjMyByYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNsZWFyY29hdFJhZGlhbmNlID0gdmVjMyggMC4wICk7XG4jZW5kaWYiOwoKICAgIHZhciBsaWdodHNfZnJhZ21lbnRfbWFwcyA9ICIjaWYgZGVmaW5lZCggUkVfSW5kaXJlY3REaWZmdXNlIClcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdFx0dmVjMyBsaWdodE1hcElycmFkaWFuY2UgPSBsaWdodE1hcFRleGVsLnJnYiAqIGxpZ2h0TWFwSW50ZW5zaXR5O1xuXHRcdGlycmFkaWFuY2UgKz0gbGlnaHRNYXBJcnJhZGlhbmNlO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBTVEFOREFSRCApICYmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHRcdGlibElycmFkaWFuY2UgKz0gZ2V0SUJMSXJyYWRpYW5jZSggZ2VvbWV0cnlOb3JtYWwgKTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdHJhZGlhbmNlICs9IGdldElCTEFuaXNvdHJvcHlSYWRpYW5jZSggZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwucm91Z2huZXNzLCBtYXRlcmlhbC5hbmlzb3Ryb3B5QiwgbWF0ZXJpYWwuYW5pc290cm9weSApO1xuXHQjZWxzZVxuXHRcdHJhZGlhbmNlICs9IGdldElCTFJhZGlhbmNlKCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbC5yb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0Y2xlYXJjb2F0UmFkaWFuY2UgKz0gZ2V0SUJMUmFkaWFuY2UoIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgogICAgdmFyIGxpZ2h0c19mcmFnbWVudF9lbmQgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdFJFX0luZGlyZWN0RGlmZnVzZSggaXJyYWRpYW5jZSwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdFJFX0luZGlyZWN0U3BlY3VsYXIoIHJhZGlhbmNlLCBpYmxJcnJhZGlhbmNlLCBjbGVhcmNvYXRSYWRpYW5jZSwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuI2VuZGlmIjsKCiAgICB2YXIgbG9nZGVwdGhidWZfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRiApXG5cdGdsX0ZyYWdEZXB0aCA9IHZJc1BlcnNwZWN0aXZlID09IDAuMCA/IGdsX0ZyYWdDb29yZC56IDogbG9nMiggdkZyYWdEZXB0aCApICogbG9nRGVwdGhCdWZGQyAqIDAuNTtcbiNlbmRpZiI7CgogICAgdmFyIGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9MT0dERVBUSEJVRiApXG5cdHVuaWZvcm0gZmxvYXQgbG9nRGVwdGhCdWZGQztcblx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuXHR2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuI2VuZGlmIjsKCiAgICB2YXIgbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9MT0dERVBUSEJVRlxuXHR2YXJ5aW5nIGZsb2F0IHZGcmFnRGVwdGg7XG5cdHZhcnlpbmcgZmxvYXQgdklzUGVyc3BlY3RpdmU7XG4jZW5kaWYiOwoKICAgIHZhciBsb2dkZXB0aGJ1Zl92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9MT0dERVBUSEJVRlxuXHR2RnJhZ0RlcHRoID0gMS4wICsgZ2xfUG9zaXRpb24udztcblx0dklzUGVyc3BlY3RpdmUgPSBmbG9hdCggaXNQZXJzcGVjdGl2ZU1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApICk7XG4jZW5kaWYiOwoKICAgIHZhciBtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dmVjNCBzYW1wbGVkRGlmZnVzZUNvbG9yID0gdGV4dHVyZTJEKCBtYXAsIHZNYXBVdiApO1xuXHQjaWZkZWYgREVDT0RFX1ZJREVPX1RFWFRVUkVcblx0XHRzYW1wbGVkRGlmZnVzZUNvbG9yID0gc1JHQlRyYW5zZmVyRU9URiggc2FtcGxlZERpZmZ1c2VDb2xvciApO1xuXHQjZW5kaWZcblx0ZGlmZnVzZUNvbG9yICo9IHNhbXBsZWREaWZmdXNlQ29sb3I7XG4jZW5kaWYiOwoKICAgIHZhciBtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBtYXA7XG4jZW5kaWYiOwoKICAgIHZhciBtYXBfcGFydGljbGVfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9NQVAgKSB8fCBkZWZpbmVkKCBVU0VfQUxQSEFNQVAgKVxuXHQjaWYgZGVmaW5lZCggVVNFX1BPSU5UU19VViApXG5cdFx0dmVjMiB1diA9IHZVdjtcblx0I2Vsc2Vcblx0XHR2ZWMyIHV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIGdsX1BvaW50Q29vcmQueCwgMS4wIC0gZ2xfUG9pbnRDb29yZC55LCAxICkgKS54eTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdGRpZmZ1c2VDb2xvciAqPSB0ZXh0dXJlMkQoIG1hcCwgdXYgKTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHRkaWZmdXNlQ29sb3IuYSAqPSB0ZXh0dXJlMkQoIGFscGhhTWFwLCB1diApLmc7XG4jZW5kaWYiOwoKICAgIHZhciBtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX1BPSU5UU19VViApXG5cdHZhcnlpbmcgdmVjMiB2VXY7XG4jZWxzZVxuXHQjaWYgZGVmaW5lZCggVVNFX01BUCApIHx8IGRlZmluZWQoIFVTRV9BTFBIQU1BUCApXG5cdFx0dW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGFscGhhTWFwO1xuI2VuZGlmIjsKCiAgICB2YXIgbWV0YWxuZXNzbWFwX2ZyYWdtZW50ID0gImZsb2F0IG1ldGFsbmVzc0ZhY3RvciA9IG1ldGFsbmVzcztcbiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHZlYzQgdGV4ZWxNZXRhbG5lc3MgPSB0ZXh0dXJlMkQoIG1ldGFsbmVzc01hcCwgdk1ldGFsbmVzc01hcFV2ICk7XG5cdG1ldGFsbmVzc0ZhY3RvciAqPSB0ZXhlbE1ldGFsbmVzcy5iO1xuI2VuZGlmIjsKCiAgICB2YXIgbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWV0YWxuZXNzTWFwO1xuI2VuZGlmIjsKCiAgICB2YXIgbW9ycGhpbnN0YW5jZV92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9JTlNUQU5DSU5HX01PUlBIXG5cdGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgTU9SUEhUQVJHRVRTX0NPVU5UIF07XG5cdGZsb2F0IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZSA9IHRleGVsRmV0Y2goIG1vcnBoVGV4dHVyZSwgaXZlYzIoIDAsIGdsX0luc3RhbmNlSUQgKSwgMCApLnI7XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRtb3JwaFRhcmdldEluZmx1ZW5jZXNbaV0gPSAgdGV4ZWxGZXRjaCggbW9ycGhUZXh0dXJlLCBpdmVjMiggaSArIDEsIGdsX0luc3RhbmNlSUQgKSwgMCApLnI7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIG1vcnBoY29sb3JfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfTU9SUEhDT0xPUlMgKVxuXHR2Q29sb3IgKj0gbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApXG5cdFx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHZDb2xvciArPSBnZXRNb3JwaCggZ2xfVmVydGV4SUQsIGksIDIgKSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHRcdCNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdFx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHZDb2xvciArPSBnZXRNb3JwaCggZ2xfVmVydGV4SUQsIGksIDIgKS5yZ2IgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0XHQjZW5kaWZcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgbW9ycGhub3JtYWxfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhOT1JNQUxTXG5cdG9iamVjdE5vcm1hbCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIG9iamVjdE5vcm1hbCArPSBnZXRNb3JwaCggZ2xfVmVydGV4SUQsIGksIDEgKS54eXogKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9NT1JQSFRBUkdFVFNcblx0I2lmbmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSFxuXHRcdHVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHRcdHVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBNT1JQSFRBUkdFVFNfQ09VTlQgXTtcblx0I2VuZGlmXG5cdHVuaWZvcm0gc2FtcGxlcjJEQXJyYXkgbW9ycGhUYXJnZXRzVGV4dHVyZTtcblx0dW5pZm9ybSBpdmVjMiBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZTtcblx0dmVjNCBnZXRNb3JwaCggY29uc3QgaW4gaW50IHZlcnRleEluZGV4LCBjb25zdCBpbiBpbnQgbW9ycGhUYXJnZXRJbmRleCwgY29uc3QgaW4gaW50IG9mZnNldCApIHtcblx0XHRpbnQgdGV4ZWxJbmRleCA9IHZlcnRleEluZGV4ICogTU9SUEhUQVJHRVRTX1RFWFRVUkVfU1RSSURFICsgb2Zmc2V0O1xuXHRcdGludCB5ID0gdGV4ZWxJbmRleCAvIG1vcnBoVGFyZ2V0c1RleHR1cmVTaXplLng7XG5cdFx0aW50IHggPSB0ZXhlbEluZGV4IC0geSAqIG1vcnBoVGFyZ2V0c1RleHR1cmVTaXplLng7XG5cdFx0aXZlYzMgbW9ycGhVViA9IGl2ZWMzKCB4LCB5LCBtb3JwaFRhcmdldEluZGV4ICk7XG5cdFx0cmV0dXJuIHRleGVsRmV0Y2goIG1vcnBoVGFyZ2V0c1RleHR1cmUsIG1vcnBoVVYsIDAgKTtcblx0fVxuI2VuZGlmIjsKCiAgICB2YXIgbW9ycGh0YXJnZXRfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTXG5cdHRyYW5zZm9ybWVkICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTU9SUEhUQVJHRVRTX0NPVU5UOyBpICsrICkge1xuXHRcdGlmICggbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF0gIT0gMC4wICkgdHJhbnNmb3JtZWQgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAwICkueHl6ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIG5vcm1hbF9mcmFnbWVudF9iZWdpbiA9ICJmbG9hdCBmYWNlRGlyZWN0aW9uID0gZ2xfRnJvbnRGYWNpbmcgPyAxLjAgOiAtIDEuMDtcbiNpZmRlZiBGTEFUX1NIQURFRFxuXHR2ZWMzIGZkeCA9IGRGZHgoIHZWaWV3UG9zaXRpb24gKTtcblx0dmVjMyBmZHkgPSBkRmR5KCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCBjcm9zcyggZmR4LCBmZHkgKSApO1xuI2Vsc2Vcblx0dmVjMyBub3JtYWwgPSBub3JtYWxpemUoIHZOb3JtYWwgKTtcblx0I2lmZGVmIERPVUJMRV9TSURFRFxuXHRcdG5vcm1hbCAqPSBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFICkgfHwgZGVmaW5lZCggVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBVU0VfQU5JU09UUk9QWSApXG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdG1hdDMgdGJuID0gbWF0Myggbm9ybWFsaXplKCB2VGFuZ2VudCApLCBub3JtYWxpemUoIHZCaXRhbmdlbnQgKSwgbm9ybWFsICk7XG5cdCNlbHNlXG5cdFx0bWF0MyB0Ym4gPSBnZXRUYW5nZW50RnJhbWUoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLFxuXHRcdCNpZiBkZWZpbmVkKCBVU0VfTk9STUFMTUFQIClcblx0XHRcdHZOb3JtYWxNYXBVdlxuXHRcdCNlbGlmIGRlZmluZWQoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQIClcblx0XHRcdHZDbGVhcmNvYXROb3JtYWxNYXBVdlxuXHRcdCNlbHNlXG5cdFx0XHR2VXZcblx0XHQjZW5kaWZcblx0XHQpO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIERPVUJMRV9TSURFRCApICYmICEgZGVmaW5lZCggRkxBVF9TSEFERUQgKVxuXHRcdHRiblswXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHRcdHRiblsxXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdG1hdDMgdGJuMiA9IG1hdDMoIG5vcm1hbGl6ZSggdlRhbmdlbnQgKSwgbm9ybWFsaXplKCB2Qml0YW5nZW50ICksIG5vcm1hbCApO1xuXHQjZWxzZVxuXHRcdG1hdDMgdGJuMiA9IGdldFRhbmdlbnRGcmFtZSggLSB2Vmlld1Bvc2l0aW9uLCBub3JtYWwsIHZDbGVhcmNvYXROb3JtYWxNYXBVdiApO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIERPVUJMRV9TSURFRCApICYmICEgZGVmaW5lZCggRkxBVF9TSEFERUQgKVxuXHRcdHRibjJbMF0gKj0gZmFjZURpcmVjdGlvbjtcblx0XHR0Ym4yWzFdICo9IGZhY2VEaXJlY3Rpb247XG5cdCNlbmRpZlxuI2VuZGlmXG52ZWMzIG5vblBlcnR1cmJlZE5vcm1hbCA9IG5vcm1hbDsiOwoKICAgIHZhciBub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRVxuXHRub3JtYWwgPSB0ZXh0dXJlMkQoIG5vcm1hbE1hcCwgdk5vcm1hbE1hcFV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHQjaWZkZWYgRkxJUF9TSURFRFxuXHRcdG5vcm1hbCA9IC0gbm9ybWFsO1xuXHQjZW5kaWZcblx0I2lmZGVmIERPVUJMRV9TSURFRFxuXHRcdG5vcm1hbCA9IG5vcm1hbCAqIGZhY2VEaXJlY3Rpb247XG5cdCNlbmRpZlxuXHRub3JtYWwgPSBub3JtYWxpemUoIG5vcm1hbE1hdHJpeCAqIG5vcm1hbCApO1xuI2VsaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKVxuXHR2ZWMzIG1hcE4gPSB0ZXh0dXJlMkQoIG5vcm1hbE1hcCwgdk5vcm1hbE1hcFV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHRtYXBOLnh5ICo9IG5vcm1hbFNjYWxlO1xuXHRub3JtYWwgPSBub3JtYWxpemUoIHRibiAqIG1hcE4gKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9CVU1QTUFQIClcblx0bm9ybWFsID0gcGVydHVyYk5vcm1hbEFyYiggLSB2Vmlld1Bvc2l0aW9uLCBub3JtYWwsIGRIZHh5X2Z3ZCgpLCBmYWNlRGlyZWN0aW9uICk7XG4jZW5kaWYiOwoKICAgIHZhciBub3JtYWxfcGFyc19mcmFnbWVudCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgbm9ybWFsX3BhcnNfdmVydGV4ID0gIiNpZm5kZWYgRkxBVF9TSEFERURcblx0dmFyeWluZyB2ZWMzIHZOb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZhcnlpbmcgdmVjMyB2VGFuZ2VudDtcblx0XHR2YXJ5aW5nIHZlYzMgdkJpdGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBub3JtYWxfdmVydGV4ID0gIiNpZm5kZWYgRkxBVF9TSEFERURcblx0dk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dlRhbmdlbnQgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkVGFuZ2VudCApO1xuXHRcdHZCaXRhbmdlbnQgPSBub3JtYWxpemUoIGNyb3NzKCB2Tm9ybWFsLCB2VGFuZ2VudCApICogdGFuZ2VudC53ICk7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbm9ybWFsTWFwO1xuXHR1bmlmb3JtIHZlYzIgbm9ybWFsU2NhbGU7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQX09CSkVDVFNQQUNFXG5cdHVuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7XG4jZW5kaWZcbiNpZiAhIGRlZmluZWQgKCBVU0VfVEFOR0VOVCApICYmICggZGVmaW5lZCAoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFICkgfHwgZGVmaW5lZCAoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKSApXG5cdG1hdDMgZ2V0VGFuZ2VudEZyYW1lKCB2ZWMzIGV5ZV9wb3MsIHZlYzMgc3VyZl9ub3JtLCB2ZWMyIHV2ICkge1xuXHRcdHZlYzMgcTAgPSBkRmR4KCBleWVfcG9zLnh5eiApO1xuXHRcdHZlYzMgcTEgPSBkRmR5KCBleWVfcG9zLnh5eiApO1xuXHRcdHZlYzIgc3QwID0gZEZkeCggdXYuc3QgKTtcblx0XHR2ZWMyIHN0MSA9IGRGZHkoIHV2LnN0ICk7XG5cdFx0dmVjMyBOID0gc3VyZl9ub3JtO1xuXHRcdHZlYzMgcTFwZXJwID0gY3Jvc3MoIHExLCBOICk7XG5cdFx0dmVjMyBxMHBlcnAgPSBjcm9zcyggTiwgcTAgKTtcblx0XHR2ZWMzIFQgPSBxMXBlcnAgKiBzdDAueCArIHEwcGVycCAqIHN0MS54O1xuXHRcdHZlYzMgQiA9IHExcGVycCAqIHN0MC55ICsgcTBwZXJwICogc3QxLnk7XG5cdFx0ZmxvYXQgZGV0ID0gbWF4KCBkb3QoIFQsIFQgKSwgZG90KCBCLCBCICkgKTtcblx0XHRmbG9hdCBzY2FsZSA9ICggZGV0ID09IDAuMCApID8gMC4wIDogaW52ZXJzZXNxcnQoIGRldCApO1xuXHRcdHJldHVybiBtYXQzKCBUICogc2NhbGUsIEIgKiBzY2FsZSwgTiApO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciBjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X2JlZ2luID0gIiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHZlYzMgY2xlYXJjb2F0Tm9ybWFsID0gbm9uUGVydHVyYmVkTm9ybWFsO1xuI2VuZGlmIjsKCiAgICB2YXIgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9tYXBzID0gIiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2ZWMzIGNsZWFyY29hdE1hcE4gPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE5vcm1hbE1hcCwgdkNsZWFyY29hdE5vcm1hbE1hcFV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHRjbGVhcmNvYXRNYXBOLnh5ICo9IGNsZWFyY29hdE5vcm1hbFNjYWxlO1xuXHRjbGVhcmNvYXROb3JtYWwgPSBub3JtYWxpemUoIHRibjIgKiBjbGVhcmNvYXRNYXBOICk7XG4jZW5kaWYiOwoKICAgIHZhciBjbGVhcmNvYXRfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXRNYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXROb3JtYWxNYXA7XG5cdHVuaWZvcm0gdmVjMiBjbGVhcmNvYXROb3JtYWxTY2FsZTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGNsZWFyY29hdFJvdWdobmVzc01hcDtcbiNlbmRpZiI7CgogICAgdmFyIGlyaWRlc2NlbmNlX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBpcmlkZXNjZW5jZU1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgaXJpZGVzY2VuY2VUaGlja25lc3NNYXA7XG4jZW5kaWYiOwoKICAgIHZhciBvcGFxdWVfZnJhZ21lbnQgPSAiI2lmZGVmIE9QQVFVRVxuZGlmZnVzZUNvbG9yLmEgPSAxLjA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5kaWZmdXNlQ29sb3IuYSAqPSBtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYTtcbiNlbmRpZlxuZ2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTsiOwoKICAgIHZhciBwYWNraW5nID0gInZlYzMgcGFja05vcm1hbFRvUkdCKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggbm9ybWFsICkgKiAwLjUgKyAwLjU7XG59XG52ZWMzIHVucGFja1JHQlRvTm9ybWFsKCBjb25zdCBpbiB2ZWMzIHJnYiApIHtcblx0cmV0dXJuIDIuMCAqIHJnYi54eXogLSAxLjA7XG59XG5jb25zdCBmbG9hdCBQYWNrVXBzY2FsZSA9IDI1Ni4gLyAyNTUuO2NvbnN0IGZsb2F0IFVucGFja0Rvd25zY2FsZSA9IDI1NS4gLyAyNTYuO2NvbnN0IGZsb2F0IFNoaWZ0UmlnaHQ4ID0gMS4gLyAyNTYuO1xuY29uc3QgZmxvYXQgSW52MjU1ID0gMS4gLyAyNTUuO1xuY29uc3QgdmVjNCBQYWNrRmFjdG9ycyA9IHZlYzQoIDEuMCwgMjU2LjAsIDI1Ni4wICogMjU2LjAsIDI1Ni4wICogMjU2LjAgKiAyNTYuMCApO1xuY29uc3QgdmVjMiBVbnBhY2tGYWN0b3JzMiA9IHZlYzIoIFVucGFja0Rvd25zY2FsZSwgMS4wIC8gUGFja0ZhY3RvcnMuZyApO1xuY29uc3QgdmVjMyBVbnBhY2tGYWN0b3JzMyA9IHZlYzMoIFVucGFja0Rvd25zY2FsZSAvIFBhY2tGYWN0b3JzLnJnLCAxLjAgLyBQYWNrRmFjdG9ycy5iICk7XG5jb25zdCB2ZWM0IFVucGFja0ZhY3RvcnM0ID0gdmVjNCggVW5wYWNrRG93bnNjYWxlIC8gUGFja0ZhY3RvcnMucmdiLCAxLjAgLyBQYWNrRmFjdG9ycy5hICk7XG52ZWM0IHBhY2tEZXB0aFRvUkdCQSggY29uc3QgaW4gZmxvYXQgdiApIHtcblx0aWYoIHYgPD0gMC4wIClcblx0XHRyZXR1cm4gdmVjNCggMC4sIDAuLCAwLiwgMC4gKTtcblx0aWYoIHYgPj0gMS4wIClcblx0XHRyZXR1cm4gdmVjNCggMS4sIDEuLCAxLiwgMS4gKTtcblx0ZmxvYXQgdnVmO1xuXHRmbG9hdCBhZiA9IG1vZGYoIHYgKiBQYWNrRmFjdG9ycy5hLCB2dWYgKTtcblx0ZmxvYXQgYmYgPSBtb2RmKCB2dWYgKiBTaGlmdFJpZ2h0OCwgdnVmICk7XG5cdGZsb2F0IGdmID0gbW9kZiggdnVmICogU2hpZnRSaWdodDgsIHZ1ZiApO1xuXHRyZXR1cm4gdmVjNCggdnVmICogSW52MjU1LCBnZiAqIFBhY2tVcHNjYWxlLCBiZiAqIFBhY2tVcHNjYWxlLCBhZiApO1xufVxudmVjMyBwYWNrRGVwdGhUb1JHQiggY29uc3QgaW4gZmxvYXQgdiApIHtcblx0aWYoIHYgPD0gMC4wIClcblx0XHRyZXR1cm4gdmVjMyggMC4sIDAuLCAwLiApO1xuXHRpZiggdiA+PSAxLjAgKVxuXHRcdHJldHVybiB2ZWMzKCAxLiwgMS4sIDEuICk7XG5cdGZsb2F0IHZ1Zjtcblx0ZmxvYXQgYmYgPSBtb2RmKCB2ICogUGFja0ZhY3RvcnMuYiwgdnVmICk7XG5cdGZsb2F0IGdmID0gbW9kZiggdnVmICogU2hpZnRSaWdodDgsIHZ1ZiApO1xuXHRyZXR1cm4gdmVjMyggdnVmICogSW52MjU1LCBnZiAqIFBhY2tVcHNjYWxlLCBiZiApO1xufVxudmVjMiBwYWNrRGVwdGhUb1JHKCBjb25zdCBpbiBmbG9hdCB2ICkge1xuXHRpZiggdiA8PSAwLjAgKVxuXHRcdHJldHVybiB2ZWMyKCAwLiwgMC4gKTtcblx0aWYoIHYgPj0gMS4wIClcblx0XHRyZXR1cm4gdmVjMiggMS4sIDEuICk7XG5cdGZsb2F0IHZ1Zjtcblx0ZmxvYXQgZ2YgPSBtb2RmKCB2ICogMjU2LiwgdnVmICk7XG5cdHJldHVybiB2ZWMyKCB2dWYgKiBJbnYyNTUsIGdmICk7XG59XG5mbG9hdCB1bnBhY2tSR0JBVG9EZXB0aCggY29uc3QgaW4gdmVjNCB2ICkge1xuXHRyZXR1cm4gZG90KCB2LCBVbnBhY2tGYWN0b3JzNCApO1xufVxuZmxvYXQgdW5wYWNrUkdCVG9EZXB0aCggY29uc3QgaW4gdmVjMyB2ICkge1xuXHRyZXR1cm4gZG90KCB2LCBVbnBhY2tGYWN0b3JzMyApO1xufVxuZmxvYXQgdW5wYWNrUkdUb0RlcHRoKCBjb25zdCBpbiB2ZWMyIHYgKSB7XG5cdHJldHVybiB2LnIgKiBVbnBhY2tGYWN0b3JzMi5yICsgdi5nICogVW5wYWNrRmFjdG9yczIuZztcbn1cbnZlYzQgcGFjazJIYWxmVG9SR0JBKCBjb25zdCBpbiB2ZWMyIHYgKSB7XG5cdHZlYzQgciA9IHZlYzQoIHYueCwgZnJhY3QoIHYueCAqIDI1NS4wICksIHYueSwgZnJhY3QoIHYueSAqIDI1NS4wICkgKTtcblx0cmV0dXJuIHZlYzQoIHIueCAtIHIueSAvIDI1NS4wLCByLnksIHIueiAtIHIudyAvIDI1NS4wLCByLncgKTtcbn1cbnZlYzIgdW5wYWNrUkdCQVRvMkhhbGYoIGNvbnN0IGluIHZlYzQgdiApIHtcblx0cmV0dXJuIHZlYzIoIHYueCArICggdi55IC8gMjU1LjAgKSwgdi56ICsgKCB2LncgLyAyNTUuMCApICk7XG59XG5mbG9hdCB2aWV3WlRvT3J0aG9ncmFwaGljRGVwdGgoIGNvbnN0IGluIGZsb2F0IHZpZXdaLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG5cdHJldHVybiAoIHZpZXdaICsgbmVhciApIC8gKCBuZWFyIC0gZmFyICk7XG59XG5mbG9hdCBvcnRob2dyYXBoaWNEZXB0aFRvVmlld1ooIGNvbnN0IGluIGZsb2F0IGRlcHRoLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG5cdHJldHVybiBkZXB0aCAqICggbmVhciAtIGZhciApIC0gbmVhcjtcbn1cbmZsb2F0IHZpZXdaVG9QZXJzcGVjdGl2ZURlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCAoIG5lYXIgKyB2aWV3WiApICogZmFyICkgLyAoICggZmFyIC0gbmVhciApICogdmlld1ogKTtcbn1cbmZsb2F0IHBlcnNwZWN0aXZlRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBkZXB0aCwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCBuZWFyICogZmFyICkgLyAoICggZmFyIC0gbmVhciApICogZGVwdGggLSBmYXIgKTtcbn0iOwoKICAgIHZhciBwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50ID0gIiNpZmRlZiBQUkVNVUxUSVBMSUVEX0FMUEhBXG5cdGdsX0ZyYWdDb2xvci5yZ2IgKj0gZ2xfRnJhZ0NvbG9yLmE7XG4jZW5kaWYiOwoKICAgIHZhciBwcm9qZWN0X3ZlcnRleCA9ICJ2ZWM0IG12UG9zaXRpb24gPSB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG4jaWZkZWYgVVNFX0JBVENISU5HXG5cdG12UG9zaXRpb24gPSBiYXRjaGluZ01hdHJpeCAqIG12UG9zaXRpb247XG4jZW5kaWZcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuXHRtdlBvc2l0aW9uID0gaW5zdGFuY2VNYXRyaXggKiBtdlBvc2l0aW9uO1xuI2VuZGlmXG5tdlBvc2l0aW9uID0gbW9kZWxWaWV3TWF0cml4ICogbXZQb3NpdGlvbjtcbmdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG12UG9zaXRpb247IjsKCiAgICB2YXIgZGl0aGVyaW5nX2ZyYWdtZW50ID0gIiNpZmRlZiBESVRIRVJJTkdcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IGRpdGhlcmluZyggZ2xfRnJhZ0NvbG9yLnJnYiApO1xuI2VuZGlmIjsKCiAgICB2YXIgZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIERJVEhFUklOR1xuXHR2ZWMzIGRpdGhlcmluZyggdmVjMyBjb2xvciApIHtcblx0XHRmbG9hdCBncmlkX3Bvc2l0aW9uID0gcmFuZCggZ2xfRnJhZ0Nvb3JkLnh5ICk7XG5cdFx0dmVjMyBkaXRoZXJfc2hpZnRfUkdCID0gdmVjMyggMC4yNSAvIDI1NS4wLCAtMC4yNSAvIDI1NS4wLCAwLjI1IC8gMjU1LjAgKTtcblx0XHRkaXRoZXJfc2hpZnRfUkdCID0gbWl4KCAyLjAgKiBkaXRoZXJfc2hpZnRfUkdCLCAtMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgZ3JpZF9wb3NpdGlvbiApO1xuXHRcdHJldHVybiBjb2xvciArIGRpdGhlcl9zaGlmdF9SR0I7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIHJvdWdobmVzc21hcF9mcmFnbWVudCA9ICJmbG9hdCByb3VnaG5lc3NGYWN0b3IgPSByb3VnaG5lc3M7XG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2ZWM0IHRleGVsUm91Z2huZXNzID0gdGV4dHVyZTJEKCByb3VnaG5lc3NNYXAsIHZSb3VnaG5lc3NNYXBVdiApO1xuXHRyb3VnaG5lc3NGYWN0b3IgKj0gdGV4ZWxSb3VnaG5lc3MuZztcbiNlbmRpZiI7CgogICAgdmFyIHJvdWdobmVzc21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfUk9VR0hORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIHJvdWdobmVzc01hcDtcbiNlbmRpZiI7CgogICAgdmFyIHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRfTUFQUyA+IDBcblx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdExpZ2h0TWFwWyBOVU1fU1BPVF9MSUdIVF9NQVBTIF07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdCNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgZGlyZWN0aW9uYWxTaGFkb3dNYXBbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93SW50ZW5zaXR5O1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdFNoYWRvd01hcFsgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBTcG90TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93SW50ZW5zaXR5O1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3dzWyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgcG9pbnRTaGFkb3dNYXBbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZQb2ludFNoYWRvd0Nvb3JkWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBQb2ludExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhTmVhcjtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYUZhcjtcblx0XHR9O1xuXHRcdHVuaWZvcm0gUG9pbnRMaWdodFNoYWRvdyBwb2ludExpZ2h0U2hhZG93c1sgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdGZsb2F0IHRleHR1cmUyRENvbXBhcmUoIHNhbXBsZXIyRCBkZXB0aHMsIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKSB7XG5cdFx0cmV0dXJuIHN0ZXAoIGNvbXBhcmUsIHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIGRlcHRocywgdXYgKSApICk7XG5cdH1cblx0dmVjMiB0ZXh0dXJlMkREaXN0cmlidXRpb24oIHNhbXBsZXIyRCBzaGFkb3csIHZlYzIgdXYgKSB7XG5cdFx0cmV0dXJuIHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvdywgdXYgKSApO1xuXHR9XG5cdGZsb2F0IFZTTVNoYWRvdyAoc2FtcGxlcjJEIHNoYWRvdywgdmVjMiB1diwgZmxvYXQgY29tcGFyZSApe1xuXHRcdGZsb2F0IG9jY2x1c2lvbiA9IDEuMDtcblx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHRleHR1cmUyRERpc3RyaWJ1dGlvbiggc2hhZG93LCB1diApO1xuXHRcdGZsb2F0IGhhcmRfc2hhZG93ID0gc3RlcCggY29tcGFyZSAsIGRpc3RyaWJ1dGlvbi54ICk7XG5cdFx0aWYgKGhhcmRfc2hhZG93ICE9IDEuMCApIHtcblx0XHRcdGZsb2F0IGRpc3RhbmNlID0gY29tcGFyZSAtIGRpc3RyaWJ1dGlvbi54IDtcblx0XHRcdGZsb2F0IHZhcmlhbmNlID0gbWF4KCAwLjAwMDAwLCBkaXN0cmlidXRpb24ueSAqIGRpc3RyaWJ1dGlvbi55ICk7XG5cdFx0XHRmbG9hdCBzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IHZhcmlhbmNlIC8gKHZhcmlhbmNlICsgZGlzdGFuY2UgKiBkaXN0YW5jZSApO1x0XHRcdHNvZnRuZXNzX3Byb2JhYmlsaXR5ID0gY2xhbXAoICggc29mdG5lc3NfcHJvYmFiaWxpdHkgLSAwLjMgKSAvICggMC45NSAtIDAuMyApLCAwLjAsIDEuMCApO1x0XHRcdG9jY2x1c2lvbiA9IGNsYW1wKCBtYXgoIGhhcmRfc2hhZG93LCBzb2Z0bmVzc19wcm9iYWJpbGl0eSApLCAwLjAsIDEuMCApO1xuXHRcdH1cblx0XHRyZXR1cm4gb2NjbHVzaW9uO1xuXHR9XG5cdGZsb2F0IGdldFNoYWRvdyggc2FtcGxlcjJEIHNoYWRvd01hcCwgdmVjMiBzaGFkb3dNYXBTaXplLCBmbG9hdCBzaGFkb3dJbnRlbnNpdHksIGZsb2F0IHNoYWRvd0JpYXMsIGZsb2F0IHNoYWRvd1JhZGl1cywgdmVjNCBzaGFkb3dDb29yZCApIHtcblx0XHRmbG9hdCBzaGFkb3cgPSAxLjA7XG5cdFx0c2hhZG93Q29vcmQueHl6IC89IHNoYWRvd0Nvb3JkLnc7XG5cdFx0c2hhZG93Q29vcmQueiArPSBzaGFkb3dCaWFzO1xuXHRcdGJvb2wgaW5GcnVzdHVtID0gc2hhZG93Q29vcmQueCA+PSAwLjAgJiYgc2hhZG93Q29vcmQueCA8PSAxLjAgJiYgc2hhZG93Q29vcmQueSA+PSAwLjAgJiYgc2hhZG93Q29vcmQueSA8PSAxLjA7XG5cdFx0Ym9vbCBmcnVzdHVtVGVzdCA9IGluRnJ1c3R1bSAmJiBzaGFkb3dDb29yZC56IDw9IDEuMDtcblx0XHRpZiAoIGZydXN0dW1UZXN0ICkge1xuXHRcdCNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKVxuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBkeDAgPSAtIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkwID0gLSB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MSA9ICsgdGV4ZWxTaXplLnggKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeTEgPSArIHRleGVsU2l6ZS55ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHgyID0gZHgwIC8gMi4wO1xuXHRcdFx0ZmxvYXQgZHkyID0gZHkwIC8gMi4wO1xuXHRcdFx0ZmxvYXQgZHgzID0gZHgxIC8gMi4wO1xuXHRcdFx0ZmxvYXQgZHkzID0gZHkxIC8gMi4wO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgwLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIDAuMCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDEsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgyLCBkeTIgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIDAuMCwgZHkyICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDMsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgwLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDMsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MyApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCBkeTMgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkxICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCBkeTEgKSwgc2hhZG93Q29vcmQueiApXG5cdFx0XHQpICogKCAxLjAgLyAxNy4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQgKVxuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBkeCA9IHRleGVsU2l6ZS54O1xuXHRcdFx0ZmxvYXQgZHkgPSB0ZXhlbFNpemUueTtcblx0XHRcdHZlYzIgdXYgPSBzaGFkb3dDb29yZC54eTtcblx0XHRcdHZlYzIgZiA9IGZyYWN0KCB1diAqIHNoYWRvd01hcFNpemUgKyAwLjUgKTtcblx0XHRcdHV2IC09IGYgKiB0ZXhlbFNpemU7XG5cdFx0XHRzaGFkb3cgPSAoXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYsIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAwLjAsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB0ZXhlbFNpemUsIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdG1peCggdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIC1keCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCAwLjAgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCBmLnggKSArXG5cdFx0XHRcdG1peCggdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIC1keCwgZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi54ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAwLjAsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAwLjAsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi55ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgLWR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIGR4LCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueSApICtcblx0XHRcdFx0bWl4KCBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgLWR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgZi54ICksXG5cdFx0XHRcdFx0IG1peCggdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIC1keCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdFx0ICB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgZi54ICksXG5cdFx0XHRcdFx0IGYueSApXG5cdFx0XHQpICogKCAxLjAgLyA5LjAgKTtcblx0XHQjZWxpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9WU00gKVxuXHRcdFx0c2hhZG93ID0gVlNNU2hhZG93KCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHNoYWRvdyA9IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHksIHNoYWRvd0Nvb3JkLnogKTtcblx0XHQjZW5kaWZcblx0XHR9XG5cdFx0cmV0dXJuIG1peCggMS4wLCBzaGFkb3csIHNoYWRvd0ludGVuc2l0eSApO1xuXHR9XG5cdHZlYzIgY3ViZVRvVVYoIHZlYzMgdiwgZmxvYXQgdGV4ZWxTaXplWSApIHtcblx0XHR2ZWMzIGFic1YgPSBhYnMoIHYgKTtcblx0XHRmbG9hdCBzY2FsZVRvQ3ViZSA9IDEuMCAvIG1heCggYWJzVi54LCBtYXgoIGFic1YueSwgYWJzVi56ICkgKTtcblx0XHRhYnNWICo9IHNjYWxlVG9DdWJlO1xuXHRcdHYgKj0gc2NhbGVUb0N1YmUgKiAoIDEuMCAtIDIuMCAqIHRleGVsU2l6ZVkgKTtcblx0XHR2ZWMyIHBsYW5hciA9IHYueHk7XG5cdFx0ZmxvYXQgYWxtb3N0QVRleGVsID0gMS41ICogdGV4ZWxTaXplWTtcblx0XHRmbG9hdCBhbG1vc3RPbmUgPSAxLjAgLSBhbG1vc3RBVGV4ZWw7XG5cdFx0aWYgKCBhYnNWLnogPj0gYWxtb3N0T25lICkge1xuXHRcdFx0aWYgKCB2LnogPiAwLjAgKVxuXHRcdFx0XHRwbGFuYXIueCA9IDQuMCAtIHYueDtcblx0XHR9IGVsc2UgaWYgKCBhYnNWLnggPj0gYWxtb3N0T25lICkge1xuXHRcdFx0ZmxvYXQgc2lnblggPSBzaWduKCB2LnggKTtcblx0XHRcdHBsYW5hci54ID0gdi56ICogc2lnblggKyAyLjAgKiBzaWduWDtcblx0XHR9IGVsc2UgaWYgKCBhYnNWLnkgPj0gYWxtb3N0T25lICkge1xuXHRcdFx0ZmxvYXQgc2lnblkgPSBzaWduKCB2LnkgKTtcblx0XHRcdHBsYW5hci54ID0gdi54ICsgMi4wICogc2lnblkgKyAyLjA7XG5cdFx0XHRwbGFuYXIueSA9IHYueiAqIHNpZ25ZIC0gMi4wO1xuXHRcdH1cblx0XHRyZXR1cm4gdmVjMiggMC4xMjUsIDAuMjUgKSAqIHBsYW5hciArIHZlYzIoIDAuMzc1LCAwLjc1ICk7XG5cdH1cblx0ZmxvYXQgZ2V0UG9pbnRTaGFkb3coIHNhbXBsZXIyRCBzaGFkb3dNYXAsIHZlYzIgc2hhZG93TWFwU2l6ZSwgZmxvYXQgc2hhZG93SW50ZW5zaXR5LCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQsIGZsb2F0IHNoYWRvd0NhbWVyYU5lYXIsIGZsb2F0IHNoYWRvd0NhbWVyYUZhciApIHtcblx0XHRmbG9hdCBzaGFkb3cgPSAxLjA7XG5cdFx0dmVjMyBsaWdodFRvUG9zaXRpb24gPSBzaGFkb3dDb29yZC54eXo7XG5cdFx0XG5cdFx0ZmxvYXQgbGlnaHRUb1Bvc2l0aW9uTGVuZ3RoID0gbGVuZ3RoKCBsaWdodFRvUG9zaXRpb24gKTtcblx0XHRpZiAoIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYUZhciA8PSAwLjAgJiYgbGlnaHRUb1Bvc2l0aW9uTGVuZ3RoIC0gc2hhZG93Q2FtZXJhTmVhciA+PSAwLjAgKSB7XG5cdFx0XHRmbG9hdCBkcCA9ICggbGlnaHRUb1Bvc2l0aW9uTGVuZ3RoIC0gc2hhZG93Q2FtZXJhTmVhciApIC8gKCBzaGFkb3dDYW1lcmFGYXIgLSBzaGFkb3dDYW1lcmFOZWFyICk7XHRcdFx0ZHAgKz0gc2hhZG93Qmlhcztcblx0XHRcdHZlYzMgYmQzRCA9IG5vcm1hbGl6ZSggbGlnaHRUb1Bvc2l0aW9uICk7XG5cdFx0XHR2ZWMyIHRleGVsU2l6ZSA9IHZlYzIoIDEuMCApIC8gKCBzaGFkb3dNYXBTaXplICogdmVjMiggNC4wLCAyLjAgKSApO1xuXHRcdFx0I2lmIGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRiApIHx8IGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRl9TT0ZUICkgfHwgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcblx0XHRcdFx0dmVjMiBvZmZzZXQgPSB2ZWMyKCAtIDEsIDEgKSAqIHNoYWRvd1JhZGl1cyAqIHRleGVsU2l6ZS55O1xuXHRcdFx0XHRzaGFkb3cgPSAoXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXl5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh5eCwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eHgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXh4LCB0ZXhlbFNpemUueSApLCBkcCApXG5cdFx0XHRcdCkgKiAoIDEuMCAvIDkuMCApO1xuXHRcdFx0I2Vsc2Vcblx0XHRcdFx0c2hhZG93ID0gdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCwgdGV4ZWxTaXplLnkgKSwgZHAgKTtcblx0XHRcdCNlbmRpZlxuXHRcdH1cblx0XHRyZXR1cm4gbWl4KCAxLjAsIHNoYWRvdywgc2hhZG93SW50ZW5zaXR5ICk7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIHNoYWRvd21hcF9wYXJzX3ZlcnRleCA9ICIjaWYgTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMFxuXHR1bmlmb3JtIG1hdDQgc3BvdExpZ2h0TWF0cml4WyBOVU1fU1BPVF9MSUdIVF9DT09SRFMgXTtcblx0dmFyeWluZyB2ZWM0IHZTcG90TGlnaHRDb29yZFsgTlVNX1NQT1RfTElHSFRfQ09PUkRTIF07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdCNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBtYXQ0IGRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHN0cnVjdCBTcG90TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93SW50ZW5zaXR5O1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3dzWyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBtYXQ0IHBvaW50U2hhZG93TWF0cml4WyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2UG9pbnRTaGFkb3dDb29yZFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgUG9pbnRMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYU5lYXI7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFGYXI7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvd3NbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuI2VuZGlmIjsKCiAgICB2YXIgc2hhZG93bWFwX3ZlcnRleCA9ICIjaWYgKCBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgKCBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwIHx8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMCApICkgfHwgKCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwIClcblx0dmVjMyBzaGFkb3dXb3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzQgc2hhZG93V29ybGRQb3NpdGlvbjtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKVxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0XHRzaGFkb3dXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbiArIHZlYzQoIHNoYWRvd1dvcmxkTm9ybWFsICogZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzLCAwICk7XG5cdFx0XHR2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdID0gZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXhbIGkgXSAqIHNoYWRvd1dvcmxkUG9zaXRpb247XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24gKyB2ZWM0KCBzaGFkb3dXb3JsZE5vcm1hbCAqIHBvaW50TGlnaHRTaGFkb3dzWyBpIF0uc2hhZG93Tm9ybWFsQmlhcywgMCApO1xuXHRcdFx0dlBvaW50U2hhZG93Q29vcmRbIGkgXSA9IHBvaW50U2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fU1BPVF9MSUdIVF9DT09SRFM7IGkgKysgKSB7XG5cdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb247XG5cdFx0I2lmICggZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRcdHNoYWRvd1dvcmxkUG9zaXRpb24ueHl6ICs9IHNoYWRvd1dvcmxkTm9ybWFsICogc3BvdExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXM7XG5cdFx0I2VuZGlmXG5cdFx0dlNwb3RMaWdodENvb3JkWyBpIF0gPSBzcG90TGlnaHRNYXRyaXhbIGkgXSAqIHNoYWRvd1dvcmxkUG9zaXRpb247XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZiI7CgogICAgdmFyIHNoYWRvd21hc2tfcGFyc19mcmFnbWVudCA9ICJmbG9hdCBnZXRTaGFkb3dNYXNrKCkge1xuXHRmbG9hdCBzaGFkb3cgPSAxLjA7XG5cdCNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdCNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodDtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0ZGlyZWN0aW9uYWxMaWdodCA9IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dJbnRlbnNpdHksIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93QmlhcywgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dSYWRpdXMsIHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBpIF0gKSA6IDEuMDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRzcG90TGlnaHQgPSBzcG90TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRTaGFkb3coIHNwb3RTaGFkb3dNYXBbIGkgXSwgc3BvdExpZ2h0LnNoYWRvd01hcFNpemUsIHNwb3RMaWdodC5zaGFkb3dJbnRlbnNpdHksIHNwb3RMaWdodC5zaGFkb3dCaWFzLCBzcG90TGlnaHQuc2hhZG93UmFkaXVzLCB2U3BvdExpZ2h0Q29vcmRbIGkgXSApIDogMS4wO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodDtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRwb2ludExpZ2h0ID0gcG9pbnRMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRzaGFkb3cgKj0gcmVjZWl2ZVNoYWRvdyA/IGdldFBvaW50U2hhZG93KCBwb2ludFNoYWRvd01hcFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd01hcFNpemUsIHBvaW50TGlnaHQuc2hhZG93SW50ZW5zaXR5LCBwb2ludExpZ2h0LnNoYWRvd0JpYXMsIHBvaW50TGlnaHQuc2hhZG93UmFkaXVzLCB2UG9pbnRTaGFkb3dDb29yZFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYU5lYXIsIHBvaW50TGlnaHQuc2hhZG93Q2FtZXJhRmFyICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNlbmRpZlxuXHRyZXR1cm4gc2hhZG93O1xufSI7CgogICAgdmFyIHNraW5iYXNlX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdG1hdDQgYm9uZU1hdFggPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueCApO1xuXHRtYXQ0IGJvbmVNYXRZID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnkgKTtcblx0bWF0NCBib25lTWF0WiA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC56ICk7XG5cdG1hdDQgYm9uZU1hdFcgPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgudyApO1xuI2VuZGlmIjsKCiAgICB2YXIgc2tpbm5pbmdfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHR1bmlmb3JtIG1hdDQgYmluZE1hdHJpeDtcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXhJbnZlcnNlO1xuXHR1bmlmb3JtIGhpZ2hwIHNhbXBsZXIyRCBib25lVGV4dHVyZTtcblx0bWF0NCBnZXRCb25lTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJvbmVUZXh0dXJlLCAwICkueDtcblx0XHRpbnQgaiA9IGludCggaSApICogNDtcblx0XHRpbnQgeCA9IGogJSBzaXplO1xuXHRcdGludCB5ID0gaiAvIHNpemU7XG5cdFx0dmVjNCB2MSA9IHRleGVsRmV0Y2goIGJvbmVUZXh0dXJlLCBpdmVjMiggeCwgeSApLCAwICk7XG5cdFx0dmVjNCB2MiA9IHRleGVsRmV0Y2goIGJvbmVUZXh0dXJlLCBpdmVjMiggeCArIDEsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjMgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHggKyAyLCB5ICksIDAgKTtcblx0XHR2ZWM0IHY0ID0gdGV4ZWxGZXRjaCggYm9uZVRleHR1cmUsIGl2ZWMyKCB4ICsgMywgeSApLCAwICk7XG5cdFx0cmV0dXJuIG1hdDQoIHYxLCB2MiwgdjMsIHY0ICk7XG5cdH1cbiNlbmRpZiI7CgogICAgdmFyIHNraW5uaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdHZlYzQgc2tpblZlcnRleCA9IGJpbmRNYXRyaXggKiB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG5cdHZlYzQgc2tpbm5lZCA9IHZlYzQoIDAuMCApO1xuXHRza2lubmVkICs9IGJvbmVNYXRYICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQueDtcblx0c2tpbm5lZCArPSBib25lTWF0WSAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnk7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFogKiBza2luVmVydGV4ICogc2tpbldlaWdodC56O1xuXHRza2lubmVkICs9IGJvbmVNYXRXICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQudztcblx0dHJhbnNmb3JtZWQgPSAoIGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbm5lZCApLnh5ejtcbiNlbmRpZiI7CgogICAgdmFyIHNraW5ub3JtYWxfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0bWF0NCBza2luTWF0cml4ID0gbWF0NCggMC4wICk7XG5cdHNraW5NYXRyaXggKz0gc2tpbldlaWdodC54ICogYm9uZU1hdFg7XG5cdHNraW5NYXRyaXggKz0gc2tpbldlaWdodC55ICogYm9uZU1hdFk7XG5cdHNraW5NYXRyaXggKz0gc2tpbldlaWdodC56ICogYm9uZU1hdFo7XG5cdHNraW5NYXRyaXggKz0gc2tpbldlaWdodC53ICogYm9uZU1hdFc7XG5cdHNraW5NYXRyaXggPSBiaW5kTWF0cml4SW52ZXJzZSAqIHNraW5NYXRyaXggKiBiaW5kTWF0cml4O1xuXHRvYmplY3ROb3JtYWwgPSB2ZWM0KCBza2luTWF0cml4ICogdmVjNCggb2JqZWN0Tm9ybWFsLCAwLjAgKSApLnh5ejtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0b2JqZWN0VGFuZ2VudCA9IHZlYzQoIHNraW5NYXRyaXggKiB2ZWM0KCBvYmplY3RUYW5nZW50LCAwLjAgKSApLnh5ejtcblx0I2VuZGlmXG4jZW5kaWYiOwoKICAgIHZhciBzcGVjdWxhcm1hcF9mcmFnbWVudCA9ICJmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xuI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR2ZWM0IHRleGVsU3BlY3VsYXIgPSB0ZXh0dXJlMkQoIHNwZWN1bGFyTWFwLCB2U3BlY3VsYXJNYXBVdiApO1xuXHRzcGVjdWxhclN0cmVuZ3RoID0gdGV4ZWxTcGVjdWxhci5yO1xuI2Vsc2Vcblx0c3BlY3VsYXJTdHJlbmd0aCA9IDEuMDtcbiNlbmRpZiI7CgogICAgdmFyIHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhck1hcDtcbiNlbmRpZiI7CgogICAgdmFyIHRvbmVtYXBwaW5nX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBUT05FX01BUFBJTkcgKVxuXHRnbF9GcmFnQ29sb3IucmdiID0gdG9uZU1hcHBpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7CgogICAgdmFyIHRvbmVtYXBwaW5nX3BhcnNfZnJhZ21lbnQgPSAiI2lmbmRlZiBzYXR1cmF0ZVxuI2RlZmluZSBzYXR1cmF0ZSggYSApIGNsYW1wKCBhLCAwLjAsIDEuMCApXG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgdG9uZU1hcHBpbmdFeHBvc3VyZTtcbnZlYzMgTGluZWFyVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdHJldHVybiBzYXR1cmF0ZSggdG9uZU1hcHBpbmdFeHBvc3VyZSAqIGNvbG9yICk7XG59XG52ZWMzIFJlaW5oYXJkVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdHJldHVybiBzYXR1cmF0ZSggY29sb3IgLyAoIHZlYzMoIDEuMCApICsgY29sb3IgKSApO1xufVxudmVjMyBDaW5lb25Ub25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0Y29sb3IgPSBtYXgoIHZlYzMoIDAuMCApLCBjb2xvciAtIDAuMDA0ICk7XG5cdHJldHVybiBwb3coICggY29sb3IgKiAoIDYuMiAqIGNvbG9yICsgMC41ICkgKSAvICggY29sb3IgKiAoIDYuMiAqIGNvbG9yICsgMS43ICkgKyAwLjA2ICksIHZlYzMoIDIuMiApICk7XG59XG52ZWMzIFJSVEFuZE9EVEZpdCggdmVjMyB2ICkge1xuXHR2ZWMzIGEgPSB2ICogKCB2ICsgMC4wMjQ1Nzg2ICkgLSAwLjAwMDA5MDUzNztcblx0dmVjMyBiID0gdiAqICggMC45ODM3MjkgKiB2ICsgMC40MzI5NTEwICkgKyAwLjIzODA4MTtcblx0cmV0dXJuIGEgLyBiO1xufVxudmVjMyBBQ0VTRmlsbWljVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbnN0IG1hdDMgQUNFU0lucHV0TWF0ID0gbWF0Myhcblx0XHR2ZWMzKCAwLjU5NzE5LCAwLjA3NjAwLCAwLjAyODQwICksXHRcdHZlYzMoIDAuMzU0NTgsIDAuOTA4MzQsIDAuMTMzODMgKSxcblx0XHR2ZWMzKCAwLjA0ODIzLCAwLjAxNTY2LCAwLjgzNzc3IClcblx0KTtcblx0Y29uc3QgbWF0MyBBQ0VTT3V0cHV0TWF0ID0gbWF0Myhcblx0XHR2ZWMzKCAgMS42MDQ3NSwgLTAuMTAyMDgsIC0wLjAwMzI3ICksXHRcdHZlYzMoIC0wLjUzMTA4LCAgMS4xMDgxMywgLTAuMDcyNzYgKSxcblx0XHR2ZWMzKCAtMC4wNzM2NywgLTAuMDA2MDUsICAxLjA3NjAyIClcblx0KTtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZSAvIDAuNjtcblx0Y29sb3IgPSBBQ0VTSW5wdXRNYXQgKiBjb2xvcjtcblx0Y29sb3IgPSBSUlRBbmRPRFRGaXQoIGNvbG9yICk7XG5cdGNvbG9yID0gQUNFU091dHB1dE1hdCAqIGNvbG9yO1xuXHRyZXR1cm4gc2F0dXJhdGUoIGNvbG9yICk7XG59XG5jb25zdCBtYXQzIExJTkVBUl9SRUMyMDIwX1RPX0xJTkVBUl9TUkdCID0gbWF0Myhcblx0dmVjMyggMS42NjA1LCAtIDAuMTI0NiwgLSAwLjAxODIgKSxcblx0dmVjMyggLSAwLjU4NzYsIDEuMTMyOSwgLSAwLjEwMDYgKSxcblx0dmVjMyggLSAwLjA3MjgsIC0gMC4wMDgzLCAxLjExODcgKVxuKTtcbmNvbnN0IG1hdDMgTElORUFSX1NSR0JfVE9fTElORUFSX1JFQzIwMjAgPSBtYXQzKFxuXHR2ZWMzKCAwLjYyNzQsIDAuMDY5MSwgMC4wMTY0ICksXG5cdHZlYzMoIDAuMzI5MywgMC45MTk1LCAwLjA4ODAgKSxcblx0dmVjMyggMC4wNDMzLCAwLjAxMTMsIDAuODk1NiApXG4pO1xudmVjMyBhZ3hEZWZhdWx0Q29udHJhc3RBcHByb3goIHZlYzMgeCApIHtcblx0dmVjMyB4MiA9IHggKiB4O1xuXHR2ZWMzIHg0ID0geDIgKiB4Mjtcblx0cmV0dXJuICsgMTUuNSAqIHg0ICogeDJcblx0XHQtIDQwLjE0ICogeDQgKiB4XG5cdFx0KyAzMS45NiAqIHg0XG5cdFx0LSA2Ljg2OCAqIHgyICogeFxuXHRcdCsgMC40Mjk4ICogeDJcblx0XHQrIDAuMTE5MSAqIHhcblx0XHQtIDAuMDAyMzI7XG59XG52ZWMzIEFnWFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBtYXQzIEFnWEluc2V0TWF0cml4ID0gbWF0Myhcblx0XHR2ZWMzKCAwLjg1NjYyNzE1MzMxNTk4MywgMC4xMzczMTg5NzI5Mjk4NDcsIDAuMTExODk4MjEyOTk5OTUgKSxcblx0XHR2ZWMzKCAwLjA5NTEyMTI0MDUzODE1ODgsIDAuNzYxMjQxOTkwNjAyNTkxLCAwLjA3Njc5OTQxODYwMzE5MDMgKSxcblx0XHR2ZWMzKCAwLjA0ODI1MTYwNjE0NTg1ODMsIDAuMTAxNDM5MDM2NDY3NTYyLCAwLjgxMTMwMjM2ODM5Njg1OSApXG5cdCk7XG5cdGNvbnN0IG1hdDMgQWdYT3V0c2V0TWF0cml4ID0gbWF0Myhcblx0XHR2ZWMzKCAxLjEyNzEwMDU4MTgxNDQzNjgsIC0gMC4xNDEzMjk3NjM0OTg0MzgzLCAtIDAuMTQxMzI5NzYzNDk4NDM4MjYgKSxcblx0XHR2ZWMzKCAtIDAuMTEwNjA2NjQzMDk2NjAzMjMsIDEuMTU3ODIzNzAyMjE2MjcyLCAtIDAuMTEwNjA2NjQzMDk2NjAyOTQgKSxcblx0XHR2ZWMzKCAtIDAuMDE2NDkzOTM4NzE3ODM0NTczLCAtIDAuMDE2NDkzOTM4NzE3ODM0MjU3LCAxLjI1MTkzNjQwNjU5NTA0MDUgKVxuXHQpO1xuXHRjb25zdCBmbG9hdCBBZ3hNaW5FdiA9IC0gMTIuNDczOTM7XHRjb25zdCBmbG9hdCBBZ3hNYXhFdiA9IDQuMDI2MDY5O1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRjb2xvciA9IExJTkVBUl9TUkdCX1RPX0xJTkVBUl9SRUMyMDIwICogY29sb3I7XG5cdGNvbG9yID0gQWdYSW5zZXRNYXRyaXggKiBjb2xvcjtcblx0Y29sb3IgPSBtYXgoIGNvbG9yLCAxZS0xMCApO1x0Y29sb3IgPSBsb2cyKCBjb2xvciApO1xuXHRjb2xvciA9ICggY29sb3IgLSBBZ3hNaW5FdiApIC8gKCBBZ3hNYXhFdiAtIEFneE1pbkV2ICk7XG5cdGNvbG9yID0gY2xhbXAoIGNvbG9yLCAwLjAsIDEuMCApO1xuXHRjb2xvciA9IGFneERlZmF1bHRDb250cmFzdEFwcHJveCggY29sb3IgKTtcblx0Y29sb3IgPSBBZ1hPdXRzZXRNYXRyaXggKiBjb2xvcjtcblx0Y29sb3IgPSBwb3coIG1heCggdmVjMyggMC4wICksIGNvbG9yICksIHZlYzMoIDIuMiApICk7XG5cdGNvbG9yID0gTElORUFSX1JFQzIwMjBfVE9fTElORUFSX1NSR0IgKiBjb2xvcjtcblx0Y29sb3IgPSBjbGFtcCggY29sb3IsIDAuMCwgMS4wICk7XG5cdHJldHVybiBjb2xvcjtcbn1cbnZlYzMgTmV1dHJhbFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBmbG9hdCBTdGFydENvbXByZXNzaW9uID0gMC44IC0gMC4wNDtcblx0Y29uc3QgZmxvYXQgRGVzYXR1cmF0aW9uID0gMC4xNTtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0ZmxvYXQgeCA9IG1pbiggY29sb3IuciwgbWluKCBjb2xvci5nLCBjb2xvci5iICkgKTtcblx0ZmxvYXQgb2Zmc2V0ID0geCA8IDAuMDggPyB4IC0gNi4yNSAqIHggKiB4IDogMC4wNDtcblx0Y29sb3IgLT0gb2Zmc2V0O1xuXHRmbG9hdCBwZWFrID0gbWF4KCBjb2xvci5yLCBtYXgoIGNvbG9yLmcsIGNvbG9yLmIgKSApO1xuXHRpZiAoIHBlYWsgPCBTdGFydENvbXByZXNzaW9uICkgcmV0dXJuIGNvbG9yO1xuXHRmbG9hdCBkID0gMS4gLSBTdGFydENvbXByZXNzaW9uO1xuXHRmbG9hdCBuZXdQZWFrID0gMS4gLSBkICogZCAvICggcGVhayArIGQgLSBTdGFydENvbXByZXNzaW9uICk7XG5cdGNvbG9yICo9IG5ld1BlYWsgLyBwZWFrO1xuXHRmbG9hdCBnID0gMS4gLSAxLiAvICggRGVzYXR1cmF0aW9uICogKCBwZWFrIC0gbmV3UGVhayApICsgMS4gKTtcblx0cmV0dXJuIG1peCggY29sb3IsIHZlYzMoIG5ld1BlYWsgKSwgZyApO1xufVxudmVjMyBDdXN0b21Ub25lTWFwcGluZyggdmVjMyBjb2xvciApIHsgcmV0dXJuIGNvbG9yOyB9IjsKCiAgICB2YXIgdHJhbnNtaXNzaW9uX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA9IHRyYW5zbWlzc2lvbjtcblx0bWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGEgPSAxLjA7XG5cdG1hdGVyaWFsLnRoaWNrbmVzcyA9IHRoaWNrbmVzcztcblx0bWF0ZXJpYWwuYXR0ZW51YXRpb25EaXN0YW5jZSA9IGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IgPSBhdHRlbnVhdGlvbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHRcdG1hdGVyaWFsLnRyYW5zbWlzc2lvbiAqPSB0ZXh0dXJlMkQoIHRyYW5zbWlzc2lvbk1hcCwgdlRyYW5zbWlzc2lvbk1hcFV2ICkucjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdFx0bWF0ZXJpYWwudGhpY2tuZXNzICo9IHRleHR1cmUyRCggdGhpY2tuZXNzTWFwLCB2VGhpY2tuZXNzTWFwVXYgKS5nO1xuXHQjZW5kaWZcblx0dmVjMyBwb3MgPSB2V29ybGRQb3NpdGlvbjtcblx0dmVjMyB2ID0gbm9ybWFsaXplKCBjYW1lcmFQb3NpdGlvbiAtIHBvcyApO1xuXHR2ZWMzIG4gPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0dmVjNCB0cmFuc21pdHRlZCA9IGdldElCTFZvbHVtZVJlZnJhY3Rpb24oXG5cdFx0biwgdiwgbWF0ZXJpYWwucm91Z2huZXNzLCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyRjkwLFxuXHRcdHBvcywgbW9kZWxNYXRyaXgsIHZpZXdNYXRyaXgsIHByb2plY3Rpb25NYXRyaXgsIG1hdGVyaWFsLmRpc3BlcnNpb24sIG1hdGVyaWFsLmlvciwgbWF0ZXJpYWwudGhpY2tuZXNzLFxuXHRcdG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IsIG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2UgKTtcblx0bWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGEgPSBtaXgoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhLCB0cmFuc21pdHRlZC5hLCBtYXRlcmlhbC50cmFuc21pc3Npb24gKTtcblx0dG90YWxEaWZmdXNlID0gbWl4KCB0b3RhbERpZmZ1c2UsIHRyYW5zbWl0dGVkLnJnYiwgbWF0ZXJpYWwudHJhbnNtaXNzaW9uICk7XG4jZW5kaWYiOwoKICAgIHZhciB0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHR1bmlmb3JtIGZsb2F0IHRyYW5zbWlzc2lvbjtcblx0dW5pZm9ybSBmbG9hdCB0aGlja25lc3M7XG5cdHVuaWZvcm0gZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0dW5pZm9ybSB2ZWMzIGF0dGVudWF0aW9uQ29sb3I7XG5cdCNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgdHJhbnNtaXNzaW9uTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9USElDS05FU1NNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCB0aGlja25lc3NNYXA7XG5cdCNlbmRpZlxuXHR1bmlmb3JtIHZlYzIgdHJhbnNtaXNzaW9uU2FtcGxlclNpemU7XG5cdHVuaWZvcm0gc2FtcGxlcjJEIHRyYW5zbWlzc2lvblNhbXBsZXJNYXA7XG5cdHVuaWZvcm0gbWF0NCBtb2RlbE1hdHJpeDtcblx0dW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7XG5cdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcblx0ZmxvYXQgdzAoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiAoIGEgKiAoIC0gYSArIDMuMCApIC0gMy4wICkgKyAxLjAgKTtcblx0fVxuXHRmbG9hdCB3MSggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqICBhICogKCAzLjAgKiBhIC0gNi4wICkgKyA0LjAgKTtcblx0fVxuXHRmbG9hdCB3MiggZmxvYXQgYSApe1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogKCBhICogKCAtIDMuMCAqIGEgKyAzLjAgKSArIDMuMCApICsgMS4wICk7XG5cdH1cblx0ZmxvYXQgdzMoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiBhICogYSApO1xuXHR9XG5cdGZsb2F0IGcwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiB3MCggYSApICsgdzEoIGEgKTtcblx0fVxuXHRmbG9hdCBnMSggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gdzIoIGEgKSArIHczKCBhICk7XG5cdH1cblx0ZmxvYXQgaDAoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIC0gMS4wICsgdzEoIGEgKSAvICggdzAoIGEgKSArIHcxKCBhICkgKTtcblx0fVxuXHRmbG9hdCBoMSggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gMS4wICsgdzMoIGEgKSAvICggdzIoIGEgKSArIHczKCBhICkgKTtcblx0fVxuXHR2ZWM0IGJpY3ViaWMoIHNhbXBsZXIyRCB0ZXgsIHZlYzIgdXYsIHZlYzQgdGV4ZWxTaXplLCBmbG9hdCBsb2QgKSB7XG5cdFx0dXYgPSB1diAqIHRleGVsU2l6ZS56dyArIDAuNTtcblx0XHR2ZWMyIGl1diA9IGZsb29yKCB1diApO1xuXHRcdHZlYzIgZnV2ID0gZnJhY3QoIHV2ICk7XG5cdFx0ZmxvYXQgZzB4ID0gZzAoIGZ1di54ICk7XG5cdFx0ZmxvYXQgZzF4ID0gZzEoIGZ1di54ICk7XG5cdFx0ZmxvYXQgaDB4ID0gaDAoIGZ1di54ICk7XG5cdFx0ZmxvYXQgaDF4ID0gaDEoIGZ1di54ICk7XG5cdFx0ZmxvYXQgaDB5ID0gaDAoIGZ1di55ICk7XG5cdFx0ZmxvYXQgaDF5ID0gaDEoIGZ1di55ICk7XG5cdFx0dmVjMiBwMCA9ICggdmVjMiggaXV2LnggKyBoMHgsIGl1di55ICsgaDB5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHR2ZWMyIHAxID0gKCB2ZWMyKCBpdXYueCArIGgxeCwgaXV2LnkgKyBoMHkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHZlYzIgcDIgPSAoIHZlYzIoIGl1di54ICsgaDB4LCBpdXYueSArIGgxeSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0dmVjMiBwMyA9ICggdmVjMiggaXV2LnggKyBoMXgsIGl1di55ICsgaDF5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHRyZXR1cm4gZzAoIGZ1di55ICkgKiAoIGcweCAqIHRleHR1cmVMb2QoIHRleCwgcDAsIGxvZCApICsgZzF4ICogdGV4dHVyZUxvZCggdGV4LCBwMSwgbG9kICkgKSArXG5cdFx0XHRnMSggZnV2LnkgKSAqICggZzB4ICogdGV4dHVyZUxvZCggdGV4LCBwMiwgbG9kICkgKyBnMXggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAzLCBsb2QgKSApO1xuXHR9XG5cdHZlYzQgdGV4dHVyZUJpY3ViaWMoIHNhbXBsZXIyRCBzYW1wbGVyLCB2ZWMyIHV2LCBmbG9hdCBsb2QgKSB7XG5cdFx0dmVjMiBmTG9kU2l6ZSA9IHZlYzIoIHRleHR1cmVTaXplKCBzYW1wbGVyLCBpbnQoIGxvZCApICkgKTtcblx0XHR2ZWMyIGNMb2RTaXplID0gdmVjMiggdGV4dHVyZVNpemUoIHNhbXBsZXIsIGludCggbG9kICsgMS4wICkgKSApO1xuXHRcdHZlYzIgZkxvZFNpemVJbnYgPSAxLjAgLyBmTG9kU2l6ZTtcblx0XHR2ZWMyIGNMb2RTaXplSW52ID0gMS4wIC8gY0xvZFNpemU7XG5cdFx0dmVjNCBmU2FtcGxlID0gYmljdWJpYyggc2FtcGxlciwgdXYsIHZlYzQoIGZMb2RTaXplSW52LCBmTG9kU2l6ZSApLCBmbG9vciggbG9kICkgKTtcblx0XHR2ZWM0IGNTYW1wbGUgPSBiaWN1YmljKCBzYW1wbGVyLCB1diwgdmVjNCggY0xvZFNpemVJbnYsIGNMb2RTaXplICksIGNlaWwoIGxvZCApICk7XG5cdFx0cmV0dXJuIG1peCggZlNhbXBsZSwgY1NhbXBsZSwgZnJhY3QoIGxvZCApICk7XG5cdH1cblx0dmVjMyBnZXRWb2x1bWVUcmFuc21pc3Npb25SYXkoIGNvbnN0IGluIHZlYzMgbiwgY29uc3QgaW4gdmVjMyB2LCBjb25zdCBpbiBmbG9hdCB0aGlja25lc3MsIGNvbnN0IGluIGZsb2F0IGlvciwgY29uc3QgaW4gbWF0NCBtb2RlbE1hdHJpeCApIHtcblx0XHR2ZWMzIHJlZnJhY3Rpb25WZWN0b3IgPSByZWZyYWN0KCAtIHYsIG5vcm1hbGl6ZSggbiApLCAxLjAgLyBpb3IgKTtcblx0XHR2ZWMzIG1vZGVsU2NhbGU7XG5cdFx0bW9kZWxTY2FsZS54ID0gbGVuZ3RoKCB2ZWMzKCBtb2RlbE1hdHJpeFsgMCBdLnh5eiApICk7XG5cdFx0bW9kZWxTY2FsZS55ID0gbGVuZ3RoKCB2ZWMzKCBtb2RlbE1hdHJpeFsgMSBdLnh5eiApICk7XG5cdFx0bW9kZWxTY2FsZS56ID0gbGVuZ3RoKCB2ZWMzKCBtb2RlbE1hdHJpeFsgMiBdLnh5eiApICk7XG5cdFx0cmV0dXJuIG5vcm1hbGl6ZSggcmVmcmFjdGlvblZlY3RvciApICogdGhpY2tuZXNzICogbW9kZWxTY2FsZTtcblx0fVxuXHRmbG9hdCBhcHBseUlvclRvUm91Z2huZXNzKCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIGZsb2F0IGlvciApIHtcblx0XHRyZXR1cm4gcm91Z2huZXNzICogY2xhbXAoIGlvciAqIDIuMCAtIDIuMCwgMC4wLCAxLjAgKTtcblx0fVxuXHR2ZWM0IGdldFRyYW5zbWlzc2lvblNhbXBsZSggY29uc3QgaW4gdmVjMiBmcmFnQ29vcmQsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgY29uc3QgaW4gZmxvYXQgaW9yICkge1xuXHRcdGZsb2F0IGxvZCA9IGxvZzIoIHRyYW5zbWlzc2lvblNhbXBsZXJTaXplLnggKSAqIGFwcGx5SW9yVG9Sb3VnaG5lc3MoIHJvdWdobmVzcywgaW9yICk7XG5cdFx0cmV0dXJuIHRleHR1cmVCaWN1YmljKCB0cmFuc21pc3Npb25TYW1wbGVyTWFwLCBmcmFnQ29vcmQueHksIGxvZCApO1xuXHR9XG5cdHZlYzMgdm9sdW1lQXR0ZW51YXRpb24oIGNvbnN0IGluIGZsb2F0IHRyYW5zbWlzc2lvbkRpc3RhbmNlLCBjb25zdCBpbiB2ZWMzIGF0dGVudWF0aW9uQ29sb3IsIGNvbnN0IGluIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2UgKSB7XG5cdFx0aWYgKCBpc2luZiggYXR0ZW51YXRpb25EaXN0YW5jZSApICkge1xuXHRcdFx0cmV0dXJuIHZlYzMoIDEuMCApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2ZWMzIGF0dGVudWF0aW9uQ29lZmZpY2llbnQgPSAtbG9nKCBhdHRlbnVhdGlvbkNvbG9yICkgLyBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHRcdFx0dmVjMyB0cmFuc21pdHRhbmNlID0gZXhwKCAtIGF0dGVudWF0aW9uQ29lZmZpY2llbnQgKiB0cmFuc21pc3Npb25EaXN0YW5jZSApO1x0XHRcdHJldHVybiB0cmFuc21pdHRhbmNlO1xuXHRcdH1cblx0fVxuXHR2ZWM0IGdldElCTFZvbHVtZVJlZnJhY3Rpb24oIGNvbnN0IGluIHZlYzMgbiwgY29uc3QgaW4gdmVjMyB2LCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIHZlYzMgZGlmZnVzZUNvbG9yLFxuXHRcdGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIHZlYzMgcG9zaXRpb24sIGNvbnN0IGluIG1hdDQgbW9kZWxNYXRyaXgsXG5cdFx0Y29uc3QgaW4gbWF0NCB2aWV3TWF0cml4LCBjb25zdCBpbiBtYXQ0IHByb2pNYXRyaXgsIGNvbnN0IGluIGZsb2F0IGRpc3BlcnNpb24sIGNvbnN0IGluIGZsb2F0IGlvciwgY29uc3QgaW4gZmxvYXQgdGhpY2tuZXNzLFxuXHRcdGNvbnN0IGluIHZlYzMgYXR0ZW51YXRpb25Db2xvciwgY29uc3QgaW4gZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZSApIHtcblx0XHR2ZWM0IHRyYW5zbWl0dGVkTGlnaHQ7XG5cdFx0dmVjMyB0cmFuc21pdHRhbmNlO1xuXHRcdCNpZmRlZiBVU0VfRElTUEVSU0lPTlxuXHRcdFx0ZmxvYXQgaGFsZlNwcmVhZCA9ICggaW9yIC0gMS4wICkgKiAwLjAyNSAqIGRpc3BlcnNpb247XG5cdFx0XHR2ZWMzIGlvcnMgPSB2ZWMzKCBpb3IgLSBoYWxmU3ByZWFkLCBpb3IsIGlvciArIGhhbGZTcHJlYWQgKTtcblx0XHRcdGZvciAoIGludCBpID0gMDsgaSA8IDM7IGkgKysgKSB7XG5cdFx0XHRcdHZlYzMgdHJhbnNtaXNzaW9uUmF5ID0gZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBuLCB2LCB0aGlja25lc3MsIGlvcnNbIGkgXSwgbW9kZWxNYXRyaXggKTtcblx0XHRcdFx0dmVjMyByZWZyYWN0ZWRSYXlFeGl0ID0gcG9zaXRpb24gKyB0cmFuc21pc3Npb25SYXk7XG5cdFx0XHRcdHZlYzQgbmRjUG9zID0gcHJvak1hdHJpeCAqIHZpZXdNYXRyaXggKiB2ZWM0KCByZWZyYWN0ZWRSYXlFeGl0LCAxLjAgKTtcblx0XHRcdFx0dmVjMiByZWZyYWN0aW9uQ29vcmRzID0gbmRjUG9zLnh5IC8gbmRjUG9zLnc7XG5cdFx0XHRcdHJlZnJhY3Rpb25Db29yZHMgKz0gMS4wO1xuXHRcdFx0XHRyZWZyYWN0aW9uQ29vcmRzIC89IDIuMDtcblx0XHRcdFx0dmVjNCB0cmFuc21pc3Npb25TYW1wbGUgPSBnZXRUcmFuc21pc3Npb25TYW1wbGUoIHJlZnJhY3Rpb25Db29yZHMsIHJvdWdobmVzcywgaW9yc1sgaSBdICk7XG5cdFx0XHRcdHRyYW5zbWl0dGVkTGlnaHRbIGkgXSA9IHRyYW5zbWlzc2lvblNhbXBsZVsgaSBdO1xuXHRcdFx0XHR0cmFuc21pdHRlZExpZ2h0LmEgKz0gdHJhbnNtaXNzaW9uU2FtcGxlLmE7XG5cdFx0XHRcdHRyYW5zbWl0dGFuY2VbIGkgXSA9IGRpZmZ1c2VDb2xvclsgaSBdICogdm9sdW1lQXR0ZW51YXRpb24oIGxlbmd0aCggdHJhbnNtaXNzaW9uUmF5ICksIGF0dGVudWF0aW9uQ29sb3IsIGF0dGVudWF0aW9uRGlzdGFuY2UgKVsgaSBdO1xuXHRcdFx0fVxuXHRcdFx0dHJhbnNtaXR0ZWRMaWdodC5hIC89IDMuMDtcblx0XHQjZWxzZVxuXHRcdFx0dmVjMyB0cmFuc21pc3Npb25SYXkgPSBnZXRWb2x1bWVUcmFuc21pc3Npb25SYXkoIG4sIHYsIHRoaWNrbmVzcywgaW9yLCBtb2RlbE1hdHJpeCApO1xuXHRcdFx0dmVjMyByZWZyYWN0ZWRSYXlFeGl0ID0gcG9zaXRpb24gKyB0cmFuc21pc3Npb25SYXk7XG5cdFx0XHR2ZWM0IG5kY1BvcyA9IHByb2pNYXRyaXggKiB2aWV3TWF0cml4ICogdmVjNCggcmVmcmFjdGVkUmF5RXhpdCwgMS4wICk7XG5cdFx0XHR2ZWMyIHJlZnJhY3Rpb25Db29yZHMgPSBuZGNQb3MueHkgLyBuZGNQb3Mudztcblx0XHRcdHJlZnJhY3Rpb25Db29yZHMgKz0gMS4wO1xuXHRcdFx0cmVmcmFjdGlvbkNvb3JkcyAvPSAyLjA7XG5cdFx0XHR0cmFuc21pdHRlZExpZ2h0ID0gZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKCByZWZyYWN0aW9uQ29vcmRzLCByb3VnaG5lc3MsIGlvciApO1xuXHRcdFx0dHJhbnNtaXR0YW5jZSA9IGRpZmZ1c2VDb2xvciAqIHZvbHVtZUF0dGVudWF0aW9uKCBsZW5ndGgoIHRyYW5zbWlzc2lvblJheSApLCBhdHRlbnVhdGlvbkNvbG9yLCBhdHRlbnVhdGlvbkRpc3RhbmNlICk7XG5cdFx0I2VuZGlmXG5cdFx0dmVjMyBhdHRlbnVhdGVkQ29sb3IgPSB0cmFuc21pdHRhbmNlICogdHJhbnNtaXR0ZWRMaWdodC5yZ2I7XG5cdFx0dmVjMyBGID0gRW52aXJvbm1lbnRCUkRGKCBuLCB2LCBzcGVjdWxhckNvbG9yLCBzcGVjdWxhckY5MCwgcm91Z2huZXNzICk7XG5cdFx0ZmxvYXQgdHJhbnNtaXR0YW5jZUZhY3RvciA9ICggdHJhbnNtaXR0YW5jZS5yICsgdHJhbnNtaXR0YW5jZS5nICsgdHJhbnNtaXR0YW5jZS5iICkgLyAzLjA7XG5cdFx0cmV0dXJuIHZlYzQoICggMS4wIC0gRiApICogYXR0ZW51YXRlZENvbG9yLCAxLjAgLSAoIDEuMCAtIHRyYW5zbWl0dGVkTGlnaHQuYSApICogdHJhbnNtaXR0YW5jZUZhY3RvciApO1xuXHR9XG4jZW5kaWYiOwoKICAgIHZhciB1dl9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfVVYgKSB8fCBkZWZpbmVkKCBVU0VfQU5JU09UUk9QWSApXG5cdHZhcnlpbmcgdmVjMiB2VXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdHZhcnlpbmcgdmVjMiB2TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0dmFyeWluZyB2ZWMyIHZBbHBoYU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHZhcnlpbmcgdmVjMiB2TGlnaHRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR2YXJ5aW5nIHZlYzIgdkFvTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQlVNUE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkJ1bXBNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dmFyeWluZyB2ZWMyIHZOb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR2YXJ5aW5nIHZlYzIgdkVtaXNzaXZlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2TWV0YWxuZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfUk9VR0hORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2Um91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWU1BUFxuXHR2YXJ5aW5nIHZlYzIgdkFuaXNvdHJvcHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdHZhcnlpbmcgdmVjMiB2U2hlZW5Db2xvck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuUm91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJDb2xvck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdHVuaWZvcm0gbWF0MyB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VHJhbnNtaXNzaW9uTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyB0aGlja25lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VGhpY2tuZXNzTWFwVXY7XG4jZW5kaWYiOwoKICAgIHZhciB1dl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR1bmlmb3JtIG1hdDMgbWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHVuaWZvcm0gbWF0MyBhbHBoYU1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZBbHBoYU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHVuaWZvcm0gbWF0MyBsaWdodE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZMaWdodE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FPTUFQXG5cdHVuaWZvcm0gbWF0MyBhb01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZBb01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dW5pZm9ybSBtYXQzIGJ1bXBNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QnVtcE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR1bmlmb3JtIG1hdDMgbm9ybWFsTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdk5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHR1bmlmb3JtIG1hdDMgZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkRpc3BsYWNlbWVudE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHVuaWZvcm0gbWF0MyBlbWlzc2l2ZU1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZFbWlzc2l2ZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgbWV0YWxuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdk1ldGFsbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgcm91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dW5pZm9ybSBtYXQzIGFuaXNvdHJvcHlNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QW5pc290cm9weU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR1bmlmb3JtIG1hdDMgY2xlYXJjb2F0TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dW5pZm9ybSBtYXQzIGNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXROb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyBjbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0dW5pZm9ybSBtYXQzIHNoZWVuQ29sb3JNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U2hlZW5Db2xvck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U2hlZW5Sb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR1bmlmb3JtIG1hdDMgaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0dW5pZm9ybSBtYXQzIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFyTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJDb2xvck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHR1bmlmb3JtIG1hdDMgc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJJbnRlbnNpdHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0dW5pZm9ybSBtYXQzIHRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZUcmFuc21pc3Npb25NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9USElDS05FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZUaGlja25lc3NNYXBVdjtcbiNlbmRpZiI7CgogICAgdmFyIHV2X3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2VXYgPSB2ZWMzKCB1diwgMSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR2TWFwVXYgPSAoIG1hcFRyYW5zZm9ybSAqIHZlYzMoIE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0dkFscGhhTWFwVXYgPSAoIGFscGhhTWFwVHJhbnNmb3JtICogdmVjMyggQUxQSEFNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHZMaWdodE1hcFV2ID0gKCBsaWdodE1hcFRyYW5zZm9ybSAqIHZlYzMoIExJR0hUTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR2QW9NYXBVdiA9ICggYW9NYXBUcmFuc2Zvcm0gKiB2ZWMzKCBBT01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQlVNUE1BUFxuXHR2QnVtcE1hcFV2ID0gKCBidW1wTWFwVHJhbnNmb3JtICogdmVjMyggQlVNUE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHZOb3JtYWxNYXBVdiA9ICggbm9ybWFsTWFwVHJhbnNmb3JtICogdmVjMyggTk9STUFMTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dkRpc3BsYWNlbWVudE1hcFV2ID0gKCBkaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBESVNQTEFDRU1FTlRNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZFbWlzc2l2ZU1hcFV2ID0gKCBlbWlzc2l2ZU1hcFRyYW5zZm9ybSAqIHZlYzMoIEVNSVNTSVZFTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dk1ldGFsbmVzc01hcFV2ID0gKCBtZXRhbG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBNRVRBTE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2Um91Z2huZXNzTWFwVXYgPSAoIHJvdWdobmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIFJPVUdITkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWU1BUFxuXHR2QW5pc290cm9weU1hcFV2ID0gKCBhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtICogdmVjMyggQU5JU09UUk9QWU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHZDbGVhcmNvYXRNYXBVdiA9ICggY2xlYXJjb2F0TWFwVHJhbnNmb3JtICogdmVjMyggQ0xFQVJDT0FUTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHZDbGVhcmNvYXROb3JtYWxNYXBVdiA9ICggY2xlYXJjb2F0Tm9ybWFsTWFwVHJhbnNmb3JtICogdmVjMyggQ0xFQVJDT0FUX05PUk1BTE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgPSAoIGNsZWFyY29hdFJvdWdobmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVF9ST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdHZJcmlkZXNjZW5jZU1hcFV2ID0gKCBpcmlkZXNjZW5jZU1hcFRyYW5zZm9ybSAqIHZlYzMoIElSSURFU0NFTkNFTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0dklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgPSAoIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHR2U2hlZW5Db2xvck1hcFV2ID0gKCBzaGVlbkNvbG9yTWFwVHJhbnNmb3JtICogdmVjMyggU0hFRU5fQ09MT1JNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHR2U2hlZW5Sb3VnaG5lc3NNYXBVdiA9ICggc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTSEVFTl9ST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZTcGVjdWxhck1hcFV2ID0gKCBzcGVjdWxhck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNQRUNVTEFSTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHR2U3BlY3VsYXJDb2xvck1hcFV2ID0gKCBzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtICogdmVjMyggU1BFQ1VMQVJfQ09MT1JNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHR2U3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA9ICggc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTUEVDVUxBUl9JTlRFTlNJVFlNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHR2VHJhbnNtaXNzaW9uTWFwVXYgPSAoIHRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybSAqIHZlYzMoIFRSQU5TTUlTU0lPTk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHZUaGlja25lc3NNYXBVdiA9ICggdGhpY2tuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggVEhJQ0tORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZiI7CgogICAgdmFyIHdvcmxkcG9zX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApIHx8IGRlZmluZWQoIERJU1RBTkNFICkgfHwgZGVmaW5lZCAoIFVTRV9TSEFET1dNQVAgKSB8fCBkZWZpbmVkICggVVNFX1RSQU5TTUlTU0lPTiApIHx8IE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0dmVjNCB3b3JsZFBvc2l0aW9uID0gdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuXHQjaWZkZWYgVVNFX0JBVENISU5HXG5cdFx0d29ybGRQb3NpdGlvbiA9IGJhdGNoaW5nTWF0cml4ICogd29ybGRQb3NpdGlvbjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuXHRcdHdvcmxkUG9zaXRpb24gPSBpbnN0YW5jZU1hdHJpeCAqIHdvcmxkUG9zaXRpb247XG5cdCNlbmRpZlxuXHR3b3JsZFBvc2l0aW9uID0gbW9kZWxNYXRyaXggKiB3b3JsZFBvc2l0aW9uO1xuI2VuZGlmIjsKCiAgICBjb25zdCB2ZXJ0ZXgkaCA9ICJ2YXJ5aW5nIHZlYzIgdlV2O1xudW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xudm9pZCBtYWluKCkge1xuXHR2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuXHRnbF9Qb3NpdGlvbiA9IHZlYzQoIHBvc2l0aW9uLnh5LCAxLjAsIDEuMCApO1xufSI7CgogICAgY29uc3QgZnJhZ21lbnQkaCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0MkQ7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG52YXJ5aW5nIHZlYzIgdlV2O1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZTJEKCB0MkQsIHZVdiApO1xuXHQjaWZkZWYgREVDT0RFX1ZJREVPX1RFWFRVUkVcblx0XHR0ZXhDb2xvciA9IHZlYzQoIG1peCggcG93KCB0ZXhDb2xvci5yZ2IgKiAwLjk0Nzg2NzI5ODYgKyB2ZWMzKCAwLjA1MjEzMjcwMTQgKSwgdmVjMyggMi40ICkgKSwgdGV4Q29sb3IucmdiICogMC4wNzczOTkzODA4LCB2ZWMzKCBsZXNzVGhhbkVxdWFsKCB0ZXhDb2xvci5yZ2IsIHZlYzMoIDAuMDQwNDUgKSApICkgKSwgdGV4Q29sb3IudyApO1xuXHQjZW5kaWZcblx0dGV4Q29sb3IucmdiICo9IGJhY2tncm91bmRJbnRlbnNpdHk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JGcgPSAidmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG52b2lkIG1haW4oKSB7XG5cdHZXb3JsZERpcmVjdGlvbiA9IHRyYW5zZm9ybURpcmVjdGlvbiggcG9zaXRpb24sIG1vZGVsTWF0cml4ICk7XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0Z2xfUG9zaXRpb24ueiA9IGdsX1Bvc2l0aW9uLnc7XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCRnID0gIiNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdHVuaWZvcm0gc2FtcGxlckN1YmUgZW52TWFwO1xuI2VsaWYgZGVmaW5lZCggRU5WTUFQX1RZUEVfQ1VCRV9VViApXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDtcbiNlbmRpZlxudW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwO1xudW5pZm9ybSBmbG9hdCBiYWNrZ3JvdW5kQmx1cnJpbmVzcztcbnVuaWZvcm0gZmxvYXQgYmFja2dyb3VuZEludGVuc2l0eTtcbnVuaWZvcm0gbWF0MyBiYWNrZ3JvdW5kUm90YXRpb247XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgYmFja2dyb3VuZFJvdGF0aW9uICogdmVjMyggZmxpcEVudk1hcCAqIHZXb3JsZERpcmVjdGlvbi54LCB2V29ybGREaXJlY3Rpb24ueXogKSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCBiYWNrZ3JvdW5kUm90YXRpb24gKiB2V29ybGREaXJlY3Rpb24sIGJhY2tncm91bmRCbHVycmluZXNzICk7XG5cdCNlbHNlXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIDEuMCApO1xuXHQjZW5kaWZcblx0dGV4Q29sb3IucmdiICo9IGJhY2tncm91bmRJbnRlbnNpdHk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JGYgPSAidmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG52b2lkIG1haW4oKSB7XG5cdHZXb3JsZERpcmVjdGlvbiA9IHRyYW5zZm9ybURpcmVjdGlvbiggcG9zaXRpb24sIG1vZGVsTWF0cml4ICk7XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0Z2xfUG9zaXRpb24ueiA9IGdsX1Bvc2l0aW9uLnc7XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCRmID0gInVuaWZvcm0gc2FtcGxlckN1YmUgdEN1YmU7XG51bmlmb3JtIGZsb2F0IHRGbGlwO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xudmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbnZvaWQgbWFpbigpIHtcblx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlKCB0Q3ViZSwgdmVjMyggdEZsaXAgKiB2V29ybGREaXJlY3Rpb24ueCwgdldvcmxkRGlyZWN0aW9uLnl6ICkgKTtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4Q29sb3I7XG5cdGdsX0ZyYWdDb2xvci5hICo9IG9wYWNpdHk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkZSA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52YXJ5aW5nIHZlYzIgdkhpZ2hQcmVjaXNpb25aVztcbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dkhpZ2hQcmVjaXNpb25aVyA9IGdsX1Bvc2l0aW9uLnp3O1xufSI7CgogICAgY29uc3QgZnJhZ21lbnQkZSA9ICIjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdHVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50PlxudmFyeWluZyB2ZWMyIHZIaWdoUHJlY2lzaW9uWlc7XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdCNpZiBERVBUSF9QQUNLSU5HID09IDMyMDBcblx0XHRkaWZmdXNlQ29sb3IuYSA9IG9wYWNpdHk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0ZmxvYXQgZnJhZ0Nvb3JkWiA9IDAuNSAqIHZIaWdoUHJlY2lzaW9uWldbMF0gLyB2SGlnaFByZWNpc2lvblpXWzFdICsgMC41O1xuXHQjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggdmVjMyggMS4wIC0gZnJhZ0Nvb3JkWiApLCBvcGFjaXR5ICk7XG5cdCNlbGlmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMVxuXHRcdGdsX0ZyYWdDb2xvciA9IHBhY2tEZXB0aFRvUkdCQSggZnJhZ0Nvb3JkWiApO1xuXHQjZWxpZiBERVBUSF9QQUNLSU5HID09IDMyMDJcblx0XHRnbF9GcmFnQ29sb3IgPSB2ZWM0KCBwYWNrRGVwdGhUb1JHQiggZnJhZ0Nvb3JkWiApLCAxLjAgKTtcblx0I2VsaWYgREVQVEhfUEFDS0lORyA9PSAzMjAzXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja0RlcHRoVG9SRyggZnJhZ0Nvb3JkWiApLCAwLjAsIDEuMCApO1xuXHQjZW5kaWZcbn0iOwoKICAgIGNvbnN0IHZlcnRleCRkID0gIiNkZWZpbmUgRElTVEFOQ0VcbnZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JGQgPSAiI2RlZmluZSBESVNUQU5DRVxudW5pZm9ybSB2ZWMzIHJlZmVyZW5jZVBvc2l0aW9uO1xudW5pZm9ybSBmbG9hdCBuZWFyRGlzdGFuY2U7XG51bmlmb3JtIGZsb2F0IGZhckRpc3RhbmNlO1xudmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbiAoKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0ZmxvYXQgZGlzdCA9IGxlbmd0aCggdldvcmxkUG9zaXRpb24gLSByZWZlcmVuY2VQb3NpdGlvbiApO1xuXHRkaXN0ID0gKCBkaXN0IC0gbmVhckRpc3RhbmNlICkgLyAoIGZhckRpc3RhbmNlIC0gbmVhckRpc3RhbmNlICk7XG5cdGRpc3QgPSBzYXR1cmF0ZSggZGlzdCApO1xuXHRnbF9GcmFnQ29sb3IgPSBwYWNrRGVwdGhUb1JHQkEoIGRpc3QgKTtcbn0iOwoKICAgIGNvbnN0IHZlcnRleCRjID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCRjID0gInVuaWZvcm0gc2FtcGxlcjJEIHRFcXVpcmVjdDtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7XG5cdHZlYzIgc2FtcGxlVVYgPSBlcXVpcmVjdFV2KCBkaXJlY3Rpb24gKTtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKCB0RXF1aXJlY3QsIHNhbXBsZVVWICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkYiA9ICJ1bmlmb3JtIGZsb2F0IHNjYWxlO1xuYXR0cmlidXRlIGZsb2F0IGxpbmVEaXN0YW5jZTtcbnZhcnlpbmcgZmxvYXQgdkxpbmVEaXN0YW5jZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0dkxpbmVEaXN0YW5jZSA9IHNjYWxlICogbGluZURpc3RhbmNlO1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCRiID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xudW5pZm9ybSBmbG9hdCBkYXNoU2l6ZTtcbnVuaWZvcm0gZmxvYXQgdG90YWxTaXplO1xudmFyeWluZyBmbG9hdCB2TGluZURpc3RhbmNlO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdGlmICggbW9kKCB2TGluZURpc3RhbmNlLCB0b3RhbFNpemUgKSA+IGRhc2hTaXplICkge1xuXHRcdGRpc2NhcmQ7XG5cdH1cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkYSA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2lmIGRlZmluZWQgKCBVU0VfRU5WTUFQICkgfHwgZGVmaW5lZCAoIFVTRV9TS0lOTklORyApXG5cdFx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxlbnZtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JGEgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHNwZWN1bGFybWFwX2ZyYWdtZW50PlxuXHRSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCA9IFJlZmxlY3RlZExpZ2h0KCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSApO1xuXHQjaWZkZWYgVVNFX0xJR0hUTUFQXG5cdFx0dmVjNCBsaWdodE1hcFRleGVsID0gdGV4dHVyZTJEKCBsaWdodE1hcCwgdkxpZ2h0TWFwVXYgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gbGlnaHRNYXBUZXhlbC5yZ2IgKiBsaWdodE1hcEludGVuc2l0eSAqIFJFQ0lQUk9DQUxfUEk7XG5cdCNlbHNlXG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IHZlYzMoIDEuMCApO1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKj0gZGlmZnVzZUNvbG9yLnJnYjtcblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlO1xuXHQjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQ5ID0gIiNkZWZpbmUgTEFNQkVSVFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxlbnZtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCQ5ID0gIiNkZWZpbmUgTEFNQkVSVFxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQ4ID0gIiNkZWZpbmUgTUFUQ0FQXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xufSI7CgogICAgY29uc3QgZnJhZ21lbnQkOCA9ICIjZGVmaW5lIE1BVENBUFxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG51bmlmb3JtIHNhbXBsZXIyRCBtYXRjYXA7XG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdHZlYzMgdmlld0RpciA9IG5vcm1hbGl6ZSggdlZpZXdQb3NpdGlvbiApO1xuXHR2ZWMzIHggPSBub3JtYWxpemUoIHZlYzMoIHZpZXdEaXIueiwgMC4wLCAtIHZpZXdEaXIueCApICk7XG5cdHZlYzMgeSA9IGNyb3NzKCB2aWV3RGlyLCB4ICk7XG5cdHZlYzIgdXYgPSB2ZWMyKCBkb3QoIHgsIG5vcm1hbCApLCBkb3QoIHksIG5vcm1hbCApICkgKiAwLjQ5NSArIDAuNTtcblx0I2lmZGVmIFVTRV9NQVRDQVBcblx0XHR2ZWM0IG1hdGNhcENvbG9yID0gdGV4dHVyZTJEKCBtYXRjYXAsIHV2ICk7XG5cdCNlbHNlXG5cdFx0dmVjNCBtYXRjYXBDb2xvciA9IHZlYzQoIHZlYzMoIG1peCggMC4yLCAwLjgsIHV2LnkgKSApLCAxLjAgKTtcblx0I2VuZGlmXG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2IgKiBtYXRjYXBDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JDcgPSAiI2RlZmluZSBOT1JNQUxcbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKVxuXHR2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApXG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuI2VuZGlmXG59IjsKCiAgICBjb25zdCBmcmFnbWVudCQ3ID0gIiNkZWZpbmUgTk9STUFMXG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMC4wLCAwLjAsIDAuMCwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja05vcm1hbFRvUkdCKCBub3JtYWwgKSwgZGlmZnVzZUNvbG9yLmEgKTtcblx0I2lmZGVmIE9QQVFVRVxuXHRcdGdsX0ZyYWdDb2xvci5hID0gMS4wO1xuXHQjZW5kaWZcbn0iOwoKICAgIGNvbnN0IHZlcnRleCQ2ID0gIiNkZWZpbmUgUEhPTkdcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoY29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmF0Y2hpbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkNiA9ICIjZGVmaW5lIFBIT05HXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gdmVjMyBlbWlzc2l2ZTtcbnVuaWZvcm0gdmVjMyBzcGVjdWxhcjtcbnVuaWZvcm0gZmxvYXQgc2hpbmluZXNzO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHNwZWN1bGFybWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19waG9uZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQ1ID0gIiNkZWZpbmUgU1RBTkRBUkRcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoY29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmF0Y2hpbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcbiNlbmRpZlxufSI7CgogICAgY29uc3QgZnJhZ21lbnQkNSA9ICIjZGVmaW5lIFNUQU5EQVJEXG4jaWZkZWYgUEhZU0lDQUxcblx0I2RlZmluZSBJT1Jcblx0I2RlZmluZSBVU0VfU1BFQ1VMQVJcbiNlbmRpZlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IHJvdWdobmVzcztcbnVuaWZvcm0gZmxvYXQgbWV0YWxuZXNzO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmZGVmIElPUlxuXHR1bmlmb3JtIGZsb2F0IGlvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUlxuXHR1bmlmb3JtIGZsb2F0IHNwZWN1bGFySW50ZW5zaXR5O1xuXHR1bmlmb3JtIHZlYzMgc3BlY3VsYXJDb2xvcjtcblx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwZWN1bGFyQ29sb3JNYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwZWN1bGFySW50ZW5zaXR5TWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0dW5pZm9ybSBmbG9hdCBjbGVhcmNvYXQ7XG5cdHVuaWZvcm0gZmxvYXQgY2xlYXJjb2F0Um91Z2huZXNzO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0RJU1BFUlNJT05cblx0dW5pZm9ybSBmbG9hdCBkaXNwZXJzaW9uO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2U7XG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHR1bmlmb3JtIHZlYzMgc2hlZW5Db2xvcjtcblx0dW5pZm9ybSBmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNoZWVuQ29sb3JNYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNoZWVuUm91Z2huZXNzTWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdHVuaWZvcm0gdmVjMiBhbmlzb3Ryb3B5VmVjdG9yO1xuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBhbmlzb3Ryb3B5TWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8aXJpZGVzY2VuY2VfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8aXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHJvdWdobmVzc21hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1ldGFsbmVzc21hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8Y2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuXHQjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG5cdHZlYzMgdG90YWxEaWZmdXNlID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0dmVjMyB0b3RhbFNwZWN1bGFyID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyO1xuXHQjaW5jbHVkZSA8dHJhbnNtaXNzaW9uX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSB0b3RhbERpZmZ1c2UgKyB0b3RhbFNwZWN1bGFyICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0ZmxvYXQgc2hlZW5FbmVyZ3lDb21wID0gMS4wIC0gMC4xNTcgKiBtYXgzKCBtYXRlcmlhbC5zaGVlbkNvbG9yICk7XG5cdFx0b3V0Z29pbmdMaWdodCA9IG91dGdvaW5nTGlnaHQgKiBzaGVlbkVuZXJneUNvbXAgKyBzaGVlblNwZWN1bGFyRGlyZWN0ICsgc2hlZW5TcGVjdWxhckluZGlyZWN0O1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRmbG9hdCBkb3ROVmNjID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5Vmlld0RpciApICk7XG5cdFx0dmVjMyBGY2MgPSBGX1NjaGxpY2soIG1hdGVyaWFsLmNsZWFyY29hdEYwLCBtYXRlcmlhbC5jbGVhcmNvYXRGOTAsIGRvdE5WY2MgKTtcblx0XHRvdXRnb2luZ0xpZ2h0ID0gb3V0Z29pbmdMaWdodCAqICggMS4wIC0gbWF0ZXJpYWwuY2xlYXJjb2F0ICogRmNjICkgKyAoIGNsZWFyY29hdFNwZWN1bGFyRGlyZWN0ICsgY2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCApICogbWF0ZXJpYWwuY2xlYXJjb2F0O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCiAgICBjb25zdCB2ZXJ0ZXgkNCA9ICIjZGVmaW5lIFRPT05cbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JDQgPSAiI2RlZmluZSBUT09OXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gdmVjMyBlbWlzc2l2ZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCA9IFJlZmxlY3RlZExpZ2h0KCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSApO1xuXHR2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c190b29uX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuXHQjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKyB0b3RhbEVtaXNzaXZlUmFkaWFuY2U7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CgogICAgY29uc3QgdmVydGV4JDMgPSAidW5pZm9ybSBmbG9hdCBzaXplO1xudW5pZm9ybSBmbG9hdCBzY2FsZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbiNpZmRlZiBVU0VfUE9JTlRTX1VWXG5cdHZhcnlpbmcgdmVjMiB2VXY7XG5cdHVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbiNlbmRpZlxudm9pZCBtYWluKCkge1xuXHQjaWZkZWYgVVNFX1BPSU5UU19VVlxuXHRcdHZVdiA9ICggdXZUcmFuc2Zvcm0gKiB2ZWMzKCB1diwgMSApICkueHk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb2ludFNpemUgPSBzaXplO1xuXHQjaWZkZWYgVVNFX1NJWkVBVFRFTlVBVElPTlxuXHRcdGJvb2wgaXNQZXJzcGVjdGl2ZSA9IGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKTtcblx0XHRpZiAoIGlzUGVyc3BlY3RpdmUgKSBnbF9Qb2ludFNpemUgKj0gKCBzY2FsZSAvIC0gbXZQb3NpdGlvbi56ICk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCQzID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJ0aWNsZV9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSB2ZWMzKCAwLjAgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX3BhcnRpY2xlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQyID0gIiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCiAgICBjb25zdCBmcmFnbWVudCQyID0gInVuaWZvcm0gdmVjMyBjb2xvcjtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hc2tfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHRnbF9GcmFnQ29sb3IgPSB2ZWM0KCBjb2xvciwgb3BhY2l0eSAqICggMS4wIC0gZ2V0U2hhZG93TWFzaygpICkgKTtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IHZlcnRleCQxID0gInVuaWZvcm0gZmxvYXQgcm90YXRpb247XG51bmlmb3JtIHZlYzIgY2VudGVyO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHR2ZWM0IG12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXhbIDMgXTtcblx0dmVjMiBzY2FsZSA9IHZlYzIoIGxlbmd0aCggbW9kZWxNYXRyaXhbIDAgXS54eXogKSwgbGVuZ3RoKCBtb2RlbE1hdHJpeFsgMSBdLnh5eiApICk7XG5cdCNpZm5kZWYgVVNFX1NJWkVBVFRFTlVBVElPTlxuXHRcdGJvb2wgaXNQZXJzcGVjdGl2ZSA9IGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKTtcblx0XHRpZiAoIGlzUGVyc3BlY3RpdmUgKSBzY2FsZSAqPSAtIG12UG9zaXRpb24uejtcblx0I2VuZGlmXG5cdHZlYzIgYWxpZ25lZFBvc2l0aW9uID0gKCBwb3NpdGlvbi54eSAtICggY2VudGVyIC0gdmVjMiggMC41ICkgKSApICogc2NhbGU7XG5cdHZlYzIgcm90YXRlZFBvc2l0aW9uO1xuXHRyb3RhdGVkUG9zaXRpb24ueCA9IGNvcyggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54IC0gc2luKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdHJvdGF0ZWRQb3NpdGlvbi55ID0gc2luKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnggKyBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueTtcblx0bXZQb3NpdGlvbi54eSArPSByb3RhdGVkUG9zaXRpb247XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG12UG9zaXRpb247XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50JDEgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwoKICAgIGNvbnN0IFNoYWRlckNodW5rID0gewogICAgCWFscGhhaGFzaF9mcmFnbWVudDogYWxwaGFoYXNoX2ZyYWdtZW50LAogICAgCWFscGhhaGFzaF9wYXJzX2ZyYWdtZW50OiBhbHBoYWhhc2hfcGFyc19mcmFnbWVudCwKICAgIAlhbHBoYW1hcF9mcmFnbWVudDogYWxwaGFtYXBfZnJhZ21lbnQsCiAgICAJYWxwaGFtYXBfcGFyc19mcmFnbWVudDogYWxwaGFtYXBfcGFyc19mcmFnbWVudCwKICAgIAlhbHBoYXRlc3RfZnJhZ21lbnQ6IGFscGhhdGVzdF9mcmFnbWVudCwKICAgIAlhbHBoYXRlc3RfcGFyc19mcmFnbWVudDogYWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQsCiAgICAJYW9tYXBfZnJhZ21lbnQ6IGFvbWFwX2ZyYWdtZW50LAogICAgCWFvbWFwX3BhcnNfZnJhZ21lbnQ6IGFvbWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJYmF0Y2hpbmdfcGFyc192ZXJ0ZXg6IGJhdGNoaW5nX3BhcnNfdmVydGV4LAogICAgCWJhdGNoaW5nX3ZlcnRleDogYmF0Y2hpbmdfdmVydGV4LAogICAgCWJlZ2luX3ZlcnRleDogYmVnaW5fdmVydGV4LAogICAgCWJlZ2lubm9ybWFsX3ZlcnRleDogYmVnaW5ub3JtYWxfdmVydGV4LAogICAgCWJzZGZzOiBic2RmcywKICAgIAlpcmlkZXNjZW5jZV9mcmFnbWVudDogaXJpZGVzY2VuY2VfZnJhZ21lbnQsCiAgICAJYnVtcG1hcF9wYXJzX2ZyYWdtZW50OiBidW1wbWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQsCiAgICAJY2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ6IGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50LAogICAgCWNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleDogY2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4LAogICAgCWNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXgsCiAgICAJY29sb3JfZnJhZ21lbnQ6IGNvbG9yX2ZyYWdtZW50LAogICAgCWNvbG9yX3BhcnNfZnJhZ21lbnQ6IGNvbG9yX3BhcnNfZnJhZ21lbnQsCiAgICAJY29sb3JfcGFyc192ZXJ0ZXg6IGNvbG9yX3BhcnNfdmVydGV4LAogICAgCWNvbG9yX3ZlcnRleDogY29sb3JfdmVydGV4LAogICAgCWNvbW1vbjogY29tbW9uLAogICAgCWN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudDogY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50LAogICAgCWRlZmF1bHRub3JtYWxfdmVydGV4OiBkZWZhdWx0bm9ybWFsX3ZlcnRleCwKICAgIAlkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg6IGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleCwKICAgIAlkaXNwbGFjZW1lbnRtYXBfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfdmVydGV4LAogICAgCWVtaXNzaXZlbWFwX2ZyYWdtZW50OiBlbWlzc2l2ZW1hcF9mcmFnbWVudCwKICAgIAllbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50OiBlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50LAogICAgCWNvbG9yc3BhY2VfZnJhZ21lbnQ6IGNvbG9yc3BhY2VfZnJhZ21lbnQsCiAgICAJY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50OiBjb2xvcnNwYWNlX3BhcnNfZnJhZ21lbnQsCiAgICAJZW52bWFwX2ZyYWdtZW50OiBlbnZtYXBfZnJhZ21lbnQsCiAgICAJZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQsCiAgICAJZW52bWFwX3BhcnNfZnJhZ21lbnQ6IGVudm1hcF9wYXJzX2ZyYWdtZW50LAogICAgCWVudm1hcF9wYXJzX3ZlcnRleDogZW52bWFwX3BhcnNfdmVydGV4LAogICAgCWVudm1hcF9waHlzaWNhbF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudCwKICAgIAllbnZtYXBfdmVydGV4OiBlbnZtYXBfdmVydGV4LAogICAgCWZvZ192ZXJ0ZXg6IGZvZ192ZXJ0ZXgsCiAgICAJZm9nX3BhcnNfdmVydGV4OiBmb2dfcGFyc192ZXJ0ZXgsCiAgICAJZm9nX2ZyYWdtZW50OiBmb2dfZnJhZ21lbnQsCiAgICAJZm9nX3BhcnNfZnJhZ21lbnQ6IGZvZ19wYXJzX2ZyYWdtZW50LAogICAgCWdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQ6IGdyYWRpZW50bWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJbGlnaHRtYXBfcGFyc19mcmFnbWVudDogbGlnaHRtYXBfcGFyc19mcmFnbWVudCwKICAgIAlsaWdodHNfbGFtYmVydF9mcmFnbWVudDogbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQsCiAgICAJbGlnaHRzX2xhbWJlcnRfcGFyc19mcmFnbWVudDogbGlnaHRzX2xhbWJlcnRfcGFyc19mcmFnbWVudCwKICAgIAlsaWdodHNfcGFyc19iZWdpbjogbGlnaHRzX3BhcnNfYmVnaW4sCiAgICAJbGlnaHRzX3Rvb25fZnJhZ21lbnQ6IGxpZ2h0c190b29uX2ZyYWdtZW50LAogICAgCWxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQsCiAgICAJbGlnaHRzX3Bob25nX2ZyYWdtZW50OiBsaWdodHNfcGhvbmdfZnJhZ21lbnQsCiAgICAJbGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50LAogICAgCWxpZ2h0c19waHlzaWNhbF9mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50LAogICAgCWxpZ2h0c19waHlzaWNhbF9wYXJzX2ZyYWdtZW50OiBsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudCwKICAgIAlsaWdodHNfZnJhZ21lbnRfYmVnaW46IGxpZ2h0c19mcmFnbWVudF9iZWdpbiwKICAgIAlsaWdodHNfZnJhZ21lbnRfbWFwczogbGlnaHRzX2ZyYWdtZW50X21hcHMsCiAgICAJbGlnaHRzX2ZyYWdtZW50X2VuZDogbGlnaHRzX2ZyYWdtZW50X2VuZCwKICAgIAlsb2dkZXB0aGJ1Zl9mcmFnbWVudDogbG9nZGVwdGhidWZfZnJhZ21lbnQsCiAgICAJbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudDogbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudCwKICAgIAlsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleDogbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXgsCiAgICAJbG9nZGVwdGhidWZfdmVydGV4OiBsb2dkZXB0aGJ1Zl92ZXJ0ZXgsCiAgICAJbWFwX2ZyYWdtZW50OiBtYXBfZnJhZ21lbnQsCiAgICAJbWFwX3BhcnNfZnJhZ21lbnQ6IG1hcF9wYXJzX2ZyYWdtZW50LAogICAgCW1hcF9wYXJ0aWNsZV9mcmFnbWVudDogbWFwX3BhcnRpY2xlX2ZyYWdtZW50LAogICAgCW1hcF9wYXJ0aWNsZV9wYXJzX2ZyYWdtZW50OiBtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudCwKICAgIAltZXRhbG5lc3NtYXBfZnJhZ21lbnQ6IG1ldGFsbmVzc21hcF9mcmFnbWVudCwKICAgIAltZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudDogbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJbW9ycGhpbnN0YW5jZV92ZXJ0ZXg6IG1vcnBoaW5zdGFuY2VfdmVydGV4LAogICAgCW1vcnBoY29sb3JfdmVydGV4OiBtb3JwaGNvbG9yX3ZlcnRleCwKICAgIAltb3JwaG5vcm1hbF92ZXJ0ZXg6IG1vcnBobm9ybWFsX3ZlcnRleCwKICAgIAltb3JwaHRhcmdldF9wYXJzX3ZlcnRleDogbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXgsCiAgICAJbW9ycGh0YXJnZXRfdmVydGV4OiBtb3JwaHRhcmdldF92ZXJ0ZXgsCiAgICAJbm9ybWFsX2ZyYWdtZW50X2JlZ2luOiBub3JtYWxfZnJhZ21lbnRfYmVnaW4sCiAgICAJbm9ybWFsX2ZyYWdtZW50X21hcHM6IG5vcm1hbF9mcmFnbWVudF9tYXBzLAogICAgCW5vcm1hbF9wYXJzX2ZyYWdtZW50OiBub3JtYWxfcGFyc19mcmFnbWVudCwKICAgIAlub3JtYWxfcGFyc192ZXJ0ZXg6IG5vcm1hbF9wYXJzX3ZlcnRleCwKICAgIAlub3JtYWxfdmVydGV4OiBub3JtYWxfdmVydGV4LAogICAgCW5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50OiBub3JtYWxtYXBfcGFyc19mcmFnbWVudCwKICAgIAljbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X2JlZ2luOiBjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X2JlZ2luLAogICAgCWNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwczogY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9tYXBzLAogICAgCWNsZWFyY29hdF9wYXJzX2ZyYWdtZW50OiBjbGVhcmNvYXRfcGFyc19mcmFnbWVudCwKICAgIAlpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50OiBpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50LAogICAgCW9wYXF1ZV9mcmFnbWVudDogb3BhcXVlX2ZyYWdtZW50LAogICAgCXBhY2tpbmc6IHBhY2tpbmcsCiAgICAJcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudDogcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCwKICAgIAlwcm9qZWN0X3ZlcnRleDogcHJvamVjdF92ZXJ0ZXgsCiAgICAJZGl0aGVyaW5nX2ZyYWdtZW50OiBkaXRoZXJpbmdfZnJhZ21lbnQsCiAgICAJZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ6IGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50LAogICAgCXJvdWdobmVzc21hcF9mcmFnbWVudDogcm91Z2huZXNzbWFwX2ZyYWdtZW50LAogICAgCXJvdWdobmVzc21hcF9wYXJzX2ZyYWdtZW50OiByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCwKICAgIAlzaGFkb3dtYXBfcGFyc19mcmFnbWVudDogc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQsCiAgICAJc2hhZG93bWFwX3BhcnNfdmVydGV4OiBzaGFkb3dtYXBfcGFyc192ZXJ0ZXgsCiAgICAJc2hhZG93bWFwX3ZlcnRleDogc2hhZG93bWFwX3ZlcnRleCwKICAgIAlzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hc2tfcGFyc19mcmFnbWVudCwKICAgIAlza2luYmFzZV92ZXJ0ZXg6IHNraW5iYXNlX3ZlcnRleCwKICAgIAlza2lubmluZ19wYXJzX3ZlcnRleDogc2tpbm5pbmdfcGFyc192ZXJ0ZXgsCiAgICAJc2tpbm5pbmdfdmVydGV4OiBza2lubmluZ192ZXJ0ZXgsCiAgICAJc2tpbm5vcm1hbF92ZXJ0ZXg6IHNraW5ub3JtYWxfdmVydGV4LAogICAgCXNwZWN1bGFybWFwX2ZyYWdtZW50OiBzcGVjdWxhcm1hcF9mcmFnbWVudCwKICAgIAlzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50OiBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50LAogICAgCXRvbmVtYXBwaW5nX2ZyYWdtZW50OiB0b25lbWFwcGluZ19mcmFnbWVudCwKICAgIAl0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50OiB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50LAogICAgCXRyYW5zbWlzc2lvbl9mcmFnbWVudDogdHJhbnNtaXNzaW9uX2ZyYWdtZW50LAogICAgCXRyYW5zbWlzc2lvbl9wYXJzX2ZyYWdtZW50OiB0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudCwKICAgIAl1dl9wYXJzX2ZyYWdtZW50OiB1dl9wYXJzX2ZyYWdtZW50LAogICAgCXV2X3BhcnNfdmVydGV4OiB1dl9wYXJzX3ZlcnRleCwKICAgIAl1dl92ZXJ0ZXg6IHV2X3ZlcnRleCwKICAgIAl3b3JsZHBvc192ZXJ0ZXg6IHdvcmxkcG9zX3ZlcnRleCwKCiAgICAJYmFja2dyb3VuZF92ZXJ0OiB2ZXJ0ZXgkaCwKICAgIAliYWNrZ3JvdW5kX2ZyYWc6IGZyYWdtZW50JGgsCiAgICAJYmFja2dyb3VuZEN1YmVfdmVydDogdmVydGV4JGcsCiAgICAJYmFja2dyb3VuZEN1YmVfZnJhZzogZnJhZ21lbnQkZywKICAgIAljdWJlX3ZlcnQ6IHZlcnRleCRmLAogICAgCWN1YmVfZnJhZzogZnJhZ21lbnQkZiwKICAgIAlkZXB0aF92ZXJ0OiB2ZXJ0ZXgkZSwKICAgIAlkZXB0aF9mcmFnOiBmcmFnbWVudCRlLAogICAgCWRpc3RhbmNlUkdCQV92ZXJ0OiB2ZXJ0ZXgkZCwKICAgIAlkaXN0YW5jZVJHQkFfZnJhZzogZnJhZ21lbnQkZCwKICAgIAllcXVpcmVjdF92ZXJ0OiB2ZXJ0ZXgkYywKICAgIAllcXVpcmVjdF9mcmFnOiBmcmFnbWVudCRjLAogICAgCWxpbmVkYXNoZWRfdmVydDogdmVydGV4JGIsCiAgICAJbGluZWRhc2hlZF9mcmFnOiBmcmFnbWVudCRiLAogICAgCW1lc2hiYXNpY192ZXJ0OiB2ZXJ0ZXgkYSwKICAgIAltZXNoYmFzaWNfZnJhZzogZnJhZ21lbnQkYSwKICAgIAltZXNobGFtYmVydF92ZXJ0OiB2ZXJ0ZXgkOSwKICAgIAltZXNobGFtYmVydF9mcmFnOiBmcmFnbWVudCQ5LAogICAgCW1lc2htYXRjYXBfdmVydDogdmVydGV4JDgsCiAgICAJbWVzaG1hdGNhcF9mcmFnOiBmcmFnbWVudCQ4LAogICAgCW1lc2hub3JtYWxfdmVydDogdmVydGV4JDcsCiAgICAJbWVzaG5vcm1hbF9mcmFnOiBmcmFnbWVudCQ3LAogICAgCW1lc2hwaG9uZ192ZXJ0OiB2ZXJ0ZXgkNiwKICAgIAltZXNocGhvbmdfZnJhZzogZnJhZ21lbnQkNiwKICAgIAltZXNocGh5c2ljYWxfdmVydDogdmVydGV4JDUsCiAgICAJbWVzaHBoeXNpY2FsX2ZyYWc6IGZyYWdtZW50JDUsCiAgICAJbWVzaHRvb25fdmVydDogdmVydGV4JDQsCiAgICAJbWVzaHRvb25fZnJhZzogZnJhZ21lbnQkNCwKICAgIAlwb2ludHNfdmVydDogdmVydGV4JDMsCiAgICAJcG9pbnRzX2ZyYWc6IGZyYWdtZW50JDMsCiAgICAJc2hhZG93X3ZlcnQ6IHZlcnRleCQyLAogICAgCXNoYWRvd19mcmFnOiBmcmFnbWVudCQyLAogICAgCXNwcml0ZV92ZXJ0OiB2ZXJ0ZXgkMSwKICAgIAlzcHJpdGVfZnJhZzogZnJhZ21lbnQkMQogICAgfTsKCiAgICAvLyBVbmlmb3JtcyBsaWJyYXJ5IGZvciBzaGFyZWQgd2ViZ2wgc2hhZGVycwogICAgY29uc3QgVW5pZm9ybXNMaWIgPSB7CgogICAgCWNvbW1vbjogewoKICAgIAkJZGlmZnVzZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4ZmZmZmZmICkgfSwKICAgIAkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0sCgogICAgCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJbWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCiAgICAJCWFscGhhTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCiAgICAJCWFscGhhVGVzdDogeyB2YWx1ZTogMCB9CgogICAgCX0sCgogICAgCXNwZWN1bGFybWFwOiB7CgogICAgCQlzcGVjdWxhck1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQlzcGVjdWxhck1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCiAgICAJfSwKCiAgICAJZW52bWFwOiB7CgogICAgCQllbnZNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJZW52TWFwUm90YXRpb246IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQlmbGlwRW52TWFwOiB7IHZhbHVlOiAtMSB9LAogICAgCQlyZWZsZWN0aXZpdHk6IHsgdmFsdWU6IDEuMCB9LCAvLyBiYXNpYywgbGFtYmVydCwgcGhvbmcKICAgIAkJaW9yOiB7IHZhbHVlOiAxLjUgfSwgLy8gcGh5c2ljYWwKICAgIAkJcmVmcmFjdGlvblJhdGlvOiB7IHZhbHVlOiAwLjk4IH0sIC8vIGJhc2ljLCBsYW1iZXJ0LCBwaG9uZwoKICAgIAl9LAoKICAgIAlhb21hcDogewoKICAgIAkJYW9NYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJYW9NYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKICAgIAkJYW9NYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgogICAgCX0sCgogICAgCWxpZ2h0bWFwOiB7CgogICAgCQlsaWdodE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQlsaWdodE1hcEludGVuc2l0eTogeyB2YWx1ZTogMSB9LAogICAgCQlsaWdodE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCiAgICAJfSwKCiAgICAJYnVtcG1hcDogewoKICAgIAkJYnVtcE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQlidW1wTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJYnVtcFNjYWxlOiB7IHZhbHVlOiAxIH0KCiAgICAJfSwKCiAgICAJbm9ybWFsbWFwOiB7CgogICAgCQlub3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJbm9ybWFsTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJbm9ybWFsU2NhbGU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDEsIDEgKSB9CgogICAgCX0sCgogICAgCWRpc3BsYWNlbWVudG1hcDogewoKICAgIAkJZGlzcGxhY2VtZW50TWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCWRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCWRpc3BsYWNlbWVudFNjYWxlOiB7IHZhbHVlOiAxIH0sCiAgICAJCWRpc3BsYWNlbWVudEJpYXM6IHsgdmFsdWU6IDAgfQoKICAgIAl9LAoKICAgIAllbWlzc2l2ZW1hcDogewoKICAgIAkJZW1pc3NpdmVNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJZW1pc3NpdmVNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgogICAgCX0sCgogICAgCW1ldGFsbmVzc21hcDogewoKICAgIAkJbWV0YWxuZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCW1ldGFsbmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCiAgICAJfSwKCiAgICAJcm91Z2huZXNzbWFwOiB7CgogICAgCQlyb3VnaG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJcm91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKICAgIAl9LAoKICAgIAlncmFkaWVudG1hcDogewoKICAgIAkJZ3JhZGllbnRNYXA6IHsgdmFsdWU6IG51bGwgfQoKICAgIAl9LAoKICAgIAlmb2c6IHsKCiAgICAJCWZvZ0RlbnNpdHk6IHsgdmFsdWU6IDAuMDAwMjUgfSwKICAgIAkJZm9nTmVhcjogeyB2YWx1ZTogMSB9LAogICAgCQlmb2dGYXI6IHsgdmFsdWU6IDIwMDAgfSwKICAgIAkJZm9nQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0KCiAgICAJfSwKCiAgICAJbGlnaHRzOiB7CgogICAgCQlhbWJpZW50TGlnaHRDb2xvcjogeyB2YWx1ZTogW10gfSwKCiAgICAJCWxpZ2h0UHJvYmU6IHsgdmFsdWU6IFtdIH0sCgogICAgCQlkaXJlY3Rpb25hbExpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgIAkJCWRpcmVjdGlvbjoge30sCiAgICAJCQljb2xvcjoge30KICAgIAkJfSB9LAoKICAgIAkJZGlyZWN0aW9uYWxMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCiAgICAJCQlzaGFkb3dCaWFzOiB7fSwKICAgIAkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAogICAgCQkJc2hhZG93UmFkaXVzOiB7fSwKICAgIAkJCXNoYWRvd01hcFNpemU6IHt9CiAgICAJCX0gfSwKCiAgICAJCWRpcmVjdGlvbmFsU2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAogICAgCQlkaXJlY3Rpb25hbFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKCiAgICAJCXNwb3RMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CiAgICAJCQljb2xvcjoge30sCiAgICAJCQlwb3NpdGlvbjoge30sCiAgICAJCQlkaXJlY3Rpb246IHt9LAogICAgCQkJZGlzdGFuY2U6IHt9LAogICAgCQkJY29uZUNvczoge30sCiAgICAJCQlwZW51bWJyYUNvczoge30sCiAgICAJCQlkZWNheToge30KICAgIAkJfSB9LAoKICAgIAkJc3BvdExpZ2h0U2hhZG93czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgIAkJCXNoYWRvd0ludGVuc2l0eTogMSwKICAgIAkJCXNoYWRvd0JpYXM6IHt9LAogICAgCQkJc2hhZG93Tm9ybWFsQmlhczoge30sCiAgICAJCQlzaGFkb3dSYWRpdXM6IHt9LAogICAgCQkJc2hhZG93TWFwU2l6ZToge30KICAgIAkJfSB9LAoKICAgIAkJc3BvdExpZ2h0TWFwOiB7IHZhbHVlOiBbXSB9LAogICAgCQlzcG90U2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAogICAgCQlzcG90TGlnaHRNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCgogICAgCQlwb2ludExpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgIAkJCWNvbG9yOiB7fSwKICAgIAkJCXBvc2l0aW9uOiB7fSwKICAgIAkJCWRlY2F5OiB7fSwKICAgIAkJCWRpc3RhbmNlOiB7fQogICAgCQl9IH0sCgogICAgCQlwb2ludExpZ2h0U2hhZG93czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgIAkJCXNoYWRvd0ludGVuc2l0eTogMSwKICAgIAkJCXNoYWRvd0JpYXM6IHt9LAogICAgCQkJc2hhZG93Tm9ybWFsQmlhczoge30sCiAgICAJCQlzaGFkb3dSYWRpdXM6IHt9LAogICAgCQkJc2hhZG93TWFwU2l6ZToge30sCiAgICAJCQlzaGFkb3dDYW1lcmFOZWFyOiB7fSwKICAgIAkJCXNoYWRvd0NhbWVyYUZhcjoge30KICAgIAkJfSB9LAoKICAgIAkJcG9pbnRTaGFkb3dNYXA6IHsgdmFsdWU6IFtdIH0sCiAgICAJCXBvaW50U2hhZG93TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKICAgIAkJaGVtaXNwaGVyZUxpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgIAkJCWRpcmVjdGlvbjoge30sCiAgICAJCQlza3lDb2xvcjoge30sCiAgICAJCQlncm91bmRDb2xvcjoge30KICAgIAkJfSB9LAoKICAgIAkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IFJlY3RBcmVhTGlnaHQgQlJERiBkYXRhIG5lZWRzIHRvIGJlIG1vdmVkIGZyb20gZXhhbXBsZSB0byBtYWluIHNyYwogICAgCQlyZWN0QXJlYUxpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKICAgIAkJCWNvbG9yOiB7fSwKICAgIAkJCXBvc2l0aW9uOiB7fSwKICAgIAkJCXdpZHRoOiB7fSwKICAgIAkJCWhlaWdodDoge30KICAgIAkJfSB9LAoKICAgIAkJbHRjXzE6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJbHRjXzI6IHsgdmFsdWU6IG51bGwgfQoKICAgIAl9LAoKICAgIAlwb2ludHM6IHsKCiAgICAJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCiAgICAJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAogICAgCQlzaXplOiB7IHZhbHVlOiAxLjAgfSwKICAgIAkJc2NhbGU6IHsgdmFsdWU6IDEuMCB9LAogICAgCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJYWxwaGFNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfSwKICAgIAkJdXZUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgogICAgCX0sCgogICAgCXNwcml0ZTogewoKICAgIAkJZGlmZnVzZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4ZmZmZmZmICkgfSwKICAgIAkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0sCiAgICAJCWNlbnRlcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMC41LCAwLjUgKSB9LAogICAgCQlyb3RhdGlvbjogeyB2YWx1ZTogMC4wIH0sCiAgICAJCW1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQltYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQlhbHBoYU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCWFscGhhVGVzdDogeyB2YWx1ZTogMCB9CgogICAgCX0KCiAgICB9OwoKICAgIGNvbnN0IFNoYWRlckxpYiA9IHsKCiAgICAJYmFzaWM6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZW52bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYW9tYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmZvZwogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY192ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGJhc2ljX2ZyYWcKCiAgICAJfSwKCiAgICAJbGFtYmVydDogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIuY29tbW9uLAogICAgCQkJVW5pZm9ybXNMaWIuc3BlY3VsYXJtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5lbnZtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5hb21hcCwKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZW1pc3NpdmVtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZm9nLAogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRzLAogICAgCQkJewogICAgCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9CiAgICAJCQl9CiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGxhbWJlcnRfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X2ZyYWcKCiAgICAJfSwKCiAgICAJcGhvbmc6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZW52bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYW9tYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0cywKICAgIAkJCXsKICAgIAkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKICAgIAkJCQlzcGVjdWxhcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MTExMTExICkgfSwKICAgIAkJCQlzaGluaW5lc3M6IHsgdmFsdWU6IDMwIH0KICAgIAkJCX0KICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaG9uZ19mcmFnCgogICAgCX0sCgogICAgCXN0YW5kYXJkOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5lbnZtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5hb21hcCwKICAgIAkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZW1pc3NpdmVtYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAogICAgCQkJVW5pZm9ybXNMaWIucm91Z2huZXNzbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubWV0YWxuZXNzbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZm9nLAogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRzLAogICAgCQkJewogICAgCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9LAogICAgCQkJCXJvdWdobmVzczogeyB2YWx1ZTogMS4wIH0sCiAgICAJCQkJbWV0YWxuZXNzOiB7IHZhbHVlOiAwLjAgfSwKICAgIAkJCQllbnZNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfQogICAgCQkJfQogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX2ZyYWcKCiAgICAJfSwKCiAgICAJdG9vbjogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIuY29tbW9uLAogICAgCQkJVW5pZm9ybXNMaWIuYW9tYXAsCiAgICAJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmdyYWRpZW50bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZm9nLAogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRzLAogICAgCQkJewogICAgCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9CiAgICAJCQl9CiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHRvb25fdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2h0b29uX2ZyYWcKCiAgICAJfSwKCiAgICAJbWF0Y2FwOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAogICAgCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAogICAgCQkJVW5pZm9ybXNMaWIuZm9nLAogICAgCQkJewogICAgCQkJCW1hdGNhcDogeyB2YWx1ZTogbnVsbCB9CiAgICAJCQl9CiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG1hdGNhcF92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG1hdGNhcF9mcmFnCgogICAgCX0sCgogICAgCXBvaW50czogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIucG9pbnRzLAogICAgCQkJVW5pZm9ybXNMaWIuZm9nCiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsucG9pbnRzX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5wb2ludHNfZnJhZwoKICAgIAl9LAoKICAgIAlkYXNoZWQ6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLmZvZywKICAgIAkJCXsKICAgIAkJCQlzY2FsZTogeyB2YWx1ZTogMSB9LAogICAgCQkJCWRhc2hTaXplOiB7IHZhbHVlOiAxIH0sCiAgICAJCQkJdG90YWxTaXplOiB7IHZhbHVlOiAyIH0KICAgIAkJCX0KICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5saW5lZGFzaGVkX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5saW5lZGFzaGVkX2ZyYWcKCiAgICAJfSwKCiAgICAJZGVwdGg6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLmNvbW1vbiwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcAogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmRlcHRoX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF9mcmFnCgogICAgCX0sCgogICAgCW5vcm1hbDogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIuY29tbW9uLAogICAgCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKICAgIAkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKICAgIAkJCXsKICAgIAkJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfQogICAgCQkJfQogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hub3JtYWxfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hub3JtYWxfZnJhZwoKICAgIAl9LAoKICAgIAlzcHJpdGU6IHsKCiAgICAJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJCVVuaWZvcm1zTGliLnNwcml0ZSwKICAgIAkJCVVuaWZvcm1zTGliLmZvZwogICAgCQldICksCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV92ZXJ0LAogICAgCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc3ByaXRlX2ZyYWcKCiAgICAJfSwKCiAgICAJYmFja2dyb3VuZDogewoKICAgIAkJdW5pZm9ybXM6IHsKICAgIAkJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCXQyRDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJYmFja2dyb3VuZEludGVuc2l0eTogeyB2YWx1ZTogMSB9CiAgICAJCX0sCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfZnJhZwoKICAgIAl9LAoKICAgIAliYWNrZ3JvdW5kQ3ViZTogewoKICAgIAkJdW5pZm9ybXM6IHsKICAgIAkJCWVudk1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJZmxpcEVudk1hcDogeyB2YWx1ZTogLTEgfSwKICAgIAkJCWJhY2tncm91bmRCbHVycmluZXNzOiB7IHZhbHVlOiAwIH0sCiAgICAJCQliYWNrZ3JvdW5kSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCiAgICAJCQliYWNrZ3JvdW5kUm90YXRpb246IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CiAgICAJCX0sCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRDdWJlX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kQ3ViZV9mcmFnCgogICAgCX0sCgogICAgCWN1YmU6IHsKCiAgICAJCXVuaWZvcm1zOiB7CiAgICAJCQl0Q3ViZTogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJdEZsaXA6IHsgdmFsdWU6IC0xIH0sCiAgICAJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfQogICAgCQl9LAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5jdWJlX3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5jdWJlX2ZyYWcKCiAgICAJfSwKCiAgICAJZXF1aXJlY3Q6IHsKCiAgICAJCXVuaWZvcm1zOiB7CiAgICAJCQl0RXF1aXJlY3Q6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJfSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZXF1aXJlY3RfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmVxdWlyZWN0X2ZyYWcKCiAgICAJfSwKCiAgICAJZGlzdGFuY2VSR0JBOiB7CgogICAgCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCiAgICAJCQlVbmlmb3Jtc0xpYi5jb21tb24sCiAgICAJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCiAgICAJCQl7CiAgICAJCQkJcmVmZXJlbmNlUG9zaXRpb246IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSB9LAogICAgCQkJCW5lYXJEaXN0YW5jZTogeyB2YWx1ZTogMSB9LAogICAgCQkJCWZhckRpc3RhbmNlOiB7IHZhbHVlOiAxMDAwIH0KICAgIAkJCX0KICAgIAkJXSApLAoKICAgIAkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfdmVydCwKICAgIAkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmRpc3RhbmNlUkdCQV9mcmFnCgogICAgCX0sCgogICAgCXNoYWRvdzogewoKICAgIAkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwogICAgCQkJVW5pZm9ybXNMaWIubGlnaHRzLAogICAgCQkJVW5pZm9ybXNMaWIuZm9nLAogICAgCQkJewogICAgCQkJCWNvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMCApIH0sCiAgICAJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KICAgIAkJCX0sCiAgICAJCV0gKSwKCiAgICAJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X3ZlcnQsCiAgICAJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5zaGFkb3dfZnJhZwoKICAgIAl9CgogICAgfTsKCiAgICBTaGFkZXJMaWIucGh5c2ljYWwgPSB7CgogICAgCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKICAgIAkJU2hhZGVyTGliLnN0YW5kYXJkLnVuaWZvcm1zLAogICAgCQl7CiAgICAJCQljbGVhcmNvYXQ6IHsgdmFsdWU6IDAgfSwKICAgIAkJCWNsZWFyY29hdE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJY2xlYXJjb2F0TWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCWNsZWFyY29hdE5vcm1hbE1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJY2xlYXJjb2F0Tm9ybWFsTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCWNsZWFyY29hdE5vcm1hbFNjYWxlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCAxLCAxICkgfSwKICAgIAkJCWNsZWFyY29hdFJvdWdobmVzczogeyB2YWx1ZTogMCB9LAogICAgCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQljbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJZGlzcGVyc2lvbjogeyB2YWx1ZTogMCB9LAogICAgCQkJaXJpZGVzY2VuY2U6IHsgdmFsdWU6IDAgfSwKICAgIAkJCWlyaWRlc2NlbmNlTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlpcmlkZXNjZW5jZU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQlpcmlkZXNjZW5jZUlPUjogeyB2YWx1ZTogMS4zIH0sCiAgICAJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW06IHsgdmFsdWU6IDEwMCB9LAogICAgCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtOiB7IHZhbHVlOiA0MDAgfSwKICAgIAkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQlzaGVlbjogeyB2YWx1ZTogMCB9LAogICAgCQkJc2hlZW5Db2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKICAgIAkJCXNoZWVuQ29sb3JNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCXNoZWVuQ29sb3JNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJc2hlZW5Sb3VnaG5lc3M6IHsgdmFsdWU6IDEgfSwKICAgIAkJCXNoZWVuUm91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlzaGVlblJvdWdobmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQl0cmFuc21pc3Npb246IHsgdmFsdWU6IDAgfSwKICAgIAkJCXRyYW5zbWlzc2lvbk1hcDogeyB2YWx1ZTogbnVsbCB9LAogICAgCQkJdHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKICAgIAkJCXRyYW5zbWlzc2lvblNhbXBsZXJTaXplOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCkgfSwKICAgIAkJCXRyYW5zbWlzc2lvblNhbXBsZXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCXRoaWNrbmVzczogeyB2YWx1ZTogMCB9LAogICAgCQkJdGhpY2tuZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQl0aGlja25lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJYXR0ZW51YXRpb25EaXN0YW5jZTogeyB2YWx1ZTogMCB9LAogICAgCQkJYXR0ZW51YXRpb25Db2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKICAgIAkJCXNwZWN1bGFyQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAxLCAxLCAxICkgfSwKICAgIAkJCXNwZWN1bGFyQ29sb3JNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCXNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQkJc3BlY3VsYXJJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKICAgIAkJCXNwZWN1bGFySW50ZW5zaXR5TWFwOiB7IHZhbHVlOiBudWxsIH0sCiAgICAJCQlzcGVjdWxhckludGVuc2l0eU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCiAgICAJCQlhbmlzb3Ryb3B5VmVjdG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCkgfSwKICAgIAkJCWFuaXNvdHJvcHlNYXA6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCWFuaXNvdHJvcHlNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAogICAgCQl9CiAgICAJXSApLAoKICAgIAl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAogICAgCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfZnJhZwoKICAgIH07CgogICAgY29uc3QgX3JnYiA9IHsgcjogMCwgYjogMCwgZzogMCB9OwogICAgY29uc3QgX2UxJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBFdWxlcigpOwogICAgY29uc3QgX20xJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CgogICAgZnVuY3Rpb24gV2ViR0xCYWNrZ3JvdW5kKCByZW5kZXJlciwgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIHN0YXRlLCBvYmplY3RzLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICkgewoKICAgIAljb25zdCBjbGVhckNvbG9yID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwogICAgCWxldCBjbGVhckFscGhhID0gYWxwaGEgPT09IHRydWUgPyAwIDogMTsKCiAgICAJbGV0IHBsYW5lTWVzaDsKICAgIAlsZXQgYm94TWVzaDsKCiAgICAJbGV0IGN1cnJlbnRCYWNrZ3JvdW5kID0gbnVsbDsKICAgIAlsZXQgY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gMDsKICAgIAlsZXQgY3VycmVudFRvbmVtYXBwaW5nID0gbnVsbDsKCiAgICAJZnVuY3Rpb24gZ2V0QmFja2dyb3VuZCggc2NlbmUgKSB7CgogICAgCQlsZXQgYmFja2dyb3VuZCA9IHNjZW5lLmlzU2NlbmUgPT09IHRydWUgPyBzY2VuZS5iYWNrZ3JvdW5kIDogbnVsbDsKCiAgICAJCWlmICggYmFja2dyb3VuZCAmJiBiYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCiAgICAJCQljb25zdCB1c2VQTVJFTSA9IHNjZW5lLmJhY2tncm91bmRCbHVycmluZXNzID4gMDsgLy8gdXNlIFBNUkVNIGlmIHRoZSB1c2VyIHdhbnRzIHRvIGJsdXIgdGhlIGJhY2tncm91bmQKICAgIAkJCWJhY2tncm91bmQgPSAoIHVzZVBNUkVNID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBiYWNrZ3JvdW5kICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gYmFja2dyb3VuZDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXIoIHNjZW5lICkgewoKICAgIAkJbGV0IGZvcmNlQ2xlYXIgPSBmYWxzZTsKICAgIAkJY29uc3QgYmFja2dyb3VuZCA9IGdldEJhY2tncm91bmQoIHNjZW5lICk7CgogICAgCQlpZiAoIGJhY2tncm91bmQgPT09IG51bGwgKSB7CgogICAgCQkJc2V0Q2xlYXIoIGNsZWFyQ29sb3IsIGNsZWFyQWxwaGEgKTsKCiAgICAJCX0gZWxzZSBpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc0NvbG9yICkgewoKICAgIAkJCXNldENsZWFyKCBiYWNrZ3JvdW5kLCAxICk7CiAgICAJCQlmb3JjZUNsZWFyID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IGVudmlyb25tZW50QmxlbmRNb2RlID0gcmVuZGVyZXIueHIuZ2V0RW52aXJvbm1lbnRCbGVuZE1vZGUoKTsKCiAgICAJCWlmICggZW52aXJvbm1lbnRCbGVuZE1vZGUgPT09ICdhZGRpdGl2ZScgKSB7CgogICAgCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMCwgMCwgMCwgMSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgogICAgCQl9IGVsc2UgaWYgKCBlbnZpcm9ubWVudEJsZW5kTW9kZSA9PT0gJ2FscGhhLWJsZW5kJyApIHsKCiAgICAJCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCAwLCAwLCAwLCAwLCBwcmVtdWx0aXBsaWVkQWxwaGEgKTsKCiAgICAJCX0KCiAgICAJCWlmICggcmVuZGVyZXIuYXV0b0NsZWFyIHx8IGZvcmNlQ2xlYXIgKSB7CgogICAgCQkJLy8gYnVmZmVycyBtaWdodCBub3QgYmUgd3JpdGFibGUgd2hpY2ggaXMgcmVxdWlyZWQgdG8gZW5zdXJlIGEgY29ycmVjdCBjbGVhcgoKICAgIAkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0VGVzdCggdHJ1ZSApOwogICAgCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRNYXNrKCB0cnVlICk7CiAgICAJCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldE1hc2soIHRydWUgKTsKCiAgICAJCQlyZW5kZXJlci5jbGVhciggcmVuZGVyZXIuYXV0b0NsZWFyQ29sb3IsIHJlbmRlcmVyLmF1dG9DbGVhckRlcHRoLCByZW5kZXJlci5hdXRvQ2xlYXJTdGVuY2lsICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYWRkVG9SZW5kZXJMaXN0KCByZW5kZXJMaXN0LCBzY2VuZSApIHsKCiAgICAJCWNvbnN0IGJhY2tncm91bmQgPSBnZXRCYWNrZ3JvdW5kKCBzY2VuZSApOwoKICAgIAkJaWYgKCBiYWNrZ3JvdW5kICYmICggYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlIHx8IGJhY2tncm91bmQubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSApIHsKCiAgICAJCQlpZiAoIGJveE1lc2ggPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJYm94TWVzaCA9IG5ldyBNZXNoKAogICAgCQkJCQluZXcgQm94R2VvbWV0cnkoIDEsIDEsIDEgKSwKICAgIAkJCQkJbmV3IFNoYWRlck1hdGVyaWFsKCB7CiAgICAJCQkJCQluYW1lOiAnQmFja2dyb3VuZEN1YmVNYXRlcmlhbCcsCiAgICAJCQkJCQl1bmlmb3JtczogY2xvbmVVbmlmb3JtcyggU2hhZGVyTGliLmJhY2tncm91bmRDdWJlLnVuaWZvcm1zICksCiAgICAJCQkJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS52ZXJ0ZXhTaGFkZXIsCiAgICAJCQkJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyTGliLmJhY2tncm91bmRDdWJlLmZyYWdtZW50U2hhZGVyLAogICAgCQkJCQkJc2lkZTogQmFja1NpZGUsCiAgICAJCQkJCQlkZXB0aFRlc3Q6IGZhbHNlLAogICAgCQkJCQkJZGVwdGhXcml0ZTogZmFsc2UsCiAgICAJCQkJCQlmb2c6IGZhbHNlLAogICAgCQkJCQkJYWxsb3dPdmVycmlkZTogZmFsc2UKICAgIAkJCQkJfSApCiAgICAJCQkJKTsKCiAgICAJCQkJYm94TWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoICdub3JtYWwnICk7CiAgICAJCQkJYm94TWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoICd1dicgKTsKCiAgICAJCQkJYm94TWVzaC5vbkJlZm9yZVJlbmRlciA9IGZ1bmN0aW9uICggcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEgKSB7CgogICAgCQkJCQl0aGlzLm1hdHJpeFdvcmxkLmNvcHlQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgogICAgCQkJCX07CgogICAgCQkJCS8vIGFkZCAiZW52TWFwIiBtYXRlcmlhbCBwcm9wZXJ0eSBzbyB0aGUgcmVuZGVyZXIgY2FuIGV2YWx1YXRlIGl0IGxpa2UgZm9yIGJ1aWx0LWluIG1hdGVyaWFscwogICAgCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggYm94TWVzaC5tYXRlcmlhbCwgJ2Vudk1hcCcsIHsKCiAgICAJCQkJCWdldDogZnVuY3Rpb24gKCkgewoKICAgIAkJCQkJCXJldHVybiB0aGlzLnVuaWZvcm1zLmVudk1hcC52YWx1ZTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSApOwoKICAgIAkJCQlvYmplY3RzLnVwZGF0ZSggYm94TWVzaCApOwoKICAgIAkJCX0KCiAgICAJCQlfZTEkMS5jb3B5KCBzY2VuZS5iYWNrZ3JvdW5kUm90YXRpb24gKTsKCiAgICAJCQkvLyBhY2NvbW1vZGF0ZSBsZWZ0LWhhbmRlZCBmcmFtZQogICAgCQkJX2UxJDEueCAqPSAtMTsgX2UxJDEueSAqPSAtMTsgX2UxJDEueiAqPSAtMTsKCiAgICAJCQlpZiAoIGJhY2tncm91bmQuaXNDdWJlVGV4dHVyZSAmJiBiYWNrZ3JvdW5kLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCS8vIGVudmlyb25tZW50IG1hcHMgd2hpY2ggYXJlIG5vdCBjdWJlIHJlbmRlciB0YXJnZXRzIG9yIFBNUkVNcyBmb2xsb3cgYSBkaWZmZXJlbnQgY29udmVudGlvbgogICAgCQkJCV9lMSQxLnkgKj0gLTE7CiAgICAJCQkJX2UxJDEueiAqPSAtMTsKCiAgICAJCQl9CgogICAgCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBiYWNrZ3JvdW5kOwogICAgCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBiYWNrZ3JvdW5kLmlzQ3ViZVRleHR1cmUgJiYgYmFja2dyb3VuZC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CiAgICAJCQlib3hNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhY2tncm91bmRCbHVycmluZXNzLnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEJsdXJyaW5lc3M7CiAgICAJCQlib3hNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhY2tncm91bmRJbnRlbnNpdHkudmFsdWUgPSBzY2VuZS5iYWNrZ3JvdW5kSW50ZW5zaXR5OwogICAgCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kUm90YXRpb24udmFsdWUuc2V0RnJvbU1hdHJpeDQoIF9tMSQxLm1ha2VSb3RhdGlvbkZyb21FdWxlciggX2UxJDEgKSApOwogICAgCQkJYm94TWVzaC5tYXRlcmlhbC50b25lTWFwcGVkID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBiYWNrZ3JvdW5kLmNvbG9yU3BhY2UgKSAhPT0gU1JHQlRyYW5zZmVyOwoKICAgIAkJCWlmICggY3VycmVudEJhY2tncm91bmQgIT09IGJhY2tncm91bmQgfHwKICAgIAkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gIT09IGJhY2tncm91bmQudmVyc2lvbiB8fAogICAgCQkJCWN1cnJlbnRUb25lbWFwcGluZyAhPT0gcmVuZGVyZXIudG9uZU1hcHBpbmcgKSB7CgogICAgCQkJCWJveE1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CiAgICAJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gYmFja2dyb3VuZC52ZXJzaW9uOwogICAgCQkJCWN1cnJlbnRUb25lbWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKICAgIAkJCX0KCiAgICAJCQlib3hNZXNoLmxheWVycy5lbmFibGVBbGwoKTsKCiAgICAJCQkvLyBwdXNoIHRvIHRoZSBwcmUtc29ydGVkIG9wYXF1ZSByZW5kZXIgbGlzdAogICAgCQkJcmVuZGVyTGlzdC51bnNoaWZ0KCBib3hNZXNoLCBib3hNZXNoLmdlb21ldHJ5LCBib3hNZXNoLm1hdGVyaWFsLCAwLCAwLCBudWxsICk7CgogICAgCQl9IGVsc2UgaWYgKCBiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNUZXh0dXJlICkgewoKICAgIAkJCWlmICggcGxhbmVNZXNoID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXBsYW5lTWVzaCA9IG5ldyBNZXNoKAogICAgCQkJCQluZXcgUGxhbmVHZW9tZXRyeSggMiwgMiApLAogICAgCQkJCQluZXcgU2hhZGVyTWF0ZXJpYWwoIHsKICAgIAkJCQkJCW5hbWU6ICdCYWNrZ3JvdW5kTWF0ZXJpYWwnLAogICAgCQkJCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIFNoYWRlckxpYi5iYWNrZ3JvdW5kLnVuaWZvcm1zICksCiAgICAJCQkJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kLnZlcnRleFNoYWRlciwKICAgIAkJCQkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC5mcmFnbWVudFNoYWRlciwKICAgIAkJCQkJCXNpZGU6IEZyb250U2lkZSwKICAgIAkJCQkJCWRlcHRoVGVzdDogZmFsc2UsCiAgICAJCQkJCQlkZXB0aFdyaXRlOiBmYWxzZSwKICAgIAkJCQkJCWZvZzogZmFsc2UsCiAgICAJCQkJCQlhbGxvd092ZXJyaWRlOiBmYWxzZQogICAgCQkJCQl9ICkKICAgIAkJCQkpOwoKICAgIAkJCQlwbGFuZU1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbm9ybWFsJyApOwoKICAgIAkJCQkvLyBhZGQgIm1hcCIgbWF0ZXJpYWwgcHJvcGVydHkgc28gdGhlIHJlbmRlcmVyIGNhbiBldmFsdWF0ZSBpdCBsaWtlIGZvciBidWlsdC1pbiBtYXRlcmlhbHMKICAgIAkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHBsYW5lTWVzaC5tYXRlcmlhbCwgJ21hcCcsIHsKCiAgICAJCQkJCWdldDogZnVuY3Rpb24gKCkgewoKICAgIAkJCQkJCXJldHVybiB0aGlzLnVuaWZvcm1zLnQyRC52YWx1ZTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSApOwoKICAgIAkJCQlvYmplY3RzLnVwZGF0ZSggcGxhbmVNZXNoICk7CgogICAgCQkJfQoKICAgIAkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy50MkQudmFsdWUgPSBiYWNrZ3JvdW5kOwogICAgCQkJcGxhbmVNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhY2tncm91bmRJbnRlbnNpdHkudmFsdWUgPSBzY2VuZS5iYWNrZ3JvdW5kSW50ZW5zaXR5OwogICAgCQkJcGxhbmVNZXNoLm1hdGVyaWFsLnRvbmVNYXBwZWQgPSBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGJhY2tncm91bmQuY29sb3JTcGFjZSApICE9PSBTUkdCVHJhbnNmZXI7CgogICAgCQkJaWYgKCBiYWNrZ3JvdW5kLm1hdHJpeEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgogICAgCQkJCWJhY2tncm91bmQudXBkYXRlTWF0cml4KCk7CgogICAgCQkJfQoKICAgIAkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy51dlRyYW5zZm9ybS52YWx1ZS5jb3B5KCBiYWNrZ3JvdW5kLm1hdHJpeCApOwoKICAgIAkJCWlmICggY3VycmVudEJhY2tncm91bmQgIT09IGJhY2tncm91bmQgfHwKICAgIAkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gIT09IGJhY2tncm91bmQudmVyc2lvbiB8fAogICAgCQkJCWN1cnJlbnRUb25lbWFwcGluZyAhPT0gcmVuZGVyZXIudG9uZU1hcHBpbmcgKSB7CgogICAgCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQkJCWN1cnJlbnRCYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKICAgIAkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gPSBiYWNrZ3JvdW5kLnZlcnNpb247CiAgICAJCQkJY3VycmVudFRvbmVtYXBwaW5nID0gcmVuZGVyZXIudG9uZU1hcHBpbmc7CgogICAgCQkJfQoKICAgIAkJCXBsYW5lTWVzaC5sYXllcnMuZW5hYmxlQWxsKCk7CgogICAgCQkJLy8gcHVzaCB0byB0aGUgcHJlLXNvcnRlZCBvcGFxdWUgcmVuZGVyIGxpc3QKICAgIAkJCXJlbmRlckxpc3QudW5zaGlmdCggcGxhbmVNZXNoLCBwbGFuZU1lc2guZ2VvbWV0cnksIHBsYW5lTWVzaC5tYXRlcmlhbCwgMCwgMCwgbnVsbCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldENsZWFyKCBjb2xvciwgYWxwaGEgKSB7CgogICAgCQljb2xvci5nZXRSR0IoIF9yZ2IsIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgKTsKCiAgICAJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIF9yZ2IuciwgX3JnYi5nLCBfcmdiLmIsIGFscGhhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJaWYgKCBib3hNZXNoICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJYm94TWVzaC5nZW9tZXRyeS5kaXNwb3NlKCk7CiAgICAJCQlib3hNZXNoLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCiAgICAJCQlib3hNZXNoID0gdW5kZWZpbmVkOwoKICAgIAkJfQoKICAgIAkJaWYgKCBwbGFuZU1lc2ggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlwbGFuZU1lc2guZ2VvbWV0cnkuZGlzcG9zZSgpOwogICAgCQkJcGxhbmVNZXNoLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCiAgICAJCQlwbGFuZU1lc2ggPSB1bmRlZmluZWQ7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCWdldENsZWFyQ29sb3I6IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gY2xlYXJDb2xvcjsKCiAgICAJCX0sCiAgICAJCXNldENsZWFyQ29sb3I6IGZ1bmN0aW9uICggY29sb3IsIGFscGhhID0gMSApIHsKCiAgICAJCQljbGVhckNvbG9yLnNldCggY29sb3IgKTsKICAgIAkJCWNsZWFyQWxwaGEgPSBhbHBoYTsKICAgIAkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgogICAgCQl9LAogICAgCQlnZXRDbGVhckFscGhhOiBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGNsZWFyQWxwaGE7CgogICAgCQl9LAogICAgCQlzZXRDbGVhckFscGhhOiBmdW5jdGlvbiAoIGFscGhhICkgewoKICAgIAkJCWNsZWFyQWxwaGEgPSBhbHBoYTsKICAgIAkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgogICAgCQl9LAogICAgCQlyZW5kZXI6IHJlbmRlciwKICAgIAkJYWRkVG9SZW5kZXJMaXN0OiBhZGRUb1JlbmRlckxpc3QsCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UKCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xCaW5kaW5nU3RhdGVzKCBnbCwgYXR0cmlidXRlcyApIHsKCiAgICAJY29uc3QgbWF4VmVydGV4QXR0cmlidXRlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9BVFRSSUJTICk7CgogICAgCWNvbnN0IGJpbmRpbmdTdGF0ZXMgPSB7fTsKCiAgICAJY29uc3QgZGVmYXVsdFN0YXRlID0gY3JlYXRlQmluZGluZ1N0YXRlKCBudWxsICk7CiAgICAJbGV0IGN1cnJlbnRTdGF0ZSA9IGRlZmF1bHRTdGF0ZTsKICAgIAlsZXQgZm9yY2VVcGRhdGUgPSBmYWxzZTsKCiAgICAJZnVuY3Rpb24gc2V0dXAoIG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5LCBpbmRleCApIHsKCiAgICAJCWxldCB1cGRhdGVCdWZmZXJzID0gZmFsc2U7CgogICAgCQljb25zdCBzdGF0ZSA9IGdldEJpbmRpbmdTdGF0ZSggZ2VvbWV0cnksIHByb2dyYW0sIG1hdGVyaWFsICk7CgogICAgCQlpZiAoIGN1cnJlbnRTdGF0ZSAhPT0gc3RhdGUgKSB7CgogICAgCQkJY3VycmVudFN0YXRlID0gc3RhdGU7CiAgICAJCQliaW5kVmVydGV4QXJyYXlPYmplY3QoIGN1cnJlbnRTdGF0ZS5vYmplY3QgKTsKCiAgICAJCX0KCiAgICAJCXVwZGF0ZUJ1ZmZlcnMgPSBuZWVkc1VwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKTsKCiAgICAJCWlmICggdXBkYXRlQnVmZmVycyApIHNhdmVDYWNoZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKTsKCiAgICAJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJYXR0cmlidXRlcy51cGRhdGUoIGluZGV4LCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiApOwoKICAgIAkJfQoKICAgIAkJaWYgKCB1cGRhdGVCdWZmZXJzIHx8IGZvcmNlVXBkYXRlICkgewoKICAgIAkJCWZvcmNlVXBkYXRlID0gZmFsc2U7CgogICAgCQkJc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSApOwoKICAgIAkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJCWdsLmJpbmRCdWZmZXIoIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBhdHRyaWJ1dGVzLmdldCggaW5kZXggKS5idWZmZXIgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gY3JlYXRlVmVydGV4QXJyYXlPYmplY3QoKSB7CgogICAgCQlyZXR1cm4gZ2wuY3JlYXRlVmVydGV4QXJyYXkoKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBiaW5kVmVydGV4QXJyYXlPYmplY3QoIHZhbyApIHsKCiAgICAJCXJldHVybiBnbC5iaW5kVmVydGV4QXJyYXkoIHZhbyApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCB2YW8gKSB7CgogICAgCQlyZXR1cm4gZ2wuZGVsZXRlVmVydGV4QXJyYXkoIHZhbyApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldEJpbmRpbmdTdGF0ZSggZ2VvbWV0cnksIHByb2dyYW0sIG1hdGVyaWFsICkgewoKICAgIAkJY29uc3Qgd2lyZWZyYW1lID0gKCBtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWUgKTsKCiAgICAJCWxldCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXTsKCiAgICAJCWlmICggcHJvZ3JhbU1hcCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXByb2dyYW1NYXAgPSB7fTsKICAgIAkJCWJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF0gPSBwcm9ncmFtTWFwOwoKICAgIAkJfQoKICAgIAkJbGV0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdOwoKICAgIAkJaWYgKCBzdGF0ZU1hcCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXN0YXRlTWFwID0ge307CiAgICAJCQlwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF0gPSBzdGF0ZU1hcDsKCiAgICAJCX0KCiAgICAJCWxldCBzdGF0ZSA9IHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCiAgICAJCWlmICggc3RhdGUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlzdGF0ZSA9IGNyZWF0ZUJpbmRpbmdTdGF0ZSggY3JlYXRlVmVydGV4QXJyYXlPYmplY3QoKSApOwogICAgCQkJc3RhdGVNYXBbIHdpcmVmcmFtZSBdID0gc3RhdGU7CgogICAgCQl9CgogICAgCQlyZXR1cm4gc3RhdGU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gY3JlYXRlQmluZGluZ1N0YXRlKCB2YW8gKSB7CgogICAgCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gW107CiAgICAJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gW107CiAgICAJCWNvbnN0IGF0dHJpYnV0ZURpdmlzb3JzID0gW107CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXhWZXJ0ZXhBdHRyaWJ1dGVzOyBpICsrICkgewoKICAgIAkJCW5ld0F0dHJpYnV0ZXNbIGkgXSA9IDA7CiAgICAJCQllbmFibGVkQXR0cmlidXRlc1sgaSBdID0gMDsKICAgIAkJCWF0dHJpYnV0ZURpdmlzb3JzWyBpIF0gPSAwOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHsKCiAgICAJCQkvLyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBvbiBub24tVkFPIHN1cHBvcnQgYnJvd3NlcgogICAgCQkJZ2VvbWV0cnk6IG51bGwsCiAgICAJCQlwcm9ncmFtOiBudWxsLAogICAgCQkJd2lyZWZyYW1lOiBmYWxzZSwKCiAgICAJCQluZXdBdHRyaWJ1dGVzOiBuZXdBdHRyaWJ1dGVzLAogICAgCQkJZW5hYmxlZEF0dHJpYnV0ZXM6IGVuYWJsZWRBdHRyaWJ1dGVzLAogICAgCQkJYXR0cmlidXRlRGl2aXNvcnM6IGF0dHJpYnV0ZURpdmlzb3JzLAogICAgCQkJb2JqZWN0OiB2YW8sCiAgICAJCQlhdHRyaWJ1dGVzOiB7fSwKICAgIAkJCWluZGV4OiBudWxsCgogICAgCQl9OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIG5lZWRzVXBkYXRlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtLCBpbmRleCApIHsKCiAgICAJCWNvbnN0IGNhY2hlZEF0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUuYXR0cmlidXRlczsKICAgIAkJY29uc3QgZ2VvbWV0cnlBdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCiAgICAJCWxldCBhdHRyaWJ1dGVzTnVtID0gMDsKCiAgICAJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGVzID0gcHJvZ3JhbS5nZXRBdHRyaWJ1dGVzKCk7CgogICAgCQlmb3IgKCBjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKICAgIAkJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGUgPSBwcm9ncmFtQXR0cmlidXRlc1sgbmFtZSBdOwoKICAgIAkJCWlmICggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiA+PSAwICkgewoKICAgIAkJCQljb25zdCBjYWNoZWRBdHRyaWJ1dGUgPSBjYWNoZWRBdHRyaWJ1dGVzWyBuYW1lIF07CiAgICAJCQkJbGV0IGdlb21ldHJ5QXR0cmlidXRlID0gZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlTWF0cml4JyAmJiBvYmplY3QuaW5zdGFuY2VNYXRyaXggKSBnZW9tZXRyeUF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZU1hdHJpeDsKICAgIAkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VDb2xvcicgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgKSBnZW9tZXRyeUF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggY2FjaGVkQXR0cmlidXRlID09PSB1bmRlZmluZWQgKSByZXR1cm4gdHJ1ZTsKCiAgICAJCQkJaWYgKCBjYWNoZWRBdHRyaWJ1dGUuYXR0cmlidXRlICE9PSBnZW9tZXRyeUF0dHJpYnV0ZSApIHJldHVybiB0cnVlOwoKICAgIAkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlICYmIGNhY2hlZEF0dHJpYnV0ZS5kYXRhICE9PSBnZW9tZXRyeUF0dHJpYnV0ZS5kYXRhICkgcmV0dXJuIHRydWU7CgogICAgCQkJCWF0dHJpYnV0ZXNOdW0gKys7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBjdXJyZW50U3RhdGUuYXR0cmlidXRlc051bSAhPT0gYXR0cmlidXRlc051bSApIHJldHVybiB0cnVlOwoKICAgIAkJaWYgKCBjdXJyZW50U3RhdGUuaW5kZXggIT09IGluZGV4ICkgcmV0dXJuIHRydWU7CgogICAgCQlyZXR1cm4gZmFsc2U7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2F2ZUNhY2hlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtLCBpbmRleCApIHsKCiAgICAJCWNvbnN0IGNhY2hlID0ge307CiAgICAJCWNvbnN0IGF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwogICAgCQlsZXQgYXR0cmlidXRlc051bSA9IDA7CgogICAgCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKICAgIAkJZm9yICggY29uc3QgbmFtZSBpbiBwcm9ncmFtQXR0cmlidXRlcyApIHsKCiAgICAJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gPj0gMCApIHsKCiAgICAJCQkJbGV0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKCiAgICAJCQkJaWYgKCBhdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlTWF0cml4JyAmJiBvYmplY3QuaW5zdGFuY2VNYXRyaXggKSBhdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CiAgICAJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlQ29sb3InICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICkgYXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlQ29sb3I7CgogICAgCQkJCX0KCiAgICAJCQkJY29uc3QgZGF0YSA9IHt9OwogICAgCQkJCWRhdGEuYXR0cmlidXRlID0gYXR0cmlidXRlOwoKICAgIAkJCQlpZiAoIGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUuZGF0YSApIHsKCiAgICAJCQkJCWRhdGEuZGF0YSA9IGF0dHJpYnV0ZS5kYXRhOwoKICAgIAkJCQl9CgogICAgCQkJCWNhY2hlWyBuYW1lIF0gPSBkYXRhOwoKICAgIAkJCQlhdHRyaWJ1dGVzTnVtICsrOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVzID0gY2FjaGU7CiAgICAJCWN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVzTnVtID0gYXR0cmlidXRlc051bTsKCiAgICAJCWN1cnJlbnRTdGF0ZS5pbmRleCA9IGluZGV4OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGluaXRBdHRyaWJ1dGVzKCkgewoKICAgIAkJY29uc3QgbmV3QXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5uZXdBdHRyaWJ1dGVzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5ld0F0dHJpYnV0ZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJbmV3QXR0cmlidXRlc1sgaSBdID0gMDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBlbmFibGVBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIHsKCiAgICAJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIGF0dHJpYnV0ZSwgMCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIGF0dHJpYnV0ZSwgbWVzaFBlckF0dHJpYnV0ZSApIHsKCiAgICAJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKICAgIAkJY29uc3QgZW5hYmxlZEF0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUuZW5hYmxlZEF0dHJpYnV0ZXM7CiAgICAJCWNvbnN0IGF0dHJpYnV0ZURpdmlzb3JzID0gY3VycmVudFN0YXRlLmF0dHJpYnV0ZURpdmlzb3JzOwoKICAgIAkJbmV3QXR0cmlidXRlc1sgYXR0cmlidXRlIF0gPSAxOwoKICAgIAkJaWYgKCBlbmFibGVkQXR0cmlidXRlc1sgYXR0cmlidXRlIF0gPT09IDAgKSB7CgogICAgCQkJZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoIGF0dHJpYnV0ZSApOwogICAgCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCiAgICAJCX0KCiAgICAJCWlmICggYXR0cmlidXRlRGl2aXNvcnNbIGF0dHJpYnV0ZSBdICE9PSBtZXNoUGVyQXR0cmlidXRlICkgewoKICAgIAkJCWdsLnZlcnRleEF0dHJpYkRpdmlzb3IoIGF0dHJpYnV0ZSwgbWVzaFBlckF0dHJpYnV0ZSApOwogICAgCQkJYXR0cmlidXRlRGl2aXNvcnNbIGF0dHJpYnV0ZSBdID0gbWVzaFBlckF0dHJpYnV0ZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNhYmxlVW51c2VkQXR0cmlidXRlcygpIHsKCiAgICAJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKICAgIAkJY29uc3QgZW5hYmxlZEF0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUuZW5hYmxlZEF0dHJpYnV0ZXM7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZW5hYmxlZEF0dHJpYnV0ZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJaWYgKCBlbmFibGVkQXR0cmlidXRlc1sgaSBdICE9PSBuZXdBdHRyaWJ1dGVzWyBpIF0gKSB7CgogICAgCQkJCWdsLmRpc2FibGVWZXJ0ZXhBdHRyaWJBcnJheSggaSApOwogICAgCQkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBpIF0gPSAwOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB2ZXJ0ZXhBdHRyaWJQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgbm9ybWFsaXplZCwgc3RyaWRlLCBvZmZzZXQsIGludGVnZXIgKSB7CgogICAgCQlpZiAoIGludGVnZXIgPT09IHRydWUgKSB7CgogICAgCQkJZ2wudmVydGV4QXR0cmliSVBvaW50ZXIoIGluZGV4LCBzaXplLCB0eXBlLCBzdHJpZGUsIG9mZnNldCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgbm9ybWFsaXplZCwgc3RyaWRlLCBvZmZzZXQgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXR1cFZlcnRleEF0dHJpYnV0ZXMoIG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5ICkgewoKICAgIAkJaW5pdEF0dHJpYnV0ZXMoKTsKCiAgICAJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgogICAgCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKICAgIAkJY29uc3QgbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzID0gbWF0ZXJpYWwuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlczsKCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gcHJvZ3JhbUF0dHJpYnV0ZXMgKSB7CgogICAgCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzWyBuYW1lIF07CgogICAgCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uID49IDAgKSB7CgogICAgCQkJCWxldCBnZW9tZXRyeUF0dHJpYnV0ZSA9IGdlb21ldHJ5QXR0cmlidXRlc1sgbmFtZSBdOwoKICAgIAkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CiAgICAJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlQ29sb3InICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VDb2xvcjsKCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQljb25zdCBub3JtYWxpemVkID0gZ2VvbWV0cnlBdHRyaWJ1dGUubm9ybWFsaXplZDsKICAgIAkJCQkJY29uc3Qgc2l6ZSA9IGdlb21ldHJ5QXR0cmlidXRlLml0ZW1TaXplOwoKICAgIAkJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5QXR0cmlidXRlICk7CgogICAgCQkJCQkvLyBUT0RPIEF0dHJpYnV0ZSBtYXkgbm90IGJlIGF2YWlsYWJsZSBvbiBjb250ZXh0IHJlc3RvcmUKCiAgICAJCQkJCWlmICggYXR0cmlidXRlID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCiAgICAJCQkJCWNvbnN0IGJ1ZmZlciA9IGF0dHJpYnV0ZS5idWZmZXI7CiAgICAJCQkJCWNvbnN0IHR5cGUgPSBhdHRyaWJ1dGUudHlwZTsKICAgIAkJCQkJY29uc3QgYnl0ZXNQZXJFbGVtZW50ID0gYXR0cmlidXRlLmJ5dGVzUGVyRWxlbWVudDsKCiAgICAJCQkJCS8vIGNoZWNrIGZvciBpbnRlZ2VyIGF0dHJpYnV0ZXMKCiAgICAJCQkJCWNvbnN0IGludGVnZXIgPSAoIHR5cGUgPT09IGdsLklOVCB8fCB0eXBlID09PSBnbC5VTlNJR05FRF9JTlQgfHwgZ2VvbWV0cnlBdHRyaWJ1dGUuZ3B1VHlwZSA9PT0gSW50VHlwZSApOwoKICAgIAkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgewoKICAgIAkJCQkJCWNvbnN0IGRhdGEgPSBnZW9tZXRyeUF0dHJpYnV0ZS5kYXRhOwogICAgCQkJCQkJY29uc3Qgc3RyaWRlID0gZGF0YS5zdHJpZGU7CiAgICAJCQkJCQljb25zdCBvZmZzZXQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5vZmZzZXQ7CgogICAgCQkJCQkJaWYgKCBkYXRhLmlzSW5zdGFuY2VkSW50ZXJsZWF2ZWRCdWZmZXIgKSB7CgogICAgCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKICAgIAkJCQkJCQkJZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksIGRhdGEubWVzaFBlckF0dHJpYnV0ZSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSAmJiBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCQkJZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPSBkYXRhLm1lc2hQZXJBdHRyaWJ1dGUgKiBkYXRhLmNvdW50OwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgogICAgCQkJCQkJCQllbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9CgogICAgCQkJCQkJZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCBidWZmZXIgKTsKCiAgICAJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCiAgICAJCQkJCQkJdmVydGV4QXR0cmliUG9pbnRlcigKICAgIAkJCQkJCQkJcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksCiAgICAJCQkJCQkJCXNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSwKICAgIAkJCQkJCQkJdHlwZSwKICAgIAkJCQkJCQkJbm9ybWFsaXplZCwKICAgIAkJCQkJCQkJc3RyaWRlICogYnl0ZXNQZXJFbGVtZW50LAogICAgCQkJCQkJCQkoIG9mZnNldCArICggc2l6ZSAvIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplICkgKiBpICkgKiBieXRlc1BlckVsZW1lbnQsCiAgICAJCQkJCQkJCWludGVnZXIKICAgIAkJCQkJCQkpOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZS5pc0luc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCiAgICAJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgogICAgCQkJCQkJCQllbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSwgZ2VvbWV0cnlBdHRyaWJ1dGUubWVzaFBlckF0dHJpYnV0ZSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSAmJiBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCQkJZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPSBnZW9tZXRyeUF0dHJpYnV0ZS5tZXNoUGVyQXR0cmlidXRlICogZ2VvbWV0cnlBdHRyaWJ1dGUuY291bnQ7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCiAgICAJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZSggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGkgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQlnbC5iaW5kQnVmZmVyKCBnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlciApOwoKICAgIAkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKICAgIAkJCQkJCQl2ZXJ0ZXhBdHRyaWJQb2ludGVyKAogICAgCQkJCQkJCQlwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSwKICAgIAkJCQkJCQkJc2l6ZSAvIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplLAogICAgCQkJCQkJCQl0eXBlLAogICAgCQkJCQkJCQlub3JtYWxpemVkLAogICAgCQkJCQkJCQlzaXplICogYnl0ZXNQZXJFbGVtZW50LAogICAgCQkJCQkJCQkoIHNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSApICogaSAqIGJ5dGVzUGVyRWxlbWVudCwKICAgIAkJCQkJCQkJaW50ZWdlcgogICAgCQkJCQkJCSk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbERlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCWNvbnN0IHZhbHVlID0gbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzWyBuYW1lIF07CgogICAgCQkJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkJc3dpdGNoICggdmFsdWUubGVuZ3RoICkgewoKICAgIAkJCQkJCQljYXNlIDI6CiAgICAJCQkJCQkJCWdsLnZlcnRleEF0dHJpYjJmdiggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiwgdmFsdWUgKTsKICAgIAkJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJCWNhc2UgMzoKICAgIAkJCQkJCQkJZ2wudmVydGV4QXR0cmliM2Z2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwogICAgCQkJCQkJCQlicmVhazsKCiAgICAJCQkJCQkJY2FzZSA0OgogICAgCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWI0ZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CiAgICAJCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCQlkZWZhdWx0OgogICAgCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWIxZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJcmVzZXQoKTsKCiAgICAJCWZvciAoIGNvbnN0IGdlb21ldHJ5SWQgaW4gYmluZGluZ1N0YXRlcyApIHsKCiAgICAJCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKICAgIAkJCWZvciAoIGNvbnN0IHByb2dyYW1JZCBpbiBwcm9ncmFtTWFwICkgewoKICAgIAkJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKICAgIAkJCQlmb3IgKCBjb25zdCB3aXJlZnJhbWUgaW4gc3RhdGVNYXAgKSB7CgogICAgCQkJCQlkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCggc3RhdGVNYXBbIHdpcmVmcmFtZSBdLm9iamVjdCApOwoKICAgIAkJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCiAgICAJCQkJfQoKICAgIAkJCQlkZWxldGUgcHJvZ3JhbU1hcFsgcHJvZ3JhbUlkIF07CgogICAgCQkJfQoKICAgIAkJCWRlbGV0ZSBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeUlkIF07CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoIGdlb21ldHJ5ICkgewoKICAgIAkJaWYgKCBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdID09PSB1bmRlZmluZWQgKSByZXR1cm47CgogICAgCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXTsKCiAgICAJCWZvciAoIGNvbnN0IHByb2dyYW1JZCBpbiBwcm9ncmFtTWFwICkgewoKICAgIAkJCWNvbnN0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFsgcHJvZ3JhbUlkIF07CgogICAgCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKICAgIAkJCQlkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCggc3RhdGVNYXBbIHdpcmVmcmFtZSBdLm9iamVjdCApOwoKICAgIAkJCQlkZWxldGUgc3RhdGVNYXBbIHdpcmVmcmFtZSBdOwoKICAgIAkJCX0KCiAgICAJCQlkZWxldGUgcHJvZ3JhbU1hcFsgcHJvZ3JhbUlkIF07CgogICAgCQl9CgogICAgCQlkZWxldGUgYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWxlYXNlU3RhdGVzT2ZQcm9ncmFtKCBwcm9ncmFtICkgewoKICAgIAkJZm9yICggY29uc3QgZ2VvbWV0cnlJZCBpbiBiaW5kaW5nU3RhdGVzICkgewoKICAgIAkJCWNvbnN0IHByb2dyYW1NYXAgPSBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeUlkIF07CgogICAgCQkJaWYgKCBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF0gPT09IHVuZGVmaW5lZCApIGNvbnRpbnVlOwoKICAgIAkJCWNvbnN0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdOwoKICAgIAkJCWZvciAoIGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCApIHsKCiAgICAJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCiAgICAJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCiAgICAJCQl9CgogICAgCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZXNldCgpIHsKCiAgICAJCXJlc2V0RGVmYXVsdFN0YXRlKCk7CiAgICAJCWZvcmNlVXBkYXRlID0gdHJ1ZTsKCiAgICAJCWlmICggY3VycmVudFN0YXRlID09PSBkZWZhdWx0U3RhdGUgKSByZXR1cm47CgogICAgCQljdXJyZW50U3RhdGUgPSBkZWZhdWx0U3RhdGU7CiAgICAJCWJpbmRWZXJ0ZXhBcnJheU9iamVjdCggY3VycmVudFN0YXRlLm9iamVjdCApOwoKICAgIAl9CgogICAgCS8vIGZvciBiYWNrd2FyZC1jb21wYXRpYmlsaXR5CgogICAgCWZ1bmN0aW9uIHJlc2V0RGVmYXVsdFN0YXRlKCkgewoKICAgIAkJZGVmYXVsdFN0YXRlLmdlb21ldHJ5ID0gbnVsbDsKICAgIAkJZGVmYXVsdFN0YXRlLnByb2dyYW0gPSBudWxsOwogICAgCQlkZWZhdWx0U3RhdGUud2lyZWZyYW1lID0gZmFsc2U7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCXNldHVwOiBzZXR1cCwKICAgIAkJcmVzZXQ6IHJlc2V0LAogICAgCQlyZXNldERlZmF1bHRTdGF0ZTogcmVzZXREZWZhdWx0U3RhdGUsCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UsCiAgICAJCXJlbGVhc2VTdGF0ZXNPZkdlb21ldHJ5OiByZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeSwKICAgIAkJcmVsZWFzZVN0YXRlc09mUHJvZ3JhbTogcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSwKCiAgICAJCWluaXRBdHRyaWJ1dGVzOiBpbml0QXR0cmlidXRlcywKICAgIAkJZW5hYmxlQXR0cmlidXRlOiBlbmFibGVBdHRyaWJ1dGUsCiAgICAJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzOiBkaXNhYmxlVW51c2VkQXR0cmlidXRlcwoKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTEJ1ZmZlclJlbmRlcmVyKCBnbCwgZXh0ZW5zaW9ucywgaW5mbyApIHsKCiAgICAJbGV0IG1vZGU7CgogICAgCWZ1bmN0aW9uIHNldE1vZGUoIHZhbHVlICkgewoKICAgIAkJbW9kZSA9IHZhbHVlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKICAgIAkJZ2wuZHJhd0FycmF5cyggbW9kZSwgc3RhcnQsIGNvdW50ICk7CgogICAgCQlpbmZvLnVwZGF0ZSggY291bnQsIG1vZGUsIDEgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXJJbnN0YW5jZXMoIHN0YXJ0LCBjb3VudCwgcHJpbWNvdW50ICkgewoKICAgIAkJaWYgKCBwcmltY291bnQgPT09IDAgKSByZXR1cm47CgogICAgCQlnbC5kcmF3QXJyYXlzSW5zdGFuY2VkKCBtb2RlLCBzdGFydCwgY291bnQsIHByaW1jb3VudCApOwoKICAgIAkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCBwcmltY291bnQgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXJNdWx0aURyYXcoIHN0YXJ0cywgY291bnRzLCBkcmF3Q291bnQgKSB7CgogICAgCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCiAgICAJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKICAgIAkJZXh0ZW5zaW9uLm11bHRpRHJhd0FycmF5c1dFQkdMKCBtb2RlLCBzdGFydHMsIDAsIGNvdW50cywgMCwgZHJhd0NvdW50ICk7CgogICAgCQlsZXQgZWxlbWVudENvdW50ID0gMDsKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKICAgIAkJCWVsZW1lbnRDb3VudCArPSBjb3VudHNbIGkgXTsKCiAgICAJCX0KCiAgICAJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMoIHN0YXJ0cywgY291bnRzLCBkcmF3Q291bnQsIHByaW1jb3VudCApIHsKCiAgICAJCWlmICggZHJhd0NvdW50ID09PSAwICkgcmV0dXJuOwoKICAgIAkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9tdWx0aV9kcmF3JyApOwoKICAgIAkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgc3RhcnRzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJcmVuZGVySW5zdGFuY2VzKCBzdGFydHNbIGkgXSwgY291bnRzWyBpIF0sIHByaW1jb3VudFsgaSBdICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlleHRlbnNpb24ubXVsdGlEcmF3QXJyYXlzSW5zdGFuY2VkV0VCR0woIG1vZGUsIHN0YXJ0cywgMCwgY291bnRzLCAwLCBwcmltY291bnQsIDAsIGRyYXdDb3VudCApOwoKICAgIAkJCWxldCBlbGVtZW50Q291bnQgPSAwOwogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKICAgIAkJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF0gKiBwcmltY291bnRbIGkgXTsKCiAgICAJCQl9CgogICAgCQkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vCgogICAgCXRoaXMuc2V0TW9kZSA9IHNldE1vZGU7CiAgICAJdGhpcy5yZW5kZXIgPSByZW5kZXI7CiAgICAJdGhpcy5yZW5kZXJJbnN0YW5jZXMgPSByZW5kZXJJbnN0YW5jZXM7CiAgICAJdGhpcy5yZW5kZXJNdWx0aURyYXcgPSByZW5kZXJNdWx0aURyYXc7CiAgICAJdGhpcy5yZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMgPSByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXM7CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMQ2FwYWJpbGl0aWVzKCBnbCwgZXh0ZW5zaW9ucywgcGFyYW1ldGVycywgdXRpbHMgKSB7CgogICAgCWxldCBtYXhBbmlzb3Ryb3B5OwoKICAgIAlmdW5jdGlvbiBnZXRNYXhBbmlzb3Ryb3B5KCkgewoKICAgIAkJaWYgKCBtYXhBbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSByZXR1cm4gbWF4QW5pc290cm9weTsKCiAgICAJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgPT09IHRydWUgKSB7CgogICAgCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgogICAgCQkJbWF4QW5pc290cm9weSA9IGdsLmdldFBhcmFtZXRlciggZXh0ZW5zaW9uLk1BWF9URVhUVVJFX01BWF9BTklTT1RST1BZX0VYVCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQltYXhBbmlzb3Ryb3B5ID0gMDsKCiAgICAJCX0KCiAgICAJCXJldHVybiBtYXhBbmlzb3Ryb3B5OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHRleHR1cmVGb3JtYXRSZWFkYWJsZSggdGV4dHVyZUZvcm1hdCApIHsKCiAgICAJCWlmICggdGV4dHVyZUZvcm1hdCAhPT0gUkdCQUZvcm1hdCAmJiB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICkgIT09IGdsLmdldFBhcmFtZXRlciggZ2wuSU1QTEVNRU5UQVRJT05fQ09MT1JfUkVBRF9GT1JNQVQgKSApIHsKCiAgICAJCQlyZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdHJ1ZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB0ZXh0dXJlVHlwZVJlYWRhYmxlKCB0ZXh0dXJlVHlwZSApIHsKCiAgICAJCWNvbnN0IGhhbGZGbG9hdFN1cHBvcnRlZEJ5RXh0ID0gKCB0ZXh0dXJlVHlwZSA9PT0gSGFsZkZsb2F0VHlwZSApICYmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICkgfHwgZXh0ZW5zaW9ucy5oYXMoICdFWFRfY29sb3JfYnVmZmVyX2Zsb2F0JyApICk7CgogICAgCQlpZiAoIHRleHR1cmVUeXBlICE9PSBVbnNpZ25lZEJ5dGVUeXBlICYmIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICkgIT09IGdsLmdldFBhcmFtZXRlciggZ2wuSU1QTEVNRU5UQVRJT05fQ09MT1JfUkVBRF9UWVBFICkgJiYgLy8gRWRnZSBhbmQgQ2hyb21lIE1hYyA8IDUyICgjOTUxMykKICAgIAkJCXRleHR1cmVUeXBlICE9PSBGbG9hdFR5cGUgJiYgISBoYWxmRmxvYXRTdXBwb3J0ZWRCeUV4dCApIHsKCiAgICAJCQlyZXR1cm4gZmFsc2U7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdHJ1ZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRNYXhQcmVjaXNpb24oIHByZWNpc2lvbiApIHsKCiAgICAJCWlmICggcHJlY2lzaW9uID09PSAnaGlnaHAnICkgewoKICAgIAkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5WRVJURVhfU0hBREVSLCBnbC5ISUdIX0ZMT0FUICkucHJlY2lzaW9uID4gMCAmJgogICAgCQkJCWdsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCggZ2wuRlJBR01FTlRfU0hBREVSLCBnbC5ISUdIX0ZMT0FUICkucHJlY2lzaW9uID4gMCApIHsKCiAgICAJCQkJcmV0dXJuICdoaWdocCc7CgogICAgCQkJfQoKICAgIAkJCXByZWNpc2lvbiA9ICdtZWRpdW1wJzsKCiAgICAJCX0KCiAgICAJCWlmICggcHJlY2lzaW9uID09PSAnbWVkaXVtcCcgKSB7CgogICAgCQkJaWYgKCBnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLlZFUlRFWF9TSEFERVIsIGdsLk1FRElVTV9GTE9BVCApLnByZWNpc2lvbiA+IDAgJiYKICAgIAkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuTUVESVVNX0ZMT0FUICkucHJlY2lzaW9uID4gMCApIHsKCiAgICAJCQkJcmV0dXJuICdtZWRpdW1wJzsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gJ2xvd3AnOwoKICAgIAl9CgogICAgCWxldCBwcmVjaXNpb24gPSBwYXJhbWV0ZXJzLnByZWNpc2lvbiAhPT0gdW5kZWZpbmVkID8gcGFyYW1ldGVycy5wcmVjaXNpb24gOiAnaGlnaHAnOwogICAgCWNvbnN0IG1heFByZWNpc2lvbiA9IGdldE1heFByZWNpc2lvbiggcHJlY2lzaW9uICk7CgogICAgCWlmICggbWF4UHJlY2lzaW9uICE9PSBwcmVjaXNpb24gKSB7CgogICAgCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOicsIHByZWNpc2lvbiwgJ25vdCBzdXBwb3J0ZWQsIHVzaW5nJywgbWF4UHJlY2lzaW9uLCAnaW5zdGVhZC4nICk7CiAgICAJCXByZWNpc2lvbiA9IG1heFByZWNpc2lvbjsKCiAgICAJfQoKICAgIAljb25zdCBsb2dhcml0aG1pY0RlcHRoQnVmZmVyID0gcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID09PSB0cnVlOwogICAgCWNvbnN0IHJldmVyc2VEZXB0aEJ1ZmZlciA9IHBhcmFtZXRlcnMucmV2ZXJzZURlcHRoQnVmZmVyID09PSB0cnVlICYmIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NsaXBfY29udHJvbCcgKTsKCiAgICAJY29uc3QgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9URVhUVVJFX0lNQUdFX1VOSVRTICk7CiAgICAJY29uc3QgbWF4VmVydGV4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwogICAgCWNvbnN0IG1heFRleHR1cmVTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVEVYVFVSRV9TSVpFICk7CiAgICAJY29uc3QgbWF4Q3ViZW1hcFNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9DVUJFX01BUF9URVhUVVJFX1NJWkUgKTsKCiAgICAJY29uc3QgbWF4QXR0cmlidXRlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9BVFRSSUJTICk7CiAgICAJY29uc3QgbWF4VmVydGV4VW5pZm9ybXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfVU5JRk9STV9WRUNUT1JTICk7CiAgICAJY29uc3QgbWF4VmFyeWluZ3MgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WQVJZSU5HX1ZFQ1RPUlMgKTsKICAgIAljb25zdCBtYXhGcmFnbWVudFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfRlJBR01FTlRfVU5JRk9STV9WRUNUT1JTICk7CgogICAgCWNvbnN0IHZlcnRleFRleHR1cmVzID0gbWF4VmVydGV4VGV4dHVyZXMgPiAwOwoKICAgIAljb25zdCBtYXhTYW1wbGVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfU0FNUExFUyApOwoKICAgIAlyZXR1cm4gewoKICAgIAkJaXNXZWJHTDI6IHRydWUsIC8vIGtlZXBpbmcgdGhpcyBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCiAgICAJCWdldE1heEFuaXNvdHJvcHk6IGdldE1heEFuaXNvdHJvcHksCiAgICAJCWdldE1heFByZWNpc2lvbjogZ2V0TWF4UHJlY2lzaW9uLAoKICAgIAkJdGV4dHVyZUZvcm1hdFJlYWRhYmxlOiB0ZXh0dXJlRm9ybWF0UmVhZGFibGUsCiAgICAJCXRleHR1cmVUeXBlUmVhZGFibGU6IHRleHR1cmVUeXBlUmVhZGFibGUsCgogICAgCQlwcmVjaXNpb246IHByZWNpc2lvbiwKICAgIAkJbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjogbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciwKICAgIAkJcmV2ZXJzZURlcHRoQnVmZmVyOiByZXZlcnNlRGVwdGhCdWZmZXIsCgogICAgCQltYXhUZXh0dXJlczogbWF4VGV4dHVyZXMsCiAgICAJCW1heFZlcnRleFRleHR1cmVzOiBtYXhWZXJ0ZXhUZXh0dXJlcywKICAgIAkJbWF4VGV4dHVyZVNpemU6IG1heFRleHR1cmVTaXplLAogICAgCQltYXhDdWJlbWFwU2l6ZTogbWF4Q3ViZW1hcFNpemUsCgogICAgCQltYXhBdHRyaWJ1dGVzOiBtYXhBdHRyaWJ1dGVzLAogICAgCQltYXhWZXJ0ZXhVbmlmb3JtczogbWF4VmVydGV4VW5pZm9ybXMsCiAgICAJCW1heFZhcnlpbmdzOiBtYXhWYXJ5aW5ncywKICAgIAkJbWF4RnJhZ21lbnRVbmlmb3JtczogbWF4RnJhZ21lbnRVbmlmb3JtcywKCiAgICAJCXZlcnRleFRleHR1cmVzOiB2ZXJ0ZXhUZXh0dXJlcywKCiAgICAJCW1heFNhbXBsZXM6IG1heFNhbXBsZXMKCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xDbGlwcGluZyggcHJvcGVydGllcyApIHsKCiAgICAJY29uc3Qgc2NvcGUgPSB0aGlzOwoKICAgIAlsZXQgZ2xvYmFsU3RhdGUgPSBudWxsLAogICAgCQludW1HbG9iYWxQbGFuZXMgPSAwLAogICAgCQlsb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlLAogICAgCQlyZW5kZXJpbmdTaGFkb3dzID0gZmFsc2U7CgogICAgCWNvbnN0IHBsYW5lID0gbmV3IFBsYW5lKCksCiAgICAJCXZpZXdOb3JtYWxNYXRyaXggPSBuZXcgTWF0cml4MygpLAoKICAgIAkJdW5pZm9ybSA9IHsgdmFsdWU6IG51bGwsIG5lZWRzVXBkYXRlOiBmYWxzZSB9OwoKICAgIAl0aGlzLnVuaWZvcm0gPSB1bmlmb3JtOwogICAgCXRoaXMubnVtUGxhbmVzID0gMDsKICAgIAl0aGlzLm51bUludGVyc2VjdGlvbiA9IDA7CgogICAgCXRoaXMuaW5pdCA9IGZ1bmN0aW9uICggcGxhbmVzLCBlbmFibGVMb2NhbENsaXBwaW5nICkgewoKICAgIAkJY29uc3QgZW5hYmxlZCA9CiAgICAJCQlwbGFuZXMubGVuZ3RoICE9PSAwIHx8CiAgICAJCQllbmFibGVMb2NhbENsaXBwaW5nIHx8CiAgICAJCQkvLyBlbmFibGUgc3RhdGUgb2YgcHJldmlvdXMgZnJhbWUgLSB0aGUgY2xpcHBpbmcgY29kZSBoYXMgdG8KICAgIAkJCS8vIHJ1biBhbm90aGVyIGZyYW1lIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBzdGF0ZToKICAgIAkJCW51bUdsb2JhbFBsYW5lcyAhPT0gMCB8fAogICAgCQkJbG9jYWxDbGlwcGluZ0VuYWJsZWQ7CgogICAgCQlsb2NhbENsaXBwaW5nRW5hYmxlZCA9IGVuYWJsZUxvY2FsQ2xpcHBpbmc7CgogICAgCQludW1HbG9iYWxQbGFuZXMgPSBwbGFuZXMubGVuZ3RoOwoKICAgIAkJcmV0dXJuIGVuYWJsZWQ7CgogICAgCX07CgogICAgCXRoaXMuYmVnaW5TaGFkb3dzID0gZnVuY3Rpb24gKCkgewoKICAgIAkJcmVuZGVyaW5nU2hhZG93cyA9IHRydWU7CiAgICAJCXByb2plY3RQbGFuZXMoIG51bGwgKTsKCiAgICAJfTsKCiAgICAJdGhpcy5lbmRTaGFkb3dzID0gZnVuY3Rpb24gKCkgewoKICAgIAkJcmVuZGVyaW5nU2hhZG93cyA9IGZhbHNlOwoKICAgIAl9OwoKICAgIAl0aGlzLnNldEdsb2JhbFN0YXRlID0gZnVuY3Rpb24gKCBwbGFuZXMsIGNhbWVyYSApIHsKCiAgICAJCWdsb2JhbFN0YXRlID0gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIDAgKTsKCiAgICAJfTsKCiAgICAJdGhpcy5zZXRTdGF0ZSA9IGZ1bmN0aW9uICggbWF0ZXJpYWwsIGNhbWVyYSwgdXNlQ2FjaGUgKSB7CgogICAgCQljb25zdCBwbGFuZXMgPSBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcywKICAgIAkJCWNsaXBJbnRlcnNlY3Rpb24gPSBtYXRlcmlhbC5jbGlwSW50ZXJzZWN0aW9uLAogICAgCQkJY2xpcFNoYWRvd3MgPSBtYXRlcmlhbC5jbGlwU2hhZG93czsKCiAgICAJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKICAgIAkJaWYgKCAhIGxvY2FsQ2xpcHBpbmdFbmFibGVkIHx8IHBsYW5lcyA9PT0gbnVsbCB8fCBwbGFuZXMubGVuZ3RoID09PSAwIHx8IHJlbmRlcmluZ1NoYWRvd3MgJiYgISBjbGlwU2hhZG93cyApIHsKCiAgICAJCQkvLyB0aGVyZSdzIG5vIGxvY2FsIGNsaXBwaW5nCgogICAgCQkJaWYgKCByZW5kZXJpbmdTaGFkb3dzICkgewoKICAgIAkJCQkvLyB0aGVyZSdzIG5vIGdsb2JhbCBjbGlwcGluZwoKICAgIAkJCQlwcm9qZWN0UGxhbmVzKCBudWxsICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmVzZXRHbG9iYWxTdGF0ZSgpOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc3Qgbkdsb2JhbCA9IHJlbmRlcmluZ1NoYWRvd3MgPyAwIDogbnVtR2xvYmFsUGxhbmVzLAogICAgCQkJCWxHbG9iYWwgPSBuR2xvYmFsICogNDsKCiAgICAJCQlsZXQgZHN0QXJyYXkgPSBtYXRlcmlhbFByb3BlcnRpZXMuY2xpcHBpbmdTdGF0ZSB8fCBudWxsOwoKICAgIAkJCXVuaWZvcm0udmFsdWUgPSBkc3RBcnJheTsgLy8gZW5zdXJlIHVuaXF1ZSBzdGF0ZQoKICAgIAkJCWRzdEFycmF5ID0gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIGxHbG9iYWwsIHVzZUNhY2hlICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBsR2xvYmFsOyArKyBpICkgewoKICAgIAkJCQlkc3RBcnJheVsgaSBdID0gZ2xvYmFsU3RhdGVbIGkgXTsKCiAgICAJCQl9CgogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmNsaXBwaW5nU3RhdGUgPSBkc3RBcnJheTsKICAgIAkJCXRoaXMubnVtSW50ZXJzZWN0aW9uID0gY2xpcEludGVyc2VjdGlvbiA/IHRoaXMubnVtUGxhbmVzIDogMDsKICAgIAkJCXRoaXMubnVtUGxhbmVzICs9IG5HbG9iYWw7CgogICAgCQl9CgoKICAgIAl9OwoKICAgIAlmdW5jdGlvbiByZXNldEdsb2JhbFN0YXRlKCkgewoKICAgIAkJaWYgKCB1bmlmb3JtLnZhbHVlICE9PSBnbG9iYWxTdGF0ZSApIHsKCiAgICAJCQl1bmlmb3JtLnZhbHVlID0gZ2xvYmFsU3RhdGU7CiAgICAJCQl1bmlmb3JtLm5lZWRzVXBkYXRlID0gbnVtR2xvYmFsUGxhbmVzID4gMDsKCiAgICAJCX0KCiAgICAJCXNjb3BlLm51bVBsYW5lcyA9IG51bUdsb2JhbFBsYW5lczsKICAgIAkJc2NvcGUubnVtSW50ZXJzZWN0aW9uID0gMDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBwcm9qZWN0UGxhbmVzKCBwbGFuZXMsIGNhbWVyYSwgZHN0T2Zmc2V0LCBza2lwVHJhbnNmb3JtICkgewoKICAgIAkJY29uc3QgblBsYW5lcyA9IHBsYW5lcyAhPT0gbnVsbCA/IHBsYW5lcy5sZW5ndGggOiAwOwogICAgCQlsZXQgZHN0QXJyYXkgPSBudWxsOwoKICAgIAkJaWYgKCBuUGxhbmVzICE9PSAwICkgewoKICAgIAkJCWRzdEFycmF5ID0gdW5pZm9ybS52YWx1ZTsKCiAgICAJCQlpZiAoIHNraXBUcmFuc2Zvcm0gIT09IHRydWUgfHwgZHN0QXJyYXkgPT09IG51bGwgKSB7CgogICAgCQkJCWNvbnN0IGZsYXRTaXplID0gZHN0T2Zmc2V0ICsgblBsYW5lcyAqIDQsCiAgICAJCQkJCXZpZXdNYXRyaXggPSBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlOwoKICAgIAkJCQl2aWV3Tm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggdmlld01hdHJpeCApOwoKICAgIAkJCQlpZiAoIGRzdEFycmF5ID09PSBudWxsIHx8IGRzdEFycmF5Lmxlbmd0aCA8IGZsYXRTaXplICkgewoKICAgIAkJCQkJZHN0QXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCBmbGF0U2l6ZSApOwoKICAgIAkJCQl9CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgaTQgPSBkc3RPZmZzZXQ7IGkgIT09IG5QbGFuZXM7ICsrIGksIGk0ICs9IDQgKSB7CgogICAgCQkJCQlwbGFuZS5jb3B5KCBwbGFuZXNbIGkgXSApLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCwgdmlld05vcm1hbE1hdHJpeCApOwoKICAgIAkJCQkJcGxhbmUubm9ybWFsLnRvQXJyYXkoIGRzdEFycmF5LCBpNCApOwogICAgCQkJCQlkc3RBcnJheVsgaTQgKyAzIF0gPSBwbGFuZS5jb25zdGFudDsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQl1bmlmb3JtLnZhbHVlID0gZHN0QXJyYXk7CiAgICAJCQl1bmlmb3JtLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCXNjb3BlLm51bVBsYW5lcyA9IG5QbGFuZXM7CiAgICAJCXNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CgogICAgCQlyZXR1cm4gZHN0QXJyYXk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xDdWJlTWFwcyggcmVuZGVyZXIgKSB7CgogICAgCWxldCBjdWJlbWFwcyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCWZ1bmN0aW9uIG1hcFRleHR1cmVNYXBwaW5nKCB0ZXh0dXJlLCBtYXBwaW5nICkgewoKICAgIAkJaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyApIHsKCiAgICAJCQl0ZXh0dXJlLm1hcHBpbmcgPSBDdWJlUmVmbGVjdGlvbk1hcHBpbmc7CgogICAgCQl9IGVsc2UgaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyApIHsKCiAgICAJCQl0ZXh0dXJlLm1hcHBpbmcgPSBDdWJlUmVmcmFjdGlvbk1hcHBpbmc7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGV4dHVyZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXQoIHRleHR1cmUgKSB7CgogICAgCQlpZiAoIHRleHR1cmUgJiYgdGV4dHVyZS5pc1RleHR1cmUgKSB7CgogICAgCQkJY29uc3QgbWFwcGluZyA9IHRleHR1cmUubWFwcGluZzsKCiAgICAJCQlpZiAoIG1hcHBpbmcgPT09IEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nICkgewoKICAgIAkJCQlpZiAoIGN1YmVtYXBzLmhhcyggdGV4dHVyZSApICkgewoKICAgIAkJCQkJY29uc3QgY3ViZW1hcCA9IGN1YmVtYXBzLmdldCggdGV4dHVyZSApLnRleHR1cmU7CiAgICAJCQkJCXJldHVybiBtYXBUZXh0dXJlTWFwcGluZyggY3ViZW1hcCwgdGV4dHVyZS5tYXBwaW5nICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQljb25zdCBpbWFnZSA9IHRleHR1cmUuaW1hZ2U7CgogICAgCQkJCQlpZiAoIGltYWdlICYmIGltYWdlLmhlaWdodCA+IDAgKSB7CgogICAgCQkJCQkJY29uc3QgcmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMQ3ViZVJlbmRlclRhcmdldCggaW1hZ2UuaGVpZ2h0ICk7CiAgICAJCQkJCQlyZW5kZXJUYXJnZXQuZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUoIHJlbmRlcmVyLCB0ZXh0dXJlICk7CiAgICAJCQkJCQljdWJlbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKICAgIAkJCQkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgogICAgCQkJCQkJcmV0dXJuIG1hcFRleHR1cmVNYXBwaW5nKCByZW5kZXJUYXJnZXQudGV4dHVyZSwgdGV4dHVyZS5tYXBwaW5nICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCS8vIGltYWdlIG5vdCB5ZXQgcmVhZHkuIHRyeSB0aGUgY29udmVyc2lvbiBuZXh0IGZyYW1lCgogICAgCQkJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGV4dHVyZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmUgPSBldmVudC50YXJnZXQ7CgogICAgCQl0ZXh0dXJlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKICAgIAkJY29uc3QgY3ViZW1hcCA9IGN1YmVtYXBzLmdldCggdGV4dHVyZSApOwoKICAgIAkJaWYgKCBjdWJlbWFwICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY3ViZW1hcHMuZGVsZXRlKCB0ZXh0dXJlICk7CiAgICAJCQljdWJlbWFwLmRpc3Bvc2UoKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJY3ViZW1hcHMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAl9CgogICAgCXJldHVybiB7CiAgICAJCWdldDogZ2V0LAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCiAgICAJfTsKCiAgICB9CgogICAgY29uc3QgTE9EX01JTiA9IDQ7CgogICAgLy8gVGhlIHN0YW5kYXJkIGRldmlhdGlvbnMgKHJhZGlhbnMpIGFzc29jaWF0ZWQgd2l0aCB0aGUgZXh0cmEgbWlwcy4gVGhlc2UgYXJlCiAgICAvLyBjaG9zZW4gdG8gYXBwcm94aW1hdGUgYSBUcm93YnJpZGdlLVJlaXR6IGRpc3RyaWJ1dGlvbiBmdW5jdGlvbiB0aW1lcyB0aGUKICAgIC8vIGdlb21ldHJpYyBzaGFkb3dpbmcgZnVuY3Rpb24uIFRoZXNlIHNpZ21hIHZhbHVlcyBzcXVhcmVkIG11c3QgbWF0Y2ggdGhlCiAgICAvLyB2YXJpYW5jZSAjZGVmaW5lcyBpbiBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQuZ2xzbC5qcy4KICAgIGNvbnN0IEVYVFJBX0xPRF9TSUdNQSA9IFsgMC4xMjUsIDAuMjE1LCAwLjM1LCAwLjQ0NiwgMC41MjYsIDAuNTgyIF07CgogICAgLy8gVGhlIG1heGltdW0gbGVuZ3RoIG9mIHRoZSBibHVyIGZvciBsb29wLiBTbWFsbGVyIHNpZ21hcyB3aWxsIHVzZSBmZXdlcgogICAgLy8gc2FtcGxlcyBhbmQgZXhpdCBlYXJseSwgYnV0IG5vdCByZWNvbXBpbGUgdGhlIHNoYWRlci4KICAgIGNvbnN0IE1BWF9TQU1QTEVTID0gMjA7CgogICAgY29uc3QgX2ZsYXRDYW1lcmEgPSAvKkBfX1BVUkVfXyovIG5ldyBPcnRob2dyYXBoaWNDYW1lcmEoKTsKICAgIGNvbnN0IF9jbGVhckNvbG9yID0gLypAX19QVVJFX18qLyBuZXcgQ29sb3IoKTsKICAgIGxldCBfb2xkVGFyZ2V0ID0gbnVsbDsKICAgIGxldCBfb2xkQWN0aXZlQ3ViZUZhY2UgPSAwOwogICAgbGV0IF9vbGRBY3RpdmVNaXBtYXBMZXZlbCA9IDA7CiAgICBsZXQgX29sZFhyRW5hYmxlZCA9IGZhbHNlOwoKICAgIC8vIEdvbGRlbiBSYXRpbwogICAgY29uc3QgUEhJID0gKCAxICsgTWF0aC5zcXJ0KCA1ICkgKSAvIDI7CiAgICBjb25zdCBJTlZfUEhJID0gMSAvIFBISTsKCiAgICAvLyBWZXJ0aWNlcyBvZiBhIGRvZGVjYWhlZHJvbiAoZXhjZXB0IHRoZSBvcHBvc2l0ZXMsIHdoaWNoIHJlcHJlc2VudCB0aGUKICAgIC8vIHNhbWUgYXhpcyksIHVzZWQgYXMgYXhpcyBkaXJlY3Rpb25zIGV2ZW5seSBzcHJlYWQgb24gYSBzcGhlcmUuCiAgICBjb25zdCBfYXhpc0RpcmVjdGlvbnMgPSBbCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSBQSEksIElOVl9QSEksIDAgKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCBQSEksIElOVl9QSEksIDAgKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAtIElOVl9QSEksIDAsIFBISSApLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIElOVl9QSEksIDAsIFBISSApLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIFBISSwgLSBJTlZfUEhJICksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgUEhJLCBJTlZfUEhJICksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLTEsIDEsIC0xICksCiAgICAJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMSwgLTEgKSwKICAgIAkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAtMSwgMSwgMSApLAogICAgCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIDEgKSBdOwoKICAgIGNvbnN0IF9vcmlnaW4gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgogICAgLyoqCiAgICAgKiBUaGlzIGNsYXNzIGdlbmVyYXRlcyBhIFByZWZpbHRlcmVkLCBNaXBtYXBwZWQgUmFkaWFuY2UgRW52aXJvbm1lbnQgTWFwCiAgICAgKiAoUE1SRU0pIGZyb20gYSBjdWJlTWFwIGVudmlyb25tZW50IHRleHR1cmUuIFRoaXMgYWxsb3dzIGRpZmZlcmVudCBsZXZlbHMgb2YKICAgICAqIGJsdXIgdG8gYmUgcXVpY2tseSBhY2Nlc3NlZCBiYXNlZCBvbiBtYXRlcmlhbCByb3VnaG5lc3MuIEl0IGlzIHBhY2tlZCBpbnRvIGEKICAgICAqIHNwZWNpYWwgQ3ViZVVWIGZvcm1hdCB0aGF0IGFsbG93cyB1cyB0byBwZXJmb3JtIGN1c3RvbSBpbnRlcnBvbGF0aW9uIHNvIHRoYXQKICAgICAqIHdlIGNhbiBzdXBwb3J0IG5vbmxpbmVhciBmb3JtYXRzIHN1Y2ggYXMgUkdCRS4gVW5saWtlIGEgdHJhZGl0aW9uYWwgbWlwbWFwCiAgICAgKiBjaGFpbiwgaXQgb25seSBnb2VzIGRvd24gdG8gdGhlIExPRF9NSU4gbGV2ZWwgKGFib3ZlKSwgYW5kIHRoZW4gY3JlYXRlcyBleHRyYQogICAgICogZXZlbiBtb3JlIGZpbHRlcmVkICdtaXBzJyBhdCB0aGUgc2FtZSBMT0RfTUlOIHJlc29sdXRpb24sIGFzc29jaWF0ZWQgd2l0aAogICAgICogaGlnaGVyIHJvdWdobmVzcyBsZXZlbHMuIEluIHRoaXMgd2F5IHdlIG1haW50YWluIHJlc29sdXRpb24gdG8gc21vb3RobHkKICAgICAqIGludGVycG9sYXRlIGRpZmZ1c2UgbGlnaHRpbmcgd2hpbGUgbGltaXRpbmcgc2FtcGxpbmcgY29tcHV0YXRpb24uCiAgICAgKgogICAgICogUGFwZXI6IEZhc3QsIEFjY3VyYXRlIEltYWdlLUJhc2VkIExpZ2h0aW5nOgogICAgICoge0BsaW5rIGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS9maWxlL2QvMTV5OHJfVXBLbFU5U3ZWNElMYjBDM3FDUGVjUzhwdkx6L3ZpZXd9CiAgICAqLwogICAgY2xhc3MgUE1SRU1HZW5lcmF0b3IgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IFBNUkVNIGdlbmVyYXRvci4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICovCiAgICAJY29uc3RydWN0b3IoIHJlbmRlcmVyICkgewoKICAgIAkJdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjsKICAgIAkJdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSBudWxsOwoKICAgIAkJdGhpcy5fbG9kTWF4ID0gMDsKICAgIAkJdGhpcy5fY3ViZVNpemUgPSAwOwogICAgCQl0aGlzLl9sb2RQbGFuZXMgPSBbXTsKICAgIAkJdGhpcy5fc2l6ZUxvZHMgPSBbXTsKICAgIAkJdGhpcy5fc2lnbWFzID0gW107CgogICAgCQl0aGlzLl9ibHVyTWF0ZXJpYWwgPSBudWxsOwogICAgCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPSBudWxsOwogICAgCQl0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAJCXRoaXMuX2NvbXBpbGVNYXRlcmlhbCggdGhpcy5fYmx1ck1hdGVyaWFsICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhIHN1cHBsaWVkIFNjZW5lLCB3aGljaCBjYW4gYmUgZmFzdGVyIHRoYW4gdXNpbmcgYW4KICAgIAkgKiBpbWFnZSBpZiBuZXR3b3JraW5nIGJhbmR3aWR0aCBpcyBsb3cuIE9wdGlvbmFsIHNpZ21hIHNwZWNpZmllcyBhIGJsdXIgcmFkaXVzCiAgICAJICogaW4gcmFkaWFucyB0byBiZSBhcHBsaWVkIHRvIHRoZSBzY2VuZSBiZWZvcmUgUE1SRU0gZ2VuZXJhdGlvbi4gT3B0aW9uYWwgbmVhcgogICAgCSAqIGFuZCBmYXIgcGxhbmVzIGVuc3VyZSB0aGUgc2NlbmUgaXMgcmVuZGVyZWQgaW4gaXRzIGVudGlyZXR5LgogICAgCSAqCiAgICAJICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgLSBUaGUgc2NlbmUgdG8gYmUgY2FwdHVyZWQuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtzaWdtYT0wXSAtIFRoZSBibHVyIHJhZGl1cyBpbiByYWRpYW5zLgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBbbmVhcj0wLjFdIC0gVGhlIG5lYXIgcGxhbmUgZGlzdGFuY2UuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtmYXI9MTAwXSAtIFRoZSBmYXIgcGxhbmUgZGlzdGFuY2UuCiAgICAJICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zPXt9XSAtIFRoZSBjb25maWd1cmF0aW9uIG9wdGlvbnMuCiAgICAJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLnNpemU9MjU2XSAtIFRoZSB0ZXh0dXJlIHNpemUgb2YgdGhlIFBNUkVNLgogICAgCSAqIEBwYXJhbSB7VmVjdG9yM30gW29wdGlvbnMucmVuZGVyVGFyZ2V0PW9yaWdpbl0gLSBUaGUgcG9zaXRpb24gb2YgdGhlIGludGVybmFsIGN1YmUgY2FtZXJhIHRoYXQgcmVuZGVycyB0aGUgc2NlbmUuCiAgICAJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCiAgICAJICovCiAgICAJZnJvbVNjZW5lKCBzY2VuZSwgc2lnbWEgPSAwLCBuZWFyID0gMC4xLCBmYXIgPSAxMDAsIG9wdGlvbnMgPSB7fSApIHsKCiAgICAJCWNvbnN0IHsKICAgIAkJCXNpemUgPSAyNTYsCiAgICAJCQlwb3NpdGlvbiA9IF9vcmlnaW4sCiAgICAJCX0gPSBvcHRpb25zOwoKICAgIAkJX29sZFRhcmdldCA9IHRoaXMuX3JlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwogICAgCQlfb2xkQWN0aXZlQ3ViZUZhY2UgPSB0aGlzLl9yZW5kZXJlci5nZXRBY3RpdmVDdWJlRmFjZSgpOwogICAgCQlfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgPSB0aGlzLl9yZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwogICAgCQlfb2xkWHJFbmFibGVkID0gdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZDsKCiAgICAJCXRoaXMuX3JlbmRlcmVyLnhyLmVuYWJsZWQgPSBmYWxzZTsKCiAgICAJCXRoaXMuX3NldFNpemUoIHNpemUgKTsKCiAgICAJCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IHRoaXMuX2FsbG9jYXRlVGFyZ2V0cygpOwogICAgCQljdWJlVVZSZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgPSB0cnVlOwoKICAgIAkJdGhpcy5fc2NlbmVUb0N1YmVVViggc2NlbmUsIG5lYXIsIGZhciwgY3ViZVVWUmVuZGVyVGFyZ2V0LCBwb3NpdGlvbiApOwoKICAgIAkJaWYgKCBzaWdtYSA+IDAgKSB7CgogICAgCQkJdGhpcy5fYmx1ciggY3ViZVVWUmVuZGVyVGFyZ2V0LCAwLCAwLCBzaWdtYSApOwoKICAgIAkJfQoKICAgIAkJdGhpcy5fYXBwbHlQTVJFTSggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CiAgICAJCXRoaXMuX2NsZWFudXAoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKICAgIAkJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBHZW5lcmF0ZXMgYSBQTVJFTSBmcm9tIGFuIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlLCB3aGljaCBjYW4gYmUgZWl0aGVyIExEUgogICAgCSAqIG9yIEhEUi4gVGhlIGlkZWFsIGlucHV0IGltYWdlIHNpemUgaXMgMWsgKDEwMjQgeCA1MTIpLAogICAgCSAqIGFzIHRoaXMgbWF0Y2hlcyBiZXN0IHdpdGggdGhlIDI1NiB4IDI1NiBjdWJlbWFwIG91dHB1dC4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7VGV4dHVyZX0gZXF1aXJlY3Rhbmd1bGFyIC0gVGhlIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlIHRvIGJlIGNvbnZlcnRlZC4KICAgIAkgKiBAcGFyYW0gez9XZWJHTFJlbmRlclRhcmdldH0gW3JlbmRlclRhcmdldD1udWxsXSAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHVzZS4KICAgIAkgKiBAcmV0dXJuIHtXZWJHTFJlbmRlclRhcmdldH0gVGhlIHJlc3VsdGluZyBQTVJFTS4KICAgIAkgKi8KICAgIAlmcm9tRXF1aXJlY3Rhbmd1bGFyKCBlcXVpcmVjdGFuZ3VsYXIsIHJlbmRlclRhcmdldCA9IG51bGwgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fZnJvbVRleHR1cmUoIGVxdWlyZWN0YW5ndWxhciwgcmVuZGVyVGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhbiBjdWJlbWFwIHRleHR1cmUsIHdoaWNoIGNhbiBiZSBlaXRoZXIgTERSCiAgICAJICogb3IgSERSLiBUaGUgaWRlYWwgaW5wdXQgY3ViZSBzaXplIGlzIDI1NiB4IDI1NiwKICAgIAkgKiBhcyB0aGlzIG1hdGNoZXMgYmVzdCB3aXRoIHRoZSAyNTYgeCAyNTYgY3ViZW1hcCBvdXRwdXQuCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1RleHR1cmV9IGN1YmVtYXAgLSBUaGUgY3ViZW1hcCB0ZXh0dXJlIHRvIGJlIGNvbnZlcnRlZC4KICAgIAkgKiBAcGFyYW0gez9XZWJHTFJlbmRlclRhcmdldH0gW3JlbmRlclRhcmdldD1udWxsXSAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHVzZS4KICAgIAkgKiBAcmV0dXJuIHtXZWJHTFJlbmRlclRhcmdldH0gVGhlIHJlc3VsdGluZyBQTVJFTS4KICAgIAkgKi8KICAgIAlmcm9tQ3ViZW1hcCggY3ViZW1hcCwgcmVuZGVyVGFyZ2V0ID0gbnVsbCApIHsKCiAgICAJCXJldHVybiB0aGlzLl9mcm9tVGV4dHVyZSggY3ViZW1hcCwgcmVuZGVyVGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJlLWNvbXBpbGVzIHRoZSBjdWJlbWFwIHNoYWRlci4gWW91IGNhbiBnZXQgZmFzdGVyIHN0YXJ0LXVwIGJ5IGludm9raW5nIHRoaXMgbWV0aG9kIGR1cmluZwogICAgCSAqIHlvdXIgdGV4dHVyZSdzIG5ldHdvcmsgZmV0Y2ggZm9yIGluY3JlYXNlZCBjb25jdXJyZW5jeS4KICAgIAkgKi8KICAgIAljb21waWxlQ3ViZW1hcFNoYWRlcigpIHsKCiAgICAJCWlmICggdGhpcy5fY3ViZW1hcE1hdGVyaWFsID09PSBudWxsICkgewoKICAgIAkJCXRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9IF9nZXRDdWJlbWFwTWF0ZXJpYWwoKTsKICAgIAkJCXRoaXMuX2NvbXBpbGVNYXRlcmlhbCggdGhpcy5fY3ViZW1hcE1hdGVyaWFsICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogUHJlLWNvbXBpbGVzIHRoZSBlcXVpcmVjdGFuZ3VsYXIgc2hhZGVyLiBZb3UgY2FuIGdldCBmYXN0ZXIgc3RhcnQtdXAgYnkgaW52b2tpbmcgdGhpcyBtZXRob2QgZHVyaW5nCiAgICAJICogeW91ciB0ZXh0dXJlJ3MgbmV0d29yayBmZXRjaCBmb3IgaW5jcmVhc2VkIGNvbmN1cnJlbmN5LgogICAgCSAqLwogICAgCWNvbXBpbGVFcXVpcmVjdGFuZ3VsYXJTaGFkZXIoKSB7CgogICAgCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPT09IG51bGwgKSB7CgogICAgCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IF9nZXRFcXVpcmVjdE1hdGVyaWFsKCk7CiAgICAJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvKioKICAgIAkgKiBEaXNwb3NlcyBvZiB0aGUgUE1SRU1HZW5lcmF0b3IncyBpbnRlcm5hbCBtZW1vcnkuIE5vdGUgdGhhdCBQTVJFTUdlbmVyYXRvciBpcyBhIHN0YXRpYyBjbGFzcywKICAgIAkgKiBzbyB5b3Ugc2hvdWxkIG5vdCBuZWVkIG1vcmUgdGhhbiBvbmUgUE1SRU1HZW5lcmF0b3Igb2JqZWN0LiBJZiB5b3UgZG8sIGNhbGxpbmcgZGlzcG9zZSgpIG9uCiAgICAJICogb25lIG9mIHRoZW0gd2lsbCBjYXVzZSBhbnkgb3RoZXJzIHRvIGFsc28gYmVjb21lIHVudXNhYmxlLgogICAgCSAqLwogICAgCWRpc3Bvc2UoKSB7CgogICAgCQl0aGlzLl9kaXNwb3NlKCk7CgogICAgCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMuX2N1YmVtYXBNYXRlcmlhbC5kaXNwb3NlKCk7CiAgICAJCWlmICggdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwuZGlzcG9zZSgpOwoKICAgIAl9CgogICAgCS8vIHByaXZhdGUgaW50ZXJmYWNlCgogICAgCV9zZXRTaXplKCBjdWJlU2l6ZSApIHsKCiAgICAJCXRoaXMuX2xvZE1heCA9IE1hdGguZmxvb3IoIE1hdGgubG9nMiggY3ViZVNpemUgKSApOwogICAgCQl0aGlzLl9jdWJlU2l6ZSA9IE1hdGgucG93KCAyLCB0aGlzLl9sb2RNYXggKTsKCiAgICAJfQoKICAgIAlfZGlzcG9zZSgpIHsKCiAgICAJCWlmICggdGhpcy5fYmx1ck1hdGVyaWFsICE9PSBudWxsICkgdGhpcy5fYmx1ck1hdGVyaWFsLmRpc3Bvc2UoKTsKCiAgICAJCWlmICggdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgIT09IG51bGwgKSB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldC5kaXNwb3NlKCk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLl9sb2RQbGFuZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCXRoaXMuX2xvZFBsYW5lc1sgaSBdLmRpc3Bvc2UoKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlfY2xlYW51cCggb3V0cHV0VGFyZ2V0ICkgewoKICAgIAkJdGhpcy5fcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBfb2xkVGFyZ2V0LCBfb2xkQWN0aXZlQ3ViZUZhY2UsIF9vbGRBY3RpdmVNaXBtYXBMZXZlbCApOwogICAgCQl0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkID0gX29sZFhyRW5hYmxlZDsKCiAgICAJCW91dHB1dFRhcmdldC5zY2lzc29yVGVzdCA9IGZhbHNlOwogICAgCQlfc2V0Vmlld3BvcnQoIG91dHB1dFRhcmdldCwgMCwgMCwgb3V0cHV0VGFyZ2V0LndpZHRoLCBvdXRwdXRUYXJnZXQuaGVpZ2h0ICk7CgogICAgCX0KCiAgICAJX2Zyb21UZXh0dXJlKCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQlpZiAoIHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nICkgewoKICAgIAkJCXRoaXMuX3NldFNpemUoIHRleHR1cmUuaW1hZ2UubGVuZ3RoID09PSAwID8gMTYgOiAoIHRleHR1cmUuaW1hZ2VbIDAgXS53aWR0aCB8fCB0ZXh0dXJlLmltYWdlWyAwIF0uaW1hZ2Uud2lkdGggKSApOwoKICAgIAkJfSBlbHNlIHsgLy8gRXF1aXJlY3Rhbmd1bGFyCgogICAgCQkJdGhpcy5fc2V0U2l6ZSggdGV4dHVyZS5pbWFnZS53aWR0aCAvIDQgKTsKCiAgICAJCX0KCiAgICAJCV9vbGRUYXJnZXQgPSB0aGlzLl9yZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKICAgIAkJX29sZEFjdGl2ZUN1YmVGYWNlID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKICAgIAkJX29sZEFjdGl2ZU1pcG1hcExldmVsID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKICAgIAkJX29sZFhyRW5hYmxlZCA9IHRoaXMuX3JlbmRlcmVyLnhyLmVuYWJsZWQ7CgogICAgCQl0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkID0gZmFsc2U7CgogICAgCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQgfHwgdGhpcy5fYWxsb2NhdGVUYXJnZXRzKCk7CiAgICAJCXRoaXMuX3RleHR1cmVUb0N1YmVVViggdGV4dHVyZSwgY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CiAgICAJCXRoaXMuX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApOwogICAgCQl0aGlzLl9jbGVhbnVwKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCiAgICAJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgogICAgCX0KCiAgICAJX2FsbG9jYXRlVGFyZ2V0cygpIHsKCiAgICAJCWNvbnN0IHdpZHRoID0gMyAqIE1hdGgubWF4KCB0aGlzLl9jdWJlU2l6ZSwgMTYgKiA3ICk7CiAgICAJCWNvbnN0IGhlaWdodCA9IDQgKiB0aGlzLl9jdWJlU2l6ZTsKCiAgICAJCWNvbnN0IHBhcmFtcyA9IHsKICAgIAkJCW1hZ0ZpbHRlcjogTGluZWFyRmlsdGVyLAogICAgCQkJbWluRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCiAgICAJCQlnZW5lcmF0ZU1pcG1hcHM6IGZhbHNlLAogICAgCQkJdHlwZTogSGFsZkZsb2F0VHlwZSwKICAgIAkJCWZvcm1hdDogUkdCQUZvcm1hdCwKICAgIAkJCWNvbG9yU3BhY2U6IExpbmVhclNSR0JDb2xvclNwYWNlLAogICAgCQkJZGVwdGhCdWZmZXI6IGZhbHNlCiAgICAJCX07CgogICAgCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKTsKCiAgICAJCWlmICggdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgPT09IG51bGwgfHwgdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQud2lkdGggIT09IHdpZHRoIHx8IHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0LmhlaWdodCAhPT0gaGVpZ2h0ICkgewoKICAgIAkJCWlmICggdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgIT09IG51bGwgKSB7CgogICAgCQkJCXRoaXMuX2Rpc3Bvc2UoKTsKCiAgICAJCQl9CgogICAgCQkJdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKTsKCiAgICAJCQljb25zdCB7IF9sb2RNYXggfSA9IHRoaXM7CiAgICAJCQkoIHsgc2l6ZUxvZHM6IHRoaXMuX3NpemVMb2RzLCBsb2RQbGFuZXM6IHRoaXMuX2xvZFBsYW5lcywgc2lnbWFzOiB0aGlzLl9zaWdtYXMgfSA9IF9jcmVhdGVQbGFuZXMoIF9sb2RNYXggKSApOwoKICAgIAkJCXRoaXMuX2JsdXJNYXRlcmlhbCA9IF9nZXRCbHVyU2hhZGVyKCBfbG9kTWF4LCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKICAgIAl9CgogICAgCV9jb21waWxlTWF0ZXJpYWwoIG1hdGVyaWFsICkgewoKICAgIAkJY29uc3QgdG1wTWVzaCA9IG5ldyBNZXNoKCB0aGlzLl9sb2RQbGFuZXNbIDAgXSwgbWF0ZXJpYWwgKTsKICAgIAkJdGhpcy5fcmVuZGVyZXIuY29tcGlsZSggdG1wTWVzaCwgX2ZsYXRDYW1lcmEgKTsKCiAgICAJfQoKICAgIAlfc2NlbmVUb0N1YmVVViggc2NlbmUsIG5lYXIsIGZhciwgY3ViZVVWUmVuZGVyVGFyZ2V0LCBwb3NpdGlvbiApIHsKCiAgICAJCWNvbnN0IGZvdiA9IDkwOwogICAgCQljb25zdCBhc3BlY3QgPSAxOwogICAgCQljb25zdCBjdWJlQ2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CiAgICAJCWNvbnN0IHVwU2lnbiA9IFsgMSwgLTEsIDEsIDEsIDEsIDEgXTsKICAgIAkJY29uc3QgZm9yd2FyZFNpZ24gPSBbIDEsIDEsIDEsIC0xLCAtMSwgLTEgXTsKICAgIAkJY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9yZW5kZXJlcjsKCiAgICAJCWNvbnN0IG9yaWdpbmFsQXV0b0NsZWFyID0gcmVuZGVyZXIuYXV0b0NsZWFyOwogICAgCQljb25zdCB0b25lTWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwogICAgCQlyZW5kZXJlci5nZXRDbGVhckNvbG9yKCBfY2xlYXJDb2xvciApOwoKICAgIAkJcmVuZGVyZXIudG9uZU1hcHBpbmcgPSBOb1RvbmVNYXBwaW5nOwogICAgCQlyZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTsKCiAgICAJCWNvbnN0IGJhY2tncm91bmRNYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggewogICAgCQkJbmFtZTogJ1BNUkVNLkJhY2tncm91bmQnLAogICAgCQkJc2lkZTogQmFja1NpZGUsCiAgICAJCQlkZXB0aFdyaXRlOiBmYWxzZSwKICAgIAkJCWRlcHRoVGVzdDogZmFsc2UsCiAgICAJCX0gKTsKCiAgICAJCWNvbnN0IGJhY2tncm91bmRCb3ggPSBuZXcgTWVzaCggbmV3IEJveEdlb21ldHJ5KCksIGJhY2tncm91bmRNYXRlcmlhbCApOwoKICAgIAkJbGV0IHVzZVNvbGlkQ29sb3IgPSBmYWxzZTsKICAgIAkJY29uc3QgYmFja2dyb3VuZCA9IHNjZW5lLmJhY2tncm91bmQ7CgogICAgCQlpZiAoIGJhY2tncm91bmQgKSB7CgogICAgCQkJaWYgKCBiYWNrZ3JvdW5kLmlzQ29sb3IgKSB7CgogICAgCQkJCWJhY2tncm91bmRNYXRlcmlhbC5jb2xvci5jb3B5KCBiYWNrZ3JvdW5kICk7CiAgICAJCQkJc2NlbmUuYmFja2dyb3VuZCA9IG51bGw7CiAgICAJCQkJdXNlU29saWRDb2xvciA9IHRydWU7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQliYWNrZ3JvdW5kTWF0ZXJpYWwuY29sb3IuY29weSggX2NsZWFyQ29sb3IgKTsKICAgIAkJCXVzZVNvbGlkQ29sb3IgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCiAgICAJCQljb25zdCBjb2wgPSBpICUgMzsKCiAgICAJCQlpZiAoIGNvbCA9PT0gMCApIHsKCiAgICAJCQkJY3ViZUNhbWVyYS51cC5zZXQoIDAsIHVwU2lnblsgaSBdLCAwICk7CiAgICAJCQkJY3ViZUNhbWVyYS5wb3NpdGlvbi5zZXQoIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHBvc2l0aW9uLnogKTsKICAgIAkJCQljdWJlQ2FtZXJhLmxvb2tBdCggcG9zaXRpb24ueCArIGZvcndhcmRTaWduWyBpIF0sIHBvc2l0aW9uLnksIHBvc2l0aW9uLnogKTsKCiAgICAJCQl9IGVsc2UgaWYgKCBjb2wgPT09IDEgKSB7CgogICAgCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCAwLCB1cFNpZ25bIGkgXSApOwogICAgCQkJCWN1YmVDYW1lcmEucG9zaXRpb24uc2V0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CiAgICAJCQkJY3ViZUNhbWVyYS5sb29rQXQoIHBvc2l0aW9uLngsIHBvc2l0aW9uLnkgKyBmb3J3YXJkU2lnblsgaSBdLCBwb3NpdGlvbi56ICk7CgoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCB1cFNpZ25bIGkgXSwgMCApOwogICAgCQkJCWN1YmVDYW1lcmEucG9zaXRpb24uc2V0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CiAgICAJCQkJY3ViZUNhbWVyYS5sb29rQXQoIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHBvc2l0aW9uLnogKyBmb3J3YXJkU2lnblsgaSBdICk7CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IHNpemUgPSB0aGlzLl9jdWJlU2l6ZTsKCiAgICAJCQlfc2V0Vmlld3BvcnQoIGN1YmVVVlJlbmRlclRhcmdldCwgY29sICogc2l6ZSwgaSA+IDIgPyBzaXplIDogMCwgc2l6ZSwgc2l6ZSApOwoKICAgIAkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJaWYgKCB1c2VTb2xpZENvbG9yICkgewoKICAgIAkJCQlyZW5kZXJlci5yZW5kZXIoIGJhY2tncm91bmRCb3gsIGN1YmVDYW1lcmEgKTsKCiAgICAJCQl9CgogICAgCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY3ViZUNhbWVyYSApOwoKICAgIAkJfQoKICAgIAkJYmFja2dyb3VuZEJveC5nZW9tZXRyeS5kaXNwb3NlKCk7CiAgICAJCWJhY2tncm91bmRCb3gubWF0ZXJpYWwuZGlzcG9zZSgpOwoKICAgIAkJcmVuZGVyZXIudG9uZU1hcHBpbmcgPSB0b25lTWFwcGluZzsKICAgIAkJcmVuZGVyZXIuYXV0b0NsZWFyID0gb3JpZ2luYWxBdXRvQ2xlYXI7CiAgICAJCXNjZW5lLmJhY2tncm91bmQgPSBiYWNrZ3JvdW5kOwoKICAgIAl9CgogICAgCV90ZXh0dXJlVG9DdWJlVVYoIHRleHR1cmUsIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCiAgICAJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgogICAgCQljb25zdCBpc0N1YmVUZXh0dXJlID0gKCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZsZWN0aW9uTWFwcGluZyB8fCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApOwoKICAgIAkJaWYgKCBpc0N1YmVUZXh0dXJlICkgewoKICAgIAkJCWlmICggdGhpcy5fY3ViZW1hcE1hdGVyaWFsID09PSBudWxsICkgewoKICAgIAkJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPSBfZ2V0Q3ViZW1hcE1hdGVyaWFsKCk7CgogICAgCQkJfQoKICAgIAkJCXRoaXMuX2N1YmVtYXBNYXRlcmlhbC51bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSA/IC0xIDogMTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJaWYgKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID09PSBudWxsICkgewoKICAgIAkJCQl0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID0gX2dldEVxdWlyZWN0TWF0ZXJpYWwoKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQljb25zdCBtYXRlcmlhbCA9IGlzQ3ViZVRleHR1cmUgPyB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgOiB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsOwogICAgCQljb25zdCBtZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgMCBdLCBtYXRlcmlhbCApOwoKICAgIAkJY29uc3QgdW5pZm9ybXMgPSBtYXRlcmlhbC51bmlmb3JtczsKCiAgICAJCXVuaWZvcm1zWyAnZW52TWFwJyBdLnZhbHVlID0gdGV4dHVyZTsKCiAgICAJCWNvbnN0IHNpemUgPSB0aGlzLl9jdWJlU2l6ZTsKCiAgICAJCV9zZXRWaWV3cG9ydCggY3ViZVVWUmVuZGVyVGFyZ2V0LCAwLCAwLCAzICogc2l6ZSwgMiAqIHNpemUgKTsKCiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CiAgICAJCXJlbmRlcmVyLnJlbmRlciggbWVzaCwgX2ZsYXRDYW1lcmEgKTsKCiAgICAJfQoKICAgIAlfYXBwbHlQTVJFTSggY3ViZVVWUmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9yZW5kZXJlcjsKICAgIAkJY29uc3QgYXV0b0NsZWFyID0gcmVuZGVyZXIuYXV0b0NsZWFyOwogICAgCQlyZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTsKICAgIAkJY29uc3QgbiA9IHRoaXMuX2xvZFBsYW5lcy5sZW5ndGg7CgogICAgCQlmb3IgKCBsZXQgaSA9IDE7IGkgPCBuOyBpICsrICkgewoKICAgIAkJCWNvbnN0IHNpZ21hID0gTWF0aC5zcXJ0KCB0aGlzLl9zaWdtYXNbIGkgXSAqIHRoaXMuX3NpZ21hc1sgaSBdIC0gdGhpcy5fc2lnbWFzWyBpIC0gMSBdICogdGhpcy5fc2lnbWFzWyBpIC0gMSBdICk7CgogICAgCQkJY29uc3QgcG9sZUF4aXMgPSBfYXhpc0RpcmVjdGlvbnNbICggbiAtIGkgLSAxICkgJSBfYXhpc0RpcmVjdGlvbnMubGVuZ3RoIF07CgogICAgCQkJdGhpcy5fYmx1ciggY3ViZVVWUmVuZGVyVGFyZ2V0LCBpIC0gMSwgaSwgc2lnbWEsIHBvbGVBeGlzICk7CgogICAgCQl9CgogICAgCQlyZW5kZXJlci5hdXRvQ2xlYXIgPSBhdXRvQ2xlYXI7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogVGhpcyBpcyBhIHR3by1wYXNzIEdhdXNzaWFuIGJsdXIgZm9yIGEgY3ViZW1hcC4gTm9ybWFsbHkgdGhpcyBpcyBkb25lCiAgICAJICogdmVydGljYWxseSBhbmQgaG9yaXpvbnRhbGx5LCBidXQgdGhpcyBicmVha3MgZG93biBvbiBhIGN1YmUuIEhlcmUgd2UgYXBwbHkKICAgIAkgKiB0aGUgYmx1ciBsYXRpdHVkaW5hbGx5IChhcm91bmQgdGhlIHBvbGVzKSwgYW5kIHRoZW4gbG9uZ2l0dWRpbmFsbHkgKHRvd2FyZHMKICAgIAkgKiB0aGUgcG9sZXMpIHRvIGFwcHJveGltYXRlIHRoZSBvcnRob2dvbmFsbHktc2VwYXJhYmxlIGJsdXIuIEl0IGlzIGxlYXN0CiAgICAJICogYWNjdXJhdGUgYXQgdGhlIHBvbGVzLCBidXQgc3RpbGwgZG9lcyBhIGRlY2VudCBqb2IuCiAgICAJICoKICAgIAkgKiBAcHJpdmF0ZQogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IGN1YmVVVlJlbmRlclRhcmdldAogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsb2RJbgogICAgCSAqIEBwYXJhbSB7bnVtYmVyfSBsb2RPdXQKICAgIAkgKiBAcGFyYW0ge251bWJlcn0gc2lnbWEKICAgIAkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtwb2xlQXhpc10KICAgIAkgKi8KICAgIAlfYmx1ciggY3ViZVVWUmVuZGVyVGFyZ2V0LCBsb2RJbiwgbG9kT3V0LCBzaWdtYSwgcG9sZUF4aXMgKSB7CgogICAgCQljb25zdCBwaW5nUG9uZ1JlbmRlclRhcmdldCA9IHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0OwoKICAgIAkJdGhpcy5faGFsZkJsdXIoCiAgICAJCQljdWJlVVZSZW5kZXJUYXJnZXQsCiAgICAJCQlwaW5nUG9uZ1JlbmRlclRhcmdldCwKICAgIAkJCWxvZEluLAogICAgCQkJbG9kT3V0LAogICAgCQkJc2lnbWEsCiAgICAJCQknbGF0aXR1ZGluYWwnLAogICAgCQkJcG9sZUF4aXMgKTsKCiAgICAJCXRoaXMuX2hhbGZCbHVyKAogICAgCQkJcGluZ1BvbmdSZW5kZXJUYXJnZXQsCiAgICAJCQljdWJlVVZSZW5kZXJUYXJnZXQsCiAgICAJCQlsb2RPdXQsCiAgICAJCQlsb2RPdXQsCiAgICAJCQlzaWdtYSwKICAgIAkJCSdsb25naXR1ZGluYWwnLAogICAgCQkJcG9sZUF4aXMgKTsKCiAgICAJfQoKICAgIAlfaGFsZkJsdXIoIHRhcmdldEluLCB0YXJnZXRPdXQsIGxvZEluLCBsb2RPdXQsIHNpZ21hUmFkaWFucywgZGlyZWN0aW9uLCBwb2xlQXhpcyApIHsKCiAgICAJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CiAgICAJCWNvbnN0IGJsdXJNYXRlcmlhbCA9IHRoaXMuX2JsdXJNYXRlcmlhbDsKCiAgICAJCWlmICggZGlyZWN0aW9uICE9PSAnbGF0aXR1ZGluYWwnICYmIGRpcmVjdGlvbiAhPT0gJ2xvbmdpdHVkaW5hbCcgKSB7CgogICAgCQkJY29uc29sZS5lcnJvcigKICAgIAkJCQknYmx1ciBkaXJlY3Rpb24gbXVzdCBiZSBlaXRoZXIgbGF0aXR1ZGluYWwgb3IgbG9uZ2l0dWRpbmFsIScgKTsKCiAgICAJCX0KCiAgICAJCS8vIE51bWJlciBvZiBzdGFuZGFyZCBkZXZpYXRpb25zIGF0IHdoaWNoIHRvIGN1dCBvZmYgdGhlIGRpc2NyZXRlIGFwcHJveGltYXRpb24uCiAgICAJCWNvbnN0IFNUQU5EQVJEX0RFVklBVElPTlMgPSAzOwoKICAgIAkJY29uc3QgYmx1ck1lc2ggPSBuZXcgTWVzaCggdGhpcy5fbG9kUGxhbmVzWyBsb2RPdXQgXSwgYmx1ck1hdGVyaWFsICk7CiAgICAJCWNvbnN0IGJsdXJVbmlmb3JtcyA9IGJsdXJNYXRlcmlhbC51bmlmb3JtczsKCiAgICAJCWNvbnN0IHBpeGVscyA9IHRoaXMuX3NpemVMb2RzWyBsb2RJbiBdIC0gMTsKICAgIAkJY29uc3QgcmFkaWFuc1BlclBpeGVsID0gaXNGaW5pdGUoIHNpZ21hUmFkaWFucyApID8gTWF0aC5QSSAvICggMiAqIHBpeGVscyApIDogMiAqIE1hdGguUEkgLyAoIDIgKiBNQVhfU0FNUExFUyAtIDEgKTsKICAgIAkJY29uc3Qgc2lnbWFQaXhlbHMgPSBzaWdtYVJhZGlhbnMgLyByYWRpYW5zUGVyUGl4ZWw7CiAgICAJCWNvbnN0IHNhbXBsZXMgPSBpc0Zpbml0ZSggc2lnbWFSYWRpYW5zICkgPyAxICsgTWF0aC5mbG9vciggU1RBTkRBUkRfREVWSUFUSU9OUyAqIHNpZ21hUGl4ZWxzICkgOiBNQVhfU0FNUExFUzsKCiAgICAJCWlmICggc2FtcGxlcyA+IE1BWF9TQU1QTEVTICkgewoKICAgIAkJCWNvbnNvbGUud2FybiggYHNpZ21hUmFkaWFucywgJHsKCQkJCXNpZ21hUmFkaWFuc30sIGlzIHRvbyBsYXJnZSBhbmQgd2lsbCBjbGlwLCBhcyBpdCByZXF1ZXN0ZWQgJHsKCQkJCXNhbXBsZXN9IHNhbXBsZXMgd2hlbiB0aGUgbWF4aW11bSBpcyBzZXQgdG8gJHtNQVhfU0FNUExFU31gICk7CgogICAgCQl9CgogICAgCQljb25zdCB3ZWlnaHRzID0gW107CiAgICAJCWxldCBzdW0gPSAwOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgTUFYX1NBTVBMRVM7ICsrIGkgKSB7CgogICAgCQkJY29uc3QgeCA9IGkgLyBzaWdtYVBpeGVsczsKICAgIAkJCWNvbnN0IHdlaWdodCA9IE1hdGguZXhwKCAtIHggKiB4IC8gMiApOwogICAgCQkJd2VpZ2h0cy5wdXNoKCB3ZWlnaHQgKTsKCiAgICAJCQlpZiAoIGkgPT09IDAgKSB7CgogICAgCQkJCXN1bSArPSB3ZWlnaHQ7CgogICAgCQkJfSBlbHNlIGlmICggaSA8IHNhbXBsZXMgKSB7CgogICAgCQkJCXN1bSArPSAyICogd2VpZ2h0OwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IHdlaWdodHMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCXdlaWdodHNbIGkgXSA9IHdlaWdodHNbIGkgXSAvIHN1bTsKCiAgICAJCX0KCiAgICAJCWJsdXJVbmlmb3Jtc1sgJ2Vudk1hcCcgXS52YWx1ZSA9IHRhcmdldEluLnRleHR1cmU7CiAgICAJCWJsdXJVbmlmb3Jtc1sgJ3NhbXBsZXMnIF0udmFsdWUgPSBzYW1wbGVzOwogICAgCQlibHVyVW5pZm9ybXNbICd3ZWlnaHRzJyBdLnZhbHVlID0gd2VpZ2h0czsKICAgIAkJYmx1clVuaWZvcm1zWyAnbGF0aXR1ZGluYWwnIF0udmFsdWUgPSBkaXJlY3Rpb24gPT09ICdsYXRpdHVkaW5hbCc7CgogICAgCQlpZiAoIHBvbGVBeGlzICkgewoKICAgIAkJCWJsdXJVbmlmb3Jtc1sgJ3BvbGVBeGlzJyBdLnZhbHVlID0gcG9sZUF4aXM7CgogICAgCQl9CgogICAgCQljb25zdCB7IF9sb2RNYXggfSA9IHRoaXM7CiAgICAJCWJsdXJVbmlmb3Jtc1sgJ2RUaGV0YScgXS52YWx1ZSA9IHJhZGlhbnNQZXJQaXhlbDsKICAgIAkJYmx1clVuaWZvcm1zWyAnbWlwSW50JyBdLnZhbHVlID0gX2xvZE1heCAtIGxvZEluOwoKICAgIAkJY29uc3Qgb3V0cHV0U2l6ZSA9IHRoaXMuX3NpemVMb2RzWyBsb2RPdXQgXTsKICAgIAkJY29uc3QgeCA9IDMgKiBvdXRwdXRTaXplICogKCBsb2RPdXQgPiBfbG9kTWF4IC0gTE9EX01JTiA/IGxvZE91dCAtIF9sb2RNYXggKyBMT0RfTUlOIDogMCApOwogICAgCQljb25zdCB5ID0gNCAqICggdGhpcy5fY3ViZVNpemUgLSBvdXRwdXRTaXplICk7CgogICAgCQlfc2V0Vmlld3BvcnQoIHRhcmdldE91dCwgeCwgeSwgMyAqIG91dHB1dFNpemUsIDIgKiBvdXRwdXRTaXplICk7CiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggdGFyZ2V0T3V0ICk7CiAgICAJCXJlbmRlcmVyLnJlbmRlciggYmx1ck1lc2gsIF9mbGF0Q2FtZXJhICk7CgogICAgCX0KCiAgICB9CgoKCiAgICBmdW5jdGlvbiBfY3JlYXRlUGxhbmVzKCBsb2RNYXggKSB7CgogICAgCWNvbnN0IGxvZFBsYW5lcyA9IFtdOwogICAgCWNvbnN0IHNpemVMb2RzID0gW107CiAgICAJY29uc3Qgc2lnbWFzID0gW107CgogICAgCWxldCBsb2QgPSBsb2RNYXg7CgogICAgCWNvbnN0IHRvdGFsTG9kcyA9IGxvZE1heCAtIExPRF9NSU4gKyAxICsgRVhUUkFfTE9EX1NJR01BLmxlbmd0aDsKCiAgICAJZm9yICggbGV0IGkgPSAwOyBpIDwgdG90YWxMb2RzOyBpICsrICkgewoKICAgIAkJY29uc3Qgc2l6ZUxvZCA9IE1hdGgucG93KCAyLCBsb2QgKTsKICAgIAkJc2l6ZUxvZHMucHVzaCggc2l6ZUxvZCApOwogICAgCQlsZXQgc2lnbWEgPSAxLjAgLyBzaXplTG9kOwoKICAgIAkJaWYgKCBpID4gbG9kTWF4IC0gTE9EX01JTiApIHsKCiAgICAJCQlzaWdtYSA9IEVYVFJBX0xPRF9TSUdNQVsgaSAtIGxvZE1heCArIExPRF9NSU4gLSAxIF07CgogICAgCQl9IGVsc2UgaWYgKCBpID09PSAwICkgewoKICAgIAkJCXNpZ21hID0gMDsKCiAgICAJCX0KCiAgICAJCXNpZ21hcy5wdXNoKCBzaWdtYSApOwoKICAgIAkJY29uc3QgdGV4ZWxTaXplID0gMS4wIC8gKCBzaXplTG9kIC0gMiApOwogICAgCQljb25zdCBtaW4gPSAtIHRleGVsU2l6ZTsKICAgIAkJY29uc3QgbWF4ID0gMSArIHRleGVsU2l6ZTsKICAgIAkJY29uc3QgdXYxID0gWyBtaW4sIG1pbiwgbWF4LCBtaW4sIG1heCwgbWF4LCBtaW4sIG1pbiwgbWF4LCBtYXgsIG1pbiwgbWF4IF07CgogICAgCQljb25zdCBjdWJlRmFjZXMgPSA2OwogICAgCQljb25zdCB2ZXJ0aWNlcyA9IDY7CiAgICAJCWNvbnN0IHBvc2l0aW9uU2l6ZSA9IDM7CiAgICAJCWNvbnN0IHV2U2l6ZSA9IDI7CiAgICAJCWNvbnN0IGZhY2VJbmRleFNpemUgPSAxOwoKICAgIAkJY29uc3QgcG9zaXRpb24gPSBuZXcgRmxvYXQzMkFycmF5KCBwb3NpdGlvblNpemUgKiB2ZXJ0aWNlcyAqIGN1YmVGYWNlcyApOwogICAgCQljb25zdCB1diA9IG5ldyBGbG9hdDMyQXJyYXkoIHV2U2l6ZSAqIHZlcnRpY2VzICogY3ViZUZhY2VzICk7CiAgICAJCWNvbnN0IGZhY2VJbmRleCA9IG5ldyBGbG9hdDMyQXJyYXkoIGZhY2VJbmRleFNpemUgKiB2ZXJ0aWNlcyAqIGN1YmVGYWNlcyApOwoKICAgIAkJZm9yICggbGV0IGZhY2UgPSAwOyBmYWNlIDwgY3ViZUZhY2VzOyBmYWNlICsrICkgewoKICAgIAkJCWNvbnN0IHggPSAoIGZhY2UgJSAzICkgKiAyIC8gMyAtIDE7CiAgICAJCQljb25zdCB5ID0gZmFjZSA+IDIgPyAwIDogLTE7CiAgICAJCQljb25zdCBjb29yZGluYXRlcyA9IFsKICAgIAkJCQl4LCB5LCAwLAogICAgCQkJCXggKyAyIC8gMywgeSwgMCwKICAgIAkJCQl4ICsgMiAvIDMsIHkgKyAxLCAwLAogICAgCQkJCXgsIHksIDAsCiAgICAJCQkJeCArIDIgLyAzLCB5ICsgMSwgMCwKICAgIAkJCQl4LCB5ICsgMSwgMAogICAgCQkJXTsKICAgIAkJCXBvc2l0aW9uLnNldCggY29vcmRpbmF0ZXMsIHBvc2l0aW9uU2l6ZSAqIHZlcnRpY2VzICogZmFjZSApOwogICAgCQkJdXYuc2V0KCB1djEsIHV2U2l6ZSAqIHZlcnRpY2VzICogZmFjZSApOwogICAgCQkJY29uc3QgZmlsbCA9IFsgZmFjZSwgZmFjZSwgZmFjZSwgZmFjZSwgZmFjZSwgZmFjZSBdOwogICAgCQkJZmFjZUluZGV4LnNldCggZmlsbCwgZmFjZUluZGV4U2l6ZSAqIHZlcnRpY2VzICogZmFjZSApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgcGxhbmVzID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CiAgICAJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBwb3NpdGlvblNpemUgKSApOwogICAgCQlwbGFuZXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCB1diwgdXZTaXplICkgKTsKICAgIAkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ2ZhY2VJbmRleCcsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGZhY2VJbmRleCwgZmFjZUluZGV4U2l6ZSApICk7CiAgICAJCWxvZFBsYW5lcy5wdXNoKCBwbGFuZXMgKTsKCiAgICAJCWlmICggbG9kID4gTE9EX01JTiApIHsKCiAgICAJCQlsb2QgLS07CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHsgbG9kUGxhbmVzLCBzaXplTG9kcywgc2lnbWFzIH07CgogICAgfQoKICAgIGZ1bmN0aW9uIF9jcmVhdGVSZW5kZXJUYXJnZXQoIHdpZHRoLCBoZWlnaHQsIHBhcmFtcyApIHsKCiAgICAJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKTsKICAgIAljdWJlVVZSZW5kZXJUYXJnZXQudGV4dHVyZS5tYXBwaW5nID0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmc7CiAgICAJY3ViZVVWUmVuZGVyVGFyZ2V0LnRleHR1cmUubmFtZSA9ICdQTVJFTS5jdWJlVXYnOwogICAgCWN1YmVVVlJlbmRlclRhcmdldC5zY2lzc29yVGVzdCA9IHRydWU7CiAgICAJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCiAgICB9CgogICAgZnVuY3Rpb24gX3NldFZpZXdwb3J0KCB0YXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgogICAgCXRhcmdldC52aWV3cG9ydC5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKICAgIAl0YXJnZXQuc2Npc3Nvci5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gX2dldEJsdXJTaGFkZXIoIGxvZE1heCwgd2lkdGgsIGhlaWdodCApIHsKCiAgICAJY29uc3Qgd2VpZ2h0cyA9IG5ldyBGbG9hdDMyQXJyYXkoIE1BWF9TQU1QTEVTICk7CiAgICAJY29uc3QgcG9sZUF4aXMgPSBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwogICAgCWNvbnN0IHNoYWRlck1hdGVyaWFsID0gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgogICAgCQluYW1lOiAnU3BoZXJpY2FsR2F1c3NpYW5CbHVyJywKCiAgICAJCWRlZmluZXM6IHsKICAgIAkJCSduJzogTUFYX1NBTVBMRVMsCiAgICAJCQknQ1VCRVVWX1RFWEVMX1dJRFRIJzogMS4wIC8gd2lkdGgsCiAgICAJCQknQ1VCRVVWX1RFWEVMX0hFSUdIVCc6IDEuMCAvIGhlaWdodCwKICAgIAkJCSdDVUJFVVZfTUFYX01JUCc6IGAke2xvZE1heH0uMGAsCiAgICAJCX0sCgogICAgCQl1bmlmb3JtczogewogICAgCQkJJ2Vudk1hcCc6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCSdzYW1wbGVzJzogeyB2YWx1ZTogMSB9LAogICAgCQkJJ3dlaWdodHMnOiB7IHZhbHVlOiB3ZWlnaHRzIH0sCiAgICAJCQknbGF0aXR1ZGluYWwnOiB7IHZhbHVlOiBmYWxzZSB9LAogICAgCQkJJ2RUaGV0YSc6IHsgdmFsdWU6IDAgfSwKICAgIAkJCSdtaXBJbnQnOiB7IHZhbHVlOiAwIH0sCiAgICAJCQkncG9sZUF4aXMnOiB7IHZhbHVlOiBwb2xlQXhpcyB9CiAgICAJCX0sCgogICAgCQl2ZXJ0ZXhTaGFkZXI6IF9nZXRDb21tb25WZXJ0ZXhTaGFkZXIoKSwKCiAgICAJCWZyYWdtZW50U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7CgkJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJCXZhcnlpbmcgdmVjMyB2T3V0cHV0RGlyZWN0aW9uOwoKCQkJdW5pZm9ybSBzYW1wbGVyMkQgZW52TWFwOwoJCQl1bmlmb3JtIGludCBzYW1wbGVzOwoJCQl1bmlmb3JtIGZsb2F0IHdlaWdodHNbIG4gXTsKCQkJdW5pZm9ybSBib29sIGxhdGl0dWRpbmFsOwoJCQl1bmlmb3JtIGZsb2F0IGRUaGV0YTsKCQkJdW5pZm9ybSBmbG9hdCBtaXBJbnQ7CgkJCXVuaWZvcm0gdmVjMyBwb2xlQXhpczsKCgkJCSNkZWZpbmUgRU5WTUFQX1RZUEVfQ1VCRV9VVgoJCQkjaW5jbHVkZSA8Y3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50PgoKCQkJdmVjMyBnZXRTYW1wbGUoIGZsb2F0IHRoZXRhLCB2ZWMzIGF4aXMgKSB7CgoJCQkJZmxvYXQgY29zVGhldGEgPSBjb3MoIHRoZXRhICk7CgkJCQkvLyBSb2RyaWd1ZXMnIGF4aXMtYW5nbGUgcm90YXRpb24KCQkJCXZlYzMgc2FtcGxlRGlyZWN0aW9uID0gdk91dHB1dERpcmVjdGlvbiAqIGNvc1RoZXRhCgkJCQkJKyBjcm9zcyggYXhpcywgdk91dHB1dERpcmVjdGlvbiApICogc2luKCB0aGV0YSApCgkJCQkJKyBheGlzICogZG90KCBheGlzLCB2T3V0cHV0RGlyZWN0aW9uICkgKiAoIDEuMCAtIGNvc1RoZXRhICk7CgoJCQkJcmV0dXJuIGJpbGluZWFyQ3ViZVVWKCBlbnZNYXAsIHNhbXBsZURpcmVjdGlvbiwgbWlwSW50ICk7CgoJCQl9CgoJCQl2b2lkIG1haW4oKSB7CgoJCQkJdmVjMyBheGlzID0gbGF0aXR1ZGluYWwgPyBwb2xlQXhpcyA6IGNyb3NzKCBwb2xlQXhpcywgdk91dHB1dERpcmVjdGlvbiApOwoKCQkJCWlmICggYWxsKCBlcXVhbCggYXhpcywgdmVjMyggMC4wICkgKSApICkgewoKCQkJCQlheGlzID0gdmVjMyggdk91dHB1dERpcmVjdGlvbi56LCAwLjAsIC0gdk91dHB1dERpcmVjdGlvbi54ICk7CgoJCQkJfQoKCQkJCWF4aXMgPSBub3JtYWxpemUoIGF4aXMgKTsKCgkJCQlnbF9GcmFnQ29sb3IgPSB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTsKCQkJCWdsX0ZyYWdDb2xvci5yZ2IgKz0gd2VpZ2h0c1sgMCBdICogZ2V0U2FtcGxlKCAwLjAsIGF4aXMgKTsKCgkJCQlmb3IgKCBpbnQgaSA9IDE7IGkgPCBuOyBpKysgKSB7CgoJCQkJCWlmICggaSA+PSBzYW1wbGVzICkgewoKCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQkJZmxvYXQgdGhldGEgPSBkVGhldGEgKiBmbG9hdCggaSApOwoJCQkJCWdsX0ZyYWdDb2xvci5yZ2IgKz0gd2VpZ2h0c1sgaSBdICogZ2V0U2FtcGxlKCAtMS4wICogdGhldGEsIGF4aXMgKTsKCQkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIGkgXSAqIGdldFNhbXBsZSggdGhldGEsIGF4aXMgKTsKCgkJCQl9CgoJCQl9CgkJYCwKCiAgICAJCWJsZW5kaW5nOiBOb0JsZW5kaW5nLAogICAgCQlkZXB0aFRlc3Q6IGZhbHNlLAogICAgCQlkZXB0aFdyaXRlOiBmYWxzZQoKICAgIAl9ICk7CgogICAgCXJldHVybiBzaGFkZXJNYXRlcmlhbDsKCiAgICB9CgogICAgZnVuY3Rpb24gX2dldEVxdWlyZWN0TWF0ZXJpYWwoKSB7CgogICAgCXJldHVybiBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCiAgICAJCW5hbWU6ICdFcXVpcmVjdGFuZ3VsYXJUb0N1YmVVVicsCgogICAgCQl1bmlmb3JtczogewogICAgCQkJJ2Vudk1hcCc6IHsgdmFsdWU6IG51bGwgfQogICAgCQl9LAoKICAgIAkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgogICAgCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDsKCgkJCSNpbmNsdWRlIDxjb21tb24+CgoJCQl2b2lkIG1haW4oKSB7CgoJCQkJdmVjMyBvdXRwdXREaXJlY3Rpb24gPSBub3JtYWxpemUoIHZPdXRwdXREaXJlY3Rpb24gKTsKCQkJCXZlYzIgdXYgPSBlcXVpcmVjdFV2KCBvdXRwdXREaXJlY3Rpb24gKTsKCgkJCQlnbF9GcmFnQ29sb3IgPSB2ZWM0KCB0ZXh0dXJlMkQgKCBlbnZNYXAsIHV2ICkucmdiLCAxLjAgKTsKCgkJCX0KCQlgLAoKICAgIAkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCiAgICAJCWRlcHRoVGVzdDogZmFsc2UsCiAgICAJCWRlcHRoV3JpdGU6IGZhbHNlCgogICAgCX0gKTsKCiAgICB9CgogICAgZnVuY3Rpb24gX2dldEN1YmVtYXBNYXRlcmlhbCgpIHsKCiAgICAJcmV0dXJuIG5ldyBTaGFkZXJNYXRlcmlhbCggewoKICAgIAkJbmFtZTogJ0N1YmVtYXBUb0N1YmVVVicsCgogICAgCQl1bmlmb3JtczogewogICAgCQkJJ2Vudk1hcCc6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCSdmbGlwRW52TWFwJzogeyB2YWx1ZTogLTEgfQogICAgCQl9LAoKICAgIAkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgogICAgCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl1bmlmb3JtIGZsb2F0IGZsaXBFbnZNYXA7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlckN1YmUgZW52TWFwOwoKCQkJdm9pZCBtYWluKCkgewoKCQkJCWdsX0ZyYWdDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIHZlYzMoIGZsaXBFbnZNYXAgKiB2T3V0cHV0RGlyZWN0aW9uLngsIHZPdXRwdXREaXJlY3Rpb24ueXogKSApOwoKCQkJfQoJCWAsCgogICAgCQlibGVuZGluZzogTm9CbGVuZGluZywKICAgIAkJZGVwdGhUZXN0OiBmYWxzZSwKICAgIAkJZGVwdGhXcml0ZTogZmFsc2UKCiAgICAJfSApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCkgewoKICAgIAlyZXR1cm4gLyogZ2xzbCAqL2AKCgkJcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7CgkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQlhdHRyaWJ1dGUgZmxvYXQgZmFjZUluZGV4OwoKCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJLy8gUkggY29vcmRpbmF0ZSBzeXN0ZW07IFBNUkVNIGZhY2UtaW5kZXhpbmcgY29udmVudGlvbgoJCXZlYzMgZ2V0RGlyZWN0aW9uKCB2ZWMyIHV2LCBmbG9hdCBmYWNlICkgewoKCQkJdXYgPSAyLjAgKiB1diAtIDEuMDsKCgkJCXZlYzMgZGlyZWN0aW9uID0gdmVjMyggdXYsIDEuMCApOwoKCQkJaWYgKCBmYWNlID09IDAuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24uenl4OyAvLyAoIDEsIHYsIHUgKSBwb3MgeAoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSAxLjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnh6eTsKCQkJCWRpcmVjdGlvbi54eiAqPSAtMS4wOyAvLyAoIC11LCAxLCAtdiApIHBvcyB5CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDIuMCApIHsKCgkJCQlkaXJlY3Rpb24ueCAqPSAtMS4wOyAvLyAoIC11LCB2LCAxICkgcG9zIHoKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gMy4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi56eXg7CgkJCQlkaXJlY3Rpb24ueHogKj0gLTEuMDsgLy8gKCAtMSwgdiwgLXUgKSBuZWcgeAoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSA0LjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnh6eTsKCQkJCWRpcmVjdGlvbi54eSAqPSAtMS4wOyAvLyAoIC11LCAtMSwgdiApIG5lZyB5CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDUuMCApIHsKCgkJCQlkaXJlY3Rpb24ueiAqPSAtMS4wOyAvLyAoIHUsIHYsIC0xICkgbmVnIHoKCgkJCX0KCgkJCXJldHVybiBkaXJlY3Rpb247CgoJCX0KCgkJdm9pZCBtYWluKCkgewoKCQkJdk91dHB1dERpcmVjdGlvbiA9IGdldERpcmVjdGlvbiggdXYsIGZhY2VJbmRleCApOwoJCQlnbF9Qb3NpdGlvbiA9IHZlYzQoIHBvc2l0aW9uLCAxLjAgKTsKCgkJfQoJYDsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xDdWJlVVZNYXBzKCByZW5kZXJlciApIHsKCiAgICAJbGV0IGN1YmVVVm1hcHMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlsZXQgcG1yZW1HZW5lcmF0b3IgPSBudWxsOwoKICAgIAlmdW5jdGlvbiBnZXQoIHRleHR1cmUgKSB7CgogICAgCQlpZiAoIHRleHR1cmUgJiYgdGV4dHVyZS5pc1RleHR1cmUgKSB7CgogICAgCQkJY29uc3QgbWFwcGluZyA9IHRleHR1cmUubWFwcGluZzsKCiAgICAJCQljb25zdCBpc0VxdWlyZWN0TWFwID0gKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyB8fCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyApOwogICAgCQkJY29uc3QgaXNDdWJlTWFwID0gKCBtYXBwaW5nID09PSBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgfHwgbWFwcGluZyA9PT0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nICk7CgogICAgCQkJLy8gZXF1aXJlY3QvY3ViZSBtYXAgdG8gY3ViZVVWIGNvbnZlcnNpb24KCiAgICAJCQlpZiAoIGlzRXF1aXJlY3RNYXAgfHwgaXNDdWJlTWFwICkgewoKICAgIAkJCQlsZXQgcmVuZGVyVGFyZ2V0ID0gY3ViZVVWbWFwcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCQkJY29uc3QgY3VycmVudFBNUkVNVmVyc2lvbiA9IHJlbmRlclRhcmdldCAhPT0gdW5kZWZpbmVkID8gcmVuZGVyVGFyZ2V0LnRleHR1cmUucG1yZW1WZXJzaW9uIDogMDsKCiAgICAJCQkJaWYgKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSAmJiB0ZXh0dXJlLnBtcmVtVmVyc2lvbiAhPT0gY3VycmVudFBNUkVNVmVyc2lvbiApIHsKCiAgICAJCQkJCWlmICggcG1yZW1HZW5lcmF0b3IgPT09IG51bGwgKSBwbXJlbUdlbmVyYXRvciA9IG5ldyBQTVJFTUdlbmVyYXRvciggcmVuZGVyZXIgKTsKCiAgICAJCQkJCXJlbmRlclRhcmdldCA9IGlzRXF1aXJlY3RNYXAgPyBwbXJlbUdlbmVyYXRvci5mcm9tRXF1aXJlY3Rhbmd1bGFyKCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKSA6IHBtcmVtR2VuZXJhdG9yLmZyb21DdWJlbWFwKCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKICAgIAkJCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUucG1yZW1WZXJzaW9uID0gdGV4dHVyZS5wbXJlbVZlcnNpb247CgogICAgCQkJCQljdWJlVVZtYXBzLnNldCggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlpZiAoIHJlbmRlclRhcmdldCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCXJldHVybiByZW5kZXJUYXJnZXQudGV4dHVyZTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJY29uc3QgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKICAgIAkJCQkJCWlmICggKCBpc0VxdWlyZWN0TWFwICYmIGltYWdlICYmIGltYWdlLmhlaWdodCA+IDAgKSB8fCAoIGlzQ3ViZU1hcCAmJiBpbWFnZSAmJiBpc0N1YmVUZXh0dXJlQ29tcGxldGUoIGltYWdlICkgKSApIHsKCiAgICAJCQkJCQkJaWYgKCBwbXJlbUdlbmVyYXRvciA9PT0gbnVsbCApIHBtcmVtR2VuZXJhdG9yID0gbmV3IFBNUkVNR2VuZXJhdG9yKCByZW5kZXJlciApOwoKICAgIAkJCQkJCQlyZW5kZXJUYXJnZXQgPSBpc0VxdWlyZWN0TWFwID8gcG1yZW1HZW5lcmF0b3IuZnJvbUVxdWlyZWN0YW5ndWxhciggdGV4dHVyZSApIDogcG1yZW1HZW5lcmF0b3IuZnJvbUN1YmVtYXAoIHRleHR1cmUgKTsKICAgIAkJCQkJCQlyZW5kZXJUYXJnZXQudGV4dHVyZS5wbXJlbVZlcnNpb24gPSB0ZXh0dXJlLnBtcmVtVmVyc2lvbjsKCiAgICAJCQkJCQkJY3ViZVVWbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKICAgIAkJCQkJCQl0ZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKICAgIAkJCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJLy8gaW1hZ2Ugbm90IHlldCByZWFkeS4gdHJ5IHRoZSBjb252ZXJzaW9uIG5leHQgZnJhbWUKCiAgICAJCQkJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRleHR1cmU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gaXNDdWJlVGV4dHVyZUNvbXBsZXRlKCBpbWFnZSApIHsKCiAgICAJCWxldCBjb3VudCA9IDA7CiAgICAJCWNvbnN0IGxlbmd0aCA9IDY7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKysgKSB7CgogICAgCQkJaWYgKCBpbWFnZVsgaSBdICE9PSB1bmRlZmluZWQgKSBjb3VudCArKzsKCiAgICAJCX0KCiAgICAJCXJldHVybiBjb3VudCA9PT0gbGVuZ3RoOwoKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmUgPSBldmVudC50YXJnZXQ7CgogICAgCQl0ZXh0dXJlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKICAgIAkJY29uc3QgY3ViZW1hcFVWID0gY3ViZVVWbWFwcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCWlmICggY3ViZW1hcFVWICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJY3ViZVVWbWFwcy5kZWxldGUoIHRleHR1cmUgKTsKICAgIAkJCWN1YmVtYXBVVi5kaXNwb3NlKCk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCWN1YmVVVm1hcHMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAkJaWYgKCBwbXJlbUdlbmVyYXRvciAhPT0gbnVsbCApIHsKCiAgICAJCQlwbXJlbUdlbmVyYXRvci5kaXNwb3NlKCk7CiAgICAJCQlwbXJlbUdlbmVyYXRvciA9IG51bGw7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJZ2V0OiBnZXQsCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTEV4dGVuc2lvbnMoIGdsICkgewoKICAgIAljb25zdCBleHRlbnNpb25zID0ge307CgogICAgCWZ1bmN0aW9uIGdldEV4dGVuc2lvbiggbmFtZSApIHsKCiAgICAJCWlmICggZXh0ZW5zaW9uc1sgbmFtZSBdICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJcmV0dXJuIGV4dGVuc2lvbnNbIG5hbWUgXTsKCiAgICAJCX0KCiAgICAJCWxldCBleHRlbnNpb247CgogICAgCQlzd2l0Y2ggKCBuYW1lICkgewoKICAgIAkJCWNhc2UgJ1dFQkdMX2RlcHRoX3RleHR1cmUnOgogICAgCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlcHRoX3RleHR1cmUnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX1dFQkdMX2RlcHRoX3RleHR1cmUnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX1dFQkdMX2RlcHRoX3RleHR1cmUnICk7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJzoKICAgIAkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJzoKICAgIAkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdNT1pfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0Yyc6CiAgICAJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICk7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJZGVmYXVsdDoKICAgIAkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oIG5hbWUgKTsKCiAgICAJCX0KCiAgICAJCWV4dGVuc2lvbnNbIG5hbWUgXSA9IGV4dGVuc2lvbjsKCiAgICAJCXJldHVybiBleHRlbnNpb247CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCWhhczogZnVuY3Rpb24gKCBuYW1lICkgewoKICAgIAkJCXJldHVybiBnZXRFeHRlbnNpb24oIG5hbWUgKSAhPT0gbnVsbDsKCiAgICAJCX0sCgogICAgCQlpbml0OiBmdW5jdGlvbiAoKSB7CgogICAgCQkJZ2V0RXh0ZW5zaW9uKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKTsKICAgIAkJCWdldEV4dGVuc2lvbiggJ1dFQkdMX2NsaXBfY3VsbF9kaXN0YW5jZScgKTsKICAgIAkJCWdldEV4dGVuc2lvbiggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKTsKICAgIAkJCWdldEV4dGVuc2lvbiggJ0VYVF9jb2xvcl9idWZmZXJfaGFsZl9mbG9hdCcgKTsKICAgIAkJCWdldEV4dGVuc2lvbiggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKTsKICAgIAkJCWdldEV4dGVuc2lvbiggJ1dFQkdMX3JlbmRlcl9zaGFyZWRfZXhwb25lbnQnICk7CgogICAgCQl9LAoKICAgIAkJZ2V0OiBmdW5jdGlvbiAoIG5hbWUgKSB7CgogICAgCQkJY29uc3QgZXh0ZW5zaW9uID0gZ2V0RXh0ZW5zaW9uKCBuYW1lICk7CgogICAgCQkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgogICAgCQkJCXdhcm5PbmNlKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogJyArIG5hbWUgKyAnIGV4dGVuc2lvbiBub3Qgc3VwcG9ydGVkLicgKTsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGV4dGVuc2lvbjsKCiAgICAJCX0KCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xHZW9tZXRyaWVzKCBnbCwgYXR0cmlidXRlcywgaW5mbywgYmluZGluZ1N0YXRlcyApIHsKCiAgICAJY29uc3QgZ2VvbWV0cmllcyA9IHt9OwogICAgCWNvbnN0IHdpcmVmcmFtZUF0dHJpYnV0ZXMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlmdW5jdGlvbiBvbkdlb21ldHJ5RGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQljb25zdCBnZW9tZXRyeSA9IGV2ZW50LnRhcmdldDsKCiAgICAJCWlmICggZ2VvbWV0cnkuaW5kZXggIT09IG51bGwgKSB7CgogICAgCQkJYXR0cmlidXRlcy5yZW1vdmUoIGdlb21ldHJ5LmluZGV4ICk7CgogICAgCQl9CgogICAgCQlmb3IgKCBjb25zdCBuYW1lIGluIGdlb21ldHJ5LmF0dHJpYnV0ZXMgKSB7CgogICAgCQkJYXR0cmlidXRlcy5yZW1vdmUoIGdlb21ldHJ5LmF0dHJpYnV0ZXNbIG5hbWUgXSApOwoKICAgIAkJfQoKICAgIAkJZ2VvbWV0cnkucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkdlb21ldHJ5RGlzcG9zZSApOwoKICAgIAkJZGVsZXRlIGdlb21ldHJpZXNbIGdlb21ldHJ5LmlkIF07CgogICAgCQljb25zdCBhdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCiAgICAJCWlmICggYXR0cmlidXRlICkgewoKICAgIAkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBhdHRyaWJ1dGUgKTsKICAgIAkJCXdpcmVmcmFtZUF0dHJpYnV0ZXMuZGVsZXRlKCBnZW9tZXRyeSApOwoKICAgIAkJfQoKICAgIAkJYmluZGluZ1N0YXRlcy5yZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeSggZ2VvbWV0cnkgKTsKCiAgICAJCWlmICggZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA9PT0gdHJ1ZSApIHsKCiAgICAJCQlkZWxldGUgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQ7CgogICAgCQl9CgogICAgCQkvLwoKICAgIAkJaW5mby5tZW1vcnkuZ2VvbWV0cmllcyAtLTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXQoIG9iamVjdCwgZ2VvbWV0cnkgKSB7CgogICAgCQlpZiAoIGdlb21ldHJpZXNbIGdlb21ldHJ5LmlkIF0gPT09IHRydWUgKSByZXR1cm4gZ2VvbWV0cnk7CgogICAgCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uR2VvbWV0cnlEaXNwb3NlICk7CgogICAgCQlnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdID0gdHJ1ZTsKCiAgICAJCWluZm8ubWVtb3J5Lmdlb21ldHJpZXMgKys7CgogICAgCQlyZXR1cm4gZ2VvbWV0cnk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlKCBnZW9tZXRyeSApIHsKCiAgICAJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgogICAgCQkvLyBVcGRhdGluZyBpbmRleCBidWZmZXIgaW4gVkFPIG5vdy4gU2VlIFdlYkdMQmluZGluZ1N0YXRlcy4KCiAgICAJCWZvciAoIGNvbnN0IG5hbWUgaW4gZ2VvbWV0cnlBdHRyaWJ1dGVzICkgewoKICAgIAkJCWF0dHJpYnV0ZXMudXBkYXRlKCBnZW9tZXRyeUF0dHJpYnV0ZXNbIG5hbWUgXSwgZ2wuQVJSQVlfQlVGRkVSICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlV2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApIHsKCiAgICAJCWNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAJCWNvbnN0IGdlb21ldHJ5SW5kZXggPSBnZW9tZXRyeS5pbmRleDsKICAgIAkJY29uc3QgZ2VvbWV0cnlQb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCWxldCB2ZXJzaW9uID0gMDsKCiAgICAJCWlmICggZ2VvbWV0cnlJbmRleCAhPT0gbnVsbCApIHsKCiAgICAJCQljb25zdCBhcnJheSA9IGdlb21ldHJ5SW5kZXguYXJyYXk7CiAgICAJCQl2ZXJzaW9uID0gZ2VvbWV0cnlJbmRleC52ZXJzaW9uOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKz0gMyApIHsKCiAgICAJCQkJY29uc3QgYSA9IGFycmF5WyBpICsgMCBdOwogICAgCQkJCWNvbnN0IGIgPSBhcnJheVsgaSArIDEgXTsKICAgIAkJCQljb25zdCBjID0gYXJyYXlbIGkgKyAyIF07CgogICAgCQkJCWluZGljZXMucHVzaCggYSwgYiwgYiwgYywgYywgYSApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSBpZiAoIGdlb21ldHJ5UG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQljb25zdCBhcnJheSA9IGdlb21ldHJ5UG9zaXRpb24uYXJyYXk7CiAgICAJCQl2ZXJzaW9uID0gZ2VvbWV0cnlQb3NpdGlvbi52ZXJzaW9uOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9ICggYXJyYXkubGVuZ3RoIC8gMyApIC0gMTsgaSA8IGw7IGkgKz0gMyApIHsKCiAgICAJCQkJY29uc3QgYSA9IGkgKyAwOwogICAgCQkJCWNvbnN0IGIgPSBpICsgMTsKICAgIAkJCQljb25zdCBjID0gaSArIDI7CgogICAgCQkJCWluZGljZXMucHVzaCggYSwgYiwgYiwgYywgYywgYSApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJcmV0dXJuOwoKICAgIAkJfQoKICAgIAkJY29uc3QgYXR0cmlidXRlID0gbmV3ICggYXJyYXlOZWVkc1VpbnQzMiggaW5kaWNlcyApID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGljZXMsIDEgKTsKICAgIAkJYXR0cmlidXRlLnZlcnNpb24gPSB2ZXJzaW9uOwoKICAgIAkJLy8gVXBkYXRpbmcgaW5kZXggYnVmZmVyIGluIFZBTyBub3cuIFNlZSBXZWJHTEJpbmRpbmdTdGF0ZXMKCiAgICAJCS8vCgogICAgCQljb25zdCBwcmV2aW91c0F0dHJpYnV0ZSA9IHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKICAgIAkJaWYgKCBwcmV2aW91c0F0dHJpYnV0ZSApIGF0dHJpYnV0ZXMucmVtb3ZlKCBwcmV2aW91c0F0dHJpYnV0ZSApOwoKICAgIAkJLy8KCiAgICAJCXdpcmVmcmFtZUF0dHJpYnV0ZXMuc2V0KCBnZW9tZXRyeSwgYXR0cmlidXRlICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0V2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApIHsKCiAgICAJCWNvbnN0IGN1cnJlbnRBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCiAgICAJCWlmICggY3VycmVudEF0dHJpYnV0ZSApIHsKCiAgICAJCQljb25zdCBnZW9tZXRyeUluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgogICAgCQkJaWYgKCBnZW9tZXRyeUluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCQkvLyBpZiB0aGUgYXR0cmlidXRlIGlzIG9ic29sZXRlLCBjcmVhdGUgYSBuZXcgb25lCgogICAgCQkJCWlmICggY3VycmVudEF0dHJpYnV0ZS52ZXJzaW9uIDwgZ2VvbWV0cnlJbmRleC52ZXJzaW9uICkgewoKICAgIAkJCQkJdXBkYXRlV2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl1cGRhdGVXaXJlZnJhbWVBdHRyaWJ1dGUoIGdlb21ldHJ5ICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCWdldDogZ2V0LAogICAgCQl1cGRhdGU6IHVwZGF0ZSwKCiAgICAJCWdldFdpcmVmcmFtZUF0dHJpYnV0ZTogZ2V0V2lyZWZyYW1lQXR0cmlidXRlCgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKCBnbCwgZXh0ZW5zaW9ucywgaW5mbyApIHsKCiAgICAJbGV0IG1vZGU7CgogICAgCWZ1bmN0aW9uIHNldE1vZGUoIHZhbHVlICkgewoKICAgIAkJbW9kZSA9IHZhbHVlOwoKICAgIAl9CgogICAgCWxldCB0eXBlLCBieXRlc1BlckVsZW1lbnQ7CgogICAgCWZ1bmN0aW9uIHNldEluZGV4KCB2YWx1ZSApIHsKCiAgICAJCXR5cGUgPSB2YWx1ZS50eXBlOwogICAgCQlieXRlc1BlckVsZW1lbnQgPSB2YWx1ZS5ieXRlc1BlckVsZW1lbnQ7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyKCBzdGFydCwgY291bnQgKSB7CgogICAgCQlnbC5kcmF3RWxlbWVudHMoIG1vZGUsIGNvdW50LCB0eXBlLCBzdGFydCAqIGJ5dGVzUGVyRWxlbWVudCApOwoKICAgIAkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCAxICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKCBzdGFydCwgY291bnQsIHByaW1jb3VudCApIHsKCiAgICAJCWlmICggcHJpbWNvdW50ID09PSAwICkgcmV0dXJuOwoKICAgIAkJZ2wuZHJhd0VsZW1lbnRzSW5zdGFuY2VkKCBtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQsIHByaW1jb3VudCApOwoKICAgIAkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCBwcmltY291bnQgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXJNdWx0aURyYXcoIHN0YXJ0cywgY291bnRzLCBkcmF3Q291bnQgKSB7CgogICAgCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCiAgICAJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKICAgIAkJZXh0ZW5zaW9uLm11bHRpRHJhd0VsZW1lbnRzV0VCR0woIG1vZGUsIGNvdW50cywgMCwgdHlwZSwgc3RhcnRzLCAwLCBkcmF3Q291bnQgKTsKCiAgICAJCWxldCBlbGVtZW50Q291bnQgPSAwOwogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgogICAgCQkJZWxlbWVudENvdW50ICs9IGNvdW50c1sgaSBdOwoKICAgIAkJfQoKICAgIAkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMoIHN0YXJ0cywgY291bnRzLCBkcmF3Q291bnQsIHByaW1jb3VudCApIHsKCiAgICAJCWlmICggZHJhd0NvdW50ID09PSAwICkgcmV0dXJuOwoKICAgIAkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9tdWx0aV9kcmF3JyApOwoKICAgIAkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgc3RhcnRzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJcmVuZGVySW5zdGFuY2VzKCBzdGFydHNbIGkgXSAvIGJ5dGVzUGVyRWxlbWVudCwgY291bnRzWyBpIF0sIHByaW1jb3VudFsgaSBdICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlleHRlbnNpb24ubXVsdGlEcmF3RWxlbWVudHNJbnN0YW5jZWRXRUJHTCggbW9kZSwgY291bnRzLCAwLCB0eXBlLCBzdGFydHMsIDAsIHByaW1jb3VudCwgMCwgZHJhd0NvdW50ICk7CgogICAgCQkJbGV0IGVsZW1lbnRDb3VudCA9IDA7CiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgogICAgCQkJCWVsZW1lbnRDb3VudCArPSBjb3VudHNbIGkgXSAqIHByaW1jb3VudFsgaSBdOwoKICAgIAkJCX0KCiAgICAJCQlpbmZvLnVwZGF0ZSggZWxlbWVudENvdW50LCBtb2RlLCAxICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLy8KCiAgICAJdGhpcy5zZXRNb2RlID0gc2V0TW9kZTsKICAgIAl0aGlzLnNldEluZGV4ID0gc2V0SW5kZXg7CiAgICAJdGhpcy5yZW5kZXIgPSByZW5kZXI7CiAgICAJdGhpcy5yZW5kZXJJbnN0YW5jZXMgPSByZW5kZXJJbnN0YW5jZXM7CiAgICAJdGhpcy5yZW5kZXJNdWx0aURyYXcgPSByZW5kZXJNdWx0aURyYXc7CiAgICAJdGhpcy5yZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMgPSByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXM7CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMSW5mbyggZ2wgKSB7CgogICAgCWNvbnN0IG1lbW9yeSA9IHsKICAgIAkJZ2VvbWV0cmllczogMCwKICAgIAkJdGV4dHVyZXM6IDAKICAgIAl9OwoKICAgIAljb25zdCByZW5kZXIgPSB7CiAgICAJCWZyYW1lOiAwLAogICAgCQljYWxsczogMCwKICAgIAkJdHJpYW5nbGVzOiAwLAogICAgCQlwb2ludHM6IDAsCiAgICAJCWxpbmVzOiAwCiAgICAJfTsKCiAgICAJZnVuY3Rpb24gdXBkYXRlKCBjb3VudCwgbW9kZSwgaW5zdGFuY2VDb3VudCApIHsKCiAgICAJCXJlbmRlci5jYWxscyArKzsKCiAgICAJCXN3aXRjaCAoIG1vZGUgKSB7CgogICAgCQkJY2FzZSBnbC5UUklBTkdMRVM6CiAgICAJCQkJcmVuZGVyLnRyaWFuZ2xlcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAvIDMgKTsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlIGdsLkxJTkVTOgogICAgCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAvIDIgKTsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlIGdsLkxJTkVfU1RSSVA6CiAgICAJCQkJcmVuZGVyLmxpbmVzICs9IGluc3RhbmNlQ291bnQgKiAoIGNvdW50IC0gMSApOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgZ2wuTElORV9MT09QOgogICAgCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogY291bnQ7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJY2FzZSBnbC5QT0lOVFM6CiAgICAJCQkJcmVuZGVyLnBvaW50cyArPSBpbnN0YW5jZUNvdW50ICogY291bnQ7CiAgICAJCQkJYnJlYWs7CgogICAgCQkJZGVmYXVsdDoKICAgIAkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xJbmZvOiBVbmtub3duIGRyYXcgbW9kZTonLCBtb2RlICk7CiAgICAJCQkJYnJlYWs7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVzZXQoKSB7CgogICAgCQlyZW5kZXIuY2FsbHMgPSAwOwogICAgCQlyZW5kZXIudHJpYW5nbGVzID0gMDsKICAgIAkJcmVuZGVyLnBvaW50cyA9IDA7CiAgICAJCXJlbmRlci5saW5lcyA9IDA7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJbWVtb3J5OiBtZW1vcnksCiAgICAJCXJlbmRlcjogcmVuZGVyLAogICAgCQlwcm9ncmFtczogbnVsbCwKICAgIAkJYXV0b1Jlc2V0OiB0cnVlLAogICAgCQlyZXNldDogcmVzZXQsCiAgICAJCXVwZGF0ZTogdXBkYXRlCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xNb3JwaHRhcmdldHMoIGdsLCBjYXBhYmlsaXRpZXMsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBtb3JwaFRleHR1cmVzID0gbmV3IFdlYWtNYXAoKTsKICAgIAljb25zdCBtb3JwaCA9IG5ldyBWZWN0b3I0KCk7CgogICAgCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSApIHsKCiAgICAJCWNvbnN0IG9iamVjdEluZmx1ZW5jZXMgPSBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKICAgIAkJLy8gdGhlIGZvbGxvd2luZyBlbmNvZGVzIG1vcnBoIHRhcmdldHMgaW50byBhbiBhcnJheSBvZiBkYXRhIHRleHR1cmVzLiBFYWNoIGxheWVyIHJlcHJlc2VudHMgYSBzaW5nbGUgbW9ycGggdGFyZ2V0LgoKICAgIAkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3I7CiAgICAJCWNvbnN0IG1vcnBoVGFyZ2V0c0NvdW50ID0gKCBtb3JwaEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgPyBtb3JwaEF0dHJpYnV0ZS5sZW5ndGggOiAwOwoKICAgIAkJbGV0IGVudHJ5ID0gbW9ycGhUZXh0dXJlcy5nZXQoIGdlb21ldHJ5ICk7CgogICAgCQlpZiAoIGVudHJ5ID09PSB1bmRlZmluZWQgfHwgZW50cnkuY291bnQgIT09IG1vcnBoVGFyZ2V0c0NvdW50ICkgewoKICAgIAkJCWlmICggZW50cnkgIT09IHVuZGVmaW5lZCApIGVudHJ5LnRleHR1cmUuZGlzcG9zZSgpOwoKICAgIAkJCWNvbnN0IGhhc01vcnBoUG9zaXRpb24gPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gIT09IHVuZGVmaW5lZDsKICAgIAkJCWNvbnN0IGhhc01vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZDsKICAgIAkJCWNvbnN0IGhhc01vcnBoQ29sb3JzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQ7CgogICAgCQkJY29uc3QgbW9ycGhUYXJnZXRzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IFtdOwogICAgCQkJY29uc3QgbW9ycGhOb3JtYWxzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCB8fCBbXTsKICAgIAkJCWNvbnN0IG1vcnBoQ29sb3JzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yIHx8IFtdOwoKICAgIAkJCWxldCB2ZXJ0ZXhEYXRhQ291bnQgPSAwOwoKICAgIAkJCWlmICggaGFzTW9ycGhQb3NpdGlvbiA9PT0gdHJ1ZSApIHZlcnRleERhdGFDb3VudCA9IDE7CiAgICAJCQlpZiAoIGhhc01vcnBoTm9ybWFscyA9PT0gdHJ1ZSApIHZlcnRleERhdGFDb3VudCA9IDI7CiAgICAJCQlpZiAoIGhhc01vcnBoQ29sb3JzID09PSB0cnVlICkgdmVydGV4RGF0YUNvdW50ID0gMzsKCiAgICAJCQlsZXQgd2lkdGggPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uLmNvdW50ICogdmVydGV4RGF0YUNvdW50OwogICAgCQkJbGV0IGhlaWdodCA9IDE7CgogICAgCQkJaWYgKCB3aWR0aCA+IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZSApIHsKCiAgICAJCQkJaGVpZ2h0ID0gTWF0aC5jZWlsKCB3aWR0aCAvIGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZSApOwogICAgCQkJCXdpZHRoID0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCBidWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KCB3aWR0aCAqIGhlaWdodCAqIDQgKiBtb3JwaFRhcmdldHNDb3VudCApOwoKICAgIAkJCWNvbnN0IHRleHR1cmUgPSBuZXcgRGF0YUFycmF5VGV4dHVyZSggYnVmZmVyLCB3aWR0aCwgaGVpZ2h0LCBtb3JwaFRhcmdldHNDb3VudCApOwogICAgCQkJdGV4dHVyZS50eXBlID0gRmxvYXRUeXBlOwogICAgCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQkJLy8gZmlsbCBidWZmZXIKCiAgICAJCQljb25zdCB2ZXJ0ZXhEYXRhU3RyaWRlID0gdmVydGV4RGF0YUNvdW50ICogNDsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtb3JwaFRhcmdldHNDb3VudDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgbW9ycGhUYXJnZXQgPSBtb3JwaFRhcmdldHNbIGkgXTsKICAgIAkJCQljb25zdCBtb3JwaE5vcm1hbCA9IG1vcnBoTm9ybWFsc1sgaSBdOwogICAgCQkJCWNvbnN0IG1vcnBoQ29sb3IgPSBtb3JwaENvbG9yc1sgaSBdOwoKICAgIAkJCQljb25zdCBvZmZzZXQgPSB3aWR0aCAqIGhlaWdodCAqIDQgKiBpOwoKICAgIAkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBtb3JwaFRhcmdldC5jb3VudDsgaiArKyApIHsKCiAgICAJCQkJCWNvbnN0IHN0cmlkZSA9IGogKiB2ZXJ0ZXhEYXRhU3RyaWRlOwoKICAgIAkJCQkJaWYgKCBoYXNNb3JwaFBvc2l0aW9uID09PSB0cnVlICkgewoKICAgIAkJCQkJCW1vcnBoLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoVGFyZ2V0LCBqICk7CgogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAwIF0gPSBtb3JwaC54OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAxIF0gPSBtb3JwaC55OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAyIF0gPSBtb3JwaC56OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAzIF0gPSAwOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBoYXNNb3JwaE5vcm1hbHMgPT09IHRydWUgKSB7CgogICAgCQkJCQkJbW9ycGguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhOb3JtYWwsIGogKTsKCiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDQgXSA9IG1vcnBoLng7CiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDUgXSA9IG1vcnBoLnk7CiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDYgXSA9IG1vcnBoLno7CiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDcgXSA9IDA7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoIGhhc01vcnBoQ29sb3JzID09PSB0cnVlICkgewoKICAgIAkJCQkJCW1vcnBoLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQ29sb3IsIGogKTsKCiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDggXSA9IG1vcnBoLng7CiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDkgXSA9IG1vcnBoLnk7CiAgICAJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDEwIF0gPSBtb3JwaC56OwogICAgCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAxMSBdID0gKCBtb3JwaENvbG9yLml0ZW1TaXplID09PSA0ICkgPyBtb3JwaC53IDogMTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQllbnRyeSA9IHsKICAgIAkJCQljb3VudDogbW9ycGhUYXJnZXRzQ291bnQsCiAgICAJCQkJdGV4dHVyZTogdGV4dHVyZSwKICAgIAkJCQlzaXplOiBuZXcgVmVjdG9yMiggd2lkdGgsIGhlaWdodCApCiAgICAJCQl9OwoKICAgIAkJCW1vcnBoVGV4dHVyZXMuc2V0KCBnZW9tZXRyeSwgZW50cnkgKTsKCiAgICAJCQlmdW5jdGlvbiBkaXNwb3NlVGV4dHVyZSgpIHsKCiAgICAJCQkJdGV4dHVyZS5kaXNwb3NlKCk7CgogICAgCQkJCW1vcnBoVGV4dHVyZXMuZGVsZXRlKCBnZW9tZXRyeSApOwoKICAgIAkJCQlnZW9tZXRyeS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIGRpc3Bvc2VUZXh0dXJlICk7CgogICAgCQkJfQoKICAgIAkJCWdlb21ldHJ5LmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgZGlzcG9zZVRleHR1cmUgKTsKCiAgICAJCX0KCiAgICAJCS8vCiAgICAJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCA9PT0gdHJ1ZSAmJiBvYmplY3QubW9ycGhUZXh0dXJlICE9PSBudWxsICkgewoKICAgIAkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRleHR1cmUnLCBvYmplY3QubW9ycGhUZXh0dXJlLCB0ZXh0dXJlcyApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlsZXQgbW9ycGhJbmZsdWVuY2VzU3VtID0gMDsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBvYmplY3RJbmZsdWVuY2VzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJbW9ycGhJbmZsdWVuY2VzU3VtICs9IG9iamVjdEluZmx1ZW5jZXNbIGkgXTsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgbW9ycGhCYXNlSW5mbHVlbmNlID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzUmVsYXRpdmUgPyAxIDogMSAtIG1vcnBoSW5mbHVlbmNlc1N1bTsKCgogICAgCQkJcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKCBnbCwgJ21vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZScsIG1vcnBoQmFzZUluZmx1ZW5jZSApOwogICAgCQkJcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKCBnbCwgJ21vcnBoVGFyZ2V0SW5mbHVlbmNlcycsIG9iamVjdEluZmx1ZW5jZXMgKTsKCiAgICAJCX0KCiAgICAJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldHNUZXh0dXJlJywgZW50cnkudGV4dHVyZSwgdGV4dHVyZXMgKTsKICAgIAkJcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKCBnbCwgJ21vcnBoVGFyZ2V0c1RleHR1cmVTaXplJywgZW50cnkuc2l6ZSApOwoKICAgIAl9CgogICAgCXJldHVybiB7CgogICAgCQl1cGRhdGU6IHVwZGF0ZQoKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTE9iamVjdHMoIGdsLCBnZW9tZXRyaWVzLCBhdHRyaWJ1dGVzLCBpbmZvICkgewoKICAgIAlsZXQgdXBkYXRlTWFwID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJZnVuY3Rpb24gdXBkYXRlKCBvYmplY3QgKSB7CgogICAgCQljb25zdCBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKICAgIAkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CiAgICAJCWNvbnN0IGJ1ZmZlcmdlb21ldHJ5ID0gZ2VvbWV0cmllcy5nZXQoIG9iamVjdCwgZ2VvbWV0cnkgKTsKCiAgICAJCS8vIFVwZGF0ZSBvbmNlIHBlciBmcmFtZQoKICAgIAkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBidWZmZXJnZW9tZXRyeSApICE9PSBmcmFtZSApIHsKCiAgICAJCQlnZW9tZXRyaWVzLnVwZGF0ZSggYnVmZmVyZ2VvbWV0cnkgKTsKCiAgICAJCQl1cGRhdGVNYXAuc2V0KCBidWZmZXJnZW9tZXRyeSwgZnJhbWUgKTsKCiAgICAJCX0KCiAgICAJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCApIHsKCiAgICAJCQlpZiAoIG9iamVjdC5oYXNFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCW9iamVjdC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBvYmplY3QgKSAhPT0gZnJhbWUgKSB7CgogICAgCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBvYmplY3QuaW5zdGFuY2VNYXRyaXgsIGdsLkFSUkFZX0JVRkZFUiApOwoKICAgIAkJCQlpZiAoIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgewoKICAgIAkJCQkJYXR0cmlidXRlcy51cGRhdGUoIG9iamVjdC5pbnN0YW5jZUNvbG9yLCBnbC5BUlJBWV9CVUZGRVIgKTsKCiAgICAJCQkJfQoKICAgIAkJCQl1cGRhdGVNYXAuc2V0KCBvYmplY3QsIGZyYW1lICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBvYmplY3QuaXNTa2lubmVkTWVzaCApIHsKCiAgICAJCQljb25zdCBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCiAgICAJCQlpZiAoIHVwZGF0ZU1hcC5nZXQoIHNrZWxldG9uICkgIT09IGZyYW1lICkgewoKICAgIAkJCQlza2VsZXRvbi51cGRhdGUoKTsKCiAgICAJCQkJdXBkYXRlTWFwLnNldCggc2tlbGV0b24sIGZyYW1lICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGJ1ZmZlcmdlb21ldHJ5OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgogICAgCQl1cGRhdGVNYXAgPSBuZXcgV2Vha01hcCgpOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UoIGV2ZW50ICkgewoKICAgIAkJY29uc3QgaW5zdGFuY2VkTWVzaCA9IGV2ZW50LnRhcmdldDsKCiAgICAJCWluc3RhbmNlZE1lc2gucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICk7CgogICAgCQlhdHRyaWJ1dGVzLnJlbW92ZSggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZU1hdHJpeCApOwoKICAgIAkJaWYgKCBpbnN0YW5jZWRNZXNoLmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSBhdHRyaWJ1dGVzLnJlbW92ZSggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCXVwZGF0ZTogdXBkYXRlLAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCgogICAgCX07CgogICAgfQoKICAgIC8qKgogICAgICogVW5pZm9ybXMgb2YgYSBwcm9ncmFtLgogICAgICogVGhvc2UgZm9ybSBhIHRyZWUgc3RydWN0dXJlIHdpdGggYSBzcGVjaWFsIHRvcC1sZXZlbCBjb250YWluZXIgZm9yIHRoZSByb290LAogICAgICogd2hpY2ggeW91IGdldCBieSBjYWxsaW5nICduZXcgV2ViR0xVbmlmb3JtcyggZ2wsIHByb2dyYW0gKScuCiAgICAgKgogICAgICoKICAgICAqIFByb3BlcnRpZXMgb2YgaW5uZXIgbm9kZXMgaW5jbHVkaW5nIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyOgogICAgICoKICAgICAqIC5zZXEgLSBhcnJheSBvZiBuZXN0ZWQgdW5pZm9ybXMKICAgICAqIC5tYXAgLSBuZXN0ZWQgdW5pZm9ybXMgYnkgbmFtZQogICAgICoKICAgICAqCiAgICAgKiBNZXRob2RzIG9mIGFsbCBub2RlcyBleGNlcHQgdGhlIHRvcC1sZXZlbCBjb250YWluZXI6CiAgICAgKgogICAgICogLnNldFZhbHVlKCBnbCwgdmFsdWUsIFt0ZXh0dXJlc10gKQogICAgICoKICAgICAqIAkJdXBsb2FkcyBhIHVuaWZvcm0gdmFsdWUocykKICAgICAqICAJdGhlICd0ZXh0dXJlcycgcGFyYW1ldGVyIGlzIG5lZWRlZCBmb3Igc2FtcGxlciB1bmlmb3JtcwogICAgICoKICAgICAqCiAgICAgKiBTdGF0aWMgbWV0aG9kcyBvZiB0aGUgdG9wLWxldmVsIGNvbnRhaW5lciAodGV4dHVyZXMgZmFjdG9yaXphdGlvbnMpOgogICAgICoKICAgICAqIC51cGxvYWQoIGdsLCBzZXEsIHZhbHVlcywgdGV4dHVyZXMgKQogICAgICoKICAgICAqIAkJc2V0cyB1bmlmb3JtcyBpbiAnc2VxJyB0byAndmFsdWVzW2lkXS52YWx1ZScKICAgICAqCiAgICAgKiAuc2VxV2l0aFZhbHVlKCBzZXEsIHZhbHVlcyApIDogZmlsdGVyZWRTZXEKICAgICAqCiAgICAgKiAJCWZpbHRlcnMgJ3NlcScgZW50cmllcyB3aXRoIGNvcnJlc3BvbmRpbmcgZW50cnkgaW4gdmFsdWVzCiAgICAgKgogICAgICoKICAgICAqIE1ldGhvZHMgb2YgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgKHRleHR1cmVzIGZhY3Rvcml6YXRpb25zKToKICAgICAqCiAgICAgKiAuc2V0VmFsdWUoIGdsLCBuYW1lLCB2YWx1ZSwgdGV4dHVyZXMgKQogICAgICoKICAgICAqIAkJc2V0cyB1bmlmb3JtIHdpdGggIG5hbWUgJ25hbWUnIHRvICd2YWx1ZScKICAgICAqCiAgICAgKiAuc2V0T3B0aW9uYWwoIGdsLCBvYmosIHByb3AgKQogICAgICoKICAgICAqIAkJbGlrZSAuc2V0IGZvciBhbiBvcHRpb25hbCBwcm9wZXJ0eSBvZiB0aGUgb2JqZWN0CiAgICAgKgogICAgICovCgoKICAgIGNvbnN0IGVtcHR5VGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IFRleHR1cmUoKTsKCiAgICBjb25zdCBlbXB0eVNoYWRvd1RleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEZXB0aFRleHR1cmUoIDEsIDEgKTsKCiAgICBjb25zdCBlbXB0eUFycmF5VGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IERhdGFBcnJheVRleHR1cmUoKTsKICAgIGNvbnN0IGVtcHR5M2RUZXh0dXJlID0gLypAX19QVVJFX18qLyBuZXcgRGF0YTNEVGV4dHVyZSgpOwogICAgY29uc3QgZW1wdHlDdWJlVGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IEN1YmVUZXh0dXJlKCk7CgogICAgLy8gLS0tIFV0aWxpdGllcyAtLS0KCiAgICAvLyBBcnJheSBDYWNoZXMgKHByb3ZpZGUgdHlwZWQgYXJyYXlzIGZvciB0ZW1wb3JhcnkgYnkgc2l6ZSkKCiAgICBjb25zdCBhcnJheUNhY2hlRjMyID0gW107CiAgICBjb25zdCBhcnJheUNhY2hlSTMyID0gW107CgogICAgLy8gRmxvYXQzMkFycmF5IGNhY2hlcyB1c2VkIGZvciB1cGxvYWRpbmcgTWF0cml4IHVuaWZvcm1zCgogICAgY29uc3QgbWF0NGFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggMTYgKTsKICAgIGNvbnN0IG1hdDNhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDkgKTsKICAgIGNvbnN0IG1hdDJhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDQgKTsKCiAgICAvLyBGbGF0dGVuaW5nIGZvciBhcnJheXMgb2YgdmVjdG9ycyBhbmQgbWF0cmljZXMKCiAgICBmdW5jdGlvbiBmbGF0dGVuKCBhcnJheSwgbkJsb2NrcywgYmxvY2tTaXplICkgewoKICAgIAljb25zdCBmaXJzdEVsZW0gPSBhcnJheVsgMCBdOwoKICAgIAlpZiAoIGZpcnN0RWxlbSA8PSAwIHx8IGZpcnN0RWxlbSA+IDAgKSByZXR1cm4gYXJyYXk7CiAgICAJLy8gdW5vcHRpbWl6ZWQ6ICEgaXNOYU4oIGZpcnN0RWxlbSApCiAgICAJLy8gc2VlIGh0dHA6Ly9qYWNrc29uZHVuc3Rhbi5jb20vYXJ0aWNsZXMvOTgzCgogICAgCWNvbnN0IG4gPSBuQmxvY2tzICogYmxvY2tTaXplOwogICAgCWxldCByID0gYXJyYXlDYWNoZUYzMlsgbiBdOwoKICAgIAlpZiAoIHIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCXIgPSBuZXcgRmxvYXQzMkFycmF5KCBuICk7CiAgICAJCWFycmF5Q2FjaGVGMzJbIG4gXSA9IHI7CgogICAgCX0KCiAgICAJaWYgKCBuQmxvY2tzICE9PSAwICkgewoKICAgIAkJZmlyc3RFbGVtLnRvQXJyYXkoIHIsIDAgKTsKCiAgICAJCWZvciAoIGxldCBpID0gMSwgb2Zmc2V0ID0gMDsgaSAhPT0gbkJsb2NrczsgKysgaSApIHsKCiAgICAJCQlvZmZzZXQgKz0gYmxvY2tTaXplOwogICAgCQkJYXJyYXlbIGkgXS50b0FycmF5KCByLCBvZmZzZXQgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gcjsKCiAgICB9CgogICAgZnVuY3Rpb24gYXJyYXlzRXF1YWwoIGEsIGIgKSB7CgogICAgCWlmICggYS5sZW5ndGggIT09IGIubGVuZ3RoICkgcmV0dXJuIGZhbHNlOwoKICAgIAlmb3IgKCBsZXQgaSA9IDAsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQlpZiAoIGFbIGkgXSAhPT0gYlsgaSBdICkgcmV0dXJuIGZhbHNlOwoKICAgIAl9CgogICAgCXJldHVybiB0cnVlOwoKICAgIH0KCiAgICBmdW5jdGlvbiBjb3B5QXJyYXkoIGEsIGIgKSB7CgogICAgCWZvciAoIGxldCBpID0gMCwgbCA9IGIubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCWFbIGkgXSA9IGJbIGkgXTsKCiAgICAJfQoKICAgIH0KCiAgICAvLyBUZXh0dXJlIHVuaXQgYWxsb2NhdGlvbgoKICAgIGZ1bmN0aW9uIGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICkgewoKICAgIAlsZXQgciA9IGFycmF5Q2FjaGVJMzJbIG4gXTsKCiAgICAJaWYgKCByID09PSB1bmRlZmluZWQgKSB7CgogICAgCQlyID0gbmV3IEludDMyQXJyYXkoIG4gKTsKICAgIAkJYXJyYXlDYWNoZUkzMlsgbiBdID0gcjsKCiAgICAJfQoKICAgIAlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG47ICsrIGkgKSB7CgogICAgCQlyWyBpIF0gPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgogICAgCX0KCiAgICAJcmV0dXJuIHI7CgogICAgfQoKICAgIC8vIC0tLSBTZXR0ZXJzIC0tLQoKICAgIC8vIE5vdGU6IERlZmluaW5nIHRoZXNlIG1ldGhvZHMgZXh0ZXJuYWxseSwgYmVjYXVzZSB0aGV5IGNvbWUgaW4gYSBidW5jaAogICAgLy8gYW5kIHRoaXMgd2F5IHRoZWlyIG5hbWVzIG1pbmlmeS4KCiAgICAvLyBTaW5nbGUgc2NhbGFyCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMWYoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWlmICggY2FjaGVbIDAgXSA9PT0gdiApIHJldHVybjsKCiAgICAJZ2wudW5pZm9ybTFmKCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJY2FjaGVbIDAgXSA9IHY7CgogICAgfQoKICAgIC8vIFNpbmdsZSBmbG9hdCB2ZWN0b3IgKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5WZWN0b3JOKQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjJmKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55ICkgewoKICAgIAkJCWdsLnVuaWZvcm0yZiggdGhpcy5hZGRyLCB2LngsIHYueSApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm0yZnYoIHRoaXMuYWRkciwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjNmKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCiAgICAJCQlnbC51bmlmb3JtM2YoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwogICAgCQkJY2FjaGVbIDIgXSA9IHYuejsKCiAgICAJCX0KCiAgICAJfSBlbHNlIGlmICggdi5yICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYuciB8fCBjYWNoZVsgMSBdICE9PSB2LmcgfHwgY2FjaGVbIDIgXSAhPT0gdi5iICkgewoKICAgIAkJCWdsLnVuaWZvcm0zZiggdGhpcy5hZGRyLCB2LnIsIHYuZywgdi5iICk7CgogICAgCQkJY2FjaGVbIDAgXSA9IHYucjsKICAgIAkJCWNhY2hlWyAxIF0gPSB2Lmc7CiAgICAJCQljYWNoZVsgMiBdID0gdi5iOwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm0zZnYoIHRoaXMuYWRkciwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjRmKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiB8fCBjYWNoZVsgMyBdICE9PSB2LncgKSB7CgogICAgCQkJZ2wudW5pZm9ybTRmKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnosIHYudyApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwogICAgCQkJY2FjaGVbIDIgXSA9IHYuejsKICAgIAkJCWNhY2hlWyAzIF0gPSB2Lnc7CgogICAgCQl9CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKICAgIAkJZ2wudW5pZm9ybTRmdiggdGhpcy5hZGRyLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0KCiAgICB9CgogICAgLy8gU2luZ2xlIG1hdHJpeCAoZnJvbSBmbGF0IGFycmF5IG9yIFRIUkVFLk1hdHJpeE4pCgogICAgZnVuY3Rpb24gc2V0VmFsdWVNMiggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIAljb25zdCBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgogICAgCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCiAgICAJCW1hdDJhcnJheS5zZXQoIGVsZW1lbnRzICk7CgogICAgCQlnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQyYXJyYXkgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVNMyggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIAljb25zdCBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgogICAgCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCiAgICAJCW1hdDNhcnJheS5zZXQoIGVsZW1lbnRzICk7CgogICAgCQlnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQzYXJyYXkgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVNNCggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIAljb25zdCBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgogICAgCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtTWF0cml4NGZ2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0gZWxzZSB7CgogICAgCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCiAgICAJCW1hdDRhcnJheS5zZXQoIGVsZW1lbnRzICk7CgogICAgCQlnbC51bmlmb3JtTWF0cml4NGZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQ0YXJyYXkgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgogICAgCX0KCiAgICB9CgogICAgLy8gU2luZ2xlIGludGVnZXIgLyBib29sZWFuCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMWkoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWlmICggY2FjaGVbIDAgXSA9PT0gdiApIHJldHVybjsKCiAgICAJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJY2FjaGVbIDAgXSA9IHY7CgogICAgfQoKICAgIC8vIFNpbmdsZSBpbnRlZ2VyIC8gYm9vbGVhbiB2ZWN0b3IgKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5WZWN0b3JOKQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjJpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55ICkgewoKICAgIAkJCWdsLnVuaWZvcm0yaSggdGhpcy5hZGRyLCB2LngsIHYueSApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm0yaXYoIHRoaXMuYWRkciwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjNpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCiAgICAJCQlnbC51bmlmb3JtM2koIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwogICAgCQkJY2FjaGVbIDIgXSA9IHYuejsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtM2l2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVY0aSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCiAgICAJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKICAgIAkJCWdsLnVuaWZvcm00aSggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKICAgIAkJCWNhY2hlWyAyIF0gPSB2Lno7CiAgICAJCQljYWNoZVsgMyBdID0gdi53OwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm00aXYoIHRoaXMuYWRkciwgdiApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKICAgIAl9CgogICAgfQoKICAgIC8vIFNpbmdsZSB1bnNpZ25lZCBpbnRlZ2VyCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMXVpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgogICAgCWdsLnVuaWZvcm0xdWkoIHRoaXMuYWRkciwgdiApOwoKICAgIAljYWNoZVsgMCBdID0gdjsKCiAgICB9CgogICAgLy8gU2luZ2xlIHVuc2lnbmVkIGludGVnZXIgdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYydWkoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgKSB7CgogICAgCQkJZ2wudW5pZm9ybTJ1aSggdGhpcy5hZGRyLCB2LngsIHYueSApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm0ydWl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYzdWkoIGdsLCB2ICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56ICkgewoKICAgIAkJCWdsLnVuaWZvcm0zdWkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiApOwoKICAgIAkJCWNhY2hlWyAwIF0gPSB2Lng7CiAgICAJCQljYWNoZVsgMSBdID0gdi55OwogICAgCQkJY2FjaGVbIDIgXSA9IHYuejsKCiAgICAJCX0KCiAgICAJfSBlbHNlIHsKCiAgICAJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgogICAgCQlnbC51bmlmb3JtM3VpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVWNHVpKCBnbCwgdiApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiB8fCBjYWNoZVsgMyBdICE9PSB2LncgKSB7CgogICAgCQkJZ2wudW5pZm9ybTR1aSggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCiAgICAJCQljYWNoZVsgMCBdID0gdi54OwogICAgCQkJY2FjaGVbIDEgXSA9IHYueTsKICAgIAkJCWNhY2hlWyAyIF0gPSB2Lno7CiAgICAJCQljYWNoZVsgMyBdID0gdi53OwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCiAgICAJCWdsLnVuaWZvcm00dWl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCiAgICAJfQoKICAgIH0KCgogICAgLy8gU2luZ2xlIHRleHR1cmUgKDJEIC8gQ3ViZSkKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVQxKCBnbCwgdiwgdGV4dHVyZXMgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIAljb25zdCB1bml0ID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwoKICAgIAlpZiAoIGNhY2hlWyAwIF0gIT09IHVuaXQgKSB7CgogICAgCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwogICAgCQljYWNoZVsgMCBdID0gdW5pdDsKCiAgICAJfQoKICAgIAlsZXQgZW1wdHlUZXh0dXJlMkQ7CgogICAgCWlmICggdGhpcy50eXBlID09PSBnbC5TQU1QTEVSXzJEX1NIQURPVyApIHsKCiAgICAJCWVtcHR5U2hhZG93VGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gPSBMZXNzRXF1YWxDb21wYXJlOyAvLyAjMjg2NzAKICAgIAkJZW1wdHlUZXh0dXJlMkQgPSBlbXB0eVNoYWRvd1RleHR1cmU7CgogICAgCX0gZWxzZSB7CgogICAgCQllbXB0eVRleHR1cmUyRCA9IGVtcHR5VGV4dHVyZTsKCiAgICAJfQoKICAgIAl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIHYgfHwgZW1wdHlUZXh0dXJlMkQsIHVuaXQgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVUM0QxKCBnbCwgdiwgdGV4dHVyZXMgKSB7CgogICAgCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKICAgIAljb25zdCB1bml0ID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwoKICAgIAlpZiAoIGNhY2hlWyAwIF0gIT09IHVuaXQgKSB7CgogICAgCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwogICAgCQljYWNoZVsgMCBdID0gdW5pdDsKCiAgICAJfQoKICAgIAl0ZXh0dXJlcy5zZXRUZXh0dXJlM0QoIHYgfHwgZW1wdHkzZFRleHR1cmUsIHVuaXQgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVUNiggZ2wsIHYsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCiAgICAJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKICAgIAkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKICAgIAkJY2FjaGVbIDAgXSA9IHVuaXQ7CgogICAgCX0KCiAgICAJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHYgfHwgZW1wdHlDdWJlVGV4dHVyZSwgdW5pdCApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVQyREFycmF5MSggZ2wsIHYsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CiAgICAJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCiAgICAJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKICAgIAkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKICAgIAkJY2FjaGVbIDAgXSA9IHVuaXQ7CgogICAgCX0KCiAgICAJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHYgfHwgZW1wdHlBcnJheVRleHR1cmUsIHVuaXQgKTsKCiAgICB9CgogICAgLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgdGhlIHNpbmd1bGFyIGNhc2UKCiAgICBmdW5jdGlvbiBnZXRTaW5ndWxhclNldHRlciggdHlwZSApIHsKCiAgICAJc3dpdGNoICggdHlwZSApIHsKCiAgICAJCWNhc2UgMHgxNDA2OiByZXR1cm4gc2V0VmFsdWVWMWY7IC8vIEZMT0FUCiAgICAJCWNhc2UgMHg4YjUwOiByZXR1cm4gc2V0VmFsdWVWMmY7IC8vIF9WRUMyCiAgICAJCWNhc2UgMHg4YjUxOiByZXR1cm4gc2V0VmFsdWVWM2Y7IC8vIF9WRUMzCiAgICAJCWNhc2UgMHg4YjUyOiByZXR1cm4gc2V0VmFsdWVWNGY7IC8vIF9WRUM0CgogICAgCQljYXNlIDB4OGI1YTogcmV0dXJuIHNldFZhbHVlTTI7IC8vIF9NQVQyCiAgICAJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNMzsgLy8gX01BVDMKICAgIAkJY2FzZSAweDhiNWM6IHJldHVybiBzZXRWYWx1ZU00OyAvLyBfTUFUNAoKICAgIAkJY2FzZSAweDE0MDQ6IGNhc2UgMHg4YjU2OiByZXR1cm4gc2V0VmFsdWVWMWk7IC8vIElOVCwgQk9PTAogICAgCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZVYyaTsgLy8gX1ZFQzIKICAgIAkJY2FzZSAweDhiNTQ6IGNhc2UgMHg4YjU4OiByZXR1cm4gc2V0VmFsdWVWM2k7IC8vIF9WRUMzCiAgICAJCWNhc2UgMHg4YjU1OiBjYXNlIDB4OGI1OTogcmV0dXJuIHNldFZhbHVlVjRpOyAvLyBfVkVDNAoKICAgIAkJY2FzZSAweDE0MDU6IHJldHVybiBzZXRWYWx1ZVYxdWk7IC8vIFVJTlQKICAgIAkJY2FzZSAweDhkYzY6IHJldHVybiBzZXRWYWx1ZVYydWk7IC8vIF9WRUMyCiAgICAJCWNhc2UgMHg4ZGM3OiByZXR1cm4gc2V0VmFsdWVWM3VpOyAvLyBfVkVDMwogICAgCQljYXNlIDB4OGRjODogcmV0dXJuIHNldFZhbHVlVjR1aTsgLy8gX1ZFQzQKCiAgICAJCWNhc2UgMHg4YjVlOiAvLyBTQU1QTEVSXzJECiAgICAJCWNhc2UgMHg4ZDY2OiAvLyBTQU1QTEVSX0VYVEVSTkFMX09FUwogICAgCQljYXNlIDB4OGRjYTogLy8gSU5UX1NBTVBMRVJfMkQKICAgIAkJY2FzZSAweDhkZDI6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzJECiAgICAJCWNhc2UgMHg4YjYyOiAvLyBTQU1QTEVSXzJEX1NIQURPVwogICAgCQkJcmV0dXJuIHNldFZhbHVlVDE7CgogICAgCQljYXNlIDB4OGI1ZjogLy8gU0FNUExFUl8zRAogICAgCQljYXNlIDB4OGRjYjogLy8gSU5UX1NBTVBMRVJfM0QKICAgIAkJY2FzZSAweDhkZDM6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzNECiAgICAJCQlyZXR1cm4gc2V0VmFsdWVUM0QxOwoKICAgIAkJY2FzZSAweDhiNjA6IC8vIFNBTVBMRVJfQ1VCRQogICAgCQljYXNlIDB4OGRjYzogLy8gSU5UX1NBTVBMRVJfQ1VCRQogICAgCQljYXNlIDB4OGRkNDogLy8gVU5TSUdORURfSU5UX1NBTVBMRVJfQ1VCRQogICAgCQljYXNlIDB4OGRjNTogLy8gU0FNUExFUl9DVUJFX1NIQURPVwogICAgCQkJcmV0dXJuIHNldFZhbHVlVDY7CgogICAgCQljYXNlIDB4OGRjMTogLy8gU0FNUExFUl8yRF9BUlJBWQogICAgCQljYXNlIDB4OGRjZjogLy8gSU5UX1NBTVBMRVJfMkRfQVJSQVkKICAgIAkJY2FzZSAweDhkZDc6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzJEX0FSUkFZCiAgICAJCWNhc2UgMHg4ZGM0OiAvLyBTQU1QTEVSXzJEX0FSUkFZX1NIQURPVwogICAgCQkJcmV0dXJuIHNldFZhbHVlVDJEQXJyYXkxOwoKICAgIAl9CgogICAgfQoKCiAgICAvLyBBcnJheSBvZiBzY2FsYXJzCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMWZBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm0xZnYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCiAgICAvLyBBcnJheSBvZiB2ZWN0b3JzIChmcm9tIGZsYXQgYXJyYXkgb3IgYXJyYXkgb2YgVEhSRUUuVmVjdG9yTikKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYyZkFycmF5KCBnbCwgdiApIHsKCiAgICAJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgMiApOwoKICAgIAlnbC51bmlmb3JtMmZ2KCB0aGlzLmFkZHIsIGRhdGEgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVWM2ZBcnJheSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDMgKTsKCiAgICAJZ2wudW5pZm9ybTNmdiggdGhpcy5hZGRyLCBkYXRhICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjRmQXJyYXkoIGdsLCB2ICkgewoKICAgIAljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA0ICk7CgogICAgCWdsLnVuaWZvcm00ZnYoIHRoaXMuYWRkciwgZGF0YSApOwoKICAgIH0KCiAgICAvLyBBcnJheSBvZiBtYXRyaWNlcyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLk1hdHJpeE4pCgogICAgZnVuY3Rpb24gc2V0VmFsdWVNMkFycmF5KCBnbCwgdiApIHsKCiAgICAJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgNCApOwoKICAgIAlnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBkYXRhICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlTTNBcnJheSggZ2wsIHYgKSB7CgogICAgCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDkgKTsKCiAgICAJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZU00QXJyYXkoIGdsLCB2ICkgewoKICAgIAljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAxNiApOwoKICAgIAlnbC51bmlmb3JtTWF0cml4NGZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBkYXRhICk7CgogICAgfQoKICAgIC8vIEFycmF5IG9mIGludGVnZXIgLyBib29sZWFuCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMWlBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCiAgICAvLyBBcnJheSBvZiBpbnRlZ2VyIC8gYm9vbGVhbiB2ZWN0b3JzIChmcm9tIGZsYXQgYXJyYXkpCgogICAgZnVuY3Rpb24gc2V0VmFsdWVWMmlBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm0yaXYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYzaUFycmF5KCBnbCwgdiApIHsKCiAgICAJZ2wudW5pZm9ybTNpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjRpQXJyYXkoIGdsLCB2ICkgewoKICAgIAlnbC51bmlmb3JtNGl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgogICAgLy8gQXJyYXkgb2YgdW5zaWduZWQgaW50ZWdlcgoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjF1aUFycmF5KCBnbCwgdiApIHsKCiAgICAJZ2wudW5pZm9ybTF1aXYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCiAgICAvLyBBcnJheSBvZiB1bnNpZ25lZCBpbnRlZ2VyIHZlY3RvcnMgKGZyb20gZmxhdCBhcnJheSkKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVYydWlBcnJheSggZ2wsIHYgKSB7CgogICAgCWdsLnVuaWZvcm0ydWl2KCB0aGlzLmFkZHIsIHYgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVWM3VpQXJyYXkoIGdsLCB2ICkgewoKICAgIAlnbC51bmlmb3JtM3VpdiggdGhpcy5hZGRyLCB2ICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVjR1aUFycmF5KCBnbCwgdiApIHsKCiAgICAJZ2wudW5pZm9ybTR1aXYoIHRoaXMuYWRkciwgdiApOwoKICAgIH0KCgogICAgLy8gQXJyYXkgb2YgdGV4dHVyZXMgKDJEIC8gM0QgLyBDdWJlIC8gMkRBcnJheSkKCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVQxQXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAljb25zdCBuID0gdi5sZW5ndGg7CgogICAgCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCiAgICAJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCiAgICAJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgogICAgCX0KCiAgICAJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2WyBpIF0gfHwgZW1wdHlUZXh0dXJlLCB1bml0c1sgaSBdICk7CgogICAgCX0KCiAgICB9CgogICAgZnVuY3Rpb24gc2V0VmFsdWVUM0RBcnJheSggZ2wsIHYsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWNvbnN0IG4gPSB2Lmxlbmd0aDsKCiAgICAJY29uc3QgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApOwoKICAgIAlpZiAoICEgYXJyYXlzRXF1YWwoIGNhY2hlLCB1bml0cyApICkgewoKICAgIAkJZ2wudW5pZm9ybTFpdiggdGhpcy5hZGRyLCB1bml0cyApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdW5pdHMgKTsKCiAgICAJfQoKICAgIAlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG47ICsrIGkgKSB7CgogICAgCQl0ZXh0dXJlcy5zZXRUZXh0dXJlM0QoIHZbIGkgXSB8fCBlbXB0eTNkVGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHNldFZhbHVlVDZBcnJheSggZ2wsIHYsIHRleHR1cmVzICkgewoKICAgIAljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgogICAgCWNvbnN0IG4gPSB2Lmxlbmd0aDsKCiAgICAJY29uc3QgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApOwoKICAgIAlpZiAoICEgYXJyYXlzRXF1YWwoIGNhY2hlLCB1bml0cyApICkgewoKICAgIAkJZ2wudW5pZm9ybTFpdiggdGhpcy5hZGRyLCB1bml0cyApOwoKICAgIAkJY29weUFycmF5KCBjYWNoZSwgdW5pdHMgKTsKCiAgICAJfQoKICAgIAlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG47ICsrIGkgKSB7CgogICAgCQl0ZXh0dXJlcy5zZXRUZXh0dXJlQ3ViZSggdlsgaSBdIHx8IGVtcHR5Q3ViZVRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRWYWx1ZVQyREFycmF5QXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCiAgICAJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKICAgIAljb25zdCBuID0gdi5sZW5ndGg7CgogICAgCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCiAgICAJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCiAgICAJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCiAgICAJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgogICAgCX0KCiAgICAJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHZbIGkgXSB8fCBlbXB0eUFycmF5VGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKICAgIAl9CgogICAgfQoKCiAgICAvLyBIZWxwZXIgdG8gcGljayB0aGUgcmlnaHQgc2V0dGVyIGZvciBhIHB1cmUgKGJvdHRvbS1sZXZlbCkgYXJyYXkKCiAgICBmdW5jdGlvbiBnZXRQdXJlQXJyYXlTZXR0ZXIoIHR5cGUgKSB7CgogICAgCXN3aXRjaCAoIHR5cGUgKSB7CgogICAgCQljYXNlIDB4MTQwNjogcmV0dXJuIHNldFZhbHVlVjFmQXJyYXk7IC8vIEZMT0FUCiAgICAJCWNhc2UgMHg4YjUwOiByZXR1cm4gc2V0VmFsdWVWMmZBcnJheTsgLy8gX1ZFQzIKICAgIAkJY2FzZSAweDhiNTE6IHJldHVybiBzZXRWYWx1ZVYzZkFycmF5OyAvLyBfVkVDMwogICAgCQljYXNlIDB4OGI1MjogcmV0dXJuIHNldFZhbHVlVjRmQXJyYXk7IC8vIF9WRUM0CgogICAgCQljYXNlIDB4OGI1YTogcmV0dXJuIHNldFZhbHVlTTJBcnJheTsgLy8gX01BVDIKICAgIAkJY2FzZSAweDhiNWI6IHJldHVybiBzZXRWYWx1ZU0zQXJyYXk7IC8vIF9NQVQzCiAgICAJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNEFycmF5OyAvLyBfTUFUNAoKICAgIAkJY2FzZSAweDE0MDQ6IGNhc2UgMHg4YjU2OiByZXR1cm4gc2V0VmFsdWVWMWlBcnJheTsgLy8gSU5ULCBCT09MCiAgICAJCWNhc2UgMHg4YjUzOiBjYXNlIDB4OGI1NzogcmV0dXJuIHNldFZhbHVlVjJpQXJyYXk7IC8vIF9WRUMyCiAgICAJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlVjNpQXJyYXk7IC8vIF9WRUMzCiAgICAJCWNhc2UgMHg4YjU1OiBjYXNlIDB4OGI1OTogcmV0dXJuIHNldFZhbHVlVjRpQXJyYXk7IC8vIF9WRUM0CgogICAgCQljYXNlIDB4MTQwNTogcmV0dXJuIHNldFZhbHVlVjF1aUFycmF5OyAvLyBVSU5UCiAgICAJCWNhc2UgMHg4ZGM2OiByZXR1cm4gc2V0VmFsdWVWMnVpQXJyYXk7IC8vIF9WRUMyCiAgICAJCWNhc2UgMHg4ZGM3OiByZXR1cm4gc2V0VmFsdWVWM3VpQXJyYXk7IC8vIF9WRUMzCiAgICAJCWNhc2UgMHg4ZGM4OiByZXR1cm4gc2V0VmFsdWVWNHVpQXJyYXk7IC8vIF9WRUM0CgogICAgCQljYXNlIDB4OGI1ZTogLy8gU0FNUExFUl8yRAogICAgCQljYXNlIDB4OGQ2NjogLy8gU0FNUExFUl9FWFRFUk5BTF9PRVMKICAgIAkJY2FzZSAweDhkY2E6IC8vIElOVF9TQU1QTEVSXzJECiAgICAJCWNhc2UgMHg4ZGQyOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRAogICAgCQljYXNlIDB4OGI2MjogLy8gU0FNUExFUl8yRF9TSEFET1cKICAgIAkJCXJldHVybiBzZXRWYWx1ZVQxQXJyYXk7CgogICAgCQljYXNlIDB4OGI1ZjogLy8gU0FNUExFUl8zRAogICAgCQljYXNlIDB4OGRjYjogLy8gSU5UX1NBTVBMRVJfM0QKICAgIAkJY2FzZSAweDhkZDM6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzNECiAgICAJCQlyZXR1cm4gc2V0VmFsdWVUM0RBcnJheTsKCiAgICAJCWNhc2UgMHg4YjYwOiAvLyBTQU1QTEVSX0NVQkUKICAgIAkJY2FzZSAweDhkY2M6IC8vIElOVF9TQU1QTEVSX0NVQkUKICAgIAkJY2FzZSAweDhkZDQ6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSX0NVQkUKICAgIAkJY2FzZSAweDhkYzU6IC8vIFNBTVBMRVJfQ1VCRV9TSEFET1cKICAgIAkJCXJldHVybiBzZXRWYWx1ZVQ2QXJyYXk7CgogICAgCQljYXNlIDB4OGRjMTogLy8gU0FNUExFUl8yRF9BUlJBWQogICAgCQljYXNlIDB4OGRjZjogLy8gSU5UX1NBTVBMRVJfMkRfQVJSQVkKICAgIAkJY2FzZSAweDhkZDc6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzJEX0FSUkFZCiAgICAJCWNhc2UgMHg4ZGM0OiAvLyBTQU1QTEVSXzJEX0FSUkFZX1NIQURPVwogICAgCQkJcmV0dXJuIHNldFZhbHVlVDJEQXJyYXlBcnJheTsKCiAgICAJfQoKICAgIH0KCiAgICAvLyAtLS0gVW5pZm9ybSBDbGFzc2VzIC0tLQoKICAgIGNsYXNzIFNpbmdsZVVuaWZvcm0gewoKICAgIAljb25zdHJ1Y3RvciggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSB7CgogICAgCQl0aGlzLmlkID0gaWQ7CiAgICAJCXRoaXMuYWRkciA9IGFkZHI7CiAgICAJCXRoaXMuY2FjaGUgPSBbXTsKICAgIAkJdGhpcy50eXBlID0gYWN0aXZlSW5mby50eXBlOwogICAgCQl0aGlzLnNldFZhbHVlID0gZ2V0U2luZ3VsYXJTZXR0ZXIoIGFjdGl2ZUluZm8udHlwZSApOwoKICAgIAkJLy8gdGhpcy5wYXRoID0gYWN0aXZlSW5mby5uYW1lOyAvLyBERUJVRwoKICAgIAl9CgogICAgfQoKICAgIGNsYXNzIFB1cmVBcnJheVVuaWZvcm0gewoKICAgIAljb25zdHJ1Y3RvciggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSB7CgogICAgCQl0aGlzLmlkID0gaWQ7CiAgICAJCXRoaXMuYWRkciA9IGFkZHI7CiAgICAJCXRoaXMuY2FjaGUgPSBbXTsKICAgIAkJdGhpcy50eXBlID0gYWN0aXZlSW5mby50eXBlOwogICAgCQl0aGlzLnNpemUgPSBhY3RpdmVJbmZvLnNpemU7CiAgICAJCXRoaXMuc2V0VmFsdWUgPSBnZXRQdXJlQXJyYXlTZXR0ZXIoIGFjdGl2ZUluZm8udHlwZSApOwoKICAgIAkJLy8gdGhpcy5wYXRoID0gYWN0aXZlSW5mby5uYW1lOyAvLyBERUJVRwoKICAgIAl9CgogICAgfQoKICAgIGNsYXNzIFN0cnVjdHVyZWRVbmlmb3JtIHsKCiAgICAJY29uc3RydWN0b3IoIGlkICkgewoKICAgIAkJdGhpcy5pZCA9IGlkOwoKICAgIAkJdGhpcy5zZXEgPSBbXTsKICAgIAkJdGhpcy5tYXAgPSB7fTsKCiAgICAJfQoKICAgIAlzZXRWYWx1ZSggZ2wsIHZhbHVlLCB0ZXh0dXJlcyApIHsKCiAgICAJCWNvbnN0IHNlcSA9IHRoaXMuc2VxOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCiAgICAJCQljb25zdCB1ID0gc2VxWyBpIF07CiAgICAJCQl1LnNldFZhbHVlKCBnbCwgdmFsdWVbIHUuaWQgXSwgdGV4dHVyZXMgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICAvLyAtLS0gVG9wLWxldmVsIC0tLQoKICAgIC8vIFBhcnNlciAtIGJ1aWxkcyB1cCB0aGUgcHJvcGVydHkgdHJlZSBmcm9tIHRoZSBwYXRoIHN0cmluZ3MKCiAgICBjb25zdCBSZVBhdGhQYXJ0ID0gLyhcdyspKFxdKT8oXFt8XC4pPy9nOwoKICAgIC8vIGV4dHJhY3RzCiAgICAvLyAJLSB0aGUgaWRlbnRpZmllciAobWVtYmVyIG5hbWUgb3IgYXJyYXkgaW5kZXgpCiAgICAvLyAgLSBmb2xsb3dlZCBieSBhbiBvcHRpb25hbCByaWdodCBicmFja2V0IChmb3VuZCB3aGVuIGFycmF5IGluZGV4KQogICAgLy8gIC0gZm9sbG93ZWQgYnkgYW4gb3B0aW9uYWwgbGVmdCBicmFja2V0IG9yIGRvdCAodHlwZSBvZiBzdWJzY3JpcHQpCiAgICAvLwogICAgLy8gTm90ZTogVGhlc2UgcG9ydGlvbnMgY2FuIGJlIHJlYWQgaW4gYSBub24tb3ZlcmxhcHBpbmcgZmFzaGlvbiBhbmQKICAgIC8vIGFsbG93IHN0cmFpZ2h0Zm9yd2FyZCBwYXJzaW5nIG9mIHRoZSBoaWVyYXJjaHkgdGhhdCBXZWJHTCBlbmNvZGVzCiAgICAvLyBpbiB0aGUgdW5pZm9ybSBuYW1lcy4KCiAgICBmdW5jdGlvbiBhZGRVbmlmb3JtKCBjb250YWluZXIsIHVuaWZvcm1PYmplY3QgKSB7CgogICAgCWNvbnRhaW5lci5zZXEucHVzaCggdW5pZm9ybU9iamVjdCApOwogICAgCWNvbnRhaW5lci5tYXBbIHVuaWZvcm1PYmplY3QuaWQgXSA9IHVuaWZvcm1PYmplY3Q7CgogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlVW5pZm9ybSggYWN0aXZlSW5mbywgYWRkciwgY29udGFpbmVyICkgewoKICAgIAljb25zdCBwYXRoID0gYWN0aXZlSW5mby5uYW1lLAogICAgCQlwYXRoTGVuZ3RoID0gcGF0aC5sZW5ndGg7CgogICAgCS8vIHJlc2V0IFJlZ0V4cCBvYmplY3QsIGJlY2F1c2Ugb2YgdGhlIGVhcmx5IGV4aXQgb2YgYSBwcmV2aW91cyBydW4KICAgIAlSZVBhdGhQYXJ0Lmxhc3RJbmRleCA9IDA7CgogICAgCXdoaWxlICggdHJ1ZSApIHsKCiAgICAJCWNvbnN0IG1hdGNoID0gUmVQYXRoUGFydC5leGVjKCBwYXRoICksCiAgICAJCQltYXRjaEVuZCA9IFJlUGF0aFBhcnQubGFzdEluZGV4OwoKICAgIAkJbGV0IGlkID0gbWF0Y2hbIDEgXTsKICAgIAkJY29uc3QgaWRJc0luZGV4ID0gbWF0Y2hbIDIgXSA9PT0gJ10nLAogICAgCQkJc3Vic2NyaXB0ID0gbWF0Y2hbIDMgXTsKCiAgICAJCWlmICggaWRJc0luZGV4ICkgaWQgPSBpZCB8IDA7IC8vIGNvbnZlcnQgdG8gaW50ZWdlcgoKICAgIAkJaWYgKCBzdWJzY3JpcHQgPT09IHVuZGVmaW5lZCB8fCBzdWJzY3JpcHQgPT09ICdbJyAmJiBtYXRjaEVuZCArIDIgPT09IHBhdGhMZW5ndGggKSB7CgogICAgCQkJLy8gYmFyZSBuYW1lIG9yICJwdXJlIiBib3R0b20tbGV2ZWwgYXJyYXkgIlswXSIgc3VmZml4CgogICAgCQkJYWRkVW5pZm9ybSggY29udGFpbmVyLCBzdWJzY3JpcHQgPT09IHVuZGVmaW5lZCA/CiAgICAJCQkJbmV3IFNpbmdsZVVuaWZvcm0oIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgOgogICAgCQkJCW5ldyBQdXJlQXJyYXlVbmlmb3JtKCBpZCwgYWN0aXZlSW5mbywgYWRkciApICk7CgogICAgCQkJYnJlYWs7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCS8vIHN0ZXAgaW50byBpbm5lciBub2RlIC8gY3JlYXRlIGl0IGluIGNhc2UgaXQgZG9lc24ndCBleGlzdAoKICAgIAkJCWNvbnN0IG1hcCA9IGNvbnRhaW5lci5tYXA7CiAgICAJCQlsZXQgbmV4dCA9IG1hcFsgaWQgXTsKCiAgICAJCQlpZiAoIG5leHQgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJbmV4dCA9IG5ldyBTdHJ1Y3R1cmVkVW5pZm9ybSggaWQgKTsKICAgIAkJCQlhZGRVbmlmb3JtKCBjb250YWluZXIsIG5leHQgKTsKCiAgICAJCQl9CgogICAgCQkJY29udGFpbmVyID0gbmV4dDsKCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICAvLyBSb290IENvbnRhaW5lcgoKICAgIGNsYXNzIFdlYkdMVW5pZm9ybXMgewoKICAgIAljb25zdHJ1Y3RvciggZ2wsIHByb2dyYW0gKSB7CgogICAgCQl0aGlzLnNlcSA9IFtdOwogICAgCQl0aGlzLm1hcCA9IHt9OwoKICAgIAkJY29uc3QgbiA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIoIHByb2dyYW0sIGdsLkFDVElWRV9VTklGT1JNUyApOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgKysgaSApIHsKCiAgICAJCQljb25zdCBpbmZvID0gZ2wuZ2V0QWN0aXZlVW5pZm9ybSggcHJvZ3JhbSwgaSApLAogICAgCQkJCWFkZHIgPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24oIHByb2dyYW0sIGluZm8ubmFtZSApOwoKICAgIAkJCXBhcnNlVW5pZm9ybSggaW5mbywgYWRkciwgdGhpcyApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXNldFZhbHVlKCBnbCwgbmFtZSwgdmFsdWUsIHRleHR1cmVzICkgewoKICAgIAkJY29uc3QgdSA9IHRoaXMubWFwWyBuYW1lIF07CgogICAgCQlpZiAoIHUgIT09IHVuZGVmaW5lZCApIHUuc2V0VmFsdWUoIGdsLCB2YWx1ZSwgdGV4dHVyZXMgKTsKCiAgICAJfQoKICAgIAlzZXRPcHRpb25hbCggZ2wsIG9iamVjdCwgbmFtZSApIHsKCiAgICAJCWNvbnN0IHYgPSBvYmplY3RbIG5hbWUgXTsKCiAgICAJCWlmICggdiAhPT0gdW5kZWZpbmVkICkgdGhpcy5zZXRWYWx1ZSggZ2wsIG5hbWUsIHYgKTsKCiAgICAJfQoKICAgIAlzdGF0aWMgdXBsb2FkKCBnbCwgc2VxLCB2YWx1ZXMsIHRleHR1cmVzICkgewoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCiAgICAJCQljb25zdCB1ID0gc2VxWyBpIF0sCiAgICAJCQkJdiA9IHZhbHVlc1sgdS5pZCBdOwoKICAgIAkJCWlmICggdi5uZWVkc1VwZGF0ZSAhPT0gZmFsc2UgKSB7CgogICAgCQkJCS8vIG5vdGU6IGFsd2F5cyB1cGRhdGluZyB3aGVuIC5uZWVkc1VwZGF0ZSBpcyB1bmRlZmluZWQKICAgIAkJCQl1LnNldFZhbHVlKCBnbCwgdi52YWx1ZSwgdGV4dHVyZXMgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCX0KCiAgICAJc3RhdGljIHNlcVdpdGhWYWx1ZSggc2VxLCB2YWx1ZXMgKSB7CgogICAgCQljb25zdCByID0gW107CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBzZXEubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKICAgIAkJCWNvbnN0IHUgPSBzZXFbIGkgXTsKICAgIAkJCWlmICggdS5pZCBpbiB2YWx1ZXMgKSByLnB1c2goIHUgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiByOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMU2hhZGVyKCBnbCwgdHlwZSwgc3RyaW5nICkgewoKICAgIAljb25zdCBzaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoIHR5cGUgKTsKCiAgICAJZ2wuc2hhZGVyU291cmNlKCBzaGFkZXIsIHN0cmluZyApOwogICAgCWdsLmNvbXBpbGVTaGFkZXIoIHNoYWRlciApOwoKICAgIAlyZXR1cm4gc2hhZGVyOwoKICAgIH0KCiAgICAvLyBGcm9tIGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L3dlYmdsL2V4dGVuc2lvbnMvS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlLwogICAgY29uc3QgQ09NUExFVElPTl9TVEFUVVNfS0hSID0gMHg5MUIxOwoKICAgIGxldCBwcm9ncmFtSWRDb3VudCA9IDA7CgogICAgZnVuY3Rpb24gaGFuZGxlU291cmNlKCBzdHJpbmcsIGVycm9yTGluZSApIHsKCiAgICAJY29uc3QgbGluZXMgPSBzdHJpbmcuc3BsaXQoICdcbicgKTsKICAgIAljb25zdCBsaW5lczIgPSBbXTsKCiAgICAJY29uc3QgZnJvbSA9IE1hdGgubWF4KCBlcnJvckxpbmUgLSA2LCAwICk7CiAgICAJY29uc3QgdG8gPSBNYXRoLm1pbiggZXJyb3JMaW5lICsgNiwgbGluZXMubGVuZ3RoICk7CgogICAgCWZvciAoIGxldCBpID0gZnJvbTsgaSA8IHRvOyBpICsrICkgewoKICAgIAkJY29uc3QgbGluZSA9IGkgKyAxOwogICAgCQlsaW5lczIucHVzaCggYCR7bGluZSA9PT0gZXJyb3JMaW5lID8gJz4nIDogJyAnfSAke2xpbmV9OiAke2xpbmVzWyBpIF19YCApOwoKICAgIAl9CgogICAgCXJldHVybiBsaW5lczIuam9pbiggJ1xuJyApOwoKICAgIH0KCiAgICBjb25zdCBfbTAgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgogICAgZnVuY3Rpb24gZ2V0RW5jb2RpbmdDb21wb25lbnRzKCBjb2xvclNwYWNlICkgewoKICAgIAlDb2xvck1hbmFnZW1lbnQuX2dldE1hdHJpeCggX20wLCBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UsIGNvbG9yU3BhY2UgKTsKCiAgICAJY29uc3QgZW5jb2RpbmdNYXRyaXggPSBgbWF0MyggJHsgX20wLmVsZW1lbnRzLm1hcCggKCB2ICkgPT4gdi50b0ZpeGVkKCA0ICkgKSB9IClgOwoKICAgIAlzd2l0Y2ggKCBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGNvbG9yU3BhY2UgKSApIHsKCiAgICAJCWNhc2UgTGluZWFyVHJhbnNmZXI6CiAgICAJCQlyZXR1cm4gWyBlbmNvZGluZ01hdHJpeCwgJ0xpbmVhclRyYW5zZmVyT0VURicgXTsKCiAgICAJCWNhc2UgU1JHQlRyYW5zZmVyOgogICAgCQkJcmV0dXJuIFsgZW5jb2RpbmdNYXRyaXgsICdzUkdCVHJhbnNmZXJPRVRGJyBdOwoKICAgIAkJZGVmYXVsdDoKICAgIAkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogVW5zdXBwb3J0ZWQgY29sb3Igc3BhY2U6ICcsIGNvbG9yU3BhY2UgKTsKICAgIAkJCXJldHVybiBbIGVuY29kaW5nTWF0cml4LCAnTGluZWFyVHJhbnNmZXJPRVRGJyBdOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIGdldFNoYWRlckVycm9ycyggZ2wsIHNoYWRlciwgdHlwZSApIHsKCiAgICAJY29uc3Qgc3RhdHVzID0gZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKCBzaGFkZXIsIGdsLkNPTVBJTEVfU1RBVFVTICk7CiAgICAJY29uc3QgZXJyb3JzID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggc2hhZGVyICkudHJpbSgpOwoKICAgIAlpZiAoIHN0YXR1cyAmJiBlcnJvcnMgPT09ICcnICkgcmV0dXJuICcnOwoKICAgIAljb25zdCBlcnJvck1hdGNoZXMgPSAvRVJST1I6IDA6KFxkKykvLmV4ZWMoIGVycm9ycyApOwogICAgCWlmICggZXJyb3JNYXRjaGVzICkgewoKICAgIAkJLy8gLS1lbmFibGUtcHJpdmlsZWdlZC13ZWJnbC1leHRlbnNpb24KICAgIAkJLy8gY29uc29sZS5sb2coICcqKicgKyB0eXBlICsgJyoqJywgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfZGVidWdfc2hhZGVycycgKS5nZXRUcmFuc2xhdGVkU2hhZGVyU291cmNlKCBzaGFkZXIgKSApOwoKICAgIAkJY29uc3QgZXJyb3JMaW5lID0gcGFyc2VJbnQoIGVycm9yTWF0Y2hlc1sgMSBdICk7CiAgICAJCXJldHVybiB0eXBlLnRvVXBwZXJDYXNlKCkgKyAnXG5cbicgKyBlcnJvcnMgKyAnXG5cbicgKyBoYW5kbGVTb3VyY2UoIGdsLmdldFNoYWRlclNvdXJjZSggc2hhZGVyICksIGVycm9yTGluZSApOwoKICAgIAl9IGVsc2UgewoKICAgIAkJcmV0dXJuIGVycm9yczsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRUZXhlbEVuY29kaW5nRnVuY3Rpb24oIGZ1bmN0aW9uTmFtZSwgY29sb3JTcGFjZSApIHsKCiAgICAJY29uc3QgY29tcG9uZW50cyA9IGdldEVuY29kaW5nQ29tcG9uZW50cyggY29sb3JTcGFjZSApOwoKICAgIAlyZXR1cm4gWwoKICAgIAkJYHZlYzQgJHtmdW5jdGlvbk5hbWV9KCB2ZWM0IHZhbHVlICkge2AsCgogICAgCQlgCXJldHVybiAke2NvbXBvbmVudHNbIDEgXX0oIHZlYzQoIHZhbHVlLnJnYiAqICR7Y29tcG9uZW50c1sgMCBdfSwgdmFsdWUuYSApICk7YCwKCiAgICAJCSd9JywKCiAgICAJXS5qb2luKCAnXG4nICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdldFRvbmVNYXBwaW5nRnVuY3Rpb24oIGZ1bmN0aW9uTmFtZSwgdG9uZU1hcHBpbmcgKSB7CgogICAgCWxldCB0b25lTWFwcGluZ05hbWU7CgogICAgCXN3aXRjaCAoIHRvbmVNYXBwaW5nICkgewoKICAgIAkJY2FzZSBMaW5lYXJUb25lTWFwcGluZzoKICAgIAkJCXRvbmVNYXBwaW5nTmFtZSA9ICdMaW5lYXInOwogICAgCQkJYnJlYWs7CgogICAgCQljYXNlIFJlaW5oYXJkVG9uZU1hcHBpbmc6CiAgICAJCQl0b25lTWFwcGluZ05hbWUgPSAnUmVpbmhhcmQnOwogICAgCQkJYnJlYWs7CgogICAgCQljYXNlIENpbmVvblRvbmVNYXBwaW5nOgogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0NpbmVvbic7CiAgICAJCQlicmVhazsKCiAgICAJCWNhc2UgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nOgogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0FDRVNGaWxtaWMnOwogICAgCQkJYnJlYWs7CgogICAgCQljYXNlIEFnWFRvbmVNYXBwaW5nOgogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0FnWCc7CiAgICAJCQlicmVhazsKCiAgICAJCWNhc2UgTmV1dHJhbFRvbmVNYXBwaW5nOgogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ05ldXRyYWwnOwogICAgCQkJYnJlYWs7CgogICAgCQljYXNlIEN1c3RvbVRvbmVNYXBwaW5nOgogICAgCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0N1c3RvbSc7CiAgICAJCQlicmVhazsKCiAgICAJCWRlZmF1bHQ6CiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IFVuc3VwcG9ydGVkIHRvbmVNYXBwaW5nOicsIHRvbmVNYXBwaW5nICk7CiAgICAJCQl0b25lTWFwcGluZ05hbWUgPSAnTGluZWFyJzsKCiAgICAJfQoKICAgIAlyZXR1cm4gJ3ZlYzMgJyArIGZ1bmN0aW9uTmFtZSArICcoIHZlYzMgY29sb3IgKSB7IHJldHVybiAnICsgdG9uZU1hcHBpbmdOYW1lICsgJ1RvbmVNYXBwaW5nKCBjb2xvciApOyB9JzsKCiAgICB9CgogICAgY29uc3QgX3YwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKICAgIGZ1bmN0aW9uIGdldEx1bWluYW5jZUZ1bmN0aW9uKCkgewoKICAgIAlDb2xvck1hbmFnZW1lbnQuZ2V0THVtaW5hbmNlQ29lZmZpY2llbnRzKCBfdjAgKTsKCiAgICAJY29uc3QgciA9IF92MC54LnRvRml4ZWQoIDQgKTsKICAgIAljb25zdCBnID0gX3YwLnkudG9GaXhlZCggNCApOwogICAgCWNvbnN0IGIgPSBfdjAuei50b0ZpeGVkKCA0ICk7CgogICAgCXJldHVybiBbCgogICAgCQknZmxvYXQgbHVtaW5hbmNlKCBjb25zdCBpbiB2ZWMzIHJnYiApIHsnLAoKICAgIAkJYAljb25zdCB2ZWMzIHdlaWdodHMgPSB2ZWMzKCAkeyByIH0sICR7IGcgfSwgJHsgYiB9ICk7YCwKCiAgICAJCScJcmV0dXJuIGRvdCggd2VpZ2h0cywgcmdiICk7JywKCiAgICAJCSd9JwoKICAgIAldLmpvaW4oICdcbicgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVWZXJ0ZXhFeHRlbnNpb25zKCBwYXJhbWV0ZXJzICkgewoKICAgIAljb25zdCBjaHVua3MgPSBbCiAgICAJCXBhcmFtZXRlcnMuZXh0ZW5zaW9uQ2xpcEN1bGxEaXN0YW5jZSA/ICcjZXh0ZW5zaW9uIEdMX0FOR0xFX2NsaXBfY3VsbF9kaXN0YW5jZSA6IHJlcXVpcmUnIDogJycsCiAgICAJCXBhcmFtZXRlcnMuZXh0ZW5zaW9uTXVsdGlEcmF3ID8gJyNleHRlbnNpb24gR0xfQU5HTEVfbXVsdGlfZHJhdyA6IHJlcXVpcmUnIDogJycsCiAgICAJXTsKCiAgICAJcmV0dXJuIGNodW5rcy5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVEZWZpbmVzKCBkZWZpbmVzICkgewoKICAgIAljb25zdCBjaHVua3MgPSBbXTsKCiAgICAJZm9yICggY29uc3QgbmFtZSBpbiBkZWZpbmVzICkgewoKICAgIAkJY29uc3QgdmFsdWUgPSBkZWZpbmVzWyBuYW1lIF07CgogICAgCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIGNvbnRpbnVlOwoKICAgIAkJY2h1bmtzLnB1c2goICcjZGVmaW5lICcgKyBuYW1lICsgJyAnICsgdmFsdWUgKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gY2h1bmtzLmpvaW4oICdcbicgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoIGdsLCBwcm9ncmFtICkgewoKICAgIAljb25zdCBhdHRyaWJ1dGVzID0ge307CgogICAgCWNvbnN0IG4gPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5BQ1RJVkVfQVRUUklCVVRFUyApOwoKICAgIAlmb3IgKCBsZXQgaSA9IDA7IGkgPCBuOyBpICsrICkgewoKICAgIAkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZUF0dHJpYiggcHJvZ3JhbSwgaSApOwogICAgCQljb25zdCBuYW1lID0gaW5mby5uYW1lOwoKICAgIAkJbGV0IGxvY2F0aW9uU2l6ZSA9IDE7CiAgICAJCWlmICggaW5mby50eXBlID09PSBnbC5GTE9BVF9NQVQyICkgbG9jYXRpb25TaXplID0gMjsKICAgIAkJaWYgKCBpbmZvLnR5cGUgPT09IGdsLkZMT0FUX01BVDMgKSBsb2NhdGlvblNpemUgPSAzOwogICAgCQlpZiAoIGluZm8udHlwZSA9PT0gZ2wuRkxPQVRfTUFUNCApIGxvY2F0aW9uU2l6ZSA9IDQ7CgogICAgCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUHJvZ3JhbTogQUNUSVZFIFZFUlRFWCBBVFRSSUJVVEU6JywgbmFtZSwgaSApOwoKICAgIAkJYXR0cmlidXRlc1sgbmFtZSBdID0gewogICAgCQkJdHlwZTogaW5mby50eXBlLAogICAgCQkJbG9jYXRpb246IGdsLmdldEF0dHJpYkxvY2F0aW9uKCBwcm9ncmFtLCBuYW1lICksCiAgICAJCQlsb2NhdGlvblNpemU6IGxvY2F0aW9uU2l6ZQogICAgCQl9OwoKICAgIAl9CgogICAgCXJldHVybiBhdHRyaWJ1dGVzOwoKICAgIH0KCiAgICBmdW5jdGlvbiBmaWx0ZXJFbXB0eUxpbmUoIHN0cmluZyApIHsKCiAgICAJcmV0dXJuIHN0cmluZyAhPT0gJyc7CgogICAgfQoKICAgIGZ1bmN0aW9uIHJlcGxhY2VMaWdodE51bXMoIHN0cmluZywgcGFyYW1ldGVycyApIHsKCiAgICAJY29uc3QgbnVtU3BvdExpZ2h0Q29vcmRzID0gcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzICsgcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzIC0gcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHM7CgogICAgCXJldHVybiBzdHJpbmcKICAgIAkJLnJlcGxhY2UoIC9OVU1fRElSX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0cyApCiAgICAJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0cyApCiAgICAJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfTUFQUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodE1hcHMgKQogICAgCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX0NPT1JEUy9nLCBudW1TcG90TGlnaHRDb29yZHMgKQogICAgCQkucmVwbGFjZSggL05VTV9SRUNUX0FSRUFfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUmVjdEFyZWFMaWdodHMgKQogICAgCQkucmVwbGFjZSggL05VTV9QT0lOVF9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0cyApCiAgICAJCS5yZXBsYWNlKCAvTlVNX0hFTUlfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtSGVtaUxpZ2h0cyApCiAgICAJCS5yZXBsYWNlKCAvTlVNX0RJUl9MSUdIVF9TSEFET1dTL2csIHBhcmFtZXRlcnMubnVtRGlyTGlnaHRTaGFkb3dzICkKICAgIAkJLnJlcGxhY2UoIC9OVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcyApCiAgICAJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKQogICAgCQkucmVwbGFjZSggL05VTV9QT0lOVF9MSUdIVF9TSEFET1dTL2csIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodFNoYWRvd3MgKTsKCiAgICB9CgogICAgZnVuY3Rpb24gcmVwbGFjZUNsaXBwaW5nUGxhbmVOdW1zKCBzdHJpbmcsIHBhcmFtZXRlcnMgKSB7CgogICAgCXJldHVybiBzdHJpbmcKICAgIAkJLnJlcGxhY2UoIC9OVU1fQ0xJUFBJTkdfUExBTkVTL2csIHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXMgKQogICAgCQkucmVwbGFjZSggL1VOSU9OX0NMSVBQSU5HX1BMQU5FUy9nLCAoIHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXMgLSBwYXJhbWV0ZXJzLm51bUNsaXBJbnRlcnNlY3Rpb24gKSApOwoKICAgIH0KCiAgICAvLyBSZXNvbHZlIEluY2x1ZGVzCgogICAgY29uc3QgaW5jbHVkZVBhdHRlcm4gPSAvXlsgXHRdKiNpbmNsdWRlICs8KFtcd1xkLi9dKyk+L2dtOwoKICAgIGZ1bmN0aW9uIHJlc29sdmVJbmNsdWRlcyggc3RyaW5nICkgewoKICAgIAlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIGluY2x1ZGVQYXR0ZXJuLCBpbmNsdWRlUmVwbGFjZXIgKTsKCiAgICB9CgogICAgY29uc3Qgc2hhZGVyQ2h1bmtNYXAgPSBuZXcgTWFwKCk7CgogICAgZnVuY3Rpb24gaW5jbHVkZVJlcGxhY2VyKCBtYXRjaCwgaW5jbHVkZSApIHsKCiAgICAJbGV0IHN0cmluZyA9IFNoYWRlckNodW5rWyBpbmNsdWRlIF07CgogICAgCWlmICggc3RyaW5nID09PSB1bmRlZmluZWQgKSB7CgogICAgCQljb25zdCBuZXdJbmNsdWRlID0gc2hhZGVyQ2h1bmtNYXAuZ2V0KCBpbmNsdWRlICk7CgogICAgCQlpZiAoIG5ld0luY2x1ZGUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlzdHJpbmcgPSBTaGFkZXJDaHVua1sgbmV3SW5jbHVkZSBdOwogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogU2hhZGVyIGNodW5rICIlcyIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlICIlcyIgaW5zdGVhZC4nLCBpbmNsdWRlLCBuZXdJbmNsdWRlICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXRocm93IG5ldyBFcnJvciggJ0NhbiBub3QgcmVzb2x2ZSAjaW5jbHVkZSA8JyArIGluY2x1ZGUgKyAnPicgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gcmVzb2x2ZUluY2x1ZGVzKCBzdHJpbmcgKTsKCiAgICB9CgogICAgLy8gVW5yb2xsIExvb3BzCgogICAgY29uc3QgdW5yb2xsTG9vcFBhdHRlcm4gPSAvI3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxzK2ZvclxzKlwoXHMqaW50XHMraVxzKj1ccyooXGQrKVxzKjtccyppXHMqPFxzKihcZCspXHMqO1xzKmlccypcK1wrXHMqXClccyp7KFtcc1xTXSs/KX1ccysjcHJhZ21hIHVucm9sbF9sb29wX2VuZC9nOwoKICAgIGZ1bmN0aW9uIHVucm9sbExvb3BzKCBzdHJpbmcgKSB7CgogICAgCXJldHVybiBzdHJpbmcucmVwbGFjZSggdW5yb2xsTG9vcFBhdHRlcm4sIGxvb3BSZXBsYWNlciApOwoKICAgIH0KCiAgICBmdW5jdGlvbiBsb29wUmVwbGFjZXIoIG1hdGNoLCBzdGFydCwgZW5kLCBzbmlwcGV0ICkgewoKICAgIAlsZXQgc3RyaW5nID0gJyc7CgogICAgCWZvciAoIGxldCBpID0gcGFyc2VJbnQoIHN0YXJ0ICk7IGkgPCBwYXJzZUludCggZW5kICk7IGkgKysgKSB7CgogICAgCQlzdHJpbmcgKz0gc25pcHBldAogICAgCQkJLnJlcGxhY2UoIC9cW1xzKmlccypcXS9nLCAnWyAnICsgaSArICcgXScgKQogICAgCQkJLnJlcGxhY2UoIC9VTlJPTExFRF9MT09QX0lOREVYL2csIGkgKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gc3RyaW5nOwoKICAgIH0KCiAgICAvLwoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlUHJlY2lzaW9uKCBwYXJhbWV0ZXJzICkgewoKICAgIAlsZXQgcHJlY2lzaW9uc3RyaW5nID0gYHByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBmbG9hdDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBpbnQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEOwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXJDdWJlOwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyMkRBcnJheTsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyMkRTaGFkb3c7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlckN1YmVTaGFkb3c7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEQXJyYXlTaGFkb3c7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIyRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBpc2FtcGxlcjNEOwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IGlzYW1wbGVyQ3ViZTsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBpc2FtcGxlcjJEQXJyYXk7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIyRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSB1c2FtcGxlcjNEOwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHVzYW1wbGVyQ3ViZTsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSB1c2FtcGxlcjJEQXJyYXk7CglgOwoKICAgIAlpZiAoIHBhcmFtZXRlcnMucHJlY2lzaW9uID09PSAnaGlnaHAnICkgewoKICAgIAkJcHJlY2lzaW9uc3RyaW5nICs9ICdcbiNkZWZpbmUgSElHSF9QUkVDSVNJT04nOwoKICAgIAl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ21lZGl1bXAnICkgewoKICAgIAkJcHJlY2lzaW9uc3RyaW5nICs9ICdcbiNkZWZpbmUgTUVESVVNX1BSRUNJU0lPTic7CgogICAgCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMucHJlY2lzaW9uID09PSAnbG93cCcgKSB7CgogICAgCQlwcmVjaXNpb25zdHJpbmcgKz0gJ1xuI2RlZmluZSBMT1dfUFJFQ0lTSU9OJzsKCiAgICAJfQoKICAgIAlyZXR1cm4gcHJlY2lzaW9uc3RyaW5nOwoKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZVNoYWRvd01hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgogICAgCWxldCBzaGFkb3dNYXBUeXBlRGVmaW5lID0gJ1NIQURPV01BUF9UWVBFX0JBU0lDJzsKCiAgICAJaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFBDRlNoYWRvd01hcCApIHsKCiAgICAJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfUENGJzsKCiAgICAJfSBlbHNlIGlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBQQ0ZTb2Z0U2hhZG93TWFwICkgewoKICAgIAkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCc7CgogICAgCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gVlNNU2hhZG93TWFwICkgewoKICAgIAkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9WU00nOwoKICAgIAl9CgogICAgCXJldHVybiBzaGFkb3dNYXBUeXBlRGVmaW5lOwoKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgogICAgCWxldCBlbnZNYXBUeXBlRGVmaW5lID0gJ0VOVk1BUF9UWVBFX0NVQkUnOwoKICAgIAlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKICAgIAkJc3dpdGNoICggcGFyYW1ldGVycy5lbnZNYXBNb2RlICkgewoKICAgIAkJCWNhc2UgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOgogICAgCQkJY2FzZSBDdWJlUmVmcmFjdGlvbk1hcHBpbmc6CiAgICAJCQkJZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKICAgIAkJCQlicmVhazsKCiAgICAJCQljYXNlIEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOgogICAgCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRV9VVic7CiAgICAJCQkJYnJlYWs7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIGVudk1hcFR5cGVEZWZpbmU7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlRW52TWFwTW9kZURlZmluZSggcGFyYW1ldGVycyApIHsKCiAgICAJbGV0IGVudk1hcE1vZGVEZWZpbmUgPSAnRU5WTUFQX01PREVfUkVGTEVDVElPTic7CgogICAgCWlmICggcGFyYW1ldGVycy5lbnZNYXAgKSB7CgogICAgCQlzd2l0Y2ggKCBwYXJhbWV0ZXJzLmVudk1hcE1vZGUgKSB7CgogICAgCQkJY2FzZSBDdWJlUmVmcmFjdGlvbk1hcHBpbmc6CgogICAgCQkJCWVudk1hcE1vZGVEZWZpbmUgPSAnRU5WTUFQX01PREVfUkVGUkFDVElPTic7CiAgICAJCQkJYnJlYWs7CgogICAgCQl9CgogICAgCX0KCiAgICAJcmV0dXJuIGVudk1hcE1vZGVEZWZpbmU7CgogICAgfQoKICAgIGZ1bmN0aW9uIGdlbmVyYXRlRW52TWFwQmxlbmRpbmdEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgogICAgCWxldCBlbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTk9ORSc7CgogICAgCWlmICggcGFyYW1ldGVycy5lbnZNYXAgKSB7CgogICAgCQlzd2l0Y2ggKCBwYXJhbWV0ZXJzLmNvbWJpbmUgKSB7CgogICAgCQkJY2FzZSBNdWx0aXBseU9wZXJhdGlvbjoKICAgIAkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTVVMVElQTFknOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgTWl4T3BlcmF0aW9uOgogICAgCQkJCWVudk1hcEJsZW5kaW5nRGVmaW5lID0gJ0VOVk1BUF9CTEVORElOR19NSVgnOwogICAgCQkJCWJyZWFrOwoKICAgIAkJCWNhc2UgQWRkT3BlcmF0aW9uOgogICAgCQkJCWVudk1hcEJsZW5kaW5nRGVmaW5lID0gJ0VOVk1BUF9CTEVORElOR19BREQnOwogICAgCQkJCWJyZWFrOwoKICAgIAkJfQoKICAgIAl9CgogICAgCXJldHVybiBlbnZNYXBCbGVuZGluZ0RlZmluZTsKCiAgICB9CgogICAgZnVuY3Rpb24gZ2VuZXJhdGVDdWJlVVZTaXplKCBwYXJhbWV0ZXJzICkgewoKICAgIAljb25zdCBpbWFnZUhlaWdodCA9IHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWSGVpZ2h0OwoKICAgIAlpZiAoIGltYWdlSGVpZ2h0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgogICAgCWNvbnN0IG1heE1pcCA9IE1hdGgubG9nMiggaW1hZ2VIZWlnaHQgKSAtIDI7CgogICAgCWNvbnN0IHRleGVsSGVpZ2h0ID0gMS4wIC8gaW1hZ2VIZWlnaHQ7CgogICAgCWNvbnN0IHRleGVsV2lkdGggPSAxLjAgLyAoIDMgKiBNYXRoLm1heCggTWF0aC5wb3coIDIsIG1heE1pcCApLCA3ICogMTYgKSApOwoKICAgIAlyZXR1cm4geyB0ZXhlbFdpZHRoLCB0ZXhlbEhlaWdodCwgbWF4TWlwIH07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMUHJvZ3JhbSggcmVuZGVyZXIsIGNhY2hlS2V5LCBwYXJhbWV0ZXJzLCBiaW5kaW5nU3RhdGVzICkgewoKICAgIAkvLyBUT0RPIFNlbmQgdGhpcyBldmVudCB0byBUaHJlZS5qcyBEZXZUb29scwogICAgCS8vIGNvbnNvbGUubG9nKCAnV2ViR0xQcm9ncmFtJywgY2FjaGVLZXkgKTsKCiAgICAJY29uc3QgZ2wgPSByZW5kZXJlci5nZXRDb250ZXh0KCk7CgogICAgCWNvbnN0IGRlZmluZXMgPSBwYXJhbWV0ZXJzLmRlZmluZXM7CgogICAgCWxldCB2ZXJ0ZXhTaGFkZXIgPSBwYXJhbWV0ZXJzLnZlcnRleFNoYWRlcjsKICAgIAlsZXQgZnJhZ21lbnRTaGFkZXIgPSBwYXJhbWV0ZXJzLmZyYWdtZW50U2hhZGVyOwoKICAgIAljb25zdCBzaGFkb3dNYXBUeXBlRGVmaW5lID0gZ2VuZXJhdGVTaGFkb3dNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICk7CiAgICAJY29uc3QgZW52TWFwVHlwZURlZmluZSA9IGdlbmVyYXRlRW52TWFwVHlwZURlZmluZSggcGFyYW1ldGVycyApOwogICAgCWNvbnN0IGVudk1hcE1vZGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKICAgIAljb25zdCBlbnZNYXBCbGVuZGluZ0RlZmluZSA9IGdlbmVyYXRlRW52TWFwQmxlbmRpbmdEZWZpbmUoIHBhcmFtZXRlcnMgKTsKICAgIAljb25zdCBlbnZNYXBDdWJlVVZTaXplID0gZ2VuZXJhdGVDdWJlVVZTaXplKCBwYXJhbWV0ZXJzICk7CgogICAgCWNvbnN0IGN1c3RvbVZlcnRleEV4dGVuc2lvbnMgPSBnZW5lcmF0ZVZlcnRleEV4dGVuc2lvbnMoIHBhcmFtZXRlcnMgKTsKCiAgICAJY29uc3QgY3VzdG9tRGVmaW5lcyA9IGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApOwoKICAgIAljb25zdCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpOwoKICAgIAlsZXQgcHJlZml4VmVydGV4LCBwcmVmaXhGcmFnbWVudDsKICAgIAlsZXQgdmVyc2lvblN0cmluZyA9IHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPyAnI3ZlcnNpb24gJyArIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gKyAnXG4nIDogJyc7CgogICAgCWlmICggcGFyYW1ldGVycy5pc1Jhd1NoYWRlck1hdGVyaWFsICkgewoKICAgIAkJcHJlZml4VmVydGV4ID0gWwoKICAgIAkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCiAgICAJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKICAgIAkJCWN1c3RvbURlZmluZXMKCiAgICAJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgogICAgCQlpZiAoIHByZWZpeFZlcnRleC5sZW5ndGggPiAwICkgewoKICAgIAkJCXByZWZpeFZlcnRleCArPSAnXG4nOwoKICAgIAkJfQoKICAgIAkJcHJlZml4RnJhZ21lbnQgPSBbCgogICAgCQkJJyNkZWZpbmUgU0hBREVSX1RZUEUgJyArIHBhcmFtZXRlcnMuc2hhZGVyVHlwZSwKICAgIAkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgogICAgCQkJY3VzdG9tRGVmaW5lcwoKICAgIAkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCiAgICAJCWlmICggcHJlZml4RnJhZ21lbnQubGVuZ3RoID4gMCApIHsKCiAgICAJCQlwcmVmaXhGcmFnbWVudCArPSAnXG4nOwoKICAgIAkJfQoKICAgIAl9IGVsc2UgewoKICAgIAkJcHJlZml4VmVydGV4ID0gWwoKICAgIAkJCWdlbmVyYXRlUHJlY2lzaW9uKCBwYXJhbWV0ZXJzICksCgogICAgCQkJJyNkZWZpbmUgU0hBREVSX1RZUEUgJyArIHBhcmFtZXRlcnMuc2hhZGVyVHlwZSwKICAgIAkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgogICAgCQkJY3VzdG9tRGVmaW5lcywKCiAgICAJCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2UgPyAnI2RlZmluZSBVU0VfQ0xJUF9ESVNUQU5DRScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYmF0Y2hpbmcgPyAnI2RlZmluZSBVU0VfQkFUQ0hJTkcnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmJhdGNoaW5nQ29sb3IgPyAnI2RlZmluZSBVU0VfQkFUQ0hJTkdfQ09MT1InIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmcgPyAnI2RlZmluZSBVU0VfSU5TVEFOQ0lORycgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yID8gJyNkZWZpbmUgVVNFX0lOU1RBTkNJTkdfQ09MT1InIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmdNb3JwaCA/ICcjZGVmaW5lIFVTRV9JTlNUQU5DSU5HX01PUlBIJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMudXNlRm9nICYmIHBhcmFtZXRlcnMuZm9nID8gJyNkZWZpbmUgVVNFX0ZPRycgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudXNlRm9nICYmIHBhcmFtZXRlcnMuZm9nRXhwMiA/ICcjZGVmaW5lIEZPR19FWFAyJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcE1vZGVEZWZpbmUgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubGlnaHRNYXAgPyAnI2RlZmluZSBVU0VfTElHSFRNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmFvTWFwID8gJyNkZWZpbmUgVVNFX0FPTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5idW1wTWFwID8gJyNkZWZpbmUgVVNFX0JVTVBNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcE9iamVjdFNwYWNlID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcCA/ICcjZGVmaW5lIFVTRV9ESVNQTEFDRU1FTlRNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwID8gJyNkZWZpbmUgVVNFX0VNSVNTSVZFTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuYW5pc290cm9weSA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFlNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRU1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfQ09MT1JNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmFscGhhTWFwID8gJyNkZWZpbmUgVVNFX0FMUEhBTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hbHBoYUhhc2ggPyAnI2RlZmluZSBVU0VfQUxQSEFIQVNIJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uID8gJyNkZWZpbmUgVVNFX1RSQU5TTUlTU0lPTicgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwID8gJyNkZWZpbmUgVVNFX1RSQU5TTUlTU0lPTk1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX1RISUNLTkVTU01BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU0hFRU5fQ09MT1JNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX1JPVUdITkVTU01BUCcgOiAnJywKCiAgICAJCQkvLwoKICAgIAkJCXBhcmFtZXRlcnMubWFwVXYgPyAnI2RlZmluZSBNQVBfVVYgJyArIHBhcmFtZXRlcnMubWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYWxwaGFNYXBVdiA/ICcjZGVmaW5lIEFMUEhBTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmFscGhhTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubGlnaHRNYXBVdiA/ICcjZGVmaW5lIExJR0hUTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmxpZ2h0TWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYW9NYXBVdiA/ICcjZGVmaW5lIEFPTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmFvTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXBVdiA/ICcjZGVmaW5lIEVNSVNTSVZFTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYnVtcE1hcFV2ID8gJyNkZWZpbmUgQlVNUE1BUF9VViAnICsgcGFyYW1ldGVycy5idW1wTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubm9ybWFsTWFwVXYgPyAnI2RlZmluZSBOT1JNQUxNQVBfVVYgJyArIHBhcmFtZXRlcnMubm9ybWFsTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZGlzcGxhY2VtZW50TWFwVXYgPyAnI2RlZmluZSBESVNQTEFDRU1FTlRNQVBfVVYgJyArIHBhcmFtZXRlcnMuZGlzcGxhY2VtZW50TWFwVXYgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ID8gJyNkZWZpbmUgTUVUQUxORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcFV2ID8gJyNkZWZpbmUgUk9VR0hORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnJvdWdobmVzc01hcFV2IDogJycsCgogICAgCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgPyAnI2RlZmluZSBBTklTT1RST1BZTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXBVdiA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwVXYgPyAnI2RlZmluZSBDTEVBUkNPQVRNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwVXYgPyAnI2RlZmluZSBDTEVBUkNPQVRfTk9STUFMTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2IDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUX1JPVUdITkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VNYXBVdiA/ICcjZGVmaW5lIElSSURFU0NFTkNFTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiA/ICcjZGVmaW5lIElSSURFU0NFTkNFX1RISUNLTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2IDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwVXYgPyAnI2RlZmluZSBTSEVFTl9DT0xPUk1BUF9VViAnICsgcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIFNIRUVOX1JPVUdITkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcFV2IDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zcGVjdWxhck1hcFV2ID8gJyNkZWZpbmUgU1BFQ1VMQVJNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJNYXBVdiA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwVXYgPyAnI2RlZmluZSBTUEVDVUxBUl9DT0xPUk1BUF9VViAnICsgcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwVXYgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA/ICcjZGVmaW5lIFNQRUNVTEFSX0lOVEVOU0lUWU1BUF9VViAnICsgcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcFV2IDogJycsCgogICAgCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXBVdiA/ICcjZGVmaW5lIFRSQU5TTUlTU0lPTk1BUF9VViAnICsgcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXBVdiA6ICcnLAogICAgCQkJcGFyYW1ldGVycy50aGlja25lc3NNYXBVdiA/ICcjZGVmaW5lIFRISUNLTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy50aGlja25lc3NNYXBVdiA6ICcnLAoKICAgIAkJCS8vCgogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyAmJiBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID09PSBmYWxzZSA/ICcjZGVmaW5lIFVTRV9UQU5HRU5UJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgPyAnI2RlZmluZSBVU0VfQ09MT1InIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnZlcnRleEFscGhhcyA/ICcjZGVmaW5lIFVTRV9DT0xPUl9BTFBIQScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4VXYxcyA/ICcjZGVmaW5lIFVTRV9VVjEnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MnMgPyAnI2RlZmluZSBVU0VfVVYyJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjNzID8gJyNkZWZpbmUgVVNFX1VWMycgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnBvaW50c1V2cyA/ICcjZGVmaW5lIFVTRV9QT0lOVFNfVVYnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5mbGF0U2hhZGluZyA/ICcjZGVmaW5lIEZMQVRfU0hBREVEJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc2tpbm5pbmcgPyAnI2RlZmluZSBVU0VfU0tJTk5JTkcnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgPyAnI2RlZmluZSBVU0VfTU9SUEhUQVJHRVRTJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5tb3JwaE5vcm1hbHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfTU9SUEhOT1JNQUxTJyA6ICcnLAogICAgCQkJKCBwYXJhbWV0ZXJzLm1vcnBoQ29sb3JzICkgPyAnI2RlZmluZSBVU0VfTU9SUEhDT0xPUlMnIDogJycsCiAgICAJCQkoIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQgPiAwICkgPyAnI2RlZmluZSBNT1JQSFRBUkdFVFNfVEVYVFVSRV9TVFJJREUgJyArIHBhcmFtZXRlcnMubW9ycGhUZXh0dXJlU3RyaWRlIDogJycsCiAgICAJCQkoIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQgPiAwICkgPyAnI2RlZmluZSBNT1JQSFRBUkdFVFNfQ09VTlQgJyArIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAnI2RlZmluZSBET1VCTEVfU0lERUQnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmZsaXBTaWRlZCA/ICcjZGVmaW5lIEZMSVBfU0lERUQnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gJyNkZWZpbmUgVVNFX1NIQURPV01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lICcgKyBzaGFkb3dNYXBUeXBlRGVmaW5lIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zaXplQXR0ZW51YXRpb24gPyAnI2RlZmluZSBVU0VfU0laRUFUVEVOVUFUSU9OJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMubnVtTGlnaHRQcm9iZXMgPiAwID8gJyNkZWZpbmUgVVNFX0xJR0hUX1BST0JFUycgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUYnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA/ICcjZGVmaW5lIFVTRV9SRVZFUlNFREVQVEhCVUYnIDogJycsCgogICAgCQkJJ3VuaWZvcm0gbWF0NCBtb2RlbE1hdHJpeDsnLAogICAgCQkJJ3VuaWZvcm0gbWF0NCBtb2RlbFZpZXdNYXRyaXg7JywKICAgIAkJCSd1bmlmb3JtIG1hdDQgcHJvamVjdGlvbk1hdHJpeDsnLAogICAgCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCiAgICAJCQkndW5pZm9ybSBtYXQzIG5vcm1hbE1hdHJpeDsnLAogICAgCQkJJ3VuaWZvcm0gdmVjMyBjYW1lcmFQb3NpdGlvbjsnLAogICAgCQkJJ3VuaWZvcm0gYm9vbCBpc09ydGhvZ3JhcGhpYzsnLAoKICAgIAkJCScjaWZkZWYgVVNFX0lOU1RBTkNJTkcnLAoKICAgIAkJCScJYXR0cmlidXRlIG1hdDQgaW5zdGFuY2VNYXRyaXg7JywKCiAgICAJCQknI2VuZGlmJywKCiAgICAJCQknI2lmZGVmIFVTRV9JTlNUQU5DSU5HX0NPTE9SJywKCiAgICAJCQknCWF0dHJpYnV0ZSB2ZWMzIGluc3RhbmNlQ29sb3I7JywKCiAgICAJCQknI2VuZGlmJywKCiAgICAJCQknI2lmZGVmIFVTRV9JTlNUQU5DSU5HX01PUlBIJywKCiAgICAJCQknCXVuaWZvcm0gc2FtcGxlcjJEIG1vcnBoVGV4dHVyZTsnLAoKICAgIAkJCScjZW5kaWYnLAoKICAgIAkJCSdhdHRyaWJ1dGUgdmVjMyBwb3NpdGlvbjsnLAogICAgCQkJJ2F0dHJpYnV0ZSB2ZWMzIG5vcm1hbDsnLAogICAgCQkJJ2F0dHJpYnV0ZSB2ZWMyIHV2OycsCgogICAgCQkJJyNpZmRlZiBVU0VfVVYxJywKCiAgICAJCQknCWF0dHJpYnV0ZSB2ZWMyIHV2MTsnLAoKICAgIAkJCScjZW5kaWYnLAoKICAgIAkJCScjaWZkZWYgVVNFX1VWMicsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjMiB1djI7JywKCiAgICAJCQknI2VuZGlmJywKCiAgICAJCQknI2lmZGVmIFVTRV9VVjMnLAoKICAgIAkJCScJYXR0cmlidXRlIHZlYzIgdXYzOycsCgogICAgCQkJJyNlbmRpZicsCgogICAgCQkJJyNpZmRlZiBVU0VfVEFOR0VOVCcsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjNCB0YW5nZW50OycsCgogICAgCQkJJyNlbmRpZicsCgogICAgCQkJJyNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKScsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjNCBjb2xvcjsnLAoKICAgIAkJCScjZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKScsCgogICAgCQkJJwlhdHRyaWJ1dGUgdmVjMyBjb2xvcjsnLAoKICAgIAkJCScjZW5kaWYnLAoKICAgIAkJCScjaWZkZWYgVVNFX1NLSU5OSU5HJywKCiAgICAJCQknCWF0dHJpYnV0ZSB2ZWM0IHNraW5JbmRleDsnLAogICAgCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luV2VpZ2h0OycsCgogICAgCQkJJyNlbmRpZicsCgogICAgCQkJJ1xuJwoKICAgIAkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCiAgICAJCXByZWZpeEZyYWdtZW50ID0gWwoKICAgIAkJCWdlbmVyYXRlUHJlY2lzaW9uKCBwYXJhbWV0ZXJzICksCgogICAgCQkJJyNkZWZpbmUgU0hBREVSX1RZUEUgJyArIHBhcmFtZXRlcnMuc2hhZGVyVHlwZSwKICAgIAkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgogICAgCQkJY3VzdG9tRGVmaW5lcywKCiAgICAJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyA/ICcjZGVmaW5lIFVTRV9GT0cnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmFscGhhVG9Db3ZlcmFnZSA/ICcjZGVmaW5lIEFMUEhBX1RPX0NPVkVSQUdFJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5tYXAgPyAnI2RlZmluZSBVU0VfTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5tYXRjYXAgPyAnI2RlZmluZSBVU0VfTUFUQ0FQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSBVU0VfRU5WTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSAnICsgZW52TWFwVHlwZURlZmluZSA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSAnICsgZW52TWFwTW9kZURlZmluZSA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSAnICsgZW52TWFwQmxlbmRpbmdEZWZpbmUgOiAnJywKICAgIAkJCWVudk1hcEN1YmVVVlNpemUgPyAnI2RlZmluZSBDVUJFVVZfVEVYRUxfV0lEVEggJyArIGVudk1hcEN1YmVVVlNpemUudGV4ZWxXaWR0aCA6ICcnLAogICAgCQkJZW52TWFwQ3ViZVVWU2l6ZSA/ICcjZGVmaW5lIENVQkVVVl9URVhFTF9IRUlHSFQgJyArIGVudk1hcEN1YmVVVlNpemUudGV4ZWxIZWlnaHQgOiAnJywKICAgIAkJCWVudk1hcEN1YmVVVlNpemUgPyAnI2RlZmluZSBDVUJFVVZfTUFYX01JUCAnICsgZW52TWFwQ3ViZVVWU2l6ZS5tYXhNaXAgKyAnLjAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYnVtcE1hcCA/ICcjZGVmaW5lIFVTRV9CVU1QTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBPYmplY3RTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0UnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFRhbmdlbnRTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5lbWlzc2l2ZU1hcCA/ICcjZGVmaW5lIFVTRV9FTUlTU0lWRU1BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWScgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcCA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0ID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuZGlzcGVyc2lvbiA/ICcjZGVmaW5lIFVTRV9ESVNQRVJTSU9OJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2UgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0UnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zcGVjdWxhck1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUk1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUl9DT0xPUk1BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfSU5URU5TSVRZTUFQJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMucm91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX1JPVUdITkVTU01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMubWV0YWxuZXNzTWFwID8gJyNkZWZpbmUgVVNFX01FVEFMTkVTU01BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmFscGhhTWFwID8gJyNkZWZpbmUgVVNFX0FMUEhBTUFQJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hbHBoYVRlc3QgPyAnI2RlZmluZSBVU0VfQUxQSEFURVNUJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5hbHBoYUhhc2ggPyAnI2RlZmluZSBVU0VfQUxQSEFIQVNIJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuc2hlZW4gPyAnI2RlZmluZSBVU0VfU0hFRU4nIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU0hFRU5fQ09MT1JNQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX1JPVUdITkVTU01BUCcgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04nIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcCA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT05NQVAnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9USElDS05FU1NNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyAmJiBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID09PSBmYWxzZSA/ICcjZGVmaW5lIFVTRV9UQU5HRU5UJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgfHwgcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3IgfHwgcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yID8gJyNkZWZpbmUgVVNFX0NPTE9SJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAnI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPyAnI2RlZmluZSBVU0VfVVYxJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjJzID8gJyNkZWZpbmUgVVNFX1VWMicgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMudmVydGV4VXYzcyA/ICcjZGVmaW5lIFVTRV9VVjMnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5wb2ludHNVdnMgPyAnI2RlZmluZSBVU0VfUE9JTlRTX1VWJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuZ3JhZGllbnRNYXAgPyAnI2RlZmluZSBVU0VfR1JBRElFTlRNQVAnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5mbGF0U2hhZGluZyA/ICcjZGVmaW5lIEZMQVRfU0hBREVEJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAnI2RlZmluZSBET1VCTEVfU0lERUQnIDogJycsCiAgICAJCQlwYXJhbWV0ZXJzLmZsaXBTaWRlZCA/ICcjZGVmaW5lIEZMSVBfU0lERUQnIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkID8gJyNkZWZpbmUgVVNFX1NIQURPV01BUCcgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lICcgKyBzaGFkb3dNYXBUeXBlRGVmaW5lIDogJycsCgogICAgCQkJcGFyYW1ldGVycy5wcmVtdWx0aXBsaWVkQWxwaGEgPyAnI2RlZmluZSBQUkVNVUxUSVBMSUVEX0FMUEhBJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMubnVtTGlnaHRQcm9iZXMgPiAwID8gJyNkZWZpbmUgVVNFX0xJR0hUX1BST0JFUycgOiAnJywKCiAgICAJCQlwYXJhbWV0ZXJzLmRlY29kZVZpZGVvVGV4dHVyZSA/ICcjZGVmaW5lIERFQ09ERV9WSURFT19URVhUVVJFJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmVFbWlzc2l2ZSA/ICcjZGVmaW5lIERFQ09ERV9WSURFT19URVhUVVJFX0VNSVNTSVZFJyA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA/ICcjZGVmaW5lIFVTRV9MT0dERVBUSEJVRicgOiAnJywKICAgIAkJCXBhcmFtZXRlcnMucmV2ZXJzZURlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX1JFVkVSU0VERVBUSEJVRicgOiAnJywKCiAgICAJCQkndW5pZm9ybSBtYXQ0IHZpZXdNYXRyaXg7JywKICAgIAkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKICAgIAkJCSd1bmlmb3JtIGJvb2wgaXNPcnRob2dyYXBoaWM7JywKCiAgICAJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/ICcjZGVmaW5lIFRPTkVfTUFQUElORycgOiAnJywKICAgIAkJCSggcGFyYW1ldGVycy50b25lTWFwcGluZyAhPT0gTm9Ub25lTWFwcGluZyApID8gU2hhZGVyQ2h1bmtbICd0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50JyBdIDogJycsIC8vIHRoaXMgY29kZSBpcyByZXF1aXJlZCBoZXJlIGJlY2F1c2UgaXQgaXMgdXNlZCBieSB0aGUgdG9uZU1hcHBpbmcoKSBmdW5jdGlvbiBkZWZpbmVkIGJlbG93CiAgICAJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/IGdldFRvbmVNYXBwaW5nRnVuY3Rpb24oICd0b25lTWFwcGluZycsIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgKSA6ICcnLAoKICAgIAkJCXBhcmFtZXRlcnMuZGl0aGVyaW5nID8gJyNkZWZpbmUgRElUSEVSSU5HJyA6ICcnLAogICAgCQkJcGFyYW1ldGVycy5vcGFxdWUgPyAnI2RlZmluZSBPUEFRVUUnIDogJycsCgogICAgCQkJU2hhZGVyQ2h1bmtbICdjb2xvcnNwYWNlX3BhcnNfZnJhZ21lbnQnIF0sIC8vIHRoaXMgY29kZSBpcyByZXF1aXJlZCBoZXJlIGJlY2F1c2UgaXQgaXMgdXNlZCBieSB0aGUgdmFyaW91cyBlbmNvZGluZy9kZWNvZGluZyBmdW5jdGlvbiBkZWZpbmVkIGJlbG93CiAgICAJCQlnZXRUZXhlbEVuY29kaW5nRnVuY3Rpb24oICdsaW5lYXJUb091dHB1dFRleGVsJywgcGFyYW1ldGVycy5vdXRwdXRDb2xvclNwYWNlICksCiAgICAJCQlnZXRMdW1pbmFuY2VGdW5jdGlvbigpLAoKICAgIAkJCXBhcmFtZXRlcnMudXNlRGVwdGhQYWNraW5nID8gJyNkZWZpbmUgREVQVEhfUEFDS0lORyAnICsgcGFyYW1ldGVycy5kZXB0aFBhY2tpbmcgOiAnJywKCiAgICAJCQknXG4nCgogICAgCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKICAgIAl9CgogICAgCXZlcnRleFNoYWRlciA9IHJlc29sdmVJbmNsdWRlcyggdmVydGV4U2hhZGVyICk7CiAgICAJdmVydGV4U2hhZGVyID0gcmVwbGFjZUxpZ2h0TnVtcyggdmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzICk7CiAgICAJdmVydGV4U2hhZGVyID0gcmVwbGFjZUNsaXBwaW5nUGxhbmVOdW1zKCB2ZXJ0ZXhTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCiAgICAJZnJhZ21lbnRTaGFkZXIgPSByZXNvbHZlSW5jbHVkZXMoIGZyYWdtZW50U2hhZGVyICk7CiAgICAJZnJhZ21lbnRTaGFkZXIgPSByZXBsYWNlTGlnaHROdW1zKCBmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyApOwogICAgCWZyYWdtZW50U2hhZGVyID0gcmVwbGFjZUNsaXBwaW5nUGxhbmVOdW1zKCBmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyApOwoKICAgIAl2ZXJ0ZXhTaGFkZXIgPSB1bnJvbGxMb29wcyggdmVydGV4U2hhZGVyICk7CiAgICAJZnJhZ21lbnRTaGFkZXIgPSB1bnJvbGxMb29wcyggZnJhZ21lbnRTaGFkZXIgKTsKCiAgICAJaWYgKCBwYXJhbWV0ZXJzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgIT09IHRydWUgKSB7CgogICAgCQkvLyBHTFNMIDMuMCBjb252ZXJzaW9uIGZvciBidWlsdC1pbiBtYXRlcmlhbHMgYW5kIFNoYWRlck1hdGVyaWFsCgogICAgCQl2ZXJzaW9uU3RyaW5nID0gJyN2ZXJzaW9uIDMwMCBlc1xuJzsKCiAgICAJCXByZWZpeFZlcnRleCA9IFsKICAgIAkJCWN1c3RvbVZlcnRleEV4dGVuc2lvbnMsCiAgICAJCQknI2RlZmluZSBhdHRyaWJ1dGUgaW4nLAogICAgCQkJJyNkZWZpbmUgdmFyeWluZyBvdXQnLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZTJEIHRleHR1cmUnCiAgICAJCV0uam9pbiggJ1xuJyApICsgJ1xuJyArIHByZWZpeFZlcnRleDsKCiAgICAJCXByZWZpeEZyYWdtZW50ID0gWwogICAgCQkJJyNkZWZpbmUgdmFyeWluZyBpbicsCiAgICAJCQkoIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPT09IEdMU0wzICkgPyAnJyA6ICdsYXlvdXQobG9jYXRpb24gPSAwKSBvdXQgaGlnaHAgdmVjNCBwY19mcmFnQ29sb3I7JywKICAgIAkJCSggcGFyYW1ldGVycy5nbHNsVmVyc2lvbiA9PT0gR0xTTDMgKSA/ICcnIDogJyNkZWZpbmUgZ2xfRnJhZ0NvbG9yIHBjX2ZyYWdDb2xvcicsCiAgICAJCQknI2RlZmluZSBnbF9GcmFnRGVwdGhFWFQgZ2xfRnJhZ0RlcHRoJywKICAgIAkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJywKICAgIAkJCScjZGVmaW5lIHRleHR1cmVDdWJlIHRleHR1cmUnLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvaiB0ZXh0dXJlUHJvaicsCiAgICAJCQknI2RlZmluZSB0ZXh0dXJlMkRMb2RFWFQgdGV4dHVyZUxvZCcsCiAgICAJCQknI2RlZmluZSB0ZXh0dXJlMkRQcm9qTG9kRVhUIHRleHR1cmVQcm9qTG9kJywKICAgIAkJCScjZGVmaW5lIHRleHR1cmVDdWJlTG9kRVhUIHRleHR1cmVMb2QnLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZTJER3JhZEVYVCB0ZXh0dXJlR3JhZCcsCiAgICAJCQknI2RlZmluZSB0ZXh0dXJlMkRQcm9qR3JhZEVYVCB0ZXh0dXJlUHJvakdyYWQnLAogICAgCQkJJyNkZWZpbmUgdGV4dHVyZUN1YmVHcmFkRVhUIHRleHR1cmVHcmFkJwogICAgCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhGcmFnbWVudDsKCiAgICAJfQoKICAgIAljb25zdCB2ZXJ0ZXhHbHNsID0gdmVyc2lvblN0cmluZyArIHByZWZpeFZlcnRleCArIHZlcnRleFNoYWRlcjsKICAgIAljb25zdCBmcmFnbWVudEdsc2wgPSB2ZXJzaW9uU3RyaW5nICsgcHJlZml4RnJhZ21lbnQgKyBmcmFnbWVudFNoYWRlcjsKCiAgICAJLy8gY29uc29sZS5sb2coICcqVkVSVEVYKicsIHZlcnRleEdsc2wgKTsKICAgIAkvLyBjb25zb2xlLmxvZyggJypGUkFHTUVOVConLCBmcmFnbWVudEdsc2wgKTsKCiAgICAJY29uc3QgZ2xWZXJ0ZXhTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIGdsLlZFUlRFWF9TSEFERVIsIHZlcnRleEdsc2wgKTsKICAgIAljb25zdCBnbEZyYWdtZW50U2hhZGVyID0gV2ViR0xTaGFkZXIoIGdsLCBnbC5GUkFHTUVOVF9TSEFERVIsIGZyYWdtZW50R2xzbCApOwoKICAgIAlnbC5hdHRhY2hTaGFkZXIoIHByb2dyYW0sIGdsVmVydGV4U2hhZGVyICk7CiAgICAJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbEZyYWdtZW50U2hhZGVyICk7CgogICAgCS8vIEZvcmNlIGEgcGFydGljdWxhciBhdHRyaWJ1dGUgdG8gaW5kZXggMC4KCiAgICAJaWYgKCBwYXJhbWV0ZXJzLmluZGV4MEF0dHJpYnV0ZU5hbWUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICk7CgogICAgCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzID09PSB0cnVlICkgewoKICAgIAkJLy8gcHJvZ3JhbXMgd2l0aCBtb3JwaFRhcmdldHMgZGlzcGxhY2UgcG9zaXRpb24gb3V0IG9mIGF0dHJpYnV0ZSAwCiAgICAJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgJ3Bvc2l0aW9uJyApOwoKICAgIAl9CgogICAgCWdsLmxpbmtQcm9ncmFtKCBwcm9ncmFtICk7CgogICAgCWZ1bmN0aW9uIG9uRmlyc3RVc2UoIHNlbGYgKSB7CgogICAgCQkvLyBjaGVjayBmb3IgbGluayBlcnJvcnMKICAgIAkJaWYgKCByZW5kZXJlci5kZWJ1Zy5jaGVja1NoYWRlckVycm9ycyApIHsKCiAgICAJCQljb25zdCBwcm9ncmFtTG9nID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2coIHByb2dyYW0gKS50cmltKCk7CiAgICAJCQljb25zdCB2ZXJ0ZXhMb2cgPSBnbC5nZXRTaGFkZXJJbmZvTG9nKCBnbFZlcnRleFNoYWRlciApLnRyaW0oKTsKICAgIAkJCWNvbnN0IGZyYWdtZW50TG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggZ2xGcmFnbWVudFNoYWRlciApLnRyaW0oKTsKCiAgICAJCQlsZXQgcnVubmFibGUgPSB0cnVlOwogICAgCQkJbGV0IGhhdmVEaWFnbm9zdGljcyA9IHRydWU7CgogICAgCQkJaWYgKCBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUyApID09PSBmYWxzZSApIHsKCiAgICAJCQkJcnVubmFibGUgPSBmYWxzZTsKCiAgICAJCQkJaWYgKCB0eXBlb2YgcmVuZGVyZXIuZGVidWcub25TaGFkZXJFcnJvciA9PT0gJ2Z1bmN0aW9uJyApIHsKCiAgICAJCQkJCXJlbmRlcmVyLmRlYnVnLm9uU2hhZGVyRXJyb3IoIGdsLCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciwgZ2xGcmFnbWVudFNoYWRlciApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gZGVmYXVsdCBlcnJvciByZXBvcnRpbmcKCiAgICAJCQkJCWNvbnN0IHZlcnRleEVycm9ycyA9IGdldFNoYWRlckVycm9ycyggZ2wsIGdsVmVydGV4U2hhZGVyLCAndmVydGV4JyApOwogICAgCQkJCQljb25zdCBmcmFnbWVudEVycm9ycyA9IGdldFNoYWRlckVycm9ycyggZ2wsIGdsRnJhZ21lbnRTaGFkZXIsICdmcmFnbWVudCcgKTsKCiAgICAJCQkJCWNvbnNvbGUuZXJyb3IoCiAgICAJCQkJCQknVEhSRUUuV2ViR0xQcm9ncmFtOiBTaGFkZXIgRXJyb3IgJyArIGdsLmdldEVycm9yKCkgKyAnIC0gJyArCiAgICAJCQkJCQknVkFMSURBVEVfU1RBVFVTICcgKyBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5WQUxJREFURV9TVEFUVVMgKSArICdcblxuJyArCiAgICAJCQkJCQknTWF0ZXJpYWwgTmFtZTogJyArIHNlbGYubmFtZSArICdcbicgKwogICAgCQkJCQkJJ01hdGVyaWFsIFR5cGU6ICcgKyBzZWxmLnR5cGUgKyAnXG5cbicgKwogICAgCQkJCQkJJ1Byb2dyYW0gSW5mbyBMb2c6ICcgKyBwcm9ncmFtTG9nICsgJ1xuJyArCiAgICAJCQkJCQl2ZXJ0ZXhFcnJvcnMgKyAnXG4nICsKICAgIAkJCQkJCWZyYWdtZW50RXJyb3JzCiAgICAJCQkJCSk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCBwcm9ncmFtTG9nICE9PSAnJyApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xQcm9ncmFtOiBQcm9ncmFtIEluZm8gTG9nOicsIHByb2dyYW1Mb2cgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCB2ZXJ0ZXhMb2cgPT09ICcnIHx8IGZyYWdtZW50TG9nID09PSAnJyApIHsKCiAgICAJCQkJaGF2ZURpYWdub3N0aWNzID0gZmFsc2U7CgogICAgCQkJfQoKICAgIAkJCWlmICggaGF2ZURpYWdub3N0aWNzICkgewoKICAgIAkJCQlzZWxmLmRpYWdub3N0aWNzID0gewoKICAgIAkJCQkJcnVubmFibGU6IHJ1bm5hYmxlLAoKICAgIAkJCQkJcHJvZ3JhbUxvZzogcHJvZ3JhbUxvZywKCiAgICAJCQkJCXZlcnRleFNoYWRlcjogewoKICAgIAkJCQkJCWxvZzogdmVydGV4TG9nLAogICAgCQkJCQkJcHJlZml4OiBwcmVmaXhWZXJ0ZXgKCiAgICAJCQkJCX0sCgogICAgCQkJCQlmcmFnbWVudFNoYWRlcjogewoKICAgIAkJCQkJCWxvZzogZnJhZ21lbnRMb2csCiAgICAJCQkJCQlwcmVmaXg6IHByZWZpeEZyYWdtZW50CgogICAgCQkJCQl9CgogICAgCQkJCX07CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gQ2xlYW4gdXAKCiAgICAJCS8vIENyYXNoZXMgaW4gaU9TOSBhbmQgaU9TMTAuICMxODQwMgogICAgCQkvLyBnbC5kZXRhY2hTaGFkZXIoIHByb2dyYW0sIGdsVmVydGV4U2hhZGVyICk7CiAgICAJCS8vIGdsLmRldGFjaFNoYWRlciggcHJvZ3JhbSwgZ2xGcmFnbWVudFNoYWRlciApOwoKICAgIAkJZ2wuZGVsZXRlU2hhZGVyKCBnbFZlcnRleFNoYWRlciApOwogICAgCQlnbC5kZWxldGVTaGFkZXIoIGdsRnJhZ21lbnRTaGFkZXIgKTsKCiAgICAJCWNhY2hlZFVuaWZvcm1zID0gbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICk7CiAgICAJCWNhY2hlZEF0dHJpYnV0ZXMgPSBmZXRjaEF0dHJpYnV0ZUxvY2F0aW9ucyggZ2wsIHByb2dyYW0gKTsKCiAgICAJfQoKICAgIAkvLyBzZXQgdXAgY2FjaGluZyBmb3IgdW5pZm9ybSBsb2NhdGlvbnMKCiAgICAJbGV0IGNhY2hlZFVuaWZvcm1zOwoKICAgIAl0aGlzLmdldFVuaWZvcm1zID0gZnVuY3Rpb24gKCkgewoKICAgIAkJaWYgKCBjYWNoZWRVbmlmb3JtcyA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCS8vIFBvcHVsYXRlcyBjYWNoZWRVbmlmb3JtcyBhbmQgY2FjaGVkQXR0cmlidXRlcwogICAgCQkJb25GaXJzdFVzZSggdGhpcyApOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGNhY2hlZFVuaWZvcm1zOwoKICAgIAl9OwoKICAgIAkvLyBzZXQgdXAgY2FjaGluZyBmb3IgYXR0cmlidXRlIGxvY2F0aW9ucwoKICAgIAlsZXQgY2FjaGVkQXR0cmlidXRlczsKCiAgICAJdGhpcy5nZXRBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkgewoKICAgIAkJaWYgKCBjYWNoZWRBdHRyaWJ1dGVzID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJLy8gUG9wdWxhdGVzIGNhY2hlZEF0dHJpYnV0ZXMgYW5kIGNhY2hlZFVuaWZvcm1zCiAgICAJCQlvbkZpcnN0VXNlKCB0aGlzICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gY2FjaGVkQXR0cmlidXRlczsKCiAgICAJfTsKCiAgICAJLy8gaW5kaWNhdGUgd2hlbiB0aGUgcHJvZ3JhbSBpcyByZWFkeSB0byBiZSB1c2VkLiBpZiB0aGUgS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlIGV4dGVuc2lvbiBpc24ndCBzdXBwb3J0ZWQsCiAgICAJLy8gZmxhZyB0aGUgcHJvZ3JhbSBhcyByZWFkeSBpbW1lZGlhdGVseS4gSXQgbWF5IGNhdXNlIGEgc3RhbGwgd2hlbiBpdCdzIGZpcnN0IHVzZWQuCgogICAgCWxldCBwcm9ncmFtUmVhZHkgPSAoIHBhcmFtZXRlcnMucmVuZGVyZXJFeHRlbnNpb25QYXJhbGxlbFNoYWRlckNvbXBpbGUgPT09IGZhbHNlICk7CgogICAgCXRoaXMuaXNSZWFkeSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCWlmICggcHJvZ3JhbVJlYWR5ID09PSBmYWxzZSApIHsKCiAgICAJCQlwcm9ncmFtUmVhZHkgPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBDT01QTEVUSU9OX1NUQVRVU19LSFIgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBwcm9ncmFtUmVhZHk7CgogICAgCX07CgogICAgCS8vIGZyZWUgcmVzb3VyY2UKCiAgICAJdGhpcy5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewoKICAgIAkJYmluZGluZ1N0YXRlcy5yZWxlYXNlU3RhdGVzT2ZQcm9ncmFtKCB0aGlzICk7CgogICAgCQlnbC5kZWxldGVQcm9ncmFtKCBwcm9ncmFtICk7CiAgICAJCXRoaXMucHJvZ3JhbSA9IHVuZGVmaW5lZDsKCiAgICAJfTsKCiAgICAJLy8KCiAgICAJdGhpcy50eXBlID0gcGFyYW1ldGVycy5zaGFkZXJUeXBlOwogICAgCXRoaXMubmFtZSA9IHBhcmFtZXRlcnMuc2hhZGVyTmFtZTsKICAgIAl0aGlzLmlkID0gcHJvZ3JhbUlkQ291bnQgKys7CiAgICAJdGhpcy5jYWNoZUtleSA9IGNhY2hlS2V5OwogICAgCXRoaXMudXNlZFRpbWVzID0gMTsKICAgIAl0aGlzLnByb2dyYW0gPSBwcm9ncmFtOwogICAgCXRoaXMudmVydGV4U2hhZGVyID0gZ2xWZXJ0ZXhTaGFkZXI7CiAgICAJdGhpcy5mcmFnbWVudFNoYWRlciA9IGdsRnJhZ21lbnRTaGFkZXI7CgogICAgCXJldHVybiB0aGlzOwoKICAgIH0KCiAgICBsZXQgX2lkID0gMDsKCiAgICBjbGFzcyBXZWJHTFNoYWRlckNhY2hlIHsKCiAgICAJY29uc3RydWN0b3IoKSB7CgogICAgCQl0aGlzLnNoYWRlckNhY2hlID0gbmV3IE1hcCgpOwogICAgCQl0aGlzLm1hdGVyaWFsQ2FjaGUgPSBuZXcgTWFwKCk7CgogICAgCX0KCiAgICAJdXBkYXRlKCBtYXRlcmlhbCApIHsKCiAgICAJCWNvbnN0IHZlcnRleFNoYWRlciA9IG1hdGVyaWFsLnZlcnRleFNoYWRlcjsKICAgIAkJY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBtYXRlcmlhbC5mcmFnbWVudFNoYWRlcjsKCiAgICAJCWNvbnN0IHZlcnRleFNoYWRlclN0YWdlID0gdGhpcy5fZ2V0U2hhZGVyU3RhZ2UoIHZlcnRleFNoYWRlciApOwogICAgCQljb25zdCBmcmFnbWVudFNoYWRlclN0YWdlID0gdGhpcy5fZ2V0U2hhZGVyU3RhZ2UoIGZyYWdtZW50U2hhZGVyICk7CgogICAgCQljb25zdCBtYXRlcmlhbFNoYWRlcnMgPSB0aGlzLl9nZXRTaGFkZXJDYWNoZUZvck1hdGVyaWFsKCBtYXRlcmlhbCApOwoKICAgIAkJaWYgKCBtYXRlcmlhbFNoYWRlcnMuaGFzKCB2ZXJ0ZXhTaGFkZXJTdGFnZSApID09PSBmYWxzZSApIHsKCiAgICAJCQltYXRlcmlhbFNoYWRlcnMuYWRkKCB2ZXJ0ZXhTaGFkZXJTdGFnZSApOwogICAgCQkJdmVydGV4U2hhZGVyU3RhZ2UudXNlZFRpbWVzICsrOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbFNoYWRlcnMuaGFzKCBmcmFnbWVudFNoYWRlclN0YWdlICkgPT09IGZhbHNlICkgewoKICAgIAkJCW1hdGVyaWFsU2hhZGVycy5hZGQoIGZyYWdtZW50U2hhZGVyU3RhZ2UgKTsKICAgIAkJCWZyYWdtZW50U2hhZGVyU3RhZ2UudXNlZFRpbWVzICsrOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIHRoaXM7CgogICAgCX0KCiAgICAJcmVtb3ZlKCBtYXRlcmlhbCApIHsKCiAgICAJCWNvbnN0IG1hdGVyaWFsU2hhZGVycyA9IHRoaXMubWF0ZXJpYWxDYWNoZS5nZXQoIG1hdGVyaWFsICk7CgogICAgCQlmb3IgKCBjb25zdCBzaGFkZXJTdGFnZSBvZiBtYXRlcmlhbFNoYWRlcnMgKSB7CgogICAgCQkJc2hhZGVyU3RhZ2UudXNlZFRpbWVzIC0tOwoKICAgIAkJCWlmICggc2hhZGVyU3RhZ2UudXNlZFRpbWVzID09PSAwICkgdGhpcy5zaGFkZXJDYWNoZS5kZWxldGUoIHNoYWRlclN0YWdlLmNvZGUgKTsKCiAgICAJCX0KCiAgICAJCXRoaXMubWF0ZXJpYWxDYWNoZS5kZWxldGUoIG1hdGVyaWFsICk7CgogICAgCQlyZXR1cm4gdGhpczsKCiAgICAJfQoKICAgIAlnZXRWZXJ0ZXhTaGFkZXJJRCggbWF0ZXJpYWwgKSB7CgogICAgCQlyZXR1cm4gdGhpcy5fZ2V0U2hhZGVyU3RhZ2UoIG1hdGVyaWFsLnZlcnRleFNoYWRlciApLmlkOwoKICAgIAl9CgogICAgCWdldEZyYWdtZW50U2hhZGVySUQoIG1hdGVyaWFsICkgewoKICAgIAkJcmV0dXJuIHRoaXMuX2dldFNoYWRlclN0YWdlKCBtYXRlcmlhbC5mcmFnbWVudFNoYWRlciApLmlkOwoKICAgIAl9CgogICAgCWRpc3Bvc2UoKSB7CgogICAgCQl0aGlzLnNoYWRlckNhY2hlLmNsZWFyKCk7CiAgICAJCXRoaXMubWF0ZXJpYWxDYWNoZS5jbGVhcigpOwoKICAgIAl9CgogICAgCV9nZXRTaGFkZXJDYWNoZUZvck1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCiAgICAJCWNvbnN0IGNhY2hlID0gdGhpcy5tYXRlcmlhbENhY2hlOwogICAgCQlsZXQgc2V0ID0gY2FjaGUuZ2V0KCBtYXRlcmlhbCApOwoKICAgIAkJaWYgKCBzZXQgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlzZXQgPSBuZXcgU2V0KCk7CiAgICAJCQljYWNoZS5zZXQoIG1hdGVyaWFsLCBzZXQgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBzZXQ7CgogICAgCX0KCiAgICAJX2dldFNoYWRlclN0YWdlKCBjb2RlICkgewoKICAgIAkJY29uc3QgY2FjaGUgPSB0aGlzLnNoYWRlckNhY2hlOwogICAgCQlsZXQgc3RhZ2UgPSBjYWNoZS5nZXQoIGNvZGUgKTsKCiAgICAJCWlmICggc3RhZ2UgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlzdGFnZSA9IG5ldyBXZWJHTFNoYWRlclN0YWdlKCBjb2RlICk7CiAgICAJCQljYWNoZS5zZXQoIGNvZGUsIHN0YWdlICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gc3RhZ2U7CgogICAgCX0KCiAgICB9CgogICAgY2xhc3MgV2ViR0xTaGFkZXJTdGFnZSB7CgogICAgCWNvbnN0cnVjdG9yKCBjb2RlICkgewoKICAgIAkJdGhpcy5pZCA9IF9pZCArKzsKCiAgICAJCXRoaXMuY29kZSA9IGNvZGU7CiAgICAJCXRoaXMudXNlZFRpbWVzID0gMDsKCiAgICAJfQoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTFByb2dyYW1zKCByZW5kZXJlciwgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcgKSB7CgogICAgCWNvbnN0IF9wcm9ncmFtTGF5ZXJzID0gbmV3IExheWVycygpOwogICAgCWNvbnN0IF9jdXN0b21TaGFkZXJzID0gbmV3IFdlYkdMU2hhZGVyQ2FjaGUoKTsKICAgIAljb25zdCBfYWN0aXZlQ2hhbm5lbHMgPSBuZXcgU2V0KCk7CiAgICAJY29uc3QgcHJvZ3JhbXMgPSBbXTsKCiAgICAJY29uc3QgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IGNhcGFiaWxpdGllcy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyOwogICAgCWNvbnN0IFNVUFBPUlRTX1ZFUlRFWF9URVhUVVJFUyA9IGNhcGFiaWxpdGllcy52ZXJ0ZXhUZXh0dXJlczsKCiAgICAJbGV0IHByZWNpc2lvbiA9IGNhcGFiaWxpdGllcy5wcmVjaXNpb247CgogICAgCWNvbnN0IHNoYWRlcklEcyA9IHsKICAgIAkJTWVzaERlcHRoTWF0ZXJpYWw6ICdkZXB0aCcsCiAgICAJCU1lc2hEaXN0YW5jZU1hdGVyaWFsOiAnZGlzdGFuY2VSR0JBJywKICAgIAkJTWVzaE5vcm1hbE1hdGVyaWFsOiAnbm9ybWFsJywKICAgIAkJTWVzaEJhc2ljTWF0ZXJpYWw6ICdiYXNpYycsCiAgICAJCU1lc2hMYW1iZXJ0TWF0ZXJpYWw6ICdsYW1iZXJ0JywKICAgIAkJTWVzaFBob25nTWF0ZXJpYWw6ICdwaG9uZycsCiAgICAJCU1lc2hUb29uTWF0ZXJpYWw6ICd0b29uJywKICAgIAkJTWVzaFN0YW5kYXJkTWF0ZXJpYWw6ICdwaHlzaWNhbCcsCiAgICAJCU1lc2hQaHlzaWNhbE1hdGVyaWFsOiAncGh5c2ljYWwnLAogICAgCQlNZXNoTWF0Y2FwTWF0ZXJpYWw6ICdtYXRjYXAnLAogICAgCQlMaW5lQmFzaWNNYXRlcmlhbDogJ2Jhc2ljJywKICAgIAkJTGluZURhc2hlZE1hdGVyaWFsOiAnZGFzaGVkJywKICAgIAkJUG9pbnRzTWF0ZXJpYWw6ICdwb2ludHMnLAogICAgCQlTaGFkb3dNYXRlcmlhbDogJ3NoYWRvdycsCiAgICAJCVNwcml0ZU1hdGVyaWFsOiAnc3ByaXRlJwogICAgCX07CgogICAgCWZ1bmN0aW9uIGdldENoYW5uZWwoIHZhbHVlICkgewoKICAgIAkJX2FjdGl2ZUNoYW5uZWxzLmFkZCggdmFsdWUgKTsKCiAgICAJCWlmICggdmFsdWUgPT09IDAgKSByZXR1cm4gJ3V2JzsKCiAgICAJCXJldHVybiBgdXYkeyB2YWx1ZSB9YDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRQYXJhbWV0ZXJzKCBtYXRlcmlhbCwgbGlnaHRzLCBzaGFkb3dzLCBzY2VuZSwgb2JqZWN0ICkgewoKICAgIAkJY29uc3QgZm9nID0gc2NlbmUuZm9nOwogICAgCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdC5nZW9tZXRyeTsKICAgIAkJY29uc3QgZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoKICAgIAkJY29uc3QgZW52TWFwID0gKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQgKTsKICAgIAkJY29uc3QgZW52TWFwQ3ViZVVWSGVpZ2h0ID0gKCAhISBlbnZNYXAgKSAmJiAoIGVudk1hcC5tYXBwaW5nID09PSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyApID8gZW52TWFwLmltYWdlLmhlaWdodCA6IG51bGw7CgogICAgCQljb25zdCBzaGFkZXJJRCA9IHNoYWRlcklEc1sgbWF0ZXJpYWwudHlwZSBdOwoKICAgIAkJLy8gaGV1cmlzdGljcyB0byBjcmVhdGUgc2hhZGVyIHBhcmFtZXRlcnMgYWNjb3JkaW5nIHRvIGxpZ2h0cyBpbiB0aGUgc2NlbmUKICAgIAkJLy8gKG5vdCB0byBibG93IG92ZXIgbWF4TGlnaHRzIGJ1ZGdldCkKCiAgICAJCWlmICggbWF0ZXJpYWwucHJlY2lzaW9uICE9PSBudWxsICkgewoKICAgIAkJCXByZWNpc2lvbiA9IGNhcGFiaWxpdGllcy5nZXRNYXhQcmVjaXNpb24oIG1hdGVyaWFsLnByZWNpc2lvbiApOwoKICAgIAkJCWlmICggcHJlY2lzaW9uICE9PSBtYXRlcmlhbC5wcmVjaXNpb24gKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbS5nZXRQYXJhbWV0ZXJzOicsIG1hdGVyaWFsLnByZWNpc2lvbiwgJ25vdCBzdXBwb3J0ZWQsIHVzaW5nJywgcHJlY2lzaW9uLCAnaW5zdGVhZC4nICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8KCiAgICAJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwogICAgCQljb25zdCBtb3JwaFRhcmdldHNDb3VudCA9ICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApID8gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoIDogMDsKCiAgICAJCWxldCBtb3JwaFRleHR1cmVTdHJpZGUgPSAwOwoKICAgIAkJaWYgKCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDE7CiAgICAJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCAhPT0gdW5kZWZpbmVkICkgbW9ycGhUZXh0dXJlU3RyaWRlID0gMjsKICAgIAkJaWYgKCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDM7CgogICAgCQkvLwoKICAgIAkJbGV0IHZlcnRleFNoYWRlciwgZnJhZ21lbnRTaGFkZXI7CiAgICAJCWxldCBjdXN0b21WZXJ0ZXhTaGFkZXJJRCwgY3VzdG9tRnJhZ21lbnRTaGFkZXJJRDsKCiAgICAJCWlmICggc2hhZGVySUQgKSB7CgogICAgCQkJY29uc3Qgc2hhZGVyID0gU2hhZGVyTGliWyBzaGFkZXJJRCBdOwoKICAgIAkJCXZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXI7CiAgICAJCQlmcmFnbWVudFNoYWRlciA9IHNoYWRlci5mcmFnbWVudFNoYWRlcjsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJdmVydGV4U2hhZGVyID0gbWF0ZXJpYWwudmVydGV4U2hhZGVyOwogICAgCQkJZnJhZ21lbnRTaGFkZXIgPSBtYXRlcmlhbC5mcmFnbWVudFNoYWRlcjsKCiAgICAJCQlfY3VzdG9tU2hhZGVycy51cGRhdGUoIG1hdGVyaWFsICk7CgogICAgCQkJY3VzdG9tVmVydGV4U2hhZGVySUQgPSBfY3VzdG9tU2hhZGVycy5nZXRWZXJ0ZXhTaGFkZXJJRCggbWF0ZXJpYWwgKTsKICAgIAkJCWN1c3RvbUZyYWdtZW50U2hhZGVySUQgPSBfY3VzdG9tU2hhZGVycy5nZXRGcmFnbWVudFNoYWRlcklEKCBtYXRlcmlhbCApOwoKICAgIAkJfQoKICAgIAkJY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwogICAgCQljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSByZW5kZXJlci5zdGF0ZS5idWZmZXJzLmRlcHRoLmdldFJldmVyc2VkKCk7CgogICAgCQljb25zdCBJU19JTlNUQU5DRURNRVNIID0gb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCA9PT0gdHJ1ZTsKICAgIAkJY29uc3QgSVNfQkFUQ0hFRE1FU0ggPSBvYmplY3QuaXNCYXRjaGVkTWVzaCA9PT0gdHJ1ZTsKCiAgICAJCWNvbnN0IEhBU19NQVAgPSAhISBtYXRlcmlhbC5tYXA7CiAgICAJCWNvbnN0IEhBU19NQVRDQVAgPSAhISBtYXRlcmlhbC5tYXRjYXA7CiAgICAJCWNvbnN0IEhBU19FTlZNQVAgPSAhISBlbnZNYXA7CiAgICAJCWNvbnN0IEhBU19BT01BUCA9ICEhIG1hdGVyaWFsLmFvTWFwOwogICAgCQljb25zdCBIQVNfTElHSFRNQVAgPSAhISBtYXRlcmlhbC5saWdodE1hcDsKICAgIAkJY29uc3QgSEFTX0JVTVBNQVAgPSAhISBtYXRlcmlhbC5idW1wTWFwOwogICAgCQljb25zdCBIQVNfTk9STUFMTUFQID0gISEgbWF0ZXJpYWwubm9ybWFsTWFwOwogICAgCQljb25zdCBIQVNfRElTUExBQ0VNRU5UTUFQID0gISEgbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwogICAgCQljb25zdCBIQVNfRU1JU1NJVkVNQVAgPSAhISBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCiAgICAJCWNvbnN0IEhBU19NRVRBTE5FU1NNQVAgPSAhISBtYXRlcmlhbC5tZXRhbG5lc3NNYXA7CiAgICAJCWNvbnN0IEhBU19ST1VHSE5FU1NNQVAgPSAhISBtYXRlcmlhbC5yb3VnaG5lc3NNYXA7CgogICAgCQljb25zdCBIQVNfQU5JU09UUk9QWSA9IG1hdGVyaWFsLmFuaXNvdHJvcHkgPiAwOwogICAgCQljb25zdCBIQVNfQ0xFQVJDT0FUID0gbWF0ZXJpYWwuY2xlYXJjb2F0ID4gMDsKICAgIAkJY29uc3QgSEFTX0RJU1BFUlNJT04gPSBtYXRlcmlhbC5kaXNwZXJzaW9uID4gMDsKICAgIAkJY29uc3QgSEFTX0lSSURFU0NFTkNFID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPiAwOwogICAgCQljb25zdCBIQVNfU0hFRU4gPSBtYXRlcmlhbC5zaGVlbiA+IDA7CiAgICAJCWNvbnN0IEhBU19UUkFOU01JU1NJT04gPSBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwOwoKICAgIAkJY29uc3QgSEFTX0FOSVNPVFJPUFlNQVAgPSBIQVNfQU5JU09UUk9QWSAmJiAhISBtYXRlcmlhbC5hbmlzb3Ryb3B5TWFwOwoKICAgIAkJY29uc3QgSEFTX0NMRUFSQ09BVE1BUCA9IEhBU19DTEVBUkNPQVQgJiYgISEgbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwogICAgCQljb25zdCBIQVNfQ0xFQVJDT0FUX05PUk1BTE1BUCA9IEhBU19DTEVBUkNPQVQgJiYgISEgbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwOwogICAgCQljb25zdCBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCA9IEhBU19DTEVBUkNPQVQgJiYgISEgbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwoKICAgIAkJY29uc3QgSEFTX0lSSURFU0NFTkNFTUFQID0gSEFTX0lSSURFU0NFTkNFICYmICEhIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwOwogICAgCQljb25zdCBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQID0gSEFTX0lSSURFU0NFTkNFICYmICEhIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKICAgIAkJY29uc3QgSEFTX1NIRUVOX0NPTE9STUFQID0gSEFTX1NIRUVOICYmICEhIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXA7CiAgICAJCWNvbnN0IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAgPSBIQVNfU0hFRU4gJiYgISEgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXA7CgogICAgCQljb25zdCBIQVNfU1BFQ1VMQVJNQVAgPSAhISBtYXRlcmlhbC5zcGVjdWxhck1hcDsKICAgIAkJY29uc3QgSEFTX1NQRUNVTEFSX0NPTE9STUFQID0gISEgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvck1hcDsKICAgIAkJY29uc3QgSEFTX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwOwoKICAgIAkJY29uc3QgSEFTX1RSQU5TTUlTU0lPTk1BUCA9IEhBU19UUkFOU01JU1NJT04gJiYgISEgbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwOwogICAgCQljb25zdCBIQVNfVEhJQ0tORVNTTUFQID0gSEFTX1RSQU5TTUlTU0lPTiAmJiAhISBtYXRlcmlhbC50aGlja25lc3NNYXA7CgogICAgCQljb25zdCBIQVNfR1JBRElFTlRNQVAgPSAhISBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCiAgICAJCWNvbnN0IEhBU19BTFBIQU1BUCA9ICEhIG1hdGVyaWFsLmFscGhhTWFwOwoKICAgIAkJY29uc3QgSEFTX0FMUEhBVEVTVCA9IG1hdGVyaWFsLmFscGhhVGVzdCA+IDA7CgogICAgCQljb25zdCBIQVNfQUxQSEFIQVNIID0gISEgbWF0ZXJpYWwuYWxwaGFIYXNoOwoKICAgIAkJY29uc3QgSEFTX0VYVEVOU0lPTlMgPSAhISBtYXRlcmlhbC5leHRlbnNpb25zOwoKICAgIAkJbGV0IHRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCiAgICAJCWlmICggbWF0ZXJpYWwudG9uZU1hcHBlZCApIHsKCiAgICAJCQlpZiAoIGN1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgfHwgY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlICkgewoKICAgIAkJCQl0b25lTWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWNvbnN0IHBhcmFtZXRlcnMgPSB7CgogICAgCQkJc2hhZGVySUQ6IHNoYWRlcklELAogICAgCQkJc2hhZGVyVHlwZTogbWF0ZXJpYWwudHlwZSwKICAgIAkJCXNoYWRlck5hbWU6IG1hdGVyaWFsLm5hbWUsCgogICAgCQkJdmVydGV4U2hhZGVyOiB2ZXJ0ZXhTaGFkZXIsCiAgICAJCQlmcmFnbWVudFNoYWRlcjogZnJhZ21lbnRTaGFkZXIsCiAgICAJCQlkZWZpbmVzOiBtYXRlcmlhbC5kZWZpbmVzLAoKICAgIAkJCWN1c3RvbVZlcnRleFNoYWRlcklEOiBjdXN0b21WZXJ0ZXhTaGFkZXJJRCwKICAgIAkJCWN1c3RvbUZyYWdtZW50U2hhZGVySUQ6IGN1c3RvbUZyYWdtZW50U2hhZGVySUQsCgogICAgCQkJaXNSYXdTaGFkZXJNYXRlcmlhbDogbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gdHJ1ZSwKICAgIAkJCWdsc2xWZXJzaW9uOiBtYXRlcmlhbC5nbHNsVmVyc2lvbiwKCiAgICAJCQlwcmVjaXNpb246IHByZWNpc2lvbiwKCiAgICAJCQliYXRjaGluZzogSVNfQkFUQ0hFRE1FU0gsCiAgICAJCQliYXRjaGluZ0NvbG9yOiBJU19CQVRDSEVETUVTSCAmJiBvYmplY3QuX2NvbG9yc1RleHR1cmUgIT09IG51bGwsCiAgICAJCQlpbnN0YW5jaW5nOiBJU19JTlNUQU5DRURNRVNILAogICAgCQkJaW5zdGFuY2luZ0NvbG9yOiBJU19JTlNUQU5DRURNRVNIICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsLAogICAgCQkJaW5zdGFuY2luZ01vcnBoOiBJU19JTlNUQU5DRURNRVNIICYmIG9iamVjdC5tb3JwaFRleHR1cmUgIT09IG51bGwsCgogICAgCQkJc3VwcG9ydHNWZXJ0ZXhUZXh0dXJlczogU1VQUE9SVFNfVkVSVEVYX1RFWFRVUkVTLAogICAgCQkJb3V0cHV0Q29sb3JTcGFjZTogKCBjdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsICkgPyByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlIDogKCBjdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBjdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuY29sb3JTcGFjZSA6IExpbmVhclNSR0JDb2xvclNwYWNlICksCiAgICAJCQlhbHBoYVRvQ292ZXJhZ2U6ICEhIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSwKCiAgICAJCQltYXA6IEhBU19NQVAsCiAgICAJCQltYXRjYXA6IEhBU19NQVRDQVAsCiAgICAJCQllbnZNYXA6IEhBU19FTlZNQVAsCiAgICAJCQllbnZNYXBNb2RlOiBIQVNfRU5WTUFQICYmIGVudk1hcC5tYXBwaW5nLAogICAgCQkJZW52TWFwQ3ViZVVWSGVpZ2h0OiBlbnZNYXBDdWJlVVZIZWlnaHQsCiAgICAJCQlhb01hcDogSEFTX0FPTUFQLAogICAgCQkJbGlnaHRNYXA6IEhBU19MSUdIVE1BUCwKICAgIAkJCWJ1bXBNYXA6IEhBU19CVU1QTUFQLAogICAgCQkJbm9ybWFsTWFwOiBIQVNfTk9STUFMTUFQLAogICAgCQkJZGlzcGxhY2VtZW50TWFwOiBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMgJiYgSEFTX0RJU1BMQUNFTUVOVE1BUCwKICAgIAkJCWVtaXNzaXZlTWFwOiBIQVNfRU1JU1NJVkVNQVAsCgogICAgCQkJbm9ybWFsTWFwT2JqZWN0U3BhY2U6IEhBU19OT1JNQUxNQVAgJiYgbWF0ZXJpYWwubm9ybWFsTWFwVHlwZSA9PT0gT2JqZWN0U3BhY2VOb3JtYWxNYXAsCiAgICAJCQlub3JtYWxNYXBUYW5nZW50U3BhY2U6IEhBU19OT1JNQUxNQVAgJiYgbWF0ZXJpYWwubm9ybWFsTWFwVHlwZSA9PT0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwLAoKICAgIAkJCW1ldGFsbmVzc01hcDogSEFTX01FVEFMTkVTU01BUCwKICAgIAkJCXJvdWdobmVzc01hcDogSEFTX1JPVUdITkVTU01BUCwKCiAgICAJCQlhbmlzb3Ryb3B5OiBIQVNfQU5JU09UUk9QWSwKICAgIAkJCWFuaXNvdHJvcHlNYXA6IEhBU19BTklTT1RST1BZTUFQLAoKICAgIAkJCWNsZWFyY29hdDogSEFTX0NMRUFSQ09BVCwKICAgIAkJCWNsZWFyY29hdE1hcDogSEFTX0NMRUFSQ09BVE1BUCwKICAgIAkJCWNsZWFyY29hdE5vcm1hbE1hcDogSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAsCiAgICAJCQljbGVhcmNvYXRSb3VnaG5lc3NNYXA6IEhBU19DTEVBUkNPQVRfUk9VR0hORVNTTUFQLAoKICAgIAkJCWRpc3BlcnNpb246IEhBU19ESVNQRVJTSU9OLAoKICAgIAkJCWlyaWRlc2NlbmNlOiBIQVNfSVJJREVTQ0VOQ0UsCiAgICAJCQlpcmlkZXNjZW5jZU1hcDogSEFTX0lSSURFU0NFTkNFTUFQLAogICAgCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNYXA6IEhBU19JUklERVNDRU5DRV9USElDS05FU1NNQVAsCgogICAgCQkJc2hlZW46IEhBU19TSEVFTiwKICAgIAkJCXNoZWVuQ29sb3JNYXA6IEhBU19TSEVFTl9DT0xPUk1BUCwKICAgIAkJCXNoZWVuUm91Z2huZXNzTWFwOiBIQVNfU0hFRU5fUk9VR0hORVNTTUFQLAoKICAgIAkJCXNwZWN1bGFyTWFwOiBIQVNfU1BFQ1VMQVJNQVAsCiAgICAJCQlzcGVjdWxhckNvbG9yTWFwOiBIQVNfU1BFQ1VMQVJfQ09MT1JNQVAsCiAgICAJCQlzcGVjdWxhckludGVuc2l0eU1hcDogSEFTX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCwKCiAgICAJCQl0cmFuc21pc3Npb246IEhBU19UUkFOU01JU1NJT04sCiAgICAJCQl0cmFuc21pc3Npb25NYXA6IEhBU19UUkFOU01JU1NJT05NQVAsCiAgICAJCQl0aGlja25lc3NNYXA6IEhBU19USElDS05FU1NNQVAsCgogICAgCQkJZ3JhZGllbnRNYXA6IEhBU19HUkFESUVOVE1BUCwKCiAgICAJCQlvcGFxdWU6IG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSBmYWxzZSAmJiBtYXRlcmlhbC5ibGVuZGluZyA9PT0gTm9ybWFsQmxlbmRpbmcgJiYgbWF0ZXJpYWwuYWxwaGFUb0NvdmVyYWdlID09PSBmYWxzZSwKCiAgICAJCQlhbHBoYU1hcDogSEFTX0FMUEhBTUFQLAogICAgCQkJYWxwaGFUZXN0OiBIQVNfQUxQSEFURVNULAogICAgCQkJYWxwaGFIYXNoOiBIQVNfQUxQSEFIQVNILAoKICAgIAkJCWNvbWJpbmU6IG1hdGVyaWFsLmNvbWJpbmUsCgogICAgCQkJLy8KCiAgICAJCQltYXBVdjogSEFTX01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5tYXAuY2hhbm5lbCApLAogICAgCQkJYW9NYXBVdjogSEFTX0FPTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFvTWFwLmNoYW5uZWwgKSwKICAgIAkJCWxpZ2h0TWFwVXY6IEhBU19MSUdIVE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5saWdodE1hcC5jaGFubmVsICksCiAgICAJCQlidW1wTWFwVXY6IEhBU19CVU1QTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmJ1bXBNYXAuY2hhbm5lbCApLAogICAgCQkJbm9ybWFsTWFwVXY6IEhBU19OT1JNQUxNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubm9ybWFsTWFwLmNoYW5uZWwgKSwKICAgIAkJCWRpc3BsYWNlbWVudE1hcFV2OiBIQVNfRElTUExBQ0VNRU5UTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcC5jaGFubmVsICksCiAgICAJCQllbWlzc2l2ZU1hcFV2OiBIQVNfRU1JU1NJVkVNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuZW1pc3NpdmVNYXAuY2hhbm5lbCApLAoKICAgIAkJCW1ldGFsbmVzc01hcFV2OiBIQVNfTUVUQUxORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLm1ldGFsbmVzc01hcC5jaGFubmVsICksCiAgICAJCQlyb3VnaG5lc3NNYXBVdjogSEFTX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKICAgIAkJCWFuaXNvdHJvcHlNYXBVdjogSEFTX0FOSVNPVFJPUFlNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuYW5pc290cm9weU1hcC5jaGFubmVsICksCgogICAgCQkJY2xlYXJjb2F0TWFwVXY6IEhBU19DTEVBUkNPQVRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLmNoYW5uZWwgKSwKICAgIAkJCWNsZWFyY29hdE5vcm1hbE1hcFV2OiBIQVNfQ0xFQVJDT0FUX05PUk1BTE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAuY2hhbm5lbCApLAogICAgCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwVXY6IEhBU19DTEVBUkNPQVRfUk9VR0hORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcC5jaGFubmVsICksCgogICAgCQkJaXJpZGVzY2VuY2VNYXBVdjogSEFTX0lSSURFU0NFTkNFTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwLmNoYW5uZWwgKSwKICAgIAkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXY6IEhBU19JUklERVNDRU5DRV9USElDS05FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAuY2hhbm5lbCApLAoKICAgIAkJCXNoZWVuQ29sb3JNYXBVdjogSEFTX1NIRUVOX0NPTE9STUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXAuY2hhbm5lbCApLAogICAgCQkJc2hlZW5Sb3VnaG5lc3NNYXBVdjogSEFTX1NIRUVOX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zaGVlblJvdWdobmVzc01hcC5jaGFubmVsICksCgogICAgCQkJc3BlY3VsYXJNYXBVdjogSEFTX1NQRUNVTEFSTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNwZWN1bGFyTWFwLmNoYW5uZWwgKSwKICAgIAkJCXNwZWN1bGFyQ29sb3JNYXBVdjogSEFTX1NQRUNVTEFSX0NPTE9STUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAuY2hhbm5lbCApLAogICAgCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXBVdjogSEFTX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcC5jaGFubmVsICksCgogICAgCQkJdHJhbnNtaXNzaW9uTWFwVXY6IEhBU19UUkFOU01JU1NJT05NQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwLmNoYW5uZWwgKSwKICAgIAkJCXRoaWNrbmVzc01hcFV2OiBIQVNfVEhJQ0tORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnRoaWNrbmVzc01hcC5jaGFubmVsICksCgogICAgCQkJYWxwaGFNYXBVdjogSEFTX0FMUEhBTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFscGhhTWFwLmNoYW5uZWwgKSwKCiAgICAJCQkvLwoKICAgIAkJCXZlcnRleFRhbmdlbnRzOiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLnRhbmdlbnQgJiYgKCBIQVNfTk9STUFMTUFQIHx8IEhBU19BTklTT1RST1BZICksCiAgICAJCQl2ZXJ0ZXhDb2xvcnM6IG1hdGVyaWFsLnZlcnRleENvbG9ycywKICAgIAkJCXZlcnRleEFscGhhczogbWF0ZXJpYWwudmVydGV4Q29sb3JzID09PSB0cnVlICYmICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IgJiYgZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvci5pdGVtU2l6ZSA9PT0gNCwKCiAgICAJCQlwb2ludHNVdnM6IG9iamVjdC5pc1BvaW50cyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2ICYmICggSEFTX01BUCB8fCBIQVNfQUxQSEFNQVAgKSwKCiAgICAJCQlmb2c6ICEhIGZvZywKICAgIAkJCXVzZUZvZzogbWF0ZXJpYWwuZm9nID09PSB0cnVlLAogICAgCQkJZm9nRXhwMjogKCAhISBmb2cgJiYgZm9nLmlzRm9nRXhwMiApLAoKICAgIAkJCWZsYXRTaGFkaW5nOiAoIG1hdGVyaWFsLmZsYXRTaGFkaW5nID09PSB0cnVlICYmIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gZmFsc2UgKSwKCiAgICAJCQlzaXplQXR0ZW51YXRpb246IG1hdGVyaWFsLnNpemVBdHRlbnVhdGlvbiA9PT0gdHJ1ZSwKICAgIAkJCWxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIsCiAgICAJCQlyZXZlcnNlRGVwdGhCdWZmZXI6IHJldmVyc2VEZXB0aEJ1ZmZlciwKCiAgICAJCQlza2lubmluZzogb2JqZWN0LmlzU2tpbm5lZE1lc2ggPT09IHRydWUsCgogICAgCQkJbW9ycGhUYXJnZXRzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gIT09IHVuZGVmaW5lZCwKICAgIAkJCW1vcnBoTm9ybWFsczogZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCAhPT0gdW5kZWZpbmVkLAogICAgCQkJbW9ycGhDb2xvcnM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkLAogICAgCQkJbW9ycGhUYXJnZXRzQ291bnQ6IG1vcnBoVGFyZ2V0c0NvdW50LAogICAgCQkJbW9ycGhUZXh0dXJlU3RyaWRlOiBtb3JwaFRleHR1cmVTdHJpZGUsCgogICAgCQkJbnVtRGlyTGlnaHRzOiBsaWdodHMuZGlyZWN0aW9uYWwubGVuZ3RoLAogICAgCQkJbnVtUG9pbnRMaWdodHM6IGxpZ2h0cy5wb2ludC5sZW5ndGgsCiAgICAJCQludW1TcG90TGlnaHRzOiBsaWdodHMuc3BvdC5sZW5ndGgsCiAgICAJCQludW1TcG90TGlnaHRNYXBzOiBsaWdodHMuc3BvdExpZ2h0TWFwLmxlbmd0aCwKICAgIAkJCW51bVJlY3RBcmVhTGlnaHRzOiBsaWdodHMucmVjdEFyZWEubGVuZ3RoLAogICAgCQkJbnVtSGVtaUxpZ2h0czogbGlnaHRzLmhlbWkubGVuZ3RoLAoKICAgIAkJCW51bURpckxpZ2h0U2hhZG93czogbGlnaHRzLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCwKICAgIAkJCW51bVBvaW50TGlnaHRTaGFkb3dzOiBsaWdodHMucG9pbnRTaGFkb3dNYXAubGVuZ3RoLAogICAgCQkJbnVtU3BvdExpZ2h0U2hhZG93czogbGlnaHRzLnNwb3RTaGFkb3dNYXAubGVuZ3RoLAogICAgCQkJbnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOiBsaWdodHMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzLAoKICAgIAkJCW51bUxpZ2h0UHJvYmVzOiBsaWdodHMubnVtTGlnaHRQcm9iZXMsCgogICAgCQkJbnVtQ2xpcHBpbmdQbGFuZXM6IGNsaXBwaW5nLm51bVBsYW5lcywKICAgIAkJCW51bUNsaXBJbnRlcnNlY3Rpb246IGNsaXBwaW5nLm51bUludGVyc2VjdGlvbiwKCiAgICAJCQlkaXRoZXJpbmc6IG1hdGVyaWFsLmRpdGhlcmluZywKCiAgICAJCQlzaGFkb3dNYXBFbmFibGVkOiByZW5kZXJlci5zaGFkb3dNYXAuZW5hYmxlZCAmJiBzaGFkb3dzLmxlbmd0aCA+IDAsCiAgICAJCQlzaGFkb3dNYXBUeXBlOiByZW5kZXJlci5zaGFkb3dNYXAudHlwZSwKCiAgICAJCQl0b25lTWFwcGluZzogdG9uZU1hcHBpbmcsCgogICAgCQkJZGVjb2RlVmlkZW9UZXh0dXJlOiBIQVNfTUFQICYmICggbWF0ZXJpYWwubWFwLmlzVmlkZW9UZXh0dXJlID09PSB0cnVlICkgJiYgKCBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIG1hdGVyaWFsLm1hcC5jb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApLAogICAgCQkJZGVjb2RlVmlkZW9UZXh0dXJlRW1pc3NpdmU6IEhBU19FTUlTU0lWRU1BUCAmJiAoIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmlzVmlkZW9UZXh0dXJlID09PSB0cnVlICkgJiYgKCBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmNvbG9yU3BhY2UgKSA9PT0gU1JHQlRyYW5zZmVyICksCgogICAgCQkJcHJlbXVsdGlwbGllZEFscGhhOiBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEsCgogICAgCQkJZG91YmxlU2lkZWQ6IG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUsCiAgICAJCQlmbGlwU2lkZWQ6IG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlLAoKICAgIAkJCXVzZURlcHRoUGFja2luZzogbWF0ZXJpYWwuZGVwdGhQYWNraW5nID49IDAsCiAgICAJCQlkZXB0aFBhY2tpbmc6IG1hdGVyaWFsLmRlcHRoUGFja2luZyB8fCAwLAoKICAgIAkJCWluZGV4MEF0dHJpYnV0ZU5hbWU6IG1hdGVyaWFsLmluZGV4MEF0dHJpYnV0ZU5hbWUsCgogICAgCQkJZXh0ZW5zaW9uQ2xpcEN1bGxEaXN0YW5jZTogSEFTX0VYVEVOU0lPTlMgJiYgbWF0ZXJpYWwuZXh0ZW5zaW9ucy5jbGlwQ3VsbERpc3RhbmNlID09PSB0cnVlICYmIGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfY2xpcF9jdWxsX2Rpc3RhbmNlJyApLAogICAgCQkJZXh0ZW5zaW9uTXVsdGlEcmF3OiAoIEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMubXVsdGlEcmF3ID09PSB0cnVlIHx8IElTX0JBVENIRURNRVNIICkgJiYgZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aV9kcmF3JyApLAoKICAgIAkJCXJlbmRlcmVyRXh0ZW5zaW9uUGFyYWxsZWxTaGFkZXJDb21waWxlOiBleHRlbnNpb25zLmhhcyggJ0tIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZScgKSwKCiAgICAJCQljdXN0b21Qcm9ncmFtQ2FjaGVLZXk6IG1hdGVyaWFsLmN1c3RvbVByb2dyYW1DYWNoZUtleSgpCgogICAgCQl9OwoKICAgIAkJLy8gdGhlIHVzYWdlIG9mIGdldENoYW5uZWwoKSBkZXRlcm1pbmVzIHRoZSBhY3RpdmUgdGV4dHVyZSBjaGFubmVscyBmb3IgdGhpcyBzaGFkZXIKCiAgICAJCXBhcmFtZXRlcnMudmVydGV4VXYxcyA9IF9hY3RpdmVDaGFubmVscy5oYXMoIDEgKTsKICAgIAkJcGFyYW1ldGVycy52ZXJ0ZXhVdjJzID0gX2FjdGl2ZUNoYW5uZWxzLmhhcyggMiApOwogICAgCQlwYXJhbWV0ZXJzLnZlcnRleFV2M3MgPSBfYWN0aXZlQ2hhbm5lbHMuaGFzKCAzICk7CgogICAgCQlfYWN0aXZlQ2hhbm5lbHMuY2xlYXIoKTsKCiAgICAJCXJldHVybiBwYXJhbWV0ZXJzOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleSggcGFyYW1ldGVycyApIHsKCiAgICAJCWNvbnN0IGFycmF5ID0gW107CgogICAgCQlpZiAoIHBhcmFtZXRlcnMuc2hhZGVySUQgKSB7CgogICAgCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaGFkZXJJRCApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmN1c3RvbVZlcnRleFNoYWRlcklEICk7CiAgICAJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmN1c3RvbUZyYWdtZW50U2hhZGVySUQgKTsKCiAgICAJCX0KCiAgICAJCWlmICggcGFyYW1ldGVycy5kZWZpbmVzICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJZm9yICggY29uc3QgbmFtZSBpbiBwYXJhbWV0ZXJzLmRlZmluZXMgKSB7CgogICAgCQkJCWFycmF5LnB1c2goIG5hbWUgKTsKICAgIAkJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRlZmluZXNbIG5hbWUgXSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggcGFyYW1ldGVycy5pc1Jhd1NoYWRlck1hdGVyaWFsID09PSBmYWxzZSApIHsKCiAgICAJCQlnZXRQcm9ncmFtQ2FjaGVLZXlQYXJhbWV0ZXJzKCBhcnJheSwgcGFyYW1ldGVycyApOwogICAgCQkJZ2V0UHJvZ3JhbUNhY2hlS2V5Qm9vbGVhbnMoIGFycmF5LCBwYXJhbWV0ZXJzICk7CiAgICAJCQlhcnJheS5wdXNoKCByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlICk7CgogICAgCQl9CgogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmN1c3RvbVByb2dyYW1DYWNoZUtleSApOwoKICAgIAkJcmV0dXJuIGFycmF5LmpvaW4oKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRQcm9ncmFtQ2FjaGVLZXlQYXJhbWV0ZXJzKCBhcnJheSwgcGFyYW1ldGVycyApIHsKCiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMucHJlY2lzaW9uICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmVudk1hcE1vZGUgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5lbnZNYXBDdWJlVVZIZWlnaHQgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5tYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmFscGhhTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5saWdodE1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYW9NYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmJ1bXBNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZGlzcGxhY2VtZW50TWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5lbWlzc2l2ZU1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubWV0YWxuZXNzTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcFV2ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy50aGlja25lc3NNYXBVdiApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNvbWJpbmUgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5mb2dFeHAyICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2l6ZUF0dGVudWF0aW9uICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5tb3JwaEF0dHJpYnV0ZUNvdW50ICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtRGlyTGlnaHRzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodHMgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0TWFwcyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUhlbWlMaWdodHMgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1SZWN0QXJlYUxpZ2h0cyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0U2hhZG93cyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRTaGFkb3dzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcyApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSApOwogICAgCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXMgKTsKICAgIAkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uICk7CiAgICAJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZGVwdGhQYWNraW5nICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0UHJvZ3JhbUNhY2hlS2V5Qm9vbGVhbnMoIGFycmF5LCBwYXJhbWV0ZXJzICkgewoKICAgIAkJX3Byb2dyYW1MYXllcnMuZGlzYWJsZUFsbCgpOwoKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnN1cHBvcnRzVmVydGV4VGV4dHVyZXMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAwICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5pbnN0YW5jaW5nICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMiApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZ01vcnBoICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMyApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMubWF0Y2FwICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA2ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5jbGVhcmNvYXQgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA4ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5pcmlkZXNjZW5jZSApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDkgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhVGVzdCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEwICk7CiAgICAJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4QWxwaGFzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTIgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleFV2MXMgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMyApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4VXYycyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE0ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjNzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTUgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleFRhbmdlbnRzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTYgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNyApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuYWxwaGFIYXNoICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTggKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmJhdGNoaW5nICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTkgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmRpc3BlcnNpb24gKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuYmF0Y2hpbmdDb2xvciApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIxICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5ncmFkaWVudE1hcCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIyICk7CgogICAgCQlhcnJheS5wdXNoKCBfcHJvZ3JhbUxheWVycy5tYXNrICk7CiAgICAJCV9wcm9ncmFtTGF5ZXJzLmRpc2FibGVBbGwoKTsKCiAgICAJCWlmICggcGFyYW1ldGVycy5mb2cgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAwICk7CiAgICAJCWlmICggcGFyYW1ldGVycy51c2VGb2cgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5mbGF0U2hhZGluZyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAzICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5yZXZlcnNlRGVwdGhCdWZmZXIgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA0ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5za2lubmluZyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDYgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLm1vcnBoTm9ybWFscyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDcgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLm1vcnBoQ29sb3JzICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEwICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5kb3VibGVTaWRlZCApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDExICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5mbGlwU2lkZWQgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMiApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMudXNlRGVwdGhQYWNraW5nICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTMgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLmRpdGhlcmluZyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE0ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy50cmFuc21pc3Npb24gKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuc2hlZW4gKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNiApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMub3BhcXVlICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKICAgIAkJaWYgKCBwYXJhbWV0ZXJzLnBvaW50c1V2cyApCiAgICAJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE4ICk7CiAgICAJCWlmICggcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmUgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOSApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlRW1pc3NpdmUgKQogICAgCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMCApOwogICAgCQlpZiAoIHBhcmFtZXRlcnMuYWxwaGFUb0NvdmVyYWdlICkKICAgIAkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjEgKTsKCiAgICAJCWFycmF5LnB1c2goIF9wcm9ncmFtTGF5ZXJzLm1hc2sgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRVbmlmb3JtcyggbWF0ZXJpYWwgKSB7CgogICAgCQljb25zdCBzaGFkZXJJRCA9IHNoYWRlcklEc1sgbWF0ZXJpYWwudHlwZSBdOwogICAgCQlsZXQgdW5pZm9ybXM7CgogICAgCQlpZiAoIHNoYWRlcklEICkgewoKICAgIAkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKICAgIAkJCXVuaWZvcm1zID0gVW5pZm9ybXNVdGlscy5jbG9uZSggc2hhZGVyLnVuaWZvcm1zICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgogICAgCQl9CgogICAgCQlyZXR1cm4gdW5pZm9ybXM7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYWNxdWlyZVByb2dyYW0oIHBhcmFtZXRlcnMsIGNhY2hlS2V5ICkgewoKICAgIAkJbGV0IHByb2dyYW07CgogICAgCQkvLyBDaGVjayBpZiBjb2RlIGhhcyBiZWVuIGFscmVhZHkgY29tcGlsZWQKICAgIAkJZm9yICggbGV0IHAgPSAwLCBwbCA9IHByb2dyYW1zLmxlbmd0aDsgcCA8IHBsOyBwICsrICkgewoKICAgIAkJCWNvbnN0IHByZWV4aXN0aW5nUHJvZ3JhbSA9IHByb2dyYW1zWyBwIF07CgogICAgCQkJaWYgKCBwcmVleGlzdGluZ1Byb2dyYW0uY2FjaGVLZXkgPT09IGNhY2hlS2V5ICkgewoKICAgIAkJCQlwcm9ncmFtID0gcHJlZXhpc3RpbmdQcm9ncmFtOwogICAgCQkJCSsrIHByb2dyYW0udXNlZFRpbWVzOwoKICAgIAkJCQlicmVhazsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIHByb2dyYW0gPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlwcm9ncmFtID0gbmV3IFdlYkdMUHJvZ3JhbSggcmVuZGVyZXIsIGNhY2hlS2V5LCBwYXJhbWV0ZXJzLCBiaW5kaW5nU3RhdGVzICk7CiAgICAJCQlwcm9ncmFtcy5wdXNoKCBwcm9ncmFtICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gcHJvZ3JhbTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWxlYXNlUHJvZ3JhbSggcHJvZ3JhbSApIHsKCiAgICAJCWlmICggLS0gcHJvZ3JhbS51c2VkVGltZXMgPT09IDAgKSB7CgogICAgCQkJLy8gUmVtb3ZlIGZyb20gdW5vcmRlcmVkIHNldAogICAgCQkJY29uc3QgaSA9IHByb2dyYW1zLmluZGV4T2YoIHByb2dyYW0gKTsKICAgIAkJCXByb2dyYW1zWyBpIF0gPSBwcm9ncmFtc1sgcHJvZ3JhbXMubGVuZ3RoIC0gMSBdOwogICAgCQkJcHJvZ3JhbXMucG9wKCk7CgogICAgCQkJLy8gRnJlZSBXZWJHTCByZXNvdXJjZXMKICAgIAkJCXByb2dyYW0uZGVzdHJveSgpOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbGVhc2VTaGFkZXJDYWNoZSggbWF0ZXJpYWwgKSB7CgogICAgCQlfY3VzdG9tU2hhZGVycy5yZW1vdmUoIG1hdGVyaWFsICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCV9jdXN0b21TaGFkZXJzLmRpc3Bvc2UoKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gewogICAgCQlnZXRQYXJhbWV0ZXJzOiBnZXRQYXJhbWV0ZXJzLAogICAgCQlnZXRQcm9ncmFtQ2FjaGVLZXk6IGdldFByb2dyYW1DYWNoZUtleSwKICAgIAkJZ2V0VW5pZm9ybXM6IGdldFVuaWZvcm1zLAogICAgCQlhY3F1aXJlUHJvZ3JhbTogYWNxdWlyZVByb2dyYW0sCiAgICAJCXJlbGVhc2VQcm9ncmFtOiByZWxlYXNlUHJvZ3JhbSwKICAgIAkJcmVsZWFzZVNoYWRlckNhY2hlOiByZWxlYXNlU2hhZGVyQ2FjaGUsCiAgICAJCS8vIEV4cG9zZWQgZm9yIHJlc291cmNlIG1vbml0b3JpbmcgJiBlcnJvciBmZWVkYmFjayB2aWEgcmVuZGVyZXIuaW5mbzoKICAgIAkJcHJvZ3JhbXM6IHByb2dyYW1zLAogICAgCQlkaXNwb3NlOiBkaXNwb3NlCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xQcm9wZXJ0aWVzKCkgewoKICAgIAlsZXQgcHJvcGVydGllcyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCWZ1bmN0aW9uIGhhcyggb2JqZWN0ICkgewoKICAgIAkJcmV0dXJuIHByb3BlcnRpZXMuaGFzKCBvYmplY3QgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXQoIG9iamVjdCApIHsKCiAgICAJCWxldCBtYXAgPSBwcm9wZXJ0aWVzLmdldCggb2JqZWN0ICk7CgogICAgCQlpZiAoIG1hcCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCW1hcCA9IHt9OwogICAgCQkJcHJvcGVydGllcy5zZXQoIG9iamVjdCwgbWFwICk7CgogICAgCQl9CgogICAgCQlyZXR1cm4gbWFwOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlbW92ZSggb2JqZWN0ICkgewoKICAgIAkJcHJvcGVydGllcy5kZWxldGUoIG9iamVjdCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0LCBrZXksIHZhbHVlICkgewoKICAgIAkJcHJvcGVydGllcy5nZXQoIG9iamVjdCApWyBrZXkgXSA9IHZhbHVlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgogICAgCQlwcm9wZXJ0aWVzID0gbmV3IFdlYWtNYXAoKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gewogICAgCQloYXM6IGhhcywKICAgIAkJZ2V0OiBnZXQsCiAgICAJCXJlbW92ZTogcmVtb3ZlLAogICAgCQl1cGRhdGU6IHVwZGF0ZSwKICAgIAkJZGlzcG9zZTogZGlzcG9zZQogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIHBhaW50ZXJTb3J0U3RhYmxlKCBhLCBiICkgewoKICAgIAlpZiAoIGEuZ3JvdXBPcmRlciAhPT0gYi5ncm91cE9yZGVyICkgewoKICAgIAkJcmV0dXJuIGEuZ3JvdXBPcmRlciAtIGIuZ3JvdXBPcmRlcjsKCiAgICAJfSBlbHNlIGlmICggYS5yZW5kZXJPcmRlciAhPT0gYi5yZW5kZXJPcmRlciApIHsKCiAgICAJCXJldHVybiBhLnJlbmRlck9yZGVyIC0gYi5yZW5kZXJPcmRlcjsKCiAgICAJfSBlbHNlIGlmICggYS5tYXRlcmlhbC5pZCAhPT0gYi5tYXRlcmlhbC5pZCApIHsKCiAgICAJCXJldHVybiBhLm1hdGVyaWFsLmlkIC0gYi5tYXRlcmlhbC5pZDsKCiAgICAJfSBlbHNlIGlmICggYS56ICE9PSBiLnogKSB7CgogICAgCQlyZXR1cm4gYS56IC0gYi56OwoKICAgIAl9IGVsc2UgewoKICAgIAkJcmV0dXJuIGEuaWQgLSBiLmlkOwoKICAgIAl9CgogICAgfQoKICAgIGZ1bmN0aW9uIHJldmVyc2VQYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCiAgICAJaWYgKCBhLmdyb3VwT3JkZXIgIT09IGIuZ3JvdXBPcmRlciApIHsKCiAgICAJCXJldHVybiBhLmdyb3VwT3JkZXIgLSBiLmdyb3VwT3JkZXI7CgogICAgCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgogICAgCQlyZXR1cm4gYS5yZW5kZXJPcmRlciAtIGIucmVuZGVyT3JkZXI7CgogICAgCX0gZWxzZSBpZiAoIGEueiAhPT0gYi56ICkgewoKICAgIAkJcmV0dXJuIGIueiAtIGEuejsKCiAgICAJfSBlbHNlIHsKCiAgICAJCXJldHVybiBhLmlkIC0gYi5pZDsKCiAgICAJfQoKICAgIH0KCgogICAgZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0KCkgewoKICAgIAljb25zdCByZW5kZXJJdGVtcyA9IFtdOwogICAgCWxldCByZW5kZXJJdGVtc0luZGV4ID0gMDsKCiAgICAJY29uc3Qgb3BhcXVlID0gW107CiAgICAJY29uc3QgdHJhbnNtaXNzaXZlID0gW107CiAgICAJY29uc3QgdHJhbnNwYXJlbnQgPSBbXTsKCiAgICAJZnVuY3Rpb24gaW5pdCgpIHsKCiAgICAJCXJlbmRlckl0ZW1zSW5kZXggPSAwOwoKICAgIAkJb3BhcXVlLmxlbmd0aCA9IDA7CiAgICAJCXRyYW5zbWlzc2l2ZS5sZW5ndGggPSAwOwogICAgCQl0cmFuc3BhcmVudC5sZW5ndGggPSAwOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKSB7CgogICAgCQlsZXQgcmVuZGVySXRlbSA9IHJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF07CgogICAgCQlpZiAoIHJlbmRlckl0ZW0gPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlyZW5kZXJJdGVtID0gewogICAgCQkJCWlkOiBvYmplY3QuaWQsCiAgICAJCQkJb2JqZWN0OiBvYmplY3QsCiAgICAJCQkJZ2VvbWV0cnk6IGdlb21ldHJ5LAogICAgCQkJCW1hdGVyaWFsOiBtYXRlcmlhbCwKICAgIAkJCQlncm91cE9yZGVyOiBncm91cE9yZGVyLAogICAgCQkJCXJlbmRlck9yZGVyOiBvYmplY3QucmVuZGVyT3JkZXIsCiAgICAJCQkJejogeiwKICAgIAkJCQlncm91cDogZ3JvdXAKICAgIAkJCX07CgogICAgCQkJcmVuZGVySXRlbXNbIHJlbmRlckl0ZW1zSW5kZXggXSA9IHJlbmRlckl0ZW07CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXJlbmRlckl0ZW0uaWQgPSBvYmplY3QuaWQ7CiAgICAJCQlyZW5kZXJJdGVtLm9iamVjdCA9IG9iamVjdDsKICAgIAkJCXJlbmRlckl0ZW0uZ2VvbWV0cnkgPSBnZW9tZXRyeTsKICAgIAkJCXJlbmRlckl0ZW0ubWF0ZXJpYWwgPSBtYXRlcmlhbDsKICAgIAkJCXJlbmRlckl0ZW0uZ3JvdXBPcmRlciA9IGdyb3VwT3JkZXI7CiAgICAJCQlyZW5kZXJJdGVtLnJlbmRlck9yZGVyID0gb2JqZWN0LnJlbmRlck9yZGVyOwogICAgCQkJcmVuZGVySXRlbS56ID0gejsKICAgIAkJCXJlbmRlckl0ZW0uZ3JvdXAgPSBncm91cDsKCiAgICAJCX0KCiAgICAJCXJlbmRlckl0ZW1zSW5kZXggKys7CgogICAgCQlyZXR1cm4gcmVuZGVySXRlbTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBwdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKSB7CgogICAgCQljb25zdCByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApOwoKICAgIAkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwLjAgKSB7CgogICAgCQkJdHJhbnNtaXNzaXZlLnB1c2goIHJlbmRlckl0ZW0gKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICkgewoKICAgIAkJCXRyYW5zcGFyZW50LnB1c2goIHJlbmRlckl0ZW0gKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJb3BhcXVlLnB1c2goIHJlbmRlckl0ZW0gKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1bnNoaWZ0KCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKSB7CgogICAgCQljb25zdCByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApOwoKICAgIAkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwLjAgKSB7CgogICAgCQkJdHJhbnNtaXNzaXZlLnVuc2hpZnQoIHJlbmRlckl0ZW0gKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICkgewoKICAgIAkJCXRyYW5zcGFyZW50LnVuc2hpZnQoIHJlbmRlckl0ZW0gKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJb3BhcXVlLnVuc2hpZnQoIHJlbmRlckl0ZW0gKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzb3J0KCBjdXN0b21PcGFxdWVTb3J0LCBjdXN0b21UcmFuc3BhcmVudFNvcnQgKSB7CgogICAgCQlpZiAoIG9wYXF1ZS5sZW5ndGggPiAxICkgb3BhcXVlLnNvcnQoIGN1c3RvbU9wYXF1ZVNvcnQgfHwgcGFpbnRlclNvcnRTdGFibGUgKTsKICAgIAkJaWYgKCB0cmFuc21pc3NpdmUubGVuZ3RoID4gMSApIHRyYW5zbWlzc2l2ZS5zb3J0KCBjdXN0b21UcmFuc3BhcmVudFNvcnQgfHwgcmV2ZXJzZVBhaW50ZXJTb3J0U3RhYmxlICk7CiAgICAJCWlmICggdHJhbnNwYXJlbnQubGVuZ3RoID4gMSApIHRyYW5zcGFyZW50LnNvcnQoIGN1c3RvbVRyYW5zcGFyZW50U29ydCB8fCByZXZlcnNlUGFpbnRlclNvcnRTdGFibGUgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBmaW5pc2goKSB7CgogICAgCQkvLyBDbGVhciByZWZlcmVuY2VzIGZyb20gaW5hY3RpdmUgcmVuZGVySXRlbXMgaW4gdGhlIGxpc3QKCiAgICAJCWZvciAoIGxldCBpID0gcmVuZGVySXRlbXNJbmRleCwgaWwgPSByZW5kZXJJdGVtcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQljb25zdCByZW5kZXJJdGVtID0gcmVuZGVySXRlbXNbIGkgXTsKCiAgICAJCQlpZiAoIHJlbmRlckl0ZW0uaWQgPT09IG51bGwgKSBicmVhazsKCiAgICAJCQlyZW5kZXJJdGVtLmlkID0gbnVsbDsKICAgIAkJCXJlbmRlckl0ZW0ub2JqZWN0ID0gbnVsbDsKICAgIAkJCXJlbmRlckl0ZW0uZ2VvbWV0cnkgPSBudWxsOwogICAgCQkJcmVuZGVySXRlbS5tYXRlcmlhbCA9IG51bGw7CiAgICAJCQlyZW5kZXJJdGVtLmdyb3VwID0gbnVsbDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gewoKICAgIAkJb3BhcXVlOiBvcGFxdWUsCiAgICAJCXRyYW5zbWlzc2l2ZTogdHJhbnNtaXNzaXZlLAogICAgCQl0cmFuc3BhcmVudDogdHJhbnNwYXJlbnQsCgogICAgCQlpbml0OiBpbml0LAogICAgCQlwdXNoOiBwdXNoLAogICAgCQl1bnNoaWZ0OiB1bnNoaWZ0LAogICAgCQlmaW5pc2g6IGZpbmlzaCwKCiAgICAJCXNvcnQ6IHNvcnQKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTFJlbmRlckxpc3RzKCkgewoKICAgIAlsZXQgbGlzdHMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlmdW5jdGlvbiBnZXQoIHNjZW5lLCByZW5kZXJDYWxsRGVwdGggKSB7CgogICAgCQljb25zdCBsaXN0QXJyYXkgPSBsaXN0cy5nZXQoIHNjZW5lICk7CiAgICAJCWxldCBsaXN0OwoKICAgIAkJaWYgKCBsaXN0QXJyYXkgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlsaXN0ID0gbmV3IFdlYkdMUmVuZGVyTGlzdCgpOwogICAgCQkJbGlzdHMuc2V0KCBzY2VuZSwgWyBsaXN0IF0gKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJaWYgKCByZW5kZXJDYWxsRGVwdGggPj0gbGlzdEFycmF5Lmxlbmd0aCApIHsKCiAgICAJCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKICAgIAkJCQlsaXN0QXJyYXkucHVzaCggbGlzdCApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWxpc3QgPSBsaXN0QXJyYXlbIHJlbmRlckNhbGxEZXB0aCBdOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiBsaXN0OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgogICAgCQlsaXN0cyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJZ2V0OiBnZXQsCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBVbmlmb3Jtc0NhY2hlKCkgewoKICAgIAljb25zdCBsaWdodHMgPSB7fTsKCiAgICAJcmV0dXJuIHsKCiAgICAJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCiAgICAJCQlpZiAoIGxpZ2h0c1sgbGlnaHQuaWQgXSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKICAgIAkJCX0KCiAgICAJCQlsZXQgdW5pZm9ybXM7CgogICAgCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCiAgICAJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CiAgICAJCQkJCXVuaWZvcm1zID0gewogICAgCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpCiAgICAJCQkJCX07CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlICdTcG90TGlnaHQnOgogICAgCQkJCQl1bmlmb3JtcyA9IHsKICAgIAkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAogICAgCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpLAogICAgCQkJCQkJZGlzdGFuY2U6IDAsCiAgICAJCQkJCQljb25lQ29zOiAwLAogICAgCQkJCQkJcGVudW1icmFDb3M6IDAsCiAgICAJCQkJCQlkZWNheTogMAogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSAnUG9pbnRMaWdodCc6CiAgICAJCQkJCXVuaWZvcm1zID0gewogICAgCQkJCQkJcG9zaXRpb246IG5ldyBWZWN0b3IzKCksCiAgICAJCQkJCQljb2xvcjogbmV3IENvbG9yKCksCiAgICAJCQkJCQlkaXN0YW5jZTogMCwKICAgIAkJCQkJCWRlY2F5OiAwCiAgICAJCQkJCX07CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlICdIZW1pc3BoZXJlTGlnaHQnOgogICAgCQkJCQl1bmlmb3JtcyA9IHsKICAgIAkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKICAgIAkJCQkJCXNreUNvbG9yOiBuZXcgQ29sb3IoKSwKICAgIAkJCQkJCWdyb3VuZENvbG9yOiBuZXcgQ29sb3IoKQogICAgCQkJCQl9OwogICAgCQkJCQlicmVhazsKCiAgICAJCQkJY2FzZSAnUmVjdEFyZWFMaWdodCc6CiAgICAJCQkJCXVuaWZvcm1zID0gewogICAgCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpLAogICAgCQkJCQkJcG9zaXRpb246IG5ldyBWZWN0b3IzKCksCiAgICAJCQkJCQloYWxmV2lkdGg6IG5ldyBWZWN0b3IzKCksCiAgICAJCQkJCQloYWxmSGVpZ2h0OiBuZXcgVmVjdG9yMygpCiAgICAJCQkJCX07CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCX0KCiAgICAJCQlsaWdodHNbIGxpZ2h0LmlkIF0gPSB1bmlmb3JtczsKCiAgICAJCQlyZXR1cm4gdW5pZm9ybXM7CgogICAgCQl9CgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFNoYWRvd1VuaWZvcm1zQ2FjaGUoKSB7CgogICAgCWNvbnN0IGxpZ2h0cyA9IHt9OwoKICAgIAlyZXR1cm4gewoKICAgIAkJZ2V0OiBmdW5jdGlvbiAoIGxpZ2h0ICkgewoKICAgIAkJCWlmICggbGlnaHRzWyBsaWdodC5pZCBdICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCXJldHVybiBsaWdodHNbIGxpZ2h0LmlkIF07CgogICAgCQkJfQoKICAgIAkJCWxldCB1bmlmb3JtczsKCiAgICAJCQlzd2l0Y2ggKCBsaWdodC50eXBlICkgewoKICAgIAkJCQljYXNlICdEaXJlY3Rpb25hbExpZ2h0JzoKICAgIAkJCQkJdW5pZm9ybXMgPSB7CiAgICAJCQkJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCiAgICAJCQkJCQlzaGFkb3dCaWFzOiAwLAogICAgCQkJCQkJc2hhZG93Tm9ybWFsQmlhczogMCwKICAgIAkJCQkJCXNoYWRvd1JhZGl1czogMSwKICAgIAkJCQkJCXNoYWRvd01hcFNpemU6IG5ldyBWZWN0b3IyKCkKICAgIAkJCQkJfTsKICAgIAkJCQkJYnJlYWs7CgogICAgCQkJCWNhc2UgJ1Nwb3RMaWdodCc6CiAgICAJCQkJCXVuaWZvcm1zID0gewogICAgCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAogICAgCQkJCQkJc2hhZG93QmlhczogMCwKICAgIAkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCiAgICAJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCiAgICAJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCiAgICAJCQkJCX07CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQljYXNlICdQb2ludExpZ2h0JzoKICAgIAkJCQkJdW5pZm9ybXMgPSB7CiAgICAJCQkJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCiAgICAJCQkJCQlzaGFkb3dCaWFzOiAwLAogICAgCQkJCQkJc2hhZG93Tm9ybWFsQmlhczogMCwKICAgIAkJCQkJCXNoYWRvd1JhZGl1czogMSwKICAgIAkJCQkJCXNoYWRvd01hcFNpemU6IG5ldyBWZWN0b3IyKCksCiAgICAJCQkJCQlzaGFkb3dDYW1lcmFOZWFyOiAxLAogICAgCQkJCQkJc2hhZG93Q2FtZXJhRmFyOiAxMDAwCiAgICAJCQkJCX07CiAgICAJCQkJCWJyZWFrOwoKICAgIAkJCQkvLyBUT0RPIChhYmVsbmF0aW9uKTogc2V0IFJlY3RBcmVhTGlnaHQgc2hhZG93IHVuaWZvcm1zCgogICAgCQkJfQoKICAgIAkJCWxpZ2h0c1sgbGlnaHQuaWQgXSA9IHVuaWZvcm1zOwoKICAgIAkJCXJldHVybiB1bmlmb3JtczsKCiAgICAJCX0KCiAgICAJfTsKCiAgICB9CgoKCiAgICBsZXQgbmV4dFZlcnNpb24gPSAwOwoKICAgIGZ1bmN0aW9uIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCggbGlnaHRBLCBsaWdodEIgKSB7CgogICAgCXJldHVybiAoIGxpZ2h0Qi5jYXN0U2hhZG93ID8gMiA6IDAgKSAtICggbGlnaHRBLmNhc3RTaGFkb3cgPyAyIDogMCApICsgKCBsaWdodEIubWFwID8gMSA6IDAgKSAtICggbGlnaHRBLm1hcCA/IDEgOiAwICk7CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMTGlnaHRzKCBleHRlbnNpb25zICkgewoKICAgIAljb25zdCBjYWNoZSA9IG5ldyBVbmlmb3Jtc0NhY2hlKCk7CgogICAgCWNvbnN0IHNoYWRvd0NhY2hlID0gU2hhZG93VW5pZm9ybXNDYWNoZSgpOwoKICAgIAljb25zdCBzdGF0ZSA9IHsKCiAgICAJCXZlcnNpb246IDAsCgogICAgCQloYXNoOiB7CiAgICAJCQlkaXJlY3Rpb25hbExlbmd0aDogLTEsCiAgICAJCQlwb2ludExlbmd0aDogLTEsCiAgICAJCQlzcG90TGVuZ3RoOiAtMSwKICAgIAkJCXJlY3RBcmVhTGVuZ3RoOiAtMSwKICAgIAkJCWhlbWlMZW5ndGg6IC0xLAoKICAgIAkJCW51bURpcmVjdGlvbmFsU2hhZG93czogLTEsCiAgICAJCQludW1Qb2ludFNoYWRvd3M6IC0xLAogICAgCQkJbnVtU3BvdFNoYWRvd3M6IC0xLAogICAgCQkJbnVtU3BvdE1hcHM6IC0xLAoKICAgIAkJCW51bUxpZ2h0UHJvYmVzOiAtMQogICAgCQl9LAoKICAgIAkJYW1iaWVudDogWyAwLCAwLCAwIF0sCiAgICAJCXByb2JlOiBbXSwKICAgIAkJZGlyZWN0aW9uYWw6IFtdLAogICAgCQlkaXJlY3Rpb25hbFNoYWRvdzogW10sCiAgICAJCWRpcmVjdGlvbmFsU2hhZG93TWFwOiBbXSwKICAgIAkJZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IFtdLAogICAgCQlzcG90OiBbXSwKICAgIAkJc3BvdExpZ2h0TWFwOiBbXSwKICAgIAkJc3BvdFNoYWRvdzogW10sCiAgICAJCXNwb3RTaGFkb3dNYXA6IFtdLAogICAgCQlzcG90TGlnaHRNYXRyaXg6IFtdLAogICAgCQlyZWN0QXJlYTogW10sCiAgICAJCXJlY3RBcmVhTFRDMTogbnVsbCwKICAgIAkJcmVjdEFyZWFMVEMyOiBudWxsLAogICAgCQlwb2ludDogW10sCiAgICAJCXBvaW50U2hhZG93OiBbXSwKICAgIAkJcG9pbnRTaGFkb3dNYXA6IFtdLAogICAgCQlwb2ludFNoYWRvd01hdHJpeDogW10sCiAgICAJCWhlbWk6IFtdLAogICAgCQludW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHM6IDAsCiAgICAJCW51bUxpZ2h0UHJvYmVzOiAwCgogICAgCX07CgogICAgCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSBzdGF0ZS5wcm9iZS5wdXNoKCBuZXcgVmVjdG9yMygpICk7CgogICAgCWNvbnN0IHZlY3RvcjMgPSBuZXcgVmVjdG9yMygpOwogICAgCWNvbnN0IG1hdHJpeDQgPSBuZXcgTWF0cml4NCgpOwogICAgCWNvbnN0IG1hdHJpeDQyID0gbmV3IE1hdHJpeDQoKTsKCiAgICAJZnVuY3Rpb24gc2V0dXAoIGxpZ2h0cyApIHsKCiAgICAJCWxldCByID0gMCwgZyA9IDAsIGIgPSAwOwoKICAgIAkJZm9yICggbGV0IGkgPSAwOyBpIDwgOTsgaSArKyApIHN0YXRlLnByb2JlWyBpIF0uc2V0KCAwLCAwLCAwICk7CgogICAgCQlsZXQgZGlyZWN0aW9uYWxMZW5ndGggPSAwOwogICAgCQlsZXQgcG9pbnRMZW5ndGggPSAwOwogICAgCQlsZXQgc3BvdExlbmd0aCA9IDA7CiAgICAJCWxldCByZWN0QXJlYUxlbmd0aCA9IDA7CiAgICAJCWxldCBoZW1pTGVuZ3RoID0gMDsKCiAgICAJCWxldCBudW1EaXJlY3Rpb25hbFNoYWRvd3MgPSAwOwogICAgCQlsZXQgbnVtUG9pbnRTaGFkb3dzID0gMDsKICAgIAkJbGV0IG51bVNwb3RTaGFkb3dzID0gMDsKICAgIAkJbGV0IG51bVNwb3RNYXBzID0gMDsKICAgIAkJbGV0IG51bVNwb3RTaGFkb3dzV2l0aE1hcHMgPSAwOwoKICAgIAkJbGV0IG51bUxpZ2h0UHJvYmVzID0gMDsKCiAgICAJCS8vIG9yZGVyaW5nIDogW3NoYWRvdyBjYXN0aW5nICsgbWFwIHRleHR1cmluZywgbWFwIHRleHR1cmluZywgc2hhZG93IGNhc3RpbmcsIG5vbmUgXQogICAgCQlsaWdodHMuc29ydCggc2hhZG93Q2FzdGluZ0FuZFRleHR1cmluZ0xpZ2h0c0ZpcnN0ICk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBsaWdodHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQljb25zdCBsaWdodCA9IGxpZ2h0c1sgaSBdOwoKICAgIAkJCWNvbnN0IGNvbG9yID0gbGlnaHQuY29sb3I7CiAgICAJCQljb25zdCBpbnRlbnNpdHkgPSBsaWdodC5pbnRlbnNpdHk7CiAgICAJCQljb25zdCBkaXN0YW5jZSA9IGxpZ2h0LmRpc3RhbmNlOwoKICAgIAkJCWNvbnN0IHNoYWRvd01hcCA9ICggbGlnaHQuc2hhZG93ICYmIGxpZ2h0LnNoYWRvdy5tYXAgKSA/IGxpZ2h0LnNoYWRvdy5tYXAudGV4dHVyZSA6IG51bGw7CgogICAgCQkJaWYgKCBsaWdodC5pc0FtYmllbnRMaWdodCApIHsKCiAgICAJCQkJciArPSBjb2xvci5yICogaW50ZW5zaXR5OwogICAgCQkJCWcgKz0gY29sb3IuZyAqIGludGVuc2l0eTsKICAgIAkJCQliICs9IGNvbG9yLmIgKiBpbnRlbnNpdHk7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNMaWdodFByb2JlICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCA5OyBqICsrICkgewoKICAgIAkJCQkJc3RhdGUucHJvYmVbIGogXS5hZGRTY2FsZWRWZWN0b3IoIGxpZ2h0LnNoLmNvZWZmaWNpZW50c1sgaiBdLCBpbnRlbnNpdHkgKTsKCiAgICAJCQkJfQoKICAgIAkJCQludW1MaWdodFByb2JlcyArKzsKCiAgICAJCQl9IGVsc2UgaWYgKCBsaWdodC5pc0RpcmVjdGlvbmFsTGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKTsKCiAgICAJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKICAgIAkJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKICAgIAkJCQkJY29uc3Qgc2hhZG93VW5pZm9ybXMgPSBzaGFkb3dDYWNoZS5nZXQoIGxpZ2h0ICk7CgogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dJbnRlbnNpdHkgPSBzaGFkb3cuaW50ZW5zaXR5OwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93UmFkaXVzID0gc2hhZG93LnJhZGl1czsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93TWFwU2l6ZSA9IHNoYWRvdy5tYXBTaXplOwoKICAgIAkJCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSBzaGFkb3dVbmlmb3JtczsKICAgIAkJCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSBzaGFkb3dNYXA7CiAgICAJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBkaXJlY3Rpb25hbExlbmd0aCBdID0gbGlnaHQuc2hhZG93Lm1hdHJpeDsKCiAgICAJCQkJCW51bURpcmVjdGlvbmFsU2hhZG93cyArKzsKCiAgICAJCQkJfQoKICAgIAkJCQlzdGF0ZS5kaXJlY3Rpb25hbFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IHVuaWZvcm1zOwoKICAgIAkJCQlkaXJlY3Rpb25hbExlbmd0aCArKzsKCiAgICAJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1Nwb3RMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgogICAgCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCiAgICAJCQkJdW5pZm9ybXMuY29sb3IuY29weSggY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CiAgICAJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCiAgICAJCQkJdW5pZm9ybXMuY29uZUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSApOwogICAgCQkJCXVuaWZvcm1zLnBlbnVtYnJhQ29zID0gTWF0aC5jb3MoIGxpZ2h0LmFuZ2xlICogKCAxIC0gbGlnaHQucGVudW1icmEgKSApOwogICAgCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgogICAgCQkJCXN0YXRlLnNwb3RbIHNwb3RMZW5ndGggXSA9IHVuaWZvcm1zOwoKICAgIAkJCQljb25zdCBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CgogICAgCQkJCWlmICggbGlnaHQubWFwICkgewoKICAgIAkJCQkJc3RhdGUuc3BvdExpZ2h0TWFwWyBudW1TcG90TWFwcyBdID0gbGlnaHQubWFwOwogICAgCQkJCQludW1TcG90TWFwcyArKzsKCiAgICAJCQkJCS8vIG1ha2Ugc3VyZSB0aGUgbGlnaHRNYXRyaXggaXMgdXAgdG8gZGF0ZQogICAgCQkJCQkvLyBUT0RPIDogZG8gaXQgaWYgcmVxdWlyZWQgb25seQogICAgCQkJCQlzaGFkb3cudXBkYXRlTWF0cmljZXMoIGxpZ2h0ICk7CgogICAgCQkJCQlpZiAoIGxpZ2h0LmNhc3RTaGFkb3cgKSBudW1TcG90U2hhZG93c1dpdGhNYXBzICsrOwoKICAgIAkJCQl9CgogICAgCQkJCXN0YXRlLnNwb3RMaWdodE1hdHJpeFsgc3BvdExlbmd0aCBdID0gc2hhZG93Lm1hdHJpeDsKCiAgICAJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKICAgIAkJCQkJY29uc3Qgc2hhZG93VW5pZm9ybXMgPSBzaGFkb3dDYWNoZS5nZXQoIGxpZ2h0ICk7CgogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dJbnRlbnNpdHkgPSBzaGFkb3cuaW50ZW5zaXR5OwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93UmFkaXVzID0gc2hhZG93LnJhZGl1czsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93TWFwU2l6ZSA9IHNoYWRvdy5tYXBTaXplOwoKICAgIAkJCQkJc3RhdGUuc3BvdFNoYWRvd1sgc3BvdExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CiAgICAJCQkJCXN0YXRlLnNwb3RTaGFkb3dNYXBbIHNwb3RMZW5ndGggXSA9IHNoYWRvd01hcDsKCiAgICAJCQkJCW51bVNwb3RTaGFkb3dzICsrOwoKICAgIAkJCQl9CgogICAgCQkJCXNwb3RMZW5ndGggKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNSZWN0QXJlYUxpZ2h0ICkgewoKICAgIAkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCiAgICAJCQkJdW5pZm9ybXMuY29sb3IuY29weSggY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgogICAgCQkJCXVuaWZvcm1zLmhhbGZXaWR0aC5zZXQoIGxpZ2h0LndpZHRoICogMC41LCAwLjAsIDAuMCApOwogICAgCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuc2V0KCAwLjAsIGxpZ2h0LmhlaWdodCAqIDAuNSwgMC4wICk7CgogICAgCQkJCXN0YXRlLnJlY3RBcmVhWyByZWN0QXJlYUxlbmd0aCBdID0gdW5pZm9ybXM7CgogICAgCQkJCXJlY3RBcmVhTGVuZ3RoICsrOwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgogICAgCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGxpZ2h0LmNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGxpZ2h0LmludGVuc2l0eSApOwogICAgCQkJCXVuaWZvcm1zLmRpc3RhbmNlID0gbGlnaHQuZGlzdGFuY2U7CiAgICAJCQkJdW5pZm9ybXMuZGVjYXkgPSBsaWdodC5kZWNheTsKCiAgICAJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKICAgIAkJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKICAgIAkJCQkJY29uc3Qgc2hhZG93VW5pZm9ybXMgPSBzaGFkb3dDYWNoZS5nZXQoIGxpZ2h0ICk7CgogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dJbnRlbnNpdHkgPSBzaGFkb3cuaW50ZW5zaXR5OwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CiAgICAJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93UmFkaXVzID0gc2hhZG93LnJhZGl1czsKICAgIAkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93TWFwU2l6ZSA9IHNoYWRvdy5tYXBTaXplOwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dDYW1lcmFOZWFyID0gc2hhZG93LmNhbWVyYS5uZWFyOwogICAgCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dDYW1lcmFGYXIgPSBzaGFkb3cuY2FtZXJhLmZhcjsKCiAgICAJCQkJCXN0YXRlLnBvaW50U2hhZG93WyBwb2ludExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CiAgICAJCQkJCXN0YXRlLnBvaW50U2hhZG93TWFwWyBwb2ludExlbmd0aCBdID0gc2hhZG93TWFwOwogICAgCQkJCQlzdGF0ZS5wb2ludFNoYWRvd01hdHJpeFsgcG9pbnRMZW5ndGggXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CgogICAgCQkJCQludW1Qb2ludFNoYWRvd3MgKys7CgogICAgCQkJCX0KCiAgICAJCQkJc3RhdGUucG9pbnRbIHBvaW50TGVuZ3RoIF0gPSB1bmlmb3JtczsKCiAgICAJCQkJcG9pbnRMZW5ndGggKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKICAgIAkJCQl1bmlmb3Jtcy5za3lDb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKTsKICAgIAkJCQl1bmlmb3Jtcy5ncm91bmRDb2xvci5jb3B5KCBsaWdodC5ncm91bmRDb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKTsKCiAgICAJCQkJc3RhdGUuaGVtaVsgaGVtaUxlbmd0aCBdID0gdW5pZm9ybXM7CgogICAgCQkJCWhlbWlMZW5ndGggKys7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCByZWN0QXJlYUxlbmd0aCA+IDAgKSB7CgogICAgCQkJaWYgKCBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKSA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJc3RhdGUucmVjdEFyZWFMVEMxID0gVW5pZm9ybXNMaWIuTFRDX0ZMT0FUXzE7CiAgICAJCQkJc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0ZMT0FUXzI7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJc3RhdGUucmVjdEFyZWFMVEMxID0gVW5pZm9ybXNMaWIuTFRDX0hBTEZfMTsKICAgIAkJCQlzdGF0ZS5yZWN0QXJlYUxUQzIgPSBVbmlmb3Jtc0xpYi5MVENfSEFMRl8yOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXN0YXRlLmFtYmllbnRbIDAgXSA9IHI7CiAgICAJCXN0YXRlLmFtYmllbnRbIDEgXSA9IGc7CiAgICAJCXN0YXRlLmFtYmllbnRbIDIgXSA9IGI7CgogICAgCQljb25zdCBoYXNoID0gc3RhdGUuaGFzaDsKCiAgICAJCWlmICggaGFzaC5kaXJlY3Rpb25hbExlbmd0aCAhPT0gZGlyZWN0aW9uYWxMZW5ndGggfHwKICAgIAkJCWhhc2gucG9pbnRMZW5ndGggIT09IHBvaW50TGVuZ3RoIHx8CiAgICAJCQloYXNoLnNwb3RMZW5ndGggIT09IHNwb3RMZW5ndGggfHwKICAgIAkJCWhhc2gucmVjdEFyZWFMZW5ndGggIT09IHJlY3RBcmVhTGVuZ3RoIHx8CiAgICAJCQloYXNoLmhlbWlMZW5ndGggIT09IGhlbWlMZW5ndGggfHwKICAgIAkJCWhhc2gubnVtRGlyZWN0aW9uYWxTaGFkb3dzICE9PSBudW1EaXJlY3Rpb25hbFNoYWRvd3MgfHwKICAgIAkJCWhhc2gubnVtUG9pbnRTaGFkb3dzICE9PSBudW1Qb2ludFNoYWRvd3MgfHwKICAgIAkJCWhhc2gubnVtU3BvdFNoYWRvd3MgIT09IG51bVNwb3RTaGFkb3dzIHx8CiAgICAJCQloYXNoLm51bVNwb3RNYXBzICE9PSBudW1TcG90TWFwcyB8fAogICAgCQkJaGFzaC5udW1MaWdodFByb2JlcyAhPT0gbnVtTGlnaHRQcm9iZXMgKSB7CgogICAgCQkJc3RhdGUuZGlyZWN0aW9uYWwubGVuZ3RoID0gZGlyZWN0aW9uYWxMZW5ndGg7CiAgICAJCQlzdGF0ZS5zcG90Lmxlbmd0aCA9IHNwb3RMZW5ndGg7CiAgICAJCQlzdGF0ZS5yZWN0QXJlYS5sZW5ndGggPSByZWN0QXJlYUxlbmd0aDsKICAgIAkJCXN0YXRlLnBvaW50Lmxlbmd0aCA9IHBvaW50TGVuZ3RoOwogICAgCQkJc3RhdGUuaGVtaS5sZW5ndGggPSBoZW1pTGVuZ3RoOwoKICAgIAkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93Lmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKICAgIAkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKICAgIAkJCXN0YXRlLnBvaW50U2hhZG93Lmxlbmd0aCA9IG51bVBvaW50U2hhZG93czsKICAgIAkJCXN0YXRlLnBvaW50U2hhZG93TWFwLmxlbmd0aCA9IG51bVBvaW50U2hhZG93czsKICAgIAkJCXN0YXRlLnNwb3RTaGFkb3cubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CiAgICAJCQlzdGF0ZS5zcG90U2hhZG93TWFwLmxlbmd0aCA9IG51bVNwb3RTaGFkb3dzOwogICAgCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXgubGVuZ3RoID0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzOwogICAgCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXgubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwogICAgCQkJc3RhdGUuc3BvdExpZ2h0TWF0cml4Lmxlbmd0aCA9IG51bVNwb3RTaGFkb3dzICsgbnVtU3BvdE1hcHMgLSBudW1TcG90U2hhZG93c1dpdGhNYXBzOwogICAgCQkJc3RhdGUuc3BvdExpZ2h0TWFwLmxlbmd0aCA9IG51bVNwb3RNYXBzOwogICAgCQkJc3RhdGUubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzID0gbnVtU3BvdFNoYWRvd3NXaXRoTWFwczsKICAgIAkJCXN0YXRlLm51bUxpZ2h0UHJvYmVzID0gbnVtTGlnaHRQcm9iZXM7CgogICAgCQkJaGFzaC5kaXJlY3Rpb25hbExlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwogICAgCQkJaGFzaC5wb2ludExlbmd0aCA9IHBvaW50TGVuZ3RoOwogICAgCQkJaGFzaC5zcG90TGVuZ3RoID0gc3BvdExlbmd0aDsKICAgIAkJCWhhc2gucmVjdEFyZWFMZW5ndGggPSByZWN0QXJlYUxlbmd0aDsKICAgIAkJCWhhc2guaGVtaUxlbmd0aCA9IGhlbWlMZW5ndGg7CgogICAgCQkJaGFzaC5udW1EaXJlY3Rpb25hbFNoYWRvd3MgPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CiAgICAJCQloYXNoLm51bVBvaW50U2hhZG93cyA9IG51bVBvaW50U2hhZG93czsKICAgIAkJCWhhc2gubnVtU3BvdFNoYWRvd3MgPSBudW1TcG90U2hhZG93czsKICAgIAkJCWhhc2gubnVtU3BvdE1hcHMgPSBudW1TcG90TWFwczsKCiAgICAJCQloYXNoLm51bUxpZ2h0UHJvYmVzID0gbnVtTGlnaHRQcm9iZXM7CgogICAgCQkJc3RhdGUudmVyc2lvbiA9IG5leHRWZXJzaW9uICsrOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldHVwVmlldyggbGlnaHRzLCBjYW1lcmEgKSB7CgogICAgCQlsZXQgZGlyZWN0aW9uYWxMZW5ndGggPSAwOwogICAgCQlsZXQgcG9pbnRMZW5ndGggPSAwOwogICAgCQlsZXQgc3BvdExlbmd0aCA9IDA7CiAgICAJCWxldCByZWN0QXJlYUxlbmd0aCA9IDA7CiAgICAJCWxldCBoZW1pTGVuZ3RoID0gMDsKCiAgICAJCWNvbnN0IHZpZXdNYXRyaXggPSBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgbGlnaHQgPSBsaWdodHNbIGkgXTsKCiAgICAJCQlpZiAoIGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5kaXJlY3Rpb25hbFsgZGlyZWN0aW9uYWxMZW5ndGggXTsKCiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKICAgIAkJCQl2ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnN1YiggdmVjdG9yMyApOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCiAgICAJCQkJZGlyZWN0aW9uYWxMZW5ndGggKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNTcG90TGlnaHQgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuc3BvdFsgc3BvdExlbmd0aCBdOwoKICAgIAkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJdW5pZm9ybXMucG9zaXRpb24uYXBwbHlNYXRyaXg0KCB2aWV3TWF0cml4ICk7CgogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zdWIoIHZlY3RvcjMgKTsKICAgIAkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCB2aWV3TWF0cml4ICk7CgogICAgCQkJCXNwb3RMZW5ndGggKys7CgogICAgCQkJfSBlbHNlIGlmICggbGlnaHQuaXNSZWN0QXJlYUxpZ2h0ICkgewoKICAgIAkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnJlY3RBcmVhWyByZWN0QXJlYUxlbmd0aCBdOwoKICAgIAkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJdW5pZm9ybXMucG9zaXRpb24uYXBwbHlNYXRyaXg0KCB2aWV3TWF0cml4ICk7CgogICAgCQkJCS8vIGV4dHJhY3QgbG9jYWwgcm90YXRpb24gb2YgbGlnaHQgdG8gZGVyaXZlIHdpZHRoL2hlaWdodCBoYWxmIHZlY3RvcnMKICAgIAkJCQltYXRyaXg0Mi5pZGVudGl0eSgpOwogICAgCQkJCW1hdHJpeDQuY29weSggbGlnaHQubWF0cml4V29ybGQgKTsKICAgIAkJCQltYXRyaXg0LnByZW11bHRpcGx5KCB2aWV3TWF0cml4ICk7CiAgICAJCQkJbWF0cml4NDIuZXh0cmFjdFJvdGF0aW9uKCBtYXRyaXg0ICk7CgogICAgCQkJCXVuaWZvcm1zLmhhbGZXaWR0aC5zZXQoIGxpZ2h0LndpZHRoICogMC41LCAwLjAsIDAuMCApOwogICAgCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuc2V0KCAwLjAsIGxpZ2h0LmhlaWdodCAqIDAuNSwgMC4wICk7CgogICAgCQkJCXVuaWZvcm1zLmhhbGZXaWR0aC5hcHBseU1hdHJpeDQoIG1hdHJpeDQyICk7CiAgICAJCQkJdW5pZm9ybXMuaGFsZkhlaWdodC5hcHBseU1hdHJpeDQoIG1hdHJpeDQyICk7CgogICAgCQkJCXJlY3RBcmVhTGVuZ3RoICsrOwoKICAgIAkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5wb2ludFsgcG9pbnRMZW5ndGggXTsKCiAgICAJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwogICAgCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKICAgIAkJCQlwb2ludExlbmd0aCArKzsKCiAgICAJCQl9IGVsc2UgaWYgKCBsaWdodC5pc0hlbWlzcGhlcmVMaWdodCApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5oZW1pWyBoZW1pTGVuZ3RoIF07CgogICAgCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKICAgIAkJCQloZW1pTGVuZ3RoICsrOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAlyZXR1cm4gewogICAgCQlzZXR1cDogc2V0dXAsCiAgICAJCXNldHVwVmlldzogc2V0dXBWaWV3LAogICAgCQlzdGF0ZTogc3RhdGUKICAgIAl9OwoKICAgIH0KCiAgICBmdW5jdGlvbiBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICkgewoKICAgIAljb25zdCBsaWdodHMgPSBuZXcgV2ViR0xMaWdodHMoIGV4dGVuc2lvbnMgKTsKCiAgICAJY29uc3QgbGlnaHRzQXJyYXkgPSBbXTsKICAgIAljb25zdCBzaGFkb3dzQXJyYXkgPSBbXTsKCiAgICAJZnVuY3Rpb24gaW5pdCggY2FtZXJhICkgewoKICAgIAkJc3RhdGUuY2FtZXJhID0gY2FtZXJhOwoKICAgIAkJbGlnaHRzQXJyYXkubGVuZ3RoID0gMDsKICAgIAkJc2hhZG93c0FycmF5Lmxlbmd0aCA9IDA7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcHVzaExpZ2h0KCBsaWdodCApIHsKCiAgICAJCWxpZ2h0c0FycmF5LnB1c2goIGxpZ2h0ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcHVzaFNoYWRvdyggc2hhZG93TGlnaHQgKSB7CgogICAgCQlzaGFkb3dzQXJyYXkucHVzaCggc2hhZG93TGlnaHQgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXR1cExpZ2h0cygpIHsKCiAgICAJCWxpZ2h0cy5zZXR1cCggbGlnaHRzQXJyYXkgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApIHsKCiAgICAJCWxpZ2h0cy5zZXR1cFZpZXcoIGxpZ2h0c0FycmF5LCBjYW1lcmEgKTsKCiAgICAJfQoKICAgIAljb25zdCBzdGF0ZSA9IHsKICAgIAkJbGlnaHRzQXJyYXk6IGxpZ2h0c0FycmF5LAogICAgCQlzaGFkb3dzQXJyYXk6IHNoYWRvd3NBcnJheSwKCiAgICAJCWNhbWVyYTogbnVsbCwKCiAgICAJCWxpZ2h0czogbGlnaHRzLAoKICAgIAkJdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0OiB7fQogICAgCX07CgogICAgCXJldHVybiB7CiAgICAJCWluaXQ6IGluaXQsCiAgICAJCXN0YXRlOiBzdGF0ZSwKICAgIAkJc2V0dXBMaWdodHM6IHNldHVwTGlnaHRzLAogICAgCQlzZXR1cExpZ2h0c1ZpZXc6IHNldHVwTGlnaHRzVmlldywKCiAgICAJCXB1c2hMaWdodDogcHVzaExpZ2h0LAogICAgCQlwdXNoU2hhZG93OiBwdXNoU2hhZG93CiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZXMoIGV4dGVuc2lvbnMgKSB7CgogICAgCWxldCByZW5kZXJTdGF0ZXMgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlmdW5jdGlvbiBnZXQoIHNjZW5lLCByZW5kZXJDYWxsRGVwdGggPSAwICkgewoKICAgIAkJY29uc3QgcmVuZGVyU3RhdGVBcnJheSA9IHJlbmRlclN0YXRlcy5nZXQoIHNjZW5lICk7CiAgICAJCWxldCByZW5kZXJTdGF0ZTsKCiAgICAJCWlmICggcmVuZGVyU3RhdGVBcnJheSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoIGV4dGVuc2lvbnMgKTsKICAgIAkJCXJlbmRlclN0YXRlcy5zZXQoIHNjZW5lLCBbIHJlbmRlclN0YXRlIF0gKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJaWYgKCByZW5kZXJDYWxsRGVwdGggPj0gcmVuZGVyU3RhdGVBcnJheS5sZW5ndGggKSB7CgogICAgCQkJCXJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoIGV4dGVuc2lvbnMgKTsKICAgIAkJCQlyZW5kZXJTdGF0ZUFycmF5LnB1c2goIHJlbmRlclN0YXRlICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZUFycmF5WyByZW5kZXJDYWxsRGVwdGggXTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gcmVuZGVyU3RhdGU7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCiAgICAJCXJlbmRlclN0YXRlcyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCX0KCiAgICAJcmV0dXJuIHsKICAgIAkJZ2V0OiBnZXQsCiAgICAJCWRpc3Bvc2U6IGRpc3Bvc2UKICAgIAl9OwoKICAgIH0KCiAgICBjb25zdCB2ZXJ0ZXggPSAidm9pZCBtYWluKCkge1xuXHRnbF9Qb3NpdGlvbiA9IHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbn0iOwoKICAgIGNvbnN0IGZyYWdtZW50ID0gInVuaWZvcm0gc2FtcGxlcjJEIHNoYWRvd19wYXNzO1xudW5pZm9ybSB2ZWMyIHJlc29sdXRpb247XG51bmlmb3JtIGZsb2F0IHJhZGl1cztcbiNpbmNsdWRlIDxwYWNraW5nPlxudm9pZCBtYWluKCkge1xuXHRjb25zdCBmbG9hdCBzYW1wbGVzID0gZmxvYXQoIFZTTV9TQU1QTEVTICk7XG5cdGZsb2F0IG1lYW4gPSAwLjA7XG5cdGZsb2F0IHNxdWFyZWRfbWVhbiA9IDAuMDtcblx0ZmxvYXQgdXZTdHJpZGUgPSBzYW1wbGVzIDw9IDEuMCA/IDAuMCA6IDIuMCAvICggc2FtcGxlcyAtIDEuMCApO1xuXHRmbG9hdCB1dlN0YXJ0ID0gc2FtcGxlcyA8PSAxLjAgPyAwLjAgOiAtIDEuMDtcblx0Zm9yICggZmxvYXQgaSA9IDAuMDsgaSA8IHNhbXBsZXM7IGkgKysgKSB7XG5cdFx0ZmxvYXQgdXZPZmZzZXQgPSB1dlN0YXJ0ICsgaSAqIHV2U3RyaWRlO1xuXHRcdCNpZmRlZiBIT1JJWk9OVEFMX1BBU1Ncblx0XHRcdHZlYzIgZGlzdHJpYnV0aW9uID0gdW5wYWNrUkdCQVRvMkhhbGYoIHRleHR1cmUyRCggc2hhZG93X3Bhc3MsICggZ2xfRnJhZ0Nvb3JkLnh5ICsgdmVjMiggdXZPZmZzZXQsIDAuMCApICogcmFkaXVzICkgLyByZXNvbHV0aW9uICkgKTtcblx0XHRcdG1lYW4gKz0gZGlzdHJpYnV0aW9uLng7XG5cdFx0XHRzcXVhcmVkX21lYW4gKz0gZGlzdHJpYnV0aW9uLnkgKiBkaXN0cmlidXRpb24ueSArIGRpc3RyaWJ1dGlvbi54ICogZGlzdHJpYnV0aW9uLng7XG5cdFx0I2Vsc2Vcblx0XHRcdGZsb2F0IGRlcHRoID0gdW5wYWNrUkdCQVRvRGVwdGgoIHRleHR1cmUyRCggc2hhZG93X3Bhc3MsICggZ2xfRnJhZ0Nvb3JkLnh5ICsgdmVjMiggMC4wLCB1dk9mZnNldCApICogcmFkaXVzICkgLyByZXNvbHV0aW9uICkgKTtcblx0XHRcdG1lYW4gKz0gZGVwdGg7XG5cdFx0XHRzcXVhcmVkX21lYW4gKz0gZGVwdGggKiBkZXB0aDtcblx0XHQjZW5kaWZcblx0fVxuXHRtZWFuID0gbWVhbiAvIHNhbXBsZXM7XG5cdHNxdWFyZWRfbWVhbiA9IHNxdWFyZWRfbWVhbiAvIHNhbXBsZXM7XG5cdGZsb2F0IHN0ZF9kZXYgPSBzcXJ0KCBzcXVhcmVkX21lYW4gLSBtZWFuICogbWVhbiApO1xuXHRnbF9GcmFnQ29sb3IgPSBwYWNrMkhhbGZUb1JHQkEoIHZlYzIoIG1lYW4sIHN0ZF9kZXYgKSApO1xufSI7CgogICAgZnVuY3Rpb24gV2ViR0xTaGFkb3dNYXAoIHJlbmRlcmVyLCBvYmplY3RzLCBjYXBhYmlsaXRpZXMgKSB7CgogICAgCWxldCBfZnJ1c3R1bSA9IG5ldyBGcnVzdHVtKCk7CgogICAgCWNvbnN0IF9zaGFkb3dNYXBTaXplID0gbmV3IFZlY3RvcjIoKSwKICAgIAkJX3ZpZXdwb3J0U2l6ZSA9IG5ldyBWZWN0b3IyKCksCgogICAgCQlfdmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpLAoKICAgIAkJX2RlcHRoTWF0ZXJpYWwgPSBuZXcgTWVzaERlcHRoTWF0ZXJpYWwoIHsgZGVwdGhQYWNraW5nOiBSR0JBRGVwdGhQYWNraW5nIH0gKSwKICAgIAkJX2Rpc3RhbmNlTWF0ZXJpYWwgPSBuZXcgTWVzaERpc3RhbmNlTWF0ZXJpYWwoKSwKCiAgICAJCV9tYXRlcmlhbENhY2hlID0ge30sCgogICAgCQlfbWF4VGV4dHVyZVNpemUgPSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemU7CgogICAgCWNvbnN0IHNoYWRvd1NpZGUgPSB7IFsgRnJvbnRTaWRlIF06IEJhY2tTaWRlLCBbIEJhY2tTaWRlIF06IEZyb250U2lkZSwgWyBEb3VibGVTaWRlIF06IERvdWJsZVNpZGUgfTsKCiAgICAJY29uc3Qgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewogICAgCQlkZWZpbmVzOiB7CiAgICAJCQlWU01fU0FNUExFUzogOAogICAgCQl9LAogICAgCQl1bmlmb3JtczogewogICAgCQkJc2hhZG93X3Bhc3M6IHsgdmFsdWU6IG51bGwgfSwKICAgIAkJCXJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBWZWN0b3IyKCkgfSwKICAgIAkJCXJhZGl1czogeyB2YWx1ZTogNC4wIH0KICAgIAkJfSwKCiAgICAJCXZlcnRleFNoYWRlcjogdmVydGV4LAogICAgCQlmcmFnbWVudFNoYWRlcjogZnJhZ21lbnQKCiAgICAJfSApOwoKICAgIAljb25zdCBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwgPSBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmNsb25lKCk7CiAgICAJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLmRlZmluZXMuSE9SSVpPTlRBTF9QQVNTID0gMTsKCiAgICAJY29uc3QgZnVsbFNjcmVlblRyaSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwogICAgCWZ1bGxTY3JlZW5Ucmkuc2V0QXR0cmlidXRlKAogICAgCQkncG9zaXRpb24nLAogICAgCQluZXcgQnVmZmVyQXR0cmlidXRlKAogICAgCQkJbmV3IEZsb2F0MzJBcnJheSggWyAtMSwgLTEsIDAuNSwgMywgLTEsIDAuNSwgLTEsIDMsIDAuNSBdICksCiAgICAJCQkzCiAgICAJCSkKICAgIAkpOwoKICAgIAljb25zdCBmdWxsU2NyZWVuTWVzaCA9IG5ldyBNZXNoKCBmdWxsU2NyZWVuVHJpLCBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsICk7CgogICAgCWNvbnN0IHNjb3BlID0gdGhpczsKCiAgICAJdGhpcy5lbmFibGVkID0gZmFsc2U7CgogICAgCXRoaXMuYXV0b1VwZGF0ZSA9IHRydWU7CiAgICAJdGhpcy5uZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAl0aGlzLnR5cGUgPSBQQ0ZTaGFkb3dNYXA7CiAgICAJbGV0IF9wcmV2aW91c1R5cGUgPSB0aGlzLnR5cGU7CgogICAgCXRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBsaWdodHMsIHNjZW5lLCBjYW1lcmEgKSB7CgogICAgCQlpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwogICAgCQlpZiAoIHNjb3BlLmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNjb3BlLm5lZWRzVXBkYXRlID09PSBmYWxzZSApIHJldHVybjsKCiAgICAJCWlmICggbGlnaHRzLmxlbmd0aCA9PT0gMCApIHJldHVybjsKCiAgICAJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKICAgIAkJY29uc3QgYWN0aXZlQ3ViZUZhY2UgPSByZW5kZXJlci5nZXRBY3RpdmVDdWJlRmFjZSgpOwogICAgCQljb25zdCBhY3RpdmVNaXBtYXBMZXZlbCA9IHJlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CgogICAgCQljb25zdCBfc3RhdGUgPSByZW5kZXJlci5zdGF0ZTsKCiAgICAJCS8vIFNldCBHTCBzdGF0ZSBmb3IgZGVwdGggbWFwLgogICAgCQlfc3RhdGUuc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKTsKICAgIAkJX3N0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDEsIDEsIDEsIDEgKTsKICAgIAkJX3N0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0VGVzdCggdHJ1ZSApOwogICAgCQlfc3RhdGUuc2V0U2Npc3NvclRlc3QoIGZhbHNlICk7CgogICAgCQkvLyBjaGVjayBmb3Igc2hhZG93IG1hcCB0eXBlIGNoYW5nZXMKCiAgICAJCWNvbnN0IHRvVlNNID0gKCBfcHJldmlvdXNUeXBlICE9PSBWU01TaGFkb3dNYXAgJiYgdGhpcy50eXBlID09PSBWU01TaGFkb3dNYXAgKTsKICAgIAkJY29uc3QgZnJvbVZTTSA9ICggX3ByZXZpb3VzVHlwZSA9PT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSAhPT0gVlNNU2hhZG93TWFwICk7CgogICAgCQkvLyByZW5kZXIgZGVwdGggbWFwCgogICAgCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CiAgICAJCQljb25zdCBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CgogICAgCQkJaWYgKCBzaGFkb3cgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xTaGFkb3dNYXA6JywgbGlnaHQsICdoYXMgbm8gc2hhZG93LicgKTsKICAgIAkJCQljb250aW51ZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBzaGFkb3cuYXV0b1VwZGF0ZSA9PT0gZmFsc2UgJiYgc2hhZG93Lm5lZWRzVXBkYXRlID09PSBmYWxzZSApIGNvbnRpbnVlOwoKICAgIAkJCV9zaGFkb3dNYXBTaXplLmNvcHkoIHNoYWRvdy5tYXBTaXplICk7CgogICAgCQkJY29uc3Qgc2hhZG93RnJhbWVFeHRlbnRzID0gc2hhZG93LmdldEZyYW1lRXh0ZW50cygpOwoKICAgIAkJCV9zaGFkb3dNYXBTaXplLm11bHRpcGx5KCBzaGFkb3dGcmFtZUV4dGVudHMgKTsKCiAgICAJCQlfdmlld3BvcnRTaXplLmNvcHkoIHNoYWRvdy5tYXBTaXplICk7CgogICAgCQkJaWYgKCBfc2hhZG93TWFwU2l6ZS54ID4gX21heFRleHR1cmVTaXplIHx8IF9zaGFkb3dNYXBTaXplLnkgPiBfbWF4VGV4dHVyZVNpemUgKSB7CgogICAgCQkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSApIHsKCiAgICAJCQkJCV92aWV3cG9ydFNpemUueCA9IE1hdGguZmxvb3IoIF9tYXhUZXh0dXJlU2l6ZSAvIHNoYWRvd0ZyYW1lRXh0ZW50cy54ICk7CiAgICAJCQkJCV9zaGFkb3dNYXBTaXplLnggPSBfdmlld3BvcnRTaXplLnggKiBzaGFkb3dGcmFtZUV4dGVudHMueDsKICAgIAkJCQkJc2hhZG93Lm1hcFNpemUueCA9IF92aWV3cG9ydFNpemUueDsKCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIF9zaGFkb3dNYXBTaXplLnkgPiBfbWF4VGV4dHVyZVNpemUgKSB7CgogICAgCQkJCQlfdmlld3BvcnRTaXplLnkgPSBNYXRoLmZsb29yKCBfbWF4VGV4dHVyZVNpemUgLyBzaGFkb3dGcmFtZUV4dGVudHMueSApOwogICAgCQkJCQlfc2hhZG93TWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55ICogc2hhZG93RnJhbWVFeHRlbnRzLnk7CiAgICAJCQkJCXNoYWRvdy5tYXBTaXplLnkgPSBfdmlld3BvcnRTaXplLnk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCBzaGFkb3cubWFwID09PSBudWxsIHx8IHRvVlNNID09PSB0cnVlIHx8IGZyb21WU00gPT09IHRydWUgKSB7CgogICAgCQkJCWNvbnN0IHBhcnMgPSAoIHRoaXMudHlwZSAhPT0gVlNNU2hhZG93TWFwICkgPyB7IG1pbkZpbHRlcjogTmVhcmVzdEZpbHRlciwgbWFnRmlsdGVyOiBOZWFyZXN0RmlsdGVyIH0gOiB7fTsKCiAgICAJCQkJaWYgKCBzaGFkb3cubWFwICE9PSBudWxsICkgewoKICAgIAkJCQkJc2hhZG93Lm1hcC5kaXNwb3NlKCk7CgogICAgCQkJCX0KCiAgICAJCQkJc2hhZG93Lm1hcCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggX3NoYWRvd01hcFNpemUueCwgX3NoYWRvd01hcFNpemUueSwgcGFycyApOwogICAgCQkJCXNoYWRvdy5tYXAudGV4dHVyZS5uYW1lID0gbGlnaHQubmFtZSArICcuc2hhZG93TWFwJzsKCiAgICAJCQkJc2hhZG93LmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgogICAgCQkJfQoKICAgIAkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggc2hhZG93Lm1hcCApOwogICAgCQkJcmVuZGVyZXIuY2xlYXIoKTsKCiAgICAJCQljb25zdCB2aWV3cG9ydENvdW50ID0gc2hhZG93LmdldFZpZXdwb3J0Q291bnQoKTsKCiAgICAJCQlmb3IgKCBsZXQgdnAgPSAwOyB2cCA8IHZpZXdwb3J0Q291bnQ7IHZwICsrICkgewoKICAgIAkJCQljb25zdCB2aWV3cG9ydCA9IHNoYWRvdy5nZXRWaWV3cG9ydCggdnAgKTsKCiAgICAJCQkJX3ZpZXdwb3J0LnNldCgKICAgIAkJCQkJX3ZpZXdwb3J0U2l6ZS54ICogdmlld3BvcnQueCwKICAgIAkJCQkJX3ZpZXdwb3J0U2l6ZS55ICogdmlld3BvcnQueSwKICAgIAkJCQkJX3ZpZXdwb3J0U2l6ZS54ICogdmlld3BvcnQueiwKICAgIAkJCQkJX3ZpZXdwb3J0U2l6ZS55ICogdmlld3BvcnQudwogICAgCQkJCSk7CgogICAgCQkJCV9zdGF0ZS52aWV3cG9ydCggX3ZpZXdwb3J0ICk7CgogICAgCQkJCXNoYWRvdy51cGRhdGVNYXRyaWNlcyggbGlnaHQsIHZwICk7CgogICAgCQkJCV9mcnVzdHVtID0gc2hhZG93LmdldEZydXN0dW0oKTsKCiAgICAJCQkJcmVuZGVyT2JqZWN0KCBzY2VuZSwgY2FtZXJhLCBzaGFkb3cuY2FtZXJhLCBsaWdodCwgdGhpcy50eXBlICk7CgogICAgCQkJfQoKICAgIAkJCS8vIGRvIGJsdXIgcGFzcyBmb3IgVlNNCgogICAgCQkJaWYgKCBzaGFkb3cuaXNQb2ludExpZ2h0U2hhZG93ICE9PSB0cnVlICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwICkgewoKICAgIAkJCQlWU01QYXNzKCBzaGFkb3csIGNhbWVyYSApOwoKICAgIAkJCX0KCiAgICAJCQlzaGFkb3cubmVlZHNVcGRhdGUgPSBmYWxzZTsKCiAgICAJCX0KCiAgICAJCV9wcmV2aW91c1R5cGUgPSB0aGlzLnR5cGU7CgogICAgCQlzY29wZS5uZWVkc1VwZGF0ZSA9IGZhbHNlOwoKICAgIAkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBjdXJyZW50UmVuZGVyVGFyZ2V0LCBhY3RpdmVDdWJlRmFjZSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCiAgICAJfTsKCiAgICAJZnVuY3Rpb24gVlNNUGFzcyggc2hhZG93LCBjYW1lcmEgKSB7CgogICAgCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBmdWxsU2NyZWVuTWVzaCApOwoKICAgIAkJaWYgKCBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmRlZmluZXMuVlNNX1NBTVBMRVMgIT09IHNoYWRvdy5ibHVyU2FtcGxlcyApIHsKCiAgICAJCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmRlZmluZXMuVlNNX1NBTVBMRVMgPSBzaGFkb3cuYmx1clNhbXBsZXM7CiAgICAJCQlzaGFkb3dNYXRlcmlhbEhvcml6b250YWwuZGVmaW5lcy5WU01fU0FNUExFUyA9IHNoYWRvdy5ibHVyU2FtcGxlczsKCiAgICAJCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIAkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgogICAgCQl9CgogICAgCQlpZiAoIHNoYWRvdy5tYXBQYXNzID09PSBudWxsICkgewoKICAgIAkJCXNoYWRvdy5tYXBQYXNzID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCBfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55ICk7CgogICAgCQl9CgogICAgCQkvLyB2ZXJ0aWNhbCBwYXNzCgogICAgCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLnVuaWZvcm1zLnNoYWRvd19wYXNzLnZhbHVlID0gc2hhZG93Lm1hcC50ZXh0dXJlOwogICAgCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLnVuaWZvcm1zLnJlc29sdXRpb24udmFsdWUgPSBzaGFkb3cubWFwU2l6ZTsKICAgIAkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5yYWRpdXMudmFsdWUgPSBzaGFkb3cucmFkaXVzOwogICAgCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXBQYXNzICk7CiAgICAJCXJlbmRlcmVyLmNsZWFyKCk7CiAgICAJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggY2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCwgZnVsbFNjcmVlbk1lc2gsIG51bGwgKTsKCiAgICAJCS8vIGhvcml6b250YWwgcGFzcwoKICAgIAkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLnVuaWZvcm1zLnNoYWRvd19wYXNzLnZhbHVlID0gc2hhZG93Lm1hcFBhc3MudGV4dHVyZTsKICAgIAkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLnVuaWZvcm1zLnJlc29sdXRpb24udmFsdWUgPSBzaGFkb3cubWFwU2l6ZTsKICAgIAkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLnVuaWZvcm1zLnJhZGl1cy52YWx1ZSA9IHNoYWRvdy5yYWRpdXM7CiAgICAJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggc2hhZG93Lm1hcCApOwogICAgCQlyZW5kZXJlci5jbGVhcigpOwogICAgCQlyZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbCwgZnVsbFNjcmVlbk1lc2gsIG51bGwgKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXREZXB0aE1hdGVyaWFsKCBvYmplY3QsIG1hdGVyaWFsLCBsaWdodCwgdHlwZSApIHsKCiAgICAJCWxldCByZXN1bHQgPSBudWxsOwoKICAgIAkJY29uc3QgY3VzdG9tTWF0ZXJpYWwgPSAoIGxpZ2h0LmlzUG9pbnRMaWdodCA9PT0gdHJ1ZSApID8gb2JqZWN0LmN1c3RvbURpc3RhbmNlTWF0ZXJpYWwgOiBvYmplY3QuY3VzdG9tRGVwdGhNYXRlcmlhbDsKCiAgICAJCWlmICggY3VzdG9tTWF0ZXJpYWwgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlyZXN1bHQgPSBjdXN0b21NYXRlcmlhbDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJcmVzdWx0ID0gKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgKSA/IF9kaXN0YW5jZU1hdGVyaWFsIDogX2RlcHRoTWF0ZXJpYWw7CgogICAgCQkJaWYgKCAoIHJlbmRlcmVyLmxvY2FsQ2xpcHBpbmdFbmFibGVkICYmIG1hdGVyaWFsLmNsaXBTaGFkb3dzID09PSB0cnVlICYmIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzICkgJiYgbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXMubGVuZ3RoICE9PSAwICkgfHwKICAgIAkJCQkoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCAmJiBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZSAhPT0gMCApIHx8CiAgICAJCQkJKCBtYXRlcmlhbC5hbHBoYU1hcCAmJiBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgfHwKICAgIAkJCQkoIG1hdGVyaWFsLm1hcCAmJiBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgfHwKICAgIAkJCQkoIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gdHJ1ZSApICkgewoKICAgIAkJCQkvLyBpbiB0aGlzIGNhc2Ugd2UgbmVlZCBhIHVuaXF1ZSBtYXRlcmlhbCBpbnN0YW5jZSByZWZsZWN0aW5nIHRoZQogICAgCQkJCS8vIGFwcHJvcHJpYXRlIHN0YXRlCgogICAgCQkJCWNvbnN0IGtleUEgPSByZXN1bHQudXVpZCwga2V5QiA9IG1hdGVyaWFsLnV1aWQ7CgogICAgCQkJCWxldCBtYXRlcmlhbHNGb3JWYXJpYW50ID0gX21hdGVyaWFsQ2FjaGVbIGtleUEgXTsKCiAgICAJCQkJaWYgKCBtYXRlcmlhbHNGb3JWYXJpYW50ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQltYXRlcmlhbHNGb3JWYXJpYW50ID0ge307CiAgICAJCQkJCV9tYXRlcmlhbENhY2hlWyBrZXlBIF0gPSBtYXRlcmlhbHNGb3JWYXJpYW50OwoKICAgIAkJCQl9CgogICAgCQkJCWxldCBjYWNoZWRNYXRlcmlhbCA9IG1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXTsKCiAgICAJCQkJaWYgKCBjYWNoZWRNYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJY2FjaGVkTWF0ZXJpYWwgPSByZXN1bHQuY2xvbmUoKTsKICAgIAkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudFsga2V5QiBdID0gY2FjaGVkTWF0ZXJpYWw7CiAgICAJCQkJCW1hdGVyaWFsLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlyZXN1bHQgPSBjYWNoZWRNYXRlcmlhbDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXN1bHQudmlzaWJsZSA9IG1hdGVyaWFsLnZpc2libGU7CiAgICAJCXJlc3VsdC53aXJlZnJhbWUgPSBtYXRlcmlhbC53aXJlZnJhbWU7CgogICAgCQlpZiAoIHR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCiAgICAJCQlyZXN1bHQuc2lkZSA9ICggbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCApID8gbWF0ZXJpYWwuc2hhZG93U2lkZSA6IG1hdGVyaWFsLnNpZGU7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCXJlc3VsdC5zaWRlID0gKCBtYXRlcmlhbC5zaGFkb3dTaWRlICE9PSBudWxsICkgPyBtYXRlcmlhbC5zaGFkb3dTaWRlIDogc2hhZG93U2lkZVsgbWF0ZXJpYWwuc2lkZSBdOwoKICAgIAkJfQoKICAgIAkJcmVzdWx0LmFscGhhTWFwID0gbWF0ZXJpYWwuYWxwaGFNYXA7CiAgICAJCXJlc3VsdC5hbHBoYVRlc3QgPSAoIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gdHJ1ZSApID8gMC41IDogbWF0ZXJpYWwuYWxwaGFUZXN0OyAvLyBhcHByb3hpbWF0ZSBhbHBoYVRvQ292ZXJhZ2UgYnkgdXNpbmcgYSBmaXhlZCBhbHBoYVRlc3QgdmFsdWUKICAgIAkJcmVzdWx0Lm1hcCA9IG1hdGVyaWFsLm1hcDsKCiAgICAJCXJlc3VsdC5jbGlwU2hhZG93cyA9IG1hdGVyaWFsLmNsaXBTaGFkb3dzOwogICAgCQlyZXN1bHQuY2xpcHBpbmdQbGFuZXMgPSBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lczsKICAgIAkJcmVzdWx0LmNsaXBJbnRlcnNlY3Rpb24gPSBtYXRlcmlhbC5jbGlwSW50ZXJzZWN0aW9uOwoKICAgIAkJcmVzdWx0LmRpc3BsYWNlbWVudE1hcCA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKICAgIAkJcmVzdWx0LmRpc3BsYWNlbWVudFNjYWxlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAJCXJlc3VsdC5kaXNwbGFjZW1lbnRCaWFzID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCiAgICAJCXJlc3VsdC53aXJlZnJhbWVMaW5ld2lkdGggPSBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGg7CiAgICAJCXJlc3VsdC5saW5ld2lkdGggPSBtYXRlcmlhbC5saW5ld2lkdGg7CgogICAgCQlpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCA9PT0gdHJ1ZSAmJiByZXN1bHQuaXNNZXNoRGlzdGFuY2VNYXRlcmlhbCA9PT0gdHJ1ZSApIHsKCiAgICAJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSByZW5kZXJlci5wcm9wZXJ0aWVzLmdldCggcmVzdWx0ICk7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubGlnaHQgPSBsaWdodDsKCiAgICAJCX0KCiAgICAJCXJldHVybiByZXN1bHQ7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVuZGVyT2JqZWN0KCBvYmplY3QsIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBsaWdodCwgdHlwZSApIHsKCiAgICAJCWlmICggb2JqZWN0LnZpc2libGUgPT09IGZhbHNlICkgcmV0dXJuOwoKICAgIAkJY29uc3QgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKICAgIAkJaWYgKCB2aXNpYmxlICYmICggb2JqZWN0LmlzTWVzaCB8fCBvYmplY3QuaXNMaW5lIHx8IG9iamVjdC5pc1BvaW50cyApICkgewoKICAgIAkJCWlmICggKCBvYmplY3QuY2FzdFNoYWRvdyB8fCAoIG9iamVjdC5yZWNlaXZlU2hhZG93ICYmIHR5cGUgPT09IFZTTVNoYWRvd01hcCApICkgJiYgKCAhIG9iamVjdC5mcnVzdHVtQ3VsbGVkIHx8IF9mcnVzdHVtLmludGVyc2VjdHNPYmplY3QoIG9iamVjdCApICkgKSB7CgogICAgCQkJCW9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggc2hhZG93Q2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgogICAgCQkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0cy51cGRhdGUoIG9iamVjdCApOwogICAgCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKICAgIAkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgogICAgCQkJCQljb25zdCBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgogICAgCQkJCQlmb3IgKCBsZXQgayA9IDAsIGtsID0gZ3JvdXBzLmxlbmd0aDsgayA8IGtsOyBrICsrICkgewoKICAgIAkJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBrIF07CiAgICAJCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCiAgICAJCQkJCQlpZiAoIGdyb3VwTWF0ZXJpYWwgJiYgZ3JvdXBNYXRlcmlhbC52aXNpYmxlICkgewoKICAgIAkJCQkJCQljb25zdCBkZXB0aE1hdGVyaWFsID0gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBncm91cE1hdGVyaWFsLCBsaWdodCwgdHlwZSApOwoKICAgIAkJCQkJCQlvYmplY3Qub25CZWZvcmVTaGFkb3coIHJlbmRlcmVyLCBvYmplY3QsIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgZ3JvdXAgKTsKCiAgICAJCQkJCQkJcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIGdyb3VwICk7CgogICAgCQkJCQkJCW9iamVjdC5vbkFmdGVyU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKICAgIAkJCQkJY29uc3QgZGVwdGhNYXRlcmlhbCA9IGdldERlcHRoTWF0ZXJpYWwoIG9iamVjdCwgbWF0ZXJpYWwsIGxpZ2h0LCB0eXBlICk7CgogICAgCQkJCQlvYmplY3Qub25CZWZvcmVTaGFkb3coIHJlbmRlcmVyLCBvYmplY3QsIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgbnVsbCApOwoKICAgIAkJCQkJcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIG51bGwgKTsKCiAgICAJCQkJCW9iamVjdC5vbkFmdGVyU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIG51bGwgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWNvbnN0IGNoaWxkcmVuID0gb2JqZWN0LmNoaWxkcmVuOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQlyZW5kZXJPYmplY3QoIGNoaWxkcmVuWyBpIF0sIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBsaWdodCwgdHlwZSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIG9uTWF0ZXJpYWxEaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJbWF0ZXJpYWwucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKICAgIAkJLy8gbWFrZSBzdXJlIHRvIHJlbW92ZSB0aGUgdW5pcXVlIGRpc3RhbmNlL2RlcHRoIG1hdGVyaWFscyB1c2VkIGZvciBzaGFkb3cgbWFwIHJlbmRlcmluZwoKICAgIAkJZm9yICggY29uc3QgaWQgaW4gX21hdGVyaWFsQ2FjaGUgKSB7CgogICAgCQkJY29uc3QgY2FjaGUgPSBfbWF0ZXJpYWxDYWNoZVsgaWQgXTsKCiAgICAJCQljb25zdCB1dWlkID0gZXZlbnQudGFyZ2V0LnV1aWQ7CgogICAgCQkJaWYgKCB1dWlkIGluIGNhY2hlICkgewoKICAgIAkJCQljb25zdCBzaGFkb3dNYXRlcmlhbCA9IGNhY2hlWyB1dWlkIF07CiAgICAJCQkJc2hhZG93TWF0ZXJpYWwuZGlzcG9zZSgpOwogICAgCQkJCWRlbGV0ZSBjYWNoZVsgdXVpZCBdOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIH0KCiAgICBjb25zdCByZXZlcnNlZEZ1bmNzID0gewogICAgCVsgTmV2ZXJEZXB0aCBdOiBBbHdheXNEZXB0aCwKICAgIAlbIExlc3NEZXB0aCBdOiBHcmVhdGVyRGVwdGgsCiAgICAJWyBFcXVhbERlcHRoIF06IE5vdEVxdWFsRGVwdGgsCiAgICAJWyBMZXNzRXF1YWxEZXB0aCBdOiBHcmVhdGVyRXF1YWxEZXB0aCwKCiAgICAJWyBBbHdheXNEZXB0aCBdOiBOZXZlckRlcHRoLAogICAgCVsgR3JlYXRlckRlcHRoIF06IExlc3NEZXB0aCwKICAgIAlbIE5vdEVxdWFsRGVwdGggXTogRXF1YWxEZXB0aCwKICAgIAlbIEdyZWF0ZXJFcXVhbERlcHRoIF06IExlc3NFcXVhbERlcHRoLAogICAgfTsKCiAgICBmdW5jdGlvbiBXZWJHTFN0YXRlKCBnbCwgZXh0ZW5zaW9ucyApIHsKCiAgICAJZnVuY3Rpb24gQ29sb3JCdWZmZXIoKSB7CgogICAgCQlsZXQgbG9ja2VkID0gZmFsc2U7CgogICAgCQljb25zdCBjb2xvciA9IG5ldyBWZWN0b3I0KCk7CiAgICAJCWxldCBjdXJyZW50Q29sb3JNYXNrID0gbnVsbDsKICAgIAkJY29uc3QgY3VycmVudENvbG9yQ2xlYXIgPSBuZXcgVmVjdG9yNCggMCwgMCwgMCwgMCApOwoKICAgIAkJcmV0dXJuIHsKCiAgICAJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIGNvbG9yTWFzayApIHsKCiAgICAJCQkJaWYgKCBjdXJyZW50Q29sb3JNYXNrICE9PSBjb2xvck1hc2sgJiYgISBsb2NrZWQgKSB7CgogICAgCQkJCQlnbC5jb2xvck1hc2soIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2ssIGNvbG9yTWFzayApOwogICAgCQkJCQljdXJyZW50Q29sb3JNYXNrID0gY29sb3JNYXNrOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRMb2NrZWQ6IGZ1bmN0aW9uICggbG9jayApIHsKCiAgICAJCQkJbG9ja2VkID0gbG9jazsKCiAgICAJCQl9LAoKICAgIAkJCXNldENsZWFyOiBmdW5jdGlvbiAoIHIsIGcsIGIsIGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCiAgICAJCQkJaWYgKCBwcmVtdWx0aXBsaWVkQWxwaGEgPT09IHRydWUgKSB7CgogICAgCQkJCQlyICo9IGE7IGcgKj0gYTsgYiAqPSBhOwoKICAgIAkJCQl9CgogICAgCQkJCWNvbG9yLnNldCggciwgZywgYiwgYSApOwoKICAgIAkJCQlpZiAoIGN1cnJlbnRDb2xvckNsZWFyLmVxdWFscyggY29sb3IgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCQlnbC5jbGVhckNvbG9yKCByLCBnLCBiLCBhICk7CiAgICAJCQkJCWN1cnJlbnRDb2xvckNsZWFyLmNvcHkoIGNvbG9yICk7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgogICAgCQkJCWxvY2tlZCA9IGZhbHNlOwoKICAgIAkJCQljdXJyZW50Q29sb3JNYXNrID0gbnVsbDsKICAgIAkJCQljdXJyZW50Q29sb3JDbGVhci5zZXQoIC0xLCAwLCAwLCAwICk7IC8vIHNldCB0byBpbnZhbGlkIHN0YXRlCgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBEZXB0aEJ1ZmZlcigpIHsKCiAgICAJCWxldCBsb2NrZWQgPSBmYWxzZTsKCiAgICAJCWxldCBjdXJyZW50UmV2ZXJzZWQgPSBmYWxzZTsKICAgIAkJbGV0IGN1cnJlbnREZXB0aE1hc2sgPSBudWxsOwogICAgCQlsZXQgY3VycmVudERlcHRoRnVuYyA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CgogICAgCQlyZXR1cm4gewoKICAgIAkJCXNldFJldmVyc2VkOiBmdW5jdGlvbiAoIHJldmVyc2VkICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRSZXZlcnNlZCAhPT0gcmV2ZXJzZWQgKSB7CgogICAgCQkJCQljb25zdCBleHQgPSBleHRlbnNpb25zLmdldCggJ0VYVF9jbGlwX2NvbnRyb2wnICk7CgogICAgCQkJCQlpZiAoIHJldmVyc2VkICkgewoKICAgIAkJCQkJCWV4dC5jbGlwQ29udHJvbEVYVCggZXh0LkxPV0VSX0xFRlRfRVhULCBleHQuWkVST19UT19PTkVfRVhUICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWV4dC5jbGlwQ29udHJvbEVYVCggZXh0LkxPV0VSX0xFRlRfRVhULCBleHQuTkVHQVRJVkVfT05FX1RPX09ORV9FWFQgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWN1cnJlbnRSZXZlcnNlZCA9IHJldmVyc2VkOwoKICAgIAkJCQkJY29uc3Qgb2xkRGVwdGggPSBjdXJyZW50RGVwdGhDbGVhcjsKICAgIAkJCQkJY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwogICAgCQkJCQl0aGlzLnNldENsZWFyKCBvbGREZXB0aCApOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlnZXRSZXZlcnNlZDogZnVuY3Rpb24gKCkgewoKICAgIAkJCQlyZXR1cm4gY3VycmVudFJldmVyc2VkOwoKICAgIAkJCX0sCgogICAgCQkJc2V0VGVzdDogZnVuY3Rpb24gKCBkZXB0aFRlc3QgKSB7CgogICAgCQkJCWlmICggZGVwdGhUZXN0ICkgewoKICAgIAkJCQkJZW5hYmxlKCBnbC5ERVBUSF9URVNUICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlkaXNhYmxlKCBnbC5ERVBUSF9URVNUICk7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXNldE1hc2s6IGZ1bmN0aW9uICggZGVwdGhNYXNrICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnREZXB0aE1hc2sgIT09IGRlcHRoTWFzayAmJiAhIGxvY2tlZCApIHsKCiAgICAJCQkJCWdsLmRlcHRoTWFzayggZGVwdGhNYXNrICk7CiAgICAJCQkJCWN1cnJlbnREZXB0aE1hc2sgPSBkZXB0aE1hc2s7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXNldEZ1bmM6IGZ1bmN0aW9uICggZGVwdGhGdW5jICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRSZXZlcnNlZCApIGRlcHRoRnVuYyA9IHJldmVyc2VkRnVuY3NbIGRlcHRoRnVuYyBdOwoKICAgIAkJCQlpZiAoIGN1cnJlbnREZXB0aEZ1bmMgIT09IGRlcHRoRnVuYyApIHsKCiAgICAJCQkJCXN3aXRjaCAoIGRlcHRoRnVuYyApIHsKCiAgICAJCQkJCQljYXNlIE5ldmVyRGVwdGg6CgogICAgCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTkVWRVIgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIEFsd2F5c0RlcHRoOgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkFMV0FZUyApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgTGVzc0RlcHRoOgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFU1MgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIExlc3NFcXVhbERlcHRoOgoKICAgIAkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFUVVBTCApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgRXF1YWxEZXB0aDoKCiAgICAJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5FUVVBTCApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgR3JlYXRlckVxdWFsRGVwdGg6CgogICAgCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuR0VRVUFMICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBHcmVhdGVyRGVwdGg6CgogICAgCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuR1JFQVRFUiApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgTm90RXF1YWxEZXB0aDoKCiAgICAJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5OT1RFUVVBTCApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWRlZmF1bHQ6CgogICAgCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTEVRVUFMICk7CgogICAgCQkJCQl9CgogICAgCQkJCQljdXJyZW50RGVwdGhGdW5jID0gZGVwdGhGdW5jOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRMb2NrZWQ6IGZ1bmN0aW9uICggbG9jayApIHsKCiAgICAJCQkJbG9ja2VkID0gbG9jazsKCiAgICAJCQl9LAoKICAgIAkJCXNldENsZWFyOiBmdW5jdGlvbiAoIGRlcHRoICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnREZXB0aENsZWFyICE9PSBkZXB0aCApIHsKCiAgICAJCQkJCWlmICggY3VycmVudFJldmVyc2VkICkgewoKICAgIAkJCQkJCWRlcHRoID0gMSAtIGRlcHRoOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJZ2wuY2xlYXJEZXB0aCggZGVwdGggKTsKICAgIAkJCQkJY3VycmVudERlcHRoQ2xlYXIgPSBkZXB0aDsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJcmVzZXQ6IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJbG9ja2VkID0gZmFsc2U7CgogICAgCQkJCWN1cnJlbnREZXB0aE1hc2sgPSBudWxsOwogICAgCQkJCWN1cnJlbnREZXB0aEZ1bmMgPSBudWxsOwogICAgCQkJCWN1cnJlbnREZXB0aENsZWFyID0gbnVsbDsKICAgIAkJCQljdXJyZW50UmV2ZXJzZWQgPSBmYWxzZTsKCiAgICAJCQl9CgogICAgCQl9OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIFN0ZW5jaWxCdWZmZXIoKSB7CgogICAgCQlsZXQgbG9ja2VkID0gZmFsc2U7CgogICAgCQlsZXQgY3VycmVudFN0ZW5jaWxNYXNrID0gbnVsbDsKICAgIAkJbGV0IGN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50U3RlbmNpbFJlZiA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gbnVsbDsKICAgIAkJbGV0IGN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CiAgICAJCWxldCBjdXJyZW50U3RlbmNpbFpGYWlsID0gbnVsbDsKICAgIAkJbGV0IGN1cnJlbnRTdGVuY2lsWlBhc3MgPSBudWxsOwogICAgCQlsZXQgY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CgogICAgCQlyZXR1cm4gewoKICAgIAkJCXNldFRlc3Q6IGZ1bmN0aW9uICggc3RlbmNpbFRlc3QgKSB7CgogICAgCQkJCWlmICggISBsb2NrZWQgKSB7CgogICAgCQkJCQlpZiAoIHN0ZW5jaWxUZXN0ICkgewoKICAgIAkJCQkJCWVuYWJsZSggZ2wuU1RFTkNJTF9URVNUICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCWRpc2FibGUoIGdsLlNURU5DSUxfVEVTVCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIHN0ZW5jaWxNYXNrICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsTWFzayAhPT0gc3RlbmNpbE1hc2sgJiYgISBsb2NrZWQgKSB7CgogICAgCQkJCQlnbC5zdGVuY2lsTWFzayggc3RlbmNpbE1hc2sgKTsKICAgIAkJCQkJY3VycmVudFN0ZW5jaWxNYXNrID0gc3RlbmNpbE1hc2s7CgogICAgCQkJCX0KCiAgICAJCQl9LAoKICAgIAkJCXNldEZ1bmM6IGZ1bmN0aW9uICggc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsRnVuYyAhPT0gc3RlbmNpbEZ1bmMgfHwKICAgIAkJCQkgICAgIGN1cnJlbnRTdGVuY2lsUmVmICE9PSBzdGVuY2lsUmVmIHx8CiAgICAJCQkJICAgICBjdXJyZW50U3RlbmNpbEZ1bmNNYXNrICE9PSBzdGVuY2lsTWFzayApIHsKCiAgICAJCQkJCWdsLnN0ZW5jaWxGdW5jKCBzdGVuY2lsRnVuYywgc3RlbmNpbFJlZiwgc3RlbmNpbE1hc2sgKTsKCiAgICAJCQkJCWN1cnJlbnRTdGVuY2lsRnVuYyA9IHN0ZW5jaWxGdW5jOwogICAgCQkJCQljdXJyZW50U3RlbmNpbFJlZiA9IHN0ZW5jaWxSZWY7CiAgICAJCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBzdGVuY2lsTWFzazsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJc2V0T3A6IGZ1bmN0aW9uICggc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsRmFpbCAhPT0gc3RlbmNpbEZhaWwgfHwKICAgIAkJCQkgICAgIGN1cnJlbnRTdGVuY2lsWkZhaWwgIT09IHN0ZW5jaWxaRmFpbCB8fAogICAgCQkJCSAgICAgY3VycmVudFN0ZW5jaWxaUGFzcyAhPT0gc3RlbmNpbFpQYXNzICkgewoKICAgIAkJCQkJZ2wuc3RlbmNpbE9wKCBzdGVuY2lsRmFpbCwgc3RlbmNpbFpGYWlsLCBzdGVuY2lsWlBhc3MgKTsKCiAgICAJCQkJCWN1cnJlbnRTdGVuY2lsRmFpbCA9IHN0ZW5jaWxGYWlsOwogICAgCQkJCQljdXJyZW50U3RlbmNpbFpGYWlsID0gc3RlbmNpbFpGYWlsOwogICAgCQkJCQljdXJyZW50U3RlbmNpbFpQYXNzID0gc3RlbmNpbFpQYXNzOwoKICAgIAkJCQl9CgogICAgCQkJfSwKCiAgICAJCQlzZXRMb2NrZWQ6IGZ1bmN0aW9uICggbG9jayApIHsKCiAgICAJCQkJbG9ja2VkID0gbG9jazsKCiAgICAJCQl9LAoKICAgIAkJCXNldENsZWFyOiBmdW5jdGlvbiAoIHN0ZW5jaWwgKSB7CgogICAgCQkJCWlmICggY3VycmVudFN0ZW5jaWxDbGVhciAhPT0gc3RlbmNpbCApIHsKCiAgICAJCQkJCWdsLmNsZWFyU3RlbmNpbCggc3RlbmNpbCApOwogICAgCQkJCQljdXJyZW50U3RlbmNpbENsZWFyID0gc3RlbmNpbDsKCiAgICAJCQkJfQoKICAgIAkJCX0sCgogICAgCQkJcmVzZXQ6IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJbG9ja2VkID0gZmFsc2U7CgogICAgCQkJCWN1cnJlbnRTdGVuY2lsTWFzayA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxGdW5jID0gbnVsbDsKICAgIAkJCQljdXJyZW50U3RlbmNpbFJlZiA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IG51bGw7CiAgICAJCQkJY3VycmVudFN0ZW5jaWxGYWlsID0gbnVsbDsKICAgIAkJCQljdXJyZW50U3RlbmNpbFpGYWlsID0gbnVsbDsKICAgIAkJCQljdXJyZW50U3RlbmNpbFpQYXNzID0gbnVsbDsKICAgIAkJCQljdXJyZW50U3RlbmNpbENsZWFyID0gbnVsbDsKCiAgICAJCQl9CgogICAgCQl9OwoKICAgIAl9CgogICAgCS8vCgogICAgCWNvbnN0IGNvbG9yQnVmZmVyID0gbmV3IENvbG9yQnVmZmVyKCk7CiAgICAJY29uc3QgZGVwdGhCdWZmZXIgPSBuZXcgRGVwdGhCdWZmZXIoKTsKICAgIAljb25zdCBzdGVuY2lsQnVmZmVyID0gbmV3IFN0ZW5jaWxCdWZmZXIoKTsKCiAgICAJY29uc3QgdWJvQmluZGluZ3MgPSBuZXcgV2Vha01hcCgpOwogICAgCWNvbnN0IHVib1Byb2dyYW1NYXAgPSBuZXcgV2Vha01hcCgpOwoKICAgIAlsZXQgZW5hYmxlZENhcGFiaWxpdGllcyA9IHt9OwoKICAgIAlsZXQgY3VycmVudEJvdW5kRnJhbWVidWZmZXJzID0ge307CiAgICAJbGV0IGN1cnJlbnREcmF3YnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CiAgICAJbGV0IGRlZmF1bHREcmF3YnVmZmVycyA9IFtdOwoKICAgIAlsZXQgY3VycmVudFByb2dyYW0gPSBudWxsOwoKICAgIAlsZXQgY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwogICAgCWxldCBjdXJyZW50QmxlbmRpbmcgPSBudWxsOwogICAgCWxldCBjdXJyZW50QmxlbmRFcXVhdGlvbiA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCbGVuZERzdCA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBudWxsOwogICAgCWxldCBjdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKICAgIAlsZXQgY3VycmVudEJsZW5kQ29sb3IgPSBuZXcgQ29sb3IoIDAsIDAsIDAgKTsKICAgIAlsZXQgY3VycmVudEJsZW5kQWxwaGEgPSAwOwogICAgCWxldCBjdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCiAgICAJbGV0IGN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwogICAgCWxldCBjdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKICAgIAlsZXQgY3VycmVudExpbmVXaWR0aCA9IG51bGw7CgogICAgCWxldCBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKICAgIAljb25zdCBtYXhUZXh0dXJlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX0NPTUJJTkVEX1RFWFRVUkVfSU1BR0VfVU5JVFMgKTsKCiAgICAJbGV0IGxpbmVXaWR0aEF2YWlsYWJsZSA9IGZhbHNlOwogICAgCWxldCB2ZXJzaW9uID0gMDsKICAgIAljb25zdCBnbFZlcnNpb24gPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLlZFUlNJT04gKTsKCiAgICAJaWYgKCBnbFZlcnNpb24uaW5kZXhPZiggJ1dlYkdMJyApICE9PSAtMSApIHsKCiAgICAJCXZlcnNpb24gPSBwYXJzZUZsb2F0KCAvXldlYkdMIChcZCkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKICAgIAkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDEuMCApOwoKICAgIAl9IGVsc2UgaWYgKCBnbFZlcnNpb24uaW5kZXhPZiggJ09wZW5HTCBFUycgKSAhPT0gLTEgKSB7CgogICAgCQl2ZXJzaW9uID0gcGFyc2VGbG9hdCggL15PcGVuR0wgRVMgKFxkKS8uZXhlYyggZ2xWZXJzaW9uIClbIDEgXSApOwogICAgCQlsaW5lV2lkdGhBdmFpbGFibGUgPSAoIHZlcnNpb24gPj0gMi4wICk7CgogICAgCX0KCiAgICAJbGV0IGN1cnJlbnRUZXh0dXJlU2xvdCA9IG51bGw7CiAgICAJbGV0IGN1cnJlbnRCb3VuZFRleHR1cmVzID0ge307CgogICAgCWNvbnN0IHNjaXNzb3JQYXJhbSA9IGdsLmdldFBhcmFtZXRlciggZ2wuU0NJU1NPUl9CT1ggKTsKICAgIAljb25zdCB2aWV3cG9ydFBhcmFtID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5WSUVXUE9SVCApOwoKICAgIAljb25zdCBjdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCkuZnJvbUFycmF5KCBzY2lzc29yUGFyYW0gKTsKICAgIAljb25zdCBjdXJyZW50Vmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggdmlld3BvcnRQYXJhbSApOwoKICAgIAlmdW5jdGlvbiBjcmVhdGVUZXh0dXJlKCB0eXBlLCB0YXJnZXQsIGNvdW50LCBkaW1lbnNpb25zICkgewoKICAgIAkJY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KCA0ICk7IC8vIDQgaXMgcmVxdWlyZWQgdG8gbWF0Y2ggZGVmYXVsdCB1bnBhY2sgYWxpZ25tZW50IG9mIDQuCiAgICAJCWNvbnN0IHRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7CgogICAgCQlnbC5iaW5kVGV4dHVyZSggdHlwZSwgdGV4dHVyZSApOwogICAgCQlnbC50ZXhQYXJhbWV0ZXJpKCB0eXBlLCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLk5FQVJFU1QgKTsKICAgIAkJZ2wudGV4UGFyYW1ldGVyaSggdHlwZSwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUICk7CgogICAgCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSArKyApIHsKCiAgICAJCQlpZiAoIHR5cGUgPT09IGdsLlRFWFRVUkVfM0QgfHwgdHlwZSA9PT0gZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCiAgICAJCQkJZ2wudGV4SW1hZ2UzRCggdGFyZ2V0LCAwLCBnbC5SR0JBLCAxLCAxLCBkaW1lbnNpb25zLCAwLCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLCBkYXRhICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJZ2wudGV4SW1hZ2UyRCggdGFyZ2V0ICsgaSwgMCwgZ2wuUkdCQSwgMSwgMSwgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgZGF0YSApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiB0ZXh0dXJlOwoKICAgIAl9CgogICAgCWNvbnN0IGVtcHR5VGV4dHVyZXMgPSB7fTsKICAgIAllbXB0eVRleHR1cmVzWyBnbC5URVhUVVJFXzJEIF0gPSBjcmVhdGVUZXh0dXJlKCBnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFXzJELCAxICk7CiAgICAJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV9DVUJFX01BUCBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YLCA2ICk7CiAgICAJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV8yRF9BUlJBWSBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV8yRF9BUlJBWSwgZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMSwgMSApOwogICAgCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfM0QgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfM0QsIGdsLlRFWFRVUkVfM0QsIDEsIDEgKTsKCiAgICAJLy8gaW5pdAoKICAgIAljb2xvckJ1ZmZlci5zZXRDbGVhciggMCwgMCwgMCwgMSApOwogICAgCWRlcHRoQnVmZmVyLnNldENsZWFyKCAxICk7CiAgICAJc3RlbmNpbEJ1ZmZlci5zZXRDbGVhciggMCApOwoKICAgIAllbmFibGUoIGdsLkRFUFRIX1RFU1QgKTsKICAgIAlkZXB0aEJ1ZmZlci5zZXRGdW5jKCBMZXNzRXF1YWxEZXB0aCApOwoKICAgIAlzZXRGbGlwU2lkZWQoIGZhbHNlICk7CiAgICAJc2V0Q3VsbEZhY2UoIEN1bGxGYWNlQmFjayApOwogICAgCWVuYWJsZSggZ2wuQ1VMTF9GQUNFICk7CgogICAgCXNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICk7CgogICAgCS8vCgogICAgCWZ1bmN0aW9uIGVuYWJsZSggaWQgKSB7CgogICAgCQlpZiAoIGVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gIT09IHRydWUgKSB7CgogICAgCQkJZ2wuZW5hYmxlKCBpZCApOwogICAgCQkJZW5hYmxlZENhcGFiaWxpdGllc1sgaWQgXSA9IHRydWU7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGlzYWJsZSggaWQgKSB7CgogICAgCQlpZiAoIGVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gIT09IGZhbHNlICkgewoKICAgIAkJCWdsLmRpc2FibGUoIGlkICk7CiAgICAJCQllbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdID0gZmFsc2U7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYmluZEZyYW1lYnVmZmVyKCB0YXJnZXQsIGZyYW1lYnVmZmVyICkgewoKICAgIAkJaWYgKCBjdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIHRhcmdldCBdICE9PSBmcmFtZWJ1ZmZlciApIHsKCiAgICAJCQlnbC5iaW5kRnJhbWVidWZmZXIoIHRhcmdldCwgZnJhbWVidWZmZXIgKTsKCiAgICAJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIHRhcmdldCBdID0gZnJhbWVidWZmZXI7CgogICAgCQkJLy8gZ2wuRFJBV19GUkFNRUJVRkZFUiBpcyBlcXVpdmFsZW50IHRvIGdsLkZSQU1FQlVGRkVSCgogICAgCQkJaWYgKCB0YXJnZXQgPT09IGdsLkRSQVdfRlJBTUVCVUZGRVIgKSB7CgogICAgCQkJCWN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1sgZ2wuRlJBTUVCVUZGRVIgXSA9IGZyYW1lYnVmZmVyOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHRhcmdldCA9PT0gZ2wuRlJBTUVCVUZGRVIgKSB7CgogICAgCQkJCWN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1sgZ2wuRFJBV19GUkFNRUJVRkZFUiBdID0gZnJhbWVidWZmZXI7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiB0cnVlOwoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGZhbHNlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRyYXdCdWZmZXJzKCByZW5kZXJUYXJnZXQsIGZyYW1lYnVmZmVyICkgewoKICAgIAkJbGV0IGRyYXdCdWZmZXJzID0gZGVmYXVsdERyYXdidWZmZXJzOwoKICAgIAkJbGV0IG5lZWRzVXBkYXRlID0gZmFsc2U7CgogICAgCQlpZiAoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCQlkcmF3QnVmZmVycyA9IGN1cnJlbnREcmF3YnVmZmVycy5nZXQoIGZyYW1lYnVmZmVyICk7CgogICAgCQkJaWYgKCBkcmF3QnVmZmVycyA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlkcmF3QnVmZmVycyA9IFtdOwogICAgCQkJCWN1cnJlbnREcmF3YnVmZmVycy5zZXQoIGZyYW1lYnVmZmVyLCBkcmF3QnVmZmVycyApOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCiAgICAJCQlpZiAoIGRyYXdCdWZmZXJzLmxlbmd0aCAhPT0gdGV4dHVyZXMubGVuZ3RoIHx8IGRyYXdCdWZmZXJzWyAwIF0gIT09IGdsLkNPTE9SX0FUVEFDSE1FTlQwICkgewoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQlkcmF3QnVmZmVyc1sgaSBdID0gZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpOwoKICAgIAkJCQl9CgogICAgCQkJCWRyYXdCdWZmZXJzLmxlbmd0aCA9IHRleHR1cmVzLmxlbmd0aDsKCiAgICAJCQkJbmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJaWYgKCBkcmF3QnVmZmVyc1sgMCBdICE9PSBnbC5CQUNLICkgewoKICAgIAkJCQlkcmF3QnVmZmVyc1sgMCBdID0gZ2wuQkFDSzsKCiAgICAJCQkJbmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggbmVlZHNVcGRhdGUgKSB7CgogICAgCQkJZ2wuZHJhd0J1ZmZlcnMoIGRyYXdCdWZmZXJzICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXNlUHJvZ3JhbSggcHJvZ3JhbSApIHsKCiAgICAJCWlmICggY3VycmVudFByb2dyYW0gIT09IHByb2dyYW0gKSB7CgogICAgCQkJZ2wudXNlUHJvZ3JhbSggcHJvZ3JhbSApOwoKICAgIAkJCWN1cnJlbnRQcm9ncmFtID0gcHJvZ3JhbTsKCiAgICAJCQlyZXR1cm4gdHJ1ZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBmYWxzZTsKCiAgICAJfQoKICAgIAljb25zdCBlcXVhdGlvblRvR0wgPSB7CiAgICAJCVsgQWRkRXF1YXRpb24gXTogZ2wuRlVOQ19BREQsCiAgICAJCVsgU3VidHJhY3RFcXVhdGlvbiBdOiBnbC5GVU5DX1NVQlRSQUNULAogICAgCQlbIFJldmVyc2VTdWJ0cmFjdEVxdWF0aW9uIF06IGdsLkZVTkNfUkVWRVJTRV9TVUJUUkFDVAogICAgCX07CgogICAgCWVxdWF0aW9uVG9HTFsgTWluRXF1YXRpb24gXSA9IGdsLk1JTjsKICAgIAllcXVhdGlvblRvR0xbIE1heEVxdWF0aW9uIF0gPSBnbC5NQVg7CgogICAgCWNvbnN0IGZhY3RvclRvR0wgPSB7CiAgICAJCVsgWmVyb0ZhY3RvciBdOiBnbC5aRVJPLAogICAgCQlbIE9uZUZhY3RvciBdOiBnbC5PTkUsCiAgICAJCVsgU3JjQ29sb3JGYWN0b3IgXTogZ2wuU1JDX0NPTE9SLAogICAgCQlbIFNyY0FscGhhRmFjdG9yIF06IGdsLlNSQ19BTFBIQSwKICAgIAkJWyBTcmNBbHBoYVNhdHVyYXRlRmFjdG9yIF06IGdsLlNSQ19BTFBIQV9TQVRVUkFURSwKICAgIAkJWyBEc3RDb2xvckZhY3RvciBdOiBnbC5EU1RfQ09MT1IsCiAgICAJCVsgRHN0QWxwaGFGYWN0b3IgXTogZ2wuRFNUX0FMUEhBLAogICAgCQlbIE9uZU1pbnVzU3JjQ29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwKICAgIAkJWyBPbmVNaW51c1NyY0FscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsCiAgICAJCVsgT25lTWludXNEc3RDb2xvckZhY3RvciBdOiBnbC5PTkVfTUlOVVNfRFNUX0NPTE9SLAogICAgCQlbIE9uZU1pbnVzRHN0QWxwaGFGYWN0b3IgXTogZ2wuT05FX01JTlVTX0RTVF9BTFBIQSwKICAgIAkJWyBDb25zdGFudENvbG9yRmFjdG9yIF06IGdsLkNPTlNUQU5UX0NPTE9SLAogICAgCQlbIE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvciBdOiBnbC5PTkVfTUlOVVNfQ09OU1RBTlRfQ09MT1IsCiAgICAJCVsgQ29uc3RhbnRBbHBoYUZhY3RvciBdOiBnbC5DT05TVEFOVF9BTFBIQSwKICAgIAkJWyBPbmVNaW51c0NvbnN0YW50QWxwaGFGYWN0b3IgXTogZ2wuT05FX01JTlVTX0NPTlNUQU5UX0FMUEhBCiAgICAJfTsKCiAgICAJZnVuY3Rpb24gc2V0QmxlbmRpbmcoIGJsZW5kaW5nLCBibGVuZEVxdWF0aW9uLCBibGVuZFNyYywgYmxlbmREc3QsIGJsZW5kRXF1YXRpb25BbHBoYSwgYmxlbmRTcmNBbHBoYSwgYmxlbmREc3RBbHBoYSwgYmxlbmRDb2xvciwgYmxlbmRBbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICkgewoKICAgIAkJaWYgKCBibGVuZGluZyA9PT0gTm9CbGVuZGluZyApIHsKCiAgICAJCQlpZiAoIGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPT09IHRydWUgKSB7CgogICAgCQkJCWRpc2FibGUoIGdsLkJMRU5EICk7CiAgICAJCQkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQlpZiAoIGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPT09IGZhbHNlICkgewoKICAgIAkJCWVuYWJsZSggZ2wuQkxFTkQgKTsKICAgIAkJCWN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJaWYgKCBibGVuZGluZyAhPT0gQ3VzdG9tQmxlbmRpbmcgKSB7CgogICAgCQkJaWYgKCBibGVuZGluZyAhPT0gY3VycmVudEJsZW5kaW5nIHx8IHByZW11bHRpcGxpZWRBbHBoYSAhPT0gY3VycmVudFByZW11bHRpcGxlZEFscGhhICkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRCbGVuZEVxdWF0aW9uICE9PSBBZGRFcXVhdGlvbiB8fCBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhICE9PSBBZGRFcXVhdGlvbiApIHsKCiAgICAJCQkJCWdsLmJsZW5kRXF1YXRpb24oIGdsLkZVTkNfQUREICk7CgogICAgCQkJCQljdXJyZW50QmxlbmRFcXVhdGlvbiA9IEFkZEVxdWF0aW9uOwogICAgCQkJCQljdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gQWRkRXF1YXRpb247CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBwcmVtdWx0aXBsaWVkQWxwaGEgKSB7CgogICAgCQkJCQlzd2l0Y2ggKCBibGVuZGluZyApIHsKCiAgICAJCQkJCQljYXNlIE5vcm1hbEJsZW5kaW5nOgogICAgCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKICAgIAkJCQkJCQlnbC5ibGVuZEZ1bmMoIGdsLk9ORSwgZ2wuT05FICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgogICAgCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5aRVJPLCBnbC5PTkVfTUlOVVNfU1JDX0NPTE9SLCBnbC5aRVJPLCBnbC5PTkUgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIE11bHRpcGx5QmxlbmRpbmc6CiAgICAJCQkJCQkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLkRTVF9DT0xPUiwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSwgZ2wuWkVSTywgZ2wuT05FICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJZGVmYXVsdDoKICAgIAkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTogSW52YWxpZCBibGVuZGluZzogJywgYmxlbmRpbmcgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXN3aXRjaCAoIGJsZW5kaW5nICkgewoKICAgIAkJCQkJCWNhc2UgTm9ybWFsQmxlbmRpbmc6CiAgICAJCQkJCQkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLlNSQ19BTFBIQSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSwgZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBICk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJY2FzZSBBZGRpdGl2ZUJsZW5kaW5nOgogICAgCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FLCBnbC5PTkUgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIFN1YnRyYWN0aXZlQmxlbmRpbmc6CiAgICAJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6IFN1YnRyYWN0aXZlQmxlbmRpbmcgcmVxdWlyZXMgbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZScgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQljYXNlIE11bHRpcGx5QmxlbmRpbmc6CiAgICAJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6IE11bHRpcGx5QmxlbmRpbmcgcmVxdWlyZXMgbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZScgKTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQlkZWZhdWx0OgogICAgCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBJbnZhbGlkIGJsZW5kaW5nOiAnLCBibGVuZGluZyApOwogICAgCQkJCQkJCWJyZWFrOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CiAgICAJCQkJY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKICAgIAkJCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CiAgICAJCQkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwogICAgCQkJCWN1cnJlbnRCbGVuZENvbG9yLnNldCggMCwgMCwgMCApOwogICAgCQkJCWN1cnJlbnRCbGVuZEFscGhhID0gMDsKCiAgICAJCQkJY3VycmVudEJsZW5kaW5nID0gYmxlbmRpbmc7CiAgICAJCQkJY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gcHJlbXVsdGlwbGllZEFscGhhOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQkvLyBjdXN0b20gYmxlbmRpbmcKCiAgICAJCWJsZW5kRXF1YXRpb25BbHBoYSA9IGJsZW5kRXF1YXRpb25BbHBoYSB8fCBibGVuZEVxdWF0aW9uOwogICAgCQlibGVuZFNyY0FscGhhID0gYmxlbmRTcmNBbHBoYSB8fCBibGVuZFNyYzsKICAgIAkJYmxlbmREc3RBbHBoYSA9IGJsZW5kRHN0QWxwaGEgfHwgYmxlbmREc3Q7CgogICAgCQlpZiAoIGJsZW5kRXF1YXRpb24gIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uIHx8IGJsZW5kRXF1YXRpb25BbHBoYSAhPT0gY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSApIHsKCiAgICAJCQlnbC5ibGVuZEVxdWF0aW9uU2VwYXJhdGUoIGVxdWF0aW9uVG9HTFsgYmxlbmRFcXVhdGlvbiBdLCBlcXVhdGlvblRvR0xbIGJsZW5kRXF1YXRpb25BbHBoYSBdICk7CgogICAgCQkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBibGVuZEVxdWF0aW9uOwogICAgCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IGJsZW5kRXF1YXRpb25BbHBoYTsKCiAgICAJCX0KCiAgICAJCWlmICggYmxlbmRTcmMgIT09IGN1cnJlbnRCbGVuZFNyYyB8fCBibGVuZERzdCAhPT0gY3VycmVudEJsZW5kRHN0IHx8IGJsZW5kU3JjQWxwaGEgIT09IGN1cnJlbnRCbGVuZFNyY0FscGhhIHx8IGJsZW5kRHN0QWxwaGEgIT09IGN1cnJlbnRCbGVuZERzdEFscGhhICkgewoKICAgIAkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBmYWN0b3JUb0dMWyBibGVuZFNyYyBdLCBmYWN0b3JUb0dMWyBibGVuZERzdCBdLCBmYWN0b3JUb0dMWyBibGVuZFNyY0FscGhhIF0sIGZhY3RvclRvR0xbIGJsZW5kRHN0QWxwaGEgXSApOwoKICAgIAkJCWN1cnJlbnRCbGVuZFNyYyA9IGJsZW5kU3JjOwogICAgCQkJY3VycmVudEJsZW5kRHN0ID0gYmxlbmREc3Q7CiAgICAJCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGE7CiAgICAJCQljdXJyZW50QmxlbmREc3RBbHBoYSA9IGJsZW5kRHN0QWxwaGE7CgogICAgCQl9CgogICAgCQlpZiAoIGJsZW5kQ29sb3IuZXF1YWxzKCBjdXJyZW50QmxlbmRDb2xvciApID09PSBmYWxzZSB8fCBibGVuZEFscGhhICE9PSBjdXJyZW50QmxlbmRBbHBoYSApIHsKCiAgICAJCQlnbC5ibGVuZENvbG9yKCBibGVuZENvbG9yLnIsIGJsZW5kQ29sb3IuZywgYmxlbmRDb2xvci5iLCBibGVuZEFscGhhICk7CgogICAgCQkJY3VycmVudEJsZW5kQ29sb3IuY29weSggYmxlbmRDb2xvciApOwogICAgCQkJY3VycmVudEJsZW5kQWxwaGEgPSBibGVuZEFscGhhOwoKICAgIAkJfQoKICAgIAkJY3VycmVudEJsZW5kaW5nID0gYmxlbmRpbmc7CiAgICAJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldE1hdGVyaWFsKCBtYXRlcmlhbCwgZnJvbnRGYWNlQ1cgKSB7CgogICAgCQltYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlCiAgICAJCQk/IGRpc2FibGUoIGdsLkNVTExfRkFDRSApCiAgICAJCQk6IGVuYWJsZSggZ2wuQ1VMTF9GQUNFICk7CgogICAgCQlsZXQgZmxpcFNpZGVkID0gKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApOwogICAgCQlpZiAoIGZyb250RmFjZUNXICkgZmxpcFNpZGVkID0gISBmbGlwU2lkZWQ7CgogICAgCQlzZXRGbGlwU2lkZWQoIGZsaXBTaWRlZCApOwoKICAgIAkJKCBtYXRlcmlhbC5ibGVuZGluZyA9PT0gTm9ybWFsQmxlbmRpbmcgJiYgbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IGZhbHNlICkKICAgIAkJCT8gc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKQogICAgCQkJOiBzZXRCbGVuZGluZyggbWF0ZXJpYWwuYmxlbmRpbmcsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb24sIG1hdGVyaWFsLmJsZW5kU3JjLCBtYXRlcmlhbC5ibGVuZERzdCwgbWF0ZXJpYWwuYmxlbmRFcXVhdGlvbkFscGhhLCBtYXRlcmlhbC5ibGVuZFNyY0FscGhhLCBtYXRlcmlhbC5ibGVuZERzdEFscGhhLCBtYXRlcmlhbC5ibGVuZENvbG9yLCBtYXRlcmlhbC5ibGVuZEFscGhhLCBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEgKTsKCiAgICAJCWRlcHRoQnVmZmVyLnNldEZ1bmMoIG1hdGVyaWFsLmRlcHRoRnVuYyApOwogICAgCQlkZXB0aEJ1ZmZlci5zZXRUZXN0KCBtYXRlcmlhbC5kZXB0aFRlc3QgKTsKICAgIAkJZGVwdGhCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuZGVwdGhXcml0ZSApOwogICAgCQljb2xvckJ1ZmZlci5zZXRNYXNrKCBtYXRlcmlhbC5jb2xvcldyaXRlICk7CgogICAgCQljb25zdCBzdGVuY2lsV3JpdGUgPSBtYXRlcmlhbC5zdGVuY2lsV3JpdGU7CiAgICAJCXN0ZW5jaWxCdWZmZXIuc2V0VGVzdCggc3RlbmNpbFdyaXRlICk7CiAgICAJCWlmICggc3RlbmNpbFdyaXRlICkgewoKICAgIAkJCXN0ZW5jaWxCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuc3RlbmNpbFdyaXRlTWFzayApOwogICAgCQkJc3RlbmNpbEJ1ZmZlci5zZXRGdW5jKCBtYXRlcmlhbC5zdGVuY2lsRnVuYywgbWF0ZXJpYWwuc3RlbmNpbFJlZiwgbWF0ZXJpYWwuc3RlbmNpbEZ1bmNNYXNrICk7CiAgICAJCQlzdGVuY2lsQnVmZmVyLnNldE9wKCBtYXRlcmlhbC5zdGVuY2lsRmFpbCwgbWF0ZXJpYWwuc3RlbmNpbFpGYWlsLCBtYXRlcmlhbC5zdGVuY2lsWlBhc3MgKTsKCiAgICAJCX0KCiAgICAJCXNldFBvbHlnb25PZmZzZXQoIG1hdGVyaWFsLnBvbHlnb25PZmZzZXQsIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRGYWN0b3IsIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRVbml0cyApOwoKICAgIAkJbWF0ZXJpYWwuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlCiAgICAJCQk/IGVuYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICkKICAgIAkJCTogZGlzYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICk7CgogICAgCX0KCiAgICAJLy8KCiAgICAJZnVuY3Rpb24gc2V0RmxpcFNpZGVkKCBmbGlwU2lkZWQgKSB7CgogICAgCQlpZiAoIGN1cnJlbnRGbGlwU2lkZWQgIT09IGZsaXBTaWRlZCApIHsKCiAgICAJCQlpZiAoIGZsaXBTaWRlZCApIHsKCiAgICAJCQkJZ2wuZnJvbnRGYWNlKCBnbC5DVyApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWdsLmZyb250RmFjZSggZ2wuQ0NXICk7CgogICAgCQkJfQoKICAgIAkJCWN1cnJlbnRGbGlwU2lkZWQgPSBmbGlwU2lkZWQ7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0Q3VsbEZhY2UoIGN1bGxGYWNlICkgewoKICAgIAkJaWYgKCBjdWxsRmFjZSAhPT0gQ3VsbEZhY2VOb25lICkgewoKICAgIAkJCWVuYWJsZSggZ2wuQ1VMTF9GQUNFICk7CgogICAgCQkJaWYgKCBjdWxsRmFjZSAhPT0gY3VycmVudEN1bGxGYWNlICkgewoKICAgIAkJCQlpZiAoIGN1bGxGYWNlID09PSBDdWxsRmFjZUJhY2sgKSB7CgogICAgCQkJCQlnbC5jdWxsRmFjZSggZ2wuQkFDSyApOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VGcm9udCApIHsKCiAgICAJCQkJCWdsLmN1bGxGYWNlKCBnbC5GUk9OVCApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJZ2wuY3VsbEZhY2UoIGdsLkZST05UX0FORF9CQUNLICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWRpc2FibGUoIGdsLkNVTExfRkFDRSApOwoKICAgIAkJfQoKICAgIAkJY3VycmVudEN1bGxGYWNlID0gY3VsbEZhY2U7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0TGluZVdpZHRoKCB3aWR0aCApIHsKCiAgICAJCWlmICggd2lkdGggIT09IGN1cnJlbnRMaW5lV2lkdGggKSB7CgogICAgCQkJaWYgKCBsaW5lV2lkdGhBdmFpbGFibGUgKSBnbC5saW5lV2lkdGgoIHdpZHRoICk7CgogICAgCQkJY3VycmVudExpbmVXaWR0aCA9IHdpZHRoOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldFBvbHlnb25PZmZzZXQoIHBvbHlnb25PZmZzZXQsIGZhY3RvciwgdW5pdHMgKSB7CgogICAgCQlpZiAoIHBvbHlnb25PZmZzZXQgKSB7CgogICAgCQkJZW5hYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgogICAgCQkJaWYgKCBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciAhPT0gZmFjdG9yIHx8IGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgIT09IHVuaXRzICkgewoKICAgIAkJCQlnbC5wb2x5Z29uT2Zmc2V0KCBmYWN0b3IsIHVuaXRzICk7CgogICAgCQkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0RmFjdG9yID0gZmFjdG9yOwogICAgCQkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSB1bml0czsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWRpc2FibGUoIGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBzZXRTY2lzc29yVGVzdCggc2Npc3NvclRlc3QgKSB7CgogICAgCQlpZiAoIHNjaXNzb3JUZXN0ICkgewoKICAgIAkJCWVuYWJsZSggZ2wuU0NJU1NPUl9URVNUICk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWRpc2FibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vIHRleHR1cmUKCiAgICAJZnVuY3Rpb24gYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICkgewoKICAgIAkJaWYgKCB3ZWJnbFNsb3QgPT09IHVuZGVmaW5lZCApIHdlYmdsU2xvdCA9IGdsLlRFWFRVUkUwICsgbWF4VGV4dHVyZXMgLSAxOwoKICAgIAkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCiAgICAJCQlnbC5hY3RpdmVUZXh0dXJlKCB3ZWJnbFNsb3QgKTsKICAgIAkJCWN1cnJlbnRUZXh0dXJlU2xvdCA9IHdlYmdsU2xvdDsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBiaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUsIHdlYmdsU2xvdCApIHsKCiAgICAJCWlmICggd2ViZ2xTbG90ID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgPT09IG51bGwgKSB7CgogICAgCQkJCXdlYmdsU2xvdCA9IGdsLlRFWFRVUkUwICsgbWF4VGV4dHVyZXMgLSAxOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXdlYmdsU2xvdCA9IGN1cnJlbnRUZXh0dXJlU2xvdDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlsZXQgYm91bmRUZXh0dXJlID0gY3VycmVudEJvdW5kVGV4dHVyZXNbIHdlYmdsU2xvdCBdOwoKICAgIAkJaWYgKCBib3VuZFRleHR1cmUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlib3VuZFRleHR1cmUgPSB7IHR5cGU6IHVuZGVmaW5lZCwgdGV4dHVyZTogdW5kZWZpbmVkIH07CiAgICAJCQljdXJyZW50Qm91bmRUZXh0dXJlc1sgd2ViZ2xTbG90IF0gPSBib3VuZFRleHR1cmU7CgogICAgCQl9CgogICAgCQlpZiAoIGJvdW5kVGV4dHVyZS50eXBlICE9PSB3ZWJnbFR5cGUgfHwgYm91bmRUZXh0dXJlLnRleHR1cmUgIT09IHdlYmdsVGV4dHVyZSApIHsKCiAgICAJCQlpZiAoIGN1cnJlbnRUZXh0dXJlU2xvdCAhPT0gd2ViZ2xTbG90ICkgewoKICAgIAkJCQlnbC5hY3RpdmVUZXh0dXJlKCB3ZWJnbFNsb3QgKTsKICAgIAkJCQljdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CgogICAgCQkJfQoKICAgIAkJCWdsLmJpbmRUZXh0dXJlKCB3ZWJnbFR5cGUsIHdlYmdsVGV4dHVyZSB8fCBlbXB0eVRleHR1cmVzWyB3ZWJnbFR5cGUgXSApOwoKICAgIAkJCWJvdW5kVGV4dHVyZS50eXBlID0gd2ViZ2xUeXBlOwogICAgCQkJYm91bmRUZXh0dXJlLnRleHR1cmUgPSB3ZWJnbFRleHR1cmU7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdW5iaW5kVGV4dHVyZSgpIHsKCiAgICAJCWNvbnN0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzWyBjdXJyZW50VGV4dHVyZVNsb3QgXTsKCiAgICAJCWlmICggYm91bmRUZXh0dXJlICE9PSB1bmRlZmluZWQgJiYgYm91bmRUZXh0dXJlLnR5cGUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlnbC5iaW5kVGV4dHVyZSggYm91bmRUZXh0dXJlLnR5cGUsIG51bGwgKTsKCiAgICAJCQlib3VuZFRleHR1cmUudHlwZSA9IHVuZGVmaW5lZDsKICAgIAkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gdW5kZWZpbmVkOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhJbWFnZTJEKCkgewoKICAgIAkJdHJ5IHsKCiAgICAJCQlnbC5jb21wcmVzc2VkVGV4SW1hZ2UyRCggLi4uYXJndW1lbnRzICk7CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBjb21wcmVzc2VkVGV4SW1hZ2UzRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wuY29tcHJlc3NlZFRleEltYWdlM0QoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4U3ViSW1hZ2UyRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wudGV4U3ViSW1hZ2UyRCggLi4uYXJndW1lbnRzICk7CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB0ZXhTdWJJbWFnZTNEKCkgewoKICAgIAkJdHJ5IHsKCiAgICAJCQlnbC50ZXhTdWJJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCkgewoKICAgIAkJdHJ5IHsKCiAgICAJCQlnbC5jb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCggLi4uYXJndW1lbnRzICk7CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlM0QoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4U3RvcmFnZTJEKCkgewoKICAgIAkJdHJ5IHsKCiAgICAJCQlnbC50ZXhTdG9yYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4U3RvcmFnZTNEKCkgewoKICAgIAkJdHJ5IHsKCiAgICAJCQlnbC50ZXhTdG9yYWdlM0QoIC4uLmFyZ3VtZW50cyApOwoKICAgIAkJfSBjYXRjaCAoIGVycm9yICkgewoKICAgIAkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdGV4SW1hZ2UyRCgpIHsKCiAgICAJCXRyeSB7CgogICAgCQkJZ2wudGV4SW1hZ2UyRCggLi4uYXJndW1lbnRzICk7CgogICAgCQl9IGNhdGNoICggZXJyb3IgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB0ZXhJbWFnZTNEKCkgewoKICAgIAkJdHJ5IHsKCiAgICAJCQlnbC50ZXhJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vCgogICAgCWZ1bmN0aW9uIHNjaXNzb3IoIHNjaXNzb3IgKSB7CgogICAgCQlpZiAoIGN1cnJlbnRTY2lzc29yLmVxdWFscyggc2Npc3NvciApID09PSBmYWxzZSApIHsKCiAgICAJCQlnbC5zY2lzc29yKCBzY2lzc29yLngsIHNjaXNzb3IueSwgc2Npc3Nvci56LCBzY2lzc29yLncgKTsKICAgIAkJCWN1cnJlbnRTY2lzc29yLmNvcHkoIHNjaXNzb3IgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB2aWV3cG9ydCggdmlld3BvcnQgKSB7CgogICAgCQlpZiAoIGN1cnJlbnRWaWV3cG9ydC5lcXVhbHMoIHZpZXdwb3J0ICkgPT09IGZhbHNlICkgewoKICAgIAkJCWdsLnZpZXdwb3J0KCB2aWV3cG9ydC54LCB2aWV3cG9ydC55LCB2aWV3cG9ydC56LCB2aWV3cG9ydC53ICk7CiAgICAJCQljdXJyZW50Vmlld3BvcnQuY29weSggdmlld3BvcnQgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1cGRhdGVVQk9NYXBwaW5nKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKICAgIAkJbGV0IG1hcHBpbmcgPSB1Ym9Qcm9ncmFtTWFwLmdldCggcHJvZ3JhbSApOwoKICAgIAkJaWYgKCBtYXBwaW5nID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJbWFwcGluZyA9IG5ldyBXZWFrTWFwKCk7CgogICAgCQkJdWJvUHJvZ3JhbU1hcC5zZXQoIHByb2dyYW0sIG1hcHBpbmcgKTsKCiAgICAJCX0KCiAgICAJCWxldCBibG9ja0luZGV4ID0gbWFwcGluZy5nZXQoIHVuaWZvcm1zR3JvdXAgKTsKCiAgICAJCWlmICggYmxvY2tJbmRleCA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCWJsb2NrSW5kZXggPSBnbC5nZXRVbmlmb3JtQmxvY2tJbmRleCggcHJvZ3JhbSwgdW5pZm9ybXNHcm91cC5uYW1lICk7CgogICAgCQkJbWFwcGluZy5zZXQoIHVuaWZvcm1zR3JvdXAsIGJsb2NrSW5kZXggKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1bmlmb3JtQmxvY2tCaW5kaW5nKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKICAgIAkJY29uc3QgbWFwcGluZyA9IHVib1Byb2dyYW1NYXAuZ2V0KCBwcm9ncmFtICk7CiAgICAJCWNvbnN0IGJsb2NrSW5kZXggPSBtYXBwaW5nLmdldCggdW5pZm9ybXNHcm91cCApOwoKICAgIAkJaWYgKCB1Ym9CaW5kaW5ncy5nZXQoIHByb2dyYW0gKSAhPT0gYmxvY2tJbmRleCApIHsKCiAgICAJCQkvLyBiaW5kIHNoYWRlciBzcGVjaWZpYyBibG9jayBpbmRleCB0byBnbG9iYWwgYmxvY2sgcG9pbnQKICAgIAkJCWdsLnVuaWZvcm1CbG9ja0JpbmRpbmcoIHByb2dyYW0sIGJsb2NrSW5kZXgsIHVuaWZvcm1zR3JvdXAuX19iaW5kaW5nUG9pbnRJbmRleCApOwoKICAgIAkJCXVib0JpbmRpbmdzLnNldCggcHJvZ3JhbSwgYmxvY2tJbmRleCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vCgogICAgCWZ1bmN0aW9uIHJlc2V0KCkgewoKICAgIAkJLy8gcmVzZXQgc3RhdGUKCiAgICAJCWdsLmRpc2FibGUoIGdsLkJMRU5EICk7CiAgICAJCWdsLmRpc2FibGUoIGdsLkNVTExfRkFDRSApOwogICAgCQlnbC5kaXNhYmxlKCBnbC5ERVBUSF9URVNUICk7CiAgICAJCWdsLmRpc2FibGUoIGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwgKTsKICAgIAkJZ2wuZGlzYWJsZSggZ2wuU0NJU1NPUl9URVNUICk7CiAgICAJCWdsLmRpc2FibGUoIGdsLlNURU5DSUxfVEVTVCApOwogICAgCQlnbC5kaXNhYmxlKCBnbC5TQU1QTEVfQUxQSEFfVE9fQ09WRVJBR0UgKTsKCiAgICAJCWdsLmJsZW5kRXF1YXRpb24oIGdsLkZVTkNfQUREICk7CiAgICAJCWdsLmJsZW5kRnVuYyggZ2wuT05FLCBnbC5aRVJPICk7CiAgICAJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5PTkUsIGdsLlpFUk8sIGdsLk9ORSwgZ2wuWkVSTyApOwogICAgCQlnbC5ibGVuZENvbG9yKCAwLCAwLCAwLCAwICk7CgogICAgCQlnbC5jb2xvck1hc2soIHRydWUsIHRydWUsIHRydWUsIHRydWUgKTsKICAgIAkJZ2wuY2xlYXJDb2xvciggMCwgMCwgMCwgMCApOwoKICAgIAkJZ2wuZGVwdGhNYXNrKCB0cnVlICk7CiAgICAJCWdsLmRlcHRoRnVuYyggZ2wuTEVTUyApOwoKICAgIAkJZGVwdGhCdWZmZXIuc2V0UmV2ZXJzZWQoIGZhbHNlICk7CgogICAgCQlnbC5jbGVhckRlcHRoKCAxICk7CgogICAgCQlnbC5zdGVuY2lsTWFzayggMHhmZmZmZmZmZiApOwogICAgCQlnbC5zdGVuY2lsRnVuYyggZ2wuQUxXQVlTLCAwLCAweGZmZmZmZmZmICk7CiAgICAJCWdsLnN0ZW5jaWxPcCggZ2wuS0VFUCwgZ2wuS0VFUCwgZ2wuS0VFUCApOwogICAgCQlnbC5jbGVhclN0ZW5jaWwoIDAgKTsKCiAgICAJCWdsLmN1bGxGYWNlKCBnbC5CQUNLICk7CiAgICAJCWdsLmZyb250RmFjZSggZ2wuQ0NXICk7CgogICAgCQlnbC5wb2x5Z29uT2Zmc2V0KCAwLCAwICk7CgogICAgCQlnbC5hY3RpdmVUZXh0dXJlKCBnbC5URVhUVVJFMCApOwoKICAgIAkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5GUkFNRUJVRkZFUiwgbnVsbCApOwogICAgCQlnbC5iaW5kRnJhbWVidWZmZXIoIGdsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKICAgIAkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5SRUFEX0ZSQU1FQlVGRkVSLCBudWxsICk7CgogICAgCQlnbC51c2VQcm9ncmFtKCBudWxsICk7CgogICAgCQlnbC5saW5lV2lkdGgoIDEgKTsKCiAgICAJCWdsLnNjaXNzb3IoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwogICAgCQlnbC52aWV3cG9ydCggMCwgMCwgZ2wuY2FudmFzLndpZHRoLCBnbC5jYW52YXMuaGVpZ2h0ICk7CgogICAgCQkvLyByZXNldCBpbnRlcm5hbHMKCiAgICAJCWVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKCiAgICAJCWN1cnJlbnRUZXh0dXJlU2xvdCA9IG51bGw7CiAgICAJCWN1cnJlbnRCb3VuZFRleHR1cmVzID0ge307CgogICAgCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnMgPSB7fTsKICAgIAkJY3VycmVudERyYXdidWZmZXJzID0gbmV3IFdlYWtNYXAoKTsKICAgIAkJZGVmYXVsdERyYXdidWZmZXJzID0gW107CgogICAgCQljdXJyZW50UHJvZ3JhbSA9IG51bGw7CgogICAgCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gZmFsc2U7CiAgICAJCWN1cnJlbnRCbGVuZGluZyA9IG51bGw7CiAgICAJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gbnVsbDsKICAgIAkJY3VycmVudEJsZW5kU3JjID0gbnVsbDsKICAgIAkJY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKICAgIAkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CiAgICAJCWN1cnJlbnRCbGVuZFNyY0FscGhhID0gbnVsbDsKICAgIAkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwogICAgCQljdXJyZW50QmxlbmRDb2xvciA9IG5ldyBDb2xvciggMCwgMCwgMCApOwogICAgCQljdXJyZW50QmxlbmRBbHBoYSA9IDA7CiAgICAJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwoKICAgIAkJY3VycmVudEZsaXBTaWRlZCA9IG51bGw7CiAgICAJCWN1cnJlbnRDdWxsRmFjZSA9IG51bGw7CgogICAgCQljdXJyZW50TGluZVdpZHRoID0gbnVsbDsKCiAgICAJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0RmFjdG9yID0gbnVsbDsKICAgIAkJY3VycmVudFBvbHlnb25PZmZzZXRVbml0cyA9IG51bGw7CgogICAgCQljdXJyZW50U2Npc3Nvci5zZXQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwogICAgCQljdXJyZW50Vmlld3BvcnQuc2V0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCiAgICAJCWNvbG9yQnVmZmVyLnJlc2V0KCk7CiAgICAJCWRlcHRoQnVmZmVyLnJlc2V0KCk7CiAgICAJCXN0ZW5jaWxCdWZmZXIucmVzZXQoKTsKCiAgICAJfQoKICAgIAlyZXR1cm4gewoKICAgIAkJYnVmZmVyczogewogICAgCQkJY29sb3I6IGNvbG9yQnVmZmVyLAogICAgCQkJZGVwdGg6IGRlcHRoQnVmZmVyLAogICAgCQkJc3RlbmNpbDogc3RlbmNpbEJ1ZmZlcgogICAgCQl9LAoKICAgIAkJZW5hYmxlOiBlbmFibGUsCiAgICAJCWRpc2FibGU6IGRpc2FibGUsCgogICAgCQliaW5kRnJhbWVidWZmZXI6IGJpbmRGcmFtZWJ1ZmZlciwKICAgIAkJZHJhd0J1ZmZlcnM6IGRyYXdCdWZmZXJzLAoKICAgIAkJdXNlUHJvZ3JhbTogdXNlUHJvZ3JhbSwKCiAgICAJCXNldEJsZW5kaW5nOiBzZXRCbGVuZGluZywKICAgIAkJc2V0TWF0ZXJpYWw6IHNldE1hdGVyaWFsLAoKICAgIAkJc2V0RmxpcFNpZGVkOiBzZXRGbGlwU2lkZWQsCiAgICAJCXNldEN1bGxGYWNlOiBzZXRDdWxsRmFjZSwKCiAgICAJCXNldExpbmVXaWR0aDogc2V0TGluZVdpZHRoLAogICAgCQlzZXRQb2x5Z29uT2Zmc2V0OiBzZXRQb2x5Z29uT2Zmc2V0LAoKICAgIAkJc2V0U2Npc3NvclRlc3Q6IHNldFNjaXNzb3JUZXN0LAoKICAgIAkJYWN0aXZlVGV4dHVyZTogYWN0aXZlVGV4dHVyZSwKICAgIAkJYmluZFRleHR1cmU6IGJpbmRUZXh0dXJlLAogICAgCQl1bmJpbmRUZXh0dXJlOiB1bmJpbmRUZXh0dXJlLAogICAgCQljb21wcmVzc2VkVGV4SW1hZ2UyRDogY29tcHJlc3NlZFRleEltYWdlMkQsCiAgICAJCWNvbXByZXNzZWRUZXhJbWFnZTNEOiBjb21wcmVzc2VkVGV4SW1hZ2UzRCwKICAgIAkJdGV4SW1hZ2UyRDogdGV4SW1hZ2UyRCwKICAgIAkJdGV4SW1hZ2UzRDogdGV4SW1hZ2UzRCwKCiAgICAJCXVwZGF0ZVVCT01hcHBpbmc6IHVwZGF0ZVVCT01hcHBpbmcsCiAgICAJCXVuaWZvcm1CbG9ja0JpbmRpbmc6IHVuaWZvcm1CbG9ja0JpbmRpbmcsCgogICAgCQl0ZXhTdG9yYWdlMkQ6IHRleFN0b3JhZ2UyRCwKICAgIAkJdGV4U3RvcmFnZTNEOiB0ZXhTdG9yYWdlM0QsCiAgICAJCXRleFN1YkltYWdlMkQ6IHRleFN1YkltYWdlMkQsCiAgICAJCXRleFN1YkltYWdlM0Q6IHRleFN1YkltYWdlM0QsCiAgICAJCWNvbXByZXNzZWRUZXhTdWJJbWFnZTJEOiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCwKICAgIAkJY29tcHJlc3NlZFRleFN1YkltYWdlM0Q6IGNvbXByZXNzZWRUZXhTdWJJbWFnZTNELAoKICAgIAkJc2Npc3Nvcjogc2Npc3NvciwKICAgIAkJdmlld3BvcnQ6IHZpZXdwb3J0LAoKICAgIAkJcmVzZXQ6IHJlc2V0CgogICAgCX07CgogICAgfQoKICAgIGZ1bmN0aW9uIFdlYkdMVGV4dHVyZXMoIF9nbCwgZXh0ZW5zaW9ucywgc3RhdGUsIHByb3BlcnRpZXMsIGNhcGFiaWxpdGllcywgdXRpbHMsIGluZm8gKSB7CgogICAgCWNvbnN0IG11bHRpc2FtcGxlZFJUVEV4dCA9IGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApID8gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgOiBudWxsOwogICAgCWNvbnN0IHN1cHBvcnRzSW52YWxpZGF0ZUZyYW1lYnVmZmVyID0gdHlwZW9mIG5hdmlnYXRvciA9PT0gJ3VuZGVmaW5lZCcgPyBmYWxzZSA6IC9PY3VsdXNCcm93c2VyL2cudGVzdCggbmF2aWdhdG9yLnVzZXJBZ2VudCApOwoKICAgIAljb25zdCBfaW1hZ2VEaW1lbnNpb25zID0gbmV3IFZlY3RvcjIoKTsKICAgIAljb25zdCBfdmlkZW9UZXh0dXJlcyA9IG5ldyBXZWFrTWFwKCk7CiAgICAJbGV0IF9jYW52YXM7CgogICAgCWNvbnN0IF9zb3VyY2VzID0gbmV3IFdlYWtNYXAoKTsgLy8gbWFwcyBXZWJnbFRleHR1cmUgb2JqZWN0cyB0byBpbnN0YW5jZXMgb2YgU291cmNlCgogICAgCS8vIGNvcmRvdmEgaU9TIChhcyBvZiA1LjApIHN0aWxsIHVzZXMgVUlXZWJWaWV3LCB3aGljaCBwcm92aWRlcyBPZmZzY3JlZW5DYW52YXMsCiAgICAJLy8gYWxzbyBPZmZzY3JlZW5DYW52YXMuZ2V0Q29udGV4dCgid2ViZ2wiKSwgYnV0IG5vdCBPZmZzY3JlZW5DYW52YXMuZ2V0Q29udGV4dCgiMmQiKSEKICAgIAkvLyBTb21lIGltcGxlbWVudGF0aW9ucyBtYXkgb25seSBpbXBsZW1lbnQgT2Zmc2NyZWVuQ2FudmFzIHBhcnRpYWxseSAoZS5nLiBsYWNraW5nIDJkKS4KCiAgICAJbGV0IHVzZU9mZnNjcmVlbkNhbnZhcyA9IGZhbHNlOwoKICAgIAl0cnkgewoKICAgIAkJdXNlT2Zmc2NyZWVuQ2FudmFzID0gdHlwZW9mIE9mZnNjcmVlbkNhbnZhcyAhPT0gJ3VuZGVmaW5lZCcKICAgIAkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wYXQvY29tcGF0CiAgICAJCQkmJiAoIG5ldyBPZmZzY3JlZW5DYW52YXMoIDEsIDEgKS5nZXRDb250ZXh0KCAnMmQnICkgKSAhPT0gbnVsbDsKCiAgICAJfSBjYXRjaCAoIGVyciApIHsKCiAgICAJCS8vIElnbm9yZSBhbnkgZXJyb3JzCgogICAgCX0KCiAgICAJZnVuY3Rpb24gY3JlYXRlQ2FudmFzKCB3aWR0aCwgaGVpZ2h0ICkgewoKICAgIAkJLy8gVXNlIE9mZnNjcmVlbkNhbnZhcyB3aGVuIGF2YWlsYWJsZS4gU3BlY2lhbGx5IG5lZWRlZCBpbiB3ZWIgd29ya2VycwoKICAgIAkJcmV0dXJuIHVzZU9mZnNjcmVlbkNhbnZhcyA/CiAgICAJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGF0L2NvbXBhdAogICAgCQkJbmV3IE9mZnNjcmVlbkNhbnZhcyggd2lkdGgsIGhlaWdodCApIDogY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlc2l6ZUltYWdlKCBpbWFnZSwgbmVlZHNOZXdDYW52YXMsIG1heFNpemUgKSB7CgogICAgCQlsZXQgc2NhbGUgPSAxOwoKICAgIAkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGltYWdlICk7CgogICAgCQkvLyBoYW5kbGUgY2FzZSBpZiB0ZXh0dXJlIGV4Y2VlZHMgbWF4IHNpemUKCiAgICAJCWlmICggZGltZW5zaW9ucy53aWR0aCA+IG1heFNpemUgfHwgZGltZW5zaW9ucy5oZWlnaHQgPiBtYXhTaXplICkgewoKICAgIAkJCXNjYWxlID0gbWF4U2l6ZSAvIE1hdGgubWF4KCBkaW1lbnNpb25zLndpZHRoLCBkaW1lbnNpb25zLmhlaWdodCApOwoKICAgIAkJfQoKICAgIAkJLy8gb25seSBwZXJmb3JtIHJlc2l6ZSBpZiBuZWNlc3NhcnkKCiAgICAJCWlmICggc2NhbGUgPCAxICkgewoKICAgIAkJCS8vIG9ubHkgcGVyZm9ybSByZXNpemUgZm9yIGNlcnRhaW4gaW1hZ2UgdHlwZXMKCiAgICAJCQlpZiAoICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHx8CiAgICAJCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAogICAgCQkJCSggdHlwZW9mIEltYWdlQml0bWFwICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEltYWdlQml0bWFwICkgfHwKICAgIAkJCQkoIHR5cGVvZiBWaWRlb0ZyYW1lICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIFZpZGVvRnJhbWUgKSApIHsKCiAgICAJCQkJY29uc3Qgd2lkdGggPSBNYXRoLmZsb29yKCBzY2FsZSAqIGRpbWVuc2lvbnMud2lkdGggKTsKICAgIAkJCQljb25zdCBoZWlnaHQgPSBNYXRoLmZsb29yKCBzY2FsZSAqIGRpbWVuc2lvbnMuaGVpZ2h0ICk7CgogICAgCQkJCWlmICggX2NhbnZhcyA9PT0gdW5kZWZpbmVkICkgX2NhbnZhcyA9IGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApOwoKICAgIAkJCQkvLyBjdWJlIHRleHR1cmVzIGNhbid0IHJldXNlIHRoZSBzYW1lIGNhbnZhcwoKICAgIAkJCQljb25zdCBjYW52YXMgPSBuZWVkc05ld0NhbnZhcyA/IGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIDogX2NhbnZhczsKCiAgICAJCQkJY2FudmFzLndpZHRoID0gd2lkdGg7CiAgICAJCQkJY2FudmFzLmhlaWdodCA9IGhlaWdodDsKCiAgICAJCQkJY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CiAgICAJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgaGFzIGJlZW4gcmVzaXplZCBmcm9tICgnICsgZGltZW5zaW9ucy53aWR0aCArICd4JyArIGRpbWVuc2lvbnMuaGVpZ2h0ICsgJykgdG8gKCcgKyB3aWR0aCArICd4JyArIGhlaWdodCArICcpLicgKTsKCiAgICAJCQkJcmV0dXJuIGNhbnZhczsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlpZiAoICdkYXRhJyBpbiBpbWFnZSApIHsKCiAgICAJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEltYWdlIGluIERhdGFUZXh0dXJlIGlzIHRvbyBiaWcgKCcgKyBkaW1lbnNpb25zLndpZHRoICsgJ3gnICsgZGltZW5zaW9ucy5oZWlnaHQgKyAnKS4nICk7CgogICAgCQkJCX0KCiAgICAJCQkJcmV0dXJuIGltYWdlOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiBpbWFnZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSB7CgogICAgCQlyZXR1cm4gdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHM7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2VuZXJhdGVNaXBtYXAoIHRhcmdldCApIHsKCiAgICAJCV9nbC5nZW5lcmF0ZU1pcG1hcCggdGFyZ2V0ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZ2V0VGFyZ2V0VHlwZSggdGV4dHVyZSApIHsKCiAgICAJCWlmICggdGV4dHVyZS5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApIHJldHVybiBfZ2wuVEVYVFVSRV9DVUJFX01BUDsKICAgIAkJaWYgKCB0ZXh0dXJlLmlzV2ViR0wzRFJlbmRlclRhcmdldCApIHJldHVybiBfZ2wuVEVYVFVSRV8zRDsKICAgIAkJaWYgKCB0ZXh0dXJlLmlzV2ViR0xBcnJheVJlbmRlclRhcmdldCB8fCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHJldHVybiBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKICAgIAkJcmV0dXJuIF9nbC5URVhUVVJFXzJEOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldEludGVybmFsRm9ybWF0KCBpbnRlcm5hbEZvcm1hdE5hbWUsIGdsRm9ybWF0LCBnbFR5cGUsIGNvbG9yU3BhY2UsIGZvcmNlTGluZWFyVHJhbnNmZXIgPSBmYWxzZSApIHsKCiAgICAJCWlmICggaW50ZXJuYWxGb3JtYXROYW1lICE9PSBudWxsICkgewoKICAgIAkJCWlmICggX2dsWyBpbnRlcm5hbEZvcm1hdE5hbWUgXSAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIF9nbFsgaW50ZXJuYWxGb3JtYXROYW1lIF07CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byB1c2Ugbm9uLWV4aXN0aW5nIFdlYkdMIGludGVybmFsIGZvcm1hdCBcJycgKyBpbnRlcm5hbEZvcm1hdE5hbWUgKyAnXCcnICk7CgogICAgCQl9CgogICAgCQlsZXQgaW50ZXJuYWxGb3JtYXQgPSBnbEZvcm1hdDsKCiAgICAJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SRUQgKSB7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMkY7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMTZGOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjg7CgogICAgCQl9CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkVEX0lOVEVHRVIgKSB7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjhVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMTZVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfSU5UICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjMyVUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkJZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SOEk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2STsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuSU5UICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjMySTsKCiAgICAJCX0KCiAgICAJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SRyApIHsKCiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkczMkY7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzE2RjsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHODsKCiAgICAJCX0KCiAgICAJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR19JTlRFR0VSICkgewoKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHOFVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMTZVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfSU5UICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkczMlVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkc4STsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzE2STsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuSU5UICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkczMkk7CgogICAgCQl9CgogICAgCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCX0lOVEVHRVIgKSB7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOFVJOwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjE2VUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjMyVUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkJZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0I4STsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IxNkk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjMySTsKCiAgICAJCX0KCiAgICAJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR0JBX0lOVEVHRVIgKSB7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQThVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBMTZVSTsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfSU5UICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTMyVUk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkJZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBOEk7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTE2STsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuSU5UICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTMySTsKCiAgICAJCX0KCiAgICAJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR0IgKSB7CgogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9JTlRfNV85XzlfOV9SRVYgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0I5X0U1OwoKICAgIAkJfQoKICAgIAkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJHQkEgKSB7CgogICAgCQkJY29uc3QgdHJhbnNmZXIgPSBmb3JjZUxpbmVhclRyYW5zZmVyID8gTGluZWFyVHJhbnNmZXIgOiBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGNvbG9yU3BhY2UgKTsKCiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTMyRjsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuSEFMRl9GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkExNkY7CiAgICAJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9ICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gX2dsLlNSR0I4X0FMUEhBOCA6IF9nbC5SR0JBODsKICAgIAkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlRfNF80XzRfNCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkE0OwogICAgCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9TSE9SVF81XzVfNV8xICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCNV9BMTsKCiAgICAJCX0KCiAgICAJCWlmICggaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUjMyRiB8fAogICAgCQkJaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SRzE2RiB8fCBpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlJHMzJGIHx8CiAgICAJCQlpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlJHQkExNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SR0JBMzJGICkgewoKICAgIAkJCWV4dGVuc2lvbnMuZ2V0KCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBpbnRlcm5hbEZvcm1hdDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRJbnRlcm5hbERlcHRoRm9ybWF0KCB1c2VTdGVuY2lsLCBkZXB0aFR5cGUgKSB7CgogICAgCQlsZXQgZ2xJbnRlcm5hbEZvcm1hdDsKICAgIAkJaWYgKCB1c2VTdGVuY2lsICkgewoKICAgIAkJCWlmICggZGVwdGhUeXBlID09PSBudWxsIHx8IGRlcHRoVHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlIHx8IGRlcHRoVHlwZSA9PT0gVW5zaWduZWRJbnQyNDhUeXBlICkgewoKICAgIAkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIMjRfU1RFTkNJTDg7CgogICAgCQkJfSBlbHNlIGlmICggZGVwdGhUeXBlID09PSBGbG9hdFR5cGUgKSB7CgogICAgCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBfZ2wuREVQVEgzMkZfU1RFTkNJTDg7CgogICAgCQkJfSBlbHNlIGlmICggZGVwdGhUeXBlID09PSBVbnNpZ25lZFNob3J0VHlwZSApIHsKCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSDI0X1NURU5DSUw4OwogICAgCQkJCWNvbnNvbGUud2FybiggJ0RlcHRoVGV4dHVyZTogMTYgYml0IGRlcHRoIGF0dGFjaG1lbnQgaXMgbm90IHN1cHBvcnRlZCB3aXRoIHN0ZW5jaWwuIFVzaW5nIDI0LWJpdCBhdHRhY2htZW50LicgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggZGVwdGhUeXBlID09PSBudWxsIHx8IGRlcHRoVHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlIHx8IGRlcHRoVHlwZSA9PT0gVW5zaWduZWRJbnQyNDhUeXBlICkgewoKICAgIAkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDI0OwoKICAgIAkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gRmxvYXRUeXBlICkgewoKICAgIAkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDMyRjsKCiAgICAJCQl9IGVsc2UgaWYgKCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkU2hvcnRUeXBlICkgewoKICAgIAkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDE2OwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiBnbEludGVybmFsRm9ybWF0OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldE1pcExldmVscyggdGV4dHVyZSwgaW1hZ2UgKSB7CgogICAgCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSApID09PSB0cnVlIHx8ICggdGV4dHVyZS5pc0ZyYW1lYnVmZmVyVGV4dHVyZSAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTmVhcmVzdEZpbHRlciAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTGluZWFyRmlsdGVyICkgKSB7CgogICAgCQkJcmV0dXJuIE1hdGgubG9nMiggTWF0aC5tYXgoIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKSApICsgMTsKCiAgICAJCX0gZWxzZSBpZiAoIHRleHR1cmUubWlwbWFwcyAhPT0gdW5kZWZpbmVkICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCS8vIHVzZXItZGVmaW5lZCBtaXBtYXBzCgogICAgCQkJcmV0dXJuIHRleHR1cmUubWlwbWFwcy5sZW5ndGg7CgogICAgCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgJiYgQXJyYXkuaXNBcnJheSggdGV4dHVyZS5pbWFnZSApICkgewoKICAgIAkJCXJldHVybiBpbWFnZS5taXBtYXBzLmxlbmd0aDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJLy8gdGV4dHVyZSB3aXRob3V0IG1pcG1hcHMgKG9ubHkgYmFzZSBsZXZlbCkKCiAgICAJCQlyZXR1cm4gMTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAkvLwoKICAgIAlmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmUgPSBldmVudC50YXJnZXQ7CgogICAgCQl0ZXh0dXJlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKICAgIAkJZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKTsKCiAgICAJCWlmICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApIHsKCiAgICAJCQlfdmlkZW9UZXh0dXJlcy5kZWxldGUoIHRleHR1cmUgKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBvblJlbmRlclRhcmdldERpc3Bvc2UoIGV2ZW50ICkgewoKICAgIAkJY29uc3QgcmVuZGVyVGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwoKICAgIAkJcmVuZGVyVGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25SZW5kZXJUYXJnZXREaXNwb3NlICk7CgogICAgCQlkZWFsbG9jYXRlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJfQoKICAgIAkvLwoKICAgIAlmdW5jdGlvbiBkZWFsbG9jYXRlVGV4dHVyZSggdGV4dHVyZSApIHsKCiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCWlmICggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCiAgICAJCS8vIGNoZWNrIGlmIGl0J3MgbmVjZXNzYXJ5IHRvIHJlbW92ZSB0aGUgV2ViR0xUZXh0dXJlIG9iamVjdAoKICAgIAkJY29uc3Qgc291cmNlID0gdGV4dHVyZS5zb3VyY2U7CiAgICAJCWNvbnN0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwoKICAgIAkJaWYgKCB3ZWJnbFRleHR1cmVzICkgewoKICAgIAkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXTsKICAgIAkJCXdlYmdsVGV4dHVyZS51c2VkVGltZXMgLS07CgogICAgCQkJLy8gdGhlIFdlYkdMVGV4dHVyZSBvYmplY3QgaXMgbm90IHVzZWQgYW55bW9yZSwgcmVtb3ZlIGl0CgogICAgCQkJaWYgKCB3ZWJnbFRleHR1cmUudXNlZFRpbWVzID09PSAwICkgewoKICAgIAkJCQlkZWxldGVUZXh0dXJlKCB0ZXh0dXJlICk7CgogICAgCQkJfQoKICAgIAkJCS8vIHJlbW92ZSB0aGUgd2VhayBtYXAgZW50cnkgaWYgbm8gV2ViR0xUZXh0dXJlIHVzZXMgdGhlIHNvdXJjZSBhbnltb3JlCgogICAgCQkJaWYgKCBPYmplY3Qua2V5cyggd2ViZ2xUZXh0dXJlcyApLmxlbmd0aCA9PT0gMCApIHsKCiAgICAJCQkJX3NvdXJjZXMuZGVsZXRlKCBzb3VyY2UgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZSApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGRlbGV0ZVRleHR1cmUoIHRleHR1cmUgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CiAgICAJCV9nbC5kZWxldGVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKICAgIAkJY29uc3Qgc291cmNlID0gdGV4dHVyZS5zb3VyY2U7CiAgICAJCWNvbnN0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwogICAgCQlkZWxldGUgd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoKICAgIAkJaW5mby5tZW1vcnkudGV4dHVyZXMgLS07CgogICAgCX0KCiAgICAJZnVuY3Rpb24gZGVhbGxvY2F0ZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApIHsKCiAgICAJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmRpc3Bvc2UoKTsKCiAgICAJCQlwcm9wZXJ0aWVzLnJlbW92ZSggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgKSB7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCiAgICAJCQkJaWYgKCBBcnJheS5pc0FycmF5KCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdICkgKSB7CgogICAgCQkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0ubGVuZ3RoOyBsZXZlbCArKyApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdICk7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggQXJyYXkuaXNBcnJheSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKSApIHsKCiAgICAJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlci5sZW5ndGg7IGxldmVsICsrICkgX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgbGV2ZWwgXSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyICk7CiAgICAJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICkgX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKICAgIAkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXIgKSB7CgogICAgCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyICkgX2dsLmRlbGV0ZVJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKICAgIAkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCWNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmVzWyBpIF0gKTsKCiAgICAJCQlpZiAoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICkgewoKICAgIAkJCQlfZ2wuZGVsZXRlVGV4dHVyZSggYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCiAgICAJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgLS07CgogICAgCQkJfQoKICAgIAkJCXByb3BlcnRpZXMucmVtb3ZlKCB0ZXh0dXJlc1sgaSBdICk7CgogICAgCQl9CgogICAgCQlwcm9wZXJ0aWVzLnJlbW92ZSggcmVuZGVyVGFyZ2V0ICk7CgogICAgCX0KCiAgICAJLy8KCiAgICAJbGV0IHRleHR1cmVVbml0cyA9IDA7CgogICAgCWZ1bmN0aW9uIHJlc2V0VGV4dHVyZVVuaXRzKCkgewoKICAgIAkJdGV4dHVyZVVuaXRzID0gMDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBhbGxvY2F0ZVRleHR1cmVVbml0KCkgewoKICAgIAkJY29uc3QgdGV4dHVyZVVuaXQgPSB0ZXh0dXJlVW5pdHM7CgogICAgCQlpZiAoIHRleHR1cmVVbml0ID49IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlcyApIHsKCiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFRleHR1cmVzOiBUcnlpbmcgdG8gdXNlICcgKyB0ZXh0dXJlVW5pdCArICcgdGV4dHVyZSB1bml0cyB3aGlsZSB0aGlzIEdQVSBzdXBwb3J0cyBvbmx5ICcgKyBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZXMgKTsKCiAgICAJCX0KCiAgICAJCXRleHR1cmVVbml0cyArPSAxOwoKICAgIAkJcmV0dXJuIHRleHR1cmVVbml0OwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFRleHR1cmVDYWNoZUtleSggdGV4dHVyZSApIHsKCiAgICAJCWNvbnN0IGFycmF5ID0gW107CgogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLndyYXBTICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUud3JhcFQgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS53cmFwUiB8fCAwICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUubWFnRmlsdGVyICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUubWluRmlsdGVyICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUuYW5pc290cm9weSApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmludGVybmFsRm9ybWF0ICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUuZm9ybWF0ICk7CiAgICAJCWFycmF5LnB1c2goIHRleHR1cmUudHlwZSApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKICAgIAkJYXJyYXkucHVzaCggdGV4dHVyZS5mbGlwWSApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnVucGFja0FsaWdubWVudCApOwogICAgCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCiAgICAJCXJldHVybiBhcnJheS5qb2luKCk7CgogICAgCX0KCiAgICAJLy8KCiAgICAJZnVuY3Rpb24gc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCBzbG90ICkgewoKICAgIAkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICkgdXBkYXRlVmlkZW9UZXh0dXJlKCB0ZXh0dXJlICk7CgogICAgCQlpZiAoIHRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSAmJiB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKICAgIAkJCWNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKCiAgICAJCQlpZiAoIGltYWdlID09PSBudWxsICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBubyBpbWFnZSBkYXRhIGZvdW5kLicgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCBpbWFnZS5jb21wbGV0ZSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgbWFya2VkIGZvciB1cGRhdGUgYnV0IGltYWdlIGlzIGluY29tcGxldGUnICk7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJdXBsb2FkVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKTsKICAgIAkJCQlyZXR1cm47CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJELCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHNldFRleHR1cmUyREFycmF5KCB0ZXh0dXJlLCBzbG90ICkgewoKICAgIAkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKICAgIAkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfMkRfQVJSQVksIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0VGV4dHVyZTNEKCB0ZXh0dXJlLCBzbG90ICkgewoKICAgIAkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKICAgIAkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfM0QsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIHNsb3QgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgogICAgCQlpZiAoIHRleHR1cmUudmVyc2lvbiA+IDAgJiYgdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uICE9PSB0ZXh0dXJlLnZlcnNpb24gKSB7CgogICAgCQkJdXBsb2FkQ3ViZVRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CiAgICAJCQlyZXR1cm47CgogICAgCQl9CgogICAgCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgogICAgCX0KCiAgICAJY29uc3Qgd3JhcHBpbmdUb0dMID0gewogICAgCQlbIFJlcGVhdFdyYXBwaW5nIF06IF9nbC5SRVBFQVQsCiAgICAJCVsgQ2xhbXBUb0VkZ2VXcmFwcGluZyBdOiBfZ2wuQ0xBTVBfVE9fRURHRSwKICAgIAkJWyBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nIF06IF9nbC5NSVJST1JFRF9SRVBFQVQKICAgIAl9OwoKICAgIAljb25zdCBmaWx0ZXJUb0dMID0gewogICAgCQlbIE5lYXJlc3RGaWx0ZXIgXTogX2dsLk5FQVJFU1QsCiAgICAJCVsgTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIgXTogX2dsLk5FQVJFU1RfTUlQTUFQX05FQVJFU1QsCiAgICAJCVsgTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciBdOiBfZ2wuTkVBUkVTVF9NSVBNQVBfTElORUFSLAoKICAgIAkJWyBMaW5lYXJGaWx0ZXIgXTogX2dsLkxJTkVBUiwKICAgIAkJWyBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyIF06IF9nbC5MSU5FQVJfTUlQTUFQX05FQVJFU1QsCiAgICAJCVsgTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyIF06IF9nbC5MSU5FQVJfTUlQTUFQX0xJTkVBUgogICAgCX07CgogICAgCWNvbnN0IGNvbXBhcmVUb0dMID0gewogICAgCQlbIE5ldmVyQ29tcGFyZSBdOiBfZ2wuTkVWRVIsCiAgICAJCVsgQWx3YXlzQ29tcGFyZSBdOiBfZ2wuQUxXQVlTLAogICAgCQlbIExlc3NDb21wYXJlIF06IF9nbC5MRVNTLAogICAgCQlbIExlc3NFcXVhbENvbXBhcmUgXTogX2dsLkxFUVVBTCwKICAgIAkJWyBFcXVhbENvbXBhcmUgXTogX2dsLkVRVUFMLAogICAgCQlbIEdyZWF0ZXJFcXVhbENvbXBhcmUgXTogX2dsLkdFUVVBTCwKICAgIAkJWyBHcmVhdGVyQ29tcGFyZSBdOiBfZ2wuR1JFQVRFUiwKICAgIAkJWyBOb3RFcXVhbENvbXBhcmUgXTogX2dsLk5PVEVRVUFMCiAgICAJfTsKCiAgICAJZnVuY3Rpb24gc2V0VGV4dHVyZVBhcmFtZXRlcnMoIHRleHR1cmVUeXBlLCB0ZXh0dXJlICkgewoKICAgIAkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKSA9PT0gZmFsc2UgJiYKICAgIAkJCSggdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciB8fCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyIHx8CiAgICAJCQl0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyRmlsdGVyIHx8IHRleHR1cmUubWluRmlsdGVyID09PSBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyIHx8IHRleHR1cmUubWluRmlsdGVyID09PSBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyIHx8IHRleHR1cmUubWluRmlsdGVyID09PSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgKSApIHsKCiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBVbmFibGUgdG8gdXNlIGxpbmVhciBmaWx0ZXJpbmcgd2l0aCBmbG9hdGluZyBwb2ludCB0ZXh0dXJlcy4gT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyIG5vdCBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2UuJyApOwoKICAgIAkJfQoKICAgIAkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9XUkFQX1MsIHdyYXBwaW5nVG9HTFsgdGV4dHVyZS53cmFwUyBdICk7CiAgICAJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9ULCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFQgXSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlVHlwZSA9PT0gX2dsLlRFWFRVUkVfM0QgfHwgdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKICAgIAkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9SLCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFIgXSApOwoKICAgIAkJfQoKICAgIAkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBmaWx0ZXJUb0dMWyB0ZXh0dXJlLm1hZ0ZpbHRlciBdICk7CiAgICAJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZmlsdGVyVG9HTFsgdGV4dHVyZS5taW5GaWx0ZXIgXSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlLmNvbXBhcmVGdW5jdGlvbiApIHsKCiAgICAJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX0NPTVBBUkVfTU9ERSwgX2dsLkNPTVBBUkVfUkVGX1RPX1RFWFRVUkUgKTsKICAgIAkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfQ09NUEFSRV9GVU5DLCBjb21wYXJlVG9HTFsgdGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gXSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBleHRlbnNpb25zLmhhcyggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKSA9PT0gdHJ1ZSApIHsKCiAgICAJCQlpZiAoIHRleHR1cmUubWFnRmlsdGVyID09PSBOZWFyZXN0RmlsdGVyICkgcmV0dXJuOwogICAgCQkJaWYgKCB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyICkgcmV0dXJuOwogICAgCQkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKSA9PT0gZmFsc2UgKSByZXR1cm47IC8vIHZlcmlmeSBleHRlbnNpb24KCiAgICAJCQlpZiAoIHRleHR1cmUuYW5pc290cm9weSA+IDEgfHwgcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX2N1cnJlbnRBbmlzb3Ryb3B5ICkgewoKICAgIAkJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKTsKICAgIAkJCQlfZ2wudGV4UGFyYW1ldGVyZiggdGV4dHVyZVR5cGUsIGV4dGVuc2lvbi5URVhUVVJFX01BWF9BTklTT1RST1BZX0VYVCwgTWF0aC5taW4oIHRleHR1cmUuYW5pc290cm9weSwgY2FwYWJpbGl0aWVzLmdldE1heEFuaXNvdHJvcHkoKSApICk7CiAgICAJCQkJcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX2N1cnJlbnRBbmlzb3Ryb3B5ID0gdGV4dHVyZS5hbmlzb3Ryb3B5OwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBpbml0VGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUgKSB7CgogICAgCQlsZXQgZm9yY2VVcGxvYWQgPSBmYWxzZTsKCiAgICAJCWlmICggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsSW5pdCA9IHRydWU7CgogICAgCQkJdGV4dHVyZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCiAgICAJCX0KCiAgICAJCS8vIGNyZWF0ZSBTb3VyY2UgPC0+IFdlYkdMVGV4dHVyZXMgbWFwcGluZyBpZiBuZWNlc3NhcnkKCiAgICAJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwogICAgCQlsZXQgd2ViZ2xUZXh0dXJlcyA9IF9zb3VyY2VzLmdldCggc291cmNlICk7CgogICAgCQlpZiAoIHdlYmdsVGV4dHVyZXMgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQl3ZWJnbFRleHR1cmVzID0ge307CiAgICAJCQlfc291cmNlcy5zZXQoIHNvdXJjZSwgd2ViZ2xUZXh0dXJlcyApOwoKICAgIAkJfQoKICAgIAkJLy8gY2hlY2sgaWYgdGhlcmUgaXMgYWxyZWFkeSBhIFdlYkdMVGV4dHVyZSBvYmplY3QgZm9yIHRoZSBnaXZlbiB0ZXh0dXJlIHBhcmFtZXRlcnMKCiAgICAJCWNvbnN0IHRleHR1cmVDYWNoZUtleSA9IGdldFRleHR1cmVDYWNoZUtleSggdGV4dHVyZSApOwoKICAgIAkJaWYgKCB0ZXh0dXJlQ2FjaGVLZXkgIT09IHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgKSB7CgogICAgCQkJLy8gaWYgbm90LCBjcmVhdGUgYSBuZXcgaW5zdGFuY2Ugb2YgV2ViR0xUZXh0dXJlCgogICAgCQkJaWYgKCB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkvLyBjcmVhdGUgbmV3IGVudHJ5CgogICAgCQkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdID0gewogICAgCQkJCQl0ZXh0dXJlOiBfZ2wuY3JlYXRlVGV4dHVyZSgpLAogICAgCQkJCQl1c2VkVGltZXM6IDAKICAgIAkJCQl9OwoKICAgIAkJCQlpbmZvLm1lbW9yeS50ZXh0dXJlcyArKzsKCiAgICAJCQkJLy8gd2hlbiBhIG5ldyBpbnN0YW5jZSBvZiBXZWJHTFRleHR1cmUgd2FzIGNyZWF0ZWQsIGEgdGV4dHVyZSB1cGxvYWQgaXMgcmVxdWlyZWQKICAgIAkJCQkvLyBldmVuIGlmIHRoZSBpbWFnZSBjb250ZW50cyBhcmUgaWRlbnRpY2FsCgogICAgCQkJCWZvcmNlVXBsb2FkID0gdHJ1ZTsKCiAgICAJCQl9CgogICAgCQkJd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0udXNlZFRpbWVzICsrOwoKICAgIAkJCS8vIGV2ZXJ5IHRpbWUgdGhlIHRleHR1cmUgY2FjaGUga2V5IGNoYW5nZXMsIGl0J3MgbmVjZXNzYXJ5IHRvIGNoZWNrIGlmIGFuIGluc3RhbmNlIG9mCiAgICAJCQkvLyBXZWJHTFRleHR1cmUgY2FuIGJlIGRlbGV0ZWQgaW4gb3JkZXIgdG8gYXZvaWQgYSBtZW1vcnkgbGVhay4KCiAgICAJCQljb25zdCB3ZWJnbFRleHR1cmUgPSB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5IF07CgogICAgCQkJaWYgKCB3ZWJnbFRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdLnVzZWRUaW1lcyAtLTsKCiAgICAJCQkJaWYgKCB3ZWJnbFRleHR1cmUudXNlZFRpbWVzID09PSAwICkgewoKICAgIAkJCQkJZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIHN0b3JlIHJlZmVyZW5jZXMgdG8gY2FjaGUga2V5IGFuZCBXZWJHTFRleHR1cmUgb2JqZWN0CgogICAgCQkJdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSA9IHRleHR1cmVDYWNoZUtleTsKICAgIAkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0udGV4dHVyZTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBmb3JjZVVwbG9hZDsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBnZXRSb3coIGluZGV4LCByb3dMZW5ndGgsIGNvbXBvbmVudFN0cmlkZSApIHsKCiAgICAJCXJldHVybiBNYXRoLmZsb29yKCBNYXRoLmZsb29yKCBpbmRleCAvIGNvbXBvbmVudFN0cmlkZSApIC8gcm93TGVuZ3RoICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlVGV4dHVyZSggdGV4dHVyZSwgaW1hZ2UsIGdsRm9ybWF0LCBnbFR5cGUgKSB7CgogICAgCQljb25zdCBjb21wb25lbnRTdHJpZGUgPSA0OyAvLyBvbmx5IFJHQkEgc3VwcG9ydGVkCgogICAgCQljb25zdCB1cGRhdGVSYW5nZXMgPSB0ZXh0dXJlLnVwZGF0ZVJhbmdlczsKCiAgICAJCWlmICggdXBkYXRlUmFuZ2VzLmxlbmd0aCA9PT0gMCApIHsKCiAgICAJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQkvLyBCZWZvcmUgYXBwbHlpbmcgdXBkYXRlIHJhbmdlcywgd2UgbWVyZ2UgYW55IGFkamFjZW50IC8gb3ZlcmxhcHBpbmcKICAgIAkJCS8vIHJhbmdlcyB0byByZWR1Y2UgbG9hZCBvbiBgZ2wudGV4U3ViSW1hZ2UyRGAuIEVtcGlyaWNhbGx5LCB0aGlzIGhhcyBsZWQKICAgIAkJCS8vIHRvIHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cyBmb3IgYXBwbGljYXRpb25zIHdoaWNoIG1ha2UgaGVhdnkgdXNlIG9mCiAgICAJCQkvLyB1cGRhdGUgcmFuZ2VzLiBMaWtlbHkgZHVlIHRvIEdQVSBjb21tYW5kIG92ZXJoZWFkLgogICAgCQkJLy8KICAgIAkJCS8vIE5vdGUgdGhhdCB0byByZWR1Y2UgZ2FyYmFnZSBjb2xsZWN0aW9uIGJldHdlZW4gZnJhbWVzLCB3ZSBtZXJnZSB0aGUKICAgIAkJCS8vIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UuIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHRoaXMgbWV0aG9kIHdpbGwgY2xlYXIgdGhlCiAgICAJCQkvLyB1cGRhdGUgcmFuZ2VzIG9uY2UgdXBkYXRlZC4KCiAgICAJCQl1cGRhdGVSYW5nZXMuc29ydCggKCBhLCBiICkgPT4gYS5zdGFydCAtIGIuc3RhcnQgKTsKCiAgICAJCQkvLyBUbyBtZXJnZSB0aGUgdXBkYXRlIHJhbmdlcyBpbi1wbGFjZSwgd2Ugd29yayBmcm9tIGxlZnQgdG8gcmlnaHQgaW4gdGhlCiAgICAJCQkvLyBleGlzdGluZyB1cGRhdGVSYW5nZXMgYXJyYXksIG1lcmdpbmcgcmFuZ2VzLiBUaGlzIG1heSByZXN1bHQgaW4gYSBmaW5hbAogICAgCQkJLy8gYXJyYXkgd2hpY2ggaXMgc21hbGxlciB0aGFuIHRoZSBvcmlnaW5hbC4gVGhpcyBpbmRleCB0cmFja3MgdGhlIGxhc3QKICAgIAkJCS8vIGluZGV4IHJlcHJlc2VudGluZyBhIG1lcmdlZCByYW5nZSwgYW55IGRhdGEgYWZ0ZXIgdGhpcyBpbmRleCBjYW4gYmUKICAgIAkJCS8vIHRyaW1tZWQgb25jZSB0aGUgbWVyZ2UgYWxnb3JpdGhtIGlzIGNvbXBsZXRlZC4KICAgIAkJCWxldCBtZXJnZUluZGV4ID0gMDsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDE7IGkgPCB1cGRhdGVSYW5nZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQljb25zdCBwcmV2aW91c1JhbmdlID0gdXBkYXRlUmFuZ2VzWyBtZXJnZUluZGV4IF07CiAgICAJCQkJY29uc3QgcmFuZ2UgPSB1cGRhdGVSYW5nZXNbIGkgXTsKCiAgICAJCQkJLy8gT25seSBtZXJnZSBpZiBpbiB0aGUgc2FtZSByb3cgYW5kIG92ZXJsYXBwaW5nL2FkamFjZW50CiAgICAJCQkJY29uc3QgcHJldmlvdXNFbmQgPSBwcmV2aW91c1JhbmdlLnN0YXJ0ICsgcHJldmlvdXNSYW5nZS5jb3VudDsKICAgIAkJCQljb25zdCBjdXJyZW50Um93ID0gZ2V0Um93KCByYW5nZS5zdGFydCwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApOwogICAgCQkJCWNvbnN0IHByZXZpb3VzUm93ID0gZ2V0Um93KCBwcmV2aW91c1JhbmdlLnN0YXJ0LCBpbWFnZS53aWR0aCwgY29tcG9uZW50U3RyaWRlICk7CgogICAgCQkJCS8vIFdlIGFkZCBvbmUgaGVyZSB0byBtZXJnZSBhZGphY2VudCByYW5nZXMuIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHJhbmdlcwogICAgCQkJCS8vIG9wZXJhdGUgb3ZlciBwb3NpdGl2ZSBpbnRlZ2Vycy4KICAgIAkJCQlpZiAoCiAgICAJCQkJCXJhbmdlLnN0YXJ0IDw9IHByZXZpb3VzRW5kICsgMSAmJgogICAgCQkJCQljdXJyZW50Um93ID09PSBwcmV2aW91c1JvdyAmJgogICAgCQkJCQlnZXRSb3coIHJhbmdlLnN0YXJ0ICsgcmFuZ2UuY291bnQgLSAxLCBpbWFnZS53aWR0aCwgY29tcG9uZW50U3RyaWRlICkgPT09IGN1cnJlbnRSb3cgLy8gZW5zdXJlIHJhbmdlIGRvZXNuJ3Qgc3BpbGwKICAgIAkJCQkpIHsKCiAgICAJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQgPSBNYXRoLm1heCgKICAgIAkJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQsCiAgICAJCQkJCQlyYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gcHJldmlvdXNSYW5nZS5zdGFydAogICAgCQkJCQkpOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJKysgbWVyZ2VJbmRleDsKICAgIAkJCQkJdXBkYXRlUmFuZ2VzWyBtZXJnZUluZGV4IF0gPSByYW5nZTsKCiAgICAJCQkJfQoKCiAgICAJCQl9CgogICAgCQkJLy8gVHJpbSB0aGUgYXJyYXkgdG8gb25seSBjb250YWluIHRoZSBtZXJnZWQgcmFuZ2VzLgogICAgCQkJdXBkYXRlUmFuZ2VzLmxlbmd0aCA9IG1lcmdlSW5kZXggKyAxOwoKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tSb3dMZW4gPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEggKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUGl4ZWxzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX1BJWEVMUyApOwogICAgCQkJY29uc3QgY3VycmVudFVucGFja1NraXBSb3dzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX1JPV1MgKTsKCiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgaW1hZ2Uud2lkdGggKTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1cGRhdGVSYW5nZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgcmFuZ2UgPSB1cGRhdGVSYW5nZXNbIGkgXTsKCiAgICAJCQkJY29uc3QgcGl4ZWxTdGFydCA9IE1hdGguZmxvb3IoIHJhbmdlLnN0YXJ0IC8gY29tcG9uZW50U3RyaWRlICk7CiAgICAJCQkJY29uc3QgcGl4ZWxDb3VudCA9IE1hdGguY2VpbCggcmFuZ2UuY291bnQgLyBjb21wb25lbnRTdHJpZGUgKTsKCiAgICAJCQkJY29uc3QgeCA9IHBpeGVsU3RhcnQgJSBpbWFnZS53aWR0aDsKICAgIAkJCQljb25zdCB5ID0gTWF0aC5mbG9vciggcGl4ZWxTdGFydCAvIGltYWdlLndpZHRoICk7CgogICAgCQkJCS8vIEFzc3VtZXMgdXBkYXRlIHJhbmdlcyByZWZlciB0byBjb250aWd1b3VzIG1lbW9yeQogICAgCQkJCWNvbnN0IHdpZHRoID0gcGl4ZWxDb3VudDsKICAgIAkJCQljb25zdCBoZWlnaHQgPSAxOwoKICAgIAkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMsIHggKTsKICAgIAkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTLCB5ICk7CgogICAgCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgogICAgCQkJfQoKICAgIAkJCXRleHR1cmUuY2xlYXJVcGRhdGVSYW5nZXMoKTsKCiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgY3VycmVudFVucGFja1Jvd0xlbiApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUk9XUywgY3VycmVudFVucGFja1NraXBSb3dzICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBsb2FkVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKSB7CgogICAgCQlsZXQgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8yRDsKCiAgICAJCWlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB0ZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzJEX0FSUkFZOwogICAgCQlpZiAoIHRleHR1cmUuaXNEYXRhM0RUZXh0dXJlICkgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8zRDsKCiAgICAJCWNvbnN0IGZvcmNlVXBsb2FkID0gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICk7CiAgICAJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoKICAgIAkJc3RhdGUuYmluZFRleHR1cmUoIHRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKICAgIAkJY29uc3Qgc291cmNlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzb3VyY2UgKTsKCiAgICAJCWlmICggc291cmNlLnZlcnNpb24gIT09IHNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uIHx8IGZvcmNlVXBsb2FkID09PSB0cnVlICkgewoKICAgIAkJCXN0YXRlLmFjdGl2ZVRleHR1cmUoIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCiAgICAJCQljb25zdCB3b3JraW5nUHJpbWFyaWVzID0gQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICk7CiAgICAJCQljb25zdCB0ZXh0dXJlUHJpbWFyaWVzID0gdGV4dHVyZS5jb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgPyBudWxsIDogQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggdGV4dHVyZS5jb2xvclNwYWNlICk7CiAgICAJCQljb25zdCB1bnBhY2tDb252ZXJzaW9uID0gdGV4dHVyZS5jb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgfHwgd29ya2luZ1ByaW1hcmllcyA9PT0gdGV4dHVyZVByaW1hcmllcyA/IF9nbC5OT05FIDogX2dsLkJST1dTRVJfREVGQVVMVF9XRUJHTDsKCiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCB0ZXh0dXJlLmZsaXBZICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIHRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19DT0xPUlNQQUNFX0NPTlZFUlNJT05fV0VCR0wsIHVucGFja0NvbnZlcnNpb24gKTsKCiAgICAJCQlsZXQgaW1hZ2UgPSByZXNpemVJbWFnZSggdGV4dHVyZS5pbWFnZSwgZmFsc2UsIGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZSApOwogICAgCQkJaW1hZ2UgPSB2ZXJpZnlDb2xvclNwYWNlKCB0ZXh0dXJlLCBpbWFnZSApOwoKICAgIAkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwoKICAgIAkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwogICAgCQkJbGV0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlLCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICk7CgogICAgCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIHRleHR1cmVUeXBlLCB0ZXh0dXJlICk7CgogICAgCQkJbGV0IG1pcG1hcDsKICAgIAkJCWNvbnN0IG1pcG1hcHMgPSB0ZXh0dXJlLm1pcG1hcHM7CgogICAgCQkJY29uc3QgdXNlVGV4U3RvcmFnZSA9ICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSAhPT0gdHJ1ZSApOwogICAgCQkJY29uc3QgYWxsb2NhdGVNZW1vcnkgPSAoIHNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID09PSB1bmRlZmluZWQgKSB8fCAoIGZvcmNlVXBsb2FkID09PSB0cnVlICk7CiAgICAJCQljb25zdCBkYXRhUmVhZHkgPSBzb3VyY2UuZGF0YVJlYWR5OwogICAgCQkJY29uc3QgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSApOwoKICAgIAkJCWlmICggdGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApIHsKCiAgICAJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRGVwdGhGb3JtYXQoIHRleHR1cmUuZm9ybWF0ID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQsIHRleHR1cmUudHlwZSApOwoKICAgIAkJCQkvLwoKICAgIAkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDEsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhVGV4dHVyZSApIHsKCiAgICAJCQkJLy8gdXNlIG1hbnVhbGx5IGNyZWF0ZWQgbWlwbWFwcyBpZiBhdmFpbGFibGUKICAgIAkJCQkvLyBpZiB0aGVyZSBhcmUgbm8gbWFudWFsIG1pcG1hcHMKICAgIAkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCiAgICAJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXBzWyAwIF0ud2lkdGgsIG1pcG1hcHNbIDAgXS5oZWlnaHQgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKICAgIAkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCiAgICAJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQkJdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCXVwZGF0ZVRleHR1cmUoIHRleHR1cmUsIGltYWdlLCBnbEZvcm1hdCwgZ2xUeXBlICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICkgewoKICAgIAkJCQlpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgewoKICAgIAkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJCXN0YXRlLnRleFN0b3JhZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQkJbWlwbWFwID0gbWlwbWFwc1sgaSBdOwoKICAgIAkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgKSB7CgogICAgCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgogICAgCQkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJCWlmICggdGV4dHVyZS5sYXllclVwZGF0ZXMuc2l6ZSA+IDAgKSB7CgogICAgCQkJCQkJCQkJCQljb25zdCBsYXllckJ5dGVMZW5ndGggPSBnZXRCeXRlTGVuZ3RoKCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLnR5cGUgKTsKCiAgICAJCQkJCQkJCQkJCWZvciAoIGNvbnN0IGxheWVySW5kZXggb2YgdGV4dHVyZS5sYXllclVwZGF0ZXMgKSB7CgogICAgCQkJCQkJCQkJCQkJY29uc3QgbGF5ZXJEYXRhID0gbWlwbWFwLmRhdGEuc3ViYXJyYXkoCiAgICAJCQkJCQkJCQkJCQkJbGF5ZXJJbmRleCAqIGxheWVyQnl0ZUxlbmd0aCAvIG1pcG1hcC5kYXRhLkJZVEVTX1BFUl9FTEVNRU5ULAogICAgCQkJCQkJCQkJCQkJCSggbGF5ZXJJbmRleCArIDEgKSAqIGxheWVyQnl0ZUxlbmd0aCAvIG1pcG1hcC5kYXRhLkJZVEVTX1BFUl9FTEVNRU5UCiAgICAJCQkJCQkJCQkJCQkpOwogICAgCQkJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCAwLCAwLCBsYXllckluZGV4LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDEsIGdsRm9ybWF0LCBsYXllckRhdGEgKTsKCiAgICAJCQkJCQkJCQkJCX0KCiAgICAJCQkJCQkJCQkJCXRleHR1cmUuY2xlYXJMYXllclVwZGF0ZXMoKTsKCiAgICAJCQkJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgMCwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgZ2xGb3JtYXQsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQkJCX0KCiAgICAJCQkJCQkJCQl9CgogICAgCQkJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgbWlwbWFwLmRhdGEsIDAsIDAgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC51cGxvYWRUZXh0dXJlKCknICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgMCwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgogICAgCQkJCQkJaWYgKCB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCApIHsKCiAgICAJCQkJCQkJaWYgKCBnbEZvcm1hdCAhPT0gbnVsbCApIHsKCiAgICAJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKICAgIAkJCQkJCQkJCX0KCiAgICAJCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQl9CgogICAgCQkJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAudXBsb2FkVGV4dHVyZSgpJyApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSApIHsKCiAgICAJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQlpZiAoIHRleHR1cmUubGF5ZXJVcGRhdGVzLnNpemUgPiAwICkgewoKICAgIAkJCQkJCQljb25zdCBsYXllckJ5dGVMZW5ndGggPSBnZXRCeXRlTGVuZ3RoKCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS50eXBlICk7CgogICAgCQkJCQkJCWZvciAoIGNvbnN0IGxheWVySW5kZXggb2YgdGV4dHVyZS5sYXllclVwZGF0ZXMgKSB7CgogICAgCQkJCQkJCQljb25zdCBsYXllckRhdGEgPSBpbWFnZS5kYXRhLnN1YmFycmF5KAogICAgCQkJCQkJCQkJbGF5ZXJJbmRleCAqIGxheWVyQnl0ZUxlbmd0aCAvIGltYWdlLmRhdGEuQllURVNfUEVSX0VMRU1FTlQsCiAgICAJCQkJCQkJCQkoIGxheWVySW5kZXggKyAxICkgKiBsYXllckJ5dGVMZW5ndGggLyBpbWFnZS5kYXRhLkJZVEVTX1BFUl9FTEVNRU5UCiAgICAJCQkJCQkJCSk7CiAgICAJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCAwLCAwLCBsYXllckluZGV4LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCAxLCBnbEZvcm1hdCwgZ2xUeXBlLCBsYXllckRhdGEgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCQl0ZXh0dXJlLmNsZWFyTGF5ZXJVcGRhdGVzKCk7CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIDAsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJc3RhdGUudGV4SW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCiAgICAJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzNELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgMCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzNELCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0ZyYW1lYnVmZmVyVGV4dHVyZSApIHsKCiAgICAJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJbGV0IHdpZHRoID0gaW1hZ2Uud2lkdGgsIGhlaWdodCA9IGltYWdlLmhlaWdodDsKCiAgICAJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsZXZlbHM7IGkgKysgKSB7CgogICAgCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCBnbEludGVybmFsRm9ybWF0LCB3aWR0aCwgaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgogICAgCQkJCQkJCXdpZHRoID4+PSAxOwogICAgCQkJCQkJCWhlaWdodCA+Pj0gMTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQkvLyByZWd1bGFyIFRleHR1cmUgKGltYWdlLCB2aWRlbywgY2FudmFzKQoKICAgIAkJCQkvLyB1c2UgbWFudWFsbHkgY3JlYXRlZCBtaXBtYXBzIGlmIGF2YWlsYWJsZQogICAgCQkJCS8vIGlmIHRoZXJlIGFyZSBubyBtYW51YWwgbWlwbWFwcwogICAgCQkJCS8vIHNldCAwIGxldmVsIG1pcG1hcCBhbmQgdGhlbiB1c2UgR0wgdG8gZ2VuZXJhdGUgb3RoZXIgbWlwbWFwIGxldmVscwoKICAgIAkJCQlpZiAoIG1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCQljb25zdCBkaW1lbnNpb25zID0gZ2V0RGltZW5zaW9ucyggbWlwbWFwc1sgMCBdICk7CgogICAgCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBkaW1lbnNpb25zLndpZHRoLCBkaW1lbnNpb25zLmhlaWdodCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgogICAgCQkJCQkJbWlwbWFwID0gbWlwbWFwc1sgaSBdOwoKICAgIAkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgMCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQkJdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKICAgIAkJCQkJCQljb25zdCBkaW1lbnNpb25zID0gZ2V0RGltZW5zaW9ucyggaW1hZ2UgKTsKCiAgICAJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBkaW1lbnNpb25zLndpZHRoLCBkaW1lbnNpb25zLmhlaWdodCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSApICkgewoKICAgIAkJCQlnZW5lcmF0ZU1pcG1hcCggdGV4dHVyZVR5cGUgKTsKCiAgICAJCQl9CgogICAgCQkJc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPSBzb3VyY2UudmVyc2lvbjsKCiAgICAJCQlpZiAoIHRleHR1cmUub25VcGRhdGUgKSB0ZXh0dXJlLm9uVXBkYXRlKCB0ZXh0dXJlICk7CgogICAgCQl9CgogICAgCQl0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gPSB0ZXh0dXJlLnZlcnNpb247CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBsb2FkQ3ViZVRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICkgewoKICAgIAkJaWYgKCB0ZXh0dXJlLmltYWdlLmxlbmd0aCAhPT0gNiApIHJldHVybjsKCiAgICAJCWNvbnN0IGZvcmNlVXBsb2FkID0gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICk7CiAgICAJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoKICAgIAkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKICAgIAkJY29uc3Qgc291cmNlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzb3VyY2UgKTsKCiAgICAJCWlmICggc291cmNlLnZlcnNpb24gIT09IHNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uIHx8IGZvcmNlVXBsb2FkID09PSB0cnVlICkgewoKICAgIAkJCXN0YXRlLmFjdGl2ZVRleHR1cmUoIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCiAgICAJCQljb25zdCB3b3JraW5nUHJpbWFyaWVzID0gQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICk7CiAgICAJCQljb25zdCB0ZXh0dXJlUHJpbWFyaWVzID0gdGV4dHVyZS5jb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgPyBudWxsIDogQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggdGV4dHVyZS5jb2xvclNwYWNlICk7CiAgICAJCQljb25zdCB1bnBhY2tDb252ZXJzaW9uID0gdGV4dHVyZS5jb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgfHwgd29ya2luZ1ByaW1hcmllcyA9PT0gdGV4dHVyZVByaW1hcmllcyA/IF9nbC5OT05FIDogX2dsLkJST1dTRVJfREVGQVVMVF9XRUJHTDsKCiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCB0ZXh0dXJlLmZsaXBZICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIHRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19DT0xPUlNQQUNFX0NPTlZFUlNJT05fV0VCR0wsIHVucGFja0NvbnZlcnNpb24gKTsKCiAgICAJCQljb25zdCBpc0NvbXByZXNzZWQgPSAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSB8fCB0ZXh0dXJlLmltYWdlWyAwIF0uaXNDb21wcmVzc2VkVGV4dHVyZSApOwogICAgCQkJY29uc3QgaXNEYXRhVGV4dHVyZSA9ICggdGV4dHVyZS5pbWFnZVsgMCBdICYmIHRleHR1cmUuaW1hZ2VbIDAgXS5pc0RhdGFUZXh0dXJlICk7CgogICAgCQkJY29uc3QgY3ViZUltYWdlID0gW107CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCiAgICAJCQkJaWYgKCAhIGlzQ29tcHJlc3NlZCAmJiAhIGlzRGF0YVRleHR1cmUgKSB7CgogICAgCQkJCQljdWJlSW1hZ2VbIGkgXSA9IHJlc2l6ZUltYWdlKCB0ZXh0dXJlLmltYWdlWyBpIF0sIHRydWUsIGNhcGFiaWxpdGllcy5tYXhDdWJlbWFwU2l6ZSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJY3ViZUltYWdlWyBpIF0gPSBpc0RhdGFUZXh0dXJlID8gdGV4dHVyZS5pbWFnZVsgaSBdLmltYWdlIDogdGV4dHVyZS5pbWFnZVsgaSBdOwoKICAgIAkJCQl9CgogICAgCQkJCWN1YmVJbWFnZVsgaSBdID0gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgY3ViZUltYWdlWyBpIF0gKTsKCiAgICAJCQl9CgogICAgCQkJY29uc3QgaW1hZ2UgPSBjdWJlSW1hZ2VbIDAgXSwKICAgIAkJCQlnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKSwKICAgIAkJCQlnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKSwKICAgIAkJCQlnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSApOwoKICAgIAkJCWNvbnN0IHVzZVRleFN0b3JhZ2UgPSAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgIT09IHRydWUgKTsKICAgIAkJCWNvbnN0IGFsbG9jYXRlTWVtb3J5ID0gKCBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9PT0gdW5kZWZpbmVkICkgfHwgKCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApOwogICAgCQkJY29uc3QgZGF0YVJlYWR5ID0gc291cmNlLmRhdGFSZWFkeTsKICAgIAkJCWxldCBsZXZlbHMgPSBnZXRNaXBMZXZlbHMoIHRleHR1cmUsIGltYWdlICk7CgogICAgCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlICk7CgogICAgCQkJbGV0IG1pcG1hcHM7CgogICAgCQkJaWYgKCBpc0NvbXByZXNzZWQgKSB7CgogICAgCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCiAgICAJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKICAgIAkJCQl9CgogICAgCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJCQltaXBtYXBzID0gY3ViZUltYWdlWyBpIF0ubWlwbWFwczsKCiAgICAJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKICAgIAkJCQkJCWNvbnN0IG1pcG1hcCA9IG1pcG1hcHNbIGogXTsKCiAgICAJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKICAgIAkJCQkJCQlpZiAoIGdsRm9ybWF0ICE9PSBudWxsICkgewoKICAgIAkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGosIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCQkJfQoKICAgIAkJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGosIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC5zZXRUZXh0dXJlQ3ViZSgpJyApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGosIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQltaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKICAgIAkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgogICAgCQkJCQkvLyBUT0RPOiBVbmlmb3JtbHkgaGFuZGxlIG1pcG1hcCBkZWZpbml0aW9ucwogICAgCQkJCQkvLyBOb3JtYWwgdGV4dHVyZXMgYW5kIGNvbXByZXNzZWQgY3ViZSB0ZXh0dXJlcyBkZWZpbmUgYmFzZSBsZXZlbCArIG1pcHMgd2l0aCB0aGVpciBtaXBtYXAgYXJyYXkKICAgIAkJCQkJLy8gVW5jb21wcmVzc2VkIGN1YmUgdGV4dHVyZXMgdXNlIHRoZWlyIG1pcG1hcCBhcnJheSBvbmx5IGZvciBtaXBzIChubyBiYXNlIGxldmVsKQoKICAgIAkJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgKSBsZXZlbHMgKys7CgogICAgCQkJCQljb25zdCBkaW1lbnNpb25zID0gZ2V0RGltZW5zaW9ucyggY3ViZUltYWdlWyAwIF0gKTsKCiAgICAJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKICAgIAkJCQkJaWYgKCBpc0RhdGFUZXh0dXJlICkgewoKICAgIAkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCiAgICAJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCwgMCwgMCwgY3ViZUltYWdlWyBpIF0ud2lkdGgsIGN1YmVJbWFnZVsgaSBdLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgY3ViZUltYWdlWyBpIF0uZGF0YSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGN1YmVJbWFnZVsgaSBdLndpZHRoLCBjdWJlSW1hZ2VbIGkgXS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdLmRhdGEgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbWlwbWFwcy5sZW5ndGg7IGogKysgKSB7CgogICAgCQkJCQkJCWNvbnN0IG1pcG1hcCA9IG1pcG1hcHNbIGogXTsKICAgIAkJCQkJCQljb25zdCBtaXBtYXBJbWFnZSA9IG1pcG1hcC5pbWFnZVsgaSBdLmltYWdlOwoKICAgIAkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCiAgICAJCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIDAsIDAsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwSW1hZ2Uud2lkdGgsIG1pcG1hcEltYWdlLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwSW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgogICAgCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKICAgIAkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdICk7CgogICAgCQkJCQkJCX0KCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgY3ViZUltYWdlWyBpIF0gKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbWlwbWFwcy5sZW5ndGg7IGogKysgKSB7CgogICAgCQkJCQkJCWNvbnN0IG1pcG1hcCA9IG1pcG1hcHNbIGogXTsKCiAgICAJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKICAgIAkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgogICAgCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuaW1hZ2VbIGkgXSApOwoKICAgIAkJCQkJCQkJfQoKICAgIAkJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCBnbEludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuaW1hZ2VbIGkgXSApOwoKICAgIAkJCQkJCQl9CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgogICAgCQkJCS8vIFdlIGFzc3VtZSBpbWFnZXMgZm9yIGN1YmUgbWFwIGhhdmUgdGhlIHNhbWUgc2l6ZS4KICAgIAkJCQlnZW5lcmF0ZU1pcG1hcCggX2dsLlRFWFRVUkVfQ1VCRV9NQVAgKTsKCiAgICAJCQl9CgogICAgCQkJc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPSBzb3VyY2UudmVyc2lvbjsKCiAgICAJCQlpZiAoIHRleHR1cmUub25VcGRhdGUgKSB0ZXh0dXJlLm9uVXBkYXRlKCB0ZXh0dXJlICk7CgogICAgCQl9CgogICAgCQl0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gPSB0ZXh0dXJlLnZlcnNpb247CgogICAgCX0KCiAgICAJLy8gUmVuZGVyIHRhcmdldHMKCiAgICAJLy8gU2V0dXAgc3RvcmFnZSBmb3IgdGFyZ2V0IHRleHR1cmUgYW5kIGJpbmQgaXQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgogICAgCWZ1bmN0aW9uIHNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCBmcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBhdHRhY2htZW50LCB0ZXh0dXJlVGFyZ2V0LCBsZXZlbCApIHsKCiAgICAJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwogICAgCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKICAgIAkJY29uc3QgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKICAgIAkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKICAgIAkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKICAgIAkJdGV4dHVyZVByb3BlcnRpZXMuX19yZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQ7CgogICAgCQlpZiAoICEgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2hhc0V4dGVybmFsVGV4dHVyZXMgKSB7CgogICAgCQkJY29uc3Qgd2lkdGggPSBNYXRoLm1heCggMSwgcmVuZGVyVGFyZ2V0LndpZHRoID4+IGxldmVsICk7CiAgICAJCQljb25zdCBoZWlnaHQgPSBNYXRoLm1heCggMSwgcmVuZGVyVGFyZ2V0LmhlaWdodCA+PiBsZXZlbCApOwoKICAgIAkJCWlmICggdGV4dHVyZVRhcmdldCA9PT0gX2dsLlRFWFRVUkVfM0QgfHwgdGV4dHVyZVRhcmdldCA9PT0gX2dsLlRFWFRVUkVfMkRfQVJSQVkgKSB7CgogICAgCQkJCXN0YXRlLnRleEltYWdlM0QoIHRleHR1cmVUYXJnZXQsIGxldmVsLCBnbEludGVybmFsRm9ybWF0LCB3aWR0aCwgaGVpZ2h0LCByZW5kZXJUYXJnZXQuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlzdGF0ZS50ZXhJbWFnZTJEKCB0ZXh0dXJlVGFyZ2V0LCBsZXZlbCwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbnVsbCApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBmcmFtZWJ1ZmZlciApOwoKICAgIAkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKICAgIAkJCW11bHRpc2FtcGxlZFJUVEV4dC5mcmFtZWJ1ZmZlclRleHR1cmUyRE11bHRpc2FtcGxlRVhUKCBfZ2wuRlJBTUVCVUZGRVIsIGF0dGFjaG1lbnQsIHRleHR1cmVUYXJnZXQsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCAwLCBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKSApOwoKICAgIAkJfSBlbHNlIGlmICggdGV4dHVyZVRhcmdldCA9PT0gX2dsLlRFWFRVUkVfMkQgfHwgKCB0ZXh0dXJlVGFyZ2V0ID49IF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggJiYgdGV4dHVyZVRhcmdldCA8PSBfZ2wuVEVYVFVSRV9DVUJFX01BUF9ORUdBVElWRV9aICkgKSB7IC8vIHNlZSAjMjQ3NTMKCiAgICAJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGxldmVsICk7CgogICAgCQl9CgogICAgCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoKICAgIAl9CgogICAgCS8vIFNldHVwIHN0b3JhZ2UgZm9yIGludGVybmFsIGRlcHRoL3N0ZW5jaWwgYnVmZmVycyBhbmQgYmluZCB0byBjb3JyZWN0IGZyYW1lYnVmZmVyCiAgICAJZnVuY3Rpb24gc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJidWZmZXIsIHJlbmRlclRhcmdldCwgaXNNdWx0aXNhbXBsZSApIHsKCiAgICAJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCiAgICAJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKICAgIAkJCS8vIHJldHJpZXZlIHRoZSBkZXB0aCBhdHRhY2htZW50IHR5cGVzCiAgICAJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwogICAgCQkJY29uc3QgZGVwdGhUeXBlID0gZGVwdGhUZXh0dXJlICYmIGRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSA/IGRlcHRoVGV4dHVyZS50eXBlIDogbnVsbDsKICAgIAkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbERlcHRoRm9ybWF0KCByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciwgZGVwdGhUeXBlICk7CiAgICAJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgogICAgCQkJLy8gc2V0IHVwIHRoZSBhdHRhY2htZW50CiAgICAJCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQljb25zdCBpc1VzZU11bHRpc2FtcGxlZFJUVCA9IHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQlpZiAoIGlzVXNlTXVsdGlzYW1wbGVkUlRUICkgewoKICAgIAkJCQltdWx0aXNhbXBsZWRSVFRFeHQucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlRVhUKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCBpc011bHRpc2FtcGxlICkgewoKICAgIAkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZSggX2dsLlJFTkRFUkJVRkZFUiwgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgogICAgCQkJfQoKICAgIAkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBnbEF0dGFjaG1lbnRUeXBlLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQljb25zdCB0ZXh0dXJlID0gdGV4dHVyZXNbIGkgXTsKCiAgICAJCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICk7CiAgICAJCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICk7CiAgICAJCQkJY29uc3QgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKICAgIAkJCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJCWlmICggaXNNdWx0aXNhbXBsZSAmJiB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCiAgICAJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKICAgIAkJCQl9IGVsc2UgaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKICAgIAkJCQkJbXVsdGlzYW1wbGVkUlRURXh0LnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZUVYVCggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZSggX2dsLlJFTkRFUkJVRkZFUiwgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgbnVsbCApOwoKICAgIAl9CgogICAgCS8vIFNldHVwIHJlc291cmNlcyBmb3IgYSBEZXB0aCBUZXh0dXJlIGZvciBhIEZCTyAobmVlZHMgYW4gZXh0ZW5zaW9uKQogICAgCWZ1bmN0aW9uIHNldHVwRGVwdGhUZXh0dXJlKCBmcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJY29uc3QgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICk7CiAgICAJCWlmICggaXNDdWJlICkgdGhyb3cgbmV3IEVycm9yKCAnRGVwdGggVGV4dHVyZSB3aXRoIGN1YmUgcmVuZGVyIHRhcmdldHMgaXMgbm90IHN1cHBvcnRlZCcgKTsKCiAgICAJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBmcmFtZWJ1ZmZlciApOwoKICAgIAkJaWYgKCAhICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSAmJiByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmlzRGVwdGhUZXh0dXJlICkgKSB7CgogICAgCQkJdGhyb3cgbmV3IEVycm9yKCAncmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSBtdXN0IGJlIGFuIGluc3RhbmNlIG9mIFRIUkVFLkRlcHRoVGV4dHVyZScgKTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKTsKICAgIAkJdGV4dHVyZVByb3BlcnRpZXMuX19yZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQ7CgogICAgCQkvLyB1cGxvYWQgYW4gZW1wdHkgZGVwdGggdGV4dHVyZSB3aXRoIGZyYW1lYnVmZmVyIHNpemUKICAgIAkJaWYgKCAhIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlIHx8CiAgICAJCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS53aWR0aCAhPT0gcmVuZGVyVGFyZ2V0LndpZHRoIHx8CiAgICAJCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS5oZWlnaHQgIT09IHJlbmRlclRhcmdldC5oZWlnaHQgKSB7CgogICAgCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS53aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKICAgIAkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ID0gcmVuZGVyVGFyZ2V0LmhlaWdodDsKICAgIAkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJfQoKICAgIAkJc2V0VGV4dHVyZTJEKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLCAwICk7CgogICAgCQljb25zdCB3ZWJnbERlcHRoVGV4dHVyZSA9IHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlOwogICAgCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuZm9ybWF0ID09PSBEZXB0aEZvcm1hdCApIHsKCiAgICAJCQlpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgKSB7CgogICAgCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5mcmFtZWJ1ZmZlclRleHR1cmUyRE11bHRpc2FtcGxlRVhUKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAsIHNhbXBsZXMgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuZm9ybWF0ID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB7CgogICAgCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKICAgIAkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAsIHNhbXBsZXMgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwICk7CgogICAgCQkJfQoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQl0aHJvdyBuZXcgRXJyb3IoICdVbmtub3duIGRlcHRoVGV4dHVyZSBmb3JtYXQnICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJLy8gU2V0dXAgR0wgcmVzb3VyY2VzIGZvciBhIG5vbi10ZXh0dXJlIGRlcHRoIGJ1ZmZlcgogICAgCWZ1bmN0aW9uIHNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCWNvbnN0IGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID09PSB0cnVlICk7CgogICAgCQkvLyBpZiB0aGUgYm91bmQgZGVwdGggdGV4dHVyZSBoYXMgY2hhbmdlZAogICAgCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19ib3VuZERlcHRoVGV4dHVyZSAhPT0gcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApIHsKCiAgICAJCQkvLyBmaXJlIHRoZSBkaXNwb3NlIGV2ZW50IHRvIGdldCByaWQgb2Ygc3RvcmVkIHN0YXRlIGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJldmlvdXNseSBib3VuZCBkZXB0aCBidWZmZXIKICAgIAkJCWNvbnN0IGRlcHRoVGV4dHVyZSA9IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmU7CiAgICAJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19kZXB0aERpc3Bvc2VDYWxsYmFjayApIHsKCiAgICAJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrKCk7CgogICAgCQkJfQoKICAgIAkJCS8vIHNldCB1cCBkaXNwb3NlIGxpc3RlbmVycyB0byB0cmFjayB3aGVuIHRoZSBjdXJyZW50bHkgYXR0YWNoZWQgYnVmZmVyIGlzIGltcGxpY2l0bHkgdW5ib3VuZAogICAgCQkJaWYgKCBkZXB0aFRleHR1cmUgKSB7CgogICAgCQkJCWNvbnN0IGRpc3Bvc2VFdmVudCA9ICgpID0+IHsKCiAgICAJCQkJCWRlbGV0ZSByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmU7CiAgICAJCQkJCWRlbGV0ZSByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fZGVwdGhEaXNwb3NlQ2FsbGJhY2s7CiAgICAJCQkJCWRlcHRoVGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIGRpc3Bvc2VFdmVudCApOwoKICAgIAkJCQl9OwoKICAgIAkJCQlkZXB0aFRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlRXZlbnQgKTsKICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fZGVwdGhEaXNwb3NlQ2FsbGJhY2sgPSBkaXNwb3NlRXZlbnQ7CgogICAgCQkJfQoKICAgIAkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19ib3VuZERlcHRoVGV4dHVyZSA9IGRlcHRoVGV4dHVyZTsKCiAgICAJCX0KCiAgICAJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSAmJiAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciApIHsKCiAgICAJCQlpZiAoIGlzQ3ViZSApIHRocm93IG5ldyBFcnJvciggJ3RhcmdldC5kZXB0aFRleHR1cmUgbm90IHN1cHBvcnRlZCBpbiBDdWJlIHJlbmRlciB0YXJnZXRzJyApOwoKICAgIAkJCWNvbnN0IG1pcG1hcHMgPSByZW5kZXJUYXJnZXQudGV4dHVyZS5taXBtYXBzOwoKICAgIAkJCWlmICggbWlwbWFwcyAmJiBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCXNldHVwRGVwdGhUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgMCBdLCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlzZXR1cERlcHRoVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSB7CgogICAgCQkJaWYgKCBpc0N1YmUgKSB7CgogICAgCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyID0gW107CgogICAgCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoKICAgIAkJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgIAkJCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSwgcmVuZGVyVGFyZ2V0LCBmYWxzZSApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQkvLyBhdHRhY2ggYnVmZmVyIGlmIGl0J3MgYmVlbiBjcmVhdGVkIGFscmVhZHkKICAgIAkJCQkJCWNvbnN0IGdsQXR0YWNobWVudFR5cGUgPSByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciA/IF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQgOiBfZ2wuREVQVEhfQVRUQUNITUVOVDsKICAgIAkJCQkJCWNvbnN0IHJlbmRlcmJ1ZmZlciA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF07CiAgICAJCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZ2xBdHRhY2htZW50VHlwZSwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCiAgICAJCQkJaWYgKCBtaXBtYXBzICYmIG1pcG1hcHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgMCBdICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgIAkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBmYWxzZSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gYXR0YWNoIGJ1ZmZlciBpZiBpdCdzIGJlZW4gY3JlYXRlZCBhbHJlYWR5CiAgICAJCQkJCWNvbnN0IGdsQXR0YWNobWVudFR5cGUgPSByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciA/IF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQgOiBfZ2wuREVQVEhfQVRUQUNITUVOVDsKICAgIAkJCQkJY29uc3QgcmVuZGVyYnVmZmVyID0gcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXI7CiAgICAJCQkJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKICAgIAkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGdsQXR0YWNobWVudFR5cGUsIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCiAgICAJfQoKICAgIAkvLyByZWJpbmQgZnJhbWVidWZmZXIgd2l0aCBleHRlcm5hbCB0ZXh0dXJlcwogICAgCWZ1bmN0aW9uIHJlYmluZFRleHR1cmVzKCByZW5kZXJUYXJnZXQsIGNvbG9yVGV4dHVyZSwgZGVwdGhUZXh0dXJlICkgewoKICAgIAkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCWlmICggY29sb3JUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQsIHJlbmRlclRhcmdldC50ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFXzJELCAwICk7CgogICAgCQl9CgogICAgCQlpZiAoIGRlcHRoVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCXNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8vIFNldCB1cCBHTCByZXNvdXJjZXMgZm9yIHRoZSByZW5kZXIgdGFyZ2V0CiAgICAJZnVuY3Rpb24gc2V0dXBSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKCiAgICAJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCiAgICAJCXJlbmRlclRhcmdldC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSApOwoKICAgIAkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgogICAgCQljb25zdCBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwogICAgCQljb25zdCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyA9ICggdGV4dHVyZXMubGVuZ3RoID4gMSApOwoKICAgIAkJaWYgKCAhIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKICAgIAkJCWlmICggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKICAgIAkJCX0KCiAgICAJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gPSB0ZXh0dXJlLnZlcnNpb247CiAgICAJCQlpbmZvLm1lbW9yeS50ZXh0dXJlcyArKzsKCiAgICAJCX0KCiAgICAJCS8vIFNldHVwIGZyYW1lYnVmZmVyCgogICAgCQlpZiAoIGlzQ3ViZSApIHsKCiAgICAJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IFtdOwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgogICAgCQkJCWlmICggdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSA9IFtdOwoKICAgIAkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCiAgICAJCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdWyBsZXZlbCBdID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgogICAgCQkJCQl9CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWlmICggdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IFtdOwoKICAgIAkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHRleHR1cmUubWlwbWFwcy5sZW5ndGg7IGxldmVsICsrICkgewoKICAgIAkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0gPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgogICAgCQkJfQoKICAgIAkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJCWNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmVzWyBpIF0gKTsKCiAgICAJCQkJCWlmICggYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCQlhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9IF9nbC5jcmVhdGVUZXh0dXJlKCk7CgogICAgCQkJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCAoIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApICYmIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKICAgIAkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwogICAgCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyID0gW107CgogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCB0ZXh0dXJlID0gdGV4dHVyZXNbIGkgXTsKICAgIAkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKCiAgICAJCQkJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgogICAgCQkJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKICAgIAkJCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICk7CiAgICAJCQkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlLCByZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwogICAgCQkJCQljb25zdCBzYW1wbGVzID0gZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKICAgIAkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCiAgICAJCQkJfQoKICAgIAkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgbnVsbCApOwoKICAgIAkJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCiAgICAJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwogICAgCQkJCQlzZXR1cFJlbmRlckJ1ZmZlclN0b3JhZ2UoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIHRydWUgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIFNldHVwIGNvbG9yIGJ1ZmZlcgoKICAgIAkJaWYgKCBpc0N1YmUgKSB7CgogICAgCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwogICAgCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCiAgICAJCQkJaWYgKCB0ZXh0dXJlLm1pcG1hcHMgJiYgdGV4dHVyZS5taXBtYXBzLmxlbmd0aCA+IDAgKSB7CgogICAgCQkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHRleHR1cmUubWlwbWFwcy5sZW5ndGg7IGxldmVsICsrICkgewoKICAgIAkJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdWyBsZXZlbCBdLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGxldmVsICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCiAgICAJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFX0NVQkVfTUFQICk7CgogICAgCQkJfQoKICAgIAkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCiAgICAJCX0gZWxzZSBpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgYXR0YWNobWVudCA9IHRleHR1cmVzWyBpIF07CiAgICAJCQkJY29uc3QgYXR0YWNobWVudFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggYXR0YWNobWVudCApOwoKICAgIAkJCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfMkQsIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CiAgICAJCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIF9nbC5URVhUVVJFXzJELCBhdHRhY2htZW50ICk7CiAgICAJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQsIGF0dGFjaG1lbnQsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5URVhUVVJFXzJELCAwICk7CgogICAgCQkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCBhdHRhY2htZW50ICkgKSB7CgogICAgCQkJCQlnZW5lcmF0ZU1pcG1hcCggX2dsLlRFWFRVUkVfMkQgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWxldCBnbFRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfMkQ7CgogICAgCQkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTDNEUmVuZGVyVGFyZ2V0IHx8IHJlbmRlclRhcmdldC5pc1dlYkdMQXJyYXlSZW5kZXJUYXJnZXQgKSB7CgogICAgCQkJCWdsVGV4dHVyZVR5cGUgPSByZW5kZXJUYXJnZXQuaXNXZWJHTDNEUmVuZGVyVGFyZ2V0ID8gX2dsLlRFWFRVUkVfM0QgOiBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCiAgICAJCQl9CgogICAgCQkJc3RhdGUuYmluZFRleHR1cmUoIGdsVGV4dHVyZVR5cGUsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CiAgICAJCQlzZXRUZXh0dXJlUGFyYW1ldGVycyggZ2xUZXh0dXJlVHlwZSwgdGV4dHVyZSApOwoKICAgIAkJCWlmICggdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHRleHR1cmUubWlwbWFwcy5sZW5ndGg7IGxldmVsICsrICkgewoKICAgIAkJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBsZXZlbCBdLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZ2xUZXh0dXJlVHlwZSwgbGV2ZWwgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsVGV4dHVyZVR5cGUsIDAgKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCiAgICAJCQkJZ2VuZXJhdGVNaXBtYXAoIGdsVGV4dHVyZVR5cGUgKTsKCiAgICAJCQl9CgogICAgCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKICAgIAkJfQoKICAgIAkJLy8gU2V0dXAgZGVwdGggYW5kIHN0ZW5jaWwgYnVmZmVycwoKICAgIAkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgogICAgCQkJc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0ICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQljb25zdCB0ZXh0dXJlID0gdGV4dHVyZXNbIGkgXTsKCiAgICAJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSApICkgewoKICAgIAkJCQljb25zdCB0YXJnZXRUeXBlID0gZ2V0VGFyZ2V0VHlwZSggcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZTsKCiAgICAJCQkJc3RhdGUuYmluZFRleHR1cmUoIHRhcmdldFR5cGUsIHdlYmdsVGV4dHVyZSApOwogICAgCQkJCWdlbmVyYXRlTWlwbWFwKCB0YXJnZXRUeXBlICk7CiAgICAJCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJfQoKICAgIAljb25zdCBpbnZhbGlkYXRpb25BcnJheVJlYWQgPSBbXTsKICAgIAljb25zdCBpbnZhbGlkYXRpb25BcnJheURyYXcgPSBbXTsKCiAgICAJZnVuY3Rpb24gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCWlmICggcmVuZGVyVGFyZ2V0LnNhbXBsZXMgPiAwICkgewoKICAgIAkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgogICAgCQkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwogICAgCQkJCWNvbnN0IHdpZHRoID0gcmVuZGVyVGFyZ2V0LndpZHRoOwogICAgCQkJCWNvbnN0IGhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CiAgICAJCQkJbGV0IG1hc2sgPSBfZ2wuQ09MT1JfQlVGRkVSX0JJVDsKICAgIAkJCQljb25zdCBkZXB0aFN0eWxlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CiAgICAJCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKICAgIAkJCQljb25zdCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyA9ICggdGV4dHVyZXMubGVuZ3RoID4gMSApOwoKICAgIAkJCQkvLyBJZiBNUlQgd2UgbmVlZCB0byByZW1vdmUgRkJPIGF0dGFjaG1lbnRzCiAgICAJCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCiAgICAJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKICAgIAkJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCBudWxsICk7CgogICAgCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgbnVsbCwgMCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgogICAgCQkJCWNvbnN0IG1pcG1hcHMgPSByZW5kZXJUYXJnZXQudGV4dHVyZS5taXBtYXBzOwoKICAgIAkJCQlpZiAoIG1pcG1hcHMgJiYgbWlwbWFwcy5sZW5ndGggPiAwICkgewoKICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCiAgICAJCQkJfQoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQlpZiAoIHJlbmRlclRhcmdldC5yZXNvbHZlRGVwdGhCdWZmZXIgKSB7CgogICAgCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSBtYXNrIHw9IF9nbC5ERVBUSF9CVUZGRVJfQklUOwoKICAgIAkJCQkJCS8vIHJlc29sdmluZyBzdGVuY2lsIGlzIHNsb3cgd2l0aCBhIEQzRCBiYWNrZW5kLiBkaXNhYmxlIGl0IGZvciBhbGwgdHJhbnNtaXNzaW9uIHJlbmRlciB0YXJnZXRzIChzZWUgIzI3Nzk5KQoKICAgIAkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgJiYgcmVuZGVyVGFyZ2V0LnJlc29sdmVTdGVuY2lsQnVmZmVyICkgbWFzayB8PSBfZ2wuU1RFTkNJTF9CVUZGRVJfQklUOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCiAgICAJCQkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApLl9fd2ViZ2xUZXh0dXJlOwogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xUZXh0dXJlLCAwICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlfZ2wuYmxpdEZyYW1lYnVmZmVyKCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCBtYXNrLCBfZ2wuTkVBUkVTVCApOwoKICAgIAkJCQkJaWYgKCBzdXBwb3J0c0ludmFsaWRhdGVGcmFtZWJ1ZmZlciA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQubGVuZ3RoID0gMDsKICAgIAkJCQkJCWludmFsaWRhdGlvbkFycmF5RHJhdy5sZW5ndGggPSAwOwoKICAgIAkJCQkJCWludmFsaWRhdGlvbkFycmF5UmVhZC5wdXNoKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpICk7CgogICAgCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgKSB7CgogICAgCQkJCQkJCWludmFsaWRhdGlvbkFycmF5UmVhZC5wdXNoKCBkZXB0aFN0eWxlICk7CiAgICAJCQkJCQkJaW52YWxpZGF0aW9uQXJyYXlEcmF3LnB1c2goIGRlcHRoU3R5bGUgKTsKCiAgICAJCQkJCQkJX2dsLmludmFsaWRhdGVGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIGludmFsaWRhdGlvbkFycmF5RHJhdyApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgaW52YWxpZGF0aW9uQXJyYXlSZWFkICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCiAgICAJCQkJLy8gSWYgTVJUIHNpbmNlIHByZS1ibGl0IHdlIHJlbW92ZWQgdGhlIEZCTyB3ZSBuZWVkIHRvIHJlY29uc3RydWN0IHRoZSBhdHRhY2htZW50cwogICAgCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgogICAgCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKICAgIAkJCQkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICkuX193ZWJnbFRleHR1cmU7CgogICAgCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xUZXh0dXJlLCAwICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciAmJiByZW5kZXJUYXJnZXQucmVzb2x2ZURlcHRoQnVmZmVyID09PSBmYWxzZSAmJiBzdXBwb3J0c0ludmFsaWRhdGVGcmFtZWJ1ZmZlciApIHsKCiAgICAJCQkJCWNvbnN0IGRlcHRoU3R5bGUgPSByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciA/IF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQgOiBfZ2wuREVQVEhfQVRUQUNITUVOVDsKCiAgICAJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBbIGRlcHRoU3R5bGUgXSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCXJldHVybiBNYXRoLm1pbiggY2FwYWJpbGl0aWVzLm1heFNhbXBsZXMsIHJlbmRlclRhcmdldC5zYW1wbGVzICk7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSB7CgogICAgCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoKICAgIAkJcmV0dXJuIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCAmJiBleHRlbnNpb25zLmhhcyggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA9PT0gdHJ1ZSAmJiByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlUmVuZGVyVG9UZXh0dXJlICE9PSBmYWxzZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1cGRhdGVWaWRlb1RleHR1cmUoIHRleHR1cmUgKSB7CgogICAgCQljb25zdCBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKICAgIAkJLy8gQ2hlY2sgdGhlIGxhc3QgZnJhbWUgd2UgdXBkYXRlZCB0aGUgVmlkZW9UZXh0dXJlCgogICAgCQlpZiAoIF92aWRlb1RleHR1cmVzLmdldCggdGV4dHVyZSApICE9PSBmcmFtZSApIHsKCiAgICAJCQlfdmlkZW9UZXh0dXJlcy5zZXQoIHRleHR1cmUsIGZyYW1lICk7CiAgICAJCQl0ZXh0dXJlLnVwZGF0ZSgpOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHZlcmlmeUNvbG9yU3BhY2UoIHRleHR1cmUsIGltYWdlICkgewoKICAgIAkJY29uc3QgY29sb3JTcGFjZSA9IHRleHR1cmUuY29sb3JTcGFjZTsKICAgIAkJY29uc3QgZm9ybWF0ID0gdGV4dHVyZS5mb3JtYXQ7CiAgICAJCWNvbnN0IHR5cGUgPSB0ZXh0dXJlLnR5cGU7CgogICAgCQlpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSA9PT0gdHJ1ZSB8fCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlID09PSB0cnVlICkgcmV0dXJuIGltYWdlOwoKICAgIAkJaWYgKCBjb2xvclNwYWNlICE9PSBMaW5lYXJTUkdCQ29sb3JTcGFjZSAmJiBjb2xvclNwYWNlICE9PSBOb0NvbG9yU3BhY2UgKSB7CgogICAgCQkJLy8gc1JHQgoKICAgIAkJCWlmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApIHsKCiAgICAJCQkJLy8gaW4gV2ViR0wgMiB1bmNvbXByZXNzZWQgdGV4dHVyZXMgY2FuIG9ubHkgYmUgc1JHQiBlbmNvZGVkIGlmIHRoZXkgaGF2ZSB0aGUgUkdCQTggZm9ybWF0CgogICAgCQkJCWlmICggZm9ybWF0ICE9PSBSR0JBRm9ybWF0IHx8IHR5cGUgIT09IFVuc2lnbmVkQnl0ZVR5cGUgKSB7CgogICAgCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFRleHR1cmVzOiBzUkdCIGVuY29kZWQgdGV4dHVyZXMgaGF2ZSB0byB1c2UgUkdCQUZvcm1hdCBhbmQgVW5zaWduZWRCeXRlVHlwZS4nICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVW5zdXBwb3J0ZWQgdGV4dHVyZSBjb2xvciBzcGFjZTonLCBjb2xvclNwYWNlICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJcmV0dXJuIGltYWdlOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldERpbWVuc2lvbnMoIGltYWdlICkgewoKICAgIAkJaWYgKCB0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgewoKICAgIAkJCS8vIGlmIGludHJpbnNpYyBkYXRhIGFyZSBub3QgYXZhaWxhYmxlLCBmYWxsYmFjayB0byB3aWR0aC9oZWlnaHQKCiAgICAJCQlfaW1hZ2VEaW1lbnNpb25zLndpZHRoID0gaW1hZ2UubmF0dXJhbFdpZHRoIHx8IGltYWdlLndpZHRoOwogICAgCQkJX2ltYWdlRGltZW5zaW9ucy5oZWlnaHQgPSBpbWFnZS5uYXR1cmFsSGVpZ2h0IHx8IGltYWdlLmhlaWdodDsKCiAgICAJCX0gZWxzZSBpZiAoIHR5cGVvZiBWaWRlb0ZyYW1lICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIFZpZGVvRnJhbWUgKSB7CgogICAgCQkJX2ltYWdlRGltZW5zaW9ucy53aWR0aCA9IGltYWdlLmRpc3BsYXlXaWR0aDsKICAgIAkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UuZGlzcGxheUhlaWdodDsKCiAgICAJCX0gZWxzZSB7CgogICAgCQkJX2ltYWdlRGltZW5zaW9ucy53aWR0aCA9IGltYWdlLndpZHRoOwogICAgCQkJX2ltYWdlRGltZW5zaW9ucy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgogICAgCQl9CgogICAgCQlyZXR1cm4gX2ltYWdlRGltZW5zaW9uczsKCiAgICAJfQoKICAgIAkvLwoKICAgIAl0aGlzLmFsbG9jYXRlVGV4dHVyZVVuaXQgPSBhbGxvY2F0ZVRleHR1cmVVbml0OwogICAgCXRoaXMucmVzZXRUZXh0dXJlVW5pdHMgPSByZXNldFRleHR1cmVVbml0czsKCiAgICAJdGhpcy5zZXRUZXh0dXJlMkQgPSBzZXRUZXh0dXJlMkQ7CiAgICAJdGhpcy5zZXRUZXh0dXJlMkRBcnJheSA9IHNldFRleHR1cmUyREFycmF5OwogICAgCXRoaXMuc2V0VGV4dHVyZTNEID0gc2V0VGV4dHVyZTNEOwogICAgCXRoaXMuc2V0VGV4dHVyZUN1YmUgPSBzZXRUZXh0dXJlQ3ViZTsKICAgIAl0aGlzLnJlYmluZFRleHR1cmVzID0gcmViaW5kVGV4dHVyZXM7CiAgICAJdGhpcy5zZXR1cFJlbmRlclRhcmdldCA9IHNldHVwUmVuZGVyVGFyZ2V0OwogICAgCXRoaXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwID0gdXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwOwogICAgCXRoaXMudXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQgPSB1cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldDsKICAgIAl0aGlzLnNldHVwRGVwdGhSZW5kZXJidWZmZXIgPSBzZXR1cERlcHRoUmVuZGVyYnVmZmVyOwogICAgCXRoaXMuc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUgPSBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZTsKICAgIAl0aGlzLnVzZU11bHRpc2FtcGxlZFJUVCA9IHVzZU11bHRpc2FtcGxlZFJUVDsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xVdGlscyggZ2wsIGV4dGVuc2lvbnMgKSB7CgogICAgCWZ1bmN0aW9uIGNvbnZlcnQoIHAsIGNvbG9yU3BhY2UgPSBOb0NvbG9yU3BhY2UgKSB7CgogICAgCQlsZXQgZXh0ZW5zaW9uOwoKICAgIAkJY29uc3QgdHJhbnNmZXIgPSBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGNvbG9yU3BhY2UgKTsKCiAgICAJCWlmICggcCA9PT0gVW5zaWduZWRCeXRlVHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9CWVRFOwogICAgCQlpZiAoIHAgPT09IFVuc2lnbmVkU2hvcnQ0NDQ0VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9TSE9SVF80XzRfNF80OwogICAgCQlpZiAoIHAgPT09IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9TSE9SVF81XzVfNV8xOwogICAgCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50NTk5OVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfSU5UXzVfOV85XzlfUkVWOwoKICAgIAkJaWYgKCBwID09PSBCeXRlVHlwZSApIHJldHVybiBnbC5CWVRFOwogICAgCQlpZiAoIHAgPT09IFNob3J0VHlwZSApIHJldHVybiBnbC5TSE9SVDsKICAgIAkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9TSE9SVDsKICAgIAkJaWYgKCBwID09PSBJbnRUeXBlICkgcmV0dXJuIGdsLklOVDsKICAgIAkJaWYgKCBwID09PSBVbnNpZ25lZEludFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfSU5UOwogICAgCQlpZiAoIHAgPT09IEZsb2F0VHlwZSApIHJldHVybiBnbC5GTE9BVDsKICAgIAkJaWYgKCBwID09PSBIYWxmRmxvYXRUeXBlICkgcmV0dXJuIGdsLkhBTEZfRkxPQVQ7CgogICAgCQlpZiAoIHAgPT09IEFscGhhRm9ybWF0ICkgcmV0dXJuIGdsLkFMUEhBOwogICAgCQlpZiAoIHAgPT09IFJHQkZvcm1hdCApIHJldHVybiBnbC5SR0I7CiAgICAJCWlmICggcCA9PT0gUkdCQUZvcm1hdCApIHJldHVybiBnbC5SR0JBOwogICAgCQlpZiAoIHAgPT09IERlcHRoRm9ybWF0ICkgcmV0dXJuIGdsLkRFUFRIX0NPTVBPTkVOVDsKICAgIAkJaWYgKCBwID09PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSByZXR1cm4gZ2wuREVQVEhfU1RFTkNJTDsKCiAgICAJCS8vIFdlYkdMMiBmb3JtYXRzLgoKICAgIAkJaWYgKCBwID09PSBSZWRGb3JtYXQgKSByZXR1cm4gZ2wuUkVEOwogICAgCQlpZiAoIHAgPT09IFJlZEludGVnZXJGb3JtYXQgKSByZXR1cm4gZ2wuUkVEX0lOVEVHRVI7CiAgICAJCWlmICggcCA9PT0gUkdGb3JtYXQgKSByZXR1cm4gZ2wuUkc7CiAgICAJCWlmICggcCA9PT0gUkdJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJHX0lOVEVHRVI7CiAgICAJCWlmICggcCA9PT0gUkdCQUludGVnZXJGb3JtYXQgKSByZXR1cm4gZ2wuUkdCQV9JTlRFR0VSOwoKICAgIAkJLy8gUzNUQwoKICAgIAkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDNfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCApIHsKCiAgICAJCQlpZiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSB7CgogICAgCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGNfc3JnYicgKTsKCiAgICAJCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgogICAgCQkJCQlpZiAoIHAgPT09IFJHQl9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfUzNUQ19EWFQxX0VYVDsKICAgIAkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9TM1RDX0RYVDFfRVhUOwogICAgCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX1MzVENfRFhUM19FWFQ7CiAgICAJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfQUxQSEFfUzNUQ19EWFQ1X0VYVDsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCXJldHVybiBudWxsOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKCiAgICAJCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgogICAgCQkJCQlpZiAoIHAgPT09IFJHQl9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9TM1RDX0RYVDFfRVhUOwogICAgCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUMV9FWFQ7CiAgICAJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDNfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQzX0VYVDsKICAgIAkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDVfRVhUOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLyBQVlJUQwoKICAgIAkJaWYgKCBwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCB8fCBwID09PSBSR0JfUFZSVENfMkJQUFYxX0Zvcm1hdCB8fCBwID09PSBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgewoKICAgIAkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ180QlBQVjFfSU1HOwogICAgCQkJCWlmICggcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX1BWUlRDXzJCUFBWMV9JTUc7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9QVlJUQ180QlBQVjFfSU1HOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfMkJQUFYxX0lNRzsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlyZXR1cm4gbnVsbDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLyBFVEMKCiAgICAJCWlmICggcCA9PT0gUkdCX0VUQzFfRm9ybWF0IHx8IHAgPT09IFJHQl9FVEMyX0Zvcm1hdCB8fCBwID09PSBSR0JBX0VUQzJfRUFDX0Zvcm1hdCApIHsKCiAgICAJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMnICk7CgogICAgCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgogICAgCQkJCWlmICggcCA9PT0gUkdCX0VUQzFfRm9ybWF0IHx8IHAgPT09IFJHQl9FVEMyX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0VUQzIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0I4X0VUQzI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0VUQzJfRUFDX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9FVEMyX0VBQyA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkE4X0VUQzJfRUFDOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXJldHVybiBudWxsOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIEFTVEMKCiAgICAJCWlmICggcCA9PT0gUkdCQV9BU1RDXzR4NF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzV4NV9Gb3JtYXQgfHwKICAgIAkJCXAgPT09IFJHQkFfQVNUQ182eDVfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ182eDZfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ184eDVfRm9ybWF0IHx8CiAgICAJCQlwID09PSBSR0JBX0FTVENfOHg2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg4X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgfHwKICAgIAkJCXAgPT09IFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDEwX0Zvcm1hdCB8fAogICAgCQkJcCA9PT0gUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTJ4MTJfRm9ybWF0ICkgewoKICAgIAkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX2FzdGMnICk7CgogICAgCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzR4NF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ180eDRfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzR4NF9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNXg0X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzV4NF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNXg0X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ181eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNXg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ181eDVfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzZ4NV9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ182eDVfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzZ4NV9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzZ4Nl9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNng2X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ184eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfOHg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ184eDVfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ184eDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzh4Nl9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfOHg4X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzh4OF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfOHg4X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDVfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDVfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDZfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4Nl9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4Nl9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHg4X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHg4X0tIUjsKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHgxMF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4MTBfS0hSOwogICAgCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEyeDEwX0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMngxMF9LSFI7CiAgICAJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTJ4MTJfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTJ4MTJfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEyeDEyX0tIUjsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlyZXR1cm4gbnVsbDsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvLyBCUFRDCgogICAgCQlpZiAoIHAgPT09IFJHQkFfQlBUQ19Gb3JtYXQgfHwgcCA9PT0gUkdCX0JQVENfU0lHTkVEX0Zvcm1hdCB8fCBwID09PSBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgKSB7CgogICAgCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9icHRjJyApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQlBUQ19Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX0JQVENfVU5PUk1fRVhUIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9CUFRDX1VOT1JNX0VYVDsKICAgIAkJCQlpZiAoIHAgPT09IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0JQVENfU0lHTkVEX0ZMT0FUX0VYVDsKICAgIAkJCQlpZiAoIHAgPT09IFJHQl9CUFRDX1VOU0lHTkVEX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfQlBUQ19VTlNJR05FRF9GTE9BVF9FWFQ7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gUkdUQwoKICAgIAkJaWYgKCBwID09PSBSRURfUkdUQzFfRm9ybWF0IHx8IHAgPT09IFNJR05FRF9SRURfUkdUQzFfRm9ybWF0IHx8IHAgPT09IFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgfHwgcCA9PT0gU0lHTkVEX1JFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgKSB7CgogICAgCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9yZ3RjJyApOwoKICAgIAkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKICAgIAkJCQlpZiAoIHAgPT09IFJHQkFfQlBUQ19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkVEX1JHVEMxX0VYVDsKICAgIAkJCQlpZiAoIHAgPT09IFNJR05FRF9SRURfUkdUQzFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NJR05FRF9SRURfUkdUQzFfRVhUOwogICAgCQkJCWlmICggcCA9PT0gUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SRURfR1JFRU5fUkdUQzJfRVhUOwogICAgCQkJCWlmICggcCA9PT0gU0lHTkVEX1JFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU0lHTkVEX1JFRF9HUkVFTl9SR1RDMl9FWFQ7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcmV0dXJuIG51bGw7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8KCiAgICAJCWlmICggcCA9PT0gVW5zaWduZWRJbnQyNDhUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVF8yNF84OwoKICAgIAkJLy8gaWYgInAiIGNhbid0IGJlIHJlc29sdmVkLCBhc3N1bWUgdGhlIHVzZXIgZGVmaW5lcyBhIFdlYkdMIGNvbnN0YW50IGFzIGEgc3RyaW5nIChmYWxsYmFjay93b3JrYXJvdW5kIGZvciBwYWNrZWQgUkdCIGZvcm1hdHMpCgogICAgCQlyZXR1cm4gKCBnbFsgcCBdICE9PSB1bmRlZmluZWQgKSA/IGdsWyBwIF0gOiBudWxsOwoKICAgIAl9CgogICAgCXJldHVybiB7IGNvbnZlcnQ6IGNvbnZlcnQgfTsKCiAgICB9CgogICAgY29uc3QgX29jY2x1c2lvbl92ZXJ0ZXggPSBgCnZvaWQgbWFpbigpIHsKCglnbF9Qb3NpdGlvbiA9IHZlYzQoIHBvc2l0aW9uLCAxLjAgKTsKCn1gOwoKICAgIGNvbnN0IF9vY2NsdXNpb25fZnJhZ21lbnQgPSBgCnVuaWZvcm0gc2FtcGxlcjJEQXJyYXkgZGVwdGhDb2xvcjsKdW5pZm9ybSBmbG9hdCBkZXB0aFdpZHRoOwp1bmlmb3JtIGZsb2F0IGRlcHRoSGVpZ2h0OwoKdm9pZCBtYWluKCkgewoKCXZlYzIgY29vcmQgPSB2ZWMyKCBnbF9GcmFnQ29vcmQueCAvIGRlcHRoV2lkdGgsIGdsX0ZyYWdDb29yZC55IC8gZGVwdGhIZWlnaHQgKTsKCglpZiAoIGNvb3JkLnggPj0gMS4wICkgewoKCQlnbF9GcmFnRGVwdGggPSB0ZXh0dXJlKCBkZXB0aENvbG9yLCB2ZWMzKCBjb29yZC54IC0gMS4wLCBjb29yZC55LCAxICkgKS5yOwoKCX0gZWxzZSB7CgoJCWdsX0ZyYWdEZXB0aCA9IHRleHR1cmUoIGRlcHRoQ29sb3IsIHZlYzMoIGNvb3JkLngsIGNvb3JkLnksIDAgKSApLnI7CgoJfQoKfWA7CgogICAgLyoqCiAgICAgKiBBIFhSIG1vZHVsZSB0aGF0IG1hbmFnZXMgdGhlIGFjY2VzcyB0byB0aGUgRGVwdGggU2Vuc2luZyBBUEkuCiAgICAgKi8KICAgIGNsYXNzIFdlYlhSRGVwdGhTZW5zaW5nIHsKCiAgICAJLyoqCiAgICAJICogQ29uc3RydWN0cyBhIG5ldyBkZXB0aCBzZW5zaW5nIG1vZHVsZS4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvcigpIHsKCiAgICAJCS8qKgogICAgCQkgKiBBIHRleHR1cmUgcmVwcmVzZW50aW5nIHRoZSBkZXB0aCBvZiB0aGUgdXNlcidzIGVudmlyb25tZW50LgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7P1RleHR1cmV9CiAgICAJCSAqLwogICAgCQl0aGlzLnRleHR1cmUgPSBudWxsOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgcGxhbmUgbWVzaCBmb3IgdmlzdWFsaXppbmcgdGhlIGRlcHRoIHRleHR1cmUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHs/TWVzaH0KICAgIAkJICovCiAgICAJCXRoaXMubWVzaCA9IG51bGw7CgogICAgCQkvKioKICAgIAkJICogVGhlIGRlcHRoIG5lYXIgdmFsdWUuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqLwogICAgCQl0aGlzLmRlcHRoTmVhciA9IDA7CgogICAgCQkvKioKICAgIAkJICogVGhlIGRlcHRoIG5lYXIgZmFyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7bnVtYmVyfQogICAgCQkgKi8KICAgIAkJdGhpcy5kZXB0aEZhciA9IDA7CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogSW5pdHMgdGhlIGRlcHRoIHNlbnNpbmcgbW9kdWxlCiAgICAJICoKICAgIAkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgogICAgCSAqIEBwYXJhbSB7WFJXZWJHTERlcHRoSW5mb3JtYXRpb259IGRlcHRoRGF0YSAtIFRoZSBYUiBkZXB0aCBkYXRhLgogICAgCSAqIEBwYXJhbSB7WFJSZW5kZXJTdGF0ZX0gcmVuZGVyU3RhdGUgLSBUaGUgWFIgcmVuZGVyIHN0YXRlLgogICAgCSAqLwogICAgCWluaXQoIHJlbmRlcmVyLCBkZXB0aERhdGEsIHJlbmRlclN0YXRlICkgewoKICAgIAkJaWYgKCB0aGlzLnRleHR1cmUgPT09IG51bGwgKSB7CgogICAgCQkJY29uc3QgdGV4dHVyZSA9IG5ldyBUZXh0dXJlKCk7CgogICAgCQkJY29uc3QgdGV4UHJvcHMgPSByZW5kZXJlci5wcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwogICAgCQkJdGV4UHJvcHMuX193ZWJnbFRleHR1cmUgPSBkZXB0aERhdGEudGV4dHVyZTsKCiAgICAJCQlpZiAoICggZGVwdGhEYXRhLmRlcHRoTmVhciAhPT0gcmVuZGVyU3RhdGUuZGVwdGhOZWFyICkgfHwgKCBkZXB0aERhdGEuZGVwdGhGYXIgIT09IHJlbmRlclN0YXRlLmRlcHRoRmFyICkgKSB7CgogICAgCQkJCXRoaXMuZGVwdGhOZWFyID0gZGVwdGhEYXRhLmRlcHRoTmVhcjsKICAgIAkJCQl0aGlzLmRlcHRoRmFyID0gZGVwdGhEYXRhLmRlcHRoRmFyOwoKICAgIAkJCX0KCiAgICAJCQl0aGlzLnRleHR1cmUgPSB0ZXh0dXJlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSBwbGFuZSBtZXNoIHRoYXQgdmlzdWFsaXplcyB0aGUgZGVwdGggdGV4dHVyZS4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7QXJyYXlDYW1lcmF9IGNhbWVyYVhSIC0gVGhlIFhSIGNhbWVyYS4KICAgIAkgKiBAcmV0dXJuIHs/TWVzaH0gVGhlIHBsYW5lIG1lc2guCiAgICAJICovCiAgICAJZ2V0TWVzaCggY2FtZXJhWFIgKSB7CgogICAgCQlpZiAoIHRoaXMudGV4dHVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQlpZiAoIHRoaXMubWVzaCA9PT0gbnVsbCApIHsKCiAgICAJCQkJY29uc3Qgdmlld3BvcnQgPSBjYW1lcmFYUi5jYW1lcmFzWyAwIF0udmlld3BvcnQ7CiAgICAJCQkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKICAgIAkJCQkJdmVydGV4U2hhZGVyOiBfb2NjbHVzaW9uX3ZlcnRleCwKICAgIAkJCQkJZnJhZ21lbnRTaGFkZXI6IF9vY2NsdXNpb25fZnJhZ21lbnQsCiAgICAJCQkJCXVuaWZvcm1zOiB7CiAgICAJCQkJCQlkZXB0aENvbG9yOiB7IHZhbHVlOiB0aGlzLnRleHR1cmUgfSwKICAgIAkJCQkJCWRlcHRoV2lkdGg6IHsgdmFsdWU6IHZpZXdwb3J0LnogfSwKICAgIAkJCQkJCWRlcHRoSGVpZ2h0OiB7IHZhbHVlOiB2aWV3cG9ydC53IH0KICAgIAkJCQkJfQogICAgCQkJCX0gKTsKCiAgICAJCQkJdGhpcy5tZXNoID0gbmV3IE1lc2goIG5ldyBQbGFuZUdlb21ldHJ5KCAyMCwgMjAgKSwgbWF0ZXJpYWwgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlyZXR1cm4gdGhpcy5tZXNoOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlc2V0cyB0aGUgbW9kdWxlCiAgICAJICovCiAgICAJcmVzZXQoKSB7CgogICAgCQl0aGlzLnRleHR1cmUgPSBudWxsOwogICAgCQl0aGlzLm1lc2ggPSBudWxsOwoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJldHVybnMgYSB0ZXh0dXJlIHJlcHJlc2VudGluZyB0aGUgZGVwdGggb2YgdGhlIHVzZXIncyBlbnZpcm9ubWVudC4KICAgIAkgKgogICAgCSAqIEByZXR1cm4gez9UZXh0dXJlfSBUaGUgZGVwdGggdGV4dHVyZS4KICAgIAkgKi8KICAgIAlnZXREZXB0aFRleHR1cmUoKSB7CgogICAgCQlyZXR1cm4gdGhpcy50ZXh0dXJlOwoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBjbGFzcyByZXByZXNlbnRzIGFuIGFic3RyYWN0aW9uIG9mIHRoZSBXZWJYUiBEZXZpY2UgQVBJIGFuZCBpcwogICAgICogaW50ZXJuYWxseSB1c2VkIGJ5IHtAbGluayBXZWJHTFJlbmRlcmVyfS4gYFdlYlhSTWFuYWdlcmAgYWxzbyBwcm92aWRlcyBhIHB1YmxpYwogICAgICogaW50ZXJmYWNlIHRoYXQgYWxsb3dzIHVzZXJzIHRvIGVuYWJsZS9kaXNhYmxlIFhSIGFuZCBwZXJmb3JtIFhSIHJlbGF0ZWQKICAgICAqIHRhc2tzIGxpa2UgZm9yIGluc3RhbmNlIHJldHJpZXZpbmcgY29udHJvbGxlcnMuCiAgICAgKgogICAgICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgogICAgICogQGhpZGVjb25zdHJ1Y3RvcgogICAgICovCiAgICBjbGFzcyBXZWJYUk1hbmFnZXIgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IFdlYkdMIHJlbmRlcmVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KICAgIAkgKiBAcGFyYW0ge1dlYkdMMlJlbmRlcmluZ0NvbnRleHR9IGdsIC0gVGhlIHJlbmRlcmluZyBjb250ZXh0LgogICAgCSAqLwogICAgCWNvbnN0cnVjdG9yKCByZW5kZXJlciwgZ2wgKSB7CgogICAgCQlzdXBlcigpOwoKICAgIAkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKICAgIAkJbGV0IHNlc3Npb24gPSBudWxsOwoKICAgIAkJbGV0IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSAxLjA7CgogICAgCQlsZXQgcmVmZXJlbmNlU3BhY2UgPSBudWxsOwogICAgCQlsZXQgcmVmZXJlbmNlU3BhY2VUeXBlID0gJ2xvY2FsLWZsb29yJzsKICAgIAkJLy8gU2V0IGRlZmF1bHQgZm92ZWF0aW9uIHRvIG1heGltdW0uCiAgICAJCWxldCBmb3ZlYXRpb24gPSAxLjA7CiAgICAJCWxldCBjdXN0b21SZWZlcmVuY2VTcGFjZSA9IG51bGw7CgogICAgCQlsZXQgcG9zZSA9IG51bGw7CiAgICAJCWxldCBnbEJpbmRpbmcgPSBudWxsOwogICAgCQlsZXQgZ2xQcm9qTGF5ZXIgPSBudWxsOwogICAgCQlsZXQgZ2xCYXNlTGF5ZXIgPSBudWxsOwogICAgCQlsZXQgeHJGcmFtZSA9IG51bGw7CgogICAgCQljb25zdCBkZXB0aFNlbnNpbmcgPSBuZXcgV2ViWFJEZXB0aFNlbnNpbmcoKTsKICAgIAkJY29uc3QgYXR0cmlidXRlcyA9IGdsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgogICAgCQlsZXQgaW5pdGlhbFJlbmRlclRhcmdldCA9IG51bGw7CiAgICAJCWxldCBuZXdSZW5kZXJUYXJnZXQgPSBudWxsOwoKICAgIAkJY29uc3QgY29udHJvbGxlcnMgPSBbXTsKICAgIAkJY29uc3QgY29udHJvbGxlcklucHV0U291cmNlcyA9IFtdOwoKICAgIAkJY29uc3QgY3VycmVudFNpemUgPSBuZXcgVmVjdG9yMigpOwogICAgCQlsZXQgY3VycmVudFBpeGVsUmF0aW8gPSBudWxsOwoKICAgIAkJLy8KCiAgICAJCWNvbnN0IGNhbWVyYUwgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKICAgIAkJY2FtZXJhTC52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgogICAgCQljb25zdCBjYW1lcmFSID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CiAgICAJCWNhbWVyYVIudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKICAgIAkJY29uc3QgY2FtZXJhcyA9IFsgY2FtZXJhTCwgY2FtZXJhUiBdOwoKICAgIAkJY29uc3QgY2FtZXJhWFIgPSBuZXcgQXJyYXlDYW1lcmEoKTsKCiAgICAJCWxldCBfY3VycmVudERlcHRoTmVhciA9IG51bGw7CiAgICAJCWxldCBfY3VycmVudERlcHRoRmFyID0gbnVsbDsKCiAgICAJCS8vCgogICAgCQkvKioKICAgIAkJICogV2hldGhlciB0aGUgbWFuYWdlcidzIFhSIGNhbWVyYSBzaG91bGQgYmUgYXV0b21hdGljYWxseSB1cGRhdGVkIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuY2FtZXJhQXV0b1VwZGF0ZSA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIG5vdGlmaWVzIHRoZSByZW5kZXJlciB0byBiZSByZWFkeSBmb3IgWFIgcmVuZGVyaW5nLiBTZXQgaXQgdG8gYHRydWVgCiAgICAJCSAqIGlmIHlvdSBhcmUgZ29pbmcgdG8gdXNlIFhSIGluIHlvdXIgYXBwLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJLyoqCiAgICAJCSAqIFdoZXRoZXIgWFIgcHJlc2VudGF0aW9uIGlzIGFjdGl2ZSBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgZmFsc2UKICAgIAkJICovCiAgICAJCXRoaXMuaXNQcmVzZW50aW5nID0gZmFsc2U7CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgYHRhcmdldCByYXlgIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgogICAgCQkgKiBVc2UgdGhpcyBzcGFjZSBmb3IgdmlzdWFsaXppbmcgM0Qgb2JqZWN0cyB0aGF0IHN1cHBvcnQgdGhlIHVzZXIgaW4gcG9pbnRpbmcKICAgIAkJICogdGFza3MgbGlrZSBVSSBpbnRlcmFjdGlvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgogICAgCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGB0YXJnZXQgcmF5YCBzcGFjZS4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0Q29udHJvbGxlciA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgogICAgCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCiAgICAJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKICAgIAkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBjb250cm9sbGVyLmdldFRhcmdldFJheVNwYWNlKCk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBncmlwYCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KICAgIAkJICogVXNlIHRoaXMgc3BhY2UgZm9yIHZpc3VhbGl6aW5nIDNEIG9iamVjdHMgdGhhdCBzdXBwb3J0IHRoZSB1c2VyIGluIHBvaW50aW5nCiAgICAJCSAqIHRhc2tzIGxpa2UgVUkgaW50ZXJhY3Rpb24uCiAgICAJCSAqCiAgICAJCSAqIE5vdGU6IElmIHlvdSB3YW50IHRvIHNob3cgc29tZXRoaW5nIGluIHRoZSB1c2VyJ3MgaGFuZCBBTkQgb2ZmZXIgYQogICAgCQkgKiBwb2ludGluZyByYXkgYXQgdGhlIHNhbWUgdGltZSwgeW91J2xsIHdhbnQgdG8gYXR0YWNoZWQgdGhlIGhhbmRoZWxkIG9iamVjdAogICAgCQkgKiB0byB0aGUgZ3JvdXAgcmV0dXJuZWQgYnkgYGdldENvbnRyb2xsZXJHcmlwKClgIGFuZCB0aGUgcmF5IHRvIHRoZQogICAgCQkgKiBncm91cCByZXR1cm5lZCBieSBgZ2V0Q29udHJvbGxlcigpYC4gVGhlIGlkZWEgaXMgdG8gaGF2ZSB0d28KICAgIAkJICogZGlmZmVyZW50IGdyb3VwcyBpbiB0d28gZGlmZmVyZW50IGNvb3JkaW5hdGUgc3BhY2VzIGZvciB0aGUgc2FtZSBXZWJYUgogICAgCQkgKiBjb250cm9sbGVyLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggb2YgdGhlIGNvbnRyb2xsZXIuCiAgICAJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgYGdyaXBgIHNwYWNlLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDb250cm9sbGVyR3JpcCA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgogICAgCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCiAgICAJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKICAgIAkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBjb250cm9sbGVyLmdldEdyaXBTcGFjZSgpOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgaGFuZGAgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCiAgICAJCSAqIFVzZSB0aGlzIHNwYWNlIGZvciB2aXN1YWxpemluZyAzRCBvYmplY3RzIHRoYXQgc3VwcG9ydCB0aGUgdXNlciBpbiBwb2ludGluZwogICAgCQkgKiB0YXNrcyBsaWtlIFVJIGludGVyYWN0aW9uLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggb2YgdGhlIGNvbnRyb2xsZXIuCiAgICAJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgYGhhbmRgIHNwYWNlLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRIYW5kID0gZnVuY3Rpb24gKCBpbmRleCApIHsKCiAgICAJCQlsZXQgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzWyBpbmRleCBdOwoKICAgIAkJCWlmICggY29udHJvbGxlciA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljb250cm9sbGVyID0gbmV3IFdlYlhSQ29udHJvbGxlcigpOwogICAgCQkJCWNvbnRyb2xsZXJzWyBpbmRleCBdID0gY29udHJvbGxlcjsKCiAgICAJCQl9CgogICAgCQkJcmV0dXJuIGNvbnRyb2xsZXIuZ2V0SGFuZFNwYWNlKCk7CgogICAgCQl9OwoKICAgIAkJLy8KCiAgICAJCWZ1bmN0aW9uIG9uU2Vzc2lvbkV2ZW50KCBldmVudCApIHsKCiAgICAJCQljb25zdCBjb250cm9sbGVySW5kZXggPSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmluZGV4T2YoIGV2ZW50LmlucHV0U291cmNlICk7CgogICAgCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0xICkgewoKICAgIAkJCQlyZXR1cm47CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgY29udHJvbGxlckluZGV4IF07CgogICAgCQkJaWYgKCBjb250cm9sbGVyICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWNvbnRyb2xsZXIudXBkYXRlKCBldmVudC5pbnB1dFNvdXJjZSwgZXZlbnQuZnJhbWUsIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CiAgICAJCQkJY29udHJvbGxlci5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6IGV2ZW50LnR5cGUsIGRhdGE6IGV2ZW50LmlucHV0U291cmNlIH0gKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBvblNlc3Npb25FbmQoKSB7CgogICAgCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc2VsZWN0Jywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdHN0YXJ0Jywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdGVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzcXVlZXplJywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzcXVlZXplZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZCApOwogICAgCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnaW5wdXRzb3VyY2VzY2hhbmdlJywgb25JbnB1dFNvdXJjZXNDaGFuZ2UgKTsKCiAgICAJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCWNvbnN0IGlucHV0U291cmNlID0gY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdOwoKICAgIAkJCQlpZiAoIGlucHV0U291cmNlID09PSBudWxsICkgY29udGludWU7CgogICAgCQkJCWNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXSA9IG51bGw7CgogICAgCQkJCWNvbnRyb2xsZXJzWyBpIF0uZGlzY29ubmVjdCggaW5wdXRTb3VyY2UgKTsKCiAgICAJCQl9CgogICAgCQkJX2N1cnJlbnREZXB0aE5lYXIgPSBudWxsOwogICAgCQkJX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CgogICAgCQkJZGVwdGhTZW5zaW5nLnJlc2V0KCk7CgogICAgCQkJLy8gcmVzdG9yZSBmcmFtZWJ1ZmZlci9yZW5kZXJpbmcgc3RhdGUKCiAgICAJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGluaXRpYWxSZW5kZXJUYXJnZXQgKTsKCiAgICAJCQlnbEJhc2VMYXllciA9IG51bGw7CiAgICAJCQlnbFByb2pMYXllciA9IG51bGw7CiAgICAJCQlnbEJpbmRpbmcgPSBudWxsOwogICAgCQkJc2Vzc2lvbiA9IG51bGw7CiAgICAJCQluZXdSZW5kZXJUYXJnZXQgPSBudWxsOwoKICAgIAkJCS8vCgogICAgCQkJYW5pbWF0aW9uLnN0b3AoKTsKCiAgICAJCQlzY29wZS5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKCiAgICAJCQlyZW5kZXJlci5zZXRQaXhlbFJhdGlvKCBjdXJyZW50UGl4ZWxSYXRpbyApOwogICAgCQkJcmVuZGVyZXIuc2V0U2l6ZSggY3VycmVudFNpemUud2lkdGgsIGN1cnJlbnRTaXplLmhlaWdodCwgZmFsc2UgKTsKCiAgICAJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZXNzaW9uZW5kJyB9ICk7CgogICAgCQl9CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgZnJhbWVidWZmZXIgc2NhbGUgZmFjdG9yLgogICAgCQkgKgogICAgCQkgKiBUaGlzIG1ldGhvZCBjYW4gbm90IGJlIHVzZWQgZHVyaW5nIGEgWFIgc2Vzc2lvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIGZyYW1lYnVmZmVyIHNjYWxlIGZhY3Rvci4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0RnJhbWVidWZmZXJTY2FsZUZhY3RvciA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgogICAgCQkJZnJhbWVidWZmZXJTY2FsZUZhY3RvciA9IHZhbHVlOwoKICAgIAkJCWlmICggc2NvcGUuaXNQcmVzZW50aW5nID09PSB0cnVlICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJYUk1hbmFnZXI6IENhbm5vdCBjaGFuZ2UgZnJhbWVidWZmZXIgc2NhbGUgd2hpbGUgcHJlc2VudGluZy4nICk7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSByZWZlcmVuY2Ugc3BhY2UgdHlwZS4gQ2FuIGJlIHVzZWQgdG8gY29uZmlndXJlIGEgc3BhdGlhbCByZWxhdGlvbnNoaXAgd2l0aCB0aGUgdXNlcidzIHBoeXNpY2FsCiAgICAJCSAqIGVudmlyb25tZW50LiBEZXBlbmRpbmcgb24gaG93IHRoZSB1c2VyIG1vdmVzIGluIDNEIHNwYWNlLCBzZXR0aW5nIGFuIGFwcHJvcHJpYXRlIHJlZmVyZW5jZSBzcGFjZSBjYW4KICAgIAkJICogaW1wcm92ZSB0cmFja2luZy4gRGVmYXVsdCBpcyBgbG9jYWwtZmxvb3JgLiBWYWxpZCB2YWx1ZXMgY2FuIGJlIGZvdW5kIGhlcmUKICAgIAkJICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hSUmVmZXJlbmNlU3BhY2UjcmVmZXJlbmNlX3NwYWNlX3R5cGVzLgogICAgCQkgKgogICAgCQkgKiBUaGlzIG1ldGhvZCBjYW4gbm90IGJlIHVzZWQgZHVyaW5nIGEgWFIgc2Vzc2lvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIHJlZmVyZW5jZSBzcGFjZSB0eXBlLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRSZWZlcmVuY2VTcGFjZVR5cGUgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKICAgIAkJCXJlZmVyZW5jZVNwYWNlVHlwZSA9IHZhbHVlOwoKICAgIAkJCWlmICggc2NvcGUuaXNQcmVzZW50aW5nID09PSB0cnVlICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJYUk1hbmFnZXI6IENhbm5vdCBjaGFuZ2UgcmVmZXJlbmNlIHNwYWNlIHR5cGUgd2hpbGUgcHJlc2VudGluZy4nICk7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBYUiByZWZlcmVuY2Ugc3BhY2UuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge1hSUmVmZXJlbmNlU3BhY2V9IFRoZSBYUiByZWZlcmVuY2Ugc3BhY2UuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldFJlZmVyZW5jZVNwYWNlID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyBhIGN1c3RvbSBYUiByZWZlcmVuY2Ugc3BhY2UuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7WFJSZWZlcmVuY2VTcGFjZX0gc3BhY2UgLSBUaGUgWFIgcmVmZXJlbmNlIHNwYWNlLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRSZWZlcmVuY2VTcGFjZSA9IGZ1bmN0aW9uICggc3BhY2UgKSB7CgogICAgCQkJY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBzcGFjZTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgY3VycmVudCBiYXNlIGxheWVyLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHs/KFhSV2ViR0xMYXllcnxYUlByb2plY3Rpb25MYXllcil9IFRoZSBYUiBiYXNlIGxheWVyLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRCYXNlTGF5ZXIgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGdsUHJvakxheWVyICE9PSBudWxsID8gZ2xQcm9qTGF5ZXIgOiBnbEJhc2VMYXllcjsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgY3VycmVudCBYUiBiaW5kaW5nLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHs/WFJXZWJHTEJpbmRpbmd9IFRoZSBYUiBiaW5kaW5nLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRCaW5kaW5nID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBnbEJpbmRpbmc7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgWFIgZnJhbWUuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4gez9YUkZyYW1lfSBUaGUgWFIgZnJhbWUuIFJldHVybnMgYG51bGxgIHdoZW4gdXNlZCBvdXRzaWRlIGEgWFIgc2Vzc2lvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0RnJhbWUgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIHhyRnJhbWU7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgWFIgc2Vzc2lvbi4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7P1hSU2Vzc2lvbn0gVGhlIFhSIHNlc3Npb24uIFJldHVybnMgYG51bGxgIHdoZW4gdXNlZCBvdXRzaWRlIGEgWFIgc2Vzc2lvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0U2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gc2Vzc2lvbjsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogQWZ0ZXIgYSBYUiBzZXNzaW9uIGhhcyBiZWVuIHJlcXVlc3RlZCB1c3VhbGx5IHdpdGggb25lIG9mIHRoZSBgKkJ1dHRvbmAgbW9kdWxlcywgaXQKICAgIAkJICogaXMgaW5qZWN0ZWQgaW50byB0aGUgcmVuZGVyZXIgd2l0aCB0aGlzIG1ldGhvZC4gVGhpcyBtZXRob2QgdHJpZ2dlcnMgdGhlIHN0YXJ0IG9mCiAgICAJCSAqIHRoZSBhY3R1YWwgWFIgcmVuZGVyaW5nLgogICAgCQkgKgogICAgCQkgKiBAYXN5bmMKICAgIAkJICogQHBhcmFtIHtYUlNlc3Npb259IHZhbHVlIC0gVGhlIFhSIHNlc3Npb24gdG8gc2V0LgogICAgCQkgKiBAcmV0dXJuIHtQcm9taXNlfSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBzZXNzaW9uIGhhcyBiZWVuIHNldC4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0U2Vzc2lvbiA9IGFzeW5jIGZ1bmN0aW9uICggdmFsdWUgKSB7CgogICAgCQkJc2Vzc2lvbiA9IHZhbHVlOwoKICAgIAkJCWlmICggc2Vzc2lvbiAhPT0gbnVsbCApIHsKCiAgICAJCQkJaW5pdGlhbFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKICAgIAkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3QnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NlbGVjdHN0YXJ0Jywgb25TZXNzaW9uRXZlbnQgKTsKICAgIAkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3RlbmQnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemUnLCBvblNlc3Npb25FdmVudCApOwogICAgCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZWVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CiAgICAJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnZW5kJywgb25TZXNzaW9uRW5kICk7CiAgICAJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnaW5wdXRzb3VyY2VzY2hhbmdlJywgb25JbnB1dFNvdXJjZXNDaGFuZ2UgKTsKCiAgICAJCQkJaWYgKCBhdHRyaWJ1dGVzLnhyQ29tcGF0aWJsZSAhPT0gdHJ1ZSApIHsKCiAgICAJCQkJCWF3YWl0IGdsLm1ha2VYUkNvbXBhdGlibGUoKTsKCiAgICAJCQkJfQoKICAgIAkJCQljdXJyZW50UGl4ZWxSYXRpbyA9IHJlbmRlcmVyLmdldFBpeGVsUmF0aW8oKTsKICAgIAkJCQlyZW5kZXJlci5nZXRTaXplKCBjdXJyZW50U2l6ZSApOwoKICAgIAkJCQkvLyBDaGVjayB0aGF0IHRoZSBicm93c2VyIGltcGxlbWVudHMgdGhlIG5lY2Vzc2FyeSBBUElzIHRvIHVzZSBhbgogICAgCQkJCS8vIFhSUHJvamVjdGlvbkxheWVyIHJhdGhlciB0aGFuIGFuIFhSV2ViR0xMYXllcgogICAgCQkJCWNvbnN0IHVzZUxheWVycyA9IHR5cGVvZiBYUldlYkdMQmluZGluZyAhPT0gJ3VuZGVmaW5lZCcgJiYgJ2NyZWF0ZVByb2plY3Rpb25MYXllcicgaW4gWFJXZWJHTEJpbmRpbmcucHJvdG90eXBlOwoKICAgIAkJCQlpZiAoICEgdXNlTGF5ZXJzICkgewoKICAgIAkJCQkJY29uc3QgbGF5ZXJJbml0ID0gewogICAgCQkJCQkJYW50aWFsaWFzOiBhdHRyaWJ1dGVzLmFudGlhbGlhcywKICAgIAkJCQkJCWFscGhhOiB0cnVlLAogICAgCQkJCQkJZGVwdGg6IGF0dHJpYnV0ZXMuZGVwdGgsCiAgICAJCQkJCQlzdGVuY2lsOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCiAgICAJCQkJCQlmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yOiBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yCiAgICAJCQkJCX07CgogICAgCQkJCQlnbEJhc2VMYXllciA9IG5ldyBYUldlYkdMTGF5ZXIoIHNlc3Npb24sIGdsLCBsYXllckluaXQgKTsKCiAgICAJCQkJCXNlc3Npb24udXBkYXRlUmVuZGVyU3RhdGUoIHsgYmFzZUxheWVyOiBnbEJhc2VMYXllciB9ICk7CgogICAgCQkJCQlyZW5kZXJlci5zZXRQaXhlbFJhdGlvKCAxICk7CiAgICAJCQkJCXJlbmRlcmVyLnNldFNpemUoIGdsQmFzZUxheWVyLmZyYW1lYnVmZmVyV2lkdGgsIGdsQmFzZUxheWVyLmZyYW1lYnVmZmVySGVpZ2h0LCBmYWxzZSApOwoKICAgIAkJCQkJbmV3UmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KAogICAgCQkJCQkJZ2xCYXNlTGF5ZXIuZnJhbWVidWZmZXJXaWR0aCwKICAgIAkJCQkJCWdsQmFzZUxheWVyLmZyYW1lYnVmZmVySGVpZ2h0LAogICAgCQkJCQkJewogICAgCQkJCQkJCWZvcm1hdDogUkdCQUZvcm1hdCwKICAgIAkJCQkJCQl0eXBlOiBVbnNpZ25lZEJ5dGVUeXBlLAogICAgCQkJCQkJCWNvbG9yU3BhY2U6IHJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2UsCiAgICAJCQkJCQkJc3RlbmNpbEJ1ZmZlcjogYXR0cmlidXRlcy5zdGVuY2lsLAogICAgCQkJCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogKCBnbEJhc2VMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKSwKICAgIAkJCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogKCBnbEJhc2VMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKQoKICAgIAkJCQkJCX0KICAgIAkJCQkJKTsKCiAgICAJCQkJfSBlbHNlIHsKCiAgICAJCQkJCWxldCBkZXB0aEZvcm1hdCA9IG51bGw7CiAgICAJCQkJCWxldCBkZXB0aFR5cGUgPSBudWxsOwogICAgCQkJCQlsZXQgZ2xEZXB0aEZvcm1hdCA9IG51bGw7CgogICAgCQkJCQlpZiAoIGF0dHJpYnV0ZXMuZGVwdGggKSB7CgogICAgCQkJCQkJZ2xEZXB0aEZvcm1hdCA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IGdsLkRFUFRIMjRfU1RFTkNJTDggOiBnbC5ERVBUSF9DT01QT05FTlQyNDsKICAgIAkJCQkJCWRlcHRoRm9ybWF0ID0gYXR0cmlidXRlcy5zdGVuY2lsID8gRGVwdGhTdGVuY2lsRm9ybWF0IDogRGVwdGhGb3JtYXQ7CiAgICAJCQkJCQlkZXB0aFR5cGUgPSBhdHRyaWJ1dGVzLnN0ZW5jaWwgPyBVbnNpZ25lZEludDI0OFR5cGUgOiBVbnNpZ25lZEludFR5cGU7CgogICAgCQkJCQl9CgogICAgCQkJCQljb25zdCBwcm9qZWN0aW9ubGF5ZXJJbml0ID0gewogICAgCQkJCQkJY29sb3JGb3JtYXQ6IGdsLlJHQkE4LAogICAgCQkJCQkJZGVwdGhGb3JtYXQ6IGdsRGVwdGhGb3JtYXQsCiAgICAJCQkJCQlzY2FsZUZhY3RvcjogZnJhbWVidWZmZXJTY2FsZUZhY3RvcgogICAgCQkJCQl9OwoKICAgIAkJCQkJZ2xCaW5kaW5nID0gbmV3IFhSV2ViR0xCaW5kaW5nKCBzZXNzaW9uLCBnbCApOwoKICAgIAkJCQkJZ2xQcm9qTGF5ZXIgPSBnbEJpbmRpbmcuY3JlYXRlUHJvamVjdGlvbkxheWVyKCBwcm9qZWN0aW9ubGF5ZXJJbml0ICk7CgogICAgCQkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7IGxheWVyczogWyBnbFByb2pMYXllciBdIH0gKTsKCiAgICAJCQkJCXJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIDEgKTsKICAgIAkJCQkJcmVuZGVyZXIuc2V0U2l6ZSggZ2xQcm9qTGF5ZXIudGV4dHVyZVdpZHRoLCBnbFByb2pMYXllci50ZXh0dXJlSGVpZ2h0LCBmYWxzZSApOwoKICAgIAkJCQkJbmV3UmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KAogICAgCQkJCQkJZ2xQcm9qTGF5ZXIudGV4dHVyZVdpZHRoLAogICAgCQkJCQkJZ2xQcm9qTGF5ZXIudGV4dHVyZUhlaWdodCwKICAgIAkJCQkJCXsKICAgIAkJCQkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCiAgICAJCQkJCQkJdHlwZTogVW5zaWduZWRCeXRlVHlwZSwKICAgIAkJCQkJCQlkZXB0aFRleHR1cmU6IG5ldyBEZXB0aFRleHR1cmUoIGdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwgZ2xQcm9qTGF5ZXIudGV4dHVyZUhlaWdodCwgZGVwdGhUeXBlLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBkZXB0aEZvcm1hdCApLAogICAgCQkJCQkJCXN0ZW5jaWxCdWZmZXI6IGF0dHJpYnV0ZXMuc3RlbmNpbCwKICAgIAkJCQkJCQljb2xvclNwYWNlOiByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlLAogICAgCQkJCQkJCXNhbXBsZXM6IGF0dHJpYnV0ZXMuYW50aWFsaWFzID8gNCA6IDAsCiAgICAJCQkJCQkJcmVzb2x2ZURlcHRoQnVmZmVyOiAoIGdsUHJvakxheWVyLmlnbm9yZURlcHRoVmFsdWVzID09PSBmYWxzZSApLAogICAgCQkJCQkJCXJlc29sdmVTdGVuY2lsQnVmZmVyOiAoIGdsUHJvakxheWVyLmlnbm9yZURlcHRoVmFsdWVzID09PSBmYWxzZSApCiAgICAJCQkJCQl9ICk7CgogICAgCQkJCX0KCiAgICAJCQkJbmV3UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPSB0cnVlOyAvLyBUT0RPIFJlbW92ZSB0aGlzIHdoZW4gcG9zc2libGUsIHNlZSAjMjMyNzgKCiAgICAJCQkJdGhpcy5zZXRGb3ZlYXRpb24oIGZvdmVhdGlvbiApOwoKICAgIAkJCQljdXN0b21SZWZlcmVuY2VTcGFjZSA9IG51bGw7CiAgICAJCQkJcmVmZXJlbmNlU3BhY2UgPSBhd2FpdCBzZXNzaW9uLnJlcXVlc3RSZWZlcmVuY2VTcGFjZSggcmVmZXJlbmNlU3BhY2VUeXBlICk7CgogICAgCQkJCWFuaW1hdGlvbi5zZXRDb250ZXh0KCBzZXNzaW9uICk7CiAgICAJCQkJYW5pbWF0aW9uLnN0YXJ0KCk7CgogICAgCQkJCXNjb3BlLmlzUHJlc2VudGluZyA9IHRydWU7CgogICAgCQkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ3Nlc3Npb25zdGFydCcgfSApOwoKICAgIAkJCX0KCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgZW52aXJvbm1lbnQgYmxlbmQgbW9kZSBmcm9tIHRoZSBjdXJyZW50IFhSIHNlc3Npb24uCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4geydvcGFxdWUnfCdhZGRpdGl2ZSd8J2FscGhhLWJsZW5kJ3x1bmRlZmluZWR9IFRoZSBlbnZpcm9ubWVudCBibGVuZCBtb2RlLiBSZXR1cm5zIGB1bmRlZmluZWRgIHdoZW4gdXNlZCBvdXRzaWRlIG9mIGEgWFIgc2Vzc2lvbi4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0RW52aXJvbm1lbnRCbGVuZE1vZGUgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJaWYgKCBzZXNzaW9uICE9PSBudWxsICkgewoKICAgIAkJCQlyZXR1cm4gc2Vzc2lvbi5lbnZpcm9ubWVudEJsZW5kTW9kZTsKCiAgICAJCQl9CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgZGVwdGggdGV4dHVyZSBjb21wdXRlZCB2aWEgZGVwdGggc2Vuc2luZy4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7P1RleHR1cmV9IFRoZSBkZXB0aCB0ZXh0dXJlLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXREZXB0aFRleHR1cmUgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy5nZXREZXB0aFRleHR1cmUoKTsKCiAgICAJCX07CgogICAgCQlmdW5jdGlvbiBvbklucHV0U291cmNlc0NoYW5nZSggZXZlbnQgKSB7CgogICAgCQkJLy8gTm90aWZ5IGRpc2Nvbm5lY3RlZAoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGV2ZW50LnJlbW92ZWQubGVuZ3RoOyBpICsrICkgewoKICAgIAkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGV2ZW50LnJlbW92ZWRbIGkgXTsKICAgIAkJCQljb25zdCBpbmRleCA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMuaW5kZXhPZiggaW5wdXRTb3VyY2UgKTsKCiAgICAJCQkJaWYgKCBpbmRleCA+PSAwICkgewoKICAgIAkJCQkJY29udHJvbGxlcklucHV0U291cmNlc1sgaW5kZXggXSA9IG51bGw7CiAgICAJCQkJCWNvbnRyb2xsZXJzWyBpbmRleCBdLmRpc2Nvbm5lY3QoIGlucHV0U291cmNlICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJLy8gTm90aWZ5IGNvbm5lY3RlZAoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGV2ZW50LmFkZGVkLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBldmVudC5hZGRlZFsgaSBdOwoKICAgIAkJCQlsZXQgY29udHJvbGxlckluZGV4ID0gY29udHJvbGxlcklucHV0U291cmNlcy5pbmRleE9mKCBpbnB1dFNvdXJjZSApOwoKICAgIAkJCQlpZiAoIGNvbnRyb2xsZXJJbmRleCA9PT0gLTEgKSB7CgogICAgCQkJCQkvLyBBc3NpZ24gaW5wdXQgc291cmNlIGEgY29udHJvbGxlciB0aGF0IGN1cnJlbnRseSBoYXMgbm8gaW5wdXQgc291cmNlCgogICAgCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCQkJaWYgKCBpID49IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMubGVuZ3RoICkgewoKICAgIAkJCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzLnB1c2goIGlucHV0U291cmNlICk7CiAgICAJCQkJCQkJY29udHJvbGxlckluZGV4ID0gaTsKICAgIAkJCQkJCQlicmVhazsKCiAgICAJCQkJCQl9IGVsc2UgaWYgKCBjb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPT09IG51bGwgKSB7CgogICAgCQkJCQkJCWNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXSA9IGlucHV0U291cmNlOwogICAgCQkJCQkJCWNvbnRyb2xsZXJJbmRleCA9IGk7CiAgICAJCQkJCQkJYnJlYWs7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQkJLy8gSWYgYWxsIGNvbnRyb2xsZXJzIGRvIGN1cnJlbnRseSByZWNlaXZlIGlucHV0IHdlIGlnbm9yZSBuZXcgb25lcwoKICAgIAkJCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0xICkgYnJlYWs7CgogICAgCQkJCX0KCiAgICAJCQkJY29uc3QgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzWyBjb250cm9sbGVySW5kZXggXTsKCiAgICAJCQkJaWYgKCBjb250cm9sbGVyICkgewoKICAgIAkJCQkJY29udHJvbGxlci5jb25uZWN0KCBpbnB1dFNvdXJjZSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8KCiAgICAJCWNvbnN0IGNhbWVyYUxQb3MgPSBuZXcgVmVjdG9yMygpOwogICAgCQljb25zdCBjYW1lcmFSUG9zID0gbmV3IFZlY3RvcjMoKTsKCiAgICAJCS8qKgogICAgCQkgKiBBc3N1bWVzIDIgY2FtZXJhcyB0aGF0IGFyZSBwYXJhbGxlbCBhbmQgc2hhcmUgYW4gWC1heGlzLCBhbmQgdGhhdAogICAgCQkgKiB0aGUgY2FtZXJhcycgcHJvamVjdGlvbiBhbmQgd29ybGQgbWF0cmljZXMgaGF2ZSBhbHJlYWR5IGJlZW4gc2V0LgogICAgCQkgKiBBbmQgdGhhdCBuZWFyIGFuZCBmYXIgcGxhbmVzIGFyZSBpZGVudGljYWwgZm9yIGJvdGggY2FtZXJhcy4KICAgIAkJICogVmlzdWFsaXphdGlvbiBvZiB0aGlzIHRlY2huaXF1ZTogaHR0cHM6Ly9jb21wdXRlcmdyYXBoaWNzLnN0YWNrZXhjaGFuZ2UuY29tL2EvNDc2NQogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge0FycmF5Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhIHRvIHVwZGF0ZS4KICAgIAkJICogQHBhcmFtIHtQZXJzcGVjdGl2ZUNhbWVyYX0gY2FtZXJhTCAtIFRoZSBsZWZ0IGNhbWVyYS4KICAgIAkJICogQHBhcmFtIHtQZXJzcGVjdGl2ZUNhbWVyYX0gY2FtZXJhUiAtIFRoZSByaWdodCBjYW1lcmEuCiAgICAJCSAqLwogICAgCQlmdW5jdGlvbiBzZXRQcm9qZWN0aW9uRnJvbVVuaW9uKCBjYW1lcmEsIGNhbWVyYUwsIGNhbWVyYVIgKSB7CgogICAgCQkJY2FtZXJhTFBvcy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGNhbWVyYUwubWF0cml4V29ybGQgKTsKICAgIAkJCWNhbWVyYVJQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmFSLm1hdHJpeFdvcmxkICk7CgogICAgCQkJY29uc3QgaXBkID0gY2FtZXJhTFBvcy5kaXN0YW5jZVRvKCBjYW1lcmFSUG9zICk7CgogICAgCQkJY29uc3QgcHJvakwgPSBjYW1lcmFMLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CiAgICAJCQljb25zdCBwcm9qUiA9IGNhbWVyYVIucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50czsKCiAgICAJCQkvLyBWUiBzeXN0ZW1zIHdpbGwgaGF2ZSBpZGVudGljYWwgZmFyIGFuZCBuZWFyIHBsYW5lcywgYW5kCiAgICAJCQkvLyBtb3N0IGxpa2VseSBpZGVudGljYWwgdG9wIGFuZCBib3R0b20gZnJ1c3R1bSBleHRlbnRzLgogICAgCQkJLy8gVXNlIHRoZSBsZWZ0IGNhbWVyYSBmb3IgdGhlc2UgdmFsdWVzLgogICAgCQkJY29uc3QgbmVhciA9IHByb2pMWyAxNCBdIC8gKCBwcm9qTFsgMTAgXSAtIDEgKTsKICAgIAkJCWNvbnN0IGZhciA9IHByb2pMWyAxNCBdIC8gKCBwcm9qTFsgMTAgXSArIDEgKTsKICAgIAkJCWNvbnN0IHRvcEZvdiA9ICggcHJvakxbIDkgXSArIDEgKSAvIHByb2pMWyA1IF07CiAgICAJCQljb25zdCBib3R0b21Gb3YgPSAoIHByb2pMWyA5IF0gLSAxICkgLyBwcm9qTFsgNSBdOwoKICAgIAkJCWNvbnN0IGxlZnRGb3YgPSAoIHByb2pMWyA4IF0gLSAxICkgLyBwcm9qTFsgMCBdOwogICAgCQkJY29uc3QgcmlnaHRGb3YgPSAoIHByb2pSWyA4IF0gKyAxICkgLyBwcm9qUlsgMCBdOwogICAgCQkJY29uc3QgbGVmdCA9IG5lYXIgKiBsZWZ0Rm92OwogICAgCQkJY29uc3QgcmlnaHQgPSBuZWFyICogcmlnaHRGb3Y7CgogICAgCQkJLy8gQ2FsY3VsYXRlIHRoZSBuZXcgY2FtZXJhJ3MgcG9zaXRpb24gb2Zmc2V0IGZyb20gdGhlCiAgICAJCQkvLyBsZWZ0IGNhbWVyYS4geE9mZnNldCBzaG91bGQgYmUgcm91Z2hseSBoYWxmIGBpcGRgLgogICAgCQkJY29uc3Qgek9mZnNldCA9IGlwZCAvICggLSBsZWZ0Rm92ICsgcmlnaHRGb3YgKTsKICAgIAkJCWNvbnN0IHhPZmZzZXQgPSB6T2Zmc2V0ICogLSBsZWZ0Rm92OwoKICAgIAkJCS8vIFRPRE86IEJldHRlciB3YXkgdG8gYXBwbHkgdGhpcyBvZmZzZXQ/CiAgICAJCQljYW1lcmFMLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CiAgICAJCQljYW1lcmEudHJhbnNsYXRlWCggeE9mZnNldCApOwogICAgCQkJY2FtZXJhLnRyYW5zbGF0ZVooIHpPZmZzZXQgKTsKICAgIAkJCWNhbWVyYS5tYXRyaXhXb3JsZC5jb21wb3NlKCBjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUgKTsKICAgIAkJCWNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UuY29weSggY2FtZXJhLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgogICAgCQkJLy8gQ2hlY2sgaWYgdGhlIHByb2plY3Rpb24gdXNlcyBhbiBpbmZpbml0ZSBmYXIgcGxhbmUuCiAgICAJCQlpZiAoIHByb2pMWyAxMCBdID09PSAtMSApIHsKCiAgICAJCQkJLy8gVXNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCBmcm9tIHRoZSBsZWZ0IGV5ZS4KICAgIAkJCQkvLyBUaGUgY2FtZXJhIG9mZnNldCBpcyBzdWZmaWNpZW50IHRvIGluY2x1ZGUgdGhlIHZpZXcgdm9sdW1lcwogICAgCQkJCS8vIG9mIGJvdGggZXllcyAoYXNzdW1pbmcgc3ltbWV0cmljIHByb2plY3Rpb25zKS4KICAgIAkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5jb3B5KCBjYW1lcmFMLnByb2plY3Rpb25NYXRyaXggKTsKICAgIAkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCS8vIEZpbmQgdGhlIHVuaW9uIG9mIHRoZSBmcnVzdHVtIHZhbHVlcyBvZiB0aGUgY2FtZXJhcyBhbmQgc2NhbGUKICAgIAkJCQkvLyB0aGUgdmFsdWVzIHNvIHRoYXQgdGhlIG5lYXIgcGxhbmUncyBwb3NpdGlvbiBkb2VzIG5vdCBjaGFuZ2UgaW4gd29ybGQgc3BhY2UsCiAgICAJCQkJLy8gYWx0aG91Z2ggbXVzdCBub3cgYmUgcmVsYXRpdmUgdG8gdGhlIG5ldyB1bmlvbiBjYW1lcmEuCiAgICAJCQkJY29uc3QgbmVhcjIgPSBuZWFyICsgek9mZnNldDsKICAgIAkJCQljb25zdCBmYXIyID0gZmFyICsgek9mZnNldDsKICAgIAkJCQljb25zdCBsZWZ0MiA9IGxlZnQgLSB4T2Zmc2V0OwogICAgCQkJCWNvbnN0IHJpZ2h0MiA9IHJpZ2h0ICsgKCBpcGQgLSB4T2Zmc2V0ICk7CiAgICAJCQkJY29uc3QgdG9wMiA9IHRvcEZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKICAgIAkJCQljb25zdCBib3R0b20yID0gYm90dG9tRm92ICogZmFyIC8gZmFyMiAqIG5lYXIyOwoKICAgIAkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5tYWtlUGVyc3BlY3RpdmUoIGxlZnQyLCByaWdodDIsIHRvcDIsIGJvdHRvbTIsIG5lYXIyLCBmYXIyICk7CiAgICAJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICkuaW52ZXJ0KCk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gdXBkYXRlQ2FtZXJhKCBjYW1lcmEsIHBhcmVudCApIHsKCiAgICAJCQlpZiAoIHBhcmVudCA9PT0gbnVsbCApIHsKCiAgICAJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLmNvcHkoIGNhbWVyYS5tYXRyaXggKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljYW1lcmEubWF0cml4V29ybGQubXVsdGlwbHlNYXRyaWNlcyggcGFyZW50Lm1hdHJpeFdvcmxkLCBjYW1lcmEubWF0cml4ICk7CgogICAgCQkJfQoKICAgIAkJCWNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UuY29weSggY2FtZXJhLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgogICAgCQl9CgogICAgCQkvKioKICAgIAkJICogVXBkYXRlcyB0aGUgc3RhdGUgb2YgdGhlIFhSIGNhbWVyYS4gVXNlIHRoaXMgbWV0aG9kIG9uIGFwcCBsZXZlbCBpZiB5b3UKICAgIAkJICogc2V0IGNhbWVyYUF1dG9VcGRhdGVgIHRvIGBmYWxzZWAuIFRoZSBtZXRob2QgcmVxdWlyZXMgdGhlIG5vbi1YUgogICAgCQkgKiBjYW1lcmEgb2YgdGhlIHNjZW5lIGFzIGEgcGFyYW1ldGVyLiBUaGUgcGFzc2VkIGluIGNhbWVyYSdzIHRyYW5zZm9ybWF0aW9uCiAgICAJCSAqIGlzIGF1dG9tYXRpY2FsbHkgYWRqdXN0ZWQgdG8gdGhlIHBvc2l0aW9uIG9mIHRoZSBYUiBjYW1lcmEgd2hlbiBjYWxsaW5nCiAgICAJCSAqIHRoaXMgbWV0aG9kLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KICAgIAkJICovCiAgICAJCXRoaXMudXBkYXRlQ2FtZXJhID0gZnVuY3Rpb24gKCBjYW1lcmEgKSB7CgogICAgCQkJaWYgKCBzZXNzaW9uID09PSBudWxsICkgcmV0dXJuOwoKICAgIAkJCWxldCBkZXB0aE5lYXIgPSBjYW1lcmEubmVhcjsKICAgIAkJCWxldCBkZXB0aEZhciA9IGNhbWVyYS5mYXI7CgogICAgCQkJaWYgKCBkZXB0aFNlbnNpbmcudGV4dHVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJaWYgKCBkZXB0aFNlbnNpbmcuZGVwdGhOZWFyID4gMCApIGRlcHRoTmVhciA9IGRlcHRoU2Vuc2luZy5kZXB0aE5lYXI7CiAgICAJCQkJaWYgKCBkZXB0aFNlbnNpbmcuZGVwdGhGYXIgPiAwICkgZGVwdGhGYXIgPSBkZXB0aFNlbnNpbmcuZGVwdGhGYXI7CgogICAgCQkJfQoKICAgIAkJCWNhbWVyYVhSLm5lYXIgPSBjYW1lcmFSLm5lYXIgPSBjYW1lcmFMLm5lYXIgPSBkZXB0aE5lYXI7CiAgICAJCQljYW1lcmFYUi5mYXIgPSBjYW1lcmFSLmZhciA9IGNhbWVyYUwuZmFyID0gZGVwdGhGYXI7CgogICAgCQkJaWYgKCBfY3VycmVudERlcHRoTmVhciAhPT0gY2FtZXJhWFIubmVhciB8fCBfY3VycmVudERlcHRoRmFyICE9PSBjYW1lcmFYUi5mYXIgKSB7CgogICAgCQkJCS8vIE5vdGUgdGhhdCB0aGUgbmV3IHJlbmRlclN0YXRlIHdvbid0IGFwcGx5IHVudGlsIHRoZSBuZXh0IGZyYW1lLiBTZWUgIzE4MzIwCgogICAgCQkJCXNlc3Npb24udXBkYXRlUmVuZGVyU3RhdGUoIHsKICAgIAkJCQkJZGVwdGhOZWFyOiBjYW1lcmFYUi5uZWFyLAogICAgCQkJCQlkZXB0aEZhcjogY2FtZXJhWFIuZmFyCiAgICAJCQkJfSApOwoKICAgIAkJCQlfY3VycmVudERlcHRoTmVhciA9IGNhbWVyYVhSLm5lYXI7CiAgICAJCQkJX2N1cnJlbnREZXB0aEZhciA9IGNhbWVyYVhSLmZhcjsKCiAgICAJCQl9CgogICAgCQkJY2FtZXJhTC5sYXllcnMubWFzayA9IGNhbWVyYS5sYXllcnMubWFzayB8IDBiMDEwOwogICAgCQkJY2FtZXJhUi5sYXllcnMubWFzayA9IGNhbWVyYS5sYXllcnMubWFzayB8IDBiMTAwOwogICAgCQkJY2FtZXJhWFIubGF5ZXJzLm1hc2sgPSBjYW1lcmFMLmxheWVycy5tYXNrIHwgY2FtZXJhUi5sYXllcnMubWFzazsKCiAgICAJCQljb25zdCBwYXJlbnQgPSBjYW1lcmEucGFyZW50OwogICAgCQkJY29uc3QgY2FtZXJhcyA9IGNhbWVyYVhSLmNhbWVyYXM7CgogICAgCQkJdXBkYXRlQ2FtZXJhKCBjYW1lcmFYUiwgcGFyZW50ICk7CgogICAgCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY2FtZXJhcy5sZW5ndGg7IGkgKysgKSB7CgogICAgCQkJCXVwZGF0ZUNhbWVyYSggY2FtZXJhc1sgaSBdLCBwYXJlbnQgKTsKCiAgICAJCQl9CgogICAgCQkJLy8gdXBkYXRlIHByb2plY3Rpb24gbWF0cml4IGZvciBwcm9wZXIgdmlldyBmcnVzdHVtIGN1bGxpbmcKCiAgICAJCQlpZiAoIGNhbWVyYXMubGVuZ3RoID09PSAyICkgewoKICAgIAkJCQlzZXRQcm9qZWN0aW9uRnJvbVVuaW9uKCBjYW1lcmFYUiwgY2FtZXJhTCwgY2FtZXJhUiApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCS8vIGFzc3VtZSBzaW5nbGUgY2FtZXJhIHNldHVwIChBUikKCiAgICAJCQkJY2FtZXJhWFIucHJvamVjdGlvbk1hdHJpeC5jb3B5KCBjYW1lcmFMLnByb2plY3Rpb25NYXRyaXggKTsKCiAgICAJCQl9CgogICAgCQkJLy8gdXBkYXRlIHVzZXIgY2FtZXJhIGFuZCBpdHMgY2hpbGRyZW4KCiAgICAJCQl1cGRhdGVVc2VyQ2FtZXJhKCBjYW1lcmEsIGNhbWVyYVhSLCBwYXJlbnQgKTsKCiAgICAJCX07CgogICAgCQlmdW5jdGlvbiB1cGRhdGVVc2VyQ2FtZXJhKCBjYW1lcmEsIGNhbWVyYVhSLCBwYXJlbnQgKSB7CgogICAgCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgogICAgCQkJCWNhbWVyYS5tYXRyaXguY29weSggY2FtZXJhWFIubWF0cml4V29ybGQgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljYW1lcmEubWF0cml4LmNvcHkoIHBhcmVudC5tYXRyaXhXb3JsZCApOwogICAgCQkJCWNhbWVyYS5tYXRyaXguaW52ZXJ0KCk7CiAgICAJCQkJY2FtZXJhLm1hdHJpeC5tdWx0aXBseSggY2FtZXJhWFIubWF0cml4V29ybGQgKTsKCiAgICAJCQl9CgogICAgCQkJY2FtZXJhLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwogICAgCQkJY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgogICAgCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhWFIucHJvamVjdGlvbk1hdHJpeCApOwogICAgCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgogICAgCQkJaWYgKCBjYW1lcmEuaXNQZXJzcGVjdGl2ZUNhbWVyYSApIHsKCiAgICAJCQkJY2FtZXJhLmZvdiA9IFJBRDJERUcgKiAyICogTWF0aC5hdGFuKCAxIC8gY2FtZXJhLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHNbIDUgXSApOwogICAgCQkJCWNhbWVyYS56b29tID0gMTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgQXJyYXlDYW1lcmF9IHdoaWNoIHJlcHJlc2VudHMgdGhlIFhSIGNhbWVyYQogICAgCQkgKiBvZiB0aGUgYWN0aXZlIFhSIHNlc3Npb24uIEZvciBlYWNoIHZpZXcgaXQgaG9sZHMgYSBzZXBhcmF0ZSBjYW1lcmEgb2JqZWN0LgogICAgCQkgKgogICAgCQkgKiBUaGUgY2FtZXJhJ3MgYGZvdmAgaXMgY3VycmVudGx5IG5vdCB1c2VkIGFuZCBkb2VzIG5vdCByZWZsZWN0IHRoZSBmb3Ygb2YKICAgIAkJICogdGhlIFhSIGNhbWVyYS4gSWYgeW91IG5lZWQgdGhlIGZvdiBvbiBhcHAgbGV2ZWwsIHlvdSBoYXZlIHRvIGNvbXB1dGUgaW4KICAgIAkJICogbWFudWFsbHkgZnJvbSB0aGUgWFIgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaWNlcy4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7QXJyYXlDYW1lcmF9IFRoZSBYUiBjYW1lcmEuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldENhbWVyYSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gY2FtZXJhWFI7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGFtb3VudCBvZiBmb3ZlYXRpb24gdXNlZCBieSB0aGUgWFIgY29tcG9zaXRvciBmb3IgdGhlIHByb2plY3Rpb24gbGF5ZXIuCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFtb3VudCBvZiBmb3ZlYXRpb24uCiAgICAJCSAqLwogICAgCQl0aGlzLmdldEZvdmVhdGlvbiA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlpZiAoIGdsUHJvakxheWVyID09PSBudWxsICYmIGdsQmFzZUxheWVyID09PSBudWxsICkgewoKICAgIAkJCQlyZXR1cm4gdW5kZWZpbmVkOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gZm92ZWF0aW9uOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSBmb3ZlYXRpb24gdmFsdWUuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIEEgbnVtYmVyIGluIHRoZSByYW5nZSBgWzAsMV1gIHdoZXJlIGAwYCBtZWFucyBubyBmb3ZlYXRpb24gKGZ1bGwgcmVzb2x1dGlvbikKICAgIAkJICogYW5kIGAxYCBtZWFucyBtYXhpbXVtIGZvdmVhdGlvbiAodGhlIGVkZ2VzIHJlbmRlciBhdCBsb3dlciByZXNvbHV0aW9uKS4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0Rm92ZWF0aW9uID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCiAgICAJCQkvLyAwID0gbm8gZm92ZWF0aW9uID0gZnVsbCByZXNvbHV0aW9uCiAgICAJCQkvLyAxID0gbWF4aW11bSBmb3ZlYXRpb24gPSB0aGUgZWRnZXMgcmVuZGVyIGF0IGxvd2VyIHJlc29sdXRpb24KCiAgICAJCQlmb3ZlYXRpb24gPSB2YWx1ZTsKCiAgICAJCQlpZiAoIGdsUHJvakxheWVyICE9PSBudWxsICkgewoKICAgIAkJCQlnbFByb2pMYXllci5maXhlZEZvdmVhdGlvbiA9IHZhbHVlOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICYmIGdsQmFzZUxheWVyLmZpeGVkRm92ZWF0aW9uICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCWdsQmFzZUxheWVyLmZpeGVkRm92ZWF0aW9uID0gdmFsdWU7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiBkZXB0aCBzZW5zaW5nIGlzIHN1cHBvcnRlZC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciBkZXB0aCBzZW5zaW5nIGlzIHN1cHBvcnRlZCBvciBub3QuCiAgICAJCSAqLwogICAgCQl0aGlzLmhhc0RlcHRoU2Vuc2luZyA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gZGVwdGhTZW5zaW5nLnRleHR1cmUgIT09IG51bGw7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGRlcHRoIHNlbnNpbmcgbWVzaC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7TWVzaH0gVGhlIGRlcHRoIHNlbnNpbmcgbWVzaC4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0RGVwdGhTZW5zaW5nTWVzaCA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gZGVwdGhTZW5zaW5nLmdldE1lc2goIGNhbWVyYVhSICk7CgogICAgCQl9OwoKICAgIAkJLy8gQW5pbWF0aW9uIExvb3AKCiAgICAJCWxldCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBudWxsOwoKICAgIAkJZnVuY3Rpb24gb25BbmltYXRpb25GcmFtZSggdGltZSwgZnJhbWUgKSB7CgogICAgCQkJcG9zZSA9IGZyYW1lLmdldFZpZXdlclBvc2UoIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CiAgICAJCQl4ckZyYW1lID0gZnJhbWU7CgogICAgCQkJaWYgKCBwb3NlICE9PSBudWxsICkgewoKICAgIAkJCQljb25zdCB2aWV3cyA9IHBvc2Uudmlld3M7CgogICAgCQkJCWlmICggZ2xCYXNlTGF5ZXIgIT09IG51bGwgKSB7CgogICAgCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXRGcmFtZWJ1ZmZlciggbmV3UmVuZGVyVGFyZ2V0LCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlciApOwogICAgCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIG5ld1JlbmRlclRhcmdldCApOwoKICAgIAkJCQl9CgogICAgCQkJCWxldCBjYW1lcmFYUk5lZWRzVXBkYXRlID0gZmFsc2U7CgogICAgCQkJCS8vIGNoZWNrIGlmIGl0J3MgbmVjZXNzYXJ5IHRvIHJlYnVpbGQgY2FtZXJhWFIncyBjYW1lcmEgbGlzdAoKICAgIAkJCQlpZiAoIHZpZXdzLmxlbmd0aCAhPT0gY2FtZXJhWFIuY2FtZXJhcy5sZW5ndGggKSB7CgogICAgCQkJCQljYW1lcmFYUi5jYW1lcmFzLmxlbmd0aCA9IDA7CiAgICAJCQkJCWNhbWVyYVhSTmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQl9CgogICAgCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZpZXdzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJCWNvbnN0IHZpZXcgPSB2aWV3c1sgaSBdOwoKICAgIAkJCQkJbGV0IHZpZXdwb3J0ID0gbnVsbDsKCiAgICAJCQkJCWlmICggZ2xCYXNlTGF5ZXIgIT09IG51bGwgKSB7CgogICAgCQkJCQkJdmlld3BvcnQgPSBnbEJhc2VMYXllci5nZXRWaWV3cG9ydCggdmlldyApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQljb25zdCBnbFN1YkltYWdlID0gZ2xCaW5kaW5nLmdldFZpZXdTdWJJbWFnZSggZ2xQcm9qTGF5ZXIsIHZpZXcgKTsKICAgIAkJCQkJCXZpZXdwb3J0ID0gZ2xTdWJJbWFnZS52aWV3cG9ydDsKCiAgICAJCQkJCQkvLyBGb3Igc2lkZS1ieS1zaWRlIHByb2plY3Rpb24sIHdlIG9ubHkgcHJvZHVjZSBhIHNpbmdsZSB0ZXh0dXJlIGZvciBib3RoIGV5ZXMuCiAgICAJCQkJCQlpZiAoIGkgPT09IDAgKSB7CgogICAgCQkJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldFRleHR1cmVzKAogICAgCQkJCQkJCQluZXdSZW5kZXJUYXJnZXQsCiAgICAJCQkJCQkJCWdsU3ViSW1hZ2UuY29sb3JUZXh0dXJlLAogICAgCQkJCQkJCQlnbFN1YkltYWdlLmRlcHRoU3RlbmNpbFRleHR1cmUgKTsKCiAgICAJCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBuZXdSZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9CgogICAgCQkJCQlsZXQgY2FtZXJhID0gY2FtZXJhc1sgaSBdOwoKICAgIAkJCQkJaWYgKCBjYW1lcmEgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCQljYW1lcmEgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKICAgIAkJCQkJCWNhbWVyYS5sYXllcnMuZW5hYmxlKCBpICk7CiAgICAJCQkJCQljYW1lcmEudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwogICAgCQkJCQkJY2FtZXJhc1sgaSBdID0gY2FtZXJhOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJY2FtZXJhLm1hdHJpeC5mcm9tQXJyYXkoIHZpZXcudHJhbnNmb3JtLm1hdHJpeCApOwogICAgCQkJCQljYW1lcmEubWF0cml4LmRlY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CiAgICAJCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmZyb21BcnJheSggdmlldy5wcm9qZWN0aW9uTWF0cml4ICk7CiAgICAJCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwogICAgCQkJCQljYW1lcmEudmlld3BvcnQuc2V0KCB2aWV3cG9ydC54LCB2aWV3cG9ydC55LCB2aWV3cG9ydC53aWR0aCwgdmlld3BvcnQuaGVpZ2h0ICk7CgogICAgCQkJCQlpZiAoIGkgPT09IDAgKSB7CgogICAgCQkJCQkJY2FtZXJhWFIubWF0cml4LmNvcHkoIGNhbWVyYS5tYXRyaXggKTsKICAgIAkJCQkJCWNhbWVyYVhSLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYVhSLnBvc2l0aW9uLCBjYW1lcmFYUi5xdWF0ZXJuaW9uLCBjYW1lcmFYUi5zY2FsZSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJaWYgKCBjYW1lcmFYUk5lZWRzVXBkYXRlID09PSB0cnVlICkgewoKICAgIAkJCQkJCWNhbWVyYVhSLmNhbWVyYXMucHVzaCggY2FtZXJhICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQkJLy8KCiAgICAJCQkJY29uc3QgZW5hYmxlZEZlYXR1cmVzID0gc2Vzc2lvbi5lbmFibGVkRmVhdHVyZXM7CiAgICAJCQkJY29uc3QgZ3B1RGVwdGhTZW5zaW5nRW5hYmxlZCA9IGVuYWJsZWRGZWF0dXJlcyAmJgogICAgCQkJCQllbmFibGVkRmVhdHVyZXMuaW5jbHVkZXMoICdkZXB0aC1zZW5zaW5nJyApICYmCiAgICAJCQkJCXNlc3Npb24uZGVwdGhVc2FnZSA9PSAnZ3B1LW9wdGltaXplZCc7CgogICAgCQkJCWlmICggZ3B1RGVwdGhTZW5zaW5nRW5hYmxlZCAmJiBnbEJpbmRpbmcgKSB7CgogICAgCQkJCQljb25zdCBkZXB0aERhdGEgPSBnbEJpbmRpbmcuZ2V0RGVwdGhJbmZvcm1hdGlvbiggdmlld3NbIDAgXSApOwoKICAgIAkJCQkJaWYgKCBkZXB0aERhdGEgJiYgZGVwdGhEYXRhLmlzVmFsaWQgJiYgZGVwdGhEYXRhLnRleHR1cmUgKSB7CgogICAgCQkJCQkJZGVwdGhTZW5zaW5nLmluaXQoIHJlbmRlcmVyLCBkZXB0aERhdGEsIHNlc3Npb24ucmVuZGVyU3RhdGUgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLwoKICAgIAkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBjb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF07CiAgICAJCQkJY29uc3QgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzWyBpIF07CgogICAgCQkJCWlmICggaW5wdXRTb3VyY2UgIT09IG51bGwgJiYgY29udHJvbGxlciAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJY29udHJvbGxlci51cGRhdGUoIGlucHV0U291cmNlLCBmcmFtZSwgY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2UgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayApIG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayggdGltZSwgZnJhbWUgKTsKCiAgICAJCQlpZiAoIGZyYW1lLmRldGVjdGVkUGxhbmVzICkgewoKICAgIAkJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdwbGFuZXNkZXRlY3RlZCcsIGRhdGE6IGZyYW1lIH0gKTsKCiAgICAJCQl9CgogICAgCQkJeHJGcmFtZSA9IG51bGw7CgogICAgCQl9CgogICAgCQljb25zdCBhbmltYXRpb24gPSBuZXcgV2ViR0xBbmltYXRpb24oKTsKCiAgICAJCWFuaW1hdGlvbi5zZXRBbmltYXRpb25Mb29wKCBvbkFuaW1hdGlvbkZyYW1lICk7CgogICAgCQl0aGlzLnNldEFuaW1hdGlvbkxvb3AgPSBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKICAgIAkJCW9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IGNhbGxiYWNrOwoKICAgIAkJfTsKCiAgICAJCXRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHt9OwoKICAgIAl9CgogICAgfQoKICAgIGNvbnN0IF9lMSA9IC8qQF9fUFVSRV9fKi8gbmV3IEV1bGVyKCk7CiAgICBjb25zdCBfbTEgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CgogICAgZnVuY3Rpb24gV2ViR0xNYXRlcmlhbHMoIHJlbmRlcmVyLCBwcm9wZXJ0aWVzICkgewoKICAgIAlmdW5jdGlvbiByZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWFwLCB1bmlmb3JtICkgewoKICAgIAkJaWYgKCBtYXAubWF0cml4QXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCiAgICAJCQltYXAudXBkYXRlTWF0cml4KCk7CgogICAgCQl9CgogICAgCQl1bmlmb3JtLnZhbHVlLmNvcHkoIG1hcC5tYXRyaXggKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoRm9nVW5pZm9ybXMoIHVuaWZvcm1zLCBmb2cgKSB7CgogICAgCQlmb2cuY29sb3IuZ2V0UkdCKCB1bmlmb3Jtcy5mb2dDb2xvci52YWx1ZSwgZ2V0VW5saXRVbmlmb3JtQ29sb3JTcGFjZSggcmVuZGVyZXIgKSApOwoKICAgIAkJaWYgKCBmb2cuaXNGb2cgKSB7CgogICAgCQkJdW5pZm9ybXMuZm9nTmVhci52YWx1ZSA9IGZvZy5uZWFyOwogICAgCQkJdW5pZm9ybXMuZm9nRmFyLnZhbHVlID0gZm9nLmZhcjsKCiAgICAJCX0gZWxzZSBpZiAoIGZvZy5pc0ZvZ0V4cDIgKSB7CgogICAgCQkJdW5pZm9ybXMuZm9nRGVuc2l0eS52YWx1ZSA9IGZvZy5kZW5zaXR5OwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJaWYgKCBtYXRlcmlhbC5pc01lc2hCYXNpY01hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaFRvb25NYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwogICAgCQkJcmVmcmVzaFVuaWZvcm1zVG9vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CiAgICAJCQlyZWZyZXNoVW5pZm9ybXNQaG9uZyggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CiAgICAJCQlyZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hQaHlzaWNhbE1hdGVyaWFsICkgewoKICAgIAkJCQlyZWZyZXNoVW5pZm9ybXNQaHlzaWNhbCggdW5pZm9ybXMsIG1hdGVyaWFsLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCiAgICAJCQl9CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hNYXRjYXBNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwogICAgCQkJcmVmcmVzaFVuaWZvcm1zTWF0Y2FwKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaERlcHRoTWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaE5vcm1hbE1hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgogICAgCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc0xpbmVCYXNpY01hdGVyaWFsICkgewoKICAgIAkJCXJlZnJlc2hVbmlmb3Jtc0xpbmUoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNMaW5lRGFzaGVkTWF0ZXJpYWwgKSB7CgogICAgCQkJCXJlZnJlc2hVbmlmb3Jtc0Rhc2goIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKICAgIAkJCX0KCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzUG9pbnRzTWF0ZXJpYWwgKSB7CgogICAgCQkJcmVmcmVzaFVuaWZvcm1zUG9pbnRzKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCApOwoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNTcHJpdGVNYXRlcmlhbCApIHsKCiAgICAJCQlyZWZyZXNoVW5pZm9ybXNTcHJpdGVzKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCiAgICAJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgKSB7CgogICAgCQkJdW5pZm9ybXMuY29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKICAgIAkJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKICAgIAkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCApIHsKCiAgICAJCQltYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsgLy8gIzE1NTgxCgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCiAgICAJCWlmICggbWF0ZXJpYWwuY29sb3IgKSB7CgogICAgCQkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5lbWlzc2l2ZSApIHsKCiAgICAJCQl1bmlmb3Jtcy5lbWlzc2l2ZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5lbWlzc2l2ZSApLm11bHRpcGx5U2NhbGFyKCBtYXRlcmlhbC5lbWlzc2l2ZUludGVuc2l0eSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgogICAgCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tYXAsIHVuaWZvcm1zLm1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5hbHBoYU1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5hbHBoYU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hbHBoYU1hcCwgdW5pZm9ybXMuYWxwaGFNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYnVtcE1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5idW1wTWFwLnZhbHVlID0gbWF0ZXJpYWwuYnVtcE1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYnVtcE1hcCwgdW5pZm9ybXMuYnVtcE1hcFRyYW5zZm9ybSApOwoKICAgIAkJCXVuaWZvcm1zLmJ1bXBTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBTY2FsZTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKICAgIAkJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgKj0gLTE7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5ub3JtYWxNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5ub3JtYWxNYXAsIHVuaWZvcm1zLm5vcm1hbE1hcFRyYW5zZm9ybSApOwoKICAgIAkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLm5vcm1hbFNjYWxlICk7CgogICAgCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCiAgICAJCQkJdW5pZm9ybXMubm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50TWFwLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAsIHVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybSApOwoKICAgIAkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGU7CiAgICAJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRCaWFzLnZhbHVlID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuZW1pc3NpdmVNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuZW1pc3NpdmVNYXAudmFsdWUgPSBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuZW1pc3NpdmVNYXAsIHVuaWZvcm1zLmVtaXNzaXZlTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFyTWFwICkgewoKICAgIAkJCXVuaWZvcm1zLnNwZWN1bGFyTWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNwZWN1bGFyTWFwLCB1bmlmb3Jtcy5zcGVjdWxhck1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgewoKICAgIAkJCXVuaWZvcm1zLmFscGhhVGVzdC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhVGVzdDsKCiAgICAJCX0KCiAgICAJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKICAgIAkJY29uc3QgZW52TWFwID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcDsKICAgIAkJY29uc3QgZW52TWFwUm90YXRpb24gPSBtYXRlcmlhbFByb3BlcnRpZXMuZW52TWFwUm90YXRpb247CgogICAgCQlpZiAoIGVudk1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBlbnZNYXA7CgogICAgCQkJX2UxLmNvcHkoIGVudk1hcFJvdGF0aW9uICk7CgogICAgCQkJLy8gYWNjb21tb2RhdGUgbGVmdC1oYW5kZWQgZnJhbWUKICAgIAkJCV9lMS54ICo9IC0xOyBfZTEueSAqPSAtMTsgX2UxLnogKj0gLTE7CgogICAgCQkJaWYgKCBlbnZNYXAuaXNDdWJlVGV4dHVyZSAmJiBlbnZNYXAuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApIHsKCiAgICAJCQkJLy8gZW52aXJvbm1lbnQgbWFwcyB3aGljaCBhcmUgbm90IGN1YmUgcmVuZGVyIHRhcmdldHMgb3IgUE1SRU1zIGZvbGxvdyBhIGRpZmZlcmVudCBjb252ZW50aW9uCiAgICAJCQkJX2UxLnkgKj0gLTE7CiAgICAJCQkJX2UxLnogKj0gLTE7CgogICAgCQkJfQoKICAgIAkJCXVuaWZvcm1zLmVudk1hcFJvdGF0aW9uLnZhbHVlLnNldEZyb21NYXRyaXg0KCBfbTEubWFrZVJvdGF0aW9uRnJvbUV1bGVyKCBfZTEgKSApOwoKICAgIAkJCXVuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSAoIGVudk1hcC5pc0N1YmVUZXh0dXJlICYmIGVudk1hcC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgogICAgCQkJdW5pZm9ybXMucmVmbGVjdGl2aXR5LnZhbHVlID0gbWF0ZXJpYWwucmVmbGVjdGl2aXR5OwogICAgCQkJdW5pZm9ybXMuaW9yLnZhbHVlID0gbWF0ZXJpYWwuaW9yOwogICAgCQkJdW5pZm9ybXMucmVmcmFjdGlvblJhdGlvLnZhbHVlID0gbWF0ZXJpYWwucmVmcmFjdGlvblJhdGlvOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5saWdodE1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5saWdodE1hcC52YWx1ZSA9IG1hdGVyaWFsLmxpZ2h0TWFwOwogICAgCQkJdW5pZm9ybXMubGlnaHRNYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcEludGVuc2l0eTsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubGlnaHRNYXAsIHVuaWZvcm1zLmxpZ2h0TWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmFvTWFwICkgewoKICAgIAkJCXVuaWZvcm1zLmFvTWFwLnZhbHVlID0gbWF0ZXJpYWwuYW9NYXA7CiAgICAJCQl1bmlmb3Jtcy5hb01hcEludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwSW50ZW5zaXR5OwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hb01hcCwgdW5pZm9ybXMuYW9NYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNMaW5lKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQl1bmlmb3Jtcy5kaWZmdXNlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CiAgICAJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKICAgIAkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgogICAgCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tYXAsIHVuaWZvcm1zLm1hcFRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rhc2goIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCiAgICAJCXVuaWZvcm1zLmRhc2hTaXplLnZhbHVlID0gbWF0ZXJpYWwuZGFzaFNpemU7CiAgICAJCXVuaWZvcm1zLnRvdGFsU2l6ZS52YWx1ZSA9IG1hdGVyaWFsLmRhc2hTaXplICsgbWF0ZXJpYWwuZ2FwU2l6ZTsKICAgIAkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBtYXRlcmlhbC5zY2FsZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNQb2ludHMoIHVuaWZvcm1zLCBtYXRlcmlhbCwgcGl4ZWxSYXRpbywgaGVpZ2h0ICkgewoKICAgIAkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwogICAgCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKICAgIAkJdW5pZm9ybXMuc2l6ZS52YWx1ZSA9IG1hdGVyaWFsLnNpemUgKiBwaXhlbFJhdGlvOwogICAgCQl1bmlmb3Jtcy5zY2FsZS52YWx1ZSA9IGhlaWdodCAqIDAuNTsKCiAgICAJCWlmICggbWF0ZXJpYWwubWFwICkgewoKICAgIAkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy51dlRyYW5zZm9ybSApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5hbHBoYU1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5hbHBoYU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhTWFwOwoKICAgIAkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hbHBoYU1hcCwgdW5pZm9ybXMuYWxwaGFNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHsKCiAgICAJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwogICAgCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKICAgIAkJdW5pZm9ybXMucm90YXRpb24udmFsdWUgPSBtYXRlcmlhbC5yb3RhdGlvbjsKCiAgICAJCWlmICggbWF0ZXJpYWwubWFwICkgewoKICAgIAkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuYWxwaGFUZXN0LnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFUZXN0OwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Bob25nKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQl1bmlmb3Jtcy5zcGVjdWxhci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zcGVjdWxhciApOwogICAgCQl1bmlmb3Jtcy5zaGluaW5lc3MudmFsdWUgPSBNYXRoLm1heCggbWF0ZXJpYWwuc2hpbmluZXNzLCAxZS00ICk7IC8vIHRvIHByZXZlbnQgcG93KCAwLjAsIDAuMCApCgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zVG9vbiggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKICAgIAkJaWYgKCBtYXRlcmlhbC5ncmFkaWVudE1hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5ncmFkaWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmdyYWRpZW50TWFwOwoKICAgIAkJfQoKICAgIAl9CgogICAgCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1N0YW5kYXJkKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQl1bmlmb3Jtcy5tZXRhbG5lc3MudmFsdWUgPSBtYXRlcmlhbC5tZXRhbG5lc3M7CgogICAgCQlpZiAoIG1hdGVyaWFsLm1ldGFsbmVzc01hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5tZXRhbG5lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC5tZXRhbG5lc3NNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1ldGFsbmVzc01hcCwgdW5pZm9ybXMubWV0YWxuZXNzTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQl1bmlmb3Jtcy5yb3VnaG5lc3MudmFsdWUgPSBtYXRlcmlhbC5yb3VnaG5lc3M7CgogICAgCQlpZiAoIG1hdGVyaWFsLnJvdWdobmVzc01hcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5yb3VnaG5lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC5yb3VnaG5lc3NNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnJvdWdobmVzc01hcCwgdW5pZm9ybXMucm91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmVudk1hcCApIHsKCiAgICAJCQkvL3VuaWZvcm1zLmVudk1hcC52YWx1ZSA9IG1hdGVyaWFsLmVudk1hcDsgLy8gcGFydCBvZiB1bmlmb3JtcyBjb21tb24KCiAgICAJCQl1bmlmb3Jtcy5lbnZNYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXBJbnRlbnNpdHk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUGh5c2ljYWwoIHVuaWZvcm1zLCBtYXRlcmlhbCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJdW5pZm9ybXMuaW9yLnZhbHVlID0gbWF0ZXJpYWwuaW9yOyAvLyBhbHNvIHBhcnQgb2YgdW5pZm9ybXMgY29tbW9uCgogICAgCQlpZiAoIG1hdGVyaWFsLnNoZWVuID4gMCApIHsKCiAgICAJCQl1bmlmb3Jtcy5zaGVlbkNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLnNoZWVuQ29sb3IgKS5tdWx0aXBseVNjYWxhciggbWF0ZXJpYWwuc2hlZW4gKTsKCiAgICAJCQl1bmlmb3Jtcy5zaGVlblJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzOwoKICAgIAkJCWlmICggbWF0ZXJpYWwuc2hlZW5Db2xvck1hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMuc2hlZW5Db2xvck1hcC52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuQ29sb3JNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwLCB1bmlmb3Jtcy5zaGVlbkNvbG9yTWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLnNoZWVuUm91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zaGVlblJvdWdobmVzc01hcCwgdW5pZm9ybXMuc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmNsZWFyY29hdCA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuY2xlYXJjb2F0LnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0OwogICAgCQkJdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzOwoKICAgIAkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwICkgewoKICAgIAkJCQl1bmlmb3Jtcy5jbGVhcmNvYXRNYXAudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXRNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXRNYXAsIHVuaWZvcm1zLmNsZWFyY29hdE1hcFRyYW5zZm9ybSApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKCiAgICAJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcCwgdW5pZm9ybXMuY2xlYXJjb2F0Tm9ybWFsTWFwVHJhbnNmb3JtICk7CgogICAgCQkJCXVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbFNjYWxlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbFNjYWxlICk7CgogICAgCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgogICAgCQkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxTY2FsZS52YWx1ZS5uZWdhdGUoKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuZGlzcGVyc2lvbiA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMuZGlzcGVyc2lvbi52YWx1ZSA9IG1hdGVyaWFsLmRpc3BlcnNpb247CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMCApIHsKCiAgICAJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZS52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlOwogICAgCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VJT1IudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUjsKICAgIAkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bS52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2VbIDAgXTsKICAgIAkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bS52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2VbIDEgXTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwICkgewoKICAgIAkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZU1hcC52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuaXJpZGVzY2VuY2VNYXAsIHVuaWZvcm1zLmlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgKSB7CgogICAgCQkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCwgdW5pZm9ybXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlpZiAoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDAgKSB7CgogICAgCQkJdW5pZm9ybXMudHJhbnNtaXNzaW9uLnZhbHVlID0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uOwogICAgCQkJdW5pZm9ybXMudHJhbnNtaXNzaW9uU2FtcGxlck1hcC52YWx1ZSA9IHRyYW5zbWlzc2lvblJlbmRlclRhcmdldC50ZXh0dXJlOwogICAgCQkJdW5pZm9ybXMudHJhbnNtaXNzaW9uU2FtcGxlclNpemUudmFsdWUuc2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQud2lkdGgsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldC5oZWlnaHQgKTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMudHJhbnNtaXNzaW9uTWFwLnZhbHVlID0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwOwoKICAgIAkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwudHJhbnNtaXNzaW9uTWFwLCB1bmlmb3Jtcy50cmFuc21pc3Npb25NYXBUcmFuc2Zvcm0gKTsKCiAgICAJCQl9CgogICAgCQkJdW5pZm9ybXMudGhpY2tuZXNzLnZhbHVlID0gbWF0ZXJpYWwudGhpY2tuZXNzOwoKICAgIAkJCWlmICggbWF0ZXJpYWwudGhpY2tuZXNzTWFwICkgewoKICAgIAkJCQl1bmlmb3Jtcy50aGlja25lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC50aGlja25lc3NNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC50aGlja25lc3NNYXAsIHVuaWZvcm1zLnRoaWNrbmVzc01hcFRyYW5zZm9ybSApOwoKICAgIAkJCX0KCiAgICAJCQl1bmlmb3Jtcy5hdHRlbnVhdGlvbkRpc3RhbmNlLnZhbHVlID0gbWF0ZXJpYWwuYXR0ZW51YXRpb25EaXN0YW5jZTsKICAgIAkJCXVuaWZvcm1zLmF0dGVudWF0aW9uQ29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvciApOwoKICAgIAkJfQoKICAgIAkJaWYgKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApIHsKCiAgICAJCQl1bmlmb3Jtcy5hbmlzb3Ryb3B5VmVjdG9yLnZhbHVlLnNldCggbWF0ZXJpYWwuYW5pc290cm9weSAqIE1hdGguY29zKCBtYXRlcmlhbC5hbmlzb3Ryb3B5Um90YXRpb24gKSwgbWF0ZXJpYWwuYW5pc290cm9weSAqIE1hdGguc2luKCBtYXRlcmlhbC5hbmlzb3Ryb3B5Um90YXRpb24gKSApOwoKICAgIAkJCWlmICggbWF0ZXJpYWwuYW5pc290cm9weU1hcCApIHsKCiAgICAJCQkJdW5pZm9ybXMuYW5pc290cm9weU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFuaXNvdHJvcHlNYXA7CgogICAgCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hbmlzb3Ryb3B5TWFwLCB1bmlmb3Jtcy5hbmlzb3Ryb3B5TWFwVHJhbnNmb3JtICk7CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJdW5pZm9ybXMuc3BlY3VsYXJJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eTsKICAgIAkJdW5pZm9ybXMuc3BlY3VsYXJDb2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICk7CgogICAgCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuc3BlY3VsYXJDb2xvck1hcC52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXA7CgogICAgCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAsIHVuaWZvcm1zLnNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm0gKTsKCiAgICAJCX0KCiAgICAJCWlmICggbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAgKSB7CgogICAgCQkJdW5pZm9ybXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcDsKCiAgICAJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAsIHVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtICk7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTWF0Y2FwKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgogICAgCQlpZiAoIG1hdGVyaWFsLm1hdGNhcCApIHsKCiAgICAJCQl1bmlmb3Jtcy5tYXRjYXAudmFsdWUgPSBtYXRlcmlhbC5tYXRjYXA7CgogICAgCQl9CgogICAgCX0KCiAgICAJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zRGlzdGFuY2UoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCiAgICAJCWNvbnN0IGxpZ2h0ID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkubGlnaHQ7CgogICAgCQl1bmlmb3Jtcy5yZWZlcmVuY2VQb3NpdGlvbi52YWx1ZS5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CiAgICAJCXVuaWZvcm1zLm5lYXJEaXN0YW5jZS52YWx1ZSA9IGxpZ2h0LnNoYWRvdy5jYW1lcmEubmVhcjsKICAgIAkJdW5pZm9ybXMuZmFyRGlzdGFuY2UudmFsdWUgPSBsaWdodC5zaGFkb3cuY2FtZXJhLmZhcjsKCiAgICAJfQoKICAgIAlyZXR1cm4gewogICAgCQlyZWZyZXNoRm9nVW5pZm9ybXM6IHJlZnJlc2hGb2dVbmlmb3JtcywKICAgIAkJcmVmcmVzaE1hdGVyaWFsVW5pZm9ybXM6IHJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zCiAgICAJfTsKCiAgICB9CgogICAgZnVuY3Rpb24gV2ViR0xVbmlmb3Jtc0dyb3VwcyggZ2wsIGluZm8sIGNhcGFiaWxpdGllcywgc3RhdGUgKSB7CgogICAgCWxldCBidWZmZXJzID0ge307CiAgICAJbGV0IHVwZGF0ZUxpc3QgPSB7fTsKICAgIAlsZXQgYWxsb2NhdGVkQmluZGluZ1BvaW50cyA9IFtdOwoKICAgIAljb25zdCBtYXhCaW5kaW5nUG9pbnRzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVU5JRk9STV9CVUZGRVJfQklORElOR1MgKTsgLy8gYmluZGluZyBwb2ludHMgYXJlIGdsb2JhbCB3aGVyZWFzIGJsb2NrIGluZGljZXMgYXJlIHBlciBzaGFkZXIgcHJvZ3JhbQoKICAgIAlmdW5jdGlvbiBiaW5kKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKICAgIAkJY29uc3Qgd2ViZ2xQcm9ncmFtID0gcHJvZ3JhbS5wcm9ncmFtOwogICAgCQlzdGF0ZS51bmlmb3JtQmxvY2tCaW5kaW5nKCB1bmlmb3Jtc0dyb3VwLCB3ZWJnbFByb2dyYW0gKTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiB1cGRhdGUoIHVuaWZvcm1zR3JvdXAsIHByb2dyYW0gKSB7CgogICAgCQlsZXQgYnVmZmVyID0gYnVmZmVyc1sgdW5pZm9ybXNHcm91cC5pZCBdOwoKICAgIAkJaWYgKCBidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQlwcmVwYXJlVW5pZm9ybXNHcm91cCggdW5pZm9ybXNHcm91cCApOwoKICAgIAkJCWJ1ZmZlciA9IGNyZWF0ZUJ1ZmZlciggdW5pZm9ybXNHcm91cCApOwogICAgCQkJYnVmZmVyc1sgdW5pZm9ybXNHcm91cC5pZCBdID0gYnVmZmVyOwoKICAgIAkJCXVuaWZvcm1zR3JvdXAuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSApOwoKICAgIAkJfQoKICAgIAkJLy8gZW5zdXJlIHRvIHVwZGF0ZSB0aGUgYmluZGluZyBwb2ludHMvYmxvY2sgaW5kaWNlcyBtYXBwaW5nIGZvciB0aGlzIHByb2dyYW0KCiAgICAJCWNvbnN0IHdlYmdsUHJvZ3JhbSA9IHByb2dyYW0ucHJvZ3JhbTsKICAgIAkJc3RhdGUudXBkYXRlVUJPTWFwcGluZyggdW5pZm9ybXNHcm91cCwgd2ViZ2xQcm9ncmFtICk7CgogICAgCQkvLyB1cGRhdGUgVUJPIG9uY2UgcGVyIGZyYW1lCgogICAgCQljb25zdCBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKICAgIAkJaWYgKCB1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF0gIT09IGZyYW1lICkgewoKICAgIAkJCXVwZGF0ZUJ1ZmZlckRhdGEoIHVuaWZvcm1zR3JvdXAgKTsKCiAgICAJCQl1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF0gPSBmcmFtZTsKCiAgICAJCX0KCiAgICAJfQoKICAgIAlmdW5jdGlvbiBjcmVhdGVCdWZmZXIoIHVuaWZvcm1zR3JvdXAgKSB7CgogICAgCQkvLyB0aGUgc2V0dXAgb2YgYW4gVUJPIGlzIGluZGVwZW5kZW50IG9mIGEgcGFydGljdWxhciBzaGFkZXIgcHJvZ3JhbSBidXQgZ2xvYmFsCgogICAgCQljb25zdCBiaW5kaW5nUG9pbnRJbmRleCA9IGFsbG9jYXRlQmluZGluZ1BvaW50SW5kZXgoKTsKICAgIAkJdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ID0gYmluZGluZ1BvaW50SW5kZXg7CgogICAgCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgIAkJY29uc3Qgc2l6ZSA9IHVuaWZvcm1zR3JvdXAuX19zaXplOwogICAgCQljb25zdCB1c2FnZSA9IHVuaWZvcm1zR3JvdXAudXNhZ2U7CgogICAgCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgYnVmZmVyICk7CiAgICAJCWdsLmJ1ZmZlckRhdGEoIGdsLlVOSUZPUk1fQlVGRkVSLCBzaXplLCB1c2FnZSApOwogICAgCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgbnVsbCApOwogICAgCQlnbC5iaW5kQnVmZmVyQmFzZSggZ2wuVU5JRk9STV9CVUZGRVIsIGJpbmRpbmdQb2ludEluZGV4LCBidWZmZXIgKTsKCiAgICAJCXJldHVybiBidWZmZXI7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gYWxsb2NhdGVCaW5kaW5nUG9pbnRJbmRleCgpIHsKCiAgICAJCWZvciAoIGxldCBpID0gMDsgaSA8IG1heEJpbmRpbmdQb2ludHM7IGkgKysgKSB7CgogICAgCQkJaWYgKCBhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLmluZGV4T2YoIGkgKSA9PT0gLTEgKSB7CgogICAgCQkJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMucHVzaCggaSApOwogICAgCQkJCXJldHVybiBpOwoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBNYXhpbXVtIG51bWJlciBvZiBzaW11bHRhbmVvdXNseSB1c2FibGUgdW5pZm9ybXMgZ3JvdXBzIHJlYWNoZWQuJyApOwoKICAgIAkJcmV0dXJuIDA7CgogICAgCX0KCiAgICAJZnVuY3Rpb24gdXBkYXRlQnVmZmVyRGF0YSggdW5pZm9ybXNHcm91cCApIHsKCiAgICAJCWNvbnN0IGJ1ZmZlciA9IGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXTsKICAgIAkJY29uc3QgdW5pZm9ybXMgPSB1bmlmb3Jtc0dyb3VwLnVuaWZvcm1zOwogICAgCQljb25zdCBjYWNoZSA9IHVuaWZvcm1zR3JvdXAuX19jYWNoZTsKCiAgICAJCWdsLmJpbmRCdWZmZXIoIGdsLlVOSUZPUk1fQlVGRkVSLCBidWZmZXIgKTsKCiAgICAJCWZvciAoIGxldCBpID0gMCwgaWwgPSB1bmlmb3Jtcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCiAgICAJCQljb25zdCB1bmlmb3JtQXJyYXkgPSBBcnJheS5pc0FycmF5KCB1bmlmb3Jtc1sgaSBdICkgPyB1bmlmb3Jtc1sgaSBdIDogWyB1bmlmb3Jtc1sgaSBdIF07CgogICAgCQkJZm9yICggbGV0IGogPSAwLCBqbCA9IHVuaWZvcm1BcnJheS5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCiAgICAJCQkJY29uc3QgdW5pZm9ybSA9IHVuaWZvcm1BcnJheVsgaiBdOwoKICAgIAkJCQlpZiAoIGhhc1VuaWZvcm1DaGFuZ2VkKCB1bmlmb3JtLCBpLCBqLCBjYWNoZSApID09PSB0cnVlICkgewoKICAgIAkJCQkJY29uc3Qgb2Zmc2V0ID0gdW5pZm9ybS5fX29mZnNldDsKCiAgICAJCQkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm0udmFsdWUgKSA/IHVuaWZvcm0udmFsdWUgOiBbIHVuaWZvcm0udmFsdWUgXTsKCiAgICAJCQkJCWxldCBhcnJheU9mZnNldCA9IDA7CgogICAgCQkJCQlmb3IgKCBsZXQgayA9IDA7IGsgPCB2YWx1ZXMubGVuZ3RoOyBrICsrICkgewoKICAgIAkJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBrIF07CgogICAgCQkJCQkJY29uc3QgaW5mbyA9IGdldFVuaWZvcm1TaXplKCB2YWx1ZSApOwoKICAgIAkJCQkJCS8vIFRPRE8gYWRkIGludGVnZXIgYW5kIHN0cnVjdCBzdXBwb3J0CiAgICAJCQkJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZTsKICAgIAkJCQkJCQlnbC5idWZmZXJTdWJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgb2Zmc2V0ICsgYXJyYXlPZmZzZXQsIHVuaWZvcm0uX19kYXRhICk7CgogICAgCQkJCQkJfSBlbHNlIGlmICggdmFsdWUuaXNNYXRyaXgzICkgewoKICAgIAkJCQkJCQkvLyBtYW51YWxseSBjb252ZXJ0aW5nIDN4MyB0byAzeDQKCiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDAgXSA9IHZhbHVlLmVsZW1lbnRzWyAwIF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDEgXSA9IHZhbHVlLmVsZW1lbnRzWyAxIF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDIgXSA9IHZhbHVlLmVsZW1lbnRzWyAyIF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDMgXSA9IDA7CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDQgXSA9IHZhbHVlLmVsZW1lbnRzWyAzIF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDUgXSA9IHZhbHVlLmVsZW1lbnRzWyA0IF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDYgXSA9IHZhbHVlLmVsZW1lbnRzWyA1IF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDcgXSA9IDA7CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDggXSA9IHZhbHVlLmVsZW1lbnRzWyA2IF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDkgXSA9IHZhbHVlLmVsZW1lbnRzWyA3IF07CiAgICAJCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDEwIF0gPSB2YWx1ZS5lbGVtZW50c1sgOCBdOwogICAgCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxMSBdID0gMDsKCiAgICAJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQl2YWx1ZS50b0FycmF5KCB1bmlmb3JtLl9fZGF0YSwgYXJyYXlPZmZzZXQgKTsKCiAgICAJCQkJCQkJYXJyYXlPZmZzZXQgKz0gaW5mby5zdG9yYWdlIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGdsLlVOSUZPUk1fQlVGRkVSLCBvZmZzZXQsIHVuaWZvcm0uX19kYXRhICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgbnVsbCApOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGhhc1VuaWZvcm1DaGFuZ2VkKCB1bmlmb3JtLCBpbmRleCwgaW5kZXhBcnJheSwgY2FjaGUgKSB7CgogICAgCQljb25zdCB2YWx1ZSA9IHVuaWZvcm0udmFsdWU7CiAgICAJCWNvbnN0IGluZGV4U3RyaW5nID0gaW5kZXggKyAnXycgKyBpbmRleEFycmF5OwoKICAgIAkJaWYgKCBjYWNoZVsgaW5kZXhTdHJpbmcgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCS8vIGNhY2hlIGVudHJ5IGRvZXMgbm90IGV4aXN0IHNvIGZhcgoKICAgIAkJCWlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJyApIHsKCiAgICAJCQkJY2FjaGVbIGluZGV4U3RyaW5nIF0gPSB2YWx1ZTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlLmNsb25lKCk7CgogICAgCQkJfQoKICAgIAkJCXJldHVybiB0cnVlOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zdCBjYWNoZWRPYmplY3QgPSBjYWNoZVsgaW5kZXhTdHJpbmcgXTsKCiAgICAJCQkvLyBjb21wYXJlIGN1cnJlbnQgdmFsdWUgd2l0aCBjYWNoZWQgZW50cnkKCiAgICAJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgogICAgCQkJCWlmICggY2FjaGVkT2JqZWN0ICE9PSB2YWx1ZSApIHsKCiAgICAJCQkJCWNhY2hlWyBpbmRleFN0cmluZyBdID0gdmFsdWU7CiAgICAJCQkJCXJldHVybiB0cnVlOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJaWYgKCBjYWNoZWRPYmplY3QuZXF1YWxzKCB2YWx1ZSApID09PSBmYWxzZSApIHsKCiAgICAJCQkJCWNhY2hlZE9iamVjdC5jb3B5KCB2YWx1ZSApOwogICAgCQkJCQlyZXR1cm4gdHJ1ZTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCXJldHVybiBmYWxzZTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBwcmVwYXJlVW5pZm9ybXNHcm91cCggdW5pZm9ybXNHcm91cCApIHsKCiAgICAJCS8vIGRldGVybWluZSB0b3RhbCBidWZmZXIgc2l6ZSBhY2NvcmRpbmcgdG8gdGhlIFNURDE0MCBsYXlvdXQKICAgIAkJLy8gSGludDogU1REMTQwIGlzIHRoZSBvbmx5IHN1cHBvcnRlZCBsYXlvdXQgaW4gV2ViR0wgMgoKICAgIAkJY29uc3QgdW5pZm9ybXMgPSB1bmlmb3Jtc0dyb3VwLnVuaWZvcm1zOwoKICAgIAkJbGV0IG9mZnNldCA9IDA7IC8vIGdsb2JhbCBidWZmZXIgb2Zmc2V0IGluIGJ5dGVzCiAgICAJCWNvbnN0IGNodW5rU2l6ZSA9IDE2OyAvLyBzaXplIG9mIGEgY2h1bmsgaW4gYnl0ZXMKCiAgICAJCWZvciAoIGxldCBpID0gMCwgbCA9IHVuaWZvcm1zLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJY29uc3QgdW5pZm9ybUFycmF5ID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybXNbIGkgXSApID8gdW5pZm9ybXNbIGkgXSA6IFsgdW5pZm9ybXNbIGkgXSBdOwoKICAgIAkJCWZvciAoIGxldCBqID0gMCwgamwgPSB1bmlmb3JtQXJyYXkubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgogICAgCQkJCWNvbnN0IHVuaWZvcm0gPSB1bmlmb3JtQXJyYXlbIGogXTsKCiAgICAJCQkJY29uc3QgdmFsdWVzID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybS52YWx1ZSApID8gdW5pZm9ybS52YWx1ZSA6IFsgdW5pZm9ybS52YWx1ZSBdOwoKICAgIAkJCQlmb3IgKCBsZXQgayA9IDAsIGtsID0gdmFsdWVzLmxlbmd0aDsgayA8IGtsOyBrICsrICkgewoKICAgIAkJCQkJY29uc3QgdmFsdWUgPSB2YWx1ZXNbIGsgXTsKCiAgICAJCQkJCWNvbnN0IGluZm8gPSBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKTsKCiAgICAJCQkJCWNvbnN0IGNodW5rT2Zmc2V0ID0gb2Zmc2V0ICUgY2h1bmtTaXplOyAvLyBvZmZzZXQgaW4gdGhlIGN1cnJlbnQgY2h1bmsKICAgIAkJCQkJY29uc3QgY2h1bmtQYWRkaW5nID0gY2h1bmtPZmZzZXQgJSBpbmZvLmJvdW5kYXJ5OyAvLyByZXF1aXJlZCBwYWRkaW5nIHRvIG1hdGNoIGJvdW5kYXJ5CiAgICAJCQkJCWNvbnN0IGNodW5rU3RhcnQgPSBjaHVua09mZnNldCArIGNodW5rUGFkZGluZzsgLy8gdGhlIHN0YXJ0IHBvc2l0aW9uIGluIHRoZSBjdXJyZW50IGNodW5rIGZvciB0aGUgZGF0YQoKICAgIAkJCQkJb2Zmc2V0ICs9IGNodW5rUGFkZGluZzsKCiAgICAJCQkJCS8vIENoZWNrIGZvciBjaHVuayBvdmVyZmxvdwogICAgCQkJCQlpZiAoIGNodW5rU3RhcnQgIT09IDAgJiYgKCBjaHVua1NpemUgLSBjaHVua1N0YXJ0ICkgPCBpbmZvLnN0b3JhZ2UgKSB7CgogICAgCQkJCQkJLy8gQWRkIHBhZGRpbmcgYW5kIGFkanVzdCBvZmZzZXQKICAgIAkJCQkJCW9mZnNldCArPSAoIGNodW5rU2l6ZSAtIGNodW5rU3RhcnQgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCS8vIHRoZSBmb2xsb3dpbmcgdHdvIHByb3BlcnRpZXMgd2lsbCBiZSB1c2VkIGZvciBwYXJ0aWFsIGJ1ZmZlciB1cGRhdGVzCiAgICAJCQkJCXVuaWZvcm0uX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheSggaW5mby5zdG9yYWdlIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICk7CiAgICAJCQkJCXVuaWZvcm0uX19vZmZzZXQgPSBvZmZzZXQ7CgogICAgCQkJCQkvLyBVcGRhdGUgdGhlIGdsb2JhbCBvZmZzZXQKICAgIAkJCQkJb2Zmc2V0ICs9IGluZm8uc3RvcmFnZTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0KCiAgICAJCS8vIGVuc3VyZSBjb3JyZWN0IGZpbmFsIHBhZGRpbmcKCiAgICAJCWNvbnN0IGNodW5rT2Zmc2V0ID0gb2Zmc2V0ICUgY2h1bmtTaXplOwoKICAgIAkJaWYgKCBjaHVua09mZnNldCA+IDAgKSBvZmZzZXQgKz0gKCBjaHVua1NpemUgLSBjaHVua09mZnNldCApOwoKICAgIAkJLy8KCiAgICAJCXVuaWZvcm1zR3JvdXAuX19zaXplID0gb2Zmc2V0OwogICAgCQl1bmlmb3Jtc0dyb3VwLl9fY2FjaGUgPSB7fTsKCiAgICAJCXJldHVybiB0aGlzOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIGdldFVuaWZvcm1TaXplKCB2YWx1ZSApIHsKCiAgICAJCWNvbnN0IGluZm8gPSB7CiAgICAJCQlib3VuZGFyeTogMCwgLy8gYnl0ZXMKICAgIAkJCXN0b3JhZ2U6IDAgLy8gYnl0ZXMKICAgIAkJfTsKCiAgICAJCS8vIGRldGVybWluZSBzaXplcyBhY2NvcmRpbmcgdG8gU1REMTQwCgogICAgCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgogICAgCQkJLy8gZmxvYXQvaW50L2Jvb2wKCiAgICAJCQlpbmZvLmJvdW5kYXJ5ID0gNDsKICAgIAkJCWluZm8uc3RvcmFnZSA9IDQ7CgogICAgCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1ZlY3RvcjIgKSB7CgogICAgCQkJLy8gdmVjMgoKICAgIAkJCWluZm8uYm91bmRhcnkgPSA4OwogICAgCQkJaW5mby5zdG9yYWdlID0gODsKCiAgICAJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVmVjdG9yMyB8fCB2YWx1ZS5pc0NvbG9yICkgewoKICAgIAkJCS8vIHZlYzMKCiAgICAJCQlpbmZvLmJvdW5kYXJ5ID0gMTY7CiAgICAJCQlpbmZvLnN0b3JhZ2UgPSAxMjsgLy8gZXZpbDogdmVjMyBtdXN0IHN0YXJ0IG9uIGEgMTYtYnl0ZSBib3VuZGFyeSBidXQgaXQgb25seSBjb25zdW1lcyAxMiBieXRlcwoKICAgIAkJfSBlbHNlIGlmICggdmFsdWUuaXNWZWN0b3I0ICkgewoKICAgIAkJCS8vIHZlYzQKCiAgICAJCQlpbmZvLmJvdW5kYXJ5ID0gMTY7CiAgICAJCQlpbmZvLnN0b3JhZ2UgPSAxNjsKCiAgICAJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4MyApIHsKCiAgICAJCQkvLyBtYXQzIChpbiBTVEQxNDAgYSAzeDMgbWF0cml4IGlzIHJlcHJlc2VudGVkIGFzIDN4NCkKCiAgICAJCQlpbmZvLmJvdW5kYXJ5ID0gNDg7CiAgICAJCQlpbmZvLnN0b3JhZ2UgPSA0ODsKCiAgICAJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4NCApIHsKCiAgICAJCQkvLyBtYXQ0CgogICAgCQkJaW5mby5ib3VuZGFyeSA9IDY0OwogICAgCQkJaW5mby5zdG9yYWdlID0gNjQ7CgogICAgCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1RleHR1cmUgKSB7CgogICAgCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBzYW1wbGVycyBjYW4gbm90IGJlIHBhcnQgb2YgYW4gdW5pZm9ybXMgZ3JvdXAuJyApOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBVbnN1cHBvcnRlZCB1bmlmb3JtIHZhbHVlIHR5cGUuJywgdmFsdWUgKTsKCiAgICAJCX0KCiAgICAJCXJldHVybiBpbmZvOwoKICAgIAl9CgogICAgCWZ1bmN0aW9uIG9uVW5pZm9ybXNHcm91cHNEaXNwb3NlKCBldmVudCApIHsKCiAgICAJCWNvbnN0IHVuaWZvcm1zR3JvdXAgPSBldmVudC50YXJnZXQ7CgogICAgCQl1bmlmb3Jtc0dyb3VwLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25Vbmlmb3Jtc0dyb3Vwc0Rpc3Bvc2UgKTsKCiAgICAJCWNvbnN0IGluZGV4ID0gYWxsb2NhdGVkQmluZGluZ1BvaW50cy5pbmRleE9mKCB1bmlmb3Jtc0dyb3VwLl9fYmluZGluZ1BvaW50SW5kZXggKTsKICAgIAkJYWxsb2NhdGVkQmluZGluZ1BvaW50cy5zcGxpY2UoIGluZGV4LCAxICk7CgogICAgCQlnbC5kZWxldGVCdWZmZXIoIGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXSApOwoKICAgIAkJZGVsZXRlIGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXTsKICAgIAkJZGVsZXRlIHVwZGF0ZUxpc3RbIHVuaWZvcm1zR3JvdXAuaWQgXTsKCiAgICAJfQoKICAgIAlmdW5jdGlvbiBkaXNwb3NlKCkgewoKICAgIAkJZm9yICggY29uc3QgaWQgaW4gYnVmZmVycyApIHsKCiAgICAJCQlnbC5kZWxldGVCdWZmZXIoIGJ1ZmZlcnNbIGlkIF0gKTsKCiAgICAJCX0KCiAgICAJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMgPSBbXTsKICAgIAkJYnVmZmVycyA9IHt9OwogICAgCQl1cGRhdGVMaXN0ID0ge307CgogICAgCX0KCiAgICAJcmV0dXJuIHsKCiAgICAJCWJpbmQ6IGJpbmQsCiAgICAJCXVwZGF0ZTogdXBkYXRlLAoKICAgIAkJZGlzcG9zZTogZGlzcG9zZQoKICAgIAl9OwoKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgcmVuZGVyZXIgdXNlcyBXZWJHTCAyIHRvIGRpc3BsYXkgc2NlbmVzLgogICAgICoKICAgICAqIFdlYkdMIDEgaXMgbm90IHN1cHBvcnRlZCBzaW5jZSBgcjE2M2AuCiAgICAgKi8KICAgIGNsYXNzIFdlYkdMUmVuZGVyZXIgewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IFdlYkdMIHJlbmRlcmVyLgogICAgCSAqCiAgICAJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfk9wdGlvbnN9IFtwYXJhbWV0ZXJzXSAtIFRoZSBjb25maWd1cmF0aW9uIHBhcmFtZXRlci4KICAgIAkgKi8KICAgIAljb25zdHJ1Y3RvciggcGFyYW1ldGVycyA9IHt9ICkgewoKICAgIAkJY29uc3QgewogICAgCQkJY2FudmFzID0gY3JlYXRlQ2FudmFzRWxlbWVudCgpLAogICAgCQkJY29udGV4dCA9IG51bGwsCiAgICAJCQlkZXB0aCA9IHRydWUsCiAgICAJCQlzdGVuY2lsID0gZmFsc2UsCiAgICAJCQlhbHBoYSA9IGZhbHNlLAogICAgCQkJYW50aWFsaWFzID0gZmFsc2UsCiAgICAJCQlwcmVtdWx0aXBsaWVkQWxwaGEgPSB0cnVlLAogICAgCQkJcHJlc2VydmVEcmF3aW5nQnVmZmVyID0gZmFsc2UsCiAgICAJCQlwb3dlclByZWZlcmVuY2UgPSAnZGVmYXVsdCcsCiAgICAJCQlmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0ID0gZmFsc2UsCiAgICAJCQlyZXZlcnNlRGVwdGhCdWZmZXIgPSBmYWxzZSwKICAgIAkJfSA9IHBhcmFtZXRlcnM7CgogICAgCQkvKioKICAgIAkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAcmVhZG9ubHkKICAgIAkJICogQGRlZmF1bHQgdHJ1ZQogICAgCQkgKi8KICAgIAkJdGhpcy5pc1dlYkdMUmVuZGVyZXIgPSB0cnVlOwoKICAgIAkJbGV0IF9hbHBoYTsKCiAgICAJCWlmICggY29udGV4dCAhPT0gbnVsbCApIHsKCiAgICAJCQlpZiAoIHR5cGVvZiBXZWJHTFJlbmRlcmluZ0NvbnRleHQgIT09ICd1bmRlZmluZWQnICYmIGNvbnRleHQgaW5zdGFuY2VvZiBXZWJHTFJlbmRlcmluZ0NvbnRleHQgKSB7CgogICAgCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFdlYkdMIDEgaXMgbm90IHN1cHBvcnRlZCBzaW5jZSByMTYzLicgKTsKCiAgICAJCQl9CgogICAgCQkJX2FscGhhID0gY29udGV4dC5nZXRDb250ZXh0QXR0cmlidXRlcygpLmFscGhhOwoKICAgIAkJfSBlbHNlIHsKCiAgICAJCQlfYWxwaGEgPSBhbHBoYTsKCiAgICAJCX0KCiAgICAJCWNvbnN0IHVpbnRDbGVhckNvbG9yID0gbmV3IFVpbnQzMkFycmF5KCA0ICk7CiAgICAJCWNvbnN0IGludENsZWFyQ29sb3IgPSBuZXcgSW50MzJBcnJheSggNCApOwoKICAgIAkJbGV0IGN1cnJlbnRSZW5kZXJMaXN0ID0gbnVsbDsKICAgIAkJbGV0IGN1cnJlbnRSZW5kZXJTdGF0ZSA9IG51bGw7CgogICAgCQkvLyByZW5kZXIoKSBjYW4gYmUgY2FsbGVkIGZyb20gd2l0aGluIGEgY2FsbGJhY2sgdHJpZ2dlcmVkIGJ5IGFub3RoZXIgcmVuZGVyLgogICAgCQkvLyBXZSB0cmFjayB0aGlzIHNvIHRoYXQgdGhlIG5lc3RlZCByZW5kZXIgY2FsbCBnZXRzIGl0cyBsaXN0IGFuZCBzdGF0ZSBpc29sYXRlZCBmcm9tIHRoZSBwYXJlbnQgcmVuZGVyIGNhbGwuCgogICAgCQljb25zdCByZW5kZXJMaXN0U3RhY2sgPSBbXTsKICAgIAkJY29uc3QgcmVuZGVyU3RhdGVTdGFjayA9IFtdOwoKICAgIAkJLy8gcHVibGljIHByb3BlcnRpZXMKCiAgICAJCS8qKgogICAgCQkgKiBBIGNhbnZhcyB3aGVyZSB0aGUgcmVuZGVyZXIgZHJhd3MgaXRzIG91dHB1dC5UaGlzIGlzIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBieSB0aGUgcmVuZGVyZXIKICAgIAkJICogaW4gdGhlIGNvbnN0cnVjdG9yIChpZiBub3QgcHJvdmlkZWQgYWxyZWFkeSk7IHlvdSBqdXN0IG5lZWQgdG8gYWRkIGl0IHRvIHlvdXIgcGFnZSBsaWtlIHNvOgogICAgCQkgKiBgYGBqcwogICAgCQkgKiBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCByZW5kZXJlci5kb21FbGVtZW50ICk7CiAgICAJCSAqIGBgYAogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7RE9NRWxlbWVudH0KICAgIAkJICovCiAgICAJCXRoaXMuZG9tRWxlbWVudCA9IGNhbnZhczsKCiAgICAJCS8qKgogICAgCQkgKiBBIG9iamVjdCB3aXRoIGRlYnVnIGNvbmZpZ3VyYXRpb24gc2V0dGluZ3MuCiAgICAJCSAqCiAgICAJCSAqIC0gYGNoZWNrU2hhZGVyRXJyb3JzYDogSWYgaXQgaXMgYHRydWVgLCBkZWZpbmVzIHdoZXRoZXIgbWF0ZXJpYWwgc2hhZGVyIHByb2dyYW1zIGFyZQogICAgCQkgKiBjaGVja2VkIGZvciBlcnJvcnMgZHVyaW5nIGNvbXBpbGF0aW9uIGFuZCBsaW5rYWdlIHByb2Nlc3MuIEl0IG1heSBiZSB1c2VmdWwgdG8gZGlzYWJsZQogICAgCQkgKiB0aGlzIGNoZWNrIGluIHByb2R1Y3Rpb24gZm9yIHBlcmZvcm1hbmNlIGdhaW4uIEl0IGlzIHN0cm9uZ2x5IHJlY29tbWVuZGVkIHRvIGtlZXAgdGhlc2UKICAgIAkJICogY2hlY2tzIGVuYWJsZWQgZHVyaW5nIGRldmVsb3BtZW50LiBJZiB0aGUgc2hhZGVyIGRvZXMgbm90IGNvbXBpbGUgYW5kIGxpbmsgLSBpdCB3aWxsIG5vdAogICAgCQkgKiB3b3JrIGFuZCBhc3NvY2lhdGVkIG1hdGVyaWFsIHdpbGwgbm90IHJlbmRlci4KICAgIAkJICogLSBgb25TaGFkZXJFcnJvcihnbCwgcHJvZ3JhbSwgZ2xWZXJ0ZXhTaGFkZXIsZ2xGcmFnbWVudFNoYWRlcilgOiBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQKICAgIAkJICogY2FuIGJlIHVzZWQgZm9yIGN1c3RvbSBlcnJvciByZXBvcnRpbmcuIFRoZSBjYWxsYmFjayByZWNlaXZlcyB0aGUgV2ViR0wgY29udGV4dCwgYW4gaW5zdGFuY2UKICAgIAkJICogb2YgV2ViR0xQcm9ncmFtIGFzIHdlbGwgdHdvIGluc3RhbmNlcyBvZiBXZWJHTFNoYWRlciByZXByZXNlbnRpbmcgdGhlIHZlcnRleCBhbmQgZnJhZ21lbnQgc2hhZGVyLgogICAgCQkgKiBBc3NpZ25pbmcgYSBjdXN0b20gZnVuY3Rpb24gZGlzYWJsZXMgdGhlIGRlZmF1bHQgZXJyb3IgcmVwb3J0aW5nLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkgKi8KICAgIAkJdGhpcy5kZWJ1ZyA9IHsKCiAgICAJCQkvKioKICAgIAkJCSAqIEVuYWJsZXMgZXJyb3IgY2hlY2tpbmcgYW5kIHJlcG9ydGluZyB3aGVuIHNoYWRlciBwcm9ncmFtcyBhcmUgYmVpbmcgY29tcGlsZWQuCiAgICAJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KICAgIAkJCSAqLwogICAgCQkJY2hlY2tTaGFkZXJFcnJvcnM6IHRydWUsCiAgICAJCQkvKioKICAgIAkJCSAqIENhbGxiYWNrIGZvciBjdXN0b20gZXJyb3IgcmVwb3J0aW5nLgogICAgCQkJICogQHR5cGUgez9GdW5jdGlvbn0KICAgIAkJCSAqLwogICAgCQkJb25TaGFkZXJFcnJvcjogbnVsbAogICAgCQl9OwoKICAgIAkJLy8gY2xlYXJpbmcKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRoZSByZW5kZXJlciBzaG91bGQgYXV0b21hdGljYWxseSBjbGVhciBpdHMgb3V0cHV0IGJlZm9yZSByZW5kZXJpbmcgYSBmcmFtZSBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmF1dG9DbGVhciA9IHRydWU7CgogICAgCQkvKioKICAgIAkJICogSWYge0BsaW5rIFdlYkdMUmVuZGVyZXIjYXV0b0NsZWFyfSBzZXQgdG8gYHRydWVgLCB3aGV0aGVyIHRoZSByZW5kZXJlciBzaG91bGQgY2xlYXIKICAgIAkJICogdGhlIGNvbG9yIGJ1ZmZlciBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmF1dG9DbGVhckNvbG9yID0gdHJ1ZTsKCiAgICAJCS8qKgogICAgCQkgKiBJZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNhdXRvQ2xlYXJ9IHNldCB0byBgdHJ1ZWAsIHdoZXRoZXIgdGhlIHJlbmRlcmVyIHNob3VsZCBjbGVhcgogICAgCQkgKiB0aGUgZGVwdGggYnVmZmVyIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuYXV0b0NsZWFyRGVwdGggPSB0cnVlOwoKICAgIAkJLyoqCiAgICAJCSAqIElmIHtAbGluayBXZWJHTFJlbmRlcmVyI2F1dG9DbGVhcn0gc2V0IHRvIGB0cnVlYCwgd2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGNsZWFyCiAgICAJCSAqIHRoZSBzdGVuY2lsIGJ1ZmZlciBvciBub3QuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtib29sZWFufQogICAgCQkgKiBAZGVmYXVsdCB0cnVlCiAgICAJCSAqLwogICAgCQl0aGlzLmF1dG9DbGVhclN0ZW5jaWwgPSB0cnVlOwoKICAgIAkJLy8gc2NlbmUgZ3JhcGgKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRoZSByZW5kZXJlciBzaG91bGQgc29ydCBvYmplY3RzIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogTm90ZTogU29ydGluZyBpcyB1c2VkIHRvIGF0dGVtcHQgdG8gcHJvcGVybHkgcmVuZGVyIG9iamVjdHMgdGhhdCBoYXZlIHNvbWUKICAgIAkJICogZGVncmVlIG9mIHRyYW5zcGFyZW5jeS4gQnkgZGVmaW5pdGlvbiwgc29ydGluZyBvYmplY3RzIG1heSBub3Qgd29yayBpbiBhbGwKICAgIAkJICogY2FzZXMuIERlcGVuZGluZyBvbiB0aGUgbmVlZHMgb2YgYXBwbGljYXRpb24sIGl0IG1heSBiZSBuZWNlc3NhcnkgdG8gdHVybgogICAgCQkgKiBvZmYgc29ydGluZyBhbmQgdXNlIG90aGVyIG1ldGhvZHMgdG8gZGVhbCB3aXRoIHRyYW5zcGFyZW5jeSByZW5kZXJpbmcgZS5nLgogICAgCQkgKiBtYW51YWxseSBkZXRlcm1pbmluZyBlYWNoIG9iamVjdCdzIHJlbmRlcmluZyBvcmRlci4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IHRydWUKICAgIAkJICovCiAgICAJCXRoaXMuc29ydE9iamVjdHMgPSB0cnVlOwoKICAgIAkJLy8gdXNlci1kZWZpbmVkIGNsaXBwaW5nCgogICAgCQkvKioKICAgIAkJICogVXNlci1kZWZpbmVkIGNsaXBwaW5nIHBsYW5lcyBzcGVjaWZpZWQgaW4gd29ybGQgc3BhY2UuIFRoZXNlIHBsYW5lcyBhcHBseSBnbG9iYWxseS4KICAgIAkJICogUG9pbnRzIGluIHNwYWNlIHdob3NlIGRvdCBwcm9kdWN0IHdpdGggdGhlIHBsYW5lIGlzIG5lZ2F0aXZlIGFyZSBjdXQgYXdheS4KICAgIAkJICoKICAgIAkJICogQHR5cGUge0FycmF5PFBsYW5lPn0KICAgIAkJICovCiAgICAJCXRoaXMuY2xpcHBpbmdQbGFuZXMgPSBbXTsKCiAgICAJCS8qKgogICAgCQkgKiBXaGV0aGVyIHRoZSByZW5kZXJlciByZXNwZWN0cyBvYmplY3QtbGV2ZWwgY2xpcHBpbmcgcGxhbmVzIG9yIG5vdC4KICAgIAkJICoKICAgIAkJICogQHR5cGUge2Jvb2xlYW59CiAgICAJCSAqIEBkZWZhdWx0IGZhbHNlCiAgICAJCSAqLwogICAgCQl0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CgogICAgCQkvLyB0b25lIG1hcHBpbmcKCiAgICAJCS8qKgogICAgCQkgKiBUaGUgdG9uZSBtYXBwaW5nIHRlY2huaXF1ZSBvZiB0aGUgcmVuZGVyZXIuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHsoTm9Ub25lTWFwcGluZ3xMaW5lYXJUb25lTWFwcGluZ3xSZWluaGFyZFRvbmVNYXBwaW5nfENpbmVvblRvbmVNYXBwaW5nfEFDRVNGaWxtaWNUb25lTWFwcGluZ3xDdXN0b21Ub25lTWFwcGluZ3xBZ1hUb25lTWFwcGluZ3xOZXV0cmFsVG9uZU1hcHBpbmcpfQogICAgCQkgKiBAZGVmYXVsdCBOb1RvbmVNYXBwaW5nCiAgICAJCSAqLwogICAgCQl0aGlzLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCiAgICAJCS8qKgogICAgCQkgKiBFeHBvc3VyZSBsZXZlbCBvZiB0b25lIG1hcHBpbmcuCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSA9IDEuMDsKCiAgICAJCS8vIHRyYW5zbWlzc2lvbgoKICAgIAkJLyoqCiAgICAJCSAqIFRoZSBub3JtYWxpemVkIHJlc29sdXRpb24gc2NhbGUgZm9yIHRoZSB0cmFuc21pc3Npb24gcmVuZGVyIHRhcmdldCwgbWVhc3VyZWQgaW4gcGVyY2VudGFnZQogICAgCQkgKiBvZiB2aWV3cG9ydCBkaW1lbnNpb25zLiBMb3dlcmluZyB0aGlzIHZhbHVlIGNhbiByZXN1bHQgaW4gc2lnbmlmaWNhbnQgcGVyZm9ybWFuY2UgaW1wcm92ZW1lbnRzCiAgICAJCSAqIHdoZW4gdXNpbmcge0BsaW5rIE1lc2hQaHlzaWNhbE1hdGVyaWFsI3RyYW5zbWlzc2lvbn0uCiAgICAJCSAqCiAgICAJCSAqIEB0eXBlIHtudW1iZXJ9CiAgICAJCSAqIEBkZWZhdWx0IDEKICAgIAkJICovCiAgICAJCXRoaXMudHJhbnNtaXNzaW9uUmVzb2x1dGlvblNjYWxlID0gMS4wOwoKICAgIAkJLy8gaW50ZXJuYWwgcHJvcGVydGllcwoKICAgIAkJY29uc3QgX3RoaXMgPSB0aGlzOwoKICAgIAkJbGV0IF9pc0NvbnRleHRMb3N0ID0gZmFsc2U7CgogICAgCQkvLyBpbnRlcm5hbCBzdGF0ZSBjYWNoZQoKICAgIAkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlOwoKICAgIAkJbGV0IF9jdXJyZW50QWN0aXZlQ3ViZUZhY2UgPSAwOwogICAgCQlsZXQgX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IDA7CiAgICAJCWxldCBfY3VycmVudFJlbmRlclRhcmdldCA9IG51bGw7CiAgICAJCWxldCBfY3VycmVudE1hdGVyaWFsSWQgPSAtMTsKCiAgICAJCWxldCBfY3VycmVudENhbWVyYSA9IG51bGw7CgogICAgCQljb25zdCBfY3VycmVudFZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKICAgIAkJY29uc3QgX2N1cnJlbnRTY2lzc29yID0gbmV3IFZlY3RvcjQoKTsKICAgIAkJbGV0IF9jdXJyZW50U2Npc3NvclRlc3QgPSBudWxsOwoKICAgIAkJY29uc3QgX2N1cnJlbnRDbGVhckNvbG9yID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwogICAgCQlsZXQgX2N1cnJlbnRDbGVhckFscGhhID0gMDsKCiAgICAJCS8vCgogICAgCQlsZXQgX3dpZHRoID0gY2FudmFzLndpZHRoOwogICAgCQlsZXQgX2hlaWdodCA9IGNhbnZhcy5oZWlnaHQ7CgogICAgCQlsZXQgX3BpeGVsUmF0aW8gPSAxOwogICAgCQlsZXQgX29wYXF1ZVNvcnQgPSBudWxsOwogICAgCQlsZXQgX3RyYW5zcGFyZW50U29ydCA9IG51bGw7CgogICAgCQljb25zdCBfdmlld3BvcnQgPSBuZXcgVmVjdG9yNCggMCwgMCwgX3dpZHRoLCBfaGVpZ2h0ICk7CiAgICAJCWNvbnN0IF9zY2lzc29yID0gbmV3IFZlY3RvcjQoIDAsIDAsIF93aWR0aCwgX2hlaWdodCApOwogICAgCQlsZXQgX3NjaXNzb3JUZXN0ID0gZmFsc2U7CgogICAgCQkvLyBmcnVzdHVtCgogICAgCQljb25zdCBfZnJ1c3R1bSA9IG5ldyBGcnVzdHVtKCk7CgogICAgCQkvLyBjbGlwcGluZwoKICAgIAkJbGV0IF9jbGlwcGluZ0VuYWJsZWQgPSBmYWxzZTsKICAgIAkJbGV0IF9sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwoKICAgIAkJLy8gY2FtZXJhIG1hdHJpY2VzIGNhY2hlCgogICAgCQljb25zdCBfY3VycmVudFByb2plY3Rpb25NYXRyaXggPSBuZXcgTWF0cml4NCgpOwogICAgCQljb25zdCBfcHJvalNjcmVlbk1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgogICAgCQljb25zdCBfdmVjdG9yMyA9IG5ldyBWZWN0b3IzKCk7CgogICAgCQljb25zdCBfdmVjdG9yNCA9IG5ldyBWZWN0b3I0KCk7CgogICAgCQljb25zdCBfZW1wdHlTY2VuZSA9IHsgYmFja2dyb3VuZDogbnVsbCwgZm9nOiBudWxsLCBlbnZpcm9ubWVudDogbnVsbCwgb3ZlcnJpZGVNYXRlcmlhbDogbnVsbCwgaXNTY2VuZTogdHJ1ZSB9OwoKICAgIAkJbGV0IF9yZW5kZXJCYWNrZ3JvdW5kID0gZmFsc2U7CgogICAgCQlmdW5jdGlvbiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgewoKICAgIAkJCXJldHVybiBfY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCA/IF9waXhlbFJhdGlvIDogMTsKCiAgICAJCX0KCiAgICAJCS8vIGluaXRpYWxpemUKCiAgICAJCWxldCBfZ2wgPSBjb250ZXh0OwoKICAgIAkJZnVuY3Rpb24gZ2V0Q29udGV4dCggY29udGV4dE5hbWUsIGNvbnRleHRBdHRyaWJ1dGVzICkgewoKICAgIAkJCXJldHVybiBjYW52YXMuZ2V0Q29udGV4dCggY29udGV4dE5hbWUsIGNvbnRleHRBdHRyaWJ1dGVzICk7CgogICAgCQl9CgogICAgCQl0cnkgewoKICAgIAkJCWNvbnN0IGNvbnRleHRBdHRyaWJ1dGVzID0gewogICAgCQkJCWFscGhhOiB0cnVlLAogICAgCQkJCWRlcHRoLAogICAgCQkJCXN0ZW5jaWwsCiAgICAJCQkJYW50aWFsaWFzLAogICAgCQkJCXByZW11bHRpcGxpZWRBbHBoYSwKICAgIAkJCQlwcmVzZXJ2ZURyYXdpbmdCdWZmZXIsCiAgICAJCQkJcG93ZXJQcmVmZXJlbmNlLAogICAgCQkJCWZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQsCiAgICAJCQl9OwoKICAgIAkJCS8vIE9mZnNjcmVlbkNhbnZhcyBkb2VzIG5vdCBoYXZlIHNldEF0dHJpYnV0ZSwgc2VlICMyMjgxMQogICAgCQkJaWYgKCAnc2V0QXR0cmlidXRlJyBpbiBjYW52YXMgKSBjYW52YXMuc2V0QXR0cmlidXRlKCAnZGF0YS1lbmdpbmUnLCBgdGhyZWUuanMgciR7UkVWSVNJT059YCApOwoKICAgIAkJCS8vIGV2ZW50IGxpc3RlbmVycyBtdXN0IGJlIHJlZ2lzdGVyZWQgYmVmb3JlIFdlYkdMIGNvbnRleHQgaXMgY3JlYXRlZCwgc2VlICMxMjc1MwogICAgCQkJY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRsb3N0Jywgb25Db250ZXh0TG9zdCwgZmFsc2UgKTsKICAgIAkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0cmVzdG9yZWQnLCBvbkNvbnRleHRSZXN0b3JlLCBmYWxzZSApOwogICAgCQkJY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRjcmVhdGlvbmVycm9yJywgb25Db250ZXh0Q3JlYXRpb25FcnJvciwgZmFsc2UgKTsKCiAgICAJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCiAgICAJCQkJY29uc3QgY29udGV4dE5hbWUgPSAnd2ViZ2wyJzsKCiAgICAJCQkJX2dsID0gZ2V0Q29udGV4dCggY29udGV4dE5hbWUsIGNvbnRleHRBdHRyaWJ1dGVzICk7CgogICAgCQkJCWlmICggX2dsID09PSBudWxsICkgewoKICAgIAkJCQkJaWYgKCBnZXRDb250ZXh0KCBjb250ZXh0TmFtZSApICkgewoKICAgIAkJCQkJCXRocm93IG5ldyBFcnJvciggJ0Vycm9yIGNyZWF0aW5nIFdlYkdMIGNvbnRleHQgd2l0aCB5b3VyIHNlbGVjdGVkIGF0dHJpYnV0ZXMuJyApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0LicgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCX0gY2F0Y2ggKCBlcnJvciApIHsKCiAgICAJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogJyArIGVycm9yLm1lc3NhZ2UgKTsKICAgIAkJCXRocm93IGVycm9yOwoKICAgIAkJfQoKICAgIAkJbGV0IGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgc3RhdGUsIGluZm87CiAgICAJCWxldCBwcm9wZXJ0aWVzLCB0ZXh0dXJlcywgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGF0dHJpYnV0ZXMsIGdlb21ldHJpZXMsIG9iamVjdHM7CiAgICAJCWxldCBwcm9ncmFtQ2FjaGUsIG1hdGVyaWFscywgcmVuZGVyTGlzdHMsIHJlbmRlclN0YXRlcywgY2xpcHBpbmcsIHNoYWRvd01hcDsKCiAgICAJCWxldCBiYWNrZ3JvdW5kLCBtb3JwaHRhcmdldHMsIGJ1ZmZlclJlbmRlcmVyLCBpbmRleGVkQnVmZmVyUmVuZGVyZXI7CgogICAgCQlsZXQgdXRpbHMsIGJpbmRpbmdTdGF0ZXMsIHVuaWZvcm1zR3JvdXBzOwoKICAgIAkJZnVuY3Rpb24gaW5pdEdMQ29udGV4dCgpIHsKCiAgICAJCQlleHRlbnNpb25zID0gbmV3IFdlYkdMRXh0ZW5zaW9ucyggX2dsICk7CiAgICAJCQlleHRlbnNpb25zLmluaXQoKTsKCiAgICAJCQl1dGlscyA9IG5ldyBXZWJHTFV0aWxzKCBfZ2wsIGV4dGVuc2lvbnMgKTsKCiAgICAJCQljYXBhYmlsaXRpZXMgPSBuZXcgV2ViR0xDYXBhYmlsaXRpZXMoIF9nbCwgZXh0ZW5zaW9ucywgcGFyYW1ldGVycywgdXRpbHMgKTsKCiAgICAJCQlzdGF0ZSA9IG5ldyBXZWJHTFN0YXRlKCBfZ2wsIGV4dGVuc2lvbnMgKTsKCiAgICAJCQlpZiAoIGNhcGFiaWxpdGllcy5yZXZlcnNlRGVwdGhCdWZmZXIgJiYgcmV2ZXJzZURlcHRoQnVmZmVyICkgewoKICAgIAkJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFJldmVyc2VkKCB0cnVlICk7CgogICAgCQkJfQoKICAgIAkJCWluZm8gPSBuZXcgV2ViR0xJbmZvKCBfZ2wgKTsKICAgIAkJCXByb3BlcnRpZXMgPSBuZXcgV2ViR0xQcm9wZXJ0aWVzKCk7CiAgICAJCQl0ZXh0dXJlcyA9IG5ldyBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICk7CiAgICAJCQljdWJlbWFwcyA9IG5ldyBXZWJHTEN1YmVNYXBzKCBfdGhpcyApOwogICAgCQkJY3ViZXV2bWFwcyA9IG5ldyBXZWJHTEN1YmVVVk1hcHMoIF90aGlzICk7CiAgICAJCQlhdHRyaWJ1dGVzID0gbmV3IFdlYkdMQXR0cmlidXRlcyggX2dsICk7CiAgICAJCQliaW5kaW5nU3RhdGVzID0gbmV3IFdlYkdMQmluZGluZ1N0YXRlcyggX2dsLCBhdHRyaWJ1dGVzICk7CiAgICAJCQlnZW9tZXRyaWVzID0gbmV3IFdlYkdMR2VvbWV0cmllcyggX2dsLCBhdHRyaWJ1dGVzLCBpbmZvLCBiaW5kaW5nU3RhdGVzICk7CiAgICAJCQlvYmplY3RzID0gbmV3IFdlYkdMT2JqZWN0cyggX2dsLCBnZW9tZXRyaWVzLCBhdHRyaWJ1dGVzLCBpbmZvICk7CiAgICAJCQltb3JwaHRhcmdldHMgPSBuZXcgV2ViR0xNb3JwaHRhcmdldHMoIF9nbCwgY2FwYWJpbGl0aWVzLCB0ZXh0dXJlcyApOwogICAgCQkJY2xpcHBpbmcgPSBuZXcgV2ViR0xDbGlwcGluZyggcHJvcGVydGllcyApOwogICAgCQkJcHJvZ3JhbUNhY2hlID0gbmV3IFdlYkdMUHJvZ3JhbXMoIF90aGlzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzLCBiaW5kaW5nU3RhdGVzLCBjbGlwcGluZyApOwogICAgCQkJbWF0ZXJpYWxzID0gbmV3IFdlYkdMTWF0ZXJpYWxzKCBfdGhpcywgcHJvcGVydGllcyApOwogICAgCQkJcmVuZGVyTGlzdHMgPSBuZXcgV2ViR0xSZW5kZXJMaXN0cygpOwogICAgCQkJcmVuZGVyU3RhdGVzID0gbmV3IFdlYkdMUmVuZGVyU3RhdGVzKCBleHRlbnNpb25zICk7CiAgICAJCQliYWNrZ3JvdW5kID0gbmV3IFdlYkdMQmFja2dyb3VuZCggX3RoaXMsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBzdGF0ZSwgb2JqZWN0cywgX2FscGhhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKTsKICAgIAkJCXNoYWRvd01hcCA9IG5ldyBXZWJHTFNoYWRvd01hcCggX3RoaXMsIG9iamVjdHMsIGNhcGFiaWxpdGllcyApOwogICAgCQkJdW5pZm9ybXNHcm91cHMgPSBuZXcgV2ViR0xVbmlmb3Jtc0dyb3VwcyggX2dsLCBpbmZvLCBjYXBhYmlsaXRpZXMsIHN0YXRlICk7CgogICAgCQkJYnVmZmVyUmVuZGVyZXIgPSBuZXcgV2ViR0xCdWZmZXJSZW5kZXJlciggX2dsLCBleHRlbnNpb25zLCBpbmZvICk7CiAgICAJCQlpbmRleGVkQnVmZmVyUmVuZGVyZXIgPSBuZXcgV2ViR0xJbmRleGVkQnVmZmVyUmVuZGVyZXIoIF9nbCwgZXh0ZW5zaW9ucywgaW5mbyApOwoKICAgIAkJCWluZm8ucHJvZ3JhbXMgPSBwcm9ncmFtQ2FjaGUucHJvZ3JhbXM7CgogICAgCQkJLyoqCiAgICAJCQkgKiBIb2xkcyBkZXRhaWxzIGFib3V0IHRoZSBjYXBhYmlsaXRpZXMgb2YgdGhlIGN1cnJlbnQgcmVuZGVyaW5nIGNvbnRleHQuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNjYXBhYmlsaXRpZXMKICAgIAkJCSAqIEB0eXBlIHtXZWJHTFJlbmRlcmVyfkNhcGFiaWxpdGllc30KICAgIAkJCSAqLwogICAgCQkJX3RoaXMuY2FwYWJpbGl0aWVzID0gY2FwYWJpbGl0aWVzOwoKICAgIAkJCS8qKgogICAgCQkJICogUHJvdmlkZXMgbWV0aG9kcyBmb3IgcmV0cmlldmluZyBhbmQgdGVzdGluZyBXZWJHTCBleHRlbnNpb25zLgogICAgCQkJICoKICAgIAkJCSAqIC0gYGdldChleHRlbnNpb25OYW1lOnN0cmluZylgOiBVc2VkIHRvIGNoZWNrIHdoZXRoZXIgYSBXZWJHTCBleHRlbnNpb24gaXMgc3VwcG9ydGVkCiAgICAJCQkgKiBhbmQgcmV0dXJuIHRoZSBleHRlbnNpb24gb2JqZWN0IGlmIGF2YWlsYWJsZS4KICAgIAkJCSAqIC0gYGhhcyhleHRlbnNpb25OYW1lOnN0cmluZylgOiByZXR1cm5zIGB0cnVlYCBpZiB0aGUgZXh0ZW5zaW9uIGlzIHN1cHBvcnRlZC4KICAgIAkJCSAqCiAgICAJCQkgKiBAbmFtZSBXZWJHTFJlbmRlcmVyI2V4dGVuc2lvbnMKICAgIAkJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCQkgKi8KICAgIAkJCV90aGlzLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zOwoKICAgIAkJCS8qKgogICAgCQkJICogVXNlZCB0byB0cmFjayBwcm9wZXJ0aWVzIG9mIG90aGVyIG9iamVjdHMgbGlrZSBuYXRpdmUgV2ViR0wgb2JqZWN0cy4KICAgIAkJCSAqCiAgICAJCQkgKiBAbmFtZSBXZWJHTFJlbmRlcmVyI3Byb3BlcnRpZXMKICAgIAkJCSAqIEB0eXBlIHtPYmplY3R9CiAgICAJCQkgKi8KICAgIAkJCV90aGlzLnByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzOwoKICAgIAkJCS8qKgogICAgCQkJICogTWFuYWdlcyB0aGUgcmVuZGVyIGxpc3RzIG9mIHRoZSByZW5kZXJlci4KICAgIAkJCSAqCiAgICAJCQkgKiBAbmFtZSBXZWJHTFJlbmRlcmVyI3JlbmRlckxpc3RzCiAgICAJCQkgKiBAdHlwZSB7T2JqZWN0fQogICAgCQkJICovCiAgICAJCQlfdGhpcy5yZW5kZXJMaXN0cyA9IHJlbmRlckxpc3RzOwoKCgogICAgCQkJLyoqCiAgICAJCQkgKiBJbnRlcmZhY2UgZm9yIG1hbmFnaW5nIHNoYWRvd3MuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNzaGFkb3dNYXAKICAgIAkJCSAqIEB0eXBlIHtXZWJHTFJlbmRlcmVyflNoYWRvd01hcH0KICAgIAkJCSAqLwogICAgCQkJX3RoaXMuc2hhZG93TWFwID0gc2hhZG93TWFwOwoKICAgIAkJCS8qKgogICAgCQkJICogSW50ZXJmYWNlIGZvciBtYW5hZ2luZyB0aGUgV2ViR0wgc3RhdGUuCiAgICAJCQkgKgogICAgCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNzdGF0ZQogICAgCQkJICogQHR5cGUge09iamVjdH0KICAgIAkJCSAqLwogICAgCQkJX3RoaXMuc3RhdGUgPSBzdGF0ZTsKCiAgICAJCQkvKioKICAgIAkJCSAqIEhvbGRzIGEgc2VyaWVzIG9mIHN0YXRpc3RpY2FsIGluZm9ybWF0aW9uIGFib3V0IHRoZSBHUFUgbWVtb3J5CiAgICAJCQkgKiBhbmQgdGhlIHJlbmRlcmluZyBwcm9jZXNzLiBVc2VmdWwgZm9yIGRlYnVnZ2luZyBhbmQgbW9uaXRvcmluZy4KICAgIAkJCSAqCiAgICAJCQkgKiBCeSBkZWZhdWx0IHRoZXNlIGRhdGEgYXJlIHJlc2V0IGF0IGVhY2ggcmVuZGVyIGNhbGwgYnV0IHdoZW4gaGF2aW5nCiAgICAJCQkgKiBtdWx0aXBsZSByZW5kZXIgcGFzc2VzIHBlciBmcmFtZSAoZS5nLiB3aGVuIHVzaW5nIHBvc3QgcHJvY2Vzc2luZykgaXQgY2FuCiAgICAJCQkgKiBiZSBwcmVmZXJyZWQgdG8gcmVzZXQgd2l0aCBhIGN1c3RvbSBwYXR0ZXJuLiBGaXJzdCwgc2V0IGBhdXRvUmVzZXRgIHRvCiAgICAJCQkgKiBgZmFsc2VgLgogICAgCQkJICogYGBganMKICAgIAkJCSAqIHJlbmRlcmVyLmluZm8uYXV0b1Jlc2V0ID0gZmFsc2U7CiAgICAJCQkgKiBgYGAKICAgIAkJCSAqIENhbGwgYHJlc2V0KClgIHdoZW5ldmVyIHlvdSBoYXZlIGZpbmlzaGVkIHRvIHJlbmRlciBhIHNpbmdsZSBmcmFtZS4KICAgIAkJCSAqIGBgYGpzCiAgICAJCQkgKiByZW5kZXJlci5pbmZvLnJlc2V0KCk7CiAgICAJCQkgKiBgYGAKICAgIAkJCSAqCiAgICAJCQkgKiBAbmFtZSBXZWJHTFJlbmRlcmVyI2luZm8KICAgIAkJCSAqIEB0eXBlIHtXZWJHTFJlbmRlcmVyfkluZm99CiAgICAJCQkgKi8KICAgIAkJCV90aGlzLmluZm8gPSBpbmZvOwoKICAgIAkJfQoKICAgIAkJaW5pdEdMQ29udGV4dCgpOwoKICAgIAkJLy8geHIKCiAgICAJCWNvbnN0IHhyID0gbmV3IFdlYlhSTWFuYWdlciggX3RoaXMsIF9nbCApOwoKICAgIAkJLyoqCiAgICAJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBYUiBtYW5hZ2VyLgogICAgCQkgKgogICAgCQkgKiBAdHlwZSB7V2ViWFJNYW5hZ2VyfQogICAgCQkgKi8KICAgIAkJdGhpcy54ciA9IHhyOwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIHJlbmRlcmluZyBjb250ZXh0LgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHtXZWJHTDJSZW5kZXJpbmdDb250ZXh0fSBUaGUgcmVuZGVyaW5nIGNvbnRleHQuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldENvbnRleHQgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIF9nbDsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgcmVuZGVyaW5nIGNvbnRleHQgYXR0cmlidXRlcy4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7V2ViR0xDb250ZXh0QXR0cmlidXRlc30gVGhlIHJlbmRlcmluZyBjb250ZXh0IGF0dHJpYnV0ZXMuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldENvbnRleHRBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBfZ2wuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2ltdWxhdGVzIGEgbG9zcyBvZiB0aGUgV2ViR0wgY29udGV4dC4gVGhpcyByZXF1aXJlcyBzdXBwb3J0IGZvciB0aGUgYFdFQkdMX2xvc2VfY29udGV4dGAgZXh0ZW5zaW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5mb3JjZUNvbnRleHRMb3NzID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbG9zZV9jb250ZXh0JyApOwogICAgCQkJaWYgKCBleHRlbnNpb24gKSBleHRlbnNpb24ubG9zZUNvbnRleHQoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2ltdWxhdGVzIGEgcmVzdG9yZSBvZiB0aGUgV2ViR0wgY29udGV4dC4gVGhpcyByZXF1aXJlcyBzdXBwb3J0IGZvciB0aGUgYFdFQkdMX2xvc2VfY29udGV4dGAgZXh0ZW5zaW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5mb3JjZUNvbnRleHRSZXN0b3JlID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbG9zZV9jb250ZXh0JyApOwogICAgCQkJaWYgKCBleHRlbnNpb24gKSBleHRlbnNpb24ucmVzdG9yZUNvbnRleHQoKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgcGl4ZWwgcmF0aW8uCiAgICAJCSAqCiAgICAJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHBpeGVsIHJhdGlvLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRQaXhlbFJhdGlvID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXJldHVybiBfcGl4ZWxSYXRpbzsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgZ2l2ZW4gcGl4ZWwgcmF0aW8gYW5kIHJlc2l6ZXMgdGhlIGNhbnZhcyBpZiBuZWNlc3NhcnkuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSBwaXhlbCByYXRpby4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgogICAgCQkJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKICAgIAkJCV9waXhlbFJhdGlvID0gdmFsdWU7CgogICAgCQkJdGhpcy5zZXRTaXplKCBfd2lkdGgsIF9oZWlnaHQsIGZhbHNlICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIHJlbmRlcmVyJ3Mgc2l6ZSBpbiBsb2dpY2FsIHBpeGVscy4gVGhpcyBtZXRob2QgZG9lcyBub3QgaG9ub3IgdGhlIHBpeGVsIHJhdGlvLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHRhcmdldCAtIFRoZSBtZXRob2Qgd3JpdGVzIHRoZSByZXN1bHQgaW4gdGhpcyB0YXJnZXQgb2JqZWN0LgogICAgCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBUaGUgcmVuZGVyZXIncyBzaXplIGluIGxvZ2ljYWwgcGl4ZWxzLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRTaXplID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5zZXQoIF93aWR0aCwgX2hlaWdodCApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXNpemVzIHRoZSBvdXRwdXQgY2FudmFzIHRvICh3aWR0aCwgaGVpZ2h0KSB3aXRoIGRldmljZSBwaXhlbCByYXRpbyB0YWtlbgogICAgCQkgKiBpbnRvIGFjY291bnQsIGFuZCBhbHNvIHNldHMgdGhlIHZpZXdwb3J0IHRvIGZpdCB0aGF0IHNpemUsIHN0YXJ0aW5nIGluICgwLAogICAgCQkgKiAwKS4gU2V0dGluZyBgdXBkYXRlU3R5bGVgIHRvIGZhbHNlIHByZXZlbnRzIGFueSBzdHlsZSBjaGFuZ2VzIHRvIHRoZSBvdXRwdXQgY2FudmFzLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggaW4gbG9naWNhbCBwaXhlbHMuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IGluIGxvZ2ljYWwgcGl4ZWxzLgogICAgCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGVTdHlsZT10cnVlXSAtIFdoZXRoZXIgdG8gdXBkYXRlIHRoZSBgc3R5bGVgIGF0dHJpYnV0ZSBvZiB0aGUgY2FudmFzIG9yIG5vdC4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0U2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgdXBkYXRlU3R5bGUgPSB0cnVlICkgewoKICAgIAkJCWlmICggeHIuaXNQcmVzZW50aW5nICkgewoKICAgIAkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDYW5cJ3QgY2hhbmdlIHNpemUgd2hpbGUgVlIgZGV2aWNlIGlzIHByZXNlbnRpbmcuJyApOwogICAgCQkJCXJldHVybjsKCiAgICAJCQl9CgogICAgCQkJX3dpZHRoID0gd2lkdGg7CiAgICAJCQlfaGVpZ2h0ID0gaGVpZ2h0OwoKICAgIAkJCWNhbnZhcy53aWR0aCA9IE1hdGguZmxvb3IoIHdpZHRoICogX3BpeGVsUmF0aW8gKTsKICAgIAkJCWNhbnZhcy5oZWlnaHQgPSBNYXRoLmZsb29yKCBoZWlnaHQgKiBfcGl4ZWxSYXRpbyApOwoKICAgIAkJCWlmICggdXBkYXRlU3R5bGUgPT09IHRydWUgKSB7CgogICAgCQkJCWNhbnZhcy5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JzsKICAgIAkJCQljYW52YXMuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgJ3B4JzsKCiAgICAJCQl9CgogICAgCQkJdGhpcy5zZXRWaWV3cG9ydCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBkcmF3aW5nIGJ1ZmZlciBzaXplIGluIHBoeXNpY2FsIHBpeGVscy4gVGhpcyBtZXRob2QgaG9ub3JzIHRoZSBwaXhlbCByYXRpby4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KICAgIAkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIGRyYXdpbmcgYnVmZmVyIHNpemUuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldERyYXdpbmdCdWZmZXJTaXplID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5zZXQoIF93aWR0aCAqIF9waXhlbFJhdGlvLCBfaGVpZ2h0ICogX3BpeGVsUmF0aW8gKS5mbG9vcigpOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBUaGlzIG1ldGhvZCBhbGxvd3MgdG8gZGVmaW5lIHRoZSBkcmF3aW5nIGJ1ZmZlciBzaXplIGJ5IHNwZWNpZnlpbmcKICAgIAkJICogd2lkdGgsIGhlaWdodCBhbmQgcGl4ZWwgcmF0aW8gYWxsIGF0IG9uY2UuIFRoZSBzaXplIG9mIHRoZSBkcmF3aW5nCiAgICAJCSAqIGJ1ZmZlciBpcyBjb21wdXRlZCB3aXRoIHRoaXMgZm9ybXVsYToKICAgIAkJICogYGBganMKICAgIAkJICogc2l6ZS54ID0gd2lkdGggKiBwaXhlbFJhdGlvOwogICAgCQkgKiBzaXplLnkgPSBoZWlnaHQgKiBwaXhlbFJhdGlvOwogICAgCQkgKiBgYGAKICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIGluIGxvZ2ljYWwgcGl4ZWxzLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBpbiBsb2dpY2FsIHBpeGVscy4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHBpeGVsUmF0aW8gLSBUaGUgcGl4ZWwgcmF0aW8uCiAgICAJCSAqLwogICAgCQl0aGlzLnNldERyYXdpbmdCdWZmZXJTaXplID0gZnVuY3Rpb24gKCB3aWR0aCwgaGVpZ2h0LCBwaXhlbFJhdGlvICkgewoKICAgIAkJCV93aWR0aCA9IHdpZHRoOwogICAgCQkJX2hlaWdodCA9IGhlaWdodDsKCiAgICAJCQlfcGl4ZWxSYXRpbyA9IHBpeGVsUmF0aW87CgogICAgCQkJY2FudmFzLndpZHRoID0gTWF0aC5mbG9vciggd2lkdGggKiBwaXhlbFJhdGlvICk7CiAgICAJCQljYW52YXMuaGVpZ2h0ID0gTWF0aC5mbG9vciggaGVpZ2h0ICogcGl4ZWxSYXRpbyApOwoKICAgIAkJCXRoaXMuc2V0Vmlld3BvcnQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgY3VycmVudCB2aWV3cG9ydCBkZWZpbml0aW9uLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHRhcmdldCAtIFRoZSBtZXRob2Qgd3JpdGVzIHRoZSByZXN1bHQgaW4gdGhpcyB0YXJnZXQgb2JqZWN0LgogICAgCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBUaGUgY3VycmVudCB2aWV3cG9ydCBkZWZpbml0aW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRDdXJyZW50Vmlld3BvcnQgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCiAgICAJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIF9jdXJyZW50Vmlld3BvcnQgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgdmlld3BvcnQgZGVmaW5pdGlvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtWZWN0b3I0fSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KICAgIAkJICogQHJldHVybiB7VmVjdG9yNH0gVGhlIHZpZXdwb3J0IGRlZmluaXRpb24uCiAgICAJCSAqLwogICAgCQl0aGlzLmdldFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfdmlld3BvcnQgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyB0aGUgdmlld3BvcnQgdG8gcmVuZGVyIGZyb20gYCh4LCB5KWAgdG8gYCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQpYC4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXIgfCBWZWN0b3I0fSB4IC0gVGhlIGhvcml6b250YWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSB2aWV3cG9ydCBvcmlnaW4gaW4gbG9naWNhbCBwaXhlbCB1bml0LgogICAgCQkgKiBPciBhbHRlcm5hdGl2ZWx5IGEgZm91ci1jb21wb25lbnQgdmVjdG9yIHNwZWNpZnlpbmcgYWxsIHRoZSBwYXJhbWV0ZXJzIG9mIHRoZSB2aWV3cG9ydC4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSB2aWV3cG9ydCBvcmlnaW4gIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSB2aWV3cG9ydCBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSB2aWV3cG9ydCBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKICAgIAkJCWlmICggeC5pc1ZlY3RvcjQgKSB7CgogICAgCQkJCV92aWV3cG9ydC5zZXQoIHgueCwgeC55LCB4LnosIHgudyApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCV92aWV3cG9ydC5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCiAgICAJCQl9CgogICAgCQkJc3RhdGUudmlld3BvcnQoIF9jdXJyZW50Vmlld3BvcnQuY29weSggX3ZpZXdwb3J0ICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkucm91bmQoKSApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBzY2lzc29yIHJlZ2lvbi4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtWZWN0b3I0fSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KICAgIAkJICogQHJldHVybiB7VmVjdG9yNH0gVGhlIHNjaXNzb3IgcmVnaW9uLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRTY2lzc29yID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgogICAgCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfc2Npc3NvciApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSBzY2lzc29yIHJlZ2lvbiB0byByZW5kZXIgZnJvbSBgKHgsIHkpYCB0byBgKHggKyB3aWR0aCwgeSArIGhlaWdodClgLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge251bWJlciB8IFZlY3RvcjR9IHggLSBUaGUgaG9yaXpvbnRhbCBjb29yZGluYXRlIGZvciB0aGUgbG93ZXIgbGVmdCBjb3JuZXIgb2YgdGhlIHNjaXNzb3IgcmVnaW9uIG9yaWdpbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCiAgICAJCSAqIE9yIGFsdGVybmF0aXZlbHkgYSBmb3VyLWNvbXBvbmVudCB2ZWN0b3Igc3BlY2lmeWluZyBhbGwgdGhlIHBhcmFtZXRlcnMgb2YgdGhlIHNjaXNzb3IgcmVnaW9uLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2ZXJ0aWNhbCBjb29yZGluYXRlIGZvciB0aGUgbG93ZXIgbGVmdCBjb3JuZXIgb2YgdGhlIHNjaXNzb3IgcmVnaW9uIG9yaWdpbiAgaW4gbG9naWNhbCBwaXhlbCB1bml0LgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHNjaXNzb3IgcmVnaW9uIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHNjaXNzb3IgcmVnaW9uIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0U2Npc3NvciA9IGZ1bmN0aW9uICggeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCiAgICAJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKICAgIAkJCQlfc2Npc3Nvci5zZXQoIHgueCwgeC55LCB4LnosIHgudyApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCV9zY2lzc29yLnNldCggeCwgeSwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJCX0KCiAgICAJCQlzdGF0ZS5zY2lzc29yKCBfY3VycmVudFNjaXNzb3IuY29weSggX3NjaXNzb3IgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKS5yb3VuZCgpICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBzY2lzc29yIHRlc3QgaXMgZW5hYmxlZC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgc2Npc3NvciB0ZXN0IGlzIGVuYWJsZWQgb3Igbm90LgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRTY2lzc29yVGVzdCA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gX3NjaXNzb3JUZXN0OwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBFbmFibGUgb3IgZGlzYWJsZSB0aGUgc2Npc3NvciB0ZXN0LiBXaGVuIHRoaXMgaXMgZW5hYmxlZCwgb25seSB0aGUgcGl4ZWxzCiAgICAJCSAqIHdpdGhpbiB0aGUgZGVmaW5lZCBzY2lzc29yIGFyZWEgd2lsbCBiZSBhZmZlY3RlZCBieSBmdXJ0aGVyIHJlbmRlcmVyCiAgICAJCSAqIGFjdGlvbnMuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gYm9vbGVhbiAtIFdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBpcyBlbmFibGVkIG9yIG5vdC4KICAgIAkJICovCiAgICAJCXRoaXMuc2V0U2Npc3NvclRlc3QgPSBmdW5jdGlvbiAoIGJvb2xlYW4gKSB7CgogICAgCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9zY2lzc29yVGVzdCA9IGJvb2xlYW4gKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyBhIGN1c3RvbSBvcGFxdWUgc29ydCBmdW5jdGlvbiBmb3IgdGhlIHJlbmRlciBsaXN0cy4gUGFzcyBgbnVsbGAKICAgIAkJICogdG8gdXNlIHRoZSBkZWZhdWx0IGBwYWludGVyU29ydFN0YWJsZWAgZnVuY3Rpb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7P0Z1bmN0aW9ufSBtZXRob2QgLSBUaGUgb3BhcXVlIHNvcnQgZnVuY3Rpb24uCiAgICAJCSAqLwogICAgCQl0aGlzLnNldE9wYXF1ZVNvcnQgPSBmdW5jdGlvbiAoIG1ldGhvZCApIHsKCiAgICAJCQlfb3BhcXVlU29ydCA9IG1ldGhvZDsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogU2V0cyBhIGN1c3RvbSB0cmFuc3BhcmVudCBzb3J0IGZ1bmN0aW9uIGZvciB0aGUgcmVuZGVyIGxpc3RzLiBQYXNzIGBudWxsYAogICAgCQkgKiB0byB1c2UgdGhlIGRlZmF1bHQgYHJldmVyc2VQYWludGVyU29ydFN0YWJsZWAgZnVuY3Rpb24uCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7P0Z1bmN0aW9ufSBtZXRob2QgLSBUaGUgb3BhcXVlIHNvcnQgZnVuY3Rpb24uCiAgICAJCSAqLwogICAgCQl0aGlzLnNldFRyYW5zcGFyZW50U29ydCA9IGZ1bmN0aW9uICggbWV0aG9kICkgewoKICAgIAkJCV90cmFuc3BhcmVudFNvcnQgPSBtZXRob2Q7CgogICAgCQl9OwoKICAgIAkJLy8gQ2xlYXJpbmcKCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBjbGVhciBjb2xvci4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtDb2xvcn0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCiAgICAJCSAqIEByZXR1cm4ge0NvbG9yfSBUaGUgY2xlYXIgY29sb3IuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldENsZWFyQ29sb3IgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCiAgICAJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGJhY2tncm91bmQuZ2V0Q2xlYXJDb2xvcigpICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIGNsZWFyIGNvbG9yIGFuZCBhbHBoYS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY2xlYXIgY29sb3IuCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWxwaGE9MV0gLSBUaGUgY2xlYXIgYWxwaGEuCiAgICAJCSAqLwogICAgCQl0aGlzLnNldENsZWFyQ29sb3IgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJYmFja2dyb3VuZC5zZXRDbGVhckNvbG9yKCAuLi5hcmd1bWVudHMgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgY2xlYXIgYWxwaGEuIFJhbmdlcyB3aXRoaW4gYFswLDFdYC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgY2xlYXIgYWxwaGEuCiAgICAJCSAqLwogICAgCQl0aGlzLmdldENsZWFyQWxwaGEgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIGJhY2tncm91bmQuZ2V0Q2xlYXJBbHBoYSgpOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBTZXRzIHRoZSBjbGVhciBhbHBoYS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGNsZWFyIGFscGhhLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRDbGVhckFscGhhID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCWJhY2tncm91bmQuc2V0Q2xlYXJBbHBoYSggLi4uYXJndW1lbnRzICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFRlbGxzIHRoZSByZW5kZXJlciB0byBjbGVhciBpdHMgY29sb3IsIGRlcHRoIG9yIHN0ZW5jaWwgZHJhd2luZyBidWZmZXIocykuCiAgICAJCSAqIFRoaXMgbWV0aG9kIGluaXRpYWxpemVzIHRoZSBidWZmZXJzIHRvIHRoZSBjdXJyZW50IGNsZWFyIGNvbG9yIHZhbHVlcy4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtib29sZWFufSBbY29sb3I9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBjb2xvciBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgogICAgCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZXB0aD10cnVlXSAtIFdoZXRoZXIgdGhlIGRlcHRoIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCiAgICAJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3N0ZW5jaWw9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBzdGVuY2lsIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCiAgICAJCSAqLwogICAgCQl0aGlzLmNsZWFyID0gZnVuY3Rpb24gKCBjb2xvciA9IHRydWUsIGRlcHRoID0gdHJ1ZSwgc3RlbmNpbCA9IHRydWUgKSB7CgogICAgCQkJbGV0IGJpdHMgPSAwOwoKICAgIAkJCWlmICggY29sb3IgKSB7CgogICAgCQkJCS8vIGNoZWNrIGlmIHdlJ3JlIHRyeWluZyB0byBjbGVhciBhbiBpbnRlZ2VyIHRhcmdldAogICAgCQkJCWxldCBpc0ludGVnZXJGb3JtYXQgPSBmYWxzZTsKICAgIAkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgewoKICAgIAkJCQkJY29uc3QgdGFyZ2V0Rm9ybWF0ID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS5mb3JtYXQ7CiAgICAJCQkJCWlzSW50ZWdlckZvcm1hdCA9IHRhcmdldEZvcm1hdCA9PT0gUkdCQUludGVnZXJGb3JtYXQgfHwKICAgIAkJCQkJCXRhcmdldEZvcm1hdCA9PT0gUkdJbnRlZ2VyRm9ybWF0IHx8CiAgICAJCQkJCQl0YXJnZXRGb3JtYXQgPT09IFJlZEludGVnZXJGb3JtYXQ7CgogICAgCQkJCX0KCiAgICAJCQkJLy8gdXNlIHRoZSBhcHByb3ByaWF0ZSBjbGVhciBmdW5jdGlvbnMgdG8gY2xlYXIgdGhlIHRhcmdldCBpZiBpdCdzIGEgc2lnbmVkCiAgICAJCQkJLy8gb3IgdW5zaWduZWQgaW50ZWdlciB0YXJnZXQKICAgIAkJCQlpZiAoIGlzSW50ZWdlckZvcm1hdCApIHsKCiAgICAJCQkJCWNvbnN0IHRhcmdldFR5cGUgPSBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLnR5cGU7CiAgICAJCQkJCWNvbnN0IGlzVW5zaWduZWRUeXBlID0gdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRCeXRlVHlwZSB8fAogICAgCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlIHx8CiAgICAJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0VHlwZSB8fAogICAgCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRJbnQyNDhUeXBlIHx8CiAgICAJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0NDQ0NFR5cGUgfHwKICAgIAkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZTsKCiAgICAJCQkJCWNvbnN0IGNsZWFyQ29sb3IgPSBiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKTsKICAgIAkJCQkJY29uc3QgYSA9IGJhY2tncm91bmQuZ2V0Q2xlYXJBbHBoYSgpOwogICAgCQkJCQljb25zdCByID0gY2xlYXJDb2xvci5yOwogICAgCQkJCQljb25zdCBnID0gY2xlYXJDb2xvci5nOwogICAgCQkJCQljb25zdCBiID0gY2xlYXJDb2xvci5iOwoKICAgIAkJCQkJaWYgKCBpc1Vuc2lnbmVkVHlwZSApIHsKCiAgICAJCQkJCQl1aW50Q2xlYXJDb2xvclsgMCBdID0gcjsKICAgIAkJCQkJCXVpbnRDbGVhckNvbG9yWyAxIF0gPSBnOwogICAgCQkJCQkJdWludENsZWFyQ29sb3JbIDIgXSA9IGI7CiAgICAJCQkJCQl1aW50Q2xlYXJDb2xvclsgMyBdID0gYTsKICAgIAkJCQkJCV9nbC5jbGVhckJ1ZmZlcnVpdiggX2dsLkNPTE9SLCAwLCB1aW50Q2xlYXJDb2xvciApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlpbnRDbGVhckNvbG9yWyAwIF0gPSByOwogICAgCQkJCQkJaW50Q2xlYXJDb2xvclsgMSBdID0gZzsKICAgIAkJCQkJCWludENsZWFyQ29sb3JbIDIgXSA9IGI7CiAgICAJCQkJCQlpbnRDbGVhckNvbG9yWyAzIF0gPSBhOwogICAgCQkJCQkJX2dsLmNsZWFyQnVmZmVyaXYoIF9nbC5DT0xPUiwgMCwgaW50Q2xlYXJDb2xvciApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJYml0cyB8PSBfZ2wuQ09MT1JfQlVGRkVSX0JJVDsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGRlcHRoICkgewoKICAgIAkJCQliaXRzIHw9IF9nbC5ERVBUSF9CVUZGRVJfQklUOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHN0ZW5jaWwgKSB7CgogICAgCQkJCWJpdHMgfD0gX2dsLlNURU5DSUxfQlVGRkVSX0JJVDsKICAgIAkJCQl0aGlzLnN0YXRlLmJ1ZmZlcnMuc3RlbmNpbC5zZXRNYXNrKCAweGZmZmZmZmZmICk7CgogICAgCQkJfQoKICAgIAkJCV9nbC5jbGVhciggYml0cyApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBDbGVhcnMgdGhlIGNvbG9yIGJ1ZmZlci4gRXF1aXZhbGVudCB0byBjYWxsaW5nIGByZW5kZXJlci5jbGVhciggdHJ1ZSwgZmFsc2UsIGZhbHNlIClgLgogICAgCQkgKi8KICAgIAkJdGhpcy5jbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXRoaXMuY2xlYXIoIHRydWUsIGZhbHNlLCBmYWxzZSApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBDbGVhcnMgdGhlIGRlcHRoIGJ1ZmZlci4gRXF1aXZhbGVudCB0byBjYWxsaW5nIGByZW5kZXJlci5jbGVhciggZmFsc2UsIHRydWUsIGZhbHNlIClgLgogICAgCQkgKi8KICAgIAkJdGhpcy5jbGVhckRlcHRoID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCXRoaXMuY2xlYXIoIGZhbHNlLCB0cnVlLCBmYWxzZSApOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBDbGVhcnMgdGhlIHN0ZW5jaWwgYnVmZmVyLiBFcXVpdmFsZW50IHRvIGNhbGxpbmcgYHJlbmRlcmVyLmNsZWFyKCBmYWxzZSwgZmFsc2UsIHRydWUgKWAuCiAgICAJCSAqLwogICAgCQl0aGlzLmNsZWFyU3RlbmNpbCA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQl0aGlzLmNsZWFyKCBmYWxzZSwgZmFsc2UsIHRydWUgKTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogRnJlZXMgdGhlIEdQVS1yZWxhdGVkIHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzCiAgICAJCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgogICAgCQkgKi8KICAgIAkJdGhpcy5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCWNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0bG9zdCcsIG9uQ29udGV4dExvc3QsIGZhbHNlICk7CiAgICAJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKICAgIAkJCWNhbnZhcy5yZW1vdmVFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0Y3JlYXRpb25lcnJvcicsIG9uQ29udGV4dENyZWF0aW9uRXJyb3IsIGZhbHNlICk7CgogICAgCQkJYmFja2dyb3VuZC5kaXNwb3NlKCk7CiAgICAJCQlyZW5kZXJMaXN0cy5kaXNwb3NlKCk7CiAgICAJCQlyZW5kZXJTdGF0ZXMuZGlzcG9zZSgpOwogICAgCQkJcHJvcGVydGllcy5kaXNwb3NlKCk7CiAgICAJCQljdWJlbWFwcy5kaXNwb3NlKCk7CiAgICAJCQljdWJldXZtYXBzLmRpc3Bvc2UoKTsKICAgIAkJCW9iamVjdHMuZGlzcG9zZSgpOwogICAgCQkJYmluZGluZ1N0YXRlcy5kaXNwb3NlKCk7CiAgICAJCQl1bmlmb3Jtc0dyb3Vwcy5kaXNwb3NlKCk7CiAgICAJCQlwcm9ncmFtQ2FjaGUuZGlzcG9zZSgpOwoKICAgIAkJCXhyLmRpc3Bvc2UoKTsKCiAgICAJCQl4ci5yZW1vdmVFdmVudExpc3RlbmVyKCAnc2Vzc2lvbnN0YXJ0Jywgb25YUlNlc3Npb25TdGFydCApOwogICAgCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25lbmQnLCBvblhSU2Vzc2lvbkVuZCApOwoKICAgIAkJCWFuaW1hdGlvbi5zdG9wKCk7CgogICAgCQl9OwoKICAgIAkJLy8gRXZlbnRzCgogICAgCQlmdW5jdGlvbiBvbkNvbnRleHRMb3N0KCBldmVudCApIHsKCiAgICAJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKICAgIAkJCWNvbnNvbGUubG9nKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ29udGV4dCBMb3N0LicgKTsKCiAgICAJCQlfaXNDb250ZXh0TG9zdCA9IHRydWU7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBvbkNvbnRleHRSZXN0b3JlKCAvKiBldmVudCAqLyApIHsKCiAgICAJCQljb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IENvbnRleHQgUmVzdG9yZWQuJyApOwoKICAgIAkJCV9pc0NvbnRleHRMb3N0ID0gZmFsc2U7CgogICAgCQkJY29uc3QgaW5mb0F1dG9SZXNldCA9IGluZm8uYXV0b1Jlc2V0OwogICAgCQkJY29uc3Qgc2hhZG93TWFwRW5hYmxlZCA9IHNoYWRvd01hcC5lbmFibGVkOwogICAgCQkJY29uc3Qgc2hhZG93TWFwQXV0b1VwZGF0ZSA9IHNoYWRvd01hcC5hdXRvVXBkYXRlOwogICAgCQkJY29uc3Qgc2hhZG93TWFwTmVlZHNVcGRhdGUgPSBzaGFkb3dNYXAubmVlZHNVcGRhdGU7CiAgICAJCQljb25zdCBzaGFkb3dNYXBUeXBlID0gc2hhZG93TWFwLnR5cGU7CgogICAgCQkJaW5pdEdMQ29udGV4dCgpOwoKICAgIAkJCWluZm8uYXV0b1Jlc2V0ID0gaW5mb0F1dG9SZXNldDsKICAgIAkJCXNoYWRvd01hcC5lbmFibGVkID0gc2hhZG93TWFwRW5hYmxlZDsKICAgIAkJCXNoYWRvd01hcC5hdXRvVXBkYXRlID0gc2hhZG93TWFwQXV0b1VwZGF0ZTsKICAgIAkJCXNoYWRvd01hcC5uZWVkc1VwZGF0ZSA9IHNoYWRvd01hcE5lZWRzVXBkYXRlOwogICAgCQkJc2hhZG93TWFwLnR5cGUgPSBzaGFkb3dNYXBUeXBlOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gb25Db250ZXh0Q3JlYXRpb25FcnJvciggZXZlbnQgKSB7CgogICAgCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEEgV2ViR0wgY29udGV4dCBjb3VsZCBub3QgYmUgY3JlYXRlZC4gUmVhc29uOiAnLCBldmVudC5zdGF0dXNNZXNzYWdlICk7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBvbk1hdGVyaWFsRGlzcG9zZSggZXZlbnQgKSB7CgogICAgCQkJY29uc3QgbWF0ZXJpYWwgPSBldmVudC50YXJnZXQ7CgogICAgCQkJbWF0ZXJpYWwucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKICAgIAkJCWRlYWxsb2NhdGVNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCiAgICAJCX0KCiAgICAJCS8vIEJ1ZmZlciBkZWFsbG9jYXRpb24KCiAgICAJCWZ1bmN0aW9uIGRlYWxsb2NhdGVNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgogICAgCQkJcmVsZWFzZU1hdGVyaWFsUHJvZ3JhbVJlZmVyZW5jZXMoIG1hdGVyaWFsICk7CgogICAgCQkJcHJvcGVydGllcy5yZW1vdmUoIG1hdGVyaWFsICk7CgogICAgCQl9CgoKICAgIAkJZnVuY3Rpb24gcmVsZWFzZU1hdGVyaWFsUHJvZ3JhbVJlZmVyZW5jZXMoIG1hdGVyaWFsICkgewoKICAgIAkJCWNvbnN0IHByb2dyYW1zID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkucHJvZ3JhbXM7CgogICAgCQkJaWYgKCBwcm9ncmFtcyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlwcm9ncmFtcy5mb3JFYWNoKCBmdW5jdGlvbiAoIHByb2dyYW0gKSB7CgogICAgCQkJCQlwcm9ncmFtQ2FjaGUucmVsZWFzZVByb2dyYW0oIHByb2dyYW0gKTsKCiAgICAJCQkJfSApOwoKICAgIAkJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgogICAgCQkJCQlwcm9ncmFtQ2FjaGUucmVsZWFzZVNoYWRlckNhY2hlKCBtYXRlcmlhbCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJLy8gQnVmZmVyIHJlbmRlcmluZwoKICAgIAkJdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QgPSBmdW5jdGlvbiAoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApIHsKCiAgICAJCQlpZiAoIHNjZW5lID09PSBudWxsICkgc2NlbmUgPSBfZW1wdHlTY2VuZTsgLy8gcmVuZGVyQnVmZmVyRGlyZWN0IHNlY29uZCBwYXJhbWV0ZXIgdXNlZCB0byBiZSBmb2cgKGNvdWxkIGJlIG51bGwpCgogICAgCQkJY29uc3QgZnJvbnRGYWNlQ1cgPSAoIG9iamVjdC5pc01lc2ggJiYgb2JqZWN0Lm1hdHJpeFdvcmxkLmRldGVybWluYW50KCkgPCAwICk7CgogICAgCQkJY29uc3QgcHJvZ3JhbSA9IHNldFByb2dyYW0oIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0ICk7CgogICAgCQkJc3RhdGUuc2V0TWF0ZXJpYWwoIG1hdGVyaWFsLCBmcm9udEZhY2VDVyApOwoKICAgIAkJCS8vCgogICAgCQkJbGV0IGluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CiAgICAJCQlsZXQgcmFuZ2VGYWN0b3IgPSAxOwoKICAgIAkJCWlmICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICkgewoKICAgIAkJCQlpbmRleCA9IGdlb21ldHJpZXMuZ2V0V2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoKICAgIAkJCQlpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgogICAgCQkJCXJhbmdlRmFjdG9yID0gMjsKCiAgICAJCQl9CgogICAgCQkJLy8KCiAgICAJCQljb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CiAgICAJCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgogICAgCQkJbGV0IGRyYXdTdGFydCA9IGRyYXdSYW5nZS5zdGFydCAqIHJhbmdlRmFjdG9yOwogICAgCQkJbGV0IGRyYXdFbmQgPSAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICogcmFuZ2VGYWN0b3I7CgogICAgCQkJaWYgKCBncm91cCAhPT0gbnVsbCApIHsKCiAgICAJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgZ3JvdXAuc3RhcnQgKiByYW5nZUZhY3RvciApOwogICAgCQkJCWRyYXdFbmQgPSBNYXRoLm1pbiggZHJhd0VuZCwgKCBncm91cC5zdGFydCArIGdyb3VwLmNvdW50ICkgKiByYW5nZUZhY3RvciApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKICAgIAkJCQlkcmF3U3RhcnQgPSBNYXRoLm1heCggZHJhd1N0YXJ0LCAwICk7CiAgICAJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCBpbmRleC5jb3VudCApOwoKICAgIAkJCX0gZWxzZSBpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgcG9zaXRpb24gIT09IG51bGwgKSB7CgogICAgCQkJCWRyYXdTdGFydCA9IE1hdGgubWF4KCBkcmF3U3RhcnQsIDAgKTsKICAgIAkJCQlkcmF3RW5kID0gTWF0aC5taW4oIGRyYXdFbmQsIHBvc2l0aW9uLmNvdW50ICk7CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IGRyYXdDb3VudCA9IGRyYXdFbmQgLSBkcmF3U3RhcnQ7CgogICAgCQkJaWYgKCBkcmF3Q291bnQgPCAwIHx8IGRyYXdDb3VudCA9PT0gSW5maW5pdHkgKSByZXR1cm47CgogICAgCQkJLy8KCiAgICAJCQliaW5kaW5nU3RhdGVzLnNldHVwKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSwgaW5kZXggKTsKCiAgICAJCQlsZXQgYXR0cmlidXRlOwogICAgCQkJbGV0IHJlbmRlcmVyID0gYnVmZmVyUmVuZGVyZXI7CgogICAgCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCiAgICAJCQkJYXR0cmlidXRlID0gYXR0cmlidXRlcy5nZXQoIGluZGV4ICk7CgogICAgCQkJCXJlbmRlcmVyID0gaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwogICAgCQkJCXJlbmRlcmVyLnNldEluZGV4KCBhdHRyaWJ1dGUgKTsKCiAgICAJCQl9CgogICAgCQkJLy8KCiAgICAJCQlpZiAoIG9iamVjdC5pc01lc2ggKSB7CgogICAgCQkJCWlmICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICkgewoKICAgIAkJCQkJc3RhdGUuc2V0TGluZVdpZHRoKCBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGggKiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgKTsKICAgIAkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVTICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuVFJJQU5HTEVTICk7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNMaW5lICkgewoKICAgIAkJCQlsZXQgbGluZVdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKICAgIAkJCQlpZiAoIGxpbmVXaWR0aCA9PT0gdW5kZWZpbmVkICkgbGluZVdpZHRoID0gMTsgLy8gTm90IHVzaW5nIExpbmUqTWF0ZXJpYWwKCiAgICAJCQkJc3RhdGUuc2V0TGluZVdpZHRoKCBsaW5lV2lkdGggKiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgKTsKCiAgICAJCQkJaWYgKCBvYmplY3QuaXNMaW5lU2VnbWVudHMgKSB7CgogICAgCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORVMgKTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZUxvb3AgKSB7CgogICAgCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORV9MT09QICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORV9TVFJJUCApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzUG9pbnRzICkgewoKICAgIAkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuUE9JTlRTICk7CgogICAgCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzU3ByaXRlICkgewoKICAgIAkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuVFJJQU5HTEVTICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggKSB7CgogICAgCQkJCWlmICggb2JqZWN0Ll9tdWx0aURyYXdJbnN0YW5jZXMgIT09IG51bGwgKSB7CgogICAgCQkJCQkvLyBAZGVwcmVjYXRlZCwgcjE3NAogICAgCQkJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IHJlbmRlck11bHRpRHJhd0luc3RhbmNlcyBoYXMgYmVlbiBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gcjE4NC4gQXBwZW5kIHRvIHJlbmRlck11bHRpRHJhdyBhcmd1bWVudHMgYW5kIHVzZSBpbmRpcmVjdGlvbi4nICk7CiAgICAJCQkJCXJlbmRlcmVyLnJlbmRlck11bHRpRHJhd0luc3RhbmNlcyggb2JqZWN0Ll9tdWx0aURyYXdTdGFydHMsIG9iamVjdC5fbXVsdGlEcmF3Q291bnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50LCBvYmplY3QuX211bHRpRHJhd0luc3RhbmNlcyApOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJaWYgKCAhIGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKSApIHsKCiAgICAJCQkJCQljb25zdCBzdGFydHMgPSBvYmplY3QuX211bHRpRHJhd1N0YXJ0czsKICAgIAkJCQkJCWNvbnN0IGNvdW50cyA9IG9iamVjdC5fbXVsdGlEcmF3Q291bnRzOwogICAgCQkJCQkJY29uc3QgZHJhd0NvdW50ID0gb2JqZWN0Ll9tdWx0aURyYXdDb3VudDsKICAgIAkJCQkJCWNvbnN0IGJ5dGVzUGVyRWxlbWVudCA9IGluZGV4ID8gYXR0cmlidXRlcy5nZXQoIGluZGV4ICkuYnl0ZXNQZXJFbGVtZW50IDogMTsKICAgIAkJCQkJCWNvbnN0IHVuaWZvcm1zID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkuY3VycmVudFByb2dyYW0uZ2V0VW5pZm9ybXMoKTsKICAgIAkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCiAgICAJCQkJCQkJdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ19nbF9EcmF3SUQnLCBpICk7CiAgICAJCQkJCQkJcmVuZGVyZXIucmVuZGVyKCBzdGFydHNbIGkgXSAvIGJ5dGVzUGVyRWxlbWVudCwgY291bnRzWyBpIF0gKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCXJlbmRlcmVyLnJlbmRlck11bHRpRHJhdyggb2JqZWN0Ll9tdWx0aURyYXdTdGFydHMsIG9iamVjdC5fbXVsdGlEcmF3Q291bnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50ICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICkgewoKICAgIAkJCQlyZW5kZXJlci5yZW5kZXJJbnN0YW5jZXMoIGRyYXdTdGFydCwgZHJhd0NvdW50LCBvYmplY3QuY291bnQgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCBnZW9tZXRyeS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ICkgewoKICAgIAkJCQljb25zdCBtYXhJbnN0YW5jZUNvdW50ID0gZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgIT09IHVuZGVmaW5lZCA/IGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50IDogSW5maW5pdHk7CiAgICAJCQkJY29uc3QgaW5zdGFuY2VDb3VudCA9IE1hdGgubWluKCBnZW9tZXRyeS5pbnN0YW5jZUNvdW50LCBtYXhJbnN0YW5jZUNvdW50ICk7CgogICAgCQkJCXJlbmRlcmVyLnJlbmRlckluc3RhbmNlcyggZHJhd1N0YXJ0LCBkcmF3Q291bnQsIGluc3RhbmNlQ291bnQgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlyZW5kZXJlci5yZW5kZXIoIGRyYXdTdGFydCwgZHJhd0NvdW50ICk7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8vIENvbXBpbGUKCiAgICAJCWZ1bmN0aW9uIHByZXBhcmVNYXRlcmlhbCggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKSB7CgogICAgCQkJaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlICYmIG1hdGVyaWFsLmZvcmNlU2luZ2xlUGFzcyA9PT0gZmFsc2UgKSB7CgogICAgCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKICAgIAkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAJCQkJZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCiAgICAJCQkJbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKICAgIAkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAJCQkJZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCiAgICAJCQkJbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQkvKioKICAgIAkJICogQ29tcGlsZXMgYWxsIG1hdGVyaWFscyBpbiB0aGUgc2NlbmUgd2l0aCB0aGUgY2FtZXJhLiBUaGlzIGlzIHVzZWZ1bCB0byBwcmVjb21waWxlIHNoYWRlcnMKICAgIAkJICogYmVmb3JlIHRoZSBmaXJzdCByZW5kZXJpbmcuIElmIHlvdSB3YW50IHRvIGFkZCBhIDNEIG9iamVjdCB0byBhbiBleGlzdGluZyBzY2VuZSwgdXNlIHRoZSB0aGlyZAogICAgCQkgKiBvcHRpb25hbCBwYXJhbWV0ZXIgZm9yIGFwcGx5aW5nIHRoZSB0YXJnZXQgc2NlbmUuCiAgICAJCSAqCiAgICAJCSAqIE5vdGUgdGhhdCB0aGUgKHRhcmdldCkgc2NlbmUncyBsaWdodGluZyBhbmQgZW52aXJvbm1lbnQgbXVzdCBiZSBjb25maWd1cmVkIGJlZm9yZSBjYWxsaW5nIHRoaXMgbWV0aG9kLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge09iamVjdDNEfSBzY2VuZSAtIFRoZSBzY2VuZSBvciBhbm90aGVyIHR5cGUgb2YgM0Qgb2JqZWN0IHRvIHByZWNvbXBpbGUuCiAgICAJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgogICAgCQkgKiBAcGFyYW0gez9TY2VuZX0gW3RhcmdldFNjZW5lPW51bGxdIC0gVGhlIHRhcmdldCBzY2VuZS4KICAgIAkJICogQHJldHVybiB7U2V0PE1hdGVyaWFsPn0gVGhlIHByZWNvbXBpbGVkIG1hdGVyaWFscy4KICAgIAkJICovCiAgICAJCXRoaXMuY29tcGlsZSA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgPSBudWxsICkgewoKICAgIAkJCWlmICggdGFyZ2V0U2NlbmUgPT09IG51bGwgKSB0YXJnZXRTY2VuZSA9IHNjZW5lOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlcy5nZXQoIHRhcmdldFNjZW5lICk7CiAgICAJCQljdXJyZW50UmVuZGVyU3RhdGUuaW5pdCggY2FtZXJhICk7CgogICAgCQkJcmVuZGVyU3RhdGVTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyU3RhdGUgKTsKCiAgICAJCQkvLyBnYXRoZXIgbGlnaHRzIGZyb20gYm90aCB0aGUgdGFyZ2V0IHNjZW5lIGFuZCB0aGUgbmV3IG9iamVjdCB0aGF0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIHNjZW5lLgoKICAgIAkJCXRhcmdldFNjZW5lLnRyYXZlcnNlVmlzaWJsZSggZnVuY3Rpb24gKCBvYmplY3QgKSB7CgogICAgCQkJCWlmICggb2JqZWN0LmlzTGlnaHQgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgogICAgCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KCBvYmplY3QgKTsKCiAgICAJCQkJCWlmICggb2JqZWN0LmNhc3RTaGFkb3cgKSB7CgogICAgCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfSApOwoKICAgIAkJCWlmICggc2NlbmUgIT09IHRhcmdldFNjZW5lICkgewoKICAgIAkJCQlzY2VuZS50cmF2ZXJzZVZpc2libGUoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKICAgIAkJCQkJaWYgKCBvYmplY3QuaXNMaWdodCAmJiBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKSApIHsKCiAgICAJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KCBvYmplY3QgKTsKCiAgICAJCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKICAgIAkJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaFNoYWRvdyggb2JqZWN0ICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9ICk7CgogICAgCQkJfQoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cygpOwoKICAgIAkJCS8vIE9ubHkgaW5pdGlhbGl6ZSBtYXRlcmlhbHMgaW4gdGhlIG5ldyBzY2VuZSwgbm90IHRoZSB0YXJnZXRTY2VuZS4KCiAgICAJCQljb25zdCBtYXRlcmlhbHMgPSBuZXcgU2V0KCk7CgogICAgCQkJc2NlbmUudHJhdmVyc2UoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKICAgIAkJCQlpZiAoICEgKCBvYmplY3QuaXNNZXNoIHx8IG9iamVjdC5pc1BvaW50cyB8fCBvYmplY3QuaXNMaW5lIHx8IG9iamVjdC5pc1Nwcml0ZSApICkgewoKICAgIAkJCQkJcmV0dXJuOwoKICAgIAkJCQl9CgogICAgCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKICAgIAkJCQlpZiAoIG1hdGVyaWFsICkgewoKICAgIAkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKICAgIAkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IG1hdGVyaWFsLmxlbmd0aDsgaSArKyApIHsKCiAgICAJCQkJCQkJY29uc3QgbWF0ZXJpYWwyID0gbWF0ZXJpYWxbIGkgXTsKCiAgICAJCQkJCQkJcHJlcGFyZU1hdGVyaWFsKCBtYXRlcmlhbDIsIHRhcmdldFNjZW5lLCBvYmplY3QgKTsKICAgIAkJCQkJCQltYXRlcmlhbHMuYWRkKCBtYXRlcmlhbDIgKTsKCiAgICAJCQkJCQl9CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCXByZXBhcmVNYXRlcmlhbCggbWF0ZXJpYWwsIHRhcmdldFNjZW5lLCBvYmplY3QgKTsKICAgIAkJCQkJCW1hdGVyaWFscy5hZGQoIG1hdGVyaWFsICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9ICk7CgogICAgCQkJY3VycmVudFJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVTdGFjay5wb3AoKTsKCiAgICAJCQlyZXR1cm4gbWF0ZXJpYWxzOwoKICAgIAkJfTsKCiAgICAJCS8vIGNvbXBpbGVBc3luYwoKICAgIAkJLyoqCiAgICAJCSAqIEFzeW5jaHJvbm91cyB2ZXJzaW9uIG9mIHtAbGluayBXZWJHTFJlbmRlcmVyI2NvbXBpbGV9LgogICAgCQkgKgogICAgCQkgKiBUaGlzIG1ldGhvZCBtYWtlcyB1c2Ugb2YgdGhlIGBLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGVgIFdlYkdMIGV4dGVuc2lvbi4gSGVuY2UsCiAgICAJCSAqIGl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSB0aGlzIHZlcnNpb24gb2YgYGNvbXBpbGUoKWAgd2hlbmV2ZXIgcG9zc2libGUuCiAgICAJCSAqCiAgICAJCSAqIEBhc3luYwogICAgCQkgKiBAcGFyYW0ge09iamVjdDNEfSBzY2VuZSAtIFRoZSBzY2VuZSBvciBhbm90aGVyIHR5cGUgb2YgM0Qgb2JqZWN0IHRvIHByZWNvbXBpbGUuCiAgICAJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgogICAgCQkgKiBAcGFyYW0gez9TY2VuZX0gW3RhcmdldFNjZW5lPW51bGxdIC0gVGhlIHRhcmdldCBzY2VuZS4KICAgIAkJICogQHJldHVybiB7UHJvbWlzZX0gQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgZ2l2ZW4gc2NlbmUgY2FuIGJlIHJlbmRlcmVkIHdpdGhvdXQgdW5uZWNlc3Nhcnkgc3RhbGxpbmcgZHVlIHRvIHNoYWRlciBjb21waWxhdGlvbi4KICAgIAkJICovCiAgICAJCXRoaXMuY29tcGlsZUFzeW5jID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhLCB0YXJnZXRTY2VuZSA9IG51bGwgKSB7CgogICAgCQkJY29uc3QgbWF0ZXJpYWxzID0gdGhpcy5jb21waWxlKCBzY2VuZSwgY2FtZXJhLCB0YXJnZXRTY2VuZSApOwoKICAgIAkJCS8vIFdhaXQgZm9yIGFsbCB0aGUgbWF0ZXJpYWxzIGluIHRoZSBuZXcgb2JqZWN0IHRvIGluZGljYXRlIHRoYXQgdGhleSdyZQogICAgCQkJLy8gcmVhZHkgdG8gYmUgdXNlZCBiZWZvcmUgcmVzb2x2aW5nIHRoZSBwcm9taXNlLgoKICAgIAkJCXJldHVybiBuZXcgUHJvbWlzZSggKCByZXNvbHZlICkgPT4gewoKICAgIAkJCQlmdW5jdGlvbiBjaGVja01hdGVyaWFsc1JlYWR5KCkgewoKICAgIAkJCQkJbWF0ZXJpYWxzLmZvckVhY2goIGZ1bmN0aW9uICggbWF0ZXJpYWwgKSB7CgogICAgCQkJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CiAgICAJCQkJCQljb25zdCBwcm9ncmFtID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtOwoKICAgIAkJCQkJCWlmICggcHJvZ3JhbS5pc1JlYWR5KCkgKSB7CgogICAgCQkJCQkJCS8vIHJlbW92ZSBhbnkgcHJvZ3JhbXMgdGhhdCByZXBvcnQgdGhleSdyZSByZWFkeSB0byB1c2UgZnJvbSB0aGUgbGlzdAogICAgCQkJCQkJCW1hdGVyaWFscy5kZWxldGUoIG1hdGVyaWFsICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfSApOwoKICAgIAkJCQkJLy8gb25jZSB0aGUgbGlzdCBvZiBjb21waWxpbmcgbWF0ZXJpYWxzIGlzIGVtcHR5LCBjYWxsIHRoZSBjYWxsYmFjawoKICAgIAkJCQkJaWYgKCBtYXRlcmlhbHMuc2l6ZSA9PT0gMCApIHsKCiAgICAJCQkJCQlyZXNvbHZlKCBzY2VuZSApOwogICAgCQkJCQkJcmV0dXJuOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJLy8gaWYgc29tZSBtYXRlcmlhbHMgYXJlIHN0aWxsIG5vdCByZWFkeSwgd2FpdCBhIGJpdCBhbmQgY2hlY2sgYWdhaW4KCiAgICAJCQkJCXNldFRpbWVvdXQoIGNoZWNrTWF0ZXJpYWxzUmVhZHksIDEwICk7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBleHRlbnNpb25zLmdldCggJ0tIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZScgKSAhPT0gbnVsbCApIHsKCiAgICAJCQkJCS8vIElmIHdlIGNhbiBjaGVjayB0aGUgY29tcGlsYXRpb24gc3RhdHVzIG9mIHRoZSBtYXRlcmlhbHMgd2l0aG91dAogICAgCQkJCQkvLyBibG9ja2luZyB0aGVuIGRvIHNvIHJpZ2h0IGF3YXkuCgogICAgCQkJCQljaGVja01hdGVyaWFsc1JlYWR5KCk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQkvLyBPdGhlcndpc2Ugc3RhcnQgYnkgd2FpdGluZyBhIGJpdCB0byBnaXZlIHRoZSBtYXRlcmlhbHMgd2UganVzdAogICAgCQkJCQkvLyBpbml0aWFsaXplZCBhIGNoYW5jZSB0byBmaW5pc2guCgogICAgCQkJCQlzZXRUaW1lb3V0KCBjaGVja01hdGVyaWFsc1JlYWR5LCAxMCApOwoKICAgIAkJCQl9CgogICAgCQkJfSApOwoKICAgIAkJfTsKCiAgICAJCS8vIEFuaW1hdGlvbiBMb29wCgogICAgCQlsZXQgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gbnVsbDsKCiAgICAJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUgKSB7CgogICAgCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUgKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIG9uWFJTZXNzaW9uU3RhcnQoKSB7CgogICAgCQkJYW5pbWF0aW9uLnN0b3AoKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIG9uWFJTZXNzaW9uRW5kKCkgewoKICAgIAkJCWFuaW1hdGlvbi5zdGFydCgpOwoKICAgIAkJfQoKICAgIAkJY29uc3QgYW5pbWF0aW9uID0gbmV3IFdlYkdMQW5pbWF0aW9uKCk7CiAgICAJCWFuaW1hdGlvbi5zZXRBbmltYXRpb25Mb29wKCBvbkFuaW1hdGlvbkZyYW1lICk7CgogICAgCQlpZiAoIHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyApIGFuaW1hdGlvbi5zZXRDb250ZXh0KCBzZWxmICk7CgogICAgCQl0aGlzLnNldEFuaW1hdGlvbkxvb3AgPSBmdW5jdGlvbiAoIGNhbGxiYWNrICkgewoKICAgIAkJCW9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IGNhbGxiYWNrOwogICAgCQkJeHIuc2V0QW5pbWF0aW9uTG9vcCggY2FsbGJhY2sgKTsKCiAgICAJCQkoIGNhbGxiYWNrID09PSBudWxsICkgPyBhbmltYXRpb24uc3RvcCgpIDogYW5pbWF0aW9uLnN0YXJ0KCk7CgogICAgCQl9OwoKICAgIAkJeHIuYWRkRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKICAgIAkJeHIuYWRkRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25lbmQnLCBvblhSU2Vzc2lvbkVuZCApOwoKICAgIAkJLy8gUmVuZGVyaW5nCgogICAgCQkvKioKICAgIAkJICogUmVuZGVycyB0aGUgZ2l2ZW4gc2NlbmUgKG9yIG90aGVyIHR5cGUgb2YgM0Qgb2JqZWN0KSB1c2luZyB0aGUgZ2l2ZW4gY2FtZXJhLgogICAgCQkgKgogICAgCQkgKiBUaGUgcmVuZGVyIGlzIGRvbmUgdG8gYSBwcmV2aW91c2x5IHNwZWNpZmllZCByZW5kZXIgdGFyZ2V0IHNldCBieSBjYWxsaW5nIHtAbGluayBXZWJHTFJlbmRlcmVyI3NldFJlbmRlclRhcmdldH0KICAgIAkJICogb3IgdG8gdGhlIGNhbnZhcyBhcyB1c3VhbC4KICAgIAkJICoKICAgIAkJICogQnkgZGVmYXVsdCByZW5kZXIgYnVmZmVycyBhcmUgY2xlYXJlZCBiZWZvcmUgcmVuZGVyaW5nIGJ1dCB5b3UgY2FuIHByZXZlbnQKICAgIAkJICogdGhpcyBieSBzZXR0aW5nIHRoZSBwcm9wZXJ0eSBgYXV0b0NsZWFyYCB0byBgZmFsc2VgLiBJZiB5b3Ugd2FudCB0byBwcmV2ZW50CiAgICAJCSAqIG9ubHkgY2VydGFpbiBidWZmZXJzIGJlaW5nIGNsZWFyZWQgeW91IGNhbiBgYXV0b0NsZWFyQ29sb3JgLCBgYXV0b0NsZWFyRGVwdGhgCiAgICAJCSAqIG9yIGBhdXRvQ2xlYXJTdGVuY2lsYCB0byBgZmFsc2VgLiBUbyBmb3JjZSBhIGNsZWFyLCB1c2Uge0BsaW5rIFdlYkdMUmVuZGVyZXIjY2xlYXJ9LgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge09iamVjdDNEfSBzY2VuZSAtIFRoZSBzY2VuZSB0byByZW5kZXIuCiAgICAJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgogICAgCQkgKi8KICAgIAkJdGhpcy5yZW5kZXIgPSBmdW5jdGlvbiAoIHNjZW5lLCBjYW1lcmEgKSB7CgogICAgCQkJaWYgKCBjYW1lcmEgIT09IHVuZGVmaW5lZCAmJiBjYW1lcmEuaXNDYW1lcmEgIT09IHRydWUgKSB7CgogICAgCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlbmRlcjogY2FtZXJhIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBUSFJFRS5DYW1lcmEuJyApOwogICAgCQkJCXJldHVybjsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBfaXNDb250ZXh0TG9zdCA9PT0gdHJ1ZSApIHJldHVybjsKCiAgICAJCQkvLyB1cGRhdGUgc2NlbmUgZ3JhcGgKCiAgICAJCQlpZiAoIHNjZW5lLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHNjZW5lLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgogICAgCQkJLy8gdXBkYXRlIGNhbWVyYSBtYXRyaWNlcyBhbmQgZnJ1c3R1bQoKICAgIAkJCWlmICggY2FtZXJhLnBhcmVudCA9PT0gbnVsbCAmJiBjYW1lcmEubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgogICAgCQkJaWYgKCB4ci5lbmFibGVkID09PSB0cnVlICYmIHhyLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJaWYgKCB4ci5jYW1lcmFBdXRvVXBkYXRlID09PSB0cnVlICkgeHIudXBkYXRlQ2FtZXJhKCBjYW1lcmEgKTsKCiAgICAJCQkJY2FtZXJhID0geHIuZ2V0Q2FtZXJhKCk7IC8vIHVzZSBYUiBjYW1lcmEgZm9yIHJlbmRlcmluZwoKICAgIAkJCX0KCiAgICAJCQkvLwogICAgCQkJaWYgKCBzY2VuZS5pc1NjZW5lID09PSB0cnVlICkgc2NlbmUub25CZWZvcmVSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhLCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlcy5nZXQoIHNjZW5lLCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCApOwogICAgCQkJY3VycmVudFJlbmRlclN0YXRlLmluaXQoIGNhbWVyYSApOwoKICAgIAkJCXJlbmRlclN0YXRlU3RhY2sucHVzaCggY3VycmVudFJlbmRlclN0YXRlICk7CgogICAgCQkJX3Byb2pTY3JlZW5NYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggY2FtZXJhLnByb2plY3Rpb25NYXRyaXgsIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKICAgIAkJCV9mcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKICAgIAkJCV9sb2NhbENsaXBwaW5nRW5hYmxlZCA9IHRoaXMubG9jYWxDbGlwcGluZ0VuYWJsZWQ7CiAgICAJCQlfY2xpcHBpbmdFbmFibGVkID0gY2xpcHBpbmcuaW5pdCggdGhpcy5jbGlwcGluZ1BsYW5lcywgX2xvY2FsQ2xpcHBpbmdFbmFibGVkICk7CgogICAgCQkJY3VycmVudFJlbmRlckxpc3QgPSByZW5kZXJMaXN0cy5nZXQoIHNjZW5lLCByZW5kZXJMaXN0U3RhY2subGVuZ3RoICk7CiAgICAJCQljdXJyZW50UmVuZGVyTGlzdC5pbml0KCk7CgogICAgCQkJcmVuZGVyTGlzdFN0YWNrLnB1c2goIGN1cnJlbnRSZW5kZXJMaXN0ICk7CgogICAgCQkJaWYgKCB4ci5lbmFibGVkID09PSB0cnVlICYmIHhyLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJY29uc3QgZGVwdGhTZW5zaW5nTWVzaCA9IF90aGlzLnhyLmdldERlcHRoU2Vuc2luZ01lc2goKTsKCiAgICAJCQkJaWYgKCBkZXB0aFNlbnNpbmdNZXNoICE9PSBudWxsICkgewoKICAgIAkJCQkJcHJvamVjdE9iamVjdCggZGVwdGhTZW5zaW5nTWVzaCwgY2FtZXJhLCAtIEluZmluaXR5LCBfdGhpcy5zb3J0T2JqZWN0cyApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXByb2plY3RPYmplY3QoIHNjZW5lLCBjYW1lcmEsIDAsIF90aGlzLnNvcnRPYmplY3RzICk7CgogICAgCQkJY3VycmVudFJlbmRlckxpc3QuZmluaXNoKCk7CgogICAgCQkJaWYgKCBfdGhpcy5zb3J0T2JqZWN0cyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJY3VycmVudFJlbmRlckxpc3Quc29ydCggX29wYXF1ZVNvcnQsIF90cmFuc3BhcmVudFNvcnQgKTsKCiAgICAJCQl9CgogICAgCQkJX3JlbmRlckJhY2tncm91bmQgPSB4ci5lbmFibGVkID09PSBmYWxzZSB8fCB4ci5pc1ByZXNlbnRpbmcgPT09IGZhbHNlIHx8IHhyLmhhc0RlcHRoU2Vuc2luZygpID09PSBmYWxzZTsKICAgIAkJCWlmICggX3JlbmRlckJhY2tncm91bmQgKSB7CgogICAgCQkJCWJhY2tncm91bmQuYWRkVG9SZW5kZXJMaXN0KCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUgKTsKCiAgICAJCQl9CgogICAgCQkJLy8KCiAgICAJCQl0aGlzLmluZm8ucmVuZGVyLmZyYW1lICsrOwoKICAgIAkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLmJlZ2luU2hhZG93cygpOwoKICAgIAkJCWNvbnN0IHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgogICAgCQkJc2hhZG93TWFwLnJlbmRlciggc2hhZG93c0FycmF5LCBzY2VuZSwgY2FtZXJhICk7CgogICAgCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkID09PSB0cnVlICkgY2xpcHBpbmcuZW5kU2hhZG93cygpOwoKICAgIAkJCS8vCgogICAgCQkJaWYgKCB0aGlzLmluZm8uYXV0b1Jlc2V0ID09PSB0cnVlICkgdGhpcy5pbmZvLnJlc2V0KCk7CgogICAgCQkJLy8gcmVuZGVyIHNjZW5lCgogICAgCQkJY29uc3Qgb3BhcXVlT2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0Lm9wYXF1ZTsKICAgIAkJCWNvbnN0IHRyYW5zbWlzc2l2ZU9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC50cmFuc21pc3NpdmU7CgogICAgCQkJY3VycmVudFJlbmRlclN0YXRlLnNldHVwTGlnaHRzKCk7CgogICAgCQkJaWYgKCBjYW1lcmEuaXNBcnJheUNhbWVyYSApIHsKCiAgICAJCQkJY29uc3QgY2FtZXJhcyA9IGNhbWVyYS5jYW1lcmFzOwoKICAgIAkJCQlpZiAoIHRyYW5zbWlzc2l2ZU9iamVjdHMubGVuZ3RoID4gMCApIHsKCiAgICAJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNhbWVyYXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJCQljb25zdCBjYW1lcmEyID0gY2FtZXJhc1sgaSBdOwoKICAgIAkJCQkJCXJlbmRlclRyYW5zbWlzc2lvblBhc3MoIG9wYXF1ZU9iamVjdHMsIHRyYW5zbWlzc2l2ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEyICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBfcmVuZGVyQmFja2dyb3VuZCApIGJhY2tncm91bmQucmVuZGVyKCBzY2VuZSApOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjYW1lcmFzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBjYW1lcmEyID0gY2FtZXJhc1sgaSBdOwoKICAgIAkJCQkJcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhMiwgY2FtZXJhMi52aWV3cG9ydCApOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJaWYgKCB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aCA+IDAgKSByZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICk7CgogICAgCQkJCWlmICggX3JlbmRlckJhY2tncm91bmQgKSBiYWNrZ3JvdW5kLnJlbmRlciggc2NlbmUgKTsKCiAgICAJCQkJcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhICk7CgogICAgCQkJfQoKICAgIAkJCS8vCgogICAgCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCAmJiBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID09PSAwICkgewoKICAgIAkJCQkvLyByZXNvbHZlIG11bHRpc2FtcGxlIHJlbmRlcmJ1ZmZlcnMgdG8gYSBzaW5nbGUtc2FtcGxlIHRleHR1cmUgaWYgbmVjZXNzYXJ5CgogICAgCQkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKICAgIAkJCQkvLyBHZW5lcmF0ZSBtaXBtYXAgaWYgd2UncmUgdXNpbmcgYW55IGtpbmQgb2YgbWlwbWFwIGZpbHRlcmluZwoKICAgIAkJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJfQoKICAgIAkJCS8vCgogICAgCQkJaWYgKCBzY2VuZS5pc1NjZW5lID09PSB0cnVlICkgc2NlbmUub25BZnRlclJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEgKTsKCiAgICAJCQkvLyBfZ2wuZmluaXNoKCk7CgogICAgCQkJYmluZGluZ1N0YXRlcy5yZXNldERlZmF1bHRTdGF0ZSgpOwogICAgCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gLTE7CiAgICAJCQlfY3VycmVudENhbWVyYSA9IG51bGw7CgogICAgCQkJcmVuZGVyU3RhdGVTdGFjay5wb3AoKTsKCiAgICAJCQlpZiAoIHJlbmRlclN0YXRlU3RhY2subGVuZ3RoID4gMCApIHsKCiAgICAJCQkJY3VycmVudFJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVTdGFja1sgcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggLSAxIF07CgogICAgCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLnNldEdsb2JhbFN0YXRlKCBfdGhpcy5jbGlwcGluZ1BsYW5lcywgY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLmNhbWVyYSApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IG51bGw7CgogICAgCQkJfQoKICAgIAkJCXJlbmRlckxpc3RTdGFjay5wb3AoKTsKCiAgICAJCQlpZiAoIHJlbmRlckxpc3RTdGFjay5sZW5ndGggPiAwICkgewoKICAgIAkJCQljdXJyZW50UmVuZGVyTGlzdCA9IHJlbmRlckxpc3RTdGFja1sgcmVuZGVyTGlzdFN0YWNrLmxlbmd0aCAtIDEgXTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQljdXJyZW50UmVuZGVyTGlzdCA9IG51bGw7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCWZ1bmN0aW9uIHByb2plY3RPYmplY3QoIG9iamVjdCwgY2FtZXJhLCBncm91cE9yZGVyLCBzb3J0T2JqZWN0cyApIHsKCiAgICAJCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCiAgICAJCQljb25zdCB2aXNpYmxlID0gb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICk7CgogICAgCQkJaWYgKCB2aXNpYmxlICkgewoKICAgIAkJCQlpZiAoIG9iamVjdC5pc0dyb3VwICkgewoKICAgIAkJCQkJZ3JvdXBPcmRlciA9IG9iamVjdC5yZW5kZXJPcmRlcjsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTE9EICkgewoKICAgIAkJCQkJaWYgKCBvYmplY3QuYXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIG9iamVjdC51cGRhdGUoIGNhbWVyYSApOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNMaWdodCApIHsKCiAgICAJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoTGlnaHQoIG9iamVjdCApOwoKICAgIAkJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyApIHsKCiAgICAJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaFNoYWRvdyggb2JqZWN0ICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1Nwcml0ZSApIHsKCiAgICAJCQkJCWlmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzU3ByaXRlKCBvYmplY3QgKSApIHsKCiAgICAJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKICAgIAkJCQkJCQlfdmVjdG9yNC5zZXRGcm9tTWF0cml4UG9zaXRpb24oIG9iamVjdC5tYXRyaXhXb3JsZCApCiAgICAJCQkJCQkJCS5hcHBseU1hdHJpeDQoIF9wcm9qU2NyZWVuTWF0cml4ICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0cy51cGRhdGUoIG9iamVjdCApOwogICAgCQkJCQkJY29uc3QgbWF0ZXJpYWwgPSBvYmplY3QubWF0ZXJpYWw7CgogICAgCQkJCQkJaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKICAgIAkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjQueiwgbnVsbCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCX0KCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTWVzaCB8fCBvYmplY3QuaXNMaW5lIHx8IG9iamVjdC5pc1BvaW50cyApIHsKCiAgICAJCQkJCWlmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSApIHsKCiAgICAJCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKICAgIAkJCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKICAgIAkJCQkJCWlmICggc29ydE9iamVjdHMgKSB7CgogICAgCQkJCQkJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIG9iamVjdC5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKICAgIAkJCQkJCQkJX3ZlY3RvcjQuY29weSggb2JqZWN0LmJvdW5kaW5nU3BoZXJlLmNlbnRlciApOwoKICAgIAkJCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwogICAgCQkJCQkJCQlfdmVjdG9yNC5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCQlfdmVjdG9yNAogICAgCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKQogICAgCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgogICAgCQkJCQkJCWNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKCiAgICAJCQkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwogICAgCQkJCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCiAgICAJCQkJCQkJCWlmICggZ3JvdXBNYXRlcmlhbCAmJiBncm91cE1hdGVyaWFsLnZpc2libGUgKSB7CgogICAgCQkJCQkJCQkJY3VycmVudFJlbmRlckxpc3QucHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgZ3JvdXBNYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjQueiwgZ3JvdXAgKTsKCiAgICAJCQkJCQkJCX0KCiAgICAJCQkJCQkJfQoKICAgIAkJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnZpc2libGUgKSB7CgogICAgCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yNC56LCBudWxsICk7CgogICAgCQkJCQkJfQoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IGNoaWxkcmVuID0gb2JqZWN0LmNoaWxkcmVuOwoKICAgIAkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCXByb2plY3RPYmplY3QoIGNoaWxkcmVuWyBpIF0sIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMgKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiByZW5kZXJTY2VuZSggY3VycmVudFJlbmRlckxpc3QsIHNjZW5lLCBjYW1lcmEsIHZpZXdwb3J0ICkgewoKICAgIAkJCWNvbnN0IG9wYXF1ZU9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC5vcGFxdWU7CiAgICAJCQljb25zdCB0cmFuc21pc3NpdmVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNtaXNzaXZlOwogICAgCQkJY29uc3QgdHJhbnNwYXJlbnRPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNwYXJlbnQ7CgogICAgCQkJY3VycmVudFJlbmRlclN0YXRlLnNldHVwTGlnaHRzVmlldyggY2FtZXJhICk7CgogICAgCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkID09PSB0cnVlICkgY2xpcHBpbmcuc2V0R2xvYmFsU3RhdGUoIF90aGlzLmNsaXBwaW5nUGxhbmVzLCBjYW1lcmEgKTsKCiAgICAJCQlpZiAoIHZpZXdwb3J0ICkgc3RhdGUudmlld3BvcnQoIF9jdXJyZW50Vmlld3BvcnQuY29weSggdmlld3BvcnQgKSApOwoKICAgIAkJCWlmICggb3BhcXVlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyT2JqZWN0cyggb3BhcXVlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwogICAgCQkJaWYgKCB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aCA+IDAgKSByZW5kZXJPYmplY3RzKCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICk7CiAgICAJCQlpZiAoIHRyYW5zcGFyZW50T2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyT2JqZWN0cyggdHJhbnNwYXJlbnRPYmplY3RzLCBzY2VuZSwgY2FtZXJhICk7CgogICAgCQkJLy8gRW5zdXJlIGRlcHRoIGJ1ZmZlciB3cml0aW5nIGlzIGVuYWJsZWQgc28gaXQgY2FuIGJlIGNsZWFyZWQgb24gbmV4dCByZW5kZXIKCiAgICAJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKICAgIAkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0TWFzayggdHJ1ZSApOwogICAgCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRNYXNrKCB0cnVlICk7CgogICAgCQkJc3RhdGUuc2V0UG9seWdvbk9mZnNldCggZmFsc2UgKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIHJlbmRlclRyYW5zbWlzc2lvblBhc3MoIG9wYXF1ZU9iamVjdHMsIHRyYW5zbWlzc2l2ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKSB7CgogICAgCQkJY29uc3Qgb3ZlcnJpZGVNYXRlcmlhbCA9IHNjZW5lLmlzU2NlbmUgPT09IHRydWUgPyBzY2VuZS5vdmVycmlkZU1hdGVyaWFsIDogbnVsbDsKCiAgICAJCQlpZiAoIG92ZXJyaWRlTWF0ZXJpYWwgIT09IG51bGwgKSB7CgogICAgCQkJCXJldHVybjsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUudHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0WyBjYW1lcmEuaWQgXSA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQljdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUudHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0WyBjYW1lcmEuaWQgXSA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggMSwgMSwgewogICAgCQkJCQlnZW5lcmF0ZU1pcG1hcHM6IHRydWUsCiAgICAJCQkJCXR5cGU6ICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICkgfHwgZXh0ZW5zaW9ucy5oYXMoICdFWFRfY29sb3JfYnVmZmVyX2Zsb2F0JyApICkgPyBIYWxmRmxvYXRUeXBlIDogVW5zaWduZWRCeXRlVHlwZSwKICAgIAkJCQkJbWluRmlsdGVyOiBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsCiAgICAJCQkJCXNhbXBsZXM6IDQsCiAgICAJCQkJCXN0ZW5jaWxCdWZmZXI6IHN0ZW5jaWwsCiAgICAJCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogZmFsc2UsCiAgICAJCQkJCXJlc29sdmVTdGVuY2lsQnVmZmVyOiBmYWxzZSwKICAgIAkJCQkJY29sb3JTcGFjZTogQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlLAogICAgCQkJCX0gKTsKCiAgICAJCQkJLy8gZGVidWcKCiAgICAJCQkJLyoKICAgIAkJCQljb25zdCBnZW9tZXRyeSA9IG5ldyBQbGFuZUdlb21ldHJ5KCk7CiAgICAJCQkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsgbWFwOiBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnRleHR1cmUgfSApOwoKICAgIAkJCQljb25zdCBtZXNoID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwogICAgCQkJCXNjZW5lLmFkZCggbWVzaCApOwogICAgCQkJCSovCgogICAgCQkJfQoKICAgIAkJCWNvbnN0IHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS50cmFuc21pc3Npb25SZW5kZXJUYXJnZXRbIGNhbWVyYS5pZCBdOwoKICAgIAkJCWNvbnN0IGFjdGl2ZVZpZXdwb3J0ID0gY2FtZXJhLnZpZXdwb3J0IHx8IF9jdXJyZW50Vmlld3BvcnQ7CiAgICAJCQl0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuc2V0U2l6ZSggYWN0aXZlVmlld3BvcnQueiAqIF90aGlzLnRyYW5zbWlzc2lvblJlc29sdXRpb25TY2FsZSwgYWN0aXZlVmlld3BvcnQudyAqIF90aGlzLnRyYW5zbWlzc2lvblJlc29sdXRpb25TY2FsZSApOwoKICAgIAkJCS8vCgogICAgCQkJY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IF90aGlzLmdldFJlbmRlclRhcmdldCgpOwogICAgCQkJY29uc3QgY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gX3RoaXMuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IF90aGlzLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CgogICAgCQkJX3RoaXMuc2V0UmVuZGVyVGFyZ2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCiAgICAJCQlfdGhpcy5nZXRDbGVhckNvbG9yKCBfY3VycmVudENsZWFyQ29sb3IgKTsKICAgIAkJCV9jdXJyZW50Q2xlYXJBbHBoYSA9IF90aGlzLmdldENsZWFyQWxwaGEoKTsKICAgIAkJCWlmICggX2N1cnJlbnRDbGVhckFscGhhIDwgMSApIF90aGlzLnNldENsZWFyQ29sb3IoIDB4ZmZmZmZmLCAwLjUgKTsKCiAgICAJCQlfdGhpcy5jbGVhcigpOwoKICAgIAkJCWlmICggX3JlbmRlckJhY2tncm91bmQgKSBiYWNrZ3JvdW5kLnJlbmRlciggc2NlbmUgKTsKCiAgICAJCQkvLyBUdXJuIG9mZiB0aGUgZmVhdHVyZXMgd2hpY2ggY2FuIGFmZmVjdCB0aGUgZnJhZyBjb2xvciBmb3Igb3BhcXVlIG9iamVjdHMgcGFzcy4KICAgIAkJCS8vIE90aGVyd2lzZSB0aGV5IGFyZSBhcHBsaWVkIHR3aWNlIGluIG9wYXF1ZSBvYmplY3RzIHBhc3MgYW5kIHRyYW5zbWlzc2lvbiBvYmplY3RzIHBhc3MuCiAgICAJCQljb25zdCBjdXJyZW50VG9uZU1hcHBpbmcgPSBfdGhpcy50b25lTWFwcGluZzsKICAgIAkJCV90aGlzLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCiAgICAJCQkvLyBSZW1vdmUgdmlld3BvcnQgZnJvbSBjYW1lcmEgdG8gYXZvaWQgbmVzdGVkIHJlbmRlciBjYWxscyByZXNldHRpbmcgdmlld3BvcnQgdG8gaXQgKGUuZyBSZWZsZWN0b3IpLgogICAgCQkJLy8gVHJhbnNtaXNzaW9uIHJlbmRlciBwYXNzIHJlcXVpcmVzIHZpZXdwb3J0IHRvIG1hdGNoIHRoZSB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuCiAgICAJCQljb25zdCBjdXJyZW50Q2FtZXJhVmlld3BvcnQgPSBjYW1lcmEudmlld3BvcnQ7CiAgICAJCQlpZiAoIGNhbWVyYS52aWV3cG9ydCAhPT0gdW5kZWZpbmVkICkgY2FtZXJhLnZpZXdwb3J0ID0gdW5kZWZpbmVkOwoKICAgIAkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApOwoKICAgIAkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLnNldEdsb2JhbFN0YXRlKCBfdGhpcy5jbGlwcGluZ1BsYW5lcywgY2FtZXJhICk7CgogICAgCQkJcmVuZGVyT2JqZWN0cyggb3BhcXVlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKICAgIAkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKICAgIAkJCXRleHR1cmVzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgogICAgCQkJaWYgKCBleHRlbnNpb25zLmhhcyggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA9PT0gZmFsc2UgKSB7IC8vIHNlZSAjMjgxMzEKCiAgICAJCQkJbGV0IHJlbmRlclRhcmdldE5lZWRzVXBkYXRlID0gZmFsc2U7CgogICAgCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRyYW5zbWlzc2l2ZU9iamVjdHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCiAgICAJCQkJCWNvbnN0IHJlbmRlckl0ZW0gPSB0cmFuc21pc3NpdmVPYmplY3RzWyBpIF07CgogICAgCQkJCQljb25zdCBvYmplY3QgPSByZW5kZXJJdGVtLm9iamVjdDsKICAgIAkJCQkJY29uc3QgZ2VvbWV0cnkgPSByZW5kZXJJdGVtLmdlb21ldHJ5OwogICAgCQkJCQljb25zdCBtYXRlcmlhbCA9IHJlbmRlckl0ZW0ubWF0ZXJpYWw7CiAgICAJCQkJCWNvbnN0IGdyb3VwID0gcmVuZGVySXRlbS5ncm91cDsKCiAgICAJCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSAmJiBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKSApIHsKCiAgICAJCQkJCQljb25zdCBjdXJyZW50U2lkZSA9IG1hdGVyaWFsLnNpZGU7CgogICAgCQkJCQkJbWF0ZXJpYWwuc2lkZSA9IEJhY2tTaWRlOwogICAgCQkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQkJCXJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgogICAgCQkJCQkJbWF0ZXJpYWwuc2lkZSA9IGN1cnJlbnRTaWRlOwogICAgCQkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKICAgIAkJCQkJCXJlbmRlclRhcmdldE5lZWRzVXBkYXRlID0gdHJ1ZTsKCiAgICAJCQkJCX0KCiAgICAJCQkJfQoKICAgIAkJCQlpZiAoIHJlbmRlclRhcmdldE5lZWRzVXBkYXRlID09PSB0cnVlICkgewoKICAgIAkJCQkJdGV4dHVyZXMudXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwogICAgCQkJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCV90aGlzLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgY3VycmVudEFjdGl2ZUN1YmVGYWNlLCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgKTsKCiAgICAJCQlfdGhpcy5zZXRDbGVhckNvbG9yKCBfY3VycmVudENsZWFyQ29sb3IsIF9jdXJyZW50Q2xlYXJBbHBoYSApOwoKICAgIAkJCWlmICggY3VycmVudENhbWVyYVZpZXdwb3J0ICE9PSB1bmRlZmluZWQgKSBjYW1lcmEudmlld3BvcnQgPSBjdXJyZW50Q2FtZXJhVmlld3BvcnQ7CgogICAgCQkJX3RoaXMudG9uZU1hcHBpbmcgPSBjdXJyZW50VG9uZU1hcHBpbmc7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiByZW5kZXJPYmplY3RzKCByZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhICkgewoKICAgIAkJCWNvbnN0IG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA6IG51bGw7CgogICAgCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcmVuZGVyTGlzdC5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKICAgIAkJCQljb25zdCByZW5kZXJJdGVtID0gcmVuZGVyTGlzdFsgaSBdOwoKICAgIAkJCQljb25zdCBvYmplY3QgPSByZW5kZXJJdGVtLm9iamVjdDsKICAgIAkJCQljb25zdCBnZW9tZXRyeSA9IHJlbmRlckl0ZW0uZ2VvbWV0cnk7CiAgICAJCQkJY29uc3QgZ3JvdXAgPSByZW5kZXJJdGVtLmdyb3VwOwogICAgCQkJCWxldCBtYXRlcmlhbCA9IHJlbmRlckl0ZW0ubWF0ZXJpYWw7CgogICAgCQkJCWlmICggbWF0ZXJpYWwuYWxsb3dPdmVycmlkZSA9PT0gdHJ1ZSAmJiBvdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgewoKICAgIAkJCQkJbWF0ZXJpYWwgPSBvdmVycmlkZU1hdGVyaWFsOwoKICAgIAkJCQl9CgogICAgCQkJCWlmICggb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgogICAgCQkJCQlyZW5kZXJPYmplY3QoIG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0KCBvYmplY3QsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKSB7CgogICAgCQkJb2JqZWN0Lm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKICAgIAkJCW9iamVjdC5tb2RlbFZpZXdNYXRyaXgubXVsdGlwbHlNYXRyaWNlcyggY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CiAgICAJCQlvYmplY3Qubm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggb2JqZWN0Lm1vZGVsVmlld01hdHJpeCApOwoKICAgIAkJCW1hdGVyaWFsLm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG9iamVjdCwgZ3JvdXAgKTsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICYmIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgbWF0ZXJpYWwuZm9yY2VTaW5nbGVQYXNzID09PSBmYWxzZSApIHsKCiAgICAJCQkJbWF0ZXJpYWwuc2lkZSA9IEJhY2tTaWRlOwogICAgCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIAkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKICAgIAkJCQltYXRlcmlhbC5zaWRlID0gRnJvbnRTaWRlOwogICAgCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgIAkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKICAgIAkJCQltYXRlcmlhbC5zaWRlID0gRG91YmxlU2lkZTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQlfdGhpcy5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgc2NlbmUsIGdlb21ldHJ5LCBtYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKICAgIAkJCX0KCiAgICAJCQlvYmplY3Qub25BZnRlclJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIGdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICkgewoKICAgIAkJCWlmICggc2NlbmUuaXNTY2VuZSAhPT0gdHJ1ZSApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHNjZW5lIGNvdWxkIGJlIGEgTWVzaCwgTGluZSwgUG9pbnRzLCAuLi4KCiAgICAJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCiAgICAJCQljb25zdCBsaWdodHMgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUubGlnaHRzOwogICAgCQkJY29uc3Qgc2hhZG93c0FycmF5ID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnNoYWRvd3NBcnJheTsKCiAgICAJCQljb25zdCBsaWdodHNTdGF0ZVZlcnNpb24gPSBsaWdodHMuc3RhdGUudmVyc2lvbjsKCiAgICAJCQljb25zdCBwYXJhbWV0ZXJzID0gcHJvZ3JhbUNhY2hlLmdldFBhcmFtZXRlcnMoIG1hdGVyaWFsLCBsaWdodHMuc3RhdGUsIHNoYWRvd3NBcnJheSwgc2NlbmUsIG9iamVjdCApOwogICAgCQkJY29uc3QgcHJvZ3JhbUNhY2hlS2V5ID0gcHJvZ3JhbUNhY2hlLmdldFByb2dyYW1DYWNoZUtleSggcGFyYW1ldGVycyApOwoKICAgIAkJCWxldCBwcm9ncmFtcyA9IG1hdGVyaWFsUHJvcGVydGllcy5wcm9ncmFtczsKCiAgICAJCQkvLyBhbHdheXMgdXBkYXRlIGVudmlyb25tZW50IGFuZCBmb2cgLSBjaGFuZ2luZyB0aGVzZSB0cmlnZ2VyIGFuIGdldFByb2dyYW0gY2FsbCwgYnV0IGl0J3MgcG9zc2libGUgdGhhdCB0aGUgcHJvZ3JhbSBkb2Vzbid0IGNoYW5nZQoKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZpcm9ubWVudCA9IG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBzY2VuZS5lbnZpcm9ubWVudCA6IG51bGw7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuZm9nID0gc2NlbmUuZm9nOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcCA9ICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggbWF0ZXJpYWwuZW52TWFwIHx8IG1hdGVyaWFsUHJvcGVydGllcy5lbnZpcm9ubWVudCApOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcFJvdGF0aW9uID0gKCBtYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgIT09IG51bGwgJiYgbWF0ZXJpYWwuZW52TWFwID09PSBudWxsICkgPyBzY2VuZS5lbnZpcm9ubWVudFJvdGF0aW9uIDogbWF0ZXJpYWwuZW52TWFwUm90YXRpb247CgogICAgCQkJaWYgKCBwcm9ncmFtcyA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkvLyBuZXcgbWF0ZXJpYWwKCiAgICAJCQkJbWF0ZXJpYWwuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKICAgIAkJCQlwcm9ncmFtcyA9IG5ldyBNYXAoKTsKICAgIAkJCQltYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbXMgPSBwcm9ncmFtczsKCiAgICAJCQl9CgogICAgCQkJbGV0IHByb2dyYW0gPSBwcm9ncmFtcy5nZXQoIHByb2dyYW1DYWNoZUtleSApOwoKICAgIAkJCWlmICggcHJvZ3JhbSAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkvLyBlYXJseSBvdXQgaWYgcHJvZ3JhbSBhbmQgbGlnaHQgc3RhdGUgaXMgaWRlbnRpY2FsCgogICAgCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtID09PSBwcm9ncmFtICYmIG1hdGVyaWFsUHJvcGVydGllcy5saWdodHNTdGF0ZVZlcnNpb24gPT09IGxpZ2h0c1N0YXRlVmVyc2lvbiApIHsKCiAgICAJCQkJCXVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyggbWF0ZXJpYWwsIHBhcmFtZXRlcnMgKTsKCiAgICAJCQkJCXJldHVybiBwcm9ncmFtOwoKICAgIAkJCQl9CgogICAgCQkJfSBlbHNlIHsKCiAgICAJCQkJcGFyYW1ldGVycy51bmlmb3JtcyA9IHByb2dyYW1DYWNoZS5nZXRVbmlmb3JtcyggbWF0ZXJpYWwgKTsKCiAgICAJCQkJbWF0ZXJpYWwub25CZWZvcmVDb21waWxlKCBwYXJhbWV0ZXJzLCBfdGhpcyApOwoKICAgIAkJCQlwcm9ncmFtID0gcHJvZ3JhbUNhY2hlLmFjcXVpcmVQcm9ncmFtKCBwYXJhbWV0ZXJzLCBwcm9ncmFtQ2FjaGVLZXkgKTsKICAgIAkJCQlwcm9ncmFtcy5zZXQoIHByb2dyYW1DYWNoZUtleSwgcHJvZ3JhbSApOwoKICAgIAkJCQltYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXMgPSBwYXJhbWV0ZXJzLnVuaWZvcm1zOwoKICAgIAkJCX0KCiAgICAJCQljb25zdCB1bmlmb3JtcyA9IG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtczsKCiAgICAJCQlpZiAoICggISBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICYmICEgbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHx8IG1hdGVyaWFsLmNsaXBwaW5nID09PSB0cnVlICkgewoKICAgIAkJCQl1bmlmb3Jtcy5jbGlwcGluZ1BsYW5lcyA9IGNsaXBwaW5nLnVuaWZvcm07CgogICAgCQkJfQoKICAgIAkJCXVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyggbWF0ZXJpYWwsIHBhcmFtZXRlcnMgKTsKCiAgICAJCQkvLyBzdG9yZSB0aGUgbGlnaHQgc2V0dXAgaXQgd2FzIGNyZWF0ZWQgZm9yCgogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzID0gbWF0ZXJpYWxOZWVkc0xpZ2h0cyggbWF0ZXJpYWwgKTsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5saWdodHNTdGF0ZVZlcnNpb24gPSBsaWdodHNTdGF0ZVZlcnNpb247CgogICAgCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgKSB7CgogICAgCQkJCS8vIHdpcmUgdXAgdGhlIG1hdGVyaWFsIHRvIHRoaXMgcmVuZGVyZXIncyBsaWdodGluZyBzdGF0ZQoKICAgIAkJCQl1bmlmb3Jtcy5hbWJpZW50TGlnaHRDb2xvci52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5hbWJpZW50OwogICAgCQkJCXVuaWZvcm1zLmxpZ2h0UHJvYmUudmFsdWUgPSBsaWdodHMuc3RhdGUucHJvYmU7CiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWw7CiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodFNoYWRvd3MudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3c7CiAgICAJCQkJdW5pZm9ybXMuc3BvdExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90OwogICAgCQkJCXVuaWZvcm1zLnNwb3RMaWdodFNoYWRvd3MudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvdzsKICAgIAkJCQl1bmlmb3Jtcy5yZWN0QXJlYUxpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5yZWN0QXJlYTsKICAgIAkJCQl1bmlmb3Jtcy5sdGNfMS52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5yZWN0QXJlYUxUQzE7CiAgICAJCQkJdW5pZm9ybXMubHRjXzIudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWFMVEMyOwogICAgCQkJCXVuaWZvcm1zLnBvaW50TGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnBvaW50OwogICAgCQkJCXVuaWZvcm1zLnBvaW50TGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnBvaW50U2hhZG93OwogICAgCQkJCXVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuaGVtaTsKCiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXA7CiAgICAJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg7CiAgICAJCQkJdW5pZm9ybXMuc3BvdFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90U2hhZG93TWFwOwogICAgCQkJCXVuaWZvcm1zLnNwb3RMaWdodE1hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90TGlnaHRNYXRyaXg7CiAgICAJCQkJdW5pZm9ybXMuc3BvdExpZ2h0TWFwLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RMaWdodE1hcDsKICAgIAkJCQl1bmlmb3Jtcy5wb2ludFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvd01hcDsKICAgIAkJCQl1bmlmb3Jtcy5wb2ludFNoYWRvd01hdHJpeC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvd01hdHJpeDsKICAgIAkJCQkvLyBUT0RPIChhYmVsbmF0aW9uKTogYWRkIGFyZWEgbGlnaHRzIHNoYWRvdyBpbmZvIHRvIHVuaWZvcm1zCgogICAgCQkJfQoKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXNMaXN0ID0gbnVsbDsKCiAgICAJCQlyZXR1cm4gcHJvZ3JhbTsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIGdldFVuaWZvcm1MaXN0KCBtYXRlcmlhbFByb3BlcnRpZXMgKSB7CgogICAgCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXNMaXN0ID09PSBudWxsICkgewoKICAgIAkJCQljb25zdCBwcm9nVW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW0uZ2V0VW5pZm9ybXMoKTsKICAgIAkJCQltYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXNMaXN0ID0gV2ViR0xVbmlmb3Jtcy5zZXFXaXRoVmFsdWUoIHByb2dVbmlmb3Jtcy5zZXEsIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtcyApOwoKICAgIAkJCX0KCiAgICAJCQlyZXR1cm4gbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdDsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIHVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyggbWF0ZXJpYWwsIHBhcmFtZXRlcnMgKSB7CgogICAgCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm91dHB1dENvbG9yU3BhY2UgPSBwYXJhbWV0ZXJzLm91dHB1dENvbG9yU3BhY2U7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuYmF0Y2hpbmcgPSBwYXJhbWV0ZXJzLmJhdGNoaW5nOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nQ29sb3IgPSBwYXJhbWV0ZXJzLmJhdGNoaW5nQ29sb3I7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9IHBhcmFtZXRlcnMuaW5zdGFuY2luZzsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvcjsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nTW9ycGggPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmdNb3JwaDsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5za2lubmluZyA9IHBhcmFtZXRlcnMuc2tpbm5pbmc7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubW9ycGhUYXJnZXRzID0gcGFyYW1ldGVycy5tb3JwaFRhcmdldHM7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzID0gcGFyYW1ldGVycy5tb3JwaE5vcm1hbHM7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubW9ycGhDb2xvcnMgPSBwYXJhbWV0ZXJzLm1vcnBoQ29sb3JzOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0c0NvdW50ID0gcGFyYW1ldGVycy5tb3JwaFRhcmdldHNDb3VudDsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyA9IHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXM7CiAgICAJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtSW50ZXJzZWN0aW9uID0gcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleEFscGhhcyA9IHBhcmFtZXRlcnMudmVydGV4QWxwaGFzOwogICAgCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleFRhbmdlbnRzID0gcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50czsKICAgIAkJCW1hdGVyaWFsUHJvcGVydGllcy50b25lTWFwcGluZyA9IHBhcmFtZXRlcnMudG9uZU1hcHBpbmc7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApIHsKCiAgICAJCQlpZiAoIHNjZW5lLmlzU2NlbmUgIT09IHRydWUgKSBzY2VuZSA9IF9lbXB0eVNjZW5lOyAvLyBzY2VuZSBjb3VsZCBiZSBhIE1lc2gsIExpbmUsIFBvaW50cywgLi4uCgogICAgCQkJdGV4dHVyZXMucmVzZXRUZXh0dXJlVW5pdHMoKTsKCiAgICAJCQljb25zdCBmb2cgPSBzY2VuZS5mb2c7CiAgICAJCQljb25zdCBlbnZpcm9ubWVudCA9IG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBzY2VuZS5lbnZpcm9ubWVudCA6IG51bGw7CiAgICAJCQljb25zdCBjb2xvclNwYWNlID0gKCBfY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApID8gX3RoaXMub3V0cHV0Q29sb3JTcGFjZSA6ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSA/IF9jdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuY29sb3JTcGFjZSA6IExpbmVhclNSR0JDb2xvclNwYWNlICk7CiAgICAJCQljb25zdCBlbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBlbnZpcm9ubWVudCApOwogICAgCQkJY29uc3QgdmVydGV4QWxwaGFzID0gbWF0ZXJpYWwudmVydGV4Q29sb3JzID09PSB0cnVlICYmICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IgJiYgZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvci5pdGVtU2l6ZSA9PT0gNDsKICAgIAkJCWNvbnN0IHZlcnRleFRhbmdlbnRzID0gISEgZ2VvbWV0cnkuYXR0cmlidXRlcy50YW5nZW50ICYmICggISEgbWF0ZXJpYWwubm9ybWFsTWFwIHx8IG1hdGVyaWFsLmFuaXNvdHJvcHkgPiAwICk7CiAgICAJCQljb25zdCBtb3JwaFRhcmdldHMgPSAhISBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CiAgICAJCQljb25zdCBtb3JwaE5vcm1hbHMgPSAhISBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsOwogICAgCQkJY29uc3QgbW9ycGhDb2xvcnMgPSAhISBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3I7CgogICAgCQkJbGV0IHRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCiAgICAJCQlpZiAoIG1hdGVyaWFsLnRvbmVNYXBwZWQgKSB7CgogICAgCQkJCWlmICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgfHwgX2N1cnJlbnRSZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCXRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3I7CiAgICAJCQljb25zdCBtb3JwaFRhcmdldHNDb3VudCA9ICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApID8gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoIDogMDsKCiAgICAJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKICAgIAkJCWNvbnN0IGxpZ2h0cyA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5saWdodHM7CgogICAgCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkID09PSB0cnVlICkgewoKICAgIAkJCQlpZiAoIF9sb2NhbENsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSB8fCBjYW1lcmEgIT09IF9jdXJyZW50Q2FtZXJhICkgewoKICAgIAkJCQkJY29uc3QgdXNlQ2FjaGUgPQogICAgCQkJCQkJY2FtZXJhID09PSBfY3VycmVudENhbWVyYSAmJgogICAgCQkJCQkJbWF0ZXJpYWwuaWQgPT09IF9jdXJyZW50TWF0ZXJpYWxJZDsKCiAgICAJCQkJCS8vIHdlIG1pZ2h0IHdhbnQgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIHdpdGggc29tZSBDbGlwcGluZ0dyb3VwCiAgICAJCQkJCS8vIG9iamVjdCBpbnN0ZWFkIG9mIHRoZSBtYXRlcmlhbCwgb25jZSBpdCBiZWNvbWVzIGZlYXNpYmxlCiAgICAJCQkJCS8vICgjODQ2NSwgIzgzNzkpCiAgICAJCQkJCWNsaXBwaW5nLnNldFN0YXRlKCBtYXRlcmlhbCwgY2FtZXJhLCB1c2VDYWNoZSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vCgogICAgCQkJbGV0IG5lZWRzUHJvZ3JhbUNoYW5nZSA9IGZhbHNlOwoKICAgIAkJCWlmICggbWF0ZXJpYWwudmVyc2lvbiA9PT0gbWF0ZXJpYWxQcm9wZXJ0aWVzLl9fdmVyc2lvbiApIHsKCiAgICAJCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgJiYgKCBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uICE9PSBsaWdodHMuc3RhdGUudmVyc2lvbiApICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm91dHB1dENvbG9yU3BhY2UgIT09IGNvbG9yU3BhY2UgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNCYXRjaGVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuYmF0Y2hpbmcgPT09IGZhbHNlICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNCYXRjaGVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuYmF0Y2hpbmcgPT09IHRydWUgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNCYXRjaGVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuYmF0Y2hpbmdDb2xvciA9PT0gdHJ1ZSAmJiBvYmplY3QuY29sb3JUZXh0dXJlID09PSBudWxsICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nQ29sb3IgPT09IGZhbHNlICYmIG9iamVjdC5jb2xvclRleHR1cmUgIT09IG51bGwgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nID09PSBmYWxzZSApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoICEgb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1NraW5uZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5za2lubmluZyA9PT0gZmFsc2UgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCAhIG9iamVjdC5pc1NraW5uZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5za2lubmluZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmdDb2xvciA9PT0gdHJ1ZSAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciA9PT0gbnVsbCApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmdDb2xvciA9PT0gZmFsc2UgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nTW9ycGggPT09IHRydWUgJiYgb2JqZWN0Lm1vcnBoVGV4dHVyZSA9PT0gbnVsbCApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmdNb3JwaCA9PT0gZmFsc2UgJiYgb2JqZWN0Lm1vcnBoVGV4dHVyZSAhPT0gbnVsbCApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXAgIT09IGVudk1hcCApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSAmJiBtYXRlcmlhbFByb3BlcnRpZXMuZm9nICE9PSBmb2cgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IHVuZGVmaW5lZCAmJgogICAgCQkJCQkoIG1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyAhPT0gY2xpcHBpbmcubnVtUGxhbmVzIHx8CiAgICAJCQkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1JbnRlcnNlY3Rpb24gIT09IGNsaXBwaW5nLm51bUludGVyc2VjdGlvbiApICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleEFscGhhcyAhPT0gdmVydGV4QWxwaGFzICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleFRhbmdlbnRzICE9PSB2ZXJ0ZXhUYW5nZW50cyApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHMgIT09IG1vcnBoVGFyZ2V0cyApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaE5vcm1hbHMgIT09IG1vcnBoTm9ybWFscyApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaENvbG9ycyAhPT0gbW9ycGhDb2xvcnMgKSB7CgogICAgCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMudG9uZU1hcHBpbmcgIT09IHRvbmVNYXBwaW5nICkgewoKICAgIAkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCiAgICAJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0c0NvdW50ICE9PSBtb3JwaFRhcmdldHNDb3VudCApIHsKCiAgICAJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgogICAgCQkJCX0KCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwogICAgCQkJCW1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gPSBtYXRlcmlhbC52ZXJzaW9uOwoKICAgIAkJCX0KCiAgICAJCQkvLwoKICAgIAkJCWxldCBwcm9ncmFtID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtOwoKICAgIAkJCWlmICggbmVlZHNQcm9ncmFtQ2hhbmdlID09PSB0cnVlICkgewoKICAgIAkJCQlwcm9ncmFtID0gZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCiAgICAJCQl9CgogICAgCQkJbGV0IHJlZnJlc2hQcm9ncmFtID0gZmFsc2U7CiAgICAJCQlsZXQgcmVmcmVzaE1hdGVyaWFsID0gZmFsc2U7CiAgICAJCQlsZXQgcmVmcmVzaExpZ2h0cyA9IGZhbHNlOwoKICAgIAkJCWNvbnN0IHBfdW5pZm9ybXMgPSBwcm9ncmFtLmdldFVuaWZvcm1zKCksCiAgICAJCQkJbV91bmlmb3JtcyA9IG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtczsKCiAgICAJCQlpZiAoIHN0YXRlLnVzZVByb2dyYW0oIHByb2dyYW0ucHJvZ3JhbSApICkgewoKICAgIAkJCQlyZWZyZXNoUHJvZ3JhbSA9IHRydWU7CiAgICAJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsKICAgIAkJCQlyZWZyZXNoTGlnaHRzID0gdHJ1ZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBtYXRlcmlhbC5pZCAhPT0gX2N1cnJlbnRNYXRlcmlhbElkICkgewoKICAgIAkJCQlfY3VycmVudE1hdGVyaWFsSWQgPSBtYXRlcmlhbC5pZDsKCiAgICAJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCByZWZyZXNoUHJvZ3JhbSB8fCBfY3VycmVudENhbWVyYSAhPT0gY2FtZXJhICkgewoKICAgIAkJCQkvLyBjb21tb24gY2FtZXJhIHVuaWZvcm1zCgogICAgCQkJCWNvbnN0IHJldmVyc2VEZXB0aEJ1ZmZlciA9IHN0YXRlLmJ1ZmZlcnMuZGVwdGguZ2V0UmV2ZXJzZWQoKTsKCiAgICAJCQkJaWYgKCByZXZlcnNlRGVwdGhCdWZmZXIgKSB7CgogICAgCQkJCQlfY3VycmVudFByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCiAgICAJCQkJCXRvTm9ybWFsaXplZFByb2plY3Rpb25NYXRyaXgoIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwogICAgCQkJCQl0b1JldmVyc2VkUHJvamVjdGlvbk1hdHJpeCggX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4ICk7CgogICAgCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdwcm9qZWN0aW9uTWF0cml4JywgX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4ICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdwcm9qZWN0aW9uTWF0cml4JywgY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCiAgICAJCQkJfQoKICAgIAkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICd2aWV3TWF0cml4JywgY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoKICAgIAkJCQljb25zdCB1Q2FtUG9zID0gcF91bmlmb3Jtcy5tYXAuY2FtZXJhUG9zaXRpb247CgogICAgCQkJCWlmICggdUNhbVBvcyAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJdUNhbVBvcy5zZXRWYWx1ZSggX2dsLCBfdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApICk7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciApIHsKCiAgICAJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2xvZ0RlcHRoQnVmRkMnLAogICAgCQkJCQkJMi4wIC8gKCBNYXRoLmxvZyggY2FtZXJhLmZhciArIDEuMCApIC8gTWF0aC5MTjIgKSApOwoKICAgIAkJCQl9CgogICAgCQkJCS8vIGNvbnNpZGVyIG1vdmluZyBpc09ydGhvZ3JhcGhpYyB0byBVbmlmb3JtTGliIGFuZCBXZWJHTE1hdGVyaWFscywgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yNjQ2NyNpc3N1ZWNvbW1lbnQtMTY0NTE4NTA2NwoKICAgIAkJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKICAgIAkJCQkJbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsIHx8CiAgICAJCQkJCW1hdGVyaWFsLmlzTWVzaExhbWJlcnRNYXRlcmlhbCB8fAogICAgCQkJCQltYXRlcmlhbC5pc01lc2hCYXNpY01hdGVyaWFsIHx8CiAgICAJCQkJCW1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgfHwKICAgIAkJCQkJbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCApIHsKCiAgICAJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2lzT3J0aG9ncmFwaGljJywgY2FtZXJhLmlzT3J0aG9ncmFwaGljQ2FtZXJhID09PSB0cnVlICk7CgogICAgCQkJCX0KCiAgICAJCQkJaWYgKCBfY3VycmVudENhbWVyYSAhPT0gY2FtZXJhICkgewoKICAgIAkJCQkJX2N1cnJlbnRDYW1lcmEgPSBjYW1lcmE7CgogICAgCQkJCQkvLyBsaWdodGluZyB1bmlmb3JtcyBkZXBlbmQgb24gdGhlIGNhbWVyYSBzbyBlbmZvcmNlIGFuIHVwZGF0ZQogICAgCQkJCQkvLyBub3csIGluIGNhc2UgdGhpcyBtYXRlcmlhbCBzdXBwb3J0cyBsaWdodHMgLSBvciBsYXRlciwgd2hlbgogICAgCQkJCQkvLyB0aGUgbmV4dCBtYXRlcmlhbCB0aGF0IGRvZXMgZ2V0cyBhY3RpdmF0ZWQ6CgogICAgCQkJCQlyZWZyZXNoTWF0ZXJpYWwgPSB0cnVlOwkJLy8gc2V0IHRvIHRydWUgb24gbWF0ZXJpYWwgY2hhbmdlCiAgICAJCQkJCXJlZnJlc2hMaWdodHMgPSB0cnVlOwkJLy8gcmVtYWlucyBzZXQgdW50aWwgdXBkYXRlIGRvbmUKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQkvLyBza2lubmluZyBhbmQgbW9ycGggdGFyZ2V0IHVuaWZvcm1zIG11c3QgYmUgc2V0IGV2ZW4gaWYgbWF0ZXJpYWwgZGlkbid0IGNoYW5nZQogICAgCQkJLy8gYXV0by1zZXR0aW5nIG9mIHRleHR1cmUgdW5pdCBmb3IgYm9uZSBhbmQgbW9ycGggdGV4dHVyZSBtdXN0IGdvIGJlZm9yZSBvdGhlciB0ZXh0dXJlcwogICAgCQkJLy8gb3RoZXJ3aXNlIHRleHR1cmVzIHVzZWQgZm9yIHNraW5uaW5nIGFuZCBtb3JwaGluZyBjYW4gdGFrZSBvdmVyIHRleHR1cmUgdW5pdHMgcmVzZXJ2ZWQgZm9yIG90aGVyIG1hdGVyaWFsIHRleHR1cmVzCgogICAgCQkJaWYgKCBvYmplY3QuaXNTa2lubmVkTWVzaCApIHsKCiAgICAJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiaW5kTWF0cml4JyApOwogICAgCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeEludmVyc2UnICk7CgogICAgCQkJCWNvbnN0IHNrZWxldG9uID0gb2JqZWN0LnNrZWxldG9uOwoKICAgIAkJCQlpZiAoIHNrZWxldG9uICkgewoKICAgIAkJCQkJaWYgKCBza2VsZXRvbi5ib25lVGV4dHVyZSA9PT0gbnVsbCApIHNrZWxldG9uLmNvbXB1dGVCb25lVGV4dHVyZSgpOwoKICAgIAkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYm9uZVRleHR1cmUnLCBza2VsZXRvbi5ib25lVGV4dHVyZSwgdGV4dHVyZXMgKTsKCiAgICAJCQkJfQoKICAgIAkJCX0KCiAgICAJCQlpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICkgewoKICAgIAkJCQlwX3VuaWZvcm1zLnNldE9wdGlvbmFsKCBfZ2wsIG9iamVjdCwgJ2JhdGNoaW5nVGV4dHVyZScgKTsKICAgIAkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdiYXRjaGluZ1RleHR1cmUnLCBvYmplY3QuX21hdHJpY2VzVGV4dHVyZSwgdGV4dHVyZXMgKTsKCiAgICAJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ0lkVGV4dHVyZScgKTsKICAgIAkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdiYXRjaGluZ0lkVGV4dHVyZScsIG9iamVjdC5faW5kaXJlY3RUZXh0dXJlLCB0ZXh0dXJlcyApOwoKICAgIAkJCQlwX3VuaWZvcm1zLnNldE9wdGlvbmFsKCBfZ2wsIG9iamVjdCwgJ2JhdGNoaW5nQ29sb3JUZXh0dXJlJyApOwogICAgCQkJCWlmICggb2JqZWN0Ll9jb2xvcnNUZXh0dXJlICE9PSBudWxsICkgewoKICAgIAkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdDb2xvclRleHR1cmUnLCBvYmplY3QuX2NvbG9yc1RleHR1cmUsIHRleHR1cmVzICk7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoKICAgIAkJCWlmICggbW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgfHwgbW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCAhPT0gdW5kZWZpbmVkIHx8ICggbW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQgKSApIHsKCiAgICAJCQkJbW9ycGh0YXJnZXRzLnVwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSApOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIHJlZnJlc2hNYXRlcmlhbCB8fCBtYXRlcmlhbFByb3BlcnRpZXMucmVjZWl2ZVNoYWRvdyAhPT0gb2JqZWN0LnJlY2VpdmVTaGFkb3cgKSB7CgogICAgCQkJCW1hdGVyaWFsUHJvcGVydGllcy5yZWNlaXZlU2hhZG93ID0gb2JqZWN0LnJlY2VpdmVTaGFkb3c7CiAgICAJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncmVjZWl2ZVNoYWRvdycsIG9iamVjdC5yZWNlaXZlU2hhZG93ICk7CgogICAgCQkJfQoKICAgIAkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yNDQ2NyNpc3N1ZWNvbW1lbnQtMTIwOTAzMTUxMgoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNNZXNoR291cmF1ZE1hdGVyaWFsICYmIG1hdGVyaWFsLmVudk1hcCAhPT0gbnVsbCApIHsKCiAgICAJCQkJbV91bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBlbnZNYXA7CgogICAgCQkJCW1fdW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggZW52TWFwLmlzQ3ViZVRleHR1cmUgJiYgZW52TWFwLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSA/IC0xIDogMTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsICYmIG1hdGVyaWFsLmVudk1hcCA9PT0gbnVsbCAmJiBzY2VuZS5lbnZpcm9ubWVudCAhPT0gbnVsbCApIHsKCiAgICAJCQkJbV91bmlmb3Jtcy5lbnZNYXBJbnRlbnNpdHkudmFsdWUgPSBzY2VuZS5lbnZpcm9ubWVudEludGVuc2l0eTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCByZWZyZXNoTWF0ZXJpYWwgKSB7CgogICAgCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3RvbmVNYXBwaW5nRXhwb3N1cmUnLCBfdGhpcy50b25lTWFwcGluZ0V4cG9zdXJlICk7CgogICAgCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICkgewoKICAgIAkJCQkJLy8gdGhlIGN1cnJlbnQgbWF0ZXJpYWwgcmVxdWlyZXMgbGlnaHRpbmcgaW5mbwoKICAgIAkJCQkJLy8gbm90ZTogYWxsIGxpZ2h0aW5nIHVuaWZvcm1zIGFyZSBhbHdheXMgc2V0IGNvcnJlY3RseQogICAgCQkJCQkvLyB0aGV5IHNpbXBseSByZWZlcmVuY2UgdGhlIHJlbmRlcmVyJ3Mgc3RhdGUgZm9yIHRoZWlyCiAgICAJCQkJCS8vIHZhbHVlcwogICAgCQkJCQkvLwogICAgCQkJCQkvLyB1c2UgdGhlIGN1cnJlbnQgbWF0ZXJpYWwncyAubmVlZHNVcGRhdGUgZmxhZ3MgdG8gc2V0CiAgICAJCQkJCS8vIHRoZSBHTCBzdGF0ZSB3aGVuIHJlcXVpcmVkCgogICAgCQkJCQltYXJrVW5pZm9ybXNMaWdodHNOZWVkc1VwZGF0ZSggbV91bmlmb3JtcywgcmVmcmVzaExpZ2h0cyApOwoKICAgIAkJCQl9CgogICAgCQkJCS8vIHJlZnJlc2ggdW5pZm9ybXMgY29tbW9uIHRvIHNldmVyYWwgbWF0ZXJpYWxzCgogICAgCQkJCWlmICggZm9nICYmIG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSApIHsKCiAgICAJCQkJCW1hdGVyaWFscy5yZWZyZXNoRm9nVW5pZm9ybXMoIG1fdW5pZm9ybXMsIGZvZyApOwoKICAgIAkJCQl9CgogICAgCQkJCW1hdGVyaWFscy5yZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcyggbV91bmlmb3JtcywgbWF0ZXJpYWwsIF9waXhlbFJhdGlvLCBfaGVpZ2h0LCBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUudHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0WyBjYW1lcmEuaWQgXSApOwoKICAgIAkJCQlXZWJHTFVuaWZvcm1zLnVwbG9hZCggX2dsLCBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICksIG1fdW5pZm9ybXMsIHRleHR1cmVzICk7CgogICAgCQkJfQoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPT09IHRydWUgKSB7CgogICAgCQkJCVdlYkdMVW5pZm9ybXMudXBsb2FkKCBfZ2wsIGdldFVuaWZvcm1MaXN0KCBtYXRlcmlhbFByb3BlcnRpZXMgKSwgbV91bmlmb3JtcywgdGV4dHVyZXMgKTsKICAgIAkJCQltYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsKCiAgICAJCQl9CgogICAgCQkJaWYgKCBtYXRlcmlhbC5pc1Nwcml0ZU1hdGVyaWFsICkgewoKICAgIAkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdjZW50ZXInLCBvYmplY3QuY2VudGVyICk7CgogICAgCQkJfQoKICAgIAkJCS8vIGNvbW1vbiBtYXRyaWNlcwoKICAgIAkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ21vZGVsVmlld01hdHJpeCcsIG9iamVjdC5tb2RlbFZpZXdNYXRyaXggKTsKICAgIAkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ25vcm1hbE1hdHJpeCcsIG9iamVjdC5ub3JtYWxNYXRyaXggKTsKICAgIAkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ21vZGVsTWF0cml4Jywgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgogICAgCQkJLy8gVUJPcwoKICAgIAkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc1Jhd1NoYWRlck1hdGVyaWFsICkgewoKICAgIAkJCQljb25zdCBncm91cHMgPSBtYXRlcmlhbC51bmlmb3Jtc0dyb3VwczsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgogICAgCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoKICAgIAkJCQkJdW5pZm9ybXNHcm91cHMudXBkYXRlKCBncm91cCwgcHJvZ3JhbSApOwogICAgCQkJCQl1bmlmb3Jtc0dyb3Vwcy5iaW5kKCBncm91cCwgcHJvZ3JhbSApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCXJldHVybiBwcm9ncmFtOwoKICAgIAkJfQoKICAgIAkJLy8gSWYgdW5pZm9ybXMgYXJlIG1hcmtlZCBhcyBjbGVhbiwgdGhleSBkb24ndCBuZWVkIHRvIGJlIGxvYWRlZCB0byB0aGUgR1BVLgoKICAgIAkJZnVuY3Rpb24gbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUoIHVuaWZvcm1zLCB2YWx1ZSApIHsKCiAgICAJCQl1bmlmb3Jtcy5hbWJpZW50TGlnaHRDb2xvci5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMubGlnaHRQcm9iZS5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoKICAgIAkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMucG9pbnRMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKICAgIAkJCXVuaWZvcm1zLnBvaW50TGlnaHRTaGFkb3dzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAJCQl1bmlmb3Jtcy5zcG90TGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAJCQl1bmlmb3Jtcy5zcG90TGlnaHRTaGFkb3dzLm5lZWRzVXBkYXRlID0gdmFsdWU7CiAgICAJCQl1bmlmb3Jtcy5yZWN0QXJlYUxpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwogICAgCQkJdW5pZm9ybXMuaGVtaXNwaGVyZUxpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoKICAgIAkJfQoKICAgIAkJZnVuY3Rpb24gbWF0ZXJpYWxOZWVkc0xpZ2h0cyggbWF0ZXJpYWwgKSB7CgogICAgCQkJcmV0dXJuIG1hdGVyaWFsLmlzTWVzaExhbWJlcnRNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCB8fAogICAgCQkJCW1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNTaGFkb3dNYXRlcmlhbCB8fAogICAgCQkJCSggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC5saWdodHMgPT09IHRydWUgKTsKCiAgICAJCX0KCiAgICAJCS8qKgogICAgCQkgKiBSZXR1cm5zIHRoZSBhY3RpdmUgY3ViZSBmYWNlLgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhY3RpdmUgY3ViZSBmYWNlLgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRBY3RpdmVDdWJlRmFjZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlyZXR1cm4gX2N1cnJlbnRBY3RpdmVDdWJlRmFjZTsKCiAgICAJCX07CgogICAgCQkvKioKICAgIAkJICogUmV0dXJucyB0aGUgYWN0aXZlIG1pcG1hcCBsZXZlbC4KICAgIAkJICoKICAgIAkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgYWN0aXZlIG1pcG1hcCBsZXZlbC4KICAgIAkJICovCiAgICAJCXRoaXMuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWw7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIFJldHVybnMgdGhlIGFjdGl2ZSByZW5kZXIgdGFyZ2V0LgogICAgCQkgKgogICAgCQkgKiBAcmV0dXJuIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSBhY3RpdmUgcmVuZGVyIHRhcmdldC4gUmV0dXJucyBgbnVsbGAgaWYgbm8gcmVuZGVyIHRhcmdldAogICAgCQkgKiBpcyBjdXJyZW50bHkgc2V0LgogICAgCQkgKi8KICAgIAkJdGhpcy5nZXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoKSB7CgogICAgCQkJcmV0dXJuIF9jdXJyZW50UmVuZGVyVGFyZ2V0OwoKICAgIAkJfTsKCiAgICAJCXRoaXMuc2V0UmVuZGVyVGFyZ2V0VGV4dHVyZXMgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgY29sb3JUZXh0dXJlLCBkZXB0aFRleHR1cmUgKSB7CgogICAgCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYXV0b0FsbG9jYXRlRGVwdGhCdWZmZXIgPSByZW5kZXJUYXJnZXQucmVzb2x2ZURlcHRoQnVmZmVyID09PSBmYWxzZTsKICAgIAkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2F1dG9BbGxvY2F0ZURlcHRoQnVmZmVyID09PSBmYWxzZSApIHsKCiAgICAJCQkJLy8gVGhlIG11bHRpc2FtcGxlX3JlbmRlcl90b190ZXh0dXJlIGV4dGVuc2lvbiBkb2Vzbid0IHdvcmsgcHJvcGVybHkgaWYgdGhlcmUKICAgIAkJCQkvLyBhcmUgbWlkZnJhbWUgZmx1c2hlcyBhbmQgYW4gZXh0ZXJuYWwgZGVwdGggYnVmZmVyLiBEaXNhYmxlIHVzZSBvZiB0aGUgZXh0ZW5zaW9uLgogICAgCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX191c2VSZW5kZXJUb1RleHR1cmUgPSBmYWxzZTsKCiAgICAJCQl9CgogICAgCQkJcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICkuX193ZWJnbFRleHR1cmUgPSBjb2xvclRleHR1cmU7CiAgICAJCQlwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlID0gcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2F1dG9BbGxvY2F0ZURlcHRoQnVmZmVyID8gdW5kZWZpbmVkIDogZGVwdGhUZXh0dXJlOwoKICAgIAkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzID0gdHJ1ZTsKCiAgICAJCX07CgogICAgCQl0aGlzLnNldFJlbmRlclRhcmdldEZyYW1lYnVmZmVyID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGRlZmF1bHRGcmFtZWJ1ZmZlciApIHsKCiAgICAJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwogICAgCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBkZWZhdWx0RnJhbWVidWZmZXI7CiAgICAJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlRGVmYXVsdEZyYW1lYnVmZmVyID0gZGVmYXVsdEZyYW1lYnVmZmVyID09PSB1bmRlZmluZWQ7CgogICAgCQl9OwoKICAgIAkJY29uc3QgX3NjcmF0Y2hGcmFtZUJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKICAgIAkJLyoqCiAgICAJCSAqIFNldHMgdGhlIGFjdGl2ZSByZW5kZXJ0YXJnZXQuCiAgICAJCSAqCiAgICAJCSAqIEBwYXJhbSB7P1dlYkdMUmVuZGVyVGFyZ2V0fSByZW5kZXJUYXJnZXQgLSBUaGUgcmVuZGVyIHRhcmdldCB0byBzZXQuIFdoZW4gYG51bGxgIGlzIGdpdmVuLAogICAgCQkgKiB0aGUgY2FudmFzIGlzIHNldCBhcyB0aGUgYWN0aXZlIHJlbmRlciB0YXJnZXQgaW5zdGVhZC4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZT0wXSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIHdoZW4gdXNpbmcgYSBjdWJlIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqIEluZGljYXRlcyB0aGUgeiBsYXllciB0byByZW5kZXIgaW4gdG8gd2hlbiB1c2luZyAzRCBvciBhcnJheSByZW5kZXIgdGFyZ2V0cy4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVNaXBtYXBMZXZlbD0wXSAtIFRoZSBhY3RpdmUgbWlwbWFwIGxldmVsLgogICAgCQkgKi8KICAgIAkJdGhpcy5zZXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UgPSAwLCBhY3RpdmVNaXBtYXBMZXZlbCA9IDAgKSB7CgogICAgCQkJX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJUYXJnZXQ7CiAgICAJCQlfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gYWN0aXZlQ3ViZUZhY2U7CiAgICAJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gYWN0aXZlTWlwbWFwTGV2ZWw7CgogICAgCQkJbGV0IHVzZURlZmF1bHRGcmFtZWJ1ZmZlciA9IHRydWU7CiAgICAJCQlsZXQgZnJhbWVidWZmZXIgPSBudWxsOwogICAgCQkJbGV0IGlzQ3ViZSA9IGZhbHNlOwogICAgCQkJbGV0IGlzUmVuZGVyVGFyZ2V0M0QgPSBmYWxzZTsKCiAgICAJCQlpZiAoIHJlbmRlclRhcmdldCApIHsKCiAgICAJCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlRGVmYXVsdEZyYW1lYnVmZmVyICE9PSB1bmRlZmluZWQgKSB7CgogICAgCQkJCQkvLyBXZSBuZWVkIHRvIG1ha2Ugc3VyZSB0byByZWJpbmQgdGhlIGZyYW1lYnVmZmVyLgogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwogICAgCQkJCQl1c2VEZWZhdWx0RnJhbWVidWZmZXIgPSBmYWxzZTsKCiAgICAJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJCXRleHR1cmVzLnNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKTsKCiAgICAJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2hhc0V4dGVybmFsVGV4dHVyZXMgKSB7CgogICAgCQkJCQkvLyBDb2xvciBhbmQgZGVwdGggdGV4dHVyZSBtdXN0IGJlIHJlYm91bmQgaW4gb3JkZXIgZm9yIHRoZSBzd2FwY2hhaW4gdG8gdXBkYXRlLgogICAgCQkJCQl0ZXh0dXJlcy5yZWJpbmRUZXh0dXJlcyggcmVuZGVyVGFyZ2V0LCBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSwgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSApOwoKICAgIAkJCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgogICAgCQkJCQkvLyBjaGVjayBpZiB0aGUgZGVwdGggdGV4dHVyZSBpcyBhbHJlYWR5IGJvdW5kIHRvIHRoZSBmcmFtZSBidWZmZXIgYW5kIHRoYXQgaXQncyBiZWVuIGluaXRpYWxpemVkCiAgICAJCQkJCWNvbnN0IGRlcHRoVGV4dHVyZSA9IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmU7CiAgICAJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2JvdW5kRGVwdGhUZXh0dXJlICE9PSBkZXB0aFRleHR1cmUgKSB7CgogICAgCQkJCQkJLy8gY2hlY2sgaWYgdGhlIGRlcHRoIHRleHR1cmUgaXMgY29tcGF0aWJsZQogICAgCQkJCQkJaWYgKAogICAgCQkJCQkJCWRlcHRoVGV4dHVyZSAhPT0gbnVsbCAmJgogICAgCQkJCQkJCXByb3BlcnRpZXMuaGFzKCBkZXB0aFRleHR1cmUgKSAmJgogICAgCQkJCQkJCSggcmVuZGVyVGFyZ2V0LndpZHRoICE9PSBkZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggfHwgcmVuZGVyVGFyZ2V0LmhlaWdodCAhPT0gZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCApCiAgICAJCQkJCQkpIHsKCiAgICAJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnV2ViR0xSZW5kZXJUYXJnZXQ6IEF0dGFjaGVkIERlcHRoVGV4dHVyZSBpcyBpbml0aWFsaXplZCB0byB0aGUgaW5jb3JyZWN0IHNpemUuJyApOwoKICAgIAkJCQkJCX0KCiAgICAJCQkJCQkvLyBTd2FwIHRoZSBkZXB0aCBidWZmZXIgdG8gdGhlIGN1cnJlbnRseSBhdHRhY2hlZCBvbmUKICAgIAkJCQkJCXRleHR1cmVzLnNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZTsKCiAgICAJCQkJaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSB8fCB0ZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCiAgICAJCQkJCWlzUmVuZGVyVGFyZ2V0M0QgPSB0cnVlOwoKICAgIAkJCQl9CgogICAgCQkJCWNvbnN0IF9fd2ViZ2xGcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CgogICAgCQkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICkgewoKICAgIAkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF0gKSApIHsKCiAgICAJCQkJCQlmcmFtZWJ1ZmZlciA9IF9fd2ViZ2xGcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2UgXVsgYWN0aXZlTWlwbWFwTGV2ZWwgXTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF07CgogICAgCQkJCQl9CgogICAgCQkJCQlpc0N1YmUgPSB0cnVlOwoKICAgIAkJCQl9IGVsc2UgaWYgKCAoIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApICYmIHRleHR1cmVzLnVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKICAgIAkJCQkJZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyOwoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBfX3dlYmdsRnJhbWVidWZmZXIgKSApIHsKCiAgICAJCQkJCQlmcmFtZWJ1ZmZlciA9IF9fd2ViZ2xGcmFtZWJ1ZmZlclsgYWN0aXZlTWlwbWFwTGV2ZWwgXTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXI7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQkJX2N1cnJlbnRWaWV3cG9ydC5jb3B5KCByZW5kZXJUYXJnZXQudmlld3BvcnQgKTsKICAgIAkJCQlfY3VycmVudFNjaXNzb3IuY29weSggcmVuZGVyVGFyZ2V0LnNjaXNzb3IgKTsKICAgIAkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gcmVuZGVyVGFyZ2V0LnNjaXNzb3JUZXN0OwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCV9jdXJyZW50Vmlld3BvcnQuY29weSggX3ZpZXdwb3J0ICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKICAgIAkJCQlfY3VycmVudFNjaXNzb3IuY29weSggX3NjaXNzb3IgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKS5mbG9vcigpOwogICAgCQkJCV9jdXJyZW50U2Npc3NvclRlc3QgPSBfc2Npc3NvclRlc3Q7CgogICAgCQkJfQoKICAgIAkJCS8vIFVzZSBhIHNjcmF0Y2ggZnJhbWUgYnVmZmVyIGlmIHJlbmRlcmluZyB0byBhIG1pcCBsZXZlbCB0byBhdm9pZCBkZXB0aCBidWZmZXJzCiAgICAJCQkvLyBiZWluZyBib3VuZCB0aGF0IGFyZSBkaWZmZXJlbnQgc2l6ZXMuCiAgICAJCQlpZiAoIGFjdGl2ZU1pcG1hcExldmVsICE9PSAwICkgewoKICAgIAkJCQlmcmFtZWJ1ZmZlciA9IF9zY3JhdGNoRnJhbWVCdWZmZXI7CgogICAgCQkJfQoKICAgIAkJCWNvbnN0IGZyYW1lYnVmZmVyQm91bmQgPSBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCiAgICAJCQlpZiAoIGZyYW1lYnVmZmVyQm91bmQgJiYgdXNlRGVmYXVsdEZyYW1lYnVmZmVyICkgewoKICAgIAkJCQlzdGF0ZS5kcmF3QnVmZmVycyggcmVuZGVyVGFyZ2V0LCBmcmFtZWJ1ZmZlciApOwoKICAgIAkJCX0KCiAgICAJCQlzdGF0ZS52aWV3cG9ydCggX2N1cnJlbnRWaWV3cG9ydCApOwogICAgCQkJc3RhdGUuc2Npc3NvciggX2N1cnJlbnRTY2lzc29yICk7CiAgICAJCQlzdGF0ZS5zZXRTY2lzc29yVGVzdCggX2N1cnJlbnRTY2lzc29yVGVzdCApOwoKICAgIAkJCWlmICggaXNDdWJlICkgewoKICAgIAkJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApOwogICAgCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBhY3RpdmVDdWJlRmFjZSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcG1hcExldmVsICk7CgogICAgCQkJfSBlbHNlIGlmICggaXNSZW5kZXJUYXJnZXQzRCApIHsKCiAgICAJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKICAgIAkJCQljb25zdCBsYXllciA9IGFjdGl2ZUN1YmVGYWNlOwogICAgCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmVMYXllciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBhY3RpdmVNaXBtYXBMZXZlbCwgbGF5ZXIgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQgIT09IG51bGwgJiYgYWN0aXZlTWlwbWFwTGV2ZWwgIT09IDAgKSB7CgogICAgCQkJCS8vIE9ubHkgYmluZCB0aGUgZnJhbWUgYnVmZmVyIGlmIHdlIGFyZSB1c2luZyBhIHNjcmF0Y2ggZnJhbWUgYnVmZmVyIHRvIHJlbmRlciB0byBhIG1pcG1hcC4KICAgIAkJCQkvLyBJZiB3ZSByZWJpbmQgdGhlIHRleHR1cmUgd2hlbiB1c2luZyBhIG11bHRpIHNhbXBsZSBidWZmZXIgdGhlbiBhbiBlcnJvciBhYm91dCBpbmNvbnNpc3RlbnQgc2FtcGxlcyB3aWxsIGJlIHRocm93bi4KICAgIAkJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApOwogICAgCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFXzJELCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCiAgICAJCQl9CgogICAgCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gLTE7IC8vIHJlc2V0IGN1cnJlbnQgbWF0ZXJpYWwgdG8gZW5zdXJlIGNvcnJlY3QgdW5pZm9ybSBiaW5kaW5ncwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBSZWFkcyB0aGUgcGl4ZWwgZGF0YSBmcm9tIHRoZSBnaXZlbiByZW5kZXIgdGFyZ2V0IGludG8gdGhlIGdpdmVuIGJ1ZmZlci4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtXZWJHTFJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG8gcmVhZCBmcm9tLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBgeGAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGB5YCBjb29yZGluYXRlIG9mIHRoZSBjb3B5IHJlZ2lvbidzIG9yaWdpbi4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBjb3B5IHJlZ2lvbi4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIGNvcHkgcmVnaW9uLgogICAgCQkgKiBAcGFyYW0ge1R5cGVkQXJyYXl9IGJ1ZmZlciAtIFRoZSByZXN1bHQgYnVmZmVyLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gW2FjdGl2ZUN1YmVGYWNlSW5kZXhdIC0gVGhlIGFjdGl2ZSBjdWJlIGZhY2UgaW5kZXguCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdGV4dHVyZUluZGV4PTBdIC0gVGhlIHRleHR1cmUgaW5kZXggb2YgYW4gTVJUIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqLwogICAgCQl0aGlzLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHMgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgYnVmZmVyLCBhY3RpdmVDdWJlRmFjZUluZGV4LCB0ZXh0dXJlSW5kZXggPSAwICkgewoKICAgIAkJCWlmICggISAoIHJlbmRlclRhcmdldCAmJiByZW5kZXJUYXJnZXQuaXNXZWJHTFJlbmRlclRhcmdldCApICkgewoKICAgIAkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IFRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0LicgKTsKICAgIAkJCQlyZXR1cm47CgogICAgCQkJfQoKICAgIAkJCWxldCBmcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CgogICAgCQkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgJiYgYWN0aXZlQ3ViZUZhY2VJbmRleCAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQlmcmFtZWJ1ZmZlciA9IGZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZUluZGV4IF07CgogICAgCQkJfQoKICAgIAkJCWlmICggZnJhbWVidWZmZXIgKSB7CgogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBmcmFtZWJ1ZmZlciApOwoKICAgIAkJCQl0cnkgewoKICAgIAkJCQkJY29uc3QgdGV4dHVyZSA9IHJlbmRlclRhcmdldC50ZXh0dXJlc1sgdGV4dHVyZUluZGV4IF07CiAgICAJCQkJCWNvbnN0IHRleHR1cmVGb3JtYXQgPSB0ZXh0dXJlLmZvcm1hdDsKICAgIAkJCQkJY29uc3QgdGV4dHVyZVR5cGUgPSB0ZXh0dXJlLnR5cGU7CgogICAgCQkJCQlpZiAoICEgY2FwYWJpbGl0aWVzLnRleHR1cmVGb3JtYXRSZWFkYWJsZSggdGV4dHVyZUZvcm1hdCApICkgewoKICAgIAkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gUkdCQSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIGZvcm1hdC4nICk7CiAgICAJCQkJCQlyZXR1cm47CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoICEgY2FwYWJpbGl0aWVzLnRleHR1cmVUeXBlUmVhZGFibGUoIHRleHR1cmVUeXBlICkgKSB7CgogICAgCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBpbiBVbnNpZ25lZEJ5dGVUeXBlIG9yIGltcGxlbWVudGF0aW9uIGRlZmluZWQgdHlwZS4nICk7CiAgICAJCQkJCQlyZXR1cm47CgogICAgCQkJCQl9CgogICAgCQkJCQkvLyB0aGUgZm9sbG93aW5nIGlmIHN0YXRlbWVudCBlbnN1cmVzIHZhbGlkIHJlYWQgcmVxdWVzdHMgKG5vIG91dC1vZi1ib3VuZHMgcGl4ZWxzLCBzZWUgIzg2MDQpCgogICAgCQkJCQlpZiAoICggeCA+PSAwICYmIHggPD0gKCByZW5kZXJUYXJnZXQud2lkdGggLSB3aWR0aCApICkgJiYgKCB5ID49IDAgJiYgeSA8PSAoIHJlbmRlclRhcmdldC5oZWlnaHQgLSBoZWlnaHQgKSApICkgewoKICAgIAkJCQkJCS8vIHdoZW4gdXNpbmcgTVJULCBzZWxlY3QgdGhlIGNvcnJlY3QgY29sb3IgYnVmZmVyIGZvciB0aGUgc3Vic2VxdWVudCByZWFkIGNvbW1hbmQKCiAgICAJCQkJCQlpZiAoIHJlbmRlclRhcmdldC50ZXh0dXJlcy5sZW5ndGggPiAxICkgX2dsLnJlYWRCdWZmZXIoIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIHRleHR1cmVJbmRleCApOwoKICAgIAkJCQkJCV9nbC5yZWFkUGl4ZWxzKCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICksIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICksIGJ1ZmZlciApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGZpbmFsbHkgewoKICAgIAkJCQkJLy8gcmVzdG9yZSBmcmFtZWJ1ZmZlciBvZiBjdXJyZW50IHJlbmRlciB0YXJnZXQgaWYgbmVjZXNzYXJ5CgogICAgCQkJCQljb25zdCBmcmFtZWJ1ZmZlciA9ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgIT09IG51bGwgKSA/IHByb3BlcnRpZXMuZ2V0KCBfY3VycmVudFJlbmRlclRhcmdldCApLl9fd2ViZ2xGcmFtZWJ1ZmZlciA6IG51bGw7CiAgICAJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBmcmFtZWJ1ZmZlciApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBBc3luY2hyb25vdXMsIG5vbi1ibG9ja2luZyB2ZXJzaW9uIG9mIHtAbGluayBXZWJHTFJlbmRlcmVyI3JlYWRSZW5kZXJUYXJnZXRQaXhlbHN9LgogICAgCQkgKgogICAgCQkgKiBJdCBpcyByZWNvbW1lbmRlZCB0byB1c2UgdGhpcyB2ZXJzaW9uIG9mIGByZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzKClgIHdoZW5ldmVyIHBvc3NpYmxlLgogICAgCQkgKgogICAgCQkgKiBAYXN5bmMKICAgIAkJICogQHBhcmFtIHtXZWJHTFJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG8gcmVhZCBmcm9tLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBgeGAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGB5YCBjb29yZGluYXRlIG9mIHRoZSBjb3B5IHJlZ2lvbidzIG9yaWdpbi4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBjb3B5IHJlZ2lvbi4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIGNvcHkgcmVnaW9uLgogICAgCQkgKiBAcGFyYW0ge1R5cGVkQXJyYXl9IGJ1ZmZlciAtIFRoZSByZXN1bHQgYnVmZmVyLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gW2FjdGl2ZUN1YmVGYWNlSW5kZXhdIC0gVGhlIGFjdGl2ZSBjdWJlIGZhY2UgaW5kZXguCiAgICAJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdGV4dHVyZUluZGV4PTBdIC0gVGhlIHRleHR1cmUgaW5kZXggb2YgYW4gTVJUIHJlbmRlciB0YXJnZXQuCiAgICAJCSAqIEByZXR1cm4ge1Byb21pc2U8VHlwZWRBcnJheT59IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIHJlYWQgaGFzIGJlZW4gZmluaXNoZWQuIFRoZSByZXNvbHZlIHByb3ZpZGVzIHRoZSByZWFkIGRhdGEgYXMgYSB0eXBlZCBhcnJheS4KICAgIAkJICovCiAgICAJCXRoaXMucmVhZFJlbmRlclRhcmdldFBpeGVsc0FzeW5jID0gYXN5bmMgZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGJ1ZmZlciwgYWN0aXZlQ3ViZUZhY2VJbmRleCwgdGV4dHVyZUluZGV4ID0gMCApIHsKCiAgICAJCQlpZiAoICEgKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXQgKSApIHsKCiAgICAJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IFRIUkVFLldlYkdMUmVuZGVyVGFyZ2V0LicgKTsKCiAgICAJCQl9CgogICAgCQkJbGV0IGZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xGcmFtZWJ1ZmZlcjsKICAgIAkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICYmIGFjdGl2ZUN1YmVGYWNlSW5kZXggIT09IHVuZGVmaW5lZCApIHsKCiAgICAJCQkJZnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2VJbmRleCBdOwoKICAgIAkJCX0KCiAgICAJCQlpZiAoIGZyYW1lYnVmZmVyICkgewoKICAgIAkJCQkvLyB0aGUgZm9sbG93aW5nIGlmIHN0YXRlbWVudCBlbnN1cmVzIHZhbGlkIHJlYWQgcmVxdWVzdHMgKG5vIG91dC1vZi1ib3VuZHMgcGl4ZWxzLCBzZWUgIzg2MDQpCiAgICAJCQkJaWYgKCAoIHggPj0gMCAmJiB4IDw9ICggcmVuZGVyVGFyZ2V0LndpZHRoIC0gd2lkdGggKSApICYmICggeSA+PSAwICYmIHkgPD0gKCByZW5kZXJUYXJnZXQuaGVpZ2h0IC0gaGVpZ2h0ICkgKSApIHsKCiAgICAJCQkJCS8vIHNldCB0aGUgYWN0aXZlIGZyYW1lIGJ1ZmZlciB0byB0aGUgb25lIHdlIHdhbnQgdG8gcmVhZAogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCiAgICAJCQkJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZXNbIHRleHR1cmVJbmRleCBdOwogICAgCQkJCQljb25zdCB0ZXh0dXJlRm9ybWF0ID0gdGV4dHVyZS5mb3JtYXQ7CiAgICAJCQkJCWNvbnN0IHRleHR1cmVUeXBlID0gdGV4dHVyZS50eXBlOwoKICAgIAkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSApIHsKCiAgICAJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHNBc3luYzogcmVuZGVyVGFyZ2V0IGlzIG5vdCBpbiBSR0JBIG9yIGltcGxlbWVudGF0aW9uIGRlZmluZWQgZm9ybWF0LicgKTsKCiAgICAJCQkJCX0KCiAgICAJCQkJCWlmICggISBjYXBhYmlsaXRpZXMudGV4dHVyZVR5cGVSZWFkYWJsZSggdGV4dHVyZVR5cGUgKSApIHsKCiAgICAJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHNBc3luYzogcmVuZGVyVGFyZ2V0IGlzIG5vdCBpbiBVbnNpZ25lZEJ5dGVUeXBlIG9yIGltcGxlbWVudGF0aW9uIGRlZmluZWQgdHlwZS4nICk7CgogICAgCQkJCQl9CgogICAgCQkJCQljb25zdCBnbEJ1ZmZlciA9IF9nbC5jcmVhdGVCdWZmZXIoKTsKICAgIAkJCQkJX2dsLmJpbmRCdWZmZXIoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgZ2xCdWZmZXIgKTsKICAgIAkJCQkJX2dsLmJ1ZmZlckRhdGEoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgYnVmZmVyLmJ5dGVMZW5ndGgsIF9nbC5TVFJFQU1fUkVBRCApOwoKICAgIAkJCQkJLy8gd2hlbiB1c2luZyBNUlQsIHNlbGVjdCB0aGUgY29yZWN0IGNvbG9yIGJ1ZmZlciBmb3IgdGhlIHN1YnNlcXVlbnQgcmVhZCBjb21tYW5kCgogICAgCQkJCQlpZiAoIHJlbmRlclRhcmdldC50ZXh0dXJlcy5sZW5ndGggPiAxICkgX2dsLnJlYWRCdWZmZXIoIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIHRleHR1cmVJbmRleCApOwoKICAgIAkJCQkJX2dsLnJlYWRQaXhlbHMoIHgsIHksIHdpZHRoLCBoZWlnaHQsIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVGb3JtYXQgKSwgdXRpbHMuY29udmVydCggdGV4dHVyZVR5cGUgKSwgMCApOwoKICAgIAkJCQkJLy8gcmVzZXQgdGhlIGZyYW1lIGJ1ZmZlciB0byB0aGUgY3VycmVudGx5IHNldCBidWZmZXIgYmVmb3JlIHdhaXRpbmcKICAgIAkJCQkJY29uc3QgY3VyckZyYW1lYnVmZmVyID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQgIT09IG51bGwgPyBwcm9wZXJ0aWVzLmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgOiBudWxsOwogICAgCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgY3VyckZyYW1lYnVmZmVyICk7CgogICAgCQkJCQkvLyBjaGVjayBpZiB0aGUgY29tbWFuZHMgaGF2ZSBmaW5pc2hlZCBldmVyeSA4IG1zCiAgICAJCQkJCWNvbnN0IHN5bmMgPSBfZ2wuZmVuY2VTeW5jKCBfZ2wuU1lOQ19HUFVfQ09NTUFORFNfQ09NUExFVEUsIDAgKTsKCiAgICAJCQkJCV9nbC5mbHVzaCgpOwoKICAgIAkJCQkJYXdhaXQgcHJvYmVBc3luYyggX2dsLCBzeW5jLCA0ICk7CgogICAgCQkJCQkvLyByZWFkIHRoZSBkYXRhIGFuZCBkZWxldGUgdGhlIGJ1ZmZlcgogICAgCQkJCQlfZ2wuYmluZEJ1ZmZlciggX2dsLlBJWEVMX1BBQ0tfQlVGRkVSLCBnbEJ1ZmZlciApOwogICAgCQkJCQlfZ2wuZ2V0QnVmZmVyU3ViRGF0YSggX2dsLlBJWEVMX1BBQ0tfQlVGRkVSLCAwLCBidWZmZXIgKTsKICAgIAkJCQkJX2dsLmRlbGV0ZUJ1ZmZlciggZ2xCdWZmZXIgKTsKICAgIAkJCQkJX2dsLmRlbGV0ZVN5bmMoIHN5bmMgKTsKCiAgICAJCQkJCXJldHVybiBidWZmZXI7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHNBc3luYzogcmVxdWVzdGVkIHJlYWQgYm91bmRzIGFyZSBvdXQgb2YgcmFuZ2UuJyApOwoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBDb3BpZXMgcGl4ZWxzIGZyb20gdGhlIGN1cnJlbnQgYm91bmQgZnJhbWVidWZmZXIgaW50byB0aGUgZ2l2ZW4gdGV4dHVyZS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtGcmFtZWJ1ZmZlclRleHR1cmV9IHRleHR1cmUgLSBUaGUgdGV4dHVyZS4KICAgIAkJICogQHBhcmFtIHs/VmVjdG9yMn0gW3Bvc2l0aW9uPW51bGxdIC0gVGhlIHN0YXJ0IHBvc2l0aW9uIG9mIHRoZSBjb3B5IG9wZXJhdGlvbi4KICAgIAkJICogQHBhcmFtIHtudW1iZXJ9IFtsZXZlbD0wXSAtIFRoZSBtaXAgbGV2ZWwuIFRoZSBkZWZhdWx0IHJlcHJlc2VudHMgdGhlIGJhc2UgbWlwLgogICAgCQkgKi8KICAgIAkJdGhpcy5jb3B5RnJhbWVidWZmZXJUb1RleHR1cmUgPSBmdW5jdGlvbiAoIHRleHR1cmUsIHBvc2l0aW9uID0gbnVsbCwgbGV2ZWwgPSAwICkgewoKICAgIAkJCWNvbnN0IGxldmVsU2NhbGUgPSBNYXRoLnBvdyggMiwgLSBsZXZlbCApOwogICAgCQkJY29uc3Qgd2lkdGggPSBNYXRoLmZsb29yKCB0ZXh0dXJlLmltYWdlLndpZHRoICogbGV2ZWxTY2FsZSApOwogICAgCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5mbG9vciggdGV4dHVyZS5pbWFnZS5oZWlnaHQgKiBsZXZlbFNjYWxlICk7CgogICAgCQkJY29uc3QgeCA9IHBvc2l0aW9uICE9PSBudWxsID8gcG9zaXRpb24ueCA6IDA7CiAgICAJCQljb25zdCB5ID0gcG9zaXRpb24gIT09IG51bGwgPyBwb3NpdGlvbi55IDogMDsKCiAgICAJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIHRleHR1cmUsIDAgKTsKCiAgICAJCQlfZ2wuY29weVRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbCwgMCwgMCwgeCwgeSwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCiAgICAJCX07CgogICAgCQljb25zdCBfc3JjRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKICAgIAkJY29uc3QgX2RzdEZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgogICAgCQkvKioKICAgIAkJICogQ29waWVzIGRhdGEgb2YgdGhlIGdpdmVuIHNvdXJjZSB0ZXh0dXJlIGludG8gYSBkZXN0aW5hdGlvbiB0ZXh0dXJlLgogICAgCQkgKgogICAgCQkgKiBXaGVuIHVzaW5nIHJlbmRlciB0YXJnZXQgdGV4dHVyZXMgYXMgYHNyY1RleHR1cmVgIGFuZCBgZHN0VGV4dHVyZWAsIHlvdSBtdXN0IG1ha2Ugc3VyZSBib3RoIHJlbmRlciB0YXJnZXRzIGFyZSBpbml0aWFsaXplZAogICAgCQkgKiB7QGxpbmsgV2ViR0xSZW5kZXJlciNpbml0UmVuZGVyVGFyZ2V0fS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtUZXh0dXJlfSBzcmNUZXh0dXJlIC0gVGhlIHNvdXJjZSB0ZXh0dXJlLgogICAgCQkgKiBAcGFyYW0ge1RleHR1cmV9IGRzdFRleHR1cmUgLSBUaGUgZGVzdGluYXRpb24gdGV4dHVyZS4KICAgIAkJICogQHBhcmFtIHs/KEJveDJ8Qm94Myl9IFtzcmNSZWdpb249bnVsbF0gLSBBIGJvdW5kaW5nIGJveCB3aGljaCBkZXNjcmliZXMgdGhlIHNvdXJjZSByZWdpb24uIENhbiBiZSB0d28gb3IgdGhyZWUtZGltZW5zaW9uYWwuCiAgICAJCSAqIEBwYXJhbSB7PyhWZWN0b3IyfFZlY3RvcjMpfSBbZHN0UG9zaXRpb249bnVsbF0gLSBBIHZlY3RvciB0aGF0IHJlcHJlc2VudHMgdGhlIG9yaWdpbiBvZiB0aGUgZGVzdGluYXRpb24gcmVnaW9uLiBDYW4gYmUgdHdvIG9yIHRocmVlLWRpbWVuc2lvbmFsLgogICAgCQkgKiBAcGFyYW0ge251bWJlcn0gW3NyY0xldmVsPTBdIC0gVGhlIHNvdXJjZSBtaXBtYXAgbGV2ZWwgdG8gY29weS4KICAgIAkJICogQHBhcmFtIHs/bnVtYmVyfSBbZHN0TGV2ZWw9bnVsbF0gLSBUaGUgZGVzdGluYXRpb24gbWlwbWFwIGxldmVsLgogICAgCQkgKi8KICAgIAkJdGhpcy5jb3B5VGV4dHVyZVRvVGV4dHVyZSA9IGZ1bmN0aW9uICggc3JjVGV4dHVyZSwgZHN0VGV4dHVyZSwgc3JjUmVnaW9uID0gbnVsbCwgZHN0UG9zaXRpb24gPSBudWxsLCBzcmNMZXZlbCA9IDAsIGRzdExldmVsID0gbnVsbCApIHsKCiAgICAJCQkvLyBzdXBwb3J0IHRoZSBwcmV2aW91cyBzaWduYXR1cmUgd2l0aCBqdXN0IGEgc2luZ2xlIGRzdCBtaXBtYXAgbGV2ZWwKICAgIAkJCWlmICggZHN0TGV2ZWwgPT09IG51bGwgKSB7CgogICAgCQkJCWlmICggc3JjTGV2ZWwgIT09IDAgKSB7CgogICAgCQkJCQkvLyBAZGVwcmVjYXRlZCwgcjE3MQogICAgCQkJCQl3YXJuT25jZSggJ1dlYkdMUmVuZGVyZXI6IGNvcHlUZXh0dXJlVG9UZXh0dXJlIGZ1bmN0aW9uIHNpZ25hdHVyZSBoYXMgY2hhbmdlZCB0byBzdXBwb3J0IHNyYyBhbmQgZHN0IG1pcG1hcCBsZXZlbHMuJyApOwogICAgCQkJCQlkc3RMZXZlbCA9IHNyY0xldmVsOwogICAgCQkJCQlzcmNMZXZlbCA9IDA7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlkc3RMZXZlbCA9IDA7CgogICAgCQkJCX0KCiAgICAJCQl9CgogICAgCQkJLy8gZ2F0aGVyIHRoZSBuZWNlc3NhcnkgZGltZW5zaW9ucyB0byBjb3B5CiAgICAJCQlsZXQgd2lkdGgsIGhlaWdodCwgZGVwdGgsIG1pblgsIG1pblksIG1pblo7CiAgICAJCQlsZXQgZHN0WCwgZHN0WSwgZHN0WjsKICAgIAkJCWNvbnN0IGltYWdlID0gc3JjVGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlID8gc3JjVGV4dHVyZS5taXBtYXBzWyBkc3RMZXZlbCBdIDogc3JjVGV4dHVyZS5pbWFnZTsKICAgIAkJCWlmICggc3JjUmVnaW9uICE9PSBudWxsICkgewoKICAgIAkJCQl3aWR0aCA9IHNyY1JlZ2lvbi5tYXgueCAtIHNyY1JlZ2lvbi5taW4ueDsKICAgIAkJCQloZWlnaHQgPSBzcmNSZWdpb24ubWF4LnkgLSBzcmNSZWdpb24ubWluLnk7CiAgICAJCQkJZGVwdGggPSBzcmNSZWdpb24uaXNCb3gzID8gc3JjUmVnaW9uLm1heC56IC0gc3JjUmVnaW9uLm1pbi56IDogMTsKICAgIAkJCQltaW5YID0gc3JjUmVnaW9uLm1pbi54OwogICAgCQkJCW1pblkgPSBzcmNSZWdpb24ubWluLnk7CiAgICAJCQkJbWluWiA9IHNyY1JlZ2lvbi5pc0JveDMgPyBzcmNSZWdpb24ubWluLnogOiAwOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWNvbnN0IGxldmVsU2NhbGUgPSBNYXRoLnBvdyggMiwgLSBzcmNMZXZlbCApOwogICAgCQkJCXdpZHRoID0gTWF0aC5mbG9vciggaW1hZ2Uud2lkdGggKiBsZXZlbFNjYWxlICk7CiAgICAJCQkJaGVpZ2h0ID0gTWF0aC5mbG9vciggaW1hZ2UuaGVpZ2h0ICogbGV2ZWxTY2FsZSApOwogICAgCQkJCWlmICggc3JjVGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgKSB7CgogICAgCQkJCQlkZXB0aCA9IGltYWdlLmRlcHRoOwoKICAgIAkJCQl9IGVsc2UgaWYgKCBzcmNUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCiAgICAJCQkJCWRlcHRoID0gTWF0aC5mbG9vciggaW1hZ2UuZGVwdGggKiBsZXZlbFNjYWxlICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQlkZXB0aCA9IDE7CgogICAgCQkJCX0KCiAgICAJCQkJbWluWCA9IDA7CiAgICAJCQkJbWluWSA9IDA7CiAgICAJCQkJbWluWiA9IDA7CgogICAgCQkJfQoKICAgIAkJCWlmICggZHN0UG9zaXRpb24gIT09IG51bGwgKSB7CgogICAgCQkJCWRzdFggPSBkc3RQb3NpdGlvbi54OwogICAgCQkJCWRzdFkgPSBkc3RQb3NpdGlvbi55OwogICAgCQkJCWRzdFogPSBkc3RQb3NpdGlvbi56OwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWRzdFggPSAwOwogICAgCQkJCWRzdFkgPSAwOwogICAgCQkJCWRzdFogPSAwOwoKICAgIAkJCX0KCiAgICAJCQkvLyBTZXQgdXAgdGhlIGRlc3RpbmF0aW9uIHRhcmdldAogICAgCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCBkc3RUZXh0dXJlLmZvcm1hdCApOwogICAgCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS50eXBlICk7CiAgICAJCQlsZXQgZ2xUYXJnZXQ7CgogICAgCQkJaWYgKCBkc3RUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCBkc3RUZXh0dXJlLCAwICk7CiAgICAJCQkJZ2xUYXJnZXQgPSBfZ2wuVEVYVFVSRV8zRDsKCiAgICAJCQl9IGVsc2UgaWYgKCBkc3RUZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCBkc3RUZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIGRzdFRleHR1cmUsIDAgKTsKICAgIAkJCQlnbFRhcmdldCA9IF9nbC5URVhUVVJFXzJEX0FSUkFZOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCXRleHR1cmVzLnNldFRleHR1cmUyRCggZHN0VGV4dHVyZSwgMCApOwogICAgCQkJCWdsVGFyZ2V0ID0gX2dsLlRFWFRVUkVfMkQ7CgogICAgCQkJfQoKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19GTElQX1lfV0VCR0wsIGRzdFRleHR1cmUuZmxpcFkgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZHN0VGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQUxJR05NRU5ULCBkc3RUZXh0dXJlLnVucGFja0FsaWdubWVudCApOwoKICAgIAkJCS8vIHVzZWQgZm9yIGNvcHlpbmcgZGF0YSBmcm9tIGNwdQogICAgCQkJY29uc3QgY3VycmVudFVucGFja1Jvd0xlbiA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCApOwogICAgCQkJY29uc3QgY3VycmVudFVucGFja0ltYWdlSGVpZ2h0ID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQgKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUGl4ZWxzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX1BJWEVMUyApOwogICAgCQkJY29uc3QgY3VycmVudFVucGFja1NraXBSb3dzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX1JPV1MgKTsKICAgIAkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwSW1hZ2VzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX0lNQUdFUyApOwoKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19ST1dfTEVOR1RILCBpbWFnZS53aWR0aCApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0lNQUdFX0hFSUdIVCwgaW1hZ2UuaGVpZ2h0ICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMsIG1pblggKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIG1pblkgKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX0lNQUdFUywgbWluWiApOwoKICAgIAkJCS8vIHNldCB1cCB0aGUgc3JjIHRleHR1cmUKICAgIAkJCWNvbnN0IGlzU3JjM0QgPSBzcmNUZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCBzcmNUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZTsKICAgIAkJCWNvbnN0IGlzRHN0M0QgPSBkc3RUZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCBkc3RUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZTsKICAgIAkJCWlmICggc3JjVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApIHsKCiAgICAJCQkJY29uc3Qgc3JjVGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc3JjVGV4dHVyZSApOwogICAgCQkJCWNvbnN0IGRzdFRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGRzdFRleHR1cmUgKTsKICAgIAkJCQljb25zdCBzcmNSZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHNyY1RleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ICk7CiAgICAJCQkJY29uc3QgZHN0UmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBkc3RUZXh0dXJlUHJvcGVydGllcy5fX3JlbmRlclRhcmdldCApOwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIHNyY1JlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgZHN0UmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCiAgICAJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGVwdGg7IGkgKysgKSB7CgogICAgCQkJCQkvLyBpZiB0aGUgc291cmNlIG9yIGRlc3RpbmF0aW9uIGFyZSBhIDNkIHRhcmdldCB0aGVuIGEgbGF5ZXIgbmVlZHMgdG8gYmUgYm91bmQKICAgIAkJCQkJaWYgKCBpc1NyYzNEICkgewoKICAgIAkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmVMYXllciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgcHJvcGVydGllcy5nZXQoIHNyY1RleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSwgc3JjTGV2ZWwsIG1pblogKyBpICk7CiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHByb3BlcnRpZXMuZ2V0KCBkc3RUZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIGRzdExldmVsLCBkc3RaICsgaSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJX2dsLmJsaXRGcmFtZWJ1ZmZlciggbWluWCwgbWluWSwgd2lkdGgsIGhlaWdodCwgZHN0WCwgZHN0WSwgd2lkdGgsIGhlaWdodCwgX2dsLkRFUFRIX0JVRkZFUl9CSVQsIF9nbC5ORUFSRVNUICk7CgogICAgCQkJCX0KCiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCBzcmNMZXZlbCAhPT0gMCB8fCBzcmNUZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSB8fCBwcm9wZXJ0aWVzLmhhcyggc3JjVGV4dHVyZSApICkgewoKICAgIAkJCQkvLyBnZXQgdGhlIGFwcHJvcHJpYXRlIGZyYW1lIGJ1ZmZlcnMKICAgIAkJCQljb25zdCBzcmNUZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlICk7CiAgICAJCQkJY29uc3QgZHN0VGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZSApOwoKICAgIAkJCQkvLyBiaW5kIHRoZSBmcmFtZSBidWZmZXIgdGFyZ2V0cwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIF9zcmNGcmFtZWJ1ZmZlciApOwogICAgCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9kc3RGcmFtZWJ1ZmZlciApOwoKICAgIAkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkZXB0aDsgaSArKyApIHsKCiAgICAJCQkJCS8vIGFzc2lnbiB0aGUgY29ycmVjdCBsYXllcnMgYW5kIG1pcCBtYXBzIHRvIHRoZSBmcmFtZSBidWZmZXJzCiAgICAJCQkJCWlmICggaXNTcmMzRCApIHsKCiAgICAJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHNyY1RleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBzcmNMZXZlbCwgbWluWiArIGkgKTsKCiAgICAJCQkJCX0gZWxzZSB7CgogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgc3JjVGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIHNyY0xldmVsICk7CgogICAgCQkJCQl9CgogICAgCQkJCQlpZiAoIGlzRHN0M0QgKSB7CgogICAgCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBkc3RUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgZHN0TGV2ZWwsIGRzdFogKyBpICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIGRzdFRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBkc3RMZXZlbCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQkJLy8gY29weSB0aGUgZGF0YSB1c2luZyB0aGUgZmFzdGVzdCBmdW5jdGlvbiB0aGF0IGNhbiBhY2hpZXZlIHRoZSBjb3B5CiAgICAJCQkJCWlmICggc3JjTGV2ZWwgIT09IDAgKSB7CgogICAgCQkJCQkJX2dsLmJsaXRGcmFtZWJ1ZmZlciggbWluWCwgbWluWSwgd2lkdGgsIGhlaWdodCwgZHN0WCwgZHN0WSwgd2lkdGgsIGhlaWdodCwgX2dsLkNPTE9SX0JVRkZFUl9CSVQsIF9nbC5ORUFSRVNUICk7CgogICAgCQkJCQl9IGVsc2UgaWYgKCBpc0RzdDNEICkgewoKICAgIAkJCQkJCV9nbC5jb3B5VGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaICsgaSwgbWluWCwgbWluWSwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlfZ2wuY29weVRleFN1YkltYWdlMkQoIGdsVGFyZ2V0LCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgbWluWCwgbWluWSwgd2lkdGgsIGhlaWdodCApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJCS8vIHVuYmluZCByZWFkLCBkcmF3IGJ1ZmZlcnMKICAgIAkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBudWxsICk7CiAgICAJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgbnVsbCApOwoKICAgIAkJCX0gZWxzZSB7CgogICAgCQkJCWlmICggaXNEc3QzRCApIHsKCiAgICAJCQkJCS8vIGNvcHkgZGF0YSBpbnRvIHRoZSAzZCB0ZXh0dXJlCiAgICAJCQkJCWlmICggc3JjVGV4dHVyZS5pc0RhdGFUZXh0dXJlIHx8IHNyY1RleHR1cmUuaXNEYXRhM0RUZXh0dXJlICkgewoKICAgIAkJCQkJCV9nbC50ZXhTdWJJbWFnZTNEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIGRzdFosIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgogICAgCQkJCQl9IGVsc2UgaWYgKCBkc3RUZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCiAgICAJCQkJCQlfZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlM0QoIGdsVGFyZ2V0LCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgZHN0Wiwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdsRm9ybWF0LCBpbWFnZS5kYXRhICk7CgogICAgCQkJCQl9IGVsc2UgewoKICAgIAkJCQkJCV9nbC50ZXhTdWJJbWFnZTNEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIGRzdFosIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9IGVsc2UgewoKICAgIAkJCQkJLy8gY29weSBkYXRhIGludG8gdGhlIDJkIHRleHR1cmUKICAgIAkJCQkJaWYgKCBzcmNUZXh0dXJlLmlzRGF0YVRleHR1cmUgKSB7CgogICAgCQkJCQkJX2dsLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJfSBlbHNlIGlmICggc3JjVGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICkgewoKICAgIAkJCQkJCV9nbC5jb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBnbEZvcm1hdCwgaW1hZ2UuZGF0YSApOwoKICAgIAkJCQkJfSBlbHNlIHsKCiAgICAJCQkJCQlfZ2wudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCB3aWR0aCwgaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSApOwoKICAgIAkJCQkJfQoKICAgIAkJCQl9CgogICAgCQkJfQoKICAgIAkJCS8vIHJlc2V0IHZhbHVlcwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGN1cnJlbnRVbnBhY2tSb3dMZW4gKTsKICAgIAkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQsIGN1cnJlbnRVbnBhY2tJbWFnZUhlaWdodCApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyApOwogICAgCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUk9XUywgY3VycmVudFVucGFja1NraXBSb3dzICk7CiAgICAJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIGN1cnJlbnRVbnBhY2tTa2lwSW1hZ2VzICk7CgogICAgCQkJLy8gR2VuZXJhdGUgbWlwbWFwcyBvbmx5IHdoZW4gY29weWluZyBsZXZlbCAwCiAgICAJCQlpZiAoIGRzdExldmVsID09PSAwICYmIGRzdFRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzICkgewoKICAgIAkJCQlfZ2wuZ2VuZXJhdGVNaXBtYXAoIGdsVGFyZ2V0ICk7CgogICAgCQkJfQoKICAgIAkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCiAgICAJCX07CgogICAgCQl0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlM0QgPSBmdW5jdGlvbiAoIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIHNyY1JlZ2lvbiA9IG51bGwsIGRzdFBvc2l0aW9uID0gbnVsbCwgbGV2ZWwgPSAwICkgewoKICAgIAkJCS8vIEBkZXByZWNhdGVkLCByMTcwCiAgICAJCQl3YXJuT25jZSggJ1dlYkdMUmVuZGVyZXI6IGNvcHlUZXh0dXJlVG9UZXh0dXJlM0QgZnVuY3Rpb24gaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlICJjb3B5VGV4dHVyZVRvVGV4dHVyZSIgaW5zdGVhZC4nICk7CgogICAgCQkJcmV0dXJuIHRoaXMuY29weVRleHR1cmVUb1RleHR1cmUoIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIHNyY1JlZ2lvbiwgZHN0UG9zaXRpb24sIGxldmVsICk7CgogICAgCQl9OwoKICAgIAkJLyoqCiAgICAJCSAqIEluaXRpYWxpemVzIHRoZSBnaXZlbiBXZWJHTFJlbmRlclRhcmdldCBtZW1vcnkuIFVzZWZ1bCBmb3IgaW5pdGlhbGl6aW5nIGEgcmVuZGVyIHRhcmdldCBzbyBkYXRhCiAgICAJCSAqIGNhbiBiZSBjb3BpZWQgaW50byBpdCB1c2luZyB7QGxpbmsgV2ViR0xSZW5kZXJlciNjb3B5VGV4dHVyZVRvVGV4dHVyZX0gYmVmb3JlIGl0IGhhcyBiZWVuCiAgICAJCSAqIHJlbmRlcmVkIHRvLgogICAgCQkgKgogICAgCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyVGFyZ2V0fSB0YXJnZXQgLSBUaGUgcmVuZGVyIHRhcmdldC4KICAgIAkJICovCiAgICAJCXRoaXMuaW5pdFJlbmRlclRhcmdldCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKICAgIAkJCWlmICggcHJvcGVydGllcy5nZXQoIHRhcmdldCApLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9PT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQl0ZXh0dXJlcy5zZXR1cFJlbmRlclRhcmdldCggdGFyZ2V0ICk7CgogICAgCQkJfQoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBJbml0aWFsaXplcyB0aGUgZ2l2ZW4gdGV4dHVyZS4gVXNlZnVsIGZvciBwcmVsb2FkaW5nIGEgdGV4dHVyZSByYXRoZXIgdGhhbiB3YWl0aW5nIHVudGlsIGZpcnN0CiAgICAJCSAqIHJlbmRlciAod2hpY2ggY2FuIGNhdXNlIG5vdGljZWFibGUgbGFncyBkdWUgdG8gZGVjb2RlIGFuZCBHUFUgdXBsb2FkIG92ZXJoZWFkKS4KICAgIAkJICoKICAgIAkJICogQHBhcmFtIHtUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIHRleHR1cmUuCiAgICAJCSAqLwogICAgCQl0aGlzLmluaXRUZXh0dXJlID0gZnVuY3Rpb24gKCB0ZXh0dXJlICkgewoKICAgIAkJCWlmICggdGV4dHVyZS5pc0N1YmVUZXh0dXJlICkgewoKICAgIAkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlQ3ViZSggdGV4dHVyZSwgMCApOwoKICAgIAkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhM0RUZXh0dXJlICkgewoKICAgIAkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlM0QoIHRleHR1cmUsIDAgKTsKCiAgICAJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCiAgICAJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHRleHR1cmUsIDAgKTsKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIHRleHR1cmUsIDAgKTsKCiAgICAJCQl9CgogICAgCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKICAgIAkJfTsKCiAgICAJCS8qKgogICAgCQkgKiBDYW4gYmUgdXNlZCB0byByZXNldCB0aGUgaW50ZXJuYWwgV2ViR0wgc3RhdGUuIFRoaXMgbWV0aG9kIGlzIG1vc3RseQogICAgCQkgKiByZWxldmFudCBmb3IgYXBwbGljYXRpb25zIHdoaWNoIHNoYXJlIGEgc2luZ2xlIFdlYkdMIGNvbnRleHQgYWNyb3NzCiAgICAJCSAqIG11bHRpcGxlIFdlYkdMIGxpYnJhcmllcy4KICAgIAkJICovCiAgICAJCXRoaXMucmVzZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQlfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gMDsKICAgIAkJCV9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwogICAgCQkJX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwoKICAgIAkJCXN0YXRlLnJlc2V0KCk7CiAgICAJCQliaW5kaW5nU3RhdGVzLnJlc2V0KCk7CgogICAgCQl9OwoKICAgIAkJaWYgKCB0eXBlb2YgX19USFJFRV9ERVZUT09MU19fICE9PSAndW5kZWZpbmVkJyApIHsKCiAgICAJCQlfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudCggbmV3IEN1c3RvbUV2ZW50KCAnb2JzZXJ2ZScsIHsgZGV0YWlsOiB0aGlzIH0gKSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIERlZmluZXMgdGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9mIHRoZSByZW5kZXJlci4KICAgIAkgKgogICAgCSAqIEluIGBXZWJHTFJlbmRlcmVyYCwgdGhlIHZhbHVlIGlzIGFsd2F5cyBgV2ViR0xDb29yZGluYXRlU3lzdGVtYC4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbX0KICAgIAkgKiBAZGVmYXVsdCBXZWJHTENvb3JkaW5hdGVTeXN0ZW0KICAgIAkgKiBAcmVhZG9ubHkKICAgIAkgKi8KICAgIAlnZXQgY29vcmRpbmF0ZVN5c3RlbSgpIHsKCiAgICAJCXJldHVybiBXZWJHTENvb3JkaW5hdGVTeXN0ZW07CgogICAgCX0KCiAgICAJLyoqCiAgICAJICogRGVmaW5lcyB0aGUgb3V0cHV0IGNvbG9yIHNwYWNlIG9mIHRoZSByZW5kZXJlci4KICAgIAkgKgogICAgCSAqIEB0eXBlIHtTUkdCQ29sb3JTcGFjZXxMaW5lYXJTUkdCQ29sb3JTcGFjZX0KICAgIAkgKiBAZGVmYXVsdCBTUkdCQ29sb3JTcGFjZQogICAgCSAqLwogICAgCWdldCBvdXRwdXRDb2xvclNwYWNlKCkgewoKICAgIAkJcmV0dXJuIHRoaXMuX291dHB1dENvbG9yU3BhY2U7CgogICAgCX0KCiAgICAJc2V0IG91dHB1dENvbG9yU3BhY2UoIGNvbG9yU3BhY2UgKSB7CgogICAgCQl0aGlzLl9vdXRwdXRDb2xvclNwYWNlID0gY29sb3JTcGFjZTsKCiAgICAJCWNvbnN0IGdsID0gdGhpcy5nZXRDb250ZXh0KCk7CiAgICAJCWdsLmRyYXdpbmdCdWZmZXJDb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50Ll9nZXREcmF3aW5nQnVmZmVyQ29sb3JTcGFjZSggY29sb3JTcGFjZSApOwogICAgCQlnbC51bnBhY2tDb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50Ll9nZXRVbnBhY2tDb2xvclNwYWNlKCk7CgogICAgCX0KCiAgICB9CgogICAgLyoqCiAgICAgKiBBIHV0aWxpdHkgY2xhc3MgZm9yIGNyZWF0aW5nIGEgYnV0dG9uIHRoYXQgYWxsb3dzIHRvIGluaXRpYXRlCiAgICAgKiBpbW1lcnNpdmUgVlIgc2Vzc2lvbnMgYmFzZWQgb24gV2ViWFIuIFRoZSBidXR0b24gY2FuIGJlIGNyZWF0ZWQKICAgICAqIHdpdGggYSBmYWN0b3J5IG1ldGhvZCBhbmQgdGhlbiBhcHBlbmRlZCBvdCB0aGUgd2Vic2l0ZSdzIERPTS4KICAgICAqCiAgICAgKiBgYGBqcwogICAgICogZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggVlJCdXR0b24uY3JlYXRlQnV0dG9uKCByZW5kZXJlciApICk7CiAgICAgKiBgYGAKICAgICAqCiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yCiAgICAgKiBAdGhyZWVfaW1wb3J0IGltcG9ydCB7IFZSQnV0dG9uIH0gZnJvbSAndGhyZWUvYWRkb25zL3dlYnhyL1ZSQnV0dG9uLmpzJzsKICAgICAqLwogICAgY2xhc3MgVlJCdXR0b24gewoKICAgIAkvKioKICAgIAkgKiBDb25zdHJ1Y3RzIGEgbmV3IFZSIGJ1dHRvbi4KICAgIAkgKgogICAgCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcnxXZWJHUFVSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCiAgICAJICogQHBhcmFtIHtYUlNlc3Npb25Jbml0fSBbc2Vzc2lvbkluaXRdIC0gVGhlIGEgY29uZmlndXJhdGlvbiBvYmplY3QgZm9yIHRoZSBBUiBzZXNzaW9uLgogICAgCSAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBUaGUgYnV0dG9uIG9yIGFuIGVycm9yIG1lc3NhZ2UgaWYgYGltbWVyc2l2ZS1hcmAgaXNuJ3Qgc3VwcG9ydGVkLgogICAgCSAqLwogICAgCXN0YXRpYyBjcmVhdGVCdXR0b24oIHJlbmRlcmVyLCBzZXNzaW9uSW5pdCA9IHt9ICkgewoKICAgIAkJY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2J1dHRvbicgKTsKCiAgICAJCWZ1bmN0aW9uIHNob3dFbnRlclZSKCAvKmRldmljZSovICkgewoKICAgIAkJCWxldCBjdXJyZW50U2Vzc2lvbiA9IG51bGw7CgogICAgCQkJYXN5bmMgZnVuY3Rpb24gb25TZXNzaW9uU3RhcnRlZCggc2Vzc2lvbiApIHsKCiAgICAJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnZW5kJywgb25TZXNzaW9uRW5kZWQgKTsKCiAgICAJCQkJYXdhaXQgcmVuZGVyZXIueHIuc2V0U2Vzc2lvbiggc2Vzc2lvbiApOwogICAgCQkJCWJ1dHRvbi50ZXh0Q29udGVudCA9ICdFWElUIFZSJzsKCiAgICAJCQkJY3VycmVudFNlc3Npb24gPSBzZXNzaW9uOwoKICAgIAkJCX0KCiAgICAJCQlmdW5jdGlvbiBvblNlc3Npb25FbmRlZCggLypldmVudCovICkgewoKICAgIAkJCQljdXJyZW50U2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnZW5kJywgb25TZXNzaW9uRW5kZWQgKTsKCiAgICAJCQkJYnV0dG9uLnRleHRDb250ZW50ID0gJ0VOVEVSIFZSJzsKCiAgICAJCQkJY3VycmVudFNlc3Npb24gPSBudWxsOwoKICAgIAkJCX0KCiAgICAJCQkvLwoKICAgIAkJCWJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJyc7CgogICAgCQkJYnV0dG9uLnN0eWxlLmN1cnNvciA9ICdwb2ludGVyJzsKICAgIAkJCWJ1dHRvbi5zdHlsZS5sZWZ0ID0gJ2NhbGMoNTAlIC0gNTBweCknOwogICAgCQkJYnV0dG9uLnN0eWxlLndpZHRoID0gJzEwMHB4JzsKCiAgICAJCQlidXR0b24udGV4dENvbnRlbnQgPSAnRU5URVIgVlInOwoKICAgIAkJCS8vIFdlYlhSJ3MgcmVxdWVzdFJlZmVyZW5jZVNwYWNlIG9ubHkgd29ya3MgaWYgdGhlIGNvcnJlc3BvbmRpbmcgZmVhdHVyZQogICAgCQkJLy8gd2FzIHJlcXVlc3RlZCBhdCBzZXNzaW9uIGNyZWF0aW9uIHRpbWUuIEZvciBzaW1wbGljaXR5LCBqdXN0IGFzayBmb3IKICAgIAkJCS8vIHRoZSBpbnRlcmVzdGluZyBvbmVzIGFzIG9wdGlvbmFsIGZlYXR1cmVzLCBidXQgYmUgYXdhcmUgdGhhdCB0aGUKICAgIAkJCS8vIHJlcXVlc3RSZWZlcmVuY2VTcGFjZSBjYWxsIHdpbGwgZmFpbCBpZiBpdCB0dXJucyBvdXQgdG8gYmUgdW5hdmFpbGFibGUuCiAgICAJCQkvLyAoJ2xvY2FsJyBpcyBhbHdheXMgYXZhaWxhYmxlIGZvciBpbW1lcnNpdmUgc2Vzc2lvbnMgYW5kIGRvZXNuJ3QgbmVlZCB0bwogICAgCQkJLy8gYmUgcmVxdWVzdGVkIHNlcGFyYXRlbHkuKQoKICAgIAkJCWNvbnN0IHNlc3Npb25PcHRpb25zID0gewogICAgCQkJCS4uLnNlc3Npb25Jbml0LAogICAgCQkJCW9wdGlvbmFsRmVhdHVyZXM6IFsKICAgIAkJCQkJJ2xvY2FsLWZsb29yJywKICAgIAkJCQkJJ2JvdW5kZWQtZmxvb3InLAogICAgCQkJCQknbGF5ZXJzJywKICAgIAkJCQkJLi4uKCBzZXNzaW9uSW5pdC5vcHRpb25hbEZlYXR1cmVzIHx8IFtdICkKICAgIAkJCQldLAogICAgCQkJfTsKCiAgICAJCQlidXR0b24ub25tb3VzZWVudGVyID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCQlidXR0b24uc3R5bGUub3BhY2l0eSA9ICcxLjAnOwoKICAgIAkJCX07CgogICAgCQkJYnV0dG9uLm9ubW91c2VsZWF2ZSA9IGZ1bmN0aW9uICgpIHsKCiAgICAJCQkJYnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMC41JzsKCiAgICAJCQl9OwoKICAgIAkJCWJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24gKCkgewoKICAgIAkJCQlpZiAoIGN1cnJlbnRTZXNzaW9uID09PSBudWxsICkgewoKICAgIAkJCQkJbmF2aWdhdG9yLnhyLnJlcXVlc3RTZXNzaW9uKCAnaW1tZXJzaXZlLXZyJywgc2Vzc2lvbk9wdGlvbnMgKS50aGVuKCBvblNlc3Npb25TdGFydGVkICk7CgogICAgCQkJCX0gZWxzZSB7CgogICAgCQkJCQljdXJyZW50U2Vzc2lvbi5lbmQoKTsKCiAgICAJCQkJCWlmICggbmF2aWdhdG9yLnhyLm9mZmVyU2Vzc2lvbiAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQkJCW5hdmlnYXRvci54ci5vZmZlclNlc3Npb24oICdpbW1lcnNpdmUtdnInLCBzZXNzaW9uT3B0aW9ucyApCiAgICAJCQkJCQkJLnRoZW4oIG9uU2Vzc2lvblN0YXJ0ZWQgKQogICAgCQkJCQkJCS5jYXRjaCggKCBlcnIgKSA9PiB7CgogICAgCQkJCQkJCQljb25zb2xlLndhcm4oIGVyciApOwoKICAgIAkJCQkJCQl9ICk7CgogICAgCQkJCQl9CgogICAgCQkJCX0KCiAgICAJCQl9OwoKICAgIAkJCWlmICggbmF2aWdhdG9yLnhyLm9mZmVyU2Vzc2lvbiAhPT0gdW5kZWZpbmVkICkgewoKICAgIAkJCQluYXZpZ2F0b3IueHIub2ZmZXJTZXNzaW9uKCAnaW1tZXJzaXZlLXZyJywgc2Vzc2lvbk9wdGlvbnMgKQogICAgCQkJCQkudGhlbiggb25TZXNzaW9uU3RhcnRlZCApCiAgICAJCQkJCS5jYXRjaCggKCBlcnIgKSA9PiB7CgogICAgCQkJCQkJY29uc29sZS53YXJuKCBlcnIgKTsKCiAgICAJCQkJCX0gKTsKCiAgICAJCQl9CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBkaXNhYmxlQnV0dG9uKCkgewoKICAgIAkJCWJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJyc7CgogICAgCQkJYnV0dG9uLnN0eWxlLmN1cnNvciA9ICdhdXRvJzsKICAgIAkJCWJ1dHRvbi5zdHlsZS5sZWZ0ID0gJ2NhbGMoNTAlIC0gNzVweCknOwogICAgCQkJYnV0dG9uLnN0eWxlLndpZHRoID0gJzE1MHB4JzsKCiAgICAJCQlidXR0b24ub25tb3VzZWVudGVyID0gbnVsbDsKICAgIAkJCWJ1dHRvbi5vbm1vdXNlbGVhdmUgPSBudWxsOwoKICAgIAkJCWJ1dHRvbi5vbmNsaWNrID0gbnVsbDsKCiAgICAJCX0KCiAgICAJCWZ1bmN0aW9uIHNob3dXZWJYUk5vdEZvdW5kKCkgewoKICAgIAkJCWRpc2FibGVCdXR0b24oKTsKCiAgICAJCQlidXR0b24udGV4dENvbnRlbnQgPSAnVlIgTk9UIFNVUFBPUlRFRCc7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBzaG93VlJOb3RBbGxvd2VkKCBleGNlcHRpb24gKSB7CgogICAgCQkJZGlzYWJsZUJ1dHRvbigpOwoKICAgIAkJCWNvbnNvbGUud2FybiggJ0V4Y2VwdGlvbiB3aGVuIHRyeWluZyB0byBjYWxsIHhyLmlzU2Vzc2lvblN1cHBvcnRlZCcsIGV4Y2VwdGlvbiApOwoKICAgIAkJCWJ1dHRvbi50ZXh0Q29udGVudCA9ICdWUiBOT1QgQUxMT1dFRCc7CgogICAgCQl9CgogICAgCQlmdW5jdGlvbiBzdHlsaXplRWxlbWVudCggZWxlbWVudCApIHsKCiAgICAJCQllbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKICAgIAkJCWVsZW1lbnQuc3R5bGUuYm90dG9tID0gJzIwcHgnOwogICAgCQkJZWxlbWVudC5zdHlsZS5wYWRkaW5nID0gJzEycHggNnB4JzsKICAgIAkJCWVsZW1lbnQuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjZmZmJzsKICAgIAkJCWVsZW1lbnQuc3R5bGUuYm9yZGVyUmFkaXVzID0gJzRweCc7CiAgICAJCQllbGVtZW50LnN0eWxlLmJhY2tncm91bmQgPSAncmdiYSgwLDAsMCwwLjEpJzsKICAgIAkJCWVsZW1lbnQuc3R5bGUuY29sb3IgPSAnI2ZmZic7CiAgICAJCQllbGVtZW50LnN0eWxlLmZvbnQgPSAnbm9ybWFsIDEzcHggc2Fucy1zZXJpZic7CiAgICAJCQllbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgCQkJZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzAuNSc7CiAgICAJCQllbGVtZW50LnN0eWxlLm91dGxpbmUgPSAnbm9uZSc7CiAgICAJCQllbGVtZW50LnN0eWxlLnpJbmRleCA9ICc5OTknOwoKICAgIAkJfQoKICAgIAkJaWYgKCAneHInIGluIG5hdmlnYXRvciApIHsKCiAgICAJCQlidXR0b24uaWQgPSAnVlJCdXR0b24nOwogICAgCQkJYnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgogICAgCQkJc3R5bGl6ZUVsZW1lbnQoIGJ1dHRvbiApOwoKICAgIAkJCW5hdmlnYXRvci54ci5pc1Nlc3Npb25TdXBwb3J0ZWQoICdpbW1lcnNpdmUtdnInICkudGhlbiggZnVuY3Rpb24gKCBzdXBwb3J0ZWQgKSB7CgogICAgCQkJCXN1cHBvcnRlZCA/IHNob3dFbnRlclZSKCkgOiBzaG93V2ViWFJOb3RGb3VuZCgpOwoKICAgIAkJCQlpZiAoIHN1cHBvcnRlZCAmJiBWUkJ1dHRvbi54clNlc3Npb25Jc0dyYW50ZWQgKSB7CgogICAgCQkJCQlidXR0b24uY2xpY2soKTsKCiAgICAJCQkJfQoKICAgIAkJCX0gKS5jYXRjaCggc2hvd1ZSTm90QWxsb3dlZCApOwoKICAgIAkJCXJldHVybiBidXR0b247CgogICAgCQl9IGVsc2UgewoKICAgIAkJCWNvbnN0IG1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnYScgKTsKCiAgICAJCQlpZiAoIHdpbmRvdy5pc1NlY3VyZUNvbnRleHQgPT09IGZhbHNlICkgewoKICAgIAkJCQltZXNzYWdlLmhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoIC9eaHR0cDovLCAnaHR0cHM6JyApOwogICAgCQkJCW1lc3NhZ2UuaW5uZXJIVE1MID0gJ1dFQlhSIE5FRURTIEhUVFBTJzsgLy8gVE9ETyBJbXByb3ZlIG1lc3NhZ2UKCiAgICAJCQl9IGVsc2UgewoKICAgIAkJCQltZXNzYWdlLmhyZWYgPSAnaHR0cHM6Ly9pbW1lcnNpdmV3ZWIuZGV2Lyc7CiAgICAJCQkJbWVzc2FnZS5pbm5lckhUTUwgPSAnV0VCWFIgTk9UIEFWQUlMQUJMRSc7CgogICAgCQkJfQoKICAgIAkJCW1lc3NhZ2Uuc3R5bGUubGVmdCA9ICdjYWxjKDUwJSAtIDkwcHgpJzsKICAgIAkJCW1lc3NhZ2Uuc3R5bGUud2lkdGggPSAnMTgwcHgnOwogICAgCQkJbWVzc2FnZS5zdHlsZS50ZXh0RGVjb3JhdGlvbiA9ICdub25lJzsKCiAgICAJCQlzdHlsaXplRWxlbWVudCggbWVzc2FnZSApOwoKICAgIAkJCXJldHVybiBtZXNzYWdlOwoKICAgIAkJfQoKICAgIAl9CgogICAgCS8qKgogICAgCSAqIFJlZ2lzdGVycyBhIGBzZXNzaW9uZ3JhbnRlZGAgZXZlbnQgbGlzdGVuZXIuIFdoZW4gYSBzZXNzaW9uIGlzIGdyYW50ZWQsIHRoZSB7QGxpbmsgVlJCdXR0b24jeHJTZXNzaW9uSXNHcmFudGVkfQogICAgCSAqIGZsYWcgd2lsbCBldmFsdWF0ZSB0byBgdHJ1ZWAuIFRoaXMgbWV0aG9kIGlzIGF1dG9tYXRpY2FsbHkgY2FsbGVkIGJ5IHRoZSBtb2R1bGUgaXRzZWxmIHNvIHRoZXJlCiAgICAJICogc2hvdWxkIGJlIG5vIG5lZWQgdG8gdXNlIGl0IG9uIGFwcCBsZXZlbC4KICAgIAkgKi8KICAgIAlzdGF0aWMgcmVnaXN0ZXJTZXNzaW9uR3JhbnRlZExpc3RlbmVyKCkgewoKICAgIAkJaWYgKCB0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiAneHInIGluIG5hdmlnYXRvciApIHsKCiAgICAJCQkvLyBXZWJYUlZpZXdlciAoYmFzZWQgb24gRmlyZWZveCkgaGFzIGEgYnVnIHdoZXJlIGFkZEV2ZW50TGlzdGVuZXIKICAgIAkJCS8vIHRocm93cyBhIHNpbGVudCBleGNlcHRpb24gYW5kIGFib3J0cyBleGVjdXRpb24gZW50aXJlbHkuCiAgICAJCQlpZiAoIC9XZWJYUlZpZXdlclwvL2kudGVzdCggbmF2aWdhdG9yLnVzZXJBZ2VudCApICkgcmV0dXJuOwoKICAgIAkJCW5hdmlnYXRvci54ci5hZGRFdmVudExpc3RlbmVyKCAnc2Vzc2lvbmdyYW50ZWQnLCAoKSA9PiB7CgogICAgCQkJCVZSQnV0dG9uLnhyU2Vzc2lvbklzR3JhbnRlZCA9IHRydWU7CgogICAgCQkJfSApOwoKICAgIAkJfQoKICAgIAl9CgogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciBhIFhSIHNlc3Npb24gaGFzIGJlZW4gZ3JhbnRlZCBvciBub3QuCiAgICAgKgogICAgICogQHN0YXRpYwogICAgICogQHR5cGUge2Jvb2xlYW59CiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCiAgICBWUkJ1dHRvbi54clNlc3Npb25Jc0dyYW50ZWQgPSBmYWxzZTsKICAgIFZSQnV0dG9uLnJlZ2lzdGVyU2Vzc2lvbkdyYW50ZWRMaXN0ZW5lcigpOwoKICAgIC8qKgogICAgICogQGxpY2Vuc2UKICAgICAqIHdlYnhyLXBvbHlmaWxsCiAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTcgR29vZ2xlCiAgICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICoKICAgICAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICoKICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBAbGljZW5zZQogICAgICogY2FyZGJvYXJkLXZyLWRpc3BsYXkKICAgICAqIENvcHlyaWdodCAoYykgMjAxNS0yMDE3IEdvb2dsZQogICAgICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CiAgICAgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICAgICAqCiAgICAgKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICAgICAqCiAgICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgICAgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuCiAgICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgICAgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAgICAqLwoKICAgIC8qKgogICAgICogQGxpY2Vuc2UKICAgICAqIHdlYnZyLXBvbHlmaWxsLWRwZGIgCiAgICAgKiBDb3B5cmlnaHQgKGMpIDIwMTcgR29vZ2xlCiAgICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KICAgICAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAogICAgICoKICAgICAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgICoKICAgICAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAgICAgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICAgICAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBAbGljZW5zZQogICAgICogd2dsdS1wcmVzZXJ2ZS1zdGF0ZQogICAgICogQ29weXJpZ2h0IChjKSAyMDE2LCBCcmFuZG9uIEpvbmVzLgogICAgICoKICAgICAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKICAgICAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsCiAgICAgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAgICAgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCiAgICAgKiBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMKICAgICAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiAgICAgKgogICAgICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4KICAgICAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgogICAgICoKICAgICAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAgICAgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKICAgICAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQogICAgICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogICAgICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKICAgICAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KICAgICAqIFRIRSBTT0ZUV0FSRS4KICAgICAqLwoKICAgIC8qKgogICAgICogQGxpY2Vuc2UKICAgICAqIG5vc2xlZXAuanMKICAgICAqIENvcHlyaWdodCAoYykgMjAxNywgUmljaCBUaWJiZXR0CiAgICAgKgogICAgICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQogICAgICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKICAgICAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMKICAgICAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKICAgICAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwogICAgICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKICAgICAqCiAgICAgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgogICAgICogYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAgICAgKgogICAgICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKICAgICAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAogICAgICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCiAgICAgKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCiAgICAgKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAogICAgICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgogICAgICogVEhFIFNPRlRXQVJFLgogICAgICovCgogICAgY29uc3QgX2dsb2JhbCA9IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDoKICAgICAgICAgICAgICAgICAgICB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoKICAgICAgICAgICAgICAgICAgICB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHt9OwoKICAgIGNvbnN0IFBSSVZBVEUgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvRXZlbnRUYXJnZXQnKTsKICAgIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpc1tQUklWQVRFXSA9IHsKICAgICAgICAgIGxpc3RlbmVyczogbmV3IE1hcCgpLAogICAgICAgIH07CiAgICAgIH0KICAgICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICAgIGlmICh0eXBlb2YgdHlwZSAhPT0gJ3N0cmluZycpIHsgdGhyb3cgbmV3IEVycm9yKCdgdHlwZWAgbXVzdCBiZSBhIHN0cmluZycpOyB9CiAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJykgeyB0aHJvdyBuZXcgRXJyb3IoJ2BsaXN0ZW5lcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7IH0KICAgICAgICBjb25zdCB0eXBlZExpc3RlbmVycyA9IHRoaXNbUFJJVkFURV0ubGlzdGVuZXJzLmdldCh0eXBlKSB8fCBbXTsKICAgICAgICB0eXBlZExpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgICAgICB0aGlzW1BSSVZBVEVdLmxpc3RlbmVycy5zZXQodHlwZSwgdHlwZWRMaXN0ZW5lcnMpOwogICAgICB9CiAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICBpZiAodHlwZW9mIHR5cGUgIT09ICdzdHJpbmcnKSB7IHRocm93IG5ldyBFcnJvcignYHR5cGVgIG11c3QgYmUgYSBzdHJpbmcnKTsgfQogICAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgIT09ICdmdW5jdGlvbicpIHsgdGhyb3cgbmV3IEVycm9yKCdgbGlzdGVuZXJgIG11c3QgYmUgYSBmdW5jdGlvbicpOyB9CiAgICAgICAgY29uc3QgdHlwZWRMaXN0ZW5lcnMgPSB0aGlzW1BSSVZBVEVdLmxpc3RlbmVycy5nZXQodHlwZSkgfHwgW107CiAgICAgICAgZm9yIChsZXQgaSA9IHR5cGVkTGlzdGVuZXJzLmxlbmd0aDsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgIGlmICh0eXBlZExpc3RlbmVyc1tpXSA9PT0gbGlzdGVuZXIpIHsKICAgICAgICAgICAgdHlwZWRMaXN0ZW5lcnMucG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGRpc3BhdGNoRXZlbnQodHlwZSwgZXZlbnQpIHsKICAgICAgICBjb25zdCB0eXBlZExpc3RlbmVycyA9IHRoaXNbUFJJVkFURV0ubGlzdGVuZXJzLmdldCh0eXBlKSB8fCBbXTsKICAgICAgICBjb25zdCBxdWV1ZSA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHlwZWRMaXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1ZXVlW2ldID0gdHlwZWRMaXN0ZW5lcnNbaV07CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGxpc3RlbmVyIG9mIHF1ZXVlKSB7CiAgICAgICAgICBsaXN0ZW5lcihldmVudCk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlb2YgdGhpc1tgb24ke3R5cGV9YF0gPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHRoaXNbYG9uJHt0eXBlfWBdKGV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBFUFNJTE9OID0gMC4wMDAwMDE7CiAgICBsZXQgQVJSQVlfVFlQRSA9ICh0eXBlb2YgRmxvYXQzMkFycmF5ICE9PSAndW5kZWZpbmVkJykgPyBGbG9hdDMyQXJyYXkgOiBBcnJheTsKCiAgICBmdW5jdGlvbiBjcmVhdGUoKSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSgxNik7CiAgICAgIGlmKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICBvdXRbMl0gPSAwOwogICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgb3V0WzRdID0gMDsKICAgICAgICBvdXRbNl0gPSAwOwogICAgICAgIG91dFs3XSA9IDA7CiAgICAgICAgb3V0WzhdID0gMDsKICAgICAgICBvdXRbOV0gPSAwOwogICAgICAgIG91dFsxMV0gPSAwOwogICAgICAgIG91dFsxMl0gPSAwOwogICAgICAgIG91dFsxM10gPSAwOwogICAgICAgIG91dFsxNF0gPSAwOwogICAgICB9CiAgICAgIG91dFswXSA9IDE7CiAgICAgIG91dFs1XSA9IDE7CiAgICAgIG91dFsxMF0gPSAxOwogICAgICBvdXRbMTVdID0gMTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBjb3B5KG91dCwgYSkgewogICAgICBvdXRbMF0gPSBhWzBdOwogICAgICBvdXRbMV0gPSBhWzFdOwogICAgICBvdXRbMl0gPSBhWzJdOwogICAgICBvdXRbM10gPSBhWzNdOwogICAgICBvdXRbNF0gPSBhWzRdOwogICAgICBvdXRbNV0gPSBhWzVdOwogICAgICBvdXRbNl0gPSBhWzZdOwogICAgICBvdXRbN10gPSBhWzddOwogICAgICBvdXRbOF0gPSBhWzhdOwogICAgICBvdXRbOV0gPSBhWzldOwogICAgICBvdXRbMTBdID0gYVsxMF07CiAgICAgIG91dFsxMV0gPSBhWzExXTsKICAgICAgb3V0WzEyXSA9IGFbMTJdOwogICAgICBvdXRbMTNdID0gYVsxM107CiAgICAgIG91dFsxNF0gPSBhWzE0XTsKICAgICAgb3V0WzE1XSA9IGFbMTVdOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKCiAgICBmdW5jdGlvbiBpZGVudGl0eShvdXQpIHsKICAgICAgb3V0WzBdID0gMTsKICAgICAgb3V0WzFdID0gMDsKICAgICAgb3V0WzJdID0gMDsKICAgICAgb3V0WzNdID0gMDsKICAgICAgb3V0WzRdID0gMDsKICAgICAgb3V0WzVdID0gMTsKICAgICAgb3V0WzZdID0gMDsKICAgICAgb3V0WzddID0gMDsKICAgICAgb3V0WzhdID0gMDsKICAgICAgb3V0WzldID0gMDsKICAgICAgb3V0WzEwXSA9IDE7CiAgICAgIG91dFsxMV0gPSAwOwogICAgICBvdXRbMTJdID0gMDsKICAgICAgb3V0WzEzXSA9IDA7CiAgICAgIG91dFsxNF0gPSAwOwogICAgICBvdXRbMTVdID0gMTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZlcnQob3V0LCBhKSB7CiAgICAgIGxldCBhMDAgPSBhWzBdLCBhMDEgPSBhWzFdLCBhMDIgPSBhWzJdLCBhMDMgPSBhWzNdOwogICAgICBsZXQgYTEwID0gYVs0XSwgYTExID0gYVs1XSwgYTEyID0gYVs2XSwgYTEzID0gYVs3XTsKICAgICAgbGV0IGEyMCA9IGFbOF0sIGEyMSA9IGFbOV0sIGEyMiA9IGFbMTBdLCBhMjMgPSBhWzExXTsKICAgICAgbGV0IGEzMCA9IGFbMTJdLCBhMzEgPSBhWzEzXSwgYTMyID0gYVsxNF0sIGEzMyA9IGFbMTVdOwogICAgICBsZXQgYjAwID0gYTAwICogYTExIC0gYTAxICogYTEwOwogICAgICBsZXQgYjAxID0gYTAwICogYTEyIC0gYTAyICogYTEwOwogICAgICBsZXQgYjAyID0gYTAwICogYTEzIC0gYTAzICogYTEwOwogICAgICBsZXQgYjAzID0gYTAxICogYTEyIC0gYTAyICogYTExOwogICAgICBsZXQgYjA0ID0gYTAxICogYTEzIC0gYTAzICogYTExOwogICAgICBsZXQgYjA1ID0gYTAyICogYTEzIC0gYTAzICogYTEyOwogICAgICBsZXQgYjA2ID0gYTIwICogYTMxIC0gYTIxICogYTMwOwogICAgICBsZXQgYjA3ID0gYTIwICogYTMyIC0gYTIyICogYTMwOwogICAgICBsZXQgYjA4ID0gYTIwICogYTMzIC0gYTIzICogYTMwOwogICAgICBsZXQgYjA5ID0gYTIxICogYTMyIC0gYTIyICogYTMxOwogICAgICBsZXQgYjEwID0gYTIxICogYTMzIC0gYTIzICogYTMxOwogICAgICBsZXQgYjExID0gYTIyICogYTMzIC0gYTIzICogYTMyOwogICAgICBsZXQgZGV0ID0gYjAwICogYjExIC0gYjAxICogYjEwICsgYjAyICogYjA5ICsgYjAzICogYjA4IC0gYjA0ICogYjA3ICsgYjA1ICogYjA2OwogICAgICBpZiAoIWRldCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGRldCA9IDEuMCAvIGRldDsKICAgICAgb3V0WzBdID0gKGExMSAqIGIxMSAtIGExMiAqIGIxMCArIGExMyAqIGIwOSkgKiBkZXQ7CiAgICAgIG91dFsxXSA9IChhMDIgKiBiMTAgLSBhMDEgKiBiMTEgLSBhMDMgKiBiMDkpICogZGV0OwogICAgICBvdXRbMl0gPSAoYTMxICogYjA1IC0gYTMyICogYjA0ICsgYTMzICogYjAzKSAqIGRldDsKICAgICAgb3V0WzNdID0gKGEyMiAqIGIwNCAtIGEyMSAqIGIwNSAtIGEyMyAqIGIwMykgKiBkZXQ7CiAgICAgIG91dFs0XSA9IChhMTIgKiBiMDggLSBhMTAgKiBiMTEgLSBhMTMgKiBiMDcpICogZGV0OwogICAgICBvdXRbNV0gPSAoYTAwICogYjExIC0gYTAyICogYjA4ICsgYTAzICogYjA3KSAqIGRldDsKICAgICAgb3V0WzZdID0gKGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMSkgKiBkZXQ7CiAgICAgIG91dFs3XSA9IChhMjAgKiBiMDUgLSBhMjIgKiBiMDIgKyBhMjMgKiBiMDEpICogZGV0OwogICAgICBvdXRbOF0gPSAoYTEwICogYjEwIC0gYTExICogYjA4ICsgYTEzICogYjA2KSAqIGRldDsKICAgICAgb3V0WzldID0gKGEwMSAqIGIwOCAtIGEwMCAqIGIxMCAtIGEwMyAqIGIwNikgKiBkZXQ7CiAgICAgIG91dFsxMF0gPSAoYTMwICogYjA0IC0gYTMxICogYjAyICsgYTMzICogYjAwKSAqIGRldDsKICAgICAgb3V0WzExXSA9IChhMjEgKiBiMDIgLSBhMjAgKiBiMDQgLSBhMjMgKiBiMDApICogZGV0OwogICAgICBvdXRbMTJdID0gKGExMSAqIGIwNyAtIGExMCAqIGIwOSAtIGExMiAqIGIwNikgKiBkZXQ7CiAgICAgIG91dFsxM10gPSAoYTAwICogYjA5IC0gYTAxICogYjA3ICsgYTAyICogYjA2KSAqIGRldDsKICAgICAgb3V0WzE0XSA9IChhMzEgKiBiMDEgLSBhMzAgKiBiMDMgLSBhMzIgKiBiMDApICogZGV0OwogICAgICBvdXRbMTVdID0gKGEyMCAqIGIwMyAtIGEyMSAqIGIwMSArIGEyMiAqIGIwMCkgKiBkZXQ7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKICAgIGZ1bmN0aW9uIG11bHRpcGx5KG91dCwgYSwgYikgewogICAgICBsZXQgYTAwID0gYVswXSwgYTAxID0gYVsxXSwgYTAyID0gYVsyXSwgYTAzID0gYVszXTsKICAgICAgbGV0IGExMCA9IGFbNF0sIGExMSA9IGFbNV0sIGExMiA9IGFbNl0sIGExMyA9IGFbN107CiAgICAgIGxldCBhMjAgPSBhWzhdLCBhMjEgPSBhWzldLCBhMjIgPSBhWzEwXSwgYTIzID0gYVsxMV07CiAgICAgIGxldCBhMzAgPSBhWzEyXSwgYTMxID0gYVsxM10sIGEzMiA9IGFbMTRdLCBhMzMgPSBhWzE1XTsKICAgICAgbGV0IGIwICA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdLCBiMyA9IGJbM107CiAgICAgIG91dFswXSA9IGIwKmEwMCArIGIxKmExMCArIGIyKmEyMCArIGIzKmEzMDsKICAgICAgb3V0WzFdID0gYjAqYTAxICsgYjEqYTExICsgYjIqYTIxICsgYjMqYTMxOwogICAgICBvdXRbMl0gPSBiMCphMDIgKyBiMSphMTIgKyBiMiphMjIgKyBiMyphMzI7CiAgICAgIG91dFszXSA9IGIwKmEwMyArIGIxKmExMyArIGIyKmEyMyArIGIzKmEzMzsKICAgICAgYjAgPSBiWzRdOyBiMSA9IGJbNV07IGIyID0gYls2XTsgYjMgPSBiWzddOwogICAgICBvdXRbNF0gPSBiMCphMDAgKyBiMSphMTAgKyBiMiphMjAgKyBiMyphMzA7CiAgICAgIG91dFs1XSA9IGIwKmEwMSArIGIxKmExMSArIGIyKmEyMSArIGIzKmEzMTsKICAgICAgb3V0WzZdID0gYjAqYTAyICsgYjEqYTEyICsgYjIqYTIyICsgYjMqYTMyOwogICAgICBvdXRbN10gPSBiMCphMDMgKyBiMSphMTMgKyBiMiphMjMgKyBiMyphMzM7CiAgICAgIGIwID0gYls4XTsgYjEgPSBiWzldOyBiMiA9IGJbMTBdOyBiMyA9IGJbMTFdOwogICAgICBvdXRbOF0gPSBiMCphMDAgKyBiMSphMTAgKyBiMiphMjAgKyBiMyphMzA7CiAgICAgIG91dFs5XSA9IGIwKmEwMSArIGIxKmExMSArIGIyKmEyMSArIGIzKmEzMTsKICAgICAgb3V0WzEwXSA9IGIwKmEwMiArIGIxKmExMiArIGIyKmEyMiArIGIzKmEzMjsKICAgICAgb3V0WzExXSA9IGIwKmEwMyArIGIxKmExMyArIGIyKmEyMyArIGIzKmEzMzsKICAgICAgYjAgPSBiWzEyXTsgYjEgPSBiWzEzXTsgYjIgPSBiWzE0XTsgYjMgPSBiWzE1XTsKICAgICAgb3V0WzEyXSA9IGIwKmEwMCArIGIxKmExMCArIGIyKmEyMCArIGIzKmEzMDsKICAgICAgb3V0WzEzXSA9IGIwKmEwMSArIGIxKmExMSArIGIyKmEyMSArIGIzKmEzMTsKICAgICAgb3V0WzE0XSA9IGIwKmEwMiArIGIxKmExMiArIGIyKmEyMiArIGIzKmEzMjsKICAgICAgb3V0WzE1XSA9IGIwKmEwMyArIGIxKmExMyArIGIyKmEyMyArIGIzKmEzMzsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCgoKCgoKCgoKCgoKICAgIGZ1bmN0aW9uIGZyb21Sb3RhdGlvblRyYW5zbGF0aW9uKG91dCwgcSwgdikgewogICAgICBsZXQgeCA9IHFbMF0sIHkgPSBxWzFdLCB6ID0gcVsyXSwgdyA9IHFbM107CiAgICAgIGxldCB4MiA9IHggKyB4OwogICAgICBsZXQgeTIgPSB5ICsgeTsKICAgICAgbGV0IHoyID0geiArIHo7CiAgICAgIGxldCB4eCA9IHggKiB4MjsKICAgICAgbGV0IHh5ID0geCAqIHkyOwogICAgICBsZXQgeHogPSB4ICogejI7CiAgICAgIGxldCB5eSA9IHkgKiB5MjsKICAgICAgbGV0IHl6ID0geSAqIHoyOwogICAgICBsZXQgenogPSB6ICogejI7CiAgICAgIGxldCB3eCA9IHcgKiB4MjsKICAgICAgbGV0IHd5ID0gdyAqIHkyOwogICAgICBsZXQgd3ogPSB3ICogejI7CiAgICAgIG91dFswXSA9IDEgLSAoeXkgKyB6eik7CiAgICAgIG91dFsxXSA9IHh5ICsgd3o7CiAgICAgIG91dFsyXSA9IHh6IC0gd3k7CiAgICAgIG91dFszXSA9IDA7CiAgICAgIG91dFs0XSA9IHh5IC0gd3o7CiAgICAgIG91dFs1XSA9IDEgLSAoeHggKyB6eik7CiAgICAgIG91dFs2XSA9IHl6ICsgd3g7CiAgICAgIG91dFs3XSA9IDA7CiAgICAgIG91dFs4XSA9IHh6ICsgd3k7CiAgICAgIG91dFs5XSA9IHl6IC0gd3g7CiAgICAgIG91dFsxMF0gPSAxIC0gKHh4ICsgeXkpOwogICAgICBvdXRbMTFdID0gMDsKICAgICAgb3V0WzEyXSA9IHZbMF07CiAgICAgIG91dFsxM10gPSB2WzFdOwogICAgICBvdXRbMTRdID0gdlsyXTsKICAgICAgb3V0WzE1XSA9IDE7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VHJhbnNsYXRpb24ob3V0LCBtYXQpIHsKICAgICAgb3V0WzBdID0gbWF0WzEyXTsKICAgICAgb3V0WzFdID0gbWF0WzEzXTsKICAgICAgb3V0WzJdID0gbWF0WzE0XTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRSb3RhdGlvbihvdXQsIG1hdCkgewogICAgICBsZXQgdHJhY2UgPSBtYXRbMF0gKyBtYXRbNV0gKyBtYXRbMTBdOwogICAgICBsZXQgUyA9IDA7CiAgICAgIGlmICh0cmFjZSA+IDApIHsKICAgICAgICBTID0gTWF0aC5zcXJ0KHRyYWNlICsgMS4wKSAqIDI7CiAgICAgICAgb3V0WzNdID0gMC4yNSAqIFM7CiAgICAgICAgb3V0WzBdID0gKG1hdFs2XSAtIG1hdFs5XSkgLyBTOwogICAgICAgIG91dFsxXSA9IChtYXRbOF0gLSBtYXRbMl0pIC8gUzsKICAgICAgICBvdXRbMl0gPSAobWF0WzFdIC0gbWF0WzRdKSAvIFM7CiAgICAgIH0gZWxzZSBpZiAoKG1hdFswXSA+IG1hdFs1XSkgJiYgKG1hdFswXSA+IG1hdFsxMF0pKSB7CiAgICAgICAgUyA9IE1hdGguc3FydCgxLjAgKyBtYXRbMF0gLSBtYXRbNV0gLSBtYXRbMTBdKSAqIDI7CiAgICAgICAgb3V0WzNdID0gKG1hdFs2XSAtIG1hdFs5XSkgLyBTOwogICAgICAgIG91dFswXSA9IDAuMjUgKiBTOwogICAgICAgIG91dFsxXSA9IChtYXRbMV0gKyBtYXRbNF0pIC8gUzsKICAgICAgICBvdXRbMl0gPSAobWF0WzhdICsgbWF0WzJdKSAvIFM7CiAgICAgIH0gZWxzZSBpZiAobWF0WzVdID4gbWF0WzEwXSkgewogICAgICAgIFMgPSBNYXRoLnNxcnQoMS4wICsgbWF0WzVdIC0gbWF0WzBdIC0gbWF0WzEwXSkgKiAyOwogICAgICAgIG91dFszXSA9IChtYXRbOF0gLSBtYXRbMl0pIC8gUzsKICAgICAgICBvdXRbMF0gPSAobWF0WzFdICsgbWF0WzRdKSAvIFM7CiAgICAgICAgb3V0WzFdID0gMC4yNSAqIFM7CiAgICAgICAgb3V0WzJdID0gKG1hdFs2XSArIG1hdFs5XSkgLyBTOwogICAgICB9IGVsc2UgewogICAgICAgIFMgPSBNYXRoLnNxcnQoMS4wICsgbWF0WzEwXSAtIG1hdFswXSAtIG1hdFs1XSkgKiAyOwogICAgICAgIG91dFszXSA9IChtYXRbMV0gLSBtYXRbNF0pIC8gUzsKICAgICAgICBvdXRbMF0gPSAobWF0WzhdICsgbWF0WzJdKSAvIFM7CiAgICAgICAgb3V0WzFdID0gKG1hdFs2XSArIG1hdFs5XSkgLyBTOwogICAgICAgIG91dFsyXSA9IDAuMjUgKiBTOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCgogICAgZnVuY3Rpb24gcGVyc3BlY3RpdmUob3V0LCBmb3Z5LCBhc3BlY3QsIG5lYXIsIGZhcikgewogICAgICBsZXQgZiA9IDEuMCAvIE1hdGgudGFuKGZvdnkgLyAyKSwgbmY7CiAgICAgIG91dFswXSA9IGYgLyBhc3BlY3Q7CiAgICAgIG91dFsxXSA9IDA7CiAgICAgIG91dFsyXSA9IDA7CiAgICAgIG91dFszXSA9IDA7CiAgICAgIG91dFs0XSA9IDA7CiAgICAgIG91dFs1XSA9IGY7CiAgICAgIG91dFs2XSA9IDA7CiAgICAgIG91dFs3XSA9IDA7CiAgICAgIG91dFs4XSA9IDA7CiAgICAgIG91dFs5XSA9IDA7CiAgICAgIG91dFsxMV0gPSAtMTsKICAgICAgb3V0WzEyXSA9IDA7CiAgICAgIG91dFsxM10gPSAwOwogICAgICBvdXRbMTVdID0gMDsKICAgICAgaWYgKGZhciAhPSBudWxsICYmIGZhciAhPT0gSW5maW5pdHkpIHsKICAgICAgICBuZiA9IDEgLyAobmVhciAtIGZhcik7CiAgICAgICAgb3V0WzEwXSA9IChmYXIgKyBuZWFyKSAqIG5mOwogICAgICAgIG91dFsxNF0gPSAoMiAqIGZhciAqIG5lYXIpICogbmY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb3V0WzEwXSA9IC0xOwogICAgICAgIG91dFsxNF0gPSAtMiAqIG5lYXI7CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGUkMSgpIHsKICAgICAgbGV0IG91dCA9IG5ldyBBUlJBWV9UWVBFKDMpOwogICAgICBpZihBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICBvdXRbMl0gPSAwOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBjbG9uZSQxKGEpIHsKICAgICAgdmFyIG91dCA9IG5ldyBBUlJBWV9UWVBFKDMpOwogICAgICBvdXRbMF0gPSBhWzBdOwogICAgICBvdXRbMV0gPSBhWzFdOwogICAgICBvdXRbMl0gPSBhWzJdOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgZnVuY3Rpb24gbGVuZ3RoKGEpIHsKICAgICAgbGV0IHggPSBhWzBdOwogICAgICBsZXQgeSA9IGFbMV07CiAgICAgIGxldCB6ID0gYVsyXTsKICAgICAgcmV0dXJuIE1hdGguc3FydCh4KnggKyB5KnkgKyB6KnopOwogICAgfQogICAgZnVuY3Rpb24gZnJvbVZhbHVlcyQxKHgsIHksIHopIHsKICAgICAgbGV0IG91dCA9IG5ldyBBUlJBWV9UWVBFKDMpOwogICAgICBvdXRbMF0gPSB4OwogICAgICBvdXRbMV0gPSB5OwogICAgICBvdXRbMl0gPSB6OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgZnVuY3Rpb24gY29weSQxKG91dCwgYSkgewogICAgICBvdXRbMF0gPSBhWzBdOwogICAgICBvdXRbMV0gPSBhWzFdOwogICAgICBvdXRbMl0gPSBhWzJdOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKICAgIGZ1bmN0aW9uIGFkZCQxKG91dCwgYSwgYikgewogICAgICBvdXRbMF0gPSBhWzBdICsgYlswXTsKICAgICAgb3V0WzFdID0gYVsxXSArIGJbMV07CiAgICAgIG91dFsyXSA9IGFbMl0gKyBiWzJdOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKCgoKCgoKCiAgICBmdW5jdGlvbiBzY2FsZSQxKG91dCwgYSwgYikgewogICAgICBvdXRbMF0gPSBhWzBdICogYjsKICAgICAgb3V0WzFdID0gYVsxXSAqIGI7CiAgICAgIG91dFsyXSA9IGFbMl0gKiBiOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKCgoKCgogICAgZnVuY3Rpb24gbm9ybWFsaXplKG91dCwgYSkgewogICAgICBsZXQgeCA9IGFbMF07CiAgICAgIGxldCB5ID0gYVsxXTsKICAgICAgbGV0IHogPSBhWzJdOwogICAgICBsZXQgbGVuID0geCp4ICsgeSp5ICsgeip6OwogICAgICBpZiAobGVuID4gMCkgewogICAgICAgIGxlbiA9IDEgLyBNYXRoLnNxcnQobGVuKTsKICAgICAgICBvdXRbMF0gPSBhWzBdICogbGVuOwogICAgICAgIG91dFsxXSA9IGFbMV0gKiBsZW47CiAgICAgICAgb3V0WzJdID0gYVsyXSAqIGxlbjsKICAgICAgfQogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgZnVuY3Rpb24gZG90KGEsIGIpIHsKICAgICAgcmV0dXJuIGFbMF0gKiBiWzBdICsgYVsxXSAqIGJbMV0gKyBhWzJdICogYlsyXTsKICAgIH0KICAgIGZ1bmN0aW9uIGNyb3NzKG91dCwgYSwgYikgewogICAgICBsZXQgYXggPSBhWzBdLCBheSA9IGFbMV0sIGF6ID0gYVsyXTsKICAgICAgbGV0IGJ4ID0gYlswXSwgYnkgPSBiWzFdLCBieiA9IGJbMl07CiAgICAgIG91dFswXSA9IGF5ICogYnogLSBheiAqIGJ5OwogICAgICBvdXRbMV0gPSBheiAqIGJ4IC0gYXggKiBiejsKICAgICAgb3V0WzJdID0gYXggKiBieSAtIGF5ICogYng7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCgoKCiAgICBmdW5jdGlvbiB0cmFuc2Zvcm1RdWF0KG91dCwgYSwgcSkgewogICAgICAgIGxldCBxeCA9IHFbMF0sIHF5ID0gcVsxXSwgcXogPSBxWzJdLCBxdyA9IHFbM107CiAgICAgICAgbGV0IHggPSBhWzBdLCB5ID0gYVsxXSwgeiA9IGFbMl07CiAgICAgICAgbGV0IHV2eCA9IHF5ICogeiAtIHF6ICogeSwKICAgICAgICAgICAgdXZ5ID0gcXogKiB4IC0gcXggKiB6LAogICAgICAgICAgICB1dnogPSBxeCAqIHkgLSBxeSAqIHg7CiAgICAgICAgbGV0IHV1dnggPSBxeSAqIHV2eiAtIHF6ICogdXZ5LAogICAgICAgICAgICB1dXZ5ID0gcXogKiB1dnggLSBxeCAqIHV2eiwKICAgICAgICAgICAgdXV2eiA9IHF4ICogdXZ5IC0gcXkgKiB1dng7CiAgICAgICAgbGV0IHcyID0gcXcgKiAyOwogICAgICAgIHV2eCAqPSB3MjsKICAgICAgICB1dnkgKj0gdzI7CiAgICAgICAgdXZ6ICo9IHcyOwogICAgICAgIHV1dnggKj0gMjsKICAgICAgICB1dXZ5ICo9IDI7CiAgICAgICAgdXV2eiAqPSAyOwogICAgICAgIG91dFswXSA9IHggKyB1dnggKyB1dXZ4OwogICAgICAgIG91dFsxXSA9IHkgKyB1dnkgKyB1dXZ5OwogICAgICAgIG91dFsyXSA9IHogKyB1dnogKyB1dXZ6OwogICAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCiAgICBmdW5jdGlvbiBhbmdsZShhLCBiKSB7CiAgICAgIGxldCB0ZW1wQSA9IGZyb21WYWx1ZXMkMShhWzBdLCBhWzFdLCBhWzJdKTsKICAgICAgbGV0IHRlbXBCID0gZnJvbVZhbHVlcyQxKGJbMF0sIGJbMV0sIGJbMl0pOwogICAgICBub3JtYWxpemUodGVtcEEsIHRlbXBBKTsKICAgICAgbm9ybWFsaXplKHRlbXBCLCB0ZW1wQik7CiAgICAgIGxldCBjb3NpbmUgPSBkb3QodGVtcEEsIHRlbXBCKTsKICAgICAgaWYoY29zaW5lID4gMS4wKSB7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgZWxzZSBpZihjb3NpbmUgPCAtMSkgewogICAgICAgIHJldHVybiBNYXRoLlBJOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBNYXRoLmFjb3MoY29zaW5lKTsKICAgICAgfQogICAgfQoKCgoKCgoKCiAgICBjb25zdCBsZW4gPSBsZW5ndGg7CgogICAgKChmdW5jdGlvbigpIHsKICAgICAgbGV0IHZlYyA9IGNyZWF0ZSQxKCk7CiAgICAgIHJldHVybiBmdW5jdGlvbihhLCBzdHJpZGUsIG9mZnNldCwgY291bnQsIGZuLCBhcmcpIHsKICAgICAgICBsZXQgaSwgbDsKICAgICAgICBpZighc3RyaWRlKSB7CiAgICAgICAgICBzdHJpZGUgPSAzOwogICAgICAgIH0KICAgICAgICBpZighb2Zmc2V0KSB7CiAgICAgICAgICBvZmZzZXQgPSAwOwogICAgICAgIH0KICAgICAgICBpZihjb3VudCkgewogICAgICAgICAgbCA9IE1hdGgubWluKChjb3VudCAqIHN0cmlkZSkgKyBvZmZzZXQsIGEubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbCA9IGEubGVuZ3RoOwogICAgICAgIH0KICAgICAgICBmb3IoaSA9IG9mZnNldDsgaSA8IGw7IGkgKz0gc3RyaWRlKSB7CiAgICAgICAgICB2ZWNbMF0gPSBhW2ldOyB2ZWNbMV0gPSBhW2krMV07IHZlY1syXSA9IGFbaSsyXTsKICAgICAgICAgIGZuKHZlYywgdmVjLCBhcmcpOwogICAgICAgICAgYVtpXSA9IHZlY1swXTsgYVtpKzFdID0gdmVjWzFdOyBhW2krMl0gPSB2ZWNbMl07CiAgICAgICAgfQogICAgICAgIHJldHVybiBhOwogICAgICB9OwogICAgfSkpKCk7CgogICAgZnVuY3Rpb24gY3JlYXRlJDIoKSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSg5KTsKICAgICAgaWYoQVJSQVlfVFlQRSAhPSBGbG9hdDMyQXJyYXkpIHsKICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgb3V0WzNdID0gMDsKICAgICAgICBvdXRbNV0gPSAwOwogICAgICAgIG91dFs2XSA9IDA7CiAgICAgICAgb3V0WzddID0gMDsKICAgICAgfQogICAgICBvdXRbMF0gPSAxOwogICAgICBvdXRbNF0gPSAxOwogICAgICBvdXRbOF0gPSAxOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZSQzKCkgewogICAgICBsZXQgb3V0ID0gbmV3IEFSUkFZX1RZUEUoNCk7CiAgICAgIGlmKEFSUkFZX1RZUEUgIT0gRmxvYXQzMkFycmF5KSB7CiAgICAgICAgb3V0WzBdID0gMDsKICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgIG91dFsyXSA9IDA7CiAgICAgICAgb3V0WzNdID0gMDsKICAgICAgfQogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgZnVuY3Rpb24gY2xvbmUkMyhhKSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgb3V0WzNdID0gYVszXTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGZyb21WYWx1ZXMkMyh4LCB5LCB6LCB3KSB7CiAgICAgIGxldCBvdXQgPSBuZXcgQVJSQVlfVFlQRSg0KTsKICAgICAgb3V0WzBdID0geDsKICAgICAgb3V0WzFdID0geTsKICAgICAgb3V0WzJdID0gejsKICAgICAgb3V0WzNdID0gdzsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGNvcHkkMyhvdXQsIGEpIHsKICAgICAgb3V0WzBdID0gYVswXTsKICAgICAgb3V0WzFdID0gYVsxXTsKICAgICAgb3V0WzJdID0gYVsyXTsKICAgICAgb3V0WzNdID0gYVszXTsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCgoKCgoKCgoKCgoKCgoKCgoKICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZSQxKG91dCwgYSkgewogICAgICBsZXQgeCA9IGFbMF07CiAgICAgIGxldCB5ID0gYVsxXTsKICAgICAgbGV0IHogPSBhWzJdOwogICAgICBsZXQgdyA9IGFbM107CiAgICAgIGxldCBsZW4gPSB4KnggKyB5KnkgKyB6KnogKyB3Knc7CiAgICAgIGlmIChsZW4gPiAwKSB7CiAgICAgICAgbGVuID0gMSAvIE1hdGguc3FydChsZW4pOwogICAgICAgIG91dFswXSA9IHggKiBsZW47CiAgICAgICAgb3V0WzFdID0geSAqIGxlbjsKICAgICAgICBvdXRbMl0gPSB6ICogbGVuOwogICAgICAgIG91dFszXSA9IHcgKiBsZW47CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH0KCgoKCgoKCgoKCgoKCgoKICAgICgoZnVuY3Rpb24oKSB7CiAgICAgIGxldCB2ZWMgPSBjcmVhdGUkMygpOwogICAgICByZXR1cm4gZnVuY3Rpb24oYSwgc3RyaWRlLCBvZmZzZXQsIGNvdW50LCBmbiwgYXJnKSB7CiAgICAgICAgbGV0IGksIGw7CiAgICAgICAgaWYoIXN0cmlkZSkgewogICAgICAgICAgc3RyaWRlID0gNDsKICAgICAgICB9CiAgICAgICAgaWYoIW9mZnNldCkgewogICAgICAgICAgb2Zmc2V0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYoY291bnQpIHsKICAgICAgICAgIGwgPSBNYXRoLm1pbigoY291bnQgKiBzdHJpZGUpICsgb2Zmc2V0LCBhLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGwgPSBhLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgZm9yKGkgPSBvZmZzZXQ7IGkgPCBsOyBpICs9IHN0cmlkZSkgewogICAgICAgICAgdmVjWzBdID0gYVtpXTsgdmVjWzFdID0gYVtpKzFdOyB2ZWNbMl0gPSBhW2krMl07IHZlY1szXSA9IGFbaSszXTsKICAgICAgICAgIGZuKHZlYywgdmVjLCBhcmcpOwogICAgICAgICAgYVtpXSA9IHZlY1swXTsgYVtpKzFdID0gdmVjWzFdOyBhW2krMl0gPSB2ZWNbMl07IGFbaSszXSA9IHZlY1szXTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGE7CiAgICAgIH07CiAgICB9KSkoKTsKCiAgICBmdW5jdGlvbiBjcmVhdGUkNCgpIHsKICAgICAgbGV0IG91dCA9IG5ldyBBUlJBWV9UWVBFKDQpOwogICAgICBpZihBUlJBWV9UWVBFICE9IEZsb2F0MzJBcnJheSkgewogICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgb3V0WzFdID0gMDsKICAgICAgICBvdXRbMl0gPSAwOwogICAgICB9CiAgICAgIG91dFszXSA9IDE7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgogICAgZnVuY3Rpb24gc2V0QXhpc0FuZ2xlKG91dCwgYXhpcywgcmFkKSB7CiAgICAgIHJhZCA9IHJhZCAqIDAuNTsKICAgICAgbGV0IHMgPSBNYXRoLnNpbihyYWQpOwogICAgICBvdXRbMF0gPSBzICogYXhpc1swXTsKICAgICAgb3V0WzFdID0gcyAqIGF4aXNbMV07CiAgICAgIG91dFsyXSA9IHMgKiBheGlzWzJdOwogICAgICBvdXRbM10gPSBNYXRoLmNvcyhyYWQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQoKICAgIGZ1bmN0aW9uIG11bHRpcGx5JDQob3V0LCBhLCBiKSB7CiAgICAgIGxldCBheCA9IGFbMF0sIGF5ID0gYVsxXSwgYXogPSBhWzJdLCBhdyA9IGFbM107CiAgICAgIGxldCBieCA9IGJbMF0sIGJ5ID0gYlsxXSwgYnogPSBiWzJdLCBidyA9IGJbM107CiAgICAgIG91dFswXSA9IGF4ICogYncgKyBhdyAqIGJ4ICsgYXkgKiBieiAtIGF6ICogYnk7CiAgICAgIG91dFsxXSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIG91dFsyXSA9IGF6ICogYncgKyBhdyAqIGJ6ICsgYXggKiBieSAtIGF5ICogYng7CiAgICAgIG91dFszXSA9IGF3ICogYncgLSBheCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYno7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CgoKCgogICAgZnVuY3Rpb24gc2xlcnAob3V0LCBhLCBiLCB0KSB7CiAgICAgIGxldCBheCA9IGFbMF0sIGF5ID0gYVsxXSwgYXogPSBhWzJdLCBhdyA9IGFbM107CiAgICAgIGxldCBieCA9IGJbMF0sIGJ5ID0gYlsxXSwgYnogPSBiWzJdLCBidyA9IGJbM107CiAgICAgIGxldCBvbWVnYSwgY29zb20sIHNpbm9tLCBzY2FsZTAsIHNjYWxlMTsKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OwogICAgICBpZiAoIGNvc29tIDwgMC4wICkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLSBieDsKICAgICAgICBieSA9IC0gYnk7CiAgICAgICAgYnogPSAtIGJ6OwogICAgICAgIGJ3ID0gLSBidzsKICAgICAgfQogICAgICBpZiAoICgxLjAgLSBjb3NvbSkgPiBFUFNJTE9OICkgewogICAgICAgIG9tZWdhICA9IE1hdGguYWNvcyhjb3NvbSk7CiAgICAgICAgc2lub20gID0gTWF0aC5zaW4ob21lZ2EpOwogICAgICAgIHNjYWxlMCA9IE1hdGguc2luKCgxLjAgLSB0KSAqIG9tZWdhKSAvIHNpbm9tOwogICAgICAgIHNjYWxlMSA9IE1hdGguc2luKHQgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzY2FsZTAgPSAxLjAgLSB0OwogICAgICAgIHNjYWxlMSA9IHQ7CiAgICAgIH0KICAgICAgb3V0WzBdID0gc2NhbGUwICogYXggKyBzY2FsZTEgKiBieDsKICAgICAgb3V0WzFdID0gc2NhbGUwICogYXkgKyBzY2FsZTEgKiBieTsKICAgICAgb3V0WzJdID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgb3V0WzNdID0gc2NhbGUwICogYXcgKyBzY2FsZTEgKiBidzsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBpbnZlcnQkMihvdXQsIGEpIHsKICAgICAgbGV0IGEwID0gYVswXSwgYTEgPSBhWzFdLCBhMiA9IGFbMl0sIGEzID0gYVszXTsKICAgICAgbGV0IGRvdCQkMSA9IGEwKmEwICsgYTEqYTEgKyBhMiphMiArIGEzKmEzOwogICAgICBsZXQgaW52RG90ID0gZG90JCQxID8gMS4wL2RvdCQkMSA6IDA7CiAgICAgIG91dFswXSA9IC1hMCppbnZEb3Q7CiAgICAgIG91dFsxXSA9IC1hMSppbnZEb3Q7CiAgICAgIG91dFsyXSA9IC1hMippbnZEb3Q7CiAgICAgIG91dFszXSA9IGEzKmludkRvdDsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KCiAgICBmdW5jdGlvbiBmcm9tTWF0MyhvdXQsIG0pIHsKICAgICAgbGV0IGZUcmFjZSA9IG1bMF0gKyBtWzRdICsgbVs4XTsKICAgICAgbGV0IGZSb290OwogICAgICBpZiAoIGZUcmFjZSA+IDAuMCApIHsKICAgICAgICBmUm9vdCA9IE1hdGguc3FydChmVHJhY2UgKyAxLjApOwogICAgICAgIG91dFszXSA9IDAuNSAqIGZSb290OwogICAgICAgIGZSb290ID0gMC41L2ZSb290OwogICAgICAgIG91dFswXSA9IChtWzVdLW1bN10pKmZSb290OwogICAgICAgIG91dFsxXSA9IChtWzZdLW1bMl0pKmZSb290OwogICAgICAgIG91dFsyXSA9IChtWzFdLW1bM10pKmZSb290OwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBpID0gMDsKICAgICAgICBpZiAoIG1bNF0gPiBtWzBdICkKICAgICAgICAgIGkgPSAxOwogICAgICAgIGlmICggbVs4XSA+IG1baSozK2ldICkKICAgICAgICAgIGkgPSAyOwogICAgICAgIGxldCBqID0gKGkrMSklMzsKICAgICAgICBsZXQgayA9IChpKzIpJTM7CiAgICAgICAgZlJvb3QgPSBNYXRoLnNxcnQobVtpKjMraV0tbVtqKjMral0tbVtrKjMra10gKyAxLjApOwogICAgICAgIG91dFtpXSA9IDAuNSAqIGZSb290OwogICAgICAgIGZSb290ID0gMC41IC8gZlJvb3Q7CiAgICAgICAgb3V0WzNdID0gKG1baiozK2tdIC0gbVtrKjMral0pICogZlJvb3Q7CiAgICAgICAgb3V0W2pdID0gKG1baiozK2ldICsgbVtpKjMral0pICogZlJvb3Q7CiAgICAgICAgb3V0W2tdID0gKG1bayozK2ldICsgbVtpKjMra10pICogZlJvb3Q7CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIGZ1bmN0aW9uIGZyb21FdWxlcihvdXQsIHgsIHksIHopIHsKICAgICAgICBsZXQgaGFsZlRvUmFkID0gMC41ICogTWF0aC5QSSAvIDE4MC4wOwogICAgICAgIHggKj0gaGFsZlRvUmFkOwogICAgICAgIHkgKj0gaGFsZlRvUmFkOwogICAgICAgIHogKj0gaGFsZlRvUmFkOwogICAgICAgIGxldCBzeCA9IE1hdGguc2luKHgpOwogICAgICAgIGxldCBjeCA9IE1hdGguY29zKHgpOwogICAgICAgIGxldCBzeSA9IE1hdGguc2luKHkpOwogICAgICAgIGxldCBjeSA9IE1hdGguY29zKHkpOwogICAgICAgIGxldCBzeiA9IE1hdGguc2luKHopOwogICAgICAgIGxldCBjeiA9IE1hdGguY29zKHopOwogICAgICAgIG91dFswXSA9IHN4ICogY3kgKiBjeiAtIGN4ICogc3kgKiBzejsKICAgICAgICBvdXRbMV0gPSBjeCAqIHN5ICogY3ogKyBzeCAqIGN5ICogc3o7CiAgICAgICAgb3V0WzJdID0gY3ggKiBjeSAqIHN6IC0gc3ggKiBzeSAqIGN6OwogICAgICAgIG91dFszXSA9IGN4ICogY3kgKiBjeiArIHN4ICogc3kgKiBzejsKICAgICAgICByZXR1cm4gb3V0OwogICAgfQoKICAgIGNvbnN0IGNsb25lJDQgPSBjbG9uZSQzOwogICAgY29uc3QgZnJvbVZhbHVlcyQ0ID0gZnJvbVZhbHVlcyQzOwogICAgY29uc3QgY29weSQ0ID0gY29weSQzOwoKCgoKCgoKCgoKICAgIGNvbnN0IG5vcm1hbGl6ZSQyID0gbm9ybWFsaXplJDE7CgoKICAgICgoZnVuY3Rpb24oKSB7CiAgICAgIGxldCB0bXB2ZWMzID0gY3JlYXRlJDEoKTsKICAgICAgbGV0IHhVbml0VmVjMyA9IGZyb21WYWx1ZXMkMSgxLDAsMCk7CiAgICAgIGxldCB5VW5pdFZlYzMgPSBmcm9tVmFsdWVzJDEoMCwxLDApOwogICAgICByZXR1cm4gZnVuY3Rpb24ob3V0LCBhLCBiKSB7CiAgICAgICAgbGV0IGRvdCQkMSA9IGRvdChhLCBiKTsKICAgICAgICBpZiAoZG90JCQxIDwgLTAuOTk5OTk5KSB7CiAgICAgICAgICBjcm9zcyh0bXB2ZWMzLCB4VW5pdFZlYzMsIGEpOwogICAgICAgICAgaWYgKGxlbih0bXB2ZWMzKSA8IDAuMDAwMDAxKQogICAgICAgICAgICBjcm9zcyh0bXB2ZWMzLCB5VW5pdFZlYzMsIGEpOwogICAgICAgICAgbm9ybWFsaXplKHRtcHZlYzMsIHRtcHZlYzMpOwogICAgICAgICAgc2V0QXhpc0FuZ2xlKG91dCwgdG1wdmVjMywgTWF0aC5QSSk7CiAgICAgICAgICByZXR1cm4gb3V0OwogICAgICAgIH0gZWxzZSBpZiAoZG90JCQxID4gMC45OTk5OTkpIHsKICAgICAgICAgIG91dFswXSA9IDA7CiAgICAgICAgICBvdXRbMV0gPSAwOwogICAgICAgICAgb3V0WzJdID0gMDsKICAgICAgICAgIG91dFszXSA9IDE7CiAgICAgICAgICByZXR1cm4gb3V0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjcm9zcyh0bXB2ZWMzLCBhLCBiKTsKICAgICAgICAgIG91dFswXSA9IHRtcHZlYzNbMF07CiAgICAgICAgICBvdXRbMV0gPSB0bXB2ZWMzWzFdOwogICAgICAgICAgb3V0WzJdID0gdG1wdmVjM1syXTsKICAgICAgICAgIG91dFszXSA9IDEgKyBkb3QkJDE7CiAgICAgICAgICByZXR1cm4gbm9ybWFsaXplJDIob3V0LCBvdXQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0pKSgpOwogICAgKChmdW5jdGlvbiAoKSB7CiAgICAgIGxldCB0ZW1wMSA9IGNyZWF0ZSQ0KCk7CiAgICAgIGxldCB0ZW1wMiA9IGNyZWF0ZSQ0KCk7CiAgICAgIHJldHVybiBmdW5jdGlvbiAob3V0LCBhLCBiLCBjLCBkLCB0KSB7CiAgICAgICAgc2xlcnAodGVtcDEsIGEsIGQsIHQpOwogICAgICAgIHNsZXJwKHRlbXAyLCBiLCBjLCB0KTsKICAgICAgICBzbGVycChvdXQsIHRlbXAxLCB0ZW1wMiwgMiAqIHQgKiAoMSAtIHQpKTsKICAgICAgICByZXR1cm4gb3V0OwogICAgICB9OwogICAgfSkoKSk7CiAgICAoKGZ1bmN0aW9uKCkgewogICAgICBsZXQgbWF0ciA9IGNyZWF0ZSQyKCk7CiAgICAgIHJldHVybiBmdW5jdGlvbihvdXQsIHZpZXcsIHJpZ2h0LCB1cCkgewogICAgICAgIG1hdHJbMF0gPSByaWdodFswXTsKICAgICAgICBtYXRyWzNdID0gcmlnaHRbMV07CiAgICAgICAgbWF0cls2XSA9IHJpZ2h0WzJdOwogICAgICAgIG1hdHJbMV0gPSB1cFswXTsKICAgICAgICBtYXRyWzRdID0gdXBbMV07CiAgICAgICAgbWF0cls3XSA9IHVwWzJdOwogICAgICAgIG1hdHJbMl0gPSAtdmlld1swXTsKICAgICAgICBtYXRyWzVdID0gLXZpZXdbMV07CiAgICAgICAgbWF0cls4XSA9IC12aWV3WzJdOwogICAgICAgIHJldHVybiBub3JtYWxpemUkMihvdXQsIGZyb21NYXQzKG91dCwgbWF0cikpOwogICAgICB9OwogICAgfSkpKCk7CgogICAgY29uc3QgUFJJVkFURSQxID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSUmlnaWRUcmFuc2Zvcm0nKTsKICAgIGNsYXNzIFhSUmlnaWRUcmFuc2Zvcm0kMSB7CiAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgIHRoaXNbUFJJVkFURSQxXSA9IHsKICAgICAgICAgIG1hdHJpeDogbnVsbCwKICAgICAgICAgIHBvc2l0aW9uOiBudWxsLAogICAgICAgICAgb3JpZW50YXRpb246IG51bGwsCiAgICAgICAgICBpbnZlcnNlOiBudWxsLAogICAgICAgIH07CiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5tYXRyaXggPSBpZGVudGl0eShuZXcgRmxvYXQzMkFycmF5KDE2KSk7CiAgICAgICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICBpZiAoYXJndW1lbnRzWzBdIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5KSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5tYXRyaXggPSBhcmd1bWVudHNbMF07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ucG9zaXRpb24gPSB0aGlzLl9nZXRQb2ludChhcmd1bWVudHNbMF0pOwogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb24gPSBET01Qb2ludFJlYWRPbmx5LmZyb21Qb2ludCh7CiAgICAgICAgICAgICAgICB4OiAwLCB5OiAwLCB6OiAwLCB3OiAxCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICAgICAgdGhpc1tQUklWQVRFJDFdLnBvc2l0aW9uID0gdGhpcy5fZ2V0UG9pbnQoYXJndW1lbnRzWzBdKTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5vcmllbnRhdGlvbiA9IHRoaXMuX2dldFBvaW50KGFyZ3VtZW50c1sxXSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVG9vIG1hbnkgYXJndW1lbnRzISIpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpc1tQUklWQVRFJDFdLm1hdHJpeCkgewogICAgICAgICAgICBsZXQgcG9zaXRpb24gPSBjcmVhdGUkMSgpOwogICAgICAgICAgICBnZXRUcmFuc2xhdGlvbihwb3NpdGlvbiwgdGhpc1tQUklWQVRFJDFdLm1hdHJpeCk7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5wb3NpdGlvbiA9IERPTVBvaW50UmVhZE9ubHkuZnJvbVBvaW50KHsKICAgICAgICAgICAgICAgIHg6IHBvc2l0aW9uWzBdLAogICAgICAgICAgICAgICAgeTogcG9zaXRpb25bMV0sCiAgICAgICAgICAgICAgICB6OiBwb3NpdGlvblsyXQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbGV0IG9yaWVudGF0aW9uID0gY3JlYXRlJDQoKTsKICAgICAgICAgICAgZ2V0Um90YXRpb24ob3JpZW50YXRpb24sIHRoaXNbUFJJVkFURSQxXS5tYXRyaXgpOwogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb24gPSBET01Qb2ludFJlYWRPbmx5LmZyb21Qb2ludCh7CiAgICAgICAgICAgICAgeDogb3JpZW50YXRpb25bMF0sCiAgICAgICAgICAgICAgeTogb3JpZW50YXRpb25bMV0sCiAgICAgICAgICAgICAgejogb3JpZW50YXRpb25bMl0sCiAgICAgICAgICAgICAgdzogb3JpZW50YXRpb25bM10KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm1hdHJpeCA9IGlkZW50aXR5KG5ldyBGbG9hdDMyQXJyYXkoMTYpKTsKICAgICAgICAgICAgZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24oCiAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm1hdHJpeCwKICAgICAgICAgICAgICBmcm9tVmFsdWVzJDQoCiAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb24ueCwKICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5vcmllbnRhdGlvbi55LAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLm9yaWVudGF0aW9uLnosCiAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb24udyksCiAgICAgICAgICAgICAgZnJvbVZhbHVlcyQxKAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDFdLnBvc2l0aW9uLngsCiAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0ucG9zaXRpb24ueSwKICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5wb3NpdGlvbi56KQogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICBfZ2V0UG9pbnQoYXJnKSB7CiAgICAgICAgaWYgKGFyZyBpbnN0YW5jZW9mIERPTVBvaW50UmVhZE9ubHkpIHsKICAgICAgICAgIHJldHVybiBhcmc7CiAgICAgICAgfQogICAgICAgIHJldHVybiBET01Qb2ludFJlYWRPbmx5LmZyb21Qb2ludChhcmcpOwogICAgICB9CiAgICAgIGdldCBtYXRyaXgoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMV0ubWF0cml4OyB9CiAgICAgIGdldCBwb3NpdGlvbigpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxXS5wb3NpdGlvbjsgfQogICAgICBnZXQgb3JpZW50YXRpb24oKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMV0ub3JpZW50YXRpb247IH0KICAgICAgZ2V0IGludmVyc2UoKSB7CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxXS5pbnZlcnNlID09PSBudWxsKSB7CiAgICAgICAgICBsZXQgaW52TWF0cml4ID0gaWRlbnRpdHkobmV3IEZsb2F0MzJBcnJheSgxNikpOwogICAgICAgICAgaW52ZXJ0KGludk1hdHJpeCwgdGhpc1tQUklWQVRFJDFdLm1hdHJpeCk7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMV0uaW52ZXJzZSA9IG5ldyBYUlJpZ2lkVHJhbnNmb3JtJDEoaW52TWF0cml4KTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxXS5pbnZlcnNlW1BSSVZBVEUkMV0uaW52ZXJzZSA9IHRoaXM7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMV0uaW52ZXJzZTsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkMiA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlNwYWNlJyk7CgogICAgY2xhc3MgWFJTcGFjZSB7CiAgICAgIGNvbnN0cnVjdG9yKHNwZWNpYWxUeXBlID0gbnVsbCwgaW5wdXRTb3VyY2UgPSBudWxsKSB7CiAgICAgICAgdGhpc1tQUklWQVRFJDJdID0gewogICAgICAgICAgc3BlY2lhbFR5cGUsCiAgICAgICAgICBpbnB1dFNvdXJjZSwKICAgICAgICAgIGJhc2VNYXRyaXg6IG51bGwsCiAgICAgICAgICBpbnZlcnNlQmFzZU1hdHJpeDogbnVsbCwKICAgICAgICAgIGxhc3RGcmFtZUlkOiAtMQogICAgICAgIH07CiAgICAgIH0KICAgICAgZ2V0IF9zcGVjaWFsVHlwZSgpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDJdLnNwZWNpYWxUeXBlOwogICAgICB9CiAgICAgIGdldCBfaW5wdXRTb3VyY2UoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQyXS5pbnB1dFNvdXJjZTsKICAgICAgfQogICAgICBfZW5zdXJlUG9zZVVwZGF0ZWQoZGV2aWNlLCBmcmFtZUlkKSB7CiAgICAgICAgaWYgKGZyYW1lSWQgPT0gdGhpc1tQUklWQVRFJDJdLmxhc3RGcmFtZUlkKSByZXR1cm47CiAgICAgICAgdGhpc1tQUklWQVRFJDJdLmxhc3RGcmFtZUlkID0gZnJhbWVJZDsKICAgICAgICB0aGlzLl9vblBvc2VVcGRhdGUoZGV2aWNlKTsKICAgICAgfQogICAgICBfb25Qb3NlVXBkYXRlKGRldmljZSkgewogICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMl0uc3BlY2lhbFR5cGUgPT0gJ3ZpZXdlcicpIHsKICAgICAgICAgIHRoaXMuX2Jhc2VNYXRyaXggPSBkZXZpY2UuZ2V0QmFzZVBvc2VNYXRyaXgoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc2V0IF9iYXNlTWF0cml4KG1hdHJpeCkgewogICAgICAgIHRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4ID0gbWF0cml4OwogICAgICAgIHRoaXNbUFJJVkFURSQyXS5pbnZlcnNlQmFzZU1hdHJpeCA9IG51bGw7CiAgICAgIH0KICAgICAgZ2V0IF9iYXNlTWF0cml4KCkgewogICAgICAgIGlmICghdGhpc1tQUklWQVRFJDJdLmJhc2VNYXRyaXgpIHsKICAgICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXgpIHsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDJdLmJhc2VNYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICAgICAgICAgICAgaW52ZXJ0KHRoaXNbUFJJVkFURSQyXS5iYXNlTWF0cml4LCB0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDJdLmJhc2VNYXRyaXg7CiAgICAgIH0KICAgICAgc2V0IF9pbnZlcnNlQmFzZU1hdHJpeChtYXRyaXgpIHsKICAgICAgICB0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXggPSBtYXRyaXg7CiAgICAgICAgdGhpc1tQUklWQVRFJDJdLmJhc2VNYXRyaXggPSBudWxsOwogICAgICB9CiAgICAgIGdldCBfaW52ZXJzZUJhc2VNYXRyaXgoKSB7CiAgICAgICAgaWYgKCF0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXgpIHsKICAgICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMl0uYmFzZU1hdHJpeCkgewogICAgICAgICAgICB0aGlzW1BSSVZBVEUkMl0uaW52ZXJzZUJhc2VNYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICAgICAgICAgICAgaW52ZXJ0KHRoaXNbUFJJVkFURSQyXS5pbnZlcnNlQmFzZU1hdHJpeCwgdGhpc1tQUklWQVRFJDJdLmJhc2VNYXRyaXgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDJdLmludmVyc2VCYXNlTWF0cml4OwogICAgICB9CiAgICAgIF9nZXRTcGFjZVJlbGF0aXZlVHJhbnNmb3JtKHNwYWNlKSB7CiAgICAgICAgaWYgKCF0aGlzLl9pbnZlcnNlQmFzZU1hdHJpeCB8fCAhc3BhY2UuX2Jhc2VNYXRyaXgpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBsZXQgb3V0ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgbXVsdGlwbHkob3V0LCB0aGlzLl9pbnZlcnNlQmFzZU1hdHJpeCwgc3BhY2UuX2Jhc2VNYXRyaXgpOwogICAgICAgIHJldHVybiBuZXcgWFJSaWdpZFRyYW5zZm9ybSQxKG91dCk7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBERUZBVUxUX0VNVUxBVElPTl9IRUlHSFQgPSAxLjY7CiAgICBjb25zdCBQUklWQVRFJDMgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJSZWZlcmVuY2VTcGFjZScpOwogICAgY29uc3QgWFJSZWZlcmVuY2VTcGFjZVR5cGVzID0gWwogICAgICAndmlld2VyJywKICAgICAgJ2xvY2FsJywKICAgICAgJ2xvY2FsLWZsb29yJywKICAgICAgJ2JvdW5kZWQtZmxvb3InLAogICAgICAndW5ib3VuZGVkJwogICAgXTsKICAgIGZ1bmN0aW9uIGlzRmxvb3IodHlwZSkgewogICAgICByZXR1cm4gdHlwZSA9PT0gJ2JvdW5kZWQtZmxvb3InIHx8IHR5cGUgPT09ICdsb2NhbC1mbG9vcic7CiAgICB9CiAgICBjbGFzcyBYUlJlZmVyZW5jZVNwYWNlIGV4dGVuZHMgWFJTcGFjZSB7CiAgICAgIGNvbnN0cnVjdG9yKHR5cGUsIHRyYW5zZm9ybSA9IG51bGwpIHsKICAgICAgICBpZiAoIVhSUmVmZXJlbmNlU3BhY2VUeXBlcy5pbmNsdWRlcyh0eXBlKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBYUlJlZmVyZW5jZVNwYWNlVHlwZSBtdXN0IGJlIG9uZSBvZiAke1hSUmVmZXJlbmNlU3BhY2VUeXBlc31gKTsKICAgICAgICB9CiAgICAgICAgc3VwZXIodHlwZSk7CiAgICAgICAgaWYgKHR5cGUgPT09ICdib3VuZGVkLWZsb29yJyAmJiAhdHJhbnNmb3JtKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFhSUmVmZXJlbmNlU3BhY2UgY2Fubm90IHVzZSAnYm91bmRlZC1mbG9vcicgdHlwZSBpZiB0aGUgcGxhdGZvcm0gZG9lcyBub3QgcHJvdmlkZSB0aGUgZmxvb3IgbGV2ZWxgKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzRmxvb3IodHlwZSkgJiYgIXRyYW5zZm9ybSkgewogICAgICAgICAgdHJhbnNmb3JtID0gaWRlbnRpdHkobmV3IEZsb2F0MzJBcnJheSgxNikpOwogICAgICAgICAgdHJhbnNmb3JtWzEzXSA9IERFRkFVTFRfRU1VTEFUSU9OX0hFSUdIVDsKICAgICAgICB9CiAgICAgICAgdGhpcy5faW52ZXJzZUJhc2VNYXRyaXggPSB0cmFuc2Zvcm0gfHwgaWRlbnRpdHkobmV3IEZsb2F0MzJBcnJheSgxNikpOwogICAgICAgIHRoaXNbUFJJVkFURSQzXSA9IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICB0cmFuc2Zvcm0sCiAgICAgICAgICBvcmlnaW5PZmZzZXQgOiBpZGVudGl0eShuZXcgRmxvYXQzMkFycmF5KDE2KSksCiAgICAgICAgfTsKICAgICAgfQogICAgICBfdHJhbnNmb3JtQmFzZVBvc2VNYXRyaXgob3V0LCBwb3NlKSB7CiAgICAgICAgbXVsdGlwbHkob3V0LCB0aGlzLl9pbnZlcnNlQmFzZU1hdHJpeCwgcG9zZSk7CiAgICAgIH0KICAgICAgX29yaWdpbk9mZnNldE1hdHJpeCgpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDNdLm9yaWdpbk9mZnNldDsKICAgICAgfQogICAgICBfYWRqdXN0Rm9yT3JpZ2luT2Zmc2V0KHRyYW5zZm9ybU1hdHJpeCkgewogICAgICAgIGxldCBpbnZlcnNlT3JpZ2luT2Zmc2V0TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgaW52ZXJ0KGludmVyc2VPcmlnaW5PZmZzZXRNYXRyaXgsIHRoaXNbUFJJVkFURSQzXS5vcmlnaW5PZmZzZXQpOwogICAgICAgIG11bHRpcGx5KHRyYW5zZm9ybU1hdHJpeCwgaW52ZXJzZU9yaWdpbk9mZnNldE1hdHJpeCwgdHJhbnNmb3JtTWF0cml4KTsKICAgICAgfQogICAgICBfZ2V0U3BhY2VSZWxhdGl2ZVRyYW5zZm9ybShzcGFjZSkgewogICAgICAgIGxldCB0cmFuc2Zvcm0gPSBzdXBlci5fZ2V0U3BhY2VSZWxhdGl2ZVRyYW5zZm9ybShzcGFjZSk7CiAgICAgICAgdGhpcy5fYWRqdXN0Rm9yT3JpZ2luT2Zmc2V0KHRyYW5zZm9ybS5tYXRyaXgpOwogICAgICAgIHJldHVybiBuZXcgWFJSaWdpZFRyYW5zZm9ybSh0cmFuc2Zvcm0ubWF0cml4KTsKICAgICAgfQogICAgICBnZXRPZmZzZXRSZWZlcmVuY2VTcGFjZShhZGRpdGlvbmFsT2Zmc2V0KSB7CiAgICAgICAgbGV0IG5ld1NwYWNlID0gbmV3IFhSUmVmZXJlbmNlU3BhY2UoCiAgICAgICAgICB0aGlzW1BSSVZBVEUkM10udHlwZSwKICAgICAgICAgIHRoaXNbUFJJVkFURSQzXS50cmFuc2Zvcm0sCiAgICAgICAgICB0aGlzW1BSSVZBVEUkM10uYm91bmRzKTsKICAgICAgICBtdWx0aXBseShuZXdTcGFjZVtQUklWQVRFJDNdLm9yaWdpbk9mZnNldCwgdGhpc1tQUklWQVRFJDNdLm9yaWdpbk9mZnNldCwgYWRkaXRpb25hbE9mZnNldC5tYXRyaXgpOwogICAgICAgIHJldHVybiBuZXdTcGFjZTsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkNCA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUicpOwogICAgY29uc3QgWFJTZXNzaW9uTW9kZXMgPSBbJ2lubGluZScsICdpbW1lcnNpdmUtdnInLCAnaW1tZXJzaXZlLWFyJ107CiAgICBjb25zdCBERUZBVUxUX1NFU1NJT05fT1BUSU9OUyA9IHsKICAgICAgJ2lubGluZSc6IHsKICAgICAgICByZXF1aXJlZEZlYXR1cmVzOiBbJ3ZpZXdlciddLAogICAgICAgIG9wdGlvbmFsRmVhdHVyZXM6IFtdLAogICAgICB9LAogICAgICAnaW1tZXJzaXZlLXZyJzogewogICAgICAgIHJlcXVpcmVkRmVhdHVyZXM6IFsndmlld2VyJywgJ2xvY2FsJ10sCiAgICAgICAgb3B0aW9uYWxGZWF0dXJlczogW10sCiAgICAgIH0sCiAgICAgICdpbW1lcnNpdmUtYXInOiB7CiAgICAgICAgcmVxdWlyZWRGZWF0dXJlczogWyd2aWV3ZXInLCAnbG9jYWwnXSwKICAgICAgICBvcHRpb25hbEZlYXR1cmVzOiBbXSwKICAgICAgfQogICAgfTsKICAgIGNvbnN0IFBPTFlGSUxMX1JFUVVFU1RfU0VTU0lPTl9FUlJPUiA9CmBQb2x5ZmlsbCBFcnJvcjogTXVzdCBjYWxsIG5hdmlnYXRvci54ci5pc1Nlc3Npb25TdXBwb3J0ZWQoKSB3aXRoIGFueSBYUlNlc3Npb25Nb2RlCm9yIG5hdmlnYXRvci54ci5yZXF1ZXN0U2Vzc2lvbignaW5saW5lJykgcHJpb3IgdG8gcmVxdWVzdGluZyBhbiBpbW1lcnNpdmUKc2Vzc2lvbi4gVGhpcyBpcyBhIGxpbWl0YXRpb24gc3BlY2lmaWMgdG8gdGhlIFdlYlhSIFBvbHlmaWxsIGFuZCBkb2VzIG5vdCBhcHBseQp0byBuYXRpdmUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSBBUEkuYCAgICA7CiAgICBjbGFzcyBYUlN5c3RlbSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgICAgY29uc3RydWN0b3IoZGV2aWNlUHJvbWlzZSkgewogICAgICAgIHN1cGVyKCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDRdID0gewogICAgICAgICAgZGV2aWNlOiBudWxsLAogICAgICAgICAgZGV2aWNlUHJvbWlzZSwKICAgICAgICAgIGltbWVyc2l2ZVNlc3Npb246IG51bGwsCiAgICAgICAgICBpbmxpbmVTZXNzaW9uczogbmV3IFNldCgpLAogICAgICAgIH07CiAgICAgICAgZGV2aWNlUHJvbWlzZS50aGVuKChkZXZpY2UpID0+IHsgdGhpc1tQUklWQVRFJDRdLmRldmljZSA9IGRldmljZTsgfSk7CiAgICAgIH0KICAgICAgYXN5bmMgaXNTZXNzaW9uU3VwcG9ydGVkKG1vZGUpIHsKICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQ0XS5kZXZpY2UpIHsKICAgICAgICAgIGF3YWl0IHRoaXNbUFJJVkFURSQ0XS5kZXZpY2VQcm9taXNlOwogICAgICAgIH0KICAgICAgICBpZiAobW9kZSAhPSAnaW5saW5lJykgewogICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzW1BSSVZBVEUkNF0uZGV2aWNlLmlzU2Vzc2lvblN1cHBvcnRlZChtb2RlKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodHJ1ZSk7CiAgICAgIH0KICAgICAgYXN5bmMgcmVxdWVzdFNlc3Npb24obW9kZSwgb3B0aW9ucykgewogICAgICAgIGlmICghdGhpc1tQUklWQVRFJDRdLmRldmljZSkgewogICAgICAgICAgaWYgKG1vZGUgIT0gJ2lubGluZScpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFBPTFlGSUxMX1JFUVVFU1RfU0VTU0lPTl9FUlJPUik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhd2FpdCB0aGlzW1BSSVZBVEUkNF0uZGV2aWNlUHJvbWlzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFYUlNlc3Npb25Nb2Rlcy5pbmNsdWRlcyhtb2RlKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigKICAgICAgICAgICAgICBgVGhlIHByb3ZpZGVkIHZhbHVlICcke21vZGV9JyBpcyBub3QgYSB2YWxpZCBlbnVtIHZhbHVlIG9mIHR5cGUgWFJTZXNzaW9uTW9kZWApOwogICAgICAgIH0KICAgICAgICBjb25zdCBkZWZhdWx0T3B0aW9ucyA9IERFRkFVTFRfU0VTU0lPTl9PUFRJT05TW21vZGVdOwogICAgICAgIGNvbnN0IHJlcXVpcmVkRmVhdHVyZXMgPSBkZWZhdWx0T3B0aW9ucy5yZXF1aXJlZEZlYXR1cmVzLmNvbmNhdCgKICAgICAgICAgICAgb3B0aW9ucyAmJiBvcHRpb25zLnJlcXVpcmVkRmVhdHVyZXMgPyBvcHRpb25zLnJlcXVpcmVkRmVhdHVyZXMgOiBbXSk7CiAgICAgICAgY29uc3Qgb3B0aW9uYWxGZWF0dXJlcyA9IGRlZmF1bHRPcHRpb25zLm9wdGlvbmFsRmVhdHVyZXMuY29uY2F0KAogICAgICAgICAgICBvcHRpb25zICYmIG9wdGlvbnMub3B0aW9uYWxGZWF0dXJlcyA/IG9wdGlvbnMub3B0aW9uYWxGZWF0dXJlcyA6IFtdKTsKICAgICAgICBjb25zdCBlbmFibGVkRmVhdHVyZXMgPSBuZXcgU2V0KCk7CiAgICAgICAgbGV0IHJlcXVpcmVtZW50c0ZhaWxlZCA9IGZhbHNlOwogICAgICAgIGZvciAobGV0IGZlYXR1cmUgb2YgcmVxdWlyZWRGZWF0dXJlcykgewogICAgICAgICAgaWYgKCF0aGlzW1BSSVZBVEUkNF0uZGV2aWNlLmlzRmVhdHVyZVN1cHBvcnRlZChmZWF0dXJlKSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBUaGUgcmVxdWlyZWQgZmVhdHVyZSAnJHtmZWF0dXJlfScgaXMgbm90IHN1cHBvcnRlZGApOwogICAgICAgICAgICByZXF1aXJlbWVudHNGYWlsZWQgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5hYmxlZEZlYXR1cmVzLmFkZChmZWF0dXJlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHJlcXVpcmVtZW50c0ZhaWxlZCkgewogICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbignU2Vzc2lvbiBkb2VzIG5vdCBzdXBwb3J0IHNvbWUgcmVxdWlyZWQgZmVhdHVyZXMnLCAnTm90U3VwcG9ydGVkRXJyb3InKTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgZmVhdHVyZSBvZiBvcHRpb25hbEZlYXR1cmVzKSB7CiAgICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQ0XS5kZXZpY2UuaXNGZWF0dXJlU3VwcG9ydGVkKGZlYXR1cmUpKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBUaGUgb3B0aW9uYWwgZmVhdHVyZSAnJHtmZWF0dXJlfScgaXMgbm90IHN1cHBvcnRlZGApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5hYmxlZEZlYXR1cmVzLmFkZChmZWF0dXJlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gYXdhaXQgdGhpc1tQUklWQVRFJDRdLmRldmljZS5yZXF1ZXN0U2Vzc2lvbihtb2RlLCBlbmFibGVkRmVhdHVyZXMpOwogICAgICAgIGNvbnN0IHNlc3Npb24gPSBuZXcgWFJTZXNzaW9uKHRoaXNbUFJJVkFURSQ0XS5kZXZpY2UsIG1vZGUsIHNlc3Npb25JZCk7CiAgICAgICAgaWYgKG1vZGUgPT0gJ2lubGluZScpIHsKICAgICAgICAgIHRoaXNbUFJJVkFURSQ0XS5pbmxpbmVTZXNzaW9ucy5hZGQoc2Vzc2lvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXNbUFJJVkFURSQ0XS5pbW1lcnNpdmVTZXNzaW9uID0gc2Vzc2lvbjsKICAgICAgICB9CiAgICAgICAgY29uc3Qgb25TZXNzaW9uRW5kID0gKCkgPT4gewogICAgICAgICAgaWYgKG1vZGUgPT0gJ2lubGluZScpIHsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDRdLmlubGluZVNlc3Npb25zLmRlbGV0ZShzZXNzaW9uKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQ0XS5pbW1lcnNpdmVTZXNzaW9uID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcignZW5kJywgb25TZXNzaW9uRW5kKTsKICAgICAgICB9OwogICAgICAgIHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcignZW5kJywgb25TZXNzaW9uRW5kKTsKICAgICAgICByZXR1cm4gc2Vzc2lvbjsKICAgICAgfQogICAgfQoKICAgIGxldCBub3c7CiAgICBpZiAoJ3BlcmZvcm1hbmNlJyBpbiBfZ2xvYmFsID09PSBmYWxzZSkgewogICAgICBsZXQgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTsKICAgICAgbm93ID0gKCkgPT4gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTsKICAgIH0gZWxzZSB7CiAgICAgIG5vdyA9ICgpID0+IHBlcmZvcm1hbmNlLm5vdygpOwogICAgfQogICAgdmFyIG5vdyQxID0gbm93OwoKICAgIGNvbnN0IFBSSVZBVEUkNSA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlBvc2UnKTsKICAgIGNsYXNzIFhSUG9zZSQxIHsKICAgICAgY29uc3RydWN0b3IodHJhbnNmb3JtLCBlbXVsYXRlZFBvc2l0aW9uKSB7CiAgICAgICAgdGhpc1tQUklWQVRFJDVdID0gewogICAgICAgICAgdHJhbnNmb3JtLAogICAgICAgICAgZW11bGF0ZWRQb3NpdGlvbiwKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCB0cmFuc2Zvcm0oKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkNV0udHJhbnNmb3JtOyB9CiAgICAgIGdldCBlbXVsYXRlZFBvc2l0aW9uKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDVdLmVtdWxhdGVkUG9zaXRpb247IH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDYgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvWFJWaWV3ZXJQb3NlJyk7CiAgICBjbGFzcyBYUlZpZXdlclBvc2UgZXh0ZW5kcyBYUlBvc2UkMSB7CiAgICAgIGNvbnN0cnVjdG9yKHRyYW5zZm9ybSwgdmlld3MsIGVtdWxhdGVkUG9zaXRpb24gPSBmYWxzZSkgewogICAgICAgIHN1cGVyKHRyYW5zZm9ybSwgZW11bGF0ZWRQb3NpdGlvbik7CiAgICAgICAgdGhpc1tQUklWQVRFJDZdID0gewogICAgICAgICAgdmlld3MKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCB2aWV3cygpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDZdLnZpZXdzOwogICAgICB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQ3ID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSVmlld3BvcnQnKTsKICAgIGNsYXNzIFhSVmlld3BvcnQgewogICAgICBjb25zdHJ1Y3Rvcih0YXJnZXQpIHsKICAgICAgICB0aGlzW1BSSVZBVEUkN10gPSB7IHRhcmdldCB9OwogICAgICB9CiAgICAgIGdldCB4KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDddLnRhcmdldC54OyB9CiAgICAgIGdldCB5KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDddLnRhcmdldC55OyB9CiAgICAgIGdldCB3aWR0aCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ3XS50YXJnZXQud2lkdGg7IH0KICAgICAgZ2V0IGhlaWdodCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQ3XS50YXJnZXQuaGVpZ2h0OyB9CiAgICB9CgogICAgY29uc3QgWFJFeWVzID0gWydsZWZ0JywgJ3JpZ2h0JywgJ25vbmUnXTsKICAgIGNvbnN0IFBSSVZBVEUkOCA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlZpZXcnKTsKICAgIGNsYXNzIFhSVmlldyB7CiAgICAgIGNvbnN0cnVjdG9yKGRldmljZSwgdHJhbnNmb3JtLCBleWUsIHNlc3Npb25JZCkgewogICAgICAgIGlmICghWFJFeWVzLmluY2x1ZGVzKGV5ZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgWFJFeWUgbXVzdCBiZSBvbmUgb2Y6ICR7WFJFeWVzfWApOwogICAgICAgIH0KICAgICAgICBjb25zdCB0ZW1wID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBjb25zdCB2aWV3cG9ydCA9IG5ldyBYUlZpZXdwb3J0KHRlbXApOwogICAgICAgIHRoaXNbUFJJVkFURSQ4XSA9IHsKICAgICAgICAgIGRldmljZSwKICAgICAgICAgIGV5ZSwKICAgICAgICAgIHZpZXdwb3J0LAogICAgICAgICAgdGVtcCwKICAgICAgICAgIHNlc3Npb25JZCwKICAgICAgICAgIHRyYW5zZm9ybSwKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCBleWUoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkOF0uZXllOyB9CiAgICAgIGdldCBwcm9qZWN0aW9uTWF0cml4KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDhdLmRldmljZS5nZXRQcm9qZWN0aW9uTWF0cml4KHRoaXMuZXllKTsgfQogICAgICBnZXQgdHJhbnNmb3JtKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDhdLnRyYW5zZm9ybTsgfQogICAgICBfZ2V0Vmlld3BvcnQobGF5ZXIpIHsKICAgICAgICBpZiAodGhpc1tQUklWQVRFJDhdLmRldmljZS5nZXRWaWV3cG9ydCh0aGlzW1BSSVZBVEUkOF0uc2Vzc2lvbklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZXllLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQ4XS50ZW1wKSkgewogICAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQ4XS52aWV3cG9ydDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IFBSSVZBVEUkOSA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUkZyYW1lJyk7CiAgICBjb25zdCBOT05fQUNUSVZFX01TRyA9ICJYUkZyYW1lIGFjY2VzcyBvdXRzaWRlIHRoZSBjYWxsYmFjayB0aGF0IHByb2R1Y2VkIGl0IGlzIGludmFsaWQuIjsKICAgIGNvbnN0IE5PTl9BTklNRlJBTUVfTVNHID0gImdldFZpZXdlclBvc2UgY2FuIG9ubHkgYmUgY2FsbGVkIG9uIFhSRnJhbWUgb2JqZWN0cyBwYXNzZWQgdG8gWFJTZXNzaW9uLnJlcXVlc3RBbmltYXRpb25GcmFtZSBjYWxsYmFja3MuIjsKICAgIGxldCBORVhUX0ZSQU1FX0lEID0gMDsKICAgIGNsYXNzIFhSRnJhbWUgewogICAgICBjb25zdHJ1Y3RvcihkZXZpY2UsIHNlc3Npb24sIHNlc3Npb25JZCkgewogICAgICAgIHRoaXNbUFJJVkFURSQ5XSA9IHsKICAgICAgICAgIGlkOiArK05FWFRfRlJBTUVfSUQsCiAgICAgICAgICBhY3RpdmU6IGZhbHNlLAogICAgICAgICAgYW5pbWF0aW9uRnJhbWU6IGZhbHNlLAogICAgICAgICAgZGV2aWNlLAogICAgICAgICAgc2Vzc2lvbiwKICAgICAgICAgIHNlc3Npb25JZAogICAgICAgIH07CiAgICAgIH0KICAgICAgZ2V0IHNlc3Npb24oKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkOV0uc2Vzc2lvbjsgfQogICAgICBnZXRWaWV3ZXJQb3NlKHJlZmVyZW5jZVNwYWNlKSB7CiAgICAgICAgaWYgKCF0aGlzW1BSSVZBVEUkOV0uYW5pbWF0aW9uRnJhbWUpIHsKICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oTk9OX0FOSU1GUkFNRV9NU0csICdJbnZhbGlkU3RhdGVFcnJvcicpOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXNbUFJJVkFURSQ5XS5hY3RpdmUpIHsKICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oTk9OX0FDVElWRV9NU0csICdJbnZhbGlkU3RhdGVFcnJvcicpOwogICAgICAgIH0KICAgICAgICBjb25zdCBkZXZpY2UgPSB0aGlzW1BSSVZBVEUkOV0uZGV2aWNlOwogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzW1BSSVZBVEUkOV0uc2Vzc2lvbjsKICAgICAgICBzZXNzaW9uW1BSSVZBVEUkMTVdLnZpZXdlclNwYWNlLl9lbnN1cmVQb3NlVXBkYXRlZChkZXZpY2UsIHRoaXNbUFJJVkFURSQ5XS5pZCk7CiAgICAgICAgcmVmZXJlbmNlU3BhY2UuX2Vuc3VyZVBvc2VVcGRhdGVkKGRldmljZSwgdGhpc1tQUklWQVRFJDldLmlkKTsKICAgICAgICBsZXQgdmlld2VyVHJhbnNmb3JtID0gcmVmZXJlbmNlU3BhY2UuX2dldFNwYWNlUmVsYXRpdmVUcmFuc2Zvcm0oc2Vzc2lvbltQUklWQVRFJDE1XS52aWV3ZXJTcGFjZSk7CiAgICAgICAgY29uc3Qgdmlld3MgPSBbXTsKICAgICAgICBmb3IgKGxldCB2aWV3U3BhY2Ugb2Ygc2Vzc2lvbltQUklWQVRFJDE1XS52aWV3U3BhY2VzKSB7CiAgICAgICAgICB2aWV3U3BhY2UuX2Vuc3VyZVBvc2VVcGRhdGVkKGRldmljZSwgdGhpc1tQUklWQVRFJDldLmlkKTsKICAgICAgICAgIGxldCB2aWV3VHJhbnNmb3JtID0gcmVmZXJlbmNlU3BhY2UuX2dldFNwYWNlUmVsYXRpdmVUcmFuc2Zvcm0odmlld1NwYWNlKTsKICAgICAgICAgIGxldCB2aWV3ID0gbmV3IFhSVmlldyhkZXZpY2UsIHZpZXdUcmFuc2Zvcm0sIHZpZXdTcGFjZS5leWUsIHRoaXNbUFJJVkFURSQ5XS5zZXNzaW9uSWQpOwogICAgICAgICAgdmlld3MucHVzaCh2aWV3KTsKICAgICAgICB9CiAgICAgICAgbGV0IHZpZXdlclBvc2UgPSBuZXcgWFJWaWV3ZXJQb3NlKHZpZXdlclRyYW5zZm9ybSwgdmlld3MsIGZhbHNlICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgIHJldHVybiB2aWV3ZXJQb3NlOwogICAgICB9CiAgICAgIGdldFBvc2Uoc3BhY2UsIGJhc2VTcGFjZSkgewogICAgICAgIGlmICghdGhpc1tQUklWQVRFJDldLmFjdGl2ZSkgewogICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihOT05fQUNUSVZFX01TRywgJ0ludmFsaWRTdGF0ZUVycm9yJyk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXNbUFJJVkFURSQ5XS5kZXZpY2U7CiAgICAgICAgaWYgKHNwYWNlLl9zcGVjaWFsVHlwZSA9PT0gInRhcmdldC1yYXkiIHx8IHNwYWNlLl9zcGVjaWFsVHlwZSA9PT0gImdyaXAiKSB7CiAgICAgICAgICByZXR1cm4gZGV2aWNlLmdldElucHV0UG9zZSgKICAgICAgICAgICAgc3BhY2UuX2lucHV0U291cmNlLCBiYXNlU3BhY2UsIHNwYWNlLl9zcGVjaWFsVHlwZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNwYWNlLl9lbnN1cmVQb3NlVXBkYXRlZChkZXZpY2UsIHRoaXNbUFJJVkFURSQ5XS5pZCk7CiAgICAgICAgICBiYXNlU3BhY2UuX2Vuc3VyZVBvc2VVcGRhdGVkKGRldmljZSwgdGhpc1tQUklWQVRFJDldLmlkKTsKICAgICAgICAgIGxldCB0cmFuc2Zvcm0gPSBiYXNlU3BhY2UuX2dldFNwYWNlUmVsYXRpdmVUcmFuc2Zvcm0oc3BhY2UpOwogICAgICAgICAgaWYgKCF0cmFuc2Zvcm0pIHsgcmV0dXJuIG51bGw7IH0KICAgICAgICAgIHJldHVybiBuZXcgWFJQb3NlKHRyYW5zZm9ybSwgZmFsc2UgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxMCA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlJlbmRlclN0YXRlJyk7CiAgICBjb25zdCBYUlJlbmRlclN0YXRlSW5pdCA9IE9iamVjdC5mcmVlemUoewogICAgICBkZXB0aE5lYXI6IDAuMSwKICAgICAgZGVwdGhGYXI6IDEwMDAuMCwKICAgICAgaW5saW5lVmVydGljYWxGaWVsZE9mVmlldzogbnVsbCwKICAgICAgYmFzZUxheWVyOiBudWxsCiAgICB9KTsKICAgIGNsYXNzIFhSUmVuZGVyU3RhdGUgewogICAgICBjb25zdHJ1Y3RvcihzdGF0ZUluaXQgPSB7fSkgewogICAgICAgIGNvbnN0IGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIFhSUmVuZGVyU3RhdGVJbml0LCBzdGF0ZUluaXQpOwogICAgICAgIHRoaXNbUFJJVkFURSQxMF0gPSB7IGNvbmZpZyB9OwogICAgICB9CiAgICAgIGdldCBkZXB0aE5lYXIoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTBdLmNvbmZpZy5kZXB0aE5lYXI7IH0KICAgICAgZ2V0IGRlcHRoRmFyKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDEwXS5jb25maWcuZGVwdGhGYXI7IH0KICAgICAgZ2V0IGlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTBdLmNvbmZpZy5pbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3OyB9CiAgICAgIGdldCBiYXNlTGF5ZXIoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTBdLmNvbmZpZy5iYXNlTGF5ZXI7IH0KICAgIH0KCiAgICBjb25zdCBQT0xZRklMTEVEX1hSX0NPTVBBVElCTEUgPSBTeW1ib2woJ0BAd2VieHItcG9seWZpbGwvcG9seWZpbGxlZC14ci1jb21wYXRpYmxlJyk7CiAgICBjb25zdCBYUl9DT01QQVRJQkxFID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL3hyLWNvbXBhdGlibGUnKTsKCiAgICBjb25zdCBQUklWQVRFJDExID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSV2ViR0xMYXllcicpOwogICAgY29uc3QgWFJXZWJHTExheWVySW5pdCA9IE9iamVjdC5mcmVlemUoewogICAgICBhbnRpYWxpYXM6IHRydWUsCiAgICAgIGRlcHRoOiBmYWxzZSwKICAgICAgc3RlbmNpbDogZmFsc2UsCiAgICAgIGFscGhhOiB0cnVlLAogICAgICBtdWx0aXZpZXc6IGZhbHNlLAogICAgICBpZ25vcmVEZXB0aFZhbHVlczogZmFsc2UsCiAgICAgIGZyYW1lYnVmZmVyU2NhbGVGYWN0b3I6IDEuMCwKICAgIH0pOwogICAgbGV0IFhSV2ViR0xMYXllciQxID0gY2xhc3MgWFJXZWJHTExheWVyIHsKICAgICAgY29uc3RydWN0b3Ioc2Vzc2lvbiwgY29udGV4dCwgbGF5ZXJJbml0PXt9KSB7CiAgICAgICAgY29uc3QgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgWFJXZWJHTExheWVySW5pdCwgbGF5ZXJJbml0KTsKICAgICAgICBpZiAoIShzZXNzaW9uIGluc3RhbmNlb2YgWFJTZXNzaW9uJDEpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3Nlc3Npb24gbXVzdCBiZSBhIFhSU2Vzc2lvbicpOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvbi5lbmRlZCkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkU3RhdGVFcnJvcmApOwogICAgICAgIH0KICAgICAgICBpZiAoY29udGV4dFtQT0xZRklMTEVEX1hSX0NPTVBBVElCTEVdKSB7CiAgICAgICAgICBpZiAoY29udGV4dFtYUl9DT01QQVRJQkxFXSAhPT0gdHJ1ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWRTdGF0ZUVycm9yYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZyYW1lYnVmZmVyID0gY29udGV4dC5nZXRQYXJhbWV0ZXIoY29udGV4dC5GUkFNRUJVRkZFUl9CSU5ESU5HKTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTFdID0gewogICAgICAgICAgY29udGV4dCwKICAgICAgICAgIGNvbmZpZywKICAgICAgICAgIGZyYW1lYnVmZmVyLAogICAgICAgICAgc2Vzc2lvbiwKICAgICAgICB9OwogICAgICB9CiAgICAgIGdldCBjb250ZXh0KCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDExXS5jb250ZXh0OyB9CiAgICAgIGdldCBhbnRpYWxpYXMoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTFdLmNvbmZpZy5hbnRpYWxpYXM7IH0KICAgICAgZ2V0IGlnbm9yZURlcHRoVmFsdWVzKCkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICBnZXQgZnJhbWVidWZmZXIoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTFdLmZyYW1lYnVmZmVyOyB9CiAgICAgIGdldCBmcmFtZWJ1ZmZlcldpZHRoKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDExXS5jb250ZXh0LmRyYXdpbmdCdWZmZXJXaWR0aDsgfQogICAgICBnZXQgZnJhbWVidWZmZXJIZWlnaHQoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTFdLmNvbnRleHQuZHJhd2luZ0J1ZmZlckhlaWdodDsgfQogICAgICBnZXQgX3Nlc3Npb24oKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTFdLnNlc3Npb247IH0KICAgICAgZ2V0Vmlld3BvcnQodmlldykgewogICAgICAgIHJldHVybiB2aWV3Ll9nZXRWaWV3cG9ydCh0aGlzKTsKICAgICAgfQogICAgICBzdGF0aWMgZ2V0TmF0aXZlRnJhbWVidWZmZXJTY2FsZUZhY3RvcihzZXNzaW9uKSB7CiAgICAgICAgaWYgKCFzZXNzaW9uKSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdnZXROYXRpdmVGcmFtZWJ1ZmZlclNjYWxlRmFjdG9yIG11c3QgYmUgcGFzc2VkIGEgc2Vzc2lvbi4nKQogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvbltQUklWQVRFJDE1XS5lbmRlZCkgeyByZXR1cm4gMC4wOyB9CiAgICAgICAgcmV0dXJuIDEuMDsKICAgICAgfQogICAgfTsKCiAgICBjb25zdCBQUklWQVRFJDEyID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSSW5wdXRTb3VyY2VFdmVudCcpOwogICAgY2xhc3MgWFJJbnB1dFNvdXJjZUV2ZW50IGV4dGVuZHMgRXZlbnQgewogICAgICBjb25zdHJ1Y3Rvcih0eXBlLCBldmVudEluaXREaWN0KSB7CiAgICAgICAgc3VwZXIodHlwZSwgZXZlbnRJbml0RGljdCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDEyXSA9IHsKICAgICAgICAgIGZyYW1lOiBldmVudEluaXREaWN0LmZyYW1lLAogICAgICAgICAgaW5wdXRTb3VyY2U6IGV2ZW50SW5pdERpY3QuaW5wdXRTb3VyY2UKICAgICAgICB9OwogICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBYUklucHV0U291cmNlRXZlbnQucHJvdG90eXBlKTsKICAgICAgfQogICAgICBnZXQgZnJhbWUoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTJdLmZyYW1lOyB9CiAgICAgIGdldCBpbnB1dFNvdXJjZSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxMl0uaW5wdXRTb3VyY2U7IH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDEzID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSU2Vzc2lvbkV2ZW50Jyk7CiAgICBjbGFzcyBYUlNlc3Npb25FdmVudCBleHRlbmRzIEV2ZW50IHsKICAgICAgY29uc3RydWN0b3IodHlwZSwgZXZlbnRJbml0RGljdCkgewogICAgICAgIHN1cGVyKHR5cGUsIGV2ZW50SW5pdERpY3QpOwogICAgICAgIHRoaXNbUFJJVkFURSQxM10gPSB7CiAgICAgICAgICBzZXNzaW9uOiBldmVudEluaXREaWN0LnNlc3Npb24KICAgICAgICB9OwogICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLCBYUlNlc3Npb25FdmVudC5wcm90b3R5cGUpOwogICAgICB9CiAgICAgIGdldCBzZXNzaW9uKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDEzXS5zZXNzaW9uOyB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxNCA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUklucHV0U291cmNlc0NoYW5nZUV2ZW50Jyk7CiAgICBjbGFzcyBYUklucHV0U291cmNlc0NoYW5nZUV2ZW50IGV4dGVuZHMgRXZlbnQgewogICAgICBjb25zdHJ1Y3Rvcih0eXBlLCBldmVudEluaXREaWN0KSB7CiAgICAgICAgc3VwZXIodHlwZSwgZXZlbnRJbml0RGljdCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDE0XSA9IHsKICAgICAgICAgIHNlc3Npb246IGV2ZW50SW5pdERpY3Quc2Vzc2lvbiwKICAgICAgICAgIGFkZGVkOiBldmVudEluaXREaWN0LmFkZGVkLAogICAgICAgICAgcmVtb3ZlZDogZXZlbnRJbml0RGljdC5yZW1vdmVkCiAgICAgICAgfTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgWFJJbnB1dFNvdXJjZXNDaGFuZ2VFdmVudC5wcm90b3R5cGUpOwogICAgICB9CiAgICAgIGdldCBzZXNzaW9uKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE0XS5zZXNzaW9uOyB9CiAgICAgIGdldCBhZGRlZCgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxNF0uYWRkZWQ7IH0KICAgICAgZ2V0IHJlbW92ZWQoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTRdLnJlbW92ZWQ7IH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDE1ID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSU2Vzc2lvbicpOwogICAgY2xhc3MgWFJWaWV3U3BhY2UgZXh0ZW5kcyBYUlNwYWNlIHsKICAgICAgY29uc3RydWN0b3IoZXllKSB7CiAgICAgICAgc3VwZXIoZXllKTsKICAgICAgfQogICAgICBnZXQgZXllKCkgewogICAgICAgIHJldHVybiB0aGlzLl9zcGVjaWFsVHlwZTsKICAgICAgfQogICAgICBfb25Qb3NlVXBkYXRlKGRldmljZSkgewogICAgICAgIHRoaXMuX2ludmVyc2VCYXNlTWF0cml4ID0gZGV2aWNlLmdldEJhc2VWaWV3TWF0cml4KHRoaXMuX3NwZWNpYWxUeXBlKTsKICAgICAgfQogICAgfQogICAgY2xhc3MgWFJTZXNzaW9uJDEgZXh0ZW5kcyBFdmVudFRhcmdldCB7CiAgICAgIGNvbnN0cnVjdG9yKGRldmljZSwgbW9kZSwgaWQpIHsKICAgICAgICBzdXBlcigpOwogICAgICAgIGxldCBpbW1lcnNpdmUgPSBtb2RlICE9ICdpbmxpbmUnOwogICAgICAgIGxldCBpbml0aWFsUmVuZGVyU3RhdGUgPSBuZXcgWFJSZW5kZXJTdGF0ZSh7CiAgICAgICAgICBpbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3OiBpbW1lcnNpdmUgPyBudWxsIDogTWF0aC5QSSAqIDAuNQogICAgICAgIH0pOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0gPSB7CiAgICAgICAgICBkZXZpY2UsCiAgICAgICAgICBtb2RlLAogICAgICAgICAgaW1tZXJzaXZlLAogICAgICAgICAgZW5kZWQ6IGZhbHNlLAogICAgICAgICAgc3VzcGVuZGVkOiBmYWxzZSwKICAgICAgICAgIGZyYW1lQ2FsbGJhY2tzOiBbXSwKICAgICAgICAgIGN1cnJlbnRGcmFtZUNhbGxiYWNrczogbnVsbCwKICAgICAgICAgIGZyYW1lSGFuZGxlOiAwLAogICAgICAgICAgZGV2aWNlRnJhbWVIYW5kbGU6IG51bGwsCiAgICAgICAgICBpZCwKICAgICAgICAgIGFjdGl2ZVJlbmRlclN0YXRlOiBpbml0aWFsUmVuZGVyU3RhdGUsCiAgICAgICAgICBwZW5kaW5nUmVuZGVyU3RhdGU6IG51bGwsCiAgICAgICAgICB2aWV3ZXJTcGFjZTogbmV3IFhSUmVmZXJlbmNlU3BhY2UoInZpZXdlciIpLAogICAgICAgICAgdmlld1NwYWNlczogW10sCiAgICAgICAgICBjdXJyZW50SW5wdXRTb3VyY2VzOiBbXQogICAgICAgIH07CiAgICAgICAgaWYgKGltbWVyc2l2ZSkgewogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS52aWV3U3BhY2VzLnB1c2gobmV3IFhSVmlld1NwYWNlKCdsZWZ0JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgWFJWaWV3U3BhY2UoJ3JpZ2h0JykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnZpZXdTcGFjZXMucHVzaChuZXcgWFJWaWV3U3BhY2UoJ25vbmUnKSk7CiAgICAgICAgfQogICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25EZXZpY2VGcmFtZSA9ICgpID0+IHsKICAgICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLmVuZGVkIHx8IHRoaXNbUFJJVkFURSQxNV0uc3VzcGVuZGVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlRnJhbWVIYW5kbGUgPSBudWxsOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5zdGFydERldmljZUZyYW1lTG9vcCgpOwogICAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0ucGVuZGluZ1JlbmRlclN0YXRlICE9PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uYWN0aXZlUmVuZGVyU3RhdGUgPSBuZXcgWFJSZW5kZXJTdGF0ZSh0aGlzW1BSSVZBVEUkMTVdLnBlbmRpbmdSZW5kZXJTdGF0ZSk7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0ucGVuZGluZ1JlbmRlclN0YXRlID0gbnVsbDsKICAgICAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uYWN0aXZlUmVuZGVyU3RhdGUuYmFzZUxheWVyKSB7CiAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kZXZpY2Uub25CYXNlTGF5ZXJTZXQoCiAgICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmlkLAogICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5hY3RpdmVSZW5kZXJTdGF0ZS5iYXNlTGF5ZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpc1tQUklWQVRFJDE1XS5hY3RpdmVSZW5kZXJTdGF0ZS5iYXNlTGF5ZXIgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZnJhbWUgPSBuZXcgWFJGcmFtZShkZXZpY2UsIHRoaXMsIHRoaXNbUFJJVkFURSQxNV0uaWQpOwogICAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gdGhpc1tQUklWQVRFJDE1XS5jdXJyZW50RnJhbWVDYWxsYmFja3MgPSB0aGlzW1BSSVZBVEUkMTVdLmZyYW1lQ2FsbGJhY2tzOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5mcmFtZUNhbGxiYWNrcyA9IFtdOwogICAgICAgICAgZnJhbWVbUFJJVkFURSQ5XS5hY3RpdmUgPSB0cnVlOwogICAgICAgICAgZnJhbWVbUFJJVkFURSQ5XS5hbmltYXRpb25GcmFtZSA9IHRydWU7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5vbkZyYW1lU3RhcnQodGhpc1tQUklWQVRFJDE1XS5pZCwgdGhpc1tQUklWQVRFJDE1XS5hY3RpdmVSZW5kZXJTdGF0ZSk7CiAgICAgICAgICB0aGlzLl9jaGVja0lucHV0U291cmNlc0NoYW5nZSgpOwogICAgICAgICAgY29uc3QgcmlnaHROb3cgPSBub3ckMSgpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoIWNhbGxiYWNrc1tpXS5jYW5jZWxsZWQgJiYgdHlwZW9mIGNhbGxiYWNrc1tpXS5jYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgY2FsbGJhY2tzW2ldLmNhbGxiYWNrKHJpZ2h0Tm93LCBmcmFtZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoKGVycikgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5jdXJyZW50RnJhbWVDYWxsYmFja3MgPSBudWxsOwogICAgICAgICAgZnJhbWVbUFJJVkFURSQ5XS5hY3RpdmUgPSBmYWxzZTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLm9uRnJhbWVFbmQodGhpc1tQUklWQVRFJDE1XS5pZCk7CiAgICAgICAgfTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnN0YXJ0RGV2aWNlRnJhbWVMb29wID0gKCkgPT4gewogICAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlRnJhbWVIYW5kbGUgPT09IG51bGwpIHsKICAgICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kZXZpY2VGcmFtZUhhbmRsZSA9IHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLnJlcXVlc3RBbmltYXRpb25GcmFtZSgKICAgICAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uRGV2aWNlRnJhbWUKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3RvcERldmljZUZyYW1lTG9vcCA9ICgpID0+IHsKICAgICAgICAgIGNvbnN0IGhhbmRsZSA9IHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlRnJhbWVIYW5kbGU7CiAgICAgICAgICBpZiAoaGFuZGxlICE9PSBudWxsKSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLmNhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZSk7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlRnJhbWVIYW5kbGUgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvbkVuZCA9IHNlc3Npb25JZCA9PiB7CiAgICAgICAgICBpZiAoc2Vzc2lvbklkICE9PSB0aGlzW1BSSVZBVEUkMTVdLmlkKSB7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3VzcGVuZGVkID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3RhcnREZXZpY2VGcmFtZUxvb3AoKTsKICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdmb2N1cycsIHsgc2Vzc2lvbjogdGhpcyB9KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5lbmRlZCA9IHRydWU7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLnN0b3BEZXZpY2VGcmFtZUxvb3AoKTsKICAgICAgICAgIGRldmljZS5yZW1vdmVFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL3ZyLXByZXNlbnQtZW5kJywgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvbkVuZCk7CiAgICAgICAgICBkZXZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC92ci1wcmVzZW50LXN0YXJ0JywgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvblN0YXJ0KTsKICAgICAgICAgIGRldmljZS5yZW1vdmVFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNlbGVjdC1zdGFydCcsIHRoaXNbUFJJVkFURSQxNV0ub25TZWxlY3RTdGFydCk7CiAgICAgICAgICBkZXZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3QtZW5kJywgdGhpc1tQUklWQVRFJDE1XS5vblNlbGVjdEVuZCk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ2VuZCcsIG5ldyBYUlNlc3Npb25FdmVudCgnZW5kJywgeyBzZXNzaW9uOiB0aGlzIH0pKTsKICAgICAgICB9OwogICAgICAgIGRldmljZS5hZGRFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL3ZyLXByZXNlbnQtZW5kJywgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvbkVuZCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvblN0YXJ0ID0gc2Vzc2lvbklkID0+IHsKICAgICAgICAgIGlmIChzZXNzaW9uSWQgPT09IHRoaXNbUFJJVkFURSQxNV0uaWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5zdXNwZW5kZWQgPSB0cnVlOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5zdG9wRGV2aWNlRnJhbWVMb29wKCk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ2JsdXInLCB7IHNlc3Npb246IHRoaXMgfSk7CiAgICAgICAgfTsKICAgICAgICBkZXZpY2UuYWRkRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC92ci1wcmVzZW50LXN0YXJ0JywgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvblN0YXJ0KTsKICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0U3RhcnQgPSBldnQgPT4gewogICAgICAgICAgaWYgKGV2dC5zZXNzaW9uSWQgIT09IHRoaXNbUFJJVkFURSQxNV0uaWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kaXNwYXRjaElucHV0U291cmNlRXZlbnQoJ3NlbGVjdHN0YXJ0JywgIGV2dC5pbnB1dFNvdXJjZSk7CiAgICAgICAgfTsKICAgICAgICBkZXZpY2UuYWRkRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3Qtc3RhcnQnLCB0aGlzW1BSSVZBVEUkMTVdLm9uU2VsZWN0U3RhcnQpOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25TZWxlY3RFbmQgPSBldnQgPT4gewogICAgICAgICAgaWYgKGV2dC5zZXNzaW9uSWQgIT09IHRoaXNbUFJJVkFURSQxNV0uaWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kaXNwYXRjaElucHV0U291cmNlRXZlbnQoJ3NlbGVjdGVuZCcsICBldnQuaW5wdXRTb3VyY2UpOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kaXNwYXRjaElucHV0U291cmNlRXZlbnQoJ3NlbGVjdCcsICBldnQuaW5wdXRTb3VyY2UpOwogICAgICAgIH07CiAgICAgICAgZGV2aWNlLmFkZEV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc2VsZWN0LWVuZCcsIHRoaXNbUFJJVkFURSQxNV0ub25TZWxlY3RFbmQpOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25TcXVlZXplU3RhcnQgPSBldnQgPT4gewogICAgICAgICAgaWYgKGV2dC5zZXNzaW9uSWQgIT09IHRoaXNbUFJJVkFURSQxNV0uaWQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kaXNwYXRjaElucHV0U291cmNlRXZlbnQoJ3NxdWVlemVzdGFydCcsICBldnQuaW5wdXRTb3VyY2UpOwogICAgICAgIH07CiAgICAgICAgZGV2aWNlLmFkZEV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc3F1ZWV6ZS1zdGFydCcsIHRoaXNbUFJJVkFURSQxNV0ub25TcXVlZXplU3RhcnQpOwogICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25TcXVlZXplRW5kID0gZXZ0ID0+IHsKICAgICAgICAgIGlmIChldnQuc2Vzc2lvbklkICE9PSB0aGlzW1BSSVZBVEUkMTVdLmlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGlzcGF0Y2hJbnB1dFNvdXJjZUV2ZW50KCdzcXVlZXplZW5kJywgIGV2dC5pbnB1dFNvdXJjZSk7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRpc3BhdGNoSW5wdXRTb3VyY2VFdmVudCgnc3F1ZWV6ZScsICBldnQuaW5wdXRTb3VyY2UpOwogICAgICAgIH07CiAgICAgICAgZGV2aWNlLmFkZEV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc3F1ZWV6ZS1lbmQnLCB0aGlzW1BSSVZBVEUkMTVdLm9uU3F1ZWV6ZUVuZCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kaXNwYXRjaElucHV0U291cmNlRXZlbnQgPSAodHlwZSwgaW5wdXRTb3VyY2UpID0+IHsKICAgICAgICAgIGNvbnN0IGZyYW1lID0gbmV3IFhSRnJhbWUoZGV2aWNlLCB0aGlzLCB0aGlzW1BSSVZBVEUkMTVdLmlkKTsKICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IFhSSW5wdXRTb3VyY2VFdmVudCh0eXBlLCB7IGZyYW1lLCBpbnB1dFNvdXJjZSB9KTsKICAgICAgICAgIGZyYW1lW1BSSVZBVEUkOV0uYWN0aXZlID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh0eXBlLCBldmVudCk7CiAgICAgICAgICBmcmFtZVtQUklWQVRFJDldLmFjdGl2ZSA9IGZhbHNlOwogICAgICAgIH07CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5zdGFydERldmljZUZyYW1lTG9vcCgpOwogICAgICAgIHRoaXMub25ibHVyID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMub25mb2N1cyA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm9ucmVzZXRwb3NlID0gdW5kZWZpbmVkOwogICAgICAgIHRoaXMub25lbmQgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5vbnNlbGVjdCA9IHVuZGVmaW5lZDsKICAgICAgICB0aGlzLm9uc2VsZWN0c3RhcnQgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5vbnNlbGVjdGVuZCA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgICBnZXQgcmVuZGVyU3RhdGUoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTVdLmFjdGl2ZVJlbmRlclN0YXRlOyB9CiAgICAgIGdldCBlbnZpcm9ubWVudEJsZW5kTW9kZSgpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE1XS5kZXZpY2UuZW52aXJvbm1lbnRCbGVuZE1vZGUgfHwgJ29wYXF1ZSc7CiAgICAgIH0KICAgICAgYXN5bmMgcmVxdWVzdFJlZmVyZW5jZVNwYWNlKHR5cGUpIHsKICAgICAgICBpZiAodGhpc1tQUklWQVRFJDE1XS5lbmRlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoIVhSUmVmZXJlbmNlU3BhY2VUeXBlcy5pbmNsdWRlcyh0eXBlKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgWFJSZWZlcmVuY2VTcGFjZVR5cGUgbXVzdCBiZSBvbmUgb2YgJHtYUlJlZmVyZW5jZVNwYWNlVHlwZXN9YCk7CiAgICAgICAgfQogICAgICAgIGlmICghdGhpc1tQUklWQVRFJDE1XS5kZXZpY2UuZG9lc1Nlc3Npb25TdXBwb3J0UmVmZXJlbmNlU3BhY2UodGhpc1tQUklWQVRFJDE1XS5pZCwgdHlwZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oYFRoZSAke3R5cGV9IHJlZmVyZW5jZSBzcGFjZSBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgc2Vzc2lvbi5gLCAnTm90U3VwcG9ydGVkRXJyb3InKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGUgPT09ICd2aWV3ZXInKSB7CiAgICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE1XS52aWV3ZXJTcGFjZTsKICAgICAgICB9CiAgICAgICAgbGV0IHRyYW5zZm9ybSA9IGF3YWl0IHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLnJlcXVlc3RGcmFtZU9mUmVmZXJlbmNlVHJhbnNmb3JtKHR5cGUpOwogICAgICAgIGlmICh0eXBlID09PSAnYm91bmRlZC1mbG9vcicpIHsKICAgICAgICAgIGlmICghdHJhbnNmb3JtKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oYCR7dHlwZX0gWFJSZWZlcmVuY2VTcGFjZSBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgZGV2aWNlLmAsICdOb3RTdXBwb3J0ZWRFcnJvcicpOwogICAgICAgICAgfQogICAgICAgICAgbGV0IGJvdW5kcyA9IHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLnJlcXVlc3RTdGFnZUJvdW5kcygpOwogICAgICAgICAgaWYgKCFib3VuZHMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihgJHt0eXBlfSBYUlJlZmVyZW5jZVNwYWNlIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBkZXZpY2UuYCwgJ05vdFN1cHBvcnRlZEVycm9yJyk7CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKGBUaGUgV2ViWFIgcG9seWZpbGwgZG9lcyBub3Qgc3VwcG9ydCB0aGUgJHt0eXBlfSByZWZlcmVuY2Ugc3BhY2UgeWV0LmAsICdOb3RTdXBwb3J0ZWRFcnJvcicpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IFhSUmVmZXJlbmNlU3BhY2UodHlwZSwgdHJhbnNmb3JtKTsKICAgICAgfQogICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2FsbGJhY2spIHsKICAgICAgICBpZiAodGhpc1tQUklWQVRFJDE1XS5lbmRlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBoYW5kbGUgPSArK3RoaXNbUFJJVkFURSQxNV0uZnJhbWVIYW5kbGU7CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5mcmFtZUNhbGxiYWNrcy5wdXNoKHsKICAgICAgICAgIGhhbmRsZSwKICAgICAgICAgIGNhbGxiYWNrLAogICAgICAgICAgY2FuY2VsbGVkOiBmYWxzZQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBoYW5kbGU7CiAgICAgIH0KICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoaGFuZGxlKSB7CiAgICAgICAgbGV0IGNhbGxiYWNrcyA9IHRoaXNbUFJJVkFURSQxNV0uZnJhbWVDYWxsYmFja3M7CiAgICAgICAgbGV0IGluZGV4ID0gY2FsbGJhY2tzLmZpbmRJbmRleChkID0+IGQgJiYgZC5oYW5kbGUgPT09IGhhbmRsZSk7CiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgIGNhbGxiYWNrc1tpbmRleF0uY2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICAgIGNhbGxiYWNrcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KICAgICAgICBjYWxsYmFja3MgPSB0aGlzW1BSSVZBVEUkMTVdLmN1cnJlbnRGcmFtZUNhbGxiYWNrczsKICAgICAgICBpZiAoY2FsbGJhY2tzKSB7CiAgICAgICAgICBpbmRleCA9IGNhbGxiYWNrcy5maW5kSW5kZXgoZCA9PiBkICYmIGQuaGFuZGxlID09PSBoYW5kbGUpOwogICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgY2FsbGJhY2tzW2luZGV4XS5jYW5jZWxsZWQgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBnZXQgaW5wdXRTb3VyY2VzKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5nZXRJbnB1dFNvdXJjZXMoKTsKICAgICAgfQogICAgICBhc3luYyBlbmQoKSB7CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uZW5kZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uaW1tZXJzaXZlKSB7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmVuZGVkID0gdHJ1ZTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvdnItcHJlc2VudC1zdGFydCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5vblByZXNlbnRhdGlvblN0YXJ0KTsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uZGV2aWNlLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ0BAd2VieHItcG9seWZpbGwvdnItcHJlc2VudC1lbmQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25QcmVzZW50YXRpb25FbmQpOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5kZXZpY2UucmVtb3ZlRXZlbnRMaXN0ZW5lcignQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3Qtc3RhcnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25TZWxlY3RTdGFydCk7CiAgICAgICAgICB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5yZW1vdmVFdmVudExpc3RlbmVyKCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNlbGVjdC1lbmQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0ub25TZWxlY3RFbmQpOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdlbmQnLCBuZXcgWFJTZXNzaW9uRXZlbnQoJ2VuZCcsIHsgc2Vzc2lvbjogdGhpcyB9KSk7CiAgICAgICAgfQogICAgICAgIHRoaXNbUFJJVkFURSQxNV0uc3RvcERldmljZUZyYW1lTG9vcCgpOwogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMTVdLmRldmljZS5lbmRTZXNzaW9uKHRoaXNbUFJJVkFURSQxNV0uaWQpOwogICAgICB9CiAgICAgIHVwZGF0ZVJlbmRlclN0YXRlKG5ld1N0YXRlKSB7CiAgICAgICAgaWYgKHRoaXNbUFJJVkFURSQxNV0uZW5kZWQpIHsKICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSAiQ2FuJ3QgY2FsbCB1cGRhdGVSZW5kZXJTdGF0ZSBvbiBhbiBYUlNlc3Npb24gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgInRoYXQgaGFzIGFscmVhZHkgZW5kZWQuIjsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgaWYgKG5ld1N0YXRlLmJhc2VMYXllciAmJiAobmV3U3RhdGUuYmFzZUxheWVyLl9zZXNzaW9uICE9PSB0aGlzKSkgewogICAgICAgICAgY29uc3QgbWVzc2FnZSA9ICJDYWxsZWQgdXBkYXRlUmVuZGVyU3RhdGUgd2l0aCBhIGJhc2UgbGF5ZXIgdGhhdCB3YXMgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgImNyZWF0ZWQgYnkgYSBkaWZmZXJlbnQgc2Vzc2lvbi4iOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgICBjb25zdCBmb3ZTZXQgPSAobmV3U3RhdGUuaW5saW5lVmVydGljYWxGaWVsZE9mVmlldyAhPT0gbnVsbCkgJiYKICAgICAgICAgICAgICAgICAgICAgICAobmV3U3RhdGUuaW5saW5lVmVydGljYWxGaWVsZE9mVmlldyAhPT0gdW5kZWZpbmVkKTsKICAgICAgICBpZiAoZm92U2V0KSB7CiAgICAgICAgICBpZiAodGhpc1tQUklWQVRFJDE1XS5pbW1lcnNpdmUpIHsKICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9ICJpbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3IG11c3Qgbm90IGJlIHNldCBmb3IgYW4gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiWFJSZW5kZXJTdGF0ZSBwYXNzZWQgdG8gdXBkYXRlUmVuZGVyU3RhdGUgZm9yIGFuICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgImltbWVyc2l2ZSBzZXNzaW9uLiI7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld1N0YXRlLmlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcgPSBNYXRoLm1pbigKICAgICAgICAgICAgICAzLjEzLCBNYXRoLm1heCgwLjAxLCBuZXdTdGF0ZS5pbmxpbmVWZXJ0aWNhbEZpZWxkT2ZWaWV3KSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzW1BSSVZBVEUkMTVdLnBlbmRpbmdSZW5kZXJTdGF0ZSA9PT0gbnVsbCkgewogICAgICAgICAgY29uc3QgYWN0aXZlUmVuZGVyU3RhdGUgPSB0aGlzW1BSSVZBVEUkMTVdLmFjdGl2ZVJlbmRlclN0YXRlOwogICAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5wZW5kaW5nUmVuZGVyU3RhdGUgPSB7CiAgICAgICAgICAgIGRlcHRoTmVhcjogYWN0aXZlUmVuZGVyU3RhdGUuZGVwdGhOZWFyLAogICAgICAgICAgICBkZXB0aEZhcjogYWN0aXZlUmVuZGVyU3RhdGUuZGVwdGhGYXIsCiAgICAgICAgICAgIGlubGluZVZlcnRpY2FsRmllbGRPZlZpZXc6IGFjdGl2ZVJlbmRlclN0YXRlLmlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcsCiAgICAgICAgICAgIGJhc2VMYXllcjogYWN0aXZlUmVuZGVyU3RhdGUuYmFzZUxheWVyCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBPYmplY3QuYXNzaWduKHRoaXNbUFJJVkFURSQxNV0ucGVuZGluZ1JlbmRlclN0YXRlLCBuZXdTdGF0ZSk7CiAgICAgIH0KICAgICAgX2NoZWNrSW5wdXRTb3VyY2VzQ2hhbmdlKCkgewogICAgICAgIGNvbnN0IGFkZGVkID0gW107CiAgICAgICAgY29uc3QgcmVtb3ZlZCA9IFtdOwogICAgICAgIGNvbnN0IG5ld0lucHV0U291cmNlcyA9IHRoaXMuaW5wdXRTb3VyY2VzOwogICAgICAgIGNvbnN0IG9sZElucHV0U291cmNlcyA9IHRoaXNbUFJJVkFURSQxNV0uY3VycmVudElucHV0U291cmNlczsKICAgICAgICBmb3IgKGNvbnN0IG5ld0lucHV0U291cmNlIG9mIG5ld0lucHV0U291cmNlcykgewogICAgICAgICAgaWYgKCFvbGRJbnB1dFNvdXJjZXMuaW5jbHVkZXMobmV3SW5wdXRTb3VyY2UpKSB7CiAgICAgICAgICAgIGFkZGVkLnB1c2gobmV3SW5wdXRTb3VyY2UpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IG9sZElucHV0U291cmNlIG9mIG9sZElucHV0U291cmNlcykgewogICAgICAgICAgaWYgKCFuZXdJbnB1dFNvdXJjZXMuaW5jbHVkZXMob2xkSW5wdXRTb3VyY2UpKSB7CiAgICAgICAgICAgIHJlbW92ZWQucHVzaChvbGRJbnB1dFNvdXJjZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChhZGRlZC5sZW5ndGggPiAwIHx8IHJlbW92ZWQubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdpbnB1dHNvdXJjZXNjaGFuZ2UnLCBuZXcgWFJJbnB1dFNvdXJjZXNDaGFuZ2VFdmVudCgnaW5wdXRzb3VyY2VzY2hhbmdlJywgewogICAgICAgICAgICBzZXNzaW9uOiB0aGlzLAogICAgICAgICAgICBhZGRlZDogYWRkZWQsCiAgICAgICAgICAgIHJlbW92ZWQ6IHJlbW92ZWQKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgdGhpc1tQUklWQVRFJDE1XS5jdXJyZW50SW5wdXRTb3VyY2VzLmxlbmd0aCA9IDA7CiAgICAgICAgZm9yIChjb25zdCBuZXdJbnB1dFNvdXJjZSBvZiBuZXdJbnB1dFNvdXJjZXMpIHsKICAgICAgICAgIHRoaXNbUFJJVkFURSQxNV0uY3VycmVudElucHV0U291cmNlcy5wdXNoKG5ld0lucHV0U291cmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDE2ID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSSW5wdXRTb3VyY2UnKTsKICAgIGNsYXNzIFhSSW5wdXRTb3VyY2UgewogICAgICBjb25zdHJ1Y3RvcihpbXBsKSB7CiAgICAgICAgdGhpc1tQUklWQVRFJDE2XSA9IHsKICAgICAgICAgIGltcGwsCiAgICAgICAgICBncmlwU3BhY2U6IG5ldyBYUlNwYWNlKCJncmlwIiwgdGhpcyksCiAgICAgICAgICB0YXJnZXRSYXlTcGFjZTogbmV3IFhSU3BhY2UoInRhcmdldC1yYXkiLCB0aGlzKQogICAgICAgIH07CiAgICAgIH0KICAgICAgZ2V0IGhhbmRlZG5lc3MoKSB7IHJldHVybiB0aGlzW1BSSVZBVEUkMTZdLmltcGwuaGFuZGVkbmVzczsgfQogICAgICBnZXQgdGFyZ2V0UmF5TW9kZSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxNl0uaW1wbC50YXJnZXRSYXlNb2RlOyB9CiAgICAgIGdldCBncmlwU3BhY2UoKSB7CiAgICAgICAgbGV0IG1vZGUgPSB0aGlzW1BSSVZBVEUkMTZdLmltcGwudGFyZ2V0UmF5TW9kZTsKICAgICAgICBpZiAobW9kZSA9PT0gImdhemUiIHx8IG1vZGUgPT09ICJzY3JlZW4iKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxNl0uZ3JpcFNwYWNlOwogICAgICB9CiAgICAgIGdldCB0YXJnZXRSYXlTcGFjZSgpIHsgcmV0dXJuIHRoaXNbUFJJVkFURSQxNl0udGFyZ2V0UmF5U3BhY2U7IH0KICAgICAgZ2V0IHByb2ZpbGVzKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE2XS5pbXBsLnByb2ZpbGVzOyB9CiAgICAgIGdldCBnYW1lcGFkKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE2XS5pbXBsLmdhbWVwYWQ7IH0KICAgIH0KCiAgICBjb25zdCBQUklWQVRFJDE3ID0gU3ltYm9sKCdAQHdlYnhyLXBvbHlmaWxsL1hSUmVmZXJlbmNlU3BhY2VFdmVudCcpOwogICAgY2xhc3MgWFJSZWZlcmVuY2VTcGFjZUV2ZW50IGV4dGVuZHMgRXZlbnQgewogICAgICBjb25zdHJ1Y3Rvcih0eXBlLCBldmVudEluaXREaWN0KSB7CiAgICAgICAgc3VwZXIodHlwZSwgZXZlbnRJbml0RGljdCk7CiAgICAgICAgdGhpc1tQUklWQVRFJDE3XSA9IHsKICAgICAgICAgIHJlZmVyZW5jZVNwYWNlOiBldmVudEluaXREaWN0LnJlZmVyZW5jZVNwYWNlLAogICAgICAgICAgdHJhbnNmb3JtOiBldmVudEluaXREaWN0LnRyYW5zZm9ybSB8fCBudWxsCiAgICAgICAgfTsKICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgWFJSZWZlcmVuY2VTcGFjZUV2ZW50LnByb3RvdHlwZSk7CiAgICAgIH0KICAgICAgZ2V0IHJlZmVyZW5jZVNwYWNlKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE3XS5yZWZlcmVuY2VTcGFjZTsgfQogICAgICBnZXQgdHJhbnNmb3JtKCkgeyByZXR1cm4gdGhpc1tQUklWQVRFJDE3XS50cmFuc2Zvcm07IH0KICAgIH0KCiAgICB2YXIgQVBJID0gewogICAgICBYUlN5c3RlbSwKICAgICAgWFJTZXNzaW9uOiBYUlNlc3Npb24kMSwKICAgICAgWFJTZXNzaW9uRXZlbnQsCiAgICAgIFhSRnJhbWUsCiAgICAgIFhSVmlldywKICAgICAgWFJWaWV3cG9ydCwKICAgICAgWFJWaWV3ZXJQb3NlLAogICAgICBYUldlYkdMTGF5ZXI6IFhSV2ViR0xMYXllciQxLAogICAgICBYUlNwYWNlLAogICAgICBYUlJlZmVyZW5jZVNwYWNlLAogICAgICBYUlJlZmVyZW5jZVNwYWNlRXZlbnQsCiAgICAgIFhSSW5wdXRTb3VyY2UsCiAgICAgIFhSSW5wdXRTb3VyY2VFdmVudCwKICAgICAgWFJJbnB1dFNvdXJjZXNDaGFuZ2VFdmVudCwKICAgICAgWFJSZW5kZXJTdGF0ZSwKICAgICAgWFJSaWdpZFRyYW5zZm9ybTogWFJSaWdpZFRyYW5zZm9ybSQxLAogICAgICBYUlBvc2U6IFhSUG9zZSQxLAogICAgfTsKCiAgICBjb25zdCBwb2x5ZmlsbE1ha2VYUkNvbXBhdGlibGUgPSBDb250ZXh0ID0+IHsKICAgICAgaWYgKHR5cGVvZiBDb250ZXh0LnByb3RvdHlwZS5tYWtlWFJDb21wYXRpYmxlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIENvbnRleHQucHJvdG90eXBlLm1ha2VYUkNvbXBhdGlibGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpc1tYUl9DT01QQVRJQkxFXSA9IHRydWU7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogICAgICB9OwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICBjb25zdCBwb2x5ZmlsbEdldENvbnRleHQgPSAoQ2FudmFzKSA9PiB7CiAgICAgIGNvbnN0IGdldENvbnRleHQgPSBDYW52YXMucHJvdG90eXBlLmdldENvbnRleHQ7CiAgICAgIENhbnZhcy5wcm90b3R5cGUuZ2V0Q29udGV4dCA9IGZ1bmN0aW9uIChjb250ZXh0VHlwZSwgZ2xBdHRyaWJzKSB7CiAgICAgICAgY29uc3QgY3R4ID0gZ2V0Q29udGV4dC5jYWxsKHRoaXMsIGNvbnRleHRUeXBlLCBnbEF0dHJpYnMpOwogICAgICAgIGlmIChjdHgpIHsKICAgICAgICAgIGN0eFtQT0xZRklMTEVEX1hSX0NPTVBBVElCTEVdID0gdHJ1ZTsKICAgICAgICAgIGlmIChnbEF0dHJpYnMgJiYgKCd4ckNvbXBhdGlibGUnIGluIGdsQXR0cmlicykpIHsKICAgICAgICAgICAgY3R4W1hSX0NPTVBBVElCTEVdID0gZ2xBdHRyaWJzLnhyQ29tcGF0aWJsZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGN0eDsKICAgICAgfTsKICAgIH07CgogICAgY29uc3QgaXNJbWFnZUJpdG1hcFN1cHBvcnRlZCA9IGdsb2JhbCA9PgogICAgICAhIShnbG9iYWwuSW1hZ2VCaXRtYXBSZW5kZXJpbmdDb250ZXh0ICYmCiAgICAgICAgIGdsb2JhbC5jcmVhdGVJbWFnZUJpdG1hcCk7CiAgICBjb25zdCBpc01vYmlsZSA9IGdsb2JhbCA9PiB7CiAgICAgIHZhciBjaGVjayA9IGZhbHNlOwogICAgICAoZnVuY3Rpb24oYSl7aWYoLyhhbmRyb2lkfGJiXGQrfG1lZWdvKS4rbW9iaWxlfGF2YW50Z298YmFkYVwvfGJsYWNrYmVycnl8YmxhemVyfGNvbXBhbHxlbGFpbmV8ZmVubmVjfGhpcHRvcHxpZW1vYmlsZXxpcChob25lfG9kKXxpcmlzfGtpbmRsZXxsZ2UgfG1hZW1vfG1pZHB8bW1wfG1vYmlsZS4rZmlyZWZveHxuZXRmcm9udHxvcGVyYSBtKG9ifGluKWl8cGFsbSggb3MpP3xwaG9uZXxwKGl4aXxyZSlcL3xwbHVja2VyfHBvY2tldHxwc3B8c2VyaWVzKDR8NikwfHN5bWJpYW58dHJlb3x1cFwuKGJyb3dzZXJ8bGluayl8dm9kYWZvbmV8d2FwfHdpbmRvd3MgY2V8eGRhfHhpaW5vL2kudGVzdChhKXx8LzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHNcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1wtKG58dSl8YzU1XC98Y2FwaXxjY3dhfGNkbVwtfGNlbGx8Y2h0bXxjbGRjfGNtZFwtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFwtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmXC01fGdcLW1vfGdvKFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZFwtKG18cHx0KXxoZWlcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXC1jfGh0KGMoXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XC18XC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XC8pfGtsb258a3B0IHxrd2NcLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XC8oa3xsfHUpfDUwfDU0fFwtW2Etd10pfGxpYnd8bHlueHxtMVwtd3xtM2dhfG01MFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKVwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblwtMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0XC1nfHFhXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFwtWzItN118aVwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXC18b298cFwtKXxzZGtcL3xzZShjKFwtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaFwtfHNoYXJ8c2llKFwtfG0pfHNrXC0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGhcLXx2XC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcLXx0ZGdcLXx0ZWwoaXxtKXx0aW1cLXx0XC1tb3x0byhwbHxzaCl8dHMoNzB8bVwtfG0zfG01KXx0eFwtOXx1cChcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcLXx5b3VyfHpldG98enRlXC0vaS50ZXN0KGEuc3Vic3RyKDAsNCkpKWNoZWNrID0gdHJ1ZTt9KShnbG9iYWwubmF2aWdhdG9yLnVzZXJBZ2VudHx8Z2xvYmFsLm5hdmlnYXRvci52ZW5kb3J8fGdsb2JhbC5vcGVyYSk7CiAgICAgIHJldHVybiBjaGVjazsKICAgIH07CiAgICBjb25zdCBhcHBseUNhbnZhc1N0eWxlc0Zvck1pbmltYWxSZW5kZXJpbmcgPSBjYW52YXMgPT4gewogICAgICBjYW52YXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgIGNhbnZhcy5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9IGNhbnZhcy5zdHlsZS5oZWlnaHQgPSAnMXB4JzsKICAgICAgY2FudmFzLnN0eWxlLnRvcCA9IGNhbnZhcy5zdHlsZS5sZWZ0ID0gJzBweCc7CiAgICB9OwoKICAgIHZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgoKCiAgICBmdW5jdGlvbiB1bndyYXBFeHBvcnRzICh4KSB7CiAgICAJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVDb21tb25qc01vZHVsZShmbiwgbW9kdWxlKSB7CiAgICAJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwogICAgfQoKICAgIHZhciBjYXJkYm9hcmRWckRpc3BsYXkgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewogICAgCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogICAgfShjb21tb25qc0dsb2JhbCwgKGZ1bmN0aW9uICgpIHsgdmFyIGNsYXNzQ2FsbENoZWNrID0gZnVuY3Rpb24gKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewogICAgICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICB9CiAgICB9OwogICAgdmFyIGNyZWF0ZUNsYXNzID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOwogICAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICAgICAgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CiAgICAgICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgICAgICBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKICAgICAgICByZXR1cm4gQ29uc3RydWN0b3I7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgc2xpY2VkVG9BcnJheSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gc2xpY2VJdGVyYXRvcihhcnIsIGkpIHsKICAgICAgICB2YXIgX2FyciA9IFtdOwogICAgICAgIHZhciBfbiA9IHRydWU7CiAgICAgICAgdmFyIF9kID0gZmFsc2U7CiAgICAgICAgdmFyIF9lID0gdW5kZWZpbmVkOwogICAgICAgIHRyeSB7CiAgICAgICAgICBmb3IgKHZhciBfaSA9IGFycltTeW1ib2wuaXRlcmF0b3JdKCksIF9zOyAhKF9uID0gKF9zID0gX2kubmV4dCgpKS5kb25lKTsgX24gPSB0cnVlKSB7CiAgICAgICAgICAgIF9hcnIucHVzaChfcy52YWx1ZSk7CiAgICAgICAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIF9kID0gdHJ1ZTsKICAgICAgICAgIF9lID0gZXJyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSkgX2lbInJldHVybiJdKCk7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoX2QpIHRocm93IF9lOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gX2FycjsKICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gKGFyciwgaSkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKICAgICAgICAgIHJldHVybiBhcnI7CiAgICAgICAgfSBlbHNlIGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGFycikpIHsKICAgICAgICAgIHJldHVybiBzbGljZUl0ZXJhdG9yKGFyciwgaSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKTsKICAgICAgICB9CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgTUlOX1RJTUVTVEVQID0gMC4wMDE7CiAgICB2YXIgTUFYX1RJTUVTVEVQID0gMTsKICAgIHZhciBkYXRhVXJpID0gZnVuY3Rpb24gZGF0YVVyaShtaW1lVHlwZSwgc3ZnKSB7CiAgICAgIHJldHVybiAnZGF0YTonICsgbWltZVR5cGUgKyAnLCcgKyBlbmNvZGVVUklDb21wb25lbnQoc3ZnKTsKICAgIH07CiAgICB2YXIgbGVycCA9IGZ1bmN0aW9uIGxlcnAoYSwgYiwgdCkgewogICAgICByZXR1cm4gYSArIChiIC0gYSkgKiB0OwogICAgfTsKICAgIHZhciBpc0lPUyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzSU9TID0gL2lQYWR8aVBob25lfGlQb2QvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaXNJT1M7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgaXNXZWJWaWV3QW5kcm9pZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGlzV2ViVmlld0FuZHJvaWQgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1ZlcnNpb24nKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdBbmRyb2lkJykgIT09IC0xICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgIT09IC0xOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBpc1dlYlZpZXdBbmRyb2lkOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGlzU2FmYXJpID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXNTYWZhcmkgPSAvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBpc1NhZmFyaTsKICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBpc0ZpcmVmb3hBbmRyb2lkID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXNGaXJlZm94QW5kcm9pZCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpICE9PSAtMSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FuZHJvaWQnKSAhPT0gLTE7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIGlzRmlyZWZveEFuZHJvaWQ7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgZ2V0Q2hyb21lVmVyc2lvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG1hdGNoID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvLipDaHJvbWVcLyhbMC05XSspLyk7CiAgICAgIHZhciB2YWx1ZSA9IG1hdGNoID8gcGFyc2VJbnQobWF0Y2hbMV0sIDEwKSA6IG51bGw7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGlzU2FmYXJpV2l0aG91dERldmljZU1vdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHZhbHVlID0gZmFsc2U7CiAgICAgIHZhbHVlID0gaXNJT1MoKSAmJiBpc1NhZmFyaSgpICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignMTNfNCcpICE9PSAtMTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgaXNDaHJvbWVXaXRob3V0RGV2aWNlTW90aW9uID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdmFsdWUgPSBmYWxzZTsKICAgICAgaWYgKGdldENocm9tZVZlcnNpb24oKSA9PT0gNjUpIHsKICAgICAgICB2YXIgbWF0Y2ggPSBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC8uKkNocm9tZVwvKFswLTlcLl0qKS8pOwogICAgICAgIGlmIChtYXRjaCkgewogICAgICAgICAgdmFyIF9tYXRjaCQxJHNwbGl0ID0gbWF0Y2hbMV0uc3BsaXQoJy4nKSwKICAgICAgICAgICAgICBfbWF0Y2gkMSRzcGxpdDIgPSBzbGljZWRUb0FycmF5KF9tYXRjaCQxJHNwbGl0LCA0KTsKICAgICAgICAgICAgICBfbWF0Y2gkMSRzcGxpdDJbMF07CiAgICAgICAgICAgICAgX21hdGNoJDEkc3BsaXQyWzFdOwogICAgICAgICAgICAgIHZhciBicmFuY2ggPSBfbWF0Y2gkMSRzcGxpdDJbMl0sCiAgICAgICAgICAgICAgYnVpbGQgPSBfbWF0Y2gkMSRzcGxpdDJbM107CiAgICAgICAgICB2YWx1ZSA9IHBhcnNlSW50KGJyYW5jaCwgMTApID09PSAzMzI1ICYmIHBhcnNlSW50KGJ1aWxkLCAxMCkgPCAxNDg7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9OwogICAgfSgpOwogICAgdmFyIGlzUjcgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpc1I3ID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdSNyBCdWlsZCcpICE9PSAtMTsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gaXNSNzsKICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBpc0xhbmRzY2FwZU1vZGUgPSBmdW5jdGlvbiBpc0xhbmRzY2FwZU1vZGUoKSB7CiAgICAgIHZhciBydG4gPSB3aW5kb3cub3JpZW50YXRpb24gPT0gOTAgfHwgd2luZG93Lm9yaWVudGF0aW9uID09IC05MDsKICAgICAgcmV0dXJuIGlzUjcoKSA/ICFydG4gOiBydG47CiAgICB9OwogICAgdmFyIGlzVGltZXN0YW1wRGVsdGFWYWxpZCA9IGZ1bmN0aW9uIGlzVGltZXN0YW1wRGVsdGFWYWxpZCh0aW1lc3RhbXBEZWx0YVMpIHsKICAgICAgaWYgKGlzTmFOKHRpbWVzdGFtcERlbHRhUykpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRpbWVzdGFtcERlbHRhUyA8PSBNSU5fVElNRVNURVApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRpbWVzdGFtcERlbHRhUyA+IE1BWF9USU1FU1RFUCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICB2YXIgZ2V0U2NyZWVuV2lkdGggPSBmdW5jdGlvbiBnZXRTY3JlZW5XaWR0aCgpIHsKICAgICAgcmV0dXJuIE1hdGgubWF4KHdpbmRvdy5zY3JlZW4ud2lkdGgsIHdpbmRvdy5zY3JlZW4uaGVpZ2h0KSAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwogICAgfTsKICAgIHZhciBnZXRTY3JlZW5IZWlnaHQgPSBmdW5jdGlvbiBnZXRTY3JlZW5IZWlnaHQoKSB7CiAgICAgIHJldHVybiBNYXRoLm1pbih3aW5kb3cuc2NyZWVuLndpZHRoLCB3aW5kb3cuc2NyZWVuLmhlaWdodCkgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKICAgIH07CiAgICB2YXIgcmVxdWVzdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiByZXF1ZXN0RnVsbHNjcmVlbihlbGVtZW50KSB7CiAgICAgIGlmIChpc1dlYlZpZXdBbmRyb2lkKCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGVsZW1lbnQucmVxdWVzdEZ1bGxzY3JlZW4pIHsKICAgICAgICBlbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSBpZiAoZWxlbWVudC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikgewogICAgICAgIGVsZW1lbnQud2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4oKTsKICAgICAgfSBlbHNlIGlmIChlbGVtZW50Lm1velJlcXVlc3RGdWxsU2NyZWVuKSB7CiAgICAgICAgZWxlbWVudC5tb3pSZXF1ZXN0RnVsbFNjcmVlbigpOwogICAgICB9IGVsc2UgaWYgKGVsZW1lbnQubXNSZXF1ZXN0RnVsbHNjcmVlbikgewogICAgICAgIGVsZW1lbnQubXNSZXF1ZXN0RnVsbHNjcmVlbigpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICB2YXIgZXhpdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiBleGl0RnVsbHNjcmVlbigpIHsKICAgICAgaWYgKGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKSB7CiAgICAgICAgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTsKICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbikgewogICAgICAgIGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKCk7CiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbikgewogICAgICAgIGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4oKTsKICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKSB7CiAgICAgICAgZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbigpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CiAgICB2YXIgZ2V0RnVsbHNjcmVlbkVsZW1lbnQgPSBmdW5jdGlvbiBnZXRGdWxsc2NyZWVuRWxlbWVudCgpIHsKICAgICAgcmV0dXJuIGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVsZW1lbnQ7CiAgICB9OwogICAgdmFyIGxpbmtQcm9ncmFtID0gZnVuY3Rpb24gbGlua1Byb2dyYW0oZ2wsIHZlcnRleFNvdXJjZSwgZnJhZ21lbnRTb3VyY2UsIGF0dHJpYkxvY2F0aW9uTWFwKSB7CiAgICAgIHZhciB2ZXJ0ZXhTaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUik7CiAgICAgIGdsLnNoYWRlclNvdXJjZSh2ZXJ0ZXhTaGFkZXIsIHZlcnRleFNvdXJjZSk7CiAgICAgIGdsLmNvbXBpbGVTaGFkZXIodmVydGV4U2hhZGVyKTsKICAgICAgdmFyIGZyYWdtZW50U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7CiAgICAgIGdsLnNoYWRlclNvdXJjZShmcmFnbWVudFNoYWRlciwgZnJhZ21lbnRTb3VyY2UpOwogICAgICBnbC5jb21waWxlU2hhZGVyKGZyYWdtZW50U2hhZGVyKTsKICAgICAgdmFyIHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7CiAgICAgIGdsLmF0dGFjaFNoYWRlcihwcm9ncmFtLCB2ZXJ0ZXhTaGFkZXIpOwogICAgICBnbC5hdHRhY2hTaGFkZXIocHJvZ3JhbSwgZnJhZ21lbnRTaGFkZXIpOwogICAgICBmb3IgKHZhciBhdHRyaWJOYW1lIGluIGF0dHJpYkxvY2F0aW9uTWFwKSB7CiAgICAgICAgZ2wuYmluZEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIGF0dHJpYkxvY2F0aW9uTWFwW2F0dHJpYk5hbWVdLCBhdHRyaWJOYW1lKTsKICAgICAgfWdsLmxpbmtQcm9ncmFtKHByb2dyYW0pOwogICAgICBnbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTsKICAgICAgZ2wuZGVsZXRlU2hhZGVyKGZyYWdtZW50U2hhZGVyKTsKICAgICAgcmV0dXJuIHByb2dyYW07CiAgICB9OwogICAgdmFyIGdldFByb2dyYW1Vbmlmb3JtcyA9IGZ1bmN0aW9uIGdldFByb2dyYW1Vbmlmb3JtcyhnbCwgcHJvZ3JhbSkgewogICAgICB2YXIgdW5pZm9ybXMgPSB7fTsKICAgICAgdmFyIHVuaWZvcm1Db3VudCA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuQUNUSVZFX1VOSUZPUk1TKTsKICAgICAgdmFyIHVuaWZvcm1OYW1lID0gJyc7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdW5pZm9ybUNvdW50OyBpKyspIHsKICAgICAgICB2YXIgdW5pZm9ybUluZm8gPSBnbC5nZXRBY3RpdmVVbmlmb3JtKHByb2dyYW0sIGkpOwogICAgICAgIHVuaWZvcm1OYW1lID0gdW5pZm9ybUluZm8ubmFtZS5yZXBsYWNlKCdbMF0nLCAnJyk7CiAgICAgICAgdW5pZm9ybXNbdW5pZm9ybU5hbWVdID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIHVuaWZvcm1OYW1lKTsKICAgICAgfQogICAgICByZXR1cm4gdW5pZm9ybXM7CiAgICB9OwogICAgdmFyIG9ydGhvTWF0cml4ID0gZnVuY3Rpb24gb3J0aG9NYXRyaXgob3V0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcikgewogICAgICB2YXIgbHIgPSAxIC8gKGxlZnQgLSByaWdodCksCiAgICAgICAgICBidCA9IDEgLyAoYm90dG9tIC0gdG9wKSwKICAgICAgICAgIG5mID0gMSAvIChuZWFyIC0gZmFyKTsKICAgICAgb3V0WzBdID0gLTIgKiBscjsKICAgICAgb3V0WzFdID0gMDsKICAgICAgb3V0WzJdID0gMDsKICAgICAgb3V0WzNdID0gMDsKICAgICAgb3V0WzRdID0gMDsKICAgICAgb3V0WzVdID0gLTIgKiBidDsKICAgICAgb3V0WzZdID0gMDsKICAgICAgb3V0WzddID0gMDsKICAgICAgb3V0WzhdID0gMDsKICAgICAgb3V0WzldID0gMDsKICAgICAgb3V0WzEwXSA9IDIgKiBuZjsKICAgICAgb3V0WzExXSA9IDA7CiAgICAgIG91dFsxMl0gPSAobGVmdCArIHJpZ2h0KSAqIGxyOwogICAgICBvdXRbMTNdID0gKHRvcCArIGJvdHRvbSkgKiBidDsKICAgICAgb3V0WzE0XSA9IChmYXIgKyBuZWFyKSAqIG5mOwogICAgICBvdXRbMTVdID0gMTsKICAgICAgcmV0dXJuIG91dDsKICAgIH07CiAgICB2YXIgaXNNb2JpbGUgPSBmdW5jdGlvbiBpc01vYmlsZSgpIHsKICAgICAgdmFyIGNoZWNrID0gZmFsc2U7CiAgICAgIChmdW5jdGlvbiAoYSkgewogICAgICAgIGlmICgvKGFuZHJvaWR8YmJcZCt8bWVlZ28pLittb2JpbGV8YXZhbnRnb3xiYWRhXC98YmxhY2tiZXJyeXxibGF6ZXJ8Y29tcGFsfGVsYWluZXxmZW5uZWN8aGlwdG9wfGllbW9iaWxlfGlwKGhvbmV8b2QpfGlyaXN8a2luZGxlfGxnZSB8bWFlbW98bWlkcHxtbXB8bW9iaWxlLitmaXJlZm94fG5ldGZyb250fG9wZXJhIG0ob2J8aW4paXxwYWxtKCBvcyk/fHBob25lfHAoaXhpfHJlKVwvfHBsdWNrZXJ8cG9ja2V0fHBzcHxzZXJpZXMoNHw2KTB8c3ltYmlhbnx0cmVvfHVwXC4oYnJvd3NlcnxsaW5rKXx2b2RhZm9uZXx3YXB8d2luZG93cyBjZXx4ZGF8eGlpbm8vaS50ZXN0KGEpIHx8IC8xMjA3fDYzMTB8NjU5MHwzZ3NvfDR0aHB8NTBbMS02XWl8Nzcwc3w4MDJzfGEgd2F8YWJhY3xhYyhlcnxvb3xzXC0pfGFpKGtvfHJuKXxhbChhdnxjYXxjbyl8YW1vaXxhbihleHxueXx5dyl8YXB0dXxhcihjaHxnbyl8YXModGV8dXMpfGF0dHd8YXUoZGl8XC1tfHIgfHMgKXxhdmFufGJlKGNrfGxsfG5xKXxiaShsYnxyZCl8YmwoYWN8YXopfGJyKGV8dil3fGJ1bWJ8YndcLShufHUpfGM1NVwvfGNhcGl8Y2N3YXxjZG1cLXxjZWxsfGNodG18Y2xkY3xjbWRcLXxjbyhtcHxuZCl8Y3Jhd3xkYShpdHxsbHxuZyl8ZGJ0ZXxkY1wtc3xkZXZpfGRpY2F8ZG1vYnxkbyhjfHApb3xkcygxMnxcLWQpfGVsKDQ5fGFpKXxlbShsMnx1bCl8ZXIoaWN8azApfGVzbDh8ZXooWzQtN10wfG9zfHdhfHplKXxmZXRjfGZseShcLXxfKXxnMSB1fGc1NjB8Z2VuZXxnZlwtNXxnXC1tb3xnbyhcLnd8b2QpfGdyKGFkfHVuKXxoYWllfGhjaXR8aGRcLShtfHB8dCl8aGVpXC18aGkocHR8dGEpfGhwKCBpfGlwKXxoc1wtY3xodChjKFwtfCB8X3xhfGd8cHxzfHQpfHRwKXxodShhd3x0Yyl8aVwtKDIwfGdvfG1hKXxpMjMwfGlhYyggfFwtfFwvKXxpYnJvfGlkZWF8aWcwMXxpa29tfGltMWt8aW5ub3xpcGFxfGlyaXN8amEodHx2KWF8amJyb3xqZW11fGppZ3N8a2RkaXxrZWppfGtndCggfFwvKXxrbG9ufGtwdCB8a3djXC18a3lvKGN8ayl8bGUobm98eGkpfGxnKCBnfFwvKGt8bHx1KXw1MHw1NHxcLVthLXddKXxsaWJ3fGx5bnh8bTFcLXd8bTNnYXxtNTBcL3xtYSh0ZXx1aXx4byl8bWMoMDF8MjF8Y2EpfG1cLWNyfG1lKHJjfHJpKXxtaShvOHxvYXx0cyl8bW1lZnxtbygwMXwwMnxiaXxkZXxkb3x0KFwtfCB8b3x2KXx6eil8bXQoNTB8cDF8diApfG13YnB8bXl3YXxuMTBbMC0yXXxuMjBbMi0zXXxuMzAoMHwyKXxuNTAoMHwyfDUpfG43KDAoMHwxKXwxMCl8bmUoKGN8bSlcLXxvbnx0Znx3Znx3Z3x3dCl8bm9rKDZ8aSl8bnpwaHxvMmltfG9wKHRpfHd2KXxvcmFufG93ZzF8cDgwMHxwYW4oYXxkfHQpfHBkeGd8cGcoMTN8XC0oWzEtOF18YykpfHBoaWx8cGlyZXxwbChheXx1Yyl8cG5cLTJ8cG8oY2t8cnR8c2UpfHByb3h8cHNpb3xwdFwtZ3xxYVwtYXxxYygwN3wxMnwyMXwzMnw2MHxcLVsyLTddfGlcLSl8cXRla3xyMzgwfHI2MDB8cmFrc3xyaW05fHJvKHZlfHpvKXxzNTVcL3xzYShnZXxtYXxtbXxtc3xueXx2YSl8c2MoMDF8aFwtfG9vfHBcLSl8c2RrXC98c2UoYyhcLXwwfDEpfDQ3fG1jfG5kfHJpKXxzZ2hcLXxzaGFyfHNpZShcLXxtKXxza1wtMHxzbCg0NXxpZCl8c20oYWx8YXJ8YjN8aXR8dDUpfHNvKGZ0fG55KXxzcCgwMXxoXC18dlwtfHYgKXxzeSgwMXxtYil8dDIoMTh8NTApfHQ2KDAwfDEwfDE4KXx0YShndHxsayl8dGNsXC18dGRnXC18dGVsKGl8bSl8dGltXC18dFwtbW98dG8ocGx8c2gpfHRzKDcwfG1cLXxtM3xtNSl8dHhcLTl8dXAoXC5ifGcxfHNpKXx1dHN0fHY0MDB8djc1MHx2ZXJpfHZpKHJnfHRlKXx2ayg0MHw1WzAtM118XC12KXx2bTQwfHZvZGF8dnVsY3x2eCg1Mnw1M3w2MHw2MXw3MHw4MHw4MXw4M3w4NXw5OCl8dzNjKFwtfCApfHdlYmN8d2hpdHx3aShnIHxuY3xudyl8d21sYnx3b251fHg3MDB8eWFzXC18eW91cnx6ZXRvfHp0ZVwtL2kudGVzdChhLnN1YnN0cigwLCA0KSkpIGNoZWNrID0gdHJ1ZTsKICAgICAgfSkobmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8IHdpbmRvdy5vcGVyYSk7CiAgICAgIHJldHVybiBjaGVjazsKICAgIH07CiAgICB2YXIgZXh0ZW5kID0gZnVuY3Rpb24gZXh0ZW5kKGRlc3QsIHNyYykgewogICAgICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7CiAgICAgICAgaWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICBkZXN0W2tleV0gPSBzcmNba2V5XTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGRlc3Q7CiAgICB9OwogICAgdmFyIHNhZmFyaUNzc1NpemVXb3JrYXJvdW5kID0gZnVuY3Rpb24gc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQoY2FudmFzKSB7CiAgICAgIGlmIChpc0lPUygpKSB7CiAgICAgICAgdmFyIHdpZHRoID0gY2FudmFzLnN0eWxlLndpZHRoOwogICAgICAgIHZhciBoZWlnaHQgPSBjYW52YXMuc3R5bGUuaGVpZ2h0OwogICAgICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9IHBhcnNlSW50KHdpZHRoKSArIDEgKyAncHgnOwogICAgICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQpICsgJ3B4JzsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9IHdpZHRoOwogICAgICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKICAgICAgICB9LCAxMDApOwogICAgICB9CiAgICAgIHdpbmRvdy5jYW52YXMgPSBjYW52YXM7CiAgICB9OwogICAgdmFyIGZyYW1lRGF0YUZyb21Qb3NlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgcGlPdmVyMTgwID0gTWF0aC5QSSAvIDE4MC4wOwogICAgICB2YXIgcmFkNDUgPSBNYXRoLlBJICogMC4yNTsKICAgICAgZnVuY3Rpb24gbWF0NF9wZXJzcGVjdGl2ZUZyb21GaWVsZE9mVmlldyhvdXQsIGZvdiwgbmVhciwgZmFyKSB7CiAgICAgICAgdmFyIHVwVGFuID0gTWF0aC50YW4oZm92ID8gZm92LnVwRGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKICAgICAgICAgICAgZG93blRhbiA9IE1hdGgudGFuKGZvdiA/IGZvdi5kb3duRGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKICAgICAgICAgICAgbGVmdFRhbiA9IE1hdGgudGFuKGZvdiA/IGZvdi5sZWZ0RGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKICAgICAgICAgICAgcmlnaHRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YucmlnaHREZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAogICAgICAgICAgICB4U2NhbGUgPSAyLjAgLyAobGVmdFRhbiArIHJpZ2h0VGFuKSwKICAgICAgICAgICAgeVNjYWxlID0gMi4wIC8gKHVwVGFuICsgZG93blRhbik7CiAgICAgICAgb3V0WzBdID0geFNjYWxlOwogICAgICAgIG91dFsxXSA9IDAuMDsKICAgICAgICBvdXRbMl0gPSAwLjA7CiAgICAgICAgb3V0WzNdID0gMC4wOwogICAgICAgIG91dFs0XSA9IDAuMDsKICAgICAgICBvdXRbNV0gPSB5U2NhbGU7CiAgICAgICAgb3V0WzZdID0gMC4wOwogICAgICAgIG91dFs3XSA9IDAuMDsKICAgICAgICBvdXRbOF0gPSAtKChsZWZ0VGFuIC0gcmlnaHRUYW4pICogeFNjYWxlICogMC41KTsKICAgICAgICBvdXRbOV0gPSAodXBUYW4gLSBkb3duVGFuKSAqIHlTY2FsZSAqIDAuNTsKICAgICAgICBvdXRbMTBdID0gZmFyIC8gKG5lYXIgLSBmYXIpOwogICAgICAgIG91dFsxMV0gPSAtMTsKICAgICAgICBvdXRbMTJdID0gMC4wOwogICAgICAgIG91dFsxM10gPSAwLjA7CiAgICAgICAgb3V0WzE0XSA9IGZhciAqIG5lYXIgLyAobmVhciAtIGZhcik7CiAgICAgICAgb3V0WzE1XSA9IDAuMDsKICAgICAgICByZXR1cm4gb3V0OwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG1hdDRfZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24ob3V0LCBxLCB2KSB7CiAgICAgICAgdmFyIHggPSBxWzBdLAogICAgICAgICAgICB5ID0gcVsxXSwKICAgICAgICAgICAgeiA9IHFbMl0sCiAgICAgICAgICAgIHcgPSBxWzNdLAogICAgICAgICAgICB4MiA9IHggKyB4LAogICAgICAgICAgICB5MiA9IHkgKyB5LAogICAgICAgICAgICB6MiA9IHogKyB6LAogICAgICAgICAgICB4eCA9IHggKiB4MiwKICAgICAgICAgICAgeHkgPSB4ICogeTIsCiAgICAgICAgICAgIHh6ID0geCAqIHoyLAogICAgICAgICAgICB5eSA9IHkgKiB5MiwKICAgICAgICAgICAgeXogPSB5ICogejIsCiAgICAgICAgICAgIHp6ID0geiAqIHoyLAogICAgICAgICAgICB3eCA9IHcgKiB4MiwKICAgICAgICAgICAgd3kgPSB3ICogeTIsCiAgICAgICAgICAgIHd6ID0gdyAqIHoyOwogICAgICAgIG91dFswXSA9IDEgLSAoeXkgKyB6eik7CiAgICAgICAgb3V0WzFdID0geHkgKyB3ejsKICAgICAgICBvdXRbMl0gPSB4eiAtIHd5OwogICAgICAgIG91dFszXSA9IDA7CiAgICAgICAgb3V0WzRdID0geHkgLSB3ejsKICAgICAgICBvdXRbNV0gPSAxIC0gKHh4ICsgenopOwogICAgICAgIG91dFs2XSA9IHl6ICsgd3g7CiAgICAgICAgb3V0WzddID0gMDsKICAgICAgICBvdXRbOF0gPSB4eiArIHd5OwogICAgICAgIG91dFs5XSA9IHl6IC0gd3g7CiAgICAgICAgb3V0WzEwXSA9IDEgLSAoeHggKyB5eSk7CiAgICAgICAgb3V0WzExXSA9IDA7CiAgICAgICAgb3V0WzEyXSA9IHZbMF07CiAgICAgICAgb3V0WzEzXSA9IHZbMV07CiAgICAgICAgb3V0WzE0XSA9IHZbMl07CiAgICAgICAgb3V0WzE1XSA9IDE7CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgICBmdW5jdGlvbiBtYXQ0X3RyYW5zbGF0ZShvdXQsIGEsIHYpIHsKICAgICAgICB2YXIgeCA9IHZbMF0sCiAgICAgICAgICAgIHkgPSB2WzFdLAogICAgICAgICAgICB6ID0gdlsyXSwKICAgICAgICAgICAgYTAwLAogICAgICAgICAgICBhMDEsCiAgICAgICAgICAgIGEwMiwKICAgICAgICAgICAgYTAzLAogICAgICAgICAgICBhMTAsCiAgICAgICAgICAgIGExMSwKICAgICAgICAgICAgYTEyLAogICAgICAgICAgICBhMTMsCiAgICAgICAgICAgIGEyMCwKICAgICAgICAgICAgYTIxLAogICAgICAgICAgICBhMjIsCiAgICAgICAgICAgIGEyMzsKICAgICAgICBpZiAoYSA9PT0gb3V0KSB7CiAgICAgICAgICBvdXRbMTJdID0gYVswXSAqIHggKyBhWzRdICogeSArIGFbOF0gKiB6ICsgYVsxMl07CiAgICAgICAgICBvdXRbMTNdID0gYVsxXSAqIHggKyBhWzVdICogeSArIGFbOV0gKiB6ICsgYVsxM107CiAgICAgICAgICBvdXRbMTRdID0gYVsyXSAqIHggKyBhWzZdICogeSArIGFbMTBdICogeiArIGFbMTRdOwogICAgICAgICAgb3V0WzE1XSA9IGFbM10gKiB4ICsgYVs3XSAqIHkgKyBhWzExXSAqIHogKyBhWzE1XTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYTAwID0gYVswXTthMDEgPSBhWzFdO2EwMiA9IGFbMl07YTAzID0gYVszXTsKICAgICAgICAgIGExMCA9IGFbNF07YTExID0gYVs1XTthMTIgPSBhWzZdO2ExMyA9IGFbN107CiAgICAgICAgICBhMjAgPSBhWzhdO2EyMSA9IGFbOV07YTIyID0gYVsxMF07YTIzID0gYVsxMV07CiAgICAgICAgICBvdXRbMF0gPSBhMDA7b3V0WzFdID0gYTAxO291dFsyXSA9IGEwMjtvdXRbM10gPSBhMDM7CiAgICAgICAgICBvdXRbNF0gPSBhMTA7b3V0WzVdID0gYTExO291dFs2XSA9IGExMjtvdXRbN10gPSBhMTM7CiAgICAgICAgICBvdXRbOF0gPSBhMjA7b3V0WzldID0gYTIxO291dFsxMF0gPSBhMjI7b3V0WzExXSA9IGEyMzsKICAgICAgICAgIG91dFsxMl0gPSBhMDAgKiB4ICsgYTEwICogeSArIGEyMCAqIHogKyBhWzEyXTsKICAgICAgICAgIG91dFsxM10gPSBhMDEgKiB4ICsgYTExICogeSArIGEyMSAqIHogKyBhWzEzXTsKICAgICAgICAgIG91dFsxNF0gPSBhMDIgKiB4ICsgYTEyICogeSArIGEyMiAqIHogKyBhWzE0XTsKICAgICAgICAgIG91dFsxNV0gPSBhMDMgKiB4ICsgYTEzICogeSArIGEyMyAqIHogKyBhWzE1XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgICBmdW5jdGlvbiBtYXQ0X2ludmVydChvdXQsIGEpIHsKICAgICAgICB2YXIgYTAwID0gYVswXSwKICAgICAgICAgICAgYTAxID0gYVsxXSwKICAgICAgICAgICAgYTAyID0gYVsyXSwKICAgICAgICAgICAgYTAzID0gYVszXSwKICAgICAgICAgICAgYTEwID0gYVs0XSwKICAgICAgICAgICAgYTExID0gYVs1XSwKICAgICAgICAgICAgYTEyID0gYVs2XSwKICAgICAgICAgICAgYTEzID0gYVs3XSwKICAgICAgICAgICAgYTIwID0gYVs4XSwKICAgICAgICAgICAgYTIxID0gYVs5XSwKICAgICAgICAgICAgYTIyID0gYVsxMF0sCiAgICAgICAgICAgIGEyMyA9IGFbMTFdLAogICAgICAgICAgICBhMzAgPSBhWzEyXSwKICAgICAgICAgICAgYTMxID0gYVsxM10sCiAgICAgICAgICAgIGEzMiA9IGFbMTRdLAogICAgICAgICAgICBhMzMgPSBhWzE1XSwKICAgICAgICAgICAgYjAwID0gYTAwICogYTExIC0gYTAxICogYTEwLAogICAgICAgICAgICBiMDEgPSBhMDAgKiBhMTIgLSBhMDIgKiBhMTAsCiAgICAgICAgICAgIGIwMiA9IGEwMCAqIGExMyAtIGEwMyAqIGExMCwKICAgICAgICAgICAgYjAzID0gYTAxICogYTEyIC0gYTAyICogYTExLAogICAgICAgICAgICBiMDQgPSBhMDEgKiBhMTMgLSBhMDMgKiBhMTEsCiAgICAgICAgICAgIGIwNSA9IGEwMiAqIGExMyAtIGEwMyAqIGExMiwKICAgICAgICAgICAgYjA2ID0gYTIwICogYTMxIC0gYTIxICogYTMwLAogICAgICAgICAgICBiMDcgPSBhMjAgKiBhMzIgLSBhMjIgKiBhMzAsCiAgICAgICAgICAgIGIwOCA9IGEyMCAqIGEzMyAtIGEyMyAqIGEzMCwKICAgICAgICAgICAgYjA5ID0gYTIxICogYTMyIC0gYTIyICogYTMxLAogICAgICAgICAgICBiMTAgPSBhMjEgKiBhMzMgLSBhMjMgKiBhMzEsCiAgICAgICAgICAgIGIxMSA9IGEyMiAqIGEzMyAtIGEyMyAqIGEzMiwKICAgICAgICBkZXQgPSBiMDAgKiBiMTEgLSBiMDEgKiBiMTAgKyBiMDIgKiBiMDkgKyBiMDMgKiBiMDggLSBiMDQgKiBiMDcgKyBiMDUgKiBiMDY7CiAgICAgICAgaWYgKCFkZXQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBkZXQgPSAxLjAgLyBkZXQ7CiAgICAgICAgb3V0WzBdID0gKGExMSAqIGIxMSAtIGExMiAqIGIxMCArIGExMyAqIGIwOSkgKiBkZXQ7CiAgICAgICAgb3V0WzFdID0gKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQ7CiAgICAgICAgb3V0WzJdID0gKGEzMSAqIGIwNSAtIGEzMiAqIGIwNCArIGEzMyAqIGIwMykgKiBkZXQ7CiAgICAgICAgb3V0WzNdID0gKGEyMiAqIGIwNCAtIGEyMSAqIGIwNSAtIGEyMyAqIGIwMykgKiBkZXQ7CiAgICAgICAgb3V0WzRdID0gKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQ7CiAgICAgICAgb3V0WzVdID0gKGEwMCAqIGIxMSAtIGEwMiAqIGIwOCArIGEwMyAqIGIwNykgKiBkZXQ7CiAgICAgICAgb3V0WzZdID0gKGEzMiAqIGIwMiAtIGEzMCAqIGIwNSAtIGEzMyAqIGIwMSkgKiBkZXQ7CiAgICAgICAgb3V0WzddID0gKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQ7CiAgICAgICAgb3V0WzhdID0gKGExMCAqIGIxMCAtIGExMSAqIGIwOCArIGExMyAqIGIwNikgKiBkZXQ7CiAgICAgICAgb3V0WzldID0gKGEwMSAqIGIwOCAtIGEwMCAqIGIxMCAtIGEwMyAqIGIwNikgKiBkZXQ7CiAgICAgICAgb3V0WzEwXSA9IChhMzAgKiBiMDQgLSBhMzEgKiBiMDIgKyBhMzMgKiBiMDApICogZGV0OwogICAgICAgIG91dFsxMV0gPSAoYTIxICogYjAyIC0gYTIwICogYjA0IC0gYTIzICogYjAwKSAqIGRldDsKICAgICAgICBvdXRbMTJdID0gKGExMSAqIGIwNyAtIGExMCAqIGIwOSAtIGExMiAqIGIwNikgKiBkZXQ7CiAgICAgICAgb3V0WzEzXSA9IChhMDAgKiBiMDkgLSBhMDEgKiBiMDcgKyBhMDIgKiBiMDYpICogZGV0OwogICAgICAgIG91dFsxNF0gPSAoYTMxICogYjAxIC0gYTMwICogYjAzIC0gYTMyICogYjAwKSAqIGRldDsKICAgICAgICBvdXRbMTVdID0gKGEyMCAqIGIwMyAtIGEyMSAqIGIwMSArIGEyMiAqIGIwMCkgKiBkZXQ7CiAgICAgICAgcmV0dXJuIG91dDsKICAgICAgfQogICAgICB2YXIgZGVmYXVsdE9yaWVudGF0aW9uID0gbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgMCwgMV0pOwogICAgICB2YXIgZGVmYXVsdFBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgMF0pOwogICAgICBmdW5jdGlvbiB1cGRhdGVFeWVNYXRyaWNlcyhwcm9qZWN0aW9uLCB2aWV3LCBwb3NlLCBmb3YsIG9mZnNldCwgdnJEaXNwbGF5KSB7CiAgICAgICAgbWF0NF9wZXJzcGVjdGl2ZUZyb21GaWVsZE9mVmlldyhwcm9qZWN0aW9uLCBmb3YgfHwgbnVsbCwgdnJEaXNwbGF5LmRlcHRoTmVhciwgdnJEaXNwbGF5LmRlcHRoRmFyKTsKICAgICAgICB2YXIgb3JpZW50YXRpb24gPSBwb3NlLm9yaWVudGF0aW9uIHx8IGRlZmF1bHRPcmllbnRhdGlvbjsKICAgICAgICB2YXIgcG9zaXRpb24gPSBwb3NlLnBvc2l0aW9uIHx8IGRlZmF1bHRQb3NpdGlvbjsKICAgICAgICBtYXQ0X2Zyb21Sb3RhdGlvblRyYW5zbGF0aW9uKHZpZXcsIG9yaWVudGF0aW9uLCBwb3NpdGlvbik7CiAgICAgICAgaWYgKG9mZnNldCkgbWF0NF90cmFuc2xhdGUodmlldywgdmlldywgb2Zmc2V0KTsKICAgICAgICBtYXQ0X2ludmVydCh2aWV3LCB2aWV3KTsKICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gKGZyYW1lRGF0YSwgcG9zZSwgdnJEaXNwbGF5KSB7CiAgICAgICAgaWYgKCFmcmFtZURhdGEgfHwgIXBvc2UpIHJldHVybiBmYWxzZTsKICAgICAgICBmcmFtZURhdGEucG9zZSA9IHBvc2U7CiAgICAgICAgZnJhbWVEYXRhLnRpbWVzdGFtcCA9IHBvc2UudGltZXN0YW1wOwogICAgICAgIHVwZGF0ZUV5ZU1hdHJpY2VzKGZyYW1lRGF0YS5sZWZ0UHJvamVjdGlvbk1hdHJpeCwgZnJhbWVEYXRhLmxlZnRWaWV3TWF0cml4LCBwb3NlLCB2ckRpc3BsYXkuX2dldEZpZWxkT2ZWaWV3KCJsZWZ0IiksIHZyRGlzcGxheS5fZ2V0RXllT2Zmc2V0KCJsZWZ0IiksIHZyRGlzcGxheSk7CiAgICAgICAgdXBkYXRlRXllTWF0cmljZXMoZnJhbWVEYXRhLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCwgZnJhbWVEYXRhLnJpZ2h0Vmlld01hdHJpeCwgcG9zZSwgdnJEaXNwbGF5Ll9nZXRGaWVsZE9mVmlldygicmlnaHQiKSwgdnJEaXNwbGF5Ll9nZXRFeWVPZmZzZXQoInJpZ2h0IiksIHZyRGlzcGxheSk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH07CiAgICB9KCk7CiAgICB2YXIgaXNJbnNpZGVDcm9zc09yaWdpbklGcmFtZSA9IGZ1bmN0aW9uIGlzSW5zaWRlQ3Jvc3NPcmlnaW5JRnJhbWUoKSB7CiAgICAgIHZhciBpc0ZyYW1lZCA9IHdpbmRvdy5zZWxmICE9PSB3aW5kb3cudG9wOwogICAgICB2YXIgcmVmT3JpZ2luID0gZ2V0T3JpZ2luRnJvbVVybChkb2N1bWVudC5yZWZlcnJlcik7CiAgICAgIHZhciB0aGlzT3JpZ2luID0gZ2V0T3JpZ2luRnJvbVVybCh3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgICAgIHJldHVybiBpc0ZyYW1lZCAmJiByZWZPcmlnaW4gIT09IHRoaXNPcmlnaW47CiAgICB9OwogICAgdmFyIGdldE9yaWdpbkZyb21VcmwgPSBmdW5jdGlvbiBnZXRPcmlnaW5Gcm9tVXJsKHVybCkgewogICAgICB2YXIgZG9tYWluSWR4OwogICAgICB2YXIgcHJvdG9TZXBJZHggPSB1cmwuaW5kZXhPZigiOi8vIik7CiAgICAgIGlmIChwcm90b1NlcElkeCAhPT0gLTEpIHsKICAgICAgICBkb21haW5JZHggPSBwcm90b1NlcElkeCArIDM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG9tYWluSWR4ID0gMDsKICAgICAgfQogICAgICB2YXIgZG9tYWluRW5kSWR4ID0gdXJsLmluZGV4T2YoJy8nLCBkb21haW5JZHgpOwogICAgICBpZiAoZG9tYWluRW5kSWR4ID09PSAtMSkgewogICAgICAgIGRvbWFpbkVuZElkeCA9IHVybC5sZW5ndGg7CiAgICAgIH0KICAgICAgcmV0dXJuIHVybC5zdWJzdHJpbmcoMCwgZG9tYWluRW5kSWR4KTsKICAgIH07CiAgICB2YXIgZ2V0UXVhdGVybmlvbkFuZ2xlID0gZnVuY3Rpb24gZ2V0UXVhdGVybmlvbkFuZ2xlKHF1YXQpIHsKICAgICAgaWYgKHF1YXQudyA+IDEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ2dldFF1YXRlcm5pb25BbmdsZTogdyA+IDEnKTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQogICAgICB2YXIgYW5nbGUgPSAyICogTWF0aC5hY29zKHF1YXQudyk7CiAgICAgIHJldHVybiBhbmdsZTsKICAgIH07CiAgICB2YXIgd2Fybk9uY2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBvYnNlcnZlZFdhcm5pbmdzID0ge307CiAgICAgIHJldHVybiBmdW5jdGlvbiAoa2V5LCBtZXNzYWdlKSB7CiAgICAgICAgaWYgKG9ic2VydmVkV2FybmluZ3Nba2V5XSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ3dlYnZyLXBvbHlmaWxsOiAnICsgbWVzc2FnZSk7CiAgICAgICAgICBvYnNlcnZlZFdhcm5pbmdzW2tleV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgfTsKICAgIH0oKTsKICAgIHZhciBkZXByZWNhdGVXYXJuaW5nID0gZnVuY3Rpb24gZGVwcmVjYXRlV2FybmluZyhkZXByZWNhdGVkLCBzdWdnZXN0ZWQpIHsKICAgICAgdmFyIGFsdGVybmF0aXZlID0gc3VnZ2VzdGVkID8gJ1BsZWFzZSB1c2UgJyArIHN1Z2dlc3RlZCArICcgaW5zdGVhZC4nIDogJyc7CiAgICAgIHdhcm5PbmNlKGRlcHJlY2F0ZWQsIGRlcHJlY2F0ZWQgKyAnIGhhcyBiZWVuIGRlcHJlY2F0ZWQuICcgKyAnVGhpcyBtYXkgbm90IHdvcmsgb24gbmF0aXZlIFdlYlZSIGRpc3BsYXlzLiAnICsgYWx0ZXJuYXRpdmUpOwogICAgfTsKICAgIGZ1bmN0aW9uIFdHTFVQcmVzZXJ2ZUdMU3RhdGUoZ2wsIGJpbmRpbmdzLCBjYWxsYmFjaykgewogICAgICBpZiAoIWJpbmRpbmdzKSB7CiAgICAgICAgY2FsbGJhY2soZ2wpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB2YXIgYm91bmRWYWx1ZXMgPSBbXTsKICAgICAgdmFyIGFjdGl2ZVRleHR1cmUgPSBudWxsOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmRpbmdzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgdmFyIGJpbmRpbmcgPSBiaW5kaW5nc1tpXTsKICAgICAgICBzd2l0Y2ggKGJpbmRpbmcpIHsKICAgICAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HXzJEOgogICAgICAgICAgY2FzZSBnbC5URVhUVVJFX0JJTkRJTkdfQ1VCRV9NQVA6CiAgICAgICAgICAgIHZhciB0ZXh0dXJlVW5pdCA9IGJpbmRpbmdzWysraV07CiAgICAgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiVEVYVFVSRV9CSU5ESU5HXzJEIG9yIFRFWFRVUkVfQklORElOR19DVUJFX01BUCBtdXN0IGJlIGZvbGxvd2VkIGJ5IGEgdmFsaWQgdGV4dHVyZSB1bml0Iik7CiAgICAgICAgICAgICAgYm91bmRWYWx1ZXMucHVzaChudWxsLCBudWxsKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWFjdGl2ZVRleHR1cmUpIHsKICAgICAgICAgICAgICBhY3RpdmVUZXh0dXJlID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkFDVElWRV9URVhUVVJFKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleHR1cmVVbml0KTsKICAgICAgICAgICAgYm91bmRWYWx1ZXMucHVzaChnbC5nZXRQYXJhbWV0ZXIoYmluZGluZyksIG51bGwpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuQUNUSVZFX1RFWFRVUkU6CiAgICAgICAgICAgIGFjdGl2ZVRleHR1cmUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQUNUSVZFX1RFWFRVUkUpOwogICAgICAgICAgICBib3VuZFZhbHVlcy5wdXNoKG51bGwpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJvdW5kVmFsdWVzLnB1c2goZ2wuZ2V0UGFyYW1ldGVyKGJpbmRpbmcpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGNhbGxiYWNrKGdsKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW5kaW5ncy5sZW5ndGg7ICsraSkgewogICAgICAgIHZhciBiaW5kaW5nID0gYmluZGluZ3NbaV07CiAgICAgICAgdmFyIGJvdW5kVmFsdWUgPSBib3VuZFZhbHVlc1tpXTsKICAgICAgICBzd2l0Y2ggKGJpbmRpbmcpIHsKICAgICAgICAgIGNhc2UgZ2wuQUNUSVZFX1RFWFRVUkU6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5BUlJBWV9CVUZGRVJfQklORElORzoKICAgICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJvdW5kVmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuQ09MT1JfQ0xFQVJfVkFMVUU6CiAgICAgICAgICAgIGdsLmNsZWFyQ29sb3IoYm91bmRWYWx1ZVswXSwgYm91bmRWYWx1ZVsxXSwgYm91bmRWYWx1ZVsyXSwgYm91bmRWYWx1ZVszXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5DT0xPUl9XUklURU1BU0s6CiAgICAgICAgICAgIGdsLmNvbG9yTWFzayhib3VuZFZhbHVlWzBdLCBib3VuZFZhbHVlWzFdLCBib3VuZFZhbHVlWzJdLCBib3VuZFZhbHVlWzNdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkNVUlJFTlRfUFJPR1JBTToKICAgICAgICAgICAgZ2wudXNlUHJvZ3JhbShib3VuZFZhbHVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkc6CiAgICAgICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIGJvdW5kVmFsdWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgZ2wuRlJBTUVCVUZGRVJfQklORElORzoKICAgICAgICAgICAgZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBib3VuZFZhbHVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIGdsLlJFTkRFUkJVRkZFUl9CSU5ESU5HOgogICAgICAgICAgICBnbC5iaW5kUmVuZGVyYnVmZmVyKGdsLlJFTkRFUkJVRkZFUiwgYm91bmRWYWx1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5URVhUVVJFX0JJTkRJTkdfMkQ6CiAgICAgICAgICAgIHZhciB0ZXh0dXJlVW5pdCA9IGJpbmRpbmdzWysraV07CiAgICAgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleHR1cmVVbml0KTsKICAgICAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgYm91bmRWYWx1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5URVhUVVJFX0JJTkRJTkdfQ1VCRV9NQVA6CiAgICAgICAgICAgIHZhciB0ZXh0dXJlVW5pdCA9IGJpbmRpbmdzWysraV07CiAgICAgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBnbC5hY3RpdmVUZXh0dXJlKHRleHR1cmVVbml0KTsKICAgICAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgYm91bmRWYWx1ZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5WSUVXUE9SVDoKICAgICAgICAgICAgZ2wudmlld3BvcnQoYm91bmRWYWx1ZVswXSwgYm91bmRWYWx1ZVsxXSwgYm91bmRWYWx1ZVsyXSwgYm91bmRWYWx1ZVszXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBnbC5CTEVORDoKICAgICAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgogICAgICAgICAgY2FzZSBnbC5ERVBUSF9URVNUOgogICAgICAgICAgY2FzZSBnbC5TQ0lTU09SX1RFU1Q6CiAgICAgICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKICAgICAgICAgICAgaWYgKGJvdW5kVmFsdWUpIHsKICAgICAgICAgICAgICBnbC5lbmFibGUoYmluZGluZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZ2wuZGlzYWJsZShiaW5kaW5nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyBHTCByZXN0b3JlIGJlaGF2aW9yIGZvciAweCIgKyBiaW5kaW5nLnRvU3RyaW5nKDE2KSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoYWN0aXZlVGV4dHVyZSkgewogICAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZShhY3RpdmVUZXh0dXJlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHZhciBnbFByZXNlcnZlU3RhdGUgPSBXR0xVUHJlc2VydmVHTFN0YXRlOwogICAgdmFyIGRpc3RvcnRpb25WUyA9IFsnYXR0cmlidXRlIHZlYzIgcG9zaXRpb247JywgJ2F0dHJpYnV0ZSB2ZWMzIHRleENvb3JkOycsICd2YXJ5aW5nIHZlYzIgdlRleENvb3JkOycsICd1bmlmb3JtIHZlYzQgdmlld3BvcnRPZmZzZXRTY2FsZVsyXTsnLCAndm9pZCBtYWluKCkgeycsICcgIHZlYzQgdmlld3BvcnQgPSB2aWV3cG9ydE9mZnNldFNjYWxlW2ludCh0ZXhDb29yZC56KV07JywgJyAgdlRleENvb3JkID0gKHRleENvb3JkLnh5ICogdmlld3BvcnQuencpICsgdmlld3BvcnQueHk7JywgJyAgZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wLCAxLjAgKTsnLCAnfSddLmpvaW4oJ1xuJyk7CiAgICB2YXIgZGlzdG9ydGlvbkZTID0gWydwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLCAndW5pZm9ybSBzYW1wbGVyMkQgZGlmZnVzZTsnLCAndmFyeWluZyB2ZWMyIHZUZXhDb29yZDsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChkaWZmdXNlLCB2VGV4Q29vcmQpOycsICd9J10uam9pbignXG4nKTsKICAgIGZ1bmN0aW9uIENhcmRib2FyZERpc3RvcnRlcihnbCwgY2FyZGJvYXJkVUksIGJ1ZmZlclNjYWxlLCBkaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MpIHsKICAgICAgdGhpcy5nbCA9IGdsOwogICAgICB0aGlzLmNhcmRib2FyZFVJID0gY2FyZGJvYXJkVUk7CiAgICAgIHRoaXMuYnVmZmVyU2NhbGUgPSBidWZmZXJTY2FsZTsKICAgICAgdGhpcy5kaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MgPSBkaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3M7CiAgICAgIHRoaXMuY3R4QXR0cmlicyA9IGdsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CiAgICAgIHRoaXMuaW5zdGFuY2VFeHQgPSBnbC5nZXRFeHRlbnNpb24oJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnKTsKICAgICAgdGhpcy5tZXNoV2lkdGggPSAyMDsKICAgICAgdGhpcy5tZXNoSGVpZ2h0ID0gMjA7CiAgICAgIHRoaXMuYnVmZmVyV2lkdGggPSBnbC5kcmF3aW5nQnVmZmVyV2lkdGg7CiAgICAgIHRoaXMuYnVmZmVySGVpZ2h0ID0gZ2wuZHJhd2luZ0J1ZmZlckhlaWdodDsKICAgICAgdGhpcy5yZWFsQmluZEZyYW1lYnVmZmVyID0gZ2wuYmluZEZyYW1lYnVmZmVyOwogICAgICB0aGlzLnJlYWxFbmFibGUgPSBnbC5lbmFibGU7CiAgICAgIHRoaXMucmVhbERpc2FibGUgPSBnbC5kaXNhYmxlOwogICAgICB0aGlzLnJlYWxDb2xvck1hc2sgPSBnbC5jb2xvck1hc2s7CiAgICAgIHRoaXMucmVhbENsZWFyQ29sb3IgPSBnbC5jbGVhckNvbG9yOwogICAgICB0aGlzLnJlYWxWaWV3cG9ydCA9IGdsLnZpZXdwb3J0OwogICAgICBpZiAoIWlzSU9TKCkpIHsKICAgICAgICB0aGlzLnJlYWxDYW52YXNXaWR0aCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZ2wuY2FudmFzLl9fcHJvdG9fXywgJ3dpZHRoJyk7CiAgICAgICAgdGhpcy5yZWFsQ2FudmFzSGVpZ2h0ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihnbC5jYW52YXMuX19wcm90b19fLCAnaGVpZ2h0Jyk7CiAgICAgIH0KICAgICAgdGhpcy5pc1BhdGNoZWQgPSBmYWxzZTsKICAgICAgdGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IG51bGw7CiAgICAgIHRoaXMuY3VsbEZhY2UgPSBmYWxzZTsKICAgICAgdGhpcy5kZXB0aFRlc3QgPSBmYWxzZTsKICAgICAgdGhpcy5ibGVuZCA9IGZhbHNlOwogICAgICB0aGlzLnNjaXNzb3JUZXN0ID0gZmFsc2U7CiAgICAgIHRoaXMuc3RlbmNpbFRlc3QgPSBmYWxzZTsKICAgICAgdGhpcy52aWV3cG9ydCA9IFswLCAwLCAwLCAwXTsKICAgICAgdGhpcy5jb2xvck1hc2sgPSBbdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZV07CiAgICAgIHRoaXMuY2xlYXJDb2xvciA9IFswLCAwLCAwLCAwXTsKICAgICAgdGhpcy5hdHRyaWJzID0gewogICAgICAgIHBvc2l0aW9uOiAwLAogICAgICAgIHRleENvb3JkOiAxCiAgICAgIH07CiAgICAgIHRoaXMucHJvZ3JhbSA9IGxpbmtQcm9ncmFtKGdsLCBkaXN0b3J0aW9uVlMsIGRpc3RvcnRpb25GUywgdGhpcy5hdHRyaWJzKTsKICAgICAgdGhpcy51bmlmb3JtcyA9IGdldFByb2dyYW1Vbmlmb3JtcyhnbCwgdGhpcy5wcm9ncmFtKTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlID0gbmV3IEZsb2F0MzJBcnJheSg4KTsKICAgICAgdGhpcy5zZXRUZXh0dXJlQm91bmRzKCk7CiAgICAgIHRoaXMudmVydGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CiAgICAgIHRoaXMuaW5kZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgICAgdGhpcy5pbmRleENvdW50ID0gMDsKICAgICAgdGhpcy5yZW5kZXJUYXJnZXQgPSBnbC5jcmVhdGVUZXh0dXJlKCk7CiAgICAgIHRoaXMuZnJhbWVidWZmZXIgPSBnbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwogICAgICB0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlciA9IG51bGw7CiAgICAgIHRoaXMuZGVwdGhCdWZmZXIgPSBudWxsOwogICAgICB0aGlzLnN0ZW5jaWxCdWZmZXIgPSBudWxsOwogICAgICBpZiAodGhpcy5jdHhBdHRyaWJzLmRlcHRoICYmIHRoaXMuY3R4QXR0cmlicy5zdGVuY2lsKSB7CiAgICAgICAgdGhpcy5kZXB0aFN0ZW5jaWxCdWZmZXIgPSBnbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmN0eEF0dHJpYnMuZGVwdGgpIHsKICAgICAgICB0aGlzLmRlcHRoQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jdHhBdHRyaWJzLnN0ZW5jaWwpIHsKICAgICAgICB0aGlzLnN0ZW5jaWxCdWZmZXIgPSBnbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKICAgICAgfQogICAgICB0aGlzLnBhdGNoKCk7CiAgICAgIHRoaXMub25SZXNpemUoKTsKICAgIH0KICAgIENhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgdGhpcy51bnBhdGNoKCk7CiAgICAgIGdsLmRlbGV0ZVByb2dyYW0odGhpcy5wcm9ncmFtKTsKICAgICAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMudmVydGV4QnVmZmVyKTsKICAgICAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMuaW5kZXhCdWZmZXIpOwogICAgICBnbC5kZWxldGVUZXh0dXJlKHRoaXMucmVuZGVyVGFyZ2V0KTsKICAgICAgZ2wuZGVsZXRlRnJhbWVidWZmZXIodGhpcy5mcmFtZWJ1ZmZlcik7CiAgICAgIGlmICh0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlcikgewogICAgICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlcik7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZGVwdGhCdWZmZXIpIHsKICAgICAgICBnbC5kZWxldGVSZW5kZXJidWZmZXIodGhpcy5kZXB0aEJ1ZmZlcik7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc3RlbmNpbEJ1ZmZlcikgewogICAgICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLnN0ZW5jaWxCdWZmZXIpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmNhcmRib2FyZFVJKSB7CiAgICAgICAgdGhpcy5jYXJkYm9hcmRVSS5kZXN0cm95KCk7CiAgICAgIH0KICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZ2wgPSB0aGlzLmdsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBnbFN0YXRlID0gW2dsLlJFTkRFUkJVRkZFUl9CSU5ESU5HLCBnbC5URVhUVVJFX0JJTkRJTkdfMkQsIGdsLlRFWFRVUkUwXTsKICAgICAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKICAgICAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICAgIGlmIChzZWxmLnNjaXNzb3JUZXN0KSB7CiAgICAgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CiAgICAgICAgfQogICAgICAgIHNlbGYucmVhbENvbG9yTWFzay5jYWxsKGdsLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKTsKICAgICAgICBzZWxmLnJlYWxWaWV3cG9ydC5jYWxsKGdsLCAwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwogICAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMSk7CiAgICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CiAgICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBzZWxmLmZyYW1lYnVmZmVyKTsKICAgICAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCk7CiAgICAgICAgZ2wudGV4SW1hZ2UyRChnbC5URVhUVVJFXzJELCAwLCBzZWxmLmN0eEF0dHJpYnMuYWxwaGEgPyBnbC5SR0JBIDogZ2wuUkdCLCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCwgMCwgc2VsZi5jdHhBdHRyaWJzLmFscGhhID8gZ2wuUkdCQSA6IGdsLlJHQiwgZ2wuVU5TSUdORURfQllURSwgbnVsbCk7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01BR19GSUxURVIsIGdsLkxJTkVBUik7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfUywgZ2wuQ0xBTVBfVE9fRURHRSk7CiAgICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgZ2wuQ0xBTVBfVE9fRURHRSk7CiAgICAgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCwgMCk7CiAgICAgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5kZXB0aCAmJiBzZWxmLmN0eEF0dHJpYnMuc3RlbmNpbCkgewogICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhTdGVuY2lsQnVmZmVyKTsKICAgICAgICAgIGdsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoZ2wuUkVOREVSQlVGRkVSLCBnbC5ERVBUSF9TVEVOQ0lMLCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCk7CiAgICAgICAgICBnbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5ULCBnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhTdGVuY2lsQnVmZmVyKTsKICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY3R4QXR0cmlicy5kZXB0aCkgewogICAgICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhCdWZmZXIpOwogICAgICAgICAgZ2wucmVuZGVyYnVmZmVyU3RvcmFnZShnbC5SRU5ERVJCVUZGRVIsIGdsLkRFUFRIX0NPTVBPTkVOVDE2LCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCk7CiAgICAgICAgICBnbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgZ2wuREVQVEhfQVRUQUNITUVOVCwgZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoQnVmZmVyKTsKICAgICAgICB9IGVsc2UgaWYgKHNlbGYuY3R4QXR0cmlicy5zdGVuY2lsKSB7CiAgICAgICAgICBnbC5iaW5kUmVuZGVyYnVmZmVyKGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5zdGVuY2lsQnVmZmVyKTsKICAgICAgICAgIGdsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoZ2wuUkVOREVSQlVGRkVSLCBnbC5TVEVOQ0lMX0lOREVYOCwgc2VsZi5idWZmZXJXaWR0aCwgc2VsZi5idWZmZXJIZWlnaHQpOwogICAgICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLlNURU5DSUxfQVRUQUNITUVOVCwgZ2wuUkVOREVSQlVGRkVSLCBzZWxmLnN0ZW5jaWxCdWZmZXIpOwogICAgICAgIH0KICAgICAgICBpZiAoIWdsLmNoZWNrRnJhbWVidWZmZXJTdGF0dXMoZ2wuRlJBTUVCVUZGRVIpID09PSBnbC5GUkFNRUJVRkZFUl9DT01QTEVURSkgewogICAgICAgICAgY29uc29sZS5lcnJvcignRnJhbWVidWZmZXIgaW5jb21wbGV0ZSEnKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBzZWxmLmxhc3RCb3VuZEZyYW1lYnVmZmVyKTsKICAgICAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewogICAgICAgICAgc2VsZi5yZWFsRW5hYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CiAgICAgICAgfQogICAgICAgIHNlbGYucmVhbENvbG9yTWFzay5hcHBseShnbCwgc2VsZi5jb2xvck1hc2spOwogICAgICAgIHNlbGYucmVhbFZpZXdwb3J0LmFwcGx5KGdsLCBzZWxmLnZpZXdwb3J0KTsKICAgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmFwcGx5KGdsLCBzZWxmLmNsZWFyQ29sb3IpOwogICAgICB9KTsKICAgICAgaWYgKHRoaXMuY2FyZGJvYXJkVUkpIHsKICAgICAgICB0aGlzLmNhcmRib2FyZFVJLm9uUmVzaXplKCk7CiAgICAgIH0KICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnBhdGNoID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5pc1BhdGNoZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgY2FudmFzID0gdGhpcy5nbC5jYW52YXM7CiAgICAgIHZhciBnbCA9IHRoaXMuZ2w7CiAgICAgIGlmICghaXNJT1MoKSkgewogICAgICAgIGNhbnZhcy53aWR0aCA9IGdldFNjcmVlbldpZHRoKCkgKiB0aGlzLmJ1ZmZlclNjYWxlOwogICAgICAgIGNhbnZhcy5oZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKSAqIHRoaXMuYnVmZmVyU2NhbGU7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ3dpZHRoJywgewogICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICByZXR1cm4gc2VsZi5idWZmZXJXaWR0aDsKICAgICAgICAgIH0sCiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewogICAgICAgICAgICBzZWxmLmJ1ZmZlcldpZHRoID0gdmFsdWU7CiAgICAgICAgICAgIHNlbGYucmVhbENhbnZhc1dpZHRoLnNldC5jYWxsKGNhbnZhcywgdmFsdWUpOwogICAgICAgICAgICBzZWxmLm9uUmVzaXplKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ2hlaWdodCcsIHsKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNlbGYuYnVmZmVySGVpZ2h0OwogICAgICAgICAgfSwKICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CiAgICAgICAgICAgIHNlbGYuYnVmZmVySGVpZ2h0ID0gdmFsdWU7CiAgICAgICAgICAgIHNlbGYucmVhbENhbnZhc0hlaWdodC5zZXQuY2FsbChjYW52YXMsIHZhbHVlKTsKICAgICAgICAgICAgc2VsZi5vblJlc2l6ZSgpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHRoaXMubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuRlJBTUVCVUZGRVJfQklORElORyk7CiAgICAgIGlmICh0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID09IG51bGwpIHsKICAgICAgICB0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID0gdGhpcy5mcmFtZWJ1ZmZlcjsKICAgICAgICB0aGlzLmdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgdGhpcy5mcmFtZWJ1ZmZlcik7CiAgICAgIH0KICAgICAgdGhpcy5nbC5iaW5kRnJhbWVidWZmZXIgPSBmdW5jdGlvbiAodGFyZ2V0LCBmcmFtZWJ1ZmZlcikgewogICAgICAgIHNlbGYubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlciA/IGZyYW1lYnVmZmVyIDogc2VsZi5mcmFtZWJ1ZmZlcjsKICAgICAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgdGFyZ2V0LCBzZWxmLmxhc3RCb3VuZEZyYW1lYnVmZmVyKTsKICAgICAgfTsKICAgICAgdGhpcy5jdWxsRmFjZSA9IGdsLmdldFBhcmFtZXRlcihnbC5DVUxMX0ZBQ0UpOwogICAgICB0aGlzLmRlcHRoVGVzdCA9IGdsLmdldFBhcmFtZXRlcihnbC5ERVBUSF9URVNUKTsKICAgICAgdGhpcy5ibGVuZCA9IGdsLmdldFBhcmFtZXRlcihnbC5CTEVORCk7CiAgICAgIHRoaXMuc2Npc3NvclRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuU0NJU1NPUl9URVNUKTsKICAgICAgdGhpcy5zdGVuY2lsVGVzdCA9IGdsLmdldFBhcmFtZXRlcihnbC5TVEVOQ0lMX1RFU1QpOwogICAgICBnbC5lbmFibGUgPSBmdW5jdGlvbiAocG5hbWUpIHsKICAgICAgICBzd2l0Y2ggKHBuYW1lKSB7CiAgICAgICAgICBjYXNlIGdsLkNVTExfRkFDRToKICAgICAgICAgICAgc2VsZi5jdWxsRmFjZSA9IHRydWU7YnJlYWs7CiAgICAgICAgICBjYXNlIGdsLkRFUFRIX1RFU1Q6CiAgICAgICAgICAgIHNlbGYuZGVwdGhUZXN0ID0gdHJ1ZTticmVhazsKICAgICAgICAgIGNhc2UgZ2wuQkxFTkQ6CiAgICAgICAgICAgIHNlbGYuYmxlbmQgPSB0cnVlO2JyZWFrOwogICAgICAgICAgY2FzZSBnbC5TQ0lTU09SX1RFU1Q6CiAgICAgICAgICAgIHNlbGYuc2Npc3NvclRlc3QgPSB0cnVlO2JyZWFrOwogICAgICAgICAgY2FzZSBnbC5TVEVOQ0lMX1RFU1Q6CiAgICAgICAgICAgIHNlbGYuc3RlbmNpbFRlc3QgPSB0cnVlO2JyZWFrOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgcG5hbWUpOwogICAgICB9OwogICAgICBnbC5kaXNhYmxlID0gZnVuY3Rpb24gKHBuYW1lKSB7CiAgICAgICAgc3dpdGNoIChwbmFtZSkgewogICAgICAgICAgY2FzZSBnbC5DVUxMX0ZBQ0U6CiAgICAgICAgICAgIHNlbGYuY3VsbEZhY2UgPSBmYWxzZTticmVhazsKICAgICAgICAgIGNhc2UgZ2wuREVQVEhfVEVTVDoKICAgICAgICAgICAgc2VsZi5kZXB0aFRlc3QgPSBmYWxzZTticmVhazsKICAgICAgICAgIGNhc2UgZ2wuQkxFTkQ6CiAgICAgICAgICAgIHNlbGYuYmxlbmQgPSBmYWxzZTticmVhazsKICAgICAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgogICAgICAgICAgICBzZWxmLnNjaXNzb3JUZXN0ID0gZmFsc2U7YnJlYWs7CiAgICAgICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKICAgICAgICAgICAgc2VsZi5zdGVuY2lsVGVzdCA9IGZhbHNlO2JyZWFrOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIHBuYW1lKTsKICAgICAgfTsKICAgICAgdGhpcy5jb2xvck1hc2sgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQ09MT1JfV1JJVEVNQVNLKTsKICAgICAgZ2wuY29sb3JNYXNrID0gZnVuY3Rpb24gKHIsIGcsIGIsIGEpIHsKICAgICAgICBzZWxmLmNvbG9yTWFza1swXSA9IHI7CiAgICAgICAgc2VsZi5jb2xvck1hc2tbMV0gPSBnOwogICAgICAgIHNlbGYuY29sb3JNYXNrWzJdID0gYjsKICAgICAgICBzZWxmLmNvbG9yTWFza1szXSA9IGE7CiAgICAgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHIsIGcsIGIsIGEpOwogICAgICB9OwogICAgICB0aGlzLmNsZWFyQ29sb3IgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQ09MT1JfQ0xFQVJfVkFMVUUpOwogICAgICBnbC5jbGVhckNvbG9yID0gZnVuY3Rpb24gKHIsIGcsIGIsIGEpIHsKICAgICAgICBzZWxmLmNsZWFyQ29sb3JbMF0gPSByOwogICAgICAgIHNlbGYuY2xlYXJDb2xvclsxXSA9IGc7CiAgICAgICAgc2VsZi5jbGVhckNvbG9yWzJdID0gYjsKICAgICAgICBzZWxmLmNsZWFyQ29sb3JbM10gPSBhOwogICAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgciwgZywgYiwgYSk7CiAgICAgIH07CiAgICAgIHRoaXMudmlld3BvcnQgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuVklFV1BPUlQpOwogICAgICBnbC52aWV3cG9ydCA9IGZ1bmN0aW9uICh4LCB5LCB3LCBoKSB7CiAgICAgICAgc2VsZi52aWV3cG9ydFswXSA9IHg7CiAgICAgICAgc2VsZi52aWV3cG9ydFsxXSA9IHk7CiAgICAgICAgc2VsZi52aWV3cG9ydFsyXSA9IHc7CiAgICAgICAgc2VsZi52aWV3cG9ydFszXSA9IGg7CiAgICAgICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgeCwgeSwgdywgaCk7CiAgICAgIH07CiAgICAgIHRoaXMuaXNQYXRjaGVkID0gdHJ1ZTsKICAgICAgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQoY2FudmFzKTsKICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnVucGF0Y2ggPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5pc1BhdGNoZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuZ2wuY2FudmFzOwogICAgICBpZiAoIWlzSU9TKCkpIHsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY2FudmFzLCAnd2lkdGgnLCB0aGlzLnJlYWxDYW52YXNXaWR0aCk7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ2hlaWdodCcsIHRoaXMucmVhbENhbnZhc0hlaWdodCk7CiAgICAgIH0KICAgICAgY2FudmFzLndpZHRoID0gdGhpcy5idWZmZXJXaWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IHRoaXMuYnVmZmVySGVpZ2h0OwogICAgICBnbC5iaW5kRnJhbWVidWZmZXIgPSB0aGlzLnJlYWxCaW5kRnJhbWVidWZmZXI7CiAgICAgIGdsLmVuYWJsZSA9IHRoaXMucmVhbEVuYWJsZTsKICAgICAgZ2wuZGlzYWJsZSA9IHRoaXMucmVhbERpc2FibGU7CiAgICAgIGdsLmNvbG9yTWFzayA9IHRoaXMucmVhbENvbG9yTWFzazsKICAgICAgZ2wuY2xlYXJDb2xvciA9IHRoaXMucmVhbENsZWFyQ29sb3I7CiAgICAgIGdsLnZpZXdwb3J0ID0gdGhpcy5yZWFsVmlld3BvcnQ7CiAgICAgIGlmICh0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID09IHRoaXMuZnJhbWVidWZmZXIpIHsKICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICB9CiAgICAgIHRoaXMuaXNQYXRjaGVkID0gZmFsc2U7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIHNhZmFyaUNzc1NpemVXb3JrYXJvdW5kKGNhbnZhcyk7CiAgICAgIH0sIDEpOwogICAgfTsKICAgIENhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuc2V0VGV4dHVyZUJvdW5kcyA9IGZ1bmN0aW9uIChsZWZ0Qm91bmRzLCByaWdodEJvdW5kcykgewogICAgICBpZiAoIWxlZnRCb3VuZHMpIHsKICAgICAgICBsZWZ0Qm91bmRzID0gWzAsIDAsIDAuNSwgMV07CiAgICAgIH0KICAgICAgaWYgKCFyaWdodEJvdW5kcykgewogICAgICAgIHJpZ2h0Qm91bmRzID0gWzAuNSwgMCwgMC41LCAxXTsKICAgICAgfQogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbMF0gPSBsZWZ0Qm91bmRzWzBdOwogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbMV0gPSBsZWZ0Qm91bmRzWzFdOwogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbMl0gPSBsZWZ0Qm91bmRzWzJdOwogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbM10gPSBsZWZ0Qm91bmRzWzNdOwogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbNF0gPSByaWdodEJvdW5kc1swXTsKICAgICAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzVdID0gcmlnaHRCb3VuZHNbMV07CiAgICAgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs2XSA9IHJpZ2h0Qm91bmRzWzJdOwogICAgICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbN10gPSByaWdodEJvdW5kc1szXTsKICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZ2wgPSB0aGlzLmdsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBnbFN0YXRlID0gW107CiAgICAgIGlmICghdGhpcy5kaXJ0eVN1Ym1pdEZyYW1lQmluZGluZ3MpIHsKICAgICAgICBnbFN0YXRlLnB1c2goZ2wuQ1VSUkVOVF9QUk9HUkFNLCBnbC5BUlJBWV9CVUZGRVJfQklORElORywgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVJfQklORElORywgZ2wuVEVYVFVSRV9CSU5ESU5HXzJELCBnbC5URVhUVVJFMCk7CiAgICAgIH0KICAgICAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKICAgICAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwogICAgICAgIHZhciBwb3NpdGlvbkRpdmlzb3IgPSAwOwogICAgICAgIHZhciB0ZXhDb29yZERpdmlzb3IgPSAwOwogICAgICAgIGlmIChzZWxmLmluc3RhbmNlRXh0KSB7CiAgICAgICAgICBwb3NpdGlvbkRpdmlzb3IgPSBnbC5nZXRWZXJ0ZXhBdHRyaWIoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCBzZWxmLmluc3RhbmNlRXh0LlZFUlRFWF9BVFRSSUJfQVJSQVlfRElWSVNPUl9BTkdMRSk7CiAgICAgICAgICB0ZXhDb29yZERpdmlzb3IgPSBnbC5nZXRWZXJ0ZXhBdHRyaWIoc2VsZi5hdHRyaWJzLnRleENvb3JkLCBzZWxmLmluc3RhbmNlRXh0LlZFUlRFWF9BVFRSSUJfQVJSQVlfRElWSVNPUl9BTkdMRSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLmN1bGxGYWNlKSB7CiAgICAgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLkNVTExfRkFDRSk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLmRlcHRoVGVzdCkgewogICAgICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5ERVBUSF9URVNUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuYmxlbmQpIHsKICAgICAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuQkxFTkQpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewogICAgICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TQ0lTU09SX1RFU1QpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5zdGVuY2lsVGVzdCkgewogICAgICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TVEVOQ0lMX1RFU1QpOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxDb2xvck1hc2suY2FsbChnbCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7CiAgICAgICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKICAgICAgICBpZiAoc2VsZi5jdHhBdHRyaWJzLmFscGhhIHx8IGlzSU9TKCkpIHsKICAgICAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMSk7CiAgICAgICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTsKICAgICAgICB9CiAgICAgICAgZ2wudXNlUHJvZ3JhbShzZWxmLnByb2dyYW0pOwogICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIsIHNlbGYuaW5kZXhCdWZmZXIpOwogICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBzZWxmLnZlcnRleEJ1ZmZlcik7CiAgICAgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoc2VsZi5hdHRyaWJzLnBvc2l0aW9uKTsKICAgICAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShzZWxmLmF0dHJpYnMudGV4Q29vcmQpOwogICAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDIwLCAwKTsKICAgICAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgMywgZ2wuRkxPQVQsIGZhbHNlLCAyMCwgOCk7CiAgICAgICAgaWYgKHNlbGYuaW5zdGFuY2VFeHQpIHsKICAgICAgICAgIGlmIChwb3NpdGlvbkRpdmlzb3IgIT0gMCkgewogICAgICAgICAgICBzZWxmLmluc3RhbmNlRXh0LnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShzZWxmLmF0dHJpYnMucG9zaXRpb24sIDApOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRleENvb3JkRGl2aXNvciAhPSAwKSB7CiAgICAgICAgICAgIHNlbGYuaW5zdGFuY2VFeHQudmVydGV4QXR0cmliRGl2aXNvckFOR0xFKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApOwogICAgICAgIGdsLnVuaWZvcm0xaShzZWxmLnVuaWZvcm1zLmRpZmZ1c2UsIDApOwogICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHNlbGYucmVuZGVyVGFyZ2V0KTsKICAgICAgICBnbC51bmlmb3JtNGZ2KHNlbGYudW5pZm9ybXMudmlld3BvcnRPZmZzZXRTY2FsZSwgc2VsZi52aWV3cG9ydE9mZnNldFNjYWxlKTsKICAgICAgICBnbC5kcmF3RWxlbWVudHMoZ2wuVFJJQU5HTEVTLCBzZWxmLmluZGV4Q291bnQsIGdsLlVOU0lHTkVEX1NIT1JULCAwKTsKICAgICAgICBpZiAoc2VsZi5jYXJkYm9hcmRVSSkgewogICAgICAgICAgc2VsZi5jYXJkYm9hcmRVSS5yZW5kZXJOb1N0YXRlKCk7CiAgICAgICAgfQogICAgICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKHNlbGYuZ2wsIGdsLkZSQU1FQlVGRkVSLCBzZWxmLmZyYW1lYnVmZmVyKTsKICAgICAgICBpZiAoIXNlbGYuY3R4QXR0cmlicy5wcmVzZXJ2ZURyYXdpbmdCdWZmZXIpIHsKICAgICAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMCk7CiAgICAgICAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzZWxmLmRpcnR5U3VibWl0RnJhbWVCaW5kaW5ncykgewogICAgICAgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBzZWxmLmxhc3RCb3VuZEZyYW1lYnVmZmVyKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuY3VsbEZhY2UpIHsKICAgICAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5DVUxMX0ZBQ0UpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VsZi5kZXB0aFRlc3QpIHsKICAgICAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5ERVBUSF9URVNUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuYmxlbmQpIHsKICAgICAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5CTEVORCk7CiAgICAgICAgfQogICAgICAgIGlmIChzZWxmLnNjaXNzb3JUZXN0KSB7CiAgICAgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU0NJU1NPUl9URVNUKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuc3RlbmNpbFRlc3QpIHsKICAgICAgICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBnbC5TVEVOQ0lMX1RFU1QpOwogICAgICAgIH0KICAgICAgICBzZWxmLnJlYWxDb2xvck1hc2suYXBwbHkoZ2wsIHNlbGYuY29sb3JNYXNrKTsKICAgICAgICBzZWxmLnJlYWxWaWV3cG9ydC5hcHBseShnbCwgc2VsZi52aWV3cG9ydCk7CiAgICAgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5hbHBoYSB8fCAhc2VsZi5jdHhBdHRyaWJzLnByZXNlcnZlRHJhd2luZ0J1ZmZlcikgewogICAgICAgICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5hcHBseShnbCwgc2VsZi5jbGVhckNvbG9yKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGYuaW5zdGFuY2VFeHQpIHsKICAgICAgICAgIGlmIChwb3NpdGlvbkRpdmlzb3IgIT0gMCkgewogICAgICAgICAgICBzZWxmLmluc3RhbmNlRXh0LnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShzZWxmLmF0dHJpYnMucG9zaXRpb24sIHBvc2l0aW9uRGl2aXNvcik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGV4Q29vcmREaXZpc29yICE9IDApIHsKICAgICAgICAgICAgc2VsZi5pbnN0YW5jZUV4dC52ZXJ0ZXhBdHRyaWJEaXZpc29yQU5HTEUoc2VsZi5hdHRyaWJzLnRleENvb3JkLCB0ZXhDb29yZERpdmlzb3IpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGlmIChpc0lPUygpKSB7CiAgICAgICAgdmFyIGNhbnZhcyA9IGdsLmNhbnZhczsKICAgICAgICBpZiAoY2FudmFzLndpZHRoICE9IHNlbGYuYnVmZmVyV2lkdGggfHwgY2FudmFzLmhlaWdodCAhPSBzZWxmLmJ1ZmZlckhlaWdodCkgewogICAgICAgICAgc2VsZi5idWZmZXJXaWR0aCA9IGNhbnZhcy53aWR0aDsKICAgICAgICAgIHNlbGYuYnVmZmVySGVpZ2h0ID0gY2FudmFzLmhlaWdodDsKICAgICAgICAgIHNlbGYub25SZXNpemUoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnVwZGF0ZURldmljZUluZm8gPSBmdW5jdGlvbiAoZGV2aWNlSW5mbykgewogICAgICB2YXIgZ2wgPSB0aGlzLmdsOwogICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgIHZhciBnbFN0YXRlID0gW2dsLkFSUkFZX0JVRkZFUl9CSU5ESU5HLCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUl9CSU5ESU5HXTsKICAgICAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKICAgICAgICB2YXIgdmVydGljZXMgPSBzZWxmLmNvbXB1dGVNZXNoVmVydGljZXNfKHNlbGYubWVzaFdpZHRoLCBzZWxmLm1lc2hIZWlnaHQsIGRldmljZUluZm8pOwogICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBzZWxmLnZlcnRleEJ1ZmZlcik7CiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHZlcnRpY2VzLCBnbC5TVEFUSUNfRFJBVyk7CiAgICAgICAgaWYgKCFzZWxmLmluZGV4Q291bnQpIHsKICAgICAgICAgIHZhciBpbmRpY2VzID0gc2VsZi5jb21wdXRlTWVzaEluZGljZXNfKHNlbGYubWVzaFdpZHRoLCBzZWxmLm1lc2hIZWlnaHQpOwogICAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgc2VsZi5pbmRleEJ1ZmZlcik7CiAgICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBpbmRpY2VzLCBnbC5TVEFUSUNfRFJBVyk7CiAgICAgICAgICBzZWxmLmluZGV4Q291bnQgPSBpbmRpY2VzLmxlbmd0aDsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIENhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuY29tcHV0ZU1lc2hWZXJ0aWNlc18gPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgZGV2aWNlSW5mbykgewogICAgICB2YXIgdmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KDIgKiB3aWR0aCAqIGhlaWdodCAqIDUpOwogICAgICB2YXIgbGVuc0ZydXN0dW0gPSBkZXZpY2VJbmZvLmdldExlZnRFeWVWaXNpYmxlVGFuQW5nbGVzKCk7CiAgICAgIHZhciBub0xlbnNGcnVzdHVtID0gZGV2aWNlSW5mby5nZXRMZWZ0RXllTm9MZW5zVGFuQW5nbGVzKCk7CiAgICAgIHZhciB2aWV3cG9ydCA9IGRldmljZUluZm8uZ2V0TGVmdEV5ZVZpc2libGVTY3JlZW5SZWN0KG5vTGVuc0ZydXN0dW0pOwogICAgICB2YXIgdmlkeCA9IDA7CiAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgMjsgZSsrKSB7CiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBoZWlnaHQ7IGorKykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrLCB2aWR4KyspIHsKICAgICAgICAgICAgdmFyIHUgPSBpIC8gKHdpZHRoIC0gMSk7CiAgICAgICAgICAgIHZhciB2ID0gaiAvIChoZWlnaHQgLSAxKTsKICAgICAgICAgICAgdmFyIHMgPSB1OwogICAgICAgICAgICB2YXIgdCA9IHY7CiAgICAgICAgICAgIHZhciB4ID0gbGVycChsZW5zRnJ1c3R1bVswXSwgbGVuc0ZydXN0dW1bMl0sIHUpOwogICAgICAgICAgICB2YXIgeSA9IGxlcnAobGVuc0ZydXN0dW1bM10sIGxlbnNGcnVzdHVtWzFdLCB2KTsKICAgICAgICAgICAgdmFyIGQgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7CiAgICAgICAgICAgIHZhciByID0gZGV2aWNlSW5mby5kaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKGQpOwogICAgICAgICAgICB2YXIgcCA9IHggKiByIC8gZDsKICAgICAgICAgICAgdmFyIHEgPSB5ICogciAvIGQ7CiAgICAgICAgICAgIHUgPSAocCAtIG5vTGVuc0ZydXN0dW1bMF0pIC8gKG5vTGVuc0ZydXN0dW1bMl0gLSBub0xlbnNGcnVzdHVtWzBdKTsKICAgICAgICAgICAgdiA9IChxIC0gbm9MZW5zRnJ1c3R1bVszXSkgLyAobm9MZW5zRnJ1c3R1bVsxXSAtIG5vTGVuc0ZydXN0dW1bM10pOwogICAgICAgICAgICB1ID0gKHZpZXdwb3J0LnggKyB1ICogdmlld3BvcnQud2lkdGggLSAwLjUpICogMi4wOwogICAgICAgICAgICB2ID0gKHZpZXdwb3J0LnkgKyB2ICogdmlld3BvcnQuaGVpZ2h0IC0gMC41KSAqIDIuMDsKICAgICAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAwXSA9IHU7CiAgICAgICAgICAgIHZlcnRpY2VzW3ZpZHggKiA1ICsgMV0gPSB2OwogICAgICAgICAgICB2ZXJ0aWNlc1t2aWR4ICogNSArIDJdID0gczsKICAgICAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAzXSA9IHQ7CiAgICAgICAgICAgIHZlcnRpY2VzW3ZpZHggKiA1ICsgNF0gPSBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgdyA9IGxlbnNGcnVzdHVtWzJdIC0gbGVuc0ZydXN0dW1bMF07CiAgICAgICAgbGVuc0ZydXN0dW1bMF0gPSAtKHcgKyBsZW5zRnJ1c3R1bVswXSk7CiAgICAgICAgbGVuc0ZydXN0dW1bMl0gPSB3IC0gbGVuc0ZydXN0dW1bMl07CiAgICAgICAgdyA9IG5vTGVuc0ZydXN0dW1bMl0gLSBub0xlbnNGcnVzdHVtWzBdOwogICAgICAgIG5vTGVuc0ZydXN0dW1bMF0gPSAtKHcgKyBub0xlbnNGcnVzdHVtWzBdKTsKICAgICAgICBub0xlbnNGcnVzdHVtWzJdID0gdyAtIG5vTGVuc0ZydXN0dW1bMl07CiAgICAgICAgdmlld3BvcnQueCA9IDEgLSAodmlld3BvcnQueCArIHZpZXdwb3J0LndpZHRoKTsKICAgICAgfQogICAgICByZXR1cm4gdmVydGljZXM7CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5jb21wdXRlTWVzaEluZGljZXNfID0gZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQpIHsKICAgICAgdmFyIGluZGljZXMgPSBuZXcgVWludDE2QXJyYXkoMiAqICh3aWR0aCAtIDEpICogKGhlaWdodCAtIDEpICogNik7CiAgICAgIHZhciBoYWxmd2lkdGggPSB3aWR0aCAvIDI7CiAgICAgIHZhciBoYWxmaGVpZ2h0ID0gaGVpZ2h0IC8gMjsKICAgICAgdmFyIHZpZHggPSAwOwogICAgICB2YXIgaWlkeCA9IDA7CiAgICAgIGZvciAodmFyIGUgPSAwOyBlIDwgMjsgZSsrKSB7CiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBoZWlnaHQ7IGorKykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrLCB2aWR4KyspIHsKICAgICAgICAgICAgaWYgKGkgPT0gMCB8fCBqID09IDApIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoaSA8PSBoYWxmd2lkdGggPT0gaiA8PSBoYWxmaGVpZ2h0KSB7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeDsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGggLSAxOwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKICAgICAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4IC0gd2lkdGggLSAxOwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHg7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIDE7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoOwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHg7CiAgICAgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoOwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwogICAgICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGluZGljZXM7CiAgICB9OwogICAgQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JfID0gZnVuY3Rpb24gKHByb3RvLCBhdHRyTmFtZSkgewogICAgICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG8sIGF0dHJOYW1lKTsKICAgICAgaWYgKGRlc2NyaXB0b3IuZ2V0ID09PSB1bmRlZmluZWQgfHwgZGVzY3JpcHRvci5zZXQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlOwogICAgICAgIGRlc2NyaXB0b3IuZ2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKTsKICAgICAgICB9OwogICAgICAgIGRlc2NyaXB0b3Iuc2V0ID0gZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIHZhbCk7CiAgICAgICAgfTsKICAgICAgfQogICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgIH07CiAgICB2YXIgdWlWUyA9IFsnYXR0cmlidXRlIHZlYzIgcG9zaXRpb247JywgJ3VuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0OycsICd2b2lkIG1haW4oKSB7JywgJyAgZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0ICogdmVjNCggcG9zaXRpb24sIC0xLjAsIDEuMCApOycsICd9J10uam9pbignXG4nKTsKICAgIHZhciB1aUZTID0gWydwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLCAndW5pZm9ybSB2ZWM0IGNvbG9yOycsICd2b2lkIG1haW4oKSB7JywgJyAgZ2xfRnJhZ0NvbG9yID0gY29sb3I7JywgJ30nXS5qb2luKCdcbicpOwogICAgdmFyIERFRzJSQUQgPSBNYXRoLlBJIC8gMTgwLjA7CiAgICB2YXIga0FuZ2xlUGVyR2VhclNlY3Rpb24gPSA2MDsKICAgIHZhciBrT3V0ZXJSaW1FbmRBbmdsZSA9IDEyOwogICAgdmFyIGtJbm5lclJpbUJlZ2luQW5nbGUgPSAyMDsKICAgIHZhciBrT3V0ZXJSYWRpdXMgPSAxOwogICAgdmFyIGtNaWRkbGVSYWRpdXMgPSAwLjc1OwogICAgdmFyIGtJbm5lclJhZGl1cyA9IDAuMzEyNTsKICAgIHZhciBrQ2VudGVyTGluZVRoaWNrbmVzc0RwID0gNDsKICAgIHZhciBrQnV0dG9uV2lkdGhEcCA9IDI4OwogICAgdmFyIGtUb3VjaFNsb3BGYWN0b3IgPSAxLjU7CiAgICBmdW5jdGlvbiBDYXJkYm9hcmRVSShnbCkgewogICAgICB0aGlzLmdsID0gZ2w7CiAgICAgIHRoaXMuYXR0cmlicyA9IHsKICAgICAgICBwb3NpdGlvbjogMAogICAgICB9OwogICAgICB0aGlzLnByb2dyYW0gPSBsaW5rUHJvZ3JhbShnbCwgdWlWUywgdWlGUywgdGhpcy5hdHRyaWJzKTsKICAgICAgdGhpcy51bmlmb3JtcyA9IGdldFByb2dyYW1Vbmlmb3JtcyhnbCwgdGhpcy5wcm9ncmFtKTsKICAgICAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKICAgICAgdGhpcy5nZWFyT2Zmc2V0ID0gMDsKICAgICAgdGhpcy5nZWFyVmVydGV4Q291bnQgPSAwOwogICAgICB0aGlzLmFycm93T2Zmc2V0ID0gMDsKICAgICAgdGhpcy5hcnJvd1ZlcnRleENvdW50ID0gMDsKICAgICAgdGhpcy5wcm9qTWF0ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgIHRoaXMubGlzdGVuZXIgPSBudWxsOwogICAgICB0aGlzLm9uUmVzaXplKCk7CiAgICB9CiAgICBDYXJkYm9hcmRVSS5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgaWYgKHRoaXMubGlzdGVuZXIpIHsKICAgICAgICBnbC5jYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmxpc3RlbmVyLCBmYWxzZSk7CiAgICAgIH0KICAgICAgZ2wuZGVsZXRlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwogICAgICBnbC5kZWxldGVCdWZmZXIodGhpcy52ZXJ0ZXhCdWZmZXIpOwogICAgfTsKICAgIENhcmRib2FyZFVJLnByb3RvdHlwZS5saXN0ZW4gPSBmdW5jdGlvbiAob3B0aW9uc0NhbGxiYWNrLCBiYWNrQ2FsbGJhY2spIHsKICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuZ2wuY2FudmFzOwogICAgICB0aGlzLmxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgdmFyIG1pZGxpbmUgPSBjYW52YXMuY2xpZW50V2lkdGggLyAyOwogICAgICAgIHZhciBidXR0b25TaXplID0ga0J1dHRvbldpZHRoRHAgKiBrVG91Y2hTbG9wRmFjdG9yOwogICAgICAgIGlmIChldmVudC5jbGllbnRYID4gbWlkbGluZSAtIGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WCA8IG1pZGxpbmUgKyBidXR0b25TaXplICYmIGV2ZW50LmNsaWVudFkgPiBjYW52YXMuY2xpZW50SGVpZ2h0IC0gYnV0dG9uU2l6ZSkgewogICAgICAgICAgb3B0aW9uc0NhbGxiYWNrKGV2ZW50KTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZXZlbnQuY2xpZW50WCA8IGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WSA8IGJ1dHRvblNpemUpIHsKICAgICAgICAgICAgYmFja0NhbGxiYWNrKGV2ZW50KTsKICAgICAgICAgIH0KICAgICAgfTsKICAgICAgY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5saXN0ZW5lciwgZmFsc2UpOwogICAgfTsKICAgIENhcmRib2FyZFVJLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5nbDsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB2YXIgZ2xTdGF0ZSA9IFtnbC5BUlJBWV9CVUZGRVJfQklORElOR107CiAgICAgIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CiAgICAgICAgdmFyIHZlcnRpY2VzID0gW107CiAgICAgICAgdmFyIG1pZGxpbmUgPSBnbC5kcmF3aW5nQnVmZmVyV2lkdGggLyAyOwogICAgICAgIHZhciBwaHlzaWNhbFBpeGVscyA9IE1hdGgubWF4KHNjcmVlbi53aWR0aCwgc2NyZWVuLmhlaWdodCkgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKICAgICAgICB2YXIgc2NhbGluZ1JhdGlvID0gZ2wuZHJhd2luZ0J1ZmZlcldpZHRoIC8gcGh5c2ljYWxQaXhlbHM7CiAgICAgICAgdmFyIGRwcyA9IHNjYWxpbmdSYXRpbyAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwogICAgICAgIHZhciBsaW5lV2lkdGggPSBrQ2VudGVyTGluZVRoaWNrbmVzc0RwICogZHBzIC8gMjsKICAgICAgICB2YXIgYnV0dG9uU2l6ZSA9IGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvciAqIGRwczsKICAgICAgICB2YXIgYnV0dG9uU2NhbGUgPSBrQnV0dG9uV2lkdGhEcCAqIGRwcyAvIDI7CiAgICAgICAgdmFyIGJ1dHRvbkJvcmRlciA9IChrQnV0dG9uV2lkdGhEcCAqIGtUb3VjaFNsb3BGYWN0b3IgLSBrQnV0dG9uV2lkdGhEcCkgKiBkcHM7CiAgICAgICAgdmVydGljZXMucHVzaChtaWRsaW5lIC0gbGluZVdpZHRoLCBidXR0b25TaXplKTsKICAgICAgICB2ZXJ0aWNlcy5wdXNoKG1pZGxpbmUgLSBsaW5lV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwogICAgICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSArIGxpbmVXaWR0aCwgYnV0dG9uU2l6ZSk7CiAgICAgICAgdmVydGljZXMucHVzaChtaWRsaW5lICsgbGluZVdpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKICAgICAgICBzZWxmLmdlYXJPZmZzZXQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyOwogICAgICAgIGZ1bmN0aW9uIGFkZEdlYXJTZWdtZW50KHRoZXRhLCByKSB7CiAgICAgICAgICB2YXIgYW5nbGUgPSAoOTAgLSB0aGV0YSkgKiBERUcyUkFEOwogICAgICAgICAgdmFyIHggPSBNYXRoLmNvcyhhbmdsZSk7CiAgICAgICAgICB2YXIgeSA9IE1hdGguc2luKGFuZ2xlKTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goa0lubmVyUmFkaXVzICogeCAqIGJ1dHRvblNjYWxlICsgbWlkbGluZSwga0lubmVyUmFkaXVzICogeSAqIGJ1dHRvblNjYWxlICsgYnV0dG9uU2NhbGUpOwogICAgICAgICAgdmVydGljZXMucHVzaChyICogeCAqIGJ1dHRvblNjYWxlICsgbWlkbGluZSwgciAqIHkgKiBidXR0b25TY2FsZSArIGJ1dHRvblNjYWxlKTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gNjsgaSsrKSB7CiAgICAgICAgICB2YXIgc2VnbWVudFRoZXRhID0gaSAqIGtBbmdsZVBlckdlYXJTZWN0aW9uOwogICAgICAgICAgYWRkR2VhclNlZ21lbnQoc2VnbWVudFRoZXRhLCBrT3V0ZXJSYWRpdXMpOwogICAgICAgICAgYWRkR2VhclNlZ21lbnQoc2VnbWVudFRoZXRhICsga091dGVyUmltRW5kQW5nbGUsIGtPdXRlclJhZGl1cyk7CiAgICAgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyBrSW5uZXJSaW1CZWdpbkFuZ2xlLCBrTWlkZGxlUmFkaXVzKTsKICAgICAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIChrQW5nbGVQZXJHZWFyU2VjdGlvbiAtIGtJbm5lclJpbUJlZ2luQW5nbGUpLCBrTWlkZGxlUmFkaXVzKTsKICAgICAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIChrQW5nbGVQZXJHZWFyU2VjdGlvbiAtIGtPdXRlclJpbUVuZEFuZ2xlKSwga091dGVyUmFkaXVzKTsKICAgICAgICB9CiAgICAgICAgc2VsZi5nZWFyVmVydGV4Q291bnQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyIC0gc2VsZi5nZWFyT2Zmc2V0OwogICAgICAgIHNlbGYuYXJyb3dPZmZzZXQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyOwogICAgICAgIGZ1bmN0aW9uIGFkZEFycm93VmVydGV4KHgsIHkpIHsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goYnV0dG9uQm9yZGVyICsgeCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCAtIGJ1dHRvbkJvcmRlciAtIHkpOwogICAgICAgIH0KICAgICAgICB2YXIgYW5nbGVkTGluZVdpZHRoID0gbGluZVdpZHRoIC8gTWF0aC5zaW4oNDUgKiBERUcyUkFEKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleCgwLCBidXR0b25TY2FsZSk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUsIDApOwogICAgICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlICsgYW5nbGVkTGluZVdpZHRoLCBhbmdsZWRMaW5lV2lkdGgpOwogICAgICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgKyBhbmdsZWRMaW5lV2lkdGgpOwogICAgICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgLSBhbmdsZWRMaW5lV2lkdGgpOwogICAgICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChidXR0b25TY2FsZSwgYnV0dG9uU2NhbGUgKiAyKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChidXR0b25TY2FsZSArIGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgKiAyIC0gYW5nbGVkTGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlIC0gYW5nbGVkTGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleCgwLCBidXR0b25TY2FsZSk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSAtIGxpbmVXaWR0aCk7CiAgICAgICAgYWRkQXJyb3dWZXJ0ZXgoa0J1dHRvbldpZHRoRHAgKiBkcHMsIGJ1dHRvblNjYWxlIC0gbGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlICsgbGluZVdpZHRoKTsKICAgICAgICBhZGRBcnJvd1ZlcnRleChrQnV0dG9uV2lkdGhEcCAqIGRwcywgYnV0dG9uU2NhbGUgKyBsaW5lV2lkdGgpOwogICAgICAgIHNlbGYuYXJyb3dWZXJ0ZXhDb3VudCA9IHZlcnRpY2VzLmxlbmd0aCAvIDIgLSBzZWxmLmFycm93T2Zmc2V0OwogICAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBzZWxmLnZlcnRleEJ1ZmZlcik7CiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpLCBnbC5TVEFUSUNfRFJBVyk7CiAgICAgIH0pOwogICAgfTsKICAgIENhcmRib2FyZFVJLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBnbCA9IHRoaXMuZ2w7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdmFyIGdsU3RhdGUgPSBbZ2wuQ1VMTF9GQUNFLCBnbC5ERVBUSF9URVNULCBnbC5CTEVORCwgZ2wuU0NJU1NPUl9URVNULCBnbC5TVEVOQ0lMX1RFU1QsIGdsLkNPTE9SX1dSSVRFTUFTSywgZ2wuVklFV1BPUlQsIGdsLkNVUlJFTlRfUFJPR1JBTSwgZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkddOwogICAgICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewogICAgICAgIGdsLmRpc2FibGUoZ2wuQ1VMTF9GQUNFKTsKICAgICAgICBnbC5kaXNhYmxlKGdsLkRFUFRIX1RFU1QpOwogICAgICAgIGdsLmRpc2FibGUoZ2wuQkxFTkQpOwogICAgICAgIGdsLmRpc2FibGUoZ2wuU0NJU1NPUl9URVNUKTsKICAgICAgICBnbC5kaXNhYmxlKGdsLlNURU5DSUxfVEVTVCk7CiAgICAgICAgZ2wuY29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpOwogICAgICAgIGdsLnZpZXdwb3J0KDAsIDAsIGdsLmRyYXdpbmdCdWZmZXJXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CiAgICAgICAgc2VsZi5yZW5kZXJOb1N0YXRlKCk7CiAgICAgIH0pOwogICAgfTsKICAgIENhcmRib2FyZFVJLnByb3RvdHlwZS5yZW5kZXJOb1N0YXRlID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZ2wgPSB0aGlzLmdsOwogICAgICBnbC51c2VQcm9ncmFtKHRoaXMucHJvZ3JhbSk7CiAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLnZlcnRleEJ1ZmZlcik7CiAgICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuYXR0cmlicy5wb3NpdGlvbik7CiAgICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIodGhpcy5hdHRyaWJzLnBvc2l0aW9uLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDgsIDApOwogICAgICBnbC51bmlmb3JtNGYodGhpcy51bmlmb3Jtcy5jb2xvciwgMS4wLCAxLjAsIDEuMCwgMS4wKTsKICAgICAgb3J0aG9NYXRyaXgodGhpcy5wcm9qTWF0LCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIDAsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQsIDAuMSwgMTAyNC4wKTsKICAgICAgZ2wudW5pZm9ybU1hdHJpeDRmdih0aGlzLnVuaWZvcm1zLnByb2plY3Rpb25NYXQsIGZhbHNlLCB0aGlzLnByb2pNYXQpOwogICAgICBnbC5kcmF3QXJyYXlzKGdsLlRSSUFOR0xFX1NUUklQLCAwLCA0KTsKICAgICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgdGhpcy5nZWFyT2Zmc2V0LCB0aGlzLmdlYXJWZXJ0ZXhDb3VudCk7CiAgICAgIGdsLmRyYXdBcnJheXMoZ2wuVFJJQU5HTEVfU1RSSVAsIHRoaXMuYXJyb3dPZmZzZXQsIHRoaXMuYXJyb3dWZXJ0ZXhDb3VudCk7CiAgICB9OwogICAgZnVuY3Rpb24gRGlzdG9ydGlvbihjb2VmZmljaWVudHMpIHsKICAgICAgdGhpcy5jb2VmZmljaWVudHMgPSBjb2VmZmljaWVudHM7CiAgICB9CiAgICBEaXN0b3J0aW9uLnByb3RvdHlwZS5kaXN0b3J0SW52ZXJzZSA9IGZ1bmN0aW9uIChyYWRpdXMpIHsKICAgICAgdmFyIHIwID0gMDsKICAgICAgdmFyIHIxID0gMTsKICAgICAgdmFyIGRyMCA9IHJhZGl1cyAtIHRoaXMuZGlzdG9ydChyMCk7CiAgICAgIHdoaWxlIChNYXRoLmFicyhyMSAtIHIwKSA+IDAuMDAwMSAgICAgICAgICAgICApIHsKICAgICAgICB2YXIgZHIxID0gcmFkaXVzIC0gdGhpcy5kaXN0b3J0KHIxKTsKICAgICAgICB2YXIgcjIgPSByMSAtIGRyMSAqICgocjEgLSByMCkgLyAoZHIxIC0gZHIwKSk7CiAgICAgICAgcjAgPSByMTsKICAgICAgICByMSA9IHIyOwogICAgICAgIGRyMCA9IGRyMTsKICAgICAgfQogICAgICByZXR1cm4gcjE7CiAgICB9OwogICAgRGlzdG9ydGlvbi5wcm90b3R5cGUuZGlzdG9ydCA9IGZ1bmN0aW9uIChyYWRpdXMpIHsKICAgICAgdmFyIHIyID0gcmFkaXVzICogcmFkaXVzOwogICAgICB2YXIgcmV0ID0gMDsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNvZWZmaWNpZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHJldCA9IHIyICogKHJldCArIHRoaXMuY29lZmZpY2llbnRzW2ldKTsKICAgICAgfQogICAgICByZXR1cm4gKHJldCArIDEpICogcmFkaXVzOwogICAgfTsKICAgIHZhciBkZWdUb1JhZCA9IE1hdGguUEkgLyAxODA7CiAgICB2YXIgcmFkVG9EZWcgPSAxODAgLyBNYXRoLlBJOwogICAgdmFyIFZlY3RvcjMgPSBmdW5jdGlvbiBWZWN0b3IzKHgsIHksIHopIHsKICAgICAgdGhpcy54ID0geCB8fCAwOwogICAgICB0aGlzLnkgPSB5IHx8IDA7CiAgICAgIHRoaXMueiA9IHogfHwgMDsKICAgIH07CiAgICBWZWN0b3IzLnByb3RvdHlwZSA9IHsKICAgICAgY29uc3RydWN0b3I6IFZlY3RvcjMsCiAgICAgIHNldDogZnVuY3Rpb24gc2V0KHgsIHksIHopIHsKICAgICAgICB0aGlzLnggPSB4OwogICAgICAgIHRoaXMueSA9IHk7CiAgICAgICAgdGhpcy56ID0gejsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgY29weTogZnVuY3Rpb24gY29weSh2KSB7CiAgICAgICAgdGhpcy54ID0gdi54OwogICAgICAgIHRoaXMueSA9IHYueTsKICAgICAgICB0aGlzLnogPSB2Lno7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIGxlbmd0aDogZnVuY3Rpb24gbGVuZ3RoKCkgewogICAgICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56KTsKICAgICAgfSwKICAgICAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUoKSB7CiAgICAgICAgdmFyIHNjYWxhciA9IHRoaXMubGVuZ3RoKCk7CiAgICAgICAgaWYgKHNjYWxhciAhPT0gMCkgewogICAgICAgICAgdmFyIGludlNjYWxhciA9IDEgLyBzY2FsYXI7CiAgICAgICAgICB0aGlzLm11bHRpcGx5U2NhbGFyKGludlNjYWxhcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbiBtdWx0aXBseVNjYWxhcihzY2FsYXIpIHsKICAgICAgICB0aGlzLnggKj0gc2NhbGFyOwogICAgICAgIHRoaXMueSAqPSBzY2FsYXI7CiAgICAgICAgdGhpcy56ICo9IHNjYWxhcjsKICAgICAgfSwKICAgICAgYXBwbHlRdWF0ZXJuaW9uOiBmdW5jdGlvbiBhcHBseVF1YXRlcm5pb24ocSkgewogICAgICAgIHZhciB4ID0gdGhpcy54OwogICAgICAgIHZhciB5ID0gdGhpcy55OwogICAgICAgIHZhciB6ID0gdGhpcy56OwogICAgICAgIHZhciBxeCA9IHEueDsKICAgICAgICB2YXIgcXkgPSBxLnk7CiAgICAgICAgdmFyIHF6ID0gcS56OwogICAgICAgIHZhciBxdyA9IHEudzsKICAgICAgICB2YXIgaXggPSBxdyAqIHggKyBxeSAqIHogLSBxeiAqIHk7CiAgICAgICAgdmFyIGl5ID0gcXcgKiB5ICsgcXogKiB4IC0gcXggKiB6OwogICAgICAgIHZhciBpeiA9IHF3ICogeiArIHF4ICogeSAtIHF5ICogeDsKICAgICAgICB2YXIgaXcgPSAtcXggKiB4IC0gcXkgKiB5IC0gcXogKiB6OwogICAgICAgIHRoaXMueCA9IGl4ICogcXcgKyBpdyAqIC1xeCArIGl5ICogLXF6IC0gaXogKiAtcXk7CiAgICAgICAgdGhpcy55ID0gaXkgKiBxdyArIGl3ICogLXF5ICsgaXogKiAtcXggLSBpeCAqIC1xejsKICAgICAgICB0aGlzLnogPSBpeiAqIHF3ICsgaXcgKiAtcXogKyBpeCAqIC1xeSAtIGl5ICogLXF4OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBkb3Q6IGZ1bmN0aW9uIGRvdCh2KSB7CiAgICAgICAgcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKICAgICAgfSwKICAgICAgY3Jvc3NWZWN0b3JzOiBmdW5jdGlvbiBjcm9zc1ZlY3RvcnMoYSwgYikgewogICAgICAgIHZhciBheCA9IGEueCwKICAgICAgICAgICAgYXkgPSBhLnksCiAgICAgICAgICAgIGF6ID0gYS56OwogICAgICAgIHZhciBieCA9IGIueCwKICAgICAgICAgICAgYnkgPSBiLnksCiAgICAgICAgICAgIGJ6ID0gYi56OwogICAgICAgIHRoaXMueCA9IGF5ICogYnogLSBheiAqIGJ5OwogICAgICAgIHRoaXMueSA9IGF6ICogYnggLSBheCAqIGJ6OwogICAgICAgIHRoaXMueiA9IGF4ICogYnkgLSBheSAqIGJ4OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9OwogICAgdmFyIFF1YXRlcm5pb24gPSBmdW5jdGlvbiBRdWF0ZXJuaW9uKHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geCB8fCAwOwogICAgICB0aGlzLnkgPSB5IHx8IDA7CiAgICAgIHRoaXMueiA9IHogfHwgMDsKICAgICAgdGhpcy53ID0gdyAhPT0gdW5kZWZpbmVkID8gdyA6IDE7CiAgICB9OwogICAgUXVhdGVybmlvbi5wcm90b3R5cGUgPSB7CiAgICAgIGNvbnN0cnVjdG9yOiBRdWF0ZXJuaW9uLAogICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh4LCB5LCB6LCB3KSB7CiAgICAgICAgdGhpcy54ID0geDsKICAgICAgICB0aGlzLnkgPSB5OwogICAgICAgIHRoaXMueiA9IHo7CiAgICAgICAgdGhpcy53ID0gdzsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgY29weTogZnVuY3Rpb24gY29weShxdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy54ID0gcXVhdGVybmlvbi54OwogICAgICAgIHRoaXMueSA9IHF1YXRlcm5pb24ueTsKICAgICAgICB0aGlzLnogPSBxdWF0ZXJuaW9uLno7CiAgICAgICAgdGhpcy53ID0gcXVhdGVybmlvbi53OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBzZXRGcm9tRXVsZXJYWVo6IGZ1bmN0aW9uIHNldEZyb21FdWxlclhZWih4LCB5LCB6KSB7CiAgICAgICAgdmFyIGMxID0gTWF0aC5jb3MoeCAvIDIpOwogICAgICAgIHZhciBjMiA9IE1hdGguY29zKHkgLyAyKTsKICAgICAgICB2YXIgYzMgPSBNYXRoLmNvcyh6IC8gMik7CiAgICAgICAgdmFyIHMxID0gTWF0aC5zaW4oeCAvIDIpOwogICAgICAgIHZhciBzMiA9IE1hdGguc2luKHkgLyAyKTsKICAgICAgICB2YXIgczMgPSBNYXRoLnNpbih6IC8gMik7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBzZXRGcm9tRXVsZXJZWFo6IGZ1bmN0aW9uIHNldEZyb21FdWxlcllYWih4LCB5LCB6KSB7CiAgICAgICAgdmFyIGMxID0gTWF0aC5jb3MoeCAvIDIpOwogICAgICAgIHZhciBjMiA9IE1hdGguY29zKHkgLyAyKTsKICAgICAgICB2YXIgYzMgPSBNYXRoLmNvcyh6IC8gMik7CiAgICAgICAgdmFyIHMxID0gTWF0aC5zaW4oeCAvIDIpOwogICAgICAgIHZhciBzMiA9IE1hdGguc2luKHkgLyAyKTsKICAgICAgICB2YXIgczMgPSBNYXRoLnNpbih6IC8gMik7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBzZXRGcm9tQXhpc0FuZ2xlOiBmdW5jdGlvbiBzZXRGcm9tQXhpc0FuZ2xlKGF4aXMsIGFuZ2xlKSB7CiAgICAgICAgdmFyIGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwKICAgICAgICAgICAgcyA9IE1hdGguc2luKGhhbGZBbmdsZSk7CiAgICAgICAgdGhpcy54ID0gYXhpcy54ICogczsKICAgICAgICB0aGlzLnkgPSBheGlzLnkgKiBzOwogICAgICAgIHRoaXMueiA9IGF4aXMueiAqIHM7CiAgICAgICAgdGhpcy53ID0gTWF0aC5jb3MoaGFsZkFuZ2xlKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfSwKICAgICAgbXVsdGlwbHk6IGZ1bmN0aW9uIG11bHRpcGx5KHEpIHsKICAgICAgICByZXR1cm4gdGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMsIHEpOwogICAgICB9LAogICAgICBtdWx0aXBseVF1YXRlcm5pb25zOiBmdW5jdGlvbiBtdWx0aXBseVF1YXRlcm5pb25zKGEsIGIpIHsKICAgICAgICB2YXIgcWF4ID0gYS54LAogICAgICAgICAgICBxYXkgPSBhLnksCiAgICAgICAgICAgIHFheiA9IGEueiwKICAgICAgICAgICAgcWF3ID0gYS53OwogICAgICAgIHZhciBxYnggPSBiLngsCiAgICAgICAgICAgIHFieSA9IGIueSwKICAgICAgICAgICAgcWJ6ID0gYi56LAogICAgICAgICAgICBxYncgPSBiLnc7CiAgICAgICAgdGhpcy54ID0gcWF4ICogcWJ3ICsgcWF3ICogcWJ4ICsgcWF5ICogcWJ6IC0gcWF6ICogcWJ5OwogICAgICAgIHRoaXMueSA9IHFheSAqIHFidyArIHFhdyAqIHFieSArIHFheiAqIHFieCAtIHFheCAqIHFiejsKICAgICAgICB0aGlzLnogPSBxYXogKiBxYncgKyBxYXcgKiBxYnogKyBxYXggKiBxYnkgLSBxYXkgKiBxYng7CiAgICAgICAgdGhpcy53ID0gcWF3ICogcWJ3IC0gcWF4ICogcWJ4IC0gcWF5ICogcWJ5IC0gcWF6ICogcWJ6OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBpbnZlcnNlOiBmdW5jdGlvbiBpbnZlcnNlKCkgewogICAgICAgIHRoaXMueCAqPSAtMTsKICAgICAgICB0aGlzLnkgKj0gLTE7CiAgICAgICAgdGhpcy56ICo9IC0xOwogICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIG5vcm1hbGl6ZTogZnVuY3Rpb24gbm9ybWFsaXplKCkgewogICAgICAgIHZhciBsID0gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyk7CiAgICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICAgIHRoaXMudyA9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGwgPSAxIC8gbDsKICAgICAgICAgIHRoaXMueCA9IHRoaXMueCAqIGw7CiAgICAgICAgICB0aGlzLnkgPSB0aGlzLnkgKiBsOwogICAgICAgICAgdGhpcy56ID0gdGhpcy56ICogbDsKICAgICAgICAgIHRoaXMudyA9IHRoaXMudyAqIGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9LAogICAgICBzbGVycDogZnVuY3Rpb24gc2xlcnAocWIsIHQpIHsKICAgICAgICBpZiAodCA9PT0gMCkgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKHQgPT09IDEpIHJldHVybiB0aGlzLmNvcHkocWIpOwogICAgICAgIHZhciB4ID0gdGhpcy54LAogICAgICAgICAgICB5ID0gdGhpcy55LAogICAgICAgICAgICB6ID0gdGhpcy56LAogICAgICAgICAgICB3ID0gdGhpcy53OwogICAgICAgIHZhciBjb3NIYWxmVGhldGEgPSB3ICogcWIudyArIHggKiBxYi54ICsgeSAqIHFiLnkgKyB6ICogcWIuejsKICAgICAgICBpZiAoY29zSGFsZlRoZXRhIDwgMCkgewogICAgICAgICAgdGhpcy53ID0gLXFiLnc7CiAgICAgICAgICB0aGlzLnggPSAtcWIueDsKICAgICAgICAgIHRoaXMueSA9IC1xYi55OwogICAgICAgICAgdGhpcy56ID0gLXFiLno7CiAgICAgICAgICBjb3NIYWxmVGhldGEgPSAtY29zSGFsZlRoZXRhOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNvcHkocWIpOwogICAgICAgIH0KICAgICAgICBpZiAoY29zSGFsZlRoZXRhID49IDEuMCkgewogICAgICAgICAgdGhpcy53ID0gdzsKICAgICAgICAgIHRoaXMueCA9IHg7CiAgICAgICAgICB0aGlzLnkgPSB5OwogICAgICAgICAgdGhpcy56ID0gejsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICB2YXIgaGFsZlRoZXRhID0gTWF0aC5hY29zKGNvc0hhbGZUaGV0YSk7CiAgICAgICAgdmFyIHNpbkhhbGZUaGV0YSA9IE1hdGguc3FydCgxLjAgLSBjb3NIYWxmVGhldGEgKiBjb3NIYWxmVGhldGEpOwogICAgICAgIGlmIChNYXRoLmFicyhzaW5IYWxmVGhldGEpIDwgMC4wMDEpIHsKICAgICAgICAgIHRoaXMudyA9IDAuNSAqICh3ICsgdGhpcy53KTsKICAgICAgICAgIHRoaXMueCA9IDAuNSAqICh4ICsgdGhpcy54KTsKICAgICAgICAgIHRoaXMueSA9IDAuNSAqICh5ICsgdGhpcy55KTsKICAgICAgICAgIHRoaXMueiA9IDAuNSAqICh6ICsgdGhpcy56KTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICB2YXIgcmF0aW9BID0gTWF0aC5zaW4oKDEgLSB0KSAqIGhhbGZUaGV0YSkgLyBzaW5IYWxmVGhldGEsCiAgICAgICAgICAgIHJhdGlvQiA9IE1hdGguc2luKHQgKiBoYWxmVGhldGEpIC8gc2luSGFsZlRoZXRhOwogICAgICAgIHRoaXMudyA9IHcgKiByYXRpb0EgKyB0aGlzLncgKiByYXRpb0I7CiAgICAgICAgdGhpcy54ID0geCAqIHJhdGlvQSArIHRoaXMueCAqIHJhdGlvQjsKICAgICAgICB0aGlzLnkgPSB5ICogcmF0aW9BICsgdGhpcy55ICogcmF0aW9COwogICAgICAgIHRoaXMueiA9IHogKiByYXRpb0EgKyB0aGlzLnogKiByYXRpb0I7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0sCiAgICAgIHNldEZyb21Vbml0VmVjdG9yczogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB2MSwgcjsKICAgICAgICB2YXIgRVBTID0gMC4wMDAwMDE7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2RnJvbSwgdlRvKSB7CiAgICAgICAgICBpZiAodjEgPT09IHVuZGVmaW5lZCkgdjEgPSBuZXcgVmVjdG9yMygpOwogICAgICAgICAgciA9IHZGcm9tLmRvdCh2VG8pICsgMTsKICAgICAgICAgIGlmIChyIDwgRVBTKSB7CiAgICAgICAgICAgIHIgPSAwOwogICAgICAgICAgICBpZiAoTWF0aC5hYnModkZyb20ueCkgPiBNYXRoLmFicyh2RnJvbS56KSkgewogICAgICAgICAgICAgIHYxLnNldCgtdkZyb20ueSwgdkZyb20ueCwgMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdjEuc2V0KDAsIC12RnJvbS56LCB2RnJvbS55KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdjEuY3Jvc3NWZWN0b3JzKHZGcm9tLCB2VG8pOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy54ID0gdjEueDsKICAgICAgICAgIHRoaXMueSA9IHYxLnk7CiAgICAgICAgICB0aGlzLnogPSB2MS56OwogICAgICAgICAgdGhpcy53ID0gcjsKICAgICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9OwogICAgICB9KCkKICAgIH07CiAgICBmdW5jdGlvbiBEZXZpY2UocGFyYW1zKSB7CiAgICAgIHRoaXMud2lkdGggPSBwYXJhbXMud2lkdGggfHwgZ2V0U2NyZWVuV2lkdGgoKTsKICAgICAgdGhpcy5oZWlnaHQgPSBwYXJhbXMuaGVpZ2h0IHx8IGdldFNjcmVlbkhlaWdodCgpOwogICAgICB0aGlzLndpZHRoTWV0ZXJzID0gcGFyYW1zLndpZHRoTWV0ZXJzOwogICAgICB0aGlzLmhlaWdodE1ldGVycyA9IHBhcmFtcy5oZWlnaHRNZXRlcnM7CiAgICAgIHRoaXMuYmV2ZWxNZXRlcnMgPSBwYXJhbXMuYmV2ZWxNZXRlcnM7CiAgICB9CiAgICB2YXIgREVGQVVMVF9BTkRST0lEID0gbmV3IERldmljZSh7CiAgICAgIHdpZHRoTWV0ZXJzOiAwLjExMCwKICAgICAgaGVpZ2h0TWV0ZXJzOiAwLjA2MiwKICAgICAgYmV2ZWxNZXRlcnM6IDAuMDA0CiAgICB9KTsKICAgIHZhciBERUZBVUxUX0lPUyA9IG5ldyBEZXZpY2UoewogICAgICB3aWR0aE1ldGVyczogMC4xMDM4LAogICAgICBoZWlnaHRNZXRlcnM6IDAuMDU4NCwKICAgICAgYmV2ZWxNZXRlcnM6IDAuMDA0CiAgICB9KTsKICAgIHZhciBWaWV3ZXJzID0gewogICAgICBDYXJkYm9hcmRWMTogbmV3IENhcmRib2FyZFZpZXdlcih7CiAgICAgICAgaWQ6ICdDYXJkYm9hcmRWMScsCiAgICAgICAgbGFiZWw6ICdDYXJkYm9hcmQgSS9PIDIwMTQnLAogICAgICAgIGZvdjogNDAsCiAgICAgICAgaW50ZXJMZW5zRGlzdGFuY2U6IDAuMDYwLAogICAgICAgIGJhc2VsaW5lTGVuc0Rpc3RhbmNlOiAwLjAzNSwKICAgICAgICBzY3JlZW5MZW5zRGlzdGFuY2U6IDAuMDQyLAogICAgICAgIGRpc3RvcnRpb25Db2VmZmljaWVudHM6IFswLjQ0MSwgMC4xNTZdLAogICAgICAgIGludmVyc2VDb2VmZmljaWVudHM6IFstMC40NDEwMDM1LCAwLjQyNzU2MTU1LCAtMC40ODA0NDM5LCAwLjU0NjAxMzksIC0wLjU4ODIxMTgzLCAwLjU3MzM5MzgsIC0wLjQ4MzAzMjAyLCAwLjMzMjk5MDgzLCAtMC4xNzU3Mzg0MSwgMC4wNjUxNzcyLCAtMC4wMTQ4ODk2MywgMC4wMDE1NTk4MzRdCiAgICAgIH0pLAogICAgICBDYXJkYm9hcmRWMjogbmV3IENhcmRib2FyZFZpZXdlcih7CiAgICAgICAgaWQ6ICdDYXJkYm9hcmRWMicsCiAgICAgICAgbGFiZWw6ICdDYXJkYm9hcmQgSS9PIDIwMTUnLAogICAgICAgIGZvdjogNjAsCiAgICAgICAgaW50ZXJMZW5zRGlzdGFuY2U6IDAuMDY0LAogICAgICAgIGJhc2VsaW5lTGVuc0Rpc3RhbmNlOiAwLjAzNSwKICAgICAgICBzY3JlZW5MZW5zRGlzdGFuY2U6IDAuMDM5LAogICAgICAgIGRpc3RvcnRpb25Db2VmZmljaWVudHM6IFswLjM0LCAwLjU1XSwKICAgICAgICBpbnZlcnNlQ29lZmZpY2llbnRzOiBbLTAuMzM4MzY3MDQsIC0wLjE4MTYyMTg1LCAwLjg2MjY1NSwgLTEuMjQ2MjA1MSwgMS4wNTYwNjAyLCAtMC41ODIwODMxNywgMC4yMTYwOTA3OCwgLTAuMDU0NDQ4MjMsIDAuMDA5MTc3OTU2LCAtOTkwNDE2OWUtMTAsIDYuMTgzNTM1RS01LCAtMTY5ODE4MDNlLTEzXQogICAgICB9KQogICAgfTsKICAgIGZ1bmN0aW9uIERldmljZUluZm8oZGV2aWNlUGFyYW1zLCBhZGRpdGlvbmFsVmlld2VycykgewogICAgICB0aGlzLnZpZXdlciA9IFZpZXdlcnMuQ2FyZGJvYXJkVjI7CiAgICAgIHRoaXMudXBkYXRlRGV2aWNlUGFyYW1zKGRldmljZVBhcmFtcyk7CiAgICAgIHRoaXMuZGlzdG9ydGlvbiA9IG5ldyBEaXN0b3J0aW9uKHRoaXMudmlld2VyLmRpc3RvcnRpb25Db2VmZmljaWVudHMpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFkZGl0aW9uYWxWaWV3ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIHZpZXdlciA9IGFkZGl0aW9uYWxWaWV3ZXJzW2ldOwogICAgICAgIFZpZXdlcnNbdmlld2VyLmlkXSA9IG5ldyBDYXJkYm9hcmRWaWV3ZXIodmlld2VyKTsKICAgICAgfQogICAgfQogICAgRGV2aWNlSW5mby5wcm90b3R5cGUudXBkYXRlRGV2aWNlUGFyYW1zID0gZnVuY3Rpb24gKGRldmljZVBhcmFtcykgewogICAgICB0aGlzLmRldmljZSA9IHRoaXMuZGV0ZXJtaW5lRGV2aWNlXyhkZXZpY2VQYXJhbXMpIHx8IHRoaXMuZGV2aWNlOwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmdldERldmljZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIHRoaXMuZGV2aWNlOwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLnNldFZpZXdlciA9IGZ1bmN0aW9uICh2aWV3ZXIpIHsKICAgICAgdGhpcy52aWV3ZXIgPSB2aWV3ZXI7CiAgICAgIHRoaXMuZGlzdG9ydGlvbiA9IG5ldyBEaXN0b3J0aW9uKHRoaXMudmlld2VyLmRpc3RvcnRpb25Db2VmZmljaWVudHMpOwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmRldGVybWluZURldmljZV8gPSBmdW5jdGlvbiAoZGV2aWNlUGFyYW1zKSB7CiAgICAgIGlmICghZGV2aWNlUGFyYW1zKSB7CiAgICAgICAgaWYgKGlzSU9TKCkpIHsKICAgICAgICAgIGNvbnNvbGUud2FybignVXNpbmcgZmFsbGJhY2sgaU9TIGRldmljZSBtZWFzdXJlbWVudHMuJyk7CiAgICAgICAgICByZXR1cm4gREVGQVVMVF9JT1M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybignVXNpbmcgZmFsbGJhY2sgQW5kcm9pZCBkZXZpY2UgbWVhc3VyZW1lbnRzLicpOwogICAgICAgICAgcmV0dXJuIERFRkFVTFRfQU5EUk9JRDsKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIE1FVEVSU19QRVJfSU5DSCA9IDAuMDI1NDsKICAgICAgdmFyIG1ldGVyc1BlclBpeGVsWCA9IE1FVEVSU19QRVJfSU5DSCAvIGRldmljZVBhcmFtcy54ZHBpOwogICAgICB2YXIgbWV0ZXJzUGVyUGl4ZWxZID0gTUVURVJTX1BFUl9JTkNIIC8gZGV2aWNlUGFyYW1zLnlkcGk7CiAgICAgIHZhciB3aWR0aCA9IGdldFNjcmVlbldpZHRoKCk7CiAgICAgIHZhciBoZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKTsKICAgICAgcmV0dXJuIG5ldyBEZXZpY2UoewogICAgICAgIHdpZHRoTWV0ZXJzOiBtZXRlcnNQZXJQaXhlbFggKiB3aWR0aCwKICAgICAgICBoZWlnaHRNZXRlcnM6IG1ldGVyc1BlclBpeGVsWSAqIGhlaWdodCwKICAgICAgICBiZXZlbE1ldGVyczogZGV2aWNlUGFyYW1zLmJldmVsTW0gKiAwLjAwMQogICAgICB9KTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXREaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICAgICAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogICAgICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKICAgICAgdmFyIGV5ZVRvU2NyZWVuRGlzdGFuY2UgPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwogICAgICB2YXIgb3V0ZXJEaXN0ID0gKGRldmljZS53aWR0aE1ldGVycyAtIHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSkgLyAyOwogICAgICB2YXIgaW5uZXJEaXN0ID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMjsKICAgICAgdmFyIGJvdHRvbURpc3QgPSB2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnM7CiAgICAgIHZhciB0b3BEaXN0ID0gZGV2aWNlLmhlaWdodE1ldGVycyAtIGJvdHRvbURpc3Q7CiAgICAgIHZhciBvdXRlckFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KG91dGVyRGlzdCAvIGV5ZVRvU2NyZWVuRGlzdGFuY2UpKTsKICAgICAgdmFyIGlubmVyQW5nbGUgPSByYWRUb0RlZyAqIE1hdGguYXRhbihkaXN0b3J0aW9uLmRpc3RvcnQoaW5uZXJEaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwogICAgICB2YXIgYm90dG9tQW5nbGUgPSByYWRUb0RlZyAqIE1hdGguYXRhbihkaXN0b3J0aW9uLmRpc3RvcnQoYm90dG9tRGlzdCAvIGV5ZVRvU2NyZWVuRGlzdGFuY2UpKTsKICAgICAgdmFyIHRvcEFuZ2xlID0gcmFkVG9EZWcgKiBNYXRoLmF0YW4oZGlzdG9ydGlvbi5kaXN0b3J0KHRvcERpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGVmdERlZ3JlZXM6IE1hdGgubWluKG91dGVyQW5nbGUsIHZpZXdlci5mb3YpLAogICAgICAgIHJpZ2h0RGVncmVlczogTWF0aC5taW4oaW5uZXJBbmdsZSwgdmlld2VyLmZvdiksCiAgICAgICAgZG93bkRlZ3JlZXM6IE1hdGgubWluKGJvdHRvbUFuZ2xlLCB2aWV3ZXIuZm92KSwKICAgICAgICB1cERlZ3JlZXM6IE1hdGgubWluKHRvcEFuZ2xlLCB2aWV3ZXIuZm92KQogICAgICB9OwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmdldExlZnRFeWVWaXNpYmxlVGFuQW5nbGVzID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CiAgICAgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKICAgICAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CiAgICAgIHZhciBmb3ZMZWZ0ID0gTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdik7CiAgICAgIHZhciBmb3ZUb3AgPSBNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpOwogICAgICB2YXIgZm92UmlnaHQgPSBNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpOwogICAgICB2YXIgZm92Qm90dG9tID0gTWF0aC50YW4oLWRlZ1RvUmFkICogdmlld2VyLmZvdik7CiAgICAgIHZhciBoYWxmV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyA0OwogICAgICB2YXIgaGFsZkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyAyOwogICAgICB2YXIgdmVydGljYWxMZW5zT2Zmc2V0ID0gdmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzIC0gaGFsZkhlaWdodDsKICAgICAgdmFyIGNlbnRlclggPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC0gaGFsZldpZHRoOwogICAgICB2YXIgY2VudGVyWSA9IC12ZXJ0aWNhbExlbnNPZmZzZXQ7CiAgICAgIHZhciBjZW50ZXJaID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICAgICAgdmFyIHNjcmVlbkxlZnQgPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclggLSBoYWxmV2lkdGgpIC8gY2VudGVyWik7CiAgICAgIHZhciBzY3JlZW5Ub3AgPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclkgKyBoYWxmSGVpZ2h0KSAvIGNlbnRlclopOwogICAgICB2YXIgc2NyZWVuUmlnaHQgPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclggKyBoYWxmV2lkdGgpIC8gY2VudGVyWik7CiAgICAgIHZhciBzY3JlZW5Cb3R0b20gPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclkgLSBoYWxmSGVpZ2h0KSAvIGNlbnRlclopOwogICAgICB2YXIgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKICAgICAgcmVzdWx0WzBdID0gTWF0aC5tYXgoZm92TGVmdCwgc2NyZWVuTGVmdCk7CiAgICAgIHJlc3VsdFsxXSA9IE1hdGgubWluKGZvdlRvcCwgc2NyZWVuVG9wKTsKICAgICAgcmVzdWx0WzJdID0gTWF0aC5taW4oZm92UmlnaHQsIHNjcmVlblJpZ2h0KTsKICAgICAgcmVzdWx0WzNdID0gTWF0aC5tYXgoZm92Qm90dG9tLCBzY3JlZW5Cb3R0b20pOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmdldExlZnRFeWVOb0xlbnNUYW5BbmdsZXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKICAgICAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwogICAgICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CiAgICAgIHZhciBmb3ZMZWZ0ID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbigtZGVnVG9SYWQgKiB2aWV3ZXIuZm92KSk7CiAgICAgIHZhciBmb3ZUb3AgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogICAgICB2YXIgZm92UmlnaHQgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdikpOwogICAgICB2YXIgZm92Qm90dG9tID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbigtZGVnVG9SYWQgKiB2aWV3ZXIuZm92KSk7CiAgICAgIHZhciBoYWxmV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyA0OwogICAgICB2YXIgaGFsZkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyAyOwogICAgICB2YXIgdmVydGljYWxMZW5zT2Zmc2V0ID0gdmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzIC0gaGFsZkhlaWdodDsKICAgICAgdmFyIGNlbnRlclggPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC0gaGFsZldpZHRoOwogICAgICB2YXIgY2VudGVyWSA9IC12ZXJ0aWNhbExlbnNPZmZzZXQ7CiAgICAgIHZhciBjZW50ZXJaID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICAgICAgdmFyIHNjcmVlbkxlZnQgPSAoY2VudGVyWCAtIGhhbGZXaWR0aCkgLyBjZW50ZXJaOwogICAgICB2YXIgc2NyZWVuVG9wID0gKGNlbnRlclkgKyBoYWxmSGVpZ2h0KSAvIGNlbnRlclo7CiAgICAgIHZhciBzY3JlZW5SaWdodCA9IChjZW50ZXJYICsgaGFsZldpZHRoKSAvIGNlbnRlclo7CiAgICAgIHZhciBzY3JlZW5Cb3R0b20gPSAoY2VudGVyWSAtIGhhbGZIZWlnaHQpIC8gY2VudGVyWjsKICAgICAgcmVzdWx0WzBdID0gTWF0aC5tYXgoZm92TGVmdCwgc2NyZWVuTGVmdCk7CiAgICAgIHJlc3VsdFsxXSA9IE1hdGgubWluKGZvdlRvcCwgc2NyZWVuVG9wKTsKICAgICAgcmVzdWx0WzJdID0gTWF0aC5taW4oZm92UmlnaHQsIHNjcmVlblJpZ2h0KTsKICAgICAgcmVzdWx0WzNdID0gTWF0aC5tYXgoZm92Qm90dG9tLCBzY3JlZW5Cb3R0b20pOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmdldExlZnRFeWVWaXNpYmxlU2NyZWVuUmVjdCA9IGZ1bmN0aW9uICh1bmRpc3RvcnRlZEZydXN0dW0pIHsKICAgICAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwogICAgICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CiAgICAgIHZhciBkaXN0ID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICAgICAgdmFyIGV5ZVggPSAoZGV2aWNlLndpZHRoTWV0ZXJzIC0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlKSAvIDI7CiAgICAgIHZhciBleWVZID0gdmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzOwogICAgICB2YXIgbGVmdCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMF0gKiBkaXN0ICsgZXllWCkgLyBkZXZpY2Uud2lkdGhNZXRlcnM7CiAgICAgIHZhciB0b3AgPSAodW5kaXN0b3J0ZWRGcnVzdHVtWzFdICogZGlzdCArIGV5ZVkpIC8gZGV2aWNlLmhlaWdodE1ldGVyczsKICAgICAgdmFyIHJpZ2h0ID0gKHVuZGlzdG9ydGVkRnJ1c3R1bVsyXSAqIGRpc3QgKyBleWVYKSAvIGRldmljZS53aWR0aE1ldGVyczsKICAgICAgdmFyIGJvdHRvbSA9ICh1bmRpc3RvcnRlZEZydXN0dW1bM10gKiBkaXN0ICsgZXllWSkgLyBkZXZpY2UuaGVpZ2h0TWV0ZXJzOwogICAgICByZXR1cm4gewogICAgICAgIHg6IGxlZnQsCiAgICAgICAgeTogYm90dG9tLAogICAgICAgIHdpZHRoOiByaWdodCAtIGxlZnQsCiAgICAgICAgaGVpZ2h0OiB0b3AgLSBib3R0b20KICAgICAgfTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAob3B0X2lzVW5kaXN0b3J0ZWQpIHsKICAgICAgcmV0dXJuIG9wdF9pc1VuZGlzdG9ydGVkID8gdGhpcy5nZXRVbmRpc3RvcnRlZEZpZWxkT2ZWaWV3TGVmdEV5ZSgpIDogdGhpcy5nZXREaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUoKTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRGaWVsZE9mVmlld1JpZ2h0RXllID0gZnVuY3Rpb24gKG9wdF9pc1VuZGlzdG9ydGVkKSB7CiAgICAgIHZhciBmb3YgPSB0aGlzLmdldEZpZWxkT2ZWaWV3TGVmdEV5ZShvcHRfaXNVbmRpc3RvcnRlZCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgbGVmdERlZ3JlZXM6IGZvdi5yaWdodERlZ3JlZXMsCiAgICAgICAgcmlnaHREZWdyZWVzOiBmb3YubGVmdERlZ3JlZXMsCiAgICAgICAgdXBEZWdyZWVzOiBmb3YudXBEZWdyZWVzLAogICAgICAgIGRvd25EZWdyZWVzOiBmb3YuZG93bkRlZ3JlZXMKICAgICAgfTsKICAgIH07CiAgICBEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRVbmRpc3RvcnRlZEZpZWxkT2ZWaWV3TGVmdEV5ZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHAgPSB0aGlzLmdldFVuZGlzdG9ydGVkUGFyYW1zXygpOwogICAgICByZXR1cm4gewogICAgICAgIGxlZnREZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLm91dGVyRGlzdCksCiAgICAgICAgcmlnaHREZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLmlubmVyRGlzdCksCiAgICAgICAgZG93bkRlZ3JlZXM6IHJhZFRvRGVnICogTWF0aC5hdGFuKHAuYm90dG9tRGlzdCksCiAgICAgICAgdXBEZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLnRvcERpc3QpCiAgICAgIH07CiAgICB9OwogICAgRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0VW5kaXN0b3J0ZWRWaWV3cG9ydExlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBwID0gdGhpcy5nZXRVbmRpc3RvcnRlZFBhcmFtc18oKTsKICAgICAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwogICAgICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CiAgICAgIHZhciBleWVUb1NjcmVlbkRpc3RhbmNlID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKICAgICAgdmFyIHNjcmVlbldpZHRoID0gZGV2aWNlLndpZHRoTWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKICAgICAgdmFyIHNjcmVlbkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwogICAgICB2YXIgeFB4UGVyVGFuQW5nbGUgPSBkZXZpY2Uud2lkdGggLyBzY3JlZW5XaWR0aDsKICAgICAgdmFyIHlQeFBlclRhbkFuZ2xlID0gZGV2aWNlLmhlaWdodCAvIHNjcmVlbkhlaWdodDsKICAgICAgdmFyIHggPSBNYXRoLnJvdW5kKChwLmV5ZVBvc1ggLSBwLm91dGVyRGlzdCkgKiB4UHhQZXJUYW5BbmdsZSk7CiAgICAgIHZhciB5ID0gTWF0aC5yb3VuZCgocC5leWVQb3NZIC0gcC5ib3R0b21EaXN0KSAqIHlQeFBlclRhbkFuZ2xlKTsKICAgICAgcmV0dXJuIHsKICAgICAgICB4OiB4LAogICAgICAgIHk6IHksCiAgICAgICAgd2lkdGg6IE1hdGgucm91bmQoKHAuZXllUG9zWCArIHAuaW5uZXJEaXN0KSAqIHhQeFBlclRhbkFuZ2xlKSAtIHgsCiAgICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKChwLmV5ZVBvc1kgKyBwLnRvcERpc3QpICogeVB4UGVyVGFuQW5nbGUpIC0geQogICAgICB9OwogICAgfTsKICAgIERldmljZUluZm8ucHJvdG90eXBlLmdldFVuZGlzdG9ydGVkUGFyYW1zXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwogICAgICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CiAgICAgIHZhciBkaXN0b3J0aW9uID0gdGhpcy5kaXN0b3J0aW9uOwogICAgICB2YXIgZXllVG9TY3JlZW5EaXN0YW5jZSA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgICAgIHZhciBoYWxmTGVuc0Rpc3RhbmNlID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMiAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgICAgIHZhciBzY3JlZW5XaWR0aCA9IGRldmljZS53aWR0aE1ldGVycyAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CiAgICAgIHZhciBzY3JlZW5IZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKICAgICAgdmFyIGV5ZVBvc1ggPSBzY3JlZW5XaWR0aCAvIDIgLSBoYWxmTGVuc0Rpc3RhbmNlOwogICAgICB2YXIgZXllUG9zWSA9ICh2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnMpIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKICAgICAgdmFyIG1heEZvdiA9IHZpZXdlci5mb3Y7CiAgICAgIHZhciB2aWV3ZXJNYXggPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKGRlZ1RvUmFkICogbWF4Rm92KSk7CiAgICAgIHZhciBvdXRlckRpc3QgPSBNYXRoLm1pbihleWVQb3NYLCB2aWV3ZXJNYXgpOwogICAgICB2YXIgaW5uZXJEaXN0ID0gTWF0aC5taW4oaGFsZkxlbnNEaXN0YW5jZSwgdmlld2VyTWF4KTsKICAgICAgdmFyIGJvdHRvbURpc3QgPSBNYXRoLm1pbihleWVQb3NZLCB2aWV3ZXJNYXgpOwogICAgICB2YXIgdG9wRGlzdCA9IE1hdGgubWluKHNjcmVlbkhlaWdodCAtIGV5ZVBvc1ksIHZpZXdlck1heCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3V0ZXJEaXN0OiBvdXRlckRpc3QsCiAgICAgICAgaW5uZXJEaXN0OiBpbm5lckRpc3QsCiAgICAgICAgdG9wRGlzdDogdG9wRGlzdCwKICAgICAgICBib3R0b21EaXN0OiBib3R0b21EaXN0LAogICAgICAgIGV5ZVBvc1g6IGV5ZVBvc1gsCiAgICAgICAgZXllUG9zWTogZXllUG9zWQogICAgICB9OwogICAgfTsKICAgIGZ1bmN0aW9uIENhcmRib2FyZFZpZXdlcihwYXJhbXMpIHsKICAgICAgdGhpcy5pZCA9IHBhcmFtcy5pZDsKICAgICAgdGhpcy5sYWJlbCA9IHBhcmFtcy5sYWJlbDsKICAgICAgdGhpcy5mb3YgPSBwYXJhbXMuZm92OwogICAgICB0aGlzLmludGVyTGVuc0Rpc3RhbmNlID0gcGFyYW1zLmludGVyTGVuc0Rpc3RhbmNlOwogICAgICB0aGlzLmJhc2VsaW5lTGVuc0Rpc3RhbmNlID0gcGFyYW1zLmJhc2VsaW5lTGVuc0Rpc3RhbmNlOwogICAgICB0aGlzLnNjcmVlbkxlbnNEaXN0YW5jZSA9IHBhcmFtcy5zY3JlZW5MZW5zRGlzdGFuY2U7CiAgICAgIHRoaXMuZGlzdG9ydGlvbkNvZWZmaWNpZW50cyA9IHBhcmFtcy5kaXN0b3J0aW9uQ29lZmZpY2llbnRzOwogICAgICB0aGlzLmludmVyc2VDb2VmZmljaWVudHMgPSBwYXJhbXMuaW52ZXJzZUNvZWZmaWNpZW50czsKICAgIH0KICAgIERldmljZUluZm8uVmlld2VycyA9IFZpZXdlcnM7CiAgICB2YXIgZm9ybWF0ID0gMTsKICAgIHZhciBsYXN0X3VwZGF0ZWQgPSAiMjAxOS0xMS0wOVQxNzozNjoxNFoiOwogICAgdmFyIGRldmljZXMgPSBbeyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiYXN1cy8qL05leHVzIDcvKiJ9LHsidWEiOiJOZXh1cyA3In1dLCJkcGkiOlszMjAuOCwzMjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiYXN1cy8qL0FTVVNfWDAwUEQvKiJ9LHsidWEiOiJBU1VTX1gwMFBEIn1dLCJkcGkiOjI0NSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9BU1VTX1gwMDhELyoifSx7InVhIjoiQVNVU19YMDA4RCJ9XSwiZHBpIjoyODIsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJhc3VzLyovQVNVU19aMDBBRC8qIn0seyJ1YSI6IkFTVVNfWjAwQUQifV0sImRwaSI6WzQwMyw0MDQuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMiBYTC8qIn0seyJ1YSI6IlBpeGVsIDIgWEwifV0sImRwaSI6NTM3LjksImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMyBYTC8qIn0seyJ1YSI6IlBpeGVsIDMgWEwifV0sImRwaSI6WzU1OC41LDU1My44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCBYTC8qIn0seyJ1YSI6IlBpeGVsIFhMIn1dLCJkcGkiOls1MzcuOSw1MzNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIDMvKiJ9LHsidWEiOiJQaXhlbCAzIn1dLCJkcGkiOjQ0Mi40LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIDIvKiJ9LHsidWEiOiJQaXhlbCAyIn1dLCJkcGkiOjQ0MSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsLyoifSx7InVhIjoiUGl4ZWwifV0sImRwaSI6WzQzMi42LDQzNi43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEM2NDM1TFZXLyoifSx7InVhIjoiSFRDNjQzNUxWVyJ9XSwiZHBpIjpbNDQ5LjcsNDQzLjNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQyBPbmUgWEwvKiJ9LHsidWEiOiJIVEMgT25lIFhMIn1dLCJkcGkiOlszMTUuMywzMTQuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiaHRjLyovTmV4dXMgOS8qIn0seyJ1YSI6Ik5leHVzIDkifV0sImRwaSI6Mjg5LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZSBNOS8qIn0seyJ1YSI6IkhUQyBPbmUgTTkifV0sImRwaSI6WzQ0Mi41LDQ0My4zXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQyBPbmVfTTgvKiJ9LHsidWEiOiJIVEMgT25lX004In1dLCJkcGkiOls0NDkuNyw0NDcuNF0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEMgT25lLyoifSx7InVhIjoiSFRDIE9uZSJ9XSwiZHBpIjo0NzIuOCwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9OZXh1cyA2UC8qIn0seyJ1YSI6Ik5leHVzIDZQIn1dLCJkcGkiOls1MTUuMSw1MThdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikh1YXdlaS8qL0JMTi1MMjQvKiJ9LHsidWEiOiJIT05PUkJMTi1MMjQifV0sImRwaSI6NDgwLCJidyI6NCwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSHVhd2VpLyovQktMLUwwOS8qIn0seyJ1YSI6IkJLTC1MMDkifV0sImRwaSI6NDAzLCJidyI6My40NywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEVOT1ZPLyovTGVub3ZvIFBCMi02OTBZLyoifSx7InVhIjoiTGVub3ZvIFBCMi02OTBZIn1dLCJkcGkiOls0NTcuMiw0NTQuNzEzXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL05leHVzIDVYLyoifSx7InVhIjoiTmV4dXMgNVgifV0sImRwaSI6WzQyMiw0MTkuOV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEdNUzM0NS8qIn0seyJ1YSI6IkxHTVMzNDUifV0sImRwaSI6WzIyMS43LDIxOS4xXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHLUQ4MDAvKiJ9LHsidWEiOiJMRy1EODAwIn1dLCJkcGkiOls0MjIsNDI0LjFdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEctRDg1MC8qIn0seyJ1YSI6IkxHLUQ4NTAifV0sImRwaSI6WzUzNy45LDU0MS45XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL1ZTOTg1IDRHLyoifSx7InVhIjoiVlM5ODUgNEcifV0sImRwaSI6WzUzNy45LDUzNS42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9OZXh1cyA1LyoifSx7InVhIjoiTmV4dXMgNSBCIn1dLCJkcGkiOls0NDIuNCw0NDQuOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTmV4dXMgNC8qIn0seyJ1YSI6Ik5leHVzIDQifV0sImRwaSI6WzMxOS44LDMxOC40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MRy1QNzY5LyoifSx7InVhIjoiTEctUDc2OSJ9XSwiZHBpIjpbMjQwLjYsMjQ3LjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHTVMzMjMvKiJ9LHsidWEiOiJMR01TMzIzIn1dLCJkcGkiOlsyMDYuNiwyMDQuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEdMUzk5Ni8qIn0seyJ1YSI6IkxHTFM5OTYifV0sImRwaSI6WzQwMy40LDQwMS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJNaWNyb21heC8qLzQ1NjBNTVgvKiJ9LHsidWEiOiI0NTYwTU1YIn1dLCJkcGkiOlsyNDAsMjE5LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik1pY3JvbWF4LyovQTI1MC8qIn0seyJ1YSI6Ik1pY3JvbWF4IEEyNTAifV0sImRwaSI6WzQ4MCw0NDYuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTWljcm9tYXgvKi9NaWNyb21heCBBUTQ1MDEvKiJ9LHsidWEiOiJNaWNyb21heCBBUTQ1MDEifV0sImRwaSI6MjQwLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9HNS8qIn0seyJ1YSI6Ik1vdG8gRyAoNSkgUGx1cyJ9XSwiZHBpIjpbNDAzLjQsNDAzXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0RST0lEIFJBWlIvKiJ9LHsidWEiOiJEUk9JRCBSQVpSIn1dLCJkcGkiOlszNjguMSwyNTYuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDgzMEMvKiJ9LHsidWEiOiJYVDgzMEMifV0sImRwaSI6WzI1NCwyNTUuOV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwMjEvKiJ9LHsidWEiOiJYVDEwMjEifV0sImRwaSI6WzI1NCwyNTYuN10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAyMy8qIn0seyJ1YSI6IlhUMTAyMyJ9XSwiZHBpIjpbMjU0LDI1Ni43XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDI4LyoifSx7InVhIjoiWFQxMDI4In1dLCJkcGkiOlszMjYuNiwzMjcuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwMzQvKiJ9LHsidWEiOiJYVDEwMzQifV0sImRwaSI6WzMyNi42LDMyOC40XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDUzLyoifSx7InVhIjoiWFQxMDUzIn1dLCJkcGkiOlszMTUuMywzMTYuMV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDE1NjIvKiJ9LHsidWEiOiJYVDE1NjIifV0sImRwaSI6WzQwMy40LDQwMi43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL05leHVzIDYvKiJ9LHsidWEiOiJOZXh1cyA2IEIifV0sImRwaSI6WzQ5NC4zLDQ4OS43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA2My8qIn0seyJ1YSI6IlhUMTA2MyJ9XSwiZHBpIjpbMjk1LDI5Ni42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA2NC8qIn0seyJ1YSI6IlhUMTA2NCJ9XSwiZHBpIjpbMjk1LDI5NS42XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDkyLyoifSx7InVhIjoiWFQxMDkyIn1dLCJkcGkiOls0MjIsNDI0LjFdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwOTUvKiJ9LHsidWEiOiJYVDEwOTUifV0sImRwaSI6WzQyMiw0MjMuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9HNC8qIn0seyJ1YSI6Ik1vdG8gRyAoNCkifV0sImRwaSI6NDAxLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9BMDAwMS8qIn0seyJ1YSI6IkEwMDAxIn1dLCJkcGkiOls0MDMuNCw0MDFdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgRTEwMDEvKiJ9LHsidWEiOiJPTkUgRTEwMDEifV0sImRwaSI6WzQ0Mi40LDQ0MS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEUxMDAzLyoifSx7InVhIjoiT05FIEUxMDAzIn1dLCJkcGkiOls0NDIuNCw0NDEuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBFMTAwNS8qIn0seyJ1YSI6Ik9ORSBFMTAwNSJ9XSwiZHBpIjpbNDQyLjQsNDQxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTIwMDEvKiJ9LHsidWEiOiJPTkUgQTIwMDEifV0sImRwaSI6WzM5MS45LDQwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEEyMDAzLyoifSx7InVhIjoiT05FIEEyMDAzIn1dLCJkcGkiOlszOTEuOSw0MDUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBBMjAwNS8qIn0seyJ1YSI6Ik9ORSBBMjAwNSJ9XSwiZHBpIjpbMzkxLjksNDA1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEEzMDAwLyoifSx7InVhIjoiT05FUExVUyBBMzAwMCJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBMzAwMy8qIn0seyJ1YSI6Ik9ORVBMVVMgQTMwMDMifV0sImRwaSI6NDAxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTMwMTAvKiJ9LHsidWEiOiJPTkVQTFVTIEEzMDEwIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEE1MDAwLyoifSx7InVhIjoiT05FUExVUyBBNTAwMCAifV0sImRwaSI6WzQwMy40MTEsMzk5LjczN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBBNTAxMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTUwMTAifV0sImRwaSI6WzQwMyw0MDBdLCJidyI6MiwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEE2MDAwLyoifSx7InVhIjoiT05FUExVUyBBNjAwMCJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNjAwMy8qIn0seyJ1YSI6Ik9ORVBMVVMgQTYwMDMifV0sImRwaSI6NDAxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTYwMTAvKiJ9LHsidWEiOiJPTkVQTFVTIEE2MDEwIn1dLCJkcGkiOjQwMSwiYnciOjIsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEE2MDEzLyoifSx7InVhIjoiT05FUExVUyBBNjAxMyJ9XSwiZHBpIjo0MDEsImJ3IjoyLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPUFBPLyovWDkwOS8qIn0seyJ1YSI6Ilg5MDkifV0sImRwaSI6WzQ0Mi40LDQ0NC4xXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkwODIvKiJ9LHsidWEiOiJHVC1JOTA4MiJ9XSwiZHBpIjpbMTg0LjcsMTg1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HMzYwUC8qIn0seyJ1YSI6IlNNLUczNjBQIn1dLCJkcGkiOlsxOTYuNywyMDUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL05leHVzIFMvKiJ9LHsidWEiOiJOZXh1cyBTIn1dLCJkcGkiOlsyMzQuNSwyMjkuOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MzAwLyoifSx7InVhIjoiR1QtSTkzMDAifV0sImRwaSI6WzMwNC44LDMwMy45XSwiYnciOjUsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1UMjMwTlUvKiJ9LHsidWEiOiJTTS1UMjMwTlUifV0sImRwaSI6MjE2LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NHSC1UMzk5LyoifSx7InVhIjoiU0dILVQzOTkifV0sImRwaSI6WzIxNy43LDIzMS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0dILU05MTkvKiJ9LHsidWEiOiJTR0gtTTkxOSJ9XSwiZHBpIjpbNDQwLjgsNDM3LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTAwNS8qIn0seyJ1YSI6IlNNLU45MDA1In1dLCJkcGkiOlszODYuNCwzODddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NBTVNVTkctU00tTjkwMEEvKiJ9LHsidWEiOiJTQU1TVU5HLVNNLU45MDBBIn1dLCJkcGkiOlszODYuNCwzODcuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5NTAwLyoifSx7InVhIjoiR1QtSTk1MDAifV0sImRwaSI6WzQ0Mi41LDQ0My4zXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTUwNS8qIn0seyJ1YSI6IkdULUk5NTA1In1dLCJkcGkiOjQzOS40LCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTAwRi8qIn0seyJ1YSI6IlNNLUc5MDBGIn1dLCJkcGkiOls0MTUuNiw0MzEuNl0sImJ3Ijo1LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MDBNLyoifSx7InVhIjoiU00tRzkwME0ifV0sImRwaSI6WzQxNS42LDQzMS42XSwiYnciOjUsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzgwMEYvKiJ9LHsidWEiOiJTTS1HODAwRiJ9XSwiZHBpIjozMjYuOCwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkwNlMvKiJ9LHsidWEiOiJTTS1HOTA2UyJ9XSwiZHBpIjpbNTYyLjcsNTcyLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTMwMC8qIn0seyJ1YSI6IkdULUk5MzAwIn1dLCJkcGkiOlszMDYuNywzMDQuOF0sImJ3Ijo1LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLVQ1MzUvKiJ9LHsidWEiOiJTTS1UNTM1In1dLCJkcGkiOlsxNDIuNiwxMzYuNF0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkyMEMvKiJ9LHsidWEiOiJTTS1OOTIwQyJ9XSwiZHBpIjpbNTE1LjEsNTE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTIwUC8qIn0seyJ1YSI6IlNNLU45MjBQIn1dLCJkcGkiOlszODYuMzY1NSwzOTAuMTQ0XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkyMFc4LyoifSx7InVhIjoiU00tTjkyMFc4In1dLCJkcGkiOls1MTUuMSw1MTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MzAwSS8qIn0seyJ1YSI6IkdULUk5MzAwSSJ9XSwiZHBpIjpbMzA0LjgsMzA1LjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTE5NS8qIn0seyJ1YSI6IkdULUk5MTk1In1dLCJkcGkiOlsyNDkuNCwyNTYuN10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU1BILUw1MjAvKiJ9LHsidWEiOiJTUEgtTDUyMCJ9XSwiZHBpIjpbMjQ5LjQsMjU1LjldLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TQU1TVU5HLVNHSC1JNzE3LyoifSx7InVhIjoiU0FNU1VORy1TR0gtSTcxNyJ9XSwiZHBpIjoyODUuOCwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU1BILUQ3MTAvKiJ9LHsidWEiOiJTUEgtRDcxMCJ9XSwiZHBpIjpbMjE3LjcsMjA0LjJdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1ONzEwMC8qIn0seyJ1YSI6IkdULU43MTAwIn1dLCJkcGkiOjI2NS4xLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TQ0gtSTYwNS8qIn0seyJ1YSI6IlNDSC1JNjA1In1dLCJkcGkiOjI2NS4xLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HYWxheHkgTmV4dXMvKiJ9LHsidWEiOiJHYWxheHkgTmV4dXMifV0sImRwaSI6WzMxNS4zLDMxNC4yXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkxMEgvKiJ9LHsidWEiOiJTTS1OOTEwSCJ9XSwiZHBpIjpbNTE1LjEsNTE4XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tTjkxMEMvKiJ9LHsidWEiOiJTTS1OOTEwQyJ9XSwiZHBpIjpbNTE1LjIsNTIwLjJdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUcxMzBNLyoifSx7InVhIjoiU00tRzEzME0ifV0sImRwaSI6WzE2NS45LDE2NC44XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTI4SS8qIn0seyJ1YSI6IlNNLUc5MjhJIn1dLCJkcGkiOls1MTUuMSw1MTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjBGLyoifSx7InVhIjoiU00tRzkyMEYifV0sImRwaSI6NTgwLjYsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyMFAvKiJ9LHsidWEiOiJTTS1HOTIwUCJ9XSwiZHBpIjpbNTIyLjUsNTc3XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyNUYvKiJ9LHsidWEiOiJTTS1HOTI1RiJ9XSwiZHBpIjo1ODAuNiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTI1Vi8qIn0seyJ1YSI6IlNNLUc5MjVWIn1dLCJkcGkiOls1MjIuNSw1NzYuNl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MzBGLyoifSx7InVhIjoiU00tRzkzMEYifV0sImRwaSI6NTc2LjYsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MzVGLyoifSx7InVhIjoiU00tRzkzNUYifV0sImRwaSI6NTMzLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NTBGLyoifSx7InVhIjoiU00tRzk1MEYifV0sImRwaSI6WzU2Mi43MDcsNTY1LjI5M10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk1NVUvKiJ9LHsidWEiOiJTTS1HOTU1VSJ9XSwiZHBpIjpbNTIyLjUxNCw1MjUuNzYyXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTU1Ri8qIn0seyJ1YSI6IlNNLUc5NTVGIn1dLCJkcGkiOls1MjIuNTE0LDUyNS43NjJdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBGLyoifSx7InVhIjoiU00tRzk2MEYifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwMC8qIn0seyJ1YSI6IlNNLUc5NjAwIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MFQvKiJ9LHsidWEiOiJTTS1HOTYwVCJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBOLyoifSx7InVhIjoiU00tRzk2ME4ifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwVS8qIn0seyJ1YSI6IlNNLUc5NjBVIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MDgvKiJ9LHsidWEiOiJTTS1HOTYwOCJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBGRC8qIn0seyJ1YSI6IlNNLUc5NjBGRCJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBXLyoifSx7InVhIjoiU00tRzk2MFcifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTY1Ri8qIn0seyJ1YSI6IlNNLUc5NjVGIn1dLCJkcGkiOjUyOSwiYnciOjIsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovQzY5MDMvKiJ9LHsidWEiOiJDNjkwMyJ9XSwiZHBpIjpbNDQyLjUsNDQzLjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0Q2NjUzLyoifSx7InVhIjoiRDY2NTMifV0sImRwaSI6WzQyOC42LDQyNy42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovRTY2NTMvKiJ9LHsidWEiOiJFNjY1MyJ9XSwiZHBpIjpbNDI4LjYsNDI1LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9FNjg1My8qIn0seyJ1YSI6IkU2ODUzIn1dLCJkcGkiOls0MDMuNCw0MDEuOV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL1NHUDMyMS8qIn0seyJ1YSI6IlNHUDMyMSJ9XSwiZHBpIjpbMjI0LjcsMjI0LjFdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiVENULyovQUxDQVRFTCBPTkUgVE9VQ0ggRmllcmNlLyoifSx7InVhIjoiQUxDQVRFTCBPTkUgVE9VQ0ggRmllcmNlIn1dLCJkcGkiOlsyNDAsMjQ3LjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlRITC8qL3RobCA1MDAwLyoifSx7InVhIjoidGhsIDUwMDAifV0sImRwaSI6WzQ4MCw0NDMuM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiRmx5LyovSVE0NDEyLyoifSx7InVhIjoiSVE0NDEyIn1dLCJkcGkiOjMwNy45LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlpURS8qL1pURSBCbGFkZSBMMi8qIn0seyJ1YSI6IlpURSBCbGFkZSBMMiJ9XSwiZHBpIjoyNDAsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJCRU5FVkUvKi9WUjUxOC8qIn0seyJ1YSI6IlZSNTE4In1dLCJkcGkiOjQ4MCwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls2NDAsOTYwXX1dLCJkcGkiOlszMjUuMSwzMjguNF0sImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzY0MCwxMTM2XX1dLCJkcGkiOlszMTcuMSwzMjAuMl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6Wzc1MCwxMzM0XX1dLCJkcGkiOjMyNi40LCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMjQyLDIyMDhdfV0sImRwaSI6WzQ1My42LDQ1OC40XSwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbMTEyNSwyMDAxXX1dLCJkcGkiOls0MTAuOSw0MTUuNF0sImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzExMjUsMjQzNl19XSwiZHBpIjo0NTgsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSHVhd2VpLyovRU1MLUwyOS8qIn0seyJ1YSI6IkVNTC1MMjkifV0sImRwaSI6NDI4LCJidyI6My40NSwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTm9raWEvKi9Ob2tpYSA3LjEvKiJ9LHsidWEiOiJOb2tpYSA3LjEifV0sImRwaSI6WzQzMiw0MzEuOV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbMTI0MiwyNjg4XX1dLCJkcGkiOjQ1OCwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzU3ME0vKiJ9LHsidWEiOiJTTS1HNTcwTSJ9XSwiZHBpIjozMjAsImJ3IjozLjY4NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTcwRi8qIn0seyJ1YSI6IlNNLUc5NzBGIn1dLCJkcGkiOjQzOCwiYnciOjIuMjgxLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk3M0YvKiJ9LHsidWEiOiJTTS1HOTczRiJ9XSwiZHBpIjo1NTAsImJ3IjoyLjAwMiwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NzVGLyoifSx7InVhIjoiU00tRzk3NUYifV0sImRwaSI6NTIyLCJidyI6Mi4wNTQsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTc3Ri8qIn0seyJ1YSI6IlNNLUc5NzdGIn1dLCJkcGkiOjUwNSwiYnciOjIuMzM0LCJhYyI6NTAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbODI4LDE3OTJdfV0sImRwaSI6MzI2LCJidyI6NSwiYWMiOjUwMH1dOwogICAgdmFyIERQREJfQ0FDSEUgPSB7CiAgICAJZm9ybWF0OiBmb3JtYXQsCiAgICAJbGFzdF91cGRhdGVkOiBsYXN0X3VwZGF0ZWQsCiAgICAJZGV2aWNlczogZGV2aWNlcwogICAgfTsKICAgIGZ1bmN0aW9uIERwZGIodXJsLCBvbkRldmljZVBhcmFtc1VwZGF0ZWQpIHsKICAgICAgdGhpcy5kcGRiID0gRFBEQl9DQUNIRTsKICAgICAgdGhpcy5yZWNhbGN1bGF0ZURldmljZVBhcmFtc18oKTsKICAgICAgaWYgKHVybCkgewogICAgICAgIHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkID0gb25EZXZpY2VQYXJhbXNVcGRhdGVkOwogICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICB2YXIgb2JqID0gdGhpczsKICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCB0cnVlKTsKICAgICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG9iai5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8PSAyOTkpIHsKICAgICAgICAgICAgb2JqLmRwZGIgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7CiAgICAgICAgICAgIG9iai5yZWNhbGN1bGF0ZURldmljZVBhcmFtc18oKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgb25saW5lIERQREIhJyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgeGhyLnNlbmQoKTsKICAgICAgfQogICAgfQogICAgRHBkYi5wcm90b3R5cGUuZ2V0RGV2aWNlUGFyYW1zID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gdGhpcy5kZXZpY2VQYXJhbXM7CiAgICB9OwogICAgRHBkYi5wcm90b3R5cGUucmVjYWxjdWxhdGVEZXZpY2VQYXJhbXNfID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgbmV3RGV2aWNlUGFyYW1zID0gdGhpcy5jYWxjRGV2aWNlUGFyYW1zXygpOwogICAgICBpZiAobmV3RGV2aWNlUGFyYW1zKSB7CiAgICAgICAgdGhpcy5kZXZpY2VQYXJhbXMgPSBuZXdEZXZpY2VQYXJhbXM7CiAgICAgICAgaWYgKHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkKSB7CiAgICAgICAgICB0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCh0aGlzLmRldmljZVBhcmFtcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byByZWNhbGN1bGF0ZSBkZXZpY2UgcGFyYW1ldGVycy4nKTsKICAgICAgfQogICAgfTsKICAgIERwZGIucHJvdG90eXBlLmNhbGNEZXZpY2VQYXJhbXNfID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZGIgPSB0aGlzLmRwZGI7CiAgICAgIGlmICghZGIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdEUERCIG5vdCBhdmFpbGFibGUuJyk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgaWYgKGRiLmZvcm1hdCAhPSAxKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRFBEQiBoYXMgdW5leHBlY3RlZCBmb3JtYXQgdmVyc2lvbi4nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoIWRiLmRldmljZXMgfHwgIWRiLmRldmljZXMubGVuZ3RoKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRFBEQiBkb2VzIG5vdCBoYXZlIGEgZGV2aWNlcyBzZWN0aW9uLicpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50IHx8IG5hdmlnYXRvci52ZW5kb3IgfHwgd2luZG93Lm9wZXJhOwogICAgICB2YXIgd2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpOwogICAgICB2YXIgaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCk7CiAgICAgIGlmICghZGIuZGV2aWNlcykgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RQREIgaGFzIG5vIGRldmljZXMgc2VjdGlvbi4nKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRiLmRldmljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgZGV2aWNlID0gZGIuZGV2aWNlc1tpXTsKICAgICAgICBpZiAoIWRldmljZS5ydWxlcykgewogICAgICAgICAgY29uc29sZS53YXJuKCdEZXZpY2VbJyArIGkgKyAnXSBoYXMgbm8gcnVsZXMgc2VjdGlvbi4nKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZGV2aWNlLnR5cGUgIT0gJ2lvcycgJiYgZGV2aWNlLnR5cGUgIT0gJ2FuZHJvaWQnKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ0RldmljZVsnICsgaSArICddIGhhcyBpbnZhbGlkIHR5cGUuJyk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzSU9TKCkgIT0gKGRldmljZS50eXBlID09ICdpb3MnKSkgY29udGludWU7CiAgICAgICAgdmFyIG1hdGNoZWQgPSBmYWxzZTsKICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGRldmljZS5ydWxlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgdmFyIHJ1bGUgPSBkZXZpY2UucnVsZXNbal07CiAgICAgICAgICBpZiAodGhpcy5ydWxlTWF0Y2hlc18ocnVsZSwgdXNlckFnZW50LCB3aWR0aCwgaGVpZ2h0KSkgewogICAgICAgICAgICBtYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghbWF0Y2hlZCkgY29udGludWU7CiAgICAgICAgdmFyIHhkcGkgPSBkZXZpY2UuZHBpWzBdIHx8IGRldmljZS5kcGk7CiAgICAgICAgdmFyIHlkcGkgPSBkZXZpY2UuZHBpWzFdIHx8IGRldmljZS5kcGk7CiAgICAgICAgcmV0dXJuIG5ldyBEZXZpY2VQYXJhbXMoeyB4ZHBpOiB4ZHBpLCB5ZHBpOiB5ZHBpLCBiZXZlbE1tOiBkZXZpY2UuYncgfSk7CiAgICAgIH0KICAgICAgY29uc29sZS53YXJuKCdObyBEUERCIGRldmljZSBtYXRjaC4nKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogICAgRHBkYi5wcm90b3R5cGUucnVsZU1hdGNoZXNfID0gZnVuY3Rpb24gKHJ1bGUsIHVhLCBzY3JlZW5XaWR0aCwgc2NyZWVuSGVpZ2h0KSB7CiAgICAgIGlmICghcnVsZS51YSAmJiAhcnVsZS5yZXMpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHJ1bGUudWEgJiYgcnVsZS51YS5zdWJzdHJpbmcoMCwgMikgPT09ICdTTScpIHJ1bGUudWEgPSBydWxlLnVhLnN1YnN0cmluZygwLCA3KTsKICAgICAgaWYgKHJ1bGUudWEgJiYgdWEuaW5kZXhPZihydWxlLnVhKSA8IDApIHJldHVybiBmYWxzZTsKICAgICAgaWYgKHJ1bGUucmVzKSB7CiAgICAgICAgaWYgKCFydWxlLnJlc1swXSB8fCAhcnVsZS5yZXNbMV0pIHJldHVybiBmYWxzZTsKICAgICAgICB2YXIgcmVzWCA9IHJ1bGUucmVzWzBdOwogICAgICAgIHZhciByZXNZID0gcnVsZS5yZXNbMV07CiAgICAgICAgaWYgKE1hdGgubWluKHNjcmVlbldpZHRoLCBzY3JlZW5IZWlnaHQpICE9IE1hdGgubWluKHJlc1gsIHJlc1kpIHx8IE1hdGgubWF4KHNjcmVlbldpZHRoLCBzY3JlZW5IZWlnaHQpICE9IE1hdGgubWF4KHJlc1gsIHJlc1kpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfTsKICAgIGZ1bmN0aW9uIERldmljZVBhcmFtcyhwYXJhbXMpIHsKICAgICAgdGhpcy54ZHBpID0gcGFyYW1zLnhkcGk7CiAgICAgIHRoaXMueWRwaSA9IHBhcmFtcy55ZHBpOwogICAgICB0aGlzLmJldmVsTW0gPSBwYXJhbXMuYmV2ZWxNbTsKICAgIH0KICAgIGZ1bmN0aW9uIFNlbnNvclNhbXBsZShzYW1wbGUsIHRpbWVzdGFtcFMpIHsKICAgICAgdGhpcy5zZXQoc2FtcGxlLCB0aW1lc3RhbXBTKTsKICAgIH0KICAgIFNlbnNvclNhbXBsZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKHNhbXBsZSwgdGltZXN0YW1wUykgewogICAgICB0aGlzLnNhbXBsZSA9IHNhbXBsZTsKICAgICAgdGhpcy50aW1lc3RhbXBTID0gdGltZXN0YW1wUzsKICAgIH07CiAgICBTZW5zb3JTYW1wbGUucHJvdG90eXBlLmNvcHkgPSBmdW5jdGlvbiAoc2Vuc29yU2FtcGxlKSB7CiAgICAgIHRoaXMuc2V0KHNlbnNvclNhbXBsZS5zYW1wbGUsIHNlbnNvclNhbXBsZS50aW1lc3RhbXBTKTsKICAgIH07CiAgICBmdW5jdGlvbiBDb21wbGVtZW50YXJ5RmlsdGVyKGtGaWx0ZXIsIGlzRGVidWcpIHsKICAgICAgdGhpcy5rRmlsdGVyID0ga0ZpbHRlcjsKICAgICAgdGhpcy5pc0RlYnVnID0gaXNEZWJ1ZzsKICAgICAgdGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudCA9IG5ldyBTZW5zb3JTYW1wbGUoKTsKICAgICAgdGhpcy5jdXJyZW50R3lyb01lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwogICAgICB0aGlzLnByZXZpb3VzR3lyb01lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwogICAgICBpZiAoaXNJT1MoKSkgewogICAgICAgIHRoaXMuZmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKC0xLCAwLCAwLCAxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigxLCAwLCAwLCAxKTsKICAgICAgfQogICAgICB0aGlzLnByZXZpb3VzRmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNGaWx0ZXJRLmNvcHkodGhpcy5maWx0ZXJRKTsKICAgICAgdGhpcy5hY2NlbFEgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCA9IGZhbHNlOwogICAgICB0aGlzLmVzdGltYXRlZEdyYXZpdHkgPSBuZXcgVmVjdG9yMygpOwogICAgICB0aGlzLm1lYXN1cmVkR3Jhdml0eSA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIHRoaXMuZ3lyb0ludGVncmFsUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICB9CiAgICBDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5hZGRBY2NlbE1lYXN1cmVtZW50ID0gZnVuY3Rpb24gKHZlY3RvciwgdGltZXN0YW1wUykgewogICAgICB0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50LnNldCh2ZWN0b3IsIHRpbWVzdGFtcFMpOwogICAgfTsKICAgIENvbXBsZW1lbnRhcnlGaWx0ZXIucHJvdG90eXBlLmFkZEd5cm9NZWFzdXJlbWVudCA9IGZ1bmN0aW9uICh2ZWN0b3IsIHRpbWVzdGFtcFMpIHsKICAgICAgdGhpcy5jdXJyZW50R3lyb01lYXN1cmVtZW50LnNldCh2ZWN0b3IsIHRpbWVzdGFtcFMpOwogICAgICB2YXIgZGVsdGFUID0gdGltZXN0YW1wUyAtIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUzsKICAgICAgaWYgKGlzVGltZXN0YW1wRGVsdGFWYWxpZChkZWx0YVQpKSB7CiAgICAgICAgdGhpcy5ydW5fKCk7CiAgICAgIH0KICAgICAgdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudC5jb3B5KHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudCk7CiAgICB9OwogICAgQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUucnVuXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCF0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCkgewogICAgICAgIHRoaXMuYWNjZWxRID0gdGhpcy5hY2NlbFRvUXVhdGVybmlvbl8odGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudC5zYW1wbGUpOwogICAgICAgIHRoaXMucHJldmlvdXNGaWx0ZXJRLmNvcHkodGhpcy5hY2NlbFEpOwogICAgICAgIHRoaXMuaXNPcmllbnRhdGlvbkluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGRlbHRhVCA9IHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudC50aW1lc3RhbXBTIC0gdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudC50aW1lc3RhbXBTOwogICAgICB2YXIgZ3lyb0RlbHRhUSA9IHRoaXMuZ3lyb1RvUXVhdGVybmlvbkRlbHRhXyh0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQuc2FtcGxlLCBkZWx0YVQpOwogICAgICB0aGlzLmd5cm9JbnRlZ3JhbFEubXVsdGlwbHkoZ3lyb0RlbHRhUSk7CiAgICAgIHRoaXMuZmlsdGVyUS5jb3B5KHRoaXMucHJldmlvdXNGaWx0ZXJRKTsKICAgICAgdGhpcy5maWx0ZXJRLm11bHRpcGx5KGd5cm9EZWx0YVEpOwogICAgICB2YXIgaW52RmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIGludkZpbHRlclEuY29weSh0aGlzLmZpbHRlclEpOwogICAgICBpbnZGaWx0ZXJRLmludmVyc2UoKTsKICAgICAgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LnNldCgwLCAwLCAtMSk7CiAgICAgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5hcHBseVF1YXRlcm5pb24oaW52RmlsdGVyUSk7CiAgICAgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5ub3JtYWxpemUoKTsKICAgICAgdGhpcy5tZWFzdXJlZEdyYXZpdHkuY29weSh0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50LnNhbXBsZSk7CiAgICAgIHRoaXMubWVhc3VyZWRHcmF2aXR5Lm5vcm1hbGl6ZSgpOwogICAgICB2YXIgZGVsdGFRID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgZGVsdGFRLnNldEZyb21Vbml0VmVjdG9ycyh0aGlzLmVzdGltYXRlZEdyYXZpdHksIHRoaXMubWVhc3VyZWRHcmF2aXR5KTsKICAgICAgZGVsdGFRLmludmVyc2UoKTsKICAgICAgaWYgKHRoaXMuaXNEZWJ1ZykgewogICAgICAgIGNvbnNvbGUubG9nKCdEZWx0YTogJWQgZGVnLCBHX2VzdDogKCVzLCAlcywgJXMpLCBHX21lYXM6ICglcywgJXMsICVzKScsIHJhZFRvRGVnICogZ2V0UXVhdGVybmlvbkFuZ2xlKGRlbHRhUSksIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS54LnRvRml4ZWQoMSksIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS55LnRvRml4ZWQoMSksIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS56LnRvRml4ZWQoMSksIHRoaXMubWVhc3VyZWRHcmF2aXR5LngudG9GaXhlZCgxKSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkueS50b0ZpeGVkKDEpLCB0aGlzLm1lYXN1cmVkR3Jhdml0eS56LnRvRml4ZWQoMSkpOwogICAgICB9CiAgICAgIHZhciB0YXJnZXRRID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGFyZ2V0US5jb3B5KHRoaXMuZmlsdGVyUSk7CiAgICAgIHRhcmdldFEubXVsdGlwbHkoZGVsdGFRKTsKICAgICAgdGhpcy5maWx0ZXJRLnNsZXJwKHRhcmdldFEsIDEgLSB0aGlzLmtGaWx0ZXIpOwogICAgICB0aGlzLnByZXZpb3VzRmlsdGVyUS5jb3B5KHRoaXMuZmlsdGVyUSk7CiAgICB9OwogICAgQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuZ2V0T3JpZW50YXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB0aGlzLmZpbHRlclE7CiAgICB9OwogICAgQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuYWNjZWxUb1F1YXRlcm5pb25fID0gZnVuY3Rpb24gKGFjY2VsKSB7CiAgICAgIHZhciBub3JtQWNjZWwgPSBuZXcgVmVjdG9yMygpOwogICAgICBub3JtQWNjZWwuY29weShhY2NlbCk7CiAgICAgIG5vcm1BY2NlbC5ub3JtYWxpemUoKTsKICAgICAgdmFyIHF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBxdWF0LnNldEZyb21Vbml0VmVjdG9ycyhuZXcgVmVjdG9yMygwLCAwLCAtMSksIG5vcm1BY2NlbCk7CiAgICAgIHF1YXQuaW52ZXJzZSgpOwogICAgICByZXR1cm4gcXVhdDsKICAgIH07CiAgICBDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5neXJvVG9RdWF0ZXJuaW9uRGVsdGFfID0gZnVuY3Rpb24gKGd5cm8sIGR0KSB7CiAgICAgIHZhciBxdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdmFyIGF4aXMgPSBuZXcgVmVjdG9yMygpOwogICAgICBheGlzLmNvcHkoZ3lybyk7CiAgICAgIGF4aXMubm9ybWFsaXplKCk7CiAgICAgIHF1YXQuc2V0RnJvbUF4aXNBbmdsZShheGlzLCBneXJvLmxlbmd0aCgpICogZHQpOwogICAgICByZXR1cm4gcXVhdDsKICAgIH07CiAgICBmdW5jdGlvbiBQb3NlUHJlZGljdG9yKHByZWRpY3Rpb25UaW1lUywgaXNEZWJ1ZykgewogICAgICB0aGlzLnByZWRpY3Rpb25UaW1lUyA9IHByZWRpY3Rpb25UaW1lUzsKICAgICAgdGhpcy5pc0RlYnVnID0gaXNEZWJ1ZzsKICAgICAgdGhpcy5wcmV2aW91c1EgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IG51bGw7CiAgICAgIHRoaXMuZGVsdGFRID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5vdXRRID0gbmV3IFF1YXRlcm5pb24oKTsKICAgIH0KICAgIFBvc2VQcmVkaWN0b3IucHJvdG90eXBlLmdldFByZWRpY3Rpb24gPSBmdW5jdGlvbiAoY3VycmVudFEsIGd5cm8sIHRpbWVzdGFtcFMpIHsKICAgICAgaWYgKCF0aGlzLnByZXZpb3VzVGltZXN0YW1wUykgewogICAgICAgIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwogICAgICAgIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gdGltZXN0YW1wUzsKICAgICAgICByZXR1cm4gY3VycmVudFE7CiAgICAgIH0KICAgICAgdmFyIGF4aXMgPSBuZXcgVmVjdG9yMygpOwogICAgICBheGlzLmNvcHkoZ3lybyk7CiAgICAgIGF4aXMubm9ybWFsaXplKCk7CiAgICAgIHZhciBhbmd1bGFyU3BlZWQgPSBneXJvLmxlbmd0aCgpOwogICAgICBpZiAoYW5ndWxhclNwZWVkIDwgZGVnVG9SYWQgKiAyMCkgewogICAgICAgIGlmICh0aGlzLmlzRGVidWcpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdNb3Zpbmcgc2xvd2x5LCBhdCAlcyBkZWcvczogbm8gcHJlZGljdGlvbicsIChyYWRUb0RlZyAqIGFuZ3VsYXJTcGVlZCkudG9GaXhlZCgxKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMub3V0US5jb3B5KGN1cnJlbnRRKTsKICAgICAgICB0aGlzLnByZXZpb3VzUS5jb3B5KGN1cnJlbnRRKTsKICAgICAgICByZXR1cm4gdGhpcy5vdXRROwogICAgICB9CiAgICAgIHZhciBwcmVkaWN0QW5nbGUgPSBhbmd1bGFyU3BlZWQgKiB0aGlzLnByZWRpY3Rpb25UaW1lUzsKICAgICAgdGhpcy5kZWx0YVEuc2V0RnJvbUF4aXNBbmdsZShheGlzLCBwcmVkaWN0QW5nbGUpOwogICAgICB0aGlzLm91dFEuY29weSh0aGlzLnByZXZpb3VzUSk7CiAgICAgIHRoaXMub3V0US5tdWx0aXBseSh0aGlzLmRlbHRhUSk7CiAgICAgIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwogICAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICAgIHJldHVybiB0aGlzLm91dFE7CiAgICB9OwogICAgZnVuY3Rpb24gRnVzaW9uUG9zZVNlbnNvcihrRmlsdGVyLCBwcmVkaWN0aW9uVGltZSwgeWF3T25seSwgaXNEZWJ1ZykgewogICAgICB0aGlzLnlhd09ubHkgPSB5YXdPbmx5OwogICAgICB0aGlzLmFjY2VsZXJvbWV0ZXIgPSBuZXcgVmVjdG9yMygpOwogICAgICB0aGlzLmd5cm9zY29wZSA9IG5ldyBWZWN0b3IzKCk7CiAgICAgIHRoaXMuZmlsdGVyID0gbmV3IENvbXBsZW1lbnRhcnlGaWx0ZXIoa0ZpbHRlciwgaXNEZWJ1Zyk7CiAgICAgIHRoaXMucG9zZVByZWRpY3RvciA9IG5ldyBQb3NlUHJlZGljdG9yKHByZWRpY3Rpb25UaW1lLCBpc0RlYnVnKTsKICAgICAgdGhpcy5pc0ZpcmVmb3hBbmRyb2lkID0gaXNGaXJlZm94QW5kcm9pZCgpOwogICAgICB0aGlzLmlzSU9TID0gaXNJT1MoKTsKICAgICAgdmFyIGNocm9tZVZlcnNpb24gPSBnZXRDaHJvbWVWZXJzaW9uKCk7CiAgICAgIHRoaXMuaXNEZXZpY2VNb3Rpb25JblJhZGlhbnMgPSAhdGhpcy5pc0lPUyAmJiBjaHJvbWVWZXJzaW9uICYmIGNocm9tZVZlcnNpb24gPCA2NjsKICAgICAgdGhpcy5pc1dpdGhvdXREZXZpY2VNb3Rpb24gPSBpc0Nocm9tZVdpdGhvdXREZXZpY2VNb3Rpb24oKSB8fCBpc1NhZmFyaVdpdGhvdXREZXZpY2VNb3Rpb24oKTsKICAgICAgdGhpcy5maWx0ZXJUb1dvcmxkUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIGlmIChpc0lPUygpKSB7CiAgICAgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDEsIDAsIDApLCBNYXRoLlBJIC8gMik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDEsIDAsIDApLCAtTWF0aC5QSSAvIDIpOwogICAgICB9CiAgICAgIHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy53b3JsZFRvU2NyZWVuUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMub3JpZ2luYWxQb3NlQWRqdXN0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMub3JpZ2luYWxQb3NlQWRqdXN0US5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIDEpLCAtd2luZG93Lm9yaWVudGF0aW9uICogTWF0aC5QSSAvIDE4MCk7CiAgICAgIHRoaXMuc2V0U2NyZWVuVHJhbnNmb3JtXygpOwogICAgICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkpIHsKICAgICAgICB0aGlzLmZpbHRlclRvV29ybGRRLm11bHRpcGx5KHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RKTsKICAgICAgfQogICAgICB0aGlzLnJlc2V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMub3JpZW50YXRpb25PdXRfID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKICAgICAgdGhpcy5zdGFydCgpOwogICAgfQogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuZ2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIEZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLmdldE9yaWVudGF0aW9uID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgb3JpZW50YXRpb24gPSB2b2lkIDA7CiAgICAgIGlmICh0aGlzLmlzV2l0aG91dERldmljZU1vdGlvbiAmJiB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblEpIHsKICAgICAgICB0aGlzLmRldmljZU9yaWVudGF0aW9uRml4USA9IHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaXhRIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB6ID0gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIC0xKSwgMCk7CiAgICAgICAgICB2YXIgeSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgICAgICBpZiAod2luZG93Lm9yaWVudGF0aW9uID09PSAtOTApIHsKICAgICAgICAgICAgeS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDEsIDApLCBNYXRoLlBJIC8gLTIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDEsIDApLCBNYXRoLlBJIC8gMik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gei5tdWx0aXBseSh5KTsKICAgICAgICB9KCk7CiAgICAgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpbHRlclRvV29ybGRRID0gdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpbHRlclRvV29ybGRRIHx8IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBxID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgICAgIHEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygxLCAwLCAwKSwgLU1hdGguUEkgLyAyKTsKICAgICAgICAgIHJldHVybiBxOwogICAgICAgIH0oKTsKICAgICAgICBvcmllbnRhdGlvbiA9IHRoaXMuX2RldmljZU9yaWVudGF0aW9uUTsKICAgICAgICB2YXIgb3V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgICBvdXQuY29weShvcmllbnRhdGlvbik7CiAgICAgICAgb3V0Lm11bHRpcGx5KHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaWx0ZXJUb1dvcmxkUSk7CiAgICAgICAgb3V0Lm11bHRpcGx5KHRoaXMucmVzZXRRKTsKICAgICAgICBvdXQubXVsdGlwbHkodGhpcy53b3JsZFRvU2NyZWVuUSk7CiAgICAgICAgb3V0Lm11bHRpcGx5UXVhdGVybmlvbnModGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpeFEsIG91dCk7CiAgICAgICAgaWYgKHRoaXMueWF3T25seSkgewogICAgICAgICAgb3V0LnggPSAwOwogICAgICAgICAgb3V0LnogPSAwOwogICAgICAgICAgb3V0Lm5vcm1hbGl6ZSgpOwogICAgICAgIH0KICAgICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1swXSA9IG91dC54OwogICAgICAgIHRoaXMub3JpZW50YXRpb25PdXRfWzFdID0gb3V0Lnk7CiAgICAgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMl0gPSBvdXQuejsKICAgICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1szXSA9IG91dC53OwogICAgICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uT3V0XzsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZmlsdGVyT3JpZW50YXRpb24gPSB0aGlzLmZpbHRlci5nZXRPcmllbnRhdGlvbigpOwogICAgICAgIG9yaWVudGF0aW9uID0gdGhpcy5wb3NlUHJlZGljdG9yLmdldFByZWRpY3Rpb24oZmlsdGVyT3JpZW50YXRpb24sIHRoaXMuZ3lyb3Njb3BlLCB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyk7CiAgICAgIH0KICAgICAgdmFyIG91dCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIG91dC5jb3B5KHRoaXMuZmlsdGVyVG9Xb3JsZFEpOwogICAgICBvdXQubXVsdGlwbHkodGhpcy5yZXNldFEpOwogICAgICBvdXQubXVsdGlwbHkob3JpZW50YXRpb24pOwogICAgICBvdXQubXVsdGlwbHkodGhpcy53b3JsZFRvU2NyZWVuUSk7CiAgICAgIGlmICh0aGlzLnlhd09ubHkpIHsKICAgICAgICBvdXQueCA9IDA7CiAgICAgICAgb3V0LnogPSAwOwogICAgICAgIG91dC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1swXSA9IG91dC54OwogICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1sxXSA9IG91dC55OwogICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1syXSA9IG91dC56OwogICAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1szXSA9IG91dC53OwogICAgICByZXR1cm4gdGhpcy5vcmllbnRhdGlvbk91dF87CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUucmVzZXRQb3NlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLnJlc2V0US5jb3B5KHRoaXMuZmlsdGVyLmdldE9yaWVudGF0aW9uKCkpOwogICAgICB0aGlzLnJlc2V0US54ID0gMDsKICAgICAgdGhpcy5yZXNldFEueSA9IDA7CiAgICAgIHRoaXMucmVzZXRRLnogKj0gLTE7CiAgICAgIHRoaXMucmVzZXRRLm5vcm1hbGl6ZSgpOwogICAgICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkpIHsKICAgICAgICB0aGlzLnJlc2V0US5tdWx0aXBseSh0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSk7CiAgICAgIH0KICAgICAgdGhpcy5yZXNldFEubXVsdGlwbHkodGhpcy5vcmlnaW5hbFBvc2VBZGp1c3RRKTsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbkRldmljZU9yaWVudGF0aW9uXyA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSA9IHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSB8fCBuZXcgUXVhdGVybmlvbigpOwogICAgICB2YXIgYWxwaGEgPSBlLmFscGhhLAogICAgICAgICAgYmV0YSA9IGUuYmV0YSwKICAgICAgICAgIGdhbW1hID0gZS5nYW1tYTsKICAgICAgYWxwaGEgPSAoYWxwaGEgfHwgMCkgKiBNYXRoLlBJIC8gMTgwOwogICAgICBiZXRhID0gKGJldGEgfHwgMCkgKiBNYXRoLlBJIC8gMTgwOwogICAgICBnYW1tYSA9IChnYW1tYSB8fCAwKSAqIE1hdGguUEkgLyAxODA7CiAgICAgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uUS5zZXRGcm9tRXVsZXJZWFooYmV0YSwgYWxwaGEsIC1nYW1tYSk7CiAgICB9OwogICAgRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25EZXZpY2VNb3Rpb25fID0gZnVuY3Rpb24gKGRldmljZU1vdGlvbikgewogICAgICB0aGlzLnVwZGF0ZURldmljZU1vdGlvbl8oZGV2aWNlTW90aW9uKTsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS51cGRhdGVEZXZpY2VNb3Rpb25fID0gZnVuY3Rpb24gKGRldmljZU1vdGlvbikgewogICAgICB2YXIgYWNjR3Jhdml0eSA9IGRldmljZU1vdGlvbi5hY2NlbGVyYXRpb25JbmNsdWRpbmdHcmF2aXR5OwogICAgICB2YXIgcm90UmF0ZSA9IGRldmljZU1vdGlvbi5yb3RhdGlvblJhdGU7CiAgICAgIHZhciB0aW1lc3RhbXBTID0gZGV2aWNlTW90aW9uLnRpbWVTdGFtcCAvIDEwMDA7CiAgICAgIHZhciBkZWx0YVMgPSB0aW1lc3RhbXBTIC0gdGhpcy5wcmV2aW91c1RpbWVzdGFtcFM7CiAgICAgIGlmIChkZWx0YVMgPCAwKSB7CiAgICAgICAgd2Fybk9uY2UoJ2Z1c2lvbi1wb3NlLXNlbnNvcjppbnZhbGlkOm5vbi1tb25vdG9uaWMnLCAnSW52YWxpZCB0aW1lc3RhbXBzIGRldGVjdGVkOiBub24tbW9ub3RvbmljIHRpbWVzdGFtcCBmcm9tIGRldmljZW1vdGlvbicpOwogICAgICAgIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gdGltZXN0YW1wUzsKICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAoZGVsdGFTIDw9IE1JTl9USU1FU1RFUCB8fCBkZWx0YVMgPiBNQVhfVElNRVNURVApIHsKICAgICAgICB3YXJuT25jZSgnZnVzaW9uLXBvc2Utc2Vuc29yOmludmFsaWQ6b3V0c2lkZS10aHJlc2hvbGQnLCAnSW52YWxpZCB0aW1lc3RhbXBzIGRldGVjdGVkOiBUaW1lc3RhbXAgZnJvbSBkZXZpY2Vtb3Rpb24gb3V0c2lkZSBleHBlY3RlZCByYW5nZS4nKTsKICAgICAgICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuYWNjZWxlcm9tZXRlci5zZXQoLWFjY0dyYXZpdHkueCwgLWFjY0dyYXZpdHkueSwgLWFjY0dyYXZpdHkueik7CiAgICAgIGlmIChyb3RSYXRlKSB7CiAgICAgICAgaWYgKGlzUjcoKSkgewogICAgICAgICAgdGhpcy5neXJvc2NvcGUuc2V0KC1yb3RSYXRlLmJldGEsIHJvdFJhdGUuYWxwaGEsIHJvdFJhdGUuZ2FtbWEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmd5cm9zY29wZS5zZXQocm90UmF0ZS5hbHBoYSwgcm90UmF0ZS5iZXRhLCByb3RSYXRlLmdhbW1hKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLmlzRGV2aWNlTW90aW9uSW5SYWRpYW5zKSB7CiAgICAgICAgICB0aGlzLmd5cm9zY29wZS5tdWx0aXBseVNjYWxhcihNYXRoLlBJIC8gMTgwKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5maWx0ZXIuYWRkR3lyb01lYXN1cmVtZW50KHRoaXMuZ3lyb3Njb3BlLCB0aW1lc3RhbXBTKTsKICAgICAgfQogICAgICB0aGlzLmZpbHRlci5hZGRBY2NlbE1lYXN1cmVtZW50KHRoaXMuYWNjZWxlcm9tZXRlciwgdGltZXN0YW1wUyk7CiAgICAgIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gdGltZXN0YW1wUzsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbk9yaWVudGF0aW9uQ2hhbmdlXyA9IGZ1bmN0aW9uIChzY3JlZW5PcmllbnRhdGlvbikgewogICAgICB0aGlzLnNldFNjcmVlblRyYW5zZm9ybV8oKTsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5vbk1lc3NhZ2VfID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIHZhciBtZXNzYWdlID0gZXZlbnQuZGF0YTsKICAgICAgaWYgKCFtZXNzYWdlIHx8ICFtZXNzYWdlLnR5cGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIHR5cGUgPSBtZXNzYWdlLnR5cGUudG9Mb3dlckNhc2UoKTsKICAgICAgaWYgKHR5cGUgIT09ICdkZXZpY2Vtb3Rpb24nKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMudXBkYXRlRGV2aWNlTW90aW9uXyhtZXNzYWdlLmRldmljZU1vdGlvbkV2ZW50KTsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5zZXRTY3JlZW5UcmFuc2Zvcm1fID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLndvcmxkVG9TY3JlZW5RLnNldCgwLCAwLCAwLCAxKTsKICAgICAgc3dpdGNoICh3aW5kb3cub3JpZW50YXRpb24pIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDkwOgogICAgICAgICAgdGhpcy53b3JsZFRvU2NyZWVuUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIDEpLCAtTWF0aC5QSSAvIDIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAtOTA6CiAgICAgICAgICB0aGlzLndvcmxkVG9TY3JlZW5RLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMCwgMCwgMSksIE1hdGguUEkgLyAyKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RLmNvcHkodGhpcy53b3JsZFRvU2NyZWVuUSk7CiAgICAgIHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RLmludmVyc2UoKTsKICAgIH07CiAgICBGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyA9IHRoaXMub25EZXZpY2VNb3Rpb25fLmJpbmQodGhpcyk7CiAgICAgIHRoaXMub25PcmllbnRhdGlvbkNoYW5nZUNhbGxiYWNrXyA9IHRoaXMub25PcmllbnRhdGlvbkNoYW5nZV8uYmluZCh0aGlzKTsKICAgICAgdGhpcy5vbk1lc3NhZ2VDYWxsYmFja18gPSB0aGlzLm9uTWVzc2FnZV8uYmluZCh0aGlzKTsKICAgICAgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfID0gdGhpcy5vbkRldmljZU9yaWVudGF0aW9uXy5iaW5kKHRoaXMpOwogICAgICBpZiAoaXNJT1MoKSAmJiBpc0luc2lkZUNyb3NzT3JpZ2luSUZyYW1lKCkpIHsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMub25NZXNzYWdlQ2FsbGJhY2tfKTsKICAgICAgfQogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VDYWxsYmFja18pOwogICAgICBpZiAodGhpcy5pc1dpdGhvdXREZXZpY2VNb3Rpb24pIHsKICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZGV2aWNlb3JpZW50YXRpb24nLCB0aGlzLm9uRGV2aWNlT3JpZW50YXRpb25DYWxsYmFja18pOwogICAgICB9IGVsc2UgewogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdkZXZpY2Vtb3Rpb24nLCB0aGlzLm9uRGV2aWNlTW90aW9uQ2FsbGJhY2tfKTsKICAgICAgfQogICAgfTsKICAgIEZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdkZXZpY2Vtb3Rpb24nLCB0aGlzLm9uRGV2aWNlTW90aW9uQ2FsbGJhY2tfKTsKICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfKTsKICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vbk9yaWVudGF0aW9uQ2hhbmdlQ2FsbGJhY2tfKTsKICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLm9uTWVzc2FnZUNhbGxiYWNrXyk7CiAgICB9OwogICAgdmFyIFNFTlNPUl9GUkVRVUVOQ1kgPSA2MDsKICAgIHZhciBYX0FYSVMgPSBuZXcgVmVjdG9yMygxLCAwLCAwKTsKICAgIHZhciBaX0FYSVMgPSBuZXcgVmVjdG9yMygwLCAwLCAxKTsKICAgIHZhciBTRU5TT1JfVE9fVlIgPSBuZXcgUXVhdGVybmlvbigpOwogICAgU0VOU09SX1RPX1ZSLnNldEZyb21BeGlzQW5nbGUoWF9BWElTLCAtTWF0aC5QSSAvIDIpOwogICAgU0VOU09SX1RPX1ZSLm11bHRpcGx5KG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShaX0FYSVMsIE1hdGguUEkgLyAyKSk7CiAgICB2YXIgUG9zZVNlbnNvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gUG9zZVNlbnNvcihjb25maWcpIHsKICAgICAgICBjbGFzc0NhbGxDaGVjayh0aGlzLCBQb3NlU2Vuc29yKTsKICAgICAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZzsKICAgICAgICB0aGlzLnNlbnNvciA9IG51bGw7CiAgICAgICAgdGhpcy5mdXNpb25TZW5zb3IgPSBudWxsOwogICAgICAgIHRoaXMuX291dCA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CiAgICAgICAgdGhpcy5hcGkgPSBudWxsOwogICAgICAgIHRoaXMuZXJyb3JzID0gW107CiAgICAgICAgdGhpcy5fc2Vuc29yUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgICAgdGhpcy5fb3V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgICAgdGhpcy5fb25TZW5zb3JSZWFkID0gdGhpcy5fb25TZW5zb3JSZWFkLmJpbmQodGhpcyk7CiAgICAgICAgdGhpcy5fb25TZW5zb3JFcnJvciA9IHRoaXMuX29uU2Vuc29yRXJyb3IuYmluZCh0aGlzKTsKICAgICAgICB0aGlzLmluaXQoKTsKICAgICAgfQogICAgICBjcmVhdGVDbGFzcyhQb3NlU2Vuc29yLCBbewogICAgICAgIGtleTogJ2luaXQnLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgdmFyIHNlbnNvciA9IG51bGw7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBzZW5zb3IgPSBuZXcgUmVsYXRpdmVPcmllbnRhdGlvblNlbnNvcih7CiAgICAgICAgICAgICAgZnJlcXVlbmN5OiBTRU5TT1JfRlJFUVVFTkNZLAogICAgICAgICAgICAgIHJlZmVyZW5jZUZyYW1lOiAnc2NyZWVuJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2Vuc29yLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgdGhpcy5fb25TZW5zb3JFcnJvcik7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGVycm9yKTsKICAgICAgICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdTZWN1cml0eUVycm9yJykgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Nhbm5vdCBjb25zdHJ1Y3Qgc2Vuc29ycyBkdWUgdG8gdGhlIEZlYXR1cmUgUG9saWN5Jyk7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdBdHRlbXB0aW5nIHRvIGZhbGwgYmFjayB1c2luZyAiZGV2aWNlbW90aW9uIjsgaG93ZXZlciB0aGlzIHdpbGwgJyArICdmYWlsIGluIHRoZSBmdXR1cmUgd2l0aG91dCBjb3JyZWN0IHBlcm1pc3Npb25zLicpOwogICAgICAgICAgICAgIHRoaXMudXNlRGV2aWNlTW90aW9uKCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IubmFtZSA9PT0gJ1JlZmVyZW5jZUVycm9yJykgewogICAgICAgICAgICAgIHRoaXMudXNlRGV2aWNlTW90aW9uKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzZW5zb3IpIHsKICAgICAgICAgICAgdGhpcy5hcGkgPSAnc2Vuc29yJzsKICAgICAgICAgICAgdGhpcy5zZW5zb3IgPSBzZW5zb3I7CiAgICAgICAgICAgIHRoaXMuc2Vuc29yLmFkZEV2ZW50TGlzdGVuZXIoJ3JlYWRpbmcnLCB0aGlzLl9vblNlbnNvclJlYWQpOwogICAgICAgICAgICB0aGlzLnNlbnNvci5zdGFydCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogJ3VzZURldmljZU1vdGlvbicsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIHVzZURldmljZU1vdGlvbigpIHsKICAgICAgICAgIHRoaXMuYXBpID0gJ2RldmljZW1vdGlvbic7CiAgICAgICAgICB0aGlzLmZ1c2lvblNlbnNvciA9IG5ldyBGdXNpb25Qb3NlU2Vuc29yKHRoaXMuY29uZmlnLktfRklMVEVSLCB0aGlzLmNvbmZpZy5QUkVESUNUSU9OX1RJTUVfUywgdGhpcy5jb25maWcuWUFXX09OTFksIHRoaXMuY29uZmlnLkRFQlVHKTsKICAgICAgICAgIGlmICh0aGlzLnNlbnNvcikgewogICAgICAgICAgICB0aGlzLnNlbnNvci5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkaW5nJywgdGhpcy5fb25TZW5zb3JSZWFkKTsKICAgICAgICAgICAgdGhpcy5zZW5zb3IucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLl9vblNlbnNvckVycm9yKTsKICAgICAgICAgICAgdGhpcy5zZW5zb3IgPSBudWxsOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogJ2dldE9yaWVudGF0aW9uJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0T3JpZW50YXRpb24oKSB7CiAgICAgICAgICBpZiAodGhpcy5mdXNpb25TZW5zb3IpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZnVzaW9uU2Vuc29yLmdldE9yaWVudGF0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMuc2Vuc29yIHx8ICF0aGlzLnNlbnNvci5xdWF0ZXJuaW9uKSB7CiAgICAgICAgICAgIHRoaXMuX291dFswXSA9IHRoaXMuX291dFsxXSA9IHRoaXMuX291dFsyXSA9IDA7CiAgICAgICAgICAgIHRoaXMuX291dFszXSA9IDE7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9vdXQ7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcSA9IHRoaXMuc2Vuc29yLnF1YXRlcm5pb247CiAgICAgICAgICB0aGlzLl9zZW5zb3JRLnNldChxWzBdLCBxWzFdLCBxWzJdLCBxWzNdKTsKICAgICAgICAgIHZhciBvdXQgPSB0aGlzLl9vdXRROwogICAgICAgICAgb3V0LmNvcHkoU0VOU09SX1RPX1ZSKTsKICAgICAgICAgIG91dC5tdWx0aXBseSh0aGlzLl9zZW5zb3JRKTsKICAgICAgICAgIGlmICh0aGlzLmNvbmZpZy5ZQVdfT05MWSkgewogICAgICAgICAgICBvdXQueCA9IG91dC56ID0gMDsKICAgICAgICAgICAgb3V0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fb3V0WzBdID0gb3V0Lng7CiAgICAgICAgICB0aGlzLl9vdXRbMV0gPSBvdXQueTsKICAgICAgICAgIHRoaXMuX291dFsyXSA9IG91dC56OwogICAgICAgICAgdGhpcy5fb3V0WzNdID0gb3V0Lnc7CiAgICAgICAgICByZXR1cm4gdGhpcy5fb3V0OwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGtleTogJ19vblNlbnNvckVycm9yJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uU2Vuc29yRXJyb3IoZXZlbnQpIHsKICAgICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZXZlbnQuZXJyb3IpOwogICAgICAgICAgaWYgKGV2ZW50LmVycm9yLm5hbWUgPT09ICdOb3RBbGxvd2VkRXJyb3InKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Blcm1pc3Npb24gdG8gYWNjZXNzIHNlbnNvciB3YXMgZGVuaWVkJyk7CiAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmVycm9yLm5hbWUgPT09ICdOb3RSZWFkYWJsZUVycm9yJykgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdTZW5zb3IgY291bGQgbm90IGJlIHJlYWQnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXZlbnQuZXJyb3IpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy51c2VEZXZpY2VNb3Rpb24oKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICBrZXk6ICdfb25TZW5zb3JSZWFkJywKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uU2Vuc29yUmVhZCgpIHt9CiAgICAgIH1dKTsKICAgICAgcmV0dXJuIFBvc2VTZW5zb3I7CiAgICB9KCk7CiAgICB2YXIgcm90YXRlSW5zdHJ1Y3Rpb25zQXNzZXQgPSAiPHN2ZyB3aWR0aD0nMTk4JyBoZWlnaHQ9JzI0MCcgdmlld0JveD0nMCAwIDE5OCAyNDAnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PGcgZmlsbD0nbm9uZScgZmlsbC1ydWxlPSdldmVub2RkJz48cGF0aCBkPSdNMTQ5LjYyNSAxMDkuNTI3bDYuNzM3IDMuODkxdi44ODZjMCAuMTc3LjAxMy4zNi4wMzguNTQ5LjAxLjA4MS4wMi4xNjIuMDI3LjI0Mi4xNCAxLjQxNS45NzQgMi45OTggMi4xMDUgMy45OTlsNS43MiA1LjA2Mi4wODEtLjA5czQuMzgyLTIuNTMgNS4yMzUtMy4wMjRsMjUuOTcgMTQuOTkzdjU0LjAwMWMwIC43NzEtLjM4NiAxLjIxNy0uOTQ4IDEuMjE3LS4yMzMgMC0uNDk1LS4wNzYtLjc3Mi0uMjM2bC0yMy45NjctMTMuODM4LS4wMTQuMDI0LTI3LjMyMiAxNS43NzUtLjg1LTEuMzIzYy00LjczMS0xLjUyOS05Ljc0OC0yLjc0LTE0Ljk1MS0zLjYxYS4yNy4yNyAwIDAgMC0uMDA3LjAyNGwtNS4wNjcgMTYuOTYxLTcuODkxIDQuNTU2LS4wMzctLjA2M3YyNy41OWMwIC43NzItLjM4NiAxLjIxNy0uOTQ4IDEuMjE3LS4yMzIgMC0uNDk1LS4wNzYtLjc3Mi0uMjM2bC00Mi40NzMtMjQuNTIyYy0uOTUtLjU0OS0xLjcyLTEuODc3LTEuNzItMi45Njd2LTEuMDM1bC0uMDIxLjA0N2E1LjExMSA1LjExMSAwIDAgMC0xLjgxNi0uMzk5IDUuNjgyIDUuNjgyIDAgMCAwLS41NDYuMDAxIDEzLjcyNCAxMy43MjQgMCAwIDEtMS45MTgtLjA0MWMtMS42NTUtLjE1My0zLjItLjYtNC40MDQtMS4yOTZsLTQ2LjU3Ni0yNi44OS4wMDUuMDEyLTEwLjI3OC0xOC43NWMtMS4wMDEtMS44MjctLjI0MS00LjIxNiAxLjY5OC01LjMzNmw1Ni4wMTEtMzIuMzQ1YTQuMTk0IDQuMTk0IDAgMCAxIDIuMDk5LS41NzJjMS4zMjYgMCAyLjU3Mi42NTkgMy4yMjcgMS44NTNsLjAwNS0uMDAzLjIyNy40MTMtLjAwNi4wMDRhOS42MyA5LjYzIDAgMCAwIDEuNDc3IDIuMDE4bC4yNzcuMjdjMS45MTQgMS44NSA0LjQ2OCAyLjgwMSA3LjExMyAyLjgwMSAxLjk0OSAwIDMuOTQ4LS41MTcgNS43NzUtMS41NzIuMDEzIDAgNy4zMTktNC4yMTkgNy4zMTktNC4yMTlhNC4xOTQgNC4xOTQgMCAwIDEgMi4wOTktLjU3MmMxLjMyNiAwIDIuNTcyLjY1OCAzLjIyNiAxLjg1M2wzLjI1IDUuOTI4LjAyMi0uMDE4IDYuNzg1IDMuOTE3LS4xMDUtLjE4MiA0Ni44ODEtMjYuOTY1bTAtMS42MzVjLS4yODIgMC0uNTYzLjA3My0uODE1LjIxOGwtNDYuMTY5IDI2LjU1Ni01LjQxLTMuMTI0LTMuMDA1LTUuNDgxYy0uOTEzLTEuNjY3LTIuNjk5LTIuNzAyLTQuNjYtMi43MDMtMS4wMTEgMC0yLjAyLjI3NC0yLjkxNy43OTJhMzgyNSAzODI1IDAgMCAxLTcuMjc1IDQuMTk1bC0uMDQ0LjAyNGE5LjkzNyA5LjkzNyAwIDAgMS00Ljk1NyAxLjM1M2MtMi4yOTIgMC00LjQxNC0uODMyLTUuOTc2LTIuMzQybC0uMjUyLS4yNDVhNy45OTIgNy45OTIgMCAwIDEtMS4xMzktMS41MzQgMS4zNzkgMS4zNzkgMCAwIDAtLjA2LS4xMjJsLS4yMjctLjQxNGExLjcxOCAxLjcxOCAwIDAgMC0uMDk1LS4xNTRjLS45MzgtMS41NzQtMi42NzMtMi41NDUtNC41NzEtMi41NDUtMS4wMTEgMC0yLjAyLjI3NC0yLjkxNy43OTJMMy4xMjUgMTU1LjUwMmMtMi42OTkgMS41NTktMy43MzggNC45NC0yLjMxNCA3LjUzOGwxMC4yNzggMTguNzVjLjE3Ny4zMjMuNDQ4LjU2My43NjEuNzA0bDQ2LjQyNiAyNi44MDRjMS40MDMuODEgMy4xNTcgMS4zMzIgNS4wNzIgMS41MDhhMTUuNjYxIDE1LjY2MSAwIDAgMCAyLjE0Ni4wNDYgNC43NjYgNC43NjYgMCAwIDEgLjM5NiAwYy4wOTYuMDA0LjE5LjAxMS4yODMuMDIyLjEwOSAxLjU5MyAxLjE1OSAzLjMyMyAyLjUyOSA0LjExNGw0Mi40NzIgMjQuNTIyYy41MjQuMzAyIDEuMDU4LjQ1NSAxLjU5LjQ1NSAxLjQ5NyAwIDIuNTgzLTEuMiAyLjU4My0yLjg1MnYtMjYuNTYybDcuMTExLTQuMTA1YTEuNjQgMS42NCAwIDAgMCAuNzQ5LS45NDhsNC42NTgtMTUuNTkzYzQuNDE0Ljc5NyA4LjY5MiAxLjg0OCAxMi43NDIgMy4xMjhsLjUzMy44MjlhMS42MzQgMS42MzQgMCAwIDAgMi4xOTMuNTMxbDI2LjUzMi0xNS4zMTdMMTkzIDE5Mi40MzNjLjUyMy4zMDIgMS4wNTguNDU1IDEuNTkuNDU1IDEuNDk3IDAgMi41ODMtMS4xOTkgMi41ODMtMi44NTJ2LTU0LjAwMWMwLS41ODQtLjMxMi0xLjEyNC0uODE4LTEuNDE2bC0yNS45Ny0xNC45OTNhMS42MzMgMS42MzMgMCAwIDAtMS42MzYuMDAxYy0uNjA2LjM1MS0yLjk5MyAxLjczLTQuMzI1IDIuNDk4bC00LjgwOS00LjI1NWMtLjgxOS0uNzI1LTEuNDYxLTEuOTMzLTEuNTYxLTIuOTM2YTcuNzc2IDcuNzc2IDAgMCAwLS4wMzMtLjI5NCAyLjQ4NyAyLjQ4NyAwIDAgMS0uMDIzLS4zMzZ2LS44ODZjMC0uNTg0LS4zMTItMS4xMjMtLjgxNy0xLjQxNmwtNi43MzktMy44OTFhMS42MzMgMS42MzMgMCAwIDAtLjgxNy0uMjE5JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTk2LjAyNyAxMzIuNjM2bDQ2LjU3NiAyNi44OTFjMS4yMDQuNjk1IDEuOTc5IDEuNTg3IDIuMjQyIDIuNTQxbC0uMDEuMDA3LTgxLjM3NCA0Ni45ODJoLS4wMDFjLTEuNjU0LS4xNTItMy4xOTktLjYtNC40MDMtMS4yOTVsLTQ2LjU3Ni0yNi44OTEgODMuNTQ2LTQ4LjIzNScgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J002My40NjEgMjA5LjE3NGMtLjAwOCAwLS4wMTUgMC0uMDIyLS4wMDItMS42OTMtLjE1Ni0zLjIyOC0uNjA5LTQuNDQxLTEuMzA5bC00Ni41NzYtMjYuODlhLjExOC4xMTggMCAwIDEgMC0uMjAzbDgzLjU0Ni00OC4yMzVhLjExNy4xMTcgMCAwIDEgLjExNyAwbDQ2LjU3NiAyNi44OTFjMS4yMjcuNzA4IDIuMDIxIDEuNjEyIDIuMjk2IDIuNjExYS4xMTYuMTE2IDAgMCAxLS4wNDIuMTI0bC0uMDIxLjAxNi04MS4zNzUgNDYuOTgxYS4xMS4xMSAwIDAgMS0uMDU4LjAxNnptLTUwLjc0Ny0yOC4zMDNsNDYuNDAxIDI2Ljc5YzEuMTc4LjY4IDIuNjcxIDEuMTIxIDQuMzIgMS4yNzZsODEuMjcyLTQ2LjkyMmMtLjI3OS0uOTA3LTEuMDI1LTEuNzMtMi4xNjMtMi4zODdsLTQ2LjUxNy0yNi44NTctODMuMzEzIDQ4LjF6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OC4zMjcgMTY1LjQ3MWE1Ljg1IDUuODUgMCAwIDEtLjU0Ni4wMDFjLTEuODk0LS4wODMtMy4zMDItMS4wMzgtMy4xNDUtMi4xMzJhMi42OTMgMi42OTMgMCAwIDAtLjA3Mi0xLjEwNWwtODEuMTAzIDQ2LjgyMmMuNjI4LjA1OCAxLjI3Mi4wNzMgMS45MTguMDQyLjE4Mi0uMDA5LjM2NC0uMDA5LjU0Ni0uMDAxIDEuODk0LjA4MyAzLjMwMiAxLjAzOCAzLjE0NSAyLjEzMmw3OS4yNTctNDUuNzU5JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTY5LjA3IDIxMS4zNDdhLjExOC4xMTggMCAwIDEtLjExNS0uMTM0Yy4wNDUtLjMxNy0uMDU3LS42MzctLjI5Ny0uOTI1LS41MDUtLjYxLTEuNTU1LTEuMDIyLTIuNzM4LTEuMDc0YTUuOTY2IDUuOTY2IDAgMCAwLS41MzUuMDAxIDE0LjAzIDE0LjAzIDAgMCAxLTEuOTM1LS4wNDEuMTE3LjExNyAwIDAgMS0uMTAzLS4wOTIuMTE2LjExNiAwIDAgMSAuMDU1LS4xMjZsODEuMTA0LTQ2LjgyMmEuMTE3LjExNyAwIDAgMSAuMTcxLjA3Yy4xMDQuMzgxLjEyOS43NjguMDc0IDEuMTUzLS4wNDUuMzE2LjA1Ny42MzcuMjk2LjkyNS41MDYuNjEgMS41NTUgMS4wMjEgMi43MzkgMS4wNzMuMTc4LjAwOC4zNTcuMDA4LjUzNS0uMDAxYS4xMTcuMTE3IDAgMCAxIC4wNjQuMjE4bC03OS4yNTYgNDUuNzU5YS4xMTQuMTE0IDAgMCAxLS4wNTkuMDE2em0tMy40MDUtMi4zNzJjLjA4OSAwIC4xNzcuMDAyLjI2NS4wMDYgMS4yNjYuMDU2IDIuMzUzLjQ4OCAyLjkwOCAxLjE1OC4yMjcuMjc0LjM1LjU3NS4zNi44ODJsNzguNjg1LTQ1LjQyOWMtLjAzNiAwLS4wNzItLjAwMS0uMTA3LS4wMDMtMS4yNjctLjA1Ni0yLjM1NC0uNDg5LTIuOTA5LTEuMTU4LS4yODItLjM0LS40MDItLjcyNC0uMzQ3LTEuMTA3YTIuNjA0IDIuNjA0IDAgMCAwLS4wMzItLjkxTDYzLjg0NiAyMDguOTdhMTMuOTEgMTMuOTEgMCAwIDAgMS41MjguMDEyYy4wOTctLjAwNS4xOTQtLjAwNy4yOTEtLjAwN3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMi4yMDggMTYyLjEzNGMtMS4wMDEtMS44MjctLjI0MS00LjIxNyAxLjY5OC01LjMzN2w1Ni4wMTEtMzIuMzQ0YzEuOTM5LTEuMTIgNC4zMjQtLjU0NiA1LjMyNiAxLjI4MWwuMjMyLjQxYTkuMzQ0IDkuMzQ0IDAgMCAwIDEuNDcgMi4wMjFsLjI3OC4yN2MzLjMyNSAzLjIxNCA4LjU4MyAzLjcxNiAxMi44ODggMS4yM2w3LjMxOS00LjIyYzEuOTQtMS4xMTkgNC4zMjQtLjU0NiA1LjMyNSAxLjI4MmwzLjI1IDUuOTI4LTgzLjUxOSA0OC4yMjktMTAuMjc4LTE4Ljc1eicgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xMi40ODYgMTgxLjAwMWEuMTEyLjExMiAwIDAgMS0uMDMxLS4wMDUuMTE0LjExNCAwIDAgMS0uMDcxLS4wNTZMMi4xMDYgMTYyLjE5Yy0xLjAzMS0xLjg4LS4yNDktNC4zNDUgMS43NDItNS40OTRsNTYuMDEtMzIuMzQ0YTQuMzI4IDQuMzI4IDAgMCAxIDIuMTU4LS41ODhjMS40MTUgMCAyLjY1LjcwMiAzLjMxMSAxLjg4Mi4wMS4wMDguMDE4LjAxNy4wMjQuMDI4bC4yMjcuNDE0YS4xMjIuMTIyIDAgMCAxIC4wMTMuMDM4IDkuNTA4IDkuNTA4IDAgMCAwIDEuNDM5IDEuOTU5bC4yNzUuMjY2YzEuODQ2IDEuNzg2IDQuMzQ0IDIuNzY5IDcuMDMxIDIuNzY5IDEuOTc3IDAgMy45NTQtLjUzOCA1LjcxNy0xLjU1N2EuMTQ4LjE0OCAwIDAgMSAuMDM1LS4wMTNsNy4yODQtNC4yMDZhNC4zMjEgNC4zMjEgMCAwIDEgMi4xNTctLjU4OGMxLjQyNyAwIDIuNjcyLjcxNiAzLjMyOSAxLjkxNGwzLjI0OSA1LjkyOWEuMTE2LjExNiAwIDAgMS0uMDQ0LjE1N2wtODMuNTE4IDQ4LjIyOWEuMTE2LjExNiAwIDAgMS0uMDU5LjAxNnptNDkuNTMtNTcuMDA0Yy0uNzA0IDAtMS40MS4xOTMtMi4wNDEuNTU3bC01Ni4wMSAzMi4zNDVjLTEuODgyIDEuMDg2LTIuNjI0IDMuNDA5LTEuNjU1IDUuMTc5bDEwLjIyMSAxOC42NDUgODMuMzE3LTQ4LjExMi0zLjE5NS01LjgyOWMtLjYxNS0xLjEyMi0xLjc4My0xLjc5Mi0zLjEyNC0xLjc5MmE0LjA4IDQuMDggMCAwIDAtMi4wNC41NTdsLTcuMzE3IDQuMjI1YS4xNDguMTQ4IDAgMCAxLS4wMzUuMDEzIDExLjcgMTEuNyAwIDAgMS01LjgwMSAxLjU2OWMtMi43NDggMC01LjMwMy0xLjAwNy03LjE5NC0yLjgzNWwtLjI3OC0uMjdhOS43MTYgOS43MTYgMCAwIDEtMS40OTctMi4wNDYuMDk2LjA5NiAwIDAgMS0uMDEzLS4wMzdsLS4xOTEtLjM0N2EuMTEuMTEgMCAwIDEtLjAyMy0uMDI5Yy0uNjE1LTEuMTIzLTEuNzgzLTEuNzkzLTMuMTI0LTEuNzkzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J000Mi40MzQgMTU1LjgwOGMtMi41MS0uMDAxLTQuNjk3LTEuMjU4LTUuODUyLTMuMzY1LTEuODExLTMuMzA0LS40MzgtNy42MzQgMy4wNTktOS42NTRsMTIuMjkxLTcuMDk4YTcuNTk5IDcuNTk5IDAgMCAxIDMuNzg5LTEuMDMzYzIuNTEgMCA0LjY5NyAxLjI1OCA1Ljg1MiAzLjM2NSAxLjgxMSAzLjMwNC40MzkgNy42MzQtMy4wNTkgOS42NTRsLTEyLjI5MSA3LjA5OGE3LjYwNiA3LjYwNiAwIDAgMS0zLjc4OSAxLjAzM3ptMTMuMjg3LTIwLjY4M2E3LjEyOCA3LjEyOCAwIDAgMC0zLjU1NS45NzFsLTEyLjI5MSA3LjA5OGMtMy4yNzkgMS44OTMtNC41NzMgNS45NDItMi44ODMgOS4wMjQgMS4wNzEgMS45NTUgMy4xMDYgMy4xMjIgNS40NDIgMy4xMjJhNy4xMyA3LjEzIDAgMCAwIDMuNTU2LS45N2wxMi4yOTEtNy4wOThjMy4yNzktMS44OTMgNC41NzItNS45NDIgMi44ODMtOS4wMjQtMS4wNzItMS45NTUtMy4xMDYtMy4xMjMtNS40NDMtMy4xMjN6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OS41ODggMTA5LjQwN2w2LjczNyAzLjg5di44ODdjMCAuMTc2LjAxMy4zNi4wMzcuNTQ5LjAxMS4wODEuMDIuMTYxLjAyOC4yNDIuMTQgMS40MTUuOTczIDIuOTk4IDIuMTA1IDMuOTk5bDcuMzk2IDYuNTQ1Yy4xNzcuMTU2LjM1OC4yOTUuNTQxLjQxNSAxLjU3OSAxLjA0IDIuOTUuNDY2IDMuMDYyLTEuMjgyLjA0OS0uNzg0LjA1Ny0xLjU5NS4wMjMtMi40MjlsLS4wMDMtLjE2di0xLjE1MWwyNS45ODcgMTUuMDAzdjU0YzAgMS4wOS0uNzcgMS41My0xLjcyLjk4MmwtNDIuNDczLTI0LjUyM2MtLjk1LS41NDgtMS43Mi0xLjg3Ny0xLjcyLTIuOTY2di0zNC4wMzMnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTk0LjU1MyAxOTEuMjVjLS4yNTcgMC0uNTQtLjA4NS0uODMxLS4yNTNsLTQyLjQ3Mi0yNC41MjFjLS45ODEtLjU2Ny0xLjc3OS0xLjk0My0xLjc3OS0zLjA2OHYtMzQuMDMzaC4yMzR2MzQuMDMzYzAgMS4wNTEuNzQ1IDIuMzM2IDEuNjYxIDIuODY2bDQyLjQ3MyAyNC41MjFjLjQyNC4yNDUuODE2LjI4OCAxLjEwMy4xMjIuMjg1LS4xNjQuNDQyLS41Mi40NDItMS4wMDJ2LTUzLjkzM2wtMjUuNzUzLTE0Ljg2OC4wMDMgMS4xMDZjLjAzNC44MzIuMDI2IDEuNjU0LS4wMjQgMi40MzktLjA1NC44NDQtLjM5NiAxLjQ2NC0uOTYzIDEuNzQ2LS42MTkuMzA5LTEuNDUuMTczLTIuMjgtLjM3M2E1LjAyMyA1LjAyMyAwIDAgMS0uNTUzLS40MjZsLTcuMzk3LTYuNTQ0Yy0xLjE1OC0xLjAyNi0xLjk5OS0yLjYyNS0yLjE0My00LjA3NmE5LjYyNCA5LjYyNCAwIDAgMC0uMDI3LS4yMzggNC4yNDEgNC4yNDEgMCAwIDEtLjAzOC0uNTY0di0uODJsLTYuNjgtMy44NTYuMTE3LS4yMDIgNi43MzggMy44OS4wNTguMDM0di45NTRjMCAuMTcxLjAxMi4zNTEuMDM2LjUzMy4wMTEuMDgzLjAyMS4xNjUuMDI5LjI0Ni4xMzggMS4zOTUuOTQ4IDIuOTM1IDIuMDY1IDMuOTIzbDcuMzk3IDYuNTQ1Yy4xNzMuMTUzLjM1LjI4OS41MjcuNDA2Ljc1OC40OTkgMS41MDQuNjMgMi4wNDcuMzU5LjQ5LS4yNDMuNzg2LS43OTUuODM0LTEuNTUxLjA1LS43NzguMDU3LTEuNTkxLjAyNC0yLjQxN2wtLjAwNC0uMTYzdi0xLjM1NWwuMTc1LjEgMjUuOTg3IDE1LjAwNC4wNTkuMDMzdjU0LjA2OGMwIC41NjktLjE5OC45OTYtLjU1OSAxLjIwNGExLjAwMiAxLjAwMiAwIDAgMS0uNTA2LjEzMScgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDUuNjg1IDE2My4xNjFsMjQuMTE1IDEzLjkyMi0yNS45NzggMTQuOTk4LTEuNDYyLS4zMDdjLTYuNTM0LTIuMTctMTMuNjI4LTMuNzI4LTIxLjAxOS00LjYxNi00LjM2NS0uNTI0LTguNjYzIDEuMDk2LTkuNTk4IDMuNjJhMi43NDYgMi43NDYgMCAwIDAtLjAxMSAxLjkyOGMxLjUzOCA0LjI2NyA0LjIzNiA4LjM2MyA3Ljk5NSAxMi4xMzVsLjUzMi44NDUtMjUuOTc3IDE0Ljk5Ny0yNC4xMTUtMTMuOTIyIDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTk0LjI4MiAyMjAuODE4bC0uMDU5LS4wMzMtMjQuMjktMTQuMDI0LjE3NS0uMTAxIDc1LjU3Ny00My42MzQuMDU4LjAzMyAyNC4yOSAxNC4wMjQtMjYuMTkxIDE1LjEyMi0uMDQ1LS4wMS0xLjQ2MS0uMzA3Yy02LjU0OS0yLjE3NC0xMy42MTMtMy43MjUtMjEuMDA5LTQuNjE0YTEzLjc0NCAxMy43NDQgMCAwIDAtMS42MzgtLjA5N2MtMy43NTggMC03LjA1NCAxLjUzMS03LjgzNyAzLjY0MmEyLjYyIDIuNjIgMCAwIDAtLjAxIDEuODQ4YzEuNTM1IDQuMjU4IDQuMjE2IDguMzI2IDcuOTY4IDEyLjA5MWwuMDE2LjAyMS41MjYuODM1LjAwNi4wMS4wNjQuMTAyLS4xMDUuMDYxLTI1Ljk3NyAxNC45OTgtLjA1OC4wMzN6bS0yMy44ODEtMTQuMDU3bDIzLjg4MSAxMy43ODggMjQuODAyLTE0LjMyYy41NDYtLjMxNS44NDYtLjQ4OSAxLjAxNy0uNTc1bC0uNDY2LS43NGMtMy43NzEtMy43ODctNi40NjctNy44ODEtOC4wMTMtMTIuMTY4YTIuODUxIDIuODUxIDAgMCAxIC4wMTEtMi4wMDhjLjgxNS0yLjE5OSA0LjIwMy0zLjc5NSA4LjA1Ni0zLjc5NS41NTcgMCAxLjExNy4wMzMgMS42NjYuMDk5IDcuNDEyLjg5MSAxNC40OTEgMi40NDUgMjEuMDQxIDQuNjIxLjgzNi4xNzUgMS4yMTUuMjU0IDEuMzkuMzA0bDI1Ljc4LTE0Ljg4NC0yMy44ODEtMTMuNzg4LTc1LjI4NCA0My40NjZ6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE2Ny4yMyAxMjUuOTc5djUwLjg3MWwtMjcuMzIxIDE1Ljc3My02LjQ2MS0xNC4xNjdjLS45MS0xLjk5Ni0zLjQyOC0xLjczOC01LjYyNC41NzRhMTAuMjM4IDEwLjIzOCAwIDAgMC0yLjMzIDQuMDE4bC02LjQ2IDIxLjYyOC0yNy4zMjIgMTUuNzc0di01MC44NzFsNzUuNTE4LTQzLjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNOTEuNzEyIDIyMC41NjdhLjEyNy4xMjcgMCAwIDEtLjA1OS0uMDE2LjExOC4xMTggMCAwIDEtLjA1OC0uMTAxdi01MC44NzFjMC0uMDQyLjAyMy0uMDguMDU4LS4xMDFsNzUuNTE5LTQzLjZhLjExNy4xMTcgMCAwIDEgLjE3NS4xMDF2NTAuODcxYzAgLjA0MS0uMDIzLjA4LS4wNTkuMWwtMjcuMzIxIDE1Ljc3NWEuMTE4LjExOCAwIDAgMS0uMDk0LjAxLjEyLjEyIDAgMCAxLS4wNzEtLjA2M2wtNi40Ni0xNC4xNjhjLS4zNzUtLjgyMi0xLjA2Mi0xLjI3NS0xLjkzNC0xLjI3NS0xLjA4OSAwLTIuMzY0LjY4Ni0zLjUgMS44ODFhMTAuMjA2IDEwLjIwNiAwIDAgMC0yLjMwMiAzLjk3MmwtNi40NiAyMS42MjdhLjExOC4xMTggMCAwIDEtLjA1NC4wNjhMOTEuNzcgMjIwLjU1MWEuMTIuMTIgMCAwIDEtLjA1OC4wMTZ6bS4xMTctNTAuOTJ2NTAuNjAxbDI3LjEwNi0xNS42NSA2LjQ0Ny0yMS41ODNhMTAuMjg2IDEwLjI4NiAwIDAgMSAyLjM1Ny00LjA2NWMxLjE4LTEuMjQyIDIuNTE3LTEuOTU0IDMuNjY5LTEuOTU0Ljk2OSAwIDEuNzMxLjUwMSAyLjE0NiAxLjQxMWw2LjQwNyAxNC4wNTEgMjcuMTUyLTE1LjY3NnYtNTAuNjAxbC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjguNTQzIDEyNi4yMTN2NTAuODdsLTI3LjMyMiAxNS43NzQtNi40Ni0xNC4xNjhjLS45MS0xLjk5NS0zLjQyOC0xLjczOC01LjYyNC41NzRhMTAuMjQ4IDEwLjI0OCAwIDAgMC0yLjMzIDQuMDE5bC02LjQ2MSAyMS42MjctMjcuMzIxIDE1Ljc3NHYtNTAuODdsNzUuNTE4LTQzLjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNOTMuMDI1IDIyMC44YS4xMjMuMTIzIDAgMCAxLS4wNTktLjAxNS4xMi4xMiAwIDAgMS0uMDU4LS4xMDF2LTUwLjg3MWMwLS4wNDIuMDIzLS4wOC4wNTgtLjEwMWw3NS41MTgtNDMuNmEuMTEyLjExMiAwIDAgMSAuMTE3IDBjLjAzNi4wMi4wNTkuMDU5LjA1OS4xdjUwLjg3MWEuMTE2LjExNiAwIDAgMS0uMDU5LjEwMWwtMjcuMzIxIDE1Ljc3NGEuMTExLjExMSAwIDAgMS0uMDk0LjAxLjExNS4xMTUgMCAwIDEtLjA3MS0uMDYybC02LjQ2LTE0LjE2OGMtLjM3NS0uODIzLTEuMDYyLTEuMjc1LTEuOTM1LTEuMjc1LTEuMDg4IDAtMi4zNjMuNjg1LTMuNDk5IDEuODgxYTEwLjE5IDEwLjE5IDAgMCAwLTIuMzAyIDMuOTcxbC02LjQ2MSAyMS42MjhhLjEwOC4xMDggMCAwIDEtLjA1My4wNjdsLTI3LjMyMiAxNS43NzVhLjEyLjEyIDAgMCAxLS4wNTguMDE1em0uMTE3LTUwLjkxOXY1MC42bDI3LjEwNi0xNS42NDkgNi40NDctMjEuNTg0YTEwLjI5MyAxMC4yOTMgMCAwIDEgMi4zNTctNC4wNjVjMS4xNzktMS4yNDEgMi41MTYtMS45NTQgMy42NjgtMS45NTQuOTY5IDAgMS43MzIuNTAyIDIuMTQ3IDEuNDEybDYuNDA3IDE0LjA1MSAyNy4xNTItMTUuNjc2di01MC42MDFsLTc1LjI4NCA0My40NjZ6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE2OS44IDE3Ny4wODNsLTI3LjMyMiAxNS43NzQtNi40Ni0xNC4xNjhjLS45MS0xLjk5NS0zLjQyOC0xLjczOC01LjYyNS41NzRhMTAuMjQ2IDEwLjI0NiAwIDAgMC0yLjMyOSA0LjAxOWwtNi40NjEgMjEuNjI3LTI3LjMyMSAxNS43NzR2LTUwLjg3bDc1LjUxOC00My42djUwLjg3eicgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J005NC4yODIgMjIwLjkxN2EuMjM0LjIzNCAwIDAgMS0uMjM0LS4yMzN2LTUwLjg3MWMwLS4wODMuMDQ1LS4xNjEuMTE3LS4yMDJsNzUuNTE4LTQzLjYwMWEuMjM0LjIzNCAwIDEgMSAuMzUuMjAydjUwLjg3MWEuMjMzLjIzMyAwIDAgMS0uMTE2LjIwMmwtMjcuMzIyIDE1Ljc3NWEuMjMyLjIzMiAwIDAgMS0uMzI5LS4xMDZsLTYuNDYxLTE0LjE2OGMtLjM2LS43ODktLjk5Mi0xLjIwNi0xLjgyOC0xLjIwNi0xLjA1NiAwLTIuMzAxLjY3Mi0zLjQxNSAxLjg0NGExMC4wOTkgMTAuMDk5IDAgMCAwLTIuMjc1IDMuOTI0bC02LjQ2IDIxLjYyOGEuMjM1LjIzNSAwIDAgMS0uMTA3LjEzNmwtMjcuMzIyIDE1Ljc3NGEuMjMuMjMgMCAwIDEtLjExNi4wMzF6bS4yMzMtNTAuOTY5djUwLjMzMWwyNi44OTEtMTUuNTI1IDYuNDM0LTIxLjUzOWExMC40MSAxMC40MSAwIDAgMSAyLjM4NC00LjExMmMxLjIwMS0xLjI2NSAyLjU2OS0xLjk5MSAzLjc1My0xLjk5MSAxLjAxOCAwIDEuODE4LjUyNiAyLjI1MyAxLjQ4bDYuMzU0IDEzLjkzNCAyNi45ODItMTUuNTc4di01MC4zMzFsLTc1LjA1MSA0My4zMzF6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTEwOS44OTQgMTk5Ljk0M2MtMS43NzQgMC0zLjI0MS0uNzI1LTQuMjQ0LTIuMTJhLjIyNC4yMjQgMCAwIDEgLjAyMy0uMjk0LjIzMy4yMzMgMCAwIDEgLjMwMS0uMDIzYy43OC41NDcgMS43MDUuODI3IDIuNzUuODI3IDEuMzIzIDAgMi43NTQtLjQzOSA0LjI1Ni0xLjMwNiA1LjMxMS0zLjA2NyA5LjYzMS0xMC41MTggOS42MzEtMTYuNjExIDAtMS45MjctLjQ0Mi0zLjU2LTEuMjc4LTQuNzI0YS4yMzIuMjMyIDAgMCAxIC4zMjMtLjMyN2MxLjY3MSAxLjE3MiAyLjU5MSAzLjM4MSAyLjU5MSA2LjIxOSAwIDYuMjQyLTQuNDI2IDEzLjg2My05Ljg2NSAxNy4wMDMtMS41NzQuOTA4LTMuMDg0IDEuMzU2LTQuNDg4IDEuMzU2em0tMi45NjktMS41NDJjLjgxMy42NTEgMS44Mi44NzcgMi45NjguODc3aC4wMDFjMS4zMjEgMCAyLjc1My0uMzI3IDQuMjU0LTEuMTk0IDUuMzExLTMuMDY3IDkuNjMyLTEwLjQ2MyA5LjYzMi0xNi41NTYgMC0xLjk3OS0uNDYzLTMuNTk5LTEuMzI2LTQuNzYxLjQxMSAxLjAzNS42MjUgMi4yNzUuNjI1IDMuNjM1IDAgNi4yNDMtNC40MjYgMTMuODgzLTkuODY1IDE3LjAyMy0xLjU3NC45MDktMy4wODQgMS4zMTctNC40OSAxLjMxNy0uNjQxIDAtMS4yNDMtLjE0OS0xLjc5OS0uMzQxeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMTMuMDk3IDE5Ny4yM2M1LjM4NC0zLjEwOCA5Ljc0OC0xMC42MzYgOS43NDgtMTYuODE0IDAtMi4wNTEtLjQ4My0zLjY5Mi0xLjMyMy00Ljg2LTEuNzg0LTEuMjUyLTQuMzc0LTEuMTk0LTcuMjU3LjQ3LTUuMzg0IDMuMTA4LTkuNzQ4IDEwLjYzNi05Ljc0OCAxNi44MTQgMCAyLjA1MS40ODMgMy42OTIgMS4zMjMgNC44NiAxLjc4NCAxLjI1MiA0LjM3NCAxLjE5NCA3LjI1Ny0uNDcnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTA4LjcyNCAxOTguNjE0Yy0xLjE0MiAwLTIuMTU4LS4yMTMtMy4wMTktLjgxNy0uMDIxLS4wMTQtLjA0LjAxNC0uMDU1LS4wMDctLjg5NC0xLjI0NC0xLjM2Ny0yLjk0OC0xLjM2Ny00Ljk3MyAwLTYuMjQyIDQuNDI2LTEzLjg2NCA5Ljg2NS0xNy4wMDUgMS41NzQtLjkwOCAzLjA4NC0xLjM2MyA0LjQ5LTEuMzYzIDEuMTQyIDAgMi4xNTguMzA5IDMuMDE4LjkxM2EuMjMuMjMgMCAwIDEgLjA1Ni4wNTZjLjg5NCAxLjI0NCAxLjM2NyAyLjk3MiAxLjM2NyA0Ljk5NyAwIDYuMjQzLTQuNDI2IDEzLjc4My05Ljg2NSAxNi45MjMtMS41NzQuOTA5LTMuMDg0IDEuMjc2LTQuNDkgMS4yNzZ6bS0yLjcxOC0xLjEwOWMuNzc0LjUzMiAxLjY4OC43NzYgMi43MTguNzc2IDEuMzIzIDAgMi43NTQtLjQxMyA0LjI1Ni0xLjI4IDUuMzExLTMuMDY2IDkuNjMxLTEwLjUwNSA5LjYzMS0xNi41OTggMC0xLjkwOS0uNDM0LTMuNTIzLTEuMjU1LTQuNjg1LS43NzQtLjUzMy0xLjY4OC0uNzk5LTIuNzE4LS43OTktMS4zMjMgMC0yLjc1NS40NDEtNC4yNTYgMS4zMDgtNS4zMTEgMy4wNjYtOS42MzEgMTAuNTA2LTkuNjMxIDE2LjU5OSAwIDEuOTA5LjQzNCAzLjUxNyAxLjI1NSA0LjY3OXonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ5LjMxOCAxMTQuMjYybC05Ljk4NCA4Ljg3OCAxNS44OTMgMTEuMDMxIDUuNTg5LTYuMTEyLTExLjQ5OC0xMy43OTcnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTY5LjY3NiAxMjAuODRsLTkuNzQ4IDUuNjI3Yy0zLjY0MiAyLjEwMy05LjUyOCAyLjExMy0xMy4xNDcuMDI0LTMuNjItMi4wODktMy42MDEtNS40ODguMDQxLTcuNTkxbDkuNDk1LTUuNjA4LTYuNzI5LTMuODg1LTgxLjgzNiA0Ny4wNzEgNDUuOTIzIDI2LjUxNCAzLjA4MS0xLjc3OWMuNjMxLS4zNjUuODY5LS44OTguNjE4LTEuMzktMi4zNTctNC42MzItMi41OTMtOS41NDYtLjY4My0xNC4yNjIgNS42MzgtMTMuOTIgMjQuNTA5LTI0LjgxNSA0OC42MTgtMjguMDcgOC4xNjktMS4xMDMgMTYuNjgtLjk2NyAyNC43MDQuMzk0Ljg1Mi4xNDUgMS43NzYuMDA4IDIuNDA3LS4zNTdsMy4wODEtMS43NzgtMjUuODI1LTE0LjkxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTExMy42NzUgMTgzLjQ1OWEuNDcuNDcgMCAwIDEtLjIzMy0uMDYybC00NS45MjQtMjYuNTE1YS40NjguNDY4IDAgMCAxIC4wMDEtLjgwOWw4MS44MzYtNDcuMDcxYS40NjcuNDY3IDAgMCAxIC40NjYgMGw2LjcyOSAzLjg4NWEuNDY3LjQ2NyAwIDAgMS0uNDY3LjgwOWwtNi40OTYtMy43NS04MC45IDQ2LjUzMyA0NC45ODggMjUuOTczIDIuODQ4LTEuNjQ0Yy4xOTItLjExMS42Mi0uNDA5LjQzNS0uNzczLTIuNDE2LTQuNzQ4LTIuNjU4LTkuODE0LS43LTE0LjY1IDIuODA2LTYuOTI3IDguODg1LTEzLjI0MiAxNy41ODItMTguMjYzIDguNjU3LTQuOTk4IDE5LjUxOC04LjQ4OSAzMS40MDctMTAuMDk0IDguMTk4LTEuMTA3IDE2Ljc5LS45NyAyNC44NDQuMzk3LjczOS4xMjUgMS41NjEuMDA3IDIuMDk1LS4zMDFsMi4zODEtMS4zNzQtMjUuMTI1LTE0LjUwNmEuNDY3LjQ2NyAwIDAgMSAuNDY3LS44MDlsMjUuODI1IDE0LjkxYS40NjcuNDY3IDAgMCAxIDAgLjgwOWwtMy4wODEgMS43NzljLS43MjEuNDE3LTEuNzYzLjU3NS0yLjcxOC40MTMtNy45NjMtMS4zNTEtMTYuNDU3LTEuNDg2LTI0LjU2My0uMzkyLTExLjc3IDEuNTg5LTIyLjUxMiA1LjAzOS0zMS4wNjUgOS45NzctOC41MTQgNC45MTYtMTQuNDU2IDExLjA3My0xNy4xODMgMTcuODA1LTEuODU0IDQuNTc4LTEuNjIzIDkuMzc2LjY2NiAxMy44NzUuMzcuNzI1LjA1NSAxLjUxMy0uOCAyLjAwNmwtMy4wODEgMS43OGEuNDc2LjQ3NiAwIDAgMS0uMjM0LjA2MicgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xNTMuMzE2IDEyOC4yNzljLTIuNDEzIDAtNC44MjEtLjUyOC02LjY1Mi0xLjU4Ni0xLjgxOC0xLjA0OS0yLjgyLTIuNDYxLTIuODItMy45NzUgMC0xLjUyNyAxLjAxNi0yLjk1NSAyLjg2MS00LjAybDkuNDkzLTUuNjA3YS4yMzMuMjMzIDAgMSAxIC4yMzguNDAybC05LjQ5NiA1LjYwOWMtMS42OTYuOTc5LTIuNjI4IDIuMjYzLTIuNjI4IDMuNjE2IDAgMS4zNC45MTggMi42MDggMi41ODUgMy41NzEgMy41NDkgMi4wNDkgOS4zNDMgMi4wMzggMTIuOTE0LS4wMjRsOS43NDgtNS42MjhhLjIzNC4yMzQgMCAwIDEgLjIzNC40MDVsLTkuNzQ4IDUuNjI4Yy0xLjg1OCAxLjA3Mi00LjI5NiAxLjYwOS02LjcyOSAxLjYwOScgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMTMuNjc1IDE4Mi45OTJsLTQ1LjkxMy0yNi41MDhNMTEzLjY3NSAxODMuMzQyYS4zNDYuMzQ2IDAgMCAxLS4xNzUtLjA0N2wtNDUuOTEzLTI2LjUwOGEuMzUuMzUgMCAxIDEgLjM1LS42MDdsNDUuOTEzIDI2LjUwOGEuMzUuMzUgMCAwIDEtLjE3NS42NTQnIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNjcuNzYyIDE1Ni40ODR2NTQuMDAxYzAgMS4wOS43NyAyLjQxOCAxLjcyIDIuOTY3bDQyLjQ3MyAyNC41MjFjLjk1LjU0OSAxLjcyLjExIDEuNzItLjk4di01NC4wMDEnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTEyLjcyNyAyMzguNTYxYy0uMjk3IDAtLjYyLS4wOTUtLjk0Ny0uMjg1bC00Mi40NzMtMjQuNTIxYy0xLjA2My0uNjEzLTEuODk1LTIuMDUtMS44OTUtMy4yN3YtNTQuMDAxYS4zNS4zNSAwIDEgMSAuNzAxIDB2NTQuMDAxYzAgLjk2LjcwNyAyLjE4IDEuNTQ0IDIuNjYzbDQyLjQ3MyAyNC41MjJjLjM0NC4xOTguNjYxLjI0My44Ny4xMjIuMjA2LS4xMTkuMzI1LS40MTEuMzI1LS43OTl2LTU0LjAwMWEuMzUuMzUgMCAxIDEgLjcgMHY1NC4wMDFjMCAuNjU1LS4yMzkgMS4xNTQtLjY3NSAxLjQwNmExLjIzNSAxLjIzNSAwIDAgMS0uNjIzLjE2MicgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xMTIuODYgMTQ3LjUxMmgtLjAwMWMtMi4zMTggMC00LjQ5OS0uNTIyLTYuMTQyLTEuNDcxLTEuNzA1LS45ODQtMi42NDMtMi4zMTUtMi42NDMtMy43NDkgMC0xLjQ0NS45NTItMi43OTEgMi42OC0zLjc4OGwxMi4wNDEtNi45NTNjMS42NjgtLjk2MiAzLjg3NC0xLjQ5MyA2LjIxMi0xLjQ5MyAyLjMxOCAwIDQuNDk5LjUyMyA2LjE0MyAxLjQ3MiAxLjcwNC45ODQgMi42NDMgMi4zMTUgMi42NDMgMy43NDggMCAxLjQ0Ni0uOTUyIDIuNzkxLTIuNjggMy43ODlsLTEyLjA0MiA2Ljk1MmMtMS42NjguOTYzLTMuODc0IDEuNDkzLTYuMjExIDEuNDkzem0xMi4xNDctMTYuNzUzYy0yLjIxNyAwLTQuMjk4LjQ5Ny01Ljg2MSAxLjM5OWwtMTIuMDQyIDYuOTUyYy0xLjUwMi44NjgtMi4zMyAxLjk5OC0yLjMzIDMuMTgyIDAgMS4xNzMuODE1IDIuMjg5IDIuMjkzIDMuMTQyIDEuNTM4Ljg4OSAzLjU5NiAxLjM3OCA1Ljc5MiAxLjM3OGguMDAxYzIuMjE2IDAgNC4yOTgtLjQ5NyA1Ljg2MS0xLjM5OWwxMi4wNDEtNi45NTNjMS41MDItLjg2NyAyLjMzLTEuOTk3IDIuMzMtMy4xODIgMC0xLjE3Mi0uODE0LTIuMjg4LTIuMjkyLTMuMTQyLTEuNTM5LS44ODgtMy41OTYtMS4zNzctNS43OTMtMS4zNzd6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE2NS42MyAxMjMuMjE5bC01LjczNCAzLjMxMWMtMy4xNjcgMS44MjgtOC4yODYgMS44MzctMTEuNDMzLjAyLTMuMTQ3LTEuODE3LTMuMTMxLTQuNzcyLjAzNi02LjYwMWw1LjczNC0zLjMxIDExLjM5NyA2LjU4JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE1NC4yMzMgMTE3LjQ0OGw5Ljk5NSA1Ljc3MS00LjY4MiAyLjcwNGMtMS40MzQuODI3LTMuMzUyIDEuMjgzLTUuMzk5IDEuMjgzLTIuMDI5IDAtMy45MjMtLjQ0OS01LjMzMy0xLjI2My0xLjI5LS43NDQtMi0xLjY5NC0yLTIuNjc0IDAtLjk5MS43MjMtMS45NTUgMi4wMzYtMi43MTNsNS4zODMtMy4xMDhtMC0uODA5bC01LjczNCAzLjMxYy0zLjE2NyAxLjgyOS0zLjE4MyA0Ljc4NC0uMDM2IDYuNjAxIDEuNTY4LjkwNSAzLjYyMyAxLjM1NyA1LjY4NCAxLjM1NyAyLjA3NyAwIDQuMTU5LS40NiA1Ljc0OS0xLjM3N2w1LjczNC0zLjMxMS0xMS4zOTctNi41OE0xNDUuNDQ1IDE3OS42NjdjLTEuNzczIDAtMy4yNDEtLjg1LTQuMjQzLTIuMjQ1LS4wNjctLjA5Mi0uMDU3LS4yNzUuMDIzLS4zNTYuMDgtLjA4MS4yMDctLjEyLjMtLjA1NS43ODEuNTQ4IDEuNzA2LjgxMiAyLjc1MS44MTEgMS4zMjIgMCAyLjc1NC0uNDQ2IDQuMjU2LTEuMzEzIDUuMzEtMy4wNjYgOS42MzEtMTAuNTIyIDkuNjMxLTE2LjYxNSAwLTEuOTI3LS40NDItMy41NjItMS4yNzktNC43MjZhLjIzNS4yMzUgMCAwIDEgLjAyNC0uMzAxLjIzMi4yMzIgMCAwIDEgLjMtLjAyN2MxLjY3IDEuMTcyIDIuNTkgMy4zOCAyLjU5IDYuMjE5IDAgNi4yNDItNC40MjUgMTMuOTg3LTkuODY1IDE3LjEyNy0xLjU3My45MDgtMy4wODMgMS40ODEtNC40ODggMS40ODF6TTE0Mi40NzYgMTc4Yy44MTQuNjUxIDEuODIgMS4wMDIgMi45NjkgMS4wMDIgMS4zMjIgMCAyLjc1My0uNDUyIDQuMjU1LTEuMzIgNS4zMS0zLjA2NSA5LjYzMS0xMC41MjMgOS42MzEtMTYuNjE3IDAtMS45OC0uNDYzLTMuNjMtMS4zMjUtNC43OTMuNDExIDEuMDM1LjYyNCAyLjI2LjYyNCAzLjYyIDAgNi4yNDItNC40MjUgMTMuODc1LTkuODY1IDE3LjAxNS0xLjU3My45MDktMy4wODQgMS4zNzYtNC40ODkgMS4zNzZhNS40OSA1LjQ5IDAgMCAxLTEuOC0uMjgzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDguNjQ4IDE3Ni43MDRjNS4zODQtMy4xMDggOS43NDgtMTAuNjM2IDkuNzQ4LTE2LjgxMyAwLTIuMDUyLS40ODMtMy42OTMtMS4zMjItNC44NjEtMS43ODUtMS4yNTItNC4zNzUtMS4xOTQtNy4yNTguNDcxLTUuMzgzIDMuMTA4LTkuNzQ4IDEwLjYzNi05Ljc0OCAxNi44MTMgMCAyLjA1MS40ODQgMy42OTIgMS4zMjMgNC44NiAxLjc4NSAxLjI1MyA0LjM3NCAxLjE5NSA3LjI1Ny0uNDcnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTQ0LjI3NiAxNzguMjc2Yy0xLjE0MyAwLTIuMTU4LS4zMDctMy4wMTktLjkxMWEuMjE3LjIxNyAwIDAgMS0uMDU1LS4wNTRjLS44OTUtMS4yNDQtMS4zNjctMi45NzItMS4zNjctNC45OTcgMC02LjI0MSA0LjQyNS0xMy44NzUgOS44NjUtMTcuMDE2IDEuNTczLS45MDggMy4wODQtMS4zNjkgNC40ODktMS4zNjkgMS4xNDMgMCAyLjE1OC4zMDcgMy4wMTkuOTFhLjI0LjI0IDAgMCAxIC4wNTUuMDU1Yy44OTQgMS4yNDQgMS4zNjcgMi45NzEgMS4zNjcgNC45OTcgMCA2LjI0MS00LjQyNSAxMy44NzUtOS44NjUgMTcuMDE2LTEuNTczLjkwOC0zLjA4NCAxLjM2OS00LjQ4OSAxLjM2OXptLTIuNzE4LTEuMTcyYy43NzMuNTMzIDEuNjg3LjkwMSAyLjcxOC45MDEgMS4zMjIgMCAyLjc1NC0uNTM4IDQuMjU2LTEuNDA1IDUuMzEtMy4wNjYgOS42MzEtMTAuNTY3IDkuNjMxLTE2LjY2MSAwLTEuOTA4LS40MzQtMy41NTQtMS4yNTYtNC43MTYtLjc3NC0uNTMyLTEuNjg4LS44MTQtMi43MTgtLjgxNC0xLjMyMiAwLTIuNzU0LjQzMy00LjI1NiAxLjMtNS4zMSAzLjA2Ni05LjYzMSAxMC41NjQtOS42MzEgMTYuNjU3IDAgMS45MS40MzQgMy41NzYgMS4yNTYgNC43Mzh6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE1MC43MiAxNzIuMzYxbC0uMzYzLS4yOTVhMjQuMTA1IDI0LjEwNSAwIDAgMCAyLjE0OC0zLjEyOCAyNC4wNSAyNC4wNSAwIDAgMCAxLjk3Ny00LjM3NWwuNDQzLjE0OWEyNC41NCAyNC41NCAwIDAgMS0yLjAxNSA0LjQ2IDI0LjYxIDI0LjYxIDAgMCAxLTIuMTkgMy4xODlNMTE1LjkxNyAxOTEuNTE0bC0uMzYzLS4yOTRhMjQuMTc0IDI0LjE3NCAwIDAgMCAyLjE0OC0zLjEyOCAyNC4wMzggMjQuMDM4IDAgMCAwIDEuOTc2LTQuMzc1bC40NDMuMTQ4YTI0LjQ4IDI0LjQ4IDAgMCAxLTIuMDE1IDQuNDYxIDI0LjY2MiAyNC42NjIgMCAwIDEtMi4xODkgMy4xODhNMTE0IDIzNy40NzZWMTgyLjU4NCAyMzcuNDc2JyBmaWxsPScjNjA3RDhCJy8+PGc+PHBhdGggZD0nTTgxLjgyMiAzNy40NzRjLjAxNy0uMTM1LS4wNzUtLjI4LS4yNjctLjM5Mi0uMzI3LS4xODgtLjgyNi0uMjEtMS4xMDktLjA0NWwtNi4wMTIgMy40NzFjLS4xMzEuMDc2LS4xOTQuMTc4LS4xOTEuMjg1LjAwMi4xMzIuMDAyLjQ2MS4wMDIuNTc4di4wNDNsLS4wMDcuMTI4LTYuNTkxIDMuNzc5Yy0uMDAxIDAtMi4wNzcgMS4wNDYtMi43ODcgNS4xOTIgMCAwLS45MTIgNi45NjEtLjg5OCAxOS43NDUuMDE1IDEyLjU3LjYwNiAxNy4wNyAxLjE2NyAyMS4zNTEuMjIgMS42ODQgMy4wMDEgMi4xMjUgMy4wMDEgMi4xMjUuMzMxLjA0LjY5OC0uMDI3IDEuMDgtLjI0OGw3NS4yNzMtNDMuNTUxYzEuODA4LTEuMDY5IDIuNjY3LTMuNzE5IDMuMDU2LTYuMjg0IDEuMjEzLTcuOTkgMS42NzUtMzIuOTc4LS4yNzUtMzkuODc4LS4xOTYtLjY5My0uNTEtMS4wODMtLjg2OC0xLjI4MmwtMi4wODYtLjc5Yy0uNzI3LjAyOC0xLjQxNi40NjctMS41MzQuNTM1TDgyLjAzMiAzNy4wNzJsLS4yMS40MDInIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNMTQ0LjMxMSAxLjcwMWwyLjA4NS43OWMuMzU4LjE5OS42NzIuNTg5Ljg2OCAxLjI4MiAxLjk0OSA2LjkgMS40ODcgMzEuODg3LjI3NSAzOS44NzgtLjM5IDIuNTY1LTEuMjQ5IDUuMjE1LTMuMDU2IDYuMjg0TDY5LjIxIDkzLjQ4NmExLjc4IDEuNzggMCAwIDEtLjg5Ni4yNThsLS4xODMtLjAxMWMwIC4wMDEtMi43ODItLjQ0LTMuMDAzLTIuMTI0LS41Ni00LjI4Mi0xLjE1MS04Ljc4MS0xLjE2NS0yMS4zNTEtLjAxNS0xMi43ODQuODk3LTE5Ljc0NS44OTctMTkuNzQ1LjcxLTQuMTQ2IDIuNzg3LTUuMTkyIDIuNzg3LTUuMTkybDYuNTkxLTMuNzc5LjAwNy0uMTI4di0uMDQzYzAtLjExNyAwLS40NDYtLjAwMi0uNTc4LS4wMDMtLjEwNy4wNTktLjIxLjE5MS0uMjg1bDYuMDEyLTMuNDcyYS45OC45OCAwIDAgMSAuNDgxLS4xMWMuMjE4IDAgLjQ0OS4wNTMuNjI3LjE1Ni4xOTMuMTEyLjI4NS4yNTguMjY4LjM5MmwuMjExLS40MDIgNjAuNzQ0LTM0LjgzNmMuMTE3LS4wNjguODA2LS41MDcgMS41MzQtLjUzNW0wLS45OTdsLS4wMzkuMDAxYy0uNjE4LjAyMy0xLjI4My4yNDQtMS45NzQuNjU2bC0uMDIxLjAxMi02MC41MTkgMzQuNzA2YTIuMzU4IDIuMzU4IDAgMCAwLS44MzEtLjE1Yy0uMzY1IDAtLjcwNC4wODQtLjk4LjI0NGwtNi4wMTIgMy40NzFjLS40NDIuMjU1LS42OTkuNjktLjY4OSAxLjE2NmwuMDAxLjE1LTYuMDggMy40ODdjLS4zNzMuMTk5LTIuNTQyIDEuNTMxLTMuMjkgNS44OThsLS4wMDYuMDM5Yy0uMDA5LjA3LS45MiA3LjE3My0uOTA2IDE5Ljg3NS4wMTQgMTIuNjIuNjAzIDE3LjExNiAxLjE3MiAyMS40NjVsLjAwMi4wMTVjLjMwOCAyLjM1NSAzLjQ3NSAyLjkyMyAzLjgzNiAyLjk4bC4wMzQuMDA0Yy4xMDEuMDEzLjIwNC4wMTkuMzA1LjAxOWEyLjc3IDIuNzcgMCAwIDAgMS4zOTYtLjM5Mmw3NS4yNzMtNDMuNTUyYzEuODExLTEuMDcxIDIuOTk5LTMuNDIzIDMuNTQyLTYuOTk3IDEuMTg2LTcuODE0IDEuNzM0LTMzLjA5Ni0uMzAxLTQwLjI5OS0uMjUzLS44OTMtLjcwNC0xLjUyNy0xLjM0My0xLjg4MmwtLjEzMi0uMDYyLTIuMDg1LS43ODlhLjk3My45NzMgMCAwIDAtLjM1My0uMDY1JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTEyOC4yNjcgMTEuNTY1bDEuNDk1LjQzNC01Ni4zMzkgMzIuMzI2JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTc0LjIwMiA5MC41NDVhLjUuNSAwIDAgMS0uMjUtLjkzMWwxOC40MzctMTAuNjQ1YS40OTkuNDk5IDAgMSAxIC40OTkuODY0TDc0LjQ1MSA5MC40NzhsLS4yNDkuMDY3TTc1Ljc2NCA0Mi42NTRsLS4xMDgtLjA2Mi4wNDYtLjE3MSA1LjEzNS0yLjk2NC4xNy4wNDUtLjA0NS4xNzEtNS4xMzUgMi45NjQtLjA2My4wMTdNNzAuNTIgOTAuMzc1VjQ2LjQyMWwuMDYzLS4wMzZMMTM3Ljg0IDcuNTU0djQzLjk1NGwtLjA2Mi4wMzZMNzAuNTIgOTAuMzc1em0uMjUtNDMuODExdjQzLjM4bDY2LjgyMS0zOC41NzlWNy45ODVMNzAuNzcgNDYuNTY0eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J004Ni45ODYgODMuMTgyYy0uMjMuMTQ5LS42MTIuMzg0LS44NDkuNTIzbC0xMS41MDUgNi43MDFjLS4yMzcuMTM5LS4yMDYuMjUyLjA2OC4yNTJoLjU2NWMuMjc1IDAgLjY5My0uMTEzLjkzLS4yNTJMODcuNyA4My43MDVjLjIzNy0uMTM5LjQyOC0uMjUzLjQyNS0uMjU2YTExLjI5IDExLjI5IDAgMCAxLS4wMDYtLjUwM2MwLS4yNzQtLjE4OC0uMzc3LS40MTgtLjIyN2wtLjcxNS40NjMnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNzUuMjY2IDkwLjc4Mkg3NC43Yy0uMiAwLS4zMTYtLjA1Ni0uMzQ2LS4xNjYtLjAzLS4xMS4wNDMtLjIxNy4yMTUtLjMxN2wxMS41MDUtNi43MDJjLjIzNi0uMTM4LjYxNS0uMzcxLjg0NC0uNTE5bC43MTUtLjQ2NGEuNDg4LjQ4OCAwIDAgMSAuMjY2LS4wODljLjE3MiAwIC4zNDUuMTMuMzQ1LjQyMSAwIC4yMTQuMDAxLjM2My4wMDMuNDM3bC4wMDYuMDA0LS4wMDQuMDY5Yy0uMDAzLjA3NS0uMDAzLjA3NS0uNDg2LjM1NmwtMTEuNTA1IDYuNzAyYTIuMjgyIDIuMjgyIDAgMCAxLS45OTIuMjY4em0tLjYtLjI1bC4wMzQuMDAxaC41NjZjLjI1MiAwIC42NDktLjEwOC44NjYtLjIzNGwxMS41MDUtNi43MDJjLjE2OC0uMDk4LjI5NC0uMTczLjM2MS0uMjE0LS4wMDQtLjA4NC0uMDA0LS4yMTgtLjAwNC0uNDM3bC0uMDk1LS4xNzEtLjEzMS4wNDktLjcxNC40NjNjLS4yMzIuMTUtLjYxNi4zODYtLjg1NC41MjVsLTExLjUwNSA2LjcwMi0uMDI5LjAxOHonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNzUuMjY2IDg5Ljg3MUg3NC43Yy0uMiAwLS4zMTYtLjA1Ni0uMzQ2LS4xNjYtLjAzLS4xMS4wNDMtLjIxNy4yMTUtLjMxN2wxMS41MDUtNi43MDJjLjI1OC0uMTUxLjY5NC0uMjY4Ljk5My0uMjY4aC41NjVjLjIgMCAuMzE2LjA1Ni4zNDYuMTY2LjAzLjExLS4wNDMuMjE3LS4yMTUuMzE3bC0xMS41MDUgNi43MDJhMi4yODIgMi4yODIgMCAwIDEtLjk5Mi4yNjh6bS0uNi0uMjVsLjAzNC4wMDFoLjU2NmMuMjUyIDAgLjY0OS0uMTA3Ljg2Ni0uMjM0bDExLjUwNS02LjcwMi4wMy0uMDE4LS4wMzUtLjAwMWgtLjU2NWMtLjI1MiAwLS42NDkuMTA4LS44NjcuMjM0bC0xMS41MDUgNi43MDItLjAyOS4wMTh6TTc0LjM3IDkwLjgwMXYtMS4yNDcgMS4yNDcnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNjguMTMgOTMuOTAxYy0uNzUxLS4wOTMtMS4zMTQtLjczNy0xLjQzOS0xLjM3Ni0uODMxLTQuMjM4LTEuMTUxLTguNzgyLTEuMTY1LTIxLjM1Mi0uMDE1LTEyLjc4NC44OTctMTkuNzQ1Ljg5Ny0xOS43NDUuNzExLTQuMTQ2IDIuNzg3LTUuMTkyIDIuNzg3LTUuMTkybDc0Ljg1OS00My4yMTljLjIyMy0uMTI5IDIuNDg3LTEuNTg0IDMuMTk1LjkyMyAxLjk1IDYuOSAxLjQ4OCAzMS44ODcuMjc1IDM5Ljg3OC0uMzg5IDIuNTY1LTEuMjQ4IDUuMjE1LTMuMDU2IDYuMjgzTDY5LjIxIDkzLjY1M2MtLjM4Mi4yMjEtLjc0OS4yODgtMS4wOC4yNDggMCAwLTIuNzgxLS40NDEtMy4wMDEtMi4xMjUtLjU2MS00LjI4MS0xLjE1Mi04Ljc4MS0xLjE2Ny0yMS4zNTEtLjAxNC0xMi43ODQuODk4LTE5Ljc0NS44OTgtMTkuNzQ1LjcxLTQuMTQ2IDIuNzg3LTUuMTkxIDIuNzg3LTUuMTkxbDYuNTk4LTMuODEuODcxLS4xMTkgNi41OTktMy44My4wNDYtLjQ2MUw2OC4xMyA5My45MDEnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNNjguMzE3IDk0LjE2MWwtLjIxNS0uMDEzaC0uMDAxbC0uMjQ0LS4wNDdjLS43MTktLjE1Ni0yLjc3Mi0uNzM2LTIuOTc2LTIuMjkyLS41NjgtNC4zNC0xLjE1NC04LjgxMy0xLjE2OC0yMS4zODQtLjAxNC0xMi42NTQuODkxLTE5LjcwNy45LTE5Ljc3Ny43MjUtNC4yMzEgMi44MzItNS4zMzggMi45MjItNS4zODJsNi42MjgtMy44MjcuODctLjExOSA2LjQ0Ni0zLjc0Mi4wMzQtLjMzNGEuMjQ4LjI0OCAwIDAgMSAuMjczLS4yMjMuMjQ4LjI0OCAwIDAgMSAuMjIzLjI3MmwtLjA1OS41ODktNi43NTIgMy45MTktLjg3LjExOC02LjU1NiAzLjc4NWMtLjAzMS4wMTYtMS45OSAxLjA2OC0yLjY2NiA1LjAxOC0uMDA3LjA2LS45MDggNy4wODYtLjg5NCAxOS43MDIuMDE0IDEyLjUzOS41OTcgMTYuOTk2IDEuMTYxIDIxLjMwNS4wOTEuNjkxLjY4OSAxLjE1NCAxLjMwOSAxLjQ1MmExLjk1IDEuOTUgMCAwIDEtLjIzNi0uNjA5Yy0uNzgxLTMuOTg0LTEuMTU1LTguMjAyLTEuMTctMjEuMzk5LS4wMTQtMTIuNjUzLjg5MS0xOS43MDcuOS0xOS43NzcuNzI1LTQuMjMxIDIuODMyLTUuMzM3IDIuOTIyLTUuMzgyLS4wMDQuMDAxIDc0LjQ0NC00Mi45OCA3NC44NDYtNDMuMjEybC4wMjgtLjAxN2MuOTA0LS41MzggMS43Mi0uNjg4IDIuMzYtLjQzMy41NTUuMjIxLjk0OS43MzMgMS4xNzIgMS41MiAyLjAxNCA3LjEyOCAxLjQ2IDMyLjIxOS4yODEgMzkuOTgzLS41MDcgMy4zNDEtMS41NzUgNS41MTUtMy4xNzUgNi40NjJMNjkuMzM1IDkzLjg2OWEyLjAyMyAyLjAyMyAwIDAgMS0xLjAxOC4yOTJ6bS0uMTQ3LS41MDdjLjI5My4wMzYuNjA0LS4wMzcuOTE1LS4yMTdsNzUuMjczLTQzLjU1MWMxLjgyMy0xLjA3OCAyLjYwMi0zLjkxNSAyLjkzNC02LjEwNiAxLjE3NC03LjczMSAxLjczMS0zMi42OTUtLjI2OC0zOS43NzItLjE3OC0uNjMxLS40NzMtMS4wMzItLjg3Ni0xLjE5Mi0uNDg0LS4xOTMtMS4xNjYtLjA1Mi0xLjkyMS4zOTdsLS4wMzQuMDIxLTc0Ljg1OCA0My4yMThjLS4wMzEuMDE3LTEuOTg5IDEuMDY5LTIuNjY2IDUuMDE5LS4wMDcuMDU5LS45MDggNy4wODUtLjg5NCAxOS43MDIuMDE1IDEzLjE1NS4zODYgMTcuMzUxIDEuMTYxIDIxLjMwMy4wOS40NjEuNDc2Ljk4MyAxLjAzNyAxLjEzOS4xMTQuMDI1LjE4NS4wMzcuMTk2LjAzOWguMDAxeicgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J002OS4zMTcgNjguOTgyYy40ODktLjI4MS44ODUtLjA1Ni44ODUuNTA1IDAgLjU2LS4zOTYgMS4yNDMtLjg4NSAxLjUyNS0uNDg4LjI4Mi0uODg0LjA1Ny0uODg0LS41MDQgMC0uNTYuMzk2LTEuMjQzLjg4NC0xLjUyNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OC45MiA3MS4xMzNjLS4yODkgMC0uNDg3LS4yMjgtLjQ4Ny0uNjI1IDAtLjU2LjM5Ni0xLjI0My44ODQtMS41MjZhLjgxMi44MTIgMCAwIDEgLjM5Ny0uMTIxYy4yODkgMCAuNDg4LjIyOS40ODguNjI2IDAgLjU2LS4zOTYgMS4yNDMtLjg4NSAxLjUyNWEuODEyLjgxMiAwIDAgMS0uMzk3LjEyMW0uNzk0LTIuNDU5YS45NzYuOTc2IDAgMCAwLS40OS4xNDdjLS41NDguMzE3LS45NzggMS4wNTgtLjk3OCAxLjY4NyAwIC40ODYuMjcxLjgxMi42NzQuODEyYS45ODUuOTg1IDAgMCAwIC40OTEtLjE0NmMuNTQ4LS4zMTcuOTc4LTEuMDU3Ljk3OC0xLjY4NyAwLS40ODYtLjI3Mi0uODEzLS42NzUtLjgxMycgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OC45MiA3MC45NDdjLS4yNzEgMC0uMjk5LS4zMDctLjI5OS0uNDM5IDAtLjQ5MS4zNjEtMS4xMTYuNzktMS4zNjNhLjYzMi42MzIgMCAwIDEgLjMwMy0uMDk2Yy4yNzIgMCAuMzAxLjMwNi4zMDEuNDM4IDAgLjQ5MS0uMzYzIDEuMTE2LS43OTEgMS4zNjRhLjYyOS42MjkgMCAwIDEtLjMwNC4wOTZtLjc5NC0yLjA4NmEuODEyLjgxMiAwIDAgMC0uMzk3LjEyMWMtLjQ4OC4yODMtLjg4NC45NjYtLjg4NCAxLjUyNiAwIC4zOTcuMTk4LjYyNS40ODcuNjI1YS44MTIuODEyIDAgMCAwIC4zOTctLjEyMWMuNDg5LS4yODIuODg1LS45NjUuODg1LTEuNTI1IDAtLjM5Ny0uMTk5LS42MjYtLjQ4OC0uNjI2JyBmaWxsPScjODA5N0EyJy8+PHBhdGggZD0nTTY5LjQ0NCA4NS4zNWMuMjY0LS4xNTIuNDc3LS4wMzEuNDc3LjI3MiAwIC4zMDMtLjIxMy42Ny0uNDc3LjgyMi0uMjYzLjE1My0uNDc3LjAzMS0uNDc3LS4yNzEgMC0uMzAyLjIxNC0uNjcxLjQ3Ny0uODIzJyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTY5LjIzIDg2LjUxYy0uMTU2IDAtLjI2My0uMTIzLS4yNjMtLjMzNyAwLS4zMDIuMjE0LS42NzEuNDc3LS44MjNhLjQzMS40MzEgMCAwIDEgLjIxNC0uMDY2Yy4xNTYgMCAuMjYzLjEyNC4yNjMuMzM4IDAgLjMwMy0uMjEzLjY3LS40NzcuODIyYS40MzEuNDMxIDAgMCAxLS4yMTQuMDY2bS40MjgtMS40MTJjLS4xIDAtLjIwMy4wMjktLjMwNy4wOS0uMzIuMTg1LS41Ny42MTgtLjU3Ljk4NSAwIC4zMDkuMTg1LjUyNC40NDkuNTI0YS42My42MyAwIDAgMCAuMzA4LS4wOWMuMzItLjE4NS41Ny0uNjE4LjU3LS45ODUgMC0uMzA5LS4xODUtLjUyNC0uNDUtLjUyNCcgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OS4yMyA4Ni4zMjJsLS4wNzYtLjE0OWMwLS4yMzUuMTc5LS41NDQuMzg0LS42NjFsLjEyLS4wNDEuMDc2LjE1MWMwIC4yMzQtLjE3OS41NDItLjM4My42NmwtLjEyMS4wNG0uNDI4LTEuMDM4YS40MzEuNDMxIDAgMCAwLS4yMTQuMDY2Yy0uMjYzLjE1Mi0uNDc3LjUyMS0uNDc3LjgyMyAwIC4yMTQuMTA3LjMzNy4yNjMuMzM3YS40MzEuNDMxIDAgMCAwIC4yMTQtLjA2NmMuMjY0LS4xNTIuNDc3LS41MTkuNDc3LS44MjIgMC0uMjE0LS4xMDctLjMzOC0uMjYzLS4zMzgnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNMTM5LjI3OCA3Ljc2OXY0My42NjdMNzIuMjA4IDkwLjE2VjQ2LjQ5M2w2Ny4wNy0zOC43MjQnIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNzIuMDgzIDkwLjM3NVY0Ni40MjFsLjA2My0uMDM2IDY3LjI1Ny0zOC44MzF2NDMuOTU0bC0uMDYyLjAzNi02Ny4yNTggMzguODMxem0uMjUtNDMuODExdjQzLjM4bDY2LjgyMS0zOC41NzlWNy45ODVMNzIuMzMzIDQ2LjU2NHonIGZpbGw9JyM2MDdEOEInLz48L2c+PHBhdGggZD0nTTEyNS43MzcgODguNjQ3bC03LjYzOSAzLjMzNFY4NGwtMTEuNDU5IDQuNzEzdjguMjY5TDk5IDEwMC4zMTVsMTMuMzY5IDMuNjQ2IDEzLjM2OC0xNS4zMTQnIGZpbGw9JyM0NTVBNjQnLz48L2c+PC9zdmc+IjsKICAgIGZ1bmN0aW9uIFJvdGF0ZUluc3RydWN0aW9ucygpIHsKICAgICAgdGhpcy5sb2FkSWNvbl8oKTsKICAgICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdmFyIHMgPSBvdmVybGF5LnN0eWxlOwogICAgICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKICAgICAgcy50b3AgPSAwOwogICAgICBzLnJpZ2h0ID0gMDsKICAgICAgcy5ib3R0b20gPSAwOwogICAgICBzLmxlZnQgPSAwOwogICAgICBzLmJhY2tncm91bmRDb2xvciA9ICdncmF5JzsKICAgICAgcy5mb250RmFtaWx5ID0gJ3NhbnMtc2VyaWYnOwogICAgICBzLnpJbmRleCA9IDEwMDAwMDA7CiAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKICAgICAgaW1nLnNyYyA9IHRoaXMuaWNvbjsKICAgICAgdmFyIHMgPSBpbWcuc3R5bGU7CiAgICAgIHMubWFyZ2luTGVmdCA9ICcyNSUnOwogICAgICBzLm1hcmdpblRvcCA9ICcyNSUnOwogICAgICBzLndpZHRoID0gJzUwJSc7CiAgICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoaW1nKTsKICAgICAgdmFyIHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdmFyIHMgPSB0ZXh0LnN0eWxlOwogICAgICBzLnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICBzLmZvbnRTaXplID0gJzE2cHgnOwogICAgICBzLmxpbmVIZWlnaHQgPSAnMjRweCc7CiAgICAgIHMubWFyZ2luID0gJzI0cHggMjUlJzsKICAgICAgcy53aWR0aCA9ICc1MCUnOwogICAgICB0ZXh0LmlubmVySFRNTCA9ICdQbGFjZSB5b3VyIHBob25lIGludG8geW91ciBDYXJkYm9hcmQgdmlld2VyLic7CiAgICAgIG92ZXJsYXkuYXBwZW5kQ2hpbGQodGV4dCk7CiAgICAgIHZhciBzbmFja2JhciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgcyA9IHNuYWNrYmFyLnN0eWxlOwogICAgICBzLmJhY2tncm91bmRDb2xvciA9ICcjQ0ZEOERDJzsKICAgICAgcy5wb3NpdGlvbiA9ICdmaXhlZCc7CiAgICAgIHMuYm90dG9tID0gMDsKICAgICAgcy53aWR0aCA9ICcxMDAlJzsKICAgICAgcy5oZWlnaHQgPSAnNDhweCc7CiAgICAgIHMucGFkZGluZyA9ICcxNHB4IDI0cHgnOwogICAgICBzLmJveFNpemluZyA9ICdib3JkZXItYm94JzsKICAgICAgcy5jb2xvciA9ICcjNjU2QTZCJzsKICAgICAgb3ZlcmxheS5hcHBlbmRDaGlsZChzbmFja2Jhcik7CiAgICAgIHZhciBzbmFja2JhclRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgc25hY2tiYXJUZXh0LnN0eWxlLmZsb2F0ID0gJ2xlZnQnOwogICAgICBzbmFja2JhclRleHQuaW5uZXJIVE1MID0gJ05vIENhcmRib2FyZCB2aWV3ZXI/JzsKICAgICAgdmFyIHNuYWNrYmFyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBzbmFja2JhckJ1dHRvbi5ocmVmID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vZ2V0L2NhcmRib2FyZC9nZXQtY2FyZGJvYXJkLyc7CiAgICAgIHNuYWNrYmFyQnV0dG9uLmlubmVySFRNTCA9ICdnZXQgb25lJzsKICAgICAgc25hY2tiYXJCdXR0b24udGFyZ2V0ID0gJ19ibGFuayc7CiAgICAgIHZhciBzID0gc25hY2tiYXJCdXR0b24uc3R5bGU7CiAgICAgIHMuZmxvYXQgPSAncmlnaHQnOwogICAgICBzLmZvbnRXZWlnaHQgPSA2MDA7CiAgICAgIHMudGV4dFRyYW5zZm9ybSA9ICd1cHBlcmNhc2UnOwogICAgICBzLmJvcmRlckxlZnQgPSAnMXB4IHNvbGlkIGdyYXknOwogICAgICBzLnBhZGRpbmdMZWZ0ID0gJzI0cHgnOwogICAgICBzLnRleHREZWNvcmF0aW9uID0gJ25vbmUnOwogICAgICBzLmNvbG9yID0gJyM2NTZBNkInOwogICAgICBzbmFja2Jhci5hcHBlbmRDaGlsZChzbmFja2JhclRleHQpOwogICAgICBzbmFja2Jhci5hcHBlbmRDaGlsZChzbmFja2JhckJ1dHRvbik7CiAgICAgIHRoaXMub3ZlcmxheSA9IG92ZXJsYXk7CiAgICAgIHRoaXMudGV4dCA9IHRleHQ7CiAgICAgIHRoaXMuaGlkZSgpOwogICAgfQogICAgUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKHBhcmVudCkgewogICAgICBpZiAoIXBhcmVudCAmJiAhdGhpcy5vdmVybGF5LnBhcmVudEVsZW1lbnQpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMub3ZlcmxheSk7CiAgICAgIH0gZWxzZSBpZiAocGFyZW50KSB7CiAgICAgICAgaWYgKHRoaXMub3ZlcmxheS5wYXJlbnRFbGVtZW50ICYmIHRoaXMub3ZlcmxheS5wYXJlbnRFbGVtZW50ICE9IHBhcmVudCkgdGhpcy5vdmVybGF5LnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5vdmVybGF5KTsKICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5vdmVybGF5KTsKICAgICAgfQogICAgICB0aGlzLm92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgIHZhciBpbWcgPSB0aGlzLm92ZXJsYXkucXVlcnlTZWxlY3RvcignaW1nJyk7CiAgICAgIHZhciBzID0gaW1nLnN0eWxlOwogICAgICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkpIHsKICAgICAgICBzLndpZHRoID0gJzIwJSc7CiAgICAgICAgcy5tYXJnaW5MZWZ0ID0gJzQwJSc7CiAgICAgICAgcy5tYXJnaW5Ub3AgPSAnMyUnOwogICAgICB9IGVsc2UgewogICAgICAgIHMud2lkdGggPSAnNTAlJzsKICAgICAgICBzLm1hcmdpbkxlZnQgPSAnMjUlJzsKICAgICAgICBzLm1hcmdpblRvcCA9ICcyNSUnOwogICAgICB9CiAgICB9OwogICAgUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLm92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH07CiAgICBSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLnNob3dUZW1wb3JhcmlseSA9IGZ1bmN0aW9uIChtcywgcGFyZW50KSB7CiAgICAgIHRoaXMuc2hvdyhwYXJlbnQpOwogICAgICB0aGlzLnRpbWVyID0gc2V0VGltZW91dCh0aGlzLmhpZGUuYmluZCh0aGlzKSwgbXMpOwogICAgfTsKICAgIFJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuZGlzYWJsZVNob3dUZW1wb3JhcmlseSA9IGZ1bmN0aW9uICgpIHsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZXIpOwogICAgfTsKICAgIFJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmRpc2FibGVTaG93VGVtcG9yYXJpbHkoKTsKICAgICAgaWYgKCFpc0xhbmRzY2FwZU1vZGUoKSAmJiBpc01vYmlsZSgpKSB7CiAgICAgICAgdGhpcy5zaG93KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgIH0KICAgIH07CiAgICBSb3RhdGVJbnN0cnVjdGlvbnMucHJvdG90eXBlLmxvYWRJY29uXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5pY29uID0gZGF0YVVyaSgnaW1hZ2Uvc3ZnK3htbCcsIHJvdGF0ZUluc3RydWN0aW9uc0Fzc2V0KTsKICAgIH07CiAgICB2YXIgREVGQVVMVF9WSUVXRVIgPSAnQ2FyZGJvYXJkVjEnOwogICAgdmFyIFZJRVdFUl9LRVkgPSAnV0VCVlJfQ0FSREJPQVJEX1ZJRVdFUic7CiAgICB2YXIgQ0xBU1NfTkFNRSA9ICd3ZWJ2ci1wb2x5ZmlsbC12aWV3ZXItc2VsZWN0b3InOwogICAgZnVuY3Rpb24gVmlld2VyU2VsZWN0b3IoZGVmYXVsdFZpZXdlcikgewogICAgICB0cnkgewogICAgICAgIHRoaXMuc2VsZWN0ZWRLZXkgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShWSUVXRVJfS0VZKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCB2aWV3ZXIgcHJvZmlsZTogJXMnLCBlcnJvcik7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLnNlbGVjdGVkS2V5KSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZEtleSA9IGRlZmF1bHRWaWV3ZXIgfHwgREVGQVVMVF9WSUVXRVI7CiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2cgPSB0aGlzLmNyZWF0ZURpYWxvZ18oRGV2aWNlSW5mby5WaWV3ZXJzKTsKICAgICAgdGhpcy5yb290ID0gbnVsbDsKICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrc18gPSBbXTsKICAgIH0KICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKHJvb3QpIHsKICAgICAgdGhpcy5yb290ID0gcm9vdDsKICAgICAgcm9vdC5hcHBlbmRDaGlsZCh0aGlzLmRpYWxvZyk7CiAgICAgIHZhciBzZWxlY3RlZCA9IHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGhpcy5zZWxlY3RlZEtleSk7CiAgICAgIHNlbGVjdGVkLmNoZWNrZWQgPSB0cnVlOwogICAgICB0aGlzLmRpYWxvZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMucm9vdCAmJiB0aGlzLnJvb3QuY29udGFpbnModGhpcy5kaWFsb2cpKSB7CiAgICAgICAgdGhpcy5yb290LnJlbW92ZUNoaWxkKHRoaXMuZGlhbG9nKTsKICAgICAgfQogICAgICB0aGlzLmRpYWxvZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfTsKICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5nZXRDdXJyZW50Vmlld2VyID0gZnVuY3Rpb24gKCkgewogICAgICByZXR1cm4gRGV2aWNlSW5mby5WaWV3ZXJzW3RoaXMuc2VsZWN0ZWRLZXldOwogICAgfTsKICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5nZXRTZWxlY3RlZEtleV8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBpbnB1dCA9IHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9ZmllbGRdOmNoZWNrZWQnKTsKICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgcmV0dXJuIGlucHV0LmlkOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfTsKICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5vbkNoYW5nZSA9IGZ1bmN0aW9uIChjYikgewogICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXy5wdXNoKGNiKTsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuZmlyZU9uQ2hhbmdlXyA9IGZ1bmN0aW9uICh2aWV3ZXIpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFja3NfW2ldKHZpZXdlcik7CiAgICAgIH0KICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUub25TYXZlXyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5zZWxlY3RlZEtleSA9IHRoaXMuZ2V0U2VsZWN0ZWRLZXlfKCk7CiAgICAgIGlmICghdGhpcy5zZWxlY3RlZEtleSB8fCAhRGV2aWNlSW5mby5WaWV3ZXJzW3RoaXMuc2VsZWN0ZWRLZXldKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignVmlld2VyU2VsZWN0b3Iub25TYXZlXzogdGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuIScpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLmZpcmVPbkNoYW5nZV8oRGV2aWNlSW5mby5WaWV3ZXJzW3RoaXMuc2VsZWN0ZWRLZXldKTsKICAgICAgdHJ5IHsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShWSUVXRVJfS0VZLCB0aGlzLnNlbGVjdGVkS2V5KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSB2aWV3ZXIgcHJvZmlsZTogJXMnLCBlcnJvcik7CiAgICAgIH0KICAgICAgdGhpcy5oaWRlKCk7CiAgICB9OwogICAgVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmNyZWF0ZURpYWxvZ18gPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKENMQVNTX05BTUUpOwogICAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdmFyIHMgPSBvdmVybGF5LnN0eWxlOwogICAgICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKICAgICAgcy5sZWZ0ID0gMDsKICAgICAgcy50b3AgPSAwOwogICAgICBzLndpZHRoID0gJzEwMCUnOwogICAgICBzLmhlaWdodCA9ICcxMDAlJzsKICAgICAgcy5iYWNrZ3JvdW5kID0gJ3JnYmEoMCwgMCwgMCwgMC4zKSc7CiAgICAgIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhpZGUuYmluZCh0aGlzKSk7CiAgICAgIHZhciB3aWR0aCA9IDI4MDsKICAgICAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICB2YXIgcyA9IGRpYWxvZy5zdHlsZTsKICAgICAgcy5ib3hTaXppbmcgPSAnYm9yZGVyLWJveCc7CiAgICAgIHMucG9zaXRpb24gPSAnZml4ZWQnOwogICAgICBzLnRvcCA9ICcyNHB4JzsKICAgICAgcy5sZWZ0ID0gJzUwJSc7CiAgICAgIHMubWFyZ2luTGVmdCA9IC13aWR0aCAvIDIgKyAncHgnOwogICAgICBzLndpZHRoID0gd2lkdGggKyAncHgnOwogICAgICBzLnBhZGRpbmcgPSAnMjRweCc7CiAgICAgIHMub3ZlcmZsb3cgPSAnaGlkZGVuJzsKICAgICAgcy5iYWNrZ3JvdW5kID0gJyNmYWZhZmEnOwogICAgICBzLmZvbnRGYW1pbHkgPSAiJ1JvYm90bycsIHNhbnMtc2VyaWYiOwogICAgICBzLmJveFNoYWRvdyA9ICcwcHggNXB4IDIwcHggIzY2Nic7CiAgICAgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUgxXygnU2VsZWN0IHlvdXIgdmlld2VyJykpOwogICAgICBmb3IgKHZhciBpZCBpbiBvcHRpb25zKSB7CiAgICAgICAgZGlhbG9nLmFwcGVuZENoaWxkKHRoaXMuY3JlYXRlQ2hvaWNlXyhpZCwgb3B0aW9uc1tpZF0ubGFiZWwpKTsKICAgICAgfQogICAgICBkaWFsb2cuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVCdXR0b25fKCdTYXZlJywgdGhpcy5vblNhdmVfLmJpbmQodGhpcykpKTsKICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG92ZXJsYXkpOwogICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGlhbG9nKTsKICAgICAgcmV0dXJuIGNvbnRhaW5lcjsKICAgIH07CiAgICBWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlSDFfID0gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgdmFyIGgxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTsKICAgICAgdmFyIHMgPSBoMS5zdHlsZTsKICAgICAgcy5jb2xvciA9ICdibGFjayc7CiAgICAgIHMuZm9udFNpemUgPSAnMjBweCc7CiAgICAgIHMuZm9udFdlaWdodCA9ICdib2xkJzsKICAgICAgcy5tYXJnaW5Ub3AgPSAwOwogICAgICBzLm1hcmdpbkJvdHRvbSA9ICcyNHB4JzsKICAgICAgaDEuaW5uZXJIVE1MID0gbmFtZTsKICAgICAgcmV0dXJuIGgxOwogICAgfTsKICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVDaG9pY2VfID0gZnVuY3Rpb24gKGlkLCBuYW1lKSB7CiAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZGl2LnN0eWxlLm1hcmdpblRvcCA9ICc4cHgnOwogICAgICBkaXYuc3R5bGUuY29sb3IgPSAnYmxhY2snOwogICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICBpbnB1dC5zdHlsZS5mb250U2l6ZSA9ICczMHB4JzsKICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCdpZCcsIGlkKTsKICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3JhZGlvJyk7CiAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgndmFsdWUnLCBpZCk7CiAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsICdmaWVsZCcpOwogICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwogICAgICBsYWJlbC5zdHlsZS5tYXJnaW5MZWZ0ID0gJzRweCc7CiAgICAgIGxhYmVsLnNldEF0dHJpYnV0ZSgnZm9yJywgaWQpOwogICAgICBsYWJlbC5pbm5lckhUTUwgPSBuYW1lOwogICAgICBkaXYuYXBwZW5kQ2hpbGQoaW5wdXQpOwogICAgICBkaXYuYXBwZW5kQ2hpbGQobGFiZWwpOwogICAgICByZXR1cm4gZGl2OwogICAgfTsKICAgIFZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5jcmVhdGVCdXR0b25fID0gZnVuY3Rpb24gKGxhYmVsLCBvbmNsaWNrKSB7CiAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgYnV0dG9uLmlubmVySFRNTCA9IGxhYmVsOwogICAgICB2YXIgcyA9IGJ1dHRvbi5zdHlsZTsKICAgICAgcy5mbG9hdCA9ICdyaWdodCc7CiAgICAgIHMudGV4dFRyYW5zZm9ybSA9ICd1cHBlcmNhc2UnOwogICAgICBzLmNvbG9yID0gJyMxMDk0ZjcnOwogICAgICBzLmZvbnRTaXplID0gJzE0cHgnOwogICAgICBzLmxldHRlclNwYWNpbmcgPSAwOwogICAgICBzLmJvcmRlciA9IDA7CiAgICAgIHMuYmFja2dyb3VuZCA9ICdub25lJzsKICAgICAgcy5tYXJnaW5Ub3AgPSAnMTZweCc7CiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uY2xpY2spOwogICAgICByZXR1cm4gYnV0dG9uOwogICAgfTsKICAgIHZhciBjb21tb25qc0dsb2JhbCQkMSA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGNvbW1vbmpzR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGNvbW1vbmpzR2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwogICAgZnVuY3Rpb24gdW53cmFwRXhwb3J0cyQkMSAoeCkgewogICAgCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CiAgICB9CiAgICBmdW5jdGlvbiBjcmVhdGVDb21tb25qc01vZHVsZSQkMShmbiwgbW9kdWxlKSB7CiAgICAJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwogICAgfQogICAgdmFyIE5vU2xlZXAgPSBjcmVhdGVDb21tb25qc01vZHVsZSQkMShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CiAgICAoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewogICAgCW1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpOwogICAgfSkoY29tbW9uanNHbG9iYWwkJDEsIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICAgICAgICAgIChmdW5jdGlvbihtb2R1bGVzKSB7CiAgICAgICAgICAgICAJdmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTsKICAgICAgICAgICAgIAlmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7CiAgICAgICAgICAgICAJCWlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CiAgICAgICAgICAgICAJCQlyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0czsKICAgICAgICAgICAgIAkJfQogICAgICAgICAgICAgCQl2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CiAgICAgICAgICAgICAJCQlpOiBtb2R1bGVJZCwKICAgICAgICAgICAgIAkJCWw6IGZhbHNlLAogICAgICAgICAgICAgCQkJZXhwb3J0czoge30KICAgICAgICAgICAgIAkJfTsKICAgICAgICAgICAgIAkJbW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CiAgICAgICAgICAgICAJCW1vZHVsZS5sID0gdHJ1ZTsKICAgICAgICAgICAgIAkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgICAgICAgCX0KICAgICAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwogICAgICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7CiAgICAgICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7CiAgICAgICAgICAgICAJCWlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsKICAgICAgICAgICAgIAkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7CiAgICAgICAgICAgICAJCQkJY29uZmlndXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgIAkJCQllbnVtZXJhYmxlOiB0cnVlLAogICAgICAgICAgICAgCQkJCWdldDogZ2V0dGVyCiAgICAgICAgICAgICAJCQl9KTsKICAgICAgICAgICAgIAkJfQogICAgICAgICAgICAgCX07CiAgICAgICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7CiAgICAgICAgICAgICAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwogICAgICAgICAgICAgCQkJZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDoKICAgICAgICAgICAgIAkJCWZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07CiAgICAgICAgICAgICAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsKICAgICAgICAgICAgIAkJcmV0dXJuIGdldHRlcjsKICAgICAgICAgICAgIAl9OwogICAgICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTsKICAgICAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSAiIjsKICAgICAgICAgICAgIAlyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTsKICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAoWwogICAgICAgICAgKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewogICAgdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7CiAgICBmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KICAgIHZhciBtZWRpYUZpbGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEpOwogICAgdmFyIG9sZElPUyA9IHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIHBhcnNlRmxvYXQoKCcnICsgKC9DUFUuKk9TIChbMC05X117Myw0fSlbMC05X117MCwxfXwoQ1BVIGxpa2UpLipBcHBsZVdlYktpdC4qTW9iaWxlL2kuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KSB8fCBbMCwgJyddKVsxXSkucmVwbGFjZSgndW5kZWZpbmVkJywgJzNfMicpLnJlcGxhY2UoJ18nLCAnLicpLnJlcGxhY2UoJ18nLCAnJykpIDwgMTAgJiYgIXdpbmRvdy5NU1N0cmVhbTsKICAgIHZhciBOb1NsZWVwID0gZnVuY3Rpb24gKCkgewogICAgICBmdW5jdGlvbiBOb1NsZWVwKCkgewogICAgICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOb1NsZWVwKTsKICAgICAgICBpZiAob2xkSU9TKSB7CiAgICAgICAgICB0aGlzLm5vU2xlZXBUaW1lciA9IG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTsKICAgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvLnNldEF0dHJpYnV0ZSgncGxheXNpbmxpbmUnLCAnJyk7CiAgICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5zZXRBdHRyaWJ1dGUoJ3NyYycsIG1lZGlhRmlsZSk7CiAgICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5hZGRFdmVudExpc3RlbmVyKCd0aW1ldXBkYXRlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKHRoaXMubm9TbGVlcFZpZGVvLmN1cnJlbnRUaW1lID4gMC41KSB7CiAgICAgICAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uY3VycmVudFRpbWUgPSBNYXRoLnJhbmRvbSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LmJpbmQodGhpcykpOwogICAgICAgIH0KICAgICAgfQogICAgICBfY3JlYXRlQ2xhc3MoTm9TbGVlcCwgW3sKICAgICAgICBrZXk6ICdlbmFibGUnLAogICAgICAgIHZhbHVlOiBmdW5jdGlvbiBlbmFibGUoKSB7CiAgICAgICAgICBpZiAob2xkSU9TKSB7CiAgICAgICAgICAgIHRoaXMuZGlzYWJsZSgpOwogICAgICAgICAgICB0aGlzLm5vU2xlZXBUaW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnLyc7CiAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQod2luZG93LnN0b3AsIDApOwogICAgICAgICAgICB9LCAxNTAwMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5wbGF5KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAga2V5OiAnZGlzYWJsZScsCiAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2FibGUoKSB7CiAgICAgICAgICBpZiAob2xkSU9TKSB7CiAgICAgICAgICAgIGlmICh0aGlzLm5vU2xlZXBUaW1lcikgewogICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMubm9TbGVlcFRpbWVyKTsKICAgICAgICAgICAgICB0aGlzLm5vU2xlZXBUaW1lciA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvLnBhdXNlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9XSk7CiAgICAgIHJldHVybiBOb1NsZWVwOwogICAgfSgpOwogICAgbW9kdWxlLmV4cG9ydHMgPSBOb1NsZWVwOwogICAgICAgICAgfSksCiAgICAgICAgICAoZnVuY3Rpb24obW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9ICdkYXRhOnZpZGVvL21wNDtiYXNlNjQsQUFBQUlHWjBlWEJ0Y0RReUFBQUNBR2x6YjIxcGMyOHlZWFpqTVcxd05ERUFBQUFJWm5KbFpRQUFDS0J0WkdGMEFBQUM4d1lGLy8vdjNFWHB2ZWJaU0xlV0xOZ2cyU1B1NzNneU5qUWdMU0JqYjNKbElERTBNaUJ5TWpRM09TQmtaRGM1WVRZeElDMGdTQzR5TmpRdlRWQkZSeTAwSUVGV1F5QmpiMlJsWXlBdElFTnZjSGxzWldaMElESXdNRE10TWpBeE5DQXRJR2gwZEhBNkx5OTNkM2N1ZG1sa1pXOXNZVzR1YjNKbkwzZ3lOalF1YUhSdGJDQXRJRzl3ZEdsdmJuTTZJR05oWW1GalBURWdjbVZtUFRFZ1pHVmliRzlqYXoweE9qQTZNQ0JoYm1Gc2VYTmxQVEI0TVRvd2VERXhNU0J0WlQxb1pYZ2djM1ZpYldVOU1pQndjM2s5TVNCd2MzbGZjbVE5TVM0d01Eb3dMakF3SUcxcGVHVmtYM0psWmowd0lHMWxYM0poYm1kbFBURTJJR05vY205dFlWOXRaVDB4SUhSeVpXeHNhWE05TUNBNGVEaGtZM1E5TUNCamNXMDlNQ0JrWldGa2VtOXVaVDB5TVN3eE1TQm1ZWE4wWDNCemEybHdQVEVnWTJoeWIyMWhYM0Z3WDI5bVpuTmxkRDB3SUhSb2NtVmhaSE05TmlCc2IyOXJZV2hsWVdSZmRHaHlaV0ZrY3oweElITnNhV05sWkY5MGFISmxZV1J6UFRBZ2JuSTlNQ0JrWldOcGJXRjBaVDB4SUdsdWRHVnliR0ZqWldROU1DQmliSFZ5WVhsZlkyOXRjR0YwUFRBZ1kyOXVjM1J5WVdsdVpXUmZhVzUwY21FOU1DQmlabkpoYldWelBUTWdZbDl3ZVhKaGJXbGtQVElnWWw5aFpHRndkRDB4SUdKZlltbGhjejB3SUdScGNtVmpkRDB4SUhkbGFXZG9kR0k5TVNCdmNHVnVYMmR2Y0Qwd0lIZGxhV2RvZEhBOU1TQnJaWGxwYm5ROU16QXdJR3RsZVdsdWRGOXRhVzQ5TXpBZ2MyTmxibVZqZFhROU5EQWdhVzUwY21GZmNtVm1jbVZ6YUQwd0lISmpYMnh2YjJ0aGFHVmhaRDB4TUNCeVl6MWpjbVlnYldKMGNtVmxQVEVnWTNKbVBUSXdMakFnY1dOdmJYQTlNQzQyTUNCeGNHMXBiajB3SUhGd2JXRjRQVFk1SUhGd2MzUmxjRDAwSUhaaWRsOXRZWGh5WVhSbFBUSXdNREF3SUhaaWRsOWlkV1p6YVhwbFBUSTFNREF3SUdOeVpsOXRZWGc5TUM0d0lHNWhiRjlvY21ROWJtOXVaU0JtYVd4c1pYSTlNQ0JwY0Y5eVlYUnBiejB4TGpRd0lHRnhQVEU2TVM0d01BQ0FBQUFBT1dXSWhBQTMvL3ArQzd2OHRERFNUamY5N3c1NWkzU2JSUE80WlkraGtqRDVoYmtBa0wzenBKNmgvTFIxQ0FBQnpnQjFrcXF6VW9ybGhRQUFBQXhCbWlRWWhuLytxWllBRExnQUFBQUpRWjVDUWhYL0FBajVJUUFEUUdnY0lRQURRR2djQUFBQUNRR2VZVVFuL3dBTEtDRUFBMEJvSEFBQUFBa0JubU5FSi84QUN5a2hBQU5BYUJ3aEFBTkFhQndBQUFBTlFacG9ORXhEUC82cGxnQU11U0VBQTBCb0hBQUFBQXRCbm9aRkVTd3Ivd0FJK1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbnFWRUovOEFDeWtoQUFOQWFCd0FBQUFKQVo2blJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFEVUdhckRSTVF6LytxWllBRExnaEFBTkFhQndBQUFBTFFaN0tSUlVzSy84QUNQa2hBQU5BYUJ3QUFBQUpBWjdwUkNmL0FBc29JUUFEUUdnY0lRQURRR2djQUFBQUNRR2U2MFFuL3dBTEtDRUFBMEJvSEFBQUFBMUJtdkEwVEVNLy9xbVdBQXk1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDMEdmRGtVVkxDdi9BQWo1SVFBRFFHZ2NBQUFBQ1FHZkxVUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbnk5RUovOEFDeWdoQUFOQWFCd0FBQUFOUVpzME5FeERQLzZwbGdBTXVDRUFBMEJvSEFBQUFBdEJuMUpGRlN3ci93QUkrU0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuM0ZFSi84QUN5Z2hBQU5BYUJ3QUFBQUpBWjl6UkNmL0FBc29JUUFEUUdnY0lRQURRR2djQUFBQURVR2JlRFJNUXovK3FaWUFETGtoQUFOQWFCd0FBQUFMUVorV1JSVXNLLzhBQ1BnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVorMVJDZi9BQXNwSVFBRFFHZ2NBQUFBQ1FHZnQwUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQTFCbTd3MFRFTS8vcW1XQUF5NElRQURRR2djQUFBQUMwR2Yya1VWTEN2L0FBajVJUUFEUUdnY0FBQUFDUUdmK1VRbi93QUxLQ0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuL3RFSi84QUN5a2hBQU5BYUJ3QUFBQU5RWnZnTkV4RFAvNnBsZ0FNdVNFQUEwQm9IQ0VBQTBCb0hBQUFBQXRCbmg1RkZTd3Ivd0FJK0NFQUEwQm9IQUFBQUFrQm5qMUVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVo0L1JDZi9BQXNwSVFBRFFHZ2NBQUFBRFVHYUpEUk1Rei8rcVpZQURMZ2hBQU5BYUJ3QUFBQUxRWjVDUlJVc0svOEFDUGtoQUFOQWFCd2hBQU5BYUJ3QUFBQUpBWjVoUkNmL0FBc29JUUFEUUdnY0FBQUFDUUdlWTBRbi93QUxLU0VBQTBCb0hDRUFBMEJvSEFBQUFBMUJtbWcwVEVNLy9xbVdBQXk1SVFBRFFHZ2NBQUFBQzBHZWhrVVZMQ3YvQUFqNUlRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZXBVUW4vd0FMS1NFQUEwQm9IQUFBQUFrQm5xZEVKLzhBQ3lnaEFBTkFhQndBQUFBTlFacXNORXhEUC82cGxnQU11Q0VBQTBCb0hDRUFBMEJvSEFBQUFBdEJuc3BGRlN3ci93QUkrU0VBQTBCb0hBQUFBQWtCbnVsRUovOEFDeWdoQUFOQWFCd2hBQU5BYUJ3QUFBQUpBWjdyUkNmL0FBc29JUUFEUUdnY0FBQUFEVUdhOERSTVF6LytxWllBRExraEFBTkFhQndoQUFOQWFCd0FBQUFMUVo4T1JSVXNLLzhBQ1BraEFBTkFhQndBQUFBSkFaOHRSQ2YvQUFzcElRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZkwwUW4vd0FMS0NFQUEwQm9IQUFBQUExQm16UTBURU0vL3FtV0FBeTRJUUFEUUdnY0FBQUFDMEdmVWtVVkxDdi9BQWo1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdmY1VRbi93QUxLQ0VBQTBCb0hBQUFBQWtCbjNORUovOEFDeWdoQUFOQWFCd2hBQU5BYUJ3QUFBQU5RWnQ0TkV4Qy8vNnBsZ0FNdVNFQUEwQm9IQUFBQUF0Qm41WkZGU3dyL3dBSStDRUFBMEJvSENFQUEwQm9IQUFBQUFrQm43VkVKLzhBQ3lraEFBTkFhQndBQUFBSkFaKzNSQ2YvQUFzcElRQURRR2djQUFBQURVR2J1elJNUW4vK25oQUFZc0FoQUFOQWFCd2hBQU5BYUJ3QUFBQUpRWi9hUWhQL0FBc3BJUUFEUUdnY0FBQUFDUUdmK1VRbi93QUxLQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQUFBQ2lGdGIyOTJBQUFBYkcxMmFHUUFBQUFBMVlDQ1g5V0FnbDhBQUFQb0FBQUgvQUFCQUFBQkFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQURBQUFBR0dsdlpITUFBQUFBRUlDQWdBY0FULy8vL3Y3L0FBQUYrWFJ5WVdzQUFBQmNkR3RvWkFBQUFBUFZnSUpmMVlDQ1h3QUFBQUVBQUFBQUFBQUgwQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUF5Z0FBQU1vQUFBQUFBQ1JsWkhSekFBQUFIR1ZzYzNRQUFBQUFBQUFBQVFBQUI5QUFBQmR3QUFFQUFBQUFCWEZ0WkdsaEFBQUFJRzFrYUdRQUFBQUExWUNDWDlXQWdsOEFBVitRQUFLL0lGWEVBQUFBQUFBdGFHUnNjZ0FBQUFBQUFBQUFkbWxrWlFBQUFBQUFBQUFBQUFBQUFGWnBaR1Z2U0dGdVpHeGxjZ0FBQUFVY2JXbHVaZ0FBQUJSMmJXaGtBQUFBQVFBQUFBQUFBQUFBQUFBQUpHUnBibVlBQUFBY1pISmxaZ0FBQUFBQUFBQUJBQUFBREhWeWJDQUFBQUFCQUFBRTNITjBZbXdBQUFDWWMzUnpaQUFBQUFBQUFBQUJBQUFBaUdGMll6RUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQXlnREtBRWdBQUFCSUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFZLy84QUFBQXlZWFpqUXdGTlFDai80UUFiWjAxQUtPeWhvM3lTVFVCQVFGQUFBQU1BRUFBcjhnRHhneGxnQVFBRWFPK0c4Z0FBQUJoemRIUnpBQUFBQUFBQUFBRUFBQUE4QUFBTHVBQUFBQlJ6ZEhOekFBQUFBQUFBQUFFQUFBQUJBQUFCOEdOMGRITUFBQUFBQUFBQVBBQUFBQUVBQUJkd0FBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBRHFZQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUFFQUFBdTRBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBQzdnQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUJ4emRITmpBQUFBQUFBQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFFRWMzUnplZ0FBQUFBQUFBQUFBQUFBUEFBQUF6UUFBQUFRQUFBQURRQUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQVBBQUFBRFFBQUFBMEFBQUFSQUFBQUR3QUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBTkFBQUFEUUFBQVFCemRHTnZBQUFBQUFBQUFEd0FBQUF3QUFBRFpBQUFBM1FBQUFPTkFBQURvQUFBQTdrQUFBUFFBQUFENndBQUEvNEFBQVFYQUFBRUxnQUFCRU1BQUFSY0FBQUVid0FBQkl3QUFBU2hBQUFFdWdBQUJNMEFBQVRrQUFBRS93QUFCUklBQUFVckFBQUZRZ0FBQlYwQUFBVndBQUFGaVFBQUJhQUFBQVcxQUFBRnpnQUFCZUVBQUFYK0FBQUdFd0FBQml3QUFBWS9BQUFHVmdBQUJuRUFBQWFFQUFBR25RQUFCclFBQUFiUEFBQUc0Z0FBQnZVQUFBY1NBQUFISndBQUIwQUFBQWRUQUFBSGNBQUFCNFVBQUFlZUFBQUhzUUFBQjhnQUFBZmpBQUFIOWdBQUNBOEFBQWdtQUFBSVFRQUFDRlFBQUFobkFBQUloQUFBQ0pjQUFBTXNkSEpoYXdBQUFGeDBhMmhrQUFBQUE5V0FnbC9WZ0lKZkFBQUFBZ0FBQUFBQUFBZjhBQUFBQUFBQUFBQUFBQUFCQVFBQUFBQUJBQUFBQUFBQUFBQUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUNzbTFrYVdFQUFBQWdiV1JvWkFBQUFBRFZnSUpmMVlDQ1h3QUFyRVFBQVdBQVZjUUFBQUFBQUNkb1pHeHlBQUFBQUFBQUFBQnpiM1Z1QUFBQUFBQUFBQUFBQUFBQVUzUmxjbVZ2QUFBQUFtTnRhVzVtQUFBQUVITnRhR1FBQUFBQUFBQUFBQUFBQUNSa2FXNW1BQUFBSEdSeVpXWUFBQUFBQUFBQUFRQUFBQXgxY213Z0FBQUFBUUFBQWlkemRHSnNBQUFBWjNOMGMyUUFBQUFBQUFBQUFRQUFBRmR0Y0RSaEFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQ0FCQUFBQUFBckVRQUFBQUFBRE5sYzJSekFBQUFBQU9BZ0lBaUFBSUFCSUNBZ0JSQUZRQUFBQUFERFVBQUFBQUFCWUNBZ0FJU0VBYUFnSUFCQWdBQUFCaHpkSFJ6QUFBQUFBQUFBQUVBQUFCWUFBQUVBQUFBQUJ4emRITmpBQUFBQUFBQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFBVWMzUnplZ0FBQUFBQUFBQUdBQUFBV0FBQUFYQnpkR052QUFBQUFBQUFBRmdBQUFPQkFBQURod0FBQTVvQUFBT3RBQUFEc3dBQUE4b0FBQVBmQUFBRDVRQUFBL2dBQUFRTEFBQUVFUUFBQkNnQUFBUTlBQUFFVUFBQUJGWUFBQVJwQUFBRWdBQUFCSVlBQUFTYkFBQUVyZ0FBQkxRQUFBVEhBQUFFM2dBQUJQTUFBQVQ1QUFBRkRBQUFCUjhBQUFVbEFBQUZQQUFBQlZFQUFBVlhBQUFGYWdBQUJYMEFBQVdEQUFBRm1nQUFCYThBQUFYQ0FBQUZ5QUFBQmRzQUFBWHlBQUFGK0FBQUJnMEFBQVlnQUFBR0pnQUFCamtBQUFaUUFBQUdaUUFBQm1zQUFBWitBQUFHa1FBQUJwY0FBQWF1QUFBR3d3QUFCc2tBQUFiY0FBQUc3d0FBQndZQUFBY01BQUFISVFBQUJ6UUFBQWM2QUFBSFRRQUFCMlFBQUFkcUFBQUhmd0FBQjVJQUFBZVlBQUFIcXdBQUI4SUFBQWZYQUFBSDNRQUFCL0FBQUFnREFBQUlDUUFBQ0NBQUFBZzFBQUFJT3dBQUNFNEFBQWhoQUFBSWVBQUFDSDRBQUFpUkFBQUlwQUFBQ0tvQUFBaXdBQUFJdGdBQUNMd0FBQWpDQUFBQUZuVmtkR0VBQUFBT2JtRnRaVk4wWlhKbGJ3QUFBSEIxWkhSaEFBQUFhRzFsZEdFQUFBQUFBQUFBSVdoa2JISUFBQUFBQUFBQUFHMWthWEpoY0hCc0FBQUFBQUFBQUFBQUFBQUFPMmxzYzNRQUFBQXpxWFJ2YndBQUFDdGtZWFJoQUFBQUFRQUFBQUJJWVc1a1FuSmhhMlVnTUM0eE1DNHlJREl3TVRVd05qRXhNREE9JzsKICAgICAgICAgIH0pCiAgICAgICAgICAgICBdKTsKICAgIH0pOwogICAgfSk7CiAgICB2YXIgTm9TbGVlcCQxID0gdW53cmFwRXhwb3J0cyQkMShOb1NsZWVwKTsKICAgIHZhciBuZXh0RGlzcGxheUlkID0gMTAwMDsKICAgIHZhciBkZWZhdWx0TGVmdEJvdW5kcyA9IFswLCAwLCAwLjUsIDFdOwogICAgdmFyIGRlZmF1bHRSaWdodEJvdW5kcyA9IFswLjUsIDAsIDAuNSwgMV07CiAgICB2YXIgcmFmID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsKICAgIHZhciBjYWYgPSB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWU7CiAgICBmdW5jdGlvbiBWUkZyYW1lRGF0YSgpIHsKICAgICAgdGhpcy5sZWZ0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICB0aGlzLmxlZnRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgIHRoaXMucmlnaHRQcm9qZWN0aW9uTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgIHRoaXMucmlnaHRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgIHRoaXMucG9zZSA9IG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiBWUkRpc3BsYXlDYXBhYmlsaXRpZXMoY29uZmlnKSB7CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHsKICAgICAgICBoYXNQb3NpdGlvbjogewogICAgICAgICAgd3JpdGFibGU6IGZhbHNlLCBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogY29uZmlnLmhhc1Bvc2l0aW9uCiAgICAgICAgfSwKICAgICAgICBoYXNFeHRlcm5hbERpc3BsYXk6IHsKICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5oYXNFeHRlcm5hbERpc3BsYXkKICAgICAgICB9LAogICAgICAgIGNhblByZXNlbnQ6IHsKICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5jYW5QcmVzZW50CiAgICAgICAgfSwKICAgICAgICBtYXhMYXllcnM6IHsKICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5tYXhMYXllcnMKICAgICAgICB9LAogICAgICAgIGhhc09yaWVudGF0aW9uOiB7CiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5oYXNPcmllbnRhdGlvbicsICdWUkRpc3BsYXkucHJvdG90eXBlLmdldEZyYW1lRGF0YScpOwogICAgICAgICAgICByZXR1cm4gY29uZmlnLmhhc09yaWVudGF0aW9uOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBWUkRpc3BsYXkoY29uZmlnKSB7CiAgICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTsKICAgICAgdmFyIFVTRV9XQUtFTE9DSyA9ICd3YWtlbG9jaycgaW4gY29uZmlnID8gY29uZmlnLndha2Vsb2NrIDogdHJ1ZTsKICAgICAgdGhpcy5pc1BvbHlmaWxsZWQgPSB0cnVlOwogICAgICB0aGlzLmRpc3BsYXlJZCA9IG5leHREaXNwbGF5SWQrKzsKICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9ICcnOwogICAgICB0aGlzLmRlcHRoTmVhciA9IDAuMDE7CiAgICAgIHRoaXMuZGVwdGhGYXIgPSAxMDAwMC4wOwogICAgICB0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2lzQ29ubmVjdGVkJywgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5pc0Nvbm5lY3RlZCcsICdWUkRpc3BsYXlDYXBhYmlsaXRpZXMucHJvdG90eXBlLmhhc0V4dGVybmFsRGlzcGxheScpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMuY2FwYWJpbGl0aWVzID0gbmV3IFZSRGlzcGxheUNhcGFiaWxpdGllcyh7CiAgICAgICAgaGFzUG9zaXRpb246IGZhbHNlLAogICAgICAgIGhhc09yaWVudGF0aW9uOiBmYWxzZSwKICAgICAgICBoYXNFeHRlcm5hbERpc3BsYXk6IGZhbHNlLAogICAgICAgIGNhblByZXNlbnQ6IGZhbHNlLAogICAgICAgIG1heExheWVyczogMQogICAgICB9KTsKICAgICAgdGhpcy5zdGFnZVBhcmFtZXRlcnMgPSBudWxsOwogICAgICB0aGlzLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwogICAgICB0aGlzLmxheWVyXyA9IG51bGw7CiAgICAgIHRoaXMub3JpZ2luYWxQYXJlbnRfID0gbnVsbDsKICAgICAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXyA9IG51bGw7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5DaGFuZ2VIYW5kbGVyXyA9IG51bGw7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVycm9ySGFuZGxlcl8gPSBudWxsOwogICAgICBpZiAoVVNFX1dBS0VMT0NLICYmIGlzTW9iaWxlKCkpIHsKICAgICAgICB0aGlzLndha2Vsb2NrXyA9IG5ldyBOb1NsZWVwJDEoKTsKICAgICAgfQogICAgfQogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEgPSBmdW5jdGlvbiAoZnJhbWVEYXRhKSB7CiAgICAgIHJldHVybiBmcmFtZURhdGFGcm9tUG9zZShmcmFtZURhdGEsIHRoaXMuX2dldFBvc2UoKSwgdGhpcyk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRQb3NlID0gZnVuY3Rpb24gKCkgewogICAgICBkZXByZWNhdGVXYXJuaW5nKCdWUkRpc3BsYXkucHJvdG90eXBlLmdldFBvc2UnLCAnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEnKTsKICAgICAgcmV0dXJuIHRoaXMuX2dldFBvc2UoKTsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLnJlc2V0UG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5yZXNldFBvc2UnKTsKICAgICAgcmV0dXJuIHRoaXMuX3Jlc2V0UG9zZSgpOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZ2V0SW1tZWRpYXRlUG9zZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRJbW1lZGlhdGVQb3NlJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CiAgICAgIHJldHVybiB0aGlzLl9nZXRQb3NlKCk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgcmV0dXJuIHJhZihjYWxsYmFjayk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChpZCkgewogICAgICByZXR1cm4gY2FmKGlkKTsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLndyYXBGb3JGdWxsc2NyZWVuID0gZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgaWYgKGlzSU9TKCkpIHsKICAgICAgICByZXR1cm4gZWxlbWVudDsKICAgICAgfQogICAgICBpZiAoIXRoaXMuZnVsbHNjcmVlbldyYXBwZXJfKSB7CiAgICAgICAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB2YXIgY3NzUHJvcGVydGllcyA9IFsnaGVpZ2h0OiAnICsgTWF0aC5taW4oc2NyZWVuLmhlaWdodCwgc2NyZWVuLndpZHRoKSArICdweCAhaW1wb3J0YW50JywgJ3RvcDogMCAhaW1wb3J0YW50JywgJ2xlZnQ6IDAgIWltcG9ydGFudCcsICdyaWdodDogMCAhaW1wb3J0YW50JywgJ2JvcmRlcjogMCcsICdtYXJnaW46IDAnLCAncGFkZGluZzogMCcsICd6LWluZGV4OiA5OTk5OTkgIWltcG9ydGFudCcsICdwb3NpdGlvbjogZml4ZWQnXTsKICAgICAgICB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgY3NzUHJvcGVydGllcy5qb2luKCc7ICcpICsgJzsnKTsKICAgICAgICB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXy5jbGFzc0xpc3QuYWRkKCd3ZWJ2ci1wb2x5ZmlsbC1mdWxsc2NyZWVuLXdyYXBwZXInKTsKICAgICAgfQogICAgICBpZiAodGhpcy5mdWxsc2NyZWVuRWxlbWVudF8gPT0gZWxlbWVudCkgewogICAgICAgIHJldHVybiB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXzsKICAgICAgfQogICAgICBpZiAodGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pIHsKICAgICAgICBpZiAodGhpcy5vcmlnaW5hbFBhcmVudF8pIHsKICAgICAgICAgIHRoaXMub3JpZ2luYWxQYXJlbnRfLmFwcGVuZENoaWxkKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8ucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Xyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfID0gZWxlbWVudDsKICAgICAgdGhpcy5vcmlnaW5hbFBhcmVudF8gPSBlbGVtZW50LnBhcmVudEVsZW1lbnQ7CiAgICAgIGlmICghdGhpcy5vcmlnaW5hbFBhcmVudF8pIHsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICB9CiAgICAgIGlmICghdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8ucGFyZW50RWxlbWVudCkgewogICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Xy5wYXJlbnRFbGVtZW50OwogICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUodGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8sIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRfKTsKICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pOwogICAgICB9CiAgICAgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLmluc2VydEJlZm9yZSh0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XywgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8uZmlyc3RDaGlsZCk7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8gPSB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Xy5nZXRBdHRyaWJ1dGUoJ3N0eWxlJyk7CiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgZnVuY3Rpb24gYXBwbHlGdWxsc2NyZWVuRWxlbWVudFN0eWxlKCkgewogICAgICAgIGlmICghc2VsZi5mdWxsc2NyZWVuRWxlbWVudF8pIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGNzc1Byb3BlcnRpZXMgPSBbJ3Bvc2l0aW9uOiBhYnNvbHV0ZScsICd0b3A6IDAnLCAnbGVmdDogMCcsICd3aWR0aDogJyArIE1hdGgubWF4KHNjcmVlbi53aWR0aCwgc2NyZWVuLmhlaWdodCkgKyAncHgnLCAnaGVpZ2h0OiAnICsgTWF0aC5taW4oc2NyZWVuLmhlaWdodCwgc2NyZWVuLndpZHRoKSArICdweCcsICdib3JkZXI6IDAnLCAnbWFyZ2luOiAwJywgJ3BhZGRpbmc6IDAnXTsKICAgICAgICBzZWxmLmZ1bGxzY3JlZW5FbGVtZW50Xy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgY3NzUHJvcGVydGllcy5qb2luKCc7ICcpICsgJzsnKTsKICAgICAgfQogICAgICBhcHBseUZ1bGxzY3JlZW5FbGVtZW50U3R5bGUoKTsKICAgICAgcmV0dXJuIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUucmVtb3ZlRnVsbHNjcmVlbldyYXBwZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XzsKICAgICAgaWYgKHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8pIHsKICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnc3R5bGUnKTsKICAgICAgfQogICAgICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XyA9IG51bGw7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVsZW1lbnRDYWNoZWRTdHlsZV8gPSBudWxsOwogICAgICB2YXIgcGFyZW50ID0gdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8ucGFyZW50RWxlbWVudDsKICAgICAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8ucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CiAgICAgIGlmICh0aGlzLm9yaWdpbmFsUGFyZW50XyA9PT0gcGFyZW50KSB7CiAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShlbGVtZW50LCB0aGlzLmZ1bGxzY3JlZW5XcmFwcGVyXyk7CiAgICAgIH0KICAgICAgZWxzZSBpZiAodGhpcy5vcmlnaW5hbFBhcmVudF8pIHsKICAgICAgICAgIHRoaXMub3JpZ2luYWxQYXJlbnRfLmFwcGVuZENoaWxkKGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfKTsKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0UHJlc2VudCA9IGZ1bmN0aW9uIChsYXllcnMpIHsKICAgICAgdmFyIHdhc1ByZXNlbnRpbmcgPSB0aGlzLmlzUHJlc2VudGluZzsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICBpZiAoIShsYXllcnMgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICBkZXByZWNhdGVXYXJuaW5nKCdWUkRpc3BsYXkucHJvdG90eXBlLnJlcXVlc3RQcmVzZW50IHdpdGggbm9uLWFycmF5IGFyZ3VtZW50JywgJ2FuIGFycmF5IG9mIFZSTGF5ZXJzIGFzIHRoZSBmaXJzdCBhcmd1bWVudCcpOwogICAgICAgIGxheWVycyA9IFtsYXllcnNdOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKCFzZWxmLmNhcGFiaWxpdGllcy5jYW5QcmVzZW50KSB7CiAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdWUkRpc3BsYXkgaXMgbm90IGNhcGFibGUgb2YgcHJlc2VudGluZy4nKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChsYXllcnMubGVuZ3RoID09IDAgfHwgbGF5ZXJzLmxlbmd0aCA+IHNlbGYuY2FwYWJpbGl0aWVzLm1heExheWVycykgewogICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignSW52YWxpZCBudW1iZXIgb2YgbGF5ZXJzLicpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGluY29taW5nTGF5ZXIgPSBsYXllcnNbMF07CiAgICAgICAgaWYgKCFpbmNvbWluZ0xheWVyLnNvdXJjZSkgewogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB2YXIgbGVmdEJvdW5kcyA9IGluY29taW5nTGF5ZXIubGVmdEJvdW5kcyB8fCBkZWZhdWx0TGVmdEJvdW5kczsKICAgICAgICB2YXIgcmlnaHRCb3VuZHMgPSBpbmNvbWluZ0xheWVyLnJpZ2h0Qm91bmRzIHx8IGRlZmF1bHRSaWdodEJvdW5kczsKICAgICAgICBpZiAod2FzUHJlc2VudGluZykgewogICAgICAgICAgdmFyIGxheWVyID0gc2VsZi5sYXllcl87CiAgICAgICAgICBpZiAobGF5ZXIuc291cmNlICE9PSBpbmNvbWluZ0xheWVyLnNvdXJjZSkgewogICAgICAgICAgICBsYXllci5zb3VyY2UgPSBpbmNvbWluZ0xheWVyLnNvdXJjZTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIGxheWVyLmxlZnRCb3VuZHNbaV0gPSBsZWZ0Qm91bmRzW2ldOwogICAgICAgICAgICBsYXllci5yaWdodEJvdW5kc1tpXSA9IHJpZ2h0Qm91bmRzW2ldOwogICAgICAgICAgfQogICAgICAgICAgc2VsZi53cmFwRm9yRnVsbHNjcmVlbihzZWxmLmxheWVyXy5zb3VyY2UpOwogICAgICAgICAgc2VsZi51cGRhdGVQcmVzZW50XygpOwogICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzZWxmLmxheWVyXyA9IHsKICAgICAgICAgIHByZWRpc3RvcnRlZDogaW5jb21pbmdMYXllci5wcmVkaXN0b3J0ZWQsCiAgICAgICAgICBzb3VyY2U6IGluY29taW5nTGF5ZXIuc291cmNlLAogICAgICAgICAgbGVmdEJvdW5kczogbGVmdEJvdW5kcy5zbGljZSgwKSwKICAgICAgICAgIHJpZ2h0Qm91bmRzOiByaWdodEJvdW5kcy5zbGljZSgwKQogICAgICAgIH07CiAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSBmYWxzZTsKICAgICAgICBpZiAoc2VsZi5sYXllcl8gJiYgc2VsZi5sYXllcl8uc291cmNlKSB7CiAgICAgICAgICB2YXIgZnVsbHNjcmVlbkVsZW1lbnQgPSBzZWxmLndyYXBGb3JGdWxsc2NyZWVuKHNlbGYubGF5ZXJfLnNvdXJjZSk7CiAgICAgICAgICB2YXIgb25GdWxsc2NyZWVuQ2hhbmdlID0gZnVuY3Rpb24gb25GdWxsc2NyZWVuQ2hhbmdlKCkgewogICAgICAgICAgICB2YXIgYWN0dWFsRnVsbHNjcmVlbkVsZW1lbnQgPSBnZXRGdWxsc2NyZWVuRWxlbWVudCgpOwogICAgICAgICAgICBzZWxmLmlzUHJlc2VudGluZyA9IGZ1bGxzY3JlZW5FbGVtZW50ID09PSBhY3R1YWxGdWxsc2NyZWVuRWxlbWVudDsKICAgICAgICAgICAgaWYgKHNlbGYuaXNQcmVzZW50aW5nKSB7CiAgICAgICAgICAgICAgaWYgKHNjcmVlbi5vcmllbnRhdGlvbiAmJiBzY3JlZW4ub3JpZW50YXRpb24ubG9jaykgewogICAgICAgICAgICAgICAgc2NyZWVuLm9yaWVudGF0aW9uLmxvY2soJ2xhbmRzY2FwZS1wcmltYXJ5JykuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3NjcmVlbi5vcmllbnRhdGlvbi5sb2NrKCkgZmFpbGVkIGR1ZSB0bycsIGVycm9yLm1lc3NhZ2UpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNlbGYud2FpdGluZ0ZvclByZXNlbnRfID0gZmFsc2U7CiAgICAgICAgICAgICAgc2VsZi5iZWdpblByZXNlbnRfKCk7CiAgICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLnVubG9jaykgewogICAgICAgICAgICAgICAgc2NyZWVuLm9yaWVudGF0aW9uLnVubG9jaygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyKCk7CiAgICAgICAgICAgICAgc2VsZi5kaXNhYmxlV2FrZUxvY2soKTsKICAgICAgICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CiAgICAgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbGYuZmlyZVZSRGlzcGxheVByZXNlbnRDaGFuZ2VfKCk7CiAgICAgICAgICB9OwogICAgICAgICAgdmFyIG9uRnVsbHNjcmVlbkVycm9yID0gZnVuY3Rpb24gb25GdWxsc2NyZWVuRXJyb3IoKSB7CiAgICAgICAgICAgIGlmICghc2VsZi53YWl0aW5nRm9yUHJlc2VudF8pIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwogICAgICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfKCk7CiAgICAgICAgICAgIHNlbGYuZGlzYWJsZVdha2VMb2NrKCk7CiAgICAgICAgICAgIHNlbGYud2FpdGluZ0ZvclByZXNlbnRfID0gZmFsc2U7CiAgICAgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gZmFsc2U7CiAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1VuYWJsZSB0byBwcmVzZW50LicpKTsKICAgICAgICAgIH07CiAgICAgICAgICBzZWxmLmFkZEZ1bGxzY3JlZW5MaXN0ZW5lcnNfKGZ1bGxzY3JlZW5FbGVtZW50LCBvbkZ1bGxzY3JlZW5DaGFuZ2UsIG9uRnVsbHNjcmVlbkVycm9yKTsKICAgICAgICAgIGlmIChyZXF1ZXN0RnVsbHNjcmVlbihmdWxsc2NyZWVuRWxlbWVudCkpIHsKICAgICAgICAgICAgc2VsZi5lbmFibGVXYWtlTG9jaygpOwogICAgICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzSU9TKCkgfHwgaXNXZWJWaWV3QW5kcm9pZCgpKSB7CiAgICAgICAgICAgIHNlbGYuZW5hYmxlV2FrZUxvY2soKTsKICAgICAgICAgICAgc2VsZi5pc1ByZXNlbnRpbmcgPSB0cnVlOwogICAgICAgICAgICBzZWxmLmJlZ2luUHJlc2VudF8oKTsKICAgICAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKICAgICAgICAgICAgcmVzb2x2ZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIXNlbGYud2FpdGluZ0ZvclByZXNlbnRfICYmICFpc0lPUygpKSB7CiAgICAgICAgICBleGl0RnVsbHNjcmVlbigpOwogICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignVW5hYmxlIHRvIHByZXNlbnQuJykpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5leGl0UHJlc2VudCA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHdhc1ByZXNlbnRpbmcgPSB0aGlzLmlzUHJlc2VudGluZzsKICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICB0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwogICAgICB0aGlzLmxheWVyXyA9IG51bGw7CiAgICAgIHRoaXMuZGlzYWJsZVdha2VMb2NrKCk7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKHdhc1ByZXNlbnRpbmcpIHsKICAgICAgICAgIGlmICghZXhpdEZ1bGxzY3JlZW4oKSAmJiBpc0lPUygpKSB7CiAgICAgICAgICAgIHNlbGYuZW5kUHJlc2VudF8oKTsKICAgICAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc1dlYlZpZXdBbmRyb2lkKCkpIHsKICAgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwogICAgICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfKCk7CiAgICAgICAgICAgIHNlbGYuZW5kUHJlc2VudF8oKTsKICAgICAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignV2FzIG5vdCBwcmVzZW50aW5nIHRvIFZSRGlzcGxheS4nKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmdldExheWVycyA9IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHRoaXMubGF5ZXJfKSB7CiAgICAgICAgcmV0dXJuIFt0aGlzLmxheWVyX107CiAgICAgIH0KICAgICAgcmV0dXJuIFtdOwogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZmlyZVZSRGlzcGxheVByZXNlbnRDaGFuZ2VfID0gZnVuY3Rpb24gKCkgewogICAgICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CiAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlDb25uZWN0XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCd2cmRpc3BsYXljb25uZWN0JywgeyBkZXRhaWw6IHsgZGlzcGxheTogdGhpcyB9IH0pOwogICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5hZGRGdWxsc2NyZWVuTGlzdGVuZXJzXyA9IGZ1bmN0aW9uIChlbGVtZW50LCBjaGFuZ2VIYW5kbGVyLCBlcnJvckhhbmRsZXIpIHsKICAgICAgdGhpcy5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBlbGVtZW50OwogICAgICB0aGlzLmZ1bGxzY3JlZW5DaGFuZ2VIYW5kbGVyXyA9IGNoYW5nZUhhbmRsZXI7CiAgICAgIHRoaXMuZnVsbHNjcmVlbkVycm9ySGFuZGxlcl8gPSBlcnJvckhhbmRsZXI7CiAgICAgIGlmIChjaGFuZ2VIYW5kbGVyKSB7CiAgICAgICAgaWYgKGRvY3VtZW50LmZ1bGxzY3JlZW5FbmFibGVkKSB7CiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwogICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubW96RnVsbFNjcmVlbkVuYWJsZWQpIHsKICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tc0Z1bGxzY3JlZW5FbmFibGVkKSB7CiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGVycm9ySGFuZGxlcikgewogICAgICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbmFibGVkKSB7CiAgICAgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubW96RnVsbFNjcmVlbkVuYWJsZWQpIHsKICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNGdWxsc2NyZWVuRW5hYmxlZCkgewogICAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfKSByZXR1cm47CiAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfOwogICAgICBpZiAodGhpcy5mdWxsc2NyZWVuQ2hhbmdlSGFuZGxlcl8pIHsKICAgICAgICB2YXIgY2hhbmdlSGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfOwogICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKICAgICAgfQogICAgICBpZiAodGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXykgewogICAgICAgIHZhciBlcnJvckhhbmRsZXIgPSB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfOwogICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CiAgICAgIH0KICAgICAgdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfID0gbnVsbDsKICAgICAgdGhpcy5mdWxsc2NyZWVuQ2hhbmdlSGFuZGxlcl8gPSBudWxsOwogICAgICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmVuYWJsZVdha2VMb2NrID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy53YWtlbG9ja18pIHsKICAgICAgICB0aGlzLndha2Vsb2NrXy5lbmFibGUoKTsKICAgICAgfQogICAgfTsKICAgIFZSRGlzcGxheS5wcm90b3R5cGUuZGlzYWJsZVdha2VMb2NrID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy53YWtlbG9ja18pIHsKICAgICAgICB0aGlzLndha2Vsb2NrXy5kaXNhYmxlKCk7CiAgICAgIH0KICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmJlZ2luUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CiAgICB9OwogICAgVlJEaXNwbGF5LnByb3RvdHlwZS5lbmRQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKHBvc2UpIHsKICAgIH07CiAgICBWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogICAgdmFyIGNvbmZpZyA9IHsKICAgICAgQURESVRJT05BTF9WSUVXRVJTOiBbXSwKICAgICAgREVGQVVMVF9WSUVXRVI6ICcnLAogICAgICBNT0JJTEVfV0FLRV9MT0NLOiB0cnVlLAogICAgICBERUJVRzogZmFsc2UsCiAgICAgIERQREJfVVJMOiAnaHR0cHM6Ly9kcGRiLndlYnZyLnJvY2tzL2RwZGIuanNvbicsCiAgICAgIEtfRklMVEVSOiAwLjk4LAogICAgICBQUkVESUNUSU9OX1RJTUVfUzogMC4wNDAsCiAgICAgIENBUkRCT0FSRF9VSV9ESVNBQkxFRDogZmFsc2UsCiAgICAgIFJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQ6IGZhbHNlLAogICAgICBZQVdfT05MWTogZmFsc2UsCiAgICAgIEJVRkZFUl9TQ0FMRTogMC41LAogICAgICBESVJUWV9TVUJNSVRfRlJBTUVfQklORElOR1M6IGZhbHNlCiAgICB9OwogICAgdmFyIEV5ZSA9IHsKICAgICAgTEVGVDogJ2xlZnQnLAogICAgICBSSUdIVDogJ3JpZ2h0JwogICAgfTsKICAgIGZ1bmN0aW9uIENhcmRib2FyZFZSRGlzcGxheShjb25maWckJDEpIHsKICAgICAgdmFyIGRlZmF1bHRzID0gZXh0ZW5kKHt9LCBjb25maWcpOwogICAgICBjb25maWckJDEgPSBleHRlbmQoZGVmYXVsdHMsIGNvbmZpZyQkMSB8fCB7fSk7CiAgICAgIFZSRGlzcGxheS5jYWxsKHRoaXMsIHsKICAgICAgICB3YWtlbG9jazogY29uZmlnJCQxLk1PQklMRV9XQUtFX0xPQ0sKICAgICAgfSk7CiAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnJCQxOwogICAgICB0aGlzLmRpc3BsYXlOYW1lID0gJ0NhcmRib2FyZCBWUkRpc3BsYXknOwogICAgICB0aGlzLmNhcGFiaWxpdGllcyA9IG5ldyBWUkRpc3BsYXlDYXBhYmlsaXRpZXMoewogICAgICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKICAgICAgICBoYXNPcmllbnRhdGlvbjogdHJ1ZSwKICAgICAgICBoYXNFeHRlcm5hbERpc3BsYXk6IGZhbHNlLAogICAgICAgIGNhblByZXNlbnQ6IHRydWUsCiAgICAgICAgbWF4TGF5ZXJzOiAxCiAgICAgIH0pOwogICAgICB0aGlzLnN0YWdlUGFyYW1ldGVycyA9IG51bGw7CiAgICAgIHRoaXMuYnVmZmVyU2NhbGVfID0gdGhpcy5jb25maWcuQlVGRkVSX1NDQUxFOwogICAgICB0aGlzLnBvc2VTZW5zb3JfID0gbmV3IFBvc2VTZW5zb3IodGhpcy5jb25maWcpOwogICAgICB0aGlzLmRpc3RvcnRlcl8gPSBudWxsOwogICAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG51bGw7CiAgICAgIHRoaXMuZHBkYl8gPSBuZXcgRHBkYih0aGlzLmNvbmZpZy5EUERCX1VSTCwgdGhpcy5vbkRldmljZVBhcmFtc1VwZGF0ZWRfLmJpbmQodGhpcykpOwogICAgICB0aGlzLmRldmljZUluZm9fID0gbmV3IERldmljZUluZm8odGhpcy5kcGRiXy5nZXREZXZpY2VQYXJhbXMoKSwgY29uZmlnJCQxLkFERElUSU9OQUxfVklFV0VSUyk7CiAgICAgIHRoaXMudmlld2VyU2VsZWN0b3JfID0gbmV3IFZpZXdlclNlbGVjdG9yKGNvbmZpZyQkMS5ERUZBVUxUX1ZJRVdFUik7CiAgICAgIHRoaXMudmlld2VyU2VsZWN0b3JfLm9uQ2hhbmdlKHRoaXMub25WaWV3ZXJDaGFuZ2VkXy5iaW5kKHRoaXMpKTsKICAgICAgdGhpcy5kZXZpY2VJbmZvXy5zZXRWaWV3ZXIodGhpcy52aWV3ZXJTZWxlY3Rvcl8uZ2V0Q3VycmVudFZpZXdlcigpKTsKICAgICAgaWYgKCF0aGlzLmNvbmZpZy5ST1RBVEVfSU5TVFJVQ1RJT05TX0RJU0FCTEVEKSB7CiAgICAgICAgdGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfID0gbmV3IFJvdGF0ZUluc3RydWN0aW9ucygpOwogICAgICB9CiAgICAgIGlmIChpc0lPUygpKSB7CiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25SZXNpemVfLmJpbmQodGhpcykpOwogICAgICB9CiAgICB9CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShWUkRpc3BsYXkucHJvdG90eXBlKTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX2dldFBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgcG9zaXRpb246IG51bGwsCiAgICAgICAgb3JpZW50YXRpb246IHRoaXMucG9zZVNlbnNvcl8uZ2V0T3JpZW50YXRpb24oKSwKICAgICAgICBsaW5lYXJWZWxvY2l0eTogbnVsbCwKICAgICAgICBsaW5lYXJBY2NlbGVyYXRpb246IG51bGwsCiAgICAgICAgYW5ndWxhclZlbG9jaXR5OiBudWxsLAogICAgICAgIGFuZ3VsYXJBY2NlbGVyYXRpb246IG51bGwKICAgICAgfTsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLl9yZXNldFBvc2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLnBvc2VTZW5zb3JfLnJlc2V0UG9zZSkgewogICAgICAgIHRoaXMucG9zZVNlbnNvcl8ucmVzZXRQb3NlKCk7CiAgICAgIH0KICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLl9nZXRGaWVsZE9mVmlldyA9IGZ1bmN0aW9uICh3aGljaEV5ZSkgewogICAgICB2YXIgZmllbGRPZlZpZXc7CiAgICAgIGlmICh3aGljaEV5ZSA9PSBFeWUuTEVGVCkgewogICAgICAgIGZpZWxkT2ZWaWV3ID0gdGhpcy5kZXZpY2VJbmZvXy5nZXRGaWVsZE9mVmlld0xlZnRFeWUoKTsKICAgICAgfSBlbHNlIGlmICh3aGljaEV5ZSA9PSBFeWUuUklHSFQpIHsKICAgICAgICBmaWVsZE9mVmlldyA9IHRoaXMuZGV2aWNlSW5mb18uZ2V0RmllbGRPZlZpZXdSaWdodEV5ZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgZXllIHByb3ZpZGVkOiAlcycsIHdoaWNoRXllKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gZmllbGRPZlZpZXc7CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5fZ2V0RXllT2Zmc2V0ID0gZnVuY3Rpb24gKHdoaWNoRXllKSB7CiAgICAgIHZhciBvZmZzZXQ7CiAgICAgIGlmICh3aGljaEV5ZSA9PSBFeWUuTEVGVCkgewogICAgICAgIG9mZnNldCA9IFstdGhpcy5kZXZpY2VJbmZvXy52aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgKiAwLjUsIDAuMCwgMC4wXTsKICAgICAgfSBlbHNlIGlmICh3aGljaEV5ZSA9PSBFeWUuUklHSFQpIHsKICAgICAgICBvZmZzZXQgPSBbdGhpcy5kZXZpY2VJbmZvXy52aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgKiAwLjUsIDAuMCwgMC4wXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGV5ZSBwcm92aWRlZDogJXMnLCB3aGljaEV5ZSk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgcmV0dXJuIG9mZnNldDsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKICAgICAgdmFyIG9mZnNldCA9IHRoaXMuX2dldEV5ZU9mZnNldCh3aGljaEV5ZSk7CiAgICAgIHZhciBmaWVsZE9mVmlldyA9IHRoaXMuX2dldEZpZWxkT2ZWaWV3KHdoaWNoRXllKTsKICAgICAgdmFyIGV5ZVBhcmFtcyA9IHsKICAgICAgICBvZmZzZXQ6IG9mZnNldCwKICAgICAgICByZW5kZXJXaWR0aDogdGhpcy5kZXZpY2VJbmZvXy5kZXZpY2Uud2lkdGggKiAwLjUgKiB0aGlzLmJ1ZmZlclNjYWxlXywKICAgICAgICByZW5kZXJIZWlnaHQ6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLmhlaWdodCAqIHRoaXMuYnVmZmVyU2NhbGVfCiAgICAgIH07CiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleWVQYXJhbXMsICdmaWVsZE9mVmlldycsIHsKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJGaWVsZE9mVmlldycsICdWUkZyYW1lRGF0YVwncyBwcm9qZWN0aW9uIG1hdHJpY2VzJyk7CiAgICAgICAgICByZXR1cm4gZmllbGRPZlZpZXc7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGV5ZVBhcmFtczsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLm9uRGV2aWNlUGFyYW1zVXBkYXRlZF8gPSBmdW5jdGlvbiAobmV3UGFyYW1zKSB7CiAgICAgIGlmICh0aGlzLmNvbmZpZy5ERUJVRykgewogICAgICAgIGNvbnNvbGUubG9nKCdEUERCIHJlcG9ydGVkIHRoYXQgZGV2aWNlIHBhcmFtcyB3ZXJlIHVwZGF0ZWQuJyk7CiAgICAgIH0KICAgICAgdGhpcy5kZXZpY2VJbmZvXy51cGRhdGVEZXZpY2VQYXJhbXMobmV3UGFyYW1zKTsKICAgICAgaWYgKHRoaXMuZGlzdG9ydGVyXykgewogICAgICAgIHRoaXMuZGlzdG9ydGVyXy51cGRhdGVEZXZpY2VJbmZvKHRoaXMuZGV2aWNlSW5mb18pOwogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS51cGRhdGVCb3VuZHNfID0gZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcy5sYXllcl8gJiYgdGhpcy5kaXN0b3J0ZXJfICYmICh0aGlzLmxheWVyXy5sZWZ0Qm91bmRzIHx8IHRoaXMubGF5ZXJfLnJpZ2h0Qm91bmRzKSkgewogICAgICAgIHRoaXMuZGlzdG9ydGVyXy5zZXRUZXh0dXJlQm91bmRzKHRoaXMubGF5ZXJfLmxlZnRCb3VuZHMsIHRoaXMubGF5ZXJfLnJpZ2h0Qm91bmRzKTsKICAgICAgfQogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuYmVnaW5QcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CiAgICAgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcpOwogICAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbDInKTsKICAgICAgaWYgKCFnbCkgcmV0dXJuOwogICAgICBpZiAodGhpcy5sYXllcl8ucHJlZGlzdG9ydGVkKSB7CiAgICAgICAgaWYgKCF0aGlzLmNvbmZpZy5DQVJEQk9BUkRfVUlfRElTQUJMRUQpIHsKICAgICAgICAgIGdsLmNhbnZhcy53aWR0aCA9IGdldFNjcmVlbldpZHRoKCkgKiB0aGlzLmJ1ZmZlclNjYWxlXzsKICAgICAgICAgIGdsLmNhbnZhcy5oZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKSAqIHRoaXMuYnVmZmVyU2NhbGVfOwogICAgICAgICAgdGhpcy5jYXJkYm9hcmRVSV8gPSBuZXcgQ2FyZGJvYXJkVUkoZ2wpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoIXRoaXMuY29uZmlnLkNBUkRCT0FSRF9VSV9ESVNBQkxFRCkgewogICAgICAgICAgdGhpcy5jYXJkYm9hcmRVSV8gPSBuZXcgQ2FyZGJvYXJkVUkoZ2wpOwogICAgICAgIH0KICAgICAgICB0aGlzLmRpc3RvcnRlcl8gPSBuZXcgQ2FyZGJvYXJkRGlzdG9ydGVyKGdsLCB0aGlzLmNhcmRib2FyZFVJXywgdGhpcy5jb25maWcuQlVGRkVSX1NDQUxFLCB0aGlzLmNvbmZpZy5ESVJUWV9TVUJNSVRfRlJBTUVfQklORElOR1MpOwogICAgICAgIHRoaXMuZGlzdG9ydGVyXy51cGRhdGVEZXZpY2VJbmZvKHRoaXMuZGV2aWNlSW5mb18pOwogICAgICB9CiAgICAgIGlmICh0aGlzLmNhcmRib2FyZFVJXykgewogICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfLmxpc3RlbihmdW5jdGlvbiAoZSkgewogICAgICAgICAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uc2hvdyh0aGlzLmxheWVyXy5zb3VyY2UucGFyZW50RWxlbWVudCk7CiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIH0uYmluZCh0aGlzKSwgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHRoaXMuZXhpdFByZXNlbnQoKTsKICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgfS5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgICBpZiAodGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfKSB7CiAgICAgICAgaWYgKGlzTGFuZHNjYXBlTW9kZSgpICYmIGlzTW9iaWxlKCkpIHsKICAgICAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy5zaG93VGVtcG9yYXJpbHkoMzAwMCwgdGhpcy5sYXllcl8uc291cmNlLnBhcmVudEVsZW1lbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18udXBkYXRlKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMub3JpZW50YXRpb25IYW5kbGVyID0gdGhpcy5vbk9yaWVudGF0aW9uQ2hhbmdlXy5iaW5kKHRoaXMpOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9yaWVudGF0aW9uSGFuZGxlcik7CiAgICAgIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIgPSB0aGlzLnVwZGF0ZUJvdW5kc18uYmluZCh0aGlzKTsKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB0aGlzLnZyZGlzcGxheXByZXNlbnRjaGFuZ2VIYW5kbGVyKTsKICAgICAgdGhpcy5maXJlVlJEaXNwbGF5RGV2aWNlUGFyYW1zQ2hhbmdlXygpOwogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuZW5kUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICh0aGlzLmRpc3RvcnRlcl8pIHsKICAgICAgICB0aGlzLmRpc3RvcnRlcl8uZGVzdHJveSgpOwogICAgICAgIHRoaXMuZGlzdG9ydGVyXyA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CiAgICAgICAgdGhpcy5jYXJkYm9hcmRVSV8uZGVzdHJveSgpOwogICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfID0gbnVsbDsKICAgICAgfQogICAgICBpZiAodGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfKSB7CiAgICAgICAgdGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfLmhpZGUoKTsKICAgICAgfQogICAgICB0aGlzLnZpZXdlclNlbGVjdG9yXy5oaWRlKCk7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMub3JpZW50YXRpb25IYW5kbGVyKTsKICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB0aGlzLnZyZGlzcGxheXByZXNlbnRjaGFuZ2VIYW5kbGVyKTsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLnVwZGF0ZVByZXNlbnRfID0gZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmVuZFByZXNlbnRfKCk7CiAgICAgIHRoaXMuYmVnaW5QcmVzZW50XygpOwogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewogICAgICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZHNfKCk7CiAgICAgICAgdGhpcy5kaXN0b3J0ZXJfLnN1Ym1pdEZyYW1lKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jYXJkYm9hcmRVSV8gJiYgdGhpcy5sYXllcl8pIHsKICAgICAgICB2YXIgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnd2ViZ2wnKTsKICAgICAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKICAgICAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbDInKTsKICAgICAgICB2YXIgY2FudmFzID0gZ2wuY2FudmFzOwogICAgICAgIGlmIChjYW52YXMud2lkdGggIT0gdGhpcy5sYXN0V2lkdGggfHwgY2FudmFzLmhlaWdodCAhPSB0aGlzLmxhc3RIZWlnaHQpIHsKICAgICAgICAgIHRoaXMuY2FyZGJvYXJkVUlfLm9uUmVzaXplKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubGFzdFdpZHRoID0gY2FudmFzLndpZHRoOwogICAgICAgIHRoaXMubGFzdEhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7CiAgICAgICAgdGhpcy5jYXJkYm9hcmRVSV8ucmVuZGVyKCk7CiAgICAgIH0KICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLm9uT3JpZW50YXRpb25DaGFuZ2VfID0gZnVuY3Rpb24gKGUpIHsKICAgICAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uaGlkZSgpOwogICAgICBpZiAodGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfKSB7CiAgICAgICAgdGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfLnVwZGF0ZSgpOwogICAgICB9CiAgICAgIHRoaXMub25SZXNpemVfKCk7CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblJlc2l6ZV8gPSBmdW5jdGlvbiAoZSkgewogICAgICBpZiAodGhpcy5sYXllcl8pIHsKICAgICAgICB2YXIgZ2wgPSB0aGlzLmxheWVyXy5zb3VyY2UuZ2V0Q29udGV4dCgnd2ViZ2wnKTsKICAgICAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKICAgICAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbDInKTsKICAgICAgICB2YXIgY3NzUHJvcGVydGllcyA9IFsncG9zaXRpb246IGFic29sdXRlJywgJ3RvcDogMCcsICdsZWZ0OiAwJywKICAgICAgICAnd2lkdGg6IDEwMHZ3JywgJ2hlaWdodDogMTAwdmgnLCAnYm9yZGVyOiAwJywgJ21hcmdpbjogMCcsCiAgICAgICAgJ3BhZGRpbmc6IDBweCcsICdib3gtc2l6aW5nOiBjb250ZW50LWJveCddOwogICAgICAgIGdsLmNhbnZhcy5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgY3NzUHJvcGVydGllcy5qb2luKCc7ICcpICsgJzsnKTsKICAgICAgICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChnbC5jYW52YXMpOwogICAgICB9CiAgICB9OwogICAgQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblZpZXdlckNoYW5nZWRfID0gZnVuY3Rpb24gKHZpZXdlcikgewogICAgICB0aGlzLmRldmljZUluZm9fLnNldFZpZXdlcih2aWV3ZXIpOwogICAgICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CiAgICAgICAgdGhpcy5kaXN0b3J0ZXJfLnVwZGF0ZURldmljZUluZm8odGhpcy5kZXZpY2VJbmZvXyk7CiAgICAgIH0KICAgICAgdGhpcy5maXJlVlJEaXNwbGF5RGV2aWNlUGFyYW1zQ2hhbmdlXygpOwogICAgfTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8gPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBldmVudCA9IG5ldyBDdXN0b21FdmVudCgndnJkaXNwbGF5ZGV2aWNlcGFyYW1zY2hhbmdlJywgewogICAgICAgIGRldGFpbDogewogICAgICAgICAgdnJkaXNwbGF5OiB0aGlzLAogICAgICAgICAgZGV2aWNlSW5mbzogdGhpcy5kZXZpY2VJbmZvXwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2ZW50KTsKICAgIH07CiAgICBDYXJkYm9hcmRWUkRpc3BsYXkuVlJGcmFtZURhdGEgPSBWUkZyYW1lRGF0YTsKICAgIENhcmRib2FyZFZSRGlzcGxheS5WUkRpc3BsYXkgPSBWUkRpc3BsYXk7CiAgICByZXR1cm4gQ2FyZGJvYXJkVlJEaXNwbGF5OwogICAgfSkpKTsKICAgIH0pOwogICAgdmFyIENhcmRib2FyZFZSRGlzcGxheSA9IHVud3JhcEV4cG9ydHMoY2FyZGJvYXJkVnJEaXNwbGF5KTsKCiAgICBjbGFzcyBYUkRldmljZSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgICAgY29uc3RydWN0b3IoZ2xvYmFsKSB7CiAgICAgICAgc3VwZXIoKTsKICAgICAgICB0aGlzLmdsb2JhbCA9IGdsb2JhbDsKICAgICAgICB0aGlzLm9uV2luZG93UmVzaXplID0gdGhpcy5vbldpbmRvd1Jlc2l6ZS5iaW5kKHRoaXMpOwogICAgICAgIHRoaXMuZ2xvYmFsLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplKTsKICAgICAgICB0aGlzLmVudmlyb25tZW50QmxlbmRNb2RlID0gJ29wYXF1ZSc7CiAgICAgIH0KICAgICAgb25CYXNlTGF5ZXJTZXQoc2Vzc2lvbklkLCBsYXllcikgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGlzU2Vzc2lvblN1cHBvcnRlZChtb2RlKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgaXNGZWF0dXJlU3VwcG9ydGVkKGZlYXR1cmVEZXNjcmlwdG9yKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgYXN5bmMgcmVxdWVzdFNlc3Npb24obW9kZSwgZW5hYmxlZEZlYXR1cmVzKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgb25GcmFtZVN0YXJ0KHNlc3Npb25JZCkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIG9uRnJhbWVFbmQoc2Vzc2lvbklkKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgZG9lc1Nlc3Npb25TdXBwb3J0UmVmZXJlbmNlU3BhY2Uoc2Vzc2lvbklkLCB0eXBlKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgcmVxdWVzdFN0YWdlQm91bmRzKCkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGFzeW5jIHJlcXVlc3RGcmFtZU9mUmVmZXJlbmNlVHJhbnNmb3JtKHR5cGUsIG9wdGlvbnMpIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGVuZFNlc3Npb24oc2Vzc2lvbklkKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgZ2V0Vmlld3BvcnQoc2Vzc2lvbklkLCBleWUsIGxheWVyLCB0YXJnZXQpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBnZXRQcm9qZWN0aW9uTWF0cml4KGV5ZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGdldEJhc2VQb3NlTWF0cml4KCkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGdldEJhc2VWaWV3TWF0cml4KGV5ZSkgeyB0aHJvdyBuZXcgRXJyb3IoJ05vdCBpbXBsZW1lbnRlZCcpOyB9CiAgICAgIGdldElucHV0U291cmNlcygpIHsgdGhyb3cgbmV3IEVycm9yKCdOb3QgaW1wbGVtZW50ZWQnKTsgfQogICAgICBnZXRJbnB1dFBvc2UoaW5wdXRTb3VyY2UsIGNvb3JkaW5hdGVTeXN0ZW0sIHBvc2VUeXBlKSB7IHRocm93IG5ldyBFcnJvcignTm90IGltcGxlbWVudGVkJyk7IH0KICAgICAgb25XaW5kb3dSZXNpemUoKSB7CiAgICAgICAgdGhpcy5vbldpbmRvd1Jlc2l6ZSgpOwogICAgICB9CiAgICB9CgogICAgbGV0IGRheWRyZWFtID0gewogICAgICBtYXBwaW5nOiAnJywKICAgICAgcHJvZmlsZXM6IFsnZ29vZ2xlLWRheWRyZWFtJywgJ2dlbmVyaWMtdHJpZ2dlci10b3VjaHBhZCddLAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiAzLAogICAgICAgIDA6IG51bGwsCiAgICAgICAgMTogbnVsbCwKICAgICAgICAyOiAwCiAgICAgIH0sCiAgICB9OwogICAgbGV0IHZpdmVGb2N1cyA9IHsKICAgICAgbWFwcGluZzogJ3hyLXN0YW5kYXJkJywKICAgICAgcHJvZmlsZXM6IFsnaHRjLXZpdmUtZm9jdXMnLCAnZ2VuZXJpYy10cmlnZ2VyLXRvdWNocGFkJ10sCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICBsZW5ndGg6IDMsCiAgICAgICAgMDogMSwKICAgICAgICAxOiBudWxsLAogICAgICAgIDI6IDAKICAgICAgfSwKICAgIH07CiAgICBsZXQgb2N1bHVzR28gPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIHByb2ZpbGVzOiBbJ29jdWx1cy1nbycsICdnZW5lcmljLXRyaWdnZXItdG91Y2hwYWQnXSwKICAgICAgYnV0dG9uczogewogICAgICAgIGxlbmd0aDogMywKICAgICAgICAwOiAxLAogICAgICAgIDE6IG51bGwsCiAgICAgICAgMjogMAogICAgICB9LAogICAgICBncmlwVHJhbnNmb3JtOiB7CiAgICAgICAgb3JpZW50YXRpb246IFtNYXRoLlBJICogMC4xMSwgMCwgMCwgMV0KICAgICAgfQogICAgfTsKICAgIGxldCBvY3VsdXNUb3VjaCA9IHsKICAgICAgbWFwcGluZzogJ3hyLXN0YW5kYXJkJywKICAgICAgZGlzcGxheVByb2ZpbGVzOiB7CiAgICAgICAgJ09jdWx1cyBRdWVzdCc6IFsnb2N1bHVzLXRvdWNoLXYyJywgJ29jdWx1cy10b3VjaCcsICdnZW5lcmljLXRyaWdnZXItc3F1ZWV6ZS10aHVtYnN0aWNrJ10KICAgICAgfSwKICAgICAgcHJvZmlsZXM6IFsnb2N1bHVzLXRvdWNoJywgJ2dlbmVyaWMtdHJpZ2dlci1zcXVlZXplLXRodW1ic3RpY2snXSwKICAgICAgYXhlczogewogICAgICAgIGxlbmd0aDogNCwKICAgICAgICAwOiBudWxsLAogICAgICAgIDE6IG51bGwsCiAgICAgICAgMjogMCwKICAgICAgICAzOiAxCiAgICAgIH0sCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICBsZW5ndGg6IDcsCiAgICAgICAgMDogMSwKICAgICAgICAxOiAyLAogICAgICAgIDI6IG51bGwsCiAgICAgICAgMzogMCwKICAgICAgICA0OiAzLAogICAgICAgIDU6IDQsCiAgICAgICAgNjogbnVsbAogICAgICB9LAogICAgICBncmlwVHJhbnNmb3JtOiB7CiAgICAgICAgcG9zaXRpb246IFswLCAtMC4wMiwgMC4wNCwgMV0sCiAgICAgICAgb3JpZW50YXRpb246IFtNYXRoLlBJICogMC4xMSwgMCwgMCwgMV0KICAgICAgfQogICAgfTsKICAgIGxldCBvcGVuVnIgPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIHByb2ZpbGVzOiBbJ2h0Yy12aXZlJywgJ2dlbmVyaWMtdHJpZ2dlci1zcXVlZXplLXRvdWNocGFkJ10sCiAgICAgIGRpc3BsYXlQcm9maWxlczogewogICAgICAgICdIVEMgVml2ZSc6IFsnaHRjLXZpdmUnLCAnZ2VuZXJpYy10cmlnZ2VyLXNxdWVlemUtdG91Y2hwYWQnXSwKICAgICAgICAnSFRDIFZpdmUgRFZUJzogWydodGMtdml2ZScsICdnZW5lcmljLXRyaWdnZXItc3F1ZWV6ZS10b3VjaHBhZCddLAogICAgICAgICdWYWx2ZSBJbmRleCc6IFsndmFsdmUtaW5kZXgnLCAnZ2VuZXJpYy10cmlnZ2VyLXNxdWVlemUtdG91Y2hwYWQtdGh1bWJzdGljayddCiAgICAgIH0sCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICBsZW5ndGg6IDMsCiAgICAgICAgMDogMSwKICAgICAgICAxOiAyLAogICAgICAgIDI6IDAKICAgICAgfSwKICAgICAgZ3JpcFRyYW5zZm9ybTogewogICAgICAgIHBvc2l0aW9uOiBbMCwgMCwgMC4wNSwgMV0sCiAgICAgIH0sCiAgICAgIHRhcmdldFJheVRyYW5zZm9ybTogewogICAgICAgIG9yaWVudGF0aW9uOiBbTWF0aC5QSSAqIC0wLjA4LCAwLCAwLCAxXQogICAgICB9LAogICAgICB1c2VyQWdlbnRPdmVycmlkZXM6IHsKICAgICAgICAiRmlyZWZveCI6IHsKICAgICAgICAgIGF4ZXM6IHsKICAgICAgICAgICAgaW52ZXJ0OiBbMSwgM10KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBsZXQgc2Ftc3VuZ0dlYXJWUiA9IHsKICAgICAgbWFwcGluZzogJ3hyLXN0YW5kYXJkJywKICAgICAgcHJvZmlsZXM6IFsnc2Ftc3VuZy1nZWFydnInLCAnZ2VuZXJpYy10cmlnZ2VyLXRvdWNocGFkJ10sCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICBsZW5ndGg6IDMsCiAgICAgICAgMDogMSwKICAgICAgICAxOiBudWxsLAogICAgICAgIDI6IDAKICAgICAgfSwKICAgICAgZ3JpcFRyYW5zZm9ybTogewogICAgICAgIG9yaWVudGF0aW9uOiBbTWF0aC5QSSAqIDAuMTEsIDAsIDAsIDFdCiAgICAgIH0KICAgIH07CiAgICBsZXQgc2Ftc3VuZ09keXNzZXkgPSB7CiAgICAgIG1hcHBpbmc6ICd4ci1zdGFuZGFyZCcsCiAgICAgIHByb2ZpbGVzOiBbJ3NhbXN1bmctb2R5c3NleScsICdtaWNyb3NvZnQtbWl4ZWQtcmVhbGl0eScsICdnZW5lcmljLXRyaWdnZXItc3F1ZWV6ZS10b3VjaHBhZC10aHVtYnN0aWNrJ10sCiAgICAgIGJ1dHRvbnM6IHsKICAgICAgICBsZW5ndGg6IDQsCiAgICAgICAgMDogMSwKICAgICAgICAxOiAwLAogICAgICAgIDI6IDIsCiAgICAgICAgMzogNCwKICAgICAgfSwKICAgICAgZ3JpcFRyYW5zZm9ybTogewogICAgICAgIHBvc2l0aW9uOiBbMCwgLTAuMDIsIDAuMDQsIDFdLAogICAgICAgIG9yaWVudGF0aW9uOiBbTWF0aC5QSSAqIDAuMTEsIDAsIDAsIDFdCiAgICAgIH0KICAgIH07CiAgICBsZXQgd2luZG93c01peGVkUmVhbGl0eSA9IHsKICAgICAgbWFwcGluZzogJ3hyLXN0YW5kYXJkJywKICAgICAgcHJvZmlsZXM6IFsnbWljcm9zb2Z0LW1peGVkLXJlYWxpdHknLCAnZ2VuZXJpYy10cmlnZ2VyLXNxdWVlemUtdG91Y2hwYWQtdGh1bWJzdGljayddLAogICAgICBidXR0b25zOiB7CiAgICAgICAgbGVuZ3RoOiA0LAogICAgICAgIDA6IDEsCiAgICAgICAgMTogMCwKICAgICAgICAyOiAyLAogICAgICAgIDM6IDQsCiAgICAgIH0sCiAgICAgIGdyaXBUcmFuc2Zvcm06IHsKICAgICAgICBwb3NpdGlvbjogWzAsIC0wLjAyLCAwLjA0LCAxXSwKICAgICAgICBvcmllbnRhdGlvbjogW01hdGguUEkgKiAwLjExLCAwLCAwLCAxXQogICAgICB9CiAgICB9OwogICAgbGV0IEdhbWVwYWRNYXBwaW5ncyA9IHsKICAgICAgJ0RheWRyZWFtIENvbnRyb2xsZXInOiBkYXlkcmVhbSwKICAgICAgJ0dlYXIgVlIgQ29udHJvbGxlcic6IHNhbXN1bmdHZWFyVlIsCiAgICAgICdIVEMgVml2ZSBGb2N1cyBDb250cm9sbGVyJzogdml2ZUZvY3VzLAogICAgICAnT2N1bHVzIEdvIENvbnRyb2xsZXInOiBvY3VsdXNHbywKICAgICAgJ09jdWx1cyBUb3VjaCAoUmlnaHQpJzogb2N1bHVzVG91Y2gsCiAgICAgICdPY3VsdXMgVG91Y2ggKExlZnQpJzogb2N1bHVzVG91Y2gsCiAgICAgICdPcGVuVlIgR2FtZXBhZCc6IG9wZW5WciwKICAgICAgJ1NwYXRpYWwgQ29udHJvbGxlciAoU3BhdGlhbCBJbnRlcmFjdGlvbiBTb3VyY2UpIDA0NUUtMDY1QSc6IHdpbmRvd3NNaXhlZFJlYWxpdHksCiAgICAgICdTcGF0aWFsIENvbnRyb2xsZXIgKFNwYXRpYWwgSW50ZXJhY3Rpb24gU291cmNlKSAwNDVFLTA2NUQnOiBzYW1zdW5nT2R5c3NleSwKICAgICAgJ1dpbmRvd3MgTWl4ZWQgUmVhbGl0eSAoUmlnaHQpJzogd2luZG93c01peGVkUmVhbGl0eSwKICAgICAgJ1dpbmRvd3MgTWl4ZWQgUmVhbGl0eSAoTGVmdCknOiB3aW5kb3dzTWl4ZWRSZWFsaXR5LAogICAgfTsKCiAgICBjb25zdCBIRUFEX0VMQk9XX09GRlNFVF9SSUdIVEhBTkRFRCA9IGZyb21WYWx1ZXMkMSgwLjE1NSwgLTAuNDY1LCAtMC4xNSk7CiAgICBjb25zdCBIRUFEX0VMQk9XX09GRlNFVF9MRUZUSEFOREVEID0gZnJvbVZhbHVlcyQxKC0wLjE1NSwgLTAuNDY1LCAtMC4xNSk7CiAgICBjb25zdCBFTEJPV19XUklTVF9PRkZTRVQgPSBmcm9tVmFsdWVzJDEoMCwgMCwgLTAuMjUpOwogICAgY29uc3QgV1JJU1RfQ09OVFJPTExFUl9PRkZTRVQgPSBmcm9tVmFsdWVzJDEoMCwgMCwgMC4wNSk7CiAgICBjb25zdCBBUk1fRVhURU5TSU9OX09GRlNFVCA9IGZyb21WYWx1ZXMkMSgtMC4wOCwgMC4xNCwgMC4wOCk7CiAgICBjb25zdCBFTEJPV19CRU5EX1JBVElPID0gMC40OwogICAgY29uc3QgRVhURU5TSU9OX1JBVElPX1dFSUdIVCA9IDAuNDsKICAgIGNvbnN0IE1JTl9BTkdVTEFSX1NQRUVEID0gMC42MTsKICAgIGNvbnN0IE1JTl9BTkdMRV9ERUxUQSA9IDAuMTc1OwogICAgY29uc3QgTUlOX0VYVEVOU0lPTl9DT1MgPSAwLjEyOwogICAgY29uc3QgTUFYX0VYVEVOU0lPTl9DT1MgPSAwLjg3OwogICAgY29uc3QgUkFEX1RPX0RFRyA9IDE4MCAvIE1hdGguUEk7CiAgICBmdW5jdGlvbiBldWxlckZyb21RdWF0ZXJuaW9uKG91dCwgcSwgb3JkZXIpIHsKICAgICAgZnVuY3Rpb24gY2xhbXAodmFsdWUsIG1pbiQkMSwgbWF4JCQxKSB7CiAgICAgICAgcmV0dXJuICh2YWx1ZSA8IG1pbiQkMSA/IG1pbiQkMSA6ICh2YWx1ZSA+IG1heCQkMSA/IG1heCQkMSA6IHZhbHVlKSk7CiAgICAgIH0KICAgICAgdmFyIHNxeCA9IHFbMF0gKiBxWzBdOwogICAgICB2YXIgc3F5ID0gcVsxXSAqIHFbMV07CiAgICAgIHZhciBzcXogPSBxWzJdICogcVsyXTsKICAgICAgdmFyIHNxdyA9IHFbM10gKiBxWzNdOwogICAgICB7CiAgICAgICAgb3V0WzBdID0gTWF0aC5hc2luKCAgY2xhbXAoIDIgKiAoIHFbMF0gKiBxWzNdIC0gcVsxXSAqIHFbMl0gKSwgLTEsIDEgKSApOwogICAgICAgIG91dFsxXSA9IE1hdGguYXRhbjIoIDIgKiAoIHFbMF0gKiBxWzJdICsgcVsxXSAqIHFbM10gKSwgKCBzcXcgLSBzcXggLSBzcXkgKyBzcXogKSApOwogICAgICAgIG91dFsyXSA9IE1hdGguYXRhbjIoIDIgKiAoIHFbMF0gKiBxWzFdICsgcVsyXSAqIHFbM10gKSwgKCBzcXcgLSBzcXggKyBzcXkgLSBzcXogKSApOwogICAgICB9CiAgICB9CiAgICBjbGFzcyBPcmllbnRhdGlvbkFybU1vZGVsIHsKICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgdGhpcy5oYW5kID0gJ3JpZ2h0JzsKICAgICAgICB0aGlzLmhlYWRFbGJvd09mZnNldCA9IEhFQURfRUxCT1dfT0ZGU0VUX1JJR0hUSEFOREVEOwogICAgICAgIHRoaXMuY29udHJvbGxlclEgPSBjcmVhdGUkNCgpOwogICAgICAgIHRoaXMubGFzdENvbnRyb2xsZXJRID0gY3JlYXRlJDQoKTsKICAgICAgICB0aGlzLmhlYWRRID0gY3JlYXRlJDQoKTsKICAgICAgICB0aGlzLmhlYWRQb3MgPSBjcmVhdGUkMSgpOwogICAgICAgIHRoaXMuZWxib3dQb3MgPSBjcmVhdGUkMSgpOwogICAgICAgIHRoaXMud3Jpc3RQb3MgPSBjcmVhdGUkMSgpOwogICAgICAgIHRoaXMudGltZSA9IG51bGw7CiAgICAgICAgdGhpcy5sYXN0VGltZSA9IG51bGw7CiAgICAgICAgdGhpcy5yb290USA9IGNyZWF0ZSQ0KCk7CiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGNyZWF0ZSQxKCk7CiAgICAgIH0KICAgICAgc2V0SGFuZGVkbmVzcyhoYW5kKSB7CiAgICAgICAgaWYgKHRoaXMuaGFuZCAhPSBoYW5kKSB7CiAgICAgICAgICB0aGlzLmhhbmQgPSBoYW5kOwogICAgICAgICAgaWYgKHRoaXMuaGFuZCA9PSAnbGVmdCcpIHsKICAgICAgICAgICAgdGhpcy5oZWFkRWxib3dPZmZzZXQgPSBIRUFEX0VMQk9XX09GRlNFVF9MRUZUSEFOREVEOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5oZWFkRWxib3dPZmZzZXQgPSBIRUFEX0VMQk9XX09GRlNFVF9SSUdIVEhBTkRFRDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgdXBkYXRlKGNvbnRyb2xsZXJPcmllbnRhdGlvbiwgaGVhZFBvc2VNYXRyaXgpIHsKICAgICAgICB0aGlzLnRpbWUgPSBub3ckMSgpOwogICAgICAgIGlmIChjb250cm9sbGVyT3JpZW50YXRpb24pIHsKICAgICAgICAgIGNvcHkkNCh0aGlzLmxhc3RDb250cm9sbGVyUSwgdGhpcy5jb250cm9sbGVyUSk7CiAgICAgICAgICBjb3B5JDQodGhpcy5jb250cm9sbGVyUSwgY29udHJvbGxlck9yaWVudGF0aW9uKTsKICAgICAgICB9CiAgICAgICAgaWYgKGhlYWRQb3NlTWF0cml4KSB7CiAgICAgICAgICBnZXRUcmFuc2xhdGlvbih0aGlzLmhlYWRQb3MsIGhlYWRQb3NlTWF0cml4KTsKICAgICAgICAgIGdldFJvdGF0aW9uKHRoaXMuaGVhZFEsIGhlYWRQb3NlTWF0cml4KTsKICAgICAgICB9CiAgICAgICAgbGV0IGhlYWRZYXdRID0gdGhpcy5nZXRIZWFkWWF3T3JpZW50YXRpb25fKCk7CiAgICAgICAgbGV0IGFuZ2xlRGVsdGEgPSB0aGlzLnF1YXRBbmdsZV8odGhpcy5sYXN0Q29udHJvbGxlclEsIHRoaXMuY29udHJvbGxlclEpOwogICAgICAgIGxldCB0aW1lRGVsdGEgPSAodGhpcy50aW1lIC0gdGhpcy5sYXN0VGltZSkgLyAxMDAwOwogICAgICAgIGxldCBjb250cm9sbGVyQW5ndWxhclNwZWVkID0gYW5nbGVEZWx0YSAvIHRpbWVEZWx0YTsKICAgICAgICBpZiAoY29udHJvbGxlckFuZ3VsYXJTcGVlZCA+IE1JTl9BTkdVTEFSX1NQRUVEKSB7CiAgICAgICAgICBzbGVycCh0aGlzLnJvb3RRLCB0aGlzLnJvb3RRLCBoZWFkWWF3USwKICAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4oYW5nbGVEZWx0YSAvIE1JTl9BTkdMRV9ERUxUQSwgMS4wKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvcHkkNCh0aGlzLnJvb3RRLCBoZWFkWWF3USk7CiAgICAgICAgfQogICAgICAgIGxldCBjb250cm9sbGVyRm9yd2FyZCA9IGZyb21WYWx1ZXMkMSgwLCAwLCAtMSk7CiAgICAgICAgdHJhbnNmb3JtUXVhdChjb250cm9sbGVyRm9yd2FyZCwgY29udHJvbGxlckZvcndhcmQsIHRoaXMuY29udHJvbGxlclEpOwogICAgICAgIGxldCBjb250cm9sbGVyRG90WSA9IGRvdChjb250cm9sbGVyRm9yd2FyZCwgWzAsIDEsIDBdKTsKICAgICAgICBsZXQgZXh0ZW5zaW9uUmF0aW8gPSB0aGlzLmNsYW1wXygKICAgICAgICAgICAgKGNvbnRyb2xsZXJEb3RZIC0gTUlOX0VYVEVOU0lPTl9DT1MpIC8gTUFYX0VYVEVOU0lPTl9DT1MsIDAuMCwgMS4wKTsKICAgICAgICBsZXQgY29udHJvbGxlckNhbWVyYVEgPSBjbG9uZSQ0KHRoaXMucm9vdFEpOwogICAgICAgIGludmVydCQyKGNvbnRyb2xsZXJDYW1lcmFRLCBjb250cm9sbGVyQ2FtZXJhUSk7CiAgICAgICAgbXVsdGlwbHkkNChjb250cm9sbGVyQ2FtZXJhUSwgY29udHJvbGxlckNhbWVyYVEsIHRoaXMuY29udHJvbGxlclEpOwogICAgICAgIGxldCBlbGJvd1BvcyA9IHRoaXMuZWxib3dQb3M7CiAgICAgICAgY29weSQxKGVsYm93UG9zLCB0aGlzLmhlYWRQb3MpOwogICAgICAgIGFkZCQxKGVsYm93UG9zLCBlbGJvd1BvcywgdGhpcy5oZWFkRWxib3dPZmZzZXQpOwogICAgICAgIGxldCBlbGJvd09mZnNldCA9IGNsb25lJDEoQVJNX0VYVEVOU0lPTl9PRkZTRVQpOwogICAgICAgIHNjYWxlJDEoZWxib3dPZmZzZXQsIGVsYm93T2Zmc2V0LCBleHRlbnNpb25SYXRpbyk7CiAgICAgICAgYWRkJDEoZWxib3dQb3MsIGVsYm93UG9zLCBlbGJvd09mZnNldCk7CiAgICAgICAgbGV0IHRvdGFsQW5nbGUgPSB0aGlzLnF1YXRBbmdsZV8oY29udHJvbGxlckNhbWVyYVEsIGNyZWF0ZSQ0KCkpOwogICAgICAgIGxldCB0b3RhbEFuZ2xlRGVnID0gdG90YWxBbmdsZSAqIFJBRF9UT19ERUc7CiAgICAgICAgbGV0IGxlcnBTdXBwcmVzc2lvbiA9IDEgLSBNYXRoLnBvdyh0b3RhbEFuZ2xlRGVnIC8gMTgwLCA0KTtsZXQgZWxib3dSYXRpbyA9IEVMQk9XX0JFTkRfUkFUSU87CiAgICAgICAgbGV0IHdyaXN0UmF0aW8gPSAxIC0gRUxCT1dfQkVORF9SQVRJTzsKICAgICAgICBsZXQgbGVycFZhbHVlID0gbGVycFN1cHByZXNzaW9uICoKICAgICAgICAgICAgKGVsYm93UmF0aW8gKyB3cmlzdFJhdGlvICogZXh0ZW5zaW9uUmF0aW8gKiBFWFRFTlNJT05fUkFUSU9fV0VJR0hUKTsKICAgICAgICBsZXQgd3Jpc3RRID0gY3JlYXRlJDQoKTsKICAgICAgICBzbGVycCh3cmlzdFEsIHdyaXN0USwgY29udHJvbGxlckNhbWVyYVEsIGxlcnBWYWx1ZSk7CiAgICAgICAgbGV0IGludldyaXN0USA9IGludmVydCQyKGNyZWF0ZSQ0KCksIHdyaXN0USk7CiAgICAgICAgbGV0IGVsYm93USA9IGNsb25lJDQoY29udHJvbGxlckNhbWVyYVEpOwogICAgICAgIG11bHRpcGx5JDQoZWxib3dRLCBlbGJvd1EsIGludldyaXN0USk7CiAgICAgICAgbGV0IHdyaXN0UG9zID0gdGhpcy53cmlzdFBvczsKICAgICAgICBjb3B5JDEod3Jpc3RQb3MsIFdSSVNUX0NPTlRST0xMRVJfT0ZGU0VUKTsKICAgICAgICB0cmFuc2Zvcm1RdWF0KHdyaXN0UG9zLCB3cmlzdFBvcywgd3Jpc3RRKTsKICAgICAgICBhZGQkMSh3cmlzdFBvcywgd3Jpc3RQb3MsIEVMQk9XX1dSSVNUX09GRlNFVCk7CiAgICAgICAgdHJhbnNmb3JtUXVhdCh3cmlzdFBvcywgd3Jpc3RQb3MsIGVsYm93USk7CiAgICAgICAgYWRkJDEod3Jpc3RQb3MsIHdyaXN0UG9zLCBlbGJvd1Bvcyk7CiAgICAgICAgbGV0IG9mZnNldCA9IGNsb25lJDEoQVJNX0VYVEVOU0lPTl9PRkZTRVQpOwogICAgICAgIHNjYWxlJDEob2Zmc2V0LCBvZmZzZXQsIGV4dGVuc2lvblJhdGlvKTsKICAgICAgICBhZGQkMSh0aGlzLnBvc2l0aW9uLCB0aGlzLndyaXN0UG9zLCBvZmZzZXQpOwogICAgICAgIHRyYW5zZm9ybVF1YXQodGhpcy5wb3NpdGlvbiwgdGhpcy5wb3NpdGlvbiwgdGhpcy5yb290USk7CiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRoaXMudGltZTsKICAgICAgfQogICAgICBnZXRQb3NpdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5wb3NpdGlvbjsKICAgICAgfQogICAgICBnZXRIZWFkWWF3T3JpZW50YXRpb25fKCkgewogICAgICAgIGxldCBoZWFkRXVsZXIgPSBjcmVhdGUkMSgpOwogICAgICAgIGV1bGVyRnJvbVF1YXRlcm5pb24oaGVhZEV1bGVyLCB0aGlzLmhlYWRRKTsKICAgICAgICBsZXQgZGVzdGluYXRpb25RID0gZnJvbUV1bGVyKGNyZWF0ZSQ0KCksIDAsIGhlYWRFdWxlclsxXSAqIFJBRF9UT19ERUcsIDApOwogICAgICAgIHJldHVybiBkZXN0aW5hdGlvblE7CiAgICAgIH0KICAgICAgY2xhbXBfKHZhbHVlLCBtaW4kJDEsIG1heCQkMSkgewogICAgICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heCh2YWx1ZSwgbWluJCQxKSwgbWF4JCQxKTsKICAgICAgfQogICAgICBxdWF0QW5nbGVfKHExLCBxMikgewogICAgICAgIGxldCB2ZWMxID0gWzAsIDAsIC0xXTsKICAgICAgICBsZXQgdmVjMiA9IFswLCAwLCAtMV07CiAgICAgICAgdHJhbnNmb3JtUXVhdCh2ZWMxLCB2ZWMxLCBxMSk7CiAgICAgICAgdHJhbnNmb3JtUXVhdCh2ZWMyLCB2ZWMyLCBxMik7CiAgICAgICAgcmV0dXJuIGFuZ2xlKHZlYzEsIHZlYzIpOwogICAgICB9CiAgICB9CgogICAgY29uc3QgUFJJVkFURSQxOCA9IFN5bWJvbCgnQEB3ZWJ4ci1wb2x5ZmlsbC9YUlJlbWFwcGVkR2FtZXBhZCcpOwogICAgY29uc3QgUExBQ0VIT0xERVJfQlVUVE9OID0geyBwcmVzc2VkOiBmYWxzZSwgdG91Y2hlZDogZmFsc2UsIHZhbHVlOiAwLjAgfTsKICAgIE9iamVjdC5mcmVlemUoUExBQ0VIT0xERVJfQlVUVE9OKTsKICAgIGNsYXNzIFhSUmVtYXBwZWRHYW1lcGFkIHsKICAgICAgY29uc3RydWN0b3IoZ2FtZXBhZCwgZGlzcGxheSwgbWFwKSB7CiAgICAgICAgaWYgKCFtYXApIHsKICAgICAgICAgIG1hcCA9IHt9OwogICAgICAgIH0KICAgICAgICBpZiAobWFwLnVzZXJBZ2VudE92ZXJyaWRlcykgewogICAgICAgICAgZm9yIChsZXQgYWdlbnQgaW4gbWFwLnVzZXJBZ2VudE92ZXJyaWRlcykgewogICAgICAgICAgICBpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcyhhZ2VudCkpIHsKICAgICAgICAgICAgICBsZXQgb3ZlcnJpZGUgPSBtYXAudXNlckFnZW50T3ZlcnJpZGVzW2FnZW50XTsKICAgICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gb3ZlcnJpZGUpIHsKICAgICAgICAgICAgICAgIGlmIChrZXkgaW4gbWFwKSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWFwW2tleV0sIG92ZXJyaWRlW2tleV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgbWFwW2tleV0gPSBvdmVycmlkZVtrZXldOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsZXQgYXhlcyA9IG5ldyBBcnJheShtYXAuYXhlcyAmJiBtYXAuYXhlcy5sZW5ndGggPyBtYXAuYXhlcy5sZW5ndGggOiBnYW1lcGFkLmF4ZXMubGVuZ3RoKTsKICAgICAgICBsZXQgYnV0dG9ucyA9IG5ldyBBcnJheShtYXAuYnV0dG9ucyAmJiBtYXAuYnV0dG9ucy5sZW5ndGggPyBtYXAuYnV0dG9ucy5sZW5ndGggOiBnYW1lcGFkLmJ1dHRvbnMubGVuZ3RoKTsKICAgICAgICBsZXQgZ3JpcFRyYW5zZm9ybSA9IG51bGw7CiAgICAgICAgaWYgKG1hcC5ncmlwVHJhbnNmb3JtKSB7CiAgICAgICAgICBsZXQgb3JpZW50YXRpb24gPSBtYXAuZ3JpcFRyYW5zZm9ybS5vcmllbnRhdGlvbiB8fCBbMCwgMCwgMCwgMV07CiAgICAgICAgICBncmlwVHJhbnNmb3JtID0gY3JlYXRlKCk7CiAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbigKICAgICAgICAgICAgZ3JpcFRyYW5zZm9ybSwKICAgICAgICAgICAgbm9ybWFsaXplJDIob3JpZW50YXRpb24sIG9yaWVudGF0aW9uKSwKICAgICAgICAgICAgbWFwLmdyaXBUcmFuc2Zvcm0ucG9zaXRpb24gfHwgWzAsIDAsIDBdCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBsZXQgdGFyZ2V0UmF5VHJhbnNmb3JtID0gbnVsbDsKICAgICAgICBpZiAobWFwLnRhcmdldFJheVRyYW5zZm9ybSkgewogICAgICAgICAgbGV0IG9yaWVudGF0aW9uID0gIG1hcC50YXJnZXRSYXlUcmFuc2Zvcm0ub3JpZW50YXRpb24gfHwgWzAsIDAsIDAsIDFdOwogICAgICAgICAgdGFyZ2V0UmF5VHJhbnNmb3JtID0gY3JlYXRlKCk7CiAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbigKICAgICAgICAgICAgdGFyZ2V0UmF5VHJhbnNmb3JtLAogICAgICAgICAgICBub3JtYWxpemUkMihvcmllbnRhdGlvbiwgb3JpZW50YXRpb24pLAogICAgICAgICAgICBtYXAudGFyZ2V0UmF5VHJhbnNmb3JtLnBvc2l0aW9uIHx8IFswLCAwLCAwXQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbGV0IHByb2ZpbGVzID0gbWFwLnByb2ZpbGVzOwogICAgICAgIGlmIChtYXAuZGlzcGxheVByb2ZpbGVzKSB7CiAgICAgICAgICBpZiAoZGlzcGxheS5kaXNwbGF5TmFtZSBpbiBtYXAuZGlzcGxheVByb2ZpbGVzKSB7CiAgICAgICAgICAgIHByb2ZpbGVzID0gbWFwLmRpc3BsYXlQcm9maWxlc1tkaXNwbGF5LmRpc3BsYXlOYW1lXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpc1tQUklWQVRFJDE4XSA9IHsKICAgICAgICAgIGdhbWVwYWQsCiAgICAgICAgICBtYXAsCiAgICAgICAgICBwcm9maWxlczogcHJvZmlsZXMgfHwgW2dhbWVwYWQuaWRdLAogICAgICAgICAgbWFwcGluZzogbWFwLm1hcHBpbmcgfHwgZ2FtZXBhZC5tYXBwaW5nLAogICAgICAgICAgYXhlcywKICAgICAgICAgIGJ1dHRvbnMsCiAgICAgICAgICBncmlwVHJhbnNmb3JtLAogICAgICAgICAgdGFyZ2V0UmF5VHJhbnNmb3JtLAogICAgICAgIH07CiAgICAgICAgdGhpcy5fdXBkYXRlKCk7CiAgICAgIH0KICAgICAgX3VwZGF0ZSgpIHsKICAgICAgICBsZXQgZ2FtZXBhZCA9IHRoaXNbUFJJVkFURSQxOF0uZ2FtZXBhZDsKICAgICAgICBsZXQgbWFwID0gdGhpc1tQUklWQVRFJDE4XS5tYXA7CiAgICAgICAgbGV0IGF4ZXMgPSB0aGlzW1BSSVZBVEUkMThdLmF4ZXM7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAobWFwLmF4ZXMgJiYgaSBpbiBtYXAuYXhlcykgewogICAgICAgICAgICBpZiAobWFwLmF4ZXNbaV0gPT09IG51bGwpIHsKICAgICAgICAgICAgICBheGVzW2ldID0gMDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBheGVzW2ldID0gZ2FtZXBhZC5heGVzW21hcC5heGVzW2ldXTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXhlc1tpXSA9IGdhbWVwYWQuYXhlc1tpXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1hcC5heGVzICYmIG1hcC5heGVzLmludmVydCkgewogICAgICAgICAgZm9yIChsZXQgYXhpcyBvZiBtYXAuYXhlcy5pbnZlcnQpIHsKICAgICAgICAgICAgaWYgKGF4aXMgPCBheGVzLmxlbmd0aCkgewogICAgICAgICAgICAgIGF4ZXNbYXhpc10gKj0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGV0IGJ1dHRvbnMgPSB0aGlzW1BSSVZBVEUkMThdLmJ1dHRvbnM7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBpZiAobWFwLmJ1dHRvbnMgJiYgaSBpbiBtYXAuYnV0dG9ucykgewogICAgICAgICAgICBpZiAobWFwLmJ1dHRvbnNbaV0gPT09IG51bGwpIHsKICAgICAgICAgICAgICBidXR0b25zW2ldID0gUExBQ0VIT0xERVJfQlVUVE9OOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGJ1dHRvbnNbaV0gPSBnYW1lcGFkLmJ1dHRvbnNbbWFwLmJ1dHRvbnNbaV1dOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidXR0b25zW2ldID0gZ2FtZXBhZC5idXR0b25zW2ldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBnZXQgaWQoKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CiAgICAgIGdldCBfcHJvZmlsZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxOF0ucHJvZmlsZXM7CiAgICAgIH0KICAgICAgZ2V0IGluZGV4KCkgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICBnZXQgY29ubmVjdGVkKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMThdLmdhbWVwYWQuY29ubmVjdGVkOwogICAgICB9CiAgICAgIGdldCB0aW1lc3RhbXAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxOF0uZ2FtZXBhZC50aW1lc3RhbXA7CiAgICAgIH0KICAgICAgZ2V0IG1hcHBpbmcoKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbUFJJVkFURSQxOF0ubWFwcGluZzsKICAgICAgfQogICAgICBnZXQgYXhlcygpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE4XS5heGVzOwogICAgICB9CiAgICAgIGdldCBidXR0b25zKCkgewogICAgICAgIHJldHVybiB0aGlzW1BSSVZBVEUkMThdLmJ1dHRvbnM7CiAgICAgIH0KICAgICAgZ2V0IGhhcHRpY0FjdHVhdG9ycygpIHsKICAgICAgICByZXR1cm4gdGhpc1tQUklWQVRFJDE4XS5nYW1lcGFkLmhhcHRpY0FjdHVhdG9yczsKICAgICAgfQogICAgfQogICAgY2xhc3MgR2FtZXBhZFhSSW5wdXRTb3VyY2UgewogICAgICBjb25zdHJ1Y3Rvcihwb2x5ZmlsbCwgZGlzcGxheSwgcHJpbWFyeUJ1dHRvbkluZGV4ID0gMCwgcHJpbWFyeVNxdWVlemVCdXR0b25JbmRleCA9IC0xKSB7CiAgICAgICAgdGhpcy5wb2x5ZmlsbCA9IHBvbHlmaWxsOwogICAgICAgIHRoaXMuZGlzcGxheSA9IGRpc3BsYXk7CiAgICAgICAgdGhpcy5uYXRpdmVHYW1lcGFkID0gbnVsbDsKICAgICAgICB0aGlzLmdhbWVwYWQgPSBudWxsOwogICAgICAgIHRoaXMuaW5wdXRTb3VyY2UgPSBuZXcgWFJJbnB1dFNvdXJjZSh0aGlzKTsKICAgICAgICB0aGlzLmxhc3RQb3NpdGlvbiA9IGNyZWF0ZSQxKCk7CiAgICAgICAgdGhpcy5lbXVsYXRlZFBvc2l0aW9uID0gZmFsc2U7CiAgICAgICAgdGhpcy5iYXNlUG9zZU1hdHJpeCA9IGNyZWF0ZSgpOwogICAgICAgIHRoaXMub3V0cHV0TWF0cml4ID0gY3JlYXRlKCk7CiAgICAgICAgdGhpcy5wcmltYXJ5QnV0dG9uSW5kZXggPSBwcmltYXJ5QnV0dG9uSW5kZXg7CiAgICAgICAgdGhpcy5wcmltYXJ5QWN0aW9uUHJlc3NlZCA9IGZhbHNlOwogICAgICAgIHRoaXMucHJpbWFyeVNxdWVlemVCdXR0b25JbmRleCA9IHByaW1hcnlTcXVlZXplQnV0dG9uSW5kZXg7CiAgICAgICAgdGhpcy5wcmltYXJ5U3F1ZWV6ZUFjdGlvblByZXNzZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmhhbmRlZG5lc3MgPSAnJzsKICAgICAgICB0aGlzLnRhcmdldFJheU1vZGUgPSAnZ2F6ZSc7CiAgICAgICAgdGhpcy5hcm1Nb2RlbCA9IG51bGw7CiAgICAgIH0KICAgICAgZ2V0IHByb2ZpbGVzKCkgewogICAgICAgIHJldHVybiB0aGlzLmdhbWVwYWQgPyB0aGlzLmdhbWVwYWQuX3Byb2ZpbGVzIDogW107CiAgICAgIH0KICAgICAgdXBkYXRlRnJvbUdhbWVwYWQoZ2FtZXBhZCkgewogICAgICAgIGlmICh0aGlzLm5hdGl2ZUdhbWVwYWQgIT09IGdhbWVwYWQpIHsKICAgICAgICAgIHRoaXMubmF0aXZlR2FtZXBhZCA9IGdhbWVwYWQ7CiAgICAgICAgICBpZiAoZ2FtZXBhZCkgewogICAgICAgICAgICB0aGlzLmdhbWVwYWQgPSBuZXcgWFJSZW1hcHBlZEdhbWVwYWQoZ2FtZXBhZCwgdGhpcy5kaXNwbGF5LCBHYW1lcGFkTWFwcGluZ3NbZ2FtZXBhZC5pZF0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5nYW1lcGFkID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhpcy5oYW5kZWRuZXNzID0gZ2FtZXBhZC5oYW5kID09PSAnJyA/ICdub25lJyA6IGdhbWVwYWQuaGFuZDsKICAgICAgICBpZiAodGhpcy5nYW1lcGFkKSB7CiAgICAgICAgICB0aGlzLmdhbWVwYWQuX3VwZGF0ZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoZ2FtZXBhZC5wb3NlKSB7CiAgICAgICAgICB0aGlzLnRhcmdldFJheU1vZGUgPSAndHJhY2tlZC1wb2ludGVyJzsKICAgICAgICAgIHRoaXMuZW11bGF0ZWRQb3NpdGlvbiA9ICFnYW1lcGFkLnBvc2UuaGFzUG9zaXRpb247CiAgICAgICAgfSBlbHNlIGlmIChnYW1lcGFkLmhhbmQgPT09ICcnKSB7CiAgICAgICAgICB0aGlzLnRhcmdldFJheU1vZGUgPSAnZ2F6ZSc7CiAgICAgICAgICB0aGlzLmVtdWxhdGVkUG9zaXRpb24gPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdXBkYXRlQmFzZVBvc2VNYXRyaXgoKSB7CiAgICAgICAgaWYgKHRoaXMubmF0aXZlR2FtZXBhZCAmJiB0aGlzLm5hdGl2ZUdhbWVwYWQucG9zZSkgewogICAgICAgICAgbGV0IHBvc2UgPSB0aGlzLm5hdGl2ZUdhbWVwYWQucG9zZTsKICAgICAgICAgIGxldCBwb3NpdGlvbiA9IHBvc2UucG9zaXRpb247CiAgICAgICAgICBsZXQgb3JpZW50YXRpb24gPSBwb3NlLm9yaWVudGF0aW9uOwogICAgICAgICAgaWYgKCFwb3NpdGlvbiAmJiAhb3JpZW50YXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFwb3NpdGlvbikgewogICAgICAgICAgICBpZiAoIXBvc2UuaGFzUG9zaXRpb24pIHsKICAgICAgICAgICAgICBpZiAoIXRoaXMuYXJtTW9kZWwpIHsKICAgICAgICAgICAgICAgIHRoaXMuYXJtTW9kZWwgPSBuZXcgT3JpZW50YXRpb25Bcm1Nb2RlbCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmFybU1vZGVsLnNldEhhbmRlZG5lc3ModGhpcy5uYXRpdmVHYW1lcGFkLmhhbmQpOwogICAgICAgICAgICAgIHRoaXMuYXJtTW9kZWwudXBkYXRlKG9yaWVudGF0aW9uLCB0aGlzLnBvbHlmaWxsLmdldEJhc2VQb3NlTWF0cml4KCkpOwogICAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5hcm1Nb2RlbC5nZXRQb3NpdGlvbigpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHBvc2l0aW9uID0gdGhpcy5sYXN0UG9zaXRpb247CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uWzBdID0gcG9zaXRpb25bMF07CiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uWzFdID0gcG9zaXRpb25bMV07CiAgICAgICAgICAgIHRoaXMubGFzdFBvc2l0aW9uWzJdID0gcG9zaXRpb25bMl07CiAgICAgICAgICB9CiAgICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbih0aGlzLmJhc2VQb3NlTWF0cml4LCBvcmllbnRhdGlvbiwgcG9zaXRpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb3B5KHRoaXMuYmFzZVBvc2VNYXRyaXgsIHRoaXMucG9seWZpbGwuZ2V0QmFzZVBvc2VNYXRyaXgoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmJhc2VQb3NlTWF0cml4OwogICAgICB9CiAgICAgIGdldFhSUG9zZShjb29yZGluYXRlU3lzdGVtLCBwb3NlVHlwZSkgewogICAgICAgIHRoaXMudXBkYXRlQmFzZVBvc2VNYXRyaXgoKTsKICAgICAgICBzd2l0Y2gocG9zZVR5cGUpIHsKICAgICAgICAgIGNhc2UgInRhcmdldC1yYXkiOgogICAgICAgICAgICBjb29yZGluYXRlU3lzdGVtLl90cmFuc2Zvcm1CYXNlUG9zZU1hdHJpeCh0aGlzLm91dHB1dE1hdHJpeCwgdGhpcy5iYXNlUG9zZU1hdHJpeCk7CiAgICAgICAgICAgIGlmICh0aGlzLmdhbWVwYWQgJiYgdGhpcy5nYW1lcGFkW1BSSVZBVEUkMThdLnRhcmdldFJheVRyYW5zZm9ybSkgewogICAgICAgICAgICAgIG11bHRpcGx5KHRoaXMub3V0cHV0TWF0cml4LCB0aGlzLm91dHB1dE1hdHJpeCwgdGhpcy5nYW1lcGFkW1BSSVZBVEUkMThdLnRhcmdldFJheVRyYW5zZm9ybSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJncmlwIjoKICAgICAgICAgICAgaWYgKCF0aGlzLm5hdGl2ZUdhbWVwYWQgfHwgIXRoaXMubmF0aXZlR2FtZXBhZC5wb3NlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29vcmRpbmF0ZVN5c3RlbS5fdHJhbnNmb3JtQmFzZVBvc2VNYXRyaXgodGhpcy5vdXRwdXRNYXRyaXgsIHRoaXMuYmFzZVBvc2VNYXRyaXgpOwogICAgICAgICAgICBpZiAodGhpcy5nYW1lcGFkICYmIHRoaXMuZ2FtZXBhZFtQUklWQVRFJDE4XS5ncmlwVHJhbnNmb3JtKSB7CiAgICAgICAgICAgICAgbXVsdGlwbHkodGhpcy5vdXRwdXRNYXRyaXgsIHRoaXMub3V0cHV0TWF0cml4LCB0aGlzLmdhbWVwYWRbUFJJVkFURSQxOF0uZ3JpcFRyYW5zZm9ybSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgY29vcmRpbmF0ZVN5c3RlbS5fYWRqdXN0Rm9yT3JpZ2luT2Zmc2V0KHRoaXMub3V0cHV0TWF0cml4KTsKICAgICAgICByZXR1cm4gbmV3IFhSUG9zZShuZXcgWFJSaWdpZFRyYW5zZm9ybSh0aGlzLm91dHB1dE1hdHJpeCksIHRoaXMuZW11bGF0ZWRQb3NpdGlvbik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IEVYVFJBX1BSRVNFTlRBVElPTl9BVFRSSUJVVEVTID0gewogICAgICBoaWdoUmVmcmVzaFJhdGU6IHRydWUsCiAgICB9OwogICAgY29uc3QgUFJJTUFSWV9CVVRUT05fTUFQID0gewogICAgICBvY3VsdXM6IDEsCiAgICAgIG9wZW52cjogMSwKICAgICAgJ3NwYXRpYWwgY29udHJvbGxlciAoc3BhdGlhbCBpbnRlcmFjdGlvbiBzb3VyY2UpJzogMQogICAgfTsKICAgIGxldCBTRVNTSU9OX0lEID0gMDsKICAgIGNsYXNzIFNlc3Npb24gewogICAgICBjb25zdHJ1Y3Rvcihtb2RlLCBlbmFibGVkRmVhdHVyZXMsIHBvbHlmaWxsT3B0aW9ucz17fSkgewogICAgICAgIHRoaXMubW9kZSA9IG1vZGU7CiAgICAgICAgdGhpcy5lbmFibGVkRmVhdHVyZXMgPSBlbmFibGVkRmVhdHVyZXM7CiAgICAgICAgdGhpcy5vdXRwdXRDb250ZXh0ID0gbnVsbDsKICAgICAgICB0aGlzLmltbWVyc2l2ZSA9IG1vZGUgPT0gJ2ltbWVyc2l2ZS12cicgfHwgbW9kZSA9PSAnaW1tZXJzaXZlLWFyJzsKICAgICAgICB0aGlzLmVuZGVkID0gbnVsbDsKICAgICAgICB0aGlzLmJhc2VMYXllciA9IG51bGw7CiAgICAgICAgdGhpcy5pZCA9ICsrU0VTU0lPTl9JRDsKICAgICAgICB0aGlzLm1vZGlmaWVkQ2FudmFzTGF5ZXIgPSBmYWxzZTsKICAgICAgICBpZiAodGhpcy5vdXRwdXRDb250ZXh0ICYmIHRydWUpIHsKICAgICAgICAgIGNvbnN0IHJlbmRlckNvbnRleHRUeXBlID0gcG9seWZpbGxPcHRpb25zLnJlbmRlckNvbnRleHRUeXBlIHx8ICcyZCc7CiAgICAgICAgICB0aGlzLnJlbmRlckNvbnRleHQgPSB0aGlzLm91dHB1dENvbnRleHQuY2FudmFzLmdldENvbnRleHQocmVuZGVyQ29udGV4dFR5cGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY2xhc3MgV2ViVlJEZXZpY2UgZXh0ZW5kcyBYUkRldmljZSB7CiAgICAgIGNvbnN0cnVjdG9yKGdsb2JhbCwgZGlzcGxheSkgewogICAgICAgIGNvbnN0IHsgY2FuUHJlc2VudCB9ID0gZGlzcGxheS5jYXBhYmlsaXRpZXM7CiAgICAgICAgc3VwZXIoZ2xvYmFsKTsKICAgICAgICB0aGlzLmRpc3BsYXkgPSBkaXNwbGF5OwogICAgICAgIHRoaXMuZnJhbWUgPSBuZXcgZ2xvYmFsLlZSRnJhbWVEYXRhKCk7CiAgICAgICAgdGhpcy5zZXNzaW9ucyA9IG5ldyBNYXAoKTsKICAgICAgICB0aGlzLmltbWVyc2l2ZVNlc3Npb24gPSBudWxsOwogICAgICAgIHRoaXMuY2FuUHJlc2VudCA9IGNhblByZXNlbnQ7CiAgICAgICAgdGhpcy5iYXNlTW9kZWxNYXRyaXggPSBjcmVhdGUoKTsKICAgICAgICB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXMgPSB7fTsKICAgICAgICB0aGlzLnRlbXBWZWMzID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgICAgICB0aGlzLm9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSA9IHRoaXMub25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlLmJpbmQodGhpcyk7CiAgICAgICAgZ2xvYmFsLndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgdGhpcy5vblZSRGlzcGxheVByZXNlbnRDaGFuZ2UpOwogICAgICAgIHRoaXMuQ0FOX1VTRV9HQU1FUEFEID0gZ2xvYmFsLm5hdmlnYXRvciAmJiAoJ2dldEdhbWVwYWRzJyBpbiBnbG9iYWwubmF2aWdhdG9yKTsKICAgICAgICB0aGlzLkhBU19CSVRNQVBfU1VQUE9SVCA9IGlzSW1hZ2VCaXRtYXBTdXBwb3J0ZWQoZ2xvYmFsKTsKICAgICAgfQogICAgICBnZXQgZGVwdGhOZWFyKCkgeyByZXR1cm4gdGhpcy5kaXNwbGF5LmRlcHRoTmVhcjsgfQogICAgICBzZXQgZGVwdGhOZWFyKHZhbCkgeyB0aGlzLmRpc3BsYXkuZGVwdGhOZWFyID0gdmFsOyB9CiAgICAgIGdldCBkZXB0aEZhcigpIHsgcmV0dXJuIHRoaXMuZGlzcGxheS5kZXB0aEZhcjsgfQogICAgICBzZXQgZGVwdGhGYXIodmFsKSB7IHRoaXMuZGlzcGxheS5kZXB0aEZhciA9IHZhbDsgfQogICAgICBvbkJhc2VMYXllclNldChzZXNzaW9uSWQsIGxheWVyKSB7CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7CiAgICAgICAgY29uc3QgY2FudmFzID0gbGF5ZXIuY29udGV4dC5jYW52YXM7CiAgICAgICAgaWYgKHNlc3Npb24uaW1tZXJzaXZlKSB7CiAgICAgICAgICBjb25zdCBsZWZ0ID0gdGhpcy5kaXNwbGF5LmdldEV5ZVBhcmFtZXRlcnMoJ2xlZnQnKTsKICAgICAgICAgIGNvbnN0IHJpZ2h0ID0gdGhpcy5kaXNwbGF5LmdldEV5ZVBhcmFtZXRlcnMoJ3JpZ2h0Jyk7CiAgICAgICAgICBjYW52YXMud2lkdGggPSBNYXRoLm1heChsZWZ0LnJlbmRlcldpZHRoLCByaWdodC5yZW5kZXJXaWR0aCkgKiAyOwogICAgICAgICAgY2FudmFzLmhlaWdodCA9IE1hdGgubWF4KGxlZnQucmVuZGVySGVpZ2h0LCByaWdodC5yZW5kZXJIZWlnaHQpOwogICAgICAgICAgdGhpcy5kaXNwbGF5LnJlcXVlc3RQcmVzZW50KFt7CiAgICAgICAgICAgICAgc291cmNlOiBjYW52YXMsIGF0dHJpYnV0ZXM6IEVYVFJBX1BSRVNFTlRBVElPTl9BVFRSSUJVVEVTCiAgICAgICAgICAgIH1dKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgaWYgKCF0aGlzLmdsb2JhbC5kb2N1bWVudC5ib2R5LmNvbnRhaW5zKGNhbnZhcykpIHsKICAgICAgICAgICAgICBzZXNzaW9uLm1vZGlmaWVkQ2FudmFzTGF5ZXIgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuZ2xvYmFsLmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY2FudmFzKTsKICAgICAgICAgICAgICBhcHBseUNhbnZhc1N0eWxlc0Zvck1pbmltYWxSZW5kZXJpbmcoY2FudmFzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzZXNzaW9uLmJhc2VMYXllciA9IGxheWVyOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgc2Vzc2lvbi5iYXNlTGF5ZXIgPSBsYXllcjsKICAgICAgICB9CiAgICAgIH0KICAgICAgaXNTZXNzaW9uU3VwcG9ydGVkKG1vZGUpIHsKICAgICAgICBpZiAobW9kZSA9PSAnaW1tZXJzaXZlLWFyJykgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAobW9kZSA9PSAnaW1tZXJzaXZlLXZyJyAmJiB0aGlzLmNhblByZXNlbnQgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlzRmVhdHVyZVN1cHBvcnRlZChmZWF0dXJlRGVzY3JpcHRvcikgewogICAgICAgIHN3aXRjaChmZWF0dXJlRGVzY3JpcHRvcikgewogICAgICAgICAgY2FzZSAndmlld2VyJzogcmV0dXJuIHRydWU7CiAgICAgICAgICBjYXNlICdsb2NhbCc6IHJldHVybiB0cnVlOwogICAgICAgICAgY2FzZSAnbG9jYWwtZmxvb3InOiByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGNhc2UgJ2JvdW5kZWQnOiByZXR1cm4gZmFsc2U7CiAgICAgICAgICBjYXNlICd1bmJvdW5kZWQnOiByZXR1cm4gZmFsc2U7CiAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGFzeW5jIHJlcXVlc3RTZXNzaW9uKG1vZGUsIGVuYWJsZWRGZWF0dXJlcykgewogICAgICAgIGlmICghdGhpcy5pc1Nlc3Npb25TdXBwb3J0ZWQobW9kZSkpIHsKICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgpOwogICAgICAgIH0KICAgICAgICBsZXQgaW1tZXJzaXZlID0gbW9kZSA9PSAnaW1tZXJzaXZlLXZyJzsKICAgICAgICBpZiAoaW1tZXJzaXZlKSB7CiAgICAgICAgICBjb25zdCBjYW52YXMgPSB0aGlzLmdsb2JhbC5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICAgIHsKICAgICAgICAgICAgY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7CiAgICAgICAgICB9CiAgICAgICAgICBhd2FpdCB0aGlzLmRpc3BsYXkucmVxdWVzdFByZXNlbnQoW3sKICAgICAgICAgICAgICBzb3VyY2U6IGNhbnZhcywgYXR0cmlidXRlczogRVhUUkFfUFJFU0VOVEFUSU9OX0FUVFJJQlVURVMgfV0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBzZXNzaW9uID0gbmV3IFNlc3Npb24obW9kZSwgZW5hYmxlZEZlYXR1cmVzLCB7CiAgICAgICAgICByZW5kZXJDb250ZXh0VHlwZTogdGhpcy5IQVNfQklUTUFQX1NVUFBPUlQgPyAnYml0bWFwcmVuZGVyZXInIDogJzJkJwogICAgICAgIH0pOwogICAgICAgIHRoaXMuc2Vzc2lvbnMuc2V0KHNlc3Npb24uaWQsIHNlc3Npb24pOwogICAgICAgIGlmIChpbW1lcnNpdmUpIHsKICAgICAgICAgIHRoaXMuaW1tZXJzaXZlU2Vzc2lvbiA9IHNlc3Npb247CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ0BAd2VieHItcG9seWZpbGwvdnItcHJlc2VudC1zdGFydCcsIHNlc3Npb24uaWQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHNlc3Npb24uaWQpOwogICAgICB9CiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjaykgewogICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXkucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrKTsKICAgICAgfQogICAgICBnZXRQcmltYXJ5QnV0dG9uSW5kZXgoZ2FtZXBhZCkgewogICAgICAgIGxldCBwcmltYXJ5QnV0dG9uID0gMDsKICAgICAgICBsZXQgbmFtZSA9IGdhbWVwYWQuaWQudG9Mb3dlckNhc2UoKTsKICAgICAgICBmb3IgKGxldCBrZXkgaW4gUFJJTUFSWV9CVVRUT05fTUFQKSB7CiAgICAgICAgICBpZiAobmFtZS5pbmNsdWRlcyhrZXkpKSB7CiAgICAgICAgICAgIHByaW1hcnlCdXR0b24gPSBQUklNQVJZX0JVVFRPTl9NQVBba2V5XTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBNYXRoLm1pbihwcmltYXJ5QnV0dG9uLCBnYW1lcGFkLmJ1dHRvbnMubGVuZ3RoIC0gMSk7CiAgICAgIH0KICAgICAgb25GcmFtZVN0YXJ0KHNlc3Npb25JZCwgcmVuZGVyU3RhdGUpIHsKICAgICAgICB0aGlzLmRpc3BsYXkuZGVwdGhOZWFyID0gcmVuZGVyU3RhdGUuZGVwdGhOZWFyOwogICAgICAgIHRoaXMuZGlzcGxheS5kZXB0aEZhciA9IHJlbmRlclN0YXRlLmRlcHRoRmFyOwogICAgICAgIHRoaXMuZGlzcGxheS5nZXRGcmFtZURhdGEodGhpcy5mcmFtZSk7CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7CiAgICAgICAgaWYgKHNlc3Npb24uaW1tZXJzaXZlICYmIHRoaXMuQ0FOX1VTRV9HQU1FUEFEKSB7CiAgICAgICAgICBsZXQgcHJldklucHV0U291cmNlcyA9IHRoaXMuZ2FtZXBhZElucHV0U291cmNlczsKICAgICAgICAgIHRoaXMuZ2FtZXBhZElucHV0U291cmNlcyA9IHt9OwogICAgICAgICAgbGV0IGdhbWVwYWRzID0gdGhpcy5nbG9iYWwubmF2aWdhdG9yLmdldEdhbWVwYWRzKCk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdhbWVwYWRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgIGxldCBnYW1lcGFkID0gZ2FtZXBhZHNbaV07CiAgICAgICAgICAgIGlmIChnYW1lcGFkICYmIGdhbWVwYWQuZGlzcGxheUlkID4gMCkgewogICAgICAgICAgICAgIGxldCBpbnB1dFNvdXJjZUltcGwgPSBwcmV2SW5wdXRTb3VyY2VzW2ldOwogICAgICAgICAgICAgIGlmICghaW5wdXRTb3VyY2VJbXBsKSB7CiAgICAgICAgICAgICAgICBpbnB1dFNvdXJjZUltcGwgPSBuZXcgR2FtZXBhZFhSSW5wdXRTb3VyY2UodGhpcywgdGhpcy5kaXNwbGF5LCB0aGlzLmdldFByaW1hcnlCdXR0b25JbmRleChnYW1lcGFkKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlucHV0U291cmNlSW1wbC51cGRhdGVGcm9tR2FtZXBhZChnYW1lcGFkKTsKICAgICAgICAgICAgICB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXNbaV0gPSBpbnB1dFNvdXJjZUltcGw7CiAgICAgICAgICAgICAgaWYgKGlucHV0U291cmNlSW1wbC5wcmltYXJ5QnV0dG9uSW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgICAgIGxldCBwcmltYXJ5QWN0aW9uUHJlc3NlZCA9IGdhbWVwYWQuYnV0dG9uc1tpbnB1dFNvdXJjZUltcGwucHJpbWFyeUJ1dHRvbkluZGV4XS5wcmVzc2VkOwogICAgICAgICAgICAgICAgaWYgKHByaW1hcnlBY3Rpb25QcmVzc2VkICYmICFpbnB1dFNvdXJjZUltcGwucHJpbWFyeUFjdGlvblByZXNzZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNlbGVjdC1zdGFydCcsIHsgc2Vzc2lvbklkOiBzZXNzaW9uLmlkLCBpbnB1dFNvdXJjZTogaW5wdXRTb3VyY2VJbXBsLmlucHV0U291cmNlIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghcHJpbWFyeUFjdGlvblByZXNzZWQgJiYgaW5wdXRTb3VyY2VJbXBsLnByaW1hcnlBY3Rpb25QcmVzc2VkKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnQEB3ZWJ4ci1wb2x5ZmlsbC9pbnB1dC1zZWxlY3QtZW5kJywgeyBzZXNzaW9uSWQ6IHNlc3Npb24uaWQsIGlucHV0U291cmNlOiBpbnB1dFNvdXJjZUltcGwuaW5wdXRTb3VyY2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbnB1dFNvdXJjZUltcGwucHJpbWFyeUFjdGlvblByZXNzZWQgPSBwcmltYXJ5QWN0aW9uUHJlc3NlZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGlucHV0U291cmNlSW1wbC5wcmltYXJ5U3F1ZWV6ZUJ1dHRvbkluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICBsZXQgcHJpbWFyeVNxdWVlemVBY3Rpb25QcmVzc2VkID0gZ2FtZXBhZC5idXR0b25zW2lucHV0U291cmNlSW1wbC5wcmltYXJ5U3F1ZWV6ZUJ1dHRvbkluZGV4XS5wcmVzc2VkOwogICAgICAgICAgICAgICAgaWYgKHByaW1hcnlTcXVlZXplQWN0aW9uUHJlc3NlZCAmJiAhaW5wdXRTb3VyY2VJbXBsLnByaW1hcnlTcXVlZXplQWN0aW9uUHJlc3NlZCkgewogICAgICAgICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoJ0BAd2VieHItcG9seWZpbGwvaW5wdXQtc3F1ZWV6ZS1zdGFydCcsIHsgc2Vzc2lvbklkOiBzZXNzaW9uLmlkLCBpbnB1dFNvdXJjZTogaW5wdXRTb3VyY2VJbXBsLmlucHV0U291cmNlIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghcHJpbWFyeVNxdWVlemVBY3Rpb25QcmVzc2VkICYmIGlucHV0U291cmNlSW1wbC5wcmltYXJ5U3F1ZWV6ZUFjdGlvblByZXNzZWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KCdAQHdlYnhyLXBvbHlmaWxsL2lucHV0LXNxdWVlemUtZW5kJywgeyBzZXNzaW9uSWQ6IHNlc3Npb24uaWQsIGlucHV0U291cmNlOiBpbnB1dFNvdXJjZUltcGwuaW5wdXRTb3VyY2UgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpbnB1dFNvdXJjZUltcGwucHJpbWFyeVNxdWVlemVBY3Rpb25QcmVzc2VkID0gcHJpbWFyeVNxdWVlemVBY3Rpb25QcmVzc2VkOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIXNlc3Npb24uaW1tZXJzaXZlICYmIHNlc3Npb24uYmFzZUxheWVyKSB7CiAgICAgICAgICBjb25zdCBjYW52YXMgPSBzZXNzaW9uLmJhc2VMYXllci5jb250ZXh0LmNhbnZhczsKICAgICAgICAgIHBlcnNwZWN0aXZlKHRoaXMuZnJhbWUubGVmdFByb2plY3Rpb25NYXRyaXgsIHJlbmRlclN0YXRlLmlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcsCiAgICAgICAgICAgICAgY2FudmFzLndpZHRoL2NhbnZhcy5oZWlnaHQsIHJlbmRlclN0YXRlLmRlcHRoTmVhciwgcmVuZGVyU3RhdGUuZGVwdGhGYXIpOwogICAgICAgIH0KICAgICAgfQogICAgICBvbkZyYW1lRW5kKHNlc3Npb25JZCkgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGlmIChzZXNzaW9uLmVuZGVkIHx8ICFzZXNzaW9uLmJhc2VMYXllcikgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvbi5vdXRwdXRDb250ZXh0ICYmCiAgICAgICAgICAgICEoc2Vzc2lvbi5pbW1lcnNpdmUgJiYgIXRoaXMuZGlzcGxheS5jYXBhYmlsaXRpZXMuaGFzRXh0ZXJuYWxEaXNwbGF5KSkgewogICAgICAgICAgY29uc3QgbWlycm9yaW5nID0KICAgICAgICAgICAgc2Vzc2lvbi5pbW1lcnNpdmUgJiYgdGhpcy5kaXNwbGF5LmNhcGFiaWxpdGllcy5oYXNFeHRlcm5hbERpc3BsYXk7CiAgICAgICAgICBjb25zdCBpQ2FudmFzID0gc2Vzc2lvbi5iYXNlTGF5ZXIuY29udGV4dC5jYW52YXM7CiAgICAgICAgICBjb25zdCBpV2lkdGggPSBtaXJyb3JpbmcgPyBpQ2FudmFzLndpZHRoIC8gMiA6IGlDYW52YXMud2lkdGg7CiAgICAgICAgICBjb25zdCBpSGVpZ2h0ID0gaUNhbnZhcy5oZWlnaHQ7CiAgICAgICAgICB7CiAgICAgICAgICAgIGNvbnN0IG9DYW52YXMgPSBzZXNzaW9uLm91dHB1dENvbnRleHQuY2FudmFzOwogICAgICAgICAgICBjb25zdCBvV2lkdGggPSBvQ2FudmFzLndpZHRoOwogICAgICAgICAgICBjb25zdCBvSGVpZ2h0ID0gb0NhbnZhcy5oZWlnaHQ7CiAgICAgICAgICAgIGNvbnN0IHJlbmRlckNvbnRleHQgPSBzZXNzaW9uLnJlbmRlckNvbnRleHQ7CiAgICAgICAgICAgIGlmICh0aGlzLkhBU19CSVRNQVBfU1VQUE9SVCkgewogICAgICAgICAgICAgIGlmIChpQ2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCkgewogICAgICAgICAgICAgICAgcmVuZGVyQ29udGV4dC50cmFuc2ZlckZyb21JbWFnZUJpdG1hcChpQ2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbC5jcmVhdGVJbWFnZUJpdG1hcChpQ2FudmFzLCAwLCAwLCBpV2lkdGgsIGlIZWlnaHQsIHsKICAgICAgICAgICAgICAgICAgcmVzaXplV2lkdGg6IG9XaWR0aCwKICAgICAgICAgICAgICAgICAgcmVzaXplSGVpZ2h0OiBvSGVpZ2h0LAogICAgICAgICAgICAgICAgfSkudGhlbihiaXRtYXAgPT4gcmVuZGVyQ29udGV4dC50cmFuc2ZlckZyb21JbWFnZUJpdG1hcChiaXRtYXApKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmVuZGVyQ29udGV4dC5kcmF3SW1hZ2UoaUNhbnZhcywgMCwgMCwgaVdpZHRoLCBpSGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsIDAsIG9XaWR0aCwgb0hlaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHNlc3Npb24uaW1tZXJzaXZlICYmIHNlc3Npb24uYmFzZUxheWVyKSB7CiAgICAgICAgICB0aGlzLmRpc3BsYXkuc3VibWl0RnJhbWUoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoaGFuZGxlKSB7CiAgICAgICAgdGhpcy5kaXNwbGF5LmNhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZSk7CiAgICAgIH0KICAgICAgYXN5bmMgZW5kU2Vzc2lvbihzZXNzaW9uSWQpIHsKICAgICAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5zZXNzaW9ucy5nZXQoc2Vzc2lvbklkKTsKICAgICAgICBpZiAoc2Vzc2lvbi5lbmRlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoc2Vzc2lvbi5pbW1lcnNpdmUpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmRpc3BsYXkuZXhpdFByZXNlbnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2Vzc2lvbi5lbmRlZCA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGRvZXNTZXNzaW9uU3VwcG9ydFJlZmVyZW5jZVNwYWNlKHNlc3Npb25JZCwgdHlwZSkgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGlmIChzZXNzaW9uLmVuZGVkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXNzaW9uLmVuYWJsZWRGZWF0dXJlcy5oYXModHlwZSk7CiAgICAgIH0KICAgICAgcmVxdWVzdFN0YWdlQm91bmRzKCkgewogICAgICAgIGlmICh0aGlzLmRpc3BsYXkuc3RhZ2VQYXJhbWV0ZXJzKSB7CiAgICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMuZGlzcGxheS5zdGFnZVBhcmFtZXRlcnMuc2l6ZVg7CiAgICAgICAgICBjb25zdCBkZXB0aCA9IHRoaXMuZGlzcGxheS5zdGFnZVBhcmFtZXRlcnMuc2l6ZVo7CiAgICAgICAgICBjb25zdCBkYXRhID0gW107CiAgICAgICAgICBkYXRhLnB1c2goLXdpZHRoIC8gMik7CiAgICAgICAgICBkYXRhLnB1c2goLWRlcHRoIC8gMik7CiAgICAgICAgICBkYXRhLnB1c2god2lkdGggLyAyKTsKICAgICAgICAgIGRhdGEucHVzaCgtZGVwdGggLyAyKTsKICAgICAgICAgIGRhdGEucHVzaCh3aWR0aCAvIDIpOwogICAgICAgICAgZGF0YS5wdXNoKGRlcHRoIC8gMik7CiAgICAgICAgICBkYXRhLnB1c2goLXdpZHRoIC8gMik7CiAgICAgICAgICBkYXRhLnB1c2goZGVwdGggLyAyKTsKICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBhc3luYyByZXF1ZXN0RnJhbWVPZlJlZmVyZW5jZVRyYW5zZm9ybSh0eXBlLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKCh0eXBlID09PSAnbG9jYWwtZmxvb3InIHx8IHR5cGUgPT09ICdib3VuZGVkLWZsb29yJykgJiYKICAgICAgICAgICAgdGhpcy5kaXNwbGF5LnN0YWdlUGFyYW1ldGVycyAmJgogICAgICAgICAgICB0aGlzLmRpc3BsYXkuc3RhZ2VQYXJhbWV0ZXJzLnNpdHRpbmdUb1N0YW5kaW5nVHJhbnNmb3JtKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5kaXNwbGF5LnN0YWdlUGFyYW1ldGVycy5zaXR0aW5nVG9TdGFuZGluZ1RyYW5zZm9ybTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgZ2V0UHJvamVjdGlvbk1hdHJpeChleWUpIHsKICAgICAgICBpZiAoZXllID09PSAnbGVmdCcpIHsKICAgICAgICAgIHJldHVybiB0aGlzLmZyYW1lLmxlZnRQcm9qZWN0aW9uTWF0cml4OwogICAgICAgIH0gZWxzZSBpZiAoZXllID09PSAncmlnaHQnKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5mcmFtZS5yaWdodFByb2plY3Rpb25NYXRyaXg7CiAgICAgICAgfSBlbHNlIGlmIChleWUgPT09ICdub25lJykgewogICAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWUubGVmdFByb2plY3Rpb25NYXRyaXg7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgZXllIG11c3QgYmUgb2YgdHlwZSAnbGVmdCcgb3IgJ3JpZ2h0J2ApOwogICAgICAgIH0KICAgICAgfQogICAgICBnZXRWaWV3cG9ydChzZXNzaW9uSWQsIGV5ZSwgbGF5ZXIsIHRhcmdldCkgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gbGF5ZXIuY29udGV4dC5jYW52YXM7CiAgICAgICAgaWYgKCFzZXNzaW9uLmltbWVyc2l2ZSkgewogICAgICAgICAgdGFyZ2V0LnggPSB0YXJnZXQueSA9IDA7CiAgICAgICAgICB0YXJnZXQud2lkdGggPSB3aWR0aDsKICAgICAgICAgIHRhcmdldC5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGV5ZSA9PT0gJ2xlZnQnIHx8IGV5ZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICB0YXJnZXQueCA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChleWUgPT09ICdyaWdodCcpIHsKICAgICAgICAgIHRhcmdldC54ID0gd2lkdGggLyAyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQud2lkdGggPSB3aWR0aCAvIDI7CiAgICAgICAgdGFyZ2V0LmhlaWdodCA9IGhlaWdodDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBnZXRCYXNlUG9zZU1hdHJpeCgpIHsKICAgICAgICBsZXQgeyBwb3NpdGlvbiwgb3JpZW50YXRpb24gfSA9IHRoaXMuZnJhbWUucG9zZTsKICAgICAgICBpZiAoIXBvc2l0aW9uICYmICFvcmllbnRhdGlvbikgewogICAgICAgICAgcmV0dXJuIHRoaXMuYmFzZU1vZGVsTWF0cml4OwogICAgICAgIH0KICAgICAgICBpZiAoIXBvc2l0aW9uKSB7CiAgICAgICAgICBwb3NpdGlvbiA9IHRoaXMudGVtcFZlYzM7CiAgICAgICAgICBwb3NpdGlvblswXSA9IHBvc2l0aW9uWzFdID0gcG9zaXRpb25bMl0gPSAwOwogICAgICAgIH0KICAgICAgICBmcm9tUm90YXRpb25UcmFuc2xhdGlvbih0aGlzLmJhc2VNb2RlbE1hdHJpeCwgb3JpZW50YXRpb24sIHBvc2l0aW9uKTsKICAgICAgICByZXR1cm4gdGhpcy5iYXNlTW9kZWxNYXRyaXg7CiAgICAgIH0KICAgICAgZ2V0QmFzZVZpZXdNYXRyaXgoZXllKSB7CiAgICAgICAgaWYgKGV5ZSA9PT0gJ2xlZnQnIHx8IGV5ZSA9PT0gJ25vbmUnKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5mcmFtZS5sZWZ0Vmlld01hdHJpeDsKICAgICAgICB9IGVsc2UgaWYgKGV5ZSA9PT0gJ3JpZ2h0JykgewogICAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWUucmlnaHRWaWV3TWF0cml4OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGV5ZSBtdXN0IGJlIG9mIHR5cGUgJ2xlZnQnIG9yICdyaWdodCdgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZ2V0SW5wdXRTb3VyY2VzKCkgewogICAgICAgIGxldCBpbnB1dFNvdXJjZXMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpIGluIHRoaXMuZ2FtZXBhZElucHV0U291cmNlcykgewogICAgICAgICAgaW5wdXRTb3VyY2VzLnB1c2godGhpcy5nYW1lcGFkSW5wdXRTb3VyY2VzW2ldLmlucHV0U291cmNlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGlucHV0U291cmNlczsKICAgICAgfQogICAgICBnZXRJbnB1dFBvc2UoaW5wdXRTb3VyY2UsIGNvb3JkaW5hdGVTeXN0ZW0sIHBvc2VUeXBlKSB7CiAgICAgICAgaWYgKCFjb29yZGluYXRlU3lzdGVtKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXMpIHsKICAgICAgICAgIGxldCBpbnB1dFNvdXJjZUltcGwgPSB0aGlzLmdhbWVwYWRJbnB1dFNvdXJjZXNbaV07CiAgICAgICAgICBpZiAoaW5wdXRTb3VyY2VJbXBsLmlucHV0U291cmNlID09PSBpbnB1dFNvdXJjZSkgewogICAgICAgICAgICByZXR1cm4gaW5wdXRTb3VyY2VJbXBsLmdldFhSUG9zZShjb29yZGluYXRlU3lzdGVtLCBwb3NlVHlwZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIG9uV2luZG93UmVzaXplKCkgewogICAgICB9CiAgICAgIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZShlKSB7CiAgICAgICAgaWYgKCF0aGlzLmRpc3BsYXkuaXNQcmVzZW50aW5nKSB7CiAgICAgICAgICB0aGlzLnNlc3Npb25zLmZvckVhY2goc2Vzc2lvbiA9PiB7CiAgICAgICAgICAgIGlmIChzZXNzaW9uLmltbWVyc2l2ZSAmJiAhc2Vzc2lvbi5lbmRlZCkgewogICAgICAgICAgICAgIGlmIChzZXNzaW9uLm1vZGlmaWVkQ2FudmFzTGF5ZXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhbnZhcyA9IHNlc3Npb24uYmFzZUxheWVyLmNvbnRleHQuY2FudmFzOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChjYW52YXMpOwogICAgICAgICAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0aGlzLmltbWVyc2l2ZVNlc3Npb24gPT09IHNlc3Npb24pIHsKICAgICAgICAgICAgICAgIHRoaXMuaW1tZXJzaXZlU2Vzc2lvbiA9IG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCgnQEB3ZWJ4ci1wb2x5ZmlsbC92ci1wcmVzZW50LWVuZCcsIHNlc3Npb24uaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBDYXJkYm9hcmRYUkRldmljZSBleHRlbmRzIFdlYlZSRGV2aWNlIHsKICAgICAgY29uc3RydWN0b3IoZ2xvYmFsLCBjYXJkYm9hcmRDb25maWcpIHsKICAgICAgICBjb25zdCBkaXNwbGF5ID0gbmV3IENhcmRib2FyZFZSRGlzcGxheShjYXJkYm9hcmRDb25maWcgfHwge30pOwogICAgICAgIHN1cGVyKGdsb2JhbCwgZGlzcGxheSk7CiAgICAgICAgdGhpcy5kaXNwbGF5ID0gZGlzcGxheTsKICAgICAgICB0aGlzLmZyYW1lID0gewogICAgICAgICAgcmlnaHRWaWV3TWF0cml4OiBuZXcgRmxvYXQzMkFycmF5KDE2KSwKICAgICAgICAgIGxlZnRWaWV3TWF0cml4OiBuZXcgRmxvYXQzMkFycmF5KDE2KSwKICAgICAgICAgIHJpZ2h0UHJvamVjdGlvbk1hdHJpeDogbmV3IEZsb2F0MzJBcnJheSgxNiksCiAgICAgICAgICBsZWZ0UHJvamVjdGlvbk1hdHJpeDogbmV3IEZsb2F0MzJBcnJheSgxNiksCiAgICAgICAgICBwb3NlOiBudWxsLAogICAgICAgICAgdGltZXN0YW1wOiBudWxsLAogICAgICAgIH07CiAgICAgIH0KICAgIH0KICAgIGxldCBTRVNTSU9OX0lEJDEgPSAwOwogICAgY2xhc3MgU2Vzc2lvbiQxIHsKICAgICAgY29uc3RydWN0b3IobW9kZSwgZW5hYmxlZEZlYXR1cmVzKSB7CiAgICAgICAgdGhpcy5tb2RlID0gbW9kZTsKICAgICAgICB0aGlzLmVuYWJsZWRGZWF0dXJlcyA9IGVuYWJsZWRGZWF0dXJlczsKICAgICAgICB0aGlzLmVuZGVkID0gbnVsbDsKICAgICAgICB0aGlzLmJhc2VMYXllciA9IG51bGw7CiAgICAgICAgdGhpcy5pZCA9ICsrU0VTU0lPTl9JRCQxOwogICAgICB9CiAgICB9CiAgICBjbGFzcyBJbmxpbmVEZXZpY2UgZXh0ZW5kcyBYUkRldmljZSB7CiAgICAgIGNvbnN0cnVjdG9yKGdsb2JhbCkgewogICAgICAgIHN1cGVyKGdsb2JhbCk7CiAgICAgICAgdGhpcy5zZXNzaW9ucyA9IG5ldyBNYXAoKTsKICAgICAgICB0aGlzLnByb2plY3Rpb25NYXRyaXggPSBjcmVhdGUoKTsKICAgICAgICB0aGlzLmlkZW50aXR5TWF0cml4ID0gY3JlYXRlKCk7CiAgICAgIH0KICAgICAgb25CYXNlTGF5ZXJTZXQoc2Vzc2lvbklkLCBsYXllcikgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIHNlc3Npb24uYmFzZUxheWVyID0gbGF5ZXI7CiAgICAgIH0KICAgICAgaXNTZXNzaW9uU3VwcG9ydGVkKG1vZGUpIHsKICAgICAgICByZXR1cm4gbW9kZSA9PSAnaW5saW5lJzsKICAgICAgfQogICAgICBpc0ZlYXR1cmVTdXBwb3J0ZWQoZmVhdHVyZURlc2NyaXB0b3IpIHsKICAgICAgICBzd2l0Y2goZmVhdHVyZURlc2NyaXB0b3IpIHsKICAgICAgICAgIGNhc2UgJ3ZpZXdlcic6IHJldHVybiB0cnVlOwogICAgICAgICAgZGVmYXVsdDogcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBhc3luYyByZXF1ZXN0U2Vzc2lvbihtb2RlLCBlbmFibGVkRmVhdHVyZXMpIHsKICAgICAgICBpZiAoIXRoaXMuaXNTZXNzaW9uU3VwcG9ydGVkKG1vZGUpKSB7CiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG5ldyBTZXNzaW9uJDEobW9kZSwgZW5hYmxlZEZlYXR1cmVzKTsKICAgICAgICB0aGlzLnNlc3Npb25zLnNldChzZXNzaW9uLmlkLCBzZXNzaW9uKTsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHNlc3Npb24uaWQpOwogICAgICB9CiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjaykgewogICAgICAgIHJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrKTsKICAgICAgfQogICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShoYW5kbGUpIHsKICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUoaGFuZGxlKTsKICAgICAgfQogICAgICBvbkZyYW1lU3RhcnQoc2Vzc2lvbklkLCByZW5kZXJTdGF0ZSkgewogICAgICAgIGNvbnN0IHNlc3Npb24gPSB0aGlzLnNlc3Npb25zLmdldChzZXNzaW9uSWQpOwogICAgICAgIGlmIChzZXNzaW9uLmJhc2VMYXllcikgewogICAgICAgICAgY29uc3QgY2FudmFzID0gc2Vzc2lvbi5iYXNlTGF5ZXIuY29udGV4dC5jYW52YXM7CiAgICAgICAgICBwZXJzcGVjdGl2ZSh0aGlzLnByb2plY3Rpb25NYXRyaXgsIHJlbmRlclN0YXRlLmlubGluZVZlcnRpY2FsRmllbGRPZlZpZXcsCiAgICAgICAgICAgICAgY2FudmFzLndpZHRoL2NhbnZhcy5oZWlnaHQsIHJlbmRlclN0YXRlLmRlcHRoTmVhciwgcmVuZGVyU3RhdGUuZGVwdGhGYXIpOwogICAgICAgIH0KICAgICAgfQogICAgICBvbkZyYW1lRW5kKHNlc3Npb25JZCkgewogICAgICB9CiAgICAgIGFzeW5jIGVuZFNlc3Npb24oc2Vzc2lvbklkKSB7CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7CiAgICAgICAgc2Vzc2lvbi5lbmRlZCA9IHRydWU7CiAgICAgIH0KICAgICAgZG9lc1Nlc3Npb25TdXBwb3J0UmVmZXJlbmNlU3BhY2Uoc2Vzc2lvbklkLCB0eXBlKSB7CiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7CiAgICAgICAgaWYgKHNlc3Npb24uZW5kZWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNlc3Npb24uZW5hYmxlZEZlYXR1cmVzLmhhcyh0eXBlKTsKICAgICAgfQogICAgICByZXF1ZXN0U3RhZ2VCb3VuZHMoKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgYXN5bmMgcmVxdWVzdEZyYW1lT2ZSZWZlcmVuY2VUcmFuc2Zvcm0odHlwZSwgb3B0aW9ucykgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGdldFByb2plY3Rpb25NYXRyaXgoZXllKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucHJvamVjdGlvbk1hdHJpeDsKICAgICAgfQogICAgICBnZXRWaWV3cG9ydChzZXNzaW9uSWQsIGV5ZSwgbGF5ZXIsIHRhcmdldCkgewogICAgICAgIHRoaXMuc2Vzc2lvbnMuZ2V0KHNlc3Npb25JZCk7CiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBsYXllci5jb250ZXh0LmNhbnZhczsKICAgICAgICB0YXJnZXQueCA9IHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQud2lkdGggPSB3aWR0aDsKICAgICAgICB0YXJnZXQuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGdldEJhc2VQb3NlTWF0cml4KCkgewogICAgICAgIHJldHVybiB0aGlzLmlkZW50aXR5TWF0cml4OwogICAgICB9CiAgICAgIGdldEJhc2VWaWV3TWF0cml4KGV5ZSkgewogICAgICAgIHJldHVybiB0aGlzLmlkZW50aXR5TWF0cml4OwogICAgICB9CiAgICAgIGdldElucHV0U291cmNlcygpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgICAgZ2V0SW5wdXRQb3NlKGlucHV0U291cmNlLCBjb29yZGluYXRlU3lzdGVtLCBwb3NlVHlwZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIG9uV2luZG93UmVzaXplKCkgewogICAgICB9CiAgICB9CgogICAgY29uc3QgZ2V0V2ViVlJEZXZpY2UgPSBhc3luYyBmdW5jdGlvbiAoZ2xvYmFsKSB7CiAgICAgIGxldCBkZXZpY2UgPSBudWxsOwogICAgICBpZiAoJ2dldFZSRGlzcGxheXMnIGluIGdsb2JhbC5uYXZpZ2F0b3IpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgZGlzcGxheXMgPSBhd2FpdCBnbG9iYWwubmF2aWdhdG9yLmdldFZSRGlzcGxheXMoKTsKICAgICAgICAgIGlmIChkaXNwbGF5cyAmJiBkaXNwbGF5cy5sZW5ndGgpIHsKICAgICAgICAgICAgZGV2aWNlID0gbmV3IFdlYlZSRGV2aWNlKGdsb2JhbCwgZGlzcGxheXNbMF0pOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgIH0KICAgICAgcmV0dXJuIGRldmljZTsKICAgIH07CiAgICBjb25zdCByZXF1ZXN0WFJEZXZpY2UgPSBhc3luYyBmdW5jdGlvbiAoZ2xvYmFsLCBjb25maWcpIHsKICAgICAgaWYgKGNvbmZpZy53ZWJ2cikgewogICAgICAgIGxldCB4ciA9IGF3YWl0IGdldFdlYlZSRGV2aWNlKGdsb2JhbCk7CiAgICAgICAgaWYgKHhyKSB7CiAgICAgICAgICByZXR1cm4geHI7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBtb2JpbGUgPSBpc01vYmlsZShnbG9iYWwpOwogICAgICBpZiAoKG1vYmlsZSAmJiBjb25maWcuY2FyZGJvYXJkKSB8fAogICAgICAgICAgKCFtb2JpbGUgJiYgY29uZmlnLmFsbG93Q2FyZGJvYXJkT25EZXNrdG9wKSkgewogICAgICAgIGlmICghZ2xvYmFsLlZSRnJhbWVEYXRhKSB7CiAgICAgICAgICBnbG9iYWwuVlJGcmFtZURhdGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMucmlnaHRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CiAgICAgICAgICAgIHRoaXMubGVmdFZpZXdNYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICAgICAgICAgICAgdGhpcy5yaWdodFByb2plY3Rpb25NYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKICAgICAgICAgICAgdGhpcy5sZWZ0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwogICAgICAgICAgICB0aGlzLnBvc2UgPSBudWxsOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG5ldyBDYXJkYm9hcmRYUkRldmljZShnbG9iYWwsIGNvbmZpZy5jYXJkYm9hcmRDb25maWcpOwogICAgICB9CiAgICAgIHJldHVybiBuZXcgSW5saW5lRGV2aWNlKGdsb2JhbCk7CiAgICB9OwoKICAgIGNvbnN0IENPTkZJR19ERUZBVUxUUyA9IHsKICAgICAgZ2xvYmFsOiBfZ2xvYmFsLAogICAgICB3ZWJ2cjogdHJ1ZSwKICAgICAgY2FyZGJvYXJkOiB0cnVlLAogICAgICBjYXJkYm9hcmRDb25maWc6IG51bGwsCiAgICAgIGFsbG93Q2FyZGJvYXJkT25EZXNrdG9wOiBmYWxzZSwKICAgIH07CiAgICBjb25zdCBwYXJ0aWFscyA9IFsnbmF2aWdhdG9yJywgJ0hUTUxDYW52YXNFbGVtZW50JywgJ1dlYkdMUmVuZGVyaW5nQ29udGV4dCddOwogICAgY2xhc3MgV2ViWFJQb2x5ZmlsbCB7CiAgICAgIGNvbnN0cnVjdG9yKGNvbmZpZz17fSkgewogICAgICAgIHRoaXMuY29uZmlnID0gT2JqZWN0LmZyZWV6ZShPYmplY3QuYXNzaWduKHt9LCBDT05GSUdfREVGQVVMVFMsIGNvbmZpZykpOwogICAgICAgIHRoaXMuZ2xvYmFsID0gdGhpcy5jb25maWcuZ2xvYmFsOwogICAgICAgIHRoaXMubmF0aXZlV2ViWFIgPSAneHInIGluIHRoaXMuZ2xvYmFsLm5hdmlnYXRvcjsKICAgICAgICB0aGlzLmluamVjdGVkID0gZmFsc2U7CiAgICAgICAgaWYgKCF0aGlzLm5hdGl2ZVdlYlhSKSB7CiAgICAgICAgICB0aGlzLl9pbmplY3RQb2x5ZmlsbCh0aGlzLmdsb2JhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuX2luamVjdENvbXBhdGliaWxpdHlTaGltcyh0aGlzLmdsb2JhbCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIF9pbmplY3RQb2x5ZmlsbChnbG9iYWwpIHsKICAgICAgICBpZiAoIXBhcnRpYWxzLmV2ZXJ5KGlmYWNlID0+ICEhZ2xvYmFsW2lmYWNlXSkpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgR2xvYmFsIG11c3QgaGF2ZSB0aGUgZm9sbG93aW5nIGF0dHJpYnV0ZXMgOiAke3BhcnRpYWxzfWApOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGNsYXNzTmFtZSBvZiBPYmplY3Qua2V5cyhBUEkpKSB7CiAgICAgICAgICBpZiAoZ2xvYmFsW2NsYXNzTmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oYCR7Y2xhc3NOYW1lfSBhbHJlYWR5IGRlZmluZWQgb24gZ2xvYmFsLmApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2xvYmFsW2NsYXNzTmFtZV0gPSBBUElbY2xhc3NOYW1lXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgewogICAgICAgICAgY29uc3QgcG9seWZpbGxlZEN0eCA9IHBvbHlmaWxsTWFrZVhSQ29tcGF0aWJsZShnbG9iYWwuV2ViR0xSZW5kZXJpbmdDb250ZXh0KTsKICAgICAgICAgIGlmIChwb2x5ZmlsbGVkQ3R4KSB7CiAgICAgICAgICAgIHBvbHlmaWxsR2V0Q29udGV4dChnbG9iYWwuSFRNTENhbnZhc0VsZW1lbnQpOwogICAgICAgICAgICBpZiAoZ2xvYmFsLk9mZnNjcmVlbkNhbnZhcykgewogICAgICAgICAgICAgIHBvbHlmaWxsR2V0Q29udGV4dChnbG9iYWwuT2Zmc2NyZWVuQ2FudmFzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZ2xvYmFsLldlYkdMMlJlbmRlcmluZ0NvbnRleHQpewogICAgICAgICAgICAgIHBvbHlmaWxsTWFrZVhSQ29tcGF0aWJsZShnbG9iYWwuV2ViR0wyUmVuZGVyaW5nQ29udGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCF3aW5kb3cuaXNTZWN1cmVDb250ZXh0KSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBXZWJYUiBQb2x5ZmlsbCBXYXJuaW5nOgpUaGlzIHBhZ2UgaXMgbm90IHJ1bm5pbmcgaW4gYSBzZWN1cmUgY29udGV4dCAoaHR0cHM6Ly8gb3IgbG9jYWxob3N0KSEKVGhpcyBtZWFucyB0aGF0IGFsdGhvdWdoIHRoZSBwYWdlIG1heSBiZSBhYmxlIHRvIHVzZSB0aGUgV2ViWFIgUG9seWZpbGwgaXQgd2lsbApub3QgYmUgYWJsZSB0byB1c2UgbmF0aXZlIFdlYlhSIGltcGxlbWVudGF0aW9ucywgYW5kIGFzIHN1Y2ggd2lsbCBub3QgYmUgYWJsZSB0bwphY2Nlc3MgZGVkaWNhdGVkIFZSIG9yIEFSIGhhcmR3YXJlLCBhbmQgd2lsbCBub3QgYmUgYWJsZSB0byB0YWtlIGFkdmFudGFnZSBvZgphbnkgcGVyZm9ybWFuY2UgaW1wcm92ZW1lbnRzIGEgbmF0aXZlIFdlYlhSIGltcGxlbWVudGF0aW9uIG1heSBvZmZlci4gUGxlYXNlCmhvc3QgdGhpcyBjb250ZW50IG9uIGEgc2VjdXJlIG9yaWdpbiBmb3IgdGhlIGJlc3QgdXNlciBleHBlcmllbmNlLgpgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLmluamVjdGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLl9wYXRjaE5hdmlnYXRvclhSKCk7CiAgICAgIH0KICAgICAgX3BhdGNoTmF2aWdhdG9yWFIoKSB7CiAgICAgICAgbGV0IGRldmljZVByb21pc2UgPSByZXF1ZXN0WFJEZXZpY2UodGhpcy5nbG9iYWwsIHRoaXMuY29uZmlnKTsKICAgICAgICB0aGlzLnhyID0gbmV3IEFQSS5YUlN5c3RlbShkZXZpY2VQcm9taXNlKTsKICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcy5nbG9iYWwubmF2aWdhdG9yLCAneHInLCB7CiAgICAgICAgICB2YWx1ZTogdGhpcy54ciwKICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgICB9KTsKICAgICAgfQogICAgICBfaW5qZWN0Q29tcGF0aWJpbGl0eVNoaW1zKGdsb2JhbCkgewogICAgICAgIGlmICghcGFydGlhbHMuZXZlcnkoaWZhY2UgPT4gISFnbG9iYWxbaWZhY2VdKSkgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBHbG9iYWwgbXVzdCBoYXZlIHRoZSBmb2xsb3dpbmcgYXR0cmlidXRlcyA6ICR7cGFydGlhbHN9YCk7CiAgICAgICAgfQogICAgICAgIGlmIChnbG9iYWwubmF2aWdhdG9yLnhyICYmCiAgICAgICAgICAgICdzdXBwb3J0c1Nlc3Npb24nIGluIGdsb2JhbC5uYXZpZ2F0b3IueHIgJiYKICAgICAgICAgICAgISgnaXNTZXNzaW9uU3VwcG9ydGVkJyBpbiBnbG9iYWwubmF2aWdhdG9yLnhyKSkgewogICAgICAgICAgbGV0IG9yaWdpbmFsU3VwcG9ydHNTZXNzaW9uID0gZ2xvYmFsLm5hdmlnYXRvci54ci5zdXBwb3J0c1Nlc3Npb247CiAgICAgICAgICBnbG9iYWwubmF2aWdhdG9yLnhyLmlzU2Vzc2lvblN1cHBvcnRlZCA9IGZ1bmN0aW9uKG1vZGUpIHsKICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsU3VwcG9ydHNTZXNzaW9uLmNhbGwodGhpcywgbW9kZSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKICAgICAgICAgIGdsb2JhbC5uYXZpZ2F0b3IueHIuc3VwcG9ydHNTZXNzaW9uID0gZnVuY3Rpb24obW9kZSkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIm5hdmlnYXRvci54ci5zdXBwb3J0c1Nlc3Npb24oKSBpcyBkZXByZWNhdGVkLiBQbGVhc2UgIiArCiAgICAgICAgICAgICJjYWxsIG5hdmlnYXRvci54ci5pc1Nlc3Npb25TdXBwb3J0ZWQoKSBpbnN0ZWFkIGFuZCBjaGVjayB0aGUgYm9vbGVhbiAiICsKICAgICAgICAgICAgInZhbHVlIHJldHVybmVkIHdoZW4gdGhlIHByb21pc2UgcmVzb2x2ZXMuIik7CiAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbFN1cHBvcnRzU2Vzc2lvbi5jYWxsKHRoaXMsIG1vZGUpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICB2YXIgdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgidmlkZW8iKVswXTsKCiAgICB2YXIgcG9seWZpbGwgPSBudWxsOwoKICAgIGxldCBjYW1lcmEsIHNjZW5lLCByZW5kZXJlcjsKICAgIGxldCB2aWRlb1BsYW5lLCB2aWRlb1RleHR1cmU7CiAgICBsZXQgcHJvZ3Jlc3NCYXIsIGJhck1hdGVyaWFsOwoKICAgIGlmKCF2aWRlbyl7CiAgICAgICAgY29uc29sZS5sb2coaW5pdCk7CiAgICAgICAgY29uc29sZS5sb2coYW5pbWF0ZSk7CiAgICAgICAgbG9nKCJObyB2aWRlbywgc2tpcHBpbmcgaW5qZWN0aW9uLiIpOwogICAgfWVsc2UgewoKICAgICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSBzdHlsZXM7CiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7CiAgICAgICAgbG9nKCJJbmplY3RlZCBzdHlsZXMiLCBudWxsLCBzdHlsZSk7CgogICAgICAgIHBvbHlmaWxsID0gbmV3IFdlYlhSUG9seWZpbGwod2luZG93LlZSX0NPTkZJRyk7CgogICAgICAgIGxvZygiV2ViWFJQb2x5ZmlsbCBpbnN0YW50aWF0ZWQuIiAsICJwcmUtaW5pdCIsIHBvbHlmaWxsKTsKICAgICAgICBsb2coIlZpZGVvIGZvdW5kOiAiLCBudWxsLCB2aWRlbyk7CgogICAgICAgIGluaXQoKTsKICAgICAgICBhbmltYXRlKCk7CiAgICB9CgoKICAgIC8vIEhlbGxvCgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBsb2coIlN0YXJ0aW5nIiwgImluaXQiKTsKCiAgICAgICAgLy8gU3RhcnQgdmlkZW8KICAgICAgICB2aWRlby5wbGF5KCk7CiAgICAgICAgdmlkZW9UZXh0dXJlID0gbmV3IFZpZGVvVGV4dHVyZSh2aWRlbyk7CgogICAgICAgIC8vIFNldHVwIHNjZW5lCiAgICAgICAgc2NlbmUgPSBuZXcgU2NlbmUoKTsKICAgICAgICBjYW1lcmEgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoNzAsIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LCAwLjEsIDEwMDApOwogICAgICAgIGNhbWVyYS5wb3NpdGlvbi56ID0gMTsKCiAgICAgICAgLy8gQ3JlYXRlIHJlbmRlcmVyCiAgICAgICAgcmVuZGVyZXIgPSBuZXcgV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogdHJ1ZSB9KTsKICAgICAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOwogICAgICAgIHJlbmRlcmVyLnhyLmVuYWJsZWQgPSB0cnVlOwogICAgICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgid2ViZ2wiKTsKCiAgICAgICAgLy8gQ3JlYXRlIG1vZGFsIG92ZXJsYXkgY29udGFpbmVyCiAgICAgICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBtb2RhbC5pZCA9ICd2ci1vdmVybGF5LW1vZGFsJzsKCiAgICAgICAgY29uc3QgY2FudmFzQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgY2FudmFzQ29udGFpbmVyLmlkID0gJ3ZyLWNhbnZhcy1jb250YWluZXInOwoKICAgICAgICBjYW52YXNDb250YWluZXIuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7CiAgICAgICAgbW9kYWwuYXBwZW5kQ2hpbGQoY2FudmFzQ29udGFpbmVyKTsKCiAgICAgICAgLy8gQWRkIFN0YXJ0IGJ1dHRvbgogICAgICAgIC8qY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgICBzdGFydEJ1dHRvbi5pZCA9ICd2ci1zdGFydC1idXR0b24nOwogICAgICAgIHN0YXJ0QnV0dG9uLnRleHRDb250ZW50ID0gJ0VudGVyIFZSJzsKICAgICAgICBzdGFydEJ1dHRvbi5vbmNsaWNrID0gKCkgPT4gewogICAgICAgICAgICBtb2RhbC5yZW1vdmVDaGlsZChzdGFydEJ1dHRvbik7IC8vIFJlbW92ZSBidXR0b24gYWZ0ZXIgY2xpY2sKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChWUkJ1dHRvbi5jcmVhdGVCdXR0b24ocmVuZGVyZXIpKTsKICAgICAgICB9OwogICAgICAgIG1vZGFsLmFwcGVuZENoaWxkKHN0YXJ0QnV0dG9uKTsqLwoKICAgICAgICBjb25zb2xlLmxvZygidGVzdDEiKTsKICAgICAgICBsZXQgdnJfYnV0dG9uID0gbW9kYWwuYXBwZW5kQ2hpbGQoVlJCdXR0b24uY3JlYXRlQnV0dG9uKHJlbmRlcmVyKSk7CiAgICAgICAgY29uc29sZS5sb2coInRlc3QyIiwgdnJfYnV0dG9uKTsKCiAgICAgICAgLy8gQWRkIENsb3NlIGJ1dHRvbgogICAgICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICAgICAgY2xvc2VCdXR0b24uaWQgPSAndnItY2xvc2UtYnV0dG9uJzsKICAgICAgICBjbG9zZUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDbG9zZSc7CgogICAgICAgIC8qc3RhcnRCdXR0b24ub25jbGljayA9IGFzeW5jICgpID0+IHsKICAgICAgICAgICAgbW9kYWwucmVtb3ZlQ2hpbGQoc3RhcnRCdXR0b24pOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIDEuIFJlcXVlc3QgYW4gaW1tZXJzaXZlIFZSIHNlc3Npb24gKG11c3QgYmUgaW5zaWRlIHVzZXIgZ2VzdHVyZSBoYW5kbGVyKQogICAgICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHhyLnJlcXVlc3RTZXNzaW9uKCJpbmxpbmUiLCB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uYWxGZWF0dXJlczogWyJsb2NhbCJdLAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gMi4gQXR0YWNoIHNlc3Npb24gdG8gcmVuZGVyZXIKICAgICAgICAgICAgICAgIGF3YWl0IHJlbmRlcmVyLnhyLnNldFNlc3Npb24oc2Vzc2lvbik7CgogICAgICAgICAgICAgICAgLy8gMy4gT3B0aW9uYWxseSBhcHBlbmQgdGhlIHN0YW5kYXJkIFZSQnV0dG9uIHRvIGFsbG93IGV4aXRpbmcgbGF0ZXIKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoVlJCdXR0b24uY3JlYXRlQnV0dG9uKHJlbmRlcmVyKSk7CgogICAgICAgICAgICAgICAgLy8gNC4gKE9wdGlvbmFsKSBSZXNpemUgcmVuZGVyZXIgdG8gZnVsbC13aW5kb3cgYmVmb3JlIHNlc3Npb24gYmVnaW5zCiAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBzdGFydCBYUiBzZXNzaW9uOiIsIGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9OyovCgogICAgICAgIG1vZGFsLmFwcGVuZENoaWxkKGNsb3NlQnV0dG9uKTsKCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChtb2RhbCk7CgogICAgICAgIC8vIEJhY2tncm91bmQKICAgICAgICBjb25zdCBsb2FkZXIgPSBuZXcgVGV4dHVyZUxvYWRlcigpOwogICAgICAgIGNvbnN0IHRleHR1cmUgPSBsb2FkZXIubG9hZCgnYm94LnBuZycpOwogICAgICAgIHNjZW5lLmJhY2tncm91bmQgPSB0ZXh0dXJlOwoKICAgICAgICAvLyBWaWRlbyBQbGFuZQogICAgICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFBsYW5lR2VvbWV0cnkoMS42LCAwLjkpOwogICAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKHsgbWFwOiB2aWRlb1RleHR1cmUgfSk7CiAgICAgICAgdmlkZW9QbGFuZSA9IG5ldyBNZXNoKGdlb21ldHJ5LCBtYXRlcmlhbCk7CiAgICAgICAgdmlkZW9QbGFuZS5wb3NpdGlvbi5zZXQoMCwgMCwgLTEuNSk7CiAgICAgICAgc2NlbmUuYWRkKHZpZGVvUGxhbmUpOwoKICAgICAgICAvLyBDb250cm9scwogICAgICAgIGNyZWF0ZUJ1dHRvbign4pa2JywgLTAuNiwgLTEuNSwgKCkgPT4gdmlkZW8ucGxheSgpKTsKICAgICAgICBjcmVhdGVCdXR0b24oJ+KPqicsIC0wLjksIC0xLjUsICgpID0+IHsgdmlkZW8uY3VycmVudFRpbWUgPSBNYXRoLm1heCgwLCB2aWRlby5jdXJyZW50VGltZSAtIDUpOyB9KTsKICAgICAgICBjcmVhdGVCdXR0b24oJ+KPqScsIC0wLjMsIC0xLjUsICgpID0+IHsgdmlkZW8uY3VycmVudFRpbWUgPSBNYXRoLm1pbih2aWRlby5kdXJhdGlvbiwgdmlkZW8uY3VycmVudFRpbWUgKyA1KTsgfSk7CgogICAgICAgIC8vIFByb2dyZXNzIEJhcgogICAgICAgIGNvbnN0IGJhckdlb21ldHJ5ID0gbmV3IFBsYW5lR2VvbWV0cnkoMS4yLCAwLjA1KTsKICAgICAgICBiYXJNYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiAweDAwZmYwMCB9KTsKICAgICAgICBwcm9ncmVzc0JhciA9IG5ldyBNZXNoKGJhckdlb21ldHJ5LCBiYXJNYXRlcmlhbCk7CiAgICAgICAgcHJvZ3Jlc3NCYXIucG9zaXRpb24uc2V0KDAsIC0wLjksIC0xLjUpOwogICAgICAgIHNjZW5lLmFkZChwcm9ncmVzc0Jhcik7CgogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvbldpbmRvd1Jlc2l6ZSk7CiAgICB9CgoKICAgIGZ1bmN0aW9uIGNyZWF0ZUJ1dHRvbihsYWJlbCwgeCwgeSwgb25DbGljaykgewogICAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGNhbnZhcy53aWR0aCA9IDEyODsKICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMTI4OwogICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7CiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDEyOCwgMTI4KTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmYnOwogICAgICAgIGN0eC5mb250ID0gJ2JvbGQgNjRweCBzYW5zLXNlcmlmJzsKICAgICAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICAgICAgY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnOwogICAgICAgIGN0eC5maWxsVGV4dChsYWJlbCwgNjQsIDY0KTsKCiAgICAgICAgY29uc3QgdGV4dHVyZSA9IG5ldyBDYW52YXNUZXh0dXJlKGNhbnZhcyk7CiAgICAgICAgY29uc3QgbWF0ID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKHsgbWFwOiB0ZXh0dXJlLCB0cmFuc3BhcmVudDogdHJ1ZSB9KTsKICAgICAgICBjb25zdCBnZW8gPSBuZXcgUGxhbmVHZW9tZXRyeSgwLjMsIDAuMyk7CiAgICAgICAgY29uc3QgbWVzaCA9IG5ldyBNZXNoKGdlbywgbWF0KTsKICAgICAgICBtZXNoLnBvc2l0aW9uLnNldCh4LCB5LCAtMS41KTsKICAgICAgICBzY2VuZS5hZGQobWVzaCk7CiAgICAgICAgLy8gRm9yIGZ1dHVyZSBpbnRlcmFjdGl2aXR5IChlLmcuLCByYXljYXN0aW5nKTogc3RvcmUgY2xpY2sgaGFuZGxlcgogICAgICAgIG1lc2gudXNlckRhdGEub25DbGljayA9IG9uQ2xpY2s7CiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlUHJvZ3Jlc3NCYXIoKSB7CiAgICAgICAgaWYgKCF2aWRlby5kdXJhdGlvbikgcmV0dXJuOwogICAgICAgIGNvbnN0IHJhdGlvID0gdmlkZW8uY3VycmVudFRpbWUgLyB2aWRlby5kdXJhdGlvbjsKICAgICAgICBwcm9ncmVzc0Jhci5zY2FsZS54ID0gcmF0aW87CiAgICAgICAgcHJvZ3Jlc3NCYXIucG9zaXRpb24ueCA9IC0wLjYgKyByYXRpbyAqIDAuNjsKICAgIH0KCiAgICBmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZSgpIHsKICAgICAgICBjYW1lcmEuYXNwZWN0ID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKICAgICAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgcmVuZGVyZXIuc2V0QW5pbWF0aW9uTG9vcChyZW5kZXIpOwogICAgfQoKICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICB1cGRhdGVQcm9ncmVzc0JhcigpOwogICAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKTsKICAgIH0KCn0pKCk7Cg==';
const WEBVR_B64 = 'KGZ1bmN0aW9uICgpIHsKCSd1c2Ugc3RyaWN0JzsKCgkvKioKCSAqIEBsaWNlbnNlCgkgKiBDb3B5cmlnaHQgMjAxMC0yMDI1IFRocmVlLmpzIEF1dGhvcnMKCSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKCSAqLwoJY29uc3QgUkVWSVNJT04gPSAnMTc4JzsKCgkvKioKCSAqIERpc2FibGVzIGZhY2UgY3VsbGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEN1bGxGYWNlTm9uZSA9IDA7CgoJLyoqCgkgKiBDdWxscyBiYWNrIGZhY2VzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VsbEZhY2VCYWNrID0gMTsKCgkvKioKCSAqIEN1bGxzIGZyb250IGZhY2VzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VsbEZhY2VGcm9udCA9IDI7CgoJLyoqCgkgKiBGaWx0ZXJzIHNoYWRvdyBtYXBzIHVzaW5nIHRoZSBQZXJjZW50YWdlLUNsb3NlciBGaWx0ZXJpbmcgKFBDRikgYWxnb3JpdGhtLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUENGU2hhZG93TWFwID0gMTsKCgkvKioKCSAqIEZpbHRlcnMgc2hhZG93IG1hcHMgdXNpbmcgdGhlIFBlcmNlbnRhZ2UtQ2xvc2VyIEZpbHRlcmluZyAoUENGKSBhbGdvcml0aG0gd2l0aAoJICogYmV0dGVyIHNvZnQgc2hhZG93cyBlc3BlY2lhbGx5IHdoZW4gdXNpbmcgbG93LXJlc29sdXRpb24gc2hhZG93IG1hcHMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBQQ0ZTb2Z0U2hhZG93TWFwID0gMjsKCgkvKioKCSAqIEZpbHRlcnMgc2hhZG93IG1hcHMgdXNpbmcgdGhlIFZhcmlhbmNlIFNoYWRvdyBNYXAgKFZTTSkgYWxnb3JpdGhtLgoJICogV2hlbiB1c2luZyBWU01TaGFkb3dNYXAgYWxsIHNoYWRvdyByZWNlaXZlcnMgd2lsbCBhbHNvIGNhc3Qgc2hhZG93cy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFZTTVNoYWRvd01hcCA9IDM7CgoJLyoqCgkgKiBPbmx5IGZyb250IGZhY2VzIGFyZSByZW5kZXJlZC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEZyb250U2lkZSA9IDA7CgoJLyoqCgkgKiBPbmx5IGJhY2sgZmFjZXMgYXJlIHJlbmRlcmVkLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQmFja1NpZGUgPSAxOwoKCS8qKgoJICogQm90aCBmcm9udCBhbmQgYmFjayBmYWNlcyBhcmUgcmVuZGVyZWQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBEb3VibGVTaWRlID0gMjsKCgkvKioKCSAqIE5vIGJsZW5kaW5nIGlzIHBlcmZvcm1lZCB3aGljaCBlZmZlY3RpdmVseSBkaXNhYmxlcwoJICogYWxwaGEgdHJhbnNwYXJlbmN5LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTm9CbGVuZGluZyA9IDA7CgoJLyoqCgkgKiBUaGUgZGVmYXVsdCBibGVuZGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE5vcm1hbEJsZW5kaW5nID0gMTsKCgkvKioKCSAqIFJlcHJlc2VudHMgYWRkaXRpdmUgYmxlbmRpbmcuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBBZGRpdGl2ZUJsZW5kaW5nID0gMjsKCgkvKioKCSAqIFJlcHJlc2VudHMgc3VidHJhY3RpdmUgYmxlbmRpbmcuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTdWJ0cmFjdGl2ZUJsZW5kaW5nID0gMzsKCgkvKioKCSAqIFJlcHJlc2VudHMgbXVsdGlwbHkgYmxlbmRpbmcuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBNdWx0aXBseUJsZW5kaW5nID0gNDsKCgkvKioKCSAqIFJlcHJlc2VudHMgY3VzdG9tIGJsZW5kaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VzdG9tQmxlbmRpbmcgPSA1OwoKCS8qKgoJICogQSBgc291cmNlICsgZGVzdGluYXRpb25gIGJsZW5kaW5nIGVxdWF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQWRkRXF1YXRpb24gPSAxMDA7CgoJLyoqCgkgKiBBIGBzb3VyY2UgLSBkZXN0aW5hdGlvbmAgYmxlbmRpbmcgZXF1YXRpb24uCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTdWJ0cmFjdEVxdWF0aW9uID0gMTAxOwoKCS8qKgoJICogQSBgZGVzdGluYXRpb24gLSBzb3VyY2VgIGJsZW5kaW5nIGVxdWF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUmV2ZXJzZVN1YnRyYWN0RXF1YXRpb24gPSAxMDI7CgoJLyoqCgkgKiBBIGJsZW5kIGVxdWF0aW9uIHRoYXQgdXNlcyB0aGUgbWluaW11bSBvZiBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTWluRXF1YXRpb24gPSAxMDM7CgoJLyoqCgkgKiBBIGJsZW5kIGVxdWF0aW9uIHRoYXQgdXNlcyB0aGUgbWF4aW11bSBvZiBzb3VyY2UgYW5kIGRlc3RpbmF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTWF4RXF1YXRpb24gPSAxMDQ7CgoJLyoqCgkgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgYDBgLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgWmVyb0ZhY3RvciA9IDIwMDsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVGYWN0b3IgPSAyMDE7CgoJLyoqCgkgKiBNdWx0aXBsaWVzIGFsbCBjb2xvcnMgYnkgdGhlIHNvdXJjZSBjb2xvcnMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTcmNDb2xvckZhY3RvciA9IDIwMjsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgZWFjaCBzb3VyY2UgY29sb3IuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gMjAzOwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTcmNBbHBoYUZhY3RvciA9IDIwNDsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSAxIG1pbnVzIHRoZSBzb3VyY2UgYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c1NyY0FscGhhRmFjdG9yID0gMjA1OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBkZXN0aW5hdGlvbiBhbHBoYSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IERzdEFscGhhRmFjdG9yID0gMjA2OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAxYCBtaW51cyB0aGUgZGVzdGluYXRpb24gYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c0RzdEFscGhhRmFjdG9yID0gMjA3OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IHRoZSBkZXN0aW5hdGlvbiBjb2xvci4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IERzdENvbG9yRmFjdG9yID0gMjA4OwoKCS8qKgoJICogTXVsdGlwbGllcyBhbGwgY29sb3JzIGJ5IGAxYCBtaW51cyBlYWNoIGRlc3RpbmF0aW9uIGNvbG9yLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgT25lTWludXNEc3RDb2xvckZhY3RvciA9IDIwOTsKCgkvKioKCSAqIE11bHRpcGxpZXMgdGhlIFJHQiBjb2xvcnMgYnkgdGhlIHNtYWxsZXIgb2YgZWl0aGVyIHRoZSBzb3VyY2UgYWxwaGEKCSAqIHZhbHVlIG9yIHRoZSB2YWx1ZSBvZiBgMWAgbWludXMgdGhlIGRlc3RpbmF0aW9uIGFscGhhIHZhbHVlLiBUaGUgYWxwaGEKCSAqIHZhbHVlIGlzIG11bHRpcGxpZWQgYnkgYDFgLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciA9IDIxMDsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBhIGNvbnN0YW50IGNvbG9yLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ29uc3RhbnRDb2xvckZhY3RvciA9IDIxMTsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBgMWAgbWludXMgYSBjb25zdGFudCBjb2xvci4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvciA9IDIxMjsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSBhIGNvbnN0YW50IGFscGhhIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ29uc3RhbnRBbHBoYUZhY3RvciA9IDIxMzsKCgkvKioKCSAqIE11bHRpcGxpZXMgYWxsIGNvbG9ycyBieSAxIG1pbnVzIGEgY29uc3RhbnQgYWxwaGEgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBPbmVNaW51c0NvbnN0YW50QWxwaGFGYWN0b3IgPSAyMTQ7CgoJLyoqCgkgKiBOZXZlciBwYXNzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTmV2ZXJEZXB0aCA9IDA7CgoJLyoqCgkgKiBBbHdheXMgcGFzcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEFsd2F5c0RlcHRoID0gMTsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGVzc0RlcHRoID0gMjsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGVzc0VxdWFsRGVwdGggPSAzOwoKCS8qKgoJICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgZXF1YWxzIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBFcXVhbERlcHRoID0gNDsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgZGVwdGggYnVmZmVyIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgR3JlYXRlckVxdWFsRGVwdGggPSA1OwoKCS8qKgoJICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBHcmVhdGVyRGVwdGggPSA2OwoKCS8qKgoJICogUGFzcyBpZiB0aGUgaW5jb21pbmcgdmFsdWUgaXMgbm90IGVxdWFsIHRvIHRoZSBkZXB0aCBidWZmZXIgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOb3RFcXVhbERlcHRoID0gNzsKCgkvKioKCSAqIE11bHRpcGxpZXMgdGhlIGVudmlyb25tZW50IG1hcCBjb2xvciB3aXRoIHRoZSBzdXJmYWNlIGNvbG9yLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTXVsdGlwbHlPcGVyYXRpb24gPSAwOwoKCS8qKgoJICogVXNlcyByZWZsZWN0aXZpdHkgdG8gYmxlbmQgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE1peE9wZXJhdGlvbiA9IDE7CgoJLyoqCgkgKiBBZGRzIHRoZSB0d28gY29sb3JzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQWRkT3BlcmF0aW9uID0gMjsKCgkvKioKCSAqIE5vIHRvbmUgbWFwcGluZyBpcyBhcHBsaWVkLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTm9Ub25lTWFwcGluZyA9IDA7CgoJLyoqCgkgKiBMaW5lYXIgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyVG9uZU1hcHBpbmcgPSAxOwoKCS8qKgoJICogUmVpbmhhcmQgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUmVpbmhhcmRUb25lTWFwcGluZyA9IDI7CgoJLyoqCgkgKiBDaW5lb24gdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ2luZW9uVG9uZU1hcHBpbmcgPSAzOwoKCS8qKgoJICogQUNFUyBGaWxtaWMgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nID0gNDsKCgkvKioKCSAqIEN1c3RvbSB0b25lIG1hcHBpbmcuCgkgKgoJICogRXhwZWN0cyBhIGN1c3RvbSBpbXBsZW1lbnRhdGlvbiBieSBtb2RpZnlpbmcgc2hhZGVyIGNvZGUgb2YgdGhlIG1hdGVyaWFsJ3MgZnJhZ21lbnQgc2hhZGVyLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3VzdG9tVG9uZU1hcHBpbmcgPSA1OwoKCS8qKgoJICogQWdYIHRvbmUgbWFwcGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEFnWFRvbmVNYXBwaW5nID0gNjsKCgkvKioKCSAqIE5ldXRyYWwgdG9uZSBtYXBwaW5nLgoJICoKCSAqIEltcGxlbWVudGF0aW9uIGJhc2VkIG9uIHRoZSBLaHJvbm9zIDNEIENvbW1lcmNlIEdyb3VwIHN0YW5kYXJkIHRvbmUgbWFwcGluZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE5ldXRyYWxUb25lTWFwcGluZyA9IDc7CgoJLyoqCgkgKiBNYXBzIHRleHR1cmVzIHVzaW5nIHRoZSBnZW9tZXRyeSdzIFVWIGNvb3JkaW5hdGVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVVZNYXBwaW5nID0gMzAwOwoKCS8qKgoJICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBjdWJlIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nID0gMzAxOwoKCS8qKgoJICogUmVmcmFjdGlvbiBtYXBwaW5nIGZvciBjdWJlIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nID0gMzAyOwoKCS8qKgoJICogUmVmbGVjdGlvbiBtYXBwaW5nIGZvciBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyA9IDMwMzsKCgkvKioKCSAqIFJlZnJhY3Rpb24gbWFwcGluZyBmb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgPSAzMDQ7CgoJLyoqCgkgKiBSZWZsZWN0aW9uIG1hcHBpbmcgZm9yIFBNUkVNIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDY7CgoJLyoqCgkgKiBUaGUgdGV4dHVyZSB3aWxsIHNpbXBseSByZXBlYXQgdG8gaW5maW5pdHkuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSZXBlYXRXcmFwcGluZyA9IDEwMDA7CgoJLyoqCgkgKiBUaGUgbGFzdCBwaXhlbCBvZiB0aGUgdGV4dHVyZSBzdHJldGNoZXMgdG8gdGhlIGVkZ2Ugb2YgdGhlIG1lc2guCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBDbGFtcFRvRWRnZVdyYXBwaW5nID0gMTAwMTsKCgkvKioKCSAqIFRoZSB0ZXh0dXJlIHdpbGwgcmVwZWF0cyB0byBpbmZpbml0eSwgbWlycm9yaW5nIG9uIGVhY2ggcmVwZWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTWlycm9yZWRSZXBlYXRXcmFwcGluZyA9IDEwMDI7CgoJLyoqCgkgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgdGV4dHVyZSBlbGVtZW50IHRoYXQgaXMgbmVhcmVzdCAoaW4gTWFuaGF0dGFuIGRpc3RhbmNlKQoJICogdG8gdGhlIHNwZWNpZmllZCB0ZXh0dXJlIGNvb3JkaW5hdGVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTmVhcmVzdEZpbHRlciA9IDEwMDM7CgoJLyoqCgkgKiBDaG9vc2VzIHRoZSBtaXBtYXAgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2hlcyB0aGUgc2l6ZSBvZiB0aGUgcGl4ZWwgYmVpbmcgdGV4dHVyZWQKCSAqIGFuZCB1c2VzIHRoZSBgTmVhcmVzdEZpbHRlcmAgY3JpdGVyaW9uICh0aGUgdGV4ZWwgbmVhcmVzdCB0byB0aGUgY2VudGVyIG9mIHRoZSBwaXhlbCkKCSAqIHRvIHByb2R1Y2UgYSB0ZXh0dXJlIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIgPSAxMDA0OwoKCS8qKgoJICogQ2hvb3NlcyB0aGUgdHdvIG1pcG1hcHMgdGhhdCBtb3N0IGNsb3NlbHkgbWF0Y2ggdGhlIHNpemUgb2YgdGhlIHBpeGVsIGJlaW5nIHRleHR1cmVkIGFuZAoJICogdXNlcyB0aGUgYE5lYXJlc3RGaWx0ZXJgIGNyaXRlcmlvbiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZSBmcm9tIGVhY2ggbWlwbWFwLgoJICogVGhlIGZpbmFsIHRleHR1cmUgdmFsdWUgaXMgYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRob3NlIHR3byB2YWx1ZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyID0gMTAwNTsKCgkvKioKCSAqIFJldHVybnMgdGhlIHdlaWdodGVkIGF2ZXJhZ2Ugb2YgdGhlIGZvdXIgdGV4dHVyZSBlbGVtZW50cyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZSBzcGVjaWZpZWQKCSAqIHRleHR1cmUgY29vcmRpbmF0ZXMsIGFuZCBjYW4gaW5jbHVkZSBpdGVtcyB3cmFwcGVkIG9yIHJlcGVhdGVkIGZyb20gb3RoZXIgcGFydHMgb2YgYSB0ZXh0dXJlLAoJICogZGVwZW5kaW5nIG9uIHRoZSB2YWx1ZXMgb2YgYHdyYXBTYCBhbmQgYHdyYXBUYCwgYW5kIG9uIHRoZSBleGFjdCBtYXBwaW5nLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyRmlsdGVyID0gMTAwNjsKCgkvKioKCSAqIENob29zZXMgdGhlIG1pcG1hcCB0aGF0IG1vc3QgY2xvc2VseSBtYXRjaGVzIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQgdXNlcwoJICogdGhlIGBMaW5lYXJGaWx0ZXJgIGNyaXRlcmlvbiAoYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRoZSBmb3VyIHRleGVscyB0aGF0IGFyZSBjbG9zZXN0IHRvIHRoZQoJICogY2VudGVyIG9mIHRoZSBwaXhlbCkgdG8gcHJvZHVjZSBhIHRleHR1cmUgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyID0gMTAwNzsKCgkvKioKCSAqIENob29zZXMgdGhlIHR3byBtaXBtYXBzIHRoYXQgbW9zdCBjbG9zZWx5IG1hdGNoIHRoZSBzaXplIG9mIHRoZSBwaXhlbCBiZWluZyB0ZXh0dXJlZCBhbmQgdXNlcwoJICogdGhlIGBMaW5lYXJGaWx0ZXJgIGNyaXRlcmlvbiB0byBwcm9kdWNlIGEgdGV4dHVyZSB2YWx1ZSBmcm9tIGVhY2ggbWlwbWFwLiBUaGUgZmluYWwgdGV4dHVyZSB2YWx1ZQoJICogaXMgYSB3ZWlnaHRlZCBhdmVyYWdlIG9mIHRob3NlIHR3byB2YWx1ZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgPSAxMDA4OwoKCS8qKgoJICogQW4gdW5zaWduZWQgYnl0ZSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRCeXRlVHlwZSA9IDEwMDk7CgoJLyoqCgkgKiBBIGJ5dGUgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEJ5dGVUeXBlID0gMTAxMDsKCgkvKioKCSAqIEEgc2hvcnQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFNob3J0VHlwZSA9IDEwMTE7CgoJLyoqCgkgKiBBbiB1bnNpZ25lZCBzaG9ydCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRTaG9ydFR5cGUgPSAxMDEyOwoKCS8qKgoJICogQW4gaW50IGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBJbnRUeXBlID0gMTAxMzsKCgkvKioKCSAqIEFuIHVuc2lnbmVkIGludCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRJbnRUeXBlID0gMTAxNDsKCgkvKioKCSAqIEEgZmxvYXQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEZsb2F0VHlwZSA9IDEwMTU7CgoJLyoqCgkgKiBBIGhhbGYgZmxvYXQgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEhhbGZGbG9hdFR5cGUgPSAxMDE2OwoKCS8qKgoJICogQW4gdW5zaWduZWQgc2hvcnQgNF80XzRfNCAocGFja2VkKSBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gMTAxNzsKCgkvKioKCSAqIEFuIHVuc2lnbmVkIHNob3J0IDVfNV81XzEgKHBhY2tlZCkgZGF0YSB0eXBlIGZvciB0ZXh0dXJlcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFVuc2lnbmVkU2hvcnQ1NTUxVHlwZSA9IDEwMTg7CgoJLyoqCgkgKiBBbiB1bnNpZ25lZCBpbnQgMjRfOCBkYXRhIHR5cGUgZm9yIHRleHR1cmVzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVW5zaWduZWRJbnQyNDhUeXBlID0gMTAyMDsKCgkvKioKCSAqIEFuIHVuc2lnbmVkIGludCA1XzlfOV85IChwYWNrZWQpIGRhdGEgdHlwZSBmb3IgdGV4dHVyZXMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBVbnNpZ25lZEludDU5OTlUeXBlID0gMzU5MDI7CgoJLyoqCgkgKiBEaXNjYXJkcyB0aGUgcmVkLCBncmVlbiBhbmQgYmx1ZSBjb21wb25lbnRzIGFuZCByZWFkcyBqdXN0IHRoZSBhbHBoYSBjb21wb25lbnQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBBbHBoYUZvcm1hdCA9IDEwMjE7CgoJLyoqCgkgKiBEaXNjYXJkcyB0aGUgYWxwaGEgY29tcG9uZW50IGFuZCByZWFkcyB0aGUgcmVkLCBncmVlbiBhbmQgYmx1ZSBjb21wb25lbnQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JGb3JtYXQgPSAxMDIyOwoKCS8qKgoJICogUmVhZHMgdGhlIHJlZCwgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBRm9ybWF0ID0gMTAyMzsKCgkvKioKCSAqIFJlYWRzIGVhY2ggZWxlbWVudCBhcyBhIHNpbmdsZSBkZXB0aCB2YWx1ZSwgY29udmVydHMgaXQgdG8gZmxvYXRpbmcgcG9pbnQsIGFuZCBjbGFtcHMgdG8gdGhlIHJhbmdlIGBbMCwxXWAuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBEZXB0aEZvcm1hdCA9IDEwMjY7CgoJLyoqCgkgKiBSZWFkcyBlYWNoIGVsZW1lbnQgaXMgYSBwYWlyIG9mIGRlcHRoIGFuZCBzdGVuY2lsIHZhbHVlcy4gVGhlIGRlcHRoIGNvbXBvbmVudCBvZiB0aGUgcGFpciBpcyBpbnRlcnByZXRlZCBhcwoJICogaW4gYERlcHRoRm9ybWF0YC4gVGhlIHN0ZW5jaWwgY29tcG9uZW50IGlzIGludGVycHJldGVkIGJhc2VkIG9uIHRoZSBkZXB0aCArIHN0ZW5jaWwgaW50ZXJuYWwgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgRGVwdGhTdGVuY2lsRm9ybWF0ID0gMTAyNzsKCgkvKioKCSAqIERpc2NhcmRzIHRoZSBncmVlbiwgYmx1ZSBhbmQgYWxwaGEgY29tcG9uZW50cyBhbmQgcmVhZHMganVzdCB0aGUgcmVkIGNvbXBvbmVudC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJlZEZvcm1hdCA9IDEwMjg7CgoJLyoqCgkgKiBEaXNjYXJkcyB0aGUgZ3JlZW4sIGJsdWUgYW5kIGFscGhhIGNvbXBvbmVudHMgYW5kIHJlYWRzIGp1c3QgdGhlIHJlZCBjb21wb25lbnQuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJlZEludGVnZXJGb3JtYXQgPSAxMDI5OwoKCS8qKgoJICogRGlzY2FyZHMgdGhlIGFscGhhLCBhbmQgYmx1ZSBjb21wb25lbnRzIGFuZCByZWFkcyB0aGUgcmVkLCBhbmQgZ3JlZW4gY29tcG9uZW50cy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHRm9ybWF0ID0gMTAzMDsKCgkvKioKCSAqIERpc2NhcmRzIHRoZSBhbHBoYSwgYW5kIGJsdWUgY29tcG9uZW50cyBhbmQgcmVhZHMgdGhlIHJlZCwgYW5kIGdyZWVuIGNvbXBvbmVudHMuIFRoZSB0ZXhlbHMgYXJlIHJlYWQgYXMgaW50ZWdlcnMgaW5zdGVhZCBvZiBmbG9hdGluZyBwb2ludC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHSW50ZWdlckZvcm1hdCA9IDEwMzE7CgoJLyoqCgkgKiBSZWFkcyB0aGUgcmVkLCBncmVlbiwgYmx1ZSBhbmQgYWxwaGEgY29tcG9uZW50cy4gVGhlIHRleGVscyBhcmUgcmVhZCBhcyBpbnRlZ2VycyBpbnN0ZWFkIG9mIGZsb2F0aW5nIHBvaW50LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQUludGVnZXJGb3JtYXQgPSAxMDMzOwoKCS8qKgoJICogQSBEWFQxLWNvbXByZXNzZWQgaW1hZ2UgaW4gYW4gUkdCIGltYWdlIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQl9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3NzY7CgoJLyoqCgkgKiBBIERYVDEtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0IgaW1hZ2UgZm9ybWF0IHdpdGggYSBzaW1wbGUgb24vb2ZmIGFscGhhIHZhbHVlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3Nzc7CgoJLyoqCgkgKiBBIERYVDMtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0JBIGltYWdlIGZvcm1hdC4gQ29tcGFyZWQgdG8gYSAzMi1iaXQgUkdCQSB0ZXh0dXJlLCBpdCBvZmZlcnMgNDoxIGNvbXByZXNzaW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9TM1RDX0RYVDNfRm9ybWF0ID0gMzM3Nzg7CgoJLyoqCgkgKiBBIERYVDUtY29tcHJlc3NlZCBpbWFnZSBpbiBhbiBSR0JBIGltYWdlIGZvcm1hdC4gSXQgYWxzbyBwcm92aWRlcyBhIDQ6MSBjb21wcmVzc2lvbiwgYnV0IGRpZmZlcnMgdG8gdGhlIERYVDMKCSAqIGNvbXByZXNzaW9uIGluIGhvdyB0aGUgYWxwaGEgY29tcHJlc3Npb24gaXMgZG9uZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCA9IDMzNzc5OwoKCS8qKgoJICogUFZSVEMgUkdCIGNvbXByZXNzaW9uIGluIDQtYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA0w5c0IHBpeGVscy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDA7CgoJLyoqCgkgKiBQVlJUQyBSR0IgY29tcHJlc3Npb24gaW4gMi1iaXQgbW9kZS4gT25lIGJsb2NrIGZvciBlYWNoIDjDlzQgcGl4ZWxzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MTsKCgkvKioKCSAqIFBWUlRDIFJHQkEgY29tcHJlc3Npb24gaW4gNC1iaXQgbW9kZS4gT25lIGJsb2NrIGZvciBlYWNoIDTDlzQgcGl4ZWxzLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDI7CgoJLyoqCgkgKiBQVlJUQyBSR0JBIGNvbXByZXNzaW9uIGluIDItYml0IG1vZGUuIE9uZSBibG9jayBmb3IgZWFjaCA4w5c0IHBpeGVscy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCA9IDM1ODQzOwoKCS8qKgoJICogRVRDMSBSR0IgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCX0VUQzFfRm9ybWF0ID0gMzYxOTY7CgoJLyoqCgkgKiBFVEMyIFJHQiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JfRVRDMl9Gb3JtYXQgPSAzNzQ5MjsKCgkvKioKCSAqIEVUQzIgUkdCQSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0VUQzJfRUFDX0Zvcm1hdCA9IDM3NDk2OwoKCS8qKgoJICogQVNUQyBSR0JBIDR4NCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNHg0X0Zvcm1hdCA9IDM3ODA4OwoKCS8qKgoJICogQVNUQyBSR0JBIDV4NCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNXg0X0Zvcm1hdCA9IDM3ODA5OwoKCS8qKgoJICogQVNUQyBSR0JBIDV4NSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNXg1X0Zvcm1hdCA9IDM3ODEwOwoKCS8qKgoJICogQVNUQyBSR0JBIDZ4NSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNng1X0Zvcm1hdCA9IDM3ODExOwoKCS8qKgoJICogQVNUQyBSR0JBIDZ4NiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfNng2X0Zvcm1hdCA9IDM3ODEyOwoKCS8qKgoJICogQVNUQyBSR0JBIDh4NSBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfOHg1X0Zvcm1hdCA9IDM3ODEzOwoKCS8qKgoJICogQVNUQyBSR0JBIDh4NiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfOHg2X0Zvcm1hdCA9IDM3ODE0OwoKCS8qKgoJICogQVNUQyBSR0JBIDh4OCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfOHg4X0Zvcm1hdCA9IDM3ODE1OwoKCS8qKgoJICogQVNUQyBSR0JBIDEweDUgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9BU1RDXzEweDVfRm9ybWF0ID0gMzc4MTY7CgoJLyoqCgkgKiBBU1RDIFJHQkEgMTB4NiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgPSAzNzgxNzsKCgkvKioKCSAqIEFTVEMgUkdCQSAxMHg4IGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCA9IDM3ODE4OwoKCS8qKgoJICogQVNUQyBSR0JBIDEweDEwIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgPSAzNzgxOTsKCgkvKioKCSAqIEFTVEMgUkdCQSAxMngxMCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0ID0gMzc4MjA7CgoJLyoqCgkgKiBBU1RDIFJHQkEgMTJ4MTIgZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCA9IDM3ODIxOwoKCS8qKgoJICogQlBUQyBSR0JBIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFJHQkFfQlBUQ19Gb3JtYXQgPSAzNjQ5MjsKCgkvKioKCSAqIEJQVEMgU2lnbmVkIFJHQiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JfQlBUQ19TSUdORURfRm9ybWF0ID0gMzY0OTQ7CgoJLyoqCgkgKiBCUFRDIFVuc2lnbmVkIFJHQiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgPSAzNjQ5NTsKCgkvKioKCSAqIFJHVEMxIFJlZCBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSRURfUkdUQzFfRm9ybWF0ID0gMzYyODM7CgoJLyoqCgkgKiBSR1RDMSBTaWduZWQgUmVkIGZvcm1hdC4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFNJR05FRF9SRURfUkdUQzFfRm9ybWF0ID0gMzYyODQ7CgoJLyoqCgkgKiBSR1RDMiBSZWQgR3JlZW4gZm9ybWF0LgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg1OwoKCS8qKgoJICogUkdUQzIgU2lnbmVkIFJlZCBHcmVlbiBmb3JtYXQuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg2OwoKCS8qKgoJICogQmFzaWMgZGVwdGggcGFja2luZy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEJhc2ljRGVwdGhQYWNraW5nID0gMzIwMDsKCgkvKioKCSAqIEEgZGVwdGggdmFsdWUgaXMgcGFja2VkIGludG8gMzIgYml0IFJHQkEuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBSR0JBRGVwdGhQYWNraW5nID0gMzIwMTsKCgkvKioKCSAqIE5vcm1hbCBpbmZvcm1hdGlvbiBpcyByZWxhdGl2ZSB0byB0aGUgdW5kZXJseWluZyBzdXJmYWNlLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgVGFuZ2VudFNwYWNlTm9ybWFsTWFwID0gMDsKCgkvKioKCSAqIE5vcm1hbCBpbmZvcm1hdGlvbiBpcyByZWxhdGl2ZSB0byB0aGUgb2JqZWN0IG9yaWVudGF0aW9uLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgT2JqZWN0U3BhY2VOb3JtYWxNYXAgPSAxOwoKCS8vIENvbG9yIHNwYWNlIHN0cmluZyBpZGVudGlmaWVycywgbWF0Y2hpbmcgQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0IGFuZCBXZWJHUFUgbmFtZXMgd2hlcmUgYXZhaWxhYmxlLgoKCS8qKgoJICogTm8gY29sb3Igc3BhY2UuCgkgKgoJICogQHR5cGUge3N0cmluZ30KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOb0NvbG9yU3BhY2UgPSAnJzsKCgkvKioKCSAqIHNSR0IgY29sb3Igc3BhY2UuCgkgKgoJICogQHR5cGUge3N0cmluZ30KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTUkdCQ29sb3JTcGFjZSA9ICdzcmdiJzsKCgkvKioKCSAqIHNSR0ItbGluZWFyIGNvbG9yIHNwYWNlLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyU1JHQkNvbG9yU3BhY2UgPSAnc3JnYi1saW5lYXInOwoKCS8qKgoJICogTGluZWFyIHRyYW5zZmVyIGZ1bmN0aW9uLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgTGluZWFyVHJhbnNmZXIgPSAnbGluZWFyJzsKCgkvKioKCSAqIHNSR0IgdHJhbnNmZXIgZnVuY3Rpb24uCgkgKgoJICogQHR5cGUge3N0cmluZ30KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBTUkdCVHJhbnNmZXIgPSAnc3JnYic7CgoJLyoqCgkgKiBLZWVwcyB0aGUgY3VycmVudCB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEtlZXBTdGVuY2lsT3AgPSA3NjgwOwoKCS8qKgoJICogV2lsbCBhbHdheXMgcmV0dXJuIHRydWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBBbHdheXNTdGVuY2lsRnVuYyA9IDUxOTsKCgkvKioKCSAqIE5ldmVyIHBhc3MuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBOZXZlckNvbXBhcmUgPSA1MTI7CgoJLyoqCgkgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHRleHR1cmUgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBMZXNzQ29tcGFyZSA9IDUxMzsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGVxdWFscyB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEVxdWFsQ29tcGFyZSA9IDUxNDsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IExlc3NFcXVhbENvbXBhcmUgPSA1MTU7CgoJLyoqCgkgKiBQYXNzIGlmIHRoZSBpbmNvbWluZyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIHRleHR1cmUgdmFsdWUuCgkgKgoJICogQHR5cGUge251bWJlcn0KCSAqIEBjb25zdGFudAoJICovCgljb25zdCBHcmVhdGVyQ29tcGFyZSA9IDUxNjsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIG5vdCBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IE5vdEVxdWFsQ29tcGFyZSA9IDUxNzsKCgkvKioKCSAqIFBhc3MgaWYgdGhlIGluY29taW5nIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB0aGUgdGV4dHVyZSB2YWx1ZS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEdyZWF0ZXJFcXVhbENvbXBhcmUgPSA1MTg7CgoJLyoqCgkgKiBBbHdheXMgcGFzcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IEFsd2F5c0NvbXBhcmUgPSA1MTk7CgoJLyoqCgkgKiBUaGUgY29udGVudHMgYXJlIGludGVuZGVkIHRvIGJlIHNwZWNpZmllZCBvbmNlIGJ5IHRoZSBhcHBsaWNhdGlvbiwgYW5kIHVzZWQgbWFueQoJICogdGltZXMgYXMgdGhlIHNvdXJjZSBmb3IgZHJhd2luZyBhbmQgaW1hZ2Ugc3BlY2lmaWNhdGlvbiBjb21tYW5kcy4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFN0YXRpY0RyYXdVc2FnZSA9IDM1MDQ0OwoKCS8qKgoJICogR0xTTCAzIHNoYWRlciBjb2RlLgoJICoKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgR0xTTDMgPSAnMzAwIGVzJzsKCgkvKioKCSAqIFdlYkdMIGNvb3JkaW5hdGUgc3lzdGVtLgoJICoKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAY29uc3RhbnQKCSAqLwoJY29uc3QgV2ViR0xDb29yZGluYXRlU3lzdGVtID0gMjAwMDsKCgkvKioKCSAqIFdlYkdQVSBjb29yZGluYXRlIHN5c3RlbS4KCSAqCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGNvbnN0YW50CgkgKi8KCWNvbnN0IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gPSAyMDAxOwoKCS8qKgoJICogVGhpcyB0eXBlIHJlcHJlc2VudHMgbW91c2UgYnV0dG9ucyBhbmQgaW50ZXJhY3Rpb24gdHlwZXMgaW4gY29udGV4dCBvZiBjb250cm9scy4KCSAqCgkgKiBAdHlwZWRlZiB7T2JqZWN0fSBDb25zdGFudHNNb3VzZQoJICogQHByb3BlcnR5IHtudW1iZXJ9IE1JRERMRSAtIFRoZSBsZWZ0IG1vdXNlIGJ1dHRvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBMRUZUIC0gVGhlIG1pZGRsZSBtb3VzZSBidXR0b24uCgkgKiBAcHJvcGVydHkge251bWJlcn0gUklHSFQgLSBUaGUgcmlnaHQgbW91c2UgYnV0dG9uLgoJICogQHByb3BlcnR5IHtudW1iZXJ9IFJPVEFURSAtIEEgcm90YXRlIGludGVyYWN0aW9uLgoJICogQHByb3BlcnR5IHtudW1iZXJ9IERPTExZIC0gQSBkb2xseSBpbnRlcmFjdGlvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQQU4gLSBBIHBhbiBpbnRlcmFjdGlvbi4KCSAqKi8KCgkvKioKCSAqIFRoaXMgdHlwZSByZXByZXNlbnRzIHRvdWNoIGludGVyYWN0aW9uIHR5cGVzIGluIGNvbnRleHQgb2YgY29udHJvbHMuCgkgKgoJICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzVG91Y2gKCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBST1RBVEUgLSBBIHJvdGF0ZSBpbnRlcmFjdGlvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBQQU4gLSBBIHBhbiBpbnRlcmFjdGlvbi4KCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBET0xMWV9QQU4gLSBUaGUgZG9sbHktcGFuIGludGVyYWN0aW9uLgoJICogQHByb3BlcnR5IHtudW1iZXJ9IERPTExZX1JPVEFURSAtIEEgZG9sbHktcm90YXRlIGludGVyYWN0aW9uLgoJICoqLwoKCS8qKgoJICogVGhpcyB0eXBlIHJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCB0aW1lc3RhbXAgcXVlcnkgdHlwZXMuCgkgKgoJICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzVGltZXN0YW1wUXVlcnkKCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDT01QVVRFIC0gQSBgY29tcHV0ZWAgdGltZXN0YW1wIHF1ZXJ5LgoJICogQHByb3BlcnR5IHtzdHJpbmd9IFJFTkRFUiAtIEEgYHJlbmRlcmAgdGltZXN0YW1wIHF1ZXJ5LgoJICoqLwoKCS8qKgoJICogUmVwcmVzZW50cyB0aGUgZGlmZmVyZW50IGludGVycG9sYXRpb24gc2FtcGxpbmcgdHlwZXMuCgkgKgoJICogQHR5cGVkZWYge09iamVjdH0gQ29uc3RhbnRzSW50ZXJwb2xhdGlvblNhbXBsaW5nVHlwZQoJICogQHByb3BlcnR5IHtzdHJpbmd9IFBFUlNQRUNUSVZFIC0gUGVyc3BlY3RpdmUtY29ycmVjdCBpbnRlcnBvbGF0aW9uLgoJICogQHByb3BlcnR5IHtzdHJpbmd9IExJTkVBUiAtIExpbmVhciBpbnRlcnBvbGF0aW9uLgoJICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVQgLSBGbGF0IGludGVycG9sYXRpb24uCgkgKi8KCgkvKioKCSAqIFJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCBpbnRlcnBvbGF0aW9uIHNhbXBsaW5nIG1vZGVzLgoJICoKCSAqIEB0eXBlZGVmIHtPYmplY3R9IENvbnN0YW50c0ludGVycG9sYXRpb25TYW1wbGluZ01vZGUKCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBOT1JNQUwgLSBOb3JtYWwgc2FtcGxpbmcgbW9kZS4KCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBDRU5UUk9JRCAtIENlbnRyb2lkIHNhbXBsaW5nIG1vZGUuCgkgKiBAcHJvcGVydHkge3N0cmluZ30gU0FNUExFIC0gU2FtcGxlLXNwZWNpZmljIHNhbXBsaW5nIG1vZGUuCgkgKiBAcHJvcGVydHkge3N0cmluZ30gRkxBVF9GSVJTVCAtIEZsYXQgaW50ZXJwb2xhdGlvbiB1c2luZyB0aGUgZmlyc3QgdmVydGV4LgoJICogQHByb3BlcnR5IHtzdHJpbmd9IEZMQVRfRUlUSEVSIC0gRmxhdCBpbnRlcnBvbGF0aW9uIHVzaW5nIGVpdGhlciB2ZXJ0ZXguCgkgKi8KCgkvKioKCSAqIFRoaXMgbW9kdWxlcyBhbGxvd3MgdG8gZGlzcGF0Y2ggZXZlbnQgb2JqZWN0cyBvbiBjdXN0b20gSmF2YVNjcmlwdCBvYmplY3RzLgoJICoKCSAqIE1haW4gcmVwb3NpdG9yeTogW2V2ZW50ZGlzcGF0Y2hlci5qc117QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi9ldmVudGRpc3BhdGNoZXIuanMvfQoJICoKCSAqIENvZGUgRXhhbXBsZToKCSAqIGBgYGpzCgkgKiBjbGFzcyBDYXIgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoJICogCXN0YXJ0KCkgewoJICoJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc3RhcnQnLCBtZXNzYWdlOiAndnJvb20gdnJvb20hJyB9ICk7CgkgKgl9CgkgKn07CgkgKgoJICogLy8gVXNpbmcgZXZlbnRzIHdpdGggdGhlIGN1c3RvbSBvYmplY3QKCSAqIGNvbnN0IGNhciA9IG5ldyBDYXIoKTsKCSAqIGNhci5hZGRFdmVudExpc3RlbmVyKCAnc3RhcnQnLCBmdW5jdGlvbiAoIGV2ZW50ICkgewoJICogCWFsZXJ0KCBldmVudC5tZXNzYWdlICk7CgkgKiB9ICk7CgkgKgoJICogY2FyLnN0YXJ0KCk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgRXZlbnREaXNwYXRjaGVyIHsKCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGdpdmVuIGV2ZW50IHR5cGUuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIFRoZSB0eXBlIG9mIGV2ZW50IHRvIGxpc3RlbiB0by4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBmdW5jdGlvbiB0aGF0IGdldHMgY2FsbGVkIHdoZW4gdGhlIGV2ZW50IGlzIGZpcmVkLgoJCSAqLwoJCWFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGxpc3RlbmVyICkgewoKCQkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHRoaXMuX2xpc3RlbmVycyA9IHt9OwoKCQkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKCQkJaWYgKCBsaXN0ZW5lcnNbIHR5cGUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWxpc3RlbmVyc1sgdHlwZSBdID0gW107CgoJCQl9CgoJCQlpZiAoIGxpc3RlbmVyc1sgdHlwZSBdLmluZGV4T2YoIGxpc3RlbmVyICkgPT09IC0xICkgewoKCQkJCWxpc3RlbmVyc1sgdHlwZSBdLnB1c2goIGxpc3RlbmVyICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGV2ZW50IGxpc3RlbmVyIGhhcyBiZWVuIGFkZGVkIHRvIHRoZSBnaXZlbiBldmVudCB0eXBlLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudC4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBsaXN0ZW5lciB0byBjaGVjay4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBoYXMgYmVlbiBhZGRlZCB0byB0aGUgZ2l2ZW4gZXZlbnQgdHlwZS4KCQkgKi8KCQloYXNFdmVudExpc3RlbmVyKCB0eXBlLCBsaXN0ZW5lciApIHsKCgkJCWNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCgkJCWlmICggbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSByZXR1cm4gZmFsc2U7CgoJCQlyZXR1cm4gbGlzdGVuZXJzWyB0eXBlIF0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApICE9PSAtMTsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBnaXZlbiBldmVudCBsaXN0ZW5lciBmcm9tIHRoZSBnaXZlbiBldmVudCB0eXBlLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgdHlwZSBvZiBldmVudC4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciAtIFRoZSBsaXN0ZW5lciB0byByZW1vdmUuCgkJICovCgkJcmVtb3ZlRXZlbnRMaXN0ZW5lciggdHlwZSwgbGlzdGVuZXIgKSB7CgoJCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgoJCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgdHlwZSBdOwoKCQkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgaW5kZXggPSBsaXN0ZW5lckFycmF5LmluZGV4T2YoIGxpc3RlbmVyICk7CgoJCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgoJCQkJCWxpc3RlbmVyQXJyYXkuc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBEaXNwYXRjaGVzIGFuIGV2ZW50IG9iamVjdC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAtIFRoZSBldmVudCB0aGF0IGdldHMgZmlyZWQuCgkJICovCgkJZGlzcGF0Y2hFdmVudCggZXZlbnQgKSB7CgoJCQljb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgoJCQlpZiAoIGxpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgZXZlbnQudHlwZSBdOwoKCQkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZXZlbnQudGFyZ2V0ID0gdGhpczsKCgkJCQkvLyBNYWtlIGEgY29weSwgaW4gY2FzZSBsaXN0ZW5lcnMgYXJlIHJlbW92ZWQgd2hpbGUgaXRlcmF0aW5nLgoJCQkJY29uc3QgYXJyYXkgPSBsaXN0ZW5lckFycmF5LnNsaWNlKCAwICk7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJYXJyYXlbIGkgXS5jYWxsKCB0aGlzLCBldmVudCApOwoKCQkJCX0KCgkJCQlldmVudC50YXJnZXQgPSBudWxsOwoKCQkJfQoKCQl9CgoJfQoKCWNvbnN0IF9sdXQgPSBbICcwMCcsICcwMScsICcwMicsICcwMycsICcwNCcsICcwNScsICcwNicsICcwNycsICcwOCcsICcwOScsICcwYScsICcwYicsICcwYycsICcwZCcsICcwZScsICcwZicsICcxMCcsICcxMScsICcxMicsICcxMycsICcxNCcsICcxNScsICcxNicsICcxNycsICcxOCcsICcxOScsICcxYScsICcxYicsICcxYycsICcxZCcsICcxZScsICcxZicsICcyMCcsICcyMScsICcyMicsICcyMycsICcyNCcsICcyNScsICcyNicsICcyNycsICcyOCcsICcyOScsICcyYScsICcyYicsICcyYycsICcyZCcsICcyZScsICcyZicsICczMCcsICczMScsICczMicsICczMycsICczNCcsICczNScsICczNicsICczNycsICczOCcsICczOScsICczYScsICczYicsICczYycsICczZCcsICczZScsICczZicsICc0MCcsICc0MScsICc0MicsICc0MycsICc0NCcsICc0NScsICc0NicsICc0NycsICc0OCcsICc0OScsICc0YScsICc0YicsICc0YycsICc0ZCcsICc0ZScsICc0ZicsICc1MCcsICc1MScsICc1MicsICc1MycsICc1NCcsICc1NScsICc1NicsICc1NycsICc1OCcsICc1OScsICc1YScsICc1YicsICc1YycsICc1ZCcsICc1ZScsICc1ZicsICc2MCcsICc2MScsICc2MicsICc2MycsICc2NCcsICc2NScsICc2NicsICc2NycsICc2OCcsICc2OScsICc2YScsICc2YicsICc2YycsICc2ZCcsICc2ZScsICc2ZicsICc3MCcsICc3MScsICc3MicsICc3MycsICc3NCcsICc3NScsICc3NicsICc3NycsICc3OCcsICc3OScsICc3YScsICc3YicsICc3YycsICc3ZCcsICc3ZScsICc3ZicsICc4MCcsICc4MScsICc4MicsICc4MycsICc4NCcsICc4NScsICc4NicsICc4NycsICc4OCcsICc4OScsICc4YScsICc4YicsICc4YycsICc4ZCcsICc4ZScsICc4ZicsICc5MCcsICc5MScsICc5MicsICc5MycsICc5NCcsICc5NScsICc5NicsICc5NycsICc5OCcsICc5OScsICc5YScsICc5YicsICc5YycsICc5ZCcsICc5ZScsICc5ZicsICdhMCcsICdhMScsICdhMicsICdhMycsICdhNCcsICdhNScsICdhNicsICdhNycsICdhOCcsICdhOScsICdhYScsICdhYicsICdhYycsICdhZCcsICdhZScsICdhZicsICdiMCcsICdiMScsICdiMicsICdiMycsICdiNCcsICdiNScsICdiNicsICdiNycsICdiOCcsICdiOScsICdiYScsICdiYicsICdiYycsICdiZCcsICdiZScsICdiZicsICdjMCcsICdjMScsICdjMicsICdjMycsICdjNCcsICdjNScsICdjNicsICdjNycsICdjOCcsICdjOScsICdjYScsICdjYicsICdjYycsICdjZCcsICdjZScsICdjZicsICdkMCcsICdkMScsICdkMicsICdkMycsICdkNCcsICdkNScsICdkNicsICdkNycsICdkOCcsICdkOScsICdkYScsICdkYicsICdkYycsICdkZCcsICdkZScsICdkZicsICdlMCcsICdlMScsICdlMicsICdlMycsICdlNCcsICdlNScsICdlNicsICdlNycsICdlOCcsICdlOScsICdlYScsICdlYicsICdlYycsICdlZCcsICdlZScsICdlZicsICdmMCcsICdmMScsICdmMicsICdmMycsICdmNCcsICdmNScsICdmNicsICdmNycsICdmOCcsICdmOScsICdmYScsICdmYicsICdmYycsICdmZCcsICdmZScsICdmZicgXTsKCgoJY29uc3QgREVHMlJBRCA9IE1hdGguUEkgLyAxODA7Cgljb25zdCBSQUQyREVHID0gMTgwIC8gTWF0aC5QSTsKCgkvKioKCSAqIEdlbmVyYXRlIGEgW1VVSURde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1VuaXZlcnNhbGx5X3VuaXF1ZV9pZGVudGlmaWVyfQoJICogKHVuaXZlcnNhbGx5IHVuaXF1ZSBpZGVudGlmaWVyKS4KCSAqCgkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBVVUlELgoJICovCglmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CgoJCS8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1MDM0L2hvdy10by1jcmVhdGUtYS1ndWlkLXV1aWQtaW4tamF2YXNjcmlwdC8yMTk2MzEzNiMyMTk2MzEzNgoKCQljb25zdCBkMCA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCBkMSA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCBkMiA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCBkMyA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCQljb25zdCB1dWlkID0gX2x1dFsgZDAgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiA4ICYgMHhmZiBdICsgX2x1dFsgZDAgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiAyNCAmIDB4ZmYgXSArICctJyArCgkJCQlfbHV0WyBkMSAmIDB4ZmYgXSArIF9sdXRbIGQxID4+IDggJiAweGZmIF0gKyAnLScgKyBfbHV0WyBkMSA+PiAxNiAmIDB4MGYgfCAweDQwIF0gKyBfbHV0WyBkMSA+PiAyNCAmIDB4ZmYgXSArICctJyArCgkJCQlfbHV0WyBkMiAmIDB4M2YgfCAweDgwIF0gKyBfbHV0WyBkMiA+PiA4ICYgMHhmZiBdICsgJy0nICsgX2x1dFsgZDIgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMiA+PiAyNCAmIDB4ZmYgXSArCgkJCQlfbHV0WyBkMyAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDggJiAweGZmIF0gKyBfbHV0WyBkMyA+PiAxNiAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDI0ICYgMHhmZiBdOwoKCQkvLyAudG9Mb3dlckNhc2UoKSBoZXJlIGZsYXR0ZW5zIGNvbmNhdGVuYXRlZCBzdHJpbmdzIHRvIHNhdmUgaGVhcCBtZW1vcnkgc3BhY2UuCgkJcmV0dXJuIHV1aWQudG9Mb3dlckNhc2UoKTsKCgl9CgoJLyoqCgkgKiBDbGFtcHMgdGhlIGdpdmVuIHZhbHVlIGJldHdlZW4gbWluIGFuZCBtYXguCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIGNsYW1wLgoJICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW4gdmFsdWUuCgkgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heCB2YWx1ZS4KCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNsYW1wZWQgdmFsdWUuCgkgKi8KCWZ1bmN0aW9uIGNsYW1wKCB2YWx1ZSwgbWluLCBtYXggKSB7CgoJCXJldHVybiBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCB2YWx1ZSApICk7CgoJfQoKCS8qKgoJICogQ29tcHV0ZXMgdGhlIEV1Y2xpZGVhbiBtb2R1bG8gb2YgdGhlIGdpdmVuIHBhcmFtZXRlcnMgdGhhdAoJICogaXMgYCggKCBuICUgbSApICsgbSApICUgbWAuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IG4gLSBUaGUgZmlyc3QgcGFyYW1ldGVyLgoJICogQHBhcmFtIHtudW1iZXJ9IG0gLSBUaGUgc2Vjb25kIHBhcmFtZXRlci4KCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIEV1Y2xpZGVhbiBtb2R1bG8uCgkgKi8KCWZ1bmN0aW9uIGV1Y2xpZGVhbk1vZHVsbyggbiwgbSApIHsKCgkJLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTW9kdWxvX29wZXJhdGlvbgoKCQlyZXR1cm4gKCAoIG4gJSBtICkgKyBtICkgJSBtOwoKCX0KCgkvKioKCSAqIFJldHVybnMgYSB2YWx1ZSBsaW5lYXJseSBpbnRlcnBvbGF0ZWQgZnJvbSB0d28ga25vd24gcG9pbnRzIGJhc2VkIG9uIHRoZSBnaXZlbiBpbnRlcnZhbCAtCgkgKiBgdCA9IDBgIHdpbGwgcmV0dXJuIGB4YCBhbmQgYHQgPSAxYCB3aWxsIHJldHVybiBgeWAuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgc3RhcnQgcG9pbnQKCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGVuZCBwb2ludC4KCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSBjbG9zZWQgaW50ZXJ2YWwgYFswLCAxXWAuCgkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBpbnRlcnBvbGF0ZWQgdmFsdWUuCgkgKi8KCWZ1bmN0aW9uIGxlcnAoIHgsIHksIHQgKSB7CgoJCXJldHVybiAoIDEgLSB0ICkgKiB4ICsgdCAqIHk7CgoJfQoKCS8qKgoJICogRGVub3JtYWxpemVzIHRoZSBnaXZlbiB2YWx1ZSBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIHR5cGVkIGFycmF5LgoJICoKCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBkZW5vcm1hbGl6ZS4KCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgdHlwZWQgYXJyYXkgdGhhdCBkZWZpbmVzIHRoZSBkYXRhIHR5cGUgb2YgdGhlIHZhbHVlLgoJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGVub3JtYWxpemUgKGZsb2F0KSB2YWx1ZSBpbiB0aGUgcmFuZ2UgYFswLDFdYC4KCSAqLwoJZnVuY3Rpb24gZGVub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCgkJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgoJCQljYXNlIEZsb2F0MzJBcnJheToKCgkJCQlyZXR1cm4gdmFsdWU7CgoJCQljYXNlIFVpbnQzMkFycmF5OgoKCQkJCXJldHVybiB2YWx1ZSAvIDQyOTQ5NjcyOTUuMDsKCgkJCWNhc2UgVWludDE2QXJyYXk6CgoJCQkJcmV0dXJuIHZhbHVlIC8gNjU1MzUuMDsKCgkJCWNhc2UgVWludDhBcnJheToKCgkJCQlyZXR1cm4gdmFsdWUgLyAyNTUuMDsKCgkJCWNhc2UgSW50MzJBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5tYXgoIHZhbHVlIC8gMjE0NzQ4MzY0Ny4wLCAtMSApOwoKCQkJY2FzZSBJbnQxNkFycmF5OgoKCQkJCXJldHVybiBNYXRoLm1heCggdmFsdWUgLyAzMjc2Ny4wLCAtMSApOwoKCQkJY2FzZSBJbnQ4QXJyYXk6CgoJCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDEyNy4wLCAtMSApOwoKCQkJZGVmYXVsdDoKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCgkJfQoKCX0KCgkvKioKCSAqIE5vcm1hbGl6ZXMgdGhlIGdpdmVuIHZhbHVlIGFjY29yZGluZyB0byB0aGUgZ2l2ZW4gdHlwZWQgYXJyYXkuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlIC0gVGhlIGZsb2F0IHZhbHVlIGluIHRoZSByYW5nZSBgWzAsMV1gIHRvIG5vcm1hbGl6ZS4KCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgdHlwZWQgYXJyYXkgdGhhdCBkZWZpbmVzIHRoZSBkYXRhIHR5cGUgb2YgdGhlIHZhbHVlLgoJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbm9ybWFsaXplIHZhbHVlLgoJICovCglmdW5jdGlvbiBub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCgkJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgoJCQljYXNlIEZsb2F0MzJBcnJheToKCgkJCQlyZXR1cm4gdmFsdWU7CgoJCQljYXNlIFVpbnQzMkFycmF5OgoKCQkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDQyOTQ5NjcyOTUuMCApOwoKCQkJY2FzZSBVaW50MTZBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiA2NTUzNS4wICk7CgoJCQljYXNlIFVpbnQ4QXJyYXk6CgoJCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogMjU1LjAgKTsKCgkJCWNhc2UgSW50MzJBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAyMTQ3NDgzNjQ3LjAgKTsKCgkJCWNhc2UgSW50MTZBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAzMjc2Ny4wICk7CgoJCQljYXNlIEludDhBcnJheToKCgkJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAxMjcuMCApOwoKCQkJZGVmYXVsdDoKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdJbnZhbGlkIGNvbXBvbmVudCB0eXBlLicgKTsKCgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIDJEIHZlY3Rvci4gQSAyRCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCBwYWlyIG9mIG51bWJlcnMKCSAqIChsYWJlbGVkIHggYW5kIHkpLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgoJICoKCSAqIC0gQSBwb2ludCBpbiAyRCBzcGFjZSAoaS5lLiBhIHBvc2l0aW9uIG9uIGEgcGxhbmUpLgoJICogLSBBIGRpcmVjdGlvbiBhbmQgbGVuZ3RoIGFjcm9zcyBhIHBsYW5lLiBJbiB0aHJlZS5qcyB0aGUgbGVuZ3RoIHdpbGwKCSAqIGFsd2F5cyBiZSB0aGUgRXVjbGlkZWFuIGRpc3RhbmNlKHN0cmFpZ2h0LWxpbmUgZGlzdGFuY2UpIGZyb20gYCgwLCAwKWAgdG8gYCh4LCB5KWAKCSAqIGFuZCB0aGUgZGlyZWN0aW9uIGlzIGFsc28gbWVhc3VyZWQgZnJvbSBgKDAsIDApYCB0b3dhcmRzIGAoeCwgeSlgLgoJICogLSBBbnkgYXJiaXRyYXJ5IG9yZGVyZWQgcGFpciBvZiBudW1iZXJzLgoJICoKCSAqIFRoZXJlIGFyZSBvdGhlciB0aGluZ3MgYSAyRCB2ZWN0b3IgY2FuIGJlIHVzZWQgdG8gcmVwcmVzZW50LCBzdWNoIGFzCgkgKiBtb21lbnR1bSB2ZWN0b3JzLCBjb21wbGV4IG51bWJlcnMgYW5kIHNvIG9uLCBob3dldmVyIHRoZXNlIGFyZSB0aGUgbW9zdAoJICogY29tbW9uIHVzZXMgaW4gdGhyZWUuanMuCgkgKgoJICogSXRlcmF0aW5nIHRocm91Z2ggYSB2ZWN0b3IgaW5zdGFuY2Ugd2lsbCB5aWVsZCBpdHMgY29tcG9uZW50cyBgKHgsIHkpYCBpbgoJICogdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCgkgKiBgYGBqcwoJICogY29uc3QgYSA9IG5ldyBUSFJFRS5WZWN0b3IyKCAwLCAxICk7CgkgKgoJICogLy9ubyBhcmd1bWVudHM7IHdpbGwgYmUgaW5pdGlhbGlzZWQgdG8gKDAsIDApCgkgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjIoICk7CgkgKgoJICogY29uc3QgZCA9IGEuZGlzdGFuY2VUbyggYiApOwoJICogYGBgCgkgKi8KCWNsYXNzIFZlY3RvcjIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IDJEIHZlY3Rvci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeD0wXSAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeT0wXSAtIFRoZSB5IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJVmVjdG9yMi5wcm90b3R5cGUuaXNWZWN0b3IyID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMueCA9IHg7CgoJCQkvKioKCQkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnkgPSB5OwoKCQl9CgoJCS8qKgoJCSAqIEFsaWFzIGZvciB7QGxpbmsgVmVjdG9yMiN4fS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICovCgkJZ2V0IHdpZHRoKCkgewoKCQkJcmV0dXJuIHRoaXMueDsKCgkJfQoKCQlzZXQgd2lkdGgoIHZhbHVlICkgewoKCQkJdGhpcy54ID0gdmFsdWU7CgoJCX0KCgkJLyoqCgkJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3IyI3l9LgoJCSAqCgkJICogQHR5cGUge251bWJlcn0KCQkgKi8KCQlnZXQgaGVpZ2h0KCkgewoKCQkJcmV0dXJuIHRoaXMueTsKCgkJfQoKCQlzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCgkJCXRoaXMueSA9IHZhbHVlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXQoIHgsIHkgKSB7CgoJCQl0aGlzLnggPSB4OwoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHNhbWUgdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHZhbHVlIHRvIHNldCBmb3IgYWxsIHZlY3RvciBjb21wb25lbnRzLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ID0gc2NhbGFyOwoJCQl0aGlzLnkgPSBzY2FsYXI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB4IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRYKCB4ICkgewoKCQkJdGhpcy54ID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvcidzIHkgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFkoIHkgKSB7CgoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWxsb3dzIHRvIHNldCBhIHZlY3RvciBjb21wb25lbnQgd2l0aCBhbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb21wb25lbnQgaW5kZXguIGAwYCBlcXVhbHMgdG8geCwgYDFgIGVxdWFscyB0byB5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSB2ZWN0b3IgY29tcG9uZW50IHdoaWNoIG1hdGNoZXMgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbXBvbmVudCBpbmRleC4gYDBgIGVxdWFscyB0byB4LCBgMWAgZXF1YWxzIHRvIHkuCgkJICogQHJldHVybiB7bnVtYmVyfSBBIHZlY3RvciBjb21wb25lbnQgdmFsdWUuCgkJICovCgkJZ2V0Q29tcG9uZW50KCBpbmRleCApIHsKCgkJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJCWNhc2UgMDogcmV0dXJuIHRoaXMueDsKCQkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKCQkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyB2ZWN0b3Igd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy54LCB0aGlzLnkgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGNvcHkuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY29weSggdiApIHsKCgkJCXRoaXMueCA9IHYueDsKCQkJdGhpcy55ID0gdi55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIGFkZC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGQoIHYgKSB7CgoJCQl0aGlzLnggKz0gdi54OwoJCQl0aGlzLnkgKz0gdi55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFNjYWxhciggcyApIHsKCgkJCXRoaXMueCArPSBzOwoJCQl0aGlzLnkgKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKyBiLng7CgkJCXRoaXMueSA9IGEueSArIGIueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciBzY2FsZWQgYnkgdGhlIGdpdmVuIGZhY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBmYWN0b3IgdGhhdCBzY2FsZXMgYHZgLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCgkJCXRoaXMueCArPSB2LnggKiBzOwoJCQl0aGlzLnkgKz0gdi55ICogczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gc3VidHJhY3QuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc3ViKCB2ICkgewoKCQkJdGhpcy54IC09IHYueDsKCQkJdGhpcy55IC09IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIGZyb20gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBzdWJ0cmFjdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzdWJTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnggLT0gczsKCQkJdGhpcy55IC09IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggLSBiLng7CgkJCXRoaXMueSA9IGEueSAtIGIueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIG11bHRpcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW11bHRpcGx5KCB2ICkgewoKCQkJdGhpcy54ICo9IHYueDsKCQkJdGhpcy55ICo9IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ICo9IHNjYWxhcjsKCQkJdGhpcy55ICo9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZGl2aWRlKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGlzIHZlY3RvciAod2l0aCBhbiBpbXBsaWNpdCAxIGFzIHRoZSAzcmQgY29tcG9uZW50KSBieQoJCSAqIHRoZSBnaXZlbiAzeDMgbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhcHBseU1hdHJpeDMoIG0gKSB7CgoJCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55OwoJCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDAgXSAqIHggKyBlWyAzIF0gKiB5ICsgZVsgNiBdOwoJCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCBvciB5IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgZ2l2ZW4gdmVjdG9yJ3MgeCBvciB5CgkJICogdmFsdWUsIHJlcGxhY2UgdGhhdCB2YWx1ZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIG1pbiB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbWluKCB2ICkgewoKCQkJdGhpcy54ID0gTWF0aC5taW4oIHRoaXMueCwgdi54ICk7CgkJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4IG9yIHkKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltYXgoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2ZWN0b3IncyB4IG9yIHkKCQkgKiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmVjdG9yJ3MgeCBvciB5IHZhbHVlLAoJCSAqIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSBtaW4gLSBUaGUgbWluaW11bSB4IGFuZCB5IHZhbHVlcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1heCAtIFRoZSBtYXhpbXVtIHggYW5kIHkgdmFsdWVzIGluIHRoZSBkZXNpcmVkIHJhbmdlLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNsYW1wKCBtaW4sIG1heCApIHsKCgkJCS8vIGFzc3VtZXMgbWluIDwgbWF4LCBjb21wb25lbnR3aXNlCgoJCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW4ueCwgbWF4LnggKTsKCQkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluLnksIG1heC55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIHggb3IgeSB2YWx1ZXMgYXJlIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCB0aGV5IGFyZQoJCSAqIHJlcGxhY2VkIGJ5IHRoZSBtYXggdmFsdWUuCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4IG9yIHkgdmFsdWVzIGFyZSBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgdGhleSBhcmUKCQkgKiByZXBsYWNlZCBieSB0aGUgbWluIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IG1pblZhbCAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcGFyYW0ge251bWJlcn0gbWF4VmFsIC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNsYW1wU2NhbGFyKCBtaW5WYWwsIG1heFZhbCApIHsKCgkJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pblZhbCwgbWF4VmFsICk7CgkJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pblZhbCwgbWF4VmFsICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkKCQkgKiB0aGUgbWF4IHZhbHVlLgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUKCQkgKiBtaW4gdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gbWluIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXggLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKCQkJY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggY2xhbXAoIGxlbmd0aCwgbWluLCBtYXggKSApOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIGRvd24gdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWZsb29yKCkgewoKCQkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNlaWwoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmQoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCB0b3dhcmRzIHplcm8gKHVwIGlmIG5lZ2F0aXZlLAoJCSAqIGRvd24gaWYgcG9zaXRpdmUpIHRvIGFuIGludGVnZXIgdmFsdWUuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlyb3VuZFRvWmVybygpIHsKCgkJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLnRydW5jKCB0aGlzLnkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEludmVydHMgdGhpcyB2ZWN0b3IgLSBpLmUuIHNldHMgeCA9IC14IGFuZCB5ID0gLXkuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQluZWdhdGUoKSB7CgoJCQl0aGlzLnggPSAtIHRoaXMueDsKCQkJdGhpcy55ID0gLSB0aGlzLnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgZG90IHByb2R1Y3Qgd2l0aC4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSByZXN1bHQgb2YgdGhlIGRvdCBwcm9kdWN0LgoJCSAqLwoJCWRvdCggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2Lnk7CgoJCX0KCgkJLyoqCgkJICogQ2FsY3VsYXRlcyB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgY3Jvc3MgcHJvZHVjdCB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgY3Jvc3MgcHJvZHVjdC4KCQkgKi8KCQljcm9zcyggdiApIHsKCgkJCXJldHVybiB0aGlzLnggKiB2LnkgLSB0aGlzLnkgKiB2Lng7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHNxdWFyZSBvZiB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIGZyb20KCQkgKiAoMCwgMCkgdG8gKHgsIHkpLiBJZiB5b3UgYXJlIGNvbXBhcmluZyB0aGUgbGVuZ3RocyBvZiB2ZWN0b3JzLCB5b3Ugc2hvdWxkCgkJICogY29tcGFyZSB0aGUgbGVuZ3RoIHNxdWFyZWQgaW5zdGVhZCBhcyBpdCBpcyBzbGlnaHRseSBtb3JlIGVmZmljaWVudCB0byBjYWxjdWxhdGUuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlbmd0aFNxKCkgewoKCQkJcmV0dXJuIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tICgwLCAwKSB0byAoeCwgeSkuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJbGVuZ3RoKCkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJbWFuaGF0dGFuTGVuZ3RoKCkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKTsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGlzIHZlY3RvciB0byBhIHVuaXQgdmVjdG9yIC0gdGhhdCBpcywgc2V0cyBpdCBlcXVhbCB0byBhIHZlY3RvcgoJCSAqIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQgd2l0aCBhIHZlY3RvciBsZW5ndGggb2YgYDFgLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbm9ybWFsaXplKCkgewoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCB0aGlzLmxlbmd0aCgpIHx8IDEgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgYW5nbGUgaW4gcmFkaWFucyBvZiB0aGlzIHZlY3RvciB3aXRoIHJlc3BlY3QgdG8gdGhlIHBvc2l0aXZlIHgtYXhpcy4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICovCgkJYW5nbGUoKSB7CgoJCQljb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoIC0gdGhpcy55LCAtIHRoaXMueCApICsgTWF0aC5QSTsKCgkJCXJldHVybiBhbmdsZTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgYW5nbGUgd2l0aC4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqLwoJCWFuZ2xlVG8oIHYgKSB7CgoJCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgoJCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKCQkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgoJCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKCQkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtMSwgMSApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IyfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICogSWYgeW91IGFyZSBqdXN0IGNvbXBhcmluZyB0aGUgZGlzdGFuY2Ugd2l0aCBhbm90aGVyIGRpc3RhbmNlLCB5b3Ugc2hvdWxkIGNvbXBhcmUKCQkgKiB0aGUgZGlzdGFuY2Ugc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgc3F1YXJlZCBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKCQkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55OwoJCQlyZXR1cm4gZHggKiBkeCArIGR5ICogZHk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIE1hbmhhdHRhbiBkaXN0YW5jZS4KCQkgKi8KCQltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdmVjdG9yIHdpdGggdGhlIHNhbWUgZGlyZWN0aW9uIGFzIHRoaXMgb25lLCBidXQKCQkgKiB3aXRoIHRoZSBzcGVjaWZpZWQgbGVuZ3RoLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGxlbmd0aCAtIFRoZSBuZXcgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldExlbmd0aCggbGVuZ3RoICkgewoKCQkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UsIHdoZXJlCgkJICogYWxwaGEgaXMgdGhlIHBlcmNlbnQgZGlzdGFuY2UgYWxvbmcgdGhlIGxpbmUgLSBhbHBoYSA9IDAgd2lsbCBiZSB0aGlzCgkJICogdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwgYmUgdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdiAtIFRoZSB2ZWN0b3IgdG8gaW50ZXJwb2xhdGUgdG93YXJkcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlcnAoIHYsIGFscGhhICkgewoKCQkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKCQkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3JzLCB3aGVyZSBhbHBoYSBpcyB0aGUgcGVyY2VudAoJCSAqIGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgZmlyc3QgdmVjdG9yLCBhbmQgYWxwaGEgPSAxIHdpbGwKCQkgKiBiZSB0aGUgc2Vjb25kIG9uZS4gVGhlIHJlc3VsdCBpcyBzdG9yZWQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdjEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdjIgLSBUaGUgc2Vjb25kIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IsIHR5cGljYWxseSBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKCQkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwoJCQl0aGlzLnkgPSB2MS55ICsgKCB2Mi55IC0gdjEueSApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IHYgLSBUaGUgdmVjdG9yIHRvIHRlc3QgZm9yIGVxdWFsaXR5LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggdiApIHsKCgkJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdmVjdG9yJ3MgeCB2YWx1ZSB0byBiZSBgYXJyYXlbIG9mZnNldCBdYCBhbmQgeQoJCSAqIHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMSBdYC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IyfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGlzIHZlY3RvciBhcm91bmQgdGhlIGdpdmVuIGNlbnRlciBieSB0aGUgZ2l2ZW4gYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IGNlbnRlciAtIFRoZSBwb2ludCBhcm91bmQgd2hpY2ggdG8gcm90YXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSB0byByb3RhdGUsIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm90YXRlQXJvdW5kKCBjZW50ZXIsIGFuZ2xlICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCBhbmdsZSApLCBzID0gTWF0aC5zaW4oIGFuZ2xlICk7CgoJCQljb25zdCB4ID0gdGhpcy54IC0gY2VudGVyLng7CgkJCWNvbnN0IHkgPSB0aGlzLnkgLSBjZW50ZXIueTsKCgkJCXRoaXMueCA9IHggKiBjIC0geSAqIHMgKyBjZW50ZXIueDsKCQkJdGhpcy55ID0geCAqIHMgKyB5ICogYyArIGNlbnRlci55OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyBlYWNoIGNvbXBvbmVudCBvZiB0aGlzIHZlY3RvciB0byBhIHBzZXVkby1yYW5kb20gdmFsdWUgYmV0d2VlbiBgMGAgYW5kCgkJICogYDFgLCBleGNsdWRpbmcgYDFgLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yMn0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcmFuZG9tKCkgewoKCQkJdGhpcy54ID0gTWF0aC5yYW5kb20oKTsKCQkJdGhpcy55ID0gTWF0aC5yYW5kb20oKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQkJeWllbGQgdGhpcy54OwoJCQl5aWVsZCB0aGlzLnk7CgoJCX0KCgl9CgoJLyoqCgkgKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgUXVhdGVybmlvbi4gUXVhdGVybmlvbnMgYXJlIHVzZWQgaW4gdGhyZWUuanMgdG8gcmVwcmVzZW50IHJvdGF0aW9ucy4KCSAqCgkgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeiwgdylgIGluCgkgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KCSAqCgkgKiBOb3RlIHRoYXQgdGhyZWUuanMgZXhwZWN0cyBRdWF0ZXJuaW9ucyB0byBiZSBub3JtYWxpemVkLgoJICogYGBganMKCSAqIGNvbnN0IHF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpOwoJICogcXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBuZXcgVEhSRUUuVmVjdG9yMyggMCwgMSwgMCApLCBNYXRoLlBJIC8gMiApOwoJICoKCSAqIGNvbnN0IHZlY3RvciA9IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAwLCAwICk7CgkgKiB2ZWN0b3IuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ZXJuaW9uICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgUXVhdGVybmlvbiB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeD0wXSAtIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdz0xXSAtIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCwgdyA9IDEgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc1F1YXRlcm5pb24gPSB0cnVlOwoKCQkJdGhpcy5feCA9IHg7CgkJCXRoaXMuX3kgPSB5OwoJCQl0aGlzLl96ID0gejsKCQkJdGhpcy5fdyA9IHc7CgoJCX0KCgkJLyoqCgkJICogSW50ZXJwb2xhdGVzIGJldHdlZW4gdHdvIHF1YXRlcm5pb25zIHZpYSBTTEVSUC4gVGhpcyBpbXBsZW1lbnRhdGlvbiBhc3N1bWVzIHRoZQoJCSAqIHF1YXRlcm5pb24gZGF0YSBhcmUgbWFuYWdlZCAgaW4gZmxhdCBhcnJheXMuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGRzdCAtIFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZHN0T2Zmc2V0IC0gQW4gb2Zmc2V0IGludG8gdGhlIGRlc3RpbmF0aW9uIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMCAtIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIGZpcnN0IHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHNyY09mZnNldDAgLSBBbiBvZmZzZXQgaW50byB0aGUgZmlyc3Qgc291cmNlIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMSAtICBUaGUgc291cmNlIGFycmF5IG9mIHRoZSBzZWNvbmQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MSAtIEFuIG9mZnNldCBpbnRvIHRoZSBzZWNvbmQgc291cmNlIGFycmF5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yIGluIHRoZSByYW5nZSBgWzAsMV1gLgoJCSAqIEBzZWUge0BsaW5rIFF1YXRlcm5pb24jc2xlcnB9CgkJICovCgkJc3RhdGljIHNsZXJwRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEsIHQgKSB7CgoJCQkvLyBmdXp6LWZyZWUsIGFycmF5LWJhc2VkIFF1YXRlcm5pb24gU0xFUlAgb3BlcmF0aW9uCgoJCQlsZXQgeDAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMCBdLAoJCQkJeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdLAoJCQkJejAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMiBdLAoJCQkJdzAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMyBdOwoKCQkJY29uc3QgeDEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMCBdLAoJCQkJeTEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMSBdLAoJCQkJejEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMiBdLAoJCQkJdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKCQkJaWYgKCB0ID09PSAwICkgewoKCQkJCWRzdFsgZHN0T2Zmc2V0ICsgMCBdID0geDA7CgkJCQlkc3RbIGRzdE9mZnNldCArIDEgXSA9IHkwOwoJCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MDsKCQkJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlpZiAoIHQgPT09IDEgKSB7CgoJCQkJZHN0WyBkc3RPZmZzZXQgKyAwIF0gPSB4MTsKCQkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTE7CgkJCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHoxOwoJCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggdzAgIT09IHcxIHx8IHgwICE9PSB4MSB8fCB5MCAhPT0geTEgfHwgejAgIT09IHoxICkgewoKCQkJCWxldCBzID0gMSAtIHQ7CgkJCQljb25zdCBjb3MgPSB4MCAqIHgxICsgeTAgKiB5MSArIHowICogejEgKyB3MCAqIHcxLAoJCQkJCWRpciA9ICggY29zID49IDAgPyAxIDogLTEgKSwKCQkJCQlzcXJTaW4gPSAxIC0gY29zICogY29zOwoKCQkJCS8vIFNraXAgdGhlIFNsZXJwIGZvciB0aW55IHN0ZXBzIHRvIGF2b2lkIG51bWVyaWMgcHJvYmxlbXM6CgkJCQlpZiAoIHNxclNpbiA+IE51bWJlci5FUFNJTE9OICkgewoKCQkJCQljb25zdCBzaW4gPSBNYXRoLnNxcnQoIHNxclNpbiApLAoJCQkJCQlsZW4gPSBNYXRoLmF0YW4yKCBzaW4sIGNvcyAqIGRpciApOwoKCQkJCQlzID0gTWF0aC5zaW4oIHMgKiBsZW4gKSAvIHNpbjsKCQkJCQl0ID0gTWF0aC5zaW4oIHQgKiBsZW4gKSAvIHNpbjsKCgkJCQl9CgoJCQkJY29uc3QgdERpciA9IHQgKiBkaXI7CgoJCQkJeDAgPSB4MCAqIHMgKyB4MSAqIHREaXI7CgkJCQl5MCA9IHkwICogcyArIHkxICogdERpcjsKCQkJCXowID0gejAgKiBzICsgejEgKiB0RGlyOwoJCQkJdzAgPSB3MCAqIHMgKyB3MSAqIHREaXI7CgoJCQkJLy8gTm9ybWFsaXplIGluIGNhc2Ugd2UganVzdCBkaWQgYSBsZXJwOgoJCQkJaWYgKCBzID09PSAxIC0gdCApIHsKCgkJCQkJY29uc3QgZiA9IDEgLyBNYXRoLnNxcnQoIHgwICogeDAgKyB5MCAqIHkwICsgejAgKiB6MCArIHcwICogdzAgKTsKCgkJCQkJeDAgKj0gZjsKCQkJCQl5MCAqPSBmOwoJCQkJCXowICo9IGY7CgkJCQkJdzAgKj0gZjsKCgkJCQl9CgoJCQl9CgoJCQlkc3RbIGRzdE9mZnNldCBdID0geDA7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTA7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejA7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0d28gcXVhdGVybmlvbnMuIFRoaXMgaW1wbGVtZW50YXRpb24gYXNzdW1lcyB0aGUgcXVhdGVybmlvbiBkYXRhIGFyZSBtYW5hZ2VkCgkJICogaW4gZmxhdCBhcnJheXMuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGRzdCAtIFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZHN0T2Zmc2V0IC0gQW4gb2Zmc2V0IGludG8gdGhlIGRlc3RpbmF0aW9uIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMCAtIFRoZSBzb3VyY2UgYXJyYXkgb2YgdGhlIGZpcnN0IHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHNyY09mZnNldDAgLSBBbiBvZmZzZXQgaW50byB0aGUgZmlyc3Qgc291cmNlIGFycmF5LgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gc3JjMSAtICBUaGUgc291cmNlIGFycmF5IG9mIHRoZSBzZWNvbmQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gc3JjT2Zmc2V0MSAtIEFuIG9mZnNldCBpbnRvIHRoZSBzZWNvbmQgc291cmNlIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBkZXN0aW5hdGlvbiBhcnJheS4KCQkgKiBAc2VlIHtAbGluayBRdWF0ZXJuaW9uI211bHRpcGx5UXVhdGVybmlvbnN9LgoJCSAqLwoJCXN0YXRpYyBtdWx0aXBseVF1YXRlcm5pb25zRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEgKSB7CgoJCQljb25zdCB4MCA9IHNyYzBbIHNyY09mZnNldDAgXTsKCQkJY29uc3QgeTAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMSBdOwoJCQljb25zdCB6MCA9IHNyYzBbIHNyY09mZnNldDAgKyAyIF07CgkJCWNvbnN0IHcwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDMgXTsKCgkJCWNvbnN0IHgxID0gc3JjMVsgc3JjT2Zmc2V0MSBdOwoJCQljb25zdCB5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF07CgkJCWNvbnN0IHoxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDIgXTsKCQkJY29uc3QgdzEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMyBdOwoKCQkJZHN0WyBkc3RPZmZzZXQgXSA9IHgwICogdzEgKyB3MCAqIHgxICsgeTAgKiB6MSAtIHowICogeTE7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTAgKiB3MSArIHcwICogeTEgKyB6MCAqIHgxIC0geDAgKiB6MTsKCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MCAqIHcxICsgdzAgKiB6MSArIHgwICogeTEgLSB5MCAqIHgxOwoJCQlkc3RbIGRzdE9mZnNldCArIDMgXSA9IHcwICogdzEgLSB4MCAqIHgxIC0geTAgKiB5MSAtIHowICogejE7CgoJCQlyZXR1cm4gZHN0OwoKCQl9CgoJCS8qKgoJCSAqIFRoZSB4IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB4KCkgewoKCQkJcmV0dXJuIHRoaXMuX3g7CgoJCX0KCgkJc2V0IHgoIHZhbHVlICkgewoKCQkJdGhpcy5feCA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyBxdWF0ZXJuaW9uLgoJCSAqCgkJICogQHR5cGUge251bWJlcn0KCQkgKiBAZGVmYXVsdCAwCgkJICovCgkJZ2V0IHkoKSB7CgoJCQlyZXR1cm4gdGhpcy5feTsKCgkJfQoKCQlzZXQgeSggdmFsdWUgKSB7CgoJCQl0aGlzLl95ID0gdmFsdWU7CgkJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJfQoKCQkvKioKCQkgKiBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICoKCQkgKiBAdHlwZSB7bnVtYmVyfQoJCSAqIEBkZWZhdWx0IDAKCQkgKi8KCQlnZXQgeigpIHsKCgkJCXJldHVybiB0aGlzLl96OwoKCQl9CgoJCXNldCB6KCB2YWx1ZSApIHsKCgkJCXRoaXMuX3ogPSB2YWx1ZTsKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSB3IHZhbHVlIG9mIHRoaXMgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMQoJCSAqLwoJCWdldCB3KCkgewoKCQkJcmV0dXJuIHRoaXMuX3c7CgoJCX0KCgkJc2V0IHcoIHZhbHVlICkgewoKCQkJdGhpcy5fdyA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgeSB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdyB2YWx1ZSBvZiB0aGlzIHF1YXRlcm5pb24uCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXNldCggeCwgeSwgeiwgdyApIHsKCgkJCXRoaXMuX3ggPSB4OwoJCQl0aGlzLl95ID0geTsKCQkJdGhpcy5feiA9IHo7CgkJCXRoaXMuX3cgPSB3OwoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBxdWF0ZXJuaW9uIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX3cgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcXVhdGVybmlvbiB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHF1YXRlcm5pb24gdG8gY29weS4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJY29weSggcXVhdGVybmlvbiApIHsKCgkJCXRoaXMuX3ggPSBxdWF0ZXJuaW9uLng7CgkJCXRoaXMuX3kgPSBxdWF0ZXJuaW9uLnk7CgkJCXRoaXMuX3ogPSBxdWF0ZXJuaW9uLno7CgkJCXRoaXMuX3cgPSBxdWF0ZXJuaW9uLnc7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSByb3RhdGlvbiBzcGVjaWZpZWQgYnkgdGhlIGdpdmVuCgkJICogRXVsZXIgYW5nbGVzLgoJCSAqCgkJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgYW5nbGVzLgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZT10cnVlXSAtIFdoZXRoZXIgdGhlIGludGVybmFsIGBvbkNoYW5nZWAgY2FsbGJhY2sgc2hvdWxkIGJlIGV4ZWN1dGVkIG9yIG5vdC4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJc2V0RnJvbUV1bGVyKCBldWxlciwgdXBkYXRlID0gdHJ1ZSApIHsKCgkJCWNvbnN0IHggPSBldWxlci5feCwgeSA9IGV1bGVyLl95LCB6ID0gZXVsZXIuX3osIG9yZGVyID0gZXVsZXIuX29yZGVyOwoKCQkJLy8gaHR0cDovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLwoJCQkvLyAJMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMvCgkJCS8vCWNvbnRlbnQvU3BpbkNhbGMubQoKCQkJY29uc3QgY29zID0gTWF0aC5jb3M7CgkJCWNvbnN0IHNpbiA9IE1hdGguc2luOwoKCQkJY29uc3QgYzEgPSBjb3MoIHggLyAyICk7CgkJCWNvbnN0IGMyID0gY29zKCB5IC8gMiApOwoJCQljb25zdCBjMyA9IGNvcyggeiAvIDIgKTsKCgkJCWNvbnN0IHMxID0gc2luKCB4IC8gMiApOwoJCQljb25zdCBzMiA9IHNpbiggeSAvIDIgKTsKCQkJY29uc3QgczMgPSBzaW4oIHogLyAyICk7CgoJCQlzd2l0Y2ggKCBvcmRlciApIHsKCgkJCQljYXNlICdYWVonOgoJCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwoJCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnWVhaJzoKCQkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1pYWSc6CgkJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwoJCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKCQkJCQlicmVhazsKCgkJCQljYXNlICdaWVgnOgoJCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CgkJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKCQkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwoJCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnWVpYJzoKCQkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CgkJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1haWSc6CgkJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwoJCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCQkJCQlicmVhazsKCgkJCQlkZWZhdWx0OgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCgkJCX0KCgkJCWlmICggdXBkYXRlID09PSB0cnVlICkgdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gZnJvbSB0aGUgZ2l2ZW4gYXhpcyBhbmQgYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgbm9ybWFsaXplZCBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlzZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9hbmdsZVRvUXVhdGVybmlvbi9pbmRleC5odG0KCgkJCWNvbnN0IGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwgcyA9IE1hdGguc2luKCBoYWxmQW5nbGUgKTsKCgkJCXRoaXMuX3ggPSBheGlzLnggKiBzOwoJCQl0aGlzLl95ID0gYXhpcy55ICogczsKCQkJdGhpcy5feiA9IGF4aXMueiAqIHM7CgkJCXRoaXMuX3cgPSBNYXRoLmNvcyggaGFsZkFuZ2xlICk7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiByb3RhdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBBIDR4NCBtYXRyaXggb2Ygd2hpY2ggdGhlIHVwcGVyIDN4MyBvZiBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLiB1bnNjYWxlZCkuCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9tYXRyaXhUb1F1YXRlcm5pb24vaW5kZXguaHRtCgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJY29uc3QgdGUgPSBtLmVsZW1lbnRzLAoKCQkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCgkJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF0sCgoJCQkJdHJhY2UgPSBtMTEgKyBtMjIgKyBtMzM7CgoJCQlpZiAoIHRyYWNlID4gMCApIHsKCgkJCQljb25zdCBzID0gMC41IC8gTWF0aC5zcXJ0KCB0cmFjZSArIDEuMCApOwoKCQkJCXRoaXMuX3cgPSAwLjI1IC8gczsKCQkJCXRoaXMuX3ggPSAoIG0zMiAtIG0yMyApICogczsKCQkJCXRoaXMuX3kgPSAoIG0xMyAtIG0zMSApICogczsKCQkJCXRoaXMuX3ogPSAoIG0yMSAtIG0xMiApICogczsKCgkJCX0gZWxzZSBpZiAoIG0xMSA+IG0yMiAmJiBtMTEgPiBtMzMgKSB7CgoJCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTExIC0gbTIyIC0gbTMzICk7CgoJCQkJdGhpcy5fdyA9ICggbTMyIC0gbTIzICkgLyBzOwoJCQkJdGhpcy5feCA9IDAuMjUgKiBzOwoJCQkJdGhpcy5feSA9ICggbTEyICsgbTIxICkgLyBzOwoJCQkJdGhpcy5feiA9ICggbTEzICsgbTMxICkgLyBzOwoKCQkJfSBlbHNlIGlmICggbTIyID4gbTMzICkgewoKCQkJCWNvbnN0IHMgPSAyLjAgKiBNYXRoLnNxcnQoIDEuMCArIG0yMiAtIG0xMSAtIG0zMyApOwoKCQkJCXRoaXMuX3cgPSAoIG0xMyAtIG0zMSApIC8gczsKCQkJCXRoaXMuX3ggPSAoIG0xMiArIG0yMSApIC8gczsKCQkJCXRoaXMuX3kgPSAwLjI1ICogczsKCQkJCXRoaXMuX3ogPSAoIG0yMyArIG0zMiApIC8gczsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTMzIC0gbTExIC0gbTIyICk7CgoJCQkJdGhpcy5fdyA9ICggbTIxIC0gbTEyICkgLyBzOwoJCQkJdGhpcy5feCA9ICggbTEzICsgbTMxICkgLyBzOwoJCQkJdGhpcy5feSA9ICggbTIzICsgbTMyICkgLyBzOwoJCQkJdGhpcy5feiA9IDAuMjUgKiBzOwoKCQkJfQoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHF1YXRlcm5pb24gdG8gdGhlIHJvdGF0aW9uIHJlcXVpcmVkIHRvIHJvdGF0ZSB0aGUgZGlyZWN0aW9uIHZlY3RvcgoJCSAqIGB2RnJvbWAgdG8gdGhlIGRpcmVjdGlvbiB2ZWN0b3IgYHZUb2AuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZGcm9tIC0gVGhlIGZpcnN0IChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdlRvIC0gVGhlIHNlY29uZCAobm9ybWFsaXplZCkgZGlyZWN0aW9uIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJc2V0RnJvbVVuaXRWZWN0b3JzKCB2RnJvbSwgdlRvICkgewoKCQkJLy8gYXNzdW1lcyBkaXJlY3Rpb24gdmVjdG9ycyB2RnJvbSBhbmQgdlRvIGFyZSBub3JtYWxpemVkCgoJCQlsZXQgciA9IHZGcm9tLmRvdCggdlRvICkgKyAxOwoKCQkJaWYgKCByIDwgMWUtOCApIHsgLy8gdGhlIGVwc2lsb24gdmFsdWUgaGFzIGJlZW4gZGlzY3Vzc2VkIGluICMzMTI4NgoKCQkJCS8vIHZGcm9tIGFuZCB2VG8gcG9pbnQgaW4gb3Bwb3NpdGUgZGlyZWN0aW9ucwoKCQkJCXIgPSAwOwoKCQkJCWlmICggTWF0aC5hYnMoIHZGcm9tLnggKSA+IE1hdGguYWJzKCB2RnJvbS56ICkgKSB7CgoJCQkJCXRoaXMuX3ggPSAtIHZGcm9tLnk7CgkJCQkJdGhpcy5feSA9IHZGcm9tLng7CgkJCQkJdGhpcy5feiA9IDA7CgkJCQkJdGhpcy5fdyA9IHI7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpcy5feCA9IDA7CgkJCQkJdGhpcy5feSA9IC0gdkZyb20uejsKCQkJCQl0aGlzLl96ID0gdkZyb20ueTsKCQkJCQl0aGlzLl93ID0gcjsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIGNyb3NzVmVjdG9ycyggdkZyb20sIHZUbyApOyAvLyBpbmxpbmVkIHRvIGF2b2lkIGN5Y2xpYyBkZXBlbmRlbmN5IG9uIFZlY3RvcjMKCgkJCQl0aGlzLl94ID0gdkZyb20ueSAqIHZUby56IC0gdkZyb20ueiAqIHZUby55OwoJCQkJdGhpcy5feSA9IHZGcm9tLnogKiB2VG8ueCAtIHZGcm9tLnggKiB2VG8uejsKCQkJCXRoaXMuX3ogPSB2RnJvbS54ICogdlRvLnkgLSB2RnJvbS55ICogdlRvLng7CgkJCQl0aGlzLl93ID0gcjsKCgkJCX0KCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGFuZ2xlIGJldHdlZW4gdGhpcyBxdWF0ZXJuaW9uIGFuZCB0aGUgZ2l2ZW4gb25lIGluIHJhZGlhbnMuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgcXVhdGVybmlvbiB0byBjb21wdXRlIHRoZSBhbmdsZSB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICovCgkJYW5nbGVUbyggcSApIHsKCgkJCXJldHVybiAyICogTWF0aC5hY29zKCBNYXRoLmFicyggY2xhbXAoIHRoaXMuZG90KCBxICksIC0xLCAxICkgKSApOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhpcyBxdWF0ZXJuaW9uIGJ5IGEgZ2l2ZW4gYW5ndWxhciBzdGVwIHRvIHRoZSBnaXZlbiBxdWF0ZXJuaW9uLgoJCSAqIFRoZSBtZXRob2QgZW5zdXJlcyB0aGF0IHRoZSBmaW5hbCBxdWF0ZXJuaW9uIHdpbGwgbm90IG92ZXJzaG9vdCBgcWAuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgdGFyZ2V0IHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0ZXAgLSBUaGUgYW5ndWxhciBzdGVwIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXJvdGF0ZVRvd2FyZHMoIHEsIHN0ZXAgKSB7CgoJCQljb25zdCBhbmdsZSA9IHRoaXMuYW5nbGVUbyggcSApOwoKCQkJaWYgKCBhbmdsZSA9PT0gMCApIHJldHVybiB0aGlzOwoKCQkJY29uc3QgdCA9IE1hdGgubWluKCAxLCBzdGVwIC8gYW5nbGUgKTsKCgkJCXRoaXMuc2xlcnAoIHEsIHQgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIHRoZSBpZGVudGl0eSBxdWF0ZXJuaW9uOyB0aGF0IGlzLCB0byB0aGUKCQkgKiBxdWF0ZXJuaW9uIHRoYXQgcmVwcmVzZW50cyAibm8gcm90YXRpb24iLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWlkZW50aXR5KCkgewoKCQkJcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwLCAxICk7CgoJCX0KCgkJLyoqCgkJICogSW52ZXJ0cyB0aGlzIHF1YXRlcm5pb24gdmlhIHtAbGluayBRdWF0ZXJuaW9uI2Nvbmp1Z2F0ZX0uIFRoZQoJCSAqIHF1YXRlcm5pb24gaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWludmVydCgpIHsKCgkJCXJldHVybiB0aGlzLmNvbmp1Z2F0ZSgpOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHJvdGF0aW9uYWwgY29uanVnYXRlIG9mIHRoaXMgcXVhdGVybmlvbi4gVGhlIGNvbmp1Z2F0ZSBvZiBhCgkJICogcXVhdGVybmlvbiByZXByZXNlbnRzIHRoZSBzYW1lIHJvdGF0aW9uIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24gYWJvdXQKCQkgKiB0aGUgcm90YXRpb25hbCBheGlzLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWNvbmp1Z2F0ZSgpIHsKCgkJCXRoaXMuX3ggKj0gLTE7CgkJCXRoaXMuX3kgKj0gLTE7CgkJCXRoaXMuX3ogKj0gLTE7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDYWxjdWxhdGVzIHRoZSBkb3QgcHJvZHVjdCBvZiB0aGlzIHF1YXRlcm5pb24gYW5kIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHYgLSBUaGUgcXVhdGVybmlvbiB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCgkJICovCgkJZG90KCB2ICkgewoKCQkJcmV0dXJuIHRoaXMuX3ggKiB2Ll94ICsgdGhpcy5feSAqIHYuX3kgKyB0aGlzLl96ICogdi5feiArIHRoaXMuX3cgKiB2Ll93OwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBzcXVhcmVkIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBvZiB0aGlzIHF1YXRlcm5pb24sCgkJICogY29uc2lkZXJlZCBhcyBhIDQgZGltZW5zaW9uYWwgdmVjdG9yLiBUaGlzIGNhbiBiZSB1c2VmdWwgaWYgeW91IGFyZSBjb21wYXJpbmcgdGhlCgkJICogbGVuZ3RocyBvZiB0d28gcXVhdGVybmlvbnMsIGFzIHRoaXMgaXMgYSBzbGlnaHRseSBtb3JlIGVmZmljaWVudCBjYWxjdWxhdGlvbiB0aGFuCgkJICoge0BsaW5rIFF1YXRlcm5pb24jbGVuZ3RofS4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNxdWFyZWQgRXVjbGlkZWFuIGxlbmd0aC4KCQkgKi8KCQlsZW5ndGhTcSgpIHsKCgkJCXJldHVybiB0aGlzLl94ICogdGhpcy5feCArIHRoaXMuX3kgKiB0aGlzLl95ICsgdGhpcy5feiAqIHRoaXMuX3ogKyB0aGlzLl93ICogdGhpcy5fdzsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgRXVjbGlkZWFuIGxlbmd0aCAoc3RyYWlnaHQtbGluZSBsZW5ndGgpIG9mIHRoaXMgcXVhdGVybmlvbiwKCQkgKiBjb25zaWRlcmVkIGFzIGEgNCBkaW1lbnNpb25hbCB2ZWN0b3IuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBFdWNsaWRlYW4gbGVuZ3RoLgoJCSAqLwoJCWxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93ICk7CgoJCX0KCgkJLyoqCgkJICogTm9ybWFsaXplcyB0aGlzIHF1YXRlcm5pb24gLSB0aGF0IGlzLCBjYWxjdWxhdGVkIHRoZSBxdWF0ZXJuaW9uIHRoYXQgcGVyZm9ybXMKCQkgKiB0aGUgc2FtZSByb3RhdGlvbiBhcyB0aGlzIG9uZSwgYnV0IGhhcyBhIGxlbmd0aCBlcXVhbCB0byBgMWAuCgkJICoKCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJbm9ybWFsaXplKCkgewoKCQkJbGV0IGwgPSB0aGlzLmxlbmd0aCgpOwoKCQkJaWYgKCBsID09PSAwICkgewoKCQkJCXRoaXMuX3ggPSAwOwoJCQkJdGhpcy5feSA9IDA7CgkJCQl0aGlzLl96ID0gMDsKCQkJCXRoaXMuX3cgPSAxOwoKCQkJfSBlbHNlIHsKCgkJCQlsID0gMSAvIGw7CgoJCQkJdGhpcy5feCA9IHRoaXMuX3ggKiBsOwoJCQkJdGhpcy5feSA9IHRoaXMuX3kgKiBsOwoJCQkJdGhpcy5feiA9IHRoaXMuX3ogKiBsOwoJCQkJdGhpcy5fdyA9IHRoaXMuX3cgKiBsOwoKCQkJfQoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGlzIHF1YXRlcm5pb24gYnkgdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQltdWx0aXBseSggcSApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHRoaXMsIHEgKTsKCgkJfQoKCQkvKioKCQkgKiBQcmUtbXVsdGlwbGllcyB0aGlzIHF1YXRlcm5pb24gYnkgdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBxdWF0ZXJuaW9uLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlwcmVtdWx0aXBseSggcSApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5UXVhdGVybmlvbnMoIHEsIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBNdWx0aXBsaWVzIHRoZSBnaXZlbiBxdWF0ZXJuaW9ucyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gYSAtIFRoZSBmaXJzdCBxdWF0ZXJuaW9uLgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gYiAtIFRoZSBzZWNvbmQgcXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJbXVsdGlwbHlRdWF0ZXJuaW9ucyggYSwgYiApIHsKCgkJCS8vIGZyb20gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9jb2RlL2luZGV4Lmh0bQoKCQkJY29uc3QgcWF4ID0gYS5feCwgcWF5ID0gYS5feSwgcWF6ID0gYS5feiwgcWF3ID0gYS5fdzsKCQkJY29uc3QgcWJ4ID0gYi5feCwgcWJ5ID0gYi5feSwgcWJ6ID0gYi5feiwgcWJ3ID0gYi5fdzsKCgkJCXRoaXMuX3ggPSBxYXggKiBxYncgKyBxYXcgKiBxYnggKyBxYXkgKiBxYnogLSBxYXogKiBxYnk7CgkJCXRoaXMuX3kgPSBxYXkgKiBxYncgKyBxYXcgKiBxYnkgKyBxYXogKiBxYnggLSBxYXggKiBxYno7CgkJCXRoaXMuX3ogPSBxYXogKiBxYncgKyBxYXcgKiBxYnogKyBxYXggKiBxYnkgLSBxYXkgKiBxYng7CgkJCXRoaXMuX3cgPSBxYXcgKiBxYncgLSBxYXggKiBxYnggLSBxYXkgKiBxYnkgLSBxYXogKiBxYno7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHF1YXRlcm5pb25zLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYiAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlzbGVycCggcWIsIHQgKSB7CgoJCQlpZiAoIHQgPT09IDAgKSByZXR1cm4gdGhpczsKCQkJaWYgKCB0ID09PSAxICkgcmV0dXJuIHRoaXMuY29weSggcWIgKTsKCgkJCWNvbnN0IHggPSB0aGlzLl94LCB5ID0gdGhpcy5feSwgeiA9IHRoaXMuX3osIHcgPSB0aGlzLl93OwoKCQkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9yZWFsTm9ybWVkQWxnZWJyYS9xdWF0ZXJuaW9ucy9zbGVycC8KCgkJCWxldCBjb3NIYWxmVGhldGEgPSB3ICogcWIuX3cgKyB4ICogcWIuX3ggKyB5ICogcWIuX3kgKyB6ICogcWIuX3o7CgoJCQlpZiAoIGNvc0hhbGZUaGV0YSA8IDAgKSB7CgoJCQkJdGhpcy5fdyA9IC0gcWIuX3c7CgkJCQl0aGlzLl94ID0gLSBxYi5feDsKCQkJCXRoaXMuX3kgPSAtIHFiLl95OwoJCQkJdGhpcy5feiA9IC0gcWIuX3o7CgoJCQkJY29zSGFsZlRoZXRhID0gLSBjb3NIYWxmVGhldGE7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuY29weSggcWIgKTsKCgkJCX0KCgkJCWlmICggY29zSGFsZlRoZXRhID49IDEuMCApIHsKCgkJCQl0aGlzLl93ID0gdzsKCQkJCXRoaXMuX3ggPSB4OwoJCQkJdGhpcy5feSA9IHk7CgkJCQl0aGlzLl96ID0gejsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWNvbnN0IHNxclNpbkhhbGZUaGV0YSA9IDEuMCAtIGNvc0hhbGZUaGV0YSAqIGNvc0hhbGZUaGV0YTsKCgkJCWlmICggc3FyU2luSGFsZlRoZXRhIDw9IE51bWJlci5FUFNJTE9OICkgewoKCQkJCWNvbnN0IHMgPSAxIC0gdDsKCQkJCXRoaXMuX3cgPSBzICogdyArIHQgKiB0aGlzLl93OwoJCQkJdGhpcy5feCA9IHMgKiB4ICsgdCAqIHRoaXMuX3g7CgkJCQl0aGlzLl95ID0gcyAqIHkgKyB0ICogdGhpcy5feTsKCQkJCXRoaXMuX3ogPSBzICogeiArIHQgKiB0aGlzLl96OwoKCQkJCXRoaXMubm9ybWFsaXplKCk7IC8vIG5vcm1hbGl6ZSBjYWxscyBfb25DaGFuZ2VDYWxsYmFjaygpCgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQljb25zdCBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoIHNxclNpbkhhbGZUaGV0YSApOwoJCQljb25zdCBoYWxmVGhldGEgPSBNYXRoLmF0YW4yKCBzaW5IYWxmVGhldGEsIGNvc0hhbGZUaGV0YSApOwoJCQljb25zdCByYXRpb0EgPSBNYXRoLnNpbiggKCAxIC0gdCApICogaGFsZlRoZXRhICkgLyBzaW5IYWxmVGhldGEsCgkJCQlyYXRpb0IgPSBNYXRoLnNpbiggdCAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhOwoKCQkJdGhpcy5fdyA9ICggdyAqIHJhdGlvQSArIHRoaXMuX3cgKiByYXRpb0IgKTsKCQkJdGhpcy5feCA9ICggeCAqIHJhdGlvQSArIHRoaXMuX3ggKiByYXRpb0IgKTsKCQkJdGhpcy5feSA9ICggeSAqIHJhdGlvQSArIHRoaXMuX3kgKiByYXRpb0IgKTsKCQkJdGhpcy5feiA9ICggeiAqIHJhdGlvQSArIHRoaXMuX3ogKiByYXRpb0IgKTsKCgkJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFBlcmZvcm1zIGEgc3BoZXJpY2FsIGxpbmVhciBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdGhlIGdpdmVuIHF1YXRlcm5pb25zCgkJICogYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgcXVhdGVybmlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcWEgLSBUaGUgc291cmNlIHF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxYiAtIFRoZSB0YXJnZXQgcXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gdCAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwgMV1gLgoJCSAqIEByZXR1cm4ge1F1YXRlcm5pb259IEEgcmVmZXJlbmNlIHRvIHRoaXMgcXVhdGVybmlvbi4KCQkgKi8KCQlzbGVycFF1YXRlcm5pb25zKCBxYSwgcWIsIHQgKSB7CgoJCQlyZXR1cm4gdGhpcy5jb3B5KCBxYSApLnNsZXJwKCBxYiwgdCApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBxdWF0ZXJuaW9uIHRvIGEgdW5pZm9ybWx5IHJhbmRvbSwgbm9ybWFsaXplZCBxdWF0ZXJuaW9uLgoJCSAqCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCXJhbmRvbSgpIHsKCgkJCS8vIEtlbiBTaG9lbWFrZQoJCQkvLyBVbmlmb3JtIHJhbmRvbSByb3RhdGlvbnMKCQkJLy8gRC4gS2lyaywgZWRpdG9yLCBHcmFwaGljcyBHZW1zIElJSSwgcGFnZXMgMTI0LTEzMi4gQWNhZGVtaWMgUHJlc3MsIE5ldyBZb3JrLCAxOTkyLgoKCQkJY29uc3QgdGhldGExID0gMiAqIE1hdGguUEkgKiBNYXRoLnJhbmRvbSgpOwoJCQljb25zdCB0aGV0YTIgPSAyICogTWF0aC5QSSAqIE1hdGgucmFuZG9tKCk7CgoJCQljb25zdCB4MCA9IE1hdGgucmFuZG9tKCk7CgkJCWNvbnN0IHIxID0gTWF0aC5zcXJ0KCAxIC0geDAgKTsKCQkJY29uc3QgcjIgPSBNYXRoLnNxcnQoIHgwICk7CgoJCQlyZXR1cm4gdGhpcy5zZXQoCgkJCQlyMSAqIE1hdGguc2luKCB0aGV0YTEgKSwKCQkJCXIxICogTWF0aC5jb3MoIHRoZXRhMSApLAoJCQkJcjIgKiBNYXRoLnNpbiggdGhldGEyICksCgkJCQlyMiAqIE1hdGguY29zKCB0aGV0YTIgKSwKCQkJKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHF1YXRlcm5pb24gaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHF1YXRlcm5pb24gdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHF1YXRlcm5pb24gaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggcXVhdGVybmlvbiApIHsKCgkJCXJldHVybiAoIHF1YXRlcm5pb24uX3ggPT09IHRoaXMuX3ggKSAmJiAoIHF1YXRlcm5pb24uX3kgPT09IHRoaXMuX3kgKSAmJiAoIHF1YXRlcm5pb24uX3ogPT09IHRoaXMuX3ogKSAmJiAoIHF1YXRlcm5pb24uX3cgPT09IHRoaXMuX3cgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgcXVhdGVybmlvbidzIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gYXJyYXkuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IGFycmF5IC0gQW4gYXJyYXkgaG9sZGluZyB0aGUgcXVhdGVybmlvbiBjb21wb25lbnQgdmFsdWVzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBBIHJlZmVyZW5jZSB0byB0aGlzIHF1YXRlcm5pb24uCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMuX3ggPSBhcnJheVsgb2Zmc2V0IF07CgkJCXRoaXMuX3kgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCQl0aGlzLl96ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQkJdGhpcy5fdyA9IGFycmF5WyBvZmZzZXQgKyAzIF07CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBXcml0ZXMgdGhlIGNvbXBvbmVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCgkJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHF1YXRlcm5pb24gY29tcG9uZW50cy4KCQkgKi8KCQl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMuX3k7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fdzsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgcXVhdGVybmlvbiBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgcXVhdGVybmlvbiBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7UXVhdGVybmlvbn0gQSByZWZlcmVuY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgoJCSAqLwoJCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgoJCQl0aGlzLl94ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMuX3kgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCQkJdGhpcy5feiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoJCQl0aGlzLl93ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUaGlzIG1ldGhvZHMgZGVmaW5lcyB0aGUgc2VyaWFsaXphdGlvbiByZXN1bHQgb2YgdGhpcyBjbGFzcy4gUmV0dXJucyB0aGUKCQkgKiBudW1lcmljYWwgZWxlbWVudHMgb2YgdGhpcyBxdWF0ZXJuaW9uIGluIGFuIGFycmF5IG9mIGZvcm1hdCBgW3gsIHksIHosIHddYC4KCQkgKgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBzZXJpYWxpemVkIHF1YXRlcm5pb24uCgkJICovCgkJdG9KU09OKCkgewoKCQkJcmV0dXJuIHRoaXMudG9BcnJheSgpOwoKCQl9CgoJCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgoJCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQkJeWllbGQgdGhpcy5feDsKCQkJeWllbGQgdGhpcy5feTsKCQkJeWllbGQgdGhpcy5fejsKCQkJeWllbGQgdGhpcy5fdzsKCgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIDNEIHZlY3Rvci4gQSAzRCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCB0cmlwbGV0IG9mIG51bWJlcnMKCSAqIChsYWJlbGVkIHgsIHkgYW5kIHopLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgoJICoKCSAqIC0gQSBwb2ludCBpbiAzRCBzcGFjZS4KCSAqIC0gQSBkaXJlY3Rpb24gYW5kIGxlbmd0aCBpbiAzRCBzcGFjZS4gSW4gdGhyZWUuanMgdGhlIGxlbmd0aCB3aWxsCgkgKiBhbHdheXMgYmUgdGhlIEV1Y2xpZGVhbiBkaXN0YW5jZShzdHJhaWdodC1saW5lIGRpc3RhbmNlKSBmcm9tIGAoMCwgMCwgMClgIHRvIGAoeCwgeSwgeilgCgkgKiBhbmQgdGhlIGRpcmVjdGlvbiBpcyBhbHNvIG1lYXN1cmVkIGZyb20gYCgwLCAwLCAwKWAgdG93YXJkcyBgKHgsIHksIHopYC4KCSAqIC0gQW55IGFyYml0cmFyeSBvcmRlcmVkIHRyaXBsZXQgb2YgbnVtYmVycy4KCSAqCgkgKiBUaGVyZSBhcmUgb3RoZXIgdGhpbmdzIGEgM0QgdmVjdG9yIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCwgc3VjaCBhcwoJICogbW9tZW50dW0gdmVjdG9ycyBhbmQgc28gb24sIGhvd2V2ZXIgdGhlc2UgYXJlIHRoZSBtb3N0CgkgKiBjb21tb24gdXNlcyBpbiB0aHJlZS5qcy4KCSAqCgkgKiBJdGVyYXRpbmcgdGhyb3VnaCBhIHZlY3RvciBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzIGAoeCwgeSwgeilgIGluCgkgKiB0aGUgY29ycmVzcG9uZGluZyBvcmRlci4KCSAqIGBgYGpzCgkgKiBjb25zdCBhID0gbmV3IFRIUkVFLlZlY3RvcjMoIDAsIDEsIDAgKTsKCSAqCgkgKiAvL25vIGFyZ3VtZW50czsgd2lsbCBiZSBpbml0aWFsaXNlZCB0byAoMCwgMCwgMCkKCSAqIGNvbnN0IGIgPSBuZXcgVEhSRUUuVmVjdG9yMyggKTsKCSAqCgkgKiBjb25zdCBkID0gYS5kaXN0YW5jZVRvKCBiICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgVmVjdG9yMyB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgM0QgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJVmVjdG9yMy5wcm90b3R5cGUuaXNWZWN0b3IzID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgeCB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMueCA9IHg7CgoJCQkvKioKCQkJICogVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnkgPSB5OwoKCQkJLyoqCgkJCSAqIFRoZSB6IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy56ID0gejsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIG9mIHRoZSB4IGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSBvZiB0aGUgeSBjb21wb25lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgb2YgdGhlIHogY29tcG9uZW50LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldCggeCwgeSwgeiApIHsKCgkJCWlmICggeiA9PT0gdW5kZWZpbmVkICkgeiA9IHRoaXMuejsgLy8gc3ByaXRlLnNjYWxlLnNldCh4LHkpCgoJCQl0aGlzLnggPSB4OwoJCQl0aGlzLnkgPSB5OwoJCQl0aGlzLnogPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgdG8gdGhlIHNhbWUgdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHZhbHVlIHRvIHNldCBmb3IgYWxsIHZlY3RvciBjb21wb25lbnRzLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ID0gc2NhbGFyOwoJCQl0aGlzLnkgPSBzY2FsYXI7CgkJCXRoaXMueiA9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvcidzIHggY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFgoIHggKSB7CgoJCQl0aGlzLnggPSB4OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yJ3MgeSBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0WSggeSApIHsKCgkJCXRoaXMueSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB6IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRaKCB6ICkgewoKCQkJdGhpcy56ID0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFsbG93cyB0byBzZXQgYSB2ZWN0b3IgY29tcG9uZW50IHdpdGggYW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwgYDJgIGVxdWFscyB0byB6LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHRoaXMueCA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAyOiB0aGlzLnogPSB2YWx1ZTsgYnJlYWs7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwgYDJgIGVxdWFscyB0byB6LgoJCSAqIEByZXR1cm4ge251bWJlcn0gQSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlLgoJCSAqLwoJCWdldENvbXBvbmVudCggaW5kZXggKSB7CgoJCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCQljYXNlIDA6IHJldHVybiB0aGlzLng7CgkJCQljYXNlIDE6IHJldHVybiB0aGlzLnk7CgkJCQljYXNlIDI6IHJldHVybiB0aGlzLno7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgdmVjdG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55LCB0aGlzLnogKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGNvcHkuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY29weSggdiApIHsKCgkJCXRoaXMueCA9IHYueDsKCQkJdGhpcy55ID0gdi55OwoJCQl0aGlzLnogPSB2Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gYWRkLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZCggdiApIHsKCgkJCXRoaXMueCArPSB2Lng7CgkJCXRoaXMueSArPSB2Lnk7CgkJCXRoaXMueiArPSB2Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgdG8gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBhZGQuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJYWRkU2NhbGFyKCBzICkgewoKCQkJdGhpcy54ICs9IHM7CgkJCXRoaXMueSArPSBzOwoJCQl0aGlzLnogKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKyBiLng7CgkJCXRoaXMueSA9IGEueSArIGIueTsKCQkJdGhpcy56ID0gYS56ICsgYi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gdmVjdG9yIHNjYWxlZCBieSB0aGUgZ2l2ZW4gZmFjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN8VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgZmFjdG9yIHRoYXQgc2NhbGVzIGB2YC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgoJCQl0aGlzLnggKz0gdi54ICogczsKCQkJdGhpcy55ICs9IHYueSAqIHM7CgkJCXRoaXMueiArPSB2LnogKiBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU3VidHJhY3RzIHRoZSBnaXZlbiB2ZWN0b3IgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBzdWJ0cmFjdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzdWIoIHYgKSB7CgoJCQl0aGlzLnggLT0gdi54OwoJCQl0aGlzLnkgLT0gdi55OwoJCQl0aGlzLnogLT0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU3VidHJhY3RzIHRoZSBnaXZlbiBzY2FsYXIgdmFsdWUgZnJvbSBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIHN1YnRyYWN0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXN1YlNjYWxhciggcyApIHsKCgkJCXRoaXMueCAtPSBzOwoJCQl0aGlzLnkgLT0gczsKCQkJdGhpcy56IC09IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTdWJ0cmFjdHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXN1YlZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggLSBiLng7CgkJCXRoaXMueSA9IGEueSAtIGIueTsKCQkJdGhpcy56ID0gYS56IC0gYi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9yIHdpdGggdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbXVsdGlwbHkoIHYgKSB7CgoJCQl0aGlzLnggKj0gdi54OwoJCQl0aGlzLnkgKj0gdi55OwoJCQl0aGlzLnogKj0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHdpdGggYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIG11bHRpcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnggKj0gc2NhbGFyOwoJCQl0aGlzLnkgKj0gc2NhbGFyOwoJCQl0aGlzLnogKj0gc2NhbGFyOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbXVsdGlwbHlWZWN0b3JzKCBhLCBiICkgewoKCQkJdGhpcy54ID0gYS54ICogYi54OwoJCQl0aGlzLnkgPSBhLnkgKiBiLnk7CgkJCXRoaXMueiA9IGEueiAqIGIuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgdGhlIGdpdmVuIEV1bGVyIHJvdGF0aW9uIHRvIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgYW5nbGVzLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5RXVsZXIoIGV1bGVyICkgewoKCQkJcmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQ0LnNldEZyb21FdWxlciggZXVsZXIgKSApOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgYSByb3RhdGlvbiBzcGVjaWZpZWQgYnkgYW4gYXhpcyBhbmQgYW4gYW5nbGUgdG8gdGhpcyB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBBIG5vcm1hbGl6ZWQgdmVjdG9yIHJlcHJlc2VudGluZyB0aGUgcm90YXRpb24gYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhcHBseUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgoJCQlyZXR1cm4gdGhpcy5hcHBseVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uJDQuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSApOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gM3gzIG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSAzeDMgbWF0cml4LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4MyggbSApIHsKCgkJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF0gKiB6OwoJCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDcgXSAqIHo7CgkJCXRoaXMueiA9IGVbIDIgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOCBdICogejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIG5vcm1hbCBtYXRyaXggYW5kIG5vcm1hbGl6ZXMKCQkgKiB0aGUgcmVzdWx0LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG5vcm1hbCBtYXRyaXguCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJYXBwbHlOb3JtYWxNYXRyaXgoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDMoIG0gKS5ub3JtYWxpemUoKTsKCgkJfQoKCQkvKioKCQkgKiBNdWx0aXBsaWVzIHRoaXMgdmVjdG9yICh3aXRoIGFuIGltcGxpY2l0IDEgaW4gdGhlIDR0aCBkaW1lbnNpb24pIGJ5IG0sIGFuZAoJCSAqIGRpdmlkZXMgYnkgcGVyc3BlY3RpdmUuCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIGFwcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbSApIHsKCgkJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLno7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJY29uc3QgdyA9IDEgLyAoIGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICk7CgoJCQl0aGlzLnggPSAoIGVbIDAgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgOCBdICogeiArIGVbIDEyIF0gKSAqIHc7CgkJCXRoaXMueSA9ICggZVsgMSBdICogeCArIGVbIDUgXSAqIHkgKyBlWyA5IF0gKiB6ICsgZVsgMTMgXSApICogdzsKCQkJdGhpcy56ID0gKCBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSApICogdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgdGhlIGdpdmVuIFF1YXRlcm5pb24gdG8gdGhpcyB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhcHBseVF1YXRlcm5pb24oIHEgKSB7CgoJCQkvLyBxdWF0ZXJuaW9uIHEgaXMgYXNzdW1lZCB0byBoYXZlIHVuaXQgbGVuZ3RoCgoJCQljb25zdCB2eCA9IHRoaXMueCwgdnkgPSB0aGlzLnksIHZ6ID0gdGhpcy56OwoJCQljb25zdCBxeCA9IHEueCwgcXkgPSBxLnksIHF6ID0gcS56LCBxdyA9IHEudzsKCgkJCS8vIHQgPSAyICogY3Jvc3MoIHEueHl6LCB2ICk7CgkJCWNvbnN0IHR4ID0gMiAqICggcXkgKiB2eiAtIHF6ICogdnkgKTsKCQkJY29uc3QgdHkgPSAyICogKCBxeiAqIHZ4IC0gcXggKiB2eiApOwoJCQljb25zdCB0eiA9IDIgKiAoIHF4ICogdnkgLSBxeSAqIHZ4ICk7CgoJCQkvLyB2ICsgcS53ICogdCArIGNyb3NzKCBxLnh5eiwgdCApOwoJCQl0aGlzLnggPSB2eCArIHF3ICogdHggKyBxeSAqIHR6IC0gcXogKiB0eTsKCQkJdGhpcy55ID0gdnkgKyBxdyAqIHR5ICsgcXogKiB0eCAtIHF4ICogdHo7CgkJCXRoaXMueiA9IHZ6ICsgcXcgKiB0eiArIHF4ICogdHkgLSBxeSAqIHR4OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUHJvamVjdHMgdGhpcyB2ZWN0b3IgZnJvbSB3b3JsZCBzcGFjZSBpbnRvIHRoZSBjYW1lcmEncyBub3JtYWxpemVkCgkJICogZGV2aWNlIGNvb3JkaW5hdGUgKE5EQykgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlwcm9qZWN0KCBjYW1lcmEgKSB7CgoJCQlyZXR1cm4gdGhpcy5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCX0KCgkJLyoqCgkJICogVW5wcm9qZWN0cyB0aGlzIHZlY3RvciBmcm9tIHRoZSBjYW1lcmEncyBub3JtYWxpemVkIGRldmljZSBjb29yZGluYXRlIChOREMpCgkJICogc3BhY2UgaW50byB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXVucHJvamVjdCggY2FtZXJhICkgewoKCQkJcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKCQl9CgoJCS8qKgoJCSAqIFRyYW5zZm9ybXMgdGhlIGRpcmVjdGlvbiBvZiB0aGlzIHZlY3RvciBieSBhIG1hdHJpeCAodGhlIHVwcGVyIGxlZnQgMyB4IDMKCQkgKiBzdWJzZXQgb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXggYW5kIHRoZW4gbm9ybWFsaXplcyB0aGUgcmVzdWx0LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQl0cmFuc2Zvcm1EaXJlY3Rpb24oIG0gKSB7CgoJCQkvLyBpbnB1dDogVEhSRUUuTWF0cml4NCBhZmZpbmUgbWF0cml4CgkJCS8vIHZlY3RvciBpbnRlcnByZXRlZCBhcyBhIGRpcmVjdGlvbgoKCQkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQkJY29uc3QgZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHo7CgkJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogejsKCQkJdGhpcy56ID0gZVsgMiBdICogeCArIGVbIDYgXSAqIHkgKyBlWyAxMCBdICogejsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZGl2aWRlKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCQkJdGhpcy56IC89IHYuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5IG9yIHoKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWluIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltaW4oIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1pbiggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5taW4oIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWluKCB0aGlzLnosIHYueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5IG9yIHoKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltYXgoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWF4KCB0aGlzLnosIHYueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5IG9yIHogdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmVjdG9yJ3MgeCwgeSBvciB6CgkJICogdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZSBjb3JyZXNwb25kaW5nIHZhbHVlLgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgbWluIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZSwKCQkgKiBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gbWluIC0gVGhlIG1pbmltdW0geCwgeSBhbmQgeiB2YWx1ZXMuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBtYXggLSBUaGUgbWF4aW11bSB4LCB5IGFuZCB6IHZhbHVlcyBpbiB0aGUgZGVzaXJlZCByYW5nZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljbGFtcCggbWluLCBtYXggKSB7CgoJCQkvLyBhc3N1bWVzIG1pbiA8IG1heCwgY29tcG9uZW50d2lzZQoKCQkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluLngsIG1heC54ICk7CgkJCXRoaXMueSA9IGNsYW1wKCB0aGlzLnksIG1pbi55LCBtYXgueSApOwoJCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW4ueiwgbWF4LnogKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSBvciB6IHZhbHVlcyBhcmUgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIHRoZXkgYXJlCgkJICogcmVwbGFjZWQgYnkgdGhlIG1heCB2YWx1ZS4KCQkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHkgb3IgeiB2YWx1ZXMgYXJlIGxlc3MgdGhhbiB0aGUgbWluIHZhbHVlLCB0aGV5IGFyZQoJCSAqIHJlcGxhY2VkIGJ5IHRoZSBtaW4gdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gbWluVmFsIC0gVGhlIG1pbmltdW0gdmFsdWUgdGhlIGNvbXBvbmVudHMgd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtYXhWYWwgLSBUaGUgbWF4aW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY2xhbXBTY2FsYXIoIG1pblZhbCwgbWF4VmFsICkgewoKCQkJdGhpcy54ID0gY2xhbXAoIHRoaXMueCwgbWluVmFsLCBtYXhWYWwgKTsKCQkJdGhpcy55ID0gY2xhbXAoIHRoaXMueSwgbWluVmFsLCBtYXhWYWwgKTsKCQkJdGhpcy56ID0gY2xhbXAoIHRoaXMueiwgbWluVmFsLCBtYXhWYWwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgbGVuZ3RoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieQoJCSAqIHRoZSBtYXggdmFsdWUuCgkJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5IHRoZQoJCSAqIG1pbiB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW4gLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgdmVjdG9yIGxlbmd0aCB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHBhcmFtIHtudW1iZXJ9IG1heCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljbGFtcExlbmd0aCggbWluLCBtYXggKSB7CgoJCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKCQkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBjbGFtcCggbGVuZ3RoLCBtaW4sIG1heCApICk7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgZG93biB0byB0aGUgbmVhcmVzdCBpbnRlZ2VyIHZhbHVlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZmxvb3IoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5mbG9vciggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGguZmxvb3IoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNlaWwoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmQoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG93YXJkcyB6ZXJvICh1cCBpZiBuZWdhdGl2ZSwKCQkgKiBkb3duIGlmIHBvc2l0aXZlKSB0byBhbiBpbnRlZ2VyIHZhbHVlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmRUb1plcm8oKSB7CgoJCQl0aGlzLnggPSBNYXRoLnRydW5jKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC50cnVuYyggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgudHJ1bmMoIHRoaXMueiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSW52ZXJ0cyB0aGlzIHZlY3RvciAtIGkuZS4gc2V0cyB4ID0gLXgsIHkgPSAteSBhbmQgeiA9IC16LgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJbmVnYXRlKCkgewoKCQkJdGhpcy54ID0gLSB0aGlzLng7CgkJCXRoaXMueSA9IC0gdGhpcy55OwoJCQl0aGlzLnogPSAtIHRoaXMuejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgdGhlIGRvdCBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkb3QgcHJvZHVjdCB3aXRoLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJlc3VsdCBvZiB0aGUgZG90IHByb2R1Y3QuCgkJICovCgkJZG90KCB2ICkgewoKCQkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYuejsKCgkJfQoKCQkvLyBUT0RPIGxlbmd0aFNxdWFyZWQ/CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBzcXVhcmUgb2YgdGhlIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tCgkJICogKDAsIDAsIDApIHRvICh4LCB5LCB6KS4gSWYgeW91IGFyZSBjb21wYXJpbmcgdGhlIGxlbmd0aHMgb2YgdmVjdG9ycywgeW91IHNob3VsZAoJCSAqIGNvbXBhcmUgdGhlIGxlbmd0aCBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZW5ndGhTcSgpIHsKCgkJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLno7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlICBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbSAoMCwgMCwgMCkgdG8gKHgsIHksIHopLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBNYW5oYXR0YW4gbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW1hbmhhdHRhbkxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICk7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhpcyB2ZWN0b3IgdG8gYSB1bml0IHZlY3RvciAtIHRoYXQgaXMsIHNldHMgaXQgZXF1YWwgdG8gYSB2ZWN0b3IKCQkgKiB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0IHdpdGggYSB2ZWN0b3IgbGVuZ3RoIG9mIGAxYC4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW5vcm1hbGl6ZSgpIHsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHZlY3RvciB0byBhIHZlY3RvciB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0CgkJICogd2l0aCB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggLSBUaGUgbmV3IGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9yIGFuZCB0aGlzIGluc3RhbmNlLCB3aGVyZQoJCSAqIGFscGhhIGlzIHRoZSBwZXJjZW50IGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgdGhpcwoJCSAqIHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsIGJlIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIGludGVycG9sYXRlIHRvd2FyZHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwKCB2LCBhbHBoYSApIHsKCgkJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CgkJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9ycywgd2hlcmUgYWxwaGEgaXMgdGhlIHBlcmNlbnQKCQkgKiBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIGZpcnN0IHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsCgkJICogYmUgdGhlIHNlY29uZCBvbmUuIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVGhlIGZpcnN0IHZlY3Rvci4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYyIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCgkJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKCQkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwoJCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDYWxjdWxhdGVzIHRoZSBjcm9zcyBwcm9kdWN0IG9mIHRoZSBnaXZlbiB2ZWN0b3Igd2l0aCB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBjcm9zcyBwcm9kdWN0IHdpdGguCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHJlc3VsdCBvZiB0aGUgY3Jvc3MgcHJvZHVjdC4KCQkgKi8KCQljcm9zcyggdiApIHsKCgkJCXJldHVybiB0aGlzLmNyb3NzVmVjdG9ycyggdGhpcywgdiApOwoKCQl9CgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgdGhlIGNyb3NzIHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CgkJICogaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY3Jvc3NWZWN0b3JzKCBhLCBiICkgewoKCQkJY29uc3QgYXggPSBhLngsIGF5ID0gYS55LCBheiA9IGEuejsKCQkJY29uc3QgYnggPSBiLngsIGJ5ID0gYi55LCBieiA9IGIuejsKCgkJCXRoaXMueCA9IGF5ICogYnogLSBheiAqIGJ5OwoJCQl0aGlzLnkgPSBheiAqIGJ4IC0gYXggKiBiejsKCQkJdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQcm9qZWN0cyB0aGlzIHZlY3RvciBvbnRvIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYgLSBUaGUgdmVjdG9yIHRvIHByb2plY3QgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcHJvamVjdE9uVmVjdG9yKCB2ICkgewoKCQkJY29uc3QgZGVub21pbmF0b3IgPSB2Lmxlbmd0aFNxKCk7CgoJCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwICk7CgoJCQljb25zdCBzY2FsYXIgPSB2LmRvdCggdGhpcyApIC8gZGVub21pbmF0b3I7CgoJCQlyZXR1cm4gdGhpcy5jb3B5KCB2ICkubXVsdGlwbHlTY2FsYXIoIHNjYWxhciApOwoKCQl9CgoJCS8qKgoJCSAqIFByb2plY3RzIHRoaXMgdmVjdG9yIG9udG8gYSBwbGFuZSBieSBzdWJ0cmFjdGluZyB0aGlzCgkJICogdmVjdG9yIHByb2plY3RlZCBvbnRvIHRoZSBwbGFuZSdzIG5vcm1hbCBmcm9tIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwbGFuZU5vcm1hbCAtIFRoZSBwbGFuZSBub3JtYWwuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcHJvamVjdE9uUGxhbmUoIHBsYW5lTm9ybWFsICkgewoKCQkJX3ZlY3RvciRjLmNvcHkoIHRoaXMgKS5wcm9qZWN0T25WZWN0b3IoIHBsYW5lTm9ybWFsICk7CgoJCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYyApOwoKCQl9CgoJCS8qKgoJCSAqIFJlZmxlY3RzIHRoaXMgdmVjdG9yIG9mZiBhIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGdpdmVuIG5vcm1hbCB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IG5vcm1hbCAtIFRoZSAobm9ybWFsaXplZCkgbm9ybWFsIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlyZWZsZWN0KCBub3JtYWwgKSB7CgoJCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYy5jb3B5KCBub3JtYWwgKS5tdWx0aXBseVNjYWxhciggMiAqIHRoaXMuZG90KCBub3JtYWwgKSApICk7CgoJCX0KCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBhbmdsZSBiZXR3ZWVuIHRoZSBnaXZlbiB2ZWN0b3IgYW5kIHRoaXMgaW5zdGFuY2UgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgYW5nbGUgd2l0aC4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqLwoJCWFuZ2xlVG8oIHYgKSB7CgoJCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgoJCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgcmV0dXJuIE1hdGguUEkgLyAyOwoKCQkJY29uc3QgdGhldGEgPSB0aGlzLmRvdCggdiApIC8gZGVub21pbmF0b3I7CgoJCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKCQkJcmV0dXJuIE1hdGguYWNvcyggY2xhbXAoIHRoZXRhLCAtMSwgMSApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVRvU3F1YXJlZCggdiApICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICogSWYgeW91IGFyZSBqdXN0IGNvbXBhcmluZyB0aGUgZGlzdGFuY2Ugd2l0aCBhbm90aGVyIGRpc3RhbmNlLCB5b3Ugc2hvdWxkIGNvbXBhcmUKCQkgKiB0aGUgZGlzdGFuY2Ugc3F1YXJlZCBpbnN0ZWFkIGFzIGl0IGlzIHNsaWdodGx5IG1vcmUgZWZmaWNpZW50IHRvIGNhbGN1bGF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgc3F1YXJlZCBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlVG9TcXVhcmVkKCB2ICkgewoKCQkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55LCBkeiA9IHRoaXMueiAtIHYuejsKCgkJCXJldHVybiBkeCAqIGR4ICsgZHkgKiBkeSArIGR6ICogZHo7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIE1hbmhhdHRhbiBkaXN0YW5jZSBmcm9tIHRoZSBnaXZlbiB2ZWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB2ZWN0b3IgdG8gY29tcHV0ZSB0aGUgTWFuaGF0dGFuIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIE1hbmhhdHRhbiBkaXN0YW5jZS4KCQkgKi8KCQltYW5oYXR0YW5EaXN0YW5jZVRvKCB2ICkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKSArIE1hdGguYWJzKCB0aGlzLnogLSB2LnogKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBzcGhlcmljYWwgY29vcmRpbmF0ZXMuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyaWNhbH0gcyAtIFRoZSBzcGhlcmljYWwgY29vcmRpbmF0ZXMuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbVNwaGVyaWNhbCggcyApIHsKCgkJCXJldHVybiB0aGlzLnNldEZyb21TcGhlcmljYWxDb29yZHMoIHMucmFkaXVzLCBzLnBoaSwgcy50aGV0YSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIHNwaGVyaWNhbCBjb29yZGluYXRlcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByYWRpdXMgLSBUaGUgcmFkaXVzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBwaGkgLSBUaGUgcGhpIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHRoZXRhIC0gVGhlIHRoZXRhIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbVNwaGVyaWNhbENvb3JkcyggcmFkaXVzLCBwaGksIHRoZXRhICkgewoKCQkJY29uc3Qgc2luUGhpUmFkaXVzID0gTWF0aC5zaW4oIHBoaSApICogcmFkaXVzOwoKCQkJdGhpcy54ID0gc2luUGhpUmFkaXVzICogTWF0aC5zaW4oIHRoZXRhICk7CgkJCXRoaXMueSA9IE1hdGguY29zKCBwaGkgKSAqIHJhZGl1czsKCQkJdGhpcy56ID0gc2luUGhpUmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBjeWxpbmRyaWNhbCBjb29yZGluYXRlcy4KCQkgKgoJCSAqIEBwYXJhbSB7Q3lsaW5kcmljYWx9IGMgLSBUaGUgY3lsaW5kcmljYWwgY29vcmRpbmF0ZXMuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbUN5bGluZHJpY2FsKCBjICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0RnJvbUN5bGluZHJpY2FsQ29vcmRzKCBjLnJhZGl1cywgYy50aGV0YSwgYy55ICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gY3lsaW5kcmljYWwgY29vcmRpbmF0ZXMuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIC0gVGhlIHJhZGl1cy4KCQkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgdGhldGEgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IHZhbHVlLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldEZyb21DeWxpbmRyaWNhbENvb3JkcyggcmFkaXVzLCB0aGV0YSwgeSApIHsKCgkJCXRoaXMueCA9IHJhZGl1cyAqIE1hdGguc2luKCB0aGV0YSApOwoJCQl0aGlzLnkgPSB5OwoJCQl0aGlzLnogPSByYWRpdXMgKiBNYXRoLmNvcyggdGhldGEgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBwb3NpdGlvbiBlbGVtZW50cyBvZiB0aGUKCQkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgoJCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDEyIF07CgkJCXRoaXMueSA9IGVbIDEzIF07CgkJCXRoaXMueiA9IGVbIDE0IF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2NhbGUgZWxlbWVudHMgb2YgdGhlCgkJICogZ2l2ZW4gdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIDR4NCBtYXRyaXguCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbU1hdHJpeFNjYWxlKCBtICkgewoKCQkJY29uc3Qgc3ggPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDAgKS5sZW5ndGgoKTsKCQkJY29uc3Qgc3kgPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKCQkJY29uc3Qgc3ogPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDIgKS5sZW5ndGgoKTsKCgkJCXRoaXMueCA9IHN4OwoJCQl0aGlzLnkgPSBzeTsKCQkJdGhpcy56ID0gc3o7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyBmcm9tIHRoZSBzcGVjaWZpZWQgbWF0cml4IGNvbHVtbi4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBjb2x1bW4gaW5kZXguCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogNCApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIHNwZWNpZmllZCBtYXRyaXggY29sdW1uLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGNvbHVtbiBpbmRleC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tTWF0cml4M0NvbHVtbiggbSwgaW5kZXggKSB7CgoJCQlyZXR1cm4gdGhpcy5mcm9tQXJyYXkoIG0uZWxlbWVudHMsIGluZGV4ICogMyApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIGZyb20gdGhlIGdpdmVuIEV1bGVyIGFuZ2xlcy4KCQkgKgoJCSAqIEBwYXJhbSB7RXVsZXJ9IGUgLSBUaGUgRXVsZXIgYW5nbGVzIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tRXVsZXIoIGUgKSB7CgoJCQl0aGlzLnggPSBlLl94OwoJCQl0aGlzLnkgPSBlLl95OwoJCQl0aGlzLnogPSBlLl96OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yIGNvbXBvbmVudHMgZnJvbSB0aGUgUkdCIGNvbXBvbmVudHMgb2YgdGhlCgkJICogZ2l2ZW4gY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjIC0gVGhlIGNvbG9yIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tQ29sb3IoIGMgKSB7CgoJCQl0aGlzLnggPSBjLnI7CgkJCXRoaXMueSA9IGMuZzsKCQkJdGhpcy56ID0gYy5iOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB2ZWN0b3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIHYgKSB7CgoJCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICYmICggdi56ID09PSB0aGlzLnogKSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyB2ZWN0b3IncyB4IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0IF1gLCB5IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMSBdYAoJCSAqIGFuZCB6IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMiBdYC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLno7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoJCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgZWFjaCBjb21wb25lbnQgb2YgdGhpcyB2ZWN0b3IgdG8gYSBwc2V1ZG8tcmFuZG9tIHZhbHVlIGJldHdlZW4gYDBgIGFuZAoJCSAqIGAxYCwgZXhjbHVkaW5nIGAxYC4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXJhbmRvbSgpIHsKCgkJCXRoaXMueCA9IE1hdGgucmFuZG9tKCk7CgkJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CgkJCXRoaXMueiA9IE1hdGgucmFuZG9tKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdmVjdG9yIHRvIGEgdW5pZm9ybWx5IHJhbmRvbSBwb2ludCBvbiBhIHVuaXQgc3BoZXJlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yM30gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcmFuZG9tRGlyZWN0aW9uKCkgewoKCQkJLy8gaHR0cHM6Ly9tYXRod29ybGQud29sZnJhbS5jb20vU3BoZXJlUG9pbnRQaWNraW5nLmh0bWwKCgkJCWNvbnN0IHRoZXRhID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOwoJCQljb25zdCB1ID0gTWF0aC5yYW5kb20oKSAqIDIgLSAxOwoJCQljb25zdCBjID0gTWF0aC5zcXJ0KCAxIC0gdSAqIHUgKTsKCgkJCXRoaXMueCA9IGMgKiBNYXRoLmNvcyggdGhldGEgKTsKCQkJdGhpcy55ID0gdTsKCQkJdGhpcy56ID0gYyAqIE1hdGguc2luKCB0aGV0YSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCQl5aWVsZCB0aGlzLng7CgkJCXlpZWxkIHRoaXMueTsKCQkJeWllbGQgdGhpcy56OwoKCQl9CgoJfQoKCWNvbnN0IF92ZWN0b3IkYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9xdWF0ZXJuaW9uJDQgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgoJLyoqCgkgKiBSZXByZXNlbnRzIGEgM3gzIG1hdHJpeC4KCSAqCgkgKiBBIE5vdGUgb24gUm93LU1ham9yIGFuZCBDb2x1bW4tTWFqb3IgT3JkZXJpbmc6CgkgKgoJICogVGhlIGNvbnN0cnVjdG9yIGFuZCB7QGxpbmsgTWF0cml4MyNzZXR9IG1ldGhvZCB0YWtlIGFyZ3VtZW50cyBpbgoJICogW3Jvdy1tYWpvcl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUm93LV9hbmRfY29sdW1uLW1ham9yX29yZGVyI0NvbHVtbi1tYWpvcl9vcmRlcn0KCSAqIG9yZGVyLCB3aGlsZSBpbnRlcm5hbGx5IHRoZXkgYXJlIHN0b3JlZCBpbiB0aGUge0BsaW5rIE1hdHJpeDMjZWxlbWVudHN9IGFycmF5IGluIGNvbHVtbi1tYWpvciBvcmRlci4KCSAqIFRoaXMgbWVhbnMgdGhhdCBjYWxsaW5nOgoJICogYGBganMKCSAqIGNvbnN0IG0gPSBuZXcgVEhSRUUuTWF0cml4KCk7CgkgKiBtLnNldCggMTEsIDEyLCAxMywKCSAqICAgICAgICAyMSwgMjIsIDIzLAoJICogICAgICAgIDMxLCAzMiwgMzMgKTsKCSAqIGBgYAoJICogd2lsbCByZXN1bHQgaW4gdGhlIGVsZW1lbnRzIGFycmF5IGNvbnRhaW5pbmc6CgkgKiBgYGBqcwoJICogbS5lbGVtZW50cyA9IFsgMTEsIDIxLCAzMSwKCSAqICAgICAgICAgICAgICAgIDEyLCAyMiwgMzIsCgkgKiAgICAgICAgICAgICAgICAxMywgMjMsIDMzIF07CgkgKiBgYGAKCSAqIGFuZCBpbnRlcm5hbGx5IGFsbCBjYWxjdWxhdGlvbnMgYXJlIHBlcmZvcm1lZCB1c2luZyBjb2x1bW4tbWFqb3Igb3JkZXJpbmcuCgkgKiBIb3dldmVyLCBhcyB0aGUgYWN0dWFsIG9yZGVyaW5nIG1ha2VzIG5vIGRpZmZlcmVuY2UgbWF0aGVtYXRpY2FsbHkgYW5kCgkgKiBtb3N0IHBlb3BsZSBhcmUgdXNlZCB0byB0aGlua2luZyBhYm91dCBtYXRyaWNlcyBpbiByb3ctbWFqb3Igb3JkZXIsIHRoZQoJICogdGhyZWUuanMgZG9jdW1lbnRhdGlvbiBzaG93cyBtYXRyaWNlcyBpbiByb3ctbWFqb3Igb3JkZXIuIEp1c3QgYmVhciBpbgoJICogbWluZCB0aGF0IGlmIHlvdSBhcmUgcmVhZGluZyB0aGUgc291cmNlIGNvZGUsIHlvdSdsbCBoYXZlIHRvIHRha2UgdGhlCgkgKiB0cmFuc3Bvc2Ugb2YgYW55IG1hdHJpY2VzIG91dGxpbmVkIGhlcmUgdG8gbWFrZSBzZW5zZSBvZiB0aGUgY2FsY3VsYXRpb25zLgoJICovCgljbGFzcyBNYXRyaXgzIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyAzeDMgbWF0cml4LiBUaGUgYXJndW1lbnRzIGFyZSBzdXBwb3NlZCB0byBiZQoJCSAqIGluIHJvdy1tYWpvciBvcmRlci4gSWYgbm8gYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgdGhlIGNvbnN0cnVjdG9yCgkJICogaW5pdGlhbGl6ZXMgdGhlIG1hdHJpeCBhcyBhbiBpZGVudGl0eSBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zMV0gLSAzLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzJdIC0gMy0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMzXSAtIDMtMyBtYXRyaXggZWxlbWVudC4KCQkgKi8KCQljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjIxLCBuMjIsIG4yMywgbjMxLCBuMzIsIG4zMyApIHsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQlNYXRyaXgzLnByb3RvdHlwZS5pc01hdHJpeDMgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIEEgY29sdW1uLW1ham9yIGxpc3Qgb2YgbWF0cml4IHZhbHVlcy4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PG51bWJlcj59CgkJCSAqLwoJCQl0aGlzLmVsZW1lbnRzID0gWwoKCQkJCTEsIDAsIDAsCgkJCQkwLCAxLCAwLAoJCQkJMCwgMCwgMQoKCQkJXTsKCgkJCWlmICggbjExICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4yMSwgbjIyLCBuMjMsIG4zMSwgbjMyLCBuMzMgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4LlRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCgkJICogaW4gcm93LW1ham9yIG9yZGVyLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTFdIC0gMS0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEyXSAtIDEtMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24xM10gLSAxLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjFdIC0gMi0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIyXSAtIDItMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yM10gLSAyLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSA9IG4xMTsgdGVbIDEgXSA9IG4yMTsgdGVbIDIgXSA9IG4zMTsKCQkJdGVbIDMgXSA9IG4xMjsgdGVbIDQgXSA9IG4yMjsgdGVbIDUgXSA9IG4zMjsKCQkJdGVbIDYgXSA9IG4xMzsgdGVbIDcgXSA9IG4yMzsgdGVbIDggXSA9IG4zMzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggdG8gdGhlIDN4MyBpZGVudGl0eSBtYXRyaXguCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlpZGVudGl0eSgpIHsKCgkJCXRoaXMuc2V0KAoKCQkJCTEsIDAsIDAsCgkJCQkwLCAxLCAwLAoJCQkJMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRyaXggdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4M30gbSAtIFRoZSBtYXRyaXggdG8gY29weS4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQljb3B5KCBtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOwoJCQl0ZVsgMyBdID0gbWVbIDMgXTsgdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOwoJCQl0ZVsgNiBdID0gbWVbIDYgXTsgdGVbIDcgXSA9IG1lWyA3IF07IHRlWyA4IF0gPSBtZVsgOCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXh0cmFjdHMgdGhlIGJhc2lzIG9mIHRoaXMgbWF0cml4IGludG8gdGhlIHRocmVlIGF4aXMgdmVjdG9ycyBwcm92aWRlZC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30geEF4aXMgLSBUaGUgYmFzaXMncyB4IGF4aXMuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB5QXhpcyAtIFRoZSBiYXNpcydzIHkgYXhpcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHpBeGlzIC0gVGhlIGJhc2lzJ3MgeiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJCXhBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAwICk7CgkJCXlBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAxICk7CgkJCXpBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAyICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXQgdGhpcyBtYXRyaXggdG8gdGhlIHVwcGVyIDN4MyBtYXRyaXggb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlzZXRGcm9tTWF0cml4NCggbSApIHsKCgkJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCgkJCXRoaXMuc2V0KAoKCQkJCW1lWyAwIF0sIG1lWyA0IF0sIG1lWyA4IF0sCgkJCQltZVsgMSBdLCBtZVsgNSBdLCBtZVsgOSBdLAoJCQkJbWVbIDIgXSwgbWVbIDYgXSwgbWVbIDEwIF0KCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQb3N0LW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDN4MyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgoJCX0KCgkJLyoqCgkJICogUHJlLW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDN4MyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJcHJlbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGVzIHRoZSBnaXZlbiAzeDMgbWF0cmljZXMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CgkJICogaW4gdGhpcyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IGEgLSBUaGUgZmlyc3QgbWF0cml4LgoJCSAqIEBwYXJhbSB7TWF0cml4M30gYiAtIFRoZSBzZWNvbmQgbWF0cml4LgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgoJCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CgkJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDMgXSwgYTEzID0gYWVbIDYgXTsKCQkJY29uc3QgYTIxID0gYWVbIDEgXSwgYTIyID0gYWVbIDQgXSwgYTIzID0gYWVbIDcgXTsKCQkJY29uc3QgYTMxID0gYWVbIDIgXSwgYTMyID0gYWVbIDUgXSwgYTMzID0gYWVbIDggXTsKCgkJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyAzIF0sIGIxMyA9IGJlWyA2IF07CgkJCWNvbnN0IGIyMSA9IGJlWyAxIF0sIGIyMiA9IGJlWyA0IF0sIGIyMyA9IGJlWyA3IF07CgkJCWNvbnN0IGIzMSA9IGJlWyAyIF0sIGIzMiA9IGJlWyA1IF0sIGIzMyA9IGJlWyA4IF07CgoJCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxOwoJCQl0ZVsgMyBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyOwoJCQl0ZVsgNiBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzOwoKCQkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKCQkJdGVbIDQgXSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKCQkJdGVbIDcgXSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKCgkJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CgkJCXRlWyA1IF0gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CgkJCXRlWyA4IF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBNdWx0aXBsaWVzIGV2ZXJ5IGNvbXBvbmVudCBvZiB0aGUgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIuCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0ZVsgMCBdICo9IHM7IHRlWyAzIF0gKj0gczsgdGVbIDYgXSAqPSBzOwoJCQl0ZVsgMSBdICo9IHM7IHRlWyA0IF0gKj0gczsgdGVbIDcgXSAqPSBzOwoJCQl0ZVsgMiBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDggXSAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgYW5kIHJldHVybnMgdGhlIGRldGVybWluYW50IG9mIHRoaXMgbWF0cml4LgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgZGV0ZXJtaW5hbnQuCgkJICovCgkJZGV0ZXJtaW5hbnQoKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQljb25zdCBhID0gdGVbIDAgXSwgYiA9IHRlWyAxIF0sIGMgPSB0ZVsgMiBdLAoJCQkJZCA9IHRlWyAzIF0sIGUgPSB0ZVsgNCBdLCBmID0gdGVbIDUgXSwKCQkJCWcgPSB0ZVsgNiBdLCBoID0gdGVbIDcgXSwgaSA9IHRlWyA4IF07CgoJCQlyZXR1cm4gYSAqIGUgKiBpIC0gYSAqIGYgKiBoIC0gYiAqIGQgKiBpICsgYiAqIGYgKiBnICsgYyAqIGQgKiBoIC0gYyAqIGUgKiBnOwoKCQl9CgoJCS8qKgoJCSAqIEludmVydHMgdGhpcyBtYXRyaXgsIHVzaW5nIHRoZSBbYW5hbHl0aWMgbWV0aG9kXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnZlcnRpYmxlX21hdHJpeCNBbmFseXRpY19zb2x1dGlvbn0uCgkJICogWW91IGNhbiBub3QgaW52ZXJ0IHdpdGggYSBkZXRlcm1pbmFudCBvZiB6ZXJvLiBJZiB5b3UgYXR0ZW1wdCB0aGlzLCB0aGUgbWV0aG9kIHByb2R1Y2VzCgkJICogYSB6ZXJvIG1hdHJpeCBpbnN0ZWFkLgoJCSAqCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJaW52ZXJ0KCkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKCQkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sCgkJCQluMTIgPSB0ZVsgMyBdLCBuMjIgPSB0ZVsgNCBdLCBuMzIgPSB0ZVsgNSBdLAoJCQkJbjEzID0gdGVbIDYgXSwgbjIzID0gdGVbIDcgXSwgbjMzID0gdGVbIDggXSwKCgkJCQl0MTEgPSBuMzMgKiBuMjIgLSBuMzIgKiBuMjMsCgkJCQl0MTIgPSBuMzIgKiBuMTMgLSBuMzMgKiBuMTIsCgkJCQl0MTMgPSBuMjMgKiBuMTIgLSBuMjIgKiBuMTMsCgoJCQkJZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzOwoKCQkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCgkJCWNvbnN0IGRldEludiA9IDEgLyBkZXQ7CgoJCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCQl0ZVsgMSBdID0gKCBuMzEgKiBuMjMgLSBuMzMgKiBuMjEgKSAqIGRldEludjsKCQkJdGVbIDIgXSA9ICggbjMyICogbjIxIC0gbjMxICogbjIyICkgKiBkZXRJbnY7CgoJCQl0ZVsgMyBdID0gdDEyICogZGV0SW52OwoJCQl0ZVsgNCBdID0gKCBuMzMgKiBuMTEgLSBuMzEgKiBuMTMgKSAqIGRldEludjsKCQkJdGVbIDUgXSA9ICggbjMxICogbjEyIC0gbjMyICogbjExICkgKiBkZXRJbnY7CgoJCQl0ZVsgNiBdID0gdDEzICogZGV0SW52OwoJCQl0ZVsgNyBdID0gKCBuMjEgKiBuMTMgLSBuMjMgKiBuMTEgKSAqIGRldEludjsKCQkJdGVbIDggXSA9ICggbjIyICogbjExIC0gbjIxICogbjEyICkgKiBkZXRJbnY7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc3Bvc2VzIHRoaXMgbWF0cml4IGluIHBsYWNlLgoJCSAqCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJdHJhbnNwb3NlKCkgewoKCQkJbGV0IHRtcDsKCQkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0bXAgPSBtWyAxIF07IG1bIDEgXSA9IG1bIDMgXTsgbVsgMyBdID0gdG1wOwoJCQl0bXAgPSBtWyAyIF07IG1bIDIgXSA9IG1bIDYgXTsgbVsgNiBdID0gdG1wOwoJCQl0bXAgPSBtWyA1IF07IG1bIDUgXSA9IG1bIDcgXTsgbVsgNyBdID0gdG1wOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIG5vcm1hbCBtYXRyaXggd2hpY2ggaXMgdGhlIGludmVyc2UgdHJhbnNwb3NlIG9mIHRoZSB1cHBlcgoJCSAqIGxlZnQgM3gzIHBvcnRpb24gb2YgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeDQgLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlnZXROb3JtYWxNYXRyaXgoIG1hdHJpeDQgKSB7CgoJCQlyZXR1cm4gdGhpcy5zZXRGcm9tTWF0cml4NCggbWF0cml4NCApLmludmVydCgpLnRyYW5zcG9zZSgpOwoKCQl9CgoJCS8qKgoJCSAqIFRyYW5zcG9zZXMgdGhpcyBtYXRyaXggaW50byB0aGUgc3VwcGxpZWQgYXJyYXksIGFuZCByZXR1cm5zIGl0c2VsZiB1bmNoYW5nZWQuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj59IHIgLSBBbiBhcnJheSB0byBzdG9yZSB0aGUgdHJhbnNwb3NlZCBtYXRyaXggZWxlbWVudHMuCgkJICogQHJldHVybiB7TWF0cml4M30gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJdHJhbnNwb3NlSW50b0FycmF5KCByICkgewoKCQkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgoJCQlyWyAwIF0gPSBtWyAwIF07CgkJCXJbIDEgXSA9IG1bIDMgXTsKCQkJclsgMiBdID0gbVsgNiBdOwoJCQlyWyAzIF0gPSBtWyAxIF07CgkJCXJbIDQgXSA9IG1bIDQgXTsKCQkJclsgNSBdID0gbVsgNyBdOwoJCQlyWyA2IF0gPSBtWyAyIF07CgkJCXJbIDcgXSA9IG1bIDUgXTsKCQkJclsgOCBdID0gbVsgOCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgVVYgdHJhbnNmb3JtIG1hdHJpeCBmcm9tIG9mZnNldCwgcmVwZWF0LCByb3RhdGlvbiwgYW5kIGNlbnRlci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0eCAtIE9mZnNldCB4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0eSAtIE9mZnNldCB5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzeCAtIFJlcGVhdCB4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzeSAtIFJlcGVhdCB5LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByb3RhdGlvbiAtIFJvdGF0aW9uLCBpbiByYWRpYW5zLiBQb3NpdGl2ZSB2YWx1ZXMgcm90YXRlIGNvdW50ZXJjbG9ja3dpc2UuCgkJICogQHBhcmFtIHtudW1iZXJ9IGN4IC0gQ2VudGVyIHggb2Ygcm90YXRpb24uCgkJICogQHBhcmFtIHtudW1iZXJ9IGN5IC0gQ2VudGVyIHkgb2Ygcm90YXRpb24KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlzZXRVdlRyYW5zZm9ybSggdHgsIHR5LCBzeCwgc3ksIHJvdGF0aW9uLCBjeCwgY3kgKSB7CgoJCQljb25zdCBjID0gTWF0aC5jb3MoIHJvdGF0aW9uICk7CgkJCWNvbnN0IHMgPSBNYXRoLnNpbiggcm90YXRpb24gKTsKCgkJCXRoaXMuc2V0KAoJCQkJc3ggKiBjLCBzeCAqIHMsIC0gc3ggKiAoIGMgKiBjeCArIHMgKiBjeSApICsgY3ggKyB0eCwKCQkJCS0gc3kgKiBzLCBzeSAqIGMsIC0gc3kgKiAoIC0gcyAqIGN4ICsgYyAqIGN5ICkgKyBjeSArIHR5LAoJCQkJMCwgMCwgMQoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2NhbGVzIHRoaXMgbWF0cml4IHdpdGggdGhlIGdpdmVuIHNjYWxhciB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc3ggLSBUaGUgYW1vdW50IHRvIHNjYWxlIGluIHRoZSBYIGF4aXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHN5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCXNjYWxlKCBzeCwgc3kgKSB7CgoJCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVNjYWxlKCBzeCwgc3kgKSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgcm90YXRpb24gaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlyb3RhdGUoIHRoZXRhICkgewoKCQkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VSb3RhdGlvbiggLSB0aGV0YSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGVzIHRoaXMgbWF0cml4IGJ5IHRoZSBnaXZlbiBzY2FsYXIgdmFsdWVzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHR4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gdHkgLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgWSBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCXRyYW5zbGF0ZSggdHgsIHR5ICkgewoKCQkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VUcmFuc2xhdGlvbiggdHgsIHR5ICkgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8vIGZvciAyRCBUcmFuc2Zvcm1zCgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSAyRCB0cmFuc2xhdGlvbiB0cmFuc2Zvcm0uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IyfSB4IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFggYXhpcyBvciBhbHRlcm5hdGl2ZWx5IGEgdHJhbnNsYXRpb24gdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byB0cmFuc2xhdGUgaW4gdGhlIFkgYXhpcy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlVHJhbnNsYXRpb24oIHgsIHkgKSB7CgoJCQlpZiAoIHguaXNWZWN0b3IyICkgewoKCQkJCXRoaXMuc2V0KAoKCQkJCQkxLCAwLCB4LngsCgkJCQkJMCwgMSwgeC55LAoJCQkJCTAsIDAsIDEKCgkJCQkpOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNldCgKCgkJCQkJMSwgMCwgeCwKCQkJCQkwLCAxLCB5LAoJCQkJCTAsIDAsIDEKCgkJCQkpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIG1hdHJpeCBhcyBhIDJEIHJvdGF0aW9uYWwgdHJhbnNmb3JtYXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gdGhldGEgLSBUaGUgcm90YXRpb24gaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlUm90YXRpb24oIHRoZXRhICkgewoKCQkJLy8gY291bnRlcmNsb2Nrd2lzZQoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApOwoJCQljb25zdCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQljLCAtIHMsIDAsCgkJCQlzLCBjLCAwLAoJCQkJMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSAyRCBzY2FsZSB0cmFuc2Zvcm0uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbW91bnQgdG8gc2NhbGUgaW4gdGhlIFkgYXhpcy4KCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlU2NhbGUoIHgsIHkgKSB7CgoJCQl0aGlzLnNldCgKCgkJCQl4LCAwLCAwLAoJCQkJMCwgeSwgMCwKCQkJCTAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIG1hdHJpeCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG1hdHJpeCAtIFRoZSBtYXRyaXggdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIG1hdHJpeCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCBtYXRyaXggKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCWNvbnN0IG1lID0gbWF0cml4LmVsZW1lbnRzOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgOTsgaSArKyApIHsKCgkJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFycmF5LgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge01hdHJpeDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJCXRoaXMuZWxlbWVudHNbIGkgXSA9IGFycmF5WyBpICsgb2Zmc2V0IF07CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBXcml0ZXMgdGhlIGVsZW1lbnRzIG9mIHRoaXMgbWF0cml4IHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCgkJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGVbIDEgXTsKCQkJYXJyYXlbIG9mZnNldCArIDIgXSA9IHRlWyAyIF07CgoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCQkJYXJyYXlbIG9mZnNldCArIDQgXSA9IHRlWyA0IF07CgkJCWFycmF5WyBvZmZzZXQgKyA1IF0gPSB0ZVsgNSBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgOCBdID0gdGVbIDggXTsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbWF0cml4IHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRyaXgzfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5mcm9tQXJyYXkoIHRoaXMuZWxlbWVudHMgKTsKCgkJfQoKCX0KCgljb25zdCBfbTMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgoJZnVuY3Rpb24gYXJyYXlOZWVkc1VpbnQzMiggYXJyYXkgKSB7CgoJCS8vIGFzc3VtZXMgbGFyZ2VyIHZhbHVlcyB1c3VhbGx5IG9uIGxhc3QKCgkJZm9yICggbGV0IGkgPSBhcnJheS5sZW5ndGggLSAxOyBpID49IDA7IC0tIGkgKSB7CgoJCQlpZiAoIGFycmF5WyBpIF0gPj0gNjU1MzUgKSByZXR1cm4gdHJ1ZTsgLy8gYWNjb3VudCBmb3IgUFJJTUlUSVZFX1JFU1RBUlRfRklYRURfSU5ERVgsICMyNDU2NQoKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gY3JlYXRlRWxlbWVudE5TKCBuYW1lICkgewoKCQlyZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCAnaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCcsIG5hbWUgKTsKCgl9CgoJZnVuY3Rpb24gY3JlYXRlQ2FudmFzRWxlbWVudCgpIHsKCgkJY29uc3QgY2FudmFzID0gY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwoJCWNhbnZhcy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCQlyZXR1cm4gY2FudmFzOwoKCX0KCgljb25zdCBfY2FjaGUgPSB7fTsKCglmdW5jdGlvbiB3YXJuT25jZSggbWVzc2FnZSApIHsKCgkJaWYgKCBtZXNzYWdlIGluIF9jYWNoZSApIHJldHVybjsKCgkJX2NhY2hlWyBtZXNzYWdlIF0gPSB0cnVlOwoKCQljb25zb2xlLndhcm4oIG1lc3NhZ2UgKTsKCgl9CgoJZnVuY3Rpb24gcHJvYmVBc3luYyggZ2wsIHN5bmMsIGludGVydmFsICkgewoKCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJZnVuY3Rpb24gcHJvYmUoKSB7CgoJCQkJc3dpdGNoICggZ2wuY2xpZW50V2FpdFN5bmMoIHN5bmMsIGdsLlNZTkNfRkxVU0hfQ09NTUFORFNfQklULCAwICkgKSB7CgoJCQkJCWNhc2UgZ2wuV0FJVF9GQUlMRUQ6CgkJCQkJCXJlamVjdCgpOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBnbC5USU1FT1VUX0VYUElSRUQ6CgkJCQkJCXNldFRpbWVvdXQoIHByb2JlLCBpbnRlcnZhbCApOwoJCQkJCQlicmVhazsKCgkJCQkJZGVmYXVsdDoKCQkJCQkJcmVzb2x2ZSgpOwoKCQkJCX0KCgkJCX0KCgkJCXNldFRpbWVvdXQoIHByb2JlLCBpbnRlcnZhbCApOwoKCQl9ICk7CgoJfQoKCWZ1bmN0aW9uIHRvTm9ybWFsaXplZFByb2plY3Rpb25NYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSB7CgoJCWNvbnN0IG0gPSBwcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwoKCQkvLyBDb252ZXJ0IFstMSwgMV0gdG8gWzAsIDFdIHByb2plY3Rpb24gbWF0cml4CgkJbVsgMiBdID0gMC41ICogbVsgMiBdICsgMC41ICogbVsgMyBdOwoJCW1bIDYgXSA9IDAuNSAqIG1bIDYgXSArIDAuNSAqIG1bIDcgXTsKCQltWyAxMCBdID0gMC41ICogbVsgMTAgXSArIDAuNSAqIG1bIDExIF07CgkJbVsgMTQgXSA9IDAuNSAqIG1bIDE0IF0gKyAwLjUgKiBtWyAxNSBdOwoKCX0KCglmdW5jdGlvbiB0b1JldmVyc2VkUHJvamVjdGlvbk1hdHJpeCggcHJvamVjdGlvbk1hdHJpeCApIHsKCgkJY29uc3QgbSA9IHByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgkJY29uc3QgaXNQZXJzcGVjdGl2ZU1hdHJpeCA9IG1bIDExIF0gPT09IC0xOwoKCQkvLyBSZXZlcnNlIFswLCAxXSBwcm9qZWN0aW9uIG1hdHJpeAoJCWlmICggaXNQZXJzcGVjdGl2ZU1hdHJpeCApIHsKCgkJCW1bIDEwIF0gPSAtIG1bIDEwIF0gLSAxOwoJCQltWyAxNCBdID0gLSBtWyAxNCBdOwoKCQl9IGVsc2UgewoKCQkJbVsgMTAgXSA9IC0gbVsgMTAgXTsKCQkJbVsgMTQgXSA9IC0gbVsgMTQgXSArIDE7CgoJCX0KCgl9CgoJY29uc3QgTElORUFSX1JFQzcwOV9UT19YWVogPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkuc2V0KAoJCTAuNDEyMzkwOCwgMC4zNTc1ODQzLCAwLjE4MDQ4MDgsCgkJMC4yMTI2MzkwLCAwLjcxNTE2ODcsIDAuMDcyMTkyMywKCQkwLjAxOTMzMDgsIDAuMTE5MTk0OCwgMC45NTA1MzIyCgkpOwoKCWNvbnN0IFhZWl9UT19MSU5FQVJfUkVDNzA5ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpLnNldCgKCQkzLjI0MDk2OTksIC0xLjUzNzM4MzIsIC0wLjQ5ODYxMDgsCgkJLTAuOTY5MjQzNiwgMS44NzU5Njc1LCAwLjA0MTU1NTEsCgkJMC4wNTU2MzAxLCAtMC4yMDM5NzcsIDEuMDU2OTcxNQoJKTsKCglmdW5jdGlvbiBjcmVhdGVDb2xvck1hbmFnZW1lbnQoKSB7CgoJCWNvbnN0IENvbG9yTWFuYWdlbWVudCA9IHsKCgkJCWVuYWJsZWQ6IHRydWUsCgoJCQl3b3JraW5nQ29sb3JTcGFjZTogTGluZWFyU1JHQkNvbG9yU3BhY2UsCgoJCQkvKioKCQkJICogSW1wbGVtZW50YXRpb25zIG9mIHN1cHBvcnRlZCBjb2xvciBzcGFjZXMuCgkJCSAqCgkJCSAqIFJlcXVpcmVkOgoJCQkgKgktIHByaW1hcmllczogY2hyb21hdGljaXR5IGNvb3JkaW5hdGVzIFsgcnggcnkgZ3ggZ3kgYnggYnkgXQoJCQkgKgktIHdoaXRlUG9pbnQ6IHJlZmVyZW5jZSB3aGl0ZSBbIHggeSBdCgkJCSAqCS0gdHJhbnNmZXI6IHRyYW5zZmVyIGZ1bmN0aW9uIChwcmUtZGVmaW5lZCkKCQkJICoJLSB0b1hZWjogTWF0cml4MyBSR0IgdG8gWFlaIHRyYW5zZm9ybQoJCQkgKgktIGZyb21YWVo6IE1hdHJpeDMgWFlaIHRvIFJHQiB0cmFuc2Zvcm0KCQkJICoJLSBsdW1pbmFuY2VDb2VmZmljaWVudHM6IFJHQiBsdW1pbmFuY2UgY29lZmZpY2llbnRzCgkJCSAqCgkJCSAqIE9wdGlvbmFsOgoJCQkgKiAgLSBvdXRwdXRDb2xvclNwYWNlQ29uZmlnOiB7IGRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOiBDb2xvclNwYWNlIH0KCQkJICogIC0gd29ya2luZ0NvbG9yU3BhY2VDb25maWc6IHsgdW5wYWNrQ29sb3JTcGFjZTogQ29sb3JTcGFjZSB9CgkJCSAqCgkJCSAqIFJlZmVyZW5jZToKCQkJICogLSBodHRwczovL3d3dy5ydXNzZWxsY290dHJlbGwuY29tL3Bob3RvL21hdHJpeENhbGN1bGF0b3IuaHRtCgkJCSAqLwoJCQlzcGFjZXM6IHt9LAoKCQkJY29udmVydDogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSwgdGFyZ2V0Q29sb3JTcGFjZSApIHsKCgkJCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgfHwgc291cmNlQ29sb3JTcGFjZSA9PT0gdGFyZ2V0Q29sb3JTcGFjZSB8fCAhIHNvdXJjZUNvbG9yU3BhY2UgfHwgISB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJCQlyZXR1cm4gY29sb3I7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCQljb2xvci5yID0gU1JHQlRvTGluZWFyKCBjb2xvci5yICk7CgkJCQkJY29sb3IuZyA9IFNSR0JUb0xpbmVhciggY29sb3IuZyApOwoJCQkJCWNvbG9yLmIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmIgKTsKCgkJCQl9CgoJCQkJaWYgKCB0aGlzLnNwYWNlc1sgc291cmNlQ29sb3JTcGFjZSBdLnByaW1hcmllcyAhPT0gdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS5wcmltYXJpZXMgKSB7CgoJCQkJCWNvbG9yLmFwcGx5TWF0cml4MyggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1hZWiApOwoJCQkJCWNvbG9yLmFwcGx5TWF0cml4MyggdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS5mcm9tWFlaICk7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5zcGFjZXNbIHRhcmdldENvbG9yU3BhY2UgXS50cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCQljb2xvci5yID0gTGluZWFyVG9TUkdCKCBjb2xvci5yICk7CgkJCQkJY29sb3IuZyA9IExpbmVhclRvU1JHQiggY29sb3IuZyApOwoJCQkJCWNvbG9yLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIGNvbG9yOwoKCQkJfSwKCgkJCXdvcmtpbmdUb0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3IsIHRhcmdldENvbG9yU3BhY2UgKSB7CgoJCQkJcmV0dXJuIHRoaXMuY29udmVydCggY29sb3IsIHRoaXMud29ya2luZ0NvbG9yU3BhY2UsIHRhcmdldENvbG9yU3BhY2UgKTsKCgkJCX0sCgoJCQljb2xvclNwYWNlVG9Xb3JraW5nOiBmdW5jdGlvbiAoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlICkgewoKCQkJCXJldHVybiB0aGlzLmNvbnZlcnQoIGNvbG9yLCBzb3VyY2VDb2xvclNwYWNlLCB0aGlzLndvcmtpbmdDb2xvclNwYWNlICk7CgoJCQl9LAoKCQkJZ2V0UHJpbWFyaWVzOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgoJCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ucHJpbWFyaWVzOwoKCQkJfSwKCgkJCWdldFRyYW5zZmVyOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgoJCQkJaWYgKCBjb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgKSByZXR1cm4gTGluZWFyVHJhbnNmZXI7CgoJCQkJcmV0dXJuIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0udHJhbnNmZXI7CgoJCQl9LAoKCQkJZ2V0THVtaW5hbmNlQ29lZmZpY2llbnRzOiBmdW5jdGlvbiAoIHRhcmdldCwgY29sb3JTcGFjZSA9IHRoaXMud29ya2luZ0NvbG9yU3BhY2UgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5mcm9tQXJyYXkoIHRoaXMuc3BhY2VzWyBjb2xvclNwYWNlIF0ubHVtaW5hbmNlQ29lZmZpY2llbnRzICk7CgoJCQl9LAoKCQkJZGVmaW5lOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2VzICkgewoKCQkJCU9iamVjdC5hc3NpZ24oIHRoaXMuc3BhY2VzLCBjb2xvclNwYWNlcyApOwoKCQkJfSwKCgkJCS8vIEludGVybmFsIEFQSXMKCgkJCV9nZXRNYXRyaXg6IGZ1bmN0aW9uICggdGFyZ2V0TWF0cml4LCBzb3VyY2VDb2xvclNwYWNlLCB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJCXJldHVybiB0YXJnZXRNYXRyaXgKCQkJCQkuY29weSggdGhpcy5zcGFjZXNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1hZWiApCgkJCQkJLm11bHRpcGx5KCB0aGlzLnNwYWNlc1sgdGFyZ2V0Q29sb3JTcGFjZSBdLmZyb21YWVogKTsKCgkJCX0sCgoJCQlfZ2V0RHJhd2luZ0J1ZmZlckNvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3JTcGFjZSApIHsKCgkJCQlyZXR1cm4gdGhpcy5zcGFjZXNbIGNvbG9yU3BhY2UgXS5vdXRwdXRDb2xvclNwYWNlQ29uZmlnLmRyYXdpbmdCdWZmZXJDb2xvclNwYWNlOwoKCQkJfSwKCgkJCV9nZXRVbnBhY2tDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgPSB0aGlzLndvcmtpbmdDb2xvclNwYWNlICkgewoKCQkJCXJldHVybiB0aGlzLnNwYWNlc1sgY29sb3JTcGFjZSBdLndvcmtpbmdDb2xvclNwYWNlQ29uZmlnLnVucGFja0NvbG9yU3BhY2U7CgoJCQl9LAoKCQkJLy8gRGVwcmVjYXRlZAoKCQkJZnJvbVdvcmtpbmdDb2xvclNwYWNlOiBmdW5jdGlvbiAoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICkgewoKCQkJCXdhcm5PbmNlKCAnVEhSRUUuQ29sb3JNYW5hZ2VtZW50OiAuZnJvbVdvcmtpbmdDb2xvclNwYWNlKCkgaGFzIGJlZW4gcmVuYW1lZCB0byAud29ya2luZ1RvQ29sb3JTcGFjZSgpLicgKTsgLy8gQGRlcHJlY2F0ZWQsIHIxNzcKCgkJCQlyZXR1cm4gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIGNvbG9yLCB0YXJnZXRDb2xvclNwYWNlICk7CgoJCQl9LAoKCQkJdG9Xb3JraW5nQ29sb3JTcGFjZTogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSApIHsKCgkJCQl3YXJuT25jZSggJ1RIUkVFLkNvbG9yTWFuYWdlbWVudDogLnRvV29ya2luZ0NvbG9yU3BhY2UoKSBoYXMgYmVlbiByZW5hbWVkIHRvIC5jb2xvclNwYWNlVG9Xb3JraW5nKCkuJyApOyAvLyBAZGVwcmVjYXRlZCwgcjE3NwoKCQkJCXJldHVybiBDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UgKTsKCgkJCX0sCgoJCX07CgoJCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCQkgKiBzUkdCIGRlZmluaXRpb25zCgkJICovCgoJCWNvbnN0IFJFQzcwOV9QUklNQVJJRVMgPSBbIDAuNjQwLCAwLjMzMCwgMC4zMDAsIDAuNjAwLCAwLjE1MCwgMC4wNjAgXTsKCQljb25zdCBSRUM3MDlfTFVNSU5BTkNFX0NPRUZGSUNJRU5UUyA9IFsgMC4yMTI2LCAwLjcxNTIsIDAuMDcyMiBdOwoJCWNvbnN0IEQ2NSA9IFsgMC4zMTI3LCAwLjMyOTAgXTsKCgkJQ29sb3JNYW5hZ2VtZW50LmRlZmluZSggewoKCQkJWyBMaW5lYXJTUkdCQ29sb3JTcGFjZSBdOiB7CgkJCQlwcmltYXJpZXM6IFJFQzcwOV9QUklNQVJJRVMsCgkJCQl3aGl0ZVBvaW50OiBENjUsCgkJCQl0cmFuc2ZlcjogTGluZWFyVHJhbnNmZXIsCgkJCQl0b1hZWjogTElORUFSX1JFQzcwOV9UT19YWVosCgkJCQlmcm9tWFlaOiBYWVpfVE9fTElORUFSX1JFQzcwOSwKCQkJCWx1bWluYW5jZUNvZWZmaWNpZW50czogUkVDNzA5X0xVTUlOQU5DRV9DT0VGRklDSUVOVFMsCgkJCQl3b3JraW5nQ29sb3JTcGFjZUNvbmZpZzogeyB1bnBhY2tDb2xvclNwYWNlOiBTUkdCQ29sb3JTcGFjZSB9LAoJCQkJb3V0cHV0Q29sb3JTcGFjZUNvbmZpZzogeyBkcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogU1JHQkNvbG9yU3BhY2UgfQoJCQl9LAoKCQkJWyBTUkdCQ29sb3JTcGFjZSBdOiB7CgkJCQlwcmltYXJpZXM6IFJFQzcwOV9QUklNQVJJRVMsCgkJCQl3aGl0ZVBvaW50OiBENjUsCgkJCQl0cmFuc2ZlcjogU1JHQlRyYW5zZmVyLAoJCQkJdG9YWVo6IExJTkVBUl9SRUM3MDlfVE9fWFlaLAoJCQkJZnJvbVhZWjogWFlaX1RPX0xJTkVBUl9SRUM3MDksCgkJCQlsdW1pbmFuY2VDb2VmZmljaWVudHM6IFJFQzcwOV9MVU1JTkFOQ0VfQ09FRkZJQ0lFTlRTLAoJCQkJb3V0cHV0Q29sb3JTcGFjZUNvbmZpZzogeyBkcmF3aW5nQnVmZmVyQ29sb3JTcGFjZTogU1JHQkNvbG9yU3BhY2UgfQoJCQl9LAoKCQl9ICk7CgoJCXJldHVybiBDb2xvck1hbmFnZW1lbnQ7CgoJfQoKCWNvbnN0IENvbG9yTWFuYWdlbWVudCA9IC8qQF9fUFVSRV9fKi8gY3JlYXRlQ29sb3JNYW5hZ2VtZW50KCk7CgoJZnVuY3Rpb24gU1JHQlRvTGluZWFyKCBjICkgewoKCQlyZXR1cm4gKCBjIDwgMC4wNDA0NSApID8gYyAqIDAuMDc3Mzk5MzgwOCA6IE1hdGgucG93KCBjICogMC45NDc4NjcyOTg2ICsgMC4wNTIxMzI3MDE0LCAyLjQgKTsKCgl9CgoJZnVuY3Rpb24gTGluZWFyVG9TUkdCKCBjICkgewoKCQlyZXR1cm4gKCBjIDwgMC4wMDMxMzA4ICkgPyBjICogMTIuOTIgOiAxLjA1NSAqICggTWF0aC5wb3coIGMsIDAuNDE2NjYgKSApIC0gMC4wNTU7CgoJfQoKCWxldCBfY2FudmFzOwoKCS8qKgoJICogQSBjbGFzcyBjb250YWluaW5nIHV0aWxpdHkgZnVuY3Rpb25zIGZvciBpbWFnZXMuCgkgKgoJICogQGhpZGVjb25zdHJ1Y3RvcgoJICovCgljbGFzcyBJbWFnZVV0aWxzIHsKCgkJLyoqCgkJICogUmV0dXJucyBhIGRhdGEgVVJJIGNvbnRhaW5pbmcgYSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ2l2ZW4gaW1hZ2UuCgkJICoKCQkgKiBAcGFyYW0geyhIVE1MSW1hZ2VFbGVtZW50fEhUTUxDYW52YXNFbGVtZW50KX0gaW1hZ2UgLSBUaGUgaW1hZ2Ugb2JqZWN0LgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbdHlwZT0naW1hZ2UvcG5nJ10gLSBJbmRpY2F0ZXMgdGhlIGltYWdlIGZvcm1hdC4KCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBkYXRhIFVSSS4KCQkgKi8KCQlzdGF0aWMgZ2V0RGF0YVVSTCggaW1hZ2UsIHR5cGUgPSAnaW1hZ2UvcG5nJyApIHsKCgkJCWlmICggL15kYXRhOi9pLnRlc3QoIGltYWdlLnNyYyApICkgewoKCQkJCXJldHVybiBpbWFnZS5zcmM7CgoJCQl9CgoJCQlpZiAoIHR5cGVvZiBIVE1MQ2FudmFzRWxlbWVudCA9PT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJcmV0dXJuIGltYWdlLnNyYzsKCgkJCX0KCgkJCWxldCBjYW52YXM7CgoJCQlpZiAoIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB7CgoJCQkJY2FudmFzID0gaW1hZ2U7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggX2NhbnZhcyA9PT0gdW5kZWZpbmVkICkgX2NhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgkJCQlfY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CgkJCQlfY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKCgkJCQljb25zdCBjb250ZXh0ID0gX2NhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgoJCQkJaWYgKCBpbWFnZSBpbnN0YW5jZW9mIEltYWdlRGF0YSApIHsKCgkJCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlLCAwLCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCWNhbnZhcyA9IF9jYW52YXM7CgoJCQl9CgoJCQlyZXR1cm4gY2FudmFzLnRvRGF0YVVSTCggdHlwZSApOwoKCQl9CgoJCS8qKgoJCSAqIENvbnZlcnRzIHRoZSBnaXZlbiBzUkdCIGltYWdlIGRhdGEgdG8gbGluZWFyIGNvbG9yIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHsoSFRNTEltYWdlRWxlbWVudHxIVE1MQ2FudmFzRWxlbWVudHxJbWFnZUJpdG1hcHxPYmplY3QpfSBpbWFnZSAtIFRoZSBpbWFnZSBvYmplY3QuCgkJICogQHJldHVybiB7SFRNTENhbnZhc0VsZW1lbnR8T2JqZWN0fSBUaGUgY29udmVydGVkIGltYWdlLgoJCSAqLwoJCXN0YXRpYyBzUkdCVG9MaW5lYXIoIGltYWdlICkgewoKCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAoJCQkJKCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAgKSApIHsKCgkJCQljb25zdCBjYW52YXMgPSBjcmVhdGVFbGVtZW50TlMoICdjYW52YXMnICk7CgoJCQkJY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CgkJCQljYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwoJCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCQkJCWNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJZGF0YVsgaSBdID0gU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NTsKCgkJCQl9CgoJCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlRGF0YSwgMCwgMCApOwoKCQkJCXJldHVybiBjYW52YXM7CgoJCQl9IGVsc2UgaWYgKCBpbWFnZS5kYXRhICkgewoKCQkJCWNvbnN0IGRhdGEgPSBpbWFnZS5kYXRhLnNsaWNlKCAwICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWlmICggZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgfHwgZGF0YSBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5ICkgewoKCQkJCQkJZGF0YVsgaSBdID0gTWF0aC5mbG9vciggU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gYXNzdW1pbmcgZmxvYXQKCgkJCQkJCWRhdGFbIGkgXSA9IFNSR0JUb0xpbmVhciggZGF0YVsgaSBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIHsKCQkJCQlkYXRhOiBkYXRhLAoJCQkJCXdpZHRoOiBpbWFnZS53aWR0aCwKCQkJCQloZWlnaHQ6IGltYWdlLmhlaWdodAoJCQkJfTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VVdGlscy5zUkdCVG9MaW5lYXIoKTogVW5zdXBwb3J0ZWQgaW1hZ2UgdHlwZS4gTm8gY29sb3Igc3BhY2UgY29udmVyc2lvbiBhcHBsaWVkLicgKTsKCQkJCXJldHVybiBpbWFnZTsKCgkJCX0KCgkJfQoKCX0KCglsZXQgX3NvdXJjZUlkID0gMDsKCgkvKioKCSAqIFJlcHJlc2VudHMgdGhlIGRhdGEgc291cmNlIG9mIGEgdGV4dHVyZS4KCSAqCgkgKiBUaGUgbWFpbiBwdXJwb3NlIG9mIHRoaXMgY2xhc3MgaXMgdG8gZGVjb3VwbGUgdGhlIGRhdGEgZGVmaW5pdGlvbiBmcm9tIHRoZSB0ZXh0dXJlCgkgKiBkZWZpbml0aW9uIHNvIHRoZSBzYW1lIGRhdGEgY2FuIGJlIHVzZWQgd2l0aCBtdWx0aXBsZSB0ZXh0dXJlIGluc3RhbmNlcy4KCSAqLwoJY2xhc3MgU291cmNlIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyB2aWRlbyB0ZXh0dXJlLgoJCSAqCgkJICogQHBhcmFtIHthbnl9IFtkYXRhPW51bGxdIC0gVGhlIGRhdGEgZGVmaW5pdGlvbiBvZiBhIHRleHR1cmUuCgkJICovCgkJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNTb3VyY2UgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoZSBJRCBvZiB0aGUgc291cmNlLgoJCQkgKgoJCQkgKiBAbmFtZSBTb3VyY2UjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9zb3VyY2VJZCArKyB9ICk7CgoJCQkvKioKCQkJICogVGhlIFVVSUQgb2YgdGhlIHNvdXJjZS4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge2FueX0KCQkJICovCgkJCXRoaXMuZGF0YSA9IGRhdGE7CgoJCQkvKioKCQkJICogVGhpcyBwcm9wZXJ0eSBpcyBvbmx5IHJlbGV2YW50IHdoZW4ge0BsaW5rIFNvdXJjZSNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYCBhbmQKCQkJICogcHJvdmlkZXMgbW9yZSBjb250cm9sIG9uIGhvdyB0ZXh0dXJlIGRhdGEgc2hvdWxkIGJlIHByb2Nlc3NlZC4gV2hlbiBgZGF0YVJlYWR5YCBpcyBzZXQKCQkJICogdG8gYGZhbHNlYCwgdGhlIGVuZ2luZSBwZXJmb3JtcyB0aGUgbWVtb3J5IGFsbG9jYXRpb24gKGlmIG5lY2Vzc2FyeSkgYnV0IGRvZXMgbm90IHRyYW5zZmVyCgkJCSAqIHRoZSBkYXRhIGludG8gdGhlIEdQVSBtZW1vcnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmRhdGFSZWFkeSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhpcyBzdGFydHMgYXQgYDBgIGFuZCBjb3VudHMgaG93IG1hbnkgdGltZXMge0BsaW5rIFNvdXJjZSNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMudmVyc2lvbiA9IDA7CgoJCX0KCgkJZ2V0U2l6ZSggdGFyZ2V0ICkgewoKCQkJY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCgkJCWlmICggZGF0YSBpbnN0YW5jZW9mIEhUTUxWaWRlb0VsZW1lbnQgKSB7CgoJCQkJdGFyZ2V0LnNldCggZGF0YS52aWRlb1dpZHRoLCBkYXRhLnZpZGVvSGVpZ2h0ICk7CgoJCQl9IGVsc2UgaWYgKCBkYXRhICE9PSBudWxsICkgewoKCQkJCXRhcmdldC5zZXQoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLmRlcHRoIHx8IDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGFyZ2V0LnNldCggMCwgMCwgMCApOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldDsKCgkJfQoKCQkvKioKCQkgKiBXaGVuIHRoZSBwcm9wZXJ0eSBpcyBzZXQgdG8gYHRydWVgLCB0aGUgZW5naW5lIGFsbG9jYXRlcyB0aGUgbWVtb3J5CgkJICogZm9yIHRoZSB0ZXh0dXJlIChpZiBuZWNlc3NhcnkpIGFuZCB0cmlnZ2VycyB0aGUgYWN0dWFsIHRleHR1cmUgdXBsb2FkCgkJICogdG8gdGhlIEdQVSBuZXh0IHRpbWUgdGhlIHNvdXJjZSBpcyB1c2VkLgoJCSAqCgkJICogQHR5cGUge2Jvb2xlYW59CgkJICogQGRlZmF1bHQgZmFsc2UKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCgkJICovCgkJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJLyoqCgkJICogU2VyaWFsaXplcyB0aGUgc291cmNlIGludG8gSlNPTi4KCQkgKgoJCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIHNvdXJjZS4KCQkgKiBAc2VlIHtAbGluayBPYmplY3RMb2FkZXIjcGFyc2V9CgkJICovCgkJdG9KU09OKCBtZXRhICkgewoKCQkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCQlpZiAoICEgaXNSb290T2JqZWN0ICYmIG1ldGEuaW1hZ2VzWyB0aGlzLnV1aWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBtZXRhLmltYWdlc1sgdGhpcy51dWlkIF07CgoJCQl9CgoJCQljb25zdCBvdXRwdXQgPSB7CgkJCQl1dWlkOiB0aGlzLnV1aWQsCgkJCQl1cmw6ICcnCgkJCX07CgoJCQljb25zdCBkYXRhID0gdGhpcy5kYXRhOwoKCQkJaWYgKCBkYXRhICE9PSBudWxsICkgewoKCQkJCWxldCB1cmw7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBkYXRhICkgKSB7CgoJCQkJCS8vIGN1YmUgdGV4dHVyZQoKCQkJCQl1cmwgPSBbXTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZGF0YS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJaWYgKCBkYXRhWyBpIF0uaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkJCQl1cmwucHVzaCggc2VyaWFsaXplSW1hZ2UoIGRhdGFbIGkgXS5pbWFnZSApICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXVybC5wdXNoKCBzZXJpYWxpemVJbWFnZSggZGF0YVsgaSBdICkgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHRleHR1cmUKCgkJCQkJdXJsID0gc2VyaWFsaXplSW1hZ2UoIGRhdGEgKTsKCgkJCQl9CgoJCQkJb3V0cHV0LnVybCA9IHVybDsKCgkJCX0KCgkJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgoJCQkJbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdID0gb3V0cHV0OwoKCQkJfQoKCQkJcmV0dXJuIG91dHB1dDsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXJpYWxpemVJbWFnZSggaW1hZ2UgKSB7CgoJCWlmICggKCB0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgfHwKCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAoJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKCQkJLy8gZGVmYXVsdCBpbWFnZXMKCgkJCXJldHVybiBJbWFnZVV0aWxzLmdldERhdGFVUkwoIGltYWdlICk7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGltYWdlLmRhdGEgKSB7CgoJCQkJLy8gaW1hZ2VzIG9mIERhdGFUZXh0dXJlCgoJCQkJcmV0dXJuIHsKCQkJCQlkYXRhOiBBcnJheS5mcm9tKCBpbWFnZS5kYXRhICksCgkJCQkJd2lkdGg6IGltYWdlLndpZHRoLAoJCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0LAoJCQkJCXR5cGU6IGltYWdlLmRhdGEuY29uc3RydWN0b3IubmFtZQoJCQkJfTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVGV4dHVyZTogVW5hYmxlIHRvIHNlcmlhbGl6ZSBUZXh0dXJlLicgKTsKCQkJCXJldHVybiB7fTsKCgkJCX0KCgkJfQoKCX0KCglsZXQgX3RleHR1cmVJZCA9IDA7CgoJY29uc3QgX3RlbXBWZWMzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCS8qKgoJICogQmFzZSBjbGFzcyBmb3IgYWxsIHRleHR1cmVzLgoJICoKCSAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIHRleHR1cmUsIGl0cyBkaW1lbnNpb25zLCBmb3JtYXQsIGFuZCB0eXBlCgkgKiBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwgY2FsbCB7QGxpbmsgVGV4dHVyZSNkaXNwb3NlfSBvbiB0aGUgdGV4dHVyZSBhbmQgaW5zdGFudGlhdGUgYSBuZXcgb25lLgoJICoKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqLwoJY2xhc3MgVGV4dHVyZSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7P09iamVjdH0gW2ltYWdlPVRleHR1cmUuREVGQVVMVF9JTUFHRV0gLSBUaGUgaW1hZ2UgaG9sZGluZyB0aGUgdGV4dHVyZSBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBpbWFnZSA9IFRleHR1cmUuREVGQVVMVF9JTUFHRSwgbWFwcGluZyA9IFRleHR1cmUuREVGQVVMVF9NQVBQSU5HLCB3cmFwUyA9IENsYW1wVG9FZGdlV3JhcHBpbmcsIHdyYXBUID0gQ2xhbXBUb0VkZ2VXcmFwcGluZywgbWFnRmlsdGVyID0gTGluZWFyRmlsdGVyLCBtaW5GaWx0ZXIgPSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsIGZvcm1hdCA9IFJHQkFGb3JtYXQsIHR5cGUgPSBVbnNpZ25lZEJ5dGVUeXBlLCBhbmlzb3Ryb3B5ID0gVGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFksIGNvbG9yU3BhY2UgPSBOb0NvbG9yU3BhY2UgKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgSUQgb2YgdGhlIHRleHR1cmUuCgkJCSAqCgkJCSAqIEBuYW1lIFRleHR1cmUjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF90ZXh0dXJlSWQgKysgfSApOwoKCQkJLyoqCgkJCSAqIFRoZSBVVUlEIG9mIHRoZSBtYXRlcmlhbC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgbmFtZSBvZiB0aGUgbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqLwoJCQl0aGlzLm5hbWUgPSAnJzsKCgkJCS8qKgoJCQkgKiBUaGUgZGF0YSBkZWZpbml0aW9uIG9mIGEgdGV4dHVyZS4gQSByZWZlcmVuY2UgdG8gdGhlIGRhdGEgc291cmNlIGNhbiBiZQoJCQkgKiBzaGFyZWQgYWNyb3NzIHRleHR1cmVzLiBUaGlzIGlzIG9mdGVuIHVzZWZ1bCBpbiBjb250ZXh0IG9mIHNwcml0ZXNoZWV0cwoJCQkgKiB3aGVyZSBtdWx0aXBsZSB0ZXh0dXJlcyByZW5kZXIgdGhlIHNhbWUgZGF0YSBidXQgd2l0aCBkaWZmZXJlbnQgdGV4dHVyZQoJCQkgKiB0cmFuc2Zvcm1hdGlvbnMuCgkJCSAqCgkJCSAqIEB0eXBlIHtTb3VyY2V9CgkJCSAqLwoJCQl0aGlzLnNvdXJjZSA9IG5ldyBTb3VyY2UoIGltYWdlICk7CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB1c2VyLWRlZmluZWQgbWlwbWFwcy4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PE9iamVjdD59CgkJCSAqLwoJCQl0aGlzLm1pcG1hcHMgPSBbXTsKCgkJCS8qKgoJCQkgKiBIb3cgdGhlIHRleHR1cmUgaXMgYXBwbGllZCB0byB0aGUgb2JqZWN0LiBUaGUgdmFsdWUgYFVWTWFwcGluZ2AKCQkJICogaXMgdGhlIGRlZmF1bHQsIHdoZXJlIHRleHR1cmUgb3IgdXYgY29vcmRpbmF0ZXMgYXJlIHVzZWQgdG8gYXBwbHkgdGhlIG1hcC4KCQkJICoKCQkJICogQHR5cGUgeyhVVk1hcHBpbmd8Q3ViZVJlZmxlY3Rpb25NYXBwaW5nfEN1YmVSZWZyYWN0aW9uTWFwcGluZ3xFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZ3xFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZ3xDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IFVWTWFwcGluZwoJCQkqLwoJCQl0aGlzLm1hcHBpbmcgPSBtYXBwaW5nOwoKCQkJLyoqCgkJCSAqIExldHMgeW91IHNlbGVjdCB0aGUgdXYgYXR0cmlidXRlIHRvIG1hcCB0aGUgdGV4dHVyZSB0by4gYDBgIGZvciBgdXZgLAoJCQkgKiBgMWAgZm9yIGB1djFgLCBgMmAgZm9yIGB1djJgIGFuZCBgM2AgZm9yIGB1djNgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmNoYW5uZWwgPSAwOwoKCQkJLyoqCgkJCSAqIFRoaXMgZGVmaW5lcyBob3cgdGhlIHRleHR1cmUgaXMgd3JhcHBlZCBob3Jpem9udGFsbHkgYW5kIGNvcnJlc3BvbmRzIHRvCgkJCSAqICpVKiBpbiBVViBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKCQkJICovCgkJCXRoaXMud3JhcFMgPSB3cmFwUzsKCgkJCS8qKgoJCQkgKiBUaGlzIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGlzIHdyYXBwZWQgaG9yaXpvbnRhbGx5IGFuZCBjb3JyZXNwb25kcyB0bwoJCQkgKiAqViogaW4gVVYgbWFwcGluZy4KCQkJICoKCQkJICogQHR5cGUgeyhSZXBlYXRXcmFwcGluZ3xDbGFtcFRvRWRnZVdyYXBwaW5nfE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcpfQoJCQkgKiBAZGVmYXVsdCBDbGFtcFRvRWRnZVdyYXBwaW5nCgkJCSAqLwoJCQl0aGlzLndyYXBUID0gd3JhcFQ7CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBMaW5lYXJGaWx0ZXIKCQkJICovCgkJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyOwoKCQkJLyoqCgkJCSAqIEhvdyB0aGUgdGV4dHVyZSBpcyBzYW1wbGVkIHdoZW4gYSB0ZXhlbCBjb3ZlcnMgbGVzcyB0aGFuIG9uZSBwaXhlbC4KCQkJICoKCQkJICogQHR5cGUgeyhOZWFyZXN0RmlsdGVyfE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyfE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXJ8TGluZWFyRmlsdGVyfExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXJ8TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyKX0KCQkJICogQGRlZmF1bHQgTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlcjsKCgkJCS8qKgoJCQkgKiBUaGUgbnVtYmVyIG9mIHNhbXBsZXMgdGFrZW4gYWxvbmcgdGhlIGF4aXMgdGhyb3VnaCB0aGUgcGl4ZWwgdGhhdCBoYXMgdGhlCgkJCSAqIGhpZ2hlc3QgZGVuc2l0eSBvZiB0ZXhlbHMuIEJ5IGRlZmF1bHQsIHRoaXMgdmFsdWUgaXMgYDFgLiBBIGhpZ2hlciB2YWx1ZQoJCQkgKiBnaXZlcyBhIGxlc3MgYmx1cnJ5IHJlc3VsdCB0aGFuIGEgYmFzaWMgbWlwbWFwLCBhdCB0aGUgY29zdCBvZiBtb3JlCgkJCSAqIHRleHR1cmUgc2FtcGxlcyBiZWluZyB1c2VkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmFuaXNvdHJvcHkgPSBhbmlzb3Ryb3B5OwoKCQkJLyoqCgkJCSAqIFRoZSBmb3JtYXQgb2YgdGhlIHRleHR1cmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IFJHQkFGb3JtYXQKCQkJICovCgkJCXRoaXMuZm9ybWF0ID0gZm9ybWF0OwoKCQkJLyoqCgkJCSAqIFRoZSBkZWZhdWx0IGludGVybmFsIGZvcm1hdCBpcyBkZXJpdmVkIGZyb20ge0BsaW5rIFRleHR1cmUjZm9ybWF0fSBhbmQge0BsaW5rIFRleHR1cmUjdHlwZX0gYW5kCgkJCSAqIGRlZmluZXMgaG93IHRoZSB0ZXh0dXJlIGRhdGEgaXMgZ29pbmcgdG8gYmUgc3RvcmVkIG9uIHRoZSBHUFUuCgkJCSAqCgkJCSAqIFRoaXMgcHJvcGVydHkgYWxsb3dzIHRvIG92ZXJ3cml0ZSB0aGUgZGVmYXVsdCBmb3JtYXQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/c3RyaW5nfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmludGVybmFsRm9ybWF0ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBUaGUgZGF0YSB0eXBlIG9mIHRoZSB0ZXh0dXJlLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCBVbnNpZ25lZEJ5dGVUeXBlCgkJCSAqLwoJCQl0aGlzLnR5cGUgPSB0eXBlOwoKCQkJLyoqCgkJCSAqIEhvdyBtdWNoIGEgc2luZ2xlIHJlcGV0aXRpb24gb2YgdGhlIHRleHR1cmUgaXMgb2Zmc2V0IGZyb20gdGhlIGJlZ2lubmluZywKCQkJICogaW4gZWFjaCBkaXJlY3Rpb24gVSBhbmQgVi4gVHlwaWNhbCByYW5nZSBpcyBgMC4wYCB0byBgMS4wYC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjJ9CgkJCSAqIEBkZWZhdWx0ICgwLDApCgkJCSAqLwoJCQl0aGlzLm9mZnNldCA9IG5ldyBWZWN0b3IyKCAwLCAwICk7CgoJCQkvKioKCQkJICogSG93IG1hbnkgdGltZXMgdGhlIHRleHR1cmUgaXMgcmVwZWF0ZWQgYWNyb3NzIHRoZSBzdXJmYWNlLCBpbiBlYWNoCgkJCSAqIGRpcmVjdGlvbiBVIGFuZCBWLiBJZiByZXBlYXQgaXMgc2V0IGdyZWF0ZXIgdGhhbiBgMWAgaW4gZWl0aGVyIGRpcmVjdGlvbiwKCQkJICogdGhlIGNvcnJlc3BvbmRpbmcgd3JhcCBwYXJhbWV0ZXIgc2hvdWxkIGFsc28gYmUgc2V0IHRvIGBSZXBlYXRXcmFwcGluZ2AKCQkJICogb3IgYE1pcnJvcmVkUmVwZWF0V3JhcHBpbmdgIHRvIGFjaGlldmUgdGhlIGRlc2lyZWQgdGlsaW5nIGVmZmVjdC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjJ9CgkJCSAqIEBkZWZhdWx0ICgxLDEpCgkJCSAqLwoJCQl0aGlzLnJlcGVhdCA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgoJCQkvKioKCQkJICogVGhlIHBvaW50IGFyb3VuZCB3aGljaCByb3RhdGlvbiBvY2N1cnMuIEEgdmFsdWUgb2YgYCgwLjUsIDAuNSlgIGNvcnJlc3BvbmRzCgkJCSAqIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHRleHR1cmUuIERlZmF1bHQgaXMgYCgwLCAwKWAsIHRoZSBsb3dlciBsZWZ0LgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yMn0KCQkJICogQGRlZmF1bHQgKDAsMCkKCQkJICovCgkJCXRoaXMuY2VudGVyID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsKCgkJCS8qKgoJCQkgKiBIb3cgbXVjaCB0aGUgdGV4dHVyZSBpcyByb3RhdGVkIGFyb3VuZCB0aGUgY2VudGVyIHBvaW50LCBpbiByYWRpYW5zLgoJCQkgKiBQb3NpdGl2ZSB2YWx1ZXMgYXJlIGNvdW50ZXItY2xvY2t3aXNlLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLnJvdGF0aW9uID0gMDsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRvIHVwZGF0ZSB0aGUgdGV4dHVyZSdzIHV2LXRyYW5zZm9ybWF0aW9uIHtAbGluayBUZXh0dXJlI21hdHJpeH0KCQkJICogZnJvbSB0aGUgcHJvcGVydGllcyB7QGxpbmsgVGV4dHVyZSNvZmZzZXR9LCB7QGxpbmsgVGV4dHVyZSNyZXBlYXR9LAoJCQkgKiB7QGxpbmsgVGV4dHVyZSNyb3RhdGlvbn0sIGFuZCB7QGxpbmsgVGV4dHVyZSNjZW50ZXJ9LgoJCQkgKgoJCQkgKiBTZXQgdGhpcyB0byBgZmFsc2VgIGlmIHlvdSBhcmUgc3BlY2lmeWluZyB0aGUgdXYtdHJhbnNmb3JtIG1hdHJpeCBkaXJlY3RseS4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIHV2LXRyYW5zZm9ybWF0aW9uIG1hdHJpeCBvZiB0aGUgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge01hdHJpeDN9CgkJCSAqLwoJCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KCQkJICoKCQkJICogU2V0IHRoaXMgdG8gYGZhbHNlYCBpZiB5b3UgYXJlIGNyZWF0aW5nIG1pcG1hcHMgbWFudWFsbHkuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IHRydWU7CgoJCQkvKioKCQkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIGFscGhhIGNoYW5uZWwsIGlmIHByZXNlbnQsIGlzIG11bHRpcGxpZWQgaW50byB0aGUKCQkJICogY29sb3IgY2hhbm5lbHMgd2hlbiB0aGUgdGV4dHVyZSBpcyB1cGxvYWRlZCB0byB0aGUgR1BVLgoJCQkgKgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwcm9wZXJ0eSBoYXMgbm8gZWZmZWN0IHdoZW4gdXNpbmcgYEltYWdlQml0bWFwYC4gWW91IG5lZWQgdG8KCQkJICogY29uZmlndXJlIHByZW11bHRpcGx5IGFscGhhIG9uIGJpdG1hcCBjcmVhdGlvbiBpbnN0ZWFkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSB0ZXh0dXJlIGlzIGZsaXBwZWQgYWxvbmcgdGhlIHZlcnRpY2FsIGF4aXMgd2hlbgoJCQkgKiB1cGxvYWRlZCB0byB0aGUgR1BVLgoJCQkgKgoJCQkgKiBOb3RlIHRoYXQgdGhpcyBwcm9wZXJ0eSBoYXMgbm8gZWZmZWN0IHdoZW4gdXNpbmcgYEltYWdlQml0bWFwYC4gWW91IG5lZWQgdG8KCQkJICogY29uZmlndXJlIHRoZSBmbGlwIG9uIGJpdG1hcCBjcmVhdGlvbiBpbnN0ZWFkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5mbGlwWSA9IHRydWU7CgoJCQkvKioKCQkJICogU3BlY2lmaWVzIHRoZSBhbGlnbm1lbnQgcmVxdWlyZW1lbnRzIGZvciB0aGUgc3RhcnQgb2YgZWFjaCBwaXhlbCByb3cgaW4gbWVtb3J5LgoJCQkgKiBUaGUgYWxsb3dhYmxlIHZhbHVlcyBhcmUgYDFgIChieXRlLWFsaWdubWVudCksIGAyYCAocm93cyBhbGlnbmVkIHRvIGV2ZW4tbnVtYmVyZWQgYnl0ZXMpLAoJCQkgKiBgNGAgKHdvcmQtYWxpZ25tZW50KSwgYW5kIGA4YCAocm93cyBzdGFydCBvbiBkb3VibGUtd29yZCBib3VuZGFyaWVzKS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgNAoJCQkgKi8KCQkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSA0OwkvLyB2YWxpZCB2YWx1ZXM6IDEsIDIsIDQsIDggKHNlZSBodHRwOi8vd3d3Lmtocm9ub3Mub3JnL29wZW5nbGVzL3Nkay9kb2NzL21hbi94aHRtbC9nbFBpeGVsU3RvcmVpLnhtbCkKCgkJCS8qKgoJCQkgKiBUZXh0dXJlcyBjb250YWluaW5nIGNvbG9yIGRhdGEgc2hvdWxkIGJlIGFubm90YXRlZCB3aXRoIGBTUkdCQ29sb3JTcGFjZWAgb3IgYExpbmVhclNSR0JDb2xvclNwYWNlYC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQGRlZmF1bHQgTm9Db2xvclNwYWNlCgkJCSAqLwoJCQl0aGlzLmNvbG9yU3BhY2UgPSBjb2xvclNwYWNlOwoKCQkJLyoqCgkJCSAqIEFuIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIHN0b3JlIGN1c3RvbSBkYXRhIGFib3V0IHRoZSB0ZXh0dXJlLiBJdAoJCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkgKi8KCQkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCQkJLyoqCgkJCSAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gb25seSB1cGRhdGUgYSBzdWJyZWdpb24gb3Igc3BlY2lmaWMgcm93cyBvZiB0aGUgdGV4dHVyZSAoZm9yIGV4YW1wbGUsIGp1c3QgdGhlCgkJCSAqIGZpcnN0IDMgcm93cykuIFVzZSB0aGUgYGFkZFVwZGF0ZVJhbmdlKClgIGZ1bmN0aW9uIHRvIGFkZCByYW5nZXMgdG8gdGhpcyBhcnJheS4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PE9iamVjdD59CgkJCSAqLwoJCQl0aGlzLnVwZGF0ZVJhbmdlcyA9IFtdOwoKCQkJLyoqCgkJCSAqIFRoaXMgc3RhcnRzIGF0IGAwYCBhbmQgY291bnRzIGhvdyBtYW55IHRpbWVzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy52ZXJzaW9uID0gMDsKCgkJCS8qKgoJCQkgKiBBIGNhbGxiYWNrIGZ1bmN0aW9uLCBjYWxsZWQgd2hlbiB0aGUgdGV4dHVyZSBpcyB1cGRhdGVkIChlLmcuLCB3aGVuCgkJCSAqIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBoYXMgYmVlbiBzZXQgdG8gdHJ1ZSBhbmQgdGhlbiB0aGUgdGV4dHVyZSBpcyB1c2VkKS4KCQkJICoKCQkJICogQHR5cGUgez9GdW5jdGlvbn0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5vblVwZGF0ZSA9IG51bGw7CgoJCQkvKioKCQkJICogQW4gb3B0aW9uYWwgYmFjayByZWZlcmVuY2UgdG8gdGhlIHRleHR1cmVzIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KFJlbmRlclRhcmdldHxXZWJHTFJlbmRlclRhcmdldCl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMucmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBJbmRpY2F0ZXMgd2hldGhlciBhIHRleHR1cmUgYmVsb25ncyB0byBhIHJlbmRlciB0YXJnZXQgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIEluZGljYXRlcyBpZiBhIHRleHR1cmUgc2hvdWxkIGJlIGhhbmRsZWQgbGlrZSBhIHRleHR1cmUgYXJyYXkuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuaXNBcnJheVRleHR1cmUgPSBpbWFnZSAmJiBpbWFnZS5kZXB0aCAmJiBpbWFnZS5kZXB0aCA+IDEgPyB0cnVlIDogZmFsc2U7CgoJCQkvKioKCQkJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhpcyB0ZXh0dXJlIHNob3VsZCBiZSBwcm9jZXNzZWQgYnkgYFBNUkVNR2VuZXJhdG9yYCBvciBub3QKCQkJICogKG9ubHkgcmVsZXZhbnQgZm9yIHJlbmRlciB0YXJnZXQgdGV4dHVyZXMpLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5wbXJlbVZlcnNpb24gPSAwOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCgkJICovCgkJZ2V0IHdpZHRoKCkgewoKCQkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLng7CgoJCX0KCgkJLyoqCgkJICogVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCgkJICovCgkJZ2V0IGhlaWdodCgpIHsKCgkJCXJldHVybiB0aGlzLnNvdXJjZS5nZXRTaXplKCBfdGVtcFZlYzMgKS55OwoKCQl9CgoJCS8qKgoJCSAqIFRoZSBkZXB0aCBvZiB0aGUgdGV4dHVyZSBpbiBwaXhlbHMuCgkJICovCgkJZ2V0IGRlcHRoKCkgewoKCQkJcmV0dXJuIHRoaXMuc291cmNlLmdldFNpemUoIF90ZW1wVmVjMyApLno7CgoJCX0KCgkJLyoqCgkJICogVGhlIGltYWdlIG9iamVjdCBob2xkaW5nIHRoZSB0ZXh0dXJlIGRhdGEuCgkJICoKCQkgKiBAdHlwZSB7P09iamVjdH0KCQkgKi8KCQlnZXQgaW1hZ2UoKSB7CgoJCQlyZXR1cm4gdGhpcy5zb3VyY2UuZGF0YTsKCgkJfQoKCQlzZXQgaW1hZ2UoIHZhbHVlID0gbnVsbCApIHsKCgkJCXRoaXMuc291cmNlLmRhdGEgPSB2YWx1ZTsKCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSB0ZXh0dXJlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBmcm9tIHRoZSBmcm9tIHRoZSBwcm9wZXJ0aWVzIHtAbGluayBUZXh0dXJlI29mZnNldH0sCgkJICoge0BsaW5rIFRleHR1cmUjcmVwZWF0fSwge0BsaW5rIFRleHR1cmUjcm90YXRpb259LCBhbmQge0BsaW5rIFRleHR1cmUjY2VudGVyfS4KCQkgKi8KCQl1cGRhdGVNYXRyaXgoKSB7CgoJCQl0aGlzLm1hdHJpeC5zZXRVdlRyYW5zZm9ybSggdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSwgdGhpcy5yZXBlYXQueCwgdGhpcy5yZXBlYXQueSwgdGhpcy5yb3RhdGlvbiwgdGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSApOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgYSByYW5nZSBvZiBkYXRhIGluIHRoZSBkYXRhIHRleHR1cmUgdG8gYmUgdXBkYXRlZCBvbiB0aGUgR1BVLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gUG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgdXBkYXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIFRoZSBudW1iZXIgb2YgY29tcG9uZW50cyB0byB1cGRhdGUuCgkJICovCgkJYWRkVXBkYXRlUmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCgkJfQoKCQkvKioKCQkgKiBDbGVhcnMgdGhlIHVwZGF0ZSByYW5nZXMuCgkJICovCgkJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgoJCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgdGV4dHVyZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7VGV4dHVyZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiB0ZXh0dXJlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1RleHR1cmV9IHNvdXJjZSAtIFRoZSB0ZXh0dXJlIHRvIGNvcHkuCgkJICogQHJldHVybiB7VGV4dHVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljb3B5KCBzb3VyY2UgKSB7CgoJCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCgkJCXRoaXMuc291cmNlID0gc291cmNlLnNvdXJjZTsKCQkJdGhpcy5taXBtYXBzID0gc291cmNlLm1pcG1hcHMuc2xpY2UoIDAgKTsKCgkJCXRoaXMubWFwcGluZyA9IHNvdXJjZS5tYXBwaW5nOwoJCQl0aGlzLmNoYW5uZWwgPSBzb3VyY2UuY2hhbm5lbDsKCgkJCXRoaXMud3JhcFMgPSBzb3VyY2Uud3JhcFM7CgkJCXRoaXMud3JhcFQgPSBzb3VyY2Uud3JhcFQ7CgoJCQl0aGlzLm1hZ0ZpbHRlciA9IHNvdXJjZS5tYWdGaWx0ZXI7CgkJCXRoaXMubWluRmlsdGVyID0gc291cmNlLm1pbkZpbHRlcjsKCgkJCXRoaXMuYW5pc290cm9weSA9IHNvdXJjZS5hbmlzb3Ryb3B5OwoKCQkJdGhpcy5mb3JtYXQgPSBzb3VyY2UuZm9ybWF0OwoJCQl0aGlzLmludGVybmFsRm9ybWF0ID0gc291cmNlLmludGVybmFsRm9ybWF0OwoJCQl0aGlzLnR5cGUgPSBzb3VyY2UudHlwZTsKCgkJCXRoaXMub2Zmc2V0LmNvcHkoIHNvdXJjZS5vZmZzZXQgKTsKCQkJdGhpcy5yZXBlYXQuY29weSggc291cmNlLnJlcGVhdCApOwoJCQl0aGlzLmNlbnRlci5jb3B5KCBzb3VyY2UuY2VudGVyICk7CgkJCXRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCQkJdGhpcy5tYXRyaXguY29weSggc291cmNlLm1hdHJpeCApOwoKCQkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBzb3VyY2UuZ2VuZXJhdGVNaXBtYXBzOwoJCQl0aGlzLnByZW11bHRpcGx5QWxwaGEgPSBzb3VyY2UucHJlbXVsdGlwbHlBbHBoYTsKCQkJdGhpcy5mbGlwWSA9IHNvdXJjZS5mbGlwWTsKCQkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSBzb3VyY2UudW5wYWNrQWxpZ25tZW50OwoJCQl0aGlzLmNvbG9yU3BhY2UgPSBzb3VyY2UuY29sb3JTcGFjZTsKCgkJCXRoaXMucmVuZGVyVGFyZ2V0ID0gc291cmNlLnJlbmRlclRhcmdldDsKCQkJdGhpcy5pc1JlbmRlclRhcmdldFRleHR1cmUgPSBzb3VyY2UuaXNSZW5kZXJUYXJnZXRUZXh0dXJlOwoJCQl0aGlzLmlzQXJyYXlUZXh0dXJlID0gc291cmNlLmlzQXJyYXlUZXh0dXJlOwoKCQkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgdGV4dHVyZSdzIHByb3BlcnRpZXMgYmFzZWQgb24gYHZhbHVlc2AuCgkJICogQHBhcmFtIHtPYmplY3R9IHZhbHVlcyAtIEEgY29udGFpbmVyIHdpdGggdGV4dHVyZSBwYXJhbWV0ZXJzLgoJCSAqLwoJCXNldFZhbHVlcyggdmFsdWVzICkgewoKCQkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCgkJCQljb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1sga2V5IF07CgoJCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5UZXh0dXJlLnNldFZhbHVlcygpOiBwYXJhbWV0ZXIgJyR7IGtleSB9JyBoYXMgdmFsdWUgb2YgdW5kZWZpbmVkLmAgKTsKCQkJCQljb250aW51ZTsKCgkJCQl9CgoJCQkJY29uc3QgY3VycmVudFZhbHVlID0gdGhpc1sga2V5IF07CgoJCQkJaWYgKCBjdXJyZW50VmFsdWUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCBgVEhSRUUuVGV4dHVyZS5zZXRWYWx1ZXMoKTogcHJvcGVydHkgJyR7IGtleSB9JyBkb2VzIG5vdCBleGlzdC5gICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWlmICggKCBjdXJyZW50VmFsdWUgJiYgbmV3VmFsdWUgKSAmJiAoIGN1cnJlbnRWYWx1ZS5pc1ZlY3RvcjIgJiYgbmV3VmFsdWUuaXNWZWN0b3IyICkgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKCQkJCX0gZWxzZSBpZiAoICggY3VycmVudFZhbHVlICYmIG5ld1ZhbHVlICkgJiYgKCBjdXJyZW50VmFsdWUuaXNWZWN0b3IzICYmIG5ld1ZhbHVlLmlzVmVjdG9yMyApICkgewoKCQkJCQljdXJyZW50VmFsdWUuY29weSggbmV3VmFsdWUgKTsKCgkJCQl9IGVsc2UgaWYgKCAoIGN1cnJlbnRWYWx1ZSAmJiBuZXdWYWx1ZSApICYmICggY3VycmVudFZhbHVlLmlzTWF0cml4MyAmJiBuZXdWYWx1ZS5pc01hdHJpeDMgKSApIHsKCgkJCQkJY3VycmVudFZhbHVlLmNvcHkoIG5ld1ZhbHVlICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGhpc1sga2V5IF0gPSBuZXdWYWx1ZTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogU2VyaWFsaXplcyB0aGUgdGV4dHVyZSBpbnRvIEpTT04uCgkJICoKCQkgKiBAcGFyYW0gez8oT2JqZWN0fHN0cmluZyl9IG1ldGEgLSBBbiBvcHRpb25hbCB2YWx1ZSBob2xkaW5nIG1ldGEgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNlcmlhbGl6YXRpb24uCgkJICogQHJldHVybiB7T2JqZWN0fSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCB0ZXh0dXJlLgoJCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KCQkgKi8KCQl0b0pTT04oIG1ldGEgKSB7CgoJCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJCWlmICggISBpc1Jvb3RPYmplY3QgJiYgbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZXR1cm4gbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF07CgoJCQl9CgoJCQljb25zdCBvdXRwdXQgPSB7CgoJCQkJbWV0YWRhdGE6IHsKCQkJCQl2ZXJzaW9uOiA0LjcsCgkJCQkJdHlwZTogJ1RleHR1cmUnLAoJCQkJCWdlbmVyYXRvcjogJ1RleHR1cmUudG9KU09OJwoJCQkJfSwKCgkJCQl1dWlkOiB0aGlzLnV1aWQsCgkJCQluYW1lOiB0aGlzLm5hbWUsCgoJCQkJaW1hZ2U6IHRoaXMuc291cmNlLnRvSlNPTiggbWV0YSApLnV1aWQsCgoJCQkJbWFwcGluZzogdGhpcy5tYXBwaW5nLAoJCQkJY2hhbm5lbDogdGhpcy5jaGFubmVsLAoKCQkJCXJlcGVhdDogWyB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55IF0sCgkJCQlvZmZzZXQ6IFsgdGhpcy5vZmZzZXQueCwgdGhpcy5vZmZzZXQueSBdLAoJCQkJY2VudGVyOiBbIHRoaXMuY2VudGVyLngsIHRoaXMuY2VudGVyLnkgXSwKCQkJCXJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAoKCQkJCXdyYXA6IFsgdGhpcy53cmFwUywgdGhpcy53cmFwVCBdLAoKCQkJCWZvcm1hdDogdGhpcy5mb3JtYXQsCgkJCQlpbnRlcm5hbEZvcm1hdDogdGhpcy5pbnRlcm5hbEZvcm1hdCwKCQkJCXR5cGU6IHRoaXMudHlwZSwKCQkJCWNvbG9yU3BhY2U6IHRoaXMuY29sb3JTcGFjZSwKCgkJCQltaW5GaWx0ZXI6IHRoaXMubWluRmlsdGVyLAoJCQkJbWFnRmlsdGVyOiB0aGlzLm1hZ0ZpbHRlciwKCQkJCWFuaXNvdHJvcHk6IHRoaXMuYW5pc290cm9weSwKCgkJCQlmbGlwWTogdGhpcy5mbGlwWSwKCgkJCQlnZW5lcmF0ZU1pcG1hcHM6IHRoaXMuZ2VuZXJhdGVNaXBtYXBzLAoJCQkJcHJlbXVsdGlwbHlBbHBoYTogdGhpcy5wcmVtdWx0aXBseUFscGhhLAoJCQkJdW5wYWNrQWxpZ25tZW50OiB0aGlzLnVucGFja0FsaWdubWVudAoKCQkJfTsKCgkJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb3V0cHV0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgoJCQkJbWV0YS50ZXh0dXJlc1sgdGhpcy51dWlkIF0gPSBvdXRwdXQ7CgoJCQl9CgoJCQlyZXR1cm4gb3V0cHV0OwoKCQl9CgoJCS8qKgoJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwoJCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgoJCSAqCgkJICogQGZpcmVzIFRleHR1cmUjZGlzcG9zZQoJCSAqLwoJCWRpc3Bvc2UoKSB7CgoJCQkvKioKCQkJICogRmlyZXMgd2hlbiB0aGUgdGV4dHVyZSBoYXMgYmVlbiBkaXNwb3NlZCBvZi4KCQkJICoKCQkJICogQGV2ZW50IFRleHR1cmUjZGlzcG9zZQoJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkgKi8KCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJCX0KCgkJLyoqCgkJICogVHJhbnNmb3JtcyB0aGUgZ2l2ZW4gdXYgdmVjdG9yIHdpdGggdGhlIHRleHR1cmVzIHV2IHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdXYgLSBUaGUgdXYgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IFRoZSB0cmFuc2Zvcm1lZCB1diB2ZWN0b3IuCgkJICovCgkJdHJhbnNmb3JtVXYoIHV2ICkgewoKCQkJaWYgKCB0aGlzLm1hcHBpbmcgIT09IFVWTWFwcGluZyApIHJldHVybiB1djsKCgkJCXV2LmFwcGx5TWF0cml4MyggdGhpcy5tYXRyaXggKTsKCgkJCWlmICggdXYueCA8IDAgfHwgdXYueCA+IDEgKSB7CgoJCQkJc3dpdGNoICggdGhpcy53cmFwUyApIHsKCgkJCQkJY2FzZSBSZXBlYXRXcmFwcGluZzoKCgkJCQkJCXV2LnggPSB1di54IC0gTWF0aC5mbG9vciggdXYueCApOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBDbGFtcFRvRWRnZVdyYXBwaW5nOgoKCQkJCQkJdXYueCA9IHV2LnggPCAwID8gMCA6IDE7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6CgoJCQkJCQlpZiAoIE1hdGguYWJzKCBNYXRoLmZsb29yKCB1di54ICkgJSAyICkgPT09IDEgKSB7CgoJCQkJCQkJdXYueCA9IE1hdGguY2VpbCggdXYueCApIC0gdXYueDsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJdXYueCA9IHV2LnggLSBNYXRoLmZsb29yKCB1di54ICk7CgoJCQkJCQl9CgoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHV2LnkgPCAwIHx8IHV2LnkgPiAxICkgewoKCQkJCXN3aXRjaCAoIHRoaXMud3JhcFQgKSB7CgoJCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgoJCQkJCQl1di55ID0gdXYueSAtIE1hdGguZmxvb3IoIHV2LnkgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCgkJCQkJCXV2LnkgPSB1di55IDwgMCA/IDAgOiAxOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKCQkJCQkJaWYgKCBNYXRoLmFicyggTWF0aC5mbG9vciggdXYueSApICUgMiApID09PSAxICkgewoKCQkJCQkJCXV2LnkgPSBNYXRoLmNlaWwoIHV2LnkgKSAtIHV2Lnk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXV2LnkgPSB1di55IC0gTWF0aC5mbG9vciggdXYueSApOwoKCQkJCQkJfQoKCQkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLmZsaXBZICkgewoKCQkJCXV2LnkgPSAxIC0gdXYueTsKCgkJCX0KCgkJCXJldHVybiB1djsKCgkJfQoKCQkvKioKCQkgKiBTZXR0aW5nIHRoaXMgcHJvcGVydHkgdG8gYHRydWVgIGluZGljYXRlcyB0aGUgZW5naW5lIHRoZSB0ZXh0dXJlCgkJICogbXVzdCBiZSB1cGRhdGVkIGluIHRoZSBuZXh0IHJlbmRlci4gVGhpcyB0cmlnZ2VycyBhIHRleHR1cmUgdXBsb2FkCgkJICogdG8gdGhlIEdQVSBhbmQgZW5zdXJlcyBjb3JyZWN0IHRleHR1cmUgcGFyYW1ldGVyIGNvbmZpZ3VyYXRpb24uCgkJICoKCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkgKiBAZGVmYXVsdCBmYWxzZQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUKCQkgKi8KCQlzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCgkJCQl0aGlzLnZlcnNpb24gKys7CgkJCQl0aGlzLnNvdXJjZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogU2V0dGluZyB0aGlzIHByb3BlcnR5IHRvIGB0cnVlYCBpbmRpY2F0ZXMgdGhlIGVuZ2luZSB0aGUgUE1SRU0KCQkgKiBtdXN0IGJlIHJlZ2VuZXJhdGVkLgoJCSAqCgkJICogQHR5cGUge2Jvb2xlYW59CgkJICogQGRlZmF1bHQgZmFsc2UKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCgkJICovCgkJc2V0IG5lZWRzUE1SRU1VcGRhdGUoIHZhbHVlICkgewoKCQkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHsKCgkJCQl0aGlzLnBtcmVtVmVyc2lvbiArKzsKCgkJCX0KCgkJfQoKCX0KCgkvKioKCSAqIFRoZSBkZWZhdWx0IGltYWdlIGZvciBhbGwgdGV4dHVyZXMuCgkgKgoJICogQHN0YXRpYwoJICogQHR5cGUgez9JbWFnZX0KCSAqIEBkZWZhdWx0IG51bGwKCSAqLwoJVGV4dHVyZS5ERUZBVUxUX0lNQUdFID0gbnVsbDsKCgkvKioKCSAqIFRoZSBkZWZhdWx0IG1hcHBpbmcgZm9yIGFsbCB0ZXh0dXJlcy4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7bnVtYmVyfQoJICogQGRlZmF1bHQgVVZNYXBwaW5nCgkgKi8KCVRleHR1cmUuREVGQVVMVF9NQVBQSU5HID0gVVZNYXBwaW5nOwoKCS8qKgoJICogVGhlIGRlZmF1bHQgYW5pc290cm9weSB2YWx1ZSBmb3IgYWxsIHRleHR1cmVzLgoJICoKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtudW1iZXJ9CgkgKiBAZGVmYXVsdCAxCgkgKi8KCVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZID0gMTsKCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyBhIDREIHZlY3Rvci4gQSA0RCB2ZWN0b3IgaXMgYW4gb3JkZXJlZCBxdWFkcnVwbGV0IG9mIG51bWJlcnMKCSAqIChsYWJlbGVkIHgsIHksIHogYW5kIHcpLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXByZXNlbnQgYSBudW1iZXIgb2YgdGhpbmdzLCBzdWNoIGFzOgoJICoKCSAqIC0gQSBwb2ludCBpbiA0RCBzcGFjZS4KCSAqIC0gQSBkaXJlY3Rpb24gYW5kIGxlbmd0aCBpbiA0RCBzcGFjZS4gSW4gdGhyZWUuanMgdGhlIGxlbmd0aCB3aWxsCgkgKiBhbHdheXMgYmUgdGhlIEV1Y2xpZGVhbiBkaXN0YW5jZShzdHJhaWdodC1saW5lIGRpc3RhbmNlKSBmcm9tIGAoMCwgMCwgMCwgMClgIHRvIGAoeCwgeSwgeiwgdylgCgkgKiBhbmQgdGhlIGRpcmVjdGlvbiBpcyBhbHNvIG1lYXN1cmVkIGZyb20gYCgwLCAwLCAwLCAwKWAgdG93YXJkcyBgKHgsIHksIHosIHcpYC4KCSAqIC0gQW55IGFyYml0cmFyeSBvcmRlcmVkIHF1YWRydXBsZXQgb2YgbnVtYmVycy4KCSAqCgkgKiBUaGVyZSBhcmUgb3RoZXIgdGhpbmdzIGEgNEQgdmVjdG9yIGNhbiBiZSB1c2VkIHRvIHJlcHJlc2VudCwgaG93ZXZlciB0aGVzZQoJICogYXJlIHRoZSBtb3N0IGNvbW1vbiB1c2VzIGluICp0aHJlZS5qcyouCgkgKgoJICogSXRlcmF0aW5nIHRocm91Z2ggYSB2ZWN0b3IgaW5zdGFuY2Ugd2lsbCB5aWVsZCBpdHMgY29tcG9uZW50cyBgKHgsIHksIHosIHcpYCBpbgoJICogdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuCgkgKiBgYGBqcwoJICogY29uc3QgYSA9IG5ldyBUSFJFRS5WZWN0b3I0KCAwLCAxLCAwLCAwICk7CgkgKgoJICogLy9ubyBhcmd1bWVudHM7IHdpbGwgYmUgaW5pdGlhbGlzZWQgdG8gKDAsIDAsIDAsIDEpCgkgKiBjb25zdCBiID0gbmV3IFRIUkVFLlZlY3RvcjQoICk7CgkgKgoJICogY29uc3QgZCA9IGEuZG90KCBiICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgVmVjdG9yNCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgNEQgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt5PTBdIC0gVGhlIHkgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt6PTBdIC0gVGhlIHogdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3PTFdIC0gVGhlIHcgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJICovCgkJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCVZlY3RvcjQucHJvdG90eXBlLmlzVmVjdG9yNCA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIHggdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnggPSB4OwoKCQkJLyoqCgkJCSAqIFRoZSB5IHZhbHVlIG9mIHRoaXMgdmVjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy55ID0geTsKCgkJCS8qKgoJCQkgKiBUaGUgeiB2YWx1ZSBvZiB0aGlzIHZlY3Rvci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMueiA9IHo7CgoJCQkvKioKCQkJICogVGhlIHcgdmFsdWUgb2YgdGhpcyB2ZWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLncgPSB3OwoKCQl9CgoJCS8qKgoJCSAqIEFsaWFzIGZvciB7QGxpbmsgVmVjdG9yNCN6fS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICovCgkJZ2V0IHdpZHRoKCkgewoKCQkJcmV0dXJuIHRoaXMuejsKCgkJfQoKCQlzZXQgd2lkdGgoIHZhbHVlICkgewoKCQkJdGhpcy56ID0gdmFsdWU7CgoJCX0KCgkJLyoqCgkJICogQWxpYXMgZm9yIHtAbGluayBWZWN0b3I0I3d9LgoJCSAqCgkJICogQHR5cGUge251bWJlcn0KCQkgKi8KCQlnZXQgaGVpZ2h0KCkgewoKCQkJcmV0dXJuIHRoaXMudzsKCgkJfQoKCQlzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCgkJCXRoaXMudyA9IHZhbHVlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgb2YgdGhlIHggY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIG9mIHRoZSB5IGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBvZiB0aGUgeiBjb21wb25lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgb2YgdGhlIHcgY29tcG9uZW50LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldCggeCwgeSwgeiwgdyApIHsKCgkJCXRoaXMueCA9IHg7CgkJCXRoaXMueSA9IHk7CgkJCXRoaXMueiA9IHo7CgkJCXRoaXMudyA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IgY29tcG9uZW50cyB0byB0aGUgc2FtZSB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgdmFsdWUgdG8gc2V0IGZvciBhbGwgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnggPSBzY2FsYXI7CgkJCXRoaXMueSA9IHNjYWxhcjsKCQkJdGhpcy56ID0gc2NhbGFyOwoJCQl0aGlzLncgPSBzY2FsYXI7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB4IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRYKCB4ICkgewoKCQkJdGhpcy54ID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvcidzIHkgY29tcG9uZW50IHRvIHRoZSBnaXZlbiB2YWx1ZQoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldFkoIHkgKSB7CgoJCQl0aGlzLnkgPSB5OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdmVjdG9yJ3MgeiBjb21wb25lbnQgdG8gdGhlIGdpdmVuIHZhbHVlCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0WiggeiApIHsKCgkJCXRoaXMueiA9IHo7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2ZWN0b3IncyB3IGNvbXBvbmVudCB0byB0aGUgZ2l2ZW4gdmFsdWUKCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRXKCB3ICkgewoKCQkJdGhpcy53ID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFsbG93cyB0byBzZXQgYSB2ZWN0b3IgY29tcG9uZW50IHdpdGggYW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwKCQkgKiBgMmAgZXF1YWxzIHRvIHosIGAzYCBlcXVhbHMgdG8gdy4KCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXNldENvbXBvbmVudCggaW5kZXgsIHZhbHVlICkgewoKCQkJc3dpdGNoICggaW5kZXggKSB7CgoJCQkJY2FzZSAwOiB0aGlzLnggPSB2YWx1ZTsgYnJlYWs7CgkJCQljYXNlIDE6IHRoaXMueSA9IHZhbHVlOyBicmVhazsKCQkJCWNhc2UgMjogdGhpcy56ID0gdmFsdWU7IGJyZWFrOwoJCQkJY2FzZSAzOiB0aGlzLncgPSB2YWx1ZTsgYnJlYWs7CgkJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIHZlY3RvciBjb21wb25lbnQgd2hpY2ggbWF0Y2hlcyB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgY29tcG9uZW50IGluZGV4LiBgMGAgZXF1YWxzIHRvIHgsIGAxYCBlcXVhbHMgdG8geSwKCQkgKiBgMmAgZXF1YWxzIHRvIHosIGAzYCBlcXVhbHMgdG8gdy4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IEEgdmVjdG9yIGNvbXBvbmVudCB2YWx1ZS4KCQkgKi8KCQlnZXRDb21wb25lbnQoIGluZGV4ICkgewoKCQkJc3dpdGNoICggaW5kZXggKSB7CgoJCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwoJCQkJY2FzZSAxOiByZXR1cm4gdGhpcy55OwoJCQkJY2FzZSAyOiByZXR1cm4gdGhpcy56OwoJCQkJY2FzZSAzOiByZXR1cm4gdGhpcy53OwoJCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IHZlY3RvciB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdmVjdG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN8VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljb3B5KCB2ICkgewoKCQkJdGhpcy54ID0gdi54OwoJCQl0aGlzLnkgPSB2Lnk7CgkJCXRoaXMueiA9IHYuejsKCQkJdGhpcy53ID0gKCB2LncgIT09IHVuZGVmaW5lZCApID8gdi53IDogMTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvciB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBhZGQuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJYWRkKCB2ICkgewoKCQkJdGhpcy54ICs9IHYueDsKCQkJdGhpcy55ICs9IHYueTsKCQkJdGhpcy56ICs9IHYuejsKCQkJdGhpcy53ICs9IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB0byBhbGwgY29tcG9uZW50cyBvZiB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyIHRvIGFkZC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGRTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnggKz0gczsKCQkJdGhpcy55ICs9IHM7CgkJCXRoaXMueiArPSBzOwoJCQl0aGlzLncgKz0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIGdpdmVuIHZlY3RvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IGEgLSBUaGUgZmlyc3QgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gYiAtIFRoZSBzZWNvbmQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCQl0aGlzLnggPSBhLnggKyBiLng7CgkJCXRoaXMueSA9IGEueSArIGIueTsKCQkJdGhpcy56ID0gYS56ICsgYi56OwoJCQl0aGlzLncgPSBhLncgKyBiLnc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiB2ZWN0b3Igc2NhbGVkIGJ5IHRoZSBnaXZlbiBmYWN0b3IgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgZmFjdG9yIHRoYXQgc2NhbGVzIGB2YC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlhZGRTY2FsZWRWZWN0b3IoIHYsIHMgKSB7CgoJCQl0aGlzLnggKz0gdi54ICogczsKCQkJdGhpcy55ICs9IHYueSAqIHM7CgkJCXRoaXMueiArPSB2LnogKiBzOwoJCQl0aGlzLncgKz0gdi53ICogczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gc3VidHJhY3QuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc3ViKCB2ICkgewoKCQkJdGhpcy54IC09IHYueDsKCQkJdGhpcy55IC09IHYueTsKCQkJdGhpcy56IC09IHYuejsKCQkJdGhpcy53IC09IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIGZyb20gYWxsIGNvbXBvbmVudHMgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gVGhlIHNjYWxhciB0byBzdWJ0cmFjdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzdWJTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnggLT0gczsKCQkJdGhpcy55IC09IHM7CgkJCXRoaXMueiAtPSBzOwoJCQl0aGlzLncgLT0gczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFN1YnRyYWN0cyB0aGUgZ2l2ZW4gdmVjdG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gYSAtIFRoZSBmaXJzdCB2ZWN0b3IuCgkJICogQHBhcmFtIHtWZWN0b3I0fSBiIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc3ViVmVjdG9ycyggYSwgYiApIHsKCgkJCXRoaXMueCA9IGEueCAtIGIueDsKCQkJdGhpcy55ID0gYS55IC0gYi55OwoJCQl0aGlzLnogPSBhLnogLSBiLno7CgkJCXRoaXMudyA9IGEudyAtIGIudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIG11bHRpcGx5LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW11bHRpcGx5KCB2ICkgewoKCQkJdGhpcy54ICo9IHYueDsKCQkJdGhpcy55ICo9IHYueTsKCQkJdGhpcy56ICo9IHYuejsKCQkJdGhpcy53ICo9IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIGFsbCBjb21wb25lbnRzIG9mIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB0byBtdWx0aXBseS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy54ICo9IHNjYWxhcjsKCQkJdGhpcy55ICo9IHNjYWxhcjsKCQkJdGhpcy56ICo9IHNjYWxhcjsKCQkJdGhpcy53ICo9IHNjYWxhcjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhpcyB2ZWN0b3Igd2l0aCB0aGUgZ2l2ZW4gNHg0IG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSA0eDQgbWF0cml4LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbSApIHsKCgkJCWNvbnN0IHggPSB0aGlzLngsIHkgPSB0aGlzLnksIHogPSB0aGlzLnosIHcgPSB0aGlzLnc7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6ICsgZVsgMTIgXSAqIHc7CgkJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogeiArIGVbIDEzIF0gKiB3OwoJCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSAqIHc7CgkJCXRoaXMudyA9IGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICogdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyBpbnN0YW5jZSBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3RvciB0byBkaXZpZGUuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZGl2aWRlKCB2ICkgewoKCQkJdGhpcy54IC89IHYueDsKCQkJdGhpcy55IC89IHYueTsKCQkJdGhpcy56IC89IHYuejsKCQkJdGhpcy53IC89IHYudzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIERpdmlkZXMgdGhpcyB2ZWN0b3IgYnkgdGhlIGdpdmVuIHNjYWxhci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzY2FsYXIgLSBUaGUgc2NhbGFyIHRvIGRpdmlkZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlkaXZpZGVTY2FsYXIoIHNjYWxhciApIHsKCgkJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgeCwgeSBhbmQgeiBjb21wb25lbnRzIG9mIHRoaXMKCQkgKiB2ZWN0b3IgdG8gdGhlIHF1YXRlcm5pb24ncyBheGlzIGFuZCB3IHRvIHRoZSBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7UXVhdGVybmlvbn0gcSAtIFRoZSBRdWF0ZXJuaW9uIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRBeGlzQW5nbGVGcm9tUXVhdGVybmlvbiggcSApIHsKCgkJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9xdWF0ZXJuaW9uVG9BbmdsZS9pbmRleC5odG0KCgkJCS8vIHEgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCQl0aGlzLncgPSAyICogTWF0aC5hY29zKCBxLncgKTsKCgkJCWNvbnN0IHMgPSBNYXRoLnNxcnQoIDEgLSBxLncgKiBxLncgKTsKCgkJCWlmICggcyA8IDAuMDAwMSApIHsKCgkJCQl0aGlzLnggPSAxOwoJCQkJdGhpcy55ID0gMDsKCQkJCXRoaXMueiA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMueCA9IHEueCAvIHM7CgkJCQl0aGlzLnkgPSBxLnkgLyBzOwoJCQkJdGhpcy56ID0gcS56IC8gczsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHgsIHkgYW5kIHogY29tcG9uZW50cyBvZiB0aGlzCgkJICogdmVjdG9yIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uIGFuZCB3IHRvIHRoZSBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEEgNHg0IG1hdHJpeCBvZiB3aGljaCB0aGUgdXBwZXIgbGVmdCAzeDMgbWF0cml4IGlzIGEgcHVyZSByb3RhdGlvbiBtYXRyaXguCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJc2V0QXhpc0FuZ2xlRnJvbVJvdGF0aW9uTWF0cml4KCBtICkgewoKCQkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL21hdHJpeFRvQW5nbGUvaW5kZXguaHRtCgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJbGV0IGFuZ2xlLCB4LCB5LCB6OyAvLyB2YXJpYWJsZXMgZm9yIHJlc3VsdAoJCQljb25zdCBlcHNpbG9uID0gMC4wMSwJCS8vIG1hcmdpbiB0byBhbGxvdyBmb3Igcm91bmRpbmcgZXJyb3JzCgkJCQllcHNpbG9uMiA9IDAuMSwJCS8vIG1hcmdpbiB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIDAgYW5kIDE4MCBkZWdyZWVzCgoJCQkJdGUgPSBtLmVsZW1lbnRzLAoKCQkJCW0xMSA9IHRlWyAwIF0sIG0xMiA9IHRlWyA0IF0sIG0xMyA9IHRlWyA4IF0sCgkJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF07CgoJCQlpZiAoICggTWF0aC5hYnMoIG0xMiAtIG0yMSApIDwgZXBzaWxvbiApICYmCgkJCSAgICAgKCBNYXRoLmFicyggbTEzIC0gbTMxICkgPCBlcHNpbG9uICkgJiYKCQkJICAgICAoIE1hdGguYWJzKCBtMjMgLSBtMzIgKSA8IGVwc2lsb24gKSApIHsKCgkJCQkvLyBzaW5ndWxhcml0eSBmb3VuZAoJCQkJLy8gZmlyc3QgY2hlY2sgZm9yIGlkZW50aXR5IG1hdHJpeCB3aGljaCBtdXN0IGhhdmUgKzEgZm9yIGFsbCB0ZXJtcwoJCQkJLy8gaW4gbGVhZGluZyBkaWFnb25hbCBhbmQgemVybyBpbiBvdGhlciB0ZXJtcwoKCQkJCWlmICggKCBNYXRoLmFicyggbTEyICsgbTIxICkgPCBlcHNpbG9uMiApICYmCgkJCQkgICAgICggTWF0aC5hYnMoIG0xMyArIG0zMSApIDwgZXBzaWxvbjIgKSAmJgoJCQkJICAgICAoIE1hdGguYWJzKCBtMjMgKyBtMzIgKSA8IGVwc2lsb24yICkgJiYKCQkJCSAgICAgKCBNYXRoLmFicyggbTExICsgbTIyICsgbTMzIC0gMyApIDwgZXBzaWxvbjIgKSApIHsKCgkJCQkJLy8gdGhpcyBzaW5ndWxhcml0eSBpcyBpZGVudGl0eSBtYXRyaXggc28gYW5nbGUgPSAwCgoJCQkJCXRoaXMuc2V0KCAxLCAwLCAwLCAwICk7CgoJCQkJCXJldHVybiB0aGlzOyAvLyB6ZXJvIGFuZ2xlLCBhcmJpdHJhcnkgYXhpcwoKCQkJCX0KCgkJCQkvLyBvdGhlcndpc2UgdGhpcyBzaW5ndWxhcml0eSBpcyBhbmdsZSA9IDE4MAoKCQkJCWFuZ2xlID0gTWF0aC5QSTsKCgkJCQljb25zdCB4eCA9ICggbTExICsgMSApIC8gMjsKCQkJCWNvbnN0IHl5ID0gKCBtMjIgKyAxICkgLyAyOwoJCQkJY29uc3QgenogPSAoIG0zMyArIDEgKSAvIDI7CgkJCQljb25zdCB4eSA9ICggbTEyICsgbTIxICkgLyA0OwoJCQkJY29uc3QgeHogPSAoIG0xMyArIG0zMSApIC8gNDsKCQkJCWNvbnN0IHl6ID0gKCBtMjMgKyBtMzIgKSAvIDQ7CgoJCQkJaWYgKCAoIHh4ID4geXkgKSAmJiAoIHh4ID4genogKSApIHsKCgkJCQkJLy8gbTExIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQkJaWYgKCB4eCA8IGVwc2lsb24gKSB7CgoJCQkJCQl4ID0gMDsKCQkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl4ID0gTWF0aC5zcXJ0KCB4eCApOwoJCQkJCQl5ID0geHkgLyB4OwoJCQkJCQl6ID0geHogLyB4OwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggeXkgPiB6eiApIHsKCgkJCQkJLy8gbTIyIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQkJaWYgKCB5eSA8IGVwc2lsb24gKSB7CgoJCQkJCQl4ID0gMC43MDcxMDY3ODE7CgkJCQkJCXkgPSAwOwoJCQkJCQl6ID0gMC43MDcxMDY3ODE7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl5ID0gTWF0aC5zcXJ0KCB5eSApOwoJCQkJCQl4ID0geHkgLyB5OwoJCQkJCQl6ID0geXogLyB5OwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gbTMzIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0gc28gYmFzZSByZXN1bHQgb24gdGhpcwoKCQkJCQlpZiAoIHp6IDwgZXBzaWxvbiApIHsKCgkJCQkJCXggPSAwLjcwNzEwNjc4MTsKCQkJCQkJeSA9IDAuNzA3MTA2NzgxOwoJCQkJCQl6ID0gMDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXogPSBNYXRoLnNxcnQoIHp6ICk7CgkJCQkJCXggPSB4eiAvIHo7CgkJCQkJCXkgPSB5eiAvIHo7CgoJCQkJCX0KCgkJCQl9CgoJCQkJdGhpcy5zZXQoIHgsIHksIHosIGFuZ2xlICk7CgoJCQkJcmV0dXJuIHRoaXM7IC8vIHJldHVybiAxODAgZGVnIHJvdGF0aW9uCgoJCQl9CgoJCQkvLyBhcyB3ZSBoYXZlIHJlYWNoZWQgaGVyZSB0aGVyZSBhcmUgbm8gc2luZ3VsYXJpdGllcyBzbyB3ZSBjYW4gaGFuZGxlIG5vcm1hbGx5CgoJCQlsZXQgcyA9IE1hdGguc3FydCggKCBtMzIgLSBtMjMgKSAqICggbTMyIC0gbTIzICkgKwoJCQkJKCBtMTMgLSBtMzEgKSAqICggbTEzIC0gbTMxICkgKwoJCQkJKCBtMjEgLSBtMTIgKSAqICggbTIxIC0gbTEyICkgKTsgLy8gdXNlZCB0byBub3JtYWxpemUKCgkJCWlmICggTWF0aC5hYnMoIHMgKSA8IDAuMDAxICkgcyA9IDE7CgoJCQkvLyBwcmV2ZW50IGRpdmlkZSBieSB6ZXJvLCBzaG91bGQgbm90IGhhcHBlbiBpZiBtYXRyaXggaXMgb3J0aG9nb25hbCBhbmQgc2hvdWxkIGJlCgkJCS8vIGNhdWdodCBieSBzaW5ndWxhcml0eSB0ZXN0IGFib3ZlLCBidXQgSSd2ZSBsZWZ0IGl0IGluIGp1c3QgaW4gY2FzZQoKCQkJdGhpcy54ID0gKCBtMzIgLSBtMjMgKSAvIHM7CgkJCXRoaXMueSA9ICggbTEzIC0gbTMxICkgLyBzOwoJCQl0aGlzLnogPSAoIG0yMSAtIG0xMiApIC8gczsKCQkJdGhpcy53ID0gTWF0aC5hY29zKCAoIG0xMSArIG0yMiArIG0zMyAtIDEgKSAvIDIgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHZlY3RvciBjb21wb25lbnRzIHRvIHRoZSBwb3NpdGlvbiBlbGVtZW50cyBvZiB0aGUKCQkgKiBnaXZlbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgNHg0IG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgoJCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJCXRoaXMueCA9IGVbIDEyIF07CgkJCXRoaXMueSA9IGVbIDEzIF07CgkJCXRoaXMueiA9IGVbIDE0IF07CgkJCXRoaXMudyA9IGVbIDE1IF07CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gdGhlIGdpdmVuIHZlY3RvcidzIHgsIHksIHogb3IgdwoJCSAqIHZhbHVlLCByZXBsYWNlIHRoYXQgdmFsdWUgd2l0aCB0aGUgY29ycmVzcG9uZGluZyBtaW4gdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW1pbiggdiApIHsKCgkJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwoJCQl0aGlzLnkgPSBNYXRoLm1pbiggdGhpcy55LCB2LnkgKTsKCQkJdGhpcy56ID0gTWF0aC5taW4oIHRoaXMueiwgdi56ICk7CgkJCXRoaXMudyA9IE1hdGgubWluKCB0aGlzLncsIHYudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUgaXMgbGVzcyB0aGFuIHRoZSBnaXZlbiB2ZWN0b3IncyB4LCB5LCB6IG9yIHcKCQkgKiB2YWx1ZSwgcmVwbGFjZSB0aGF0IHZhbHVlIHdpdGggdGhlIGNvcnJlc3BvbmRpbmcgbWF4IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3I0fSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQltYXgoIHYgKSB7CgoJCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQkJdGhpcy55ID0gTWF0aC5tYXgoIHRoaXMueSwgdi55ICk7CgkJCXRoaXMueiA9IE1hdGgubWF4KCB0aGlzLnosIHYueiApOwoJCQl0aGlzLncgPSBNYXRoLm1heCggdGhpcy53LCB2LncgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgbWF4IHZlY3RvcidzIHgsIHksIHogb3IgdwoJCSAqIHZhbHVlLCBpdCBpcyByZXBsYWNlZCBieSB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS4KCQkgKiBJZiB0aGlzIHZlY3RvcidzIHgsIHksIHogb3IgdyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWUsCgkJICogaXQgaXMgcmVwbGFjZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IG1pbiAtIFRoZSBtaW5pbXVtIHgsIHkgYW5kIHogdmFsdWVzLgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gbWF4IC0gVGhlIG1heGltdW0geCwgeSBhbmQgeiB2YWx1ZXMgaW4gdGhlIGRlc2lyZWQgcmFuZ2UuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJY2xhbXAoIG1pbiwgbWF4ICkgewoKCQkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCgkJCXRoaXMueCA9IGNsYW1wKCB0aGlzLngsIG1pbi54LCBtYXgueCApOwoJCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW4ueSwgbWF4LnkgKTsKCQkJdGhpcy56ID0gY2xhbXAoIHRoaXMueiwgbWluLnosIG1heC56ICk7CgkJCXRoaXMudyA9IGNsYW1wKCB0aGlzLncsIG1pbi53LCBtYXgudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyB4LCB5LCB6IG9yIHcgdmFsdWVzIGFyZSBncmVhdGVyIHRoYW4gdGhlIG1heCB2YWx1ZSwgdGhleSBhcmUKCQkgKiByZXBsYWNlZCBieSB0aGUgbWF4IHZhbHVlLgoJCSAqIElmIHRoaXMgdmVjdG9yJ3MgeCwgeSwgeiBvciB3IHZhbHVlcyBhcmUgbGVzcyB0aGFuIHRoZSBtaW4gdmFsdWUsIHRoZXkgYXJlCgkJICogcmVwbGFjZWQgYnkgdGhlIG1pbiB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBtaW5WYWwgLSBUaGUgbWluaW11bSB2YWx1ZSB0aGUgY29tcG9uZW50cyB3aWxsIGJlIGNsYW1wZWQgdG8uCgkJICogQHBhcmFtIHtudW1iZXJ9IG1heFZhbCAtIFRoZSBtYXhpbXVtIHZhbHVlIHRoZSBjb21wb25lbnRzIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgoJCQl0aGlzLnggPSBjbGFtcCggdGhpcy54LCBtaW5WYWwsIG1heFZhbCApOwoJCQl0aGlzLnkgPSBjbGFtcCggdGhpcy55LCBtaW5WYWwsIG1heFZhbCApOwoJCQl0aGlzLnogPSBjbGFtcCggdGhpcy56LCBtaW5WYWwsIG1heFZhbCApOwoJCQl0aGlzLncgPSBjbGFtcCggdGhpcy53LCBtaW5WYWwsIG1heFZhbCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSWYgdGhpcyB2ZWN0b3IncyBsZW5ndGggaXMgZ3JlYXRlciB0aGFuIHRoZSBtYXggdmFsdWUsIGl0IGlzIHJlcGxhY2VkIGJ5CgkJICogdGhlIG1heCB2YWx1ZS4KCQkgKiBJZiB0aGlzIHZlY3RvcidzIGxlbmd0aCBpcyBsZXNzIHRoYW4gdGhlIG1pbiB2YWx1ZSwgaXQgaXMgcmVwbGFjZWQgYnkgdGhlCgkJICogbWluIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IG1pbiAtIFRoZSBtaW5pbXVtIHZhbHVlIHRoZSB2ZWN0b3IgbGVuZ3RoIHdpbGwgYmUgY2xhbXBlZCB0by4KCQkgKiBAcGFyYW0ge251bWJlcn0gbWF4IC0gVGhlIG1heGltdW0gdmFsdWUgdGhlIHZlY3RvciBsZW5ndGggd2lsbCBiZSBjbGFtcGVkIHRvLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNsYW1wTGVuZ3RoKCBtaW4sIG1heCApIHsKCgkJCWNvbnN0IGxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7CgoJCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIGNsYW1wKCBsZW5ndGgsIG1pbiwgbWF4ICkgKTsKCgkJfQoKCQkvKioKCQkgKiBUaGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBhcmUgcm91bmRlZCBkb3duIHRvIHRoZSBuZWFyZXN0IGludGVnZXIgdmFsdWUuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmbG9vcigpIHsKCgkJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmZsb29yKCB0aGlzLnkgKTsKCQkJdGhpcy56ID0gTWF0aC5mbG9vciggdGhpcy56ICk7CgkJCXRoaXMudyA9IE1hdGguZmxvb3IoIHRoaXMudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdXAgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWNlaWwoKSB7CgoJCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLmNlaWwoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLmNlaWwoIHRoaXMudyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVGhlIGNvbXBvbmVudHMgb2YgdGhpcyB2ZWN0b3IgYXJlIHJvdW5kZWQgdG8gdGhlIG5lYXJlc3QgaW50ZWdlciB2YWx1ZQoJCSAqCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJcm91bmQoKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoJCQl0aGlzLncgPSBNYXRoLnJvdW5kKCB0aGlzLncgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFRoZSBjb21wb25lbnRzIG9mIHRoaXMgdmVjdG9yIGFyZSByb3VuZGVkIHRvd2FyZHMgemVybyAodXAgaWYgbmVnYXRpdmUsCgkJICogZG93biBpZiBwb3NpdGl2ZSkgdG8gYW4gaW50ZWdlciB2YWx1ZS4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCXJvdW5kVG9aZXJvKCkgewoKCQkJdGhpcy54ID0gTWF0aC50cnVuYyggdGhpcy54ICk7CgkJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwoJCQl0aGlzLnogPSBNYXRoLnRydW5jKCB0aGlzLnogKTsKCQkJdGhpcy53ID0gTWF0aC50cnVuYyggdGhpcy53ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBJbnZlcnRzIHRoaXMgdmVjdG9yIC0gaS5lLiBzZXRzIHggPSAteCwgeSA9IC15LCB6ID0gLXosIHcgPSAtdy4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW5lZ2F0ZSgpIHsKCgkJCXRoaXMueCA9IC0gdGhpcy54OwoJCQl0aGlzLnkgPSAtIHRoaXMueTsKCQkJdGhpcy56ID0gLSB0aGlzLno7CgkJCXRoaXMudyA9IC0gdGhpcy53OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ2FsY3VsYXRlcyB0aGUgZG90IHByb2R1Y3Qgb2YgdGhlIGdpdmVuIHZlY3RvciB3aXRoIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGNvbXB1dGUgdGhlIGRvdCBwcm9kdWN0IHdpdGguCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgcmVzdWx0IG9mIHRoZSBkb3QgcHJvZHVjdC4KCQkgKi8KCQlkb3QoIHYgKSB7CgoJCQlyZXR1cm4gdGhpcy54ICogdi54ICsgdGhpcy55ICogdi55ICsgdGhpcy56ICogdi56ICsgdGhpcy53ICogdi53OwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBzcXVhcmUgb2YgdGhlIEV1Y2xpZGVhbiBsZW5ndGggKHN0cmFpZ2h0LWxpbmUgbGVuZ3RoKSBmcm9tCgkJICogKDAsIDAsIDAsIDApIHRvICh4LCB5LCB6LCB3KS4gSWYgeW91IGFyZSBjb21wYXJpbmcgdGhlIGxlbmd0aHMgb2YgdmVjdG9ycywgeW91IHNob3VsZAoJCSAqIGNvbXBhcmUgdGhlIGxlbmd0aCBzcXVhcmVkIGluc3RlYWQgYXMgaXQgaXMgc2xpZ2h0bHkgbW9yZSBlZmZpY2llbnQgdG8gY2FsY3VsYXRlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgc3F1YXJlIGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZW5ndGhTcSgpIHsKCgkJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLnc7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlICBFdWNsaWRlYW4gbGVuZ3RoIChzdHJhaWdodC1saW5lIGxlbmd0aCkgZnJvbSAoMCwgMCwgMCwgMCkgdG8gKHgsIHksIHosIHcpLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBNYW5oYXR0YW4gbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgbGVuZ3RoIG9mIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW1hbmhhdHRhbkxlbmd0aCgpIHsKCgkJCXJldHVybiBNYXRoLmFicyggdGhpcy54ICkgKyBNYXRoLmFicyggdGhpcy55ICkgKyBNYXRoLmFicyggdGhpcy56ICkgKyBNYXRoLmFicyggdGhpcy53ICk7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhpcyB2ZWN0b3IgdG8gYSB1bml0IHZlY3RvciAtIHRoYXQgaXMsIHNldHMgaXQgZXF1YWwgdG8gYSB2ZWN0b3IKCQkgKiB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0IHdpdGggYSB2ZWN0b3IgbGVuZ3RoIG9mIGAxYC4KCQkgKgoJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCW5vcm1hbGl6ZSgpIHsKCgkJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHZlY3RvciB0byBhIHZlY3RvciB3aXRoIHRoZSBzYW1lIGRpcmVjdGlvbiBhcyB0aGlzIG9uZSwgYnV0CgkJICogd2l0aCB0aGUgc3BlY2lmaWVkIGxlbmd0aC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsZW5ndGggLSBUaGUgbmV3IGxlbmd0aCBvZiB0aGlzIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9yIGFuZCB0aGlzIGluc3RhbmNlLCB3aGVyZQoJCSAqIGFscGhhIGlzIHRoZSBwZXJjZW50IGRpc3RhbmNlIGFsb25nIHRoZSBsaW5lIC0gYWxwaGEgPSAwIHdpbGwgYmUgdGhpcwoJCSAqIHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsIGJlIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYgLSBUaGUgdmVjdG9yIHRvIGludGVycG9sYXRlIHRvd2FyZHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwKCB2LCBhbHBoYSApIHsKCgkJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJCXRoaXMueSArPSAoIHYueSAtIHRoaXMueSApICogYWxwaGE7CgkJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgkJCXRoaXMudyArPSAoIHYudyAtIHRoaXMudyApICogYWxwaGE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBMaW5lYXJseSBpbnRlcnBvbGF0ZXMgYmV0d2VlbiB0aGUgZ2l2ZW4gdmVjdG9ycywgd2hlcmUgYWxwaGEgaXMgdGhlIHBlcmNlbnQKCQkgKiBkaXN0YW5jZSBhbG9uZyB0aGUgbGluZSAtIGFscGhhID0gMCB3aWxsIGJlIGZpcnN0IHZlY3RvciwgYW5kIGFscGhhID0gMSB3aWxsCgkJICogYmUgdGhlIHNlY29uZCBvbmUuIFRoZSByZXN1bHQgaXMgc3RvcmVkIGluIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYxIC0gVGhlIGZpcnN0IHZlY3Rvci4KCQkgKiBAcGFyYW0ge1ZlY3RvcjR9IHYyIC0gVGhlIHNlY29uZCB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFscGhhIC0gVGhlIGludGVycG9sYXRpb24gZmFjdG9yLCB0eXBpY2FsbHkgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsIDFdYC4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCgkJCXRoaXMueCA9IHYxLnggKyAoIHYyLnggLSB2MS54ICkgKiBhbHBoYTsKCQkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwoJCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgkJCXRoaXMudyA9IHYxLncgKyAoIHYyLncgLSB2MS53ICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdmVjdG9yIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdiAtIFRoZSB2ZWN0b3IgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHZlY3RvciBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCB2ICkgewoKCQkJcmV0dXJuICggKCB2LnggPT09IHRoaXMueCApICYmICggdi55ID09PSB0aGlzLnkgKSAmJiAoIHYueiA9PT0gdGhpcy56ICkgJiYgKCB2LncgPT09IHRoaXMudyApICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIHZlY3RvcidzIHggdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgXWAsIHkgdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAxIF1gLAoJCSAqIHogdmFsdWUgdG8gYmUgYGFycmF5WyBvZmZzZXQgKyAyIF1gLCB3IHZhbHVlIHRvIGJlIGBhcnJheVsgb2Zmc2V0ICsgMyBdYC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSB2ZWN0b3IgY29tcG9uZW50IHZhbHVlcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIFRoZSBvZmZzZXQgaW50byB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7VmVjdG9yNH0gQSByZWZlcmVuY2UgdG8gdGhpcyB2ZWN0b3IuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQkJdGhpcy56ID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCQkJdGhpcy53ID0gYXJyYXlbIG9mZnNldCArIDMgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFdyaXRlcyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgdmVjdG9yIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyPn0gVGhlIHZlY3RvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLno7CgkJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLnc7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBidWZmZXIgYXR0cmlidXRlIGhvbGRpbmcgdmVjdG9yIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4ICkgewoKCQkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoJCQl0aGlzLnogPSBhdHRyaWJ1dGUuZ2V0WiggaW5kZXggKTsKCQkJdGhpcy53ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIGVhY2ggY29tcG9uZW50IG9mIHRoaXMgdmVjdG9yIHRvIGEgcHNldWRvLXJhbmRvbSB2YWx1ZSBiZXR3ZWVuIGAwYCBhbmQKCQkgKiBgMWAsIGV4Y2x1ZGluZyBgMWAuCgkJICoKCQkgKiBAcmV0dXJuIHtWZWN0b3I0fSBBIHJlZmVyZW5jZSB0byB0aGlzIHZlY3Rvci4KCQkgKi8KCQlyYW5kb20oKSB7CgoJCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwoJCQl0aGlzLnkgPSBNYXRoLnJhbmRvbSgpOwoJCQl0aGlzLnogPSBNYXRoLnJhbmRvbSgpOwoJCQl0aGlzLncgPSBNYXRoLnJhbmRvbSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCQl5aWVsZCB0aGlzLng7CgkJCXlpZWxkIHRoaXMueTsKCQkJeWllbGQgdGhpcy56OwoJCQl5aWVsZCB0aGlzLnc7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIHJlbmRlciB0YXJnZXQgaXMgYSBidWZmZXIgd2hlcmUgdGhlIHZpZGVvIGNhcmQgZHJhd3MgcGl4ZWxzIGZvciBhIHNjZW5lCgkgKiB0aGF0IGlzIGJlaW5nIHJlbmRlcmVkIGluIHRoZSBiYWNrZ3JvdW5kLiBJdCBpcyB1c2VkIGluIGRpZmZlcmVudCBlZmZlY3RzLAoJICogc3VjaCBhcyBhcHBseWluZyBwb3N0cHJvY2Vzc2luZyB0byBhIHJlbmRlcmVkIGltYWdlIGJlZm9yZSBkaXNwbGF5aW5nIGl0CgkgKiBvbiB0aGUgc2NyZWVuLgoJICoKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqLwoJY2xhc3MgUmVuZGVyVGFyZ2V0IGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgkJLyoqCgkJICogUmVuZGVyIHRhcmdldCBvcHRpb25zLgoJCSAqCgkJICogQHR5cGVkZWYge09iamVjdH0gUmVuZGVyVGFyZ2V0fk9wdGlvbnMKCQkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtnZW5lcmF0ZU1pcG1hcHM9ZmFsc2VdIC0gV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIG9yIG5vdC4KCQkgKiBAcHJvcGVydHkge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyLgoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHByb3BlcnR5IHs/c3RyaW5nfSBbaW50ZXJuYWxGb3JtYXQ9bnVsbF0gLSBUaGUgdGV4dHVyZSdzIGludGVybmFsIGZvcm1hdC4KCQkgKiBAcHJvcGVydHkge251bWJlcn0gW3dyYXBTPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHRleHR1cmUncyB1diB3cmFwcGluZyBtb2RlLgoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbd3JhcFQ9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgdGV4dHVyZSdzIHV2IHdyYXBwaW5nIG1vZGUuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFthbmlzb3Ryb3B5PTFdIC0gVGhlIHRleHR1cmUncyBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIHRleHR1cmUncyBjb2xvciBzcGFjZS4KCQkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtkZXB0aEJ1ZmZlcj10cnVlXSAtIFdoZXRoZXIgdG8gYWxsb2NhdGUgYSBkZXB0aCBidWZmZXIgb3Igbm90LgoJCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3N0ZW5jaWxCdWZmZXI9ZmFsc2VdIC0gV2hldGhlciB0byBhbGxvY2F0ZSBhIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KCQkgKiBAcHJvcGVydHkge2Jvb2xlYW59IFtyZXNvbHZlRGVwdGhCdWZmZXI9dHJ1ZV0gLSBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCgkJICogQHByb3BlcnR5IHtib29sZWFufSBbcmVzb2x2ZVN0ZW5jaWxCdWZmZXI9dHJ1ZV0gLSBXaGV0aGVyICB0byByZXNvbHZlIHRoZSBzdGVuY2lsIGJ1ZmZlciBvciBub3QuCgkJICogQHByb3BlcnR5IHs/VGV4dHVyZX0gW2RlcHRoVGV4dHVyZT1udWxsXSAtIFJlZmVyZW5jZSB0byBhIGRlcHRoIHRleHR1cmUuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFtzYW1wbGVzPTBdIC0gVGhlIE1TQUEgc2FtcGxlcyBjb3VudC4KCQkgKiBAcHJvcGVydHkge251bWJlcn0gW2NvdW50PTFdIC0gRGVmaW5lcyB0aGUgbnVtYmVyIG9mIGNvbG9yIGF0dGFjaG1lbnRzIC4gTXVzdCBiZSBhdCBsZWFzdCBgMWAuCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSB0ZXh0dXJlIGRlcHRoLgoJCSAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW211bHRpdmlldz1mYWxzZV0gLSBXaGV0aGVyIHRoaXMgdGFyZ2V0IGlzIHVzZWQgZm9yIG11bHRpdmlldyByZW5kZXJpbmcuCgkJICovCgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgcmVuZGVyIHRhcmdldC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgoJCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KCQkgKi8KCQljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCQlzdXBlcigpOwoKCQkJb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHsKCQkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCgkJCQlpbnRlcm5hbEZvcm1hdDogbnVsbCwKCQkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAoJCQkJZGVwdGhCdWZmZXI6IHRydWUsCgkJCQlzdGVuY2lsQnVmZmVyOiBmYWxzZSwKCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogdHJ1ZSwKCQkJCXJlc29sdmVTdGVuY2lsQnVmZmVyOiB0cnVlLAoJCQkJZGVwdGhUZXh0dXJlOiBudWxsLAoJCQkJc2FtcGxlczogMCwKCQkJCWNvdW50OiAxLAoJCQkJZGVwdGg6IDEsCgkJCQltdWx0aXZpZXc6IGZhbHNlCgkJCX0sIG9wdGlvbnMgKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMud2lkdGggPSB3aWR0aDsKCgkJCS8qKgoJCQkgKiBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLmhlaWdodCA9IGhlaWdodDsKCgkJCS8qKgoJCQkgKiBUaGUgZGVwdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuZGVwdGggPSBvcHRpb25zLmRlcHRoOwoKCQkJLyoqCgkJCSAqIEEgcmVjdGFuZ3VsYXIgYXJlYSBpbnNpZGUgdGhlIHJlbmRlciB0YXJnZXQncyB2aWV3cG9ydC4gRnJhZ21lbnRzIHRoYXQgYXJlCgkJCSAqIG91dHNpZGUgdGhlIGFyZWEgd2lsbCBiZSBkaXNjYXJkZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtWZWN0b3I0fQoJCQkgKiBAZGVmYXVsdCAoMCwwLHdpZHRoLGhlaWdodCkKCQkJICovCgkJCXRoaXMuc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQkvKioKCQkJICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBzaG91bGQgYmUgZW5hYmxlZCB3aGVuIHJlbmRlcmluZyBpbnRvCgkJCSAqIHRoaXMgcmVuZGVyIHRhcmdldCBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIEEgcmVjdGFuZ3VsYXIgYXJlYSByZXByZXNlbnRpbmcgdGhlIHJlbmRlciB0YXJnZXQncyB2aWV3cG9ydC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjR9CgkJCSAqIEBkZWZhdWx0ICgwLDAsd2lkdGgsaGVpZ2h0KQoJCQkgKi8KCQkJdGhpcy52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IG9wdGlvbnMuZGVwdGggfTsKCgkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSggaW1hZ2UgKTsKCgkJCS8qKgoJCQkgKiBBbiBhcnJheSBvZiB0ZXh0dXJlcy4gRWFjaCBjb2xvciBhdHRhY2htZW50IGlzIHJlcHJlc2VudGVkIGFzIGEgc2VwYXJhdGUgdGV4dHVyZS4KCQkJICogSGFzIGF0IGxlYXN0IGEgc2luZ2xlIGVudHJ5IGZvciB0aGUgZGVmYXVsdCBjb2xvciBhdHRhY2htZW50LgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8VGV4dHVyZT59CgkJCSAqLwoJCQl0aGlzLnRleHR1cmVzID0gW107CgoJCQljb25zdCBjb3VudCA9IG9wdGlvbnMuY291bnQ7CgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKCQkJCXRoaXMudGV4dHVyZXNbIGkgXSA9IHRleHR1cmUuY2xvbmUoKTsKCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoJCQkJdGhpcy50ZXh0dXJlc1sgaSBdLnJlbmRlclRhcmdldCA9IHRoaXM7CgoJCQl9CgoJCQl0aGlzLl9zZXRUZXh0dXJlT3B0aW9ucyggb3B0aW9ucyApOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gYWxsb2NhdGUgYSBkZXB0aCBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5kZXB0aEJ1ZmZlciA9IG9wdGlvbnMuZGVwdGhCdWZmZXI7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBhbGxvY2F0ZSBhIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnN0ZW5jaWxCdWZmZXI7CgoJCQkvKioKCQkJICogV2hldGhlciB0byByZXNvbHZlIHRoZSBkZXB0aCBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5yZXNvbHZlRGVwdGhCdWZmZXIgPSBvcHRpb25zLnJlc29sdmVEZXB0aEJ1ZmZlcjsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRvIHJlc29sdmUgdGhlIHN0ZW5jaWwgYnVmZmVyIG9yIG5vdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMucmVzb2x2ZVN0ZW5jaWxCdWZmZXIgPSBvcHRpb25zLnJlc29sdmVTdGVuY2lsQnVmZmVyOwoKCQkJdGhpcy5fZGVwdGhUZXh0dXJlID0gbnVsbDsKCQkJdGhpcy5kZXB0aFRleHR1cmUgPSBvcHRpb25zLmRlcHRoVGV4dHVyZTsKCgkJCS8qKgoJCQkgKiBUaGUgbnVtYmVyIG9mIE1TQUEgc2FtcGxlcy4KCQkJICoKCQkJICogQSB2YWx1ZSBvZiBgMGAgZGlzYWJsZXMgTVNBQS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5zYW1wbGVzID0gb3B0aW9ucy5zYW1wbGVzOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gdGhpcyB0YXJnZXQgaXMgdXNlZCBpbiBtdWx0aXZpZXcgcmVuZGVyaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMubXVsdGl2aWV3ID0gb3B0aW9ucy5tdWx0aXZpZXc7CgoJCX0KCgkJX3NldFRleHR1cmVPcHRpb25zKCBvcHRpb25zID0ge30gKSB7CgoJCQljb25zdCB2YWx1ZXMgPSB7CgkJCQltaW5GaWx0ZXI6IExpbmVhckZpbHRlciwKCQkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCgkJCQlmbGlwWTogZmFsc2UsCgkJCQlpbnRlcm5hbEZvcm1hdDogbnVsbAoJCQl9OwoKCQkJaWYgKCBvcHRpb25zLm1hcHBpbmcgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5tYXBwaW5nID0gb3B0aW9ucy5tYXBwaW5nOwoJCQlpZiAoIG9wdGlvbnMud3JhcFMgIT09IHVuZGVmaW5lZCApIHZhbHVlcy53cmFwUyA9IG9wdGlvbnMud3JhcFM7CgkJCWlmICggb3B0aW9ucy53cmFwVCAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLndyYXBUID0gb3B0aW9ucy53cmFwVDsKCQkJaWYgKCBvcHRpb25zLndyYXBSICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMud3JhcFIgPSBvcHRpb25zLndyYXBSOwoJCQlpZiAoIG9wdGlvbnMubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMubWFnRmlsdGVyID0gb3B0aW9ucy5tYWdGaWx0ZXI7CgkJCWlmICggb3B0aW9ucy5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5taW5GaWx0ZXIgPSBvcHRpb25zLm1pbkZpbHRlcjsKCQkJaWYgKCBvcHRpb25zLmZvcm1hdCAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLmZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0OwoJCQlpZiAoIG9wdGlvbnMudHlwZSAhPT0gdW5kZWZpbmVkICkgdmFsdWVzLnR5cGUgPSBvcHRpb25zLnR5cGU7CgkJCWlmICggb3B0aW9ucy5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuYW5pc290cm9weSA9IG9wdGlvbnMuYW5pc290cm9weTsKCQkJaWYgKCBvcHRpb25zLmNvbG9yU3BhY2UgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5jb2xvclNwYWNlID0gb3B0aW9ucy5jb2xvclNwYWNlOwoJCQlpZiAoIG9wdGlvbnMuZmxpcFkgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5mbGlwWSA9IG9wdGlvbnMuZmxpcFk7CgkJCWlmICggb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCApIHZhbHVlcy5nZW5lcmF0ZU1pcG1hcHMgPSBvcHRpb25zLmdlbmVyYXRlTWlwbWFwczsKCQkJaWYgKCBvcHRpb25zLmludGVybmFsRm9ybWF0ICE9PSB1bmRlZmluZWQgKSB2YWx1ZXMuaW50ZXJuYWxGb3JtYXQgPSBvcHRpb25zLmludGVybmFsRm9ybWF0OwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbIGkgXTsKCQkJCXRleHR1cmUuc2V0VmFsdWVzKCB2YWx1ZXMgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBUaGUgdGV4dHVyZSByZXByZXNlbnRpbmcgdGhlIGRlZmF1bHQgY29sb3IgYXR0YWNobWVudC4KCQkgKgoJCSAqIEB0eXBlIHtUZXh0dXJlfQoJCSAqLwoJCWdldCB0ZXh0dXJlKCkgewoKCQkJcmV0dXJuIHRoaXMudGV4dHVyZXNbIDAgXTsKCgkJfQoKCQlzZXQgdGV4dHVyZSggdmFsdWUgKSB7CgoJCQl0aGlzLnRleHR1cmVzWyAwIF0gPSB2YWx1ZTsKCgkJfQoKCQlzZXQgZGVwdGhUZXh0dXJlKCBjdXJyZW50ICkgewoKCQkJaWYgKCB0aGlzLl9kZXB0aFRleHR1cmUgIT09IG51bGwgKSB0aGlzLl9kZXB0aFRleHR1cmUucmVuZGVyVGFyZ2V0ID0gbnVsbDsKCQkJaWYgKCBjdXJyZW50ICE9PSBudWxsICkgY3VycmVudC5yZW5kZXJUYXJnZXQgPSB0aGlzOwoKCQkJdGhpcy5fZGVwdGhUZXh0dXJlID0gY3VycmVudDsKCgkJfQoKCQkvKioKCQkgKiBJbnN0ZWFkIG9mIHNhdmluZyB0aGUgZGVwdGggaW4gYSByZW5kZXJidWZmZXIsIGEgdGV4dHVyZQoJCSAqIGNhbiBiZSB1c2VkIGluc3RlYWQgd2hpY2ggaXMgdXNlZnVsIGZvciBmdXJ0aGVyIHByb2Nlc3NpbmcKCQkgKiBlLmcuIGluIGNvbnRleHQgb2YgcG9zdC1wcm9jZXNzaW5nLgoJCSAqCgkJICogQHR5cGUgez9EZXB0aFRleHR1cmV9CgkJICogQGRlZmF1bHQgbnVsbAoJCSAqLwoJCWdldCBkZXB0aFRleHR1cmUoKSB7CgoJCQlyZXR1cm4gdGhpcy5fZGVwdGhUZXh0dXJlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHNpemUgb2YgdGhpcyByZW5kZXIgdGFyZ2V0LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGguCgkJICovCgkJc2V0U2l6ZSggd2lkdGgsIGhlaWdodCwgZGVwdGggPSAxICkgewoKCQkJaWYgKCB0aGlzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuZGVwdGggIT09IGRlcHRoICkgewoKCQkJCXRoaXMud2lkdGggPSB3aWR0aDsKCQkJCXRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwoJCQkJdGhpcy5kZXB0aCA9IGRlcHRoOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLnRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaW1hZ2Uud2lkdGggPSB3aWR0aDsKCQkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaW1hZ2UuaGVpZ2h0ID0gaGVpZ2h0OwoJCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5kZXB0aCA9IGRlcHRoOwoJCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5pc0FycmF5VGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbIGkgXS5pbWFnZS5kZXB0aCA+IDE7CgoJCQkJfQoKCQkJCXRoaXMuZGlzcG9zZSgpOwoKCQkJfQoKCQkJdGhpcy52aWV3cG9ydC5zZXQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCQkJdGhpcy5zY2lzc29yLnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgcmVuZGVyIHRhcmdldCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7UmVuZGVyVGFyZ2V0fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSBzZXR0aW5ncyBvZiB0aGUgZ2l2ZW4gcmVuZGVyIHRhcmdldC4gVGhpcyBpcyBhIHN0cnVjdHVyYWwgY29weSBzbwoJCSAqIG5vIHJlc291cmNlcyBhcmUgc2hhcmVkIGJldHdlZW4gcmVuZGVyIHRhcmdldHMgYWZ0ZXIgdGhlIGNvcHkuIFRoYXQgaW5jbHVkZXMKCQkgKiBhbGwgTVJUIHRleHR1cmVzIGFuZCB0aGUgZGVwdGggdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fSBzb3VyY2UgLSBUaGUgcmVuZGVyIHRhcmdldCB0byBjb3B5LgoJCSAqIEByZXR1cm4ge1JlbmRlclRhcmdldH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljb3B5KCBzb3VyY2UgKSB7CgoJCQl0aGlzLndpZHRoID0gc291cmNlLndpZHRoOwoJCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CgkJCXRoaXMuZGVwdGggPSBzb3VyY2UuZGVwdGg7CgoJCQl0aGlzLnNjaXNzb3IuY29weSggc291cmNlLnNjaXNzb3IgKTsKCQkJdGhpcy5zY2lzc29yVGVzdCA9IHNvdXJjZS5zY2lzc29yVGVzdDsKCgkJCXRoaXMudmlld3BvcnQuY29weSggc291cmNlLnZpZXdwb3J0ICk7CgoJCQl0aGlzLnRleHR1cmVzLmxlbmd0aCA9IDA7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gc291cmNlLnRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCXRoaXMudGV4dHVyZXNbIGkgXSA9IHNvdXJjZS50ZXh0dXJlc1sgaSBdLmNsb25lKCk7CgkJCQl0aGlzLnRleHR1cmVzWyBpIF0uaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCQkJCXRoaXMudGV4dHVyZXNbIGkgXS5yZW5kZXJUYXJnZXQgPSB0aGlzOwoKCQkJCS8vIGVuc3VyZSBpbWFnZSBvYmplY3QgaXMgbm90IHNoYXJlZCwgc2VlICMyMDMyOAoKCQkJCWNvbnN0IGltYWdlID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS50ZXh0dXJlc1sgaSBdLmltYWdlICk7CgkJCQl0aGlzLnRleHR1cmVzWyBpIF0uc291cmNlID0gbmV3IFNvdXJjZSggaW1hZ2UgKTsKCgkJCX0KCgkJCXRoaXMuZGVwdGhCdWZmZXIgPSBzb3VyY2UuZGVwdGhCdWZmZXI7CgkJCXRoaXMuc3RlbmNpbEJ1ZmZlciA9IHNvdXJjZS5zdGVuY2lsQnVmZmVyOwoKCQkJdGhpcy5yZXNvbHZlRGVwdGhCdWZmZXIgPSBzb3VyY2UucmVzb2x2ZURlcHRoQnVmZmVyOwoJCQl0aGlzLnJlc29sdmVTdGVuY2lsQnVmZmVyID0gc291cmNlLnJlc29sdmVTdGVuY2lsQnVmZmVyOwoKCQkJaWYgKCBzb3VyY2UuZGVwdGhUZXh0dXJlICE9PSBudWxsICkgdGhpcy5kZXB0aFRleHR1cmUgPSBzb3VyY2UuZGVwdGhUZXh0dXJlLmNsb25lKCk7CgoJCQl0aGlzLnNhbXBsZXMgPSBzb3VyY2Uuc2FtcGxlczsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwoJCSAqIG1ldGhvZCB3aGVuZXZlciB0aGlzIGluc3RhbmNlIGlzIG5vIGxvbmdlciB1c2VkIGluIHlvdXIgYXBwLgoJCSAqCgkJICogQGZpcmVzIFJlbmRlclRhcmdldCNkaXNwb3NlCgkJICovCgkJZGlzcG9zZSgpIHsKCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9CgoJfQoKCS8qKgoJICogQSByZW5kZXIgdGFyZ2V0IHVzZWQgaW4gY29udGV4dCBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkgKgoJICogQGF1Z21lbnRzIFJlbmRlclRhcmdldAoJICovCgljbGFzcyBXZWJHTFJlbmRlclRhcmdldCBleHRlbmRzIFJlbmRlclRhcmdldCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgM0QgcmVuZGVyIHRhcmdldC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSByZW5kZXIgdGFyZ2V0LgoJCSAqIEBwYXJhbSB7UmVuZGVyVGFyZ2V0fk9wdGlvbnN9IFtvcHRpb25zXSAtIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdC4KCQkgKi8KCQljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCQlzdXBlciggd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNXZWJHTFJlbmRlclRhcmdldCA9IHRydWU7CgoJCX0KCgl9CgoJLyoqCgkgKiBDcmVhdGVzIGFuIGFycmF5IG9mIHRleHR1cmVzIGRpcmVjdGx5IGZyb20gcmF3IGJ1ZmZlciBkYXRhLgoJICoKCSAqIEBhdWdtZW50cyBUZXh0dXJlCgkgKi8KCWNsYXNzIERhdGFBcnJheVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBkYXRhIGFycmF5IHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0gez9UeXBlZEFycmF5fSBbZGF0YT1udWxsXSAtIFRoZSBidWZmZXIgZGF0YS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoPTFdIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbaGVpZ2h0PTFdIC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBkYXRhID0gbnVsbCwgd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEgKSB7CgoJCQlzdXBlciggbnVsbCApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNEYXRhQXJyYXlUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgaW1hZ2UgZGVmaW5pdGlvbiBvZiBhIGRhdGEgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge3tkYXRhOlR5cGVkQXJyYXksd2lkdGg6bnVtYmVyLGhlaWdodDpudW1iZXIsZGVwdGg6bnVtYmVyfX0KCQkJICovCgkJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGluIHRoZSBkZXB0aCBhbmQgY29ycmVzcG9uZHMgdG8KCQkJICogKlcqIGluIFVWVyBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKCQkJICovCgkJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgbWlwbWFwcyAoaWYgcG9zc2libGUpIGZvciBhIHRleHR1cmUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkvKioKCQkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCgkJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYDFgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJCQkvKioKCQkJICogQSBzZXQgb2YgYWxsIGxheWVycyB3aGljaCBuZWVkIHRvIGJlIHVwZGF0ZWQgaW4gdGhlIHRleHR1cmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtTZXQ8bnVtYmVyPn0KCQkJICovCgkJCXRoaXMubGF5ZXJVcGRhdGVzID0gbmV3IFNldCgpOwoKCQl9CgoJCS8qKgoJCSAqIERlc2NyaWJlcyB0aGF0IGEgc3BlY2lmaWMgbGF5ZXIgb2YgdGhlIHRleHR1cmUgbmVlZHMgdG8gYmUgdXBkYXRlZC4KCQkgKiBOb3JtYWxseSB3aGVuIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfSBpcyBzZXQgdG8gYHRydWVgLCB0aGUKCQkgKiBlbnRpcmUgZGF0YSB0ZXh0dXJlIGFycmF5IGlzIHNlbnQgdG8gdGhlIEdQVS4gTWFya2luZyBzcGVjaWZpYwoJCSAqIGxheWVycyB3aWxsIG9ubHkgdHJhbnNtaXQgc3Vic2V0cyBvZiBhbGwgbWlwbWFwcyBhc3NvY2lhdGVkIHdpdGggYQoJCSAqIHNwZWNpZmljIGRlcHRoIGluIHRoZSBhcnJheSB3aGljaCBpcyBvZnRlbiBtdWNoIG1vcmUgcGVyZm9ybWFudC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllckluZGV4IC0gVGhlIGxheWVyIGluZGV4IHRoYXQgc2hvdWxkIGJlIHVwZGF0ZWQuCgkJICovCgkJYWRkTGF5ZXJVcGRhdGUoIGxheWVySW5kZXggKSB7CgoJCQl0aGlzLmxheWVyVXBkYXRlcy5hZGQoIGxheWVySW5kZXggKTsKCgkJfQoKCQkvKioKCQkgKiBSZXNldHMgdGhlIGxheWVyIHVwZGF0ZXMgcmVnaXN0cnkuCgkJICovCgkJY2xlYXJMYXllclVwZGF0ZXMoKSB7CgoJCQl0aGlzLmxheWVyVXBkYXRlcy5jbGVhcigpOwoKCQl9CgoJfQoKCS8qKgoJICogQ3JlYXRlcyBhIHRocmVlLWRpbWVuc2lvbmFsIHRleHR1cmUgZnJvbSByYXcgZGF0YSwgd2l0aCBwYXJhbWV0ZXJzIHRvCgkgKiBkaXZpZGUgaXQgaW50byB3aWR0aCwgaGVpZ2h0LCBhbmQgZGVwdGguCgkgKgoJICogQGF1Z21lbnRzIFRleHR1cmUKCSAqLwoJY2xhc3MgRGF0YTNEVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGRhdGEgYXJyYXkgdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7P1R5cGVkQXJyYXl9IFtkYXRhPW51bGxdIC0gVGhlIGJ1ZmZlciBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggb2YgdGhlIHRleHR1cmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHQ9MV0gLSBUaGUgaGVpZ2h0IG9mIHRoZSB0ZXh0dXJlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZGVwdGg9MV0gLSBUaGUgZGVwdGggb2YgdGhlIHRleHR1cmUuCgkJICovCgkJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCgkJCS8vIFdlJ3JlIGdvaW5nIHRvIGFkZCAuc2V0WFhYKCkgbWV0aG9kcyBmb3Igc2V0dGluZyBwcm9wZXJ0aWVzIGxhdGVyLgoJCQkvLyBVc2VycyBjYW4gc3RpbGwgc2V0IGluIERhdGEzRFRleHR1cmUgZGlyZWN0bHkuCgkJCS8vCgkJCS8vCWNvbnN0IHRleHR1cmUgPSBuZXcgVEhSRUUuRGF0YTNEVGV4dHVyZSggZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggKTsKCQkJLy8gCXRleHR1cmUuYW5pc290cm9weSA9IDE2OwoJCQkvLwoJCQkvLyBTZWUgIzE0ODM5CgoJCQlzdXBlciggbnVsbCApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNEYXRhM0RUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgaW1hZ2UgZGVmaW5pdGlvbiBvZiBhIGRhdGEgdGV4dHVyZS4KCQkJICoKCQkJICogQHR5cGUge3tkYXRhOlR5cGVkQXJyYXksd2lkdGg6bnVtYmVyLGhlaWdodDpudW1iZXIsZGVwdGg6bnVtYmVyfX0KCQkJICovCgkJCXRoaXMuaW1hZ2UgPSB7IGRhdGEsIHdpZHRoLCBoZWlnaHQsIGRlcHRoIH07CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBtb3JlIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogSG93IHRoZSB0ZXh0dXJlIGlzIHNhbXBsZWQgd2hlbiBhIHRleGVsIGNvdmVycyBsZXNzIHRoYW4gb25lIHBpeGVsLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBOZWFyZXN0RmlsdGVyYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXJ8TmVhcmVzdE1pcG1hcExpbmVhckZpbHRlcnxMaW5lYXJGaWx0ZXJ8TGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlcnxMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIpfQoJCQkgKiBAZGVmYXVsdCBOZWFyZXN0RmlsdGVyCgkJCSAqLwoJCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCQkvKioKCQkJICogVGhpcyBkZWZpbmVzIGhvdyB0aGUgdGV4dHVyZSBpcyB3cmFwcGVkIGluIHRoZSBkZXB0aCBhbmQgY29ycmVzcG9uZHMgdG8KCQkJICogKlcqIGluIFVWVyBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFJlcGVhdFdyYXBwaW5nfENsYW1wVG9FZGdlV3JhcHBpbmd8TWlycm9yZWRSZXBlYXRXcmFwcGluZyl9CgkJCSAqIEBkZWZhdWx0IENsYW1wVG9FZGdlV3JhcHBpbmcKCQkJICovCgkJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gZ2VuZXJhdGUgbWlwbWFwcyAoaWYgcG9zc2libGUpIGZvciBhIHRleHR1cmUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkvKioKCQkJICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHRleHR1cmUgaXMgZmxpcHBlZCBhbG9uZyB0aGUgdmVydGljYWwgYXhpcyB3aGVuCgkJCSAqIHVwbG9hZGVkIHRvIHRoZSBHUFUuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYGZhbHNlYCBieSBkZWZhdWx0LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBTcGVjaWZpZXMgdGhlIGFsaWdubWVudCByZXF1aXJlbWVudHMgZm9yIHRoZSBzdGFydCBvZiBlYWNoIHBpeGVsIHJvdyBpbiBtZW1vcnkuCgkJCSAqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYDFgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJCX0KCgl9CgoJLyoqCgkgKiBSZXByZXNlbnRzIGFuIGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggKEFBQkIpIGluIDNEIHNwYWNlLgoJICovCgljbGFzcyBCb3gzIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFttaW49KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KV0gLSBBIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBib3guCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbbWF4PSgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSldIC0gQSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSB1cHBlciBib3VuZGFyeSBvZiB0aGUgYm94LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBtaW4gPSBuZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApLCBtYXggPSBuZXcgVmVjdG9yMyggLSBJbmZpbml0eSwgLSBJbmZpbml0eSwgLSBJbmZpbml0eSApICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNCb3gzID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgbG93ZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLm1pbiA9IG1pbjsKCgkJCS8qKgoJCQkgKiBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLm1heCA9IG1heDsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBsb3dlciBhbmQgdXBwZXIgYm91bmRhcmllcyBvZiB0aGlzIGJveC4KCQkgKiBQbGVhc2Ugbm90ZSB0aGF0IHRoaXMgbWV0aG9kIG9ubHkgY29waWVzIHRoZSB2YWx1ZXMgZnJvbSB0aGUgZ2l2ZW4gb2JqZWN0cy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gbWluIC0gVGhlIGxvd2VyIGJvdW5kYXJ5IG9mIHRoZSBib3guCgkJICogQHBhcmFtIHtWZWN0b3IzfSBtYXggLSBUaGUgdXBwZXIgYm91bmRhcnkgb2YgdGhlIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlzZXQoIG1pbiwgbWF4ICkgewoKCQkJdGhpcy5taW4uY29weSggbWluICk7CgkJCXRoaXMubWF4LmNvcHkoIG1heCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJveCBzbyBpdCBlbmNsb3NlcyB0aGUgcG9zaXRpb24gZGF0YQoJCSAqIGluIHRoZSBnaXZlbiBhcnJheS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEuCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJc2V0RnJvbUFycmF5KCBhcnJheSApIHsKCgkJCXRoaXMubWFrZUVtcHR5KCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYi5mcm9tQXJyYXkoIGFycmF5LCBpICkgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHVwcGVyIGFuZCBsb3dlciBib3VuZHMgb2YgdGhpcyBib3ggc28gaXQgZW5jbG9zZXMgdGhlIHBvc2l0aW9uIGRhdGEKCQkgKiBpbiB0aGUgZ2l2ZW4gYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7QnVmZmVyQXR0cmlidXRlfSBhdHRyaWJ1dGUgLSBBIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyAzRCBwb3NpdGlvbiBkYXRhLgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCXNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSApIHsKCgkJCXRoaXMubWFrZUVtcHR5KCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdmVjdG9yJGIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpICkgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHVwcGVyIGFuZCBsb3dlciBib3VuZHMgb2YgdGhpcyBib3ggc28gaXQgZW5jbG9zZXMgdGhlIHBvc2l0aW9uIGRhdGEKCQkgKiBpbiB0aGUgZ2l2ZW4gYXJyYXkuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBbiBhcnJheSBob2xkaW5nIDNEIHBvc2l0aW9uIGRhdGEgYXMgaW5zdGFuY2VzIG9mIHtAbGluayBWZWN0b3IzfS4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCQl0aGlzLm1ha2VFbXB0eSgpOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIHBvaW50c1sgaSBdICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDZW50ZXJzIHRoaXMgYm94IG9uIHRoZSBnaXZlbiBjZW50ZXIgdmVjdG9yIGFuZCBzZXRzIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQKCQkgKiBkZXB0aCB0byB0aGUgZ2l2ZW4gc2l6ZSB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGNlbnRlciAtIFRoZSBjZW50ZXIgb2YgdGhlIGJveC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHNpemUgLSBUaGUgeCwgeSBhbmQgeiBkaW1lbnNpb25zIG9mIHRoZSBib3guCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJc2V0RnJvbUNlbnRlckFuZFNpemUoIGNlbnRlciwgc2l6ZSApIHsKCgkJCWNvbnN0IGhhbGZTaXplID0gX3ZlY3RvciRiLmNvcHkoIHNpemUgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CgkJCXRoaXMubWF4LmNvcHkoIGNlbnRlciApLmFkZCggaGFsZlNpemUgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSB3b3JsZC1heGlzLWFsaWduZWQgYm91bmRpbmcgYm94IGZvciB0aGUgZ2l2ZW4gM0Qgb2JqZWN0CgkJICogKGluY2x1ZGluZyBpdHMgY2hpbGRyZW4pLCBhY2NvdW50aW5nIGZvciB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLAoJCSAqIHdvcmxkIHRyYW5zZm9ybXMuIFRoZSBmdW5jdGlvbiBtYXkgcmVzdWx0IGluIGEgbGFyZ2VyIGJveCB0aGFuIHN0cmljdGx5IG5lY2Vzc2FyeS4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gY29tcHV0ZSB0aGUgYm91bmRpbmcgYm94IGZvci4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtwcmVjaXNlPWZhbHNlXSAtIElmIHNldCB0byBgdHJ1ZWAsIHRoZSBtZXRob2QgY29tcHV0ZXMgdGhlIHNtYWxsZXN0CgkJICogd29ybGQtYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveCBhdCB0aGUgZXhwZW5zZSBvZiBtb3JlIGNvbXB1dGF0aW9uLgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCXNldEZyb21PYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKCQkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJCXJldHVybiB0aGlzLmV4cGFuZEJ5T2JqZWN0KCBvYmplY3QsIHByZWNpc2UgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IGJveCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7Qm94M30gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBib3ggdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBjb3B5LgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWNvcHkoIGJveCApIHsKCgkJCXRoaXMubWluLmNvcHkoIGJveC5taW4gKTsKCQkJdGhpcy5tYXguY29weSggYm94Lm1heCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTWFrZXMgdGhpcyBib3ggZW1wdHkgd2hpY2ggbWVhbnMgaW4gZW5jbG9zZXMgYSB6ZXJvIHNwYWNlIGluIDNELgoJCSAqCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJbWFrZUVtcHR5KCkgewoKCQkJdGhpcy5taW4ueCA9IHRoaXMubWluLnkgPSB0aGlzLm1pbi56ID0gKyBJbmZpbml0eTsKCQkJdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSB0aGlzLm1heC56ID0gLSBJbmZpbml0eTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGJveCBpbmNsdWRlcyB6ZXJvIHBvaW50cyB3aXRoaW4gaXRzIGJvdW5kcy4KCQkgKiBOb3RlIHRoYXQgYSBib3ggd2l0aCBlcXVhbCBsb3dlciBhbmQgdXBwZXIgYm91bmRzIHN0aWxsIGluY2x1ZGVzIG9uZQoJCSAqIHBvaW50LCB0aGUgb25lIGJvdGggYm91bmRzIHNoYXJlLgoJCSAqCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGJveCBpcyBlbXB0eSBvciBub3QuCgkJICovCgkJaXNFbXB0eSgpIHsKCgkJCS8vIHRoaXMgaXMgYSBtb3JlIHJvYnVzdCBjaGVjayBmb3IgZW1wdHkgdGhhbiAoIHZvbHVtZSA8PSAwICkgYmVjYXVzZSB2b2x1bWUgY2FuIGdldCBwb3NpdGl2ZSB3aXRoIHR3byBuZWdhdGl2ZSBheGVzCgoJCQlyZXR1cm4gKCB0aGlzLm1heC54IDwgdGhpcy5taW4ueCApIHx8ICggdGhpcy5tYXgueSA8IHRoaXMubWluLnkgKSB8fCAoIHRoaXMubWF4LnogPCB0aGlzLm1pbi56ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgY2VudGVyIHBvaW50IG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2VudGVyIHBvaW50LgoJCSAqLwoJCWdldENlbnRlciggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCwgMCApIDogdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMubWluLCB0aGlzLm1heCApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBkaW1lbnNpb25zIG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgc2l6ZS4KCQkgKi8KCQlnZXRTaXplKCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwLCAwICkgOiB0YXJnZXQuc3ViVmVjdG9ycyggdGhpcy5tYXgsIHRoaXMubWluICk7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIGJveCB0byBpbmNsdWRlIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdGhhdCBzaG91bGQgYmUgaW5jbHVkZWQgYnkgdGhlIGJvdW5kaW5nIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlleHBhbmRCeVBvaW50KCBwb2ludCApIHsKCgkJCXRoaXMubWluLm1pbiggcG9pbnQgKTsKCQkJdGhpcy5tYXgubWF4KCBwb2ludCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGlzIGJveCBlcXVpbGF0ZXJhbGx5IGJ5IHRoZSBnaXZlbiB2ZWN0b3IuIFRoZSB3aWR0aCBvZiB0aGlzCgkJICogYm94IHdpbGwgYmUgZXhwYW5kZWQgYnkgdGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgaW4gYm90aAoJCSAqIGRpcmVjdGlvbnMuIFRoZSBoZWlnaHQgb2YgdGhpcyBib3ggd2lsbCBiZSBleHBhbmRlZCBieSB0aGUgeSBjb21wb25lbnQgb2YKCQkgKiB0aGUgdmVjdG9yIGluIGJvdGggZGlyZWN0aW9ucy4gVGhlIGRlcHRoIG9mIHRoaXMgYm94IHdpbGwgYmUKCQkgKiBleHBhbmRlZCBieSB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBpbiBib3RoIGRpcmVjdGlvbnMuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZlY3RvciAtIFRoZSB2ZWN0b3IgdGhhdCBzaG91bGQgZXhwYW5kIHRoZSBib3VuZGluZyBib3guCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJZXhwYW5kQnlWZWN0b3IoIHZlY3RvciApIHsKCgkJCXRoaXMubWluLnN1YiggdmVjdG9yICk7CgkJCXRoaXMubWF4LmFkZCggdmVjdG9yICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBFeHBhbmRzIGVhY2ggZGltZW5zaW9uIG9mIHRoZSBib3ggYnkgdGhlIGdpdmVuIHNjYWxhci4gSWYgbmVnYXRpdmUsIHRoZQoJCSAqIGRpbWVuc2lvbnMgb2YgdGhlIGJveCB3aWxsIGJlIGNvbnRyYWN0ZWQuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc2NhbGFyIC0gVGhlIHNjYWxhciB2YWx1ZSB0aGF0IHNob3VsZCBleHBhbmQgdGhlIGJvdW5kaW5nIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlleHBhbmRCeVNjYWxhciggc2NhbGFyICkgewoKCQkJdGhpcy5taW4uYWRkU2NhbGFyKCAtIHNjYWxhciApOwoJCQl0aGlzLm1heC5hZGRTY2FsYXIoIHNjYWxhciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIGJveCB0byBpbmNsdWRlIHRoZSBnaXZlbiAzRCBvYmplY3QgYW5kCgkJICogaXRzIGNoaWxkcmVuLCBhY2NvdW50aW5nIGZvciB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZAoJCSAqIHRyYW5zZm9ybXMuIFRoZSBmdW5jdGlvbiBtYXkgcmVzdWx0IGluIGEgbGFyZ2VyIGJveCB0aGFuIHN0cmljdGx5CgkJICogbmVjZXNzYXJ5ICh1bmxlc3MgdGhlIHByZWNpc2UgcGFyYW1ldGVyIGlzIHNldCB0byB0cnVlKS4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdGhhdCBzaG91bGQgZXhwYW5kIHRoZSBib3VuZGluZyBib3guCgkJICogQHBhcmFtIHtib29sZWFufSBwcmVjaXNlIC0gSWYgc2V0IHRvIGB0cnVlYCwgdGhlIG1ldGhvZCBleHBhbmRzIHRoZSBib3VuZGluZyBib3gKCQkgKiBhcyBsaXR0bGUgYXMgbmVjZXNzYXJ5IGF0IHRoZSBleHBlbnNlIG9mIG1vcmUgY29tcHV0YXRpb24uCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJZXhwYW5kQnlPYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKCQkJLy8gQ29tcHV0ZXMgdGhlIHdvcmxkLWF4aXMtYWxpZ25lZCBib3VuZGluZyBib3ggb2YgYW4gb2JqZWN0IChpbmNsdWRpbmcgaXRzIGNoaWxkcmVuKSwKCQkJLy8gYWNjb3VudGluZyBmb3IgYm90aCB0aGUgb2JqZWN0J3MsIGFuZCBjaGlsZHJlbidzLCB3b3JsZCB0cmFuc2Zvcm1zCgoJCQlvYmplY3QudXBkYXRlV29ybGRNYXRyaXgoIGZhbHNlLCBmYWxzZSApOwoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIGdlb21ldHJ5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCgkJCQkvLyBwcmVjaXNlIEFBQkIgY29tcHV0YXRpb24gYmFzZWQgb24gdmVydGV4IGRhdGEgcmVxdWlyZXMgYXQgbGVhc3QgYSBwb3NpdGlvbiBhdHRyaWJ1dGUuCgkJCQkvLyBpbnN0YW5jaW5nIGlzbid0IHN1cHBvcnRlZCBzbyBmYXIgYW5kIHVzZXMgdGhlIG5vcm1hbCAoY29uc2VydmF0aXZlKSBjb2RlIHBhdGguCgoJCQkJaWYgKCBwcmVjaXNlID09PSB0cnVlICYmIHBvc2l0aW9uQXR0cmlidXRlICE9PSB1bmRlZmluZWQgJiYgb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJaWYgKCBvYmplY3QuaXNNZXNoID09PSB0cnVlICkgewoKCQkJCQkJCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggaSwgX3ZlY3RvciRiICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCV92ZWN0b3IkYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoKCQkJCQkJfQoKCQkJCQkJX3ZlY3RvciRiLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgkJCQkJCXRoaXMuZXhwYW5kQnlQb2ludCggX3ZlY3RvciRiICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ0JveCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJLy8gb2JqZWN0LWxldmVsIGJvdW5kaW5nIGJveAoKCQkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQkJCQkJb2JqZWN0LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJCQkJfQoKCQkJCQkJX2JveCQ0LmNvcHkoIG9iamVjdC5ib3VuZGluZ0JveCApOwoKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGdlb21ldHJ5LWxldmVsIGJvdW5kaW5nIGJveAoKCQkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCQkJCQlnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJCQkJCX0KCgkJCQkJCV9ib3gkNC5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApOwoKCQkJCQl9CgoJCQkJCV9ib3gkNC5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCQl0aGlzLnVuaW9uKCBfYm94JDQgKTsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdGhpcy5leHBhbmRCeU9iamVjdCggY2hpbGRyZW5bIGkgXSwgcHJlY2lzZSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50IGxpZXMgd2l0aGluIG9yIG9uIHRoZSBib3VuZGFyaWVzIG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGJvdW5kaW5nIGJveCBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIHBvaW50LnggPj0gdGhpcy5taW4ueCAmJiBwb2ludC54IDw9IHRoaXMubWF4LnggJiYKCQkJCXBvaW50LnkgPj0gdGhpcy5taW4ueSAmJiBwb2ludC55IDw9IHRoaXMubWF4LnkgJiYKCQkJCXBvaW50LnogPj0gdGhpcy5taW4ueiAmJiBwb2ludC56IDw9IHRoaXMubWF4Lno7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBib3VuZGluZyBib3ggaW5jbHVkZXMgdGhlIGVudGlyZXR5IG9mIHRoZSBnaXZlbiBib3VuZGluZyBib3guCgkJICogSWYgdGhpcyBib3ggYW5kIHRoZSBnaXZlbiBvbmUgYXJlIGlkZW50aWNhbCwgdGhpcyBmdW5jdGlvbiBhbHNvIHJldHVybnMgYHRydWVgLgoJCSAqCgkJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm91bmRpbmcgYm94IHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgYm91bmRpbmcgYm94IGNvbnRhaW5zIHRoZSBnaXZlbiBib3VuZGluZyBib3ggb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zQm94KCBib3ggKSB7CgoJCQlyZXR1cm4gdGhpcy5taW4ueCA8PSBib3gubWluLnggJiYgYm94Lm1heC54IDw9IHRoaXMubWF4LnggJiYKCQkJCXRoaXMubWluLnkgPD0gYm94Lm1pbi55ICYmIGJveC5tYXgueSA8PSB0aGlzLm1heC55ICYmCgkJCQl0aGlzLm1pbi56IDw9IGJveC5taW4ueiAmJiBib3gubWF4LnogPD0gdGhpcy5tYXguejsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgcG9pbnQgYXMgYSBwcm9wb3J0aW9uIG9mIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQgZGVwdGguCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBwb2ludCBpbiAzRCBzcGFjZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IEEgcG9pbnQgYXMgYSBwcm9wb3J0aW9uIG9mIHRoaXMgYm94J3Mgd2lkdGgsIGhlaWdodCBhbmQgZGVwdGguCgkJICovCgkJZ2V0UGFyYW1ldGVyKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkJLy8gVGhpcyBjYW4gcG90ZW50aWFsbHkgaGF2ZSBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBib3gKCQkJLy8gaGFzIGEgc2l6ZSBkaW1lbnNpb24gb2YgMC4KCgkJCXJldHVybiB0YXJnZXQuc2V0KAoJCQkJKCBwb2ludC54IC0gdGhpcy5taW4ueCApIC8gKCB0aGlzLm1heC54IC0gdGhpcy5taW4ueCApLAoJCQkJKCBwb2ludC55IC0gdGhpcy5taW4ueSApIC8gKCB0aGlzLm1heC55IC0gdGhpcy5taW4ueSApLAoJCQkJKCBwb2ludC56IC0gdGhpcy5taW4ueiApIC8gKCB0aGlzLm1heC56IC0gdGhpcy5taW4ueiApCgkJCSk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIGJveCBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWludGVyc2VjdHNCb3goIGJveCApIHsKCgkJCS8vIHVzaW5nIDYgc3BsaXR0aW5nIHBsYW5lcyB0byBydWxlIG91dCBpbnRlcnNlY3Rpb25zLgoJCQlyZXR1cm4gYm94Lm1heC54ID49IHRoaXMubWluLnggJiYgYm94Lm1pbi54IDw9IHRoaXMubWF4LnggJiYKCQkJCWJveC5tYXgueSA+PSB0aGlzLm1pbi55ICYmIGJveC5taW4ueSA8PSB0aGlzLm1heC55ICYmCgkJCQlib3gubWF4LnogPj0gdGhpcy5taW4ueiAmJiBib3gubWluLnogPD0gdGhpcy5tYXguejsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKgoJCSAqIEBwYXJhbSB7U3BoZXJlfSBzcGhlcmUgLSBUaGUgYm91bmRpbmcgc3BoZXJlIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQkvLyBGaW5kIHRoZSBwb2ludCBvbiB0aGUgQUFCQiBjbG9zZXN0IHRvIHRoZSBzcGhlcmUgY2VudGVyLgoJCQl0aGlzLmNsYW1wUG9pbnQoIHNwaGVyZS5jZW50ZXIsIF92ZWN0b3IkYiApOwoKCQkJLy8gSWYgdGhhdCBwb2ludCBpcyBpbnNpZGUgdGhlIHNwaGVyZSwgdGhlIEFBQkIgYW5kIHNwaGVyZSBpbnRlcnNlY3QuCgkJCXJldHVybiBfdmVjdG9yJGIuZGlzdGFuY2VUb1NxdWFyZWQoIHNwaGVyZS5jZW50ZXIgKSA8PSAoIHNwaGVyZS5yYWRpdXMgKiBzcGhlcmUucmFkaXVzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBsYW5lIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcGxhbmUgaW50ZXJzZWN0cyB3aXRoIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWludGVyc2VjdHNQbGFuZSggcGxhbmUgKSB7CgoJCQkvLyBXZSBjb21wdXRlIHRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGRvdCBwcm9kdWN0IHZhbHVlcy4gSWYgdGhvc2UgdmFsdWVzCgkJCS8vIGFyZSBvbiB0aGUgc2FtZSBzaWRlIChiYWNrIG9yIGZyb250KSBvZiB0aGUgcGxhbmUsIHRoZW4gdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoKCQkJbGV0IG1pbiwgbWF4OwoKCQkJaWYgKCBwbGFuZS5ub3JtYWwueCA+IDAgKSB7CgoJCQkJbWluID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwoJCQkJbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1heC54OwoKCQkJfSBlbHNlIHsKCgkJCQltaW4gPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWF4Lng7CgkJCQltYXggPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWluLng7CgoJCQl9CgoJCQlpZiAoIHBsYW5lLm5vcm1hbC55ID4gMCApIHsKCgkJCQltaW4gKz0gcGxhbmUubm9ybWFsLnkgKiB0aGlzLm1pbi55OwoJCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCgkJCX0gZWxzZSB7CgoJCQkJbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCQkJCW1heCArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWluLnk7CgoJCQl9CgoJCQlpZiAoIHBsYW5lLm5vcm1hbC56ID4gMCApIHsKCgkJCQltaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwoJCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKCgkJCX0gZWxzZSB7CgoJCQkJbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKCQkJCW1heCArPSBwbGFuZS5ub3JtYWwueiAqIHRoaXMubWluLno7CgoJCQl9CgoJCQlyZXR1cm4gKCBtaW4gPD0gLSBwbGFuZS5jb25zdGFudCAmJiBtYXggPj0gLSBwbGFuZS5jb25zdGFudCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhpcyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge1RyaWFuZ2xlfSB0cmlhbmdsZSAtIFRoZSB0cmlhbmdsZSB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIHRyaWFuZ2xlIGludGVyc2VjdHMgd2l0aCB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlpbnRlcnNlY3RzVHJpYW5nbGUoIHRyaWFuZ2xlICkgewoKCQkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQkvLyBjb21wdXRlIGJveCBjZW50ZXIgYW5kIGV4dGVudHMKCQkJdGhpcy5nZXRDZW50ZXIoIF9jZW50ZXIgKTsKCQkJX2V4dGVudHMuc3ViVmVjdG9ycyggdGhpcy5tYXgsIF9jZW50ZXIgKTsKCgkJCS8vIHRyYW5zbGF0ZSB0cmlhbmdsZSB0byBhYWJiIG9yaWdpbgoJCQlfdjAkMi5zdWJWZWN0b3JzKCB0cmlhbmdsZS5hLCBfY2VudGVyICk7CgkJCV92MSQ3LnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmIsIF9jZW50ZXIgKTsKCQkJX3YyJDQuc3ViVmVjdG9ycyggdHJpYW5nbGUuYywgX2NlbnRlciApOwoKCQkJLy8gY29tcHV0ZSBlZGdlIHZlY3RvcnMgZm9yIHRyaWFuZ2xlCgkJCV9mMC5zdWJWZWN0b3JzKCBfdjEkNywgX3YwJDIgKTsKCQkJX2YxLnN1YlZlY3RvcnMoIF92MiQ0LCBfdjEkNyApOwoJCQlfZjIuc3ViVmVjdG9ycyggX3YwJDIsIF92MiQ0ICk7CgoJCQkvLyB0ZXN0IGFnYWluc3QgYXhlcyB0aGF0IGFyZSBnaXZlbiBieSBjcm9zcyBwcm9kdWN0IGNvbWJpbmF0aW9ucyBvZiB0aGUgZWRnZXMgb2YgdGhlIHRyaWFuZ2xlIGFuZCB0aGUgZWRnZXMgb2YgdGhlIGFhYmIKCQkJLy8gbWFrZSBhbiBheGlzIHRlc3Rpbmcgb2YgZWFjaCBvZiB0aGUgMyBzaWRlcyBvZiB0aGUgYWFiYiBhZ2FpbnN0IGVhY2ggb2YgdGhlIDMgc2lkZXMgb2YgdGhlIHRyaWFuZ2xlID0gOSBheGlzIG9mIHNlcGFyYXRpb24KCQkJLy8gYXhpc19paiA9IHVfaSB4IGZfaiAodTAsIHUxLCB1MiA9IGZhY2Ugbm9ybWFscyBvZiBhYWJiID0geCx5LHogYXhlcyB2ZWN0b3JzIHNpbmNlIGFhYmIgaXMgYXhpcyBhbGlnbmVkKQoJCQlsZXQgYXhlcyA9IFsKCQkJCTAsIC0gX2YwLnosIF9mMC55LCAwLCAtIF9mMS56LCBfZjEueSwgMCwgLSBfZjIueiwgX2YyLnksCgkJCQlfZjAueiwgMCwgLSBfZjAueCwgX2YxLnosIDAsIC0gX2YxLngsIF9mMi56LCAwLCAtIF9mMi54LAoJCQkJLSBfZjAueSwgX2YwLngsIDAsIC0gX2YxLnksIF9mMS54LCAwLCAtIF9mMi55LCBfZjIueCwgMAoJCQldOwoJCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQkvLyB0ZXN0IDMgZmFjZSBub3JtYWxzIGZyb20gdGhlIGFhYmIKCQkJYXhlcyA9IFsgMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSBdOwoJCQlpZiAoICEgc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKSApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQkvLyBmaW5hbGx5IHRlc3RpbmcgdGhlIGZhY2Ugbm9ybWFsIG9mIHRoZSB0cmlhbmdsZQoJCQkvLyB1c2UgYWxyZWFkeSBleGlzdGluZyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMgaGVyZQoJCQlfdHJpYW5nbGVOb3JtYWwuY3Jvc3NWZWN0b3JzKCBfZjAsIF9mMSApOwoJCQlheGVzID0gWyBfdHJpYW5nbGVOb3JtYWwueCwgX3RyaWFuZ2xlTm9ybWFsLnksIF90cmlhbmdsZU5vcm1hbC56IF07CgoJCQlyZXR1cm4gc2F0Rm9yQXhlcyggYXhlcywgX3YwJDIsIF92MSQ3LCBfdjIkNCwgX2V4dGVudHMgKTsKCgkJfQoKCQkvKioKCQkgKiBDbGFtcHMgdGhlIGdpdmVuIHBvaW50IHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoaXMgYm94LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjbGFtcC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjbGFtcGVkIHBvaW50LgoJCSAqLwoJCWNsYW1wUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuY2xhbXAoIHRoaXMubWluLCB0aGlzLm1heCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGV1Y2xpZGVhbiBkaXN0YW5jZSBmcm9tIGFueSBlZGdlIG9mIHRoaXMgYm94IHRvIHRoZSBzcGVjaWZpZWQgcG9pbnQuIElmCgkJICogdGhlIGdpdmVuIHBvaW50IGxpZXMgaW5zaWRlIG9mIHRoaXMgYm94LCB0aGUgZGlzdGFuY2Ugd2lsbCBiZSBgMGAuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGV1Y2xpZGVhbiBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIHRoaXMuY2xhbXBQb2ludCggcG9pbnQsIF92ZWN0b3IkYiApLmRpc3RhbmNlVG8oIHBvaW50ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIGJvdW5kaW5nIHNwaGVyZSB0aGF0IGVuY2xvc2VzIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHRhcmdldCAtIFRoZSB0YXJnZXQgc3BoZXJlIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gVGhlIGJvdW5kaW5nIHNwaGVyZSB0aGF0IGVuY2xvc2VzIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWdldEJvdW5kaW5nU3BoZXJlKCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJCXRhcmdldC5tYWtlRW1wdHkoKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhpcy5nZXRDZW50ZXIoIHRhcmdldC5jZW50ZXIgKTsKCgkJCQl0YXJnZXQucmFkaXVzID0gdGhpcy5nZXRTaXplKCBfdmVjdG9yJGIgKS5sZW5ndGgoKSAqIDAuNTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGludGVyc2VjdGlvbiBvZiB0aGlzIGJvdW5kaW5nIGJveCBhbmQgdGhlIGdpdmVuIG9uZSwgc2V0dGluZyB0aGUgdXBwZXIKCQkgKiBib3VuZCBvZiB0aGlzIGJveCB0byB0aGUgbGVzc2VyIG9mIHRoZSB0d28gYm94ZXMnIHVwcGVyIGJvdW5kcyBhbmQgdGhlCgkJICogbG93ZXIgYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGdyZWF0ZXIgb2YgdGhlIHR3byBib3hlcycgbG93ZXIgYm91bmRzLiBJZgoJCSAqIHRoZXJlJ3Mgbm8gb3ZlcmxhcCwgbWFrZXMgdGhpcyBib3ggZW1wdHkuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gaW50ZXJzZWN0IHdpdGguCgkJICogQHJldHVybiB7Qm94M30gQSByZWZlcmVuY2UgdG8gdGhpcyBib3VuZGluZyBib3guCgkJICovCgkJaW50ZXJzZWN0KCBib3ggKSB7CgoJCQl0aGlzLm1pbi5tYXgoIGJveC5taW4gKTsKCQkJdGhpcy5tYXgubWluKCBib3gubWF4ICk7CgoJCQkvLyBlbnN1cmUgdGhhdCBpZiB0aGVyZSBpcyBubyBvdmVybGFwLCB0aGUgcmVzdWx0IGlzIGZ1bGx5IGVtcHR5LCBub3Qgc2xpZ2h0bHkgZW1wdHkgd2l0aCBub24taW5mLytpbmYgdmFsdWVzIHRoYXQgd2lsbCBjYXVzZSBzdWJzZXF1ZW5jZSBpbnRlcnNlY3RzIHRvIGVycm9uZW91c2x5IHJldHVybiB2YWxpZCB2YWx1ZXMuCgkJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB0aGlzLm1ha2VFbXB0eSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHVuaW9uIG9mIHRoaXMgYm94IGFuZCBhbm90aGVyIGFuZCB0aGUgZ2l2ZW4gb25lLCBzZXR0aW5nIHRoZSB1cHBlcgoJCSAqIGJvdW5kIG9mIHRoaXMgYm94IHRvIHRoZSBncmVhdGVyIG9mIHRoZSB0d28gYm94ZXMnIHVwcGVyIGJvdW5kcyBhbmQgdGhlCgkJICogbG93ZXIgYm91bmQgb2YgdGhpcyBib3ggdG8gdGhlIGxlc3NlciBvZiB0aGUgdHdvIGJveGVzJyBsb3dlciBib3VuZHMuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdGhhdCB3aWxsIGJlIHVuaW9uZWQgd2l0aCB0aGlzIGluc3RhbmNlLgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCXVuaW9uKCBib3ggKSB7CgoJCQl0aGlzLm1pbi5taW4oIGJveC5taW4gKTsKCQkJdGhpcy5tYXgubWF4KCBib3gubWF4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2Zvcm1zIHRoaXMgYm91bmRpbmcgYm94IGJ5IHRoZSBnaXZlbiA0eDQgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtYXRyaXggLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqIEByZXR1cm4ge0JveDN9IEEgcmVmZXJlbmNlIHRvIHRoaXMgYm91bmRpbmcgYm94LgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKCQkJLy8gdHJhbnNmb3JtIG9mIGVtcHR5IGJveCBpcyBhbiBlbXB0eSBib3guCgkJCWlmICggdGhpcy5pc0VtcHR5KCkgKSByZXR1cm4gdGhpczsKCgkJCS8vIE5PVEU6IEkgYW0gdXNpbmcgYSBiaW5hcnkgcGF0dGVybiB0byBzcGVjaWZ5IGFsbCAyXjMgY29tYmluYXRpb25zIGJlbG93CgkJCV9wb2ludHNbIDAgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWluLnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMDAKCQkJX3BvaW50c1sgMSBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5taW4ueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAwMQoJCQlfcG9pbnRzWyAyIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1heC55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDEwCgkJCV9wb2ludHNbIDMgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWF4LnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMTEKCQkJX3BvaW50c1sgNCBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5taW4ueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDEwMAoJCQlfcG9pbnRzWyA1IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAxCgkJCV9wb2ludHNbIDYgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWF4LnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMTAKCQkJX3BvaW50c1sgNyBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5tYXgueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDExMQoKCQkJdGhpcy5zZXRGcm9tUG9pbnRzKCBfcG9pbnRzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiBvZmZzZXQgdG8gYm90aCB0aGUgdXBwZXIgYW5kIGxvd2VyIGJvdW5kcyBvZiB0aGlzIGJvdW5kaW5nIGJveCwKCQkgKiBlZmZlY3RpdmVseSBtb3ZpbmcgaXQgaW4gM0Qgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQgdGhhdCBzaG91bGQgYmUgdXNlZCB0byB0cmFuc2xhdGUgdGhlIGJvdW5kaW5nIGJveC4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQl0cmFuc2xhdGUoIG9mZnNldCApIHsKCgkJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CgkJCXRoaXMubWF4LmFkZCggb2Zmc2V0ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGJvdW5kaW5nIGJveCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIGJvdW5kaW5nIGJveCBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCBib3ggKSB7CgoJCQlyZXR1cm4gYm94Lm1pbi5lcXVhbHMoIHRoaXMubWluICkgJiYgYm94Lm1heC5lcXVhbHMoIHRoaXMubWF4ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcmV0dXJuIHtPYmplY3R9IFNlcmlhbGl6ZWQgc3RydWN0dXJlIHdpdGggZmllbGRzIHJlcHJlc2VudGluZyB0aGUgb2JqZWN0IHN0YXRlLgoJCSAqLwoJCXRvSlNPTigpIHsKCgkJCXJldHVybiB7CgkJCQltaW46IHRoaXMubWluLnRvQXJyYXkoKSwKCQkJCW1heDogdGhpcy5tYXgudG9BcnJheSgpCgkJCX07CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0ganNvbiAtIFRoZSBzZXJpYWxpemVkIGpzb24gdG8gc2V0IHRoZSBib3ggZnJvbS4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIGJveC4KCQkgKi8KCQlmcm9tSlNPTigganNvbiApIHsKCgkJCXRoaXMubWluLmZyb21BcnJheSgganNvbi5taW4gKTsKCQkJdGhpcy5tYXguZnJvbUFycmF5KCBqc29uLm1heCApOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgljb25zdCBfcG9pbnRzID0gWwoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkKCV07CgoJY29uc3QgX3ZlY3RvciRiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCWNvbnN0IF9ib3gkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKCgkvLyB0cmlhbmdsZSBjZW50ZXJlZCB2ZXJ0aWNlcwoKCWNvbnN0IF92MCQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3YxJDcgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdjIkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvLyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMKCgljb25zdCBfZjAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZjEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX2NlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9leHRlbnRzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3RyaWFuZ2xlTm9ybWFsID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3Rlc3RBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCWZ1bmN0aW9uIHNhdEZvckF4ZXMoIGF4ZXMsIHYwLCB2MSwgdjIsIGV4dGVudHMgKSB7CgoJCWZvciAoIGxldCBpID0gMCwgaiA9IGF4ZXMubGVuZ3RoIC0gMzsgaSA8PSBqOyBpICs9IDMgKSB7CgoJCQlfdGVzdEF4aXMuZnJvbUFycmF5KCBheGVzLCBpICk7CgkJCS8vIHByb2plY3QgdGhlIGFhYmIgb250byB0aGUgc2VwYXJhdGluZyBheGlzCgkJCWNvbnN0IHIgPSBleHRlbnRzLnggKiBNYXRoLmFicyggX3Rlc3RBeGlzLnggKSArIGV4dGVudHMueSAqIE1hdGguYWJzKCBfdGVzdEF4aXMueSApICsgZXh0ZW50cy56ICogTWF0aC5hYnMoIF90ZXN0QXhpcy56ICk7CgkJCS8vIHByb2plY3QgYWxsIDMgdmVydGljZXMgb2YgdGhlIHRyaWFuZ2xlIG9udG8gdGhlIHNlcGFyYXRpbmcgYXhpcwoJCQljb25zdCBwMCA9IHYwLmRvdCggX3Rlc3RBeGlzICk7CgkJCWNvbnN0IHAxID0gdjEuZG90KCBfdGVzdEF4aXMgKTsKCQkJY29uc3QgcDIgPSB2Mi5kb3QoIF90ZXN0QXhpcyApOwoJCQkvLyBhY3R1YWwgdGVzdCwgYmFzaWNhbGx5IHNlZSBpZiBlaXRoZXIgb2YgdGhlIG1vc3QgZXh0cmVtZSBvZiB0aGUgdHJpYW5nbGUgcG9pbnRzIGludGVyc2VjdHMgcgoJCQlpZiAoIE1hdGgubWF4KCAtIE1hdGgubWF4KCBwMCwgcDEsIHAyICksIE1hdGgubWluKCBwMCwgcDEsIHAyICkgKSA+IHIgKSB7CgoJCQkJLy8gcG9pbnRzIG9mIHRoZSBwcm9qZWN0ZWQgdHJpYW5nbGUgYXJlIG91dHNpZGUgdGhlIHByb2plY3RlZCBoYWxmLWxlbmd0aCBvZiB0aGUgYWFiYgoJCQkJLy8gdGhlIGF4aXMgaXMgc2VwYXJhdGluZyBhbmQgd2UgY2FuIGV4aXQKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJY29uc3QgX2JveCQzID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwoJY29uc3QgX3YxJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdjIkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIEFuIGFuYWx5dGljYWwgM0Qgc3BoZXJlIGRlZmluZWQgYnkgYSBjZW50ZXIgYW5kIHJhZGl1cy4gVGhpcyBjbGFzcyBpcyBtYWlubHkKCSAqIHVzZWQgYXMgYSBCb3VuZGluZyBTcGhlcmUgZm9yIDNEIG9iamVjdHMuCgkgKi8KCWNsYXNzIFNwaGVyZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgc3BoZXJlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbY2VudGVyPSgwLDAsMCldIC0gVGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgkJICogQHBhcmFtIHtudW1iZXJ9IFtyYWRpdXM9LTFdIC0gVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpLCByYWRpdXMgPSAtMSApIHsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzU3BoZXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUKCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLmNlbnRlciA9IGNlbnRlcjsKCgkJCS8qKgoJCQkgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqLwoJCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBzcGhlcmUncyBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gY2VudGVyIC0gVGhlIGNlbnRlci4KCQkgKiBAcGFyYW0ge251bWJlcn0gcmFkaXVzIC0gVGhlIHJhZGl1cy4KCQkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgoJCSAqLwoJCXNldCggY2VudGVyLCByYWRpdXMgKSB7CgoJCQl0aGlzLmNlbnRlci5jb3B5KCBjZW50ZXIgKTsKCQkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgbWluaW11bSBib3VuZGluZyBzcGhlcmUgZm9yIGxpc3Qgb2YgcG9pbnRzLgoJCSAqIElmIHRoZSBvcHRpb25hbCBjZW50ZXIgcG9pbnQgaXMgZ2l2ZW4sIGl0IGlzIHVzZWQgYXMgdGhlIHNwaGVyZSdzCgkJICogY2VudGVyLiBPdGhlcndpc2UsIHRoZSBjZW50ZXIgb2YgdGhlIGF4aXMtYWxpZ25lZCBib3VuZGluZyBib3gKCQkgKiBlbmNvbXBhc3NpbmcgdGhlIHBvaW50cyBpcyBjYWxjdWxhdGVkLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxWZWN0b3IzPn0gcG9pbnRzIC0gQSBsaXN0IG9mIHBvaW50cyBpbiAzRCBzcGFjZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbENlbnRlcl0gLSBUaGUgY2VudGVyIG9mIHRoZSBzcGhlcmUuCgkJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KCQkgKi8KCQlzZXRGcm9tUG9pbnRzKCBwb2ludHMsIG9wdGlvbmFsQ2VudGVyICkgewoKCQkJY29uc3QgY2VudGVyID0gdGhpcy5jZW50ZXI7CgoJCQlpZiAoIG9wdGlvbmFsQ2VudGVyICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY2VudGVyLmNvcHkoIG9wdGlvbmFsQ2VudGVyICk7CgoJCQl9IGVsc2UgewoKCQkJCV9ib3gkMy5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKS5nZXRDZW50ZXIoIGNlbnRlciApOwoKCQkJfQoKCQkJbGV0IG1heFJhZGl1c1NxID0gMDsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnRzWyBpIF0gKSApOwoKCQkJfQoKCQkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gc3BoZXJlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBjb3B5LgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJY29weSggc3BoZXJlICkgewoKCQkJdGhpcy5jZW50ZXIuY29weSggc3BoZXJlLmNlbnRlciApOwoJCQl0aGlzLnJhZGl1cyA9IHNwaGVyZS5yYWRpdXM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc3BoZXJlIGlzIGVtcHR5ICh0aGUgcmFkaXVzIHNldCB0byBhIG5lZ2F0aXZlIG51bWJlcikuCgkJICoKCQkgKiBTcGhlcmVzIHdpdGggYSByYWRpdXMgb2YgYDBgIGNvbnRhaW4gb25seSB0aGVpciBjZW50ZXIgcG9pbnQgYW5kIGFyZSBub3QKCQkgKiBjb25zaWRlcmVkIHRvIGJlIGVtcHR5LgoJCSAqCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpcyBlbXB0eSBvciBub3QuCgkJICovCgkJaXNFbXB0eSgpIHsKCgkJCXJldHVybiAoIHRoaXMucmFkaXVzIDwgMCApOwoKCQl9CgoJCS8qKgoJCSAqIE1ha2VzIHRoaXMgc3BoZXJlIGVtcHR5IHdoaWNoIG1lYW5zIGluIGVuY2xvc2VzIGEgemVybyBzcGFjZSBpbiAzRC4KCQkgKgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJbWFrZUVtcHR5KCkgewoKCQkJdGhpcy5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJCXRoaXMucmFkaXVzID0gLTE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgaW5jbHVzaXZlIG9mCgkJICogdGhlIHN1cmZhY2Ugb2YgdGhlIHNwaGVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY2hlY2suCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBjb250YWlucyB0aGUgZ2l2ZW4gcG9pbnQgb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuY2VudGVyICkgPD0gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBjbG9zZXN0IGRpc3RhbmNlIGZyb20gdGhlIGJvdW5kYXJ5IG9mIHRoZSBzcGhlcmUgdG8gdGhlCgkJICogZ2l2ZW4gcG9pbnQuIElmIHRoZSBzcGhlcmUgY29udGFpbnMgdGhlIHBvaW50LCB0aGUgZGlzdGFuY2Ugd2lsbAoJCSAqIGJlIG5lZ2F0aXZlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkaXN0YW5jZSB0byB0aGUgcG9pbnQuCgkJICovCgkJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJCXJldHVybiAoIHBvaW50LmRpc3RhbmNlVG8oIHRoaXMuY2VudGVyICkgLSB0aGlzLnJhZGl1cyApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gb25lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQljb25zdCByYWRpdXNTdW0gPSB0aGlzLnJhZGl1cyArIHNwaGVyZS5yYWRpdXM7CgoJCQlyZXR1cm4gc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHJhZGl1c1N1bSAqIHJhZGl1c1N1bSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gYm94LgoJCSAqCgkJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzU3BoZXJlKCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBzcGhlcmUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQkJcmV0dXJuIE1hdGguYWJzKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMuY2VudGVyICkgKSA8PSB0aGlzLnJhZGl1czsKCgkJfQoKCQkvKioKCQkgKiBDbGFtcHMgYSBwb2ludCB3aXRoaW4gdGhlIHNwaGVyZS4gSWYgdGhlIHBvaW50IGlzIG91dHNpZGUgdGhlIHNwaGVyZSwgaXQKCQkgKiB3aWxsIGNsYW1wIGl0IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBlZGdlIG9mIHRoZSBzcGhlcmUuIFBvaW50cwoJCSAqIGFscmVhZHkgaW5zaWRlIHRoZSBzcGhlcmUgd2lsbCBub3QgYmUgYWZmZWN0ZWQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBsYW5lIHRvIGNsYW1wLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsYW1wZWQgcG9pbnQuCgkJICovCgkJY2xhbXBQb2ludCggcG9pbnQsIHRhcmdldCApIHsKCgkJCWNvbnN0IGRlbHRhTGVuZ3RoU3EgPSB0aGlzLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCgkJCXRhcmdldC5jb3B5KCBwb2ludCApOwoKCQkJaWYgKCBkZWx0YUxlbmd0aFNxID4gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKSB7CgoJCQkJdGFyZ2V0LnN1YiggdGhpcy5jZW50ZXIgKS5ub3JtYWxpemUoKTsKCQkJCXRhcmdldC5tdWx0aXBseVNjYWxhciggdGhpcy5yYWRpdXMgKS5hZGQoIHRoaXMuY2VudGVyICk7CgoJCQl9CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBib3VuZGluZyBib3ggdGhhdCBlbmNsb3NlcyB0aGlzIHNwaGVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7Qm94M30gdGFyZ2V0IC0gVGhlIHRhcmdldCBib3ggdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7Qm94M30gVGhlIGJvdW5kaW5nIGJveCB0aGF0IGVuY2xvc2VzIHRoaXMgc3BoZXJlLgoJCSAqLwoJCWdldEJvdW5kaW5nQm94KCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJCS8vIEVtcHR5IHNwaGVyZSBwcm9kdWNlcyBlbXB0eSBib3VuZGluZyBib3gKCQkJCXRhcmdldC5tYWtlRW1wdHkoKTsKCQkJCXJldHVybiB0YXJnZXQ7CgoJCQl9CgoJCQl0YXJnZXQuc2V0KCB0aGlzLmNlbnRlciwgdGhpcy5jZW50ZXIgKTsKCQkJdGFyZ2V0LmV4cGFuZEJ5U2NhbGFyKCB0aGlzLnJhZGl1cyApOwoKCQkJcmV0dXJuIHRhcmdldDsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2Zvcm1zIHRoaXMgc3BoZXJlIHdpdGggdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICogQHJldHVybiB7U3BoZXJlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHNwaGVyZS4KCQkgKi8KCQlhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJCXRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgkJCXRoaXMucmFkaXVzID0gdGhpcy5yYWRpdXMgKiBtYXRyaXguZ2V0TWF4U2NhbGVPbkF4aXMoKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFRyYW5zbGF0ZXMgdGhlIHNwaGVyZSdzIGNlbnRlciBieSB0aGUgZ2l2ZW4gb2Zmc2V0LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBvZmZzZXQgLSBUaGUgb2Zmc2V0LgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgoJCQl0aGlzLmNlbnRlci5hZGQoIG9mZnNldCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXhwYW5kcyB0aGUgYm91bmRhcmllcyBvZiB0aGlzIHNwaGVyZSB0byBpbmNsdWRlIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gaW5jbHVkZS4KCQkgKiBAcmV0dXJuIHtTcGhlcmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgc3BoZXJlLgoJCSAqLwoJCWV4cGFuZEJ5UG9pbnQoIHBvaW50ICkgewoKCQkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCQl0aGlzLmNlbnRlci5jb3B5KCBwb2ludCApOwoKCQkJCXRoaXMucmFkaXVzID0gMDsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCV92MSQ2LnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLmNlbnRlciApOwoKCQkJY29uc3QgbGVuZ3RoU3EgPSBfdjEkNi5sZW5ndGhTcSgpOwoKCQkJaWYgKCBsZW5ndGhTcSA+ICggdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyApICkgewoKCQkJCS8vIGNhbGN1bGF0ZSB0aGUgbWluaW1hbCBzcGhlcmUKCgkJCQljb25zdCBsZW5ndGggPSBNYXRoLnNxcnQoIGxlbmd0aFNxICk7CgoJCQkJY29uc3QgZGVsdGEgPSAoIGxlbmd0aCAtIHRoaXMucmFkaXVzICkgKiAwLjU7CgoJCQkJdGhpcy5jZW50ZXIuYWRkU2NhbGVkVmVjdG9yKCBfdjEkNiwgZGVsdGEgLyBsZW5ndGggKTsKCgkJCQl0aGlzLnJhZGl1cyArPSBkZWx0YTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEV4cGFuZHMgdGhpcyBzcGhlcmUgdG8gZW5jbG9zZSBib3RoIHRoZSBvcmlnaW5hbCBzcGhlcmUgYW5kIHRoZSBnaXZlbiBzcGhlcmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbmNsdWRlLgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBzcGhlcmUuCgkJICovCgkJdW5pb24oIHNwaGVyZSApIHsKCgkJCWlmICggc3BoZXJlLmlzRW1wdHkoKSApIHsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB7CgoJCQkJdGhpcy5jb3B5KCBzcGhlcmUgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggdGhpcy5jZW50ZXIuZXF1YWxzKCBzcGhlcmUuY2VudGVyICkgPT09IHRydWUgKSB7CgoJCQkJIHRoaXMucmFkaXVzID0gTWF0aC5tYXgoIHRoaXMucmFkaXVzLCBzcGhlcmUucmFkaXVzICk7CgoJCQl9IGVsc2UgewoKCQkJCV92MiQzLnN1YlZlY3RvcnMoIHNwaGVyZS5jZW50ZXIsIHRoaXMuY2VudGVyICkuc2V0TGVuZ3RoKCBzcGhlcmUucmFkaXVzICk7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuYWRkKCBfdjIkMyApICk7CgoJCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuc3ViKCBfdjIkMyApICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHNwaGVyZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgc3BoZXJlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIHNwaGVyZSApIHsKCgkJCXJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyggdGhpcy5jZW50ZXIgKSAmJiAoIHNwaGVyZS5yYWRpdXMgPT09IHRoaXMucmFkaXVzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBzcGhlcmUgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge1NwaGVyZX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBzZXJpYWxpemVkIHN0cnVjdHVyZSBvZiB0aGUgYm91bmRpbmcgc3BoZXJlLgoJCSAqCgkJICogQHJldHVybiB7T2JqZWN0fSBTZXJpYWxpemVkIHN0cnVjdHVyZSB3aXRoIGZpZWxkcyByZXByZXNlbnRpbmcgdGhlIG9iamVjdCBzdGF0ZS4KCQkgKi8KCQl0b0pTT04oKSB7CgoJCQlyZXR1cm4gewoJCQkJcmFkaXVzOiB0aGlzLnJhZGl1cywKCQkJCWNlbnRlcjogdGhpcy5jZW50ZXIudG9BcnJheSgpCgkJCX07CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgc3RydWN0dXJlIG9mIHRoZSBib3VuZGluZyBzcGhlcmUuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0ganNvbiAtIFRoZSBzZXJpYWxpemVkIGpzb24gdG8gc2V0IHRoZSBzcGhlcmUgZnJvbS4KCQkgKiBAcmV0dXJuIHtCb3gzfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJvdW5kaW5nIHNwaGVyZS4KCQkgKi8KCQlmcm9tSlNPTigganNvbiApIHsKCgkJCXRoaXMucmFkaXVzID0ganNvbi5yYWRpdXM7CgkJCXRoaXMuY2VudGVyLmZyb21BcnJheSgganNvbi5jZW50ZXIgKTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9CgoJY29uc3QgX3ZlY3RvciRhID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3NlZ0NlbnRlciA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9zZWdEaXIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZGlmZiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfZWRnZTEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfZWRnZTIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfbm9ybWFsJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJLyoqCgkgKiBBIHJheSB0aGF0IGVtaXRzIGZyb20gYW4gb3JpZ2luIGluIGEgY2VydGFpbiBkaXJlY3Rpb24uIFRoZSBjbGFzcyBpcyB1c2VkIGJ5CgkgKiB7QGxpbmsgUmF5Y2FzdGVyfSB0byBhc3Npc3Qgd2l0aCByYXljYXN0aW5nLiBSYXljYXN0aW5nIGlzIHVzZWQgZm9yCgkgKiBtb3VzZSBwaWNraW5nICh3b3JraW5nIG91dCB3aGF0IG9iamVjdHMgaW4gdGhlIDNEIHNwYWNlIHRoZSBtb3VzZSBpcyBvdmVyKQoJICogYW1vbmdzdCBvdGhlciB0aGluZ3MuCgkgKi8KCWNsYXNzIFJheSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgcmF5LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbb3JpZ2luPSgwLDAsMCldIC0gVGhlIG9yaWdpbiBvZiB0aGUgcmF5LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gW2RpcmVjdGlvbj0oMCwwLC0xKV0gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiBvZiB0aGUgcmF5LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBvcmlnaW4gPSBuZXcgVmVjdG9yMygpLCBkaXJlY3Rpb24gPSBuZXcgVmVjdG9yMyggMCwgMCwgLTEgKSApIHsKCgkJCS8qKgoJCQkgKiBUaGUgb3JpZ2luIG9mIHRoZSByYXkuCgkJCSAqCgkJCSAqIEB0eXBlIHtWZWN0b3IzfQoJCQkgKi8KCQkJdGhpcy5vcmlnaW4gPSBvcmlnaW47CgoJCQkvKioKCQkJICogVGhlIChub3JtYWxpemVkKSBkaXJlY3Rpb24gb2YgdGhlIHJheS4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSByYXkncyBjb21wb25lbnRzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gb3JpZ2luIC0gVGhlIG9yaWdpbi4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGRpcmVjdGlvbiAtIFRoZSBkaXJlY3Rpb24uCgkJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KCQkgKi8KCQlzZXQoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKCQkJdGhpcy5vcmlnaW4uY29weSggb3JpZ2luICk7CgkJCXRoaXMuZGlyZWN0aW9uLmNvcHkoIGRpcmVjdGlvbiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIHJheSB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtSYXl9IHJheSAtIFRoZSByYXkgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtSYXl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcmF5LgoJCSAqLwoJCWNvcHkoIHJheSApIHsKCgkJCXRoaXMub3JpZ2luLmNvcHkoIHJheS5vcmlnaW4gKTsKCQkJdGhpcy5kaXJlY3Rpb24uY29weSggcmF5LmRpcmVjdGlvbiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHZlY3RvciB0aGF0IGlzIGxvY2F0ZWQgYXQgYSBnaXZlbiBkaXN0YW5jZSBhbG9uZyB0aGlzIHJheS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGRpc3RhbmNlIGFsb25nIHRoZSByYXkgdG8gcmV0cmlldmUgYSBwb3NpdGlvbiBmb3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBBIHBvc2l0aW9uIG9uIHRoZSByYXkuCgkJICovCgkJYXQoIHQsIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCB0ICk7CgoJCX0KCgkJLyoqCgkJICogQWRqdXN0cyB0aGUgZGlyZWN0aW9uIG9mIHRoZSByYXkgdG8gcG9pbnQgYXQgdGhlIGdpdmVuIHZlY3RvciBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdiAtIFRoZSB0YXJnZXQgcG9zaXRpb24uCgkJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KCQkgKi8KCQlsb29rQXQoIHYgKSB7CgoJCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCB2ICkuc3ViKCB0aGlzLm9yaWdpbiApLm5vcm1hbGl6ZSgpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2hpZnQgdGhlIG9yaWdpbiBvZiB0aGlzIHJheSBhbG9uZyBpdHMgZGlyZWN0aW9uIGJ5IHRoZSBnaXZlbiBkaXN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0IC0gVGhlIGRpc3RhbmNlIGFsb25nIHRoZSByYXkgdG8gaW50ZXJwb2xhdGUuCgkJICogQHJldHVybiB7UmF5fSBBIHJlZmVyZW5jZSB0byB0aGlzIHJheS4KCQkgKi8KCQlyZWNhc3QoIHQgKSB7CgoJCQl0aGlzLm9yaWdpbi5jb3B5KCB0aGlzLmF0KCB0LCBfdmVjdG9yJGEgKSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgcG9pbnQgYWxvbmcgdGhpcyByYXkgdGhhdCBpcyBjbG9zZXN0IHRvIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGdldCB0aGUgY2xvc2V0IGxvY2F0aW9uIG9uIHRoZSByYXkgZm9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhpcyByYXkuCgkJICovCgkJY2xvc2VzdFBvaW50VG9Qb2ludCggcG9pbnQsIHRhcmdldCApIHsKCgkJCXRhcmdldC5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKTsKCgkJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gdGFyZ2V0LmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCWlmICggZGlyZWN0aW9uRGlzdGFuY2UgPCAwICkgewoKCQkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBkaXJlY3Rpb25EaXN0YW5jZSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGRpc3RhbmNlIG9mIHRoZSBjbG9zZXN0IGFwcHJvYWNoIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBwb2ludC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlIHRvIGNvbXB1dGUgdGhlIGRpc3RhbmNlIHRvLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSB7CgoJCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgc3F1YXJlZCBkaXN0YW5jZSBvZiB0aGUgY2xvc2VzdCBhcHByb2FjaCBiZXR3ZWVuIHRoaXMgcmF5IGFuZCB0aGUgZ2l2ZW4gcG9pbnQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gQSBwb2ludCBpbiAzRCBzcGFjZSB0byBjb21wdXRlIHRoZSBkaXN0YW5jZSB0by4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlU3FUb1BvaW50KCBwb2ludCApIHsKCgkJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gX3ZlY3RvciRhLnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLm9yaWdpbiApLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCS8vIHBvaW50IGJlaGluZCB0aGUgcmF5CgoJCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCgkJCQlyZXR1cm4gdGhpcy5vcmlnaW4uZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCQl9CgoJCQlfdmVjdG9yJGEuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCBkaXJlY3Rpb25EaXN0YW5jZSApOwoKCQkJcmV0dXJuIF92ZWN0b3IkYS5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBzcXVhcmVkIGRpc3RhbmNlIGJldHdlZW4gdGhpcyByYXkgYW5kIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYwIC0gVGhlIHN0YXJ0IHBvaW50IG9mIHRoZSBsaW5lIHNlZ21lbnQuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2MSAtIFRoZSBlbmQgcG9pbnQgb2YgdGhlIGxpbmUgc2VnbWVudC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbFBvaW50T25SYXldIC0gV2hlbiBwcm92aWRlZCwgaXQgcmVjZWl2ZXMgdGhlIHBvaW50IG9uIHRoaXMgcmF5IHRoYXQgaXMgY2xvc2VzdCB0byB0aGUgc2VnbWVudC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25hbFBvaW50T25TZWdtZW50XSAtIFdoZW4gcHJvdmlkZWQsIGl0IHJlY2VpdmVzIHRoZSBwb2ludCBvbiB0aGUgbGluZSBzZWdtZW50IHRoYXQgaXMgY2xvc2VzdCB0byB0aGlzIHJheS4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBzcXVhcmVkIGRpc3RhbmNlLgoJCSAqLwoJCWRpc3RhbmNlU3FUb1NlZ21lbnQoIHYwLCB2MSwgb3B0aW9uYWxQb2ludE9uUmF5LCBvcHRpb25hbFBvaW50T25TZWdtZW50ICkgewoKCQkJLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vcG1qb25pYWsvR2VvbWV0cmljVG9vbHMvYmxvYi9tYXN0ZXIvR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVEaXN0UmF5U2VnbWVudC5oCgkJCS8vIEl0IHJldHVybnMgdGhlIG1pbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSByYXkgYW5kIHRoZSBzZWdtZW50CgkJCS8vIGRlZmluZWQgYnkgdjAgYW5kIHYxCgkJCS8vIEl0IGNhbiBhbHNvIHNldCB0d28gb3B0aW9uYWwgdGFyZ2V0cyA6CgkJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHJheQoJCQkvLyAtIFRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzZWdtZW50CgoJCQlfc2VnQ2VudGVyLmNvcHkoIHYwICkuYWRkKCB2MSApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCQkJX3NlZ0Rpci5jb3B5KCB2MSApLnN1YiggdjAgKS5ub3JtYWxpemUoKTsKCQkJX2RpZmYuY29weSggdGhpcy5vcmlnaW4gKS5zdWIoIF9zZWdDZW50ZXIgKTsKCgkJCWNvbnN0IHNlZ0V4dGVudCA9IHYwLmRpc3RhbmNlVG8oIHYxICkgKiAwLjU7CgkJCWNvbnN0IGEwMSA9IC0gdGhpcy5kaXJlY3Rpb24uZG90KCBfc2VnRGlyICk7CgkJCWNvbnN0IGIwID0gX2RpZmYuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoJCQljb25zdCBiMSA9IC0gX2RpZmYuZG90KCBfc2VnRGlyICk7CgkJCWNvbnN0IGMgPSBfZGlmZi5sZW5ndGhTcSgpOwoJCQljb25zdCBkZXQgPSBNYXRoLmFicyggMSAtIGEwMSAqIGEwMSApOwoJCQlsZXQgczAsIHMxLCBzcXJEaXN0LCBleHREZXQ7CgoJCQlpZiAoIGRldCA+IDAgKSB7CgoJCQkJLy8gVGhlIHJheSBhbmQgc2VnbWVudCBhcmUgbm90IHBhcmFsbGVsLgoKCQkJCXMwID0gYTAxICogYjEgLSBiMDsKCQkJCXMxID0gYTAxICogYjAgLSBiMTsKCQkJCWV4dERldCA9IHNlZ0V4dGVudCAqIGRldDsKCgkJCQlpZiAoIHMwID49IDAgKSB7CgoJCQkJCWlmICggczEgPj0gLSBleHREZXQgKSB7CgoJCQkJCQlpZiAoIHMxIDw9IGV4dERldCApIHsKCgkJCQkJCQkvLyByZWdpb24gMAoJCQkJCQkJLy8gTWluaW11bSBhdCBpbnRlcmlvciBwb2ludHMgb2YgcmF5IGFuZCBzZWdtZW50LgoKCQkJCQkJCWNvbnN0IGludkRldCA9IDEgLyBkZXQ7CgkJCQkJCQlzMCAqPSBpbnZEZXQ7CgkJCQkJCQlzMSAqPSBpbnZEZXQ7CgkJCQkJCQlzcXJEaXN0ID0gczAgKiAoIHMwICsgYTAxICogczEgKyAyICogYjAgKSArIHMxICogKCBhMDEgKiBzMCArIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyByZWdpb24gMQoKCQkJCQkJCXMxID0gc2VnRXh0ZW50OwoJCQkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHJlZ2lvbiA1CgoJCQkJCQlzMSA9IC0gc2VnRXh0ZW50OwoJCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CgkJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIHMxIDw9IC0gZXh0RGV0ICkgewoKCQkJCQkJLy8gcmVnaW9uIDQKCgkJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCAtIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKCQkJCQkJczEgPSAoIHMwID4gMCApID8gLSBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJCQl9IGVsc2UgaWYgKCBzMSA8PSBleHREZXQgKSB7CgoJCQkJCQkvLyByZWdpb24gMwoKCQkJCQkJczAgPSAwOwoJCQkJCQlzMSA9IE1hdGgubWluKCBNYXRoLm1heCggLSBzZWdFeHRlbnQsIC0gYjEgKSwgc2VnRXh0ZW50ICk7CgkJCQkJCXNxckRpc3QgPSBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyByZWdpb24gMgoKCQkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKCQkJCQkJczEgPSAoIHMwID4gMCApID8gc2VnRXh0ZW50IDogTWF0aC5taW4oIE1hdGgubWF4KCAtIHNlZ0V4dGVudCwgLSBiMSApLCBzZWdFeHRlbnQgKTsKCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gUmF5IGFuZCBzZWdtZW50IGFyZSBwYXJhbGxlbC4KCgkJCQlzMSA9ICggYTAxID4gMCApID8gLSBzZWdFeHRlbnQgOiBzZWdFeHRlbnQ7CgkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggYTAxICogczEgKyBiMCApICk7CgkJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQkJfQoKCQkJaWYgKCBvcHRpb25hbFBvaW50T25SYXkgKSB7CgoJCQkJb3B0aW9uYWxQb2ludE9uUmF5LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgczAgKTsKCgkJCX0KCgkJCWlmICggb3B0aW9uYWxQb2ludE9uU2VnbWVudCApIHsKCgkJCQlvcHRpb25hbFBvaW50T25TZWdtZW50LmNvcHkoIF9zZWdDZW50ZXIgKS5hZGRTY2FsZWRWZWN0b3IoIF9zZWdEaXIsIHMxICk7CgoJCQl9CgoJCQlyZXR1cm4gc3FyRGlzdDsKCgkJfQoKCQkvKioKCQkgKiBJbnRlcnNlY3RzIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIHNwaGVyZSwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KCQkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gaW50ZXJzZWN0LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCgkJICovCgkJaW50ZXJzZWN0U3BoZXJlKCBzcGhlcmUsIHRhcmdldCApIHsKCgkJCV92ZWN0b3IkYS5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLm9yaWdpbiApOwoJCQljb25zdCB0Y2EgPSBfdmVjdG9yJGEuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoJCQljb25zdCBkMiA9IF92ZWN0b3IkYS5kb3QoIF92ZWN0b3IkYSApIC0gdGNhICogdGNhOwoJCQljb25zdCByYWRpdXMyID0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CgoJCQlpZiAoIGQyID4gcmFkaXVzMiApIHJldHVybiBudWxsOwoKCQkJY29uc3QgdGhjID0gTWF0aC5zcXJ0KCByYWRpdXMyIC0gZDIgKTsKCgkJCS8vIHQwID0gZmlyc3QgaW50ZXJzZWN0IHBvaW50IC0gZW50cmFuY2Ugb24gZnJvbnQgb2Ygc3BoZXJlCgkJCWNvbnN0IHQwID0gdGNhIC0gdGhjOwoKCQkJLy8gdDEgPSBzZWNvbmQgaW50ZXJzZWN0IHBvaW50IC0gZXhpdCBwb2ludCBvbiBiYWNrIG9mIHNwaGVyZQoJCQljb25zdCB0MSA9IHRjYSArIHRoYzsKCgkJCS8vIHRlc3QgdG8gc2VlIGlmIHQxIGlzIGJlaGluZCB0aGUgcmF5IC0gaWYgc28sIHJldHVybiBudWxsCgkJCWlmICggdDEgPCAwICkgcmV0dXJuIG51bGw7CgoJCQkvLyB0ZXN0IHRvIHNlZSBpZiB0MCBpcyBiZWhpbmQgdGhlIHJheToKCQkJLy8gaWYgaXQgaXMsIHRoZSByYXkgaXMgaW5zaWRlIHRoZSBzcGhlcmUsIHNvIHJldHVybiB0aGUgc2Vjb25kIGV4aXQgcG9pbnQgc2NhbGVkIGJ5IHQxLAoJCQkvLyBpbiBvcmRlciB0byBhbHdheXMgcmV0dXJuIGFuIGludGVyc2VjdCBwb2ludCB0aGF0IGlzIGluIGZyb250IG9mIHRoZSByYXkuCgkJCWlmICggdDAgPCAwICkgcmV0dXJuIHRoaXMuYXQoIHQxLCB0YXJnZXQgKTsKCgkJCS8vIGVsc2UgdDAgaXMgaW4gZnJvbnQgb2YgdGhlIHJheSwgc28gcmV0dXJuIHRoZSBmaXJzdCBjb2xsaXNpb24gcG9pbnQgc2NhbGVkIGJ5IHQwCgkJCXJldHVybiB0aGlzLmF0KCB0MCwgdGFyZ2V0ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBzcGhlcmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIHNwaGVyZSB0byBpbnRlcnNlY3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKCQkJaWYgKCBzcGhlcmUucmFkaXVzIDwgMCApIHJldHVybiBmYWxzZTsgLy8gaGFuZGxlIGVtcHR5IHNwaGVyZXMsIHNlZSAjMzExODcKCgkJCXJldHVybiB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgPD0gKCBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1cyApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSByYXkncyBvcmlnaW4gdG8gdGhlIGdpdmVuIHBsYW5lLiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgcmF5CgkJICogZG9lcyBub3QgaW50ZXJzZWN0IHdpdGggdGhlIHBsYW5lLgoJCSAqCgkJICogQHBhcmFtIHtQbGFuZX0gcGxhbmUgLSBUaGUgcGxhbmUgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgdG8uCgkJICogQHJldHVybiB7P251bWJlcn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHNwaGVyZSBvciBub3QuCgkJICovCgkJZGlzdGFuY2VUb1BsYW5lKCBwbGFuZSApIHsKCgkJCWNvbnN0IGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgoJCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgoJCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICkgPT09IDAgKSB7CgoJCQkJCXJldHVybiAwOwoKCQkJCX0KCgkJCQkvLyBOdWxsIGlzIHByZWZlcmFibGUgdG8gdW5kZWZpbmVkIHNpbmNlIHVuZGVmaW5lZCBtZWFucy4uLi4gaXQgaXMgdW5kZWZpbmVkCgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQljb25zdCB0ID0gLSAoIHRoaXMub3JpZ2luLmRvdCggcGxhbmUubm9ybWFsICkgKyBwbGFuZS5jb25zdGFudCApIC8gZGVub21pbmF0b3I7CgoJCQkvLyBSZXR1cm4gaWYgdGhlIHJheSBuZXZlciBpbnRlcnNlY3RzIHRoZSBwbGFuZQoKCQkJcmV0dXJuIHQgPj0gMCA/IHQgOiBudWxsOwoKCQl9CgoJCS8qKgoJCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUsIHJldHVybmluZyB0aGUgaW50ZXJzZWN0aW9uCgkJICogcG9pbnQgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGludGVyc2VjdC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJzZWN0aW9uIHBvaW50LgoJCSAqLwoJCWludGVyc2VjdFBsYW5lKCBwbGFuZSwgdGFyZ2V0ICkgewoKCQkJY29uc3QgdCA9IHRoaXMuZGlzdGFuY2VUb1BsYW5lKCBwbGFuZSApOwoKCQkJaWYgKCB0ID09PSBudWxsICkgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuYXQoIHQsIHRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgcmF5IGludGVyc2VjdHMgd2l0aCB0aGUgZ2l2ZW4gcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byBpbnRlcnNlY3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIHBsYW5lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQkJLy8gY2hlY2sgaWYgdGhlIHJheSBsaWVzIG9uIHRoZSBwbGFuZSBmaXJzdAoKCQkJY29uc3QgZGlzdFRvUG9pbnQgPSBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIHRoaXMub3JpZ2luICk7CgoJCQlpZiAoIGRpc3RUb1BvaW50ID09PSAwICkgewoKCQkJCXJldHVybiB0cnVlOwoKCQkJfQoKCQkJY29uc3QgZGVub21pbmF0b3IgPSBwbGFuZS5ub3JtYWwuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKCQkJaWYgKCBkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCApIHsKCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCS8vIHJheSBvcmlnaW4gaXMgYmVoaW5kIHRoZSBwbGFuZSAoYW5kIGlzIHBvaW50aW5nIGJlaGluZCBpdCkKCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQkvKioKCQkgKiBJbnRlcnNlY3RzIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIGJvdW5kaW5nIGJveCwgcmV0dXJuaW5nIHRoZSBpbnRlcnNlY3Rpb24KCQkgKiBwb2ludCBvciBgbnVsbGAgaWYgdGhlcmUgaXMgbm8gaW50ZXJzZWN0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtCb3gzfSBib3ggLSBUaGUgYm94IHRvIGludGVyc2VjdC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgaW50ZXJzZWN0aW9uIHBvaW50LgoJCSAqLwoJCWludGVyc2VjdEJveCggYm94LCB0YXJnZXQgKSB7CgoJCQlsZXQgdG1pbiwgdG1heCwgdHltaW4sIHR5bWF4LCB0em1pbiwgdHptYXg7CgoJCQljb25zdCBpbnZkaXJ4ID0gMSAvIHRoaXMuZGlyZWN0aW9uLngsCgkJCQlpbnZkaXJ5ID0gMSAvIHRoaXMuZGlyZWN0aW9uLnksCgkJCQlpbnZkaXJ6ID0gMSAvIHRoaXMuZGlyZWN0aW9uLno7CgoJCQljb25zdCBvcmlnaW4gPSB0aGlzLm9yaWdpbjsKCgkJCWlmICggaW52ZGlyeCA+PSAwICkgewoKCQkJCXRtaW4gPSAoIGJveC5taW4ueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQkJdG1heCA9ICggYm94Lm1heC54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgoJCQl9IGVsc2UgewoKCQkJCXRtaW4gPSAoIGJveC5tYXgueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQkJdG1heCA9ICggYm94Lm1pbi54IC0gb3JpZ2luLnggKSAqIGludmRpcng7CgoJCQl9CgoJCQlpZiAoIGludmRpcnkgPj0gMCApIHsKCgkJCQl0eW1pbiA9ICggYm94Lm1pbi55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgkJCQl0eW1heCA9ICggYm94Lm1heC55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgoJCQl9IGVsc2UgewoKCQkJCXR5bWluID0gKCBib3gubWF4LnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCQkJCXR5bWF4ID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCgkJCX0KCgkJCWlmICggKCB0bWluID4gdHltYXggKSB8fCAoIHR5bWluID4gdG1heCApICkgcmV0dXJuIG51bGw7CgoJCQlpZiAoIHR5bWluID4gdG1pbiB8fCBpc05hTiggdG1pbiApICkgdG1pbiA9IHR5bWluOwoKCQkJaWYgKCB0eW1heCA8IHRtYXggfHwgaXNOYU4oIHRtYXggKSApIHRtYXggPSB0eW1heDsKCgkJCWlmICggaW52ZGlyeiA+PSAwICkgewoKCQkJCXR6bWluID0gKCBib3gubWluLnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCQkJCXR6bWF4ID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCgkJCX0gZWxzZSB7CgoJCQkJdHptaW4gPSAoIGJveC5tYXgueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoJCQkJdHptYXggPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKCQkJfQoKCQkJaWYgKCAoIHRtaW4gPiB0em1heCApIHx8ICggdHptaW4gPiB0bWF4ICkgKSByZXR1cm4gbnVsbDsKCgkJCWlmICggdHptaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4gKSB0bWluID0gdHptaW47CgoJCQlpZiAoIHR6bWF4IDwgdG1heCB8fCB0bWF4ICE9PSB0bWF4ICkgdG1heCA9IHR6bWF4OwoKCQkJLy9yZXR1cm4gcG9pbnQgY2xvc2VzdCB0byB0aGUgcmF5IChwb3NpdGl2ZSBzaWRlKQoKCQkJaWYgKCB0bWF4IDwgMCApIHJldHVybiBudWxsOwoKCQkJcmV0dXJuIHRoaXMuYXQoIHRtaW4gPj0gMCA/IHRtaW4gOiB0bWF4LCB0YXJnZXQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveC4KCQkgKgoJCSAqIEBwYXJhbSB7Qm94M30gYm94IC0gVGhlIGJveCB0byBpbnRlcnNlY3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0Qm94KCBib3gsIF92ZWN0b3IkYSApICE9PSBudWxsOwoKCQl9CgoJCS8qKgoJCSAqIEludGVyc2VjdHMgdGhpcyByYXkgd2l0aCB0aGUgZ2l2ZW4gdHJpYW5nbGUsIHJldHVybmluZyB0aGUgaW50ZXJzZWN0aW9uCgkJICogcG9pbnQgb3IgYG51bGxgIGlmIHRoZXJlIGlzIG5vIGludGVyc2VjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCB2ZXJ0ZXggb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgdmVydGV4IG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgdmVydGV4IG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IGJhY2tmYWNlQ3VsbGluZyAtIFdoZXRoZXIgdG8gdXNlIGJhY2tmYWNlIGN1bGxpbmcgb3Igbm90LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnNlY3Rpb24gcG9pbnQuCgkJICovCgkJaW50ZXJzZWN0VHJpYW5nbGUoIGEsIGIsIGMsIGJhY2tmYWNlQ3VsbGluZywgdGFyZ2V0ICkgewoKCQkJLy8gQ29tcHV0ZSB0aGUgb2Zmc2V0IG9yaWdpbiwgZWRnZXMsIGFuZCBub3JtYWwuCgoJCQkvLyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9wbWpvbmlhay9HZW9tZXRyaWNUb29scy9ibG9iL21hc3Rlci9HVEVuZ2luZS9JbmNsdWRlL01hdGhlbWF0aWNzL0d0ZUludHJSYXkzVHJpYW5nbGUzLmgKCgkJCV9lZGdlMS5zdWJWZWN0b3JzKCBiLCBhICk7CgkJCV9lZGdlMi5zdWJWZWN0b3JzKCBjLCBhICk7CgkJCV9ub3JtYWwkMS5jcm9zc1ZlY3RvcnMoIF9lZGdlMSwgX2VkZ2UyICk7CgoJCQkvLyBTb2x2ZSBRICsgdCpEID0gYjEqRTEgKyBiMipFMiAoUSA9IGtEaWZmLCBEID0gcmF5IGRpcmVjdGlvbiwKCQkJLy8gRTEgPSBrRWRnZTEsIEUyID0ga0VkZ2UyLCBOID0gQ3Jvc3MoRTEsRTIpKSBieQoJCQkvLyAgIHxEb3QoRCxOKXwqYjEgPSBzaWduKERvdChELE4pKSpEb3QoRCxDcm9zcyhRLEUyKSkKCQkJLy8gICB8RG90KEQsTil8KmIyID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoRTEsUSkpCgkJCS8vICAgfERvdChELE4pfCp0ID0gLXNpZ24oRG90KEQsTikpKkRvdChRLE4pCgkJCWxldCBEZE4gPSB0aGlzLmRpcmVjdGlvbi5kb3QoIF9ub3JtYWwkMSApOwoJCQlsZXQgc2lnbjsKCgkJCWlmICggRGROID4gMCApIHsKCgkJCQlpZiAoIGJhY2tmYWNlQ3VsbGluZyApIHJldHVybiBudWxsOwoJCQkJc2lnbiA9IDE7CgoJCQl9IGVsc2UgaWYgKCBEZE4gPCAwICkgewoKCQkJCXNpZ24gPSAtMTsKCQkJCURkTiA9IC0gRGROOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCV9kaWZmLnN1YlZlY3RvcnMoIHRoaXMub3JpZ2luLCBhICk7CgkJCWNvbnN0IERkUXhFMiA9IHNpZ24gKiB0aGlzLmRpcmVjdGlvbi5kb3QoIF9lZGdlMi5jcm9zc1ZlY3RvcnMoIF9kaWZmLCBfZWRnZTIgKSApOwoKCQkJLy8gYjEgPCAwLCBubyBpbnRlcnNlY3Rpb24KCQkJaWYgKCBEZFF4RTIgPCAwICkgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJY29uc3QgRGRFMXhRID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UxLmNyb3NzKCBfZGlmZiApICk7CgoJCQkvLyBiMiA8IDAsIG5vIGludGVyc2VjdGlvbgoJCQlpZiAoIERkRTF4USA8IDAgKSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCQkvLyBiMStiMiA+IDEsIG5vIGludGVyc2VjdGlvbgoJCQlpZiAoIERkUXhFMiArIERkRTF4USA+IERkTiApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCS8vIExpbmUgaW50ZXJzZWN0cyB0cmlhbmdsZSwgY2hlY2sgaWYgcmF5IGRvZXMuCgkJCWNvbnN0IFFkTiA9IC0gc2lnbiAqIF9kaWZmLmRvdCggX25vcm1hbCQxICk7CgoJCQkvLyB0IDwgMCwgbm8gaW50ZXJzZWN0aW9uCgkJCWlmICggUWROIDwgMCApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCS8vIFJheSBpbnRlcnNlY3RzIHRyaWFuZ2xlLgoJCQlyZXR1cm4gdGhpcy5hdCggUWROIC8gRGROLCB0YXJnZXQgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2Zvcm1zIHRoaXMgcmF5IHdpdGggdGhlIGdpdmVuIDR4NCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeDQgLSBUaGUgdHJhbnNmb3JtYXRpb24gbWF0cml4LgoJCSAqIEByZXR1cm4ge1JheX0gQSByZWZlcmVuY2UgdG8gdGhpcyByYXkuCgkJICovCgkJYXBwbHlNYXRyaXg0KCBtYXRyaXg0ICkgewoKCQkJdGhpcy5vcmlnaW4uYXBwbHlNYXRyaXg0KCBtYXRyaXg0ICk7CgkJCXRoaXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4NCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyByYXkgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtSYXl9IHJheSAtIFRoZSByYXkgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIHJheSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICovCgkJZXF1YWxzKCByYXkgKSB7CgoJCQlyZXR1cm4gcmF5Lm9yaWdpbi5lcXVhbHMoIHRoaXMub3JpZ2luICkgJiYgcmF5LmRpcmVjdGlvbi5lcXVhbHMoIHRoaXMuZGlyZWN0aW9uICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyByYXkgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge1JheX0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJfQoKCS8qKgoJICogUmVwcmVzZW50cyBhIDR4NCBtYXRyaXguCgkgKgoJICogVGhlIG1vc3QgY29tbW9uIHVzZSBvZiBhIDR4NCBtYXRyaXggaW4gM0QgY29tcHV0ZXIgZ3JhcGhpY3MgaXMgYXMgYSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkgKiBGb3IgYW4gaW50cm9kdWN0aW9uIHRvIHRyYW5zZm9ybWF0aW9uIG1hdHJpY2VzIGFzIHVzZWQgaW4gV2ViR0wsIGNoZWNrIG91dCBbdGhpcyB0dXRvcmlhbF17QGxpbmsgaHR0cHM6Ly93d3cub3BlbmdsLXR1dG9yaWFsLm9yZy9iZWdpbm5lcnMtdHV0b3JpYWxzL3R1dG9yaWFsLTMtbWF0cmljZXN9CgkgKgoJICogVGhpcyBhbGxvd3MgYSAzRCB2ZWN0b3IgcmVwcmVzZW50aW5nIGEgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdW5kZXJnbwoJICogdHJhbnNmb3JtYXRpb25zIHN1Y2ggYXMgdHJhbnNsYXRpb24sIHJvdGF0aW9uLCBzaGVhciwgc2NhbGUsIHJlZmxlY3Rpb24sCgkgKiBvcnRob2dvbmFsIG9yIHBlcnNwZWN0aXZlIHByb2plY3Rpb24gYW5kIHNvIG9uLCBieSBiZWluZyBtdWx0aXBsaWVkIGJ5IHRoZQoJICogbWF0cml4LiBUaGlzIGlzIGtub3duIGFzIGBhcHBseWluZ2AgdGhlIG1hdHJpeCB0byB0aGUgdmVjdG9yLgoJICoKCSAqIEEgTm90ZSBvbiBSb3ctTWFqb3IgYW5kIENvbHVtbi1NYWpvciBPcmRlcmluZzoKCSAqCgkgKiBUaGUgY29uc3RydWN0b3IgYW5kIHtAbGluayBNYXRyaXgzI3NldH0gbWV0aG9kIHRha2UgYXJndW1lbnRzIGluCgkgKiBbcm93LW1ham9yXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3ctX2FuZF9jb2x1bW4tbWFqb3Jfb3JkZXIjQ29sdW1uLW1ham9yX29yZGVyfQoJICogb3JkZXIsIHdoaWxlIGludGVybmFsbHkgdGhleSBhcmUgc3RvcmVkIGluIHRoZSB7QGxpbmsgTWF0cml4MyNlbGVtZW50c30gYXJyYXkgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJICogVGhpcyBtZWFucyB0aGF0IGNhbGxpbmc6CgkgKiBgYGBqcwoJICogY29uc3QgbSA9IG5ldyBUSFJFRS5NYXRyaXg0KCk7CgkgKiBtLnNldCggMTEsIDEyLCAxMywgMTQsCgkgKiAgICAgICAgMjEsIDIyLCAyMywgMjQsCgkgKiAgICAgICAgMzEsIDMyLCAzMywgMzQsCgkgKiAgICAgICAgNDEsIDQyLCA0MywgNDQgKTsKCSAqIGBgYAoJICogd2lsbCByZXN1bHQgaW4gdGhlIGVsZW1lbnRzIGFycmF5IGNvbnRhaW5pbmc6CgkgKiBgYGBqcwoJICogbS5lbGVtZW50cyA9IFsgMTEsIDIxLCAzMSwgNDEsCgkgKiAgICAgICAgICAgICAgICAxMiwgMjIsIDMyLCA0MiwKCSAqICAgICAgICAgICAgICAgIDEzLCAyMywgMzMsIDQzLAoJICogICAgICAgICAgICAgICAgMTQsIDI0LCAzNCwgNDQgXTsKCSAqIGBgYAoJICogYW5kIGludGVybmFsbHkgYWxsIGNhbGN1bGF0aW9ucyBhcmUgcGVyZm9ybWVkIHVzaW5nIGNvbHVtbi1tYWpvciBvcmRlcmluZy4KCSAqIEhvd2V2ZXIsIGFzIHRoZSBhY3R1YWwgb3JkZXJpbmcgbWFrZXMgbm8gZGlmZmVyZW5jZSBtYXRoZW1hdGljYWxseSBhbmQKCSAqIG1vc3QgcGVvcGxlIGFyZSB1c2VkIHRvIHRoaW5raW5nIGFib3V0IG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlciwgdGhlCgkgKiB0aHJlZS5qcyBkb2N1bWVudGF0aW9uIHNob3dzIG1hdHJpY2VzIGluIHJvdy1tYWpvciBvcmRlci4gSnVzdCBiZWFyIGluCgkgKiBtaW5kIHRoYXQgaWYgeW91IGFyZSByZWFkaW5nIHRoZSBzb3VyY2UgY29kZSwgeW91J2xsIGhhdmUgdG8gdGFrZSB0aGUKCSAqIHRyYW5zcG9zZSBvZiBhbnkgbWF0cmljZXMgb3V0bGluZWQgaGVyZSB0byBtYWtlIHNlbnNlIG9mIHRoZSBjYWxjdWxhdGlvbnMuCgkgKi8KCWNsYXNzIE1hdHJpeDQgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IDR4NCBtYXRyaXguIFRoZSBhcmd1bWVudHMgYXJlIHN1cHBvc2VkIHRvIGJlCgkJICogaW4gcm93LW1ham9yIG9yZGVyLiBJZiBubyBhcmd1bWVudHMgYXJlIHByb3ZpZGVkLCB0aGUgY29uc3RydWN0b3IKCQkgKiBpbml0aWFsaXplcyB0aGUgbWF0cml4IGFzIGFuIGlkZW50aXR5IG1hdHJpeC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjExXSAtIDEtMSBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24xMl0gLSAxLTIgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTNdIC0gMS0zIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjE0XSAtIDEtNCBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yMV0gLSAyLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjJdIC0gMi0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIzXSAtIDItMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yNF0gLSAyLTQgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzFdIC0gMy0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMyXSAtIDMtMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zM10gLSAzLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzRdIC0gMy00IG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQxXSAtIDQtMSBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW240Ml0gLSA0LTIgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuNDNdIC0gNC0zIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQ0XSAtIDQtNCBtYXRyaXggZWxlbWVudC4KCQkgKi8KCQljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCU1hdHJpeDQucHJvdG90eXBlLmlzTWF0cml4NCA9IHRydWU7CgoJCQkvKioKCQkJICogQSBjb2x1bW4tbWFqb3IgbGlzdCBvZiBtYXRyaXggdmFsdWVzLgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPn0KCQkJICovCgkJCXRoaXMuZWxlbWVudHMgPSBbCgoJCQkJMSwgMCwgMCwgMCwKCQkJCTAsIDEsIDAsIDAsCgkJCQkwLCAwLCAxLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJXTsKCgkJCWlmICggbjExICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGVsZW1lbnRzIG9mIHRoZSBtYXRyaXguVGhlIGFyZ3VtZW50cyBhcmUgc3VwcG9zZWQgdG8gYmUKCQkgKiBpbiByb3ctbWFqb3Igb3JkZXIuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gW24xMV0gLSAxLTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMTJdIC0gMS0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjEzXSAtIDEtMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24xNF0gLSAxLTQgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjFdIC0gMi0xIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjIyXSAtIDItMiBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24yM10gLSAyLTMgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMjRdIC0gMi00IG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjMxXSAtIDMtMSBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW24zMl0gLSAzLTIgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuMzNdIC0gMy0zIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjM0XSAtIDMtNCBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW240MV0gLSA0LTEgbWF0cml4IGVsZW1lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuNDJdIC0gNC0yIG1hdHJpeCBlbGVtZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbjQzXSAtIDQtMyBtYXRyaXggZWxlbWVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW240NF0gLSA0LTQgbWF0cml4IGVsZW1lbnQuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMTQsIG4yMSwgbjIyLCBuMjMsIG4yNCwgbjMxLCBuMzIsIG4zMywgbjM0LCBuNDEsIG40MiwgbjQzLCBuNDQgKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQl0ZVsgMCBdID0gbjExOyB0ZVsgNCBdID0gbjEyOyB0ZVsgOCBdID0gbjEzOyB0ZVsgMTIgXSA9IG4xNDsKCQkJdGVbIDEgXSA9IG4yMTsgdGVbIDUgXSA9IG4yMjsgdGVbIDkgXSA9IG4yMzsgdGVbIDEzIF0gPSBuMjQ7CgkJCXRlWyAyIF0gPSBuMzE7IHRlWyA2IF0gPSBuMzI7IHRlWyAxMCBdID0gbjMzOyB0ZVsgMTQgXSA9IG4zNDsKCQkJdGVbIDMgXSA9IG40MTsgdGVbIDcgXSA9IG40MjsgdGVbIDExIF0gPSBuNDM7IHRlWyAxNSBdID0gbjQ0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgNHg0IGlkZW50aXR5IG1hdHJpeC4KCQkgKgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWlkZW50aXR5KCkgewoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgMCwgMCwKCQkJCTAsIDEsIDAsIDAsCgkJCQkwLCAwLCAxLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBtYXRyaXggd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgTWF0cml4NCgpLmZyb21BcnJheSggdGhpcy5lbGVtZW50cyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRyaXggdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gY29weS4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQljb3B5KCBtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMCBdID0gbWVbIDAgXTsgdGVbIDEgXSA9IG1lWyAxIF07IHRlWyAyIF0gPSBtZVsgMiBdOyB0ZVsgMyBdID0gbWVbIDMgXTsKCQkJdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOyB0ZVsgNiBdID0gbWVbIDYgXTsgdGVbIDcgXSA9IG1lWyA3IF07CgkJCXRlWyA4IF0gPSBtZVsgOCBdOyB0ZVsgOSBdID0gbWVbIDkgXTsgdGVbIDEwIF0gPSBtZVsgMTAgXTsgdGVbIDExIF0gPSBtZVsgMTEgXTsKCQkJdGVbIDEyIF0gPSBtZVsgMTIgXTsgdGVbIDEzIF0gPSBtZVsgMTMgXTsgdGVbIDE0IF0gPSBtZVsgMTQgXTsgdGVbIDE1IF0gPSBtZVsgMTUgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdHJhbnNsYXRpb24gY29tcG9uZW50IG9mIHRoZSBnaXZlbiBtYXRyaXgKCQkgKiBpbnRvIHRoaXMgbWF0cml4J3MgdHJhbnNsYXRpb24gY29tcG9uZW50LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBjb3B5IHRoZSB0cmFuc2xhdGlvbiBjb21wb25lbnQuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJY29weVBvc2l0aW9uKCBtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOwoJCQl0ZVsgMTMgXSA9IG1lWyAxMyBdOwoJCQl0ZVsgMTQgXSA9IG1lWyAxNCBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0IHRoZSB1cHBlciAzeDMgZWxlbWVudHMgb2YgdGhpcyBtYXRyaXggdG8gdGhlIHZhbHVlcyBvZiBnaXZlbiAzeDMgbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIDN4MyBtYXRyaXguCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0RnJvbU1hdHJpeDMoIG0gKSB7CgoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCQl0aGlzLnNldCgKCgkJCQltZVsgMCBdLCBtZVsgMyBdLCBtZVsgNiBdLCAwLAoJCQkJbWVbIDEgXSwgbWVbIDQgXSwgbWVbIDcgXSwgMCwKCQkJCW1lWyAyIF0sIG1lWyA1IF0sIG1lWyA4IF0sIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRXh0cmFjdHMgdGhlIGJhc2lzIG9mIHRoaXMgbWF0cml4IGludG8gdGhlIHRocmVlIGF4aXMgdmVjdG9ycyBwcm92aWRlZC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30geEF4aXMgLSBUaGUgYmFzaXMncyB4IGF4aXMuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB5QXhpcyAtIFRoZSBiYXNpcydzIHkgYXhpcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHpBeGlzIC0gVGhlIGJhc2lzJ3MgeiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJCXhBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDAgKTsKCQkJeUF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMSApOwoJCQl6QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAyICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiBiYXNpcyB2ZWN0b3JzIHRvIHRoaXMgbWF0cml4LgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB4QXhpcyAtIFRoZSBiYXNpcydzIHggYXhpcy4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHlBeGlzIC0gVGhlIGJhc2lzJ3MgeSBheGlzLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gekF4aXMgLSBUaGUgYmFzaXMncyB6IGF4aXMuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbWFrZUJhc2lzKCB4QXhpcywgeUF4aXMsIHpBeGlzICkgewoKCQkJdGhpcy5zZXQoCgkJCQl4QXhpcy54LCB5QXhpcy54LCB6QXhpcy54LCAwLAoJCQkJeEF4aXMueSwgeUF4aXMueSwgekF4aXMueSwgMCwKCQkJCXhBeGlzLnosIHlBeGlzLnosIHpBeGlzLnosIDAsCgkJCQkwLCAwLCAwLCAxCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBFeHRyYWN0cyB0aGUgcm90YXRpb24gY29tcG9uZW50IG9mIHRoZSBnaXZlbiBtYXRyaXgKCQkgKiBpbnRvIHRoaXMgbWF0cml4J3Mgcm90YXRpb24gY29tcG9uZW50LgoJCSAqCgkJICogTm90ZTogVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCByZWZsZWN0aW9uIG1hdHJpY2VzLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlleHRyYWN0Um90YXRpb24oIG0gKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCgkJCWNvbnN0IHNjYWxlWCA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJCWNvbnN0IHNjYWxlWSA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAxICkubGVuZ3RoKCk7CgkJCWNvbnN0IHNjYWxlWiA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAyICkubGVuZ3RoKCk7CgoJCQl0ZVsgMCBdID0gbWVbIDAgXSAqIHNjYWxlWDsKCQkJdGVbIDEgXSA9IG1lWyAxIF0gKiBzY2FsZVg7CgkJCXRlWyAyIF0gPSBtZVsgMiBdICogc2NhbGVYOwoJCQl0ZVsgMyBdID0gMDsKCgkJCXRlWyA0IF0gPSBtZVsgNCBdICogc2NhbGVZOwoJCQl0ZVsgNSBdID0gbWVbIDUgXSAqIHNjYWxlWTsKCQkJdGVbIDYgXSA9IG1lWyA2IF0gKiBzY2FsZVk7CgkJCXRlWyA3IF0gPSAwOwoKCQkJdGVbIDggXSA9IG1lWyA4IF0gKiBzY2FsZVo7CgkJCXRlWyA5IF0gPSBtZVsgOSBdICogc2NhbGVaOwoJCQl0ZVsgMTAgXSA9IG1lWyAxMCBdICogc2NhbGVaOwoJCQl0ZVsgMTEgXSA9IDA7CgoJCQl0ZVsgMTIgXSA9IDA7CgkJCXRlWyAxMyBdID0gMDsKCQkJdGVbIDE0IF0gPSAwOwoJCQl0ZVsgMTUgXSA9IDE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgKHRoZSB1cHBlciBsZWZ0IDN4MyBtYXRyaXgpIG9mIHRoaXMgbWF0cml4IHRvCgkJICogdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieSB0aGUgZ2l2ZW4gRXVsZXIgYW5nbGVzLiBUaGUgcmVzdCBvZgoJCSAqIHRoZSBtYXRyaXggaXMgc2V0IHRvIHRoZSBpZGVudGl0eS4gRGVwZW5kaW5nIG9uIHRoZSB7QGxpbmsgRXVsZXIjb3JkZXJ9LAoJCSAqIHRoZXJlIGFyZSBzaXggcG9zc2libGUgb3V0Y29tZXMuIFNlZSBbdGhpcyBwYWdlXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlcl9hbmdsZXMjUm90YXRpb25fbWF0cml4fQoJCSAqIGZvciBhIGNvbXBsZXRlIGxpc3QuCgkJICoKCQkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbWFrZVJvdGF0aW9uRnJvbUV1bGVyKCBldWxlciApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWNvbnN0IHggPSBldWxlci54LCB5ID0gZXVsZXIueSwgeiA9IGV1bGVyLno7CgkJCWNvbnN0IGEgPSBNYXRoLmNvcyggeCApLCBiID0gTWF0aC5zaW4oIHggKTsKCQkJY29uc3QgYyA9IE1hdGguY29zKCB5ICksIGQgPSBNYXRoLnNpbiggeSApOwoJCQljb25zdCBlID0gTWF0aC5jb3MoIHogKSwgZiA9IE1hdGguc2luKCB6ICk7CgoJCQlpZiAoIGV1bGVyLm9yZGVyID09PSAnWFlaJyApIHsKCgkJCQljb25zdCBhZSA9IGEgKiBlLCBhZiA9IGEgKiBmLCBiZSA9IGIgKiBlLCBiZiA9IGIgKiBmOwoKCQkJCXRlWyAwIF0gPSBjICogZTsKCQkJCXRlWyA0IF0gPSAtIGMgKiBmOwoJCQkJdGVbIDggXSA9IGQ7CgoJCQkJdGVbIDEgXSA9IGFmICsgYmUgKiBkOwoJCQkJdGVbIDUgXSA9IGFlIC0gYmYgKiBkOwoJCQkJdGVbIDkgXSA9IC0gYiAqIGM7CgoJCQkJdGVbIDIgXSA9IGJmIC0gYWUgKiBkOwoJCQkJdGVbIDYgXSA9IGJlICsgYWYgKiBkOwoJCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWVhaJyApIHsKCgkJCQljb25zdCBjZSA9IGMgKiBlLCBjZiA9IGMgKiBmLCBkZSA9IGQgKiBlLCBkZiA9IGQgKiBmOwoKCQkJCXRlWyAwIF0gPSBjZSArIGRmICogYjsKCQkJCXRlWyA0IF0gPSBkZSAqIGIgLSBjZjsKCQkJCXRlWyA4IF0gPSBhICogZDsKCgkJCQl0ZVsgMSBdID0gYSAqIGY7CgkJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCQl0ZVsgOSBdID0gLSBiOwoKCQkJCXRlWyAyIF0gPSBjZiAqIGIgLSBkZTsKCQkJCXRlWyA2IF0gPSBkZiArIGNlICogYjsKCQkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1pYWScgKSB7CgoJCQkJY29uc3QgY2UgPSBjICogZSwgY2YgPSBjICogZiwgZGUgPSBkICogZSwgZGYgPSBkICogZjsKCgkJCQl0ZVsgMCBdID0gY2UgLSBkZiAqIGI7CgkJCQl0ZVsgNCBdID0gLSBhICogZjsKCQkJCXRlWyA4IF0gPSBkZSArIGNmICogYjsKCgkJCQl0ZVsgMSBdID0gY2YgKyBkZSAqIGI7CgkJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCQl0ZVsgOSBdID0gZGYgLSBjZSAqIGI7CgoJCQkJdGVbIDIgXSA9IC0gYSAqIGQ7CgkJCQl0ZVsgNiBdID0gYjsKCQkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCQl9IGVsc2UgaWYgKCBldWxlci5vcmRlciA9PT0gJ1pZWCcgKSB7CgoJCQkJY29uc3QgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKCgkJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCQl0ZVsgNCBdID0gYmUgKiBkIC0gYWY7CgkJCQl0ZVsgOCBdID0gYWUgKiBkICsgYmY7CgoJCQkJdGVbIDEgXSA9IGMgKiBmOwoJCQkJdGVbIDUgXSA9IGJmICogZCArIGFlOwoJCQkJdGVbIDkgXSA9IGFmICogZCAtIGJlOwoKCQkJCXRlWyAyIF0gPSAtIGQ7CgkJCQl0ZVsgNiBdID0gYiAqIGM7CgkJCQl0ZVsgMTAgXSA9IGEgKiBjOwoKCQkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWlgnICkgewoKCQkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgoJCQkJdGVbIDAgXSA9IGMgKiBlOwoJCQkJdGVbIDQgXSA9IGJkIC0gYWMgKiBmOwoJCQkJdGVbIDggXSA9IGJjICogZiArIGFkOwoKCQkJCXRlWyAxIF0gPSBmOwoJCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQkJdGVbIDkgXSA9IC0gYiAqIGU7CgoJCQkJdGVbIDIgXSA9IC0gZCAqIGU7CgkJCQl0ZVsgNiBdID0gYWQgKiBmICsgYmM7CgkJCQl0ZVsgMTAgXSA9IGFjIC0gYmQgKiBmOwoKCQkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdYWlknICkgewoKCQkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgoJCQkJdGVbIDAgXSA9IGMgKiBlOwoJCQkJdGVbIDQgXSA9IC0gZjsKCQkJCXRlWyA4IF0gPSBkICogZTsKCgkJCQl0ZVsgMSBdID0gYWMgKiBmICsgYmQ7CgkJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCQl0ZVsgOSBdID0gYWQgKiBmIC0gYmM7CgoJCQkJdGVbIDIgXSA9IGJjICogZiAtIGFkOwoJCQkJdGVbIDYgXSA9IGIgKiBlOwoJCQkJdGVbIDEwIF0gPSBiZCAqIGYgKyBhYzsKCgkJCX0KCgkJCS8vIGJvdHRvbSByb3cKCQkJdGVbIDMgXSA9IDA7CgkJCXRlWyA3IF0gPSAwOwoJCQl0ZVsgMTEgXSA9IDA7CgoJCQkvLyBsYXN0IGNvbHVtbgoJCQl0ZVsgMTIgXSA9IDA7CgkJCXRlWyAxMyBdID0gMDsKCQkJdGVbIDE0IF0gPSAwOwoJCQl0ZVsgMTUgXSA9IDE7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSByb3RhdGlvbiBjb21wb25lbnQgb2YgdGhpcyBtYXRyaXggdG8gdGhlIHJvdGF0aW9uIHNwZWNpZmllZCBieQoJCSAqIHRoZSBnaXZlbiBRdWF0ZXJuaW9uIGFzIG91dGxpbmVkIFtoZXJlXXtAbGluayBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Sb3RhdGlvbl9tYXRyaXgjUXVhdGVybmlvbn0KCQkgKiBUaGUgcmVzdCBvZiB0aGUgbWF0cml4IGlzIHNldCB0byB0aGUgaWRlbnRpdHkuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgUXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlUm90YXRpb25Gcm9tUXVhdGVybmlvbiggcSApIHsKCgkJCXJldHVybiB0aGlzLmNvbXBvc2UoIF96ZXJvLCBxLCBfb25lICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgcm90YXRpb24gY29tcG9uZW50IG9mIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgsIGxvb2tpbmcgZnJvbSBgZXllYCB0b3dhcmRzCgkJICogYHRhcmdldGAsIGFuZCBvcmllbnRlZCBieSB0aGUgdXAtZGlyZWN0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBleWUgLSBUaGUgZXllIHZlY3Rvci4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdXAgLSBUaGUgdXAgdmVjdG9yLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWxvb2tBdCggZXllLCB0YXJnZXQsIHVwICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJX3ouc3ViVmVjdG9ycyggZXllLCB0YXJnZXQgKTsKCgkJCWlmICggX3oubGVuZ3RoU3EoKSA9PT0gMCApIHsKCgkJCQkvLyBleWUgYW5kIHRhcmdldCBhcmUgaW4gdGhlIHNhbWUgcG9zaXRpb24KCgkJCQlfei56ID0gMTsKCgkJCX0KCgkJCV96Lm5vcm1hbGl6ZSgpOwoJCQlfeC5jcm9zc1ZlY3RvcnMoIHVwLCBfeiApOwoKCQkJaWYgKCBfeC5sZW5ndGhTcSgpID09PSAwICkgewoKCQkJCS8vIHVwIGFuZCB6IGFyZSBwYXJhbGxlbAoKCQkJCWlmICggTWF0aC5hYnMoIHVwLnogKSA9PT0gMSApIHsKCgkJCQkJX3oueCArPSAwLjAwMDE7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX3oueiArPSAwLjAwMDE7CgoJCQkJfQoKCQkJCV96Lm5vcm1hbGl6ZSgpOwoJCQkJX3guY3Jvc3NWZWN0b3JzKCB1cCwgX3ogKTsKCgkJCX0KCgkJCV94Lm5vcm1hbGl6ZSgpOwoJCQlfeS5jcm9zc1ZlY3RvcnMoIF96LCBfeCApOwoKCQkJdGVbIDAgXSA9IF94Lng7IHRlWyA0IF0gPSBfeS54OyB0ZVsgOCBdID0gX3oueDsKCQkJdGVbIDEgXSA9IF94Lnk7IHRlWyA1IF0gPSBfeS55OyB0ZVsgOSBdID0gX3oueTsKCQkJdGVbIDIgXSA9IF94Lno7IHRlWyA2IF0gPSBfeS56OyB0ZVsgMTAgXSA9IF96Lno7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBQb3N0LW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgoJCX0KCgkJLyoqCgkJICogUHJlLW11bHRpcGxpZXMgdGhpcyBtYXRyaXggYnkgdGhlIGdpdmVuIDR4NCBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgbWF0cml4IHRvIG11bHRpcGx5IHdpdGguCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJcHJlbXVsdGlwbHkoIG0gKSB7CgoJCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGVzIHRoZSBnaXZlbiA0eDQgbWF0cmljZXMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0CgkJICogaW4gdGhpcyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IGEgLSBUaGUgZmlyc3QgbWF0cml4LgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gYiAtIFRoZSBzZWNvbmQgbWF0cml4LgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgoJCQljb25zdCBhZSA9IGEuZWxlbWVudHM7CgkJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJY29uc3QgYTExID0gYWVbIDAgXSwgYTEyID0gYWVbIDQgXSwgYTEzID0gYWVbIDggXSwgYTE0ID0gYWVbIDEyIF07CgkJCWNvbnN0IGEyMSA9IGFlWyAxIF0sIGEyMiA9IGFlWyA1IF0sIGEyMyA9IGFlWyA5IF0sIGEyNCA9IGFlWyAxMyBdOwoJCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNiBdLCBhMzMgPSBhZVsgMTAgXSwgYTM0ID0gYWVbIDE0IF07CgkJCWNvbnN0IGE0MSA9IGFlWyAzIF0sIGE0MiA9IGFlWyA3IF0sIGE0MyA9IGFlWyAxMSBdLCBhNDQgPSBhZVsgMTUgXTsKCgkJCWNvbnN0IGIxMSA9IGJlWyAwIF0sIGIxMiA9IGJlWyA0IF0sIGIxMyA9IGJlWyA4IF0sIGIxNCA9IGJlWyAxMiBdOwoJCQljb25zdCBiMjEgPSBiZVsgMSBdLCBiMjIgPSBiZVsgNSBdLCBiMjMgPSBiZVsgOSBdLCBiMjQgPSBiZVsgMTMgXTsKCQkJY29uc3QgYjMxID0gYmVbIDIgXSwgYjMyID0gYmVbIDYgXSwgYjMzID0gYmVbIDEwIF0sIGIzNCA9IGJlWyAxNCBdOwoJCQljb25zdCBiNDEgPSBiZVsgMyBdLCBiNDIgPSBiZVsgNyBdLCBiNDMgPSBiZVsgMTEgXSwgYjQ0ID0gYmVbIDE1IF07CgoJCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwoJCQl0ZVsgNCBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyICsgYTE0ICogYjQyOwoJCQl0ZVsgOCBdID0gYTExICogYjEzICsgYTEyICogYjIzICsgYTEzICogYjMzICsgYTE0ICogYjQzOwoJCQl0ZVsgMTIgXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKCgkJCXRlWyAxIF0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzEgKyBhMjQgKiBiNDE7CgkJCXRlWyA1IF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzIgKyBhMjQgKiBiNDI7CgkJCXRlWyA5IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzMgKyBhMjQgKiBiNDM7CgkJCXRlWyAxMyBdID0gYTIxICogYjE0ICsgYTIyICogYjI0ICsgYTIzICogYjM0ICsgYTI0ICogYjQ0OwoKCQkJdGVbIDIgXSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMSArIGEzNCAqIGI0MTsKCQkJdGVbIDYgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMiArIGEzNCAqIGI0MjsKCQkJdGVbIDEwIF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzMgKyBhMzQgKiBiNDM7CgkJCXRlWyAxNCBdID0gYTMxICogYjE0ICsgYTMyICogYjI0ICsgYTMzICogYjM0ICsgYTM0ICogYjQ0OwoKCQkJdGVbIDMgXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKCQkJdGVbIDcgXSA9IGE0MSAqIGIxMiArIGE0MiAqIGIyMiArIGE0MyAqIGIzMiArIGE0NCAqIGI0MjsKCQkJdGVbIDExIF0gPSBhNDEgKiBiMTMgKyBhNDIgKiBiMjMgKyBhNDMgKiBiMzMgKyBhNDQgKiBiNDM7CgkJCXRlWyAxNSBdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyBldmVyeSBjb21wb25lbnQgb2YgdGhlIG1hdHJpeCBieSB0aGUgZ2l2ZW4gc2NhbGFyLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBUaGUgc2NhbGFyLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW11bHRpcGx5U2NhbGFyKCBzICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJdGVbIDAgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA4IF0gKj0gczsgdGVbIDEyIF0gKj0gczsKCQkJdGVbIDEgXSAqPSBzOyB0ZVsgNSBdICo9IHM7IHRlWyA5IF0gKj0gczsgdGVbIDEzIF0gKj0gczsKCQkJdGVbIDIgXSAqPSBzOyB0ZVsgNiBdICo9IHM7IHRlWyAxMCBdICo9IHM7IHRlWyAxNCBdICo9IHM7CgkJCXRlWyAzIF0gKj0gczsgdGVbIDcgXSAqPSBzOyB0ZVsgMTEgXSAqPSBzOyB0ZVsgMTUgXSAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgYW5kIHJldHVybnMgdGhlIGRldGVybWluYW50IG9mIHRoaXMgbWF0cml4LgoJCSAqCgkJICogQmFzZWQgb24gdGhlIG1ldGhvZCBvdXRsaW5lZCBbaGVyZV17QGxpbmsgaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtbH0uCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBkZXRlcm1pbmFudC4KCQkgKi8KCQlkZXRlcm1pbmFudCgpIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWNvbnN0IG4xMSA9IHRlWyAwIF0sIG4xMiA9IHRlWyA0IF0sIG4xMyA9IHRlWyA4IF0sIG4xNCA9IHRlWyAxMiBdOwoJCQljb25zdCBuMjEgPSB0ZVsgMSBdLCBuMjIgPSB0ZVsgNSBdLCBuMjMgPSB0ZVsgOSBdLCBuMjQgPSB0ZVsgMTMgXTsKCQkJY29uc3QgbjMxID0gdGVbIDIgXSwgbjMyID0gdGVbIDYgXSwgbjMzID0gdGVbIDEwIF0sIG4zNCA9IHRlWyAxNCBdOwoJCQljb25zdCBuNDEgPSB0ZVsgMyBdLCBuNDIgPSB0ZVsgNyBdLCBuNDMgPSB0ZVsgMTEgXSwgbjQ0ID0gdGVbIDE1IF07CgoJCQkvL1RPRE86IG1ha2UgdGhpcyBtb3JlIGVmZmljaWVudAoKCQkJcmV0dXJuICgKCQkJCW40MSAqICgKCQkJCQkrIG4xNCAqIG4yMyAqIG4zMgoJCQkJCSAtIG4xMyAqIG4yNCAqIG4zMgoJCQkJCSAtIG4xNCAqIG4yMiAqIG4zMwoJCQkJCSArIG4xMiAqIG4yNCAqIG4zMwoJCQkJCSArIG4xMyAqIG4yMiAqIG4zNAoJCQkJCSAtIG4xMiAqIG4yMyAqIG4zNAoJCQkJKSArCgkJCQluNDIgKiAoCgkJCQkJKyBuMTEgKiBuMjMgKiBuMzQKCQkJCQkgLSBuMTEgKiBuMjQgKiBuMzMKCQkJCQkgKyBuMTQgKiBuMjEgKiBuMzMKCQkJCQkgLSBuMTMgKiBuMjEgKiBuMzQKCQkJCQkgKyBuMTMgKiBuMjQgKiBuMzEKCQkJCQkgLSBuMTQgKiBuMjMgKiBuMzEKCQkJCSkgKwoJCQkJbjQzICogKAoJCQkJCSsgbjExICogbjI0ICogbjMyCgkJCQkJIC0gbjExICogbjIyICogbjM0CgkJCQkJIC0gbjE0ICogbjIxICogbjMyCgkJCQkJICsgbjEyICogbjIxICogbjM0CgkJCQkJICsgbjE0ICogbjIyICogbjMxCgkJCQkJIC0gbjEyICogbjI0ICogbjMxCgkJCQkpICsKCQkJCW40NCAqICgKCQkJCQktIG4xMyAqIG4yMiAqIG4zMQoJCQkJCSAtIG4xMSAqIG4yMyAqIG4zMgoJCQkJCSArIG4xMSAqIG4yMiAqIG4zMwoJCQkJCSArIG4xMyAqIG4yMSAqIG4zMgoJCQkJCSAtIG4xMiAqIG4yMSAqIG4zMwoJCQkJCSArIG4xMiAqIG4yMyAqIG4zMQoJCQkJKQoKCQkJKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc3Bvc2VzIHRoaXMgbWF0cml4IGluIHBsYWNlLgoJCSAqCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJdHJhbnNwb3NlKCkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQlsZXQgdG1wOwoKCQkJdG1wID0gdGVbIDEgXTsgdGVbIDEgXSA9IHRlWyA0IF07IHRlWyA0IF0gPSB0bXA7CgkJCXRtcCA9IHRlWyAyIF07IHRlWyAyIF0gPSB0ZVsgOCBdOyB0ZVsgOCBdID0gdG1wOwoJCQl0bXAgPSB0ZVsgNiBdOyB0ZVsgNiBdID0gdGVbIDkgXTsgdGVbIDkgXSA9IHRtcDsKCgkJCXRtcCA9IHRlWyAzIF07IHRlWyAzIF0gPSB0ZVsgMTIgXTsgdGVbIDEyIF0gPSB0bXA7CgkJCXRtcCA9IHRlWyA3IF07IHRlWyA3IF0gPSB0ZVsgMTMgXTsgdGVbIDEzIF0gPSB0bXA7CgkJCXRtcCA9IHRlWyAxMSBdOyB0ZVsgMTEgXSA9IHRlWyAxNCBdOyB0ZVsgMTQgXSA9IHRtcDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHBvc2l0aW9uIGNvbXBvbmVudCBmb3IgdGhpcyBtYXRyaXggZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLAoJCSAqIHdpdGhvdXQgYWZmZWN0aW5nIHRoZSByZXN0IG9mIHRoZSBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcnxWZWN0b3IzfSB4IC0gVGhlIHggY29tcG9uZW50IG9mIHRoZSB2ZWN0b3Igb3IgYWx0ZXJuYXRpdmVseSB0aGUgdmVjdG9yIG9iamVjdC4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIHogY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IuCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJc2V0UG9zaXRpb24oIHgsIHksIHogKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJCXRlWyAxMiBdID0geC54OwoJCQkJdGVbIDEzIF0gPSB4Lnk7CgkJCQl0ZVsgMTQgXSA9IHguejsKCgkJCX0gZWxzZSB7CgoJCQkJdGVbIDEyIF0gPSB4OwoJCQkJdGVbIDEzIF0gPSB5OwoJCQkJdGVbIDE0IF0gPSB6OwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogSW52ZXJ0cyB0aGlzIG1hdHJpeCwgdXNpbmcgdGhlIFthbmFseXRpYyBtZXRob2Rde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludmVydGlibGVfbWF0cml4I0FuYWx5dGljX3NvbHV0aW9ufS4KCQkgKiBZb3UgY2FuIG5vdCBpbnZlcnQgd2l0aCBhIGRldGVybWluYW50IG9mIHplcm8uIElmIHlvdSBhdHRlbXB0IHRoaXMsIHRoZSBtZXRob2QgcHJvZHVjZXMKCQkgKiBhIHplcm8gbWF0cml4IGluc3RlYWQuCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlpbnZlcnQoKSB7CgoJCQkvLyBiYXNlZCBvbiBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL21hdHJpeC9mdW5jdGlvbnMvaW52ZXJzZS9mb3VyRC9pbmRleC5odG0KCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKCQkJCW4xMSA9IHRlWyAwIF0sIG4yMSA9IHRlWyAxIF0sIG4zMSA9IHRlWyAyIF0sIG40MSA9IHRlWyAzIF0sCgkJCQluMTIgPSB0ZVsgNCBdLCBuMjIgPSB0ZVsgNSBdLCBuMzIgPSB0ZVsgNiBdLCBuNDIgPSB0ZVsgNyBdLAoJCQkJbjEzID0gdGVbIDggXSwgbjIzID0gdGVbIDkgXSwgbjMzID0gdGVbIDEwIF0sIG40MyA9IHRlWyAxMSBdLAoJCQkJbjE0ID0gdGVbIDEyIF0sIG4yNCA9IHRlWyAxMyBdLCBuMzQgPSB0ZVsgMTQgXSwgbjQ0ID0gdGVbIDE1IF0sCgoJCQkJdDExID0gbjIzICogbjM0ICogbjQyIC0gbjI0ICogbjMzICogbjQyICsgbjI0ICogbjMyICogbjQzIC0gbjIyICogbjM0ICogbjQzIC0gbjIzICogbjMyICogbjQ0ICsgbjIyICogbjMzICogbjQ0LAoJCQkJdDEyID0gbjE0ICogbjMzICogbjQyIC0gbjEzICogbjM0ICogbjQyIC0gbjE0ICogbjMyICogbjQzICsgbjEyICogbjM0ICogbjQzICsgbjEzICogbjMyICogbjQ0IC0gbjEyICogbjMzICogbjQ0LAoJCQkJdDEzID0gbjEzICogbjI0ICogbjQyIC0gbjE0ICogbjIzICogbjQyICsgbjE0ICogbjIyICogbjQzIC0gbjEyICogbjI0ICogbjQzIC0gbjEzICogbjIyICogbjQ0ICsgbjEyICogbjIzICogbjQ0LAoJCQkJdDE0ID0gbjE0ICogbjIzICogbjMyIC0gbjEzICogbjI0ICogbjMyIC0gbjE0ICogbjIyICogbjMzICsgbjEyICogbjI0ICogbjMzICsgbjEzICogbjIyICogbjM0IC0gbjEyICogbjIzICogbjM0OwoKCQkJY29uc3QgZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzICsgbjQxICogdDE0OwoKCQkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCgkJCWNvbnN0IGRldEludiA9IDEgLyBkZXQ7CgoJCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCQl0ZVsgMSBdID0gKCBuMjQgKiBuMzMgKiBuNDEgLSBuMjMgKiBuMzQgKiBuNDEgLSBuMjQgKiBuMzEgKiBuNDMgKyBuMjEgKiBuMzQgKiBuNDMgKyBuMjMgKiBuMzEgKiBuNDQgLSBuMjEgKiBuMzMgKiBuNDQgKSAqIGRldEludjsKCQkJdGVbIDIgXSA9ICggbjIyICogbjM0ICogbjQxIC0gbjI0ICogbjMyICogbjQxICsgbjI0ICogbjMxICogbjQyIC0gbjIxICogbjM0ICogbjQyIC0gbjIyICogbjMxICogbjQ0ICsgbjIxICogbjMyICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyAzIF0gPSAoIG4yMyAqIG4zMiAqIG40MSAtIG4yMiAqIG4zMyAqIG40MSAtIG4yMyAqIG4zMSAqIG40MiArIG4yMSAqIG4zMyAqIG40MiArIG4yMiAqIG4zMSAqIG40MyAtIG4yMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKCQkJdGVbIDQgXSA9IHQxMiAqIGRldEludjsKCQkJdGVbIDUgXSA9ICggbjEzICogbjM0ICogbjQxIC0gbjE0ICogbjMzICogbjQxICsgbjE0ICogbjMxICogbjQzIC0gbjExICogbjM0ICogbjQzIC0gbjEzICogbjMxICogbjQ0ICsgbjExICogbjMzICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyA2IF0gPSAoIG4xNCAqIG4zMiAqIG40MSAtIG4xMiAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMSAqIG40MiArIG4xMSAqIG4zNCAqIG40MiArIG4xMiAqIG4zMSAqIG40NCAtIG4xMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgNyBdID0gKCBuMTIgKiBuMzMgKiBuNDEgLSBuMTMgKiBuMzIgKiBuNDEgKyBuMTMgKiBuMzEgKiBuNDIgLSBuMTEgKiBuMzMgKiBuNDIgLSBuMTIgKiBuMzEgKiBuNDMgKyBuMTEgKiBuMzIgKiBuNDMgKSAqIGRldEludjsKCgkJCXRlWyA4IF0gPSB0MTMgKiBkZXRJbnY7CgkJCXRlWyA5IF0gPSAoIG4xNCAqIG4yMyAqIG40MSAtIG4xMyAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMSAqIG40MyArIG4xMSAqIG4yNCAqIG40MyArIG4xMyAqIG4yMSAqIG40NCAtIG4xMSAqIG4yMyAqIG40NCApICogZGV0SW52OwoJCQl0ZVsgMTAgXSA9ICggbjEyICogbjI0ICogbjQxIC0gbjE0ICogbjIyICogbjQxICsgbjE0ICogbjIxICogbjQyIC0gbjExICogbjI0ICogbjQyIC0gbjEyICogbjIxICogbjQ0ICsgbjExICogbjIyICogbjQ0ICkgKiBkZXRJbnY7CgkJCXRlWyAxMSBdID0gKCBuMTMgKiBuMjIgKiBuNDEgLSBuMTIgKiBuMjMgKiBuNDEgLSBuMTMgKiBuMjEgKiBuNDIgKyBuMTEgKiBuMjMgKiBuNDIgKyBuMTIgKiBuMjEgKiBuNDMgLSBuMTEgKiBuMjIgKiBuNDMgKSAqIGRldEludjsKCgkJCXRlWyAxMiBdID0gdDE0ICogZGV0SW52OwoJCQl0ZVsgMTMgXSA9ICggbjEzICogbjI0ICogbjMxIC0gbjE0ICogbjIzICogbjMxICsgbjE0ICogbjIxICogbjMzIC0gbjExICogbjI0ICogbjMzIC0gbjEzICogbjIxICogbjM0ICsgbjExICogbjIzICogbjM0ICkgKiBkZXRJbnY7CgkJCXRlWyAxNCBdID0gKCBuMTQgKiBuMjIgKiBuMzEgLSBuMTIgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjEgKiBuMzIgKyBuMTEgKiBuMjQgKiBuMzIgKyBuMTIgKiBuMjEgKiBuMzQgLSBuMTEgKiBuMjIgKiBuMzQgKSAqIGRldEludjsKCQkJdGVbIDE1IF0gPSAoIG4xMiAqIG4yMyAqIG4zMSAtIG4xMyAqIG4yMiAqIG4zMSArIG4xMyAqIG4yMSAqIG4zMiAtIG4xMSAqIG4yMyAqIG4zMiAtIG4xMiAqIG4yMSAqIG4zMyArIG4xMSAqIG4yMiAqIG4zMyApICogZGV0SW52OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgY29sdW1ucyBvZiB0aGlzIG1hdHJpeCBieSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHNjYWxlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlzY2FsZSggdiApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQkJY29uc3QgeCA9IHYueCwgeSA9IHYueSwgeiA9IHYuejsKCgkJCXRlWyAwIF0gKj0geDsgdGVbIDQgXSAqPSB5OyB0ZVsgOCBdICo9IHo7CgkJCXRlWyAxIF0gKj0geDsgdGVbIDUgXSAqPSB5OyB0ZVsgOSBdICo9IHo7CgkJCXRlWyAyIF0gKj0geDsgdGVbIDYgXSAqPSB5OyB0ZVsgMTAgXSAqPSB6OwoJCQl0ZVsgMyBdICo9IHg7IHRlWyA3IF0gKj0geTsgdGVbIDExIF0gKj0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEdldHMgdGhlIG1heGltdW0gc2NhbGUgdmFsdWUgb2YgdGhlIHRocmVlIGF4ZXMuCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBtYXhpbXVtIHNjYWxlLgoJCSAqLwoJCWdldE1heFNjYWxlT25BeGlzKCkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJY29uc3Qgc2NhbGVYU3EgPSB0ZVsgMCBdICogdGVbIDAgXSArIHRlWyAxIF0gKiB0ZVsgMSBdICsgdGVbIDIgXSAqIHRlWyAyIF07CgkJCWNvbnN0IHNjYWxlWVNxID0gdGVbIDQgXSAqIHRlWyA0IF0gKyB0ZVsgNSBdICogdGVbIDUgXSArIHRlWyA2IF0gKiB0ZVsgNiBdOwoJCQljb25zdCBzY2FsZVpTcSA9IHRlWyA4IF0gKiB0ZVsgOCBdICsgdGVbIDkgXSAqIHRlWyA5IF0gKyB0ZVsgMTAgXSAqIHRlWyAxMCBdOwoKCQkJcmV0dXJuIE1hdGguc3FydCggTWF0aC5tYXgoIHNjYWxlWFNxLCBzY2FsZVlTcSwgc2NhbGVaU3EgKSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSB0cmFuc2xhdGlvbiB0cmFuc2Zvcm0gZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ8VmVjdG9yM30geCAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBYIGF4aXMgb3IgYWx0ZXJuYXRpdmVseSBhIHRyYW5zbGF0aW9uIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbW91bnQgdG8gdHJhbnNsYXRlIGluIHRoZSBZIGF4aXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW1vdW50IHRvIHRyYW5zbGF0ZSBpbiB0aGUgeiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VUcmFuc2xhdGlvbiggeCwgeSwgeiApIHsKCgkJCWlmICggeC5pc1ZlY3RvcjMgKSB7CgoJCQkJdGhpcy5zZXQoCgoJCQkJCTEsIDAsIDAsIHgueCwKCQkJCQkwLCAxLCAwLCB4LnksCgkJCQkJMCwgMCwgMSwgeC56LAoJCQkJCTAsIDAsIDAsIDEKCgkJCQkpOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNldCgKCgkJCQkJMSwgMCwgMCwgeCwKCQkJCQkwLCAxLCAwLCB5LAoJCQkJCTAsIDAsIDEsIHosCgkJCQkJMCwgMCwgMCwgMQoKCQkJCSk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFggYXhpcyBieQoJCSAqIHRoZSBnaXZlbiBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvblgoIHRoZXRhICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCAwLCAwLCAwLAoJCQkJMCwgYywgLSBzLCAwLAoJCQkJMCwgcywgYywgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFkgYXhpcyBieQoJCSAqIHRoZSBnaXZlbiBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvblkoIHRoZXRhICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQkgYywgMCwgcywgMCwKCQkJCSAwLCAxLCAwLCAwLAoJCQkJLSBzLCAwLCBjLCAwLAoJCQkJIDAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIFogYXhpcyBieQoJCSAqIHRoZSBnaXZlbiBhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB0aGV0YSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvblooIHRoZXRhICkgewoKCQkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCQl0aGlzLnNldCgKCgkJCQljLCAtIHMsIDAsIDAsCgkJCQlzLCBjLCAwLCAwLAoJCQkJMCwgMCwgMSwgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBhcm91bmQgdGhlIGdpdmVuIGF4aXMgYnkKCQkgKiB0aGUgZ2l2ZW4gYW5nbGUuCgkJICoKCQkgKiBUaGlzIGlzIGEgc29tZXdoYXQgY29udHJvdmVyc2lhbCBidXQgbWF0aGVtYXRpY2FsbHkgc291bmQgYWx0ZXJuYXRpdmUgdG8KCQkgKiByb3RhdGluZyB2aWEgUXVhdGVybmlvbnMuIFNlZSB0aGUgZGlzY3Vzc2lvbiBbaGVyZV17QGxpbmsgaHR0cHM6Ly93d3cuZ2FtZWRldi5uZXQvYXJ0aWNsZXMvcHJvZ3JhbW1pbmcvbWF0aC1hbmQtcGh5c2ljcy9kby13ZS1yZWFsbHktbmVlZC1xdWF0ZXJuaW9ucy1yMTE5OX0uCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgbm9ybWFsaXplZCByb3RhdGlvbiBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSByb3RhdGlvbiBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VSb3RhdGlvbkF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkJLy8gQmFzZWQgb24gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9yZWZlcmVuY2UvYXJ0aWNsZXMvYXJ0aWNsZTExOTkuYXNwCgoJCQljb25zdCBjID0gTWF0aC5jb3MoIGFuZ2xlICk7CgkJCWNvbnN0IHMgPSBNYXRoLnNpbiggYW5nbGUgKTsKCQkJY29uc3QgdCA9IDEgLSBjOwoJCQljb25zdCB4ID0gYXhpcy54LCB5ID0gYXhpcy55LCB6ID0gYXhpcy56OwoJCQljb25zdCB0eCA9IHQgKiB4LCB0eSA9IHQgKiB5OwoKCQkJdGhpcy5zZXQoCgoJCQkJdHggKiB4ICsgYywgdHggKiB5IC0gcyAqIHosIHR4ICogeiArIHMgKiB5LCAwLAoJCQkJdHggKiB5ICsgcyAqIHosIHR5ICogeSArIGMsIHR5ICogeiAtIHMgKiB4LCAwLAoJCQkJdHggKiB6IC0gcyAqIHksIHR5ICogeiArIHMgKiB4LCB0ICogeiAqIHogKyBjLCAwLAoJCQkJMCwgMCwgMCwgMQoKCQkJKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBtYXRyaXggYXMgYSBzY2FsZSB0cmFuc2Zvcm1hdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWCBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWSBheGlzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB6IC0gVGhlIGFtb3VudCB0byBzY2FsZSBpbiB0aGUgWiBheGlzLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCW1ha2VTY2FsZSggeCwgeSwgeiApIHsKCgkJCXRoaXMuc2V0KAoKCQkJCXgsIDAsIDAsIDAsCgkJCQkwLCB5LCAwLCAwLAoJCQkJMCwgMCwgeiwgMCwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgbWF0cml4IGFzIGEgc2hlYXIgdHJhbnNmb3JtYXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geHkgLSBUaGUgYW1vdW50IHRvIHNoZWFyIFggYnkgWS4KCQkgKiBAcGFyYW0ge251bWJlcn0geHogLSBUaGUgYW1vdW50IHRvIHNoZWFyIFggYnkgWi4KCQkgKiBAcGFyYW0ge251bWJlcn0geXggLSBUaGUgYW1vdW50IHRvIHNoZWFyIFkgYnkgWC4KCQkgKiBAcGFyYW0ge251bWJlcn0geXogLSBUaGUgYW1vdW50IHRvIHNoZWFyIFkgYnkgWi4KCQkgKiBAcGFyYW0ge251bWJlcn0genggLSBUaGUgYW1vdW50IHRvIHNoZWFyIFogYnkgWC4KCQkgKiBAcGFyYW0ge251bWJlcn0genkgLSBUaGUgYW1vdW50IHRvIHNoZWFyIFogYnkgWS4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlU2hlYXIoIHh5LCB4eiwgeXgsIHl6LCB6eCwgenkgKSB7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCB5eCwgengsIDAsCgkJCQl4eSwgMSwgenksIDAsCgkJCQl4eiwgeXosIDEsIDAsCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIG1hdHJpeCB0byB0aGUgdHJhbnNmb3JtYXRpb24gY29tcG9zZWQgb2YgdGhlIGdpdmVuIHBvc2l0aW9uLAoJCSAqIHJvdGF0aW9uIChRdWF0ZXJuaW9uKSBhbmQgc2NhbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvc2l0aW9uIC0gVGhlIHBvc2l0aW9uIHZlY3Rvci4KCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHF1YXRlcm5pb24gLSBUaGUgcm90YXRpb24gYXMgYSBRdWF0ZXJuaW9uLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gc2NhbGUgLSBUaGUgc2NhbGUgdmVjdG9yLgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWNvbnN0IHggPSBxdWF0ZXJuaW9uLl94LCB5ID0gcXVhdGVybmlvbi5feSwgeiA9IHF1YXRlcm5pb24uX3osIHcgPSBxdWF0ZXJuaW9uLl93OwoJCQljb25zdCB4MiA9IHggKyB4LAl5MiA9IHkgKyB5LCB6MiA9IHogKyB6OwoJCQljb25zdCB4eCA9IHggKiB4MiwgeHkgPSB4ICogeTIsIHh6ID0geCAqIHoyOwoJCQljb25zdCB5eSA9IHkgKiB5MiwgeXogPSB5ICogejIsIHp6ID0geiAqIHoyOwoJCQljb25zdCB3eCA9IHcgKiB4Miwgd3kgPSB3ICogeTIsIHd6ID0gdyAqIHoyOwoKCQkJY29uc3Qgc3ggPSBzY2FsZS54LCBzeSA9IHNjYWxlLnksIHN6ID0gc2NhbGUuejsKCgkJCXRlWyAwIF0gPSAoIDEgLSAoIHl5ICsgenogKSApICogc3g7CgkJCXRlWyAxIF0gPSAoIHh5ICsgd3ogKSAqIHN4OwoJCQl0ZVsgMiBdID0gKCB4eiAtIHd5ICkgKiBzeDsKCQkJdGVbIDMgXSA9IDA7CgoJCQl0ZVsgNCBdID0gKCB4eSAtIHd6ICkgKiBzeTsKCQkJdGVbIDUgXSA9ICggMSAtICggeHggKyB6eiApICkgKiBzeTsKCQkJdGVbIDYgXSA9ICggeXogKyB3eCApICogc3k7CgkJCXRlWyA3IF0gPSAwOwoKCQkJdGVbIDggXSA9ICggeHogKyB3eSApICogc3o7CgkJCXRlWyA5IF0gPSAoIHl6IC0gd3ggKSAqIHN6OwoJCQl0ZVsgMTAgXSA9ICggMSAtICggeHggKyB5eSApICkgKiBzejsKCQkJdGVbIDExIF0gPSAwOwoKCQkJdGVbIDEyIF0gPSBwb3NpdGlvbi54OwoJCQl0ZVsgMTMgXSA9IHBvc2l0aW9uLnk7CgkJCXRlWyAxNCBdID0gcG9zaXRpb24uejsKCQkJdGVbIDE1IF0gPSAxOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRGVjb21wb3NlcyB0aGlzIG1hdHJpeCBpbnRvIGl0cyBwb3NpdGlvbiwgcm90YXRpb24gYW5kIHNjYWxlIGNvbXBvbmVudHMKCQkgKiBhbmQgcHJvdmlkZXMgdGhlIHJlc3VsdCBpbiB0aGUgZ2l2ZW4gb2JqZWN0cy4KCQkgKgoJCSAqIE5vdGU6IE5vdCBhbGwgbWF0cmljZXMgYXJlIGRlY29tcG9zYWJsZSBpbiB0aGlzIHdheS4gRm9yIGV4YW1wbGUsIGlmIGFuCgkJICogb2JqZWN0IGhhcyBhIG5vbi11bmlmb3JtbHkgc2NhbGVkIHBhcmVudCwgdGhlbiB0aGUgb2JqZWN0J3Mgd29ybGQgbWF0cml4CgkJICogbWF5IG5vdCBiZSBkZWNvbXBvc2FibGUsIGFuZCB0aGlzIG1ldGhvZCBtYXkgbm90IGJlIGFwcHJvcHJpYXRlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb3NpdGlvbiAtIFRoZSBwb3NpdGlvbiB2ZWN0b3IuCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxdWF0ZXJuaW9uIC0gVGhlIHJvdGF0aW9uIGFzIGEgUXVhdGVybmlvbi4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHNjYWxlIC0gVGhlIHNjYWxlIHZlY3Rvci4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQlkZWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJCWxldCBzeCA9IF92MSQ1LnNldCggdGVbIDAgXSwgdGVbIDEgXSwgdGVbIDIgXSApLmxlbmd0aCgpOwoJCQljb25zdCBzeSA9IF92MSQ1LnNldCggdGVbIDQgXSwgdGVbIDUgXSwgdGVbIDYgXSApLmxlbmd0aCgpOwoJCQljb25zdCBzeiA9IF92MSQ1LnNldCggdGVbIDggXSwgdGVbIDkgXSwgdGVbIDEwIF0gKS5sZW5ndGgoKTsKCgkJCS8vIGlmIGRldGVybWluZSBpcyBuZWdhdGl2ZSwgd2UgbmVlZCB0byBpbnZlcnQgb25lIHNjYWxlCgkJCWNvbnN0IGRldCA9IHRoaXMuZGV0ZXJtaW5hbnQoKTsKCQkJaWYgKCBkZXQgPCAwICkgc3ggPSAtIHN4OwoKCQkJcG9zaXRpb24ueCA9IHRlWyAxMiBdOwoJCQlwb3NpdGlvbi55ID0gdGVbIDEzIF07CgkJCXBvc2l0aW9uLnogPSB0ZVsgMTQgXTsKCgkJCS8vIHNjYWxlIHRoZSByb3RhdGlvbiBwYXJ0CgkJCV9tMSQyLmNvcHkoIHRoaXMgKTsKCgkJCWNvbnN0IGludlNYID0gMSAvIHN4OwoJCQljb25zdCBpbnZTWSA9IDEgLyBzeTsKCQkJY29uc3QgaW52U1ogPSAxIC8gc3o7CgoJCQlfbTEkMi5lbGVtZW50c1sgMCBdICo9IGludlNYOwoJCQlfbTEkMi5lbGVtZW50c1sgMSBdICo9IGludlNYOwoJCQlfbTEkMi5lbGVtZW50c1sgMiBdICo9IGludlNYOwoKCQkJX20xJDIuZWxlbWVudHNbIDQgXSAqPSBpbnZTWTsKCQkJX20xJDIuZWxlbWVudHNbIDUgXSAqPSBpbnZTWTsKCQkJX20xJDIuZWxlbWVudHNbIDYgXSAqPSBpbnZTWTsKCgkJCV9tMSQyLmVsZW1lbnRzWyA4IF0gKj0gaW52U1o7CgkJCV9tMSQyLmVsZW1lbnRzWyA5IF0gKj0gaW52U1o7CgkJCV9tMSQyLmVsZW1lbnRzWyAxMCBdICo9IGludlNaOwoKCQkJcXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQyICk7CgoJCQlzY2FsZS54ID0gc3g7CgkJCXNjYWxlLnkgPSBzeTsKCQkJc2NhbGUueiA9IHN6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ3JlYXRlcyBhIHBlcnNwZWN0aXZlIHByb2plY3Rpb24gbWF0cml4LiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSBieQoJCSAqIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSN1cGRhdGVQcm9qZWN0aW9uTWF0cml4fS4KCgkJICogQHBhcmFtIHtudW1iZXJ9IGxlZnQgLSBMZWZ0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHJpZ2h0IC0gUmlnaHQgYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gdG9wIC0gVG9wIGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbSAtIEJvdHRvbSBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBuZWFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGRpc3RhbmNlIGZyb20gdGhlIGNhbWVyYSB0byB0aGUgZmFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0gW2Nvb3JkaW5hdGVTeXN0ZW09V2ViR0xDb29yZGluYXRlU3lzdGVtXSAtIFRoZSBjb29yZGluYXRlIHN5c3RlbS4KCQkgKiBAcmV0dXJuIHtNYXRyaXg0fSBBIHJlZmVyZW5jZSB0byB0aGlzIG1hdHJpeC4KCQkgKi8KCQltYWtlUGVyc3BlY3RpdmUoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgbmVhciwgZmFyLCBjb29yZGluYXRlU3lzdGVtID0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCQljb25zdCB4ID0gMiAqIG5lYXIgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQljb25zdCB5ID0gMiAqIG5lYXIgLyAoIHRvcCAtIGJvdHRvbSApOwoKCQkJY29uc3QgYSA9ICggcmlnaHQgKyBsZWZ0ICkgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQljb25zdCBiID0gKCB0b3AgKyBib3R0b20gKSAvICggdG9wIC0gYm90dG9tICk7CgoJCQlsZXQgYywgZDsKCgkJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJCWMgPSAtICggZmFyICsgbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgkJCQlkID0gKCAtMiAqIGZhciAqIG5lYXIgKSAvICggZmFyIC0gbmVhciApOwoKCQkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCQljID0gLSBmYXIgLyAoIGZhciAtIG5lYXIgKTsKCQkJCWQgPSAoIC0gZmFyICogbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgoJCQl9IGVsc2UgewoKCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLk1hdHJpeDQubWFrZVBlcnNwZWN0aXZlKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCQl9CgoJCQl0ZVsgMCBdID0geDsJdGVbIDQgXSA9IDA7CXRlWyA4IF0gPSBhOyAJdGVbIDEyIF0gPSAwOwoJCQl0ZVsgMSBdID0gMDsJdGVbIDUgXSA9IHk7CXRlWyA5IF0gPSBiOyAJdGVbIDEzIF0gPSAwOwoJCQl0ZVsgMiBdID0gMDsJdGVbIDYgXSA9IDA7CXRlWyAxMCBdID0gYzsgCXRlWyAxNCBdID0gZDsKCQkJdGVbIDMgXSA9IDA7CXRlWyA3IF0gPSAwOwl0ZVsgMTEgXSA9IC0xOwl0ZVsgMTUgXSA9IDA7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDcmVhdGVzIGEgb3J0aG9ncmFwaGljIHByb2plY3Rpb24gbWF0cml4LiBUaGlzIGlzIHVzZWQgaW50ZXJuYWxseSBieQoJCSAqIHtAbGluayBPcnRob2dyYXBoaWNDYW1lcmEjdXBkYXRlUHJvamVjdGlvbk1hdHJpeH0uCgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0IC0gTGVmdCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByaWdodCAtIFJpZ2h0IGJvdW5kYXJ5IG9mIHRoZSB2aWV3aW5nIGZydXN0dW0gYXQgdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHRvcCAtIFRvcCBib3VuZGFyeSBvZiB0aGUgdmlld2luZyBmcnVzdHVtIGF0IHRoZSBuZWFyIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBib3R0b20gLSBCb3R0b20gYm91bmRhcnkgb2YgdGhlIHZpZXdpbmcgZnJ1c3R1bSBhdCB0aGUgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gbmVhciAtIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIG5lYXIgcGxhbmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGZhciAtIFRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjYW1lcmEgdG8gdGhlIGZhciBwbGFuZS4KCQkgKiBAcGFyYW0geyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9IFtjb29yZGluYXRlU3lzdGVtPVdlYkdMQ29vcmRpbmF0ZVN5c3RlbV0gLSBUaGUgY29vcmRpbmF0ZSBzeXN0ZW0uCgkJICogQHJldHVybiB7TWF0cml4NH0gQSByZWZlcmVuY2UgdG8gdGhpcyBtYXRyaXguCgkJICovCgkJbWFrZU9ydGhvZ3JhcGhpYyggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIsIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJCWNvbnN0IHcgPSAxLjAgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCQljb25zdCBoID0gMS4wIC8gKCB0b3AgLSBib3R0b20gKTsKCQkJY29uc3QgcCA9IDEuMCAvICggZmFyIC0gbmVhciApOwoKCQkJY29uc3QgeCA9ICggcmlnaHQgKyBsZWZ0ICkgKiB3OwoJCQljb25zdCB5ID0gKCB0b3AgKyBib3R0b20gKSAqIGg7CgoJCQlsZXQgeiwgekludjsKCgkJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJCXogPSAoIGZhciArIG5lYXIgKSAqIHA7CgkJCQl6SW52ID0gLTIgKiBwOwoKCQkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCQl6ID0gbmVhciAqIHA7CgkJCQl6SW52ID0gLTEgKiBwOwoKCQkJfSBlbHNlIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5NYXRyaXg0Lm1ha2VPcnRob2dyYXBoaWMoKTogSW52YWxpZCBjb29yZGluYXRlIHN5c3RlbTogJyArIGNvb3JkaW5hdGVTeXN0ZW0gKTsKCgkJCX0KCgkJCXRlWyAwIF0gPSAyICogdzsJdGVbIDQgXSA9IDA7CQl0ZVsgOCBdID0gMDsgCQl0ZVsgMTIgXSA9IC0geDsKCQkJdGVbIDEgXSA9IDA7IAkJdGVbIDUgXSA9IDIgKiBoOwl0ZVsgOSBdID0gMDsgCQl0ZVsgMTMgXSA9IC0geTsKCQkJdGVbIDIgXSA9IDA7IAkJdGVbIDYgXSA9IDA7CQl0ZVsgMTAgXSA9IHpJbnY7CXRlWyAxNCBdID0gLSB6OwoJCQl0ZVsgMyBdID0gMDsgCQl0ZVsgNyBdID0gMDsJCXRlWyAxMSBdID0gMDsJCXRlWyAxNSBdID0gMTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIG1hdHJpeCB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgbWF0cml4IGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIG1hdHJpeCApIHsKCgkJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQkJY29uc3QgbWUgPSBtYXRyaXguZWxlbWVudHM7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCgkJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBlbGVtZW50cyBvZiB0aGUgbWF0cml4IGZyb20gdGhlIGdpdmVuIGFycmF5LgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBhcnJheSAtIFRoZSBtYXRyaXggZWxlbWVudHMgaW4gY29sdW1uLW1ham9yIG9yZGVyLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge01hdHJpeDR9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbWF0cml4LgoJCSAqLwoJCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCAxNjsgaSArKyApIHsKCgkJCQl0aGlzLmVsZW1lbnRzWyBpIF0gPSBhcnJheVsgaSArIG9mZnNldCBdOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV3JpdGVzIHRoZSBlbGVtZW50cyBvZiB0aGlzIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXJyYXkuIElmIG5vIGFycmF5IGlzIHByb3ZpZGVkLAoJCSAqIHRoZSBtZXRob2QgcmV0dXJucyBhIG5ldyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gW2FycmF5PVtdXSAtIFRoZSB0YXJnZXQgYXJyYXkgaG9sZGluZyB0aGUgbWF0cml4IGVsZW1lbnRzIGluIGNvbHVtbi1tYWpvciBvcmRlci4KCQkgKiBAcGFyYW0ge251bWJlcn0gW29mZnNldD0wXSAtIEluZGV4IG9mIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBhcnJheS4KCQkgKiBAcmV0dXJuIHtBcnJheTxudW1iZXI+fSBUaGUgbWF0cml4IGVsZW1lbnRzIGluIGNvbHVtbi1tYWpvciBvcmRlci4KCQkgKi8KCQl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQkJYXJyYXlbIG9mZnNldCBdID0gdGVbIDAgXTsKCQkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRlWyAxIF07CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGVbIDMgXTsKCgkJCWFycmF5WyBvZmZzZXQgKyA0IF0gPSB0ZVsgNCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKCQkJYXJyYXlbIG9mZnNldCArIDYgXSA9IHRlWyA2IF07CgkJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CgkJCWFycmF5WyBvZmZzZXQgKyA5IF0gPSB0ZVsgOSBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMTAgXSA9IHRlWyAxMCBdOwoJCQlhcnJheVsgb2Zmc2V0ICsgMTEgXSA9IHRlWyAxMSBdOwoKCQkJYXJyYXlbIG9mZnNldCArIDEyIF0gPSB0ZVsgMTIgXTsKCQkJYXJyYXlbIG9mZnNldCArIDEzIF0gPSB0ZVsgMTMgXTsKCQkJYXJyYXlbIG9mZnNldCArIDE0IF0gPSB0ZVsgMTQgXTsKCQkJYXJyYXlbIG9mZnNldCArIDE1IF0gPSB0ZVsgMTUgXTsKCgkJCXJldHVybiBhcnJheTsKCgkJfQoKCX0KCgljb25zdCBfdjEkNSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9tMSQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoJY29uc3QgX3plcm8gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAwLCAwICk7Cgljb25zdCBfb25lID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwoJY29uc3QgX3ggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfeSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF96ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCWNvbnN0IF9tYXRyaXgkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IF9xdWF0ZXJuaW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgoJLyoqCgkgKiBBIGNsYXNzIHJlcHJlc2VudGluZyBFdWxlciBhbmdsZXMuCgkgKgoJICogRXVsZXIgYW5nbGVzIGRlc2NyaWJlIGEgcm90YXRpb25hbCB0cmFuc2Zvcm1hdGlvbiBieSByb3RhdGluZyBhbiBvYmplY3Qgb24KCSAqIGl0cyB2YXJpb3VzIGF4ZXMgaW4gc3BlY2lmaWVkIGFtb3VudHMgcGVyIGF4aXMsIGFuZCBhIHNwZWNpZmllZCBheGlzCgkgKiBvcmRlci4KCSAqCgkgKiBJdGVyYXRpbmcgdGhyb3VnaCBhbiBpbnN0YW5jZSB3aWxsIHlpZWxkIGl0cyBjb21wb25lbnRzICh4LCB5LCB6LAoJICogb3JkZXIpIGluIHRoZSBjb3JyZXNwb25kaW5nIG9yZGVyLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBhID0gbmV3IFRIUkVFLkV1bGVyKCAwLCAxLCAxLjU3LCAnWFlaJyApOwoJICogY29uc3QgYiA9IG5ldyBUSFJFRS5WZWN0b3IzKCAxLCAwLCAxICk7CgkgKiBiLmFwcGx5RXVsZXIoYSk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgRXVsZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGV1bGVyIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt4PTBdIC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3k9MF0gLSBUaGUgYW5nbGUgb2YgdGhlIHkgYXhpcyBpbiByYWRpYW5zLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbej0wXSAtIFRoZSBhbmdsZSBvZiB0aGUgeiBheGlzIGluIHJhZGlhbnMuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcj1FdWxlci5ERUZBVUxUX09SREVSXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB4ID0gMCwgeSA9IDAsIHogPSAwLCBvcmRlciA9IEV1bGVyLkRFRkFVTFRfT1JERVIgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0V1bGVyID0gdHJ1ZTsKCgkJCXRoaXMuX3ggPSB4OwoJCQl0aGlzLl95ID0geTsKCQkJdGhpcy5feiA9IHo7CgkJCXRoaXMuX29yZGVyID0gb3JkZXI7CgoJCX0KCgkJLyoqCgkJICogVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB4KCkgewoKCQkJcmV0dXJuIHRoaXMuX3g7CgoJCX0KCgkJc2V0IHgoIHZhbHVlICkgewoKCQkJdGhpcy5feCA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogVGhlIGFuZ2xlIG9mIHRoZSB5IGF4aXMgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB5KCkgewoKCQkJcmV0dXJuIHRoaXMuX3k7CgoJCX0KCgkJc2V0IHkoIHZhbHVlICkgewoKCQkJdGhpcy5feSA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogVGhlIGFuZ2xlIG9mIHRoZSB6IGF4aXMgaW4gcmFkaWFucy4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCB6KCkgewoKCQkJcmV0dXJuIHRoaXMuX3o7CgoJCX0KCgkJc2V0IHooIHZhbHVlICkgewoKCQkJdGhpcy5feiA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCgkJICoKCQkgKiBAdHlwZSB7c3RyaW5nfQoJCSAqIEBkZWZhdWx0ICdYWVonCgkJICovCgkJZ2V0IG9yZGVyKCkgewoKCQkJcmV0dXJuIHRoaXMuX29yZGVyOwoKCQl9CgoJCXNldCBvcmRlciggdmFsdWUgKSB7CgoJCQl0aGlzLl9vcmRlciA9IHZhbHVlOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgRXVsZXIgY29tcG9uZW50cy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGFuZ2xlIG9mIHRoZSB4IGF4aXMgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBhbmdsZSBvZiB0aGUgeSBheGlzIGluIHJhZGlhbnMuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgYW5nbGUgb2YgdGhlIHogYXhpcyBpbiByYWRpYW5zLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbb3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBvcmRlciB0aGF0IHRoZSByb3RhdGlvbnMgYXJlIGFwcGxpZWQuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJc2V0KCB4LCB5LCB6LCBvcmRlciA9IHRoaXMuX29yZGVyICkgewoKCQkJdGhpcy5feCA9IHg7CgkJCXRoaXMuX3kgPSB5OwoJCQl0aGlzLl96ID0gejsKCQkJdGhpcy5fb3JkZXIgPSBvcmRlcjsKCgkJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgRXVsZXIgaW5zdGFuY2Ugd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX29yZGVyICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIEV1bGVyIGluc3RhbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBpbnN0YW5jZSB0byBjb3B5LgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgoJCSAqLwoJCWNvcHkoIGV1bGVyICkgewoKCQkJdGhpcy5feCA9IGV1bGVyLl94OwoJCQl0aGlzLl95ID0gZXVsZXIuX3k7CgkJCXRoaXMuX3ogPSBldWxlci5fejsKCQkJdGhpcy5fb3JkZXIgPSBldWxlci5fb3JkZXI7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIGEgcHVyZSByb3RhdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBBIDR4NCBtYXRyaXggb2Ygd2hpY2ggdGhlIHVwcGVyIDN4MyBvZiBtYXRyaXggaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLiB1bnNjYWxlZCkuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGU9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBpbnRlcm5hbCBgb25DaGFuZ2VgIGNhbGxiYWNrIHNob3VsZCBiZSBleGVjdXRlZCBvciBub3QuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtLCBvcmRlciA9IHRoaXMuX29yZGVyLCB1cGRhdGUgPSB0cnVlICkgewoKCQkJY29uc3QgdGUgPSBtLmVsZW1lbnRzOwoJCQljb25zdCBtMTEgPSB0ZVsgMCBdLCBtMTIgPSB0ZVsgNCBdLCBtMTMgPSB0ZVsgOCBdOwoJCQljb25zdCBtMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdOwoJCQljb25zdCBtMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXTsKCgkJCXN3aXRjaCAoIG9yZGVyICkgewoKCQkJCWNhc2UgJ1hZWic6CgoJCQkJCXRoaXMuX3kgPSBNYXRoLmFzaW4oIGNsYW1wKCBtMTMsIC0xLCAxICkgKTsKCgkJCQkJaWYgKCBNYXRoLmFicyggbTEzICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0xMSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIG0zMiwgbTIyICk7CgkJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1lYWic6CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0yMywgLTEsIDEgKSApOwoKCQkJCQlpZiAoIE1hdGguYWJzKCBtMjMgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMjIgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCAtIG0zMSwgbTExICk7CgkJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1pYWSc6CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmFzaW4oIGNsYW1wKCBtMzIsIC0xLCAxICkgKTsKCgkJCQkJaWYgKCBNYXRoLmFicyggbTMyICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5feSA9IDA7CgkJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1pZWCc6CgoJCQkJCXRoaXMuX3kgPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0zMSwgLTEsIDEgKSApOwoKCQkJCQlpZiAoIE1hdGguYWJzKCBtMzEgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0zMyApOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMTEgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3ggPSAwOwoJCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1laWCc6CgoJCQkJCXRoaXMuX3ogPSBNYXRoLmFzaW4oIGNsYW1wKCBtMjEsIC0xLCAxICkgKTsKCgkJCQkJaWYgKCBNYXRoLmFicyggbTIxICkgPCAwLjk5OTk5OTkgKSB7CgoJCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0yMiApOwoJCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5feCA9IDA7CgkJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1haWSc6CgoJCQkJCXRoaXMuX3ogPSBNYXRoLmFzaW4oIC0gY2xhbXAoIG0xMiwgLTEsIDEgKSApOwoKCQkJCQlpZiAoIE1hdGguYWJzKCBtMTIgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0yMiApOwoJCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMTEgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCAtIG0yMywgbTMzICk7CgkJCQkJCXRoaXMuX3kgPSAwOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkV1bGVyOiAuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCkgZW5jb3VudGVyZWQgYW4gdW5rbm93biBvcmRlcjogJyArIG9yZGVyICk7CgoJCQl9CgoJCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKCQkJaWYgKCB1cGRhdGUgPT09IHRydWUgKSB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBhbmdsZXMgb2YgdGhpcyBFdWxlciBpbnN0YW5jZSBmcm9tIGEgbm9ybWFsaXplZCBxdWF0ZXJuaW9uLgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gQSBub3JtYWxpemVkIFF1YXRlcm5pb24uCgkJICogQHBhcmFtIHtzdHJpbmd9IFtvcmRlcl0gLSBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIG9yZGVyIHRoYXQgdGhlIHJvdGF0aW9ucyBhcmUgYXBwbGllZC4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFt1cGRhdGU9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBpbnRlcm5hbCBgb25DaGFuZ2VgIGNhbGxiYWNrIHNob3VsZCBiZSBleGVjdXRlZCBvciBub3QuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJc2V0RnJvbVF1YXRlcm5pb24oIHEsIG9yZGVyLCB1cGRhdGUgKSB7CgoJCQlfbWF0cml4JDIubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKTsKCgkJCXJldHVybiB0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX21hdHJpeCQyLCBvcmRlciwgdXBkYXRlICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgYW5nbGVzIG9mIHRoaXMgRXVsZXIgaW5zdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3Rvci4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW29yZGVyXSAtIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgoJCSAqLwoJCXNldEZyb21WZWN0b3IzKCB2LCBvcmRlciA9IHRoaXMuX29yZGVyICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0KCB2LngsIHYueSwgdi56LCBvcmRlciApOwoKCQl9CgoJCS8qKgoJCSAqIFJlc2V0cyB0aGUgZXVsZXIgYW5nbGUgd2l0aCBhIG5ldyBvcmRlciBieSBjcmVhdGluZyBhIHF1YXRlcm5pb24gZnJvbSB0aGlzCgkJICogZXVsZXIgYW5nbGUgYW5kIHRoZW4gc2V0dGluZyB0aGlzIGV1bGVyIGFuZ2xlIHdpdGggdGhlIHF1YXRlcm5pb24gYW5kIHRoZQoJCSAqIG5ldyBvcmRlci4KCQkgKgoJCSAqIFdhcm5pbmc6IFRoaXMgZGlzY2FyZHMgcmV2b2x1dGlvbiBpbmZvcm1hdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbbmV3T3JkZXJdIC0gQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBuZXcgb3JkZXIgdGhhdCB0aGUgcm90YXRpb25zIGFyZSBhcHBsaWVkLgoJCSAqIEByZXR1cm4ge0V1bGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIEV1bGVyIGluc3RhbmNlLgoJCSAqLwoJCXJlb3JkZXIoIG5ld09yZGVyICkgewoKCQkJX3F1YXRlcm5pb24kMy5zZXRGcm9tRXVsZXIoIHRoaXMgKTsKCgkJCXJldHVybiB0aGlzLnNldEZyb21RdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQzLCBuZXdPcmRlciApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgRXVsZXIgaW5zdGFuY2UgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtFdWxlcn0gZXVsZXIgLSBUaGUgRXVsZXIgaW5zdGFuY2UgdG8gdGVzdCBmb3IgZXF1YWxpdHkuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGlzIEV1bGVyIGluc3RhbmNlIGlzIGVxdWFsIHdpdGggdGhlIGdpdmVuIG9uZS4KCQkgKi8KCQllcXVhbHMoIGV1bGVyICkgewoKCQkJcmV0dXJuICggZXVsZXIuX3ggPT09IHRoaXMuX3ggKSAmJiAoIGV1bGVyLl95ID09PSB0aGlzLl95ICkgJiYgKCBldWxlci5feiA9PT0gdGhpcy5feiApICYmICggZXVsZXIuX29yZGVyID09PSB0aGlzLl9vcmRlciApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBFdWxlciBpbnN0YW5jZSdzIGNvbXBvbmVudHMgdG8gdmFsdWVzIGZyb20gdGhlIGdpdmVuIGFycmF5LiBUaGUgZmlyc3QgdGhyZWUKCQkgKiBlbnRyaWVzIG9mIHRoZSBhcnJheSBhcmUgYXNzaWduIHRvIHRoZSB4LHkgYW5kIHogY29tcG9uZW50cy4gQW4gb3B0aW9uYWwgZm91cnRoIGVudHJ5CgkJICogZGVmaW5lcyB0aGUgRXVsZXIgb3JkZXIuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcixudW1iZXIsbnVtYmVyLD9zdHJpbmc+fSBhcnJheSAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIEV1bGVyIGNvbXBvbmVudCB2YWx1ZXMuCgkJICogQHJldHVybiB7RXVsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgRXVsZXIgaW5zdGFuY2UuCgkJICovCgkJZnJvbUFycmF5KCBhcnJheSApIHsKCgkJCXRoaXMuX3ggPSBhcnJheVsgMCBdOwoJCQl0aGlzLl95ID0gYXJyYXlbIDEgXTsKCQkJdGhpcy5feiA9IGFycmF5WyAyIF07CgkJCWlmICggYXJyYXlbIDMgXSAhPT0gdW5kZWZpbmVkICkgdGhpcy5fb3JkZXIgPSBhcnJheVsgMyBdOwoKCQkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV3JpdGVzIHRoZSBjb21wb25lbnRzIG9mIHRoaXMgRXVsZXIgaW5zdGFuY2UgdG8gdGhlIGdpdmVuIGFycmF5LiBJZiBubyBhcnJheSBpcyBwcm92aWRlZCwKCQkgKiB0aGUgbWV0aG9kIHJldHVybnMgYSBuZXcgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcixudW1iZXIsbnVtYmVyLHN0cmluZz59IFthcnJheT1bXV0gLSBUaGUgdGFyZ2V0IGFycmF5IGhvbGRpbmcgdGhlIEV1bGVyIGNvbXBvbmVudHMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBJbmRleCBvZiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgYXJyYXkuCgkJICogQHJldHVybiB7QXJyYXk8bnVtYmVyLG51bWJlcixudW1iZXIsc3RyaW5nPn0gVGhlIEV1bGVyIGNvbXBvbmVudHMuCgkJICovCgkJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMuX3g7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLl95OwoJCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy5fejsKCQkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRoaXMuX29yZGVyOwoKCQkJcmV0dXJuIGFycmF5OwoKCQl9CgoJCV9vbkNoYW5nZSggY2FsbGJhY2sgKSB7CgoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgoJCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQkJeWllbGQgdGhpcy5feDsKCQkJeWllbGQgdGhpcy5feTsKCQkJeWllbGQgdGhpcy5fejsKCQkJeWllbGQgdGhpcy5fb3JkZXI7CgoJCX0KCgl9CgoJLyoqCgkgKiBUaGUgZGVmYXVsdCBFdWxlciBhbmdsZSBvcmRlci4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7c3RyaW5nfQoJICogQGRlZmF1bHQgJ1hZWicKCSAqLwoJRXVsZXIuREVGQVVMVF9PUkRFUiA9ICdYWVonOwoKCS8qKgoJICogQSBsYXllcnMgb2JqZWN0IGFzc2lnbnMgYW4gM0Qgb2JqZWN0IHRvIDEgb3IgbW9yZSBvZiAzMgoJICogbGF5ZXJzIG51bWJlcmVkIGAwYCB0byBgMzFgIC0gaW50ZXJuYWxseSB0aGUgbGF5ZXJzIGFyZSBzdG9yZWQgYXMgYQoJICogYml0IG1hc2tdLCBhbmQgYnkgZGVmYXVsdCBhbGwgM0Qgb2JqZWN0cyBhcmUgYSBtZW1iZXIgb2YgbGF5ZXIgYDBgLgoJICoKCSAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gY29udHJvbCB2aXNpYmlsaXR5IC0gYW4gb2JqZWN0IG11c3Qgc2hhcmUgYSBsYXllciB3aXRoCgkgKiBhIGNhbWVyYSB0byBiZSB2aXNpYmxlIHdoZW4gdGhhdCBjYW1lcmEncyB2aWV3IGlzCgkgKiByZW5kZXJlZC4KCSAqCgkgKiBBbGwgY2xhc3NlcyB0aGF0IGluaGVyaXQgZnJvbSB7QGxpbmsgT2JqZWN0M0R9IGhhdmUgYW4gYGxheWVyc2AgcHJvcGVydHkgd2hpY2gKCSAqIGlzIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MuCgkgKi8KCWNsYXNzIExheWVycyB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgbGF5ZXJzIGluc3RhbmNlLCB3aXRoIG1lbWJlcnNoaXAKCQkgKiBpbml0aWFsbHkgc2V0IHRvIGxheWVyIGAwYC4KCQkgKi8KCQljb25zdHJ1Y3RvcigpIHsKCgkJCS8qKgoJCQkgKiBBIGJpdCBtYXNrIHN0b3Jpbmcgd2hpY2ggb2YgdGhlIDMyIGxheWVycyB0aGlzIGxheWVycyBvYmplY3QgaXMgY3VycmVudGx5CgkJCSAqIGEgbWVtYmVyIG9mLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy5tYXNrID0gMSB8IDA7CgoJCX0KCgkJLyoqCgkJICogU2V0cyBtZW1iZXJzaGlwIHRvIHRoZSBnaXZlbiBsYXllciwgYW5kIHJlbW92ZSBtZW1iZXJzaGlwIGFsbCBvdGhlciBsYXllcnMuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gbGF5ZXIgLSBUaGUgbGF5ZXIgdG8gc2V0LgoJCSAqLwoJCXNldCggbGF5ZXIgKSB7CgoJCQl0aGlzLm1hc2sgPSAoIDEgPDwgbGF5ZXIgfCAwICkgPj4+IDA7CgoJCX0KCgkJLyoqCgkJICogQWRkcyBtZW1iZXJzaGlwIG9mIHRoZSBnaXZlbiBsYXllci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byBlbmFibGUuCgkJICovCgkJZW5hYmxlKCBsYXllciApIHsKCgkJCXRoaXMubWFzayB8PSAxIDw8IGxheWVyIHwgMDsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIG1lbWJlcnNoaXAgdG8gYWxsIGxheWVycy4KCQkgKi8KCQllbmFibGVBbGwoKSB7CgoJCQl0aGlzLm1hc2sgPSAweGZmZmZmZmZmIHwgMDsKCgkJfQoKCQkvKioKCQkgKiBUb2dnbGVzIHRoZSBtZW1iZXJzaGlwIG9mIHRoZSBnaXZlbiBsYXllci4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsYXllciAtIFRoZSBsYXllciB0byB0b2dnbGUuCgkJICovCgkJdG9nZ2xlKCBsYXllciApIHsKCgkJCXRoaXMubWFzayBePSAxIDw8IGxheWVyIHwgMDsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIG1lbWJlcnNoaXAgb2YgdGhlIGdpdmVuIGxheWVyLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIGVuYWJsZS4KCQkgKi8KCQlkaXNhYmxlKCBsYXllciApIHsKCgkJCXRoaXMubWFzayAmPSB+ICggMSA8PCBsYXllciB8IDAgKTsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBtZW1iZXJzaGlwIGZyb20gYWxsIGxheWVycy4KCQkgKi8KCQlkaXNhYmxlQWxsKCkgewoKCQkJdGhpcy5tYXNrID0gMDsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGlzIGFuZCB0aGUgZ2l2ZW4gbGF5ZXJzIG9iamVjdCBoYXZlIGF0IGxlYXN0IG9uZQoJCSAqIGxheWVyIGluIGNvbW1vbi4KCQkgKgoJCSAqIEBwYXJhbSB7TGF5ZXJzfSBsYXllcnMgLSBUaGUgbGF5ZXJzIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbiB9IFdoZXRoZXIgdGhpcyBhbmQgdGhlIGdpdmVuIGxheWVycyBvYmplY3QgaGF2ZSBhdCBsZWFzdCBvbmUgbGF5ZXIgaW4gY29tbW9uIG9yIG5vdC4KCQkgKi8KCQl0ZXN0KCBsYXllcnMgKSB7CgoJCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiBsYXllcnMubWFzayApICE9PSAwOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBsYXllciBpcyBlbmFibGVkLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGxheWVyIC0gVGhlIGxheWVyIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbiB9IFdoZXRoZXIgdGhlIGdpdmVuIGxheWVyIGlzIGVuYWJsZWQgb3Igbm90LgoJCSAqLwoJCWlzRW5hYmxlZCggbGF5ZXIgKSB7CgoJCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiAoIDEgPDwgbGF5ZXIgfCAwICkgKSAhPT0gMDsKCgkJfQoKCX0KCglsZXQgX29iamVjdDNESWQgPSAwOwoKCWNvbnN0IF92MSQ0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ExID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwoJY29uc3QgX20xJDEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IF90YXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX3Bvc2l0aW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfc2NhbGUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9xdWF0ZXJuaW9uJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgoJY29uc3QgX3hBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMCwgMCApOwoJY29uc3QgX3lBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwoJY29uc3QgX3pBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMCwgMSApOwoKCS8qKgoJICogRmlyZXMgd2hlbiB0aGUgb2JqZWN0IGhhcyBiZWVuIGFkZGVkIHRvIGl0cyBwYXJlbnQgb2JqZWN0LgoJICoKCSAqIEBldmVudCBPYmplY3QzRCNhZGRlZAoJICogQHR5cGUge09iamVjdH0KCSAqLwoJY29uc3QgX2FkZGVkRXZlbnQgPSB7IHR5cGU6ICdhZGRlZCcgfTsKCgkvKioKCSAqIEZpcmVzIHdoZW4gdGhlIG9iamVjdCBoYXMgYmVlbiByZW1vdmVkIGZyb20gaXRzIHBhcmVudCBvYmplY3QuCgkgKgoJICogQGV2ZW50IE9iamVjdDNEI3JlbW92ZWQKCSAqIEB0eXBlIHtPYmplY3R9CgkgKi8KCWNvbnN0IF9yZW1vdmVkRXZlbnQgPSB7IHR5cGU6ICdyZW1vdmVkJyB9OwoKCS8qKgoJICogRmlyZXMgd2hlbiBhIG5ldyBjaGlsZCBvYmplY3QgaGFzIGJlZW4gYWRkZWQuCgkgKgoJICogQGV2ZW50IE9iamVjdDNEI2NoaWxkYWRkZWQKCSAqIEB0eXBlIHtPYmplY3R9CgkgKi8KCWNvbnN0IF9jaGlsZGFkZGVkRXZlbnQgPSB7IHR5cGU6ICdjaGlsZGFkZGVkJywgY2hpbGQ6IG51bGwgfTsKCgkvKioKCSAqIEZpcmVzIHdoZW4gYSBjaGlsZCBvYmplY3QgaGFzIGJlZW4gcmVtb3ZlZC4KCSAqCgkgKiBAZXZlbnQgT2JqZWN0M0QjY2hpbGRyZW1vdmVkCgkgKiBAdHlwZSB7T2JqZWN0fQoJICovCgljb25zdCBfY2hpbGRyZW1vdmVkRXZlbnQgPSB7IHR5cGU6ICdjaGlsZHJlbW92ZWQnLCBjaGlsZDogbnVsbCB9OwoKCS8qKgoJICogVGhpcyBpcyB0aGUgYmFzZSBjbGFzcyBmb3IgbW9zdCBvYmplY3RzIGluIHRocmVlLmpzIGFuZCBwcm92aWRlcyBhIHNldCBvZgoJICogcHJvcGVydGllcyBhbmQgbWV0aG9kcyBmb3IgbWFuaXB1bGF0aW5nIG9iamVjdHMgaW4gM0Qgc3BhY2UuCgkgKgoJICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgoJICovCgljbGFzcyBPYmplY3QzRCBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgM0Qgb2JqZWN0LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzT2JqZWN0M0QgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoZSBJRCBvZiB0aGUgM0Qgb2JqZWN0LgoJCQkgKgoJCQkgKiBAbmFtZSBPYmplY3QzRCNpZAoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAcmVhZG9ubHkKCQkJICovCgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX29iamVjdDNESWQgKysgfSApOwoKCQkJLyoqCgkJCSAqIFRoZSBVVUlEIG9mIHRoZSAzRCBvYmplY3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqIEByZWFkb25seQoJCQkgKi8KCQkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCQkvKioKCQkJICogVGhlIG5hbWUgb2YgdGhlIDNEIG9iamVjdC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMubmFtZSA9ICcnOwoKCQkJLyoqCgkJCSAqIFRoZSB0eXBlIHByb3BlcnR5IGlzIHVzZWQgZm9yIGRldGVjdGluZyB0aGUgb2JqZWN0IHR5cGUKCQkJICogaW4gY29udGV4dCBvZiBzZXJpYWxpemF0aW9uL2Rlc2VyaWFsaXphdGlvbi4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnR5cGUgPSAnT2JqZWN0M0QnOwoKCQkJLyoqCgkJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgb2JqZWN0LgoJCQkgKgoJCQkgKiBAdHlwZSB7P09iamVjdDNEfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLnBhcmVudCA9IG51bGw7CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB0aGUgY2hpbGQgM0Qgb2JqZWN0cyBvZiB0aGlzIGluc3RhbmNlLgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0M0Q+fQoJCQkgKi8KCQkJdGhpcy5jaGlsZHJlbiA9IFtdOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGB1cGAgZGlyZWN0aW9uIG9mIHRoZSAzRCBvYmplY3Qgd2hpY2ggaW5mbHVlbmNlcwoJCQkgKiB0aGUgb3JpZW50YXRpb24gdmlhIG1ldGhvZHMgbGlrZSB7QGxpbmsgT2JqZWN0M0QjbG9va0F0fS4KCQkJICoKCQkJICogVGhlIGRlZmF1bHQgdmFsdWVzIGZvciBhbGwgM0Qgb2JqZWN0cyBpcyBkZWZpbmVkIGJ5IGBPYmplY3QzRC5ERUZBVUxUX1VQYC4KCQkJICoKCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCSAqLwoJCQl0aGlzLnVwID0gT2JqZWN0M0QuREVGQVVMVF9VUC5jbG9uZSgpOwoKCQkJY29uc3QgcG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCByb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoJCQljb25zdCBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJY29uc3Qgc2NhbGUgPSBuZXcgVmVjdG9yMyggMSwgMSwgMSApOwoKCQkJZnVuY3Rpb24gb25Sb3RhdGlvbkNoYW5nZSgpIHsKCgkJCQlxdWF0ZXJuaW9uLnNldEZyb21FdWxlciggcm90YXRpb24sIGZhbHNlICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvblF1YXRlcm5pb25DaGFuZ2UoKSB7CgoJCQkJcm90YXRpb24uc2V0RnJvbVF1YXRlcm5pb24oIHF1YXRlcm5pb24sIHVuZGVmaW5lZCwgZmFsc2UgKTsKCgkJCX0KCgkJCXJvdGF0aW9uLl9vbkNoYW5nZSggb25Sb3RhdGlvbkNoYW5nZSApOwoJCQlxdWF0ZXJuaW9uLl9vbkNoYW5nZSggb25RdWF0ZXJuaW9uQ2hhbmdlICk7CgoJCQlPYmplY3QuZGVmaW5lUHJvcGVydGllcyggdGhpcywgewoJCQkJLyoqCgkJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBsb2NhbCBwb3NpdGlvbi4KCQkJCSAqCgkJCQkgKiBAbmFtZSBPYmplY3QzRCNwb3NpdGlvbgoJCQkJICogQHR5cGUge1ZlY3RvcjN9CgkJCQkgKiBAZGVmYXVsdCAoMCwwLDApCgkJCQkgKi8KCQkJCXBvc2l0aW9uOiB7CgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQkJdmFsdWU6IHBvc2l0aW9uCgkJCQl9LAoJCQkJLyoqCgkJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBsb2NhbCByb3RhdGlvbiBhcyBFdWxlciBhbmdsZXMsIGluIHJhZGlhbnMuCgkJCQkgKgoJCQkJICogQG5hbWUgT2JqZWN0M0Qjcm90YXRpb24KCQkJCSAqIEB0eXBlIHtFdWxlcn0KCQkJCSAqIEBkZWZhdWx0ICgwLDAsMCkKCQkJCSAqLwoJCQkJcm90YXRpb246IHsKCQkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCQl2YWx1ZTogcm90YXRpb24KCQkJCX0sCgkJCQkvKioKCQkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHJvdGF0aW9uIGFzIFF1YXRlcm5pb25zLgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI3F1YXRlcm5pb24KCQkJCSAqIEB0eXBlIHtRdWF0ZXJuaW9ufQoJCQkJICovCgkJCQlxdWF0ZXJuaW9uOiB7CgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQkJdmFsdWU6IHF1YXRlcm5pb24KCQkJCX0sCgkJCQkvKioKCQkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIGxvY2FsIHNjYWxlLgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI3NjYWxlCgkJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJCSAqIEBkZWZhdWx0ICgxLDEsMSkKCQkJCSAqLwoJCQkJc2NhbGU6IHsKCQkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCQl2YWx1ZTogc2NhbGUKCQkJCX0sCgkJCQkvKioKCQkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIG1vZGVsLXZpZXcgbWF0cml4LgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI21vZGVsVmlld01hdHJpeAoJCQkJICogQHR5cGUge01hdHJpeDR9CgkJCQkgKi8KCQkJCW1vZGVsVmlld01hdHJpeDogewoJCQkJCXZhbHVlOiBuZXcgTWF0cml4NCgpCgkJCQl9LAoJCQkJLyoqCgkJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyBub3JtYWwgbWF0cml4LgoJCQkJICoKCQkJCSAqIEBuYW1lIE9iamVjdDNEI25vcm1hbE1hdHJpeAoJCQkJICogQHR5cGUge01hdHJpeDN9CgkJCQkgKi8KCQkJCW5vcm1hbE1hdHJpeDogewoJCQkJCXZhbHVlOiBuZXcgTWF0cml4MygpCgkJCQl9CgkJCX0gKTsKCgkJCS8qKgoJCQkgKiBSZXByZXNlbnRzIHRoZSBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gbG9jYWwgc3BhY2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRyaXg0fQoJCQkgKi8KCQkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIG9iamVjdCdzIHRyYW5zZm9ybWF0aW9uIG1hdHJpeCBpbiB3b3JsZCBzcGFjZS4KCQkJICogSWYgdGhlIDNEIG9iamVjdCBoYXMgbm8gcGFyZW50LCB0aGVuIGl0J3MgaWRlbnRpY2FsIHRvIHRoZSBsb2NhbCB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKCQkJICoKCQkJICogQHR5cGUge01hdHJpeDR9CgkJCSAqLwoJCQl0aGlzLm1hdHJpeFdvcmxkID0gbmV3IE1hdHJpeDQoKTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgbG9jYWwgbWF0cml4IGZyb20gcG9zaXRpb24sCgkJCSAqIHJvdGF0aW9uIGFuZCBzY2FsZSBldmVyeSBmcmFtZS4KCQkJICoKCQkJICogVGhlIGRlZmF1bHQgdmFsdWVzIGZvciBhbGwgM0Qgb2JqZWN0cyBpcyBkZWZpbmVkIGJ5IGBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURWAuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgd29ybGQgbWF0cml4IGZyb20gdGhlIGN1cnJlbnQgbG9jYWwKCQkJICogbWF0cml4IGFuZCB0aGUgb2JqZWN0J3MgdHJhbnNmb3JtYXRpb24gaGllcmFyY2h5LgoJCQkgKgoJCQkgKiBUaGUgZGVmYXVsdCB2YWx1ZXMgZm9yIGFsbCAzRCBvYmplY3RzIGlzIGRlZmluZWQgYnkgYE9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFYC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID0gT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfV09STERfQVVUT19VUERBVEU7IC8vIGNoZWNrZWQgYnkgdGhlIHJlbmRlcmVyCgoJCQkvKioKCQkJICogV2hlbiBzZXQgdG8gYHRydWVgLCBpdCBjYWxjdWxhdGVzIHRoZSB3b3JsZCBtYXRyaXggaW4gdGhhdCBmcmFtZSBhbmQgcmVzZXRzIHRoaXMgcHJvcGVydHkKCQkJICogdG8gYGZhbHNlYC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBUaGUgbGF5ZXIgbWVtYmVyc2hpcCBvZiB0aGUgM0Qgb2JqZWN0LiBUaGUgM0Qgb2JqZWN0IGlzIG9ubHkgdmlzaWJsZSBpZiBpdCBoYXMKCQkJICogYXQgbGVhc3Qgb25lIGxheWVyIGluIGNvbW1vbiB3aXRoIHRoZSBjYW1lcmEgaW4gdXNlLiBUaGlzIHByb3BlcnR5IGNhbiBhbHNvIGJlCgkJCSAqIHVzZWQgdG8gZmlsdGVyIG91dCB1bndhbnRlZCBvYmplY3RzIGluIHJheS1pbnRlcnNlY3Rpb24gdGVzdHMgd2hlbiB1c2luZyB7QGxpbmsgUmF5Y2FzdGVyfS4KCQkJICoKCQkJICogQHR5cGUge0xheWVyc30KCQkJICovCgkJCXRoaXMubGF5ZXJzID0gbmV3IExheWVycygpOwoKCQkJLyoqCgkJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBnZXRzIHJlbmRlcmVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy52aXNpYmxlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSAzRCBvYmplY3QgZ2V0cyByZW5kZXJlZCBpbnRvIHNoYWRvdyBtYXBzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuY2FzdFNoYWRvdyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIDNEIG9iamVjdCBpcyBhZmZlY3RlZCBieSBzaGFkb3dzIGluIHRoZSBzY2VuZS4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBXaGVuIHNldCB0byBgdHJ1ZWAsIHRoZSAzRCBvYmplY3QgaXMgaG9ub3JlZCBieSB2aWV3IGZydXN0dW0gY3VsbGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHRydWU7CgoJCQkvKioKCQkJICogVGhpcyB2YWx1ZSBhbGxvd3MgdGhlIGRlZmF1bHQgcmVuZGVyaW5nIG9yZGVyIG9mIHNjZW5lIGdyYXBoIG9iamVjdHMgdG8gYmUKCQkJICogb3ZlcnJpZGRlbiBhbHRob3VnaCBvcGFxdWUgYW5kIHRyYW5zcGFyZW50IG9iamVjdHMgcmVtYWluIHNvcnRlZCBpbmRlcGVuZGVudGx5LgoJCQkgKiBXaGVuIHRoaXMgcHJvcGVydHkgaXMgc2V0IGZvciBhbiBpbnN0YW5jZSBvZiB7QGxpbmsgR3JvdXB9LGFsbCBkZXNjZW5kYW50cwoJCQkgKiBvYmplY3RzIHdpbGwgYmUgc29ydGVkIGFuZCByZW5kZXJlZCB0b2dldGhlci4gU29ydGluZyBpcyBmcm9tIGxvd2VzdCB0byBoaWdoZXN0CgkJCSAqIHJlbmRlciBvcmRlci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5yZW5kZXJPcmRlciA9IDA7CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB0aGUgYW5pbWF0aW9uIGNsaXBzIG9mIHRoZSAzRCBvYmplY3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtBcnJheTxBbmltYXRpb25DbGlwPn0KCQkJICovCgkJCXRoaXMuYW5pbWF0aW9ucyA9IFtdOwoKCQkJLyoqCgkJCSAqIEN1c3RvbSBkZXB0aCBtYXRlcmlhbCB0byBiZSB1c2VkIHdoZW4gcmVuZGVyaW5nIHRvIHRoZSBkZXB0aCBtYXAuIENhbiBvbmx5IGJlIHVzZWQKCQkJICogaW4gY29udGV4dCBvZiBtZXNoZXMuIFdoZW4gc2hhZG93LWNhc3Rpbmcgd2l0aCBhIHtAbGluayBEaXJlY3Rpb25hbExpZ2h0fSBvciB7QGxpbmsgU3BvdExpZ2h0fSwKCQkJICogaWYgeW91IGFyZSBtb2RpZnlpbmcgdmVydGV4IHBvc2l0aW9ucyBpbiB0aGUgdmVydGV4IHNoYWRlciB5b3UgbXVzdCBzcGVjaWZ5IGEgY3VzdG9tIGRlcHRoCgkJCSAqIG1hdGVyaWFsIGZvciBwcm9wZXIgc2hhZG93cy4KCQkJICoKCQkJICogT25seSByZWxldmFudCBpbiBjb250ZXh0IG9mIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KCQkJICoKCQkJICogQHR5cGUgeyhNYXRlcmlhbHx1bmRlZmluZWQpfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMuY3VzdG9tRGVwdGhNYXRlcmlhbCA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBTYW1lIGFzIHtAbGluayBPYmplY3QzRCNjdXN0b21EZXB0aE1hdGVyaWFsfSwgYnV0IHVzZWQgd2l0aCB7QGxpbmsgUG9pbnRMaWdodH0uCgkJCSAqCgkJCSAqIE9ubHkgcmVsZXZhbnQgaW4gY29udGV4dCBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHsoTWF0ZXJpYWx8dW5kZWZpbmVkKX0KCQkJICogQGRlZmF1bHQgdW5kZWZpbmVkCgkJCSAqLwoJCQl0aGlzLmN1c3RvbURpc3RhbmNlTWF0ZXJpYWwgPSB1bmRlZmluZWQ7CgoJCQkvKioKCQkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIDNEIG9iamVjdC4gSXQKCQkJICogc2hvdWxkIG5vdCBob2xkIHJlZmVyZW5jZXMgdG8gZnVuY3Rpb25zIGFzIHRoZXNlIHdpbGwgbm90IGJlIGNsb25lZC4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMudXNlckRhdGEgPSB7fTsKCgkJfQoKCQkvKioKCQkgKiBBIGNhbGxiYWNrIHRoYXQgaXMgZXhlY3V0ZWQgaW1tZWRpYXRlbHkgYmVmb3JlIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkIHRvIGEgc2hhZG93IG1hcC4KCQkgKgoJCSAqIEBwYXJhbSB7UmVuZGVyZXJ8V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0aGF0IGlzIHVzZWQgdG8gcmVuZGVyIHRoZSBzY2VuZS4KCQkgKiBAcGFyYW0ge0NhbWVyYX0gc2hhZG93Q2FtZXJhIC0gVGhlIHNoYWRvdyBjYW1lcmEuCgkJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtNYXRlcmlhbH0gZGVwdGhNYXRlcmlhbCAtIFRoZSBkZXB0aCBtYXRlcmlhbC4KCQkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KCQkgKi8KCQlvbkJlZm9yZVNoYWRvdyggLyogcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCAqLyApIHt9CgoJCS8qKgoJCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBhZnRlciBhIDNEIG9iamVjdCBpcyByZW5kZXJlZCB0byBhIHNoYWRvdyBtYXAuCgkJICoKCQkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCgkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCgkJICogQHBhcmFtIHtDYW1lcmF9IHNoYWRvd0NhbWVyYSAtIFRoZSBzaGFkb3cgY2FtZXJhLgoJCSAqIEBwYXJhbSB7QnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5IC0gVGhlIDNEIG9iamVjdCdzIGdlb21ldHJ5LgoJCSAqIEBwYXJhbSB7TWF0ZXJpYWx9IGRlcHRoTWF0ZXJpYWwgLSBUaGUgZGVwdGggbWF0ZXJpYWwuCgkJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCgkJICovCgkJb25BZnRlclNoYWRvdyggLyogcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCAqLyApIHt9CgoJCS8qKgoJCSAqIEEgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgYSAzRCBvYmplY3QgaXMgcmVuZGVyZWQuCgkJICoKCQkgKiBAcGFyYW0ge1JlbmRlcmVyfFdlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QuCgkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCgkJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtNYXRlcmlhbH0gbWF0ZXJpYWwgLSBUaGUgM0Qgb2JqZWN0J3MgbWF0ZXJpYWwuCgkJICogQHBhcmFtIHtPYmplY3R9IGdyb3VwIC0gVGhlIGdlb21ldHJ5IGdyb3VwIGRhdGEuCgkJICovCgkJb25CZWZvcmVSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCgkJLyoqCgkJICogQSBjYWxsYmFjayB0aGF0IGlzIGV4ZWN1dGVkIGltbWVkaWF0ZWx5IGFmdGVyIGEgM0Qgb2JqZWN0IGlzIHJlbmRlcmVkLgoJCSAqCgkJICogQHBhcmFtIHtSZW5kZXJlcnxXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KCQkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0LgoJCSAqIEBwYXJhbSB7Q2FtZXJhfSBjYW1lcmEgLSBUaGUgY2FtZXJhIHRoYXQgaXMgdXNlZCB0byByZW5kZXIgdGhlIHNjZW5lLgoJCSAqIEBwYXJhbSB7QnVmZmVyR2VvbWV0cnl9IGdlb21ldHJ5IC0gVGhlIDNEIG9iamVjdCdzIGdlb21ldHJ5LgoJCSAqIEBwYXJhbSB7TWF0ZXJpYWx9IG1hdGVyaWFsIC0gVGhlIDNEIG9iamVjdCdzIG1hdGVyaWFsLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBncm91cCAtIFRoZSBnZW9tZXRyeSBncm91cCBkYXRhLgoJCSAqLwoJCW9uQWZ0ZXJSZW5kZXIoIC8qIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICovICkge30KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gdHJhbnNmb3JtYXRpb24gbWF0cml4IHRvIHRoZSBvYmplY3QgYW5kIHVwZGF0ZXMgdGhlIG9iamVjdCdzIHBvc2l0aW9uLAoJCSAqIHJvdGF0aW9uIGFuZCBzY2FsZS4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbWF0cml4IC0gVGhlIHRyYW5zZm9ybWF0aW9uIG1hdHJpeC4KCQkgKi8KCQlhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlICkgdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJCXRoaXMubWF0cml4LnByZW11bHRpcGx5KCBtYXRyaXggKTsKCgkJCXRoaXMubWF0cml4LmRlY29tcG9zZSggdGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCB0aGlzLnNjYWxlICk7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyBhIHJvdGF0aW9uIHJlcHJlc2VudGVkIGJ5IGdpdmVuIHRoZSBxdWF0ZXJuaW9uIHRvIHRoZSAzRCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHEgLSBUaGUgcXVhdGVybmlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlhcHBseVF1YXRlcm5pb24oIHEgKSB7CgoJCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIHEgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIGFuIGF4aXMvYW5nbGUgY291cGxlIHRvIHRoZSAzRCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqLwoJCXNldFJvdGF0aW9uRnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgoJCQkvLyBhc3N1bWVzIGF4aXMgaXMgbm9ybWFsaXplZAoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgZ2l2ZW4gcm90YXRpb24gcmVwcmVzZW50ZWQgYXMgRXVsZXIgYW5nbGVzIHRvIHRoZSAzRCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge0V1bGVyfSBldWxlciAtIFRoZSBFdWxlciBhbmdsZXMuCgkJICovCgkJc2V0Um90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21FdWxlciggZXVsZXIsIHRydWUgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiByb3RhdGlvbiByZXByZXNlbnRlZCBhcyByb3RhdGlvbiBtYXRyaXggdG8gdGhlIDNEIG9iamVjdC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIEFsdGhvdWdoIGEgNHg0IG1hdHJpeCBpcyBleHBlY3RlZCwgdGhlIHVwcGVyIDN4MyBwb3J0aW9uIG11c3QgYmUKCQkgKiBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKS4KCQkgKi8KCQlzZXRSb3RhdGlvbkZyb21NYXRyaXgoIG0gKSB7CgoJCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIHJvdGF0aW9uIHJlcHJlc2VudGVkIGFzIGEgUXVhdGVybmlvbiB0byB0aGUgM0Qgb2JqZWN0LgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24KCQkgKi8KCQlzZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKCQkJLy8gYXNzdW1lcyBxIGlzIG5vcm1hbGl6ZWQKCgkJCXRoaXMucXVhdGVybmlvbi5jb3B5KCBxICk7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFsb25nIGFuIGF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGF4aXMgLSBUaGUgKG5vcm1hbGl6ZWQpIGF4aXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJvdGF0ZU9uQXhpcyggYXhpcywgYW5nbGUgKSB7CgoJCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gb2JqZWN0IHNwYWNlCgkJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCQlfcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCgkJCXRoaXMucXVhdGVybmlvbi5tdWx0aXBseSggX3ExICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYWxvbmcgYW4gYXhpcyBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYXhpcyAtIFRoZSAobm9ybWFsaXplZCkgYXhpcyB2ZWN0b3IuCgkJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJcm90YXRlT25Xb3JsZEF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkJLy8gcm90YXRlIG9iamVjdCBvbiBheGlzIGluIHdvcmxkIHNwYWNlCgkJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgkJCS8vIG1ldGhvZCBhc3N1bWVzIG5vIHJvdGF0ZWQgcGFyZW50CgoJCQlfcTEuc2V0RnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKTsKCgkJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSb3RhdGVzIHRoZSAzRCBvYmplY3QgYXJvdW5kIGl0cyBYIGF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlyb3RhdGVYKCBhbmdsZSApIHsKCgkJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggX3hBeGlzLCBhbmdsZSApOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhlIDNEIG9iamVjdCBhcm91bmQgaXRzIFkgYXhpcyBpbiBsb2NhbCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJvdGF0ZVkoIGFuZ2xlICkgewoKCQkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCBfeUF4aXMsIGFuZ2xlICk7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgM0Qgb2JqZWN0IGFyb3VuZCBpdHMgWiBheGlzIGluIGxvY2FsIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJcm90YXRlWiggYW5nbGUgKSB7CgoJCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIF96QXhpcywgYW5nbGUgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIHRoZSBnaXZlbiBheGlzIGluIGxvY2FsIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBheGlzIC0gVGhlIChub3JtYWxpemVkKSBheGlzIHZlY3Rvci4KCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlT25BeGlzKCBheGlzLCBkaXN0YW5jZSApIHsKCgkJCS8vIHRyYW5zbGF0ZSBvYmplY3QgYnkgZGlzdGFuY2UgYWxvbmcgYXhpcyBpbiBvYmplY3Qgc3BhY2UKCQkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJCV92MSQ0LmNvcHkoIGF4aXMgKS5hcHBseVF1YXRlcm5pb24oIHRoaXMucXVhdGVybmlvbiApOwoKCQkJdGhpcy5wb3NpdGlvbi5hZGQoIF92MSQ0Lm11bHRpcGx5U2NhbGFyKCBkaXN0YW5jZSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBYLWF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlWCggZGlzdGFuY2UgKSB7CgoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF94QXhpcywgZGlzdGFuY2UgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBZLWF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlWSggZGlzdGFuY2UgKSB7CgoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF95QXhpcywgZGlzdGFuY2UgKTsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGUgdGhlIDNEIG9iamVjdCBieSBhIGRpc3RhbmNlIGFsb25nIGl0cyBaLWF4aXMgaW4gbG9jYWwgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgZGlzdGFuY2UgaW4gd29ybGQgdW5pdHMuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlWiggZGlzdGFuY2UgKSB7CgoJCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF96QXhpcywgZGlzdGFuY2UgKTsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gdmVjdG9yIGZyb20gdGhpcyAzRCBvYmplY3QncyBsb2NhbCBzcGFjZSB0byB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0byBjb252ZXJ0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb252ZXJ0ZWQgdmVjdG9yLgoJCSAqLwoJCWxvY2FsVG9Xb3JsZCggdmVjdG9yICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhlIGdpdmVuIHZlY3RvciBmcm9tIHRoaXMgM0Qgb2JqZWN0J3Mgd29yZCBzcGFjZSB0byBsb2NhbCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdmVjdG9yIC0gVGhlIHZlY3RvciB0byBjb252ZXJ0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBjb252ZXJ0ZWQgdmVjdG9yLgoJCSAqLwoJCXdvcmxkVG9Mb2NhbCggdmVjdG9yICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCBfbTEkMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKSApOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhlIG9iamVjdCB0byBmYWNlIGEgcG9pbnQgaW4gd29ybGQgc3BhY2UuCgkJICoKCQkgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IG9iamVjdHMgaGF2aW5nIG5vbi11bmlmb3JtbHktc2NhbGVkIHBhcmVudChzKS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfFZlY3RvcjN9IHggLSBUaGUgeCBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLiBBbHRlcm5hdGl2ZWx5LCBhIHZlY3RvciByZXByZXNlbnRpbmcgYSBwb3NpdGlvbiBpbiB3b3JsZCBzcGFjZQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbeV0gLSBUaGUgeSBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbel0gLSBUaGUgeiBjb29yZGluYXRlIGluIHdvcmxkIHNwYWNlLgoJCSAqLwoJCWxvb2tBdCggeCwgeSwgeiApIHsKCgkJCS8vIFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgb2JqZWN0cyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgcGFyZW50KHMpCgoJCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJCV90YXJnZXQuY29weSggeCApOwoKCQkJfSBlbHNlIHsKCgkJCQlfdGFyZ2V0LnNldCggeCwgeSwgeiApOwoKCQkJfQoKCQkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJX3Bvc2l0aW9uJDMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCQlpZiAoIHRoaXMuaXNDYW1lcmEgfHwgdGhpcy5pc0xpZ2h0ICkgewoKCQkJCV9tMSQxJDEubG9va0F0KCBfcG9zaXRpb24kMywgX3RhcmdldCwgdGhpcy51cCApOwoKCQkJfSBlbHNlIHsKCgkJCQlfbTEkMSQxLmxvb2tBdCggX3RhcmdldCwgX3Bvc2l0aW9uJDMsIHRoaXMudXAgKTsKCgkJCX0KCgkJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxJDEgKTsKCgkJCWlmICggcGFyZW50ICkgewoKCQkJCV9tMSQxJDEuZXh0cmFjdFJvdGF0aW9uKCBwYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCV9xMS5zZXRGcm9tUm90YXRpb25NYXRyaXgoIF9tMSQxJDEgKTsKCQkJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExLmludmVydCgpICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gM0Qgb2JqZWN0IGFzIGEgY2hpbGQgdG8gdGhpcyAzRCBvYmplY3QuIEFuIGFyYml0cmFyeSBudW1iZXIgb2YKCQkgKiBvYmplY3RzIG1heSBiZSBhZGRlZC4gQW55IGN1cnJlbnQgcGFyZW50IG9uIGFuIG9iamVjdCBwYXNzZWQgaW4gaGVyZSB3aWxsIGJlCgkJICogcmVtb3ZlZCwgc2luY2UgYW4gb2JqZWN0IGNhbiBoYXZlIGF0IG1vc3Qgb25lIHBhcmVudC4KCQkgKgoJCSAqIEBmaXJlcyBPYmplY3QzRCNhZGRlZAoJCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZGFkZGVkCgkJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdCB0byBhZGQuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYWRkKCBvYmplY3QgKSB7CgoJCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXRoaXMuYWRkKCBhcmd1bWVudHNbIGkgXSApOwoKCQkJCX0KCgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggb2JqZWN0ID09PSB0aGlzICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBjYW5cJ3QgYmUgYWRkZWQgYXMgYSBjaGlsZCBvZiBpdHNlbGYuJywgb2JqZWN0ICk7CgkJCQlyZXR1cm4gdGhpczsKCgkJCX0KCgkJCWlmICggb2JqZWN0ICYmIG9iamVjdC5pc09iamVjdDNEICkgewoKCQkJCW9iamVjdC5yZW1vdmVGcm9tUGFyZW50KCk7CgkJCQlvYmplY3QucGFyZW50ID0gdGhpczsKCQkJCXRoaXMuY2hpbGRyZW4ucHVzaCggb2JqZWN0ICk7CgoJCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgoJCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG9iamVjdDsKCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkYWRkZWRFdmVudCApOwoJCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG51bGw7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuJywgb2JqZWN0ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgY2hpbGQgZnJvbSB0aGlzIDNEIG9iamVjdC4KCQkgKiBBbiBhcmJpdHJhcnkgbnVtYmVyIG9mIG9iamVjdHMgbWF5IGJlIHJlbW92ZWQuCgkJICoKCQkgKiBAZmlyZXMgT2JqZWN0M0QjcmVtb3ZlZAoJCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZHJlbW92ZWQKCQkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIHJlbW92ZS4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlyZW1vdmUoIG9iamVjdCApIHsKCgkJCWlmICggYXJndW1lbnRzLmxlbmd0aCA+IDEgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJdGhpcy5yZW1vdmUoIGFyZ3VtZW50c1sgaSBdICk7CgoJCQkJfQoKCQkJCXJldHVybiB0aGlzOwoKCQkJfQoKCQkJY29uc3QgaW5kZXggPSB0aGlzLmNoaWxkcmVuLmluZGV4T2YoIG9iamVjdCApOwoKCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgoJCQkJb2JqZWN0LnBhcmVudCA9IG51bGw7CgkJCQl0aGlzLmNoaWxkcmVuLnNwbGljZSggaW5kZXgsIDEgKTsKCgkJCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggX3JlbW92ZWRFdmVudCApOwoKCQkJCV9jaGlsZHJlbW92ZWRFdmVudC5jaGlsZCA9IG9iamVjdDsKCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX2NoaWxkcmVtb3ZlZEV2ZW50ICk7CgkJCQlfY2hpbGRyZW1vdmVkRXZlbnQuY2hpbGQgPSBudWxsOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmVtb3ZlcyB0aGlzIDNEIG9iamVjdCBmcm9tIGl0cyBjdXJyZW50IHBhcmVudC4KCQkgKgoJCSAqIEBmaXJlcyBPYmplY3QzRCNyZW1vdmVkCgkJICogQGZpcmVzIE9iamVjdDNEI2NoaWxkcmVtb3ZlZAoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJlbW92ZUZyb21QYXJlbnQoKSB7CgoJCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCgkJCWlmICggcGFyZW50ICE9PSBudWxsICkgewoKCQkJCXBhcmVudC5yZW1vdmUoIHRoaXMgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJlbW92ZXMgYWxsIGNoaWxkIG9iamVjdHMuCgkJICoKCQkgKiBAZmlyZXMgT2JqZWN0M0QjcmVtb3ZlZAoJCSAqIEBmaXJlcyBPYmplY3QzRCNjaGlsZHJlbW92ZWQKCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbGVhcigpIHsKCgkJCXJldHVybiB0aGlzLnJlbW92ZSggLi4uIHRoaXMuY2hpbGRyZW4gKTsKCgkJfQoKCQkvKioKCQkgKiBBZGRzIHRoZSBnaXZlbiAzRCBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzIDNEIG9iamVjdCwgd2hpbGUgbWFpbnRhaW5pbmcgdGhlIG9iamVjdCdzIHdvcmxkCgkJICogdHJhbnNmb3JtLiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykuCgkJICoKCQkgKiBAZmlyZXMgT2JqZWN0M0QjYWRkZWQKCQkgKiBAZmlyZXMgT2JqZWN0M0QjY2hpbGRhZGRlZAoJCSAqIEBwYXJhbSB7T2JqZWN0M0R9IG9iamVjdCAtIFRoZSAzRCBvYmplY3QgdG8gYXR0YWNoLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWF0dGFjaCggb2JqZWN0ICkgewoKCQkJLy8gYWRkcyBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzLCB3aGlsZSBtYWludGFpbmluZyB0aGUgb2JqZWN0J3Mgd29ybGQgdHJhbnNmb3JtCgoJCQkvLyBOb3RlOiBUaGlzIG1ldGhvZCBkb2VzIG5vdCBzdXBwb3J0IHNjZW5lIGdyYXBocyBoYXZpbmcgbm9uLXVuaWZvcm1seS1zY2FsZWQgbm9kZXMocykKCgkJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCQlfbTEkMSQxLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJCWlmICggb2JqZWN0LnBhcmVudCAhPT0gbnVsbCApIHsKCgkJCQlvYmplY3QucGFyZW50LnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJCV9tMSQxJDEubXVsdGlwbHkoIG9iamVjdC5wYXJlbnQubWF0cml4V29ybGQgKTsKCgkJCX0KCgkJCW9iamVjdC5hcHBseU1hdHJpeDQoIF9tMSQxJDEgKTsKCgkJCW9iamVjdC5yZW1vdmVGcm9tUGFyZW50KCk7CgkJCW9iamVjdC5wYXJlbnQgPSB0aGlzOwoJCQl0aGlzLmNoaWxkcmVuLnB1c2goIG9iamVjdCApOwoKCQkJb2JqZWN0LnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgdHJ1ZSApOwoKCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9hZGRlZEV2ZW50ICk7CgoJCQlfY2hpbGRhZGRlZEV2ZW50LmNoaWxkID0gb2JqZWN0OwoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIF9jaGlsZGFkZGVkRXZlbnQgKTsKCQkJX2NoaWxkYWRkZWRFdmVudC5jaGlsZCA9IG51bGw7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZWFyY2hlcyB0aHJvdWdoIHRoZSAzRCBvYmplY3QgYW5kIGl0cyBjaGlsZHJlbiwgc3RhcnRpbmcgd2l0aCB0aGUgM0Qgb2JqZWN0CgkJICogaXRzZWxmLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgd2l0aCBhIG1hdGNoaW5nIElELgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGlkIC0gVGhlIGlkLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfHVuZGVmaW5lZH0gVGhlIGZvdW5kIDNEIG9iamVjdC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBubyAzRCBvYmplY3QgaGFzIGJlZW4gZm91bmQuCgkJICovCgkJZ2V0T2JqZWN0QnlJZCggaWQgKSB7CgoJCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnaWQnLCBpZCApOwoKCQl9CgoJCS8qKgoJCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKCQkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIHRoZSBmaXJzdCB3aXRoIGEgbWF0Y2hpbmcgbmFtZS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUuCgkJICogQHJldHVybiB7T2JqZWN0M0R8dW5kZWZpbmVkfSBUaGUgZm91bmQgM0Qgb2JqZWN0LiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmIG5vIDNEIG9iamVjdCBoYXMgYmVlbiBmb3VuZC4KCQkgKi8KCQlnZXRPYmplY3RCeU5hbWUoIG5hbWUgKSB7CgoJCQlyZXR1cm4gdGhpcy5nZXRPYmplY3RCeVByb3BlcnR5KCAnbmFtZScsIG5hbWUgKTsKCgkJfQoKCQkvKioKCQkgKiBTZWFyY2hlcyB0aHJvdWdoIHRoZSAzRCBvYmplY3QgYW5kIGl0cyBjaGlsZHJlbiwgc3RhcnRpbmcgd2l0aCB0aGUgM0Qgb2JqZWN0CgkJICogaXRzZWxmLCBhbmQgcmV0dXJucyB0aGUgZmlyc3Qgd2l0aCBhIG1hdGNoaW5nIHByb3BlcnR5IHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcHJvcGVydHkuCgkJICogQHBhcmFtIHthbnl9IHZhbHVlIC0gVGhlIHZhbHVlLgoJCSAqIEByZXR1cm4ge09iamVjdDNEfHVuZGVmaW5lZH0gVGhlIGZvdW5kIDNEIG9iamVjdC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBubyAzRCBvYmplY3QgaGFzIGJlZW4gZm91bmQuCgkJICovCgkJZ2V0T2JqZWN0QnlQcm9wZXJ0eSggbmFtZSwgdmFsdWUgKSB7CgoJCQlpZiAoIHRoaXNbIG5hbWUgXSA9PT0gdmFsdWUgKSByZXR1cm4gdGhpczsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW5bIGkgXTsKCQkJCWNvbnN0IG9iamVjdCA9IGNoaWxkLmdldE9iamVjdEJ5UHJvcGVydHkoIG5hbWUsIHZhbHVlICk7CgoJCQkJaWYgKCBvYmplY3QgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcmV0dXJuIG9iamVjdDsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdW5kZWZpbmVkOwoKCQl9CgoJCS8qKgoJCSAqIFNlYXJjaGVzIHRocm91Z2ggdGhlIDNEIG9iamVjdCBhbmQgaXRzIGNoaWxkcmVuLCBzdGFydGluZyB3aXRoIHRoZSAzRCBvYmplY3QKCQkgKiBpdHNlbGYsIGFuZCByZXR1cm5zIGFsbCAzRCBvYmplY3RzIHdpdGggYSBtYXRjaGluZyBwcm9wZXJ0eSB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb2YgdGhlIHByb3BlcnR5LgoJCSAqIEBwYXJhbSB7YW55fSB2YWx1ZSAtIFRoZSB2YWx1ZS4KCQkgKiBAcGFyYW0ge0FycmF5PE9iamVjdDNEPn0gcmVzdWx0IC0gVGhlIG1ldGhvZCBzdG9yZXMgdGhlIHJlc3VsdCBpbiB0aGlzIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PE9iamVjdDNEPn0gVGhlIGZvdW5kIDNEIG9iamVjdHMuCgkJICovCgkJZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgPSBbXSApIHsKCgkJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJlc3VsdC5wdXNoKCB0aGlzICk7CgoJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNoaWxkcmVuWyBpIF0uZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlLCByZXN1bHQgKTsKCgkJCX0KCgkJCXJldHVybiByZXN1bHQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIHZlY3RvciByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoZSByZXN1bHQgaXMgc3RvcmVkIHRvLgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSAzRCBvYmplY3QncyBwb3NpdGlvbiBpbiB3b3JsZCBzcGFjZS4KCQkgKi8KCQlnZXRXb3JsZFBvc2l0aW9uKCB0YXJnZXQgKSB7CgoJCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJcmV0dXJuIHRhcmdldC5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubWF0cml4V29ybGQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgUXVhdGVybmlvbiByZXByZXNlbnRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSAzRCBvYmplY3QgaW4gd29ybGQgc3BhY2UuCgkJICoKCQkgKiBAcGFyYW0ge1F1YXRlcm5pb259IHRhcmdldCAtIFRoZSB0YXJnZXQgUXVhdGVybmlvbiB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KCQkgKiBAcmV0dXJuIHtRdWF0ZXJuaW9ufSBUaGUgM0Qgb2JqZWN0J3Mgcm90YXRpb24gaW4gd29ybGQgc3BhY2UuCgkJICovCgkJZ2V0V29ybGRRdWF0ZXJuaW9uKCB0YXJnZXQgKSB7CgoJCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQzLCB0YXJnZXQsIF9zY2FsZSQyICk7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSBzY2FsZSBvZiB0aGUgM0Qgb2JqZWN0IGluIHdvcmxkIHNwYWNlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGUgcmVzdWx0IGlzIHN0b3JlZCB0by4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgM0Qgb2JqZWN0J3Mgc2NhbGUgaW4gd29ybGQgc3BhY2UuCgkJICovCgkJZ2V0V29ybGRTY2FsZSggdGFyZ2V0ICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCXRoaXMubWF0cml4V29ybGQuZGVjb21wb3NlKCBfcG9zaXRpb24kMywgX3F1YXRlcm5pb24kMiwgdGFyZ2V0ICk7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSAoImxvb2siKSBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIGRpcmVjdGlvbiBpbiB3b3JsZCBzcGFjZS4KCQkgKi8KCQlnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJCWNvbnN0IGUgPSB0aGlzLm1hdHJpeFdvcmxkLmVsZW1lbnRzOwoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIGVbIDggXSwgZVsgOSBdLCBlWyAxMCBdICkubm9ybWFsaXplKCk7CgoJCX0KCgkJLyoqCgkJICogQWJzdHJhY3QgbWV0aG9kIHRvIGdldCBpbnRlcnNlY3Rpb25zIGJldHdlZW4gYSBjYXN0ZWQgcmF5IGFuZCB0aGlzCgkJICogM0Qgb2JqZWN0LiBSZW5kZXJhYmxlIDNEIG9iamVjdHMgc3VjaCBhcyB7QGxpbmsgTWVzaH0sIHtAbGluayBMaW5lfSBvciB7QGxpbmsgUG9pbnRzfQoJCSAqIGltcGxlbWVudCB0aGlzIG1ldGhvZCBpbiBvcmRlciB0byB1c2UgcmF5Y2FzdGluZy4KCQkgKgoJCSAqIEBhYnN0cmFjdAoJCSAqIEBwYXJhbSB7UmF5Y2FzdGVyfSByYXljYXN0ZXIgLSBUaGUgcmF5Y2FzdGVyLgoJCSAqIEBwYXJhbSB7QXJyYXk8T2JqZWN0Pn0gaW50ZXJzZWN0cyAtIEFuIGFycmF5IGhvbGRpbmcgdGhlIHJlc3VsdCBvZiB0aGUgbWV0aG9kLgoJCSAqLwoJCXJheWNhc3QoIC8qIHJheWNhc3RlciwgaW50ZXJzZWN0cyAqLyApIHt9CgoJCS8qKgoJCSAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFjayBvbiB0aGlzIDNEIG9iamVjdCBhbmQgYWxsIGRlc2NlbmRhbnRzLgoJCSAqCgkJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgoJCSAqCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgoJCSAqLwoJCXRyYXZlcnNlKCBjYWxsYmFjayApIHsKCgkJCWNhbGxiYWNrKCB0aGlzICk7CgoJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNoaWxkcmVuWyBpIF0udHJhdmVyc2UoIGNhbGxiYWNrICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogTGlrZSB7QGxpbmsgT2JqZWN0M0QjdHJhdmVyc2V9LCBidXQgdGhlIGNhbGxiYWNrIHdpbGwgb25seSBiZSBleGVjdXRlZCBmb3IgdmlzaWJsZSAzRCBvYmplY3RzLgoJCSAqIERlc2NlbmRhbnRzIG9mIGludmlzaWJsZSAzRCBvYmplY3RzIGFyZSBub3QgdHJhdmVyc2VkLgoJCSAqCgkJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgoJCSAqCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgoJCSAqLwoJCXRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKSB7CgoJCQlpZiAoIHRoaXMudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQljYWxsYmFjayggdGhpcyApOwoKCQkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljaGlsZHJlblsgaSBdLnRyYXZlcnNlVmlzaWJsZSggY2FsbGJhY2sgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBMaWtlIHtAbGluayBPYmplY3QzRCN0cmF2ZXJzZX0sIGJ1dCB0aGUgY2FsbGJhY2sgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIGZvciBhbGwgYW5jZXN0b3JzLgoJCSAqCgkJICogTm90ZTogTW9kaWZ5aW5nIHRoZSBzY2VuZSBncmFwaCBpbnNpZGUgdGhlIGNhbGxiYWNrIGlzIGRpc2NvdXJhZ2VkLgoJCSAqCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgLSBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIHRvIHByb2Nlc3MgdGhlIGN1cnJlbnQgM0Qgb2JqZWN0LgoJCSAqLwoJCXRyYXZlcnNlQW5jZXN0b3JzKCBjYWxsYmFjayApIHsKCgkJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQkJaWYgKCBwYXJlbnQgIT09IG51bGwgKSB7CgoJCQkJY2FsbGJhY2soIHBhcmVudCApOwoKCQkJCXBhcmVudC50cmF2ZXJzZUFuY2VzdG9ycyggY2FsbGJhY2sgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4gbG9jYWwgc3BhY2UgYnkgY29tcHV0aW5nIGl0IGZyb20gdGhlIGN1cnJlbnQKCQkgKiBwb3NpdGlvbiwgcm90YXRpb24gYW5kIHNjYWxlIHZhbHVlcy4KCQkgKi8KCQl1cGRhdGVNYXRyaXgoKSB7CgoJCQl0aGlzLm1hdHJpeC5jb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCgkJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJLyoqCgkJICogVXBkYXRlcyB0aGUgdHJhbnNmb3JtYXRpb24gbWF0cml4IGluIHdvcmxkIHNwYWNlIG9mIHRoaXMgM0Qgb2JqZWN0cyBhbmQgaXRzIGRlc2NlbmRhbnRzLgoJCSAqCgkJICogVG8gZW5zdXJlIGNvcnJlY3QgcmVzdWx0cywgdGhpcyBtZXRob2QgYWxzbyByZWNvbXB1dGVzIHRoZSAzRCBvYmplY3QncyB0cmFuc2Zvcm1hdGlvbiBtYXRyaXggaW4KCQkgKiBsb2NhbCBzcGFjZS4gVGhlIGNvbXB1dGF0aW9uIG9mIHRoZSBsb2NhbCBhbmQgd29ybGQgbWF0cml4IGNhbiBiZSBjb250cm9sbGVkIHdpdGggdGhlCgkJICoge0BsaW5rIE9iamVjdDNEI21hdHJpeEF1dG9VcGRhdGV9IGFuZCB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBmbGFncyB3aGljaCBhcmUgYm90aAoJCSAqIGB0cnVlYCBieSBkZWZhdWx0LiAgU2V0IHRoZXNlIGZsYWdzIHRvIGBmYWxzZWAgaWYgeW91IG5lZWQgbW9yZSBjb250cm9sIG92ZXIgdGhlIHVwZGF0ZSBtYXRyaXggcHJvY2Vzcy4KCQkgKgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ZvcmNlPWZhbHNlXSAtIFdoZW4gc2V0IHRvIGB0cnVlYCwgYSByZWNvbXB1dGF0aW9uIG9mIHdvcmxkIG1hdHJpY2VzIGlzIGZvcmNlZCBldmVuCgkJICogd2hlbiB7QGxpbmsgT2JqZWN0M0QjbWF0cml4V29ybGRBdXRvVXBkYXRlfSBpcyBzZXQgdG8gYGZhbHNlYC4KCQkgKi8KCQl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCQlpZiAoIHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSB8fCBmb3JjZSApIHsKCgkJCQlpZiAoIHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQlpZiAoIHRoaXMucGFyZW50ID09PSBudWxsICkgewoKCQkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5tYXRyaXhXb3JsZC5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLnBhcmVudC5tYXRyaXhXb3JsZCwgdGhpcy5tYXRyaXggKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCQlmb3JjZSA9IHRydWU7CgoJCQl9CgoJCQkvLyBtYWtlIHN1cmUgZGVzY2VuZGFudHMgYXJlIHVwZGF0ZWQgaWYgcmVxdWlyZWQKCgkJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKCQkJCWNoaWxkLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIEFuIGFsdGVybmF0aXZlIHZlcnNpb24gb2Yge0BsaW5rIE9iamVjdDNEI3VwZGF0ZU1hdHJpeFdvcmxkfSB3aXRoIG1vcmUgY29udHJvbCBvdmVyIHRoZQoJCSAqIHVwZGF0ZSBvZiBhbmNlc3RvciBhbmQgZGVzY2VuZGFudCBub2Rlcy4KCQkgKgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZVBhcmVudHM9ZmFsc2VdIFdoZXRoZXIgYW5jZXN0b3Igbm9kZXMgc2hvdWxkIGJlIHVwZGF0ZWQgb3Igbm90LgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3VwZGF0ZUNoaWxkcmVuPWZhbHNlXSBXaGV0aGVyIGRlc2NlbmRhbnQgbm9kZXMgc2hvdWxkIGJlIHVwZGF0ZWQgb3Igbm90LgoJCSAqLwoJCXVwZGF0ZVdvcmxkTWF0cml4KCB1cGRhdGVQYXJlbnRzLCB1cGRhdGVDaGlsZHJlbiApIHsKCgkJCWNvbnN0IHBhcmVudCA9IHRoaXMucGFyZW50OwoKCQkJaWYgKCB1cGRhdGVQYXJlbnRzID09PSB0cnVlICYmIHBhcmVudCAhPT0gbnVsbCApIHsKCgkJCQlwYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCQl9CgoJCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCQlpZiAoIHRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJCXRoaXMubWF0cml4V29ybGQuY29weSggdGhpcy5tYXRyaXggKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIG1ha2Ugc3VyZSBkZXNjZW5kYW50cyBhcmUgdXBkYXRlZAoKCQkJaWYgKCB1cGRhdGVDaGlsZHJlbiA9PT0gdHJ1ZSApIHsKCgkJCQljb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY29uc3QgY2hpbGQgPSBjaGlsZHJlblsgaSBdOwoKCQkJCQljaGlsZC51cGRhdGVXb3JsZE1hdHJpeCggZmFsc2UsIHRydWUgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogU2VyaWFsaXplcyB0aGUgM0Qgb2JqZWN0IGludG8gSlNPTi4KCQkgKgoJCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIDNEIG9iamVjdC4KCQkgKiBAc2VlIHtAbGluayBPYmplY3RMb2FkZXIjcGFyc2V9CgkJICovCgkJdG9KU09OKCBtZXRhICkgewoKCQkJLy8gbWV0YSBpcyBhIHN0cmluZyB3aGVuIGNhbGxlZCBmcm9tIEpTT04uc3RyaW5naWZ5CgkJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKCQkJY29uc3Qgb3V0cHV0ID0ge307CgoJCQkvLyBtZXRhIGlzIGEgaGFzaCB1c2VkIHRvIGNvbGxlY3QgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLgoJCQkvLyBub3QgcHJvdmlkaW5nIGl0IGltcGxpZXMgdGhhdCB0aGlzIGlzIHRoZSByb290IG9iamVjdAoJCQkvLyBiZWluZyBzZXJpYWxpemVkLgoJCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCQkvLyBpbml0aWFsaXplIG1ldGEgb2JqCgkJCQltZXRhID0gewoJCQkJCWdlb21ldHJpZXM6IHt9LAoJCQkJCW1hdGVyaWFsczoge30sCgkJCQkJdGV4dHVyZXM6IHt9LAoJCQkJCWltYWdlczoge30sCgkJCQkJc2hhcGVzOiB7fSwKCQkJCQlza2VsZXRvbnM6IHt9LAoJCQkJCWFuaW1hdGlvbnM6IHt9LAoJCQkJCW5vZGVzOiB7fQoJCQkJfTsKCgkJCQlvdXRwdXQubWV0YWRhdGEgPSB7CgkJCQkJdmVyc2lvbjogNC43LAoJCQkJCXR5cGU6ICdPYmplY3QnLAoJCQkJCWdlbmVyYXRvcjogJ09iamVjdDNELnRvSlNPTicKCQkJCX07CgoJCQl9CgoJCQkvLyBzdGFuZGFyZCBPYmplY3QzRCBzZXJpYWxpemF0aW9uCgoJCQljb25zdCBvYmplY3QgPSB7fTsKCgkJCW9iamVjdC51dWlkID0gdGhpcy51dWlkOwoJCQlvYmplY3QudHlwZSA9IHRoaXMudHlwZTsKCgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIG9iamVjdC5uYW1lID0gdGhpcy5uYW1lOwoJCQlpZiAoIHRoaXMuY2FzdFNoYWRvdyA9PT0gdHJ1ZSApIG9iamVjdC5jYXN0U2hhZG93ID0gdHJ1ZTsKCQkJaWYgKCB0aGlzLnJlY2VpdmVTaGFkb3cgPT09IHRydWUgKSBvYmplY3QucmVjZWl2ZVNoYWRvdyA9IHRydWU7CgkJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIG9iamVjdC52aXNpYmxlID0gZmFsc2U7CgkJCWlmICggdGhpcy5mcnVzdHVtQ3VsbGVkID09PSBmYWxzZSApIG9iamVjdC5mcnVzdHVtQ3VsbGVkID0gZmFsc2U7CgkJCWlmICggdGhpcy5yZW5kZXJPcmRlciAhPT0gMCApIG9iamVjdC5yZW5kZXJPcmRlciA9IHRoaXMucmVuZGVyT3JkZXI7CgkJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb2JqZWN0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJCW9iamVjdC5sYXllcnMgPSB0aGlzLmxheWVycy5tYXNrOwoJCQlvYmplY3QubWF0cml4ID0gdGhpcy5tYXRyaXgudG9BcnJheSgpOwoJCQlvYmplY3QudXAgPSB0aGlzLnVwLnRvQXJyYXkoKTsKCgkJCWlmICggdGhpcy5tYXRyaXhBdXRvVXBkYXRlID09PSBmYWxzZSApIG9iamVjdC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCQkvLyBvYmplY3Qgc3BlY2lmaWMgcHJvcGVydGllcwoKCQkJaWYgKCB0aGlzLmlzSW5zdGFuY2VkTWVzaCApIHsKCgkJCQlvYmplY3QudHlwZSA9ICdJbnN0YW5jZWRNZXNoJzsKCQkJCW9iamVjdC5jb3VudCA9IHRoaXMuY291bnQ7CgkJCQlvYmplY3QuaW5zdGFuY2VNYXRyaXggPSB0aGlzLmluc3RhbmNlTWF0cml4LnRvSlNPTigpOwoJCQkJaWYgKCB0aGlzLmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSBvYmplY3QuaW5zdGFuY2VDb2xvciA9IHRoaXMuaW5zdGFuY2VDb2xvci50b0pTT04oKTsKCgkJCX0KCgkJCWlmICggdGhpcy5pc0JhdGNoZWRNZXNoICkgewoKCQkJCW9iamVjdC50eXBlID0gJ0JhdGNoZWRNZXNoJzsKCQkJCW9iamVjdC5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkID0gdGhpcy5wZXJPYmplY3RGcnVzdHVtQ3VsbGVkOwoJCQkJb2JqZWN0LnNvcnRPYmplY3RzID0gdGhpcy5zb3J0T2JqZWN0czsKCgkJCQlvYmplY3QuZHJhd1JhbmdlcyA9IHRoaXMuX2RyYXdSYW5nZXM7CgkJCQlvYmplY3QucmVzZXJ2ZWRSYW5nZXMgPSB0aGlzLl9yZXNlcnZlZFJhbmdlczsKCgkJCQlvYmplY3QuZ2VvbWV0cnlJbmZvID0gdGhpcy5fZ2VvbWV0cnlJbmZvLm1hcCggaW5mbyA9PiAoIHsKCQkJCQkuLi5pbmZvLAoJCQkJCWJvdW5kaW5nQm94OiBpbmZvLmJvdW5kaW5nQm94ID8gaW5mby5ib3VuZGluZ0JveC50b0pTT04oKSA6IHVuZGVmaW5lZCwKCQkJCQlib3VuZGluZ1NwaGVyZTogaW5mby5ib3VuZGluZ1NwaGVyZSA/IGluZm8uYm91bmRpbmdTcGhlcmUudG9KU09OKCkgOiB1bmRlZmluZWQKCQkJCX0gKSApOwoJCQkJb2JqZWN0Lmluc3RhbmNlSW5mbyA9IHRoaXMuX2luc3RhbmNlSW5mby5tYXAoIGluZm8gPT4gKCB7IC4uLmluZm8gfSApICk7CgoJCQkJb2JqZWN0LmF2YWlsYWJsZUluc3RhbmNlSWRzID0gdGhpcy5fYXZhaWxhYmxlSW5zdGFuY2VJZHMuc2xpY2UoKTsKCQkJCW9iamVjdC5hdmFpbGFibGVHZW9tZXRyeUlkcyA9IHRoaXMuX2F2YWlsYWJsZUdlb21ldHJ5SWRzLnNsaWNlKCk7CgoJCQkJb2JqZWN0Lm5leHRJbmRleFN0YXJ0ID0gdGhpcy5fbmV4dEluZGV4U3RhcnQ7CgkJCQlvYmplY3QubmV4dFZlcnRleFN0YXJ0ID0gdGhpcy5fbmV4dFZlcnRleFN0YXJ0OwoJCQkJb2JqZWN0Lmdlb21ldHJ5Q291bnQgPSB0aGlzLl9nZW9tZXRyeUNvdW50OwoKCQkJCW9iamVjdC5tYXhJbnN0YW5jZUNvdW50ID0gdGhpcy5fbWF4SW5zdGFuY2VDb3VudDsKCQkJCW9iamVjdC5tYXhWZXJ0ZXhDb3VudCA9IHRoaXMuX21heFZlcnRleENvdW50OwoJCQkJb2JqZWN0Lm1heEluZGV4Q291bnQgPSB0aGlzLl9tYXhJbmRleENvdW50OwoKCQkJCW9iamVjdC5nZW9tZXRyeUluaXRpYWxpemVkID0gdGhpcy5fZ2VvbWV0cnlJbml0aWFsaXplZDsKCgkJCQlvYmplY3QubWF0cmljZXNUZXh0dXJlID0gdGhpcy5fbWF0cmljZXNUZXh0dXJlLnRvSlNPTiggbWV0YSApOwoKCQkJCW9iamVjdC5pbmRpcmVjdFRleHR1cmUgPSB0aGlzLl9pbmRpcmVjdFRleHR1cmUudG9KU09OKCBtZXRhICk7CgoJCQkJaWYgKCB0aGlzLl9jb2xvcnNUZXh0dXJlICE9PSBudWxsICkgewoKCQkJCQlvYmplY3QuY29sb3JzVGV4dHVyZSA9IHRoaXMuX2NvbG9yc1RleHR1cmUudG9KU09OKCBtZXRhICk7CgoJCQkJfQoKCQkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQkJb2JqZWN0LmJvdW5kaW5nU3BoZXJlID0gdGhpcy5ib3VuZGluZ1NwaGVyZS50b0pTT04oKTsKCgkJCQl9CgoJCQkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ICE9PSBudWxsICkgewoKCQkJCQlvYmplY3QuYm91bmRpbmdCb3ggPSB0aGlzLmJvdW5kaW5nQm94LnRvSlNPTigpOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlmdW5jdGlvbiBzZXJpYWxpemUoIGxpYnJhcnksIGVsZW1lbnQgKSB7CgoJCQkJaWYgKCBsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9IGVsZW1lbnQudG9KU09OKCBtZXRhICk7CgoJCQkJfQoKCQkJCXJldHVybiBlbGVtZW50LnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuaXNTY2VuZSApIHsKCgkJCQlpZiAoIHRoaXMuYmFja2dyb3VuZCApIHsKCgkJCQkJaWYgKCB0aGlzLmJhY2tncm91bmQuaXNDb2xvciApIHsKCgkJCQkJCW9iamVjdC5iYWNrZ3JvdW5kID0gdGhpcy5iYWNrZ3JvdW5kLnRvSlNPTigpOwoKCQkJCQl9IGVsc2UgaWYgKCB0aGlzLmJhY2tncm91bmQuaXNUZXh0dXJlICkgewoKCQkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIHRoaXMuZW52aXJvbm1lbnQgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1JlbmRlclRhcmdldFRleHR1cmUgIT09IHRydWUgKSB7CgoJCQkJCW9iamVjdC5lbnZpcm9ubWVudCA9IHRoaXMuZW52aXJvbm1lbnQudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCB0aGlzLmlzTWVzaCB8fCB0aGlzLmlzTGluZSB8fCB0aGlzLmlzUG9pbnRzICkgewoKCQkJCW9iamVjdC5nZW9tZXRyeSA9IHNlcmlhbGl6ZSggbWV0YS5nZW9tZXRyaWVzLCB0aGlzLmdlb21ldHJ5ICk7CgoJCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMuZ2VvbWV0cnkucGFyYW1ldGVyczsKCgkJCQlpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCAmJiBwYXJhbWV0ZXJzLnNoYXBlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zdCBzaGFwZXMgPSBwYXJhbWV0ZXJzLnNoYXBlczsKCgkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBzaGFwZXMgKSApIHsKCgkJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBpIF07CgoJCQkJCQkJc2VyaWFsaXplKCBtZXRhLnNoYXBlcywgc2hhcGUgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXNlcmlhbGl6ZSggbWV0YS5zaGFwZXMsIHNoYXBlcyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJb2JqZWN0LmJpbmRNb2RlID0gdGhpcy5iaW5kTW9kZTsKCQkJCW9iamVjdC5iaW5kTWF0cml4ID0gdGhpcy5iaW5kTWF0cml4LnRvQXJyYXkoKTsKCgkJCQlpZiAoIHRoaXMuc2tlbGV0b24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJc2VyaWFsaXplKCBtZXRhLnNrZWxldG9ucywgdGhpcy5za2VsZXRvbiApOwoKCQkJCQlvYmplY3Quc2tlbGV0b24gPSB0aGlzLnNrZWxldG9uLnV1aWQ7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0aGlzLm1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCB0aGlzLm1hdGVyaWFsICkgKSB7CgoJCQkJCWNvbnN0IHV1aWRzID0gW107CgoJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMubWF0ZXJpYWwubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJCXV1aWRzLnB1c2goIHNlcmlhbGl6ZSggbWV0YS5tYXRlcmlhbHMsIHRoaXMubWF0ZXJpYWxbIGkgXSApICk7CgoJCQkJCX0KCgkJCQkJb2JqZWN0Lm1hdGVyaWFsID0gdXVpZHM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJb2JqZWN0Lm1hdGVyaWFsID0gc2VyaWFsaXplKCBtZXRhLm1hdGVyaWFscywgdGhpcy5tYXRlcmlhbCApOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMCApIHsKCgkJCQlvYmplY3QuY2hpbGRyZW4gPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJb2JqZWN0LmNoaWxkcmVuLnB1c2goIHRoaXMuY2hpbGRyZW5bIGkgXS50b0pTT04oIG1ldGEgKS5vYmplY3QgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLwoKCQkJaWYgKCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoID4gMCApIHsKCgkJCQlvYmplY3QuYW5pbWF0aW9ucyA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuYW5pbWF0aW9ucy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uc1sgaSBdOwoKCQkJCQlvYmplY3QuYW5pbWF0aW9ucy5wdXNoKCBzZXJpYWxpemUoIG1ldGEuYW5pbWF0aW9ucywgYW5pbWF0aW9uICkgKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIGlzUm9vdE9iamVjdCApIHsKCgkJCQljb25zdCBnZW9tZXRyaWVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5nZW9tZXRyaWVzICk7CgkJCQljb25zdCBtYXRlcmlhbHMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLm1hdGVyaWFscyApOwoJCQkJY29uc3QgdGV4dHVyZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLnRleHR1cmVzICk7CgkJCQljb25zdCBpbWFnZXMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLmltYWdlcyApOwoJCQkJY29uc3Qgc2hhcGVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5zaGFwZXMgKTsKCQkJCWNvbnN0IHNrZWxldG9ucyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuc2tlbGV0b25zICk7CgkJCQljb25zdCBhbmltYXRpb25zID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5hbmltYXRpb25zICk7CgkJCQljb25zdCBub2RlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEubm9kZXMgKTsKCgkJCQlpZiAoIGdlb21ldHJpZXMubGVuZ3RoID4gMCApIG91dHB1dC5nZW9tZXRyaWVzID0gZ2VvbWV0cmllczsKCQkJCWlmICggbWF0ZXJpYWxzLmxlbmd0aCA+IDAgKSBvdXRwdXQubWF0ZXJpYWxzID0gbWF0ZXJpYWxzOwoJCQkJaWYgKCB0ZXh0dXJlcy5sZW5ndGggPiAwICkgb3V0cHV0LnRleHR1cmVzID0gdGV4dHVyZXM7CgkJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgb3V0cHV0LmltYWdlcyA9IGltYWdlczsKCQkJCWlmICggc2hhcGVzLmxlbmd0aCA+IDAgKSBvdXRwdXQuc2hhcGVzID0gc2hhcGVzOwoJCQkJaWYgKCBza2VsZXRvbnMubGVuZ3RoID4gMCApIG91dHB1dC5za2VsZXRvbnMgPSBza2VsZXRvbnM7CgkJCQlpZiAoIGFuaW1hdGlvbnMubGVuZ3RoID4gMCApIG91dHB1dC5hbmltYXRpb25zID0gYW5pbWF0aW9uczsKCQkJCWlmICggbm9kZXMubGVuZ3RoID4gMCApIG91dHB1dC5ub2RlcyA9IG5vZGVzOwoKCQkJfQoKCQkJb3V0cHV0Lm9iamVjdCA9IG9iamVjdDsKCgkJCXJldHVybiBvdXRwdXQ7CgoJCQkvLyBleHRyYWN0IGRhdGEgZnJvbSB0aGUgY2FjaGUgaGFzaAoJCQkvLyByZW1vdmUgbWV0YWRhdGEgb24gZWFjaCBpdGVtCgkJCS8vIGFuZCByZXR1cm4gYXMgYXJyYXkKCQkJZnVuY3Rpb24gZXh0cmFjdEZyb21DYWNoZSggY2FjaGUgKSB7CgoJCQkJY29uc3QgdmFsdWVzID0gW107CgkJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgoJCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IDNEIG9iamVjdCB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtib29sZWFufSBbcmVjdXJzaXZlPXRydWVdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBkZXNjZW5kYW50cyBvZiB0aGUgM0Qgb2JqZWN0IGFyZSBhbHNvIGNsb25lZC4KCQkgKiBAcmV0dXJuIHtPYmplY3QzRH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCByZWN1cnNpdmUgKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzLCByZWN1cnNpdmUgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gM0Qgb2JqZWN0IHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdDNEfSBzb3VyY2UgLSBUaGUgM0Qgb2JqZWN0IHRvIGNvcHkuCgkJICogQHBhcmFtIHtib29sZWFufSBbcmVjdXJzaXZlPXRydWVdIC0gV2hlbiBzZXQgdG8gYHRydWVgLCBkZXNjZW5kYW50cyBvZiB0aGUgM0Qgb2JqZWN0IGFyZSBjbG9uZWQuCgkJICogQHJldHVybiB7T2JqZWN0M0R9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weSggc291cmNlLCByZWN1cnNpdmUgPSB0cnVlICkgewoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCQl0aGlzLnVwLmNvcHkoIHNvdXJjZS51cCApOwoKCQkJdGhpcy5wb3NpdGlvbi5jb3B5KCBzb3VyY2UucG9zaXRpb24gKTsKCQkJdGhpcy5yb3RhdGlvbi5vcmRlciA9IHNvdXJjZS5yb3RhdGlvbi5vcmRlcjsKCQkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHNvdXJjZS5xdWF0ZXJuaW9uICk7CgkJCXRoaXMuc2NhbGUuY29weSggc291cmNlLnNjYWxlICk7CgoJCQl0aGlzLm1hdHJpeC5jb3B5KCBzb3VyY2UubWF0cml4ICk7CgkJCXRoaXMubWF0cml4V29ybGQuY29weSggc291cmNlLm1hdHJpeFdvcmxkICk7CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJCXRoaXMubWF0cml4V29ybGRBdXRvVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZTsKCQkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gc291cmNlLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGU7CgoJCQl0aGlzLmxheWVycy5tYXNrID0gc291cmNlLmxheWVycy5tYXNrOwoJCQl0aGlzLnZpc2libGUgPSBzb3VyY2UudmlzaWJsZTsKCgkJCXRoaXMuY2FzdFNoYWRvdyA9IHNvdXJjZS5jYXN0U2hhZG93OwoJCQl0aGlzLnJlY2VpdmVTaGFkb3cgPSBzb3VyY2UucmVjZWl2ZVNoYWRvdzsKCgkJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHNvdXJjZS5mcnVzdHVtQ3VsbGVkOwoJCQl0aGlzLnJlbmRlck9yZGVyID0gc291cmNlLnJlbmRlck9yZGVyOwoKCQkJdGhpcy5hbmltYXRpb25zID0gc291cmNlLmFuaW1hdGlvbnMuc2xpY2UoKTsKCgkJCXRoaXMudXNlckRhdGEgPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeSggc291cmNlLnVzZXJEYXRhICkgKTsKCgkJCWlmICggcmVjdXJzaXZlID09PSB0cnVlICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNvdXJjZS5jaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNoaWxkID0gc291cmNlLmNoaWxkcmVuWyBpIF07CgkJCQkJdGhpcy5hZGQoIGNoaWxkLmNsb25lKCkgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgkvKioKCSAqIFRoZSBkZWZhdWx0IHVwIGRpcmVjdGlvbiBmb3Igb2JqZWN0cywgYWxzbyB1c2VkIGFzIHRoZSBkZWZhdWx0CgkgKiBwb3NpdGlvbiBmb3Ige0BsaW5rIERpcmVjdGlvbmFsTGlnaHR9IGFuZCB7QGxpbmsgSGVtaXNwaGVyZUxpZ2h0fS4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7VmVjdG9yM30KCSAqIEBkZWZhdWx0ICgwLDEsMCkKCSAqLwoJT2JqZWN0M0QuREVGQVVMVF9VUCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKCgkvKioKCSAqIFRoZSBkZWZhdWx0IHNldHRpbmcgZm9yIHtAbGluayBPYmplY3QzRCNtYXRyaXhBdXRvVXBkYXRlfSBmb3IKCSAqIG5ld2x5IGNyZWF0ZWQgM0Qgb2JqZWN0cy4KCSAqCgkgKiBAc3RhdGljCgkgKiBAdHlwZSB7Ym9vbGVhbn0KCSAqIEBkZWZhdWx0IHRydWUKCSAqLwoJT2JqZWN0M0QuREVGQVVMVF9NQVRSSVhfQVVUT19VUERBVEUgPSB0cnVlOwoKCS8qKgoJICogVGhlIGRlZmF1bHQgc2V0dGluZyBmb3Ige0BsaW5rIE9iamVjdDNEI21hdHJpeFdvcmxkQXV0b1VwZGF0ZX0gZm9yCgkgKiBuZXdseSBjcmVhdGVkIDNEIG9iamVjdHMuCgkgKgoJICogQHN0YXRpYwoJICogQHR5cGUge2Jvb2xlYW59CgkgKiBAZGVmYXVsdCB0cnVlCgkgKi8KCU9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFID0gdHJ1ZTsKCgljb25zdCBfdjAkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92MSQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3YyJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdjMkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfdmFiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZhYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92YmMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdmFwID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZicCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92Y3AgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX3Y0MCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjQoKTsKCWNvbnN0IF92NDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3I0KCk7Cgljb25zdCBfdjQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yNCgpOwoKCS8qKgoJICogQSBnZW9tZXRyaWMgdHJpYW5nbGUgYXMgZGVmaW5lZCBieSB0aHJlZSB2ZWN0b3JzIHJlcHJlc2VudGluZyBpdHMgdGhyZWUgY29ybmVycy4KCSAqLwoJY2xhc3MgVHJpYW5nbGUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRyaWFuZ2xlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbYT0oMCwwLDApXSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gW2I9KDAsMCwwKV0gLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbYz0oMCwwLDApXSAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBhID0gbmV3IFZlY3RvcjMoKSwgYiA9IG5ldyBWZWN0b3IzKCksIGMgPSBuZXcgVmVjdG9yMygpICkgewoKCQkJLyoqCgkJCSAqIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJICovCgkJCXRoaXMuYSA9IGE7CgoJCQkvKioKCQkJICogVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJICovCgkJCXRoaXMuYiA9IGI7CgoJCQkvKioKCQkJICogVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtWZWN0b3IzfQoJCQkgKi8KCQkJdGhpcy5jID0gYzsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIHZlY3RvciBvZiBhIHRyaWFuZ2xlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBiIC0gVGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYyAtIFRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3Mgbm9ybWFsLgoJCSAqLwoJCXN0YXRpYyBnZXROb3JtYWwoIGEsIGIsIGMsIHRhcmdldCApIHsKCgkJCXRhcmdldC5zdWJWZWN0b3JzKCBjLCBiICk7CgkJCV92MCQxLnN1YlZlY3RvcnMoIGEsIGIgKTsKCQkJdGFyZ2V0LmNyb3NzKCBfdjAkMSApOwoKCQkJY29uc3QgdGFyZ2V0TGVuZ3RoU3EgPSB0YXJnZXQubGVuZ3RoU3EoKTsKCQkJaWYgKCB0YXJnZXRMZW5ndGhTcSA+IDAgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5tdWx0aXBseVNjYWxhciggMSAvIE1hdGguc3FydCggdGFyZ2V0TGVuZ3RoU3EgKSApOwoKCQkJfQoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIDAsIDAsIDAgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyBhIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZyb20gdGhlIGdpdmVuIHZlY3Rvci4KCQkgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgdHJpYW5nbGUgaXMgZGVnZW5lcmF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4gez9WZWN0b3IzfSBUaGUgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgZm9yIHRoZSBnaXZlbiBwb2ludAoJCSAqLwoJCXN0YXRpYyBnZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCB0YXJnZXQgKSB7CgoJCQkvLyBiYXNlZCBvbjogaHR0cDovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbAoKCQkJX3YwJDEuc3ViVmVjdG9ycyggYywgYSApOwoJCQlfdjEkMy5zdWJWZWN0b3JzKCBiLCBhICk7CgkJCV92MiQyLnN1YlZlY3RvcnMoIHBvaW50LCBhICk7CgoJCQljb25zdCBkb3QwMCA9IF92MCQxLmRvdCggX3YwJDEgKTsKCQkJY29uc3QgZG90MDEgPSBfdjAkMS5kb3QoIF92MSQzICk7CgkJCWNvbnN0IGRvdDAyID0gX3YwJDEuZG90KCBfdjIkMiApOwoJCQljb25zdCBkb3QxMSA9IF92MSQzLmRvdCggX3YxJDMgKTsKCQkJY29uc3QgZG90MTIgPSBfdjEkMy5kb3QoIF92MiQyICk7CgoJCQljb25zdCBkZW5vbSA9ICggZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDEgKTsKCgkJCS8vIGNvbGxpbmVhciBvciBzaW5ndWxhciB0cmlhbmdsZQoJCQlpZiAoIGRlbm9tID09PSAwICkgewoKCQkJCXRhcmdldC5zZXQoIDAsIDAsIDAgKTsKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJY29uc3QgaW52RGVub20gPSAxIC8gZGVub207CgkJCWNvbnN0IHUgPSAoIGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyICkgKiBpbnZEZW5vbTsKCQkJY29uc3QgdiA9ICggZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIgKSAqIGludkRlbm9tOwoKCQkJLy8gYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgbXVzdCBhbHdheXMgc3VtIHRvIDEKCQkJcmV0dXJuIHRhcmdldC5zZXQoIDEgLSB1IC0gdiwgdiwgdSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSBnaXZlbiBwb2ludCwgd2hlbiBwcm9qZWN0ZWQgb250byB0aGUgcGxhbmUgb2YgdGhlCgkJICogdHJpYW5nbGUsIGxpZXMgd2l0aGluIHRoZSB0cmlhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgaW4gM0Qgc3BhY2UgdG8gdGVzdC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQoJCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUgb3Igbm90LgoJCSAqLwoJCXN0YXRpYyBjb250YWluc1BvaW50KCBwb2ludCwgYSwgYiwgYyApIHsKCgkJCS8vIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlIHRoZW4gd2UgY2FuJ3QgY29udGFpbiBhIHBvaW50CgkJCWlmICggdGhpcy5nZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCBfdjMkMiApID09PSBudWxsICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJCXJldHVybiAoIF92MyQyLnggPj0gMCApICYmICggX3YzJDIueSA+PSAwICkgJiYgKCAoIF92MyQyLnggKyBfdjMkMi55ICkgPD0gMSApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSB2YWx1ZSBiYXJ5Y2VudHJpY2FsbHkgaW50ZXJwb2xhdGVkIGZvciB0aGUgZ2l2ZW4gcG9pbnQgb24gdGhlCgkJICogdHJpYW5nbGUuIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFBvc2l0aW9uIG9mIGludGVycG9sYXRlZCBwb2ludC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAxIC0gVGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwMiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAzIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2MSAtIFZhbHVlIHRvIGludGVycG9sYXRlIG9mIGZpcnN0IHZlcnRleC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYyIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2Ygc2Vjb25kIHZlcnRleC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYzIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgdGhpcmQgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBpbnRlcnBvbGF0ZWQgdmFsdWUuCgkJICovCgkJc3RhdGljIGdldEludGVycG9sYXRpb24oIHBvaW50LCBwMSwgcDIsIHAzLCB2MSwgdjIsIHYzLCB0YXJnZXQgKSB7CgoJCQlpZiAoIHRoaXMuZ2V0QmFyeWNvb3JkKCBwb2ludCwgcDEsIHAyLCBwMywgX3YzJDIgKSA9PT0gbnVsbCApIHsKCgkJCQl0YXJnZXQueCA9IDA7CgkJCQl0YXJnZXQueSA9IDA7CgkJCQlpZiAoICd6JyBpbiB0YXJnZXQgKSB0YXJnZXQueiA9IDA7CgkJCQlpZiAoICd3JyBpbiB0YXJnZXQgKSB0YXJnZXQudyA9IDA7CgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCXRhcmdldC5zZXRTY2FsYXIoIDAgKTsKCQkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjEsIF92MyQyLnggKTsKCQkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjIsIF92MyQyLnkgKTsKCQkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjMsIF92MyQyLnogKTsKCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHZhbHVlIGJhcnljZW50cmljYWxseSBpbnRlcnBvbGF0ZWQgZm9yIHRoZSBnaXZlbiBhdHRyaWJ1dGUgYW5kIGluZGljZXMuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0ciAtIFRoZSBhdHRyaWJ1dGUgdG8gaW50ZXJwb2xhdGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gSW5kZXggb2YgZmlyc3QgdmVydGV4LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIEluZGV4IG9mIHNlY29uZCB2ZXJ0ZXguCgkJICogQHBhcmFtIHtudW1iZXJ9IGkzIC0gSW5kZXggb2YgdGhpcmQgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYmFyeWNvb3JkIC0gVGhlIGJhcnljb29yZGluYXRlIHZhbHVlIHRvIHVzZSB0byBpbnRlcnBvbGF0ZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSBpbnRlcnBvbGF0ZWQgYXR0cmlidXRlIHZhbHVlLgoJCSAqLwoJCXN0YXRpYyBnZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIGF0dHIsIGkxLCBpMiwgaTMsIGJhcnljb29yZCwgdGFyZ2V0ICkgewoKCQkJX3Y0MC5zZXRTY2FsYXIoIDAgKTsKCQkJX3Y0MS5zZXRTY2FsYXIoIDAgKTsKCQkJX3Y0Mi5zZXRTY2FsYXIoIDAgKTsKCgkJCV92NDAuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0ciwgaTEgKTsKCQkJX3Y0MS5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyLCBpMiApOwoJCQlfdjQyLmZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHIsIGkzICk7CgoJCQl0YXJnZXQuc2V0U2NhbGFyKCAwICk7CgkJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDAsIGJhcnljb29yZC54ICk7CgkJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDEsIGJhcnljb29yZC55ICk7CgkJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIF92NDIsIGJhcnljb29yZC56ICk7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoZSB0cmlhbmdsZSBpcyBvcmllbnRlZCB0b3dhcmRzIHRoZSBnaXZlbiBkaXJlY3Rpb24uCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGEgLSBUaGUgZmlyc3QgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGIgLSBUaGUgc2Vjb25kIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBkaXJlY3Rpb24gLSBUaGUgKG5vcm1hbGl6ZWQpIGRpcmVjdGlvbiB2ZWN0b3IuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgdHJpYW5nbGUgaXMgb3JpZW50ZWQgdG93YXJkcyB0aGUgZ2l2ZW4gZGlyZWN0aW9uIG9yIG5vdC4KCQkgKi8KCQlzdGF0aWMgaXNGcm9udEZhY2luZyggYSwgYiwgYywgZGlyZWN0aW9uICkgewoKCQkJX3YwJDEuc3ViVmVjdG9ycyggYywgYiApOwoJCQlfdjEkMy5zdWJWZWN0b3JzKCBhLCBiICk7CgoJCQkvLyBzdHJpY3RseSBmcm9udCBmYWNpbmcKCQkJcmV0dXJuICggX3YwJDEuY3Jvc3MoIF92MSQzICkuZG90KCBkaXJlY3Rpb24gKSA8IDAgKSA/IHRydWUgOiBmYWxzZTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYSAtIFRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IGMgLSBUaGUgdGhpcmQgY29ybmVyIG9mIHRoZSB0cmlhbmdsZS4KCQkgKiBAcmV0dXJuIHtUcmlhbmdsZX0gQSByZWZlcmVuY2UgdG8gdGhpcyB0cmlhbmdsZS4KCQkgKi8KCQlzZXQoIGEsIGIsIGMgKSB7CgoJCQl0aGlzLmEuY29weSggYSApOwoJCQl0aGlzLmIuY29weSggYiApOwoJCQl0aGlzLmMuY29weSggYyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdHJpYW5nbGUncyB2ZXJ0aWNlcyBieSBjb3B5aW5nIHRoZSBnaXZlbiBhcnJheSB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PFZlY3RvcjM+fSBwb2ludHMgLSBBbiBhcnJheSB3aXRoIDNEIHBvaW50cy4KCQkgKiBAcGFyYW0ge251bWJlcn0gaTAgLSBUaGUgYXJyYXkgaW5kZXggcmVwcmVzZW50aW5nIHRoZSBmaXJzdCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMSAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIFRoZSBhcnJheSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHRoaXJkIGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCgkJICovCgkJc2V0RnJvbVBvaW50c0FuZEluZGljZXMoIHBvaW50cywgaTAsIGkxLCBpMiApIHsKCgkJCXRoaXMuYS5jb3B5KCBwb2ludHNbIGkwIF0gKTsKCQkJdGhpcy5iLmNvcHkoIHBvaW50c1sgaTEgXSApOwoJCQl0aGlzLmMuY29weSggcG9pbnRzWyBpMiBdICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB0cmlhbmdsZSdzIHZlcnRpY2VzIGJ5IGNvcHlpbmcgdGhlIGdpdmVuIGF0dHJpYnV0ZSB2YWx1ZXMuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gQSBidWZmZXIgYXR0cmlidXRlIHdpdGggM0QgcG9pbnRzIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGkwIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIGZpcnN0IGNvcm5lciBvZiB0aGUgdHJpYW5nbGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IGkxIC0gVGhlIGF0dHJpYnV0ZSBpbmRleCByZXByZXNlbnRpbmcgdGhlIHNlY29uZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpMiAtIFRoZSBhdHRyaWJ1dGUgaW5kZXggcmVwcmVzZW50aW5nIHRoZSB0aGlyZCBjb3JuZXIgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqIEByZXR1cm4ge1RyaWFuZ2xlfSBBIHJlZmVyZW5jZSB0byB0aGlzIHRyaWFuZ2xlLgoJCSAqLwoJCXNldEZyb21BdHRyaWJ1dGVBbmRJbmRpY2VzKCBhdHRyaWJ1dGUsIGkwLCBpMSwgaTIgKSB7CgoJCQl0aGlzLmEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMCApOwoJCQl0aGlzLmIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMSApOwoJCQl0aGlzLmMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyB0cmlhbmdsZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7VHJpYW5nbGV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gdHJpYW5nbGUgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7VHJpYW5nbGV9IHRyaWFuZ2xlIC0gVGhlIHRyaWFuZ2xlIHRvIGNvcHkuCgkJICogQHJldHVybiB7VHJpYW5nbGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgdHJpYW5nbGUuCgkJICovCgkJY29weSggdHJpYW5nbGUgKSB7CgoJCQl0aGlzLmEuY29weSggdHJpYW5nbGUuYSApOwoJCQl0aGlzLmIuY29weSggdHJpYW5nbGUuYiApOwoJCQl0aGlzLmMuY29weSggdHJpYW5nbGUuYyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIGFyZWEgb2YgdGhlIHRyaWFuZ2xlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgdHJpYW5nbGUncyBhcmVhLgoJCSAqLwoJCWdldEFyZWEoKSB7CgoJCQlfdjAkMS5zdWJWZWN0b3JzKCB0aGlzLmMsIHRoaXMuYiApOwoJCQlfdjEkMy5zdWJWZWN0b3JzKCB0aGlzLmEsIHRoaXMuYiApOwoKCQkJcmV0dXJuIF92MCQxLmNyb3NzKCBfdjEkMyApLmxlbmd0aCgpICogMC41OwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBtaWRwb2ludCBvZiB0aGUgdHJpYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgdmVjdG9yIHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSB0cmlhbmdsZSdzIG1pZHBvaW50LgoJCSAqLwoJCWdldE1pZHBvaW50KCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICkuYWRkKCB0aGlzLmMgKS5tdWx0aXBseVNjYWxhciggMSAvIDMgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgbm9ybWFsIG9mIHRoZSB0cmlhbmdsZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIHRyaWFuZ2xlJ3Mgbm9ybWFsLgoJCSAqLwoJCWdldE5vcm1hbCggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldE5vcm1hbCggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYywgdGFyZ2V0ICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgYSBwbGFuZSB0aGUgdHJpYW5nbGUgbGllcyB3aXRoaW4uCgkJICoKCQkgKiBAcGFyYW0ge1BsYW5lfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtQbGFuZX0gVGhlIHBsYW5lIHRoZSB0cmlhbmdsZSBsaWVzIHdpdGhpbi4KCQkgKi8KCQlnZXRQbGFuZSggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5zZXRGcm9tQ29wbGFuYXJQb2ludHMoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMgKTsKCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyBhIGJhcnljZW50cmljIGNvb3JkaW5hdGVzIGZyb20gdGhlIGdpdmVuIHZlY3Rvci4KCQkgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgdHJpYW5nbGUgaXMgZGVnZW5lcmF0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIHBvaW50IGluIDNEIHNwYWNlLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7P1ZlY3RvcjN9IFRoZSBiYXJ5Y2VudHJpYyBjb29yZGluYXRlcyBmb3IgdGhlIGdpdmVuIHBvaW50CgkJICovCgkJZ2V0QmFyeWNvb3JkKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldEJhcnljb29yZCggcG9pbnQsIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSB2YWx1ZSBiYXJ5Y2VudHJpY2FsbHkgaW50ZXJwb2xhdGVkIGZvciB0aGUgZ2l2ZW4gcG9pbnQgb24gdGhlCgkJICogdHJpYW5nbGUuIFJldHVybnMgYG51bGxgIGlmIHRoZSB0cmlhbmdsZSBpcyBkZWdlbmVyYXRlLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFBvc2l0aW9uIG9mIGludGVycG9sYXRlZCBwb2ludC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHYxIC0gVmFsdWUgdG8gaW50ZXJwb2xhdGUgb2YgZmlyc3QgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdjIgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiBzZWNvbmQgdmVydGV4LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdjMgLSBWYWx1ZSB0byBpbnRlcnBvbGF0ZSBvZiB0aGlyZCB2ZXJ0ZXguCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVycG9sYXRlZCB2YWx1ZS4KCQkgKi8KCQlnZXRJbnRlcnBvbGF0aW9uKCBwb2ludCwgdjEsIHYyLCB2MywgdGFyZ2V0ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB2MSwgdjIsIHYzLCB0YXJnZXQgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQoJCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IGluIDNEIHNwYWNlIHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgZ2l2ZW4gcG9pbnQsIHdoZW4gcHJvamVjdGVkIG9udG8gdGhlIHBsYW5lIG9mIHRoZQoJCSAqIHRyaWFuZ2xlLCBsaWVzIHdpdGhpbiB0aGUgdHJpYW5nbGUgb3Igbm90LgoJCSAqLwoJCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmNvbnRhaW5zUG9pbnQoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gZGlyZWN0aW9uIC0gVGhlIChub3JtYWxpemVkKSBkaXJlY3Rpb24gdmVjdG9yLgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHRyaWFuZ2xlIGlzIG9yaWVudGVkIHRvd2FyZHMgdGhlIGdpdmVuIGRpcmVjdGlvbiBvciBub3QuCgkJICovCgkJaXNGcm9udEZhY2luZyggZGlyZWN0aW9uICkgewoKCQkJcmV0dXJuIFRyaWFuZ2xlLmlzRnJvbnRGYWNpbmcoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIGRpcmVjdGlvbiApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgdHJpYW5nbGUgaW50ZXJzZWN0cyB3aXRoIHRoZSBnaXZlbiBib3guCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3ggdG8gaW50ZXJzZWN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyB0cmlhbmdsZSBpbnRlcnNlY3RzIHdpdGggdGhlIGdpdmVuIGJveCBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzVHJpYW5nbGUoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSB0cmlhbmdsZSB0byB0aGUgZ2l2ZW4gcG9pbnQuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHAgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgY2xvc2VzdCBwb2ludCBmb3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgdHJpYW5nbGUuCgkJICovCgkJY2xvc2VzdFBvaW50VG9Qb2ludCggcCwgdGFyZ2V0ICkgewoKCQkJY29uc3QgYSA9IHRoaXMuYSwgYiA9IHRoaXMuYiwgYyA9IHRoaXMuYzsKCQkJbGV0IHYsIHc7CgoJCQkvLyBhbGdvcml0aG0gdGhhbmtzIHRvIFJlYWwtVGltZSBDb2xsaXNpb24gRGV0ZWN0aW9uIGJ5IENocmlzdGVyIEVyaWNzb24sCgkJCS8vIHB1Ymxpc2hlZCBieSBNb3JnYW4gS2F1Zm1hbm4gUHVibGlzaGVycywgKGMpIDIwMDUgRWxzZXZpZXIgSW5jLiwKCQkJLy8gdW5kZXIgdGhlIGFjY29tcGFueWluZyBsaWNlbnNlOyBzZWUgY2hhcHRlciA1LjEuNSBmb3IgZGV0YWlsZWQgZXhwbGFuYXRpb24uCgkJCS8vIGJhc2ljYWxseSwgd2UncmUgZGlzdGluZ3Vpc2hpbmcgd2hpY2ggb2YgdGhlIHZvcm9ub2kgcmVnaW9ucyBvZiB0aGUgdHJpYW5nbGUKCQkJLy8gdGhlIHBvaW50IGxpZXMgaW4gd2l0aCB0aGUgbWluaW11bSBhbW91bnQgb2YgcmVkdW5kYW50IGNvbXB1dGF0aW9uLgoKCQkJX3ZhYi5zdWJWZWN0b3JzKCBiLCBhICk7CgkJCV92YWMuc3ViVmVjdG9ycyggYywgYSApOwoJCQlfdmFwLnN1YlZlY3RvcnMoIHAsIGEgKTsKCQkJY29uc3QgZDEgPSBfdmFiLmRvdCggX3ZhcCApOwoJCQljb25zdCBkMiA9IF92YWMuZG90KCBfdmFwICk7CgkJCWlmICggZDEgPD0gMCAmJiBkMiA8PSAwICkgewoKCQkJCS8vIHZlcnRleCByZWdpb24gb2YgQTsgYmFyeWNlbnRyaWMgY29vcmRzICgxLCAwLCAwKQoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICk7CgoJCQl9CgoJCQlfdmJwLnN1YlZlY3RvcnMoIHAsIGIgKTsKCQkJY29uc3QgZDMgPSBfdmFiLmRvdCggX3ZicCApOwoJCQljb25zdCBkNCA9IF92YWMuZG90KCBfdmJwICk7CgkJCWlmICggZDMgPj0gMCAmJiBkNCA8PSBkMyApIHsKCgkJCQkvLyB2ZXJ0ZXggcmVnaW9uIG9mIEI7IGJhcnljZW50cmljIGNvb3JkcyAoMCwgMSwgMCkKCQkJCXJldHVybiB0YXJnZXQuY29weSggYiApOwoKCQkJfQoKCQkJY29uc3QgdmMgPSBkMSAqIGQ0IC0gZDMgKiBkMjsKCQkJaWYgKCB2YyA8PSAwICYmIGQxID49IDAgJiYgZDMgPD0gMCApIHsKCgkJCQl2ID0gZDEgLyAoIGQxIC0gZDMgKTsKCQkJCS8vIGVkZ2UgcmVnaW9uIG9mIEFCOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDEtdiwgdiwgMCkKCQkJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggX3ZhYiwgdiApOwoKCQkJfQoKCQkJX3ZjcC5zdWJWZWN0b3JzKCBwLCBjICk7CgkJCWNvbnN0IGQ1ID0gX3ZhYi5kb3QoIF92Y3AgKTsKCQkJY29uc3QgZDYgPSBfdmFjLmRvdCggX3ZjcCApOwoJCQlpZiAoIGQ2ID49IDAgJiYgZDUgPD0gZDYgKSB7CgoJCQkJLy8gdmVydGV4IHJlZ2lvbiBvZiBDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDAsIDEpCgkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGMgKTsKCgkJCX0KCgkJCWNvbnN0IHZiID0gZDUgKiBkMiAtIGQxICogZDY7CgkJCWlmICggdmIgPD0gMCAmJiBkMiA+PSAwICYmIGQ2IDw9IDAgKSB7CgoJCQkJdyA9IGQyIC8gKCBkMiAtIGQ2ICk7CgkJCQkvLyBlZGdlIHJlZ2lvbiBvZiBBQzsgYmFyeWNlbnRyaWMgY29vcmRzICgxLXcsIDAsIHcpCgkJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWMsIHcgKTsKCgkJCX0KCgkJCWNvbnN0IHZhID0gZDMgKiBkNiAtIGQ1ICogZDQ7CgkJCWlmICggdmEgPD0gMCAmJiAoIGQ0IC0gZDMgKSA+PSAwICYmICggZDUgLSBkNiApID49IDAgKSB7CgoJCQkJX3ZiYy5zdWJWZWN0b3JzKCBjLCBiICk7CgkJCQl3ID0gKCBkNCAtIGQzICkgLyAoICggZDQgLSBkMyApICsgKCBkNSAtIGQ2ICkgKTsKCQkJCS8vIGVkZ2UgcmVnaW9uIG9mIEJDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDEtdywgdykKCQkJCXJldHVybiB0YXJnZXQuY29weSggYiApLmFkZFNjYWxlZFZlY3RvciggX3ZiYywgdyApOyAvLyBlZGdlIHJlZ2lvbiBvZiBCQwoKCQkJfQoKCQkJLy8gZmFjZSByZWdpb24KCQkJY29uc3QgZGVub20gPSAxIC8gKCB2YSArIHZiICsgdmMgKTsKCQkJLy8gdSA9IHZhICogZGVub20KCQkJdiA9IHZiICogZGVub207CgkJCXcgPSB2YyAqIGRlbm9tOwoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBhICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFiLCB2ICkuYWRkU2NhbGVkVmVjdG9yKCBfdmFjLCB3ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyB0cmlhbmdsZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1RyaWFuZ2xlfSB0cmlhbmdsZSAtIFRoZSB0cmlhbmdsZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgdHJpYW5nbGUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggdHJpYW5nbGUgKSB7CgoJCQlyZXR1cm4gdHJpYW5nbGUuYS5lcXVhbHMoIHRoaXMuYSApICYmIHRyaWFuZ2xlLmIuZXF1YWxzKCB0aGlzLmIgKSAmJiB0cmlhbmdsZS5jLmVxdWFscyggdGhpcy5jICk7CgoJCX0KCgl9CgoJY29uc3QgX2NvbG9yS2V5d29yZHMgPSB7ICdhbGljZWJsdWUnOiAweEYwRjhGRiwgJ2FudGlxdWV3aGl0ZSc6IDB4RkFFQkQ3LCAnYXF1YSc6IDB4MDBGRkZGLCAnYXF1YW1hcmluZSc6IDB4N0ZGRkQ0LCAnYXp1cmUnOiAweEYwRkZGRiwKCQknYmVpZ2UnOiAweEY1RjVEQywgJ2Jpc3F1ZSc6IDB4RkZFNEM0LCAnYmxhY2snOiAweDAwMDAwMCwgJ2JsYW5jaGVkYWxtb25kJzogMHhGRkVCQ0QsICdibHVlJzogMHgwMDAwRkYsICdibHVldmlvbGV0JzogMHg4QTJCRTIsCgkJJ2Jyb3duJzogMHhBNTJBMkEsICdidXJseXdvb2QnOiAweERFQjg4NywgJ2NhZGV0Ymx1ZSc6IDB4NUY5RUEwLCAnY2hhcnRyZXVzZSc6IDB4N0ZGRjAwLCAnY2hvY29sYXRlJzogMHhEMjY5MUUsICdjb3JhbCc6IDB4RkY3RjUwLAoJCSdjb3JuZmxvd2VyYmx1ZSc6IDB4NjQ5NUVELCAnY29ybnNpbGsnOiAweEZGRjhEQywgJ2NyaW1zb24nOiAweERDMTQzQywgJ2N5YW4nOiAweDAwRkZGRiwgJ2RhcmtibHVlJzogMHgwMDAwOEIsICdkYXJrY3lhbic6IDB4MDA4QjhCLAoJCSdkYXJrZ29sZGVucm9kJzogMHhCODg2MEIsICdkYXJrZ3JheSc6IDB4QTlBOUE5LCAnZGFya2dyZWVuJzogMHgwMDY0MDAsICdkYXJrZ3JleSc6IDB4QTlBOUE5LCAnZGFya2toYWtpJzogMHhCREI3NkIsICdkYXJrbWFnZW50YSc6IDB4OEIwMDhCLAoJCSdkYXJrb2xpdmVncmVlbic6IDB4NTU2QjJGLCAnZGFya29yYW5nZSc6IDB4RkY4QzAwLCAnZGFya29yY2hpZCc6IDB4OTkzMkNDLCAnZGFya3JlZCc6IDB4OEIwMDAwLCAnZGFya3NhbG1vbic6IDB4RTk5NjdBLCAnZGFya3NlYWdyZWVuJzogMHg4RkJDOEYsCgkJJ2RhcmtzbGF0ZWJsdWUnOiAweDQ4M0Q4QiwgJ2RhcmtzbGF0ZWdyYXknOiAweDJGNEY0RiwgJ2RhcmtzbGF0ZWdyZXknOiAweDJGNEY0RiwgJ2Rhcmt0dXJxdW9pc2UnOiAweDAwQ0VEMSwgJ2Rhcmt2aW9sZXQnOiAweDk0MDBEMywKCQknZGVlcHBpbmsnOiAweEZGMTQ5MywgJ2RlZXBza3libHVlJzogMHgwMEJGRkYsICdkaW1ncmF5JzogMHg2OTY5NjksICdkaW1ncmV5JzogMHg2OTY5NjksICdkb2RnZXJibHVlJzogMHgxRTkwRkYsICdmaXJlYnJpY2snOiAweEIyMjIyMiwKCQknZmxvcmFsd2hpdGUnOiAweEZGRkFGMCwgJ2ZvcmVzdGdyZWVuJzogMHgyMjhCMjIsICdmdWNoc2lhJzogMHhGRjAwRkYsICdnYWluc2Jvcm8nOiAweERDRENEQywgJ2dob3N0d2hpdGUnOiAweEY4RjhGRiwgJ2dvbGQnOiAweEZGRDcwMCwKCQknZ29sZGVucm9kJzogMHhEQUE1MjAsICdncmF5JzogMHg4MDgwODAsICdncmVlbic6IDB4MDA4MDAwLCAnZ3JlZW55ZWxsb3cnOiAweEFERkYyRiwgJ2dyZXknOiAweDgwODA4MCwgJ2hvbmV5ZGV3JzogMHhGMEZGRjAsICdob3RwaW5rJzogMHhGRjY5QjQsCgkJJ2luZGlhbnJlZCc6IDB4Q0Q1QzVDLCAnaW5kaWdvJzogMHg0QjAwODIsICdpdm9yeSc6IDB4RkZGRkYwLCAna2hha2knOiAweEYwRTY4QywgJ2xhdmVuZGVyJzogMHhFNkU2RkEsICdsYXZlbmRlcmJsdXNoJzogMHhGRkYwRjUsICdsYXduZ3JlZW4nOiAweDdDRkMwMCwKCQknbGVtb25jaGlmZm9uJzogMHhGRkZBQ0QsICdsaWdodGJsdWUnOiAweEFERDhFNiwgJ2xpZ2h0Y29yYWwnOiAweEYwODA4MCwgJ2xpZ2h0Y3lhbic6IDB4RTBGRkZGLCAnbGlnaHRnb2xkZW5yb2R5ZWxsb3cnOiAweEZBRkFEMiwgJ2xpZ2h0Z3JheSc6IDB4RDNEM0QzLAoJCSdsaWdodGdyZWVuJzogMHg5MEVFOTAsICdsaWdodGdyZXknOiAweEQzRDNEMywgJ2xpZ2h0cGluayc6IDB4RkZCNkMxLCAnbGlnaHRzYWxtb24nOiAweEZGQTA3QSwgJ2xpZ2h0c2VhZ3JlZW4nOiAweDIwQjJBQSwgJ2xpZ2h0c2t5Ymx1ZSc6IDB4ODdDRUZBLAoJCSdsaWdodHNsYXRlZ3JheSc6IDB4Nzc4ODk5LCAnbGlnaHRzbGF0ZWdyZXknOiAweDc3ODg5OSwgJ2xpZ2h0c3RlZWxibHVlJzogMHhCMEM0REUsICdsaWdodHllbGxvdyc6IDB4RkZGRkUwLCAnbGltZSc6IDB4MDBGRjAwLCAnbGltZWdyZWVuJzogMHgzMkNEMzIsCgkJJ2xpbmVuJzogMHhGQUYwRTYsICdtYWdlbnRhJzogMHhGRjAwRkYsICdtYXJvb24nOiAweDgwMDAwMCwgJ21lZGl1bWFxdWFtYXJpbmUnOiAweDY2Q0RBQSwgJ21lZGl1bWJsdWUnOiAweDAwMDBDRCwgJ21lZGl1bW9yY2hpZCc6IDB4QkE1NUQzLAoJCSdtZWRpdW1wdXJwbGUnOiAweDkzNzBEQiwgJ21lZGl1bXNlYWdyZWVuJzogMHgzQ0IzNzEsICdtZWRpdW1zbGF0ZWJsdWUnOiAweDdCNjhFRSwgJ21lZGl1bXNwcmluZ2dyZWVuJzogMHgwMEZBOUEsICdtZWRpdW10dXJxdW9pc2UnOiAweDQ4RDFDQywKCQknbWVkaXVtdmlvbGV0cmVkJzogMHhDNzE1ODUsICdtaWRuaWdodGJsdWUnOiAweDE5MTk3MCwgJ21pbnRjcmVhbSc6IDB4RjVGRkZBLCAnbWlzdHlyb3NlJzogMHhGRkU0RTEsICdtb2NjYXNpbic6IDB4RkZFNEI1LCAnbmF2YWpvd2hpdGUnOiAweEZGREVBRCwKCQknbmF2eSc6IDB4MDAwMDgwLCAnb2xkbGFjZSc6IDB4RkRGNUU2LCAnb2xpdmUnOiAweDgwODAwMCwgJ29saXZlZHJhYic6IDB4NkI4RTIzLCAnb3JhbmdlJzogMHhGRkE1MDAsICdvcmFuZ2VyZWQnOiAweEZGNDUwMCwgJ29yY2hpZCc6IDB4REE3MEQ2LAoJCSdwYWxlZ29sZGVucm9kJzogMHhFRUU4QUEsICdwYWxlZ3JlZW4nOiAweDk4RkI5OCwgJ3BhbGV0dXJxdW9pc2UnOiAweEFGRUVFRSwgJ3BhbGV2aW9sZXRyZWQnOiAweERCNzA5MywgJ3BhcGF5YXdoaXAnOiAweEZGRUZENSwgJ3BlYWNocHVmZic6IDB4RkZEQUI5LAoJCSdwZXJ1JzogMHhDRDg1M0YsICdwaW5rJzogMHhGRkMwQ0IsICdwbHVtJzogMHhEREEwREQsICdwb3dkZXJibHVlJzogMHhCMEUwRTYsICdwdXJwbGUnOiAweDgwMDA4MCwgJ3JlYmVjY2FwdXJwbGUnOiAweDY2MzM5OSwgJ3JlZCc6IDB4RkYwMDAwLCAncm9zeWJyb3duJzogMHhCQzhGOEYsCgkJJ3JveWFsYmx1ZSc6IDB4NDE2OUUxLCAnc2FkZGxlYnJvd24nOiAweDhCNDUxMywgJ3NhbG1vbic6IDB4RkE4MDcyLCAnc2FuZHlicm93bic6IDB4RjRBNDYwLCAnc2VhZ3JlZW4nOiAweDJFOEI1NywgJ3NlYXNoZWxsJzogMHhGRkY1RUUsCgkJJ3NpZW5uYSc6IDB4QTA1MjJELCAnc2lsdmVyJzogMHhDMEMwQzAsICdza3libHVlJzogMHg4N0NFRUIsICdzbGF0ZWJsdWUnOiAweDZBNUFDRCwgJ3NsYXRlZ3JheSc6IDB4NzA4MDkwLCAnc2xhdGVncmV5JzogMHg3MDgwOTAsICdzbm93JzogMHhGRkZBRkEsCgkJJ3NwcmluZ2dyZWVuJzogMHgwMEZGN0YsICdzdGVlbGJsdWUnOiAweDQ2ODJCNCwgJ3Rhbic6IDB4RDJCNDhDLCAndGVhbCc6IDB4MDA4MDgwLCAndGhpc3RsZSc6IDB4RDhCRkQ4LCAndG9tYXRvJzogMHhGRjYzNDcsICd0dXJxdW9pc2UnOiAweDQwRTBEMCwKCQkndmlvbGV0JzogMHhFRTgyRUUsICd3aGVhdCc6IDB4RjVERUIzLCAnd2hpdGUnOiAweEZGRkZGRiwgJ3doaXRlc21va2UnOiAweEY1RjVGNSwgJ3llbGxvdyc6IDB4RkZGRjAwLCAneWVsbG93Z3JlZW4nOiAweDlBQ0QzMiB9OwoKCWNvbnN0IF9oc2xBID0geyBoOiAwLCBzOiAwLCBsOiAwIH07Cgljb25zdCBfaHNsQiA9IHsgaDogMCwgczogMCwgbDogMCB9OwoKCWZ1bmN0aW9uIGh1ZTJyZ2IoIHAsIHEsIHQgKSB7CgoJCWlmICggdCA8IDAgKSB0ICs9IDE7CgkJaWYgKCB0ID4gMSApIHQgLT0gMTsKCQlpZiAoIHQgPCAxIC8gNiApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqIHQ7CgkJaWYgKCB0IDwgMSAvIDIgKSByZXR1cm4gcTsKCQlpZiAoIHQgPCAyIC8gMyApIHJldHVybiBwICsgKCBxIC0gcCApICogNiAqICggMiAvIDMgLSB0ICk7CgkJcmV0dXJuIHA7CgoJfQoKCS8qKgoJICogQSBDb2xvciBpbnN0YW5jZSBpcyByZXByZXNlbnRlZCBieSBSR0IgY29tcG9uZW50cyBpbiB0aGUgbGluZWFyIDxpPndvcmtpbmcKCSAqIGNvbG9yIHNwYWNlPC9pPiwgd2hpY2ggZGVmYXVsdHMgdG8gYExpbmVhclNSR0JDb2xvclNwYWNlYC4gSW5wdXRzCgkgKiBjb252ZW50aW9uYWxseSB1c2luZyBgU1JHQkNvbG9yU3BhY2VgIChzdWNoIGFzIGhleGFkZWNpbWFscyBhbmQgQ1NTCgkgKiBzdHJpbmdzKSBhcmUgY29udmVydGVkIHRvIHRoZSB3b3JraW5nIGNvbG9yIHNwYWNlIGF1dG9tYXRpY2FsbHkuCgkgKgoJICogYGBganMKCSAqIC8vIGNvbnZlcnRlZCBhdXRvbWF0aWNhbGx5IGZyb20gU1JHQkNvbG9yU3BhY2UgdG8gTGluZWFyU1JHQkNvbG9yU3BhY2UKCSAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0SGV4KCAweDExMjIzMyApOwoJICogYGBgCgkgKiBTb3VyY2UgY29sb3Igc3BhY2VzIG1heSBiZSBzcGVjaWZpZWQgZXhwbGljaXRseSwgdG8gZW5zdXJlIGNvcnJlY3QgY29udmVyc2lvbnMuCgkgKiBgYGBqcwoJICogLy8gYXNzdW1lZCBhbHJlYWR5IExpbmVhclNSR0JDb2xvclNwYWNlOyBubyBjb252ZXJzaW9uCgkgKiBjb25zdCBjb2xvciA9IG5ldyBUSFJFRS5Db2xvcigpLnNldFJHQiggMC41LCAwLjUsIDAuNSApOwoJICoKCSAqIC8vIGNvbnZlcnRlZCBleHBsaWNpdGx5IGZyb20gU1JHQkNvbG9yU3BhY2UgdG8gTGluZWFyU1JHQkNvbG9yU3BhY2UKCSAqIGNvbnN0IGNvbG9yID0gbmV3IFRIUkVFLkNvbG9yKCkuc2V0UkdCKCAwLjUsIDAuNSwgMC41LCBTUkdCQ29sb3JTcGFjZSApOwoJICogYGBgCgkgKiBJZiBUSFJFRS5Db2xvck1hbmFnZW1lbnQgaXMgZGlzYWJsZWQsIG5vIGNvbnZlcnNpb25zIG9jY3VyLiBGb3IgZGV0YWlscywKCSAqIHNlZSA8aT5Db2xvciBtYW5hZ2VtZW50PC9pPi4gSXRlcmF0aW5nIHRocm91Z2ggYSBDb2xvciBpbnN0YW5jZSB3aWxsIHlpZWxkCgkgKiBpdHMgY29tcG9uZW50cyAociwgZywgYikgaW4gdGhlIGNvcnJlc3BvbmRpbmcgb3JkZXIuIEEgQ29sb3IgY2FuIGJlIGluaXRpYWxpc2VkCgkgKiBpbiBhbnkgb2YgdGhlIGZvbGxvd2luZyB3YXlzOgoJICogYGBganMKCSAqIC8vZW1wdHkgY29uc3RydWN0b3IgLSB3aWxsIGRlZmF1bHQgd2hpdGUKCSAqIGNvbnN0IGNvbG9yMSA9IG5ldyBUSFJFRS5Db2xvcigpOwoJICoKCSAqIC8vSGV4YWRlY2ltYWwgY29sb3IgKHJlY29tbWVuZGVkKQoJICogY29uc3QgY29sb3IyID0gbmV3IFRIUkVFLkNvbG9yKCAweGZmMDAwMCApOwoJICoKCSAqIC8vUkdCIHN0cmluZwoJICogY29uc3QgY29sb3IzID0gbmV3IFRIUkVFLkNvbG9yKCJyZ2IoMjU1LCAwLCAwKSIpOwoJICogY29uc3QgY29sb3I0ID0gbmV3IFRIUkVFLkNvbG9yKCJyZ2IoMTAwJSwgMCUsIDAlKSIpOwoJICoKCSAqIC8vWDExIGNvbG9yIG5hbWUgLSBhbGwgMTQwIGNvbG9yIG5hbWVzIGFyZSBzdXBwb3J0ZWQuCgkgKiAvL05vdGUgdGhlIGxhY2sgb2YgQ2FtZWxDYXNlIGluIHRoZSBuYW1lCgkgKiBjb25zdCBjb2xvcjUgPSBuZXcgVEhSRUUuQ29sb3IoICdza3libHVlJyApOwoJICogLy9IU0wgc3RyaW5nCgkgKiBjb25zdCBjb2xvcjYgPSBuZXcgVEhSRUUuQ29sb3IoImhzbCgwLCAxMDAlLCA1MCUpIik7CgkgKgoJICogLy9TZXBhcmF0ZSBSR0IgdmFsdWVzIGJldHdlZW4gMCBhbmQgMQoJICogY29uc3QgY29sb3I3ID0gbmV3IFRIUkVFLkNvbG9yKCAxLCAwLCAwICk7CgkgKiBgYGAKCSAqLwoJY2xhc3MgQ29sb3IgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbG9yLgoJCSAqCgkJICogTm90ZSB0aGF0IHN0YW5kYXJkIG1ldGhvZCBvZiBzcGVjaWZ5aW5nIGNvbG9yIGluIHRocmVlLmpzIGlzIHdpdGggYSBoZXhhZGVjaW1hbCB0cmlwbGV0LAoJCSAqIGFuZCB0aGF0IG1ldGhvZCBpcyB1c2VkIHRocm91Z2hvdXQgdGhlIHJlc3Qgb2YgdGhlIGRvY3VtZW50YXRpb24uCgkJICoKCQkgKiBAcGFyYW0geyhudW1iZXJ8c3RyaW5nfENvbG9yKX0gW3JdIC0gVGhlIHJlZCBjb21wb25lbnQgb2YgdGhlIGNvbG9yLiBJZiBgZ2AgYW5kIGBiYCBhcmUKCQkgKiBub3QgcHJvdmlkZWQsIGl0IGNhbiBiZSBoZXhhZGVjaW1hbCB0cmlwbGV0LCBhIENTUy1zdHlsZSBzdHJpbmcgb3IgYW5vdGhlciBgQ29sb3JgIGluc3RhbmNlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZ10gLSBUaGUgZ3JlZW4gY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYl0gLSBUaGUgYmx1ZSBjb21wb25lbnQuCgkJICovCgkJY29uc3RydWN0b3IoIHIsIGcsIGIgKSB7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0NvbG9yID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgcmVkIGNvbXBvbmVudC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5yID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgZ3JlZW4gY29tcG9uZW50LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLmcgPSAxOwoKCQkJLyoqCgkJCSAqIFRoZSBibHVlIGNvbXBvbmVudC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5iID0gMTsKCgkJCXJldHVybiB0aGlzLnNldCggciwgZywgYiApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGNvbG9ycydzIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gdmFsdWVzLgoJCSAqCgkJICogQHBhcmFtIHsobnVtYmVyfHN0cmluZ3xDb2xvcil9IFtyXSAtIFRoZSByZWQgY29tcG9uZW50IG9mIHRoZSBjb2xvci4gSWYgYGdgIGFuZCBgYmAgYXJlCgkJICogbm90IHByb3ZpZGVkLCBpdCBjYW4gYmUgaGV4YWRlY2ltYWwgdHJpcGxldCwgYSBDU1Mtc3R5bGUgc3RyaW5nIG9yIGFub3RoZXIgYENvbG9yYCBpbnN0YW5jZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2ddIC0gVGhlIGdyZWVuIGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2JdIC0gVGhlIGJsdWUgY29tcG9uZW50LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXNldCggciwgZywgYiApIHsKCgkJCWlmICggZyA9PT0gdW5kZWZpbmVkICYmIGIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyByIGlzIFRIUkVFLkNvbG9yLCBoZXggb3Igc3RyaW5nCgoJCQkJY29uc3QgdmFsdWUgPSByOwoKCQkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNDb2xvciApIHsKCgkJCQkJdGhpcy5jb3B5KCB2YWx1ZSApOwoKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgKSB7CgoJCQkJCXRoaXMuc2V0SGV4KCB2YWx1ZSApOwoKCQkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgKSB7CgoJCQkJCXRoaXMuc2V0U3R5bGUoIHZhbHVlICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnNldFJHQiggciwgZywgYiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29sb3JzJ3MgY29tcG9uZW50cyB0byB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHNjYWxhciAtIFRoZSBzY2FsYXIgdmFsdWUuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgoJCQl0aGlzLnIgPSBzY2FsYXI7CgkJCXRoaXMuZyA9IHNjYWxhcjsKCQkJdGhpcy5iID0gc2NhbGFyOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gYSBoZXhhZGVjaW1hbCB2YWx1ZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZXggLSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlzZXRIZXgoIGhleCwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQkJaGV4ID0gTWF0aC5mbG9vciggaGV4ICk7CgoJCQl0aGlzLnIgPSAoIGhleCA+PiAxNiAmIDI1NSApIC8gMjU1OwoJCQl0aGlzLmcgPSAoIGhleCA+PiA4ICYgMjU1ICkgLyAyNTU7CgkJCXRoaXMuYiA9ICggaGV4ICYgMjU1ICkgLyAyNTU7CgoJCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gUkdCIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSByIC0gUmVkIGNoYW5uZWwgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCgkJICogQHBhcmFtIHtudW1iZXJ9IGcgLSBHcmVlbiBjaGFubmVsIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBiIC0gQmx1ZSBjaGFubmVsIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXNldFJHQiggciwgZywgYiwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJCXRoaXMuciA9IHI7CgkJCXRoaXMuZyA9IGc7CgkJCXRoaXMuYiA9IGI7CgoJCQlDb2xvck1hbmFnZW1lbnQuY29sb3JTcGFjZVRvV29ya2luZyggdGhpcywgY29sb3JTcGFjZSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGlzIGNvbG9yIGZyb20gUkdCIHZhbHVlcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBoIC0gSHVlIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBzIC0gU2F0dXJhdGlvbiB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KCQkgKiBAcGFyYW0ge251bWJlcn0gbCAtIExpZ2h0bmVzcyB2YWx1ZSBiZXR3ZWVuIGAwLjBgIGFuZCBgMS4wYC4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Q29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlzZXRIU0woIGgsIHMsIGwsIGNvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKSB7CgoJCQkvLyBoLHMsbCByYW5nZXMgYXJlIGluIDAuMCAtIDEuMAoJCQloID0gZXVjbGlkZWFuTW9kdWxvKCBoLCAxICk7CgkJCXMgPSBjbGFtcCggcywgMCwgMSApOwoJCQlsID0gY2xhbXAoIGwsIDAsIDEgKTsKCgkJCWlmICggcyA9PT0gMCApIHsKCgkJCQl0aGlzLnIgPSB0aGlzLmcgPSB0aGlzLmIgPSBsOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCBwID0gbCA8PSAwLjUgPyBsICogKCAxICsgcyApIDogbCArIHMgLSAoIGwgKiBzICk7CgkJCQljb25zdCBxID0gKCAyICogbCApIC0gcDsKCgkJCQl0aGlzLnIgPSBodWUycmdiKCBxLCBwLCBoICsgMSAvIDMgKTsKCQkJCXRoaXMuZyA9IGh1ZTJyZ2IoIHEsIHAsIGggKTsKCQkJCXRoaXMuYiA9IGh1ZTJyZ2IoIHEsIHAsIGggLSAxIC8gMyApOwoKCQkJfQoKCQkJQ29sb3JNYW5hZ2VtZW50LmNvbG9yU3BhY2VUb1dvcmtpbmcoIHRoaXMsIGNvbG9yU3BhY2UgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhpcyBjb2xvciBmcm9tIGEgQ1NTLXN0eWxlIHN0cmluZy4gRm9yIGV4YW1wbGUsIGByZ2IoMjUwLCAwLDApYCwKCQkgKiBgcmdiKDEwMCUsIDAlLCAwJSlgLCBgaHNsKDAsIDEwMCUsIDUwJSlgLCBgI2ZmMDAwMGAsIGAjZjAwYCwgb3IgYHJlZGAgKCBvcgoJCSAqIGFueSBbWDExIGNvbG9yIG5hbWVde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL1gxMV9jb2xvcl9uYW1lcyNDb2xvcl9uYW1lX2NoYXJ0fSAtCgkJICogYWxsIDE0MCBjb2xvciBuYW1lcyBhcmUgc3VwcG9ydGVkKS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZSAtIENvbG9yIGFzIGEgQ1NTLXN0eWxlIHN0cmluZy4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXNldFN0eWxlKCBzdHlsZSwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQkJZnVuY3Rpb24gaGFuZGxlQWxwaGEoIHN0cmluZyApIHsKCgkJCQlpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJCWlmICggcGFyc2VGbG9hdCggc3RyaW5nICkgPCAxICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogQWxwaGEgY29tcG9uZW50IG9mICcgKyBzdHlsZSArICcgd2lsbCBiZSBpZ25vcmVkLicgKTsKCgkJCQl9CgoJCQl9CgoKCQkJbGV0IG07CgoJCQlpZiAoIG0gPSAvXihcdyspXCgoW15cKV0qKVwpLy5leGVjKCBzdHlsZSApICkgewoKCQkJCS8vIHJnYiAvIGhzbAoKCQkJCWxldCBjb2xvcjsKCQkJCWNvbnN0IG5hbWUgPSBtWyAxIF07CgkJCQljb25zdCBjb21wb25lbnRzID0gbVsgMiBdOwoKCQkJCXN3aXRjaCAoIG5hbWUgKSB7CgoJCQkJCWNhc2UgJ3JnYic6CgkJCQkJY2FzZSAncmdiYSc6CgoJCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVxzKixccyooXGQrKVxzKixccyooXGQrKVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIHJnYigyNTUsMCwwKSByZ2JhKDI1NSwwLDAsMC41KQoKCQkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgoJCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAoJCQkJCQkJCU1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMSBdLCAxMCApICkgLyAyNTUsCgkJCQkJCQkJTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDI1NSwKCQkJCQkJCQlNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMjU1LAoJCQkJCQkJCWNvbG9yU3BhY2UKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVwlXHMqLFxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIHJnYigxMDAlLDAlLDAlKSByZ2JhKDEwMCUsMCUsMCUsMC41KQoKCQkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgoJCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAoJCQkJCQkJCU1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMSBdLCAxMCApICkgLyAxMDAsCgkJCQkJCQkJTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDEwMCwKCQkJCQkJCQlNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMTAwLAoJCQkJCQkJCWNvbG9yU3BhY2UKCQkJCQkJCSk7CgoJCQkJCQl9CgoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnaHNsJzoKCQkJCQljYXNlICdoc2xhJzoKCgkJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCpcLj9cZCspXHMqLFxzKihcZCpcLj9cZCspXCVccyosXHMqKFxkKlwuP1xkKylcJVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJCS8vIGhzbCgxMjAsNTAlLDUwJSkgaHNsYSgxMjAsNTAlLDUwJSwwLjUpCgoJCQkJCQkJaGFuZGxlQWxwaGEoIGNvbG9yWyA0IF0gKTsKCgkJCQkJCQlyZXR1cm4gdGhpcy5zZXRIU0woCgkJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDEgXSApIC8gMzYwLAoJCQkJCQkJCXBhcnNlRmxvYXQoIGNvbG9yWyAyIF0gKSAvIDEwMCwKCQkJCQkJCQlwYXJzZUZsb2F0KCBjb2xvclsgMyBdICkgLyAxMDAsCgkJCQkJCQkJY29sb3JTcGFjZQoJCQkJCQkJKTsKCgkJCQkJCX0KCgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OgoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgbW9kZWwgJyArIHN0eWxlICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggbSA9IC9eXCMoW0EtRmEtZlxkXSspJC8uZXhlYyggc3R5bGUgKSApIHsKCgkJCQkvLyBoZXggY29sb3IKCgkJCQljb25zdCBoZXggPSBtWyAxIF07CgkJCQljb25zdCBzaXplID0gaGV4Lmxlbmd0aDsKCgkJCQlpZiAoIHNpemUgPT09IDMgKSB7CgoJCQkJCS8vICNmZjAKCQkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCgkJCQkJCXBhcnNlSW50KCBoZXguY2hhckF0KCAwICksIDE2ICkgLyAxNSwKCQkJCQkJcGFyc2VJbnQoIGhleC5jaGFyQXQoIDEgKSwgMTYgKSAvIDE1LAoJCQkJCQlwYXJzZUludCggaGV4LmNoYXJBdCggMiApLCAxNiApIC8gMTUsCgkJCQkJCWNvbG9yU3BhY2UKCQkJCQkpOwoKCQkJCX0gZWxzZSBpZiAoIHNpemUgPT09IDYgKSB7CgoJCQkJCS8vICNmZjAwMDAKCQkJCQlyZXR1cm4gdGhpcy5zZXRIZXgoIHBhcnNlSW50KCBoZXgsIDE2ICksIGNvbG9yU3BhY2UgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogSW52YWxpZCBoZXggY29sb3IgJyArIHN0eWxlICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggc3R5bGUgJiYgc3R5bGUubGVuZ3RoID4gMCApIHsKCgkJCQlyZXR1cm4gdGhpcy5zZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgY29sb3IgZnJvbSBhIGNvbG9yIG5hbWUuIEZhc3RlciB0aGFuIHtAbGluayBDb2xvciNzZXRTdHlsZX0gaWYKCQkgKiB5b3UgZG9uJ3QgbmVlZCB0aGUgb3RoZXIgQ1NTLXN0eWxlIGZvcm1hdHMuCgkJICoKCQkgKiBGb3IgY29udmVuaWVuY2UsIHRoZSBsaXN0IG9mIG5hbWVzIGlzIGV4cG9zZWQgaW4gYENvbG9yLk5BTUVTYCBhcyBhIGhhc2guCgkJICogYGBganMKCQkgKiBDb2xvci5OQU1FUy5hbGljZWJsdWUgLy8gcmV0dXJucyAweEYwRjhGRgoJCSAqIGBgYAoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlIC0gVGhlIGNvbG9yIG5hbWUuCgkJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlzZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgoJCQkvLyBjb2xvciBrZXl3b3JkcwoJCQljb25zdCBoZXggPSBfY29sb3JLZXl3b3Jkc1sgc3R5bGUudG9Mb3dlckNhc2UoKSBdOwoKCQkJaWYgKCBoZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyByZWQKCQkJCXRoaXMuc2V0SGV4KCBoZXgsIGNvbG9yU3BhY2UgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gdW5rbm93biBjb2xvcgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IFVua25vd24gY29sb3IgJyArIHN0eWxlICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IGNvbG9yIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLnIsIHRoaXMuZywgdGhpcy5iICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9yIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb3B5LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWNvcHkoIGNvbG9yICkgewoKCQkJdGhpcy5yID0gY29sb3IucjsKCQkJdGhpcy5nID0gY29sb3IuZzsKCQkJdGhpcy5iID0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgZ2l2ZW4gY29sb3IgaW50byB0aGlzIGNvbG9yLCBhbmQgdGhlbiBjb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20KCQkgKiBgU1JHQkNvbG9yU3BhY2VgIHRvIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb3B5L2NvbnZlcnQuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJY29weVNSR0JUb0xpbmVhciggY29sb3IgKSB7CgoJCQl0aGlzLnIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLnIgKTsKCQkJdGhpcy5nID0gU1JHQlRvTGluZWFyKCBjb2xvci5nICk7CgkJCXRoaXMuYiA9IFNSR0JUb0xpbmVhciggY29sb3IuYiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSBnaXZlbiBjb2xvciBpbnRvIHRoaXMgY29sb3IsIGFuZCB0aGVuIGNvbnZlcnRzIHRoaXMgY29sb3IgZnJvbQoJCSAqIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAgdG8gYFNSR0JDb2xvclNwYWNlYC4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvcHkvY29udmVydC4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQljb3B5TGluZWFyVG9TUkdCKCBjb2xvciApIHsKCgkJCXRoaXMuciA9IExpbmVhclRvU1JHQiggY29sb3IuciApOwoJCQl0aGlzLmcgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmcgKTsKCQkJdGhpcy5iID0gTGluZWFyVG9TUkdCKCBjb2xvci5iICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGlzIGNvbG9yIGZyb20gYFNSR0JDb2xvclNwYWNlYCB0byBgTGluZWFyU1JHQkNvbG9yU3BhY2VgLgoJCSAqCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJY29udmVydFNSR0JUb0xpbmVhcigpIHsKCgkJCXRoaXMuY29weVNSR0JUb0xpbmVhciggdGhpcyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29udmVydHMgdGhpcyBjb2xvciBmcm9tIGBMaW5lYXJTUkdCQ29sb3JTcGFjZWAgdG8gYFNSR0JDb2xvclNwYWNlYC4KCQkgKgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWNvbnZlcnRMaW5lYXJUb1NSR0IoKSB7CgoJCQl0aGlzLmNvcHlMaW5lYXJUb1NSR0IoIHRoaXMgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGhleGFkZWNpbWFsIHZhbHVlIG9mIHRoaXMgY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9U1JHQkNvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGhleGFkZWNpbWFsIHZhbHVlLgoJCSAqLwoJCWdldEhleCggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCgkJCXJldHVybiBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLnIgKiAyNTUsIDAsIDI1NSApICkgKiA2NTUzNiArIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuZyAqIDI1NSwgMCwgMjU1ICkgKSAqIDI1NiArIE1hdGgucm91bmQoIGNsYW1wKCBfY29sb3IuYiAqIDI1NSwgMCwgMjU1ICkgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBoZXhhZGVjaW1hbCB2YWx1ZSBvZiB0aGlzIGNvbG9yIGFzIGEgc3RyaW5nIChmb3IgZXhhbXBsZSwgJ0ZGRkZGRicpLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IFtjb2xvclNwYWNlPVNSR0JDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBoZXhhZGVjaW1hbCB2YWx1ZSBhcyBhIHN0cmluZy4KCQkgKi8KCQlnZXRIZXhTdHJpbmcoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJCXJldHVybiAoICcwMDAwMDAnICsgdGhpcy5nZXRIZXgoIGNvbG9yU3BhY2UgKS50b1N0cmluZyggMTYgKSApLnNsaWNlKCAtNiApOwoKCQl9CgoJCS8qKgoJCSAqIENvbnZlcnRzIHRoZSBjb2xvcnMgUkdCIHZhbHVlcyBpbnRvIHRoZSBIU0wgZm9ybWF0IGFuZCBzdG9yZXMgdGhlbSBpbnRvIHRoZQoJCSAqIGdpdmVuIHRhcmdldCBvYmplY3QuCgkJICoKCQkgKiBAcGFyYW0ge3toOm51bWJlcixzOm51bWJlcixsOm51bWJlcn19IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Db2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlLgoJCSAqIEByZXR1cm4ge3toOm51bWJlcixzOm51bWJlcixsOm51bWJlcn19IFRoZSBIU0wgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBjb2xvci4KCQkgKi8KCQlnZXRIU0woIHRhcmdldCwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJCS8vIGgscyxsIHJhbmdlcyBhcmUgaW4gMC4wIC0gMS4wCgoJCQlDb2xvck1hbmFnZW1lbnQud29ya2luZ1RvQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQkJY29uc3QgciA9IF9jb2xvci5yLCBnID0gX2NvbG9yLmcsIGIgPSBfY29sb3IuYjsKCgkJCWNvbnN0IG1heCA9IE1hdGgubWF4KCByLCBnLCBiICk7CgkJCWNvbnN0IG1pbiA9IE1hdGgubWluKCByLCBnLCBiICk7CgoJCQlsZXQgaHVlLCBzYXR1cmF0aW9uOwoJCQljb25zdCBsaWdodG5lc3MgPSAoIG1pbiArIG1heCApIC8gMi4wOwoKCQkJaWYgKCBtaW4gPT09IG1heCApIHsKCgkJCQlodWUgPSAwOwoJCQkJc2F0dXJhdGlvbiA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IGRlbHRhID0gbWF4IC0gbWluOwoKCQkJCXNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAoIG1heCArIG1pbiApIDogZGVsdGEgLyAoIDIgLSBtYXggLSBtaW4gKTsKCgkJCQlzd2l0Y2ggKCBtYXggKSB7CgoJCQkJCWNhc2UgcjogaHVlID0gKCBnIC0gYiApIC8gZGVsdGEgKyAoIGcgPCBiID8gNiA6IDAgKTsgYnJlYWs7CgkJCQkJY2FzZSBnOiBodWUgPSAoIGIgLSByICkgLyBkZWx0YSArIDI7IGJyZWFrOwoJCQkJCWNhc2UgYjogaHVlID0gKCByIC0gZyApIC8gZGVsdGEgKyA0OyBicmVhazsKCgkJCQl9CgoJCQkJaHVlIC89IDY7CgoJCQl9CgoJCQl0YXJnZXQuaCA9IGh1ZTsKCQkJdGFyZ2V0LnMgPSBzYXR1cmF0aW9uOwoJCQl0YXJnZXQubCA9IGxpZ2h0bmVzczsKCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yIGFuZCBzdG9yZXMgdGhlbSBpbnRvIHRoZSBnaXZlbiB0YXJnZXQgb2JqZWN0LgoJCSAqCgkJICogQHBhcmFtIHtDb2xvcn0gdGFyZ2V0IC0gVGhlIHRhcmdldCBjb2xvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2NvbG9yU3BhY2U9Q29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlXSAtIFRoZSBjb2xvciBzcGFjZS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gVGhlIFJHQiByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGNvbG9yLgoJCSAqLwoJCWdldFJHQiggdGFyZ2V0LCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKCQkJQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdUb0NvbG9yU3BhY2UoIF9jb2xvci5jb3B5KCB0aGlzICksIGNvbG9yU3BhY2UgKTsKCgkJCXRhcmdldC5yID0gX2NvbG9yLnI7CgkJCXRhcmdldC5nID0gX2NvbG9yLmc7CgkJCXRhcmdldC5iID0gX2NvbG9yLmI7CgoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoaXMgY29sb3IgYXMgYSBDU1Mgc3R5bGUgc3RyaW5nLiBFeGFtcGxlOiBgcmdiKDI1NSwwLDApYC4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1TUkdCQ29sb3JTcGFjZV0gLSBUaGUgY29sb3Igc3BhY2UuCgkJICogQHJldHVybiB7c3RyaW5nfSBUaGUgQ1NTIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgY29sb3IuCgkJICovCgkJZ2V0U3R5bGUoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJCUNvbG9yTWFuYWdlbWVudC53b3JraW5nVG9Db2xvclNwYWNlKCBfY29sb3IuY29weSggdGhpcyApLCBjb2xvclNwYWNlICk7CgoJCQljb25zdCByID0gX2NvbG9yLnIsIGcgPSBfY29sb3IuZywgYiA9IF9jb2xvci5iOwoKCQkJaWYgKCBjb2xvclNwYWNlICE9PSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJCQkvLyBSZXF1aXJlcyBDU1MgQ29sb3IgTW9kdWxlIExldmVsIDQgKGh0dHBzOi8vd3d3LnczLm9yZy9UUi9jc3MtY29sb3ItNC8pLgoJCQkJcmV0dXJuIGBjb2xvcigkeyBjb2xvclNwYWNlIH0gJHsgci50b0ZpeGVkKCAzICkgfSAkeyBnLnRvRml4ZWQoIDMgKSB9ICR7IGIudG9GaXhlZCggMyApIH0pYDsKCgkJCX0KCgkJCXJldHVybiBgcmdiKCR7IE1hdGgucm91bmQoIHIgKiAyNTUgKSB9LCR7IE1hdGgucm91bmQoIGcgKiAyNTUgKSB9LCR7IE1hdGgucm91bmQoIGIgKiAyNTUgKSB9KWA7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gSFNMIHZhbHVlcyB0byB0aGlzIGNvbG9yJ3MgdmFsdWVzLgoJCSAqIEludGVybmFsbHksIHRoaXMgY29udmVydHMgdGhlIGNvbG9yJ3MgUkdCIHZhbHVlcyB0byBIU0wsIGFkZHMgSFNMCgkJICogYW5kIHRoZW4gY29udmVydHMgdGhlIGNvbG9yIGJhY2sgdG8gUkdCLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGggLSBIdWUgdmFsdWUgYmV0d2VlbiBgMC4wYCBhbmQgYDEuMGAuCgkJICogQHBhcmFtIHtudW1iZXJ9IHMgLSBTYXR1cmF0aW9uIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsIC0gTGlnaHRuZXNzIHZhbHVlIGJldHdlZW4gYDAuMGAgYW5kIGAxLjBgLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCW9mZnNldEhTTCggaCwgcywgbCApIHsKCgkJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoKCQkJcmV0dXJuIHRoaXMuc2V0SFNMKCBfaHNsQS5oICsgaCwgX2hzbEEucyArIHMsIF9oc2xBLmwgKyBsICk7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3IgdG8gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGFkZC4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlhZGQoIGNvbG9yICkgewoKCQkJdGhpcy5yICs9IGNvbG9yLnI7CgkJCXRoaXMuZyArPSBjb2xvci5nOwoJCQl0aGlzLmIgKz0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgdGhlIFJHQiB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9ycyBhbmQgc3RvcmVzIHRoZSByZXN1bHQgaW4gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMSAtIFRoZSBmaXJzdCBjb2xvci4KCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvcjIgLSBUaGUgc2Vjb25kIGNvbG9yLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWFkZENvbG9ycyggY29sb3IxLCBjb2xvcjIgKSB7CgoJCQl0aGlzLnIgPSBjb2xvcjEuciArIGNvbG9yMi5yOwoJCQl0aGlzLmcgPSBjb2xvcjEuZyArIGNvbG9yMi5nOwoJCQl0aGlzLmIgPSBjb2xvcjEuYiArIGNvbG9yMi5iOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyB0aGUgZ2l2ZW4gc2NhbGFyIHZhbHVlIHRvIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gYWRkLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWFkZFNjYWxhciggcyApIHsKCgkJCXRoaXMuciArPSBzOwoJCQl0aGlzLmcgKz0gczsKCQkJdGhpcy5iICs9IHM7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTdWJ0cmFjdHMgdGhlIFJHQiB2YWx1ZXMgb2YgdGhlIGdpdmVuIGNvbG9yIGZyb20gdGhlIFJHQiB2YWx1ZXMgb2YgdGhpcyBjb2xvci4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIHN1YnRyYWN0LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCXN1YiggY29sb3IgKSB7CgoJCQl0aGlzLnIgPSBNYXRoLm1heCggMCwgdGhpcy5yIC0gY29sb3IuciApOwoJCQl0aGlzLmcgPSBNYXRoLm1heCggMCwgdGhpcy5nIC0gY29sb3IuZyApOwoJCQl0aGlzLmIgPSBNYXRoLm1heCggMCwgdGhpcy5iIC0gY29sb3IuYiApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTXVsdGlwbGllcyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gY29sb3Igd2l0aCB0aGUgUkdCIHZhbHVlcyBvZiB0aGlzIGNvbG9yLgoJCSAqCgkJICogQHBhcmFtIHtDb2xvcn0gY29sb3IgLSBUaGUgY29sb3IgdG8gbXVsdGlwbHkuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbXVsdGlwbHkoIGNvbG9yICkgewoKCQkJdGhpcy5yICo9IGNvbG9yLnI7CgkJCXRoaXMuZyAqPSBjb2xvci5nOwoJCQl0aGlzLmIgKj0gY29sb3IuYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIE11bHRpcGxpZXMgdGhlIGdpdmVuIHNjYWxhciB2YWx1ZSB3aXRoIHRoZSBSR0IgdmFsdWVzIG9mIHRoaXMgY29sb3IuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gcyAtIFRoZSBzY2FsYXIgdG8gbXVsdGlwbHkuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCQl0aGlzLnIgKj0gczsKCQkJdGhpcy5nICo9IHM7CgkJCXRoaXMuYiAqPSBzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTGluZWFybHkgaW50ZXJwb2xhdGVzIHRoaXMgY29sb3IncyBSR0IgdmFsdWVzIHRvd2FyZCB0aGUgUkdCIHZhbHVlcyBvZiB0aGUKCQkgKiBnaXZlbiBjb2xvci4gVGhlIGFscGhhIGFyZ3VtZW50IGNhbiBiZSB0aG91Z2h0IG9mIGFzIHRoZSByYXRpbyBiZXR3ZWVuCgkJICogdGhlIHR3byBjb2xvcnMsIHdoZXJlIGAwLjBgIGlzIHRoaXMgY29sb3IgYW5kIGAxLjBgIGlzIHRoZSBmaXJzdCBhcmd1bWVudC4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNvbG9yIHRvIGNvbnZlcmdlIG9uLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbGVycCggY29sb3IsIGFscGhhICkgewoKCQkJdGhpcy5yICs9ICggY29sb3IuciAtIHRoaXMuciApICogYWxwaGE7CgkJCXRoaXMuZyArPSAoIGNvbG9yLmcgLSB0aGlzLmcgKSAqIGFscGhhOwoJCQl0aGlzLmIgKz0gKCBjb2xvci5iIC0gdGhpcy5iICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyBiZXR3ZWVuIHRoZSBnaXZlbiBjb2xvcnMgYW5kIHN0b3JlcyB0aGUgcmVzdWx0IGluIHRoaXMgaW5zdGFuY2UuCgkJICogVGhlIGFscGhhIGFyZ3VtZW50IGNhbiBiZSB0aG91Z2h0IG9mIGFzIHRoZSByYXRpbyBiZXR3ZWVuIHRoZSB0d28gY29sb3JzLCB3aGVyZSBgMC4wYAoJCSAqIGlzIHRoZSBmaXJzdCBhbmQgYDEuMGAgaXMgdGhlIHNlY29uZCBjb2xvci4KCQkgKgoJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yMSAtIFRoZSBmaXJzdCBjb2xvci4KCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvcjIgLSBUaGUgc2Vjb25kIGNvbG9yLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBpbnRlcnBvbGF0aW9uIGZhY3RvciBpbiB0aGUgY2xvc2VkIGludGVydmFsIGBbMCwxXWAuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJbGVycENvbG9ycyggY29sb3IxLCBjb2xvcjIsIGFscGhhICkgewoKCQkJdGhpcy5yID0gY29sb3IxLnIgKyAoIGNvbG9yMi5yIC0gY29sb3IxLnIgKSAqIGFscGhhOwoJCQl0aGlzLmcgPSBjb2xvcjEuZyArICggY29sb3IyLmcgLSBjb2xvcjEuZyApICogYWxwaGE7CgkJCXRoaXMuYiA9IGNvbG9yMS5iICsgKCBjb2xvcjIuYiAtIGNvbG9yMS5iICkgKiBhbHBoYTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIExpbmVhcmx5IGludGVycG9sYXRlcyB0aGlzIGNvbG9yJ3MgSFNMIHZhbHVlcyB0b3dhcmQgdGhlIEhTTCB2YWx1ZXMgb2YgdGhlCgkJICogZ2l2ZW4gY29sb3IuIEl0IGRpZmZlcnMgZnJvbSB7QGxpbmsgQ29sb3IjbGVycH0gYnkgbm90IGludGVycG9sYXRpbmcgc3RyYWlnaHQKCQkgKiBmcm9tIG9uZSBjb2xvciB0byB0aGUgb3RoZXIsIGJ1dCBpbnN0ZWFkIGdvaW5nIHRocm91Z2ggYWxsIHRoZSBodWVzIGluIGJldHdlZW4KCQkgKiB0aG9zZSB0d28gY29sb3JzLiBUaGUgYWxwaGEgYXJndW1lbnQgY2FuIGJlIHRob3VnaHQgb2YgYXMgdGhlIHJhdGlvIGJldHdlZW4KCQkgKiB0aGUgdHdvIGNvbG9ycywgd2hlcmUgMC4wIGlzIHRoaXMgY29sb3IgYW5kIDEuMCBpcyB0aGUgZmlyc3QgYXJndW1lbnQuCgkJICoKCQkgKiBAcGFyYW0ge0NvbG9yfSBjb2xvciAtIFRoZSBjb2xvciB0byBjb252ZXJnZSBvbi4KCQkgKiBAcGFyYW0ge251bWJlcn0gYWxwaGEgLSBUaGUgaW50ZXJwb2xhdGlvbiBmYWN0b3IgaW4gdGhlIGNsb3NlZCBpbnRlcnZhbCBgWzAsMV1gLgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWxlcnBIU0woIGNvbG9yLCBhbHBoYSApIHsKCgkJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoJCQljb2xvci5nZXRIU0woIF9oc2xCICk7CgoJCQljb25zdCBoID0gbGVycCggX2hzbEEuaCwgX2hzbEIuaCwgYWxwaGEgKTsKCQkJY29uc3QgcyA9IGxlcnAoIF9oc2xBLnMsIF9oc2xCLnMsIGFscGhhICk7CgkJCWNvbnN0IGwgPSBsZXJwKCBfaHNsQS5sLCBfaHNsQi5sLCBhbHBoYSApOwoKCQkJdGhpcy5zZXRIU0woIGgsIHMsIGwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGNvbG9yJ3MgUkdCIGNvbXBvbmVudHMgZnJvbSB0aGUgZ2l2ZW4gM0QgdmVjdG9yLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSB2IC0gVGhlIHZlY3RvciB0byBzZXQuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJc2V0RnJvbVZlY3RvcjMoIHYgKSB7CgoJCQl0aGlzLnIgPSB2Lng7CgkJCXRoaXMuZyA9IHYueTsKCQkJdGhpcy5iID0gdi56OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVHJhbnNmb3JtcyB0aGlzIGNvbG9yIHdpdGggdGhlIGdpdmVuIDN4MyBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDN9IG0gLSBUaGUgbWF0cml4LgoJCSAqIEByZXR1cm4ge0NvbG9yfSBBIHJlZmVyZW5jZSB0byB0aGlzIGNvbG9yLgoJCSAqLwoJCWFwcGx5TWF0cml4MyggbSApIHsKCgkJCWNvbnN0IHIgPSB0aGlzLnIsIGcgPSB0aGlzLmcsIGIgPSB0aGlzLmI7CgkJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQkJdGhpcy5yID0gZVsgMCBdICogciArIGVbIDMgXSAqIGcgKyBlWyA2IF0gKiBiOwoJCQl0aGlzLmcgPSBlWyAxIF0gKiByICsgZVsgNCBdICogZyArIGVbIDcgXSAqIGI7CgkJCXRoaXMuYiA9IGVbIDIgXSAqIHIgKyBlWyA1IF0gKiBnICsgZVsgOCBdICogYjsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgY29sb3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqCgkJICogQHBhcmFtIHtDb2xvcn0gYyAtIFRoZSBjb2xvciB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgYm91bmRpbmcgY29sb3IgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggYyApIHsKCgkJCXJldHVybiAoIGMuciA9PT0gdGhpcy5yICkgJiYgKCBjLmcgPT09IHRoaXMuZyApICYmICggYy5iID09PSB0aGlzLmIgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoaXMgY29sb3IncyBSR0IgY29tcG9uZW50cyBmcm9tIHRoZSBnaXZlbiBhcnJheS4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8bnVtYmVyPn0gYXJyYXkgLSBBbiBhcnJheSBob2xkaW5nIHRoZSBSR0IgdmFsdWVzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gVGhlIG9mZnNldCBpbnRvIHRoZSBhcnJheS4KCQkgKiBAcmV0dXJuIHtDb2xvcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBjb2xvci4KCQkgKi8KCQlmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQkJdGhpcy5yID0gYXJyYXlbIG9mZnNldCBdOwoJCQl0aGlzLmcgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCQl0aGlzLmIgPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV3JpdGVzIHRoZSBSR0IgY29tcG9uZW50cyBvZiB0aGlzIGNvbG9yIHRvIHRoZSBnaXZlbiBhcnJheS4gSWYgbm8gYXJyYXkgaXMgcHJvdmlkZWQsCgkJICogdGhlIG1ldGhvZCByZXR1cm5zIGEgbmV3IGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxudW1iZXI+fSBbYXJyYXk9W11dIC0gVGhlIHRhcmdldCBhcnJheSBob2xkaW5nIHRoZSBjb2xvciBjb21wb25lbnRzLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb2Zmc2V0PTBdIC0gSW5kZXggb2YgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIGFycmF5LgoJCSAqIEByZXR1cm4ge0FycmF5PG51bWJlcj59IFRoZSBjb2xvciBjb21wb25lbnRzLgoJCSAqLwoJCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLnI7CgkJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLmc7CgkJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLmI7CgoJCQlyZXR1cm4gYXJyYXk7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgY29tcG9uZW50cyBvZiB0aGlzIGNvbG9yIGZyb20gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgaG9sZGluZyBjb2xvciBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7Q29sb3J9IEEgcmVmZXJlbmNlIHRvIHRoaXMgY29sb3IuCgkJICovCgkJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCgkJCXRoaXMuciA9IGF0dHJpYnV0ZS5nZXRYKCBpbmRleCApOwoJCQl0aGlzLmcgPSBhdHRyaWJ1dGUuZ2V0WSggaW5kZXggKTsKCQkJdGhpcy5iID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUaGlzIG1ldGhvZHMgZGVmaW5lcyB0aGUgc2VyaWFsaXphdGlvbiByZXN1bHQgb2YgdGhpcyBjbGFzcy4gUmV0dXJucyB0aGUgY29sb3IKCQkgKiBhcyBhIGhleGFkZWNpbWFsIHZhbHVlLgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgaGV4YWRlY2ltYWwgdmFsdWUuCgkJICovCgkJdG9KU09OKCkgewoKCQkJcmV0dXJuIHRoaXMuZ2V0SGV4KCk7CgoJCX0KCgkJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCQl5aWVsZCB0aGlzLnI7CgkJCXlpZWxkIHRoaXMuZzsKCQkJeWllbGQgdGhpcy5iOwoKCQl9CgoJfQoKCWNvbnN0IF9jb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CgoJLyoqCgkgKiBBIGRpY3Rpb25hcnkgd2l0aCBYMTEgY29sb3IgbmFtZXMuCgkgKgoJICogTm90ZSB0aGF0IG11bHRpcGxlIHdvcmRzIHN1Y2ggYXMgRGFyayBPcmFuZ2UgYmVjb21lIHRoZSBzdHJpbmcgJ2RhcmtvcmFuZ2UnLgoJICoKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtPYmplY3R9CgkgKi8KCUNvbG9yLk5BTUVTID0gX2NvbG9yS2V5d29yZHM7CgoJbGV0IF9tYXRlcmlhbElkID0gMDsKCgkvKioKCSAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIG1hdGVyaWFscy4KCSAqCgkgKiBNYXRlcmlhbHMgZGVmaW5lIHRoZSBhcHBlYXJhbmNlIG9mIHJlbmRlcmFibGUgM0Qgb2JqZWN0cy4KCSAqCgkgKiBAYWJzdHJhY3QKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqLwoJY2xhc3MgTWF0ZXJpYWwgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1hdGVyaWFsLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzTWF0ZXJpYWwgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoZSBJRCBvZiB0aGUgbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEBuYW1lIE1hdGVyaWFsI2lkCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEByZWFkb25seQoJCQkgKi8KCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfbWF0ZXJpYWxJZCArKyB9ICk7CgoJCQkvKioKCQkJICogVGhlIFVVSUQgb2YgdGhlIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBAdHlwZSB7c3RyaW5nfQoJCQkgKiBAcmVhZG9ubHkKCQkJICovCgkJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQkJLyoqCgkJCSAqIFRoZSBuYW1lIG9mIHRoZSBtYXRlcmlhbC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMubmFtZSA9ICcnOwoKCQkJLyoqCgkJCSAqIFRoZSB0eXBlIHByb3BlcnR5IGlzIHVzZWQgZm9yIGRldGVjdGluZyB0aGUgb2JqZWN0IHR5cGUKCQkJICogaW4gY29udGV4dCBvZiBzZXJpYWxpemF0aW9uL2Rlc2VyaWFsaXphdGlvbi4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLnR5cGUgPSAnTWF0ZXJpYWwnOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIHR5cGUgb2YgdGhlIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBJdCBtdXN0IGJlIHNldCB0byBgQ3VzdG9tQmxlbmRpbmdgIGlmIGN1c3RvbSBibGVuZGluZyBwcm9wZXJ0aWVzIGxpa2UKCQkJICoge0BsaW5rIE1hdGVyaWFsI2JsZW5kU3JjfSwge0BsaW5rIE1hdGVyaWFsI2JsZW5kRHN0fSBvciB7QGxpbmsgTWF0ZXJpYWwjYmxlbmRFcXVhdGlvbn0KCQkJICogc2hvdWxkIGhhdmUgYW55IGVmZmVjdC4KCQkJICoKCQkJICogQHR5cGUgeyhOb0JsZW5kaW5nfE5vcm1hbEJsZW5kaW5nfEFkZGl0aXZlQmxlbmRpbmd8U3VidHJhY3RpdmVCbGVuZGluZ3xNdWx0aXBseUJsZW5kaW5nfEN1c3RvbUJsZW5kaW5nKX0KCQkJICogQGRlZmF1bHQgTm9ybWFsQmxlbmRpbmcKCQkJICovCgkJCXRoaXMuYmxlbmRpbmcgPSBOb3JtYWxCbGVuZGluZzsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHdoaWNoIHNpZGUgb2YgZmFjZXMgd2lsbCBiZSByZW5kZXJlZCAtIGZyb250LCBiYWNrIG9yIGJvdGguCgkJCSAqCgkJCSAqIEB0eXBlIHsoRnJvbnRTaWRlfEJhY2tTaWRlfERvdWJsZVNpZGUpfQoJCQkgKiBAZGVmYXVsdCBGcm9udFNpZGUKCQkJICovCgkJCXRoaXMuc2lkZSA9IEZyb250U2lkZTsKCgkJCS8qKgoJCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB2ZXJ0ZXggY29sb3JzIHNob3VsZCBiZSB1c2VkLgoJCQkgKgoJCQkgKiBUaGUgZW5naW5lIHN1cHBvcnRzIFJHQiBhbmQgUkdCQSB2ZXJ0ZXggY29sb3JzIGRlcGVuZGluZyBvbiB3aGV0aGVyIGEgdGhyZWUgKFJHQikgb3IKCQkJICogZm91ciAoUkdCQSkgY29tcG9uZW50IGNvbG9yIGJ1ZmZlciBhdHRyaWJ1dGUgaXMgdXNlZC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLnZlcnRleENvbG9ycyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgaG93IHRyYW5zcGFyZW50IHRoZSBtYXRlcmlhbCBpcy4KCQkJICogQSB2YWx1ZSBvZiBgMC4wYCBpbmRpY2F0ZXMgZnVsbHkgdHJhbnNwYXJlbnQsIGAxLjBgIGlzIGZ1bGx5IG9wYXF1ZS4KCQkJICoKCQkJICogSWYgdGhlIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gaXMgbm90IHNldCB0byBgdHJ1ZWAsCgkJCSAqIHRoZSBtYXRlcmlhbCB3aWxsIHJlbWFpbiBmdWxseSBvcGFxdWUgYW5kIHRoaXMgdmFsdWUgd2lsbCBvbmx5IGFmZmVjdCBpdHMgY29sb3IuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMub3BhY2l0eSA9IDE7CgoJCQkvKioKCQkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgaXMgdHJhbnNwYXJlbnQuIFRoaXMgaGFzIGFuIGVmZmVjdCBvbgoJCQkgKiByZW5kZXJpbmcgYXMgdHJhbnNwYXJlbnQgb2JqZWN0cyBuZWVkIHNwZWNpYWwgdHJlYXRtZW50IGFuZCBhcmUgcmVuZGVyZWQKCQkJICogYWZ0ZXIgbm9uLXRyYW5zcGFyZW50IG9iamVjdHMuCgkJCSAqCgkJCSAqIFdoZW4gc2V0IHRvIHRydWUsIHRoZSBleHRlbnQgdG8gd2hpY2ggdGhlIG1hdGVyaWFsIGlzIHRyYW5zcGFyZW50IGlzCgkJCSAqIGNvbnRyb2xsZWQgYnkge0BsaW5rIE1hdGVyaWFsI29wYWNpdHl9LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMudHJhbnNwYXJlbnQgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBFbmFibGVzIGFscGhhIGhhc2hlZCB0cmFuc3BhcmVuY3ksIGFuIGFsdGVybmF0aXZlIHRvIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3IKCQkJICoge0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uIFRoZSBtYXRlcmlhbCB3aWxsIG5vdCBiZSByZW5kZXJlZCBpZiBvcGFjaXR5IGlzIGxvd2VyIHRoYW4KCQkJICogYSByYW5kb20gdGhyZXNob2xkLiBSYW5kb21pemF0aW9uIGludHJvZHVjZXMgc29tZSBncmFpbiBvciBub2lzZSwgYnV0IGFwcHJveGltYXRlcyBhbHBoYQoJCQkgKiBibGVuZGluZyB3aXRob3V0IHRoZSBhc3NvY2lhdGVkIHByb2JsZW1zIG9mIHNvcnRpbmcuIFVzaW5nIFRBQSBjYW4gcmVkdWNlIHRoZSByZXN1bHRpbmcgbm9pc2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5hbHBoYUhhc2ggPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBzb3VyY2UgZmFjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CgkJCSAqIEBkZWZhdWx0IFNyY0FscGhhRmFjdG9yCgkJCSAqLwoJCQl0aGlzLmJsZW5kU3JjID0gU3JjQWxwaGFGYWN0b3I7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZGVzdGluYXRpb24gZmFjdG9yLgoJCQkgKgoJCQkgKiBAdHlwZSB7KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CgkJCSAqIEBkZWZhdWx0IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IKCQkJICovCgkJCXRoaXMuYmxlbmREc3QgPSBPbmVNaW51c1NyY0FscGhhRmFjdG9yOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGJsZW5kaW5nIGVxdWF0aW9uLgoJCQkgKgoJCQkgKiBAdHlwZSB7KEFkZEVxdWF0aW9ufFN1YnRyYWN0RXF1YXRpb258UmV2ZXJzZVN1YnRyYWN0RXF1YXRpb258TWluRXF1YXRpb258TWF4RXF1YXRpb24pfQoJCQkgKiBAZGVmYXVsdCBBZGRFcXVhdGlvbgoJCQkgKi8KCQkJdGhpcy5ibGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgc291cmNlIGFscGhhIGZhY3Rvci4KCQkJICoKCQkJICogQHR5cGUgez8oWmVyb0ZhY3RvcnxPbmVGYWN0b3J8U3JjQ29sb3JGYWN0b3J8T25lTWludXNTcmNDb2xvckZhY3RvcnxTcmNBbHBoYUZhY3RvcnxPbmVNaW51c1NyY0FscGhhRmFjdG9yfERzdEFscGhhRmFjdG9yfE9uZU1pbnVzRHN0QWxwaGFGYWN0b3J8RHN0Q29sb3JGYWN0b3J8T25lTWludXNEc3RDb2xvckZhY3RvcnxTcmNBbHBoYVNhdHVyYXRlRmFjdG9yfENvbnN0YW50Q29sb3JGYWN0b3J8T25lTWludXNDb25zdGFudENvbG9yRmFjdG9yfENvbnN0YW50QWxwaGFGYWN0b3J8T25lTWludXNDb25zdGFudEFscGhhRmFjdG9yKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5ibGVuZFNyY0FscGhhID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHRoZSBibGVuZGluZyBkZXN0aW5hdGlvbiBhbHBoYSBmYWN0b3IuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KFplcm9GYWN0b3J8T25lRmFjdG9yfFNyY0NvbG9yRmFjdG9yfE9uZU1pbnVzU3JjQ29sb3JGYWN0b3J8U3JjQWxwaGFGYWN0b3J8T25lTWludXNTcmNBbHBoYUZhY3RvcnxEc3RBbHBoYUZhY3RvcnxPbmVNaW51c0RzdEFscGhhRmFjdG9yfERzdENvbG9yRmFjdG9yfE9uZU1pbnVzRHN0Q29sb3JGYWN0b3J8U3JjQWxwaGFTYXR1cmF0ZUZhY3RvcnxDb25zdGFudENvbG9yRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRDb2xvckZhY3RvcnxDb25zdGFudEFscGhhRmFjdG9yfE9uZU1pbnVzQ29uc3RhbnRBbHBoYUZhY3Rvcil9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYmxlbmREc3RBbHBoYSA9IG51bGw7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgYmxlbmRpbmcgZXF1YXRpb24gb2YgdGhlIGFscGhhIGNoYW5uZWwuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KEFkZEVxdWF0aW9ufFN1YnRyYWN0RXF1YXRpb258UmV2ZXJzZVN1YnRyYWN0RXF1YXRpb258TWluRXF1YXRpb258TWF4RXF1YXRpb24pfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CgoJCQkvKioKCQkJICogUmVwcmVzZW50cyB0aGUgUkdCIHZhbHVlcyBvZiB0aGUgY29uc3RhbnQgYmxlbmQgY29sb3IuCgkJCSAqCgkJCSAqIFRoaXMgcHJvcGVydHkgaGFzIG9ubHkgYW4gZWZmZWN0IHdoZW4gdXNpbmcgY3VzdG9tIGJsZW5kaW5nIHdpdGggYENvbnN0YW50Q29sb3JgIG9yIGBPbmVNaW51c0NvbnN0YW50Q29sb3JgLgoJCQkgKgoJCQkgKiBAdHlwZSB7Q29sb3J9CgkJCSAqIEBkZWZhdWx0ICgwLDAsMCkKCQkJICovCgkJCXRoaXMuYmxlbmRDb2xvciA9IG5ldyBDb2xvciggMCwgMCwgMCApOwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIGFscGhhIHZhbHVlIG9mIHRoZSBjb25zdGFudCBibGVuZCBjb2xvci4KCQkJICoKCQkJICogVGhpcyBwcm9wZXJ0eSBoYXMgb25seSBhbiBlZmZlY3Qgd2hlbiB1c2luZyBjdXN0b20gYmxlbmRpbmcgd2l0aCBgQ29uc3RhbnRBbHBoYWAgb3IgYE9uZU1pbnVzQ29uc3RhbnRBbHBoYWAuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMuYmxlbmRBbHBoYSA9IDA7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgZGVwdGggZnVuY3Rpb24uCgkJCSAqCgkJCSAqIEB0eXBlIHsoTmV2ZXJEZXB0aHxBbHdheXNEZXB0aHxMZXNzRGVwdGh8TGVzc0VxdWFsRGVwdGh8RXF1YWxEZXB0aHxHcmVhdGVyRXF1YWxEZXB0aHxHcmVhdGVyRGVwdGh8Tm90RXF1YWxEZXB0aCl9CgkJCSAqIEBkZWZhdWx0IExlc3NFcXVhbERlcHRoCgkJCSAqLwoJCQl0aGlzLmRlcHRoRnVuYyA9IExlc3NFcXVhbERlcHRoOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gaGF2ZSBkZXB0aCB0ZXN0IGVuYWJsZWQgd2hlbiByZW5kZXJpbmcgdGhpcyBtYXRlcmlhbC4KCQkJICogV2hlbiB0aGUgZGVwdGggdGVzdCBpcyBkaXNhYmxlZCwgdGhlIGRlcHRoIHdyaXRlIHdpbGwgYWxzbyBiZSBpbXBsaWNpdGx5IGRpc2FibGVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5kZXB0aFRlc3QgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgcmVuZGVyaW5nIHRoaXMgbWF0ZXJpYWwgaGFzIGFueSBlZmZlY3Qgb24gdGhlIGRlcHRoIGJ1ZmZlci4KCQkJICoKCQkJICogV2hlbiBkcmF3aW5nIDJEIG92ZXJsYXlzIGl0IGNhbiBiZSB1c2VmdWwgdG8gZGlzYWJsZSB0aGUgZGVwdGggd3JpdGluZyBpbgoJCQkgKiBvcmRlciB0byBsYXllciBzZXZlcmFsIHRoaW5ncyB0b2dldGhlciB3aXRob3V0IGNyZWF0aW5nIHotaW5kZXggYXJ0aWZhY3RzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5kZXB0aFdyaXRlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBUaGUgYml0IG1hc2sgdG8gdXNlIHdoZW4gd3JpdGluZyB0byB0aGUgc3RlbmNpbCBidWZmZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDB4ZmYKCQkJICovCgkJCXRoaXMuc3RlbmNpbFdyaXRlTWFzayA9IDB4ZmY7CgoJCQkvKioKCQkJICogVGhlIHN0ZW5jaWwgY29tcGFyaXNvbiBmdW5jdGlvbiB0byB1c2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtOZXZlclN0ZW5jaWxGdW5jfExlc3NTdGVuY2lsRnVuY3xFcXVhbFN0ZW5jaWxGdW5jfExlc3NFcXVhbFN0ZW5jaWxGdW5jfEdyZWF0ZXJTdGVuY2lsRnVuY3xOb3RFcXVhbFN0ZW5jaWxGdW5jfEdyZWF0ZXJFcXVhbFN0ZW5jaWxGdW5jfEFsd2F5c1N0ZW5jaWxGdW5jfQoJCQkgKiBAZGVmYXVsdCBBbHdheXNTdGVuY2lsRnVuYwoJCQkgKi8KCQkJdGhpcy5zdGVuY2lsRnVuYyA9IEFsd2F5c1N0ZW5jaWxGdW5jOwoKCQkJLyoqCgkJCSAqIFRoZSB2YWx1ZSB0byB1c2Ugd2hlbiBwZXJmb3JtaW5nIHN0ZW5jaWwgY29tcGFyaXNvbnMgb3Igc3RlbmNpbCBvcGVyYXRpb25zLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxSZWYgPSAwOwoKCQkJLyoqCgkJCSAqIFRoZSBiaXQgbWFzayB0byB1c2Ugd2hlbiBjb21wYXJpbmcgYWdhaW5zdCB0aGUgc3RlbmNpbCBidWZmZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDB4ZmYKCQkJICovCgkJCXRoaXMuc3RlbmNpbEZ1bmNNYXNrID0gMHhmZjsKCgkJCS8qKgoJCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucyBgZmFsc2VgLgoJCQkgKgoJCQkgKiBAdHlwZSB7WmVyb1N0ZW5jaWxPcHxLZWVwU3RlbmNpbE9wfFJlcGxhY2VTdGVuY2lsT3B8SW5jcmVtZW50U3RlbmNpbE9wfERlY3JlbWVudFN0ZW5jaWxPcHxJbmNyZW1lbnRXcmFwU3RlbmNpbE9wfERlY3JlbWVudFdyYXBTdGVuY2lsT3B8SW52ZXJ0U3RlbmNpbE9wfQoJCQkgKiBAZGVmYXVsdCBLZWVwU3RlbmNpbE9wCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxGYWlsID0gS2VlcFN0ZW5jaWxPcDsKCgkJCS8qKgoJCQkgKiBXaGljaCBzdGVuY2lsIG9wZXJhdGlvbiB0byBwZXJmb3JtIHdoZW4gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24gcmV0dXJucwoJCQkgKiBgdHJ1ZWAgYnV0IHRoZSBkZXB0aCB0ZXN0IGZhaWxzLgoJCQkgKgoJCQkgKiBAdHlwZSB7WmVyb1N0ZW5jaWxPcHxLZWVwU3RlbmNpbE9wfFJlcGxhY2VTdGVuY2lsT3B8SW5jcmVtZW50U3RlbmNpbE9wfERlY3JlbWVudFN0ZW5jaWxPcHxJbmNyZW1lbnRXcmFwU3RlbmNpbE9wfERlY3JlbWVudFdyYXBTdGVuY2lsT3B8SW52ZXJ0U3RlbmNpbE9wfQoJCQkgKiBAZGVmYXVsdCBLZWVwU3RlbmNpbE9wCgkJCSAqLwoJCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IEtlZXBTdGVuY2lsT3A7CgoJCQkvKioKCQkJICogV2hpY2ggc3RlbmNpbCBvcGVyYXRpb24gdG8gcGVyZm9ybSB3aGVuIHRoZSBjb21wYXJpc29uIGZ1bmN0aW9uIHJldHVybnMKCQkJICogYHRydWVgIGFuZCB0aGUgZGVwdGggdGVzdCBwYXNzZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtaZXJvU3RlbmNpbE9wfEtlZXBTdGVuY2lsT3B8UmVwbGFjZVN0ZW5jaWxPcHxJbmNyZW1lbnRTdGVuY2lsT3B8RGVjcmVtZW50U3RlbmNpbE9wfEluY3JlbWVudFdyYXBTdGVuY2lsT3B8RGVjcmVtZW50V3JhcFN0ZW5jaWxPcHxJbnZlcnRTdGVuY2lsT3B9CgkJCSAqIEBkZWZhdWx0IEtlZXBTdGVuY2lsT3AKCQkJICovCgkJCXRoaXMuc3RlbmNpbFpQYXNzID0gS2VlcFN0ZW5jaWxPcDsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHN0ZW5jaWwgb3BlcmF0aW9ucyBhcmUgcGVyZm9ybWVkIGFnYWluc3QgdGhlIHN0ZW5jaWwgYnVmZmVyLiBJbgoJCQkgKiBvcmRlciB0byBwZXJmb3JtIHdyaXRlcyBvciBjb21wYXJpc29ucyBhZ2FpbnN0IHRoZSBzdGVuY2lsIGJ1ZmZlciB0aGlzCgkJCSAqIHZhbHVlIG11c3QgYmUgYHRydWVgLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuc3RlbmNpbFdyaXRlID0gZmFsc2U7CgoJCQkvKioKCQkJICogVXNlci1kZWZpbmVkIGNsaXBwaW5nIHBsYW5lcyBzcGVjaWZpZWQgYXMgVEhSRUUuUGxhbmUgb2JqZWN0cyBpbiB3b3JsZAoJCQkgKiBzcGFjZS4gVGhlc2UgcGxhbmVzIGFwcGx5IHRvIHRoZSBvYmplY3RzIHRoaXMgbWF0ZXJpYWwgaXMgYXR0YWNoZWQgdG8uCgkJCSAqIFBvaW50cyBpbiBzcGFjZSB3aG9zZSBzaWduZWQgZGlzdGFuY2UgdG8gdGhlIHBsYW5lIGlzIG5lZ2F0aXZlIGFyZSBjbGlwcGVkCgkJCSAqIChub3QgcmVuZGVyZWQpLiBUaGlzIHJlcXVpcmVzIHtAbGluayBXZWJHTFJlbmRlcmVyI2xvY2FsQ2xpcHBpbmdFbmFibGVkfSB0bwoJCQkgKiBiZSBgdHJ1ZWAuCgkJCSAqCgkJCSAqIEB0eXBlIHs/QXJyYXk8UGxhbmU+fQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBDaGFuZ2VzIHRoZSBiZWhhdmlvciBvZiBjbGlwcGluZyBwbGFuZXMgc28gdGhhdCBvbmx5IHRoZWlyIGludGVyc2VjdGlvbiBpcwoJCQkgKiBjbGlwcGVkLCByYXRoZXIgdGhhbiB0aGVpciB1bmlvbi4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmNsaXBJbnRlcnNlY3Rpb24gPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHdoZXRoZXIgdG8gY2xpcCBzaGFkb3dzIGFjY29yZGluZyB0byB0aGUgY2xpcHBpbmcgcGxhbmVzIHNwZWNpZmllZAoJCQkgKiBvbiB0aGlzIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuY2xpcFNoYWRvd3MgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHdoaWNoIHNpZGUgb2YgZmFjZXMgY2FzdCBzaGFkb3dzLiBJZiBgbnVsbGAsIHRoZSBzaWRlIGNhc3Rpbmcgc2hhZG93cwoJCQkgKiBpcyBkZXRlcm1pbmVkIGFzIGZvbGxvd3M6CgkJCSAqCgkJCSAqIC0gV2hlbiB7QGxpbmsgTWF0ZXJpYWwjc2lkZX0gaXMgc2V0IHRvIGBGcm9udFNpZGVgLCB0aGUgYmFjayBzaWRlIGNhc3Qgc2hhZG93cy4KCQkJICogLSBXaGVuIHtAbGluayBNYXRlcmlhbCNzaWRlfSBpcyBzZXQgdG8gYEJhY2tTaWRlYCwgdGhlIGZyb250IHNpZGUgY2FzdCBzaGFkb3dzLgoJCQkgKiAtIFdoZW4ge0BsaW5rIE1hdGVyaWFsI3NpZGV9IGlzIHNldCB0byBgRG91YmxlU2lkZWAsIGJvdGggc2lkZXMgY2FzdCBzaGFkb3dzLgoJCQkgKgoJCQkgKiBAdHlwZSB7PyhGcm9udFNpZGV8QmFja1NpZGV8RG91YmxlU2lkZSl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuc2hhZG93U2lkZSA9IG51bGw7CgoJCQkvKioKCQkJICogV2hldGhlciB0byByZW5kZXIgdGhlIG1hdGVyaWFsJ3MgY29sb3IuCgkJCSAqCgkJCSAqIFRoaXMgY2FuIGJlIHVzZWQgaW4gY29uanVuY3Rpb24gd2l0aCB7QGxpbmsgT2JqZWN0M0QjcmVuZGVyT2Rlcn0gdG8gY3JlYXRlIGludmlzaWJsZQoJCQkgKiBvYmplY3RzIHRoYXQgb2NjbHVkZSBvdGhlciBvYmplY3RzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5jb2xvcldyaXRlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBPdmVycmlkZSB0aGUgcmVuZGVyZXIncyBkZWZhdWx0IHByZWNpc2lvbiBmb3IgdGhpcyBtYXRlcmlhbC4KCQkJICoKCQkJICogQHR5cGUgez8oJ2hpZ2hwJ3wnbWVkaXVtcCd8J2xvd3AnKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5wcmVjaXNpb24gPSBudWxsOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gdXNlIHBvbHlnb24gb2Zmc2V0IG9yIG5vdC4gV2hlbiBlbmFibGVkLCBlYWNoIGZyYWdtZW50J3MgZGVwdGggdmFsdWUgd2lsbAoJCQkgKiBiZSBvZmZzZXQgYWZ0ZXIgaXQgaXMgaW50ZXJwb2xhdGVkIGZyb20gdGhlIGRlcHRoIHZhbHVlcyBvZiB0aGUgYXBwcm9wcmlhdGUgdmVydGljZXMuCgkJCSAqIFRoZSBvZmZzZXQgaXMgYWRkZWQgYmVmb3JlIHRoZSBkZXB0aCB0ZXN0IGlzIHBlcmZvcm1lZCBhbmQgYmVmb3JlIHRoZSB2YWx1ZSBpcyB3cml0dGVuCgkJCSAqIGludG8gdGhlIGRlcHRoIGJ1ZmZlci4KCQkJICoKCQkJICogQ2FuIGJlIHVzZWZ1bCBmb3IgcmVuZGVyaW5nIGhpZGRlbi1saW5lIGltYWdlcywgZm9yIGFwcGx5aW5nIGRlY2FscyB0byBzdXJmYWNlcywgYW5kIGZvcgoJCQkgKiByZW5kZXJpbmcgc29saWRzIHdpdGggaGlnaGxpZ2h0ZWQgZWRnZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gZmFsc2U7CgoJCQkvKioKCQkJICogU3BlY2lmaWVzIGEgc2NhbGUgZmFjdG9yIHRoYXQgaXMgdXNlZCB0byBjcmVhdGUgYSB2YXJpYWJsZSBkZXB0aCBvZmZzZXQgZm9yIGVhY2ggcG9seWdvbi4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gMDsKCgkJCS8qKgoJCQkgKiBJcyBtdWx0aXBsaWVkIGJ5IGFuIGltcGxlbWVudGF0aW9uLXNwZWNpZmljIHZhbHVlIHRvIGNyZWF0ZSBhIGNvbnN0YW50IGRlcHRoIG9mZnNldC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgPSAwOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdG8gYXBwbHkgZGl0aGVyaW5nIHRvIHRoZSBjb2xvciB0byByZW1vdmUgdGhlIGFwcGVhcmFuY2Ugb2YgYmFuZGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmRpdGhlcmluZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgYWxwaGEgdG8gY292ZXJhZ2Ugc2hvdWxkIGJlIGVuYWJsZWQgb3Igbm90LiBDYW4gb25seSBiZSB1c2VkIHdpdGggTVNBQS1lbmFibGVkIGNvbnRleHRzCgkJCSAqIChtZWFuaW5nIHdoZW4gdGhlIHJlbmRlcmVyIHdhcyBjcmVhdGVkIHdpdGggKmFudGlhbGlhcyogcGFyYW1ldGVyIHNldCB0byBgdHJ1ZWApLiBFbmFibGluZyB0aGlzCgkJCSAqIHdpbGwgc21vb3RoIGFsaWFzaW5nIG9uIGNsaXAgcGxhbmUgZWRnZXMgYW5kIGFscGhhVGVzdC1jbGlwcGVkIGVkZ2VzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuYWxwaGFUb0NvdmVyYWdlID0gZmFsc2U7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBwcmVtdWx0aXBseSB0aGUgYWxwaGEgKHRyYW5zcGFyZW5jeSkgdmFsdWUuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIGRvdWJsZS1zaWRlZCwgdHJhbnNwYXJlbnQgb2JqZWN0cyBzaG91bGQgYmUgcmVuZGVyZWQgd2l0aCBhIHNpbmdsZSBwYXNzIG9yIG5vdC4KCQkJICoKCQkJICogVGhlIGVuZ2luZSByZW5kZXJzIGRvdWJsZS1zaWRlZCwgdHJhbnNwYXJlbnQgb2JqZWN0cyB3aXRoIHR3byBkcmF3IGNhbGxzIChiYWNrIGZhY2VzIGZpcnN0LAoJCQkgKiB0aGVuIGZyb250IGZhY2VzKSB0byBtaXRpZ2F0ZSB0cmFuc3BhcmVuY3kgYXJ0aWZhY3RzLiBUaGVyZSBhcmUgc2NlbmFyaW9zIGhvd2V2ZXIgd2hlcmUgdGhpcwoJCQkgKiBhcHByb2FjaCBwcm9kdWNlcyBubyBxdWFsaXR5IGdhaW5zIGJ1dCBzdGlsbCBkb3VibGVzIGRyYXcgY2FsbHMgZS5nLiB3aGVuIHJlbmRlcmluZyBmbGF0CgkJCSAqIHZlZ2V0YXRpb24gbGlrZSBncmFzcyBzcHJpdGVzLiBJbiB0aGVzZSBjYXNlcywgc2V0IHRoZSBgZm9yY2VTaW5nbGVQYXNzYCBmbGFnIHRvIGB0cnVlYCB0bwoJCQkgKiBkaXNhYmxlIHRoZSB0d28gcGFzcyByZW5kZXJpbmcgdG8gYXZvaWQgcGVyZm9ybWFuY2UgaXNzdWVzLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gZmFsc2U7CgoJCQkvKioKCQkJICogV2hldGhlciBpdCdzIHBvc3NpYmxlIHRvIG92ZXJyaWRlIHRoZSBtYXRlcmlhbCB3aXRoIHtAbGluayBTY2VuZSNvdmVycmlkZU1hdGVyaWFsfSBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmFsbG93T3ZlcnJpZGUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgd2hldGhlciAzRCBvYmplY3RzIHVzaW5nIHRoaXMgbWF0ZXJpYWwgYXJlIHZpc2libGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLnZpc2libGUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIGlzIHRvbmUgbWFwcGVkIGFjY29yZGluZyB0byB0aGUgcmVuZGVyZXIncyB0b25lIG1hcHBpbmcgc2V0dGluZy4KCQkJICoKCQkJICogSXQgaXMgaWdub3JlZCB3aGVuIHJlbmRlcmluZyB0byBhIHJlbmRlciB0YXJnZXQgb3IgdXNpbmcgcG9zdCBwcm9jZXNzaW5nIG9yIHdoZW4gdXNpbmcKCQkJICogYFdlYkdQVVJlbmRlcmVyYC4gSW4gYWxsIHRoZXNlIGNhc2VzLCBhbGwgbWF0ZXJpYWxzIGFyZSBob25vcmVkIGJ5IHRvbmUgbWFwcGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMudG9uZU1hcHBlZCA9IHRydWU7CgoJCQkvKioKCQkJICogQW4gb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gc3RvcmUgY3VzdG9tIGRhdGEgYWJvdXQgdGhlIE1hdGVyaWFsLiBJdAoJCQkgKiBzaG91bGQgbm90IGhvbGQgcmVmZXJlbmNlcyB0byBmdW5jdGlvbnMgYXMgdGhlc2Ugd2lsbCBub3QgYmUgY2xvbmVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkgKi8KCQkJdGhpcy51c2VyRGF0YSA9IHt9OwoKCQkJLyoqCgkJCSAqIFRoaXMgc3RhcnRzIGF0IGAwYCBhbmQgY291bnRzIGhvdyBtYW55IHRpbWVzIHtAbGluayBNYXRlcmlhbCNuZWVkc1VwZGF0ZX0gaXMgc2V0IHRvIGB0cnVlYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMudmVyc2lvbiA9IDA7CgoJCQl0aGlzLl9hbHBoYVRlc3QgPSAwOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGFscGhhIHZhbHVlIHRvIGJlIHVzZWQgd2hlbiBydW5uaW5nIGFuIGFscGhhIHRlc3QuIFRoZSBtYXRlcmlhbAoJCSAqIHdpbGwgbm90IGJlIHJlbmRlcmVkIGlmIHRoZSBvcGFjaXR5IGlzIGxvd2VyIHRoYW4gdGhpcyB2YWx1ZS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQHJlYWRvbmx5CgkJICogQGRlZmF1bHQgMAoJCSAqLwoJCWdldCBhbHBoYVRlc3QoKSB7CgoJCQlyZXR1cm4gdGhpcy5fYWxwaGFUZXN0OwoKCQl9CgoJCXNldCBhbHBoYVRlc3QoIHZhbHVlICkgewoKCQkJaWYgKCB0aGlzLl9hbHBoYVRlc3QgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgoJCQkJdGhpcy52ZXJzaW9uICsrOwoKCQkJfQoKCQkJdGhpcy5fYWxwaGFUZXN0ID0gdmFsdWU7CgoJCX0KCgkJLyoqCgkJICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIG1hdGVyaWFsIGlzIHVzZWQgdG8gcmVuZGVyIGEgM0Qgb2JqZWN0LgoJCSAqCgkJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtTY2VuZX0gc2NlbmUgLSBUaGUgc2NlbmUuCgkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEgdGhhdCBpcyB1c2VkIHRvIHJlbmRlciB0aGUgc2NlbmUuCgkJICogQHBhcmFtIHtCdWZmZXJHZW9tZXRyeX0gZ2VvbWV0cnkgLSBUaGUgM0Qgb2JqZWN0J3MgZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtPYmplY3QzRH0gb2JqZWN0IC0gVGhlIDNEIG9iamVjdC4KCQkgKiBAcGFyYW0ge09iamVjdH0gZ3JvdXAgLSBUaGUgZ2VvbWV0cnkgZ3JvdXAgZGF0YS4KCQkgKi8KCQlvbkJlZm9yZVJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICovICkge30KCgkJLyoqCgkJICogQW4gb3B0aW9uYWwgY2FsbGJhY2sgdGhhdCBpcyBleGVjdXRlZCBpbW1lZGlhdGVseSBiZWZvcmUgdGhlIHNoYWRlcgoJCSAqIHByb2dyYW0gaXMgY29tcGlsZWQuIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHdpdGggdGhlIHNoYWRlciBzb3VyY2UgY29kZQoJCSAqIGFzIGEgcGFyYW1ldGVyLiBVc2VmdWwgZm9yIHRoZSBtb2RpZmljYXRpb24gb2YgYnVpbHQtaW4gbWF0ZXJpYWxzLgoJCSAqCgkJICogVGhpcyBtZXRob2QgY2FuIG9ubHkgYmUgdXNlZCB3aGVuIHJlbmRlcmluZyB3aXRoIHtAbGluayBXZWJHTFJlbmRlcmVyfS4gVGhlCgkJICogcmVjb21tZW5kZWQgYXBwcm9hY2ggd2hlbiBjdXN0b21pemluZyBtYXRlcmlhbHMgaXMgdG8gdXNlIGBXZWJHUFVSZW5kZXJlcmAgd2l0aCB0aGUgbmV3CgkJICogTm9kZSBNYXRlcmlhbCBzeXN0ZW0gYW5kIFtUU0xde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvd2lraS9UaHJlZS5qcy1TaGFkaW5nLUxhbmd1YWdlfS4KCQkgKgoJCSAqIEBwYXJhbSB7e3ZlcnRleFNoYWRlcjpzdHJpbmcsZnJhZ21lbnRTaGFkZXI6c3RyaW5nLHVuaWZvcm1zOk9iamVjdH19IHNoYWRlcm9iamVjdCAtIFRoZSBvYmplY3QgaG9sZHMgdGhlIHVuaWZvcm1zIGFuZCB0aGUgdmVydGV4IGFuZCBmcmFnbWVudCBzaGFkZXIgc291cmNlLgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBBIHJlZmVyZW5jZSB0byB0aGUgcmVuZGVyZXIuCgkJICovCgkJb25CZWZvcmVDb21waWxlKCAvKiBzaGFkZXJvYmplY3QsIHJlbmRlcmVyICovICkge30KCgkJLyoqCgkJICogSW4gY2FzZSB7QGxpbmsgTWF0ZXJpYWwjb25CZWZvcmVDb21waWxlfSBpcyB1c2VkLCB0aGlzIGNhbGxiYWNrIGNhbiBiZSB1c2VkIHRvIGlkZW50aWZ5CgkJICogdmFsdWVzIG9mIHNldHRpbmdzIHVzZWQgaW4gYG9uQmVmb3JlQ29tcGlsZSgpYCwgc28gdGhyZWUuanMgY2FuIHJldXNlIGEgY2FjaGVkCgkJICogc2hhZGVyIG9yIHJlY29tcGlsZSB0aGUgc2hhZGVyIGZvciB0aGlzIG1hdGVyaWFsIGFzIG5lZWRlZC4KCQkgKgoJCSAqIFRoaXMgbWV0aG9kIGNhbiBvbmx5IGJlIHVzZWQgd2hlbiByZW5kZXJpbmcgd2l0aCB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkJICoKCQkgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBjdXN0b20gcHJvZ3JhbSBjYWNoZSBrZXkuCgkJICovCgkJY3VzdG9tUHJvZ3JhbUNhY2hlS2V5KCkgewoKCQkJcmV0dXJuIHRoaXMub25CZWZvcmVDb21waWxlLnRvU3RyaW5nKCk7CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgdG8gc2V0IGRlZmF1bHQgdmFsdWVzIGZyb20gcGFyYW1ldGVyIG9iamVjdHMuCgkJICogSXQgaXMgYSBnZW5lcmljIGltcGxlbWVudGF0aW9uIHNvIGl0IGNhbiBiZSB1c2VkIHdpdGggZGlmZmVyZW50IHR5cGVzCgkJICogb2YgbWF0ZXJpYWxzLgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IFt2YWx1ZXNdIC0gVGhlIG1hdGVyaWFsIHZhbHVlcyB0byBzZXQuCgkJICovCgkJc2V0VmFsdWVzKCB2YWx1ZXMgKSB7CgoJCQlpZiAoIHZhbHVlcyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJZm9yICggY29uc3Qga2V5IGluIHZhbHVlcyApIHsKCgkJCQljb25zdCBuZXdWYWx1ZSA9IHZhbHVlc1sga2V5IF07CgoJCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oIGBUSFJFRS5NYXRlcmlhbDogcGFyYW1ldGVyICckeyBrZXkgfScgaGFzIHZhbHVlIG9mIHVuZGVmaW5lZC5gICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWNvbnN0IGN1cnJlbnRWYWx1ZSA9IHRoaXNbIGtleSBdOwoKCQkJCWlmICggY3VycmVudFZhbHVlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk1hdGVyaWFsOiAnJHsga2V5IH0nIGlzIG5vdCBhIHByb3BlcnR5IG9mIFRIUkVFLiR7IHRoaXMudHlwZSB9LmAgKTsKCQkJCQljb250aW51ZTsKCgkJCQl9CgoJCQkJaWYgKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5zZXQoIG5ld1ZhbHVlICk7CgoJCQkJfSBlbHNlIGlmICggKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzVmVjdG9yMyApICYmICggbmV3VmFsdWUgJiYgbmV3VmFsdWUuaXNWZWN0b3IzICkgKSB7CgoJCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXNbIGtleSBdID0gbmV3VmFsdWU7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFNlcmlhbGl6ZXMgdGhlIG1hdGVyaWFsIGludG8gSlNPTi4KCQkgKgoJCSAqIEBwYXJhbSB7PyhPYmplY3R8c3RyaW5nKX0gbWV0YSAtIEFuIG9wdGlvbmFsIHZhbHVlIGhvbGRpbmcgbWV0YSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc2VyaWFsaXphdGlvbi4KCQkgKiBAcmV0dXJuIHtPYmplY3R9IEEgSlNPTiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzZXJpYWxpemVkIG1hdGVyaWFsLgoJCSAqIEBzZWUge0BsaW5rIE9iamVjdExvYWRlciNwYXJzZX0KCQkgKi8KCQl0b0pTT04oIG1ldGEgKSB7CgoJCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJCW1ldGEgPSB7CgkJCQkJdGV4dHVyZXM6IHt9LAoJCQkJCWltYWdlczoge30KCQkJCX07CgoJCQl9CgoJCQljb25zdCBkYXRhID0gewoJCQkJbWV0YWRhdGE6IHsKCQkJCQl2ZXJzaW9uOiA0LjcsCgkJCQkJdHlwZTogJ01hdGVyaWFsJywKCQkJCQlnZW5lcmF0b3I6ICdNYXRlcmlhbC50b0pTT04nCgkJCQl9CgkJCX07CgoJCQkvLyBzdGFuZGFyZCBNYXRlcmlhbCBzZXJpYWxpemF0aW9uCgkJCWRhdGEudXVpZCA9IHRoaXMudXVpZDsKCQkJZGF0YS50eXBlID0gdGhpcy50eXBlOwoKCQkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoKCQkJaWYgKCB0aGlzLmNvbG9yICYmIHRoaXMuY29sb3IuaXNDb2xvciApIGRhdGEuY29sb3IgPSB0aGlzLmNvbG9yLmdldEhleCgpOwoKCQkJaWYgKCB0aGlzLnJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5yb3VnaG5lc3MgPSB0aGlzLnJvdWdobmVzczsKCQkJaWYgKCB0aGlzLm1ldGFsbmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5tZXRhbG5lc3MgPSB0aGlzLm1ldGFsbmVzczsKCgkJCWlmICggdGhpcy5zaGVlbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaGVlbiA9IHRoaXMuc2hlZW47CgkJCWlmICggdGhpcy5zaGVlbkNvbG9yICYmIHRoaXMuc2hlZW5Db2xvci5pc0NvbG9yICkgZGF0YS5zaGVlbkNvbG9yID0gdGhpcy5zaGVlbkNvbG9yLmdldEhleCgpOwoJCQlpZiAoIHRoaXMuc2hlZW5Sb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hlZW5Sb3VnaG5lc3MgPSB0aGlzLnNoZWVuUm91Z2huZXNzOwoJCQlpZiAoIHRoaXMuZW1pc3NpdmUgJiYgdGhpcy5lbWlzc2l2ZS5pc0NvbG9yICkgZGF0YS5lbWlzc2l2ZSA9IHRoaXMuZW1pc3NpdmUuZ2V0SGV4KCk7CgkJCWlmICggdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAhPT0gdW5kZWZpbmVkICYmIHRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgIT09IDEgKSBkYXRhLmVtaXNzaXZlSW50ZW5zaXR5ID0gdGhpcy5lbWlzc2l2ZUludGVuc2l0eTsKCgkJCWlmICggdGhpcy5zcGVjdWxhciAmJiB0aGlzLnNwZWN1bGFyLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyID0gdGhpcy5zcGVjdWxhci5nZXRIZXgoKTsKCQkJaWYgKCB0aGlzLnNwZWN1bGFySW50ZW5zaXR5ICE9PSB1bmRlZmluZWQgKSBkYXRhLnNwZWN1bGFySW50ZW5zaXR5ID0gdGhpcy5zcGVjdWxhckludGVuc2l0eTsKCQkJaWYgKCB0aGlzLnNwZWN1bGFyQ29sb3IgJiYgdGhpcy5zcGVjdWxhckNvbG9yLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyQ29sb3IgPSB0aGlzLnNwZWN1bGFyQ29sb3IuZ2V0SGV4KCk7CgkJCWlmICggdGhpcy5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hpbmluZXNzID0gdGhpcy5zaGluaW5lc3M7CgkJCWlmICggdGhpcy5jbGVhcmNvYXQgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0ID0gdGhpcy5jbGVhcmNvYXQ7CgkJCWlmICggdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuY2xlYXJjb2F0Um91Z2huZXNzID0gdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3M7CgoJCQlpZiAoIHRoaXMuY2xlYXJjb2F0TWFwICYmIHRoaXMuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmNsZWFyY29hdE1hcCA9IHRoaXMuY2xlYXJjb2F0TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwICYmIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwICYmIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmNsZWFyY29hdE5vcm1hbE1hcCA9IHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLmNsZWFyY29hdE5vcm1hbFNjYWxlID0gdGhpcy5jbGVhcmNvYXROb3JtYWxTY2FsZS50b0FycmF5KCk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuZGlzcGVyc2lvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS5kaXNwZXJzaW9uID0gdGhpcy5kaXNwZXJzaW9uOwoKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlID0gdGhpcy5pcmlkZXNjZW5jZTsKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlSU9SICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlSU9SID0gdGhpcy5pcmlkZXNjZW5jZUlPUjsKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UgIT09IHVuZGVmaW5lZCApIGRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZTsKCgkJCWlmICggdGhpcy5pcmlkZXNjZW5jZU1hcCAmJiB0aGlzLmlyaWRlc2NlbmNlTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmlyaWRlc2NlbmNlTWFwID0gdGhpcy5pcmlkZXNjZW5jZU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICYmIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAuaXNUZXh0dXJlICkgewoKCQkJCWRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPSB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCQl9CgoJCQlpZiAoIHRoaXMuYW5pc290cm9weSAhPT0gdW5kZWZpbmVkICkgZGF0YS5hbmlzb3Ryb3B5ID0gdGhpcy5hbmlzb3Ryb3B5OwoJCQlpZiAoIHRoaXMuYW5pc290cm9weVJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmFuaXNvdHJvcHlSb3RhdGlvbiA9IHRoaXMuYW5pc290cm9weVJvdGF0aW9uOwoKCQkJaWYgKCB0aGlzLmFuaXNvdHJvcHlNYXAgJiYgdGhpcy5hbmlzb3Ryb3B5TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmFuaXNvdHJvcHlNYXAgPSB0aGlzLmFuaXNvdHJvcHlNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCX0KCgkJCWlmICggdGhpcy5tYXAgJiYgdGhpcy5tYXAuaXNUZXh0dXJlICkgZGF0YS5tYXAgPSB0aGlzLm1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMubWF0Y2FwICYmIHRoaXMubWF0Y2FwLmlzVGV4dHVyZSApIGRhdGEubWF0Y2FwID0gdGhpcy5tYXRjYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJaWYgKCB0aGlzLmFscGhhTWFwICYmIHRoaXMuYWxwaGFNYXAuaXNUZXh0dXJlICkgZGF0YS5hbHBoYU1hcCA9IHRoaXMuYWxwaGFNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5saWdodE1hcCAmJiB0aGlzLmxpZ2h0TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmxpZ2h0TWFwID0gdGhpcy5saWdodE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQkJZGF0YS5saWdodE1hcEludGVuc2l0eSA9IHRoaXMubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuYW9NYXAgJiYgdGhpcy5hb01hcC5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS5hb01hcCA9IHRoaXMuYW9NYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJCWRhdGEuYW9NYXBJbnRlbnNpdHkgPSB0aGlzLmFvTWFwSW50ZW5zaXR5OwoKCQkJfQoKCQkJaWYgKCB0aGlzLmJ1bXBNYXAgJiYgdGhpcy5idW1wTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmJ1bXBNYXAgPSB0aGlzLmJ1bXBNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJCWRhdGEuYnVtcFNjYWxlID0gdGhpcy5idW1wU2NhbGU7CgoJCQl9CgoJCQlpZiAoIHRoaXMubm9ybWFsTWFwICYmIHRoaXMubm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLm5vcm1hbE1hcCA9IHRoaXMubm9ybWFsTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLm5vcm1hbE1hcFR5cGUgPSB0aGlzLm5vcm1hbE1hcFR5cGU7CgkJCQlkYXRhLm5vcm1hbFNjYWxlID0gdGhpcy5ub3JtYWxTY2FsZS50b0FycmF5KCk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuZGlzcGxhY2VtZW50TWFwICYmIHRoaXMuZGlzcGxhY2VtZW50TWFwLmlzVGV4dHVyZSApIHsKCgkJCQlkYXRhLmRpc3BsYWNlbWVudE1hcCA9IHRoaXMuZGlzcGxhY2VtZW50TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCQlkYXRhLmRpc3BsYWNlbWVudFNjYWxlID0gdGhpcy5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJCWRhdGEuZGlzcGxhY2VtZW50QmlhcyA9IHRoaXMuZGlzcGxhY2VtZW50QmlhczsKCgkJCX0KCgkJCWlmICggdGhpcy5yb3VnaG5lc3NNYXAgJiYgdGhpcy5yb3VnaG5lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS5yb3VnaG5lc3NNYXAgPSB0aGlzLnJvdWdobmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMubWV0YWxuZXNzTWFwICYmIHRoaXMubWV0YWxuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEubWV0YWxuZXNzTWFwID0gdGhpcy5tZXRhbG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5lbWlzc2l2ZU1hcCAmJiB0aGlzLmVtaXNzaXZlTWFwLmlzVGV4dHVyZSApIGRhdGEuZW1pc3NpdmVNYXAgPSB0aGlzLmVtaXNzaXZlTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhck1hcCAmJiB0aGlzLnNwZWN1bGFyTWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJNYXAgPSB0aGlzLnNwZWN1bGFyTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhckludGVuc2l0eU1hcCAmJiB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJCWlmICggdGhpcy5zcGVjdWxhckNvbG9yTWFwICYmIHRoaXMuc3BlY3VsYXJDb2xvck1hcC5pc1RleHR1cmUgKSBkYXRhLnNwZWN1bGFyQ29sb3JNYXAgPSB0aGlzLnNwZWN1bGFyQ29sb3JNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5lbnZNYXAgJiYgdGhpcy5lbnZNYXAuaXNUZXh0dXJlICkgewoKCQkJCWRhdGEuZW52TWFwID0gdGhpcy5lbnZNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQlpZiAoIHRoaXMuY29tYmluZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5jb21iaW5lID0gdGhpcy5jb21iaW5lOwoKCQkJfQoKCQkJaWYgKCB0aGlzLmVudk1hcFJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmVudk1hcFJvdGF0aW9uID0gdGhpcy5lbnZNYXBSb3RhdGlvbi50b0FycmF5KCk7CgkJCWlmICggdGhpcy5lbnZNYXBJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuZW52TWFwSW50ZW5zaXR5ID0gdGhpcy5lbnZNYXBJbnRlbnNpdHk7CgkJCWlmICggdGhpcy5yZWZsZWN0aXZpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEucmVmbGVjdGl2aXR5ID0gdGhpcy5yZWZsZWN0aXZpdHk7CgkJCWlmICggdGhpcy5yZWZyYWN0aW9uUmF0aW8gIT09IHVuZGVmaW5lZCApIGRhdGEucmVmcmFjdGlvblJhdGlvID0gdGhpcy5yZWZyYWN0aW9uUmF0aW87CgoJCQlpZiAoIHRoaXMuZ3JhZGllbnRNYXAgJiYgdGhpcy5ncmFkaWVudE1hcC5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS5ncmFkaWVudE1hcCA9IHRoaXMuZ3JhZGllbnRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCX0KCgkJCWlmICggdGhpcy50cmFuc21pc3Npb24gIT09IHVuZGVmaW5lZCApIGRhdGEudHJhbnNtaXNzaW9uID0gdGhpcy50cmFuc21pc3Npb247CgkJCWlmICggdGhpcy50cmFuc21pc3Npb25NYXAgJiYgdGhpcy50cmFuc21pc3Npb25NYXAuaXNUZXh0dXJlICkgZGF0YS50cmFuc21pc3Npb25NYXAgPSB0aGlzLnRyYW5zbWlzc2lvbk1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlpZiAoIHRoaXMudGhpY2tuZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnRoaWNrbmVzcyA9IHRoaXMudGhpY2tuZXNzOwoJCQlpZiAoIHRoaXMudGhpY2tuZXNzTWFwICYmIHRoaXMudGhpY2tuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEudGhpY2tuZXNzTWFwID0gdGhpcy50aGlja25lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJaWYgKCB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgIT09IHVuZGVmaW5lZCAmJiB0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgIT09IEluZmluaXR5ICkgZGF0YS5hdHRlbnVhdGlvbkRpc3RhbmNlID0gdGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlOwoJCQlpZiAoIHRoaXMuYXR0ZW51YXRpb25Db2xvciAhPT0gdW5kZWZpbmVkICkgZGF0YS5hdHRlbnVhdGlvbkNvbG9yID0gdGhpcy5hdHRlbnVhdGlvbkNvbG9yLmdldEhleCgpOwoKCQkJaWYgKCB0aGlzLnNpemUgIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZSA9IHRoaXMuc2l6ZTsKCQkJaWYgKCB0aGlzLnNoYWRvd1NpZGUgIT09IG51bGwgKSBkYXRhLnNoYWRvd1NpZGUgPSB0aGlzLnNoYWRvd1NpZGU7CgkJCWlmICggdGhpcy5zaXplQXR0ZW51YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZUF0dGVudWF0aW9uID0gdGhpcy5zaXplQXR0ZW51YXRpb247CgoJCQlpZiAoIHRoaXMuYmxlbmRpbmcgIT09IE5vcm1hbEJsZW5kaW5nICkgZGF0YS5ibGVuZGluZyA9IHRoaXMuYmxlbmRpbmc7CgkJCWlmICggdGhpcy5zaWRlICE9PSBGcm9udFNpZGUgKSBkYXRhLnNpZGUgPSB0aGlzLnNpZGU7CgkJCWlmICggdGhpcy52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgKSBkYXRhLnZlcnRleENvbG9ycyA9IHRydWU7CgoJCQlpZiAoIHRoaXMub3BhY2l0eSA8IDEgKSBkYXRhLm9wYWNpdHkgPSB0aGlzLm9wYWNpdHk7CgkJCWlmICggdGhpcy50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIGRhdGEudHJhbnNwYXJlbnQgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLmJsZW5kU3JjICE9PSBTcmNBbHBoYUZhY3RvciApIGRhdGEuYmxlbmRTcmMgPSB0aGlzLmJsZW5kU3JjOwoJCQlpZiAoIHRoaXMuYmxlbmREc3QgIT09IE9uZU1pbnVzU3JjQWxwaGFGYWN0b3IgKSBkYXRhLmJsZW5kRHN0ID0gdGhpcy5ibGVuZERzdDsKCQkJaWYgKCB0aGlzLmJsZW5kRXF1YXRpb24gIT09IEFkZEVxdWF0aW9uICkgZGF0YS5ibGVuZEVxdWF0aW9uID0gdGhpcy5ibGVuZEVxdWF0aW9uOwoJCQlpZiAoIHRoaXMuYmxlbmRTcmNBbHBoYSAhPT0gbnVsbCApIGRhdGEuYmxlbmRTcmNBbHBoYSA9IHRoaXMuYmxlbmRTcmNBbHBoYTsKCQkJaWYgKCB0aGlzLmJsZW5kRHN0QWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRHN0QWxwaGEgPSB0aGlzLmJsZW5kRHN0QWxwaGE7CgkJCWlmICggdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGEgIT09IG51bGwgKSBkYXRhLmJsZW5kRXF1YXRpb25BbHBoYSA9IHRoaXMuYmxlbmRFcXVhdGlvbkFscGhhOwoJCQlpZiAoIHRoaXMuYmxlbmRDb2xvciAmJiB0aGlzLmJsZW5kQ29sb3IuaXNDb2xvciApIGRhdGEuYmxlbmRDb2xvciA9IHRoaXMuYmxlbmRDb2xvci5nZXRIZXgoKTsKCQkJaWYgKCB0aGlzLmJsZW5kQWxwaGEgIT09IDAgKSBkYXRhLmJsZW5kQWxwaGEgPSB0aGlzLmJsZW5kQWxwaGE7CgoJCQlpZiAoIHRoaXMuZGVwdGhGdW5jICE9PSBMZXNzRXF1YWxEZXB0aCApIGRhdGEuZGVwdGhGdW5jID0gdGhpcy5kZXB0aEZ1bmM7CgkJCWlmICggdGhpcy5kZXB0aFRlc3QgPT09IGZhbHNlICkgZGF0YS5kZXB0aFRlc3QgPSB0aGlzLmRlcHRoVGVzdDsKCQkJaWYgKCB0aGlzLmRlcHRoV3JpdGUgPT09IGZhbHNlICkgZGF0YS5kZXB0aFdyaXRlID0gdGhpcy5kZXB0aFdyaXRlOwoJCQlpZiAoIHRoaXMuY29sb3JXcml0ZSA9PT0gZmFsc2UgKSBkYXRhLmNvbG9yV3JpdGUgPSB0aGlzLmNvbG9yV3JpdGU7CgoJCQlpZiAoIHRoaXMuc3RlbmNpbFdyaXRlTWFzayAhPT0gMHhmZiApIGRhdGEuc3RlbmNpbFdyaXRlTWFzayA9IHRoaXMuc3RlbmNpbFdyaXRlTWFzazsKCQkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jICE9PSBBbHdheXNTdGVuY2lsRnVuYyApIGRhdGEuc3RlbmNpbEZ1bmMgPSB0aGlzLnN0ZW5jaWxGdW5jOwoJCQlpZiAoIHRoaXMuc3RlbmNpbFJlZiAhPT0gMCApIGRhdGEuc3RlbmNpbFJlZiA9IHRoaXMuc3RlbmNpbFJlZjsKCQkJaWYgKCB0aGlzLnN0ZW5jaWxGdW5jTWFzayAhPT0gMHhmZiApIGRhdGEuc3RlbmNpbEZ1bmNNYXNrID0gdGhpcy5zdGVuY2lsRnVuY01hc2s7CgkJCWlmICggdGhpcy5zdGVuY2lsRmFpbCAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbEZhaWwgPSB0aGlzLnN0ZW5jaWxGYWlsOwoJCQlpZiAoIHRoaXMuc3RlbmNpbFpGYWlsICE9PSBLZWVwU3RlbmNpbE9wICkgZGF0YS5zdGVuY2lsWkZhaWwgPSB0aGlzLnN0ZW5jaWxaRmFpbDsKCQkJaWYgKCB0aGlzLnN0ZW5jaWxaUGFzcyAhPT0gS2VlcFN0ZW5jaWxPcCApIGRhdGEuc3RlbmNpbFpQYXNzID0gdGhpcy5zdGVuY2lsWlBhc3M7CgkJCWlmICggdGhpcy5zdGVuY2lsV3JpdGUgPT09IHRydWUgKSBkYXRhLnN0ZW5jaWxXcml0ZSA9IHRoaXMuc3RlbmNpbFdyaXRlOwoKCQkJLy8gcm90YXRpb24gKFNwcml0ZU1hdGVyaWFsKQoJCQlpZiAoIHRoaXMucm90YXRpb24gIT09IHVuZGVmaW5lZCAmJiB0aGlzLnJvdGF0aW9uICE9PSAwICkgZGF0YS5yb3RhdGlvbiA9IHRoaXMucm90YXRpb247CgoJCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldCA9PT0gdHJ1ZSApIGRhdGEucG9seWdvbk9mZnNldCA9IHRydWU7CgkJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yOwoJCQlpZiAoIHRoaXMucG9seWdvbk9mZnNldFVuaXRzICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0VW5pdHMgPSB0aGlzLnBvbHlnb25PZmZzZXRVbml0czsKCgkJCWlmICggdGhpcy5saW5ld2lkdGggIT09IHVuZGVmaW5lZCAmJiB0aGlzLmxpbmV3aWR0aCAhPT0gMSApIGRhdGEubGluZXdpZHRoID0gdGhpcy5saW5ld2lkdGg7CgkJCWlmICggdGhpcy5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5kYXNoU2l6ZSA9IHRoaXMuZGFzaFNpemU7CgkJCWlmICggdGhpcy5nYXBTaXplICE9PSB1bmRlZmluZWQgKSBkYXRhLmdhcFNpemUgPSB0aGlzLmdhcFNpemU7CgkJCWlmICggdGhpcy5zY2FsZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zY2FsZSA9IHRoaXMuc2NhbGU7CgoJCQlpZiAoIHRoaXMuZGl0aGVyaW5nID09PSB0cnVlICkgZGF0YS5kaXRoZXJpbmcgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLmFscGhhVGVzdCA+IDAgKSBkYXRhLmFscGhhVGVzdCA9IHRoaXMuYWxwaGFUZXN0OwoJCQlpZiAoIHRoaXMuYWxwaGFIYXNoID09PSB0cnVlICkgZGF0YS5hbHBoYUhhc2ggPSB0cnVlOwoJCQlpZiAoIHRoaXMuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlICkgZGF0YS5hbHBoYVRvQ292ZXJhZ2UgPSB0cnVlOwoJCQlpZiAoIHRoaXMucHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgZGF0YS5wcmVtdWx0aXBsaWVkQWxwaGEgPSB0cnVlOwoJCQlpZiAoIHRoaXMuZm9yY2VTaW5nbGVQYXNzID09PSB0cnVlICkgZGF0YS5mb3JjZVNpbmdsZVBhc3MgPSB0cnVlOwoKCQkJaWYgKCB0aGlzLndpcmVmcmFtZSA9PT0gdHJ1ZSApIGRhdGEud2lyZWZyYW1lID0gdHJ1ZTsKCQkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA+IDEgKSBkYXRhLndpcmVmcmFtZUxpbmV3aWR0aCA9IHRoaXMud2lyZWZyYW1lTGluZXdpZHRoOwoJCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZWNhcCAhPT0gJ3JvdW5kJyApIGRhdGEud2lyZWZyYW1lTGluZWNhcCA9IHRoaXMud2lyZWZyYW1lTGluZWNhcDsKCQkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmVqb2luICE9PSAncm91bmQnICkgZGF0YS53aXJlZnJhbWVMaW5lam9pbiA9IHRoaXMud2lyZWZyYW1lTGluZWpvaW47CgoJCQlpZiAoIHRoaXMuZmxhdFNoYWRpbmcgPT09IHRydWUgKSBkYXRhLmZsYXRTaGFkaW5nID0gdHJ1ZTsKCgkJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIGRhdGEudmlzaWJsZSA9IGZhbHNlOwoKCQkJaWYgKCB0aGlzLnRvbmVNYXBwZWQgPT09IGZhbHNlICkgZGF0YS50b25lTWFwcGVkID0gZmFsc2U7CgoJCQlpZiAoIHRoaXMuZm9nID09PSBmYWxzZSApIGRhdGEuZm9nID0gZmFsc2U7CgoJCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIGRhdGEudXNlckRhdGEgPSB0aGlzLnVzZXJEYXRhOwoKCQkJLy8gVE9ETzogQ29waWVkIGZyb20gT2JqZWN0M0QudG9KU09OCgoJCQlmdW5jdGlvbiBleHRyYWN0RnJvbUNhY2hlKCBjYWNoZSApIHsKCgkJCQljb25zdCB2YWx1ZXMgPSBbXTsKCgkJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgoJCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQkJZGVsZXRlIGRhdGEubWV0YWRhdGE7CgkJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCgkJCX0KCgkJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJCWNvbnN0IHRleHR1cmVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS50ZXh0dXJlcyApOwoJCQkJY29uc3QgaW1hZ2VzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5pbWFnZXMgKTsKCgkJCQlpZiAoIHRleHR1cmVzLmxlbmd0aCA+IDAgKSBkYXRhLnRleHR1cmVzID0gdGV4dHVyZXM7CgkJCQlpZiAoIGltYWdlcy5sZW5ndGggPiAwICkgZGF0YS5pbWFnZXMgPSBpbWFnZXM7CgoJCQl9CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgbmV3IG1hdGVyaWFsIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtNYXRlcmlhbH0gQSBjbG9uZSBvZiB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNsb25lKCkgewoKCQkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBtYXRlcmlhbCB0byB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHBhcmFtIHtNYXRlcmlhbH0gc291cmNlIC0gVGhlIG1hdGVyaWFsIHRvIGNvcHkuCgkJICogQHJldHVybiB7TWF0ZXJpYWx9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weSggc291cmNlICkgewoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCQl0aGlzLmJsZW5kaW5nID0gc291cmNlLmJsZW5kaW5nOwoJCQl0aGlzLnNpZGUgPSBzb3VyY2Uuc2lkZTsKCQkJdGhpcy52ZXJ0ZXhDb2xvcnMgPSBzb3VyY2UudmVydGV4Q29sb3JzOwoKCQkJdGhpcy5vcGFjaXR5ID0gc291cmNlLm9wYWNpdHk7CgkJCXRoaXMudHJhbnNwYXJlbnQgPSBzb3VyY2UudHJhbnNwYXJlbnQ7CgoJCQl0aGlzLmJsZW5kU3JjID0gc291cmNlLmJsZW5kU3JjOwoJCQl0aGlzLmJsZW5kRHN0ID0gc291cmNlLmJsZW5kRHN0OwoJCQl0aGlzLmJsZW5kRXF1YXRpb24gPSBzb3VyY2UuYmxlbmRFcXVhdGlvbjsKCQkJdGhpcy5ibGVuZFNyY0FscGhhID0gc291cmNlLmJsZW5kU3JjQWxwaGE7CgkJCXRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhOwoJCQl0aGlzLmJsZW5kRXF1YXRpb25BbHBoYSA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uQWxwaGE7CgkJCXRoaXMuYmxlbmRDb2xvci5jb3B5KCBzb3VyY2UuYmxlbmRDb2xvciApOwoJCQl0aGlzLmJsZW5kQWxwaGEgPSBzb3VyY2UuYmxlbmRBbHBoYTsKCgkJCXRoaXMuZGVwdGhGdW5jID0gc291cmNlLmRlcHRoRnVuYzsKCQkJdGhpcy5kZXB0aFRlc3QgPSBzb3VyY2UuZGVwdGhUZXN0OwoJCQl0aGlzLmRlcHRoV3JpdGUgPSBzb3VyY2UuZGVwdGhXcml0ZTsKCgkJCXRoaXMuc3RlbmNpbFdyaXRlTWFzayA9IHNvdXJjZS5zdGVuY2lsV3JpdGVNYXNrOwoJCQl0aGlzLnN0ZW5jaWxGdW5jID0gc291cmNlLnN0ZW5jaWxGdW5jOwoJCQl0aGlzLnN0ZW5jaWxSZWYgPSBzb3VyY2Uuc3RlbmNpbFJlZjsKCQkJdGhpcy5zdGVuY2lsRnVuY01hc2sgPSBzb3VyY2Uuc3RlbmNpbEZ1bmNNYXNrOwoJCQl0aGlzLnN0ZW5jaWxGYWlsID0gc291cmNlLnN0ZW5jaWxGYWlsOwoJCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IHNvdXJjZS5zdGVuY2lsWkZhaWw7CgkJCXRoaXMuc3RlbmNpbFpQYXNzID0gc291cmNlLnN0ZW5jaWxaUGFzczsKCQkJdGhpcy5zdGVuY2lsV3JpdGUgPSBzb3VyY2Uuc3RlbmNpbFdyaXRlOwoKCQkJY29uc3Qgc3JjUGxhbmVzID0gc291cmNlLmNsaXBwaW5nUGxhbmVzOwoJCQlsZXQgZHN0UGxhbmVzID0gbnVsbDsKCgkJCWlmICggc3JjUGxhbmVzICE9PSBudWxsICkgewoKCQkJCWNvbnN0IG4gPSBzcmNQbGFuZXMubGVuZ3RoOwoJCQkJZHN0UGxhbmVzID0gbmV3IEFycmF5KCBuICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJCQlkc3RQbGFuZXNbIGkgXSA9IHNyY1BsYW5lc1sgaSBdLmNsb25lKCk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5jbGlwcGluZ1BsYW5lcyA9IGRzdFBsYW5lczsKCQkJdGhpcy5jbGlwSW50ZXJzZWN0aW9uID0gc291cmNlLmNsaXBJbnRlcnNlY3Rpb247CgkJCXRoaXMuY2xpcFNoYWRvd3MgPSBzb3VyY2UuY2xpcFNoYWRvd3M7CgoJCQl0aGlzLnNoYWRvd1NpZGUgPSBzb3VyY2Uuc2hhZG93U2lkZTsKCgkJCXRoaXMuY29sb3JXcml0ZSA9IHNvdXJjZS5jb2xvcldyaXRlOwoKCQkJdGhpcy5wcmVjaXNpb24gPSBzb3VyY2UucHJlY2lzaW9uOwoKCQkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gc291cmNlLnBvbHlnb25PZmZzZXQ7CgkJCXRoaXMucG9seWdvbk9mZnNldEZhY3RvciA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0RmFjdG9yOwoJCQl0aGlzLnBvbHlnb25PZmZzZXRVbml0cyA9IHNvdXJjZS5wb2x5Z29uT2Zmc2V0VW5pdHM7CgoJCQl0aGlzLmRpdGhlcmluZyA9IHNvdXJjZS5kaXRoZXJpbmc7CgoJCQl0aGlzLmFscGhhVGVzdCA9IHNvdXJjZS5hbHBoYVRlc3Q7CgkJCXRoaXMuYWxwaGFIYXNoID0gc291cmNlLmFscGhhSGFzaDsKCQkJdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBzb3VyY2UuYWxwaGFUb0NvdmVyYWdlOwoJCQl0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBsaWVkQWxwaGE7CgkJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gc291cmNlLmZvcmNlU2luZ2xlUGFzczsKCgkJCXRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwoKCQkJdGhpcy50b25lTWFwcGVkID0gc291cmNlLnRvbmVNYXBwZWQ7CgoJCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBGcmVlcyB0aGUgR1BVLXJlbGF0ZWQgcmVzb3VyY2VzIGFsbG9jYXRlZCBieSB0aGlzIGluc3RhbmNlLiBDYWxsIHRoaXMKCQkgKiBtZXRob2Qgd2hlbmV2ZXIgdGhpcyBpbnN0YW5jZSBpcyBubyBsb25nZXIgdXNlZCBpbiB5b3VyIGFwcC4KCQkgKgoJCSAqIEBmaXJlcyBNYXRlcmlhbCNkaXNwb3NlCgkJICovCgkJZGlzcG9zZSgpIHsKCgkJCS8qKgoJCQkgKiBGaXJlcyB3aGVuIHRoZSBtYXRlcmlhbCBoYXMgYmVlbiBkaXNwb3NlZCBvZi4KCQkJICoKCQkJICogQGV2ZW50IE1hdGVyaWFsI2Rpc3Bvc2UKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHRpbmcgdGhpcyBwcm9wZXJ0eSB0byBgdHJ1ZWAgaW5kaWNhdGVzIHRoZSBlbmdpbmUgdGhlIG1hdGVyaWFsCgkJICogbmVlZHMgdG8gYmUgcmVjb21waWxlZC4KCQkgKgoJCSAqIEB0eXBlIHtib29sZWFufQoJCSAqIEBkZWZhdWx0IGZhbHNlCgkJICogQHBhcmFtIHtib29sZWFufSB2YWx1ZQoJCSAqLwoJCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJfQoKCS8qKgoJICogQSBtYXRlcmlhbCBmb3IgZHJhd2luZyBnZW9tZXRyaWVzIGluIGEgc2ltcGxlIHNoYWRlZCAoZmxhdCBvciB3aXJlZnJhbWUpIHdheS4KCSAqCgkgKiBUaGlzIG1hdGVyaWFsIGlzIG5vdCBhZmZlY3RlZCBieSBsaWdodHMuCgkgKgoJICogQGF1Z21lbnRzIE1hdGVyaWFsCgkgKi8KCWNsYXNzIE1lc2hCYXNpY01hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2ggYmFzaWMgbWF0ZXJpYWwuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdH0gW3BhcmFtZXRlcnNdIC0gQW4gb2JqZWN0IHdpdGggb25lIG9yIG1vcmUgcHJvcGVydGllcwoJCSAqIGRlZmluaW5nIHRoZSBtYXRlcmlhbCdzIGFwcGVhcmFuY2UuIEFueSBwcm9wZXJ0eSBvZiB0aGUgbWF0ZXJpYWwKCQkgKiAoaW5jbHVkaW5nIGFueSBwcm9wZXJ0eSBmcm9tIGluaGVyaXRlZCBtYXRlcmlhbHMpIGNhbiBiZSBwYXNzZWQKCQkgKiBpbiBoZXJlLiBDb2xvciB2YWx1ZXMgY2FuIGJlIHBhc3NlZCBhbnkgdHlwZSBvZiB2YWx1ZSBhY2NlcHRlZAoJCSAqIGJ5IHtAbGluayBDb2xvciNzZXR9LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzTWVzaEJhc2ljTWF0ZXJpYWwgPSB0cnVlOwoKCQkJdGhpcy50eXBlID0gJ01lc2hCYXNpY01hdGVyaWFsJzsKCgkJCS8qKgoJCQkgKiBDb2xvciBvZiB0aGUgbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEB0eXBlIHtDb2xvcn0KCQkJICogQGRlZmF1bHQgKDEsMSwxKQoJCQkgKi8KCQkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZW1pc3NpdmUKCgkJCS8qKgoJCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAoJCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uIFRoZSB0ZXh0dXJlIG1hcAoJCQkgKiBjb2xvciBpcyBtb2R1bGF0ZWQgYnkgdGhlIGRpZmZ1c2UgYGNvbG9yYC4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLm1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGxpZ2h0IG1hcC4gUmVxdWlyZXMgYSBzZWNvbmQgc2V0IG9mIFVWcy4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBJbnRlbnNpdHkgb2YgdGhlIGJha2VkIGxpZ2h0LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQkJLyoqCgkJCSAqIFRoZSByZWQgY2hhbm5lbCBvZiB0aGlzIHRleHR1cmUgaXMgdXNlZCBhcyB0aGUgYW1iaWVudCBvY2NsdXNpb24gbWFwLgoJCQkgKiBSZXF1aXJlcyBhIHNlY29uZCBzZXQgb2YgVVZzLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYW9NYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEludGVuc2l0eSBvZiB0aGUgYW1iaWVudCBvY2NsdXNpb24gZWZmZWN0LiBSYW5nZSBpcyBgWzAsMV1gLCB3aGVyZSBgMGAKCQkJICogZGlzYWJsZXMgYW1iaWVudCBvY2NsdXNpb24uIFdoZXJlIGludGVuc2l0eSBpcyBgMWAgYW5kIHRoZSBBTyBtYXAncwoJCQkgKiByZWQgY2hhbm5lbCBpcyBhbHNvIGAxYCwgYW1iaWVudCBsaWdodCBpcyBmdWxseSBvY2NsdWRlZCBvbiBhIHN1cmZhY2UuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSAxLjA7CgoJCQkvKioKCQkJICogU3BlY3VsYXIgbWFwIHVzZWQgYnkgdGhlIG1hdGVyaWFsLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKCQkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KCQkJICoKCQkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCgkJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCgkJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKCQkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAoJCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGVudmlyb25tZW50IG1hcC4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmVudk1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBlbnZpcm9ubWVudCBtYXAgaW4gcmFkaWFucy4KCQkJICoKCQkJICogQHR5cGUge0V1bGVyfQoJCQkgKiBAZGVmYXVsdCAoMCwwLDApCgkJCSAqLwoJCQl0aGlzLmVudk1hcFJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CgoJCQkvKioKCQkJICogSG93IHRvIGNvbWJpbmUgdGhlIHJlc3VsdCBvZiB0aGUgc3VyZmFjZSdzIGNvbG9yIHdpdGggdGhlIGVudmlyb25tZW50IG1hcCwgaWYgYW55LgoJCQkgKgoJCQkgKiBXaGVuIHNldCB0byBgTWl4T3BlcmF0aW9uYCwgdGhlIHtAbGluayBNZXNoQmFzaWNNYXRlcmlhbCNyZWZsZWN0aXZpdHl9IGlzIHVzZWQgdG8KCQkJICogYmxlbmQgYmV0d2VlbiB0aGUgdHdvIGNvbG9ycy4KCQkJICoKCQkJICogQHR5cGUgeyhNdWx0aXBseU9wZXJhdGlvbnxNaXhPcGVyYXRpb258QWRkT3BlcmF0aW9uKX0KCQkJICogQGRlZmF1bHQgTXVsdGlwbHlPcGVyYXRpb24KCQkJICovCgkJCXRoaXMuY29tYmluZSA9IE11bHRpcGx5T3BlcmF0aW9uOwoKCQkJLyoqCgkJCSAqIEhvdyBtdWNoIHRoZSBlbnZpcm9ubWVudCBtYXAgYWZmZWN0cyB0aGUgc3VyZmFjZS4KCQkJICogVGhlIHZhbGlkIHJhbmdlIGlzIGJldHdlZW4gYDBgIChubyByZWZsZWN0aW9ucykgYW5kIGAxYCAoZnVsbCByZWZsZWN0aW9ucykuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMucmVmbGVjdGl2aXR5ID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgaW5kZXggb2YgcmVmcmFjdGlvbiAoSU9SKSBvZiBhaXIgKGFwcHJveGltYXRlbHkgMSkgZGl2aWRlZCBieSB0aGUKCQkJICogaW5kZXggb2YgcmVmcmFjdGlvbiBvZiB0aGUgbWF0ZXJpYWwuIEl0IGlzIHVzZWQgd2l0aCBlbnZpcm9ubWVudCBtYXBwaW5nCgkJCSAqIG1vZGVzIHtAbGluayBDdWJlUmVmcmFjdGlvbk1hcHBpbmd9IGFuZCB7QGxpbmsgRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmd9LgoJCQkgKiBUaGUgcmVmcmFjdGlvbiByYXRpbyBzaG91bGQgbm90IGV4Y2VlZCBgMWAuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAuOTgKCQkJICovCgkJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCgkJCS8qKgoJCQkgKiBSZW5kZXJzIHRoZSBnZW9tZXRyeSBhcyBhIHdpcmVmcmFtZS4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIENvbnRyb2xzIHRoZSB0aGlja25lc3Mgb2YgdGhlIHdpcmVmcmFtZS4KCQkJICoKCQkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIGFwcGVhcmFuY2Ugb2Ygd2lyZWZyYW1lIGVuZHMuCgkJCSAqCgkJCSAqIENhbiBvbmx5IGJlIHVzZWQgd2l0aCB7QGxpbmsgU1ZHUmVuZGVyZXJ9LgoJCQkgKgoJCQkgKiBAdHlwZSB7KCdyb3VuZCd8J2JldmVsJ3wnbWl0ZXInKX0KCQkJICogQGRlZmF1bHQgJ3JvdW5kJwoJCQkgKi8KCQkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIGFwcGVhcmFuY2Ugb2Ygd2lyZWZyYW1lIGpvaW50cy4KCQkJICoKCQkJICogQ2FuIG9ubHkgYmUgdXNlZCB3aXRoIHtAbGluayBTVkdSZW5kZXJlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHsoJ3JvdW5kJ3wnYmV2ZWwnfCdtaXRlcicpfQoJCQkgKiBAZGVmYXVsdCAncm91bmQnCgkJCSAqLwoJCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRoZSBtYXRlcmlhbCBpcyBhZmZlY3RlZCBieSBmb2cgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5mb2cgPSB0cnVlOwoKCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwoJCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQkJdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKCQkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCgkJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCQl0aGlzLmVudk1hcFJvdGF0aW9uLmNvcHkoIHNvdXJjZS5lbnZNYXBSb3RhdGlvbiApOwoJCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQkJdGhpcy5yZWZsZWN0aXZpdHkgPSBzb3VyY2UucmVmbGVjdGl2aXR5OwoJCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CgoJCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCQkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CgkJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgljb25zdCBfdmVjdG9yJDkgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfdmVjdG9yMiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKCWxldCBfaWQkMiA9IDA7CgoJLyoqCgkgKiBUaGlzIGNsYXNzIHN0b3JlcyBkYXRhIGZvciBhbiBhdHRyaWJ1dGUgKHN1Y2ggYXMgdmVydGV4IHBvc2l0aW9ucywgZmFjZQoJICogaW5kaWNlcywgbm9ybWFscywgY29sb3JzLCBVVnMsIGFuZCBhbnkgY3VzdG9tIGF0dHJpYnV0ZXMgKSBhc3NvY2lhdGVkIHdpdGgKCSAqIGEgZ2VvbWV0cnksIHdoaWNoIGFsbG93cyBmb3IgbW9yZSBlZmZpY2llbnQgcGFzc2luZyBvZiBkYXRhIHRvIHRoZSBHUFUuCgkgKgoJICogV2hlbiB3b3JraW5nIHdpdGggdmVjdG9yLWxpa2UgZGF0YSwgdGhlIGBmcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGV4IClgCgkgKiBoZWxwZXIgbWV0aG9kcyBvbiB2ZWN0b3IgYW5kIGNvbG9yIGNsYXNzIG1pZ2h0IGJlIGhlbHBmdWwuIEUuZy4ge0BsaW5rIFZlY3RvcjMjZnJvbUJ1ZmZlckF0dHJpYnV0ZX0uCgkgKi8KCWNsYXNzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7VHlwZWRBcnJheX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgPSBmYWxzZSApIHsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggYXJyYXkgKSApIHsKCgkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4nICk7CgoJCQl9CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0J1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIElEIG9mIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCQkgKgoJCQkgKiBAbmFtZSBCdWZmZXJBdHRyaWJ1dGUjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQyICsrIH0gKTsKCgkJCS8qKgoJCQkgKiBUaGUgbmFtZSBvZiB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMubmFtZSA9ICcnOwoKCQkJLyoqCgkJCSAqIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4gSXQgc2hvdWxkIGhhdmUgYGl0ZW1TaXplICogbnVtVmVydGljZXNgCgkJCSAqIGVsZW1lbnRzLCB3aGVyZSBgbnVtVmVydGljZXNgIGlzIHRoZSBudW1iZXIgb2YgdmVydGljZXMgaW4gdGhlIGFzc29jaWF0ZWQgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtUeXBlZEFycmF5fQoJCQkgKi8KCQkJdGhpcy5hcnJheSA9IGFycmF5OwoKCQkJLyoqCgkJCSAqIFRoZSBudW1iZXIgb2YgdmFsdWVzIG9mIHRoZSBhcnJheSB0aGF0IHNob3VsZCBiZSBhc3NvY2lhdGVkIHdpdGggYSBwYXJ0aWN1bGFyIHZlcnRleC4KCQkJICogRm9yIGluc3RhbmNlLCBpZiB0aGlzIGF0dHJpYnV0ZSBpcyBzdG9yaW5nIGEgMy1jb21wb25lbnQgdmVjdG9yIChzdWNoIGFzIGEgcG9zaXRpb24sCgkJCSAqIG5vcm1hbCwgb3IgY29sb3IpLCB0aGVuIHRoZSB2YWx1ZSBzaG91bGQgYmUgYDNgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIG51bWJlciBvZiBpdGVtcyB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUgc3RvcmVzLiBJdCBpcyBpbnRlcm5hbGx5IGNvbXB1dGVkCgkJCSAqIGJ5IGRpdmlkaW5nIHRoZSBgYXJyYXlgIGxlbmd0aCBieSB0aGUgYGl0ZW1TaXplYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQl0aGlzLmNvdW50ID0gYXJyYXkgIT09IHVuZGVmaW5lZCA/IGFycmF5Lmxlbmd0aCAvIGl0ZW1TaXplIDogMDsKCgkJCS8qKgoJCQkgKiBBcHBsaWVzIHRvIGludGVnZXIgZGF0YSBvbmx5LiBJbmRpY2F0ZXMgaG93IHRoZSB1bmRlcmx5aW5nIGRhdGEgaW4gdGhlIGJ1ZmZlciBtYXBzIHRvCgkJCSAqIHRoZSB2YWx1ZXMgaW4gdGhlIEdMU0wgY29kZS4gRm9yIGluc3RhbmNlLCBpZiBgYXJyYXlgIGlzIGFuIGluc3RhbmNlIG9mIGBVSW50MTZBcnJheWAsCgkJCSAqIGFuZCBgbm9ybWFsaXplZGAgaXMgYHRydWVgLCB0aGUgdmFsdWVzIGAwIC0gKzY1NTM1YCBpbiB0aGUgYXJyYXkgZGF0YSB3aWxsIGJlIG1hcHBlZCB0bwoJCQkgKiBgMC4wZiAtICsxLjBmYCBpbiB0aGUgR0xTTCBhdHRyaWJ1dGUuIElmIGBub3JtYWxpemVkYCBpcyBgZmFsc2VgLCB0aGUgdmFsdWVzIHdpbGwgYmUgY29udmVydGVkCgkJCSAqIHRvIGZsb2F0cyB1bm1vZGlmaWVkLCBpLmUuIGA2NTUzNWAgYmVjb21lcyBgNjU1MzUuMGZgLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICovCgkJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQ7CgoJCQkvKioKCQkJICogRGVmaW5lcyB0aGUgaW50ZW5kZWQgdXNhZ2UgcGF0dGVybiBvZiB0aGUgZGF0YSBzdG9yZSBmb3Igb3B0aW1pemF0aW9uIHB1cnBvc2VzLgoJCQkgKgoJCQkgKiBOb3RlOiBBZnRlciB0aGUgaW5pdGlhbCB1c2Ugb2YgYSBidWZmZXIsIGl0cyB1c2FnZSBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwKCQkJICogaW5zdGFudGlhdGUgYSBuZXcgb25lIGFuZCBzZXQgdGhlIGRlc2lyZWQgdXNhZ2UgYmVmb3JlIHRoZSBuZXh0IHJlbmRlci4KCQkJICoKCQkJICogQHR5cGUgeyhTdGF0aWNEcmF3VXNhZ2V8RHluYW1pY0RyYXdVc2FnZXxTdHJlYW1EcmF3VXNhZ2V8U3RhdGljUmVhZFVzYWdlfER5bmFtaWNSZWFkVXNhZ2V8U3RyZWFtUmVhZFVzYWdlfFN0YXRpY0NvcHlVc2FnZXxEeW5hbWljQ29weVVzYWdlfFN0cmVhbUNvcHlVc2FnZSl9CgkJCSAqIEBkZWZhdWx0IFN0YXRpY0RyYXdVc2FnZQoJCQkgKi8KCQkJdGhpcy51c2FnZSA9IFN0YXRpY0RyYXdVc2FnZTsKCgkJCS8qKgoJCQkgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIG9ubHkgdXBkYXRlIHNvbWUgY29tcG9uZW50cyBvZiBzdG9yZWQgdmVjdG9ycyAoZm9yIGV4YW1wbGUsIGp1c3QgdGhlCgkJCSAqIGNvbXBvbmVudCByZWxhdGVkIHRvIGNvbG9yKS4gVXNlIHRoZSBgYWRkVXBkYXRlUmFuZ2UoKWAgZnVuY3Rpb24gdG8gYWRkIHJhbmdlcyB0byB0aGlzIGFycmF5LgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8T2JqZWN0Pn0KCQkJICovCgkJCXRoaXMudXBkYXRlUmFuZ2VzID0gW107CgoJCQkvKioKCQkJICogQ29uZmlndXJlcyB0aGUgYm91bmQgR1BVIHR5cGUgZm9yIHVzZSBpbiBzaGFkZXJzLgoJCQkgKgoJCQkgKiBOb3RlOiB0aGlzIG9ubHkgaGFzIGFuIGVmZmVjdCBmb3IgaW50ZWdlciBhcnJheXMgYW5kIGlzIG5vdCBjb25maWd1cmFibGUgZm9yIGZsb2F0IGFycmF5cy4KCQkJICogRm9yIGxvd2VyIHByZWNpc2lvbiBmbG9hdCB0eXBlcywgdXNlIGBGbG9hdDE2QnVmZmVyQXR0cmlidXRlYC4KCQkJICoKCQkJICogQHR5cGUgeyhGbG9hdFR5cGV8SW50VHlwZSl9CgkJCSAqIEBkZWZhdWx0IEZsb2F0VHlwZQoJCQkgKi8KCQkJdGhpcy5ncHVUeXBlID0gRmxvYXRUeXBlOwoKCQkJLyoqCgkJCSAqIEEgdmVyc2lvbiBudW1iZXIsIGluY3JlbWVudGVkIGV2ZXJ5IHRpbWUgdGhlIGBuZWVkc1VwZGF0ZWAgaXMgc2V0IHRvIGB0cnVlYC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMudmVyc2lvbiA9IDA7CgoJCX0KCgkJLyoqCgkJICogQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IGlzIGV4ZWN1dGVkIGFmdGVyIHRoZSByZW5kZXJlciBoYXMgdHJhbnNmZXJyZWQgdGhlIGF0dHJpYnV0ZQoJCSAqIGFycmF5IGRhdGEgdG8gdGhlIEdQVS4KCQkgKi8KCQlvblVwbG9hZENhbGxiYWNrKCkge30KCgkJLyoqCgkJICogRmxhZyB0byBpbmRpY2F0ZSB0aGF0IHRoaXMgYXR0cmlidXRlIGhhcyBjaGFuZ2VkIGFuZCBzaG91bGQgYmUgcmUtc2VudCB0bwoJCSAqIHRoZSBHUFUuIFNldCB0aGlzIHRvIGB0cnVlYCB3aGVuIHlvdSBtb2RpZnkgdGhlIHZhbHVlIG9mIHRoZSBhcnJheS4KCQkgKgoJCSAqIEB0eXBlIHtudW1iZXJ9CgkJICogQGRlZmF1bHQgZmFsc2UKCQkgKiBAcGFyYW0ge2Jvb2xlYW59IHZhbHVlCgkJICovCgkJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgdXNhZ2Ugb2YgdGhpcyBidWZmZXIgYXR0cmlidXRlLgoJCSAqCgkJICogQHBhcmFtIHsoU3RhdGljRHJhd1VzYWdlfER5bmFtaWNEcmF3VXNhZ2V8U3RyZWFtRHJhd1VzYWdlfFN0YXRpY1JlYWRVc2FnZXxEeW5hbWljUmVhZFVzYWdlfFN0cmVhbVJlYWRVc2FnZXxTdGF0aWNDb3B5VXNhZ2V8RHluYW1pY0NvcHlVc2FnZXxTdHJlYW1Db3B5VXNhZ2UpfSB2YWx1ZSAtIFRoZSB1c2FnZSB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICovCgkJc2V0VXNhZ2UoIHZhbHVlICkgewoKCQkJdGhpcy51c2FnZSA9IHZhbHVlOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQWRkcyBhIHJhbmdlIG9mIGRhdGEgaW4gdGhlIGRhdGEgYXJyYXkgdG8gYmUgdXBkYXRlZCBvbiB0aGUgR1BVLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gUG9zaXRpb24gYXQgd2hpY2ggdG8gc3RhcnQgdXBkYXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb3VudCAtIFRoZSBudW1iZXIgb2YgY29tcG9uZW50cyB0byB1cGRhdGUuCgkJICovCgkJYWRkVXBkYXRlUmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJCXRoaXMudXBkYXRlUmFuZ2VzLnB1c2goIHsgc3RhcnQsIGNvdW50IH0gKTsKCgkJfQoKCQkvKioKCQkgKiBDbGVhcnMgdGhlIHVwZGF0ZSByYW5nZXMuCgkJICovCgkJY2xlYXJVcGRhdGVSYW5nZXMoKSB7CgoJCQl0aGlzLnVwZGF0ZVJhbmdlcy5sZW5ndGggPSAwOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyB0aGUgdmFsdWVzIG9mIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gc291cmNlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weSggc291cmNlICkgewoKCQkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgkJCXRoaXMuYXJyYXkgPSBuZXcgc291cmNlLmFycmF5LmNvbnN0cnVjdG9yKCBzb3VyY2UuYXJyYXkgKTsKCQkJdGhpcy5pdGVtU2l6ZSA9IHNvdXJjZS5pdGVtU2l6ZTsKCQkJdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKCQkJdGhpcy5ub3JtYWxpemVkID0gc291cmNlLm5vcm1hbGl6ZWQ7CgoJCQl0aGlzLnVzYWdlID0gc291cmNlLnVzYWdlOwoJCQl0aGlzLmdwdVR5cGUgPSBzb3VyY2UuZ3B1VHlwZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvcGllcyBhIHZlY3RvciBmcm9tIHRoZSBnaXZlbiBidWZmZXIgYXR0cmlidXRlIHRvIHRoaXMgb25lLiBUaGUgc3RhcnQKCQkgKiBhbmQgZGVzdGluYXRpb24gcG9zaXRpb24gaW4gdGhlIGF0dHJpYnV0ZSBidWZmZXJzIGFyZSByZXByZXNlbnRlZCBieSB0aGUKCQkgKiBnaXZlbiBpbmRpY2VzLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4MSAtIFRoZSBkZXN0aW5hdGlvbiBpbmRleCBpbnRvIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcGFyYW0ge0J1ZmZlckF0dHJpYnV0ZX0gYXR0cmlidXRlIC0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUgdG8gY29weSBmcm9tLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleDIgLSBUaGUgc291cmNlIGluZGV4IGludG8gdGhlIGdpdmVuIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNvcHlBdCggaW5kZXgxLCBhdHRyaWJ1dGUsIGluZGV4MiApIHsKCgkJCWluZGV4MSAqPSB0aGlzLml0ZW1TaXplOwoJCQlpbmRleDIgKj0gYXR0cmlidXRlLml0ZW1TaXplOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5pdGVtU2l6ZTsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdGhpcy5hcnJheVsgaW5kZXgxICsgaSBdID0gYXR0cmlidXRlLmFycmF5WyBpbmRleDIgKyBpIF07CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIGdpdmVuIGFycmF5IGRhdGEgaW50byB0aGlzIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhUeXBlZEFycmF5fEFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY29weUFycmF5KCBhcnJheSApIHsKCgkJCXRoaXMuYXJyYXkuc2V0KCBhcnJheSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gM3gzIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBXb3JrcyB3aXRoCgkJICogaXRlbSBzaXplIGAyYCBhbmQgYDNgLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYXBwbHlNYXRyaXgzKCBtICkgewoKCQkJaWYgKCB0aGlzLml0ZW1TaXplID09PSAyICkgewoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCQlfdmVjdG9yMiQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCQkJCQlfdmVjdG9yMiQxLmFwcGx5TWF0cml4MyggbSApOwoKCQkJCQl0aGlzLnNldFhZKCBpLCBfdmVjdG9yMiQxLngsIF92ZWN0b3IyJDEueSApOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRoaXMuaXRlbVNpemUgPT09IDMgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgkJCQkJX3ZlY3RvciQ5LmFwcGx5TWF0cml4MyggbSApOwoKCQkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIEFwcGxpZXMgdGhlIGdpdmVuIDR4NCBtYXRyaXggdG8gdGhlIGdpdmVuIGF0dHJpYnV0ZS4gT25seSB3b3JrcyB3aXRoCgkJICogaXRlbSBzaXplIGAzYC4KCQkgKgoJCSAqIEBwYXJhbSB7TWF0cml4NH0gbSAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWFwcGx5TWF0cml4NCggbSApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCV92ZWN0b3IkOS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgoJCQkJX3ZlY3RvciQ5LmFwcGx5TWF0cml4NCggbSApOwoKCQkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDkueCwgX3ZlY3RvciQ5LnksIF92ZWN0b3IkOS56ICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBBcHBsaWVzIHRoZSBnaXZlbiAzeDMgbm9ybWFsIG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKCQkgKiBpdGVtIHNpemUgYDNgLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXgzfSBtIC0gVGhlIG5vcm1hbCBtYXRyaXggdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCQlfdmVjdG9yJDkuYXBwbHlOb3JtYWxNYXRyaXgoIG0gKTsKCgkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ5LngsIF92ZWN0b3IkOS55LCBfdmVjdG9yJDkueiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IG1hdHJpeCB0byB0aGUgZ2l2ZW4gYXR0cmlidXRlLiBPbmx5IHdvcmtzIHdpdGgKCQkgKiBpdGVtIHNpemUgYDNgIGFuZCB3aXRoIGRpcmVjdGlvbiB2ZWN0b3JzLgoJCSAqCgkJICogQHBhcmFtIHtNYXRyaXg0fSBtIC0gVGhlIG1hdHJpeCB0byBhcHBseS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNmb3JtRGlyZWN0aW9uKCBtICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3ZlY3RvciQ5LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCQlfdmVjdG9yJDkudHJhbnNmb3JtRGlyZWN0aW9uKCBtICk7CgoJCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkOS54LCBfdmVjdG9yJDkueSwgX3ZlY3RvciQ5LnogKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGFycmF5IGRhdGEgaW4gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhUeXBlZEFycmF5fEFycmF5KX0gdmFsdWUgLSBUaGUgYXJyYXkgZGF0YSB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtvZmZzZXQ9MF0gLSBUaGUgb2Zmc2V0IGluIHRoaXMgYnVmZmVyIGF0dHJpYnV0ZSdzIGFycmF5LgoJCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXQoIHZhbHVlLCBvZmZzZXQgPSAwICkgewoKCQkJLy8gTWF0Y2hpbmcgQnVmZmVyQXR0cmlidXRlIGNvbnN0cnVjdG9yLCBkbyBub3Qgbm9ybWFsaXplIHRoZSBhcnJheS4KCQkJdGhpcy5hcnJheS5zZXQoIHZhbHVlLCBvZmZzZXQgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGdpdmVuIGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb21wb25lbnQgLSBUaGUgY29tcG9uZW50IGluZGV4LgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHJldHVybmVkIHZhbHVlLgoJCSAqLwoJCWdldENvbXBvbmVudCggaW5kZXgsIGNvbXBvbmVudCApIHsKCgkJCWxldCB2YWx1ZSA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdOwoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IGRlbm9ybWFsaXplKCB2YWx1ZSwgdGhpcy5hcnJheSApOwoKCQkJcmV0dXJuIHZhbHVlOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIHZhbHVlIHRvIHRoZSBnaXZlbiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gY29tcG9uZW50IC0gVGhlIGNvbXBvbmVudCBpbmRleC4KCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXRDb21wb25lbnQoIGluZGV4LCBjb21wb25lbnQsIHZhbHVlICkgewoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IG5vcm1hbGl6ZSggdmFsdWUsIHRoaXMuYXJyYXkgKTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdID0gdmFsdWU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSB4IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHggY29tcG9uZW50LgoJCSAqLwoJCWdldFgoIGluZGV4ICkgewoKCQkJbGV0IHggPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgXTsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeCA9IGRlbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgoJCQlyZXR1cm4geDsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB4IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0WCggaW5kZXgsIHggKSB7CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSBdID0geDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgeSBjb21wb25lbnQuCgkJICovCgkJZ2V0WSggaW5kZXggKSB7CgoJCQlsZXQgeSA9IHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXTsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IGRlbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCQlyZXR1cm4geTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB5IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZhbHVlIHRvIHNldC4KCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0WSggaW5kZXgsIHkgKSB7CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCgkJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXSA9IHk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSB6IGNvbXBvbmVudCBvZiB0aGUgdmVjdG9yIGF0IHRoZSBnaXZlbiBpbmRleC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBpbnRvIHRoZSBidWZmZXIgYXR0cmlidXRlLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHogY29tcG9uZW50LgoJCSAqLwoJCWdldFooIGluZGV4ICkgewoKCQkJbGV0IHogPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF07CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBkZW5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQkJcmV0dXJuIHo7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgeiBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFooIGluZGV4LCB6ICkgewoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF0gPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgdyBjb21wb25lbnQgb2YgdGhlIHZlY3RvciBhdCB0aGUgZ2l2ZW4gaW5kZXguCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBUaGUgaW5kZXggaW50byB0aGUgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB3IGNvbXBvbmVudC4KCQkgKi8KCQlnZXRXKCBpbmRleCApIHsKCgkJCWxldCB3ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdOwoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB3ID0gZGVub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJCXJldHVybiB3OwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHcgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge0J1ZmZlckF0dHJpYnV0ZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXRXKCBpbmRleCwgdyApIHsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHggYW5kIHkgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFhZKCBpbmRleCwgeCwgeSApIHsKCgkJCWluZGV4ICo9IHRoaXMuaXRlbVNpemU7CgoJCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCQl5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCQl9CgoJCQl0aGlzLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHgsIHkgYW5kIHogY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgZm9yIHRoZSB6IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFhZWiggaW5kZXgsIHgsIHksIHogKSB7CgoJCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQkJeCA9IG5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoJCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoJCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQkJfQoKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMiBdID0gejsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHgsIHksIHogYW5kIHcgY29tcG9uZW50IG9mIHRoZSB2ZWN0b3IgYXQgdGhlIGdpdmVuIGluZGV4LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IGludG8gdGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgdmFsdWUgZm9yIHRoZSB4IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSB5IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgdmFsdWUgZm9yIHRoZSB6IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHcgLSBUaGUgdmFsdWUgZm9yIHRoZSB3IGNvbXBvbmVudCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFhZWlcoIGluZGV4LCB4LCB5LCB6LCB3ICkgewoKCQkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJCWlmICggdGhpcy5ub3JtYWxpemVkICkgewoKCQkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJCXogPSBub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCQkJCXcgPSBub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJCX0KCgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKCQkJdGhpcy5hcnJheVsgaW5kZXggKyAxIF0gPSB5OwoJCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgkJCXRoaXMuYXJyYXlbIGluZGV4ICsgMyBdID0gdzsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgZXhlY3V0ZWQgYWZ0ZXIgdGhlIFJlbmRlcmVyIGhhcyB0cmFuc2ZlcnJlZAoJCSAqIHRoZSBhdHRyaWJ1dGUgYXJyYXkgZGF0YSB0byB0aGUgR1BVLiBDYW4gYmUgdXNlZCB0byBwZXJmb3JtIGNsZWFuLXVwIG9wZXJhdGlvbnMgYWZ0ZXIKCQkgKiB0aGUgdXBsb2FkIHdoZW4gYXR0cmlidXRlIGRhdGEgYXJlIG5vdCBuZWVkZWQgYW55bW9yZSBvbiB0aGUgQ1BVIHNpZGUuCgkJICoKCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayAtIFRoZSBgb25VcGxvYWQoKWAgY2FsbGJhY2suCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCW9uVXBsb2FkKCBjYWxsYmFjayApIHsKCgkJCXRoaXMub25VcGxvYWRDYWxsYmFjayA9IGNhbGxiYWNrOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBidWZmZXIgYXR0cmlidXRlIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtCdWZmZXJBdHRyaWJ1dGV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvciggdGhpcy5hcnJheSwgdGhpcy5pdGVtU2l6ZSApLmNvcHkoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBTZXJpYWxpemVzIHRoZSBidWZmZXIgYXR0cmlidXRlIGludG8gSlNPTi4KCQkgKgoJCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKi8KCQl0b0pTT04oKSB7CgoJCQljb25zdCBkYXRhID0gewoJCQkJaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCgkJCQl0eXBlOiB0aGlzLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQlhcnJheTogQXJyYXkuZnJvbSggdGhpcy5hcnJheSApLAoJCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCgkJCX07CgoJCQlpZiAoIHRoaXMubmFtZSAhPT0gJycgKSBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CgkJCWlmICggdGhpcy51c2FnZSAhPT0gU3RhdGljRHJhd1VzYWdlICkgZGF0YS51c2FnZSA9IHRoaXMudXNhZ2U7CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0KCgkvKioKCSAqIENvbnZlbmllbnQgY2xhc3MgdGhhdCBjYW4gYmUgdXNlZCB3aGVuIGNyZWF0aW5nIGEgYFVJbnQxNmAgYnVmZmVyIGF0dHJpYnV0ZSB3aXRoCgkgKiBhIHBsYWluIGBBcnJheWAgaW5zdGFuY2UuCgkgKgoJICogQGF1Z21lbnRzIEJ1ZmZlckF0dHJpYnV0ZQoJICovCgljbGFzcyBVaW50MTZCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fFVpbnQxNkFycmF5KX0gYXJyYXkgLSBUaGUgYXJyYXkgaG9sZGluZyB0aGUgYXR0cmlidXRlIGRhdGEuCgkJICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TaXplIC0gVGhlIGl0ZW0gc2l6ZS4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtub3JtYWxpemVkPWZhbHNlXSAtIFdoZXRoZXIgdGhlIGRhdGEgYXJlIG5vcm1hbGl6ZWQgb3Igbm90LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCQlzdXBlciggbmV3IFVpbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl9CgoJfQoKCS8qKgoJICogQ29udmVuaWVudCBjbGFzcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gY3JlYXRpbmcgYSBgVUludDMyYCBidWZmZXIgYXR0cmlidXRlIHdpdGgKCSAqIGEgcGxhaW4gYEFycmF5YCBpbnN0YW5jZS4KCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyQXR0cmlidXRlCgkgKi8KCWNsYXNzIFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYnVmZmVyIGF0dHJpYnV0ZS4KCQkgKgoJCSAqIEBwYXJhbSB7KEFycmF5PG51bWJlcj58VWludDMyQXJyYXkpfSBhcnJheSAtIFRoZSBhcnJheSBob2xkaW5nIHRoZSBhdHRyaWJ1dGUgZGF0YS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaXRlbVNpemUgLSBUaGUgaXRlbSBzaXplLgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW25vcm1hbGl6ZWQ9ZmFsc2VdIC0gV2hldGhlciB0aGUgZGF0YSBhcmUgbm9ybWFsaXplZCBvciBub3QuCgkJICovCgkJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJCXN1cGVyKCBuZXcgVWludDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBDb252ZW5pZW50IGNsYXNzIHRoYXQgY2FuIGJlIHVzZWQgd2hlbiBjcmVhdGluZyBhIGBGbG9hdDMyYCBidWZmZXIgYXR0cmlidXRlIHdpdGgKCSAqIGEgcGxhaW4gYEFycmF5YCBpbnN0YW5jZS4KCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyQXR0cmlidXRlCgkgKi8KCWNsYXNzIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICoKCQkgKiBAcGFyYW0geyhBcnJheTxudW1iZXI+fEZsb2F0MzJBcnJheSl9IGFycmF5IC0gVGhlIGFycmF5IGhvbGRpbmcgdGhlIGF0dHJpYnV0ZSBkYXRhLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBpdGVtU2l6ZSAtIFRoZSBpdGVtIHNpemUuCgkJICogQHBhcmFtIHtib29sZWFufSBbbm9ybWFsaXplZD1mYWxzZV0gLSBXaGV0aGVyIHRoZSBkYXRhIGFyZSBub3JtYWxpemVkIG9yIG5vdC4KCQkgKi8KCQljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQkJc3VwZXIoIG5ldyBGbG9hdDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCX0KCgl9CgoJbGV0IF9pZCQxID0gMDsKCgljb25zdCBfbTEkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IF9vYmogPSAvKkBfX1BVUkVfXyovIG5ldyBPYmplY3QzRCgpOwoJY29uc3QgX29mZnNldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9ib3gkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKCWNvbnN0IF9ib3hNb3JwaFRhcmdldHMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7Cgljb25zdCBfdmVjdG9yJDggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJLyoqCgkgKiBBIHJlcHJlc2VudGF0aW9uIG9mIG1lc2gsIGxpbmUsIG9yIHBvaW50IGdlb21ldHJ5LiBJbmNsdWRlcyB2ZXJ0ZXgKCSAqIHBvc2l0aW9ucywgZmFjZSBpbmRpY2VzLCBub3JtYWxzLCBjb2xvcnMsIFVWcywgYW5kIGN1c3RvbSBhdHRyaWJ1dGVzCgkgKiB3aXRoaW4gYnVmZmVycywgcmVkdWNpbmcgdGhlIGNvc3Qgb2YgcGFzc2luZyBhbGwgdGhpcyBkYXRhIHRvIHRoZSBHUFUuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CgkgKiAvLyBjcmVhdGUgYSBzaW1wbGUgc3F1YXJlIHNoYXBlLiBXZSBkdXBsaWNhdGUgdGhlIHRvcCBsZWZ0IGFuZCBib3R0b20gcmlnaHQKCSAqIC8vIHZlcnRpY2VzIGJlY2F1c2UgZWFjaCB2ZXJ0ZXggbmVlZHMgdG8gYXBwZWFyIG9uY2UgcGVyIHRyaWFuZ2xlLgoJICogY29uc3QgdmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KCBbCgkgKiAJLTEuMCwgLTEuMCwgIDEuMCwgLy8gdjAKCSAqIAkgMS4wLCAtMS4wLCAgMS4wLCAvLyB2MQoJICogCSAxLjAsICAxLjAsICAxLjAsIC8vIHYyCgkgKgoJICogCSAxLjAsICAxLjAsICAxLjAsIC8vIHYzCgkgKiAJLTEuMCwgIDEuMCwgIDEuMCwgLy8gdjQKCSAqIAktMS4wLCAtMS4wLCAgMS4wICAvLyB2NQoJICogXSApOwoJICogLy8gaXRlbVNpemUgPSAzIGJlY2F1c2UgdGhlcmUgYXJlIDMgdmFsdWVzIChjb21wb25lbnRzKSBwZXIgdmVydGV4CgkgKiBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBUSFJFRS5CdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCSAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweGZmMDAwMCB9ICk7CgkgKiBjb25zdCBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIEV2ZW50RGlzcGF0Y2hlcgoJICovCgljbGFzcyBCdWZmZXJHZW9tZXRyeSBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZ2VvbWV0cnkuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNCdWZmZXJHZW9tZXRyeSA9IHRydWU7CgoJCQkvKioKCQkJICogVGhlIElEIG9mIHRoZSBnZW9tZXRyeS4KCQkJICoKCQkJICogQG5hbWUgQnVmZmVyR2VvbWV0cnkjaWQKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQHJlYWRvbmx5CgkJCSAqLwoJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQxICsrIH0gKTsKCgkJCS8qKgoJCQkgKiBUaGUgVVVJRCBvZiB0aGUgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqIEByZWFkb25seQoJCQkgKi8KCQkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCQkvKioKCQkJICogVGhlIG5hbWUgb2YgdGhlIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7c3RyaW5nfQoJCQkgKi8KCQkJdGhpcy5uYW1lID0gJyc7CgkJCXRoaXMudHlwZSA9ICdCdWZmZXJHZW9tZXRyeSc7CgoJCQkvKioKCQkJICogQWxsb3dzIGZvciB2ZXJ0aWNlcyB0byBiZSByZS11c2VkIGFjcm9zcyBtdWx0aXBsZSB0cmlhbmdsZXM7IHRoaXMgaXMKCQkJICogY2FsbGVkIHVzaW5nICJpbmRleGVkIHRyaWFuZ2xlcyIuIEVhY2ggdHJpYW5nbGUgaXMgYXNzb2NpYXRlZCB3aXRoIHRoZQoJCQkgKiBpbmRpY2VzIG9mIHRocmVlIHZlcnRpY2VzLiBUaGlzIGF0dHJpYnV0ZSB0aGVyZWZvcmUgc3RvcmVzIHRoZSBpbmRleCBvZgoJCQkgKiBlYWNoIHZlcnRleCBmb3IgZWFjaCB0cmlhbmd1bGFyIGZhY2UuIElmIHRoaXMgYXR0cmlidXRlIGlzIG5vdCBzZXQsIHRoZQoJCQkgKiByZW5kZXJlciBhc3N1bWVzIHRoYXQgZWFjaCB0aHJlZSBjb250aWd1b3VzIHBvc2l0aW9ucyByZXByZXNlbnQgYSBzaW5nbGUgdHJpYW5nbGUuCgkJCSAqCgkJCSAqIEB0eXBlIHs/QnVmZmVyQXR0cmlidXRlfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLmluZGV4ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBBIChzdG9yYWdlKSBidWZmZXIgYXR0cmlidXRlIHdoaWNoIHdhcyBnZW5lcmF0ZWQgd2l0aCBhIGNvbXB1dGUgc2hhZGVyIGFuZAoJCQkgKiBub3cgZGVmaW5lcyBpbmRpcmVjdCBkcmF3IGNhbGxzLgoJCQkgKgoJCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdQVVJlbmRlcmVyfSBhbmQgYSBXZWJHUFUgYmFja2VuZC4KCQkJICoKCQkJICogQHR5cGUgez9CdWZmZXJBdHRyaWJ1dGV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuaW5kaXJlY3QgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoaXMgZGljdGlvbmFyeSBoYXMgYXMgaWQgdGhlIG5hbWUgb2YgdGhlIGF0dHJpYnV0ZSB0byBiZSBzZXQgYW5kIGFzIHZhbHVlCgkJCSAqIHRoZSBidWZmZXIgYXR0cmlidXRlIHRvIHNldCBpdCB0by4gUmF0aGVyIHRoYW4gYWNjZXNzaW5nIHRoaXMgcHJvcGVydHkgZGlyZWN0bHksCgkJCSAqIHVzZSBgc2V0QXR0cmlidXRlKClgIGFuZCBgZ2V0QXR0cmlidXRlKClgIHRvIGFjY2VzcyBhdHRyaWJ1dGVzIG9mIHRoaXMgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLChCdWZmZXJBdHRyaWJ1dGV8SW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUpPn0KCQkJICovCgkJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoKCQkJLyoqCgkJCSAqIFRoaXMgZGljdGlvbmFyeSBob2xkcyB0aGUgbW9ycGggdGFyZ2V0cyBvZiB0aGUgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIE5vdGU6IE9uY2UgdGhlIGdlb21ldHJ5IGhhcyBiZWVuIHJlbmRlcmVkLCB0aGUgbW9ycGggYXR0cmlidXRlIGRhdGEgY2Fubm90CgkJCSAqIGJlIGNoYW5nZWQuIFlvdSB3aWxsIGhhdmUgdG8gY2FsbCBgZGlzcG9zZSgpPywgYW5kIGNyZWF0ZSBhIG5ldyBnZW9tZXRyeSBpbnN0YW5jZS4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMubW9ycGhBdHRyaWJ1dGVzID0ge307CgoJCQkvKioKCQkJICogVXNlZCB0byBjb250cm9sIHRoZSBtb3JwaCB0YXJnZXQgYmVoYXZpb3I7IHdoZW4gc2V0IHRvIGB0cnVlYCwgdGhlIG1vcnBoCgkJCSAqIHRhcmdldCBkYXRhIGlzIHRyZWF0ZWQgYXMgcmVsYXRpdmUgb2Zmc2V0cywgcmF0aGVyIHRoYW4gYXMgYWJzb2x1dGUKCQkJICogcG9zaXRpb25zL25vcm1hbHMuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFNwbGl0IHRoZSBnZW9tZXRyeSBpbnRvIGdyb3VwcywgZWFjaCBvZiB3aGljaCB3aWxsIGJlIHJlbmRlcmVkIGluIGEKCQkJICogc2VwYXJhdGUgZHJhdyBjYWxsLiBUaGlzIGFsbG93cyBhbiBhcnJheSBvZiBtYXRlcmlhbHMgdG8gYmUgdXNlZCB3aXRoIHRoZSBnZW9tZXRyeS4KCQkJICoKCQkJICogVXNlIGBhZGRHcm91cCgpYCBhbmQgYGNsZWFyR3JvdXBzKClgIHRvIGVkaXQgZ3JvdXBzLCByYXRoZXIgdGhhbiBtb2RpZnlpbmcgdGhpcyBhcnJheSBkaXJlY3RseS4KCQkJICoKCQkJICogRXZlcnkgdmVydGV4IGFuZCBpbmRleCBtdXN0IGJlbG9uZyB0byBleGFjdGx5IG9uZSBncm91cCDigJQgZ3JvdXBzIG11c3Qgbm90IHNoYXJlIHZlcnRpY2VzIG9yCgkJCSAqIGluZGljZXMsIGFuZCBtdXN0IG5vdCBsZWF2ZSB2ZXJ0aWNlcyBvciBpbmRpY2VzIHVudXNlZC4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PE9iamVjdD59CgkJCSAqLwoJCQl0aGlzLmdyb3VwcyA9IFtdOwoKCQkJLyoqCgkJCSAqIEJvdW5kaW5nIGJveCBmb3IgdGhlIGdlb21ldHJ5IHdoaWNoIGNhbiBiZSBjYWxjdWxhdGVkIHdpdGggYGNvbXB1dGVCb3VuZGluZ0JveCgpYC4KCQkJICoKCQkJICogQHR5cGUge0JveDN9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoKCQkJLyoqCgkJCSAqIEJvdW5kaW5nIHNwaGVyZSBmb3IgdGhlIGdlb21ldHJ5IHdoaWNoIGNhbiBiZSBjYWxjdWxhdGVkIHdpdGggYGNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpYC4KCQkJICoKCQkJICogQHR5cGUge1NwaGVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCQkvKioKCQkJICogRGV0ZXJtaW5lcyB0aGUgcGFydCBvZiB0aGUgZ2VvbWV0cnkgdG8gcmVuZGVyLiBUaGlzIHNob3VsZCBub3QgYmUgc2V0IGRpcmVjdGx5LAoJCQkgKiBpbnN0ZWFkIHVzZSBgc2V0RHJhd1JhbmdlKClgLgoJCQkgKgoJCQkgKiBAdHlwZSB7e3N0YXJ0Om51bWJlcixjb3VudDpudW1iZXJ9fQoJCQkgKi8KCQkJdGhpcy5kcmF3UmFuZ2UgPSB7IHN0YXJ0OiAwLCBjb3VudDogSW5maW5pdHkgfTsKCgkJCS8qKgoJCQkgKiBBbiBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBzdG9yZSBjdXN0b20gZGF0YSBhYm91dCB0aGUgZ2VvbWV0cnkuCgkJCSAqIEl0IHNob3VsZCBub3QgaG9sZCByZWZlcmVuY2VzIHRvIGZ1bmN0aW9ucyBhcyB0aGVzZSB3aWxsIG5vdCBiZSBjbG9uZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLnVzZXJEYXRhID0ge307CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhpcyBnZW9tZXRyeS4KCQkgKgoJCSAqIEByZXR1cm4gez9CdWZmZXJBdHRyaWJ1dGV9IFRoZSBpbmRleC4gUmV0dXJucyBgbnVsbGAgaWYgbm8gaW5kZXggaXMgZGVmaW5lZC4KCQkgKi8KCQlnZXRJbmRleCgpIHsKCgkJCXJldHVybiB0aGlzLmluZGV4OwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGluZGV4IHRvIHRoaXMgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PG51bWJlcj58QnVmZmVyQXR0cmlidXRlfSBpbmRleCAtIFRoZSBpbmRleCB0byBzZXQuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0SW5kZXgoIGluZGV4ICkgewoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBpbmRleCApICkgewoKCQkJCXRoaXMuaW5kZXggPSBuZXcgKCBhcnJheU5lZWRzVWludDMyKCBpbmRleCApID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGV4LCAxICk7CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuaW5kZXggPSBpbmRleDsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGdpdmVuIGluZGlyZWN0IGF0dHJpYnV0ZSB0byB0aGlzIGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV9IGluZGlyZWN0IC0gVGhlIGF0dHJpYnV0ZSBob2xkaW5nIGluZGlyZWN0IGRyYXcgY2FsbHMuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0SW5kaXJlY3QoIGluZGlyZWN0ICkgewoKCQkJdGhpcy5pbmRpcmVjdCA9IGluZGlyZWN0OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgaW5kaXJlY3QgYXR0cmlidXRlIG9mIHRoaXMgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcmV0dXJuIHs/QnVmZmVyQXR0cmlidXRlfSBUaGUgaW5kaXJlY3QgYXR0cmlidXRlLiBSZXR1cm5zIGBudWxsYCBpZiBubyBpbmRpcmVjdCBhdHRyaWJ1dGUgaXMgZGVmaW5lZC4KCQkgKi8KCQlnZXRJbmRpcmVjdCgpIHsKCgkJCXJldHVybiB0aGlzLmluZGlyZWN0OwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGJ1ZmZlciBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCgkJICogQHJldHVybiB7QnVmZmVyQXR0cmlidXRlfEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlfHVuZGVmaW5lZH0gVGhlIGJ1ZmZlciBhdHRyaWJ1dGUuCgkJICogUmV0dXJucyBgdW5kZWZpbmVkYCBpZiBub3QgYXR0cmlidXRlIGhhcyBiZWVuIGZvdW5kLgoJCSAqLwoJCWdldEF0dHJpYnV0ZSggbmFtZSApIHsKCgkJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUuCgkJICogQHBhcmFtIHtCdWZmZXJBdHRyaWJ1dGV8SW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGV9IGF0dHJpYnV0ZSAtIFRoZSBhdHRyaWJ1dGUgdG8gc2V0LgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldEF0dHJpYnV0ZSggbmFtZSwgYXR0cmlidXRlICkgewoKCQkJdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF0gPSBhdHRyaWJ1dGU7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBEZWxldGVzIHRoZSBhdHRyaWJ1dGUgZm9yIHRoZSBnaXZlbiBuYW1lLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgYXR0cmlidXRlIG5hbWUgdG8gZGVsZXRlLgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWRlbGV0ZUF0dHJpYnV0ZSggbmFtZSApIHsKCgkJCWRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYHRydWVgIGlmIHRoaXMgZ2VvbWV0cnkgaGFzIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIG5hbWUuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBhdHRyaWJ1dGUgbmFtZS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgZ2VvbWV0cnkgaGFzIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIGdpdmVuIG5hbWUgb3Igbm90LgoJCSAqLwoJCWhhc0F0dHJpYnV0ZSggbmFtZSApIHsKCgkJCXJldHVybiB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkOwoKCQl9CgoJCS8qKgoJCSAqIEFkZHMgYSBncm91cCB0byB0aGlzIGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0IC0gVGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhpcyBkcmF3IGNhbGwuIFRoYXQgaXMgdGhlIGZpcnN0CgkJICogdmVydGV4IGZvciBub24taW5kZXhlZCBnZW9tZXRyeSwgb3RoZXJ3aXNlIHRoZSBmaXJzdCB0cmlhbmdsZSBpbmRleC4KCQkgKiBAcGFyYW0ge251bWJlcn0gY291bnQgLSBTcGVjaWZpZXMgaG93IG1hbnkgdmVydGljZXMgKG9yIGluZGljZXMpIGFyZSBwYXJ0IG9mIHRoaXMgZ3JvdXAuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttYXRlcmlhbEluZGV4PTBdIC0gVGhlIG1hdGVyaWFsIGFycmF5IGluZGV4IHRvIHVzZS4KCQkgKi8KCQlhZGRHcm91cCggc3RhcnQsIGNvdW50LCBtYXRlcmlhbEluZGV4ID0gMCApIHsKCgkJCXRoaXMuZ3JvdXBzLnB1c2goIHsKCgkJCQlzdGFydDogc3RhcnQsCgkJCQljb3VudDogY291bnQsCgkJCQltYXRlcmlhbEluZGV4OiBtYXRlcmlhbEluZGV4CgoJCQl9ICk7CgoJCX0KCgkJLyoqCgkJICogQ2xlYXJzIGFsbCBncm91cHMuCgkJICovCgkJY2xlYXJHcm91cHMoKSB7CgoJCQl0aGlzLmdyb3VwcyA9IFtdOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGRyYXcgcmFuZ2UgZm9yIHRoaXMgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgLSBUaGUgZmlyc3QgdmVydGV4IGZvciBub24taW5kZXhlZCBnZW9tZXRyeSwgb3RoZXJ3aXNlIHRoZSBmaXJzdCB0cmlhbmdsZSBpbmRleC4KCQkgKiBAcGFyYW0ge251bWJlcn0gY291bnQgLSBGb3Igbm9uLWluZGV4ZWQgQnVmZmVyR2VvbWV0cnksIGBjb3VudGAgaXMgdGhlIG51bWJlciBvZiB2ZXJ0aWNlcyB0byByZW5kZXIuCgkJICogRm9yIGluZGV4ZWQgQnVmZmVyR2VvbWV0cnksIGBjb3VudGAgaXMgdGhlIG51bWJlciBvZiBpbmRpY2VzIHRvIHJlbmRlci4KCQkgKi8KCQlzZXREcmF3UmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc3RhcnQ7CgkJCXRoaXMuZHJhd1JhbmdlLmNvdW50ID0gY291bnQ7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgZ2l2ZW4gNHg0IHRyYW5zZm9ybWF0aW9uIG1hdHJpeCB0byB0aGUgZ2VvbWV0cnkuCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSBtYXRyaXggdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlwb3NpdGlvbi5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJCXBvc2l0aW9uLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCWNvbnN0IG5vcm1hbCA9IHRoaXMuYXR0cmlidXRlcy5ub3JtYWw7CgoJCQlpZiAoIG5vcm1hbCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnN0IG5vcm1hbE1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCgkJCQlub3JtYWwuYXBwbHlOb3JtYWxNYXRyaXgoIG5vcm1hbE1hdHJpeCApOwoKCQkJCW5vcm1hbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCQljb25zdCB0YW5nZW50ID0gdGhpcy5hdHRyaWJ1dGVzLnRhbmdlbnQ7CgoJCQlpZiAoIHRhbmdlbnQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0YW5nZW50LnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4ICk7CgoJCQkJdGFuZ2VudC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJdGhpcy5jb21wdXRlQm91bmRpbmdCb3goKTsKCgkJCX0KCgkJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQXBwbGllcyB0aGUgcm90YXRpb24gcmVwcmVzZW50ZWQgYnkgdGhlIFF1YXRlcm5pb24gdG8gdGhlIGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtRdWF0ZXJuaW9ufSBxIC0gVGhlIFF1YXRlcm5pb24gdG8gYXBwbHkuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJYXBwbHlRdWF0ZXJuaW9uKCBxICkgewoKCQkJX20xJDMubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHEgKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgYWJvdXQgdGhlIFggYXhpcy4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCgkJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjcm90YXRpb259IGZvciB0eXBpY2FsCgkJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gYW5nbGUgLSBUaGUgYW5nbGUgaW4gcmFkaWFucy4KCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlyb3RhdGVYKCBhbmdsZSApIHsKCgkJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgeC1heGlzCgoJCQlfbTEkMy5tYWtlUm90YXRpb25YKCBhbmdsZSApOwoKCQkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSQzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSb3RhdGVzIHRoZSBnZW9tZXRyeSBhYm91dCB0aGUgWSBheGlzLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKCQkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNyb3RhdGlvbn0gZm9yIHR5cGljYWwKCQkgKiByZWFsLXRpbWUgbWVzaCByb3RhdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZSAtIFRoZSBhbmdsZSBpbiByYWRpYW5zLgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXJvdGF0ZVkoIGFuZ2xlICkgewoKCQkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB5LWF4aXMKCgkJCV9tMSQzLm1ha2VSb3RhdGlvblkoIGFuZ2xlICk7CgoJCQl0aGlzLmFwcGx5TWF0cml4NCggX20xJDMgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJvdGF0ZXMgdGhlIGdlb21ldHJ5IGFib3V0IHRoZSBaIGF4aXMuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQoJCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3JvdGF0aW9ufSBmb3IgdHlwaWNhbAoJCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGFuZ2xlIC0gVGhlIGFuZ2xlIGluIHJhZGlhbnMuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJcm90YXRlWiggYW5nbGUgKSB7CgoJCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHotYXhpcwoKCQkJX20xJDMubWFrZVJvdGF0aW9uWiggYW5nbGUgKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogVHJhbnNsYXRlcyB0aGUgZ2VvbWV0cnkuIFRoaXMgaXMgdHlwaWNhbGx5IGRvbmUgYXMgYSBvbmUgdGltZQoJCSAqIG9wZXJhdGlvbiwgYW5kIG5vdCBkdXJpbmcgYSBsb29wLiBVc2Uge0BsaW5rIE9iamVjdDNEI3Bvc2l0aW9ufSBmb3IgdHlwaWNhbAoJCSAqIHJlYWwtdGltZSBtZXNoIHJvdGF0aW9uLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgeCBvZmZzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgeSBvZmZzZXQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBvZmZzZXQuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJdHJhbnNsYXRlKCB4LCB5LCB6ICkgewoKCQkJLy8gdHJhbnNsYXRlIGdlb21ldHJ5CgoJCQlfbTEkMy5tYWtlVHJhbnNsYXRpb24oIHgsIHksIHogKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2NhbGVzIHRoZSBnZW9tZXRyeS4gVGhpcyBpcyB0eXBpY2FsbHkgZG9uZSBhcyBhIG9uZSB0aW1lCgkJICogb3BlcmF0aW9uLCBhbmQgbm90IGR1cmluZyBhIGxvb3AuIFVzZSB7QGxpbmsgT2JqZWN0M0Qjc2NhbGV9IGZvciB0eXBpY2FsCgkJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0geCAtIFRoZSB4IHNjYWxlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHkgc2NhbGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IHogLSBUaGUgeiBzY2FsZS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzY2FsZSggeCwgeSwgeiApIHsKCgkJCS8vIHNjYWxlIGdlb21ldHJ5CgoJCQlfbTEkMy5tYWtlU2NhbGUoIHgsIHksIHogKTsKCgkJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEkMyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUm90YXRlcyB0aGUgZ2VvbWV0cnkgdG8gZmFjZSBhIHBvaW50IGluIDNEIHNwYWNlLiBUaGlzIGlzIHR5cGljYWxseSBkb25lIGFzIGEgb25lIHRpbWUKCQkgKiBvcGVyYXRpb24sIGFuZCBub3QgZHVyaW5nIGEgbG9vcC4gVXNlIHtAbGluayBPYmplY3QzRCNsb29rQXR9IGZvciB0eXBpY2FsCgkJICogcmVhbC10aW1lIG1lc2ggcm90YXRpb24uCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHZlY3RvciAtIFRoZSB0YXJnZXQgcG9pbnQuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJbG9va0F0KCB2ZWN0b3IgKSB7CgoJCQlfb2JqLmxvb2tBdCggdmVjdG9yICk7CgoJCQlfb2JqLnVwZGF0ZU1hdHJpeCgpOwoKCQkJdGhpcy5hcHBseU1hdHJpeDQoIF9vYmoubWF0cml4ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDZW50ZXIgdGhlIGdlb21ldHJ5IGJhc2VkIG9uIGl0cyBib3VuZGluZyBib3guCgkJICoKCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljZW50ZXIoKSB7CgoJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJdGhpcy5ib3VuZGluZ0JveC5nZXRDZW50ZXIoIF9vZmZzZXQgKS5uZWdhdGUoKTsKCgkJCXRoaXMudHJhbnNsYXRlKCBfb2Zmc2V0LngsIF9vZmZzZXQueSwgX29mZnNldC56ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBEZWZpbmVzIGEgZ2VvbWV0cnkgYnkgY3JlYXRpbmcgYSBgcG9zaXRpb25gIGF0dHJpYnV0ZSBiYXNlZCBvbiB0aGUgZ2l2ZW4gYXJyYXkgb2YgcG9pbnRzLiBUaGUgYXJyYXkKCQkgKiBjYW4gaG9sZCAyRCBvciAzRCB2ZWN0b3JzLiBXaGVuIHVzaW5nIHR3by1kaW1lbnNpb25hbCBkYXRhLCB0aGUgYHpgIGNvb3JkaW5hdGUgZm9yIGFsbCB2ZXJ0aWNlcyBpcwoJCSAqIHNldCB0byBgMGAuCgkJICoKCQkgKiBJZiB0aGUgbWV0aG9kIGlzIHVzZWQgd2l0aCBhbiBleGlzdGluZyBgcG9zaXRpb25gIGF0dHJpYnV0ZSwgdGhlIHZlcnRleCBkYXRhIGFyZSBvdmVyd3JpdHRlbiB3aXRoIHRoZQoJCSAqIGRhdGEgZnJvbSB0aGUgYXJyYXkuIFRoZSBsZW5ndGggb2YgdGhlIGFycmF5IG11c3QgbWF0Y2ggdGhlIHZlcnRleCBjb3VudC4KCQkgKgoJCSAqIEBwYXJhbSB7QXJyYXk8VmVjdG9yMj58QXJyYXk8VmVjdG9yMz59IHBvaW50cyAtIFRoZSBwb2ludHMuCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0RnJvbVBvaW50cyggcG9pbnRzICkgewoKCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQkJaWYgKCBwb3NpdGlvbkF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnN0IHBvc2l0aW9uID0gW107CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHBvaW50ID0gcG9pbnRzWyBpIF07CgkJCQkJcG9zaXRpb24ucHVzaCggcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgoJCQkJfQoKCQkJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIDMgKSApOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCBsID0gTWF0aC5taW4oIHBvaW50cy5sZW5ndGgsIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICk7IC8vIG1ha2Ugc3VyZSBkYXRhIGRvIG5vdCBleGNlZWQgYnVmZmVyIHNpemUKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsOyBpICsrICkgewoKCQkJCQljb25zdCBwb2ludCA9IHBvaW50c1sgaSBdOwoJCQkJCXBvc2l0aW9uQXR0cmlidXRlLnNldFhZWiggaSwgcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgoJCQkJfQoKCQkJCWlmICggcG9pbnRzLmxlbmd0aCA+IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50ICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5CdWZmZXJHZW9tZXRyeTogQnVmZmVyIHNpemUgdG9vIHNtYWxsIGZvciBwb2ludHMgZGF0YS4gVXNlIC5kaXNwb3NlKCkgYW5kIGNyZWF0ZSBhIG5ldyBnZW9tZXRyeS4nICk7CgoJCQkJfQoKCQkJCXBvc2l0aW9uQXR0cmlidXRlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIGdlb21ldHJ5LCBhbmQgdXBkYXRlcyB0aGUgYGJvdW5kaW5nQm94YCBtZW1iZXIuCgkJICogVGhlIGJvdW5kaW5nIGJveCBpcyBub3QgY29tcHV0ZWQgYnkgdGhlIGVuZ2luZTsgaXQgbXVzdCBiZSBjb21wdXRlZCBieSB5b3VyIGFwcC4KCQkgKiBZb3UgbWF5IG5lZWQgdG8gcmVjb21wdXRlIHRoZSBib3VuZGluZyBib3ggaWYgdGhlIGdlb21ldHJ5IHZlcnRpY2VzIGFyZSBtb2RpZmllZC4KCQkgKi8KCQljb21wdXRlQm91bmRpbmdCb3goKSB7CgoJCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQkJdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgoJCQl9CgoJCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nQm94KCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIGJveC4nLCB0aGlzICk7CgoJCQkJdGhpcy5ib3VuZGluZ0JveC5zZXQoCgkJCQkJbmV3IFZlY3RvcjMoIC0gSW5maW5pdHksIC0gSW5maW5pdHksIC0gSW5maW5pdHkgKSwKCQkJCQluZXcgVmVjdG9yMyggKyBJbmZpbml0eSwgKyBJbmZpbml0eSwgKyBJbmZpbml0eSApCgkJCQkpOwoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nQm94LnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgoJCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJCV9ib3gkMi5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKCQkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCB0aGlzLmJvdW5kaW5nQm94Lm1pbiwgX2JveCQyLm1pbiApOwoJCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDggKTsKCgkJCQkJCQlfdmVjdG9yJDguYWRkVmVjdG9ycyggdGhpcy5ib3VuZGluZ0JveC5tYXgsIF9ib3gkMi5tYXggKTsKCQkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ4ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX2JveCQyLm1pbiApOwoJCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfYm94JDIubWF4ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXRoaXMuYm91bmRpbmdCb3gubWFrZUVtcHR5KCk7CgoJCQl9CgoJCQlpZiAoIGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi54ICkgfHwgaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnkgKSB8fCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueiApICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogQ29tcHV0ZWQgbWluL21heCBoYXZlIE5hTiB2YWx1ZXMuIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBDb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIG9mIHRoZSBnZW9tZXRyeSwgYW5kIHVwZGF0ZXMgdGhlIGBib3VuZGluZ1NwaGVyZWAgbWVtYmVyLgoJCSAqIFRoZSBlbmdpbmUgYXV0b21hdGljYWxseSBjb21wdXRlcyB0aGUgYm91bmRpbmcgc3BoZXJlIHdoZW4gaXQgaXMgbmVlZGVkLCBlLmcuLCBmb3IgcmF5IGNhc3Rpbmcgb3IgdmlldyBmcnVzdHVtIGN1bGxpbmcuCgkJICogWW91IG1heSBuZWVkIHRvIHJlY29tcHV0ZSB0aGUgYm91bmRpbmcgc3BoZXJlIGlmIHRoZSBnZW9tZXRyeSB2ZXJ0aWNlcyBhcmUgbW9kaWZpZWQuCgkJICovCgkJY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCkgewoKCQkJaWYgKCB0aGlzLmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgewoKCQkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCQl9CgoJCQljb25zdCBwb3NpdGlvbiA9IHRoaXMuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk6IEdMQnVmZmVyQXR0cmlidXRlIHJlcXVpcmVzIGEgbWFudWFsIGJvdW5kaW5nIHNwaGVyZS4nLCB0aGlzICk7CgoJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5zZXQoIG5ldyBWZWN0b3IzKCksIEluZmluaXR5ICk7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBwb3NpdGlvbiApIHsKCgkJCQkvLyBmaXJzdCwgZmluZCB0aGUgY2VudGVyIG9mIHRoZSBib3VuZGluZyBzcGhlcmUKCgkJCQljb25zdCBjZW50ZXIgPSB0aGlzLmJvdW5kaW5nU3BoZXJlLmNlbnRlcjsKCgkJCQlfYm94JDIuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24gKTsKCgkJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKCQkJCWlmICggbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gKSB7CgoJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKCQkJCQkJX2JveE1vcnBoVGFyZ2V0cy5zZXRGcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSApOwoKCQkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWluLCBfYm94TW9ycGhUYXJnZXRzLm1pbiApOwoJCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKCQkJCQkJCV92ZWN0b3IkOC5hZGRWZWN0b3JzKCBfYm94JDIubWF4LCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoJCQkJCQkJX2JveCQyLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkOCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlfYm94JDIuZXhwYW5kQnlQb2ludCggX2JveE1vcnBoVGFyZ2V0cy5taW4gKTsKCQkJCQkJCV9ib3gkMi5leHBhbmRCeVBvaW50KCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCV9ib3gkMi5nZXRDZW50ZXIoIGNlbnRlciApOwoKCQkJCS8vIHNlY29uZCwgdHJ5IHRvIGZpbmQgYSBib3VuZGluZ1NwaGVyZSB3aXRoIGEgcmFkaXVzIHNtYWxsZXIgdGhhbiB0aGUKCQkJCS8vIGJvdW5kaW5nU3BoZXJlIG9mIHRoZSBib3VuZGluZ0JveDogc3FydCgzKSBzbWFsbGVyIGluIHRoZSBiZXN0IGNhc2UKCgkJCQlsZXQgbWF4UmFkaXVzU3EgPSAwOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb3NpdGlvbi5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGkgKTsKCgkJCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggX3ZlY3RvciQ4ICkgKTsKCgkJCQl9CgoJCQkJLy8gcHJvY2VzcyBtb3JwaCBhdHRyaWJ1dGVzIGlmIHByZXNlbnQKCgkJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uWyBpIF07CgkJCQkJCWNvbnN0IG1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJCQkJCWZvciAoIGxldCBqID0gMCwgamwgPSBtb3JwaEF0dHJpYnV0ZS5jb3VudDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJCV92ZWN0b3IkOC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgaiApOwoKCQkJCQkJCWlmICggbW9ycGhUYXJnZXRzUmVsYXRpdmUgKSB7CgoJCQkJCQkJCV9vZmZzZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGogKTsKCQkJCQkJCQlfdmVjdG9yJDguYWRkKCBfb2Zmc2V0ICk7CgoJCQkJCQkJfQoKCQkJCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IkOCApICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgPSBNYXRoLnNxcnQoIG1heFJhZGl1c1NxICk7CgoJCQkJaWYgKCBpc05hTiggdGhpcy5ib3VuZGluZ1NwaGVyZS5yYWRpdXMgKSApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIENhbGN1bGF0ZXMgYW5kIGFkZHMgYSB0YW5nZW50IGF0dHJpYnV0ZSB0byB0aGlzIGdlb21ldHJ5LgoJCSAqCgkJICogVGhlIGNvbXB1dGF0aW9uIGlzIG9ubHkgc3VwcG9ydGVkIGZvciBpbmRleGVkIGdlb21ldHJpZXMgYW5kIGlmIHBvc2l0aW9uLCBub3JtYWwsIGFuZCB1diBhdHRyaWJ1dGVzCgkJICogYXJlIGRlZmluZWQuIFdoZW4gdXNpbmcgYSB0YW5nZW50IHNwYWNlIG5vcm1hbCBtYXAsIHByZWZlciB0aGUgTWlra1RTcGFjZSBhbGdvcml0aG0gcHJvdmlkZWQgYnkKCQkgKiB7QGxpbmsgQnVmZmVyR2VvbWV0cnlVdGlscyNjb21wdXRlTWlra1RTcGFjZVRhbmdlbnRzfSBpbnN0ZWFkLgoJCSAqLwoJCWNvbXB1dGVUYW5nZW50cygpIHsKCgkJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCQkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJCS8vIGJhc2VkIG9uIGh0dHA6Ly93d3cudGVyYXRob24uY29tL2NvZGUvdGFuZ2VudC5odG1sCgkJCS8vIChwZXIgdmVydGV4IHRhbmdlbnRzKQoKCQkJaWYgKCBpbmRleCA9PT0gbnVsbCB8fAoJCQkJIGF0dHJpYnV0ZXMucG9zaXRpb24gPT09IHVuZGVmaW5lZCB8fAoJCQkJIGF0dHJpYnV0ZXMubm9ybWFsID09PSB1bmRlZmluZWQgfHwKCQkJCSBhdHRyaWJ1dGVzLnV2ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5OiAuY29tcHV0ZVRhbmdlbnRzKCkgZmFpbGVkLiBNaXNzaW5nIHJlcXVpcmVkIGF0dHJpYnV0ZXMgKGluZGV4LCBwb3NpdGlvbiwgbm9ybWFsIG9yIHV2KScgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3Qgbm9ybWFsQXR0cmlidXRlID0gYXR0cmlidXRlcy5ub3JtYWw7CgkJCWNvbnN0IHV2QXR0cmlidXRlID0gYXR0cmlidXRlcy51djsKCgkJCWlmICggdGhpcy5oYXNBdHRyaWJ1dGUoICd0YW5nZW50JyApID09PSBmYWxzZSApIHsKCgkJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3RhbmdlbnQnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBuZXcgRmxvYXQzMkFycmF5KCA0ICogcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKSwgNCApICk7CgoJCQl9CgoJCQljb25zdCB0YW5nZW50QXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICd0YW5nZW50JyApOwoKCQkJY29uc3QgdGFuMSA9IFtdLCB0YW4yID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSArKyApIHsKCgkJCQl0YW4xWyBpIF0gPSBuZXcgVmVjdG9yMygpOwoJCQkJdGFuMlsgaSBdID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCWNvbnN0IHZBID0gbmV3IFZlY3RvcjMoKSwKCQkJCXZCID0gbmV3IFZlY3RvcjMoKSwKCQkJCXZDID0gbmV3IFZlY3RvcjMoKSwKCgkJCQl1dkEgPSBuZXcgVmVjdG9yMigpLAoJCQkJdXZCID0gbmV3IFZlY3RvcjIoKSwKCQkJCXV2QyA9IG5ldyBWZWN0b3IyKCksCgoJCQkJc2RpciA9IG5ldyBWZWN0b3IzKCksCgkJCQl0ZGlyID0gbmV3IFZlY3RvcjMoKTsKCgkJCWZ1bmN0aW9uIGhhbmRsZVRyaWFuZ2xlKCBhLCBiLCBjICkgewoKCQkJCXZBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBhICk7CgkJCQl2Qi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgYiApOwoJCQkJdkMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGMgKTsKCgkJCQl1dkEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXZBdHRyaWJ1dGUsIGEgKTsKCQkJCXV2Qi5mcm9tQnVmZmVyQXR0cmlidXRlKCB1dkF0dHJpYnV0ZSwgYiApOwoJCQkJdXZDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2QXR0cmlidXRlLCBjICk7CgoJCQkJdkIuc3ViKCB2QSApOwoJCQkJdkMuc3ViKCB2QSApOwoKCQkJCXV2Qi5zdWIoIHV2QSApOwoJCQkJdXZDLnN1YiggdXZBICk7CgoJCQkJY29uc3QgciA9IDEuMCAvICggdXZCLnggKiB1dkMueSAtIHV2Qy54ICogdXZCLnkgKTsKCgkJCQkvLyBzaWxlbnRseSBpZ25vcmUgZGVnZW5lcmF0ZSB1diB0cmlhbmdsZXMgaGF2aW5nIGNvaW5jaWRlbnQgb3IgY29saW5lYXIgdmVydGljZXMKCgkJCQlpZiAoICEgaXNGaW5pdGUoIHIgKSApIHJldHVybjsKCgkJCQlzZGlyLmNvcHkoIHZCICkubXVsdGlwbHlTY2FsYXIoIHV2Qy55ICkuYWRkU2NhbGVkVmVjdG9yKCB2QywgLSB1dkIueSApLm11bHRpcGx5U2NhbGFyKCByICk7CgkJCQl0ZGlyLmNvcHkoIHZDICkubXVsdGlwbHlTY2FsYXIoIHV2Qi54ICkuYWRkU2NhbGVkVmVjdG9yKCB2QiwgLSB1dkMueCApLm11bHRpcGx5U2NhbGFyKCByICk7CgoJCQkJdGFuMVsgYSBdLmFkZCggc2RpciApOwoJCQkJdGFuMVsgYiBdLmFkZCggc2RpciApOwoJCQkJdGFuMVsgYyBdLmFkZCggc2RpciApOwoKCQkJCXRhbjJbIGEgXS5hZGQoIHRkaXIgKTsKCQkJCXRhbjJbIGIgXS5hZGQoIHRkaXIgKTsKCQkJCXRhbjJbIGMgXS5hZGQoIHRkaXIgKTsKCgkJCX0KCgkJCWxldCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJCWlmICggZ3JvdXBzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQlncm91cHMgPSBbIHsKCQkJCQlzdGFydDogMCwKCQkJCQljb3VudDogaW5kZXguY291bnQKCQkJCX0gXTsKCgkJCX0KCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBncm91cHMubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgoJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCgkJCQljb25zdCBzdGFydCA9IGdyb3VwLnN0YXJ0OwoJCQkJY29uc3QgY291bnQgPSBncm91cC5jb3VudDsKCgkJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IHN0YXJ0ICsgY291bnQ7IGogPCBqbDsgaiArPSAzICkgewoKCQkJCQloYW5kbGVUcmlhbmdsZSgKCQkJCQkJaW5kZXguZ2V0WCggaiArIDAgKSwKCQkJCQkJaW5kZXguZ2V0WCggaiArIDEgKSwKCQkJCQkJaW5kZXguZ2V0WCggaiArIDIgKQoJCQkJCSk7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgdG1wID0gbmV3IFZlY3RvcjMoKSwgdG1wMiA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IG4gPSBuZXcgVmVjdG9yMygpLCBuMiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlmdW5jdGlvbiBoYW5kbGVWZXJ0ZXgoIHYgKSB7CgoJCQkJbi5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHYgKTsKCQkJCW4yLmNvcHkoIG4gKTsKCgkJCQljb25zdCB0ID0gdGFuMVsgdiBdOwoKCQkJCS8vIEdyYW0tU2NobWlkdCBvcnRob2dvbmFsaXplCgoJCQkJdG1wLmNvcHkoIHQgKTsKCQkJCXRtcC5zdWIoIG4ubXVsdGlwbHlTY2FsYXIoIG4uZG90KCB0ICkgKSApLm5vcm1hbGl6ZSgpOwoKCQkJCS8vIENhbGN1bGF0ZSBoYW5kZWRuZXNzCgoJCQkJdG1wMi5jcm9zc1ZlY3RvcnMoIG4yLCB0ICk7CgkJCQljb25zdCB0ZXN0ID0gdG1wMi5kb3QoIHRhbjJbIHYgXSApOwoJCQkJY29uc3QgdyA9ICggdGVzdCA8IDAuMCApID8gLTEgOiAxLjA7CgoJCQkJdGFuZ2VudEF0dHJpYnV0ZS5zZXRYWVpXKCB2LCB0bXAueCwgdG1wLnksIHRtcC56LCB3ICk7CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyArKyBpICkgewoKCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgoJCQkJY29uc3Qgc3RhcnQgPSBncm91cC5zdGFydDsKCQkJCWNvbnN0IGNvdW50ID0gZ3JvdXAuY291bnQ7CgoJCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMCApICk7CgkJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMSApICk7CgkJCQkJaGFuZGxlVmVydGV4KCBpbmRleC5nZXRYKCBqICsgMiApICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIENvbXB1dGVzIHZlcnRleCBub3JtYWxzIGZvciB0aGUgZ2l2ZW4gdmVydGV4IGRhdGEuIEZvciBpbmRleGVkIGdlb21ldHJpZXMsIHRoZSBtZXRob2Qgc2V0cwoJCSAqIGVhY2ggdmVydGV4IG5vcm1hbCB0byBiZSB0aGUgYXZlcmFnZSBvZiB0aGUgZmFjZSBub3JtYWxzIG9mIHRoZSBmYWNlcyB0aGF0IHNoYXJlIHRoYXQgdmVydGV4LgoJCSAqIEZvciBub24taW5kZXhlZCBnZW9tZXRyaWVzLCB2ZXJ0aWNlcyBhcmUgbm90IHNoYXJlZCwgYW5kIHRoZSBtZXRob2Qgc2V0cyBlYWNoIHZlcnRleCBub3JtYWwKCQkgKiB0byBiZSB0aGUgc2FtZSBhcyB0aGUgZmFjZSBub3JtYWwuCgkJICovCgkJY29tcHV0ZVZlcnRleE5vcm1hbHMoKSB7CgoJCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CgkJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCgkJCWlmICggcG9zaXRpb25BdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlsZXQgbm9ybWFsQXR0cmlidXRlID0gdGhpcy5nZXRBdHRyaWJ1dGUoICdub3JtYWwnICk7CgoJCQkJaWYgKCBub3JtYWxBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJbm9ybWFsQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKiAzICksIDMgKTsKCQkJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5vcm1hbEF0dHJpYnV0ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHJlc2V0IGV4aXN0aW5nIG5vcm1hbHMgdG8gemVybwoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbm9ybWFsQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpLCAwLCAwLCAwICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJY29uc3QgcEEgPSBuZXcgVmVjdG9yMygpLCBwQiA9IG5ldyBWZWN0b3IzKCksIHBDID0gbmV3IFZlY3RvcjMoKTsKCQkJCWNvbnN0IG5BID0gbmV3IFZlY3RvcjMoKSwgbkIgPSBuZXcgVmVjdG9yMygpLCBuQyA9IG5ldyBWZWN0b3IzKCk7CgkJCQljb25zdCBjYiA9IG5ldyBWZWN0b3IzKCksIGFiID0gbmV3IFZlY3RvcjMoKTsKCgkJCQkvLyBpbmRleGVkIGVsZW1lbnRzCgoJCQkJaWYgKCBpbmRleCApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGluZGV4LmNvdW50OyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJCWNvbnN0IHZBID0gaW5kZXguZ2V0WCggaSArIDAgKTsKCQkJCQkJY29uc3QgdkIgPSBpbmRleC5nZXRYKCBpICsgMSApOwoJCQkJCQljb25zdCB2QyA9IGluZGV4LmdldFgoIGkgKyAyICk7CgoJCQkJCQlwQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgdkEgKTsKCQkJCQkJcEIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZCICk7CgkJCQkJCXBDLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCB2QyApOwoKCQkJCQkJY2Iuc3ViVmVjdG9ycyggcEMsIHBCICk7CgkJCQkJCWFiLnN1YlZlY3RvcnMoIHBBLCBwQiApOwoJCQkJCQljYi5jcm9zcyggYWIgKTsKCgkJCQkJCW5BLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbEF0dHJpYnV0ZSwgdkEgKTsKCQkJCQkJbkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2QiApOwoJCQkJCQluQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHZDICk7CgoJCQkJCQluQS5hZGQoIGNiICk7CgkJCQkJCW5CLmFkZCggY2IgKTsKCQkJCQkJbkMuYWRkKCBjYiApOwoKCQkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkEsIG5BLngsIG5BLnksIG5BLnogKTsKCQkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkIsIG5CLngsIG5CLnksIG5CLnogKTsKCQkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkMsIG5DLngsIG5DLnksIG5DLnogKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIG5vbi1pbmRleGVkIGVsZW1lbnRzICh1bmNvbm5lY3RlZCB0cmlhbmdsZSBzb3VwKQoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQkJcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAwICk7CgkJCQkJCXBCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICsgMSApOwoJCQkJCQlwQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDIgKTsKCgkJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwoJCQkJCQlhYi5zdWJWZWN0b3JzKCBwQSwgcEIgKTsKCQkJCQkJY2IuY3Jvc3MoIGFiICk7CgoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMCwgY2IueCwgY2IueSwgY2IueiApOwoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMSwgY2IueCwgY2IueSwgY2IueiApOwoJCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMiwgY2IueCwgY2IueSwgY2IueiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOwoKCQkJCW5vcm1hbEF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogRW5zdXJlcyBldmVyeSBub3JtYWwgdmVjdG9yIGluIGEgZ2VvbWV0cnkgd2lsbCBoYXZlIGEgbWFnbml0dWRlIG9mIGAxYC4gVGhpcyB3aWxsCgkJICogY29ycmVjdCBsaWdodGluZyBvbiB0aGUgZ2VvbWV0cnkgc3VyZmFjZXMuCgkJICovCgkJbm9ybWFsaXplTm9ybWFscygpIHsKCgkJCWNvbnN0IG5vcm1hbHMgPSB0aGlzLmF0dHJpYnV0ZXMubm9ybWFsOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5vcm1hbHMuY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCgkJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgaSApOwoKCQkJCV92ZWN0b3IkOC5ub3JtYWxpemUoKTsKCgkJCQlub3JtYWxzLnNldFhZWiggaSwgX3ZlY3RvciQ4LngsIF92ZWN0b3IkOC55LCBfdmVjdG9yJDgueiApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFJldHVybiBhIG5ldyBub24taW5kZXggdmVyc2lvbiBvZiB0aGlzIGluZGV4ZWQgZ2VvbWV0cnkuIElmIHRoZSBnZW9tZXRyeQoJCSAqIGlzIGFscmVhZHkgbm9uLWluZGV4ZWQsIHRoZSBtZXRob2QgaXMgYSBOT09QLgoJCSAqCgkJICogQHJldHVybiB7QnVmZmVyR2VvbWV0cnl9IFRoZSBub24taW5kZXhlZCB2ZXJzaW9uIG9mIHRoaXMgaW5kZXhlZCBnZW9tZXRyeS4KCQkgKi8KCQl0b05vbkluZGV4ZWQoKSB7CgoJCQlmdW5jdGlvbiBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CgkJCQljb25zdCBpdGVtU2l6ZSA9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKCQkJCWNvbnN0IG5vcm1hbGl6ZWQgPSBhdHRyaWJ1dGUubm9ybWFsaXplZDsKCgkJCQljb25zdCBhcnJheTIgPSBuZXcgYXJyYXkuY29uc3RydWN0b3IoIGluZGljZXMubGVuZ3RoICogaXRlbVNpemUgKTsKCgkJCQlsZXQgaW5kZXggPSAwLCBpbmRleDIgPSAwOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGluZGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogYXR0cmlidXRlLmRhdGEuc3RyaWRlICsgYXR0cmlidXRlLm9mZnNldDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogaXRlbVNpemU7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgaXRlbVNpemU7IGogKysgKSB7CgoJCQkJCQlhcnJheTJbIGluZGV4MiArKyBdID0gYXJyYXlbIGluZGV4ICsrIF07CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGFycmF5MiwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKTsKCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHRoaXMuaW5kZXggPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuJyApOwoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9CgoJCQljb25zdCBnZW9tZXRyeTIgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJCWNvbnN0IGluZGljZXMgPSB0aGlzLmluZGV4LmFycmF5OwoJCQljb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKCQkJLy8gYXR0cmlidXRlcwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCQlnZW9tZXRyeTIuc2V0QXR0cmlidXRlKCBuYW1lLCBuZXdBdHRyaWJ1dGUgKTsKCgkJCX0KCgkJCS8vIG1vcnBoIGF0dHJpYnV0ZXMKCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzOwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgbW9ycGhBcnJheSA9IFtdOwoJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsgLy8gbW9ycGhBdHRyaWJ1dGU6IGFycmF5IG9mIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGVzCgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBhdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZVsgaSBdOwoKCQkJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCQkJbW9ycGhBcnJheS5wdXNoKCBuZXdBdHRyaWJ1dGUgKTsKCgkJCQl9CgoJCQkJZ2VvbWV0cnkyLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gbW9ycGhBcnJheTsKCgkJCX0KCgkJCWdlb21ldHJ5Mi5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCQkvLyBncm91cHMKCgkJCWNvbnN0IGdyb3VwcyA9IHRoaXMuZ3JvdXBzOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCWdlb21ldHJ5Mi5hZGRHcm91cCggZ3JvdXAuc3RhcnQsIGdyb3VwLmNvdW50LCBncm91cC5tYXRlcmlhbEluZGV4ICk7CgoJCQl9CgoJCQlyZXR1cm4gZ2VvbWV0cnkyOwoKCQl9CgoJCS8qKgoJCSAqIFNlcmlhbGl6ZXMgdGhlIGdlb21ldHJ5IGludG8gSlNPTi4KCQkgKgoJCSAqIEByZXR1cm4ge09iamVjdH0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCgkJICovCgkJdG9KU09OKCkgewoKCQkJY29uc3QgZGF0YSA9IHsKCQkJCW1ldGFkYXRhOiB7CgkJCQkJdmVyc2lvbjogNC43LAoJCQkJCXR5cGU6ICdCdWZmZXJHZW9tZXRyeScsCgkJCQkJZ2VuZXJhdG9yOiAnQnVmZmVyR2VvbWV0cnkudG9KU09OJwoJCQkJfQoJCQl9OwoKCQkJLy8gc3RhbmRhcmQgQnVmZmVyR2VvbWV0cnkgc2VyaWFsaXphdGlvbgoKCQkJZGF0YS51dWlkID0gdGhpcy51dWlkOwoJCQlkYXRhLnR5cGUgPSB0aGlzLnR5cGU7CgkJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIGRhdGEubmFtZSA9IHRoaXMubmFtZTsKCQkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBkYXRhLnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJCWlmICggdGhpcy5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVyczsKCgkJCQlmb3IgKCBjb25zdCBrZXkgaW4gcGFyYW1ldGVycyApIHsKCgkJCQkJaWYgKCBwYXJhbWV0ZXJzWyBrZXkgXSAhPT0gdW5kZWZpbmVkICkgZGF0YVsga2V5IF0gPSBwYXJhbWV0ZXJzWyBrZXkgXTsKCgkJCQl9CgoJCQkJcmV0dXJuIGRhdGE7CgoJCQl9CgoJCQkvLyBmb3Igc2ltcGxpY2l0eSB0aGUgY29kZSBhc3N1bWVzIGF0dHJpYnV0ZXMgYXJlIG5vdCBzaGFyZWQgYWNyb3NzIGdlb21ldHJpZXMsIHNlZSAjMTU4MTEKCgkJCWRhdGEuZGF0YSA9IHsgYXR0cmlidXRlczoge30gfTsKCgkJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCgkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJZGF0YS5kYXRhLmluZGV4ID0gewoJCQkJCXR5cGU6IGluZGV4LmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQkJYXJyYXk6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBpbmRleC5hcnJheSApCgkJCQl9OwoKCQkJfQoKCQkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzICkgewoKCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoKCQkJCWRhdGEuZGF0YS5hdHRyaWJ1dGVzWyBrZXkgXSA9IGF0dHJpYnV0ZS50b0pTT04oIGRhdGEuZGF0YSApOwoKCQkJfQoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0ge307CgkJCWxldCBoYXNNb3JwaEF0dHJpYnV0ZXMgPSBmYWxzZTsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiB0aGlzLm1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQljb25zdCBhdHRyaWJ1dGVBcnJheSA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzWyBrZXkgXTsKCgkJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhdHRyaWJ1dGVBcnJheS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlQXJyYXlbIGkgXTsKCgkJCQkJYXJyYXkucHVzaCggYXR0cmlidXRlLnRvSlNPTiggZGF0YS5kYXRhICkgKTsKCgkJCQl9CgoJCQkJaWYgKCBhcnJheS5sZW5ndGggPiAwICkgewoKCQkJCQltb3JwaEF0dHJpYnV0ZXNbIGtleSBdID0gYXJyYXk7CgoJCQkJCWhhc01vcnBoQXR0cmlidXRlcyA9IHRydWU7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBoYXNNb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJZGF0YS5kYXRhLm1vcnBoQXR0cmlidXRlcyA9IG1vcnBoQXR0cmlidXRlczsKCQkJCWRhdGEuZGF0YS5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCQl9CgoJCQljb25zdCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJCWlmICggZ3JvdXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJZGF0YS5kYXRhLmdyb3VwcyA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBncm91cHMgKSApOwoKCQkJfQoKCQkJY29uc3QgYm91bmRpbmdTcGhlcmUgPSB0aGlzLmJvdW5kaW5nU3BoZXJlOwoKCQkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQlkYXRhLmRhdGEuYm91bmRpbmdTcGhlcmUgPSBib3VuZGluZ1NwaGVyZS50b0pTT04oKTsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBuZXcgZ2VvbWV0cnkgd2l0aCBjb3BpZWQgdmFsdWVzIGZyb20gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEByZXR1cm4ge0J1ZmZlckdlb21ldHJ5fSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGdlb21ldHJ5IHRvIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBzb3VyY2UgLSBUaGUgZ2VvbWV0cnkgdG8gY29weS4KCQkgKiBAcmV0dXJuIHtCdWZmZXJHZW9tZXRyeX0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljb3B5KCBzb3VyY2UgKSB7CgoJCQkvLyByZXNldAoKCQkJdGhpcy5pbmRleCA9IG51bGw7CgkJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoJCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwoJCQl0aGlzLmdyb3VwcyA9IFtdOwoJCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCQkvLyB1c2VkIGZvciBzdG9yaW5nIGNsb25lZCwgc2hhcmVkIGRhdGEKCgkJCWNvbnN0IGRhdGEgPSB7fTsKCgkJCS8vIG5hbWUKCgkJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQkJLy8gaW5kZXgKCgkJCWNvbnN0IGluZGV4ID0gc291cmNlLmluZGV4OwoKCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLnNldEluZGV4KCBpbmRleC5jbG9uZSgpICk7CgoJCQl9CgoJCQkvLyBhdHRyaWJ1dGVzCgoJCQljb25zdCBhdHRyaWJ1dGVzID0gc291cmNlLmF0dHJpYnV0ZXM7CgoJCQlmb3IgKCBjb25zdCBuYW1lIGluIGF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlc1sgbmFtZSBdOwoJCQkJdGhpcy5zZXRBdHRyaWJ1dGUoIG5hbWUsIGF0dHJpYnV0ZS5jbG9uZSggZGF0YSApICk7CgoJCQl9CgoJCQkvLyBtb3JwaCBhdHRyaWJ1dGVzCgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBzb3VyY2UubW9ycGhBdHRyaWJ1dGVzOwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBtb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBbXTsKCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF07IC8vIG1vcnBoQXR0cmlidXRlOiBhcnJheSBvZiBGbG9hdDMyQnVmZmVyQXR0cmlidXRlcwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWFycmF5LnB1c2goIG1vcnBoQXR0cmlidXRlWyBpIF0uY2xvbmUoIGRhdGEgKSApOwoKCQkJCX0KCgkJCQl0aGlzLm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdID0gYXJyYXk7CgoJCQl9CgoJCQl0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gc291cmNlLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKCQkJLy8gZ3JvdXBzCgoJCQljb25zdCBncm91cHMgPSBzb3VyY2UuZ3JvdXBzOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCXRoaXMuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKCQkJfQoKCQkJLy8gYm91bmRpbmcgYm94CgoJCQljb25zdCBib3VuZGluZ0JveCA9IHNvdXJjZS5ib3VuZGluZ0JveDsKCgkJCWlmICggYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJdGhpcy5ib3VuZGluZ0JveCA9IGJvdW5kaW5nQm94LmNsb25lKCk7CgoJCQl9CgoJCQkvLyBib3VuZGluZyBzcGhlcmUKCgkJCWNvbnN0IGJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlOwoKCQkJaWYgKCBib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJCX0KCgkJCS8vIGRyYXcgcmFuZ2UKCgkJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc291cmNlLmRyYXdSYW5nZS5zdGFydDsKCQkJdGhpcy5kcmF3UmFuZ2UuY291bnQgPSBzb3VyY2UuZHJhd1JhbmdlLmNvdW50OwoKCQkJLy8gdXNlciBkYXRhCgoJCQl0aGlzLnVzZXJEYXRhID0gc291cmNlLnVzZXJEYXRhOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRnJlZXMgdGhlIEdQVS1yZWxhdGVkIHJlc291cmNlcyBhbGxvY2F0ZWQgYnkgdGhpcyBpbnN0YW5jZS4gQ2FsbCB0aGlzCgkJICogbWV0aG9kIHdoZW5ldmVyIHRoaXMgaW5zdGFuY2UgaXMgbm8gbG9uZ2VyIHVzZWQgaW4geW91ciBhcHAuCgkJICoKCQkgKiBAZmlyZXMgQnVmZmVyR2VvbWV0cnkjZGlzcG9zZQoJCSAqLwoJCWRpc3Bvc2UoKSB7CgoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgkJfQoKCX0KCgljb25zdCBfaW52ZXJzZU1hdHJpeCQzID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoJY29uc3QgX3JheSQzID0gLypAX19QVVJFX18qLyBuZXcgUmF5KCk7Cgljb25zdCBfc3BoZXJlJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKCWNvbnN0IF9zcGhlcmVIaXRBdCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfdkEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF92QiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZDJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgoJY29uc3QgX3RlbXBBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX21vcnBoQSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgljb25zdCBfaW50ZXJzZWN0aW9uUG9pbnQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIENsYXNzIHJlcHJlc2VudGluZyB0cmlhbmd1bGFyIHBvbHlnb24gbWVzaCBiYXNlZCBvYmplY3RzLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMSwgMSwgMSApOwoJICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZjAwIH0gKTsKCSAqIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkgKiBzY2VuZS5hZGQoIG1lc2ggKTsKCSAqIGBgYAoJICoKCSAqIEBhdWdtZW50cyBPYmplY3QzRAoJICovCgljbGFzcyBNZXNoIGV4dGVuZHMgT2JqZWN0M0QgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IG1lc2guCgkJICoKCQkgKiBAcGFyYW0ge0J1ZmZlckdlb21ldHJ5fSBbZ2VvbWV0cnldIC0gVGhlIG1lc2ggZ2VvbWV0cnkuCgkJICogQHBhcmFtIHtNYXRlcmlhbHxBcnJheTxNYXRlcmlhbD59IFttYXRlcmlhbF0gLSBUaGUgbWVzaCBtYXRlcmlhbC4KCQkgKi8KCQljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKSwgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoKSApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc01lc2ggPSB0cnVlOwoKCQkJdGhpcy50eXBlID0gJ01lc2gnOwoKCQkJLyoqCgkJCSAqIFRoZSBtZXNoIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7QnVmZmVyR2VvbWV0cnl9CgkJCSAqLwoJCQl0aGlzLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgoJCQkvKioKCQkJICogVGhlIG1lc2ggbWF0ZXJpYWwuCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRlcmlhbHxBcnJheTxNYXRlcmlhbD59CgkJCSAqIEBkZWZhdWx0IE1lc2hCYXNpY01hdGVyaWFsCgkJCSAqLwoJCQl0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgoJCQkvKioKCQkJICogQSBkaWN0aW9uYXJ5IHJlcHJlc2VudGluZyB0aGUgbW9ycGggdGFyZ2V0cyBpbiB0aGUgZ2VvbWV0cnkuIFRoZSBrZXkgaXMgdGhlCgkJCSAqIG1vcnBoIHRhcmdldHMgbmFtZSwgdGhlIHZhbHVlIGl0cyBhdHRyaWJ1dGUgaW5kZXguIFRoaXMgbWVtYmVyIGlzIGB1bmRlZmluZWRgCgkJCSAqIGJ5IGRlZmF1bHQgYW5kIG9ubHkgc2V0IHdoZW4gbW9ycGggdGFyZ2V0cyBhcmUgZGV0ZWN0ZWQgaW4gdGhlIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7T2JqZWN0PFN0cmluZyxudW1iZXI+fHVuZGVmaW5lZH0KCQkJICogQGRlZmF1bHQgdW5kZWZpbmVkCgkJCSAqLwoJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBBbiBhcnJheSBvZiB3ZWlnaHRzIHR5cGljYWxseSBpbiB0aGUgcmFuZ2UgYFswLDFdYCB0aGF0IHNwZWNpZnkgaG93IG11Y2ggb2YgdGhlIG1vcnBoCgkJCSAqIGlzIGFwcGxpZWQuIFRoaXMgbWVtYmVyIGlzIGB1bmRlZmluZWRgIGJ5IGRlZmF1bHQgYW5kIG9ubHkgc2V0IHdoZW4gbW9ycGggdGFyZ2V0cyBhcmUKCQkJICogZGV0ZWN0ZWQgaW4gdGhlIGdlb21ldHJ5LgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8bnVtYmVyPnx1bmRlZmluZWR9CgkJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAoJCQkgKi8KCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSB1bmRlZmluZWQ7CgoJCQkvKioKCQkJICogVGhlIG51bWJlciBvZiBpbnN0YW5jZXMgb2YgdGhpcyBtZXNoLgoJCQkgKiBDYW4gb25seSBiZSB1c2VkIHdpdGgge0BsaW5rIFdlYkdQVVJlbmRlcmVyfS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5jb3VudCA9IDE7CgoJCQl0aGlzLnVwZGF0ZU1vcnBoVGFyZ2V0cygpOwoKCQl9CgoJCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJCWlmICggc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5zbGljZSgpOwoKCQkJfQoKCQkJaWYgKCBzb3VyY2UubW9ycGhUYXJnZXREaWN0aW9uYXJ5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSApOwoKCQkJfQoKCQkJdGhpcy5tYXRlcmlhbCA9IEFycmF5LmlzQXJyYXkoIHNvdXJjZS5tYXRlcmlhbCApID8gc291cmNlLm1hdGVyaWFsLnNsaWNlKCkgOiBzb3VyY2UubWF0ZXJpYWw7CgkJCXRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSB2YWx1ZXMgb2Yge0BsaW5rIE1lc2gjbW9ycGhUYXJnZXREaWN0aW9uYXJ5fSBhbmQge0BsaW5rIE1lc2gjbW9ycGhUYXJnZXRJbmZsdWVuY2VzfQoJCSAqIHRvIG1ha2Ugc3VyZSBleGlzdGluZyBtb3JwaCB0YXJnZXRzIGNhbiBpbmZsdWVuY2UgdGhpcyAzRCBvYmplY3QuCgkJICovCgkJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoJCQljb25zdCBrZXlzID0gT2JqZWN0LmtleXMoIG1vcnBoQXR0cmlidXRlcyApOwoKCQkJaWYgKCBrZXlzLmxlbmd0aCA+IDAgKSB7CgoJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIGtleXNbIDAgXSBdOwoKCQkJCWlmICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSBbXTsKCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHt9OwoKCQkJCQlmb3IgKCBsZXQgbSA9IDAsIG1sID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBtIDwgbWw7IG0gKysgKSB7CgoJCQkJCQljb25zdCBuYW1lID0gbW9ycGhBdHRyaWJ1dGVbIG0gXS5uYW1lIHx8IFN0cmluZyggbSApOwoKCQkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMucHVzaCggMCApOwoJCQkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgbmFtZSBdID0gbTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBsb2NhbC1zcGFjZSBwb3NpdGlvbiBvZiB0aGUgdmVydGV4IGF0IHRoZSBnaXZlbiBpbmRleCwgdGFraW5nIGludG8KCQkgKiBhY2NvdW50IHRoZSBjdXJyZW50IGFuaW1hdGlvbiBzdGF0ZSBvZiBib3RoIG1vcnBoIHRhcmdldHMgYW5kIHNraW5uaW5nLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIHZlcnRleCBpbmRleC4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHRhcmdldCAtIFRoZSB0YXJnZXQgb2JqZWN0IHRoYXQgaXMgdXNlZCB0byBzdG9yZSB0aGUgbWV0aG9kJ3MgcmVzdWx0LgoJCSAqIEByZXR1cm4ge1ZlY3RvcjN9IFRoZSB2ZXJ0ZXggcG9zaXRpb24gaW4gbG9jYWwgc3BhY2UuCgkJICovCgkJZ2V0VmVydGV4UG9zaXRpb24oIGluZGV4LCB0YXJnZXQgKSB7CgoJCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhQb3NpdGlvbiA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbW9ycGhUYXJnZXRzUmVsYXRpdmUgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJCXRhcmdldC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaW5kZXggKTsKCgkJCWNvbnN0IG1vcnBoSW5mbHVlbmNlcyA9IHRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKCQkJaWYgKCBtb3JwaFBvc2l0aW9uICYmIG1vcnBoSW5mbHVlbmNlcyApIHsKCgkJCQlfbW9ycGhBLnNldCggMCwgMCwgMCApOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaFBvc2l0aW9uLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCBpbmZsdWVuY2UgPSBtb3JwaEluZmx1ZW5jZXNbIGkgXTsKCQkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoUG9zaXRpb25bIGkgXTsKCgkJCQkJaWYgKCBpbmZsdWVuY2UgPT09IDAgKSBjb250aW51ZTsKCgkJCQkJX3RlbXBBLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQXR0cmlidXRlLCBpbmRleCApOwoKCQkJCQlpZiAoIG1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJX21vcnBoQS5hZGRTY2FsZWRWZWN0b3IoIF90ZW1wQSwgaW5mbHVlbmNlICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlfbW9ycGhBLmFkZFNjYWxlZFZlY3RvciggX3RlbXBBLnN1YiggdGFyZ2V0ICksIGluZmx1ZW5jZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXRhcmdldC5hZGQoIF9tb3JwaEEgKTsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgaW50ZXJzZWN0aW9uIHBvaW50cyBiZXR3ZWVuIGEgY2FzdGVkIHJheSBhbmQgdGhpcyBsaW5lLgoJCSAqCgkJICogQHBhcmFtIHtSYXljYXN0ZXJ9IHJheWNhc3RlciAtIFRoZSByYXljYXN0ZXIuCgkJICogQHBhcmFtIHtBcnJheTxPYmplY3Q+fSBpbnRlcnNlY3RzIC0gVGhlIHRhcmdldCBhcnJheSB0aGF0IGhvbGRzIHRoZSBpbnRlcnNlY3Rpb24gcG9pbnRzLgoJCSAqLwoJCXJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoJCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgoJCQlpZiAoIG1hdGVyaWFsID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgc3BoZXJlIGluIHdvcmxkIHNwYWNlCgoJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQlfc3BoZXJlJDYuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKTsKCQkJX3NwaGVyZSQ2LmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCgkJCS8vIGNoZWNrIGRpc3RhbmNlIGZyb20gcmF5IG9yaWdpbiB0byBib3VuZGluZyBzcGhlcmUKCgkJCV9yYXkkMy5jb3B5KCByYXljYXN0ZXIucmF5ICkucmVjYXN0KCByYXljYXN0ZXIubmVhciApOwoKCQkJaWYgKCBfc3BoZXJlJDYuY29udGFpbnNQb2ludCggX3JheSQzLm9yaWdpbiApID09PSBmYWxzZSApIHsKCgkJCQlpZiAoIF9yYXkkMy5pbnRlcnNlY3RTcGhlcmUoIF9zcGhlcmUkNiwgX3NwaGVyZUhpdEF0ICkgPT09IG51bGwgKSByZXR1cm47CgoJCQkJaWYgKCBfcmF5JDMub3JpZ2luLmRpc3RhbmNlVG9TcXVhcmVkKCBfc3BoZXJlSGl0QXQgKSA+ICggcmF5Y2FzdGVyLmZhciAtIHJheWNhc3Rlci5uZWFyICkgKiogMiApIHJldHVybjsKCgkJCX0KCgkJCS8vIGNvbnZlcnQgcmF5IHRvIGxvY2FsIHNwYWNlIG9mIG1lc2gKCgkJCV9pbnZlcnNlTWF0cml4JDMuY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQkJX3JheSQzLmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4JDMgKTsKCgkJCS8vIHRlc3Qgd2l0aCBib3VuZGluZyBib3ggaW4gbG9jYWwgc3BhY2UKCgkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQkJaWYgKCBfcmF5JDMuaW50ZXJzZWN0c0JveCggZ2VvbWV0cnkuYm91bmRpbmdCb3ggKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQl9CgoJCQkvLyB0ZXN0IGZvciBpbnRlcnNlY3Rpb25zIHdpdGggZ2VvbWV0cnkKCgkJCXRoaXMuX2NvbXB1dGVJbnRlcnNlY3Rpb25zKCByYXljYXN0ZXIsIGludGVyc2VjdHMsIF9yYXkkMyApOwoKCQl9CgoJCV9jb21wdXRlSW50ZXJzZWN0aW9ucyggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCByYXlMb2NhbFNwYWNlICkgewoKCQkJbGV0IGludGVyc2VjdGlvbjsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoKCQkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQljb25zdCB1diA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXY7CgkJCWNvbnN0IHV2MSA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYxOwoJCQljb25zdCBub3JtYWwgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLm5vcm1hbDsKCQkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoJCQljb25zdCBkcmF3UmFuZ2UgPSBnZW9tZXRyeS5kcmF3UmFuZ2U7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCS8vIGluZGV4ZWQgYnVmZmVyIGdlb21ldHJ5CgoJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCBncm91cC5zdGFydCwgZHJhd1JhbmdlLnN0YXJ0ICk7CgkJCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBpbmRleC5jb3VudCwgTWF0aC5taW4oICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApLCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICkgKTsKCgkJCQkJCWZvciAoIGxldCBqID0gc3RhcnQsIGpsID0gZW5kOyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQkJCQljb25zdCBhID0gaW5kZXguZ2V0WCggaiApOwoJCQkJCQkJY29uc3QgYiA9IGluZGV4LmdldFgoIGogKyAxICk7CgkJCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaiArIDIgKTsKCgkJCQkJCQlpbnRlcnNlY3Rpb24gPSBjaGVja0dlb21ldHJ5SW50ZXJzZWN0aW9uKCB0aGlzLCBncm91cE1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKCQkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaiAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIGluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlLm1hdGVyaWFsSW5kZXggPSBncm91cC5tYXRlcmlhbEluZGV4OwoJCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggMCwgZHJhd1JhbmdlLnN0YXJ0ICk7CgkJCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJCWNvbnN0IGEgPSBpbmRleC5nZXRYKCBpICk7CgkJCQkJCWNvbnN0IGIgPSBpbmRleC5nZXRYKCBpICsgMSApOwoJCQkJCQljb25zdCBjID0gaW5kZXguZ2V0WCggaSArIDIgKTsKCgkJCQkJCWludGVyc2VjdGlvbiA9IGNoZWNrR2VvbWV0cnlJbnRlcnNlY3Rpb24oIHRoaXMsIG1hdGVyaWFsLCByYXljYXN0ZXIsIHJheUxvY2FsU3BhY2UsIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApOwoKCQkJCQkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgoJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBpbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIG5vbi1pbmRleGVkIGJ1ZmZlciBnZW9tZXRyeQoKCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgkJCQkJCWNvbnN0IGdyb3VwTWF0ZXJpYWwgPSBtYXRlcmlhbFsgZ3JvdXAubWF0ZXJpYWxJbmRleCBdOwoKCQkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsIE1hdGgubWluKCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApICk7CgoJCQkJCQlmb3IgKCBsZXQgaiA9IHN0YXJ0LCBqbCA9IGVuZDsgaiA8IGpsOyBqICs9IDMgKSB7CgoJCQkJCQkJY29uc3QgYSA9IGo7CgkJCQkJCQljb25zdCBiID0gaiArIDE7CgkJCQkJCQljb25zdCBjID0gaiArIDI7CgoJCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgZ3JvdXBNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCgkJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGogLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBub24taW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCgkJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2UubWF0ZXJpYWxJbmRleCA9IGdyb3VwLm1hdGVyaWFsSW5kZXg7CgkJCQkJCQkJaW50ZXJzZWN0cy5wdXNoKCBpbnRlcnNlY3Rpb24gKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb24uY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCQkJZm9yICggbGV0IGkgPSBzdGFydCwgaWwgPSBlbmQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQkJY29uc3QgYSA9IGk7CgkJCQkJCWNvbnN0IGIgPSBpICsgMTsKCQkJCQkJY29uc3QgYyA9IGkgKyAyOwoKCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgoJCQkJCQlpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaSAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIG5vbi1pbmRleGVkIGJ1ZmZlciBzZW1hbnRpY3MKCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJZnVuY3Rpb24gY2hlY2tJbnRlcnNlY3Rpb24kMSggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHBBLCBwQiwgcEMsIHBvaW50ICkgewoKCQlsZXQgaW50ZXJzZWN0OwoKCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKCQkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQywgcEIsIHBBLCB0cnVlLCBwb2ludCApOwoKCQl9IGVsc2UgewoKCQkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQSwgcEIsIHBDLCAoIG1hdGVyaWFsLnNpZGUgPT09IEZyb250U2lkZSApLCBwb2ludCApOwoKCQl9CgoJCWlmICggaW50ZXJzZWN0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJCV9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmNvcHkoIHBvaW50ICk7CgkJX2ludGVyc2VjdGlvblBvaW50V29ybGQuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZCApOwoKCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgcmV0dXJuIG51bGw7CgoJCXJldHVybiB7CgkJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQkJcG9pbnQ6IF9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkLmNsb25lKCksCgkJCW9iamVjdDogb2JqZWN0CgkJfTsKCgl9CgoJZnVuY3Rpb24gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApIHsKCgkJb2JqZWN0LmdldFZlcnRleFBvc2l0aW9uKCBhLCBfdkEkMSApOwoJCW9iamVjdC5nZXRWZXJ0ZXhQb3NpdGlvbiggYiwgX3ZCJDEgKTsKCQlvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGMsIF92QyQxICk7CgoJCWNvbnN0IGludGVyc2VjdGlvbiA9IGNoZWNrSW50ZXJzZWN0aW9uJDEoIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfaW50ZXJzZWN0aW9uUG9pbnQgKTsKCgkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgoJCQljb25zdCBiYXJ5Y29vcmQgPSBuZXcgVmVjdG9yMygpOwoJCQlUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIF9pbnRlcnNlY3Rpb25Qb2ludCwgX3ZBJDEsIF92QiQxLCBfdkMkMSwgYmFyeWNvb3JkICk7CgoJCQlpZiAoIHV2ICkgewoKCQkJCWludGVyc2VjdGlvbi51diA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggdXYsIGEsIGIsIGMsIGJhcnljb29yZCwgbmV3IFZlY3RvcjIoKSApOwoKCQkJfQoKCQkJaWYgKCB1djEgKSB7CgoJCQkJaW50ZXJzZWN0aW9uLnV2MSA9IFRyaWFuZ2xlLmdldEludGVycG9sYXRlZEF0dHJpYnV0ZSggdXYxLCBhLCBiLCBjLCBiYXJ5Y29vcmQsIG5ldyBWZWN0b3IyKCkgKTsKCgkJCX0KCgkJCWlmICggbm9ybWFsICkgewoKCQkJCWludGVyc2VjdGlvbi5ub3JtYWwgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0ZWRBdHRyaWJ1dGUoIG5vcm1hbCwgYSwgYiwgYywgYmFyeWNvb3JkLCBuZXcgVmVjdG9yMygpICk7CgoJCQkJaWYgKCBpbnRlcnNlY3Rpb24ubm9ybWFsLmRvdCggcmF5LmRpcmVjdGlvbiApID4gMCApIHsKCgkJCQkJaW50ZXJzZWN0aW9uLm5vcm1hbC5tdWx0aXBseVNjYWxhciggLTEgKTsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBmYWNlID0gewoJCQkJYTogYSwKCQkJCWI6IGIsCgkJCQljOiBjLAoJCQkJbm9ybWFsOiBuZXcgVmVjdG9yMygpLAoJCQkJbWF0ZXJpYWxJbmRleDogMAoJCQl9OwoKCQkJVHJpYW5nbGUuZ2V0Tm9ybWFsKCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBmYWNlLm5vcm1hbCApOwoKCQkJaW50ZXJzZWN0aW9uLmZhY2UgPSBmYWNlOwoJCQlpbnRlcnNlY3Rpb24uYmFyeWNvb3JkID0gYmFyeWNvb3JkOwoKCQl9CgoJCXJldHVybiBpbnRlcnNlY3Rpb247CgoJfQoKCS8qKgoJICogQSBnZW9tZXRyeSBjbGFzcyBmb3IgYSByZWN0YW5ndWxhciBjdWJvaWQgd2l0aCBhIGdpdmVuIHdpZHRoLCBoZWlnaHQsIGFuZCBkZXB0aC4KCSAqIE9uIGNyZWF0aW9uLCB0aGUgY3Vib2lkIGlzIGNlbnRyZWQgb24gdGhlIG9yaWdpbiwgd2l0aCBlYWNoIGVkZ2UgcGFyYWxsZWwgdG8gb25lCgkgKiBvZiB0aGUgYXhlcy4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDEsIDEgKTsKCSAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiAweDAwZmYwMCB9ICk7CgkgKiBjb25zdCBjdWJlID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJICogc2NlbmUuYWRkKCBjdWJlICk7CgkgKiBgYGAKCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyR2VvbWV0cnkKCSAqLwoJY2xhc3MgQm94R2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYm94IGdlb21ldHJ5LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3aWR0aD0xXSAtIFRoZSB3aWR0aC4gVGhhdCBpcywgdGhlIGxlbmd0aCBvZiB0aGUgZWRnZXMgcGFyYWxsZWwgdG8gdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQuIFRoYXQgaXMsIHRoZSBsZW5ndGggb2YgdGhlIGVkZ2VzIHBhcmFsbGVsIHRvIHRoZSBZIGF4aXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aD0xXSAtIFRoZSBkZXB0aC4gVGhhdCBpcywgdGhlIGxlbmd0aCBvZiB0aGUgZWRnZXMgcGFyYWxsZWwgdG8gdGhlIFogYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3dpZHRoU2VnbWVudHM9MV0gLSBOdW1iZXIgb2Ygc2VnbWVudGVkIHJlY3Rhbmd1bGFyIGZhY2VzIGFsb25nIHRoZSB3aWR0aCBvZiB0aGUgc2lkZXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtoZWlnaHRTZWdtZW50cz0xXSAtIE51bWJlciBvZiBzZWdtZW50ZWQgcmVjdGFuZ3VsYXIgZmFjZXMgYWxvbmcgdGhlIGhlaWdodCBvZiB0aGUgc2lkZXMuCgkJICogQHBhcmFtIHtudW1iZXJ9IFtkZXB0aFNlZ21lbnRzPTFdIC0gTnVtYmVyIG9mIHNlZ21lbnRlZCByZWN0YW5ndWxhciBmYWNlcyBhbG9uZyB0aGUgZGVwdGggb2YgdGhlIHNpZGVzLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSwgd2lkdGhTZWdtZW50cyA9IDEsIGhlaWdodFNlZ21lbnRzID0gMSwgZGVwdGhTZWdtZW50cyA9IDEgKSB7CgoJCQlzdXBlcigpOwoKCQkJdGhpcy50eXBlID0gJ0JveEdlb21ldHJ5JzsKCgkJCS8qKgoJCQkgKiBIb2xkcyB0aGUgY29uc3RydWN0b3IgcGFyYW1ldGVycyB0aGF0IGhhdmUgYmVlbgoJCQkgKiB1c2VkIHRvIGdlbmVyYXRlIHRoZSBnZW9tZXRyeS4gQW55IG1vZGlmaWNhdGlvbgoJCQkgKiBhZnRlciBpbnN0YW50aWF0aW9uIGRvZXMgbm90IGNoYW5nZSB0aGUgZ2VvbWV0cnkuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCQl3aWR0aDogd2lkdGgsCgkJCQloZWlnaHQ6IGhlaWdodCwKCQkJCWRlcHRoOiBkZXB0aCwKCQkJCXdpZHRoU2VnbWVudHM6IHdpZHRoU2VnbWVudHMsCgkJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCQlkZXB0aFNlZ21lbnRzOiBkZXB0aFNlZ21lbnRzCgkJCX07CgoJCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCQkvLyBzZWdtZW50cwoKCQkJd2lkdGhTZWdtZW50cyA9IE1hdGguZmxvb3IoIHdpZHRoU2VnbWVudHMgKTsKCQkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApOwoJCQlkZXB0aFNlZ21lbnRzID0gTWF0aC5mbG9vciggZGVwdGhTZWdtZW50cyApOwoKCQkJLy8gYnVmZmVycwoKCQkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCQljb25zdCBub3JtYWxzID0gW107CgkJCWNvbnN0IHV2cyA9IFtdOwoKCQkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQkJbGV0IG51bWJlck9mVmVydGljZXMgPSAwOwoJCQlsZXQgZ3JvdXBTdGFydCA9IDA7CgoJCQkvLyBidWlsZCBlYWNoIHNpZGUgb2YgdGhlIGJveCBnZW9tZXRyeQoKCQkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgLTEsIC0xLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aCwgZGVwdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDAgKTsgLy8gcHgKCQkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgMSwgLTEsIGRlcHRoLCBoZWlnaHQsIC0gd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAxICk7IC8vIG54CgkJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIDEsIHdpZHRoLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAyICk7IC8vIHB5CgkJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIC0xLCB3aWR0aCwgZGVwdGgsIC0gaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAzICk7IC8vIG55CgkJCWJ1aWxkUGxhbmUoICd4JywgJ3knLCAneicsIDEsIC0xLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDQgKTsgLy8gcHoKCQkJYnVpbGRQbGFuZSggJ3gnLCAneScsICd6JywgLTEsIC0xLCB3aWR0aCwgaGVpZ2h0LCAtIGRlcHRoLCB3aWR0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgNSApOyAvLyBuegoKCQkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJCQlmdW5jdGlvbiBidWlsZFBsYW5lKCB1LCB2LCB3LCB1ZGlyLCB2ZGlyLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ3JpZFgsIGdyaWRZLCBtYXRlcmlhbEluZGV4ICkgewoKCQkJCWNvbnN0IHNlZ21lbnRXaWR0aCA9IHdpZHRoIC8gZ3JpZFg7CgkJCQljb25zdCBzZWdtZW50SGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgoJCQkJY29uc3Qgd2lkdGhIYWxmID0gd2lkdGggLyAyOwoJCQkJY29uc3QgaGVpZ2h0SGFsZiA9IGhlaWdodCAvIDI7CgkJCQljb25zdCBkZXB0aEhhbGYgPSBkZXB0aCAvIDI7CgoJCQkJY29uc3QgZ3JpZFgxID0gZ3JpZFggKyAxOwoJCQkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKCQkJCWxldCB2ZXJ0ZXhDb3VudGVyID0gMDsKCQkJCWxldCBncm91cENvdW50ID0gMDsKCgkJCQljb25zdCB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKCQkJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgoJCQkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRIZWlnaHQgLSBoZWlnaHRIYWxmOwoKCQkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYMTsgaXggKysgKSB7CgoJCQkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50V2lkdGggLSB3aWR0aEhhbGY7CgoJCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKCQkJCQkJdmVjdG9yWyB1IF0gPSB4ICogdWRpcjsKCQkJCQkJdmVjdG9yWyB2IF0gPSB5ICogdmRpcjsKCQkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aEhhbGY7CgoJCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIHZlcnRleCBidWZmZXIKCgkJCQkJCXZlcnRpY2VzLnB1c2goIHZlY3Rvci54LCB2ZWN0b3IueSwgdmVjdG9yLnogKTsKCgkJCQkJCS8vIHNldCB2YWx1ZXMgdG8gY29ycmVjdCB2ZWN0b3IgY29tcG9uZW50CgoJCQkJCQl2ZWN0b3JbIHUgXSA9IDA7CgkJCQkJCXZlY3RvclsgdiBdID0gMDsKCQkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aCA+IDAgPyAxIDogLTE7CgoJCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIG5vcm1hbCBidWZmZXIKCgkJCQkJCW5vcm1hbHMucHVzaCggdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiApOwoKCQkJCQkJLy8gdXZzCgoJCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJCQl1dnMucHVzaCggMSAtICggaXkgLyBncmlkWSApICk7CgoJCQkJCQkvLyBjb3VudGVycwoKCQkJCQkJdmVydGV4Q291bnRlciArPSAxOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGluZGljZXMKCgkJCQkvLyAxLiB5b3UgbmVlZCB0aHJlZSBpbmRpY2VzIHRvIGRyYXcgYSBzaW5nbGUgZmFjZQoJCQkJLy8gMi4gYSBzaW5nbGUgc2VnbWVudCBjb25zaXN0cyBvZiB0d28gZmFjZXMKCQkJCS8vIDMuIHNvIHdlIG5lZWQgdG8gZ2VuZXJhdGUgc2l4ICgyKjMpIGluZGljZXMgcGVyIHNlZ21lbnQKCgkJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCgkJCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDsgaXggKysgKSB7CgoJCQkJCQljb25zdCBhID0gbnVtYmVyT2ZWZXJ0aWNlcyArIGl4ICsgZ3JpZFgxICogaXk7CgkJCQkJCWNvbnN0IGIgPSBudW1iZXJPZlZlcnRpY2VzICsgaXggKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJCQljb25zdCBjID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiAoIGl5ICsgMSApOwoJCQkJCQljb25zdCBkID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCgkJCQkJCS8vIGZhY2VzCgoJCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJCQkvLyBpbmNyZWFzZSBjb3VudGVyCgoJCQkJCQlncm91cENvdW50ICs9IDY7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gYWRkIGEgZ3JvdXAgdG8gdGhlIGdlb21ldHJ5LiB0aGlzIHdpbGwgZW5zdXJlIG11bHRpIG1hdGVyaWFsIHN1cHBvcnQKCgkJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgbWF0ZXJpYWxJbmRleCApOwoKCQkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCgkJCQkvLyB1cGRhdGUgdG90YWwgbnVtYmVyIG9mIHZlcnRpY2VzCgoJCQkJbnVtYmVyT2ZWZXJ0aWNlcyArPSB2ZXJ0ZXhDb3VudGVyOwoKCQkJfQoKCQl9CgoJCWNvcHkoIHNvdXJjZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBGYWN0b3J5IG1ldGhvZCBmb3IgY3JlYXRpbmcgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzcyBmcm9tIHRoZSBnaXZlbgoJCSAqIEpTT04gb2JqZWN0LgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IGRhdGEgLSBBIEpTT04gb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2VyaWFsaXplZCBnZW9tZXRyeS4KCQkgKiBAcmV0dXJuIHtCb3hHZW9tZXRyeX0gQSBuZXcgaW5zdGFuY2UuCgkJICovCgkJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQkJcmV0dXJuIG5ldyBCb3hHZW9tZXRyeSggZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQsIGRhdGEuZGVwdGgsIGRhdGEud2lkdGhTZWdtZW50cywgZGF0YS5oZWlnaHRTZWdtZW50cywgZGF0YS5kZXB0aFNlZ21lbnRzICk7CgoJCX0KCgl9CgoJLy8gVW5pZm9ybSBVdGlsaXRpZXMKCglmdW5jdGlvbiBjbG9uZVVuaWZvcm1zKCBzcmMgKSB7CgoJCWNvbnN0IGRzdCA9IHt9OwoKCQlmb3IgKCBjb25zdCB1IGluIHNyYyApIHsKCgkJCWRzdFsgdSBdID0ge307CgoJCQlmb3IgKCBjb25zdCBwIGluIHNyY1sgdSBdICkgewoKCQkJCWNvbnN0IHByb3BlcnR5ID0gc3JjWyB1IF1bIHAgXTsKCgkJCQlpZiAoIHByb3BlcnR5ICYmICggcHJvcGVydHkuaXNDb2xvciB8fAoJCQkJCXByb3BlcnR5LmlzTWF0cml4MyB8fCBwcm9wZXJ0eS5pc01hdHJpeDQgfHwKCQkJCQlwcm9wZXJ0eS5pc1ZlY3RvcjIgfHwgcHJvcGVydHkuaXNWZWN0b3IzIHx8IHByb3BlcnR5LmlzVmVjdG9yNCB8fAoJCQkJCXByb3BlcnR5LmlzVGV4dHVyZSB8fCBwcm9wZXJ0eS5pc1F1YXRlcm5pb24gKSApIHsKCgkJCQkJaWYgKCBwcm9wZXJ0eS5pc1JlbmRlclRhcmdldFRleHR1cmUgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdVbmlmb3Jtc1V0aWxzOiBUZXh0dXJlcyBvZiByZW5kZXIgdGFyZ2V0cyBjYW5ub3QgYmUgY2xvbmVkIHZpYSBjbG9uZVVuaWZvcm1zKCkgb3IgbWVyZ2VVbmlmb3JtcygpLicgKTsKCQkJCQkJZHN0WyB1IF1bIHAgXSA9IG51bGw7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHkuY2xvbmUoKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIHByb3BlcnR5ICkgKSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eS5zbGljZSgpOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGRzdDsKCgl9CgoJZnVuY3Rpb24gbWVyZ2VVbmlmb3JtcyggdW5pZm9ybXMgKSB7CgoJCWNvbnN0IG1lcmdlZCA9IHt9OwoKCQlmb3IgKCBsZXQgdSA9IDA7IHUgPCB1bmlmb3Jtcy5sZW5ndGg7IHUgKysgKSB7CgoJCQljb25zdCB0bXAgPSBjbG9uZVVuaWZvcm1zKCB1bmlmb3Jtc1sgdSBdICk7CgoJCQlmb3IgKCBjb25zdCBwIGluIHRtcCApIHsKCgkJCQltZXJnZWRbIHAgXSA9IHRtcFsgcCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiBtZXJnZWQ7CgoJfQoKCWZ1bmN0aW9uIGNsb25lVW5pZm9ybXNHcm91cHMoIHNyYyApIHsKCgkJY29uc3QgZHN0ID0gW107CgoJCWZvciAoIGxldCB1ID0gMDsgdSA8IHNyYy5sZW5ndGg7IHUgKysgKSB7CgoJCQlkc3QucHVzaCggc3JjWyB1IF0uY2xvbmUoKSApOwoKCQl9CgoJCXJldHVybiBkc3Q7CgoJfQoKCWZ1bmN0aW9uIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgewoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCWlmICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApIHsKCgkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tcmRvb2IvdGhyZWUuanMvcHVsbC8yMzkzNyNpc3N1ZWNvbW1lbnQtMTExMTA2NzM5OAoJCQlyZXR1cm4gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZTsKCgkJfQoKCQkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8yNzg2OAoJCWlmICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlICkgewoKCQkJcmV0dXJuIGN1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS5jb2xvclNwYWNlOwoKCQl9CgoJCXJldHVybiBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2U7CgoJfQoKCS8vIExlZ2FjeQoKCWNvbnN0IFVuaWZvcm1zVXRpbHMgPSB7IGNsb25lOiBjbG9uZVVuaWZvcm1zLCBtZXJnZTogbWVyZ2VVbmlmb3JtcyB9OwoKCXZhciBkZWZhdWx0X3ZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gcHJvamVjdGlvbk1hdHJpeCAqIG1vZGVsVmlld01hdHJpeCAqIHZlYzQoIHBvc2l0aW9uLCAxLjAgKTtcbn0iOwoKCXZhciBkZWZhdWx0X2ZyYWdtZW50ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggMS4wLCAwLjAsIDAuMCwgMS4wICk7XG59IjsKCgkvKioKCSAqIEEgbWF0ZXJpYWwgcmVuZGVyZWQgd2l0aCBjdXN0b20gc2hhZGVycy4gQSBzaGFkZXIgaXMgYSBzbWFsbCBwcm9ncmFtIHdyaXR0ZW4gaW4gR0xTTC4KCSAqIHRoYXQgcnVucyBvbiB0aGUgR1BVLiBZb3UgbWF5IHdhbnQgdG8gdXNlIGEgY3VzdG9tIHNoYWRlciBpZiB5b3UgbmVlZCB0byBpbXBsZW1lbnQgYW4KCSAqIGVmZmVjdCBub3QgaW5jbHVkZWQgd2l0aCBhbnkgb2YgdGhlIGJ1aWx0LWluIG1hdGVyaWFscy4KCSAqCgkgKiBUaGVyZSBhcmUgdGhlIGZvbGxvd2luZyBub3RlcyB0byBiZWFyIGluIG1pbmQgd2hlbiB1c2luZyBhIGBTaGFkZXJNYXRlcmlhbGA6CgkgKgoJICogLSBgU2hhZGVyTWF0ZXJpYWxgIGNhbiBvbmx5IGJlIHVzZWQgd2l0aCB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uCgkgKiAtIEJ1aWx0IGluIGF0dHJpYnV0ZXMgYW5kIHVuaWZvcm1zIGFyZSBwYXNzZWQgdG8gdGhlIHNoYWRlcnMgYWxvbmcgd2l0aCB5b3VyIGNvZGUuIElmCgkgKiB5b3UgZG9uJ3Qgd2FudCB0aGF0LCB1c2Uge0BsaW5rIFJhd1NoYWRlck1hdGVyaWFsfSBpbnN0ZWFkLgoJICogLSBZb3UgY2FuIHVzZSB0aGUgZGlyZWN0aXZlIGAjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0YCBhbmQgYCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kYAoJICogaW4gb3JkZXIgdG8gdW5yb2xsIGEgYGZvcmAgbG9vcCBpbiBHTFNMIGJ5IHRoZSBzaGFkZXIgcHJlcHJvY2Vzc29yLiBUaGUgZGlyZWN0aXZlIGhhcwoJICogdG8gYmUgcGxhY2VkIHJpZ2h0IGFib3ZlIHRoZSBsb29wLiBUaGUgbG9vcCBmb3JtYXR0aW5nIGhhcyB0byBjb3JyZXNwb25kIHRvIGEgZGVmaW5lZCBzdGFuZGFyZC4KCSAqICAgLSBUaGUgbG9vcCBoYXMgdG8gYmUgW25vcm1hbGl6ZWRde0BsaW5rIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL05vcm1hbGl6ZWRfbG9vcH0uCgkgKiAgIC0gVGhlIGxvb3AgdmFyaWFibGUgaGFzIHRvIGJlICppKi4KCSAqICAgLSBUaGUgdmFsdWUgYFVOUk9MTEVEX0xPT1BfSU5ERVhgIHdpbGwgYmUgcmVwbGFjZWQgd2l0aCB0aGUgZXhwbGljaXRseQoJICogdmFsdWUgb2YgKmkqIGZvciB0aGUgZ2l2ZW4gaXRlcmF0aW9uIGFuZCBjYW4gYmUgdXNlZCBpbiBwcmVwcm9jZXNzb3IKCSAqIHN0YXRlbWVudHMuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IG1hdGVyaWFsID0gbmV3IFRIUkVFLlNoYWRlck1hdGVyaWFsKCB7CgkgKiAJdW5pZm9ybXM6IHsKCSAqIAkJdGltZTogeyB2YWx1ZTogMS4wIH0sCgkgKiAJCXJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBUSFJFRS5WZWN0b3IyKCkgfQoJICogCX0sCgkgKiAJdmVydGV4U2hhZGVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggJ3ZlcnRleFNoYWRlcicgKS50ZXh0Q29udGVudCwKCSAqIAlmcmFnbWVudFNoYWRlcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdmcmFnbWVudFNoYWRlcicgKS50ZXh0Q29udGVudAoJICogfSApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIE1hdGVyaWFsCgkgKi8KCWNsYXNzIFNoYWRlck1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHNoYWRlciBtYXRlcmlhbC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCgkJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAoJCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAoJCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCgkJICogYnkge0BsaW5rIENvbG9yI3NldH0uCgkJICovCgkJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNTaGFkZXJNYXRlcmlhbCA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnU2hhZGVyTWF0ZXJpYWwnOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgY3VzdG9tIGNvbnN0YW50cyB1c2luZyBgI2RlZmluZWAgZGlyZWN0aXZlcyB3aXRoaW4gdGhlIEdMU0wgY29kZQoJCQkgKiBmb3IgYm90aCB0aGUgdmVydGV4IHNoYWRlciBhbmQgdGhlIGZyYWdtZW50IHNoYWRlcjsgZWFjaCBrZXkvdmFsdWUgcGFpcgoJCQkgKiB5aWVsZHMgYW5vdGhlciBkaXJlY3RpdmUuCgkJCSAqIGBgYGpzCgkJCSAqIGRlZmluZXM6IHsKCQkJICogCUZPTzogMTUsCgkJCSAqIAlCQVI6IHRydWUKCQkJICogfQoJCQkgKiBgYGAKCQkJICogWWllbGRzIHRoZSBsaW5lczoKCQkJICogYGBgCgkJCSAqICNkZWZpbmUgRk9PIDE1CgkJCSAqICNkZWZpbmUgQkFSIHRydWUKCQkJICogYGBgCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLmRlZmluZXMgPSB7fTsKCgkJCS8qKgoJCQkgKiBBbiBvYmplY3Qgb2YgdGhlIGZvcm06CgkJCSAqIGBgYGpzCgkJCSAqIHsKCQkJICogCSJ1bmlmb3JtMSI6IHsgdmFsdWU6IDEuMCB9LAoJCQkgKiAJInVuaWZvcm0yIjogeyB2YWx1ZTogMiB9CgkJCSAqIH0KCQkJICogYGBgCgkJCSAqIHNwZWNpZnlpbmcgdGhlIHVuaWZvcm1zIHRvIGJlIHBhc3NlZCB0byB0aGUgc2hhZGVyIGNvZGU7IGtleXMgYXJlIHVuaWZvcm0KCQkJICogbmFtZXMsIHZhbHVlcyBhcmUgZGVmaW5pdGlvbnMgb2YgdGhlIGZvcm0KCQkJICogYGBgCgkJCSAqIHsKCQkJICogCXZhbHVlOiAxLjAKCQkJICogfQoJCQkgKiBgYGAKCQkJICogd2hlcmUgYHZhbHVlYCBpcyB0aGUgdmFsdWUgb2YgdGhlIHVuaWZvcm0uIE5hbWVzIG11c3QgbWF0Y2ggdGhlIG5hbWUgb2YKCQkJICogdGhlIHVuaWZvcm0sIGFzIGRlZmluZWQgaW4gdGhlIEdMU0wgY29kZS4gTm90ZSB0aGF0IHVuaWZvcm1zIGFyZSByZWZyZXNoZWQKCQkJICogb24gZXZlcnkgZnJhbWUsIHNvIHVwZGF0aW5nIHRoZSB2YWx1ZSBvZiB0aGUgdW5pZm9ybSB3aWxsIGltbWVkaWF0ZWx5CgkJCSAqIHVwZGF0ZSB0aGUgdmFsdWUgYXZhaWxhYmxlIHRvIHRoZSBHTFNMIGNvZGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCSAqLwoJCQl0aGlzLnVuaWZvcm1zID0ge307CgoJCQkvKioKCQkJICogQW4gYXJyYXkgaG9sZGluZyB1bmlmb3JtcyBncm91cHMgZm9yIGNvbmZpZ3VyaW5nIFVCT3MuCgkJCSAqCgkJCSAqIEB0eXBlIHtBcnJheTxVbmlmb3Jtc0dyb3VwPn0KCQkJICovCgkJCXRoaXMudW5pZm9ybXNHcm91cHMgPSBbXTsKCgkJCS8qKgoJCQkgKiBWZXJ0ZXggc2hhZGVyIEdMU0wgY29kZS4gVGhpcyBpcyB0aGUgYWN0dWFsIGNvZGUgZm9yIHRoZSBzaGFkZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqLwoJCQl0aGlzLnZlcnRleFNoYWRlciA9IGRlZmF1bHRfdmVydGV4OwoKCQkJLyoqCgkJCSAqIEZyYWdtZW50IHNoYWRlciBHTFNMIGNvZGUuIFRoaXMgaXMgdGhlIGFjdHVhbCBjb2RlIGZvciB0aGUgc2hhZGVyLgoJCQkgKgoJCQkgKiBAdHlwZSB7c3RyaW5nfQoJCQkgKi8KCQkJdGhpcy5mcmFnbWVudFNoYWRlciA9IGRlZmF1bHRfZnJhZ21lbnQ7CgoJCQkvKioKCQkJICogQ29udHJvbHMgbGluZSB0aGlja25lc3Mgb3IgbGluZXMuCgkJCSAqCgkJCSAqIFdlYkdMIGFuZCBXZWJHUFUgaWdub3JlIHRoaXMgc2V0dGluZyBhbmQgYWx3YXlzIHJlbmRlciBsaW5lIHByaW1pdGl2ZXMgd2l0aCBhCgkJCSAqIHdpZHRoIG9mIG9uZSBwaXhlbC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5saW5ld2lkdGggPSAxOwoKCQkJLyoqCgkJCSAqIFJlbmRlcnMgdGhlIGdlb21ldHJ5IGFzIGEgd2lyZWZyYW1lLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgoJCQkvKioKCQkJICogQ29udHJvbHMgdGhlIHRoaWNrbmVzcyBvZiB0aGUgd2lyZWZyYW1lLgoJCQkgKgoJCQkgKiBXZWJHTCBhbmQgV2ViR1BVIGlnbm9yZSB0aGlzIHByb3BlcnR5IGFuZCBhbHdheXMgcmVuZGVyCgkJCSAqIDEgcGl4ZWwgd2lkZSBsaW5lcy4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoKCQkJLyoqCgkJCSAqIERlZmluZSB3aGV0aGVyIHRoZSBtYXRlcmlhbCBjb2xvciBpcyBhZmZlY3RlZCBieSBnbG9iYWwgZm9nIHNldHRpbmdzOyBgdHJ1ZWAKCQkJICogdG8gcGFzcyBmb2cgdW5pZm9ybXMgdG8gdGhlIHNoYWRlci4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmZvZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgd2hldGhlciB0aGlzIG1hdGVyaWFsIHVzZXMgbGlnaHRpbmc7IGB0cnVlYCB0byBwYXNzIHVuaWZvcm0gZGF0YQoJCQkgKiByZWxhdGVkIHRvIGxpZ2h0aW5nIHRvIHRoaXMgc2hhZGVyLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgZmFsc2UKCQkJICovCgkJCXRoaXMubGlnaHRzID0gZmFsc2U7CgoJCQkvKioKCQkJICogRGVmaW5lcyB3aGV0aGVyIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgY2xpcHBpbmc7IGB0cnVlYCB0byBsZXQgdGhlIHJlbmRlcmVyCgkJCSAqIHBhc3MgdGhlIGNsaXBwaW5nUGxhbmVzIHVuaWZvcm0uCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5jbGlwcGluZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIE92ZXJ3cml0dGVuIGFuZCBzZXQgdG8gYHRydWVgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmZvcmNlU2luZ2xlUGFzcyA9IHRydWU7CgoJCQkvKioKCQkJICogVGhpcyBvYmplY3QgYWxsb3dzIHRvIGVuYWJsZSBjZXJ0YWluIFdlYkdMIDIgZXh0ZW5zaW9ucy4KCQkJICoKCQkJICogLSBjbGlwQ3VsbERpc3RhbmNlOiBzZXQgdG8gYHRydWVgIHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIGNsaXBwaW5nCgkJCSAqIC0gbXVsdGlEcmF3OiBzZXQgdG8gYHRydWVgIHRvIHVzZSB2ZXJ0ZXggc2hhZGVyIG11bHRpX2RyYXcgLyBlbmFibGUgZ2xfRHJhd0lECgkJCSAqCgkJCSAqIEB0eXBlIHt7Y2xpcEN1bGxEaXN0YW5jZTpmYWxzZSxtdWx0aURyYXc6ZmFsc2V9fQoJCQkgKi8KCQkJdGhpcy5leHRlbnNpb25zID0gewoJCQkJY2xpcEN1bGxEaXN0YW5jZTogZmFsc2UsIC8vIHNldCB0byB1c2UgdmVydGV4IHNoYWRlciBjbGlwcGluZwoJCQkJbXVsdGlEcmF3OiBmYWxzZSAvLyBzZXQgdG8gdXNlIHZlcnRleCBzaGFkZXIgbXVsdGlfZHJhdyAvIGVuYWJsZSBnbF9EcmF3SUQKCQkJfTsKCgkJCS8qKgoJCQkgKiBXaGVuIHRoZSByZW5kZXJlZCBnZW9tZXRyeSBkb2Vzbid0IGluY2x1ZGUgdGhlc2UgYXR0cmlidXRlcyBidXQgdGhlCgkJCSAqIG1hdGVyaWFsIGRvZXMsIHRoZXNlIGRlZmF1bHQgdmFsdWVzIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBzaGFkZXJzLiBUaGlzCgkJCSAqIGF2b2lkcyBlcnJvcnMgd2hlbiBidWZmZXIgZGF0YSBpcyBtaXNzaW5nLgoJCQkgKgoJCQkgKiAtIGNvbG9yOiBbIDEsIDEsIDEgXQoJCQkgKiAtIHV2OiBbIDAsIDAgXQoJCQkgKiAtIHV2MTogWyAwLCAwIF0KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMuZGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyA9IHsKCQkJCSdjb2xvcic6IFsgMSwgMSwgMSBdLAoJCQkJJ3V2JzogWyAwLCAwIF0sCgkJCQkndXYxJzogWyAwLCAwIF0KCQkJfTsKCgkJCS8qKgoJCQkgKiBJZiBzZXQsIHRoaXMgY2FsbHMgW2dsLmJpbmRBdHRyaWJMb2NhdGlvbl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dlYkdMUmVuZGVyaW5nQ29udGV4dC9iaW5kQXR0cmliTG9jYXRpb259CgkJCSAqIHRvIGJpbmQgYSBnZW5lcmljIHZlcnRleCBpbmRleCB0byBhbiBhdHRyaWJ1dGUgdmFyaWFibGUuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd8dW5kZWZpbmVkfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMuaW5kZXgwQXR0cmlidXRlTmFtZSA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBDYW4gYmUgdXNlZCB0byBmb3JjZSBhIHVuaWZvcm0gdXBkYXRlIHdoaWxlIGNoYW5naW5nIHVuaWZvcm1zIGluCgkJCSAqIHtAbGluayBPYmplY3QzRCNvbkJlZm9yZVJlbmRlcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBEZWZpbmVzIHRoZSBHTFNMIHZlcnNpb24gb2YgY3VzdG9tIHNoYWRlciBjb2RlLgoJCQkgKgoJCQkgKiBAdHlwZSB7PyhHTFNMMXxHTFNMMyl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuZ2xzbFZlcnNpb24gPSBudWxsOwoKCQkJaWYgKCBwYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJCX0KCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBzb3VyY2UuZnJhZ21lbnRTaGFkZXI7CgkJCXRoaXMudmVydGV4U2hhZGVyID0gc291cmNlLnZlcnRleFNoYWRlcjsKCgkJCXRoaXMudW5pZm9ybXMgPSBjbG9uZVVuaWZvcm1zKCBzb3VyY2UudW5pZm9ybXMgKTsKCQkJdGhpcy51bmlmb3Jtc0dyb3VwcyA9IGNsb25lVW5pZm9ybXNHcm91cHMoIHNvdXJjZS51bmlmb3Jtc0dyb3VwcyApOwoKCQkJdGhpcy5kZWZpbmVzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5kZWZpbmVzICk7CgoJCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCgkJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCQkJdGhpcy5saWdodHMgPSBzb3VyY2UubGlnaHRzOwoJCQl0aGlzLmNsaXBwaW5nID0gc291cmNlLmNsaXBwaW5nOwoKCQkJdGhpcy5leHRlbnNpb25zID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5leHRlbnNpb25zICk7CgoJCQl0aGlzLmdsc2xWZXJzaW9uID0gc291cmNlLmdsc2xWZXJzaW9uOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJdG9KU09OKCBtZXRhICkgewoKCQkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQkJZGF0YS5nbHNsVmVyc2lvbiA9IHRoaXMuZ2xzbFZlcnNpb247CgkJCWRhdGEudW5pZm9ybXMgPSB7fTsKCgkJCWZvciAoIGNvbnN0IG5hbWUgaW4gdGhpcy51bmlmb3JtcyApIHsKCgkJCQljb25zdCB1bmlmb3JtID0gdGhpcy51bmlmb3Jtc1sgbmFtZSBdOwoJCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKCQkJCWlmICggdmFsdWUgJiYgdmFsdWUuaXNUZXh0dXJlICkgewoKCQkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJCXR5cGU6ICd0JywKCQkJCQkJdmFsdWU6IHZhbHVlLnRvSlNPTiggbWV0YSApLnV1aWQKCQkJCQl9OwoKCQkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQkJdHlwZTogJ2MnLAoJCQkJCQl2YWx1ZTogdmFsdWUuZ2V0SGV4KCkKCQkJCQl9OwoKCQkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMiApIHsKCgkJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCQl0eXBlOiAndjInLAoJCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQkJfTsKCgkJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjMgKSB7CgoJCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQkJdHlwZTogJ3YzJywKCQkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJCX07CgoJCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3I0ICkgewoKCQkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJCXR5cGU6ICd2NCcsCgkJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKCQkJCQl9OwoKCQkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzTWF0cml4MyApIHsKCgkJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCQl0eXBlOiAnbTMnLAoJCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQkJfTsKCgkJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDQgKSB7CgoJCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQkJdHlwZTogJ200JywKCQkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJCX07CgoJCQkJfSBlbHNlIHsKCgkJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCQl2YWx1ZTogdmFsdWUKCQkJCQl9OwoKCQkJCQkvLyBub3RlOiB0aGUgYXJyYXkgdmFyaWFudHMgdjJ2LCB2M3YsIHY0diwgbTR2IGFuZCB0diBhcmUgbm90IHN1cHBvcnRlZCBzbyBmYXIKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLmRlZmluZXMgKS5sZW5ndGggPiAwICkgZGF0YS5kZWZpbmVzID0gdGhpcy5kZWZpbmVzOwoKCQkJZGF0YS52ZXJ0ZXhTaGFkZXIgPSB0aGlzLnZlcnRleFNoYWRlcjsKCQkJZGF0YS5mcmFnbWVudFNoYWRlciA9IHRoaXMuZnJhZ21lbnRTaGFkZXI7CgoJCQlkYXRhLmxpZ2h0cyA9IHRoaXMubGlnaHRzOwoJCQlkYXRhLmNsaXBwaW5nID0gdGhpcy5jbGlwcGluZzsKCgkJCWNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKCgkJCWZvciAoIGNvbnN0IGtleSBpbiB0aGlzLmV4dGVuc2lvbnMgKSB7CgoJCQkJaWYgKCB0aGlzLmV4dGVuc2lvbnNbIGtleSBdID09PSB0cnVlICkgZXh0ZW5zaW9uc1sga2V5IF0gPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCBPYmplY3Qua2V5cyggZXh0ZW5zaW9ucyApLmxlbmd0aCA+IDAgKSBkYXRhLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zOwoKCQkJcmV0dXJuIGRhdGE7CgoJCX0KCgl9CgoJLyoqCgkgKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBjYW1lcmFzLiBUaGlzIGNsYXNzIHNob3VsZCBhbHdheXMgYmUgaW5oZXJpdGVkCgkgKiB3aGVuIHlvdSBidWlsZCBhIG5ldyBjYW1lcmEuCgkgKgoJICogQGFic3RyYWN0CgkgKiBAYXVnbWVudHMgT2JqZWN0M0QKCSAqLwoJY2xhc3MgQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0QgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGNhbWVyYS4KCQkgKi8KCQljb25zdHJ1Y3RvcigpIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0NhbWVyYSA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnQ2FtZXJhJzsKCgkJCS8qKgoJCQkgKiBUaGUgaW52ZXJzZSBvZiB0aGUgY2FtZXJhJ3Mgd29ybGQgbWF0cml4LgoJCQkgKgoJCQkgKiBAdHlwZSB7TWF0cml4NH0KCQkJICovCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRyaXg0fQoJCQkgKi8KCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJCS8qKgoJCQkgKiBUaGUgaW52ZXJzZSBvZiB0aGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguCgkJCSAqCgkJCSAqIEB0eXBlIHtNYXRyaXg0fQoJCQkgKi8KCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCQkvKioKCQkJICogVGhlIGNvb3JkaW5hdGUgc3lzdGVtIGluIHdoaWNoIHRoZSBjYW1lcmEgaXMgdXNlZC4KCQkJICoKCQkJICogQHR5cGUgeyhXZWJHTENvb3JkaW5hdGVTeXN0ZW18V2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSl9CgkJCSAqLwoJCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW07CgoJCX0KCgkJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQkJdGhpcy5tYXRyaXhXb3JsZEludmVyc2UuY29weSggc291cmNlLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoKCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCXRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggc291cmNlLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgoJCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSBzb3VyY2UuY29vcmRpbmF0ZVN5c3RlbTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSB2ZWN0b3IgcmVwcmVzZW50aW5nIHRoZSAoImxvb2siKSBkaXJlY3Rpb24gb2YgdGhlIDNEIG9iamVjdCBpbiB3b3JsZCBzcGFjZS4KCQkgKgoJCSAqIFRoaXMgbWV0aG9kIGlzIG92ZXJ3cml0dGVuIHNpbmNlIGNhbWVyYXMgaGF2ZSBhIGRpZmZlcmVudCBmb3J3YXJkIHZlY3RvciBjb21wYXJlZCB0byBvdGhlcgoJCSAqIDNEIG9iamVjdHMuIEEgY2FtZXJhIGxvb2tzIGRvd24gaXRzIGxvY2FsLCBuZWdhdGl2ZSB6LWF4aXMgYnkgZGVmYXVsdC4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhlIHJlc3VsdCBpcyBzdG9yZWQgdG8uCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIDNEIG9iamVjdCdzIGRpcmVjdGlvbiBpbiB3b3JsZCBzcGFjZS4KCQkgKi8KCQlnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHN1cGVyLmdldFdvcmxkRGlyZWN0aW9uKCB0YXJnZXQgKS5uZWdhdGUoKTsKCgkJfQoKCQl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCQlzdXBlci51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJfQoKCQl1cGRhdGVXb3JsZE1hdHJpeCggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKSB7CgoJCQlzdXBlci51cGRhdGVXb3JsZE1hdHJpeCggdXBkYXRlUGFyZW50cywgdXBkYXRlQ2hpbGRyZW4gKTsKCgkJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJfQoKCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfQoKCX0KCgljb25zdCBfdjMkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCWNvbnN0IF9taW5UYXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7Cgljb25zdCBfbWF4VGFyZ2V0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwoKCS8qKgoJICogQ2FtZXJhIHRoYXQgdXNlcyBbcGVyc3BlY3RpdmUgcHJvamVjdGlvbl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUGVyc3BlY3RpdmVfKGdyYXBoaWNhbCl9LgoJICoKCSAqIFRoaXMgcHJvamVjdGlvbiBtb2RlIGlzIGRlc2lnbmVkIHRvIG1pbWljIHRoZSB3YXkgdGhlIGh1bWFuIGV5ZSBzZWVzLiBJdAoJICogaXMgdGhlIG1vc3QgY29tbW9uIHByb2plY3Rpb24gbW9kZSB1c2VkIGZvciByZW5kZXJpbmcgYSAzRCBzY2VuZS4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA0NSwgd2lkdGggLyBoZWlnaHQsIDEsIDEwMDAgKTsKCSAqIHNjZW5lLmFkZCggY2FtZXJhICk7CgkgKiBgYGAKCSAqCgkgKiBAYXVnbWVudHMgQ2FtZXJhCgkgKi8KCWNsYXNzIFBlcnNwZWN0aXZlQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBwZXJzcGVjdGl2ZSBjYW1lcmEuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gW2Zvdj01MF0gLSBUaGUgdmVydGljYWwgZmllbGQgb2Ygdmlldy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2FzcGVjdD0xXSAtIFRoZSBhc3BlY3QgcmF0aW8uCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuZWFyPTAuMV0gLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2Zhcj0yMDAwXSAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCgkJICovCgkJY29uc3RydWN0b3IoIGZvdiA9IDUwLCBhc3BlY3QgPSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKCQkJc3VwZXIoKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzUGVyc3BlY3RpdmVDYW1lcmEgPSB0cnVlOwoKCQkJdGhpcy50eXBlID0gJ1BlcnNwZWN0aXZlQ2FtZXJhJzsKCgkJCS8qKgoJCQkgKiBUaGUgdmVydGljYWwgZmllbGQgb2YgdmlldywgZnJvbSBib3R0b20gdG8gdG9wIG9mIHZpZXcsCgkJCSAqIGluIGRlZ3JlZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDUwCgkJCSAqLwoJCQl0aGlzLmZvdiA9IGZvdjsKCgkJCS8qKgoJCQkgKiBUaGUgem9vbSBmYWN0b3Igb2YgdGhlIGNhbWVyYS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy56b29tID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4gVGhlIHZhbGlkIHJhbmdlIGlzIGdyZWF0ZXIgdGhhbiBgMGAKCQkJICogYW5kIGxlc3MgdGhhbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmFyfS4KCQkJICoKCQkJICogTm90ZSB0aGF0LCB1bmxpa2UgZm9yIHRoZSB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhfSwgYDBgIGlzIDxlbT5ub3Q8L2VtPiBhCgkJCSAqIHZhbGlkIHZhbHVlIGZvciBhIHBlcnNwZWN0aXZlIGNhbWVyYSdzIG5lYXIgcGxhbmUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAuMQoJCQkgKi8KCQkJdGhpcy5uZWFyID0gbmVhcjsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgZmFyIHBsYW5lLiBNdXN0IGJlIGdyZWF0ZXIgdGhhbiB0aGUKCQkJICogY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjbmVhcn0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDIwMDAKCQkJICovCgkJCXRoaXMuZmFyID0gZmFyOwoKCQkJLyoqCgkJCSAqIE9iamVjdCBkaXN0YW5jZSB1c2VkIGZvciBzdGVyZW9zY29weSBhbmQgZGVwdGgtb2YtZmllbGQgZWZmZWN0cy4gVGhpcwoJCQkgKiBwYXJhbWV0ZXIgZG9lcyBub3QgaW5mbHVlbmNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCB1bmxlc3MgYQoJCQkgKiB7QGxpbmsgU3RlcmVvQ2FtZXJhfSBpcyBiZWluZyB1c2VkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxMAoJCQkgKi8KCQkJdGhpcy5mb2N1cyA9IDEwOwoKCQkJLyoqCgkJCSAqIFRoZSBhc3BlY3QgcmF0aW8sIHVzdWFsbHkgdGhlIGNhbnZhcyB3aWR0aCAvIGNhbnZhcyBoZWlnaHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuYXNwZWN0ID0gYXNwZWN0OwoKCQkJLyoqCgkJCSAqIFJlcHJlc2VudHMgdGhlIGZydXN0dW0gd2luZG93IHNwZWNpZmljYXRpb24uIFRoaXMgcHJvcGVydHkgc2hvdWxkIG5vdCBiZSBlZGl0ZWQKCQkJICogZGlyZWN0bHkgYnV0IHZpYSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0gYW5kIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNjbGVhclZpZXdPZmZzZXR9LgoJCQkgKgoJCQkgKiBAdHlwZSB7P09iamVjdH0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy52aWV3ID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBGaWxtIHNpemUgdXNlZCBmb3IgdGhlIGxhcmdlciBheGlzLiBEZWZhdWx0IGlzIGAzNWAgKG1pbGxpbWV0ZXJzKS4gVGhpcwoJCQkgKiBwYXJhbWV0ZXIgZG9lcyBub3QgaW5mbHVlbmNlIHRoZSBwcm9qZWN0aW9uIG1hdHJpeCB1bmxlc3Mge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1PZmZzZXR9CgkJCSAqIGlzIHNldCB0byBhIG5vbnplcm8gdmFsdWUuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDM1CgkJCSAqLwoJCQl0aGlzLmZpbG1HYXVnZSA9IDM1OwoKCQkJLyoqCgkJCSAqIEhvcml6b250YWwgb2ZmLWNlbnRlciBvZmZzZXQgaW4gdGhlIHNhbWUgdW5pdCBhcyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5maWxtT2Zmc2V0ID0gMDsKCgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJCXRoaXMuZm92ID0gc291cmNlLmZvdjsKCQkJdGhpcy56b29tID0gc291cmNlLnpvb207CgoJCQl0aGlzLm5lYXIgPSBzb3VyY2UubmVhcjsKCQkJdGhpcy5mYXIgPSBzb3VyY2UuZmFyOwoJCQl0aGlzLmZvY3VzID0gc291cmNlLmZvY3VzOwoKCQkJdGhpcy5hc3BlY3QgPSBzb3VyY2UuYXNwZWN0OwoJCQl0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnZpZXcgKTsKCgkJCXRoaXMuZmlsbUdhdWdlID0gc291cmNlLmZpbG1HYXVnZTsKCQkJdGhpcy5maWxtT2Zmc2V0ID0gc291cmNlLmZpbG1PZmZzZXQ7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBGT1YgYnkgZm9jYWwgbGVuZ3RoIGluIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCgkJICoKCQkgKiBUaGUgZGVmYXVsdCBmaWxtIGdhdWdlIGlzIDM1LCBzbyB0aGF0IHRoZSBmb2NhbCBsZW5ndGggY2FuIGJlIHNwZWNpZmllZCBmb3IKCQkgKiBhIDM1bW0gKGZ1bGwgZnJhbWUpIGNhbWVyYS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBmb2NhbExlbmd0aCAtIFZhbHVlcyBmb3IgZm9jYWwgbGVuZ3RoIGFuZCBmaWxtIGdhdWdlIG11c3QgaGF2ZSB0aGUgc2FtZSB1bml0LgoJCSAqLwoJCXNldEZvY2FsTGVuZ3RoKCBmb2NhbExlbmd0aCApIHsKCgkJCS8qKiBzZWUge0BsaW5rIGh0dHA6Ly93d3cuYm9iYXRraW5zLmNvbS9waG90b2dyYXBoeS90ZWNobmljYWwvZmllbGRfb2Zfdmlldy5odG1sfSAqLwoJCQljb25zdCB2RXh0ZW50U2xvcGUgPSAwLjUgKiB0aGlzLmdldEZpbG1IZWlnaHQoKSAvIGZvY2FsTGVuZ3RoOwoKCQkJdGhpcy5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggdkV4dGVudFNsb3BlICk7CgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGZvY2FsIGxlbmd0aCBmcm9tIHRoZSBjdXJyZW50IHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmb3Z9IGFuZAoJCSAqIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSNmaWxtR2F1Z2V9LgoJCSAqCgkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgY29tcHV0ZWQgZm9jYWwgbGVuZ3RoLgoJCSAqLwoJCWdldEZvY2FsTGVuZ3RoKCkgewoKCQkJY29uc3QgdkV4dGVudFNsb3BlID0gTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApOwoKCQkJcmV0dXJuIDAuNSAqIHRoaXMuZ2V0RmlsbUhlaWdodCgpIC8gdkV4dGVudFNsb3BlOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmVydGljYWwgZmllbGQgb2YgdmlldyBhbmdsZSBpbiBkZWdyZWVzIGNvbnNpZGVyaW5nIHtAbGluayBQZXJzcGVjdGl2ZUNhbWVyYSN6b29tfS4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGVmZmVjdGl2ZSBGT1YuCgkJICovCgkJZ2V0RWZmZWN0aXZlRk9WKCkgewoKCQkJcmV0dXJuIFJBRDJERUcgKiAyICogTWF0aC5hdGFuKAoJCQkJTWF0aC50YW4oIERFRzJSQUQgKiAwLjUgKiB0aGlzLmZvdiApIC8gdGhpcy56b29tICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgd2lkdGggb2YgdGhlIGltYWdlIG9uIHRoZSBmaWxtLiBJZiB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjYXNwZWN0fSBpcyBncmVhdGVyIHRoYW4gb3IKCQkgKiBlcXVhbCB0byBvbmUgKGxhbmRzY2FwZSBmb3JtYXQpLCB0aGUgcmVzdWx0IGVxdWFscyB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjZmlsbUdhdWdlfS4KCQkgKgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGZpbG0gd2lkdGguCgkJICovCgkJZ2V0RmlsbVdpZHRoKCkgewoKCQkJLy8gZmlsbSBub3QgY29tcGxldGVseSBjb3ZlcmVkIGluIHBvcnRyYWl0IGZvcm1hdCAoYXNwZWN0IDwgMSkKCQkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4oIHRoaXMuYXNwZWN0LCAxICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgaGVpZ2h0IG9mIHRoZSBpbWFnZSBvbiB0aGUgZmlsbS4gSWYge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2FzcGVjdH0gaXMgZ3JlYXRlciB0aGFuIG9yCgkJICogZXF1YWwgdG8gb25lIChsYW5kc2NhcGUgZm9ybWF0KSwgdGhlIHJlc3VsdCBlcXVhbHMge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI2ZpbG1HYXVnZX0uCgkJICoKCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBmaWxtIHdpZHRoLgoJCSAqLwoJCWdldEZpbG1IZWlnaHQoKSB7CgoJCQkvLyBmaWxtIG5vdCBjb21wbGV0ZWx5IGNvdmVyZWQgaW4gbGFuZHNjYXBlIGZvcm1hdCAoYXNwZWN0ID4gMSkKCQkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlIC8gTWF0aC5tYXgoIHRoaXMuYXNwZWN0LCAxICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIDJEIGJvdW5kcyBvZiB0aGUgY2FtZXJhJ3Mgdmlld2FibGUgcmVjdGFuZ2xlIGF0IGEgZ2l2ZW4gZGlzdGFuY2UgYWxvbmcgdGhlIHZpZXdpbmcgZGlyZWN0aW9uLgoJCSAqIFNldHMgYG1pblRhcmdldGAgYW5kIGBtYXhUYXJnZXRgIHRvIHRoZSBjb29yZGluYXRlcyBvZiB0aGUgbG93ZXItbGVmdCBhbmQgdXBwZXItcmlnaHQgY29ybmVycyBvZiB0aGUgdmlldyByZWN0YW5nbGUuCgkJICoKCQkgKiBAcGFyYW0ge251bWJlcn0gZGlzdGFuY2UgLSBUaGUgdmlld2luZyBkaXN0YW5jZS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjJ9IG1pblRhcmdldCAtIFRoZSBsb3dlci1sZWZ0IGNvcm5lciBvZiB0aGUgdmlldyByZWN0YW5nbGUgaXMgd3JpdHRlbiBpbnRvIHRoaXMgdmVjdG9yLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gbWF4VGFyZ2V0IC0gVGhlIHVwcGVyLXJpZ2h0IGNvcm5lciBvZiB0aGUgdmlldyByZWN0YW5nbGUgaXMgd3JpdHRlbiBpbnRvIHRoaXMgdmVjdG9yLgoJCSAqLwoJCWdldFZpZXdCb3VuZHMoIGRpc3RhbmNlLCBtaW5UYXJnZXQsIG1heFRhcmdldCApIHsKCgkJCV92MyQxLnNldCggLTEsIC0xLCAwLjUgKS5hcHBseU1hdHJpeDQoIHRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJCW1pblRhcmdldC5zZXQoIF92MyQxLngsIF92MyQxLnkgKS5tdWx0aXBseVNjYWxhciggLSBkaXN0YW5jZSAvIF92MyQxLnogKTsKCgkJCV92MyQxLnNldCggMSwgMSwgMC41ICkuYXBwbHlNYXRyaXg0KCB0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgoJCQltYXhUYXJnZXQuc2V0KCBfdjMkMS54LCBfdjMkMS55ICkubXVsdGlwbHlTY2FsYXIoIC0gZGlzdGFuY2UgLyBfdjMkMS56ICk7CgoJCX0KCgkJLyoqCgkJICogQ29tcHV0ZXMgdGhlIHdpZHRoIGFuZCBoZWlnaHQgb2YgdGhlIGNhbWVyYSdzIHZpZXdhYmxlIHJlY3RhbmdsZSBhdCBhIGdpdmVuIGRpc3RhbmNlIGFsb25nIHRoZSB2aWV3aW5nIGRpcmVjdGlvbi4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBkaXN0YW5jZSAtIFRoZSB2aWV3aW5nIGRpc3RhbmNlLgoJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHJlc3VsdCB3aGVyZSB4IGlzIHdpZHRoIGFuZCB5IGlzIGhlaWdodC4KCQkgKiBAcmV0dXJucyB7VmVjdG9yMn0gVGhlIHZpZXcgc2l6ZS4KCQkgKi8KCQlnZXRWaWV3U2l6ZSggZGlzdGFuY2UsIHRhcmdldCApIHsKCgkJCXRoaXMuZ2V0Vmlld0JvdW5kcyggZGlzdGFuY2UsIF9taW5UYXJnZXQsIF9tYXhUYXJnZXQgKTsKCgkJCXJldHVybiB0YXJnZXQuc3ViVmVjdG9ycyggX21heFRhcmdldCwgX21pblRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgYW4gb2Zmc2V0IGluIGEgbGFyZ2VyIGZydXN0dW0uIFRoaXMgaXMgdXNlZnVsIGZvciBtdWx0aS13aW5kb3cgb3IKCQkgKiBtdWx0aS1tb25pdG9yL211bHRpLW1hY2hpbmUgc2V0dXBzLgoJCSAqCgkJICogRm9yIGV4YW1wbGUsIGlmIHlvdSBoYXZlIDN4MiBtb25pdG9ycyBhbmQgZWFjaCBtb25pdG9yIGlzIDE5MjB4MTA4MCBhbmQKCQkgKiB0aGUgbW9uaXRvcnMgYXJlIGluIGdyaWQgbGlrZSB0aGlzCgkJICpgYGAKCQkgKiAgICstLS0rLS0tKy0tLSsKCQkgKiAgIHwgQSB8IEIgfCBDIHwKCQkgKiAgICstLS0rLS0tKy0tLSsKCQkgKiAgIHwgRCB8IEUgfCBGIHwKCQkgKiAgICstLS0rLS0tKy0tLSsKCQkgKmBgYAoJCSAqIHRoZW4gZm9yIGVhY2ggbW9uaXRvciB5b3Ugd291bGQgY2FsbCBpdCBsaWtlIHRoaXM6CgkJICpgYGBqcwoJCSAqIGNvbnN0IHcgPSAxOTIwOwoJCSAqIGNvbnN0IGggPSAxMDgwOwoJCSAqIGNvbnN0IGZ1bGxXaWR0aCA9IHcgKiAzOwoJCSAqIGNvbnN0IGZ1bGxIZWlnaHQgPSBoICogMjsKCQkgKgoJCSAqIC8vIC0tQS0tCgkJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAwLCB3LCBoICk7CgkJICogLy8gLS1CLS0KCQkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDAsIHcsIGggKTsKCQkgKiAvLyAtLUMtLQoJCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAyLCBoICogMCwgdywgaCApOwoJCSAqIC8vIC0tRC0tCgkJICogY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDAsIGggKiAxLCB3LCBoICk7CgkJICogLy8gLS1FLS0KCQkgKiBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDEsIHcsIGggKTsKCQkgKiAvLyAtLUYtLQoJCSAqIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAyLCBoICogMSwgdywgaCApOwoJCSAqIGBgYAoJCSAqCgkJICogTm90ZSB0aGVyZSBpcyBubyByZWFzb24gbW9uaXRvcnMgaGF2ZSB0byBiZSB0aGUgc2FtZSBzaXplIG9yIGluIGEgZ3JpZC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsV2lkdGggLSBUaGUgZnVsbCB3aWR0aCBvZiBtdWx0aXZpZXcgc2V0dXAuCgkJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxIZWlnaHQgLSBUaGUgZnVsbCBoZWlnaHQgb2YgbXVsdGl2aWV3IHNldHVwLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGhvcml6b250YWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHN1YmNhbWVyYS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiBzdWJjYW1lcmEuCgkJICovCgkJc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCQkJdGhpcy5hc3BlY3QgPSBmdWxsV2lkdGggLyBmdWxsSGVpZ2h0OwoKCQkJaWYgKCB0aGlzLnZpZXcgPT09IG51bGwgKSB7CgoJCQkJdGhpcy52aWV3ID0gewoJCQkJCWVuYWJsZWQ6IHRydWUsCgkJCQkJZnVsbFdpZHRoOiAxLAoJCQkJCWZ1bGxIZWlnaHQ6IDEsCgkJCQkJb2Zmc2V0WDogMCwKCQkJCQlvZmZzZXRZOiAwLAoJCQkJCXdpZHRoOiAxLAoJCQkJCWhlaWdodDogMQoJCQkJfTsKCgkJCX0KCgkJCXRoaXMudmlldy5lbmFibGVkID0gdHJ1ZTsKCQkJdGhpcy52aWV3LmZ1bGxXaWR0aCA9IGZ1bGxXaWR0aDsKCQkJdGhpcy52aWV3LmZ1bGxIZWlnaHQgPSBmdWxsSGVpZ2h0OwoJCQl0aGlzLnZpZXcub2Zmc2V0WCA9IHg7CgkJCXRoaXMudmlldy5vZmZzZXRZID0geTsKCQkJdGhpcy52aWV3LndpZHRoID0gd2lkdGg7CgkJCXRoaXMudmlldy5oZWlnaHQgPSBoZWlnaHQ7CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfQoKCQkvKioKCQkgKiBSZW1vdmVzIHRoZSB2aWV3IG9mZnNldCBmcm9tIHRoZSBwcm9qZWN0aW9uIG1hdHJpeC4KCQkgKi8KCQljbGVhclZpZXdPZmZzZXQoKSB7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLnZpZXcuZW5hYmxlZCA9IGZhbHNlOwoKCQkJfQoKCQkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJCX0KCgkJLyoqCgkJICogVXBkYXRlcyB0aGUgY2FtZXJhJ3MgcHJvamVjdGlvbiBtYXRyaXguIE11c3QgYmUgY2FsbGVkIGFmdGVyIGFueSBjaGFuZ2Ugb2YKCQkgKiBjYW1lcmEgcHJvcGVydGllcy4KCQkgKi8KCQl1cGRhdGVQcm9qZWN0aW9uTWF0cml4KCkgewoKCQkJY29uc3QgbmVhciA9IHRoaXMubmVhcjsKCQkJbGV0IHRvcCA9IG5lYXIgKiBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICkgLyB0aGlzLnpvb207CgkJCWxldCBoZWlnaHQgPSAyICogdG9wOwoJCQlsZXQgd2lkdGggPSB0aGlzLmFzcGVjdCAqIGhlaWdodDsKCQkJbGV0IGxlZnQgPSAtMC41ICogd2lkdGg7CgkJCWNvbnN0IHZpZXcgPSB0aGlzLnZpZXc7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCgkJCQljb25zdCBmdWxsV2lkdGggPSB2aWV3LmZ1bGxXaWR0aCwKCQkJCQlmdWxsSGVpZ2h0ID0gdmlldy5mdWxsSGVpZ2h0OwoKCQkJCWxlZnQgKz0gdmlldy5vZmZzZXRYICogd2lkdGggLyBmdWxsV2lkdGg7CgkJCQl0b3AgLT0gdmlldy5vZmZzZXRZICogaGVpZ2h0IC8gZnVsbEhlaWdodDsKCQkJCXdpZHRoICo9IHZpZXcud2lkdGggLyBmdWxsV2lkdGg7CgkJCQloZWlnaHQgKj0gdmlldy5oZWlnaHQgLyBmdWxsSGVpZ2h0OwoKCQkJfQoKCQkJY29uc3Qgc2tldyA9IHRoaXMuZmlsbU9mZnNldDsKCQkJaWYgKCBza2V3ICE9PSAwICkgbGVmdCArPSBuZWFyICogc2tldyAvIHRoaXMuZ2V0RmlsbVdpZHRoKCk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0LCBsZWZ0ICsgd2lkdGgsIHRvcCwgdG9wIC0gaGVpZ2h0LCBuZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCQl9CgoJCXRvSlNPTiggbWV0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJCWRhdGEub2JqZWN0LmZvdiA9IHRoaXMuZm92OwoJCQlkYXRhLm9iamVjdC56b29tID0gdGhpcy56b29tOwoKCQkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKCQkJZGF0YS5vYmplY3QuZmFyID0gdGhpcy5mYXI7CgkJCWRhdGEub2JqZWN0LmZvY3VzID0gdGhpcy5mb2N1czsKCgkJCWRhdGEub2JqZWN0LmFzcGVjdCA9IHRoaXMuYXNwZWN0OwoKCQkJaWYgKCB0aGlzLnZpZXcgIT09IG51bGwgKSBkYXRhLm9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIHRoaXMudmlldyApOwoKCQkJZGF0YS5vYmplY3QuZmlsbUdhdWdlID0gdGhpcy5maWxtR2F1Z2U7CgkJCWRhdGEub2JqZWN0LmZpbG1PZmZzZXQgPSB0aGlzLmZpbG1PZmZzZXQ7CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0KCgljb25zdCBmb3YgPSAtOTA7IC8vIG5lZ2F0aXZlIGZvdiBpcyBub3QgYW4gZXJyb3IKCWNvbnN0IGFzcGVjdCA9IDE7CgoJLyoqCgkgKiBBIHNwZWNpYWwgdHlwZSBvZiBjYW1lcmEgdGhhdCBpcyBwb3NpdGlvbmVkIGluIDNEIHNwYWNlIHRvIHJlbmRlciBpdHMgc3Vycm91bmRpbmdzIGludG8gYQoJICogY3ViZSByZW5kZXIgdGFyZ2V0LiBUaGUgcmVuZGVyIHRhcmdldCBjYW4gdGhlbiBiZSB1c2VkIGFzIGFuIGVudmlyb25tZW50IG1hcCBmb3IgcmVuZGVyaW5nCgkgKiByZWFsdGltZSByZWZsZWN0aW9ucyBpbiB5b3VyIHNjZW5lLgoJICoKCSAqIGBgYGpzCgkgKiAvLyBDcmVhdGUgY3ViZSByZW5kZXIgdGFyZ2V0CgkgKiBjb25zdCBjdWJlUmVuZGVyVGFyZ2V0ID0gbmV3IFRIUkVFLldlYkdMQ3ViZVJlbmRlclRhcmdldCggMjU2LCB7IGdlbmVyYXRlTWlwbWFwczogdHJ1ZSwgbWluRmlsdGVyOiBUSFJFRS5MaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgfSApOwoJICoKCSAqIC8vIENyZWF0ZSBjdWJlIGNhbWVyYQoJICogY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBUSFJFRS5DdWJlQ2FtZXJhKCAxLCAxMDAwMDAsIGN1YmVSZW5kZXJUYXJnZXQgKTsKCSAqIHNjZW5lLmFkZCggY3ViZUNhbWVyYSApOwoJICoKCSAqIC8vIENyZWF0ZSBjYXIKCSAqIGNvbnN0IGNocm9tZU1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBlbnZNYXA6IGN1YmVSZW5kZXJUYXJnZXQudGV4dHVyZSB9ICk7CgkgKiBjb25zdCBjYXIgPSBuZXcgVEhSRUUuTWVzaCggY2FyR2VvbWV0cnksIGNocm9tZU1hdGVyaWFsICk7CgkgKiBzY2VuZS5hZGQoIGNhciApOwoJICoKCSAqIC8vIFVwZGF0ZSB0aGUgcmVuZGVyIHRhcmdldCBjdWJlCgkgKiBjYXIudmlzaWJsZSA9IGZhbHNlOwoJICogY3ViZUNhbWVyYS5wb3NpdGlvbi5jb3B5KCBjYXIucG9zaXRpb24gKTsKCSAqIGN1YmVDYW1lcmEudXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKTsKCSAqCgkgKiAvLyBSZW5kZXIgdGhlIHNjZW5lCgkgKiBjYXIudmlzaWJsZSA9IHRydWU7CgkgKiByZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmEgKTsKCSAqIGBgYAoJICoKCSAqIEBhdWdtZW50cyBPYmplY3QzRAoJICovCgljbGFzcyBDdWJlQ2FtZXJhIGV4dGVuZHMgT2JqZWN0M0QgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IGN1YmUgY2FtZXJhLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IG5lYXIgLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gZmFyIC0gVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4KCQkgKiBAcGFyYW0ge1dlYkdMQ3ViZVJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIGN1YmUgcmVuZGVyIHRhcmdldC4KCQkgKi8KCQljb25zdHJ1Y3RvciggbmVhciwgZmFyLCByZW5kZXJUYXJnZXQgKSB7CgoJCQlzdXBlcigpOwoKCQkJdGhpcy50eXBlID0gJ0N1YmVDYW1lcmEnOwoKCQkJLyoqCgkJCSAqIEEgcmVmZXJlbmNlIHRvIHRoZSBjdWJlIHJlbmRlciB0YXJnZXQuCgkJCSAqCgkJCSAqIEB0eXBlIHtXZWJHTEN1YmVSZW5kZXJUYXJnZXR9CgkJCSAqLwoJCQl0aGlzLnJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKCgkJCS8qKgoJCQkgKiBUaGUgY3VycmVudCBhY3RpdmUgY29vcmRpbmF0ZSBzeXN0ZW0uCgkJCSAqCgkJCSAqIEB0eXBlIHs/KFdlYkdMQ29vcmRpbmF0ZVN5c3RlbXxXZWJHUFVDb29yZGluYXRlU3lzdGVtKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBUaGUgY3VycmVudCBhY3RpdmUgbWlwbWFwIGxldmVsCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMuYWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoKCQkJY29uc3QgY2FtZXJhUFggPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhUFgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFQWCApOwoKCQkJY29uc3QgY2FtZXJhTlggPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhTlgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFOWCApOwoKCQkJY29uc3QgY2FtZXJhUFkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhUFkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFQWSApOwoKCQkJY29uc3QgY2FtZXJhTlkgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhTlkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFOWSApOwoKCQkJY29uc3QgY2FtZXJhUFogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhUFoubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFQWiApOwoKCQkJY29uc3QgY2FtZXJhTlogPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoIGZvdiwgYXNwZWN0LCBuZWFyLCBmYXIgKTsKCQkJY2FtZXJhTloubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJCXRoaXMuYWRkKCBjYW1lcmFOWiApOwoKCQl9CgoJCS8qKgoJCSAqIE11c3QgYmUgY2FsbGVkIHdoZW4gdGhlIGNvb3JkaW5hdGUgc3lzdGVtIG9mIHRoZSBjdWJlIGNhbWVyYSBpcyBjaGFuZ2VkLgoJCSAqLwoJCXVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CgoJCQljb25zdCBjb29yZGluYXRlU3lzdGVtID0gdGhpcy5jb29yZGluYXRlU3lzdGVtOwoKCQkJY29uc3QgY2FtZXJhcyA9IHRoaXMuY2hpbGRyZW4uY29uY2F0KCk7CgoJCQljb25zdCBbIGNhbWVyYVBYLCBjYW1lcmFOWCwgY2FtZXJhUFksIGNhbWVyYU5ZLCBjYW1lcmFQWiwgY2FtZXJhTlogXSA9IGNhbWVyYXM7CgoJCQlmb3IgKCBjb25zdCBjYW1lcmEgb2YgY2FtZXJhcyApIHRoaXMucmVtb3ZlKCBjYW1lcmEgKTsKCgkJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJCWNhbWVyYVBYLnVwLnNldCggMCwgMSwgMCApOwoJCQkJY2FtZXJhUFgubG9va0F0KCAxLCAwLCAwICk7CgoJCQkJY2FtZXJhTlgudXAuc2V0KCAwLCAxLCAwICk7CgkJCQljYW1lcmFOWC5sb29rQXQoIC0xLCAwLCAwICk7CgoJCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAtMSApOwoJCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgoJCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAxICk7CgkJCQljYW1lcmFOWS5sb29rQXQoIDAsIC0xLCAwICk7CgoJCQkJY2FtZXJhUFoudXAuc2V0KCAwLCAxLCAwICk7CgkJCQljYW1lcmFQWi5sb29rQXQoIDAsIDAsIDEgKTsKCgkJCQljYW1lcmFOWi51cC5zZXQoIDAsIDEsIDAgKTsKCQkJCWNhbWVyYU5aLmxvb2tBdCggMCwgMCwgLTEgKTsKCgkJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQkJY2FtZXJhUFgudXAuc2V0KCAwLCAtMSwgMCApOwoJCQkJY2FtZXJhUFgubG9va0F0KCAtMSwgMCwgMCApOwoKCQkJCWNhbWVyYU5YLnVwLnNldCggMCwgLTEsIDAgKTsKCQkJCWNhbWVyYU5YLmxvb2tBdCggMSwgMCwgMCApOwoKCQkJCWNhbWVyYVBZLnVwLnNldCggMCwgMCwgMSApOwoJCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgoJCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAtMSApOwoJCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtMSwgMCApOwoKCQkJCWNhbWVyYVBaLnVwLnNldCggMCwgLTEsIDAgKTsKCQkJCWNhbWVyYVBaLmxvb2tBdCggMCwgMCwgMSApOwoKCQkJCWNhbWVyYU5aLnVwLnNldCggMCwgLTEsIDAgKTsKCQkJCWNhbWVyYU5aLmxvb2tBdCggMCwgMCwgLTEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuQ3ViZUNhbWVyYS51cGRhdGVDb29yZGluYXRlU3lzdGVtKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCQl9CgoJCQlmb3IgKCBjb25zdCBjYW1lcmEgb2YgY2FtZXJhcyApIHsKCgkJCQl0aGlzLmFkZCggY2FtZXJhICk7CgoJCQkJY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogQ2FsbGluZyB0aGlzIG1ldGhvZCB3aWxsIHJlbmRlciB0aGUgZ2l2ZW4gc2NlbmUgd2l0aCB0aGUgZ2l2ZW4gcmVuZGVyZXIKCQkgKiBpbnRvIHRoZSBjdWJlIHJlbmRlciB0YXJnZXQgb2YgdGhlIGNhbWVyYS4KCQkgKgoJCSAqIEBwYXJhbSB7KFJlbmRlcmVyfFdlYkdMUmVuZGVyZXIpfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KCQkgKiBAcGFyYW0ge1NjZW5lfSBzY2VuZSAtIFRoZSBzY2VuZSB0byByZW5kZXIuCgkJICovCgkJdXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKSB7CgoJCQlpZiAoIHRoaXMucGFyZW50ID09PSBudWxsICkgdGhpcy51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJY29uc3QgeyByZW5kZXJUYXJnZXQsIGFjdGl2ZU1pcG1hcExldmVsIH0gPSB0aGlzOwoKCQkJaWYgKCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gIT09IHJlbmRlcmVyLmNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gcmVuZGVyZXIuY29vcmRpbmF0ZVN5c3RlbTsKCgkJCQl0aGlzLnVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKTsKCgkJCX0KCgkJCWNvbnN0IFsgY2FtZXJhUFgsIGNhbWVyYU5YLCBjYW1lcmFQWSwgY2FtZXJhTlksIGNhbWVyYVBaLCBjYW1lcmFOWiBdID0gdGhpcy5jaGlsZHJlbjsKCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJY29uc3QgY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQkJY29uc3QgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCgkJCWNvbnN0IGN1cnJlbnRYckVuYWJsZWQgPSByZW5kZXJlci54ci5lbmFibGVkOwoKCQkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKCQkJY29uc3QgZ2VuZXJhdGVNaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhUFggKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCAxLCBhY3RpdmVNaXBtYXBMZXZlbCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWCApOwoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQsIDIsIGFjdGl2ZU1pcG1hcExldmVsICk7CgkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVBZICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMywgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlkgKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCA0LCBhY3RpdmVNaXBtYXBMZXZlbCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWiApOwoKCQkJLy8gbWlwbWFwcyBhcmUgZ2VuZXJhdGVkIGR1cmluZyB0aGUgbGFzdCBjYWxsIG9mIHJlbmRlcigpCgkJCS8vIGF0IHRoaXMgcG9pbnQsIGFsbCBzaWRlcyBvZiB0aGUgY3ViZSByZW5kZXIgdGFyZ2V0IGFyZSBkZWZpbmVkCgoJCQlyZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBnZW5lcmF0ZU1pcG1hcHM7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgNSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhTlogKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgY3VycmVudEFjdGl2ZUN1YmVGYWNlLCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgKTsKCgkJCXJlbmRlcmVyLnhyLmVuYWJsZWQgPSBjdXJyZW50WHJFbmFibGVkOwoKCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUubmVlZHNQTVJFTVVwZGF0ZSA9IHRydWU7CgoJCX0KCgl9CgoJLyoqCgkgKiBDcmVhdGVzIGEgY3ViZSB0ZXh0dXJlIG1hZGUgdXAgb2Ygc2l4IGltYWdlcy4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLkN1YmVUZXh0dXJlTG9hZGVyKCk7CgkgKiBsb2FkZXIuc2V0UGF0aCggJ3RleHR1cmVzL2N1YmUvcGlzYS8nICk7CgkgKgoJICogY29uc3QgdGV4dHVyZUN1YmUgPSBsb2FkZXIubG9hZCggWwoJICogCSdweC5wbmcnLCAnbngucG5nJywgJ3B5LnBuZycsICdueS5wbmcnLCAncHoucG5nJywgJ256LnBuZycKCSAqIF0gKTsKCSAqCgkgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmZmYsIGVudk1hcDogdGV4dHVyZUN1YmUgfSApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIFRleHR1cmUKCSAqLwoJY2xhc3MgQ3ViZVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBjdWJlIHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5PEltYWdlPn0gW2ltYWdlcz1bXV0gLSBBbiBhcnJheSBob2xkaW5nIGEgaW1hZ2UgZm9yIGVhY2ggc2lkZSBvZiBhIGN1YmUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPUN1YmVSZWZsZWN0aW9uTWFwcGluZ10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyTWlwbWFwTGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbY29sb3JTcGFjZT1Ob0NvbG9yU3BhY2VdIC0gVGhlIGNvbG9yIHNwYWNlIHZhbHVlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBpbWFnZXMgPSBbXSwgbWFwcGluZyA9IEN1YmVSZWZsZWN0aW9uTWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKCQkJc3VwZXIoIGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0N1YmVUZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBJZiBzZXQgdG8gYHRydWVgLCB0aGUgdGV4dHVyZSBpcyBmbGlwcGVkIGFsb25nIHRoZSB2ZXJ0aWNhbCBheGlzIHdoZW4KCQkJICogdXBsb2FkZWQgdG8gdGhlIEdQVS4KCQkJICoKCQkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKCQl9CgoJCS8qKgoJCSAqIEFsaWFzIGZvciB7QGxpbmsgQ3ViZVRleHR1cmUjaW1hZ2V9LgoJCSAqCgkJICogQHR5cGUge0FycmF5PEltYWdlPn0KCQkgKi8KCQlnZXQgaW1hZ2VzKCkgewoKCQkJcmV0dXJuIHRoaXMuaW1hZ2U7CgoJCX0KCgkJc2V0IGltYWdlcyggdmFsdWUgKSB7CgoJCQl0aGlzLmltYWdlID0gdmFsdWU7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIGN1YmUgcmVuZGVyIHRhcmdldCB1c2VkIGluIGNvbnRleHQgb2Yge0BsaW5rIFdlYkdMUmVuZGVyZXJ9LgoJICoKCSAqIEBhdWdtZW50cyBXZWJHTFJlbmRlclRhcmdldAoJICovCgljbGFzcyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgY3ViZSByZW5kZXIgdGFyZ2V0LgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFtzaXplPTFdIC0gVGhlIHNpemUgb2YgdGhlIHJlbmRlciB0YXJnZXQuCgkJICogQHBhcmFtIHtSZW5kZXJUYXJnZXR+T3B0aW9uc30gW29wdGlvbnNdIC0gVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0LgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBzaXplID0gMSwgb3B0aW9ucyA9IHt9ICkgewoKCQkJc3VwZXIoIHNpemUsIHNpemUsIG9wdGlvbnMgKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsKCgkJCWNvbnN0IGltYWdlID0geyB3aWR0aDogc2l6ZSwgaGVpZ2h0OiBzaXplLCBkZXB0aDogMSB9OwoJCQljb25zdCBpbWFnZXMgPSBbIGltYWdlLCBpbWFnZSwgaW1hZ2UsIGltYWdlLCBpbWFnZSwgaW1hZ2UgXTsKCgkJCS8qKgoJCQkgKiBPdmVyd3JpdHRlbiB3aXRoIGEgZGlmZmVyZW50IHRleHR1cmUgdHlwZS4KCQkJICoKCQkJICogQHR5cGUge0RhdGFBcnJheVRleHR1cmV9CgkJCSAqLwoJCQl0aGlzLnRleHR1cmUgPSBuZXcgQ3ViZVRleHR1cmUoIGltYWdlcyApOwoJCQl0aGlzLl9zZXRUZXh0dXJlT3B0aW9ucyggb3B0aW9ucyApOwoKCQkJLy8gQnkgY29udmVudGlvbiAtLSBsaWtlbHkgYmFzZWQgb24gdGhlIFJlbmRlck1hbiBzcGVjIGZyb20gdGhlIDE5OTAncyAtLSBjdWJlIG1hcHMgYXJlIHNwZWNpZmllZCBieSBXZWJHTCAoYW5kIHRocmVlLmpzKQoJCQkvLyBpbiBhIGNvb3JkaW5hdGUgc3lzdGVtIGluIHdoaWNoIHBvc2l0aXZlLXggaXMgdG8gdGhlIHJpZ2h0IHdoZW4gbG9va2luZyB1cCB0aGUgcG9zaXRpdmUteiBheGlzIC0tIGluIG90aGVyIHdvcmRzLAoJCQkvLyBpbiBhIGxlZnQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBCeSBjb250aW51aW5nIHRoaXMgY29udmVudGlvbiwgcHJlZXhpc3RpbmcgY3ViZSBtYXBzIGNvbnRpbnVlZCB0byByZW5kZXIgY29ycmVjdGx5LgoKCQkJLy8gdGhyZWUuanMgdXNlcyBhIHJpZ2h0LWhhbmRlZCBjb29yZGluYXRlIHN5c3RlbS4gU28gZW52aXJvbm1lbnQgbWFwcyB1c2VkIGluIHRocmVlLmpzIGFwcGVhciB0byBoYXZlIHB4IGFuZCBueCBzd2FwcGVkCgkJCS8vIGFuZCB0aGUgZmxhZyBpc1JlbmRlclRhcmdldFRleHR1cmUgY29udHJvbHMgdGhpcyBjb252ZXJzaW9uLiBUaGUgZmxpcCBpcyBub3QgcmVxdWlyZWQgd2hlbiB1c2luZyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQudGV4dHVyZQoJCQkvLyBhcyBhIGN1YmUgdGV4dHVyZSAodGhpcyBpcyBkZXRlY3RlZCB3aGVuIGlzUmVuZGVyVGFyZ2V0VGV4dHVyZSBpcyBzZXQgdG8gdHJ1ZSBmb3IgY3ViZSB0ZXh0dXJlcykuCgoJCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBDb252ZXJ0cyB0aGUgZ2l2ZW4gZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmUgdG8gYSBjdWJlIG1hcC4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIGVxdWlyZWN0YW5ndWxhciB0ZXh0dXJlLgoJCSAqIEByZXR1cm4ge1dlYkdMQ3ViZVJlbmRlclRhcmdldH0gQSByZWZlcmVuY2UgdG8gdGhpcyBjdWJlIHJlbmRlciB0YXJnZXQuCgkJICovCgkJZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUoIHJlbmRlcmVyLCB0ZXh0dXJlICkgewoKCQkJdGhpcy50ZXh0dXJlLnR5cGUgPSB0ZXh0dXJlLnR5cGU7CgkJCXRoaXMudGV4dHVyZS5jb2xvclNwYWNlID0gdGV4dHVyZS5jb2xvclNwYWNlOwoKCQkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoJCQl0aGlzLnRleHR1cmUubWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgkJCXRoaXMudGV4dHVyZS5tYWdGaWx0ZXIgPSB0ZXh0dXJlLm1hZ0ZpbHRlcjsKCgkJCWNvbnN0IHNoYWRlciA9IHsKCgkJCQl1bmlmb3JtczogewoJCQkJCXRFcXVpcmVjdDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJfSwKCgkJCQl2ZXJ0ZXhTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQkJdmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjsKCgkJCQl2ZWMzIHRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkgewoKCQkJCQlyZXR1cm4gbm9ybWFsaXplKCAoIG1hdHJpeCAqIHZlYzQoIGRpciwgMC4wICkgKS54eXogKTsKCgkJCQl9CgoJCQkJdm9pZCBtYWluKCkgewoKCQkJCQl2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApOwoKCQkJCQkjaW5jbHVkZSA8YmVnaW5fdmVydGV4PgoJCQkJCSNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD4KCgkJCQl9CgkJCWAsCgoJCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQkJdW5pZm9ybSBzYW1wbGVyMkQgdEVxdWlyZWN0OwoKCQkJCXZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247CgoJCQkJI2luY2x1ZGUgPGNvbW1vbj4KCgkJCQl2b2lkIG1haW4oKSB7CgoJCQkJCXZlYzMgZGlyZWN0aW9uID0gbm9ybWFsaXplKCB2V29ybGREaXJlY3Rpb24gKTsKCgkJCQkJdmVjMiBzYW1wbGVVViA9IGVxdWlyZWN0VXYoIGRpcmVjdGlvbiApOwoKCQkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlMkQoIHRFcXVpcmVjdCwgc2FtcGxlVVYgKTsKCgkJCQl9CgkJCWAKCQkJfTsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IEJveEdlb21ldHJ5KCA1LCA1LCA1ICk7CgoJCQljb25zdCBtYXRlcmlhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoKCQkJCW5hbWU6ICdDdWJlbWFwRnJvbUVxdWlyZWN0JywKCgkJCQl1bmlmb3JtczogY2xvbmVVbmlmb3Jtcyggc2hhZGVyLnVuaWZvcm1zICksCgkJCQl2ZXJ0ZXhTaGFkZXI6IHNoYWRlci52ZXJ0ZXhTaGFkZXIsCgkJCQlmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLAoJCQkJc2lkZTogQmFja1NpZGUsCgkJCQlibGVuZGluZzogTm9CbGVuZGluZwoKCQkJfSApOwoKCQkJbWF0ZXJpYWwudW5pZm9ybXMudEVxdWlyZWN0LnZhbHVlID0gdGV4dHVyZTsKCgkJCWNvbnN0IG1lc2ggPSBuZXcgTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCQljb25zdCBjdXJyZW50TWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgoJCQkvLyBBdm9pZCBibHVycmVkIHBvbGVzCgkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgPT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHRleHR1cmUubWluRmlsdGVyID0gTGluZWFyRmlsdGVyOwoKCQkJY29uc3QgY2FtZXJhID0gbmV3IEN1YmVDYW1lcmEoIDEsIDEwLCB0aGlzICk7CgkJCWNhbWVyYS51cGRhdGUoIHJlbmRlcmVyLCBtZXNoICk7CgoJCQl0ZXh0dXJlLm1pbkZpbHRlciA9IGN1cnJlbnRNaW5GaWx0ZXI7CgoJCQltZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQkJbWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDbGVhcnMgdGhpcyBjdWJlIHJlbmRlciB0YXJnZXQuCgkJICoKCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NvbG9yPXRydWVdIC0gV2hldGhlciB0aGUgY29sb3IgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtkZXB0aD10cnVlXSAtIFdoZXRoZXIgdGhlIGRlcHRoIGJ1ZmZlciBzaG91bGQgYmUgY2xlYXJlZCBvciBub3QuCgkJICogQHBhcmFtIHtib29sZWFufSBbc3RlbmNpbD10cnVlXSAtIFdoZXRoZXIgdGhlIHN0ZW5jaWwgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KCQkgKi8KCQljbGVhciggcmVuZGVyZXIsIGNvbG9yID0gdHJ1ZSwgZGVwdGggPSB0cnVlLCBzdGVuY2lsID0gdHJ1ZSApIHsKCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCB0aGlzLCBpICk7CgoJCQkJcmVuZGVyZXIuY2xlYXIoIGNvbG9yLCBkZXB0aCwgc3RlbmNpbCApOwoKCQkJfQoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBjdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBUaGlzIGlzIGFsbW9zdCBpZGVudGljYWwgdG8gYW4ge0BsaW5rIE9iamVjdDNEfS4gSXRzIHB1cnBvc2UgaXMgdG8KCSAqIG1ha2Ugd29ya2luZyB3aXRoIGdyb3VwcyBvZiBvYmplY3RzIHN5bnRhY3RpY2FsbHkgY2xlYXJlci4KCSAqCgkgKiBgYGBqcwoJICogLy8gQ3JlYXRlIGEgZ3JvdXAgYW5kIGFkZCB0aGUgdHdvIGN1YmVzLgoJICogLy8gVGhlc2UgY3ViZXMgY2FuIG5vdyBiZSByb3RhdGVkIC8gc2NhbGVkIGV0YyBhcyBhIGdyb3VwLgoJICogY29uc3QgZ3JvdXAgPSBuZXcgVEhSRUUuR3JvdXAoKTsKCSAqCgkgKiBncm91cC5hZGQoIG1lc2hBICk7CgkgKiBncm91cC5hZGQoIG1lc2hCICk7CgkgKgoJICogc2NlbmUuYWRkKCBncm91cCApOwoJICogYGBgCgkgKgoJICogQGF1Z21lbnRzIE9iamVjdDNECgkgKi8KCWNsYXNzIEdyb3VwIGV4dGVuZHMgT2JqZWN0M0QgewoKCQljb25zdHJ1Y3RvcigpIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0dyb3VwID0gdHJ1ZTsKCgkJCXRoaXMudHlwZSA9ICdHcm91cCc7CgoJCX0KCgl9CgoJY29uc3QgX21vdmVFdmVudCA9IHsgdHlwZTogJ21vdmUnIH07CgoJLyoqCgkgKiBDbGFzcyBmb3IgcmVwcmVzZW50aW5nIGEgWFIgY29udHJvbGxlciB3aXRoIGl0cwoJICogZGlmZmVyZW50IGNvb3JkaW5hdGUgc3lzdGVtcy4KCSAqCgkgKiBAcHJpdmF0ZQoJICovCgljbGFzcyBXZWJYUkNvbnRyb2xsZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IFhSIGNvbnRyb2xsZXIuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQkvKioKCQkJICogQSBncm91cCByZXByZXNlbnRpbmcgdGhlIHRhcmdldCByYXkgc3BhY2UKCQkJICogb2YgdGhlIFhSIGNvbnRyb2xsZXIuCgkJCSAqCgkJCSAqIEBwcml2YXRlCgkJCSAqIEB0eXBlIHs/R3JvdXB9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuX3RhcmdldFJheSA9IG51bGw7CgoJCQkvKioKCQkJICogQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGdyaXAgc3BhY2UKCQkJICogb2YgdGhlIFhSIGNvbnRyb2xsZXIuCgkJCSAqCgkJCSAqIEBwcml2YXRlCgkJCSAqIEB0eXBlIHs/R3JvdXB9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuX2dyaXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlCgkJCSAqIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCQkgKgoJCQkgKiBAcHJpdmF0ZQoJCQkgKiBAdHlwZSB7P0dyb3VwfQoJCQkgKiBAZGVmYXVsdCBudWxsCgkJCSAqLwoJCQl0aGlzLl9oYW5kID0gbnVsbDsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCSAqCgkJICogQHJldHVybiB7R3JvdXB9IEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBoYW5kIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCSAqLwoJCWdldEhhbmRTcGFjZSgpIHsKCgkJCWlmICggdGhpcy5faGFuZCA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLl9oYW5kID0gbmV3IEdyb3VwKCk7CgkJCQl0aGlzLl9oYW5kLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCXRoaXMuX2hhbmQudmlzaWJsZSA9IGZhbHNlOwoKCQkJCXRoaXMuX2hhbmQuam9pbnRzID0ge307CgkJCQl0aGlzLl9oYW5kLmlucHV0U3RhdGUgPSB7IHBpbmNoaW5nOiBmYWxzZSB9OwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuX2hhbmQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHJheSBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKgoJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgdGFyZ2V0IHJheSBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKi8KCQlnZXRUYXJnZXRSYXlTcGFjZSgpIHsKCgkJCWlmICggdGhpcy5fdGFyZ2V0UmF5ID09PSBudWxsICkgewoKCQkJCXRoaXMuX3RhcmdldFJheSA9IG5ldyBHcm91cCgpOwoJCQkJdGhpcy5fdGFyZ2V0UmF5Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCXRoaXMuX3RhcmdldFJheS52aXNpYmxlID0gZmFsc2U7CgkJCQl0aGlzLl90YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJCXRoaXMuX3RhcmdldFJheS5saW5lYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgkJCQl0aGlzLl90YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgkJCQl0aGlzLl90YXJnZXRSYXkuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLl90YXJnZXRSYXk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgZ3JpcCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKgoJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgZ3JpcCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKi8KCQlnZXRHcmlwU3BhY2UoKSB7CgoJCQlpZiAoIHRoaXMuX2dyaXAgPT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZ3JpcCA9IG5ldyBHcm91cCgpOwoJCQkJdGhpcy5fZ3JpcC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgkJCQl0aGlzLl9ncmlwLnZpc2libGUgPSBmYWxzZTsKCQkJCXRoaXMuX2dyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJCXRoaXMuX2dyaXAubGluZWFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwoJCQkJdGhpcy5fZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJCXRoaXMuX2dyaXAuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzLl9ncmlwOwoKCQl9CgoJCS8qKgoJCSAqIERpc3BhdGNoZXMgdGhlIGdpdmVuIGV2ZW50IHRvIHRoZSBncm91cHMgcmVwcmVzZW50aW5nCgkJICogdGhlIGRpZmZlcmVudCBjb29yZGluYXRlIHNwYWNlcyBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAtIFRoZSBldmVudCB0byBkaXNwYXRjaC4KCQkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJZGlzcGF0Y2hFdmVudCggZXZlbnQgKSB7CgoJCQlpZiAoIHRoaXMuX3RhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLl90YXJnZXRSYXkuZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCgkJCX0KCgkJCWlmICggdGhpcy5fZ3JpcCAhPT0gbnVsbCApIHsKCgkJCQl0aGlzLl9ncmlwLmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7CgoJCQl9CgoJCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5faGFuZC5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29ubmVjdHMgdGhlIGNvbnRyb2xsZXIgd2l0aCB0aGUgZ2l2ZW4gWFIgaW5wdXQgc291cmNlLgoJCSAqCgkJICogQHBhcmFtIHtYUklucHV0U291cmNlfSBpbnB1dFNvdXJjZSAtIFRoZSBpbnB1dCBzb3VyY2UuCgkJICogQHJldHVybiB7V2ViWFJDb250cm9sbGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCWNvbm5lY3QoIGlucHV0U291cmNlICkgewoKCQkJaWYgKCBpbnB1dFNvdXJjZSAmJiBpbnB1dFNvdXJjZS5oYW5kICkgewoKCQkJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKCQkJCWlmICggaGFuZCApIHsKCgkJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKCQkJCQkJLy8gSW5pdGlhbGl6ZSBoYW5kIHdpdGggam9pbnRzIHdoZW4gY29ubmVjdGVkCgkJCQkJCXRoaXMuX2dldEhhbmRKb2ludCggaGFuZCwgaW5wdXRqb2ludCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdjb25uZWN0ZWQnLCBkYXRhOiBpbnB1dFNvdXJjZSB9ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBEaXNjb25uZWN0cyB0aGUgY29udHJvbGxlciBmcm9tIHRoZSBnaXZlbiBYUiBpbnB1dCBzb3VyY2UuCgkJICoKCQkgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gVGhlIGlucHV0IHNvdXJjZS4KCQkgKiBAcmV0dXJuIHtXZWJYUkNvbnRyb2xsZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJZGlzY29ubmVjdCggaW5wdXRTb3VyY2UgKSB7CgoJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc2Nvbm5lY3RlZCcsIGRhdGE6IGlucHV0U291cmNlIH0gKTsKCgkJCWlmICggdGhpcy5fdGFyZ2V0UmF5ICE9PSBudWxsICkgewoKCQkJCXRoaXMuX3RhcmdldFJheS52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCQlpZiAoIHRoaXMuX2dyaXAgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZ3JpcC52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5faGFuZC52aXNpYmxlID0gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSBjb250cm9sbGVyIHdpdGggdGhlIGdpdmVuIGlucHV0IHNvdXJjZSwgWFIgZnJhbWUgYW5kIHJlZmVyZW5jZSBzcGFjZS4KCQkgKiBUaGlzIHVwZGF0ZXMgdGhlIHRyYW5zZm9ybWF0aW9ucyBvZiB0aGUgZ3JvdXBzIHRoYXQgcmVwcmVzZW50IHRoZSBkaWZmZXJlbnQKCQkgKiBjb29yZGluYXRlIHN5c3RlbXMgb2YgdGhlIGNvbnRyb2xsZXIuCgkJICoKCQkgKiBAcGFyYW0ge1hSSW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gVGhlIGlucHV0IHNvdXJjZS4KCQkgKiBAcGFyYW0ge1hSRnJhbWV9IGZyYW1lIC0gVGhlIFhSIGZyYW1lLgoJCSAqIEBwYXJhbSB7WFJSZWZlcmVuY2VTcGFjZX0gcmVmZXJlbmNlU3BhY2UgLSBUaGUgcmVmZXJlbmNlIHNwYWNlLgoJCSAqIEByZXR1cm4ge1dlYlhSQ29udHJvbGxlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQl1cGRhdGUoIGlucHV0U291cmNlLCBmcmFtZSwgcmVmZXJlbmNlU3BhY2UgKSB7CgoJCQlsZXQgaW5wdXRQb3NlID0gbnVsbDsKCQkJbGV0IGdyaXBQb3NlID0gbnVsbDsKCQkJbGV0IGhhbmRQb3NlID0gbnVsbDsKCgkJCWNvbnN0IHRhcmdldFJheSA9IHRoaXMuX3RhcmdldFJheTsKCQkJY29uc3QgZ3JpcCA9IHRoaXMuX2dyaXA7CgkJCWNvbnN0IGhhbmQgPSB0aGlzLl9oYW5kOwoKCQkJaWYgKCBpbnB1dFNvdXJjZSAmJiBmcmFtZS5zZXNzaW9uLnZpc2liaWxpdHlTdGF0ZSAhPT0gJ3Zpc2libGUtYmx1cnJlZCcgKSB7CgoJCQkJaWYgKCBoYW5kICYmIGlucHV0U291cmNlLmhhbmQgKSB7CgoJCQkJCWhhbmRQb3NlID0gdHJ1ZTsKCgkJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKCQkJCQkJLy8gVXBkYXRlIHRoZSBqb2ludHMgZ3JvdXBzIHdpdGggdGhlIFhSSm9pbnQgcG9zZXMKCQkJCQkJY29uc3Qgam9pbnRQb3NlID0gZnJhbWUuZ2V0Sm9pbnRQb3NlKCBpbnB1dGpvaW50LCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCQkJLy8gVGhlIHRyYW5zZm9ybSBvZiB0aGlzIGpvaW50IHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRoZSBqb2ludCBwb3NlIG9uIGVhY2ggZnJhbWUKCQkJCQkJY29uc3Qgam9pbnQgPSB0aGlzLl9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKTsKCgkJCQkJCWlmICggam9pbnRQb3NlICE9PSBudWxsICkgewoKCQkJCQkJCWpvaW50Lm1hdHJpeC5mcm9tQXJyYXkoIGpvaW50UG9zZS50cmFuc2Zvcm0ubWF0cml4ICk7CgkJCQkJCQlqb2ludC5tYXRyaXguZGVjb21wb3NlKCBqb2ludC5wb3NpdGlvbiwgam9pbnQucm90YXRpb24sIGpvaW50LnNjYWxlICk7CgkJCQkJCQlqb2ludC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQkJCWpvaW50LmpvaW50UmFkaXVzID0gam9pbnRQb3NlLnJhZGl1czsKCgkJCQkJCX0KCgkJCQkJCWpvaW50LnZpc2libGUgPSBqb2ludFBvc2UgIT09IG51bGw7CgoJCQkJCX0KCgkJCQkJLy8gQ3VzdG9tIGV2ZW50cwoKCQkJCQkvLyBDaGVjayBwaW5jaHoKCQkJCQljb25zdCBpbmRleFRpcCA9IGhhbmQuam9pbnRzWyAnaW5kZXgtZmluZ2VyLXRpcCcgXTsKCQkJCQljb25zdCB0aHVtYlRpcCA9IGhhbmQuam9pbnRzWyAndGh1bWItdGlwJyBdOwoJCQkJCWNvbnN0IGRpc3RhbmNlID0gaW5kZXhUaXAucG9zaXRpb24uZGlzdGFuY2VUbyggdGh1bWJUaXAucG9zaXRpb24gKTsKCgkJCQkJY29uc3QgZGlzdGFuY2VUb1BpbmNoID0gMC4wMjsKCQkJCQljb25zdCB0aHJlc2hvbGQgPSAwLjAwNTsKCgkJCQkJaWYgKCBoYW5kLmlucHV0U3RhdGUucGluY2hpbmcgJiYgZGlzdGFuY2UgPiBkaXN0YW5jZVRvUGluY2ggKyB0aHJlc2hvbGQgKSB7CgoJCQkJCQloYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSBmYWxzZTsKCQkJCQkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7CgkJCQkJCQl0eXBlOiAncGluY2hlbmQnLAoJCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKCQkJCQkJCXRhcmdldDogdGhpcwoJCQkJCQl9ICk7CgoJCQkJCX0gZWxzZSBpZiAoICEgaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlIDw9IGRpc3RhbmNlVG9QaW5jaCAtIHRocmVzaG9sZCApIHsKCgkJCQkJCWhhbmQuaW5wdXRTdGF0ZS5waW5jaGluZyA9IHRydWU7CgkJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggewoJCQkJCQkJdHlwZTogJ3BpbmNoc3RhcnQnLAoJCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKCQkJCQkJCXRhcmdldDogdGhpcwoJCQkJCQl9ICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIGdyaXAgIT09IG51bGwgJiYgaW5wdXRTb3VyY2UuZ3JpcFNwYWNlICkgewoKCQkJCQkJZ3JpcFBvc2UgPSBmcmFtZS5nZXRQb3NlKCBpbnB1dFNvdXJjZS5ncmlwU3BhY2UsIHJlZmVyZW5jZVNwYWNlICk7CgoJCQkJCQlpZiAoIGdyaXBQb3NlICE9PSBudWxsICkgewoKCQkJCQkJCWdyaXAubWF0cml4LmZyb21BcnJheSggZ3JpcFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwoJCQkJCQkJZ3JpcC5tYXRyaXguZGVjb21wb3NlKCBncmlwLnBvc2l0aW9uLCBncmlwLnJvdGF0aW9uLCBncmlwLnNjYWxlICk7CgkJCQkJCQlncmlwLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCQkJCWlmICggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKSB7CgoJCQkJCQkJCWdyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwoJCQkJCQkJCWdyaXAubGluZWFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlncmlwLmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICkgewoKCQkJCQkJCQlncmlwLmhhc0FuZ3VsYXJWZWxvY2l0eSA9IHRydWU7CgkJCQkJCQkJZ3JpcC5hbmd1bGFyVmVsb2NpdHkuY29weSggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCB0YXJnZXRSYXkgIT09IG51bGwgKSB7CgoJCQkJCWlucHV0UG9zZSA9IGZyYW1lLmdldFBvc2UoIGlucHV0U291cmNlLnRhcmdldFJheVNwYWNlLCByZWZlcmVuY2VTcGFjZSApOwoKCQkJCQkvLyBTb21lIHJ1bnRpbWVzIChuYW1lbHkgVml2ZSBDb3Ntb3Mgd2l0aCBWaXZlIE9wZW5YUiBSdW50aW1lKSBoYXZlIG9ubHkgZ3JpcCBzcGFjZSBhbmQgcmF5IHNwYWNlIGlzIGVxdWFsIHRvIGl0CgkJCQkJaWYgKCBpbnB1dFBvc2UgPT09IG51bGwgJiYgZ3JpcFBvc2UgIT09IG51bGwgKSB7CgoJCQkJCQlpbnB1dFBvc2UgPSBncmlwUG9zZTsKCgkJCQkJfQoKCQkJCQlpZiAoIGlucHV0UG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJCXRhcmdldFJheS5tYXRyaXguZnJvbUFycmF5KCBpbnB1dFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwoJCQkJCQl0YXJnZXRSYXkubWF0cml4LmRlY29tcG9zZSggdGFyZ2V0UmF5LnBvc2l0aW9uLCB0YXJnZXRSYXkucm90YXRpb24sIHRhcmdldFJheS5zY2FsZSApOwoJCQkJCQl0YXJnZXRSYXkubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCQlpZiAoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSB0cnVlOwoJCQkJCQkJdGFyZ2V0UmF5LmxpbmVhclZlbG9jaXR5LmNvcHkoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCgkJCQkJCX0KCgkJCQkJCWlmICggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gdHJ1ZTsKCQkJCQkJCXRhcmdldFJheS5hbmd1bGFyVmVsb2NpdHkuY29weSggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl0YXJnZXRSYXkuaGFzQW5ndWxhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCQl9CgoJCQkJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIF9tb3ZlRXZlbnQgKTsKCgkJCQkJfQoKCQkJCX0KCgoJCQl9CgoJCQlpZiAoIHRhcmdldFJheSAhPT0gbnVsbCApIHsKCgkJCQl0YXJnZXRSYXkudmlzaWJsZSA9ICggaW5wdXRQb3NlICE9PSBudWxsICk7CgoJCQl9CgoJCQlpZiAoIGdyaXAgIT09IG51bGwgKSB7CgoJCQkJZ3JpcC52aXNpYmxlID0gKCBncmlwUG9zZSAhPT0gbnVsbCApOwoKCQkJfQoKCQkJaWYgKCBoYW5kICE9PSBudWxsICkgewoKCQkJCWhhbmQudmlzaWJsZSA9ICggaGFuZFBvc2UgIT09IG51bGwgKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgam9pbnQgZm9yIHRoZSBnaXZlbiBpbnB1dCBqb2ludC4KCQkgKgoJCSAqIEBwcml2YXRlCgkJICogQHBhcmFtIHtHcm91cH0gaGFuZCAtIFRoZSBncm91cCByZXByZXNlbnRpbmcgdGhlIGhhbmQgc3BhY2UuCgkJICogQHBhcmFtIHtYUkpvaW50U3BhY2V9IGlucHV0am9pbnQgLSBUaGUgaGFuZCBqb2ludCBkYXRhLgoJCSAqIEByZXR1cm4ge0dyb3VwfSBBIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgaGFuZCBqb2ludCBmb3IgdGhlIGdpdmVuIGlucHV0IGpvaW50LgoJCSAqLwoJCV9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKSB7CgoJCQlpZiAoIGhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3Qgam9pbnQgPSBuZXcgR3JvdXAoKTsKCQkJCWpvaW50Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJCWpvaW50LnZpc2libGUgPSBmYWxzZTsKCQkJCWhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID0gam9pbnQ7CgoJCQkJaGFuZC5hZGQoIGpvaW50ICk7CgoJCQl9CgoJCQlyZXR1cm4gaGFuZC5qb2ludHNbIGlucHV0am9pbnQuam9pbnROYW1lIF07CgoJCX0KCgl9CgoJLyoqCgkgKiBTY2VuZXMgYWxsb3cgeW91IHRvIHNldCB1cCB3aGF0IGlzIHRvIGJlIHJlbmRlcmVkIGFuZCB3aGVyZSBieSB0aHJlZS5qcy4KCSAqIFRoaXMgaXMgd2hlcmUgeW91IHBsYWNlIDNEIG9iamVjdHMgbGlrZSBtZXNoZXMsIGxpbmVzIG9yIGxpZ2h0cy4KCSAqCgkgKiBAYXVnbWVudHMgT2JqZWN0M0QKCSAqLwoJY2xhc3MgU2NlbmUgZXh0ZW5kcyBPYmplY3QzRCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgc2NlbmUuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNTY2VuZSA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnU2NlbmUnOwoKCQkJLyoqCgkJCSAqIERlZmluZXMgdGhlIGJhY2tncm91bmQgb2YgdGhlIHNjZW5lLiBWYWxpZCBpbnB1dHMgYXJlOgoJCQkgKgoJCQkgKiAtIEEgY29sb3IgZm9yIGRlZmluaW5nIGEgdW5pZm9ybSBjb2xvcmVkIGJhY2tncm91bmQuCgkJCSAqIC0gQSB0ZXh0dXJlIGZvciBkZWZpbmluZyBhIChmbGF0KSB0ZXh0dXJlZCBiYWNrZ3JvdW5kLgoJCQkgKiAtIEN1YmUgdGV4dHVyZXMgb3IgZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmVzIGZvciBkZWZpbmluZyBhIHNreWJveC4KCQkJICoKCQkJICogQHR5cGUgez8oQ29sb3J8VGV4dHVyZSl9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYmFja2dyb3VuZCA9IG51bGw7CgoJCQkvKioKCQkJICogU2V0cyB0aGUgZW52aXJvbm1lbnQgbWFwIGZvciBhbGwgcGh5c2ljYWwgbWF0ZXJpYWxzIGluIHRoZSBzY2VuZS4gSG93ZXZlciwKCQkJICogaXQncyBub3QgcG9zc2libGUgdG8gb3ZlcndyaXRlIGFuIGV4aXN0aW5nIHRleHR1cmUgYXNzaWduZWQgdG8gdGhlIGBlbnZNYXBgCgkJCSAqIG1hdGVyaWFsIHByb3BlcnR5LgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuZW52aXJvbm1lbnQgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEEgZm9nIGluc3RhbmNlIGRlZmluaW5nIHRoZSB0eXBlIG9mIGZvZyB0aGF0IGFmZmVjdHMgZXZlcnl0aGluZwoJCQkgKiByZW5kZXJlZCBpbiB0aGUgc2NlbmUuCgkJCSAqCgkJCSAqIEB0eXBlIHs/KEZvZ3xGb2dFeHAyKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5mb2cgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIGJsdXJyaW5lc3Mgb2YgdGhlIGJhY2tncm91bmQuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCgkJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNiYWNrZ3JvdW5kfS4gVmFsaWQgaW5wdXQgaXMgYSBmbG9hdCBiZXR3ZWVuIGAwYAoJCQkgKiBhbmQgYDFgLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmJhY2tncm91bmRCbHVycmluZXNzID0gMDsKCgkJCS8qKgoJCQkgKiBBdHRlbnVhdGVzIHRoZSBjb2xvciBvZiB0aGUgYmFja2dyb3VuZC4gT25seSBhcHBsaWVzIHRvIGJhY2tncm91bmQgdGV4dHVyZXMuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMuYmFja2dyb3VuZEludGVuc2l0eSA9IDE7CgoJCQkvKioKCQkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBiYWNrZ3JvdW5kIGluIHJhZGlhbnMuIE9ubHkgaW5mbHVlbmNlcyBlbnZpcm9ubWVudCBtYXBzCgkJCSAqIGFzc2lnbmVkIHRvIHtAbGluayBTY2VuZSNiYWNrZ3JvdW5kfS4KCQkJICoKCQkJICogQHR5cGUge0V1bGVyfQoJCQkgKiBAZGVmYXVsdCAoMCwwLDApCgkJCSAqLwoJCQl0aGlzLmJhY2tncm91bmRSb3RhdGlvbiA9IG5ldyBFdWxlcigpOwoKCQkJLyoqCgkJCSAqIEF0dGVudWF0ZXMgdGhlIGNvbG9yIG9mIHRoZSBlbnZpcm9ubWVudC4gT25seSBpbmZsdWVuY2VzIGVudmlyb25tZW50IG1hcHMKCQkJICogYXNzaWduZWQgdG8ge0BsaW5rIFNjZW5lI2Vudmlyb25tZW50fS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5lbnZpcm9ubWVudEludGVuc2l0eSA9IDE7CgoJCQkvKioKCQkJICogVGhlIHJvdGF0aW9uIG9mIHRoZSBlbnZpcm9ubWVudCBtYXAgaW4gcmFkaWFucy4gT25seSBpbmZsdWVuY2VzIHBoeXNpY2FsIG1hdGVyaWFscwoJCQkgKiBpbiB0aGUgc2NlbmUgd2hlbiB7QGxpbmsgU2NlbmUjZW52aXJvbm1lbnR9IGlzIHVzZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtFdWxlcn0KCQkJICogQGRlZmF1bHQgKDAsMCwwKQoJCQkgKi8KCQkJdGhpcy5lbnZpcm9ubWVudFJvdGF0aW9uID0gbmV3IEV1bGVyKCk7CgoJCQkvKioKCQkJICogRm9yY2VzIGV2ZXJ5dGhpbmcgaW4gdGhlIHNjZW5lIHRvIGJlIHJlbmRlcmVkIHdpdGggdGhlIGRlZmluZWQgbWF0ZXJpYWwuIEl0IGlzIHBvc3NpYmxlCgkJCSAqIHRvIGV4Y2x1ZGUgbWF0ZXJpYWxzIGZyb20gb3ZlcnJpZGUgYnkgc2V0dGluZyB7QGxpbmsgTWF0ZXJpYWwjYWxsb3dPdmVycmlkZX0gdG8gYGZhbHNlYC4KCQkJICoKCQkJICogQHR5cGUgez9NYXRlcmlhbH0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5vdmVycmlkZU1hdGVyaWFsID0gbnVsbDsKCgkJCWlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJCX0KCgkJfQoKCQljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCQlpZiAoIHNvdXJjZS5iYWNrZ3JvdW5kICE9PSBudWxsICkgdGhpcy5iYWNrZ3JvdW5kID0gc291cmNlLmJhY2tncm91bmQuY2xvbmUoKTsKCQkJaWYgKCBzb3VyY2UuZW52aXJvbm1lbnQgIT09IG51bGwgKSB0aGlzLmVudmlyb25tZW50ID0gc291cmNlLmVudmlyb25tZW50LmNsb25lKCk7CgkJCWlmICggc291cmNlLmZvZyAhPT0gbnVsbCApIHRoaXMuZm9nID0gc291cmNlLmZvZy5jbG9uZSgpOwoKCQkJdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHNvdXJjZS5iYWNrZ3JvdW5kQmx1cnJpbmVzczsKCQkJdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gc291cmNlLmJhY2tncm91bmRJbnRlbnNpdHk7CgkJCXRoaXMuYmFja2dyb3VuZFJvdGF0aW9uLmNvcHkoIHNvdXJjZS5iYWNrZ3JvdW5kUm90YXRpb24gKTsKCgkJCXRoaXMuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSBzb3VyY2UuZW52aXJvbm1lbnRJbnRlbnNpdHk7CgkJCXRoaXMuZW52aXJvbm1lbnRSb3RhdGlvbi5jb3B5KCBzb3VyY2UuZW52aXJvbm1lbnRSb3RhdGlvbiApOwoKCQkJaWYgKCBzb3VyY2Uub3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMub3ZlcnJpZGVNYXRlcmlhbCA9IHNvdXJjZS5vdmVycmlkZU1hdGVyaWFsLmNsb25lKCk7CgoJCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBzb3VyY2UubWF0cml4QXV0b1VwZGF0ZTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCXRvSlNPTiggbWV0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJCWlmICggdGhpcy5mb2cgIT09IG51bGwgKSBkYXRhLm9iamVjdC5mb2cgPSB0aGlzLmZvZy50b0pTT04oKTsKCgkJCWlmICggdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDAgKSBkYXRhLm9iamVjdC5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3M7CgkJCWlmICggdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ICE9PSAxICkgZGF0YS5vYmplY3QuYmFja2dyb3VuZEludGVuc2l0eSA9IHRoaXMuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJZGF0YS5vYmplY3QuYmFja2dyb3VuZFJvdGF0aW9uID0gdGhpcy5iYWNrZ3JvdW5kUm90YXRpb24udG9BcnJheSgpOwoKCQkJaWYgKCB0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5ICE9PSAxICkgZGF0YS5vYmplY3QuZW52aXJvbm1lbnRJbnRlbnNpdHkgPSB0aGlzLmVudmlyb25tZW50SW50ZW5zaXR5OwoJCQlkYXRhLm9iamVjdC5lbnZpcm9ubWVudFJvdGF0aW9uID0gdGhpcy5lbnZpcm9ubWVudFJvdGF0aW9uLnRvQXJyYXkoKTsKCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJfQoKCWNvbnN0IF92ZWN0b3IxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoJY29uc3QgX3ZlY3RvcjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgljb25zdCBfbm9ybWFsTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpOwoKCS8qKgoJICogQSB0d28gZGltZW5zaW9uYWwgc3VyZmFjZSB0aGF0IGV4dGVuZHMgaW5maW5pdGVseSBpbiAzRCBzcGFjZSwgcmVwcmVzZW50ZWQKCSAqIGluIFtIZXNzaWFuIG5vcm1hbCBmb3JtXXtAbGluayBodHRwOi8vbWF0aHdvcmxkLndvbGZyYW0uY29tL0hlc3NpYW5Ob3JtYWxGb3JtLmh0bWx9CgkgKiBieSBhIHVuaXQgbGVuZ3RoIG5vcm1hbCB2ZWN0b3IgYW5kIGEgY29uc3RhbnQuCgkgKi8KCWNsYXNzIFBsYW5lIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gW25vcm1hbD0oMSwwLDApXSAtIEEgdW5pdCBsZW5ndGggdmVjdG9yIGRlZmluaW5nIHRoZSBub3JtYWwgb2YgdGhlIHBsYW5lLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbY29uc3RhbnQ9MF0gLSBUaGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIG9yaWdpbiB0byB0aGUgcGxhbmUuCgkJICovCgkJY29uc3RydWN0b3IoIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCAxLCAwLCAwICksIGNvbnN0YW50ID0gMCApIHsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzUGxhbmUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIEEgdW5pdCBsZW5ndGggdmVjdG9yIGRlZmluaW5nIHRoZSBub3JtYWwgb2YgdGhlIHBsYW5lLgoJCQkgKgoJCQkgKiBAdHlwZSB7VmVjdG9yM30KCQkJICovCgkJCXRoaXMubm9ybWFsID0gbm9ybWFsOwoKCQkJLyoqCgkJCSAqIFRoZSBzaWduZWQgZGlzdGFuY2UgZnJvbSB0aGUgb3JpZ2luIHRvIHRoZSBwbGFuZS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHBsYW5lIGNvbXBvbmVudHMgYnkgY29weWluZyB0aGUgZ2l2ZW4gdmFsdWVzLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBub3JtYWwgLSBUaGUgbm9ybWFsLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBjb25zdGFudCAtIFRoZSBjb25zdGFudC4KCQkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KCQkgKi8KCQlzZXQoIG5vcm1hbCwgY29uc3RhbnQgKSB7CgoJCQl0aGlzLm5vcm1hbC5jb3B5KCBub3JtYWwgKTsKCQkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgcGxhbmUgY29tcG9uZW50cyBieSBkZWZpbmluZyBgeGAsIGB5YCwgYHpgIGFzIHRoZQoJCSAqIHBsYW5lIG5vcm1hbCBhbmQgYHdgIGFzIHRoZSBjb25zdGFudC4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIHZhbHVlIGZvciB0aGUgbm9ybWFsJ3MgeCBjb21wb25lbnQuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmFsdWUgZm9yIHRoZSBub3JtYWwncyB5IGNvbXBvbmVudC4KCQkgKiBAcGFyYW0ge251bWJlcn0geiAtIFRoZSB2YWx1ZSBmb3IgdGhlIG5vcm1hbCdzIHogY29tcG9uZW50LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gVGhlIGNvbnN0YW50IHZhbHVlLgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXNldENvbXBvbmVudHMoIHgsIHksIHosIHcgKSB7CgoJCQl0aGlzLm5vcm1hbC5zZXQoIHgsIHksIHogKTsKCQkJdGhpcy5jb25zdGFudCA9IHc7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBwbGFuZSBmcm9tIHRoZSBnaXZlbiBub3JtYWwgYW5kIGNvcGxhbmFyIHBvaW50ICh0aGF0IGlzIGEgcG9pbnQKCQkgKiB0aGF0IGxpZXMgb250byB0aGUgcGxhbmUpLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBub3JtYWwgLSBUaGUgbm9ybWFsLgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBBIGNvcGxhbmFyIHBvaW50LgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KCBub3JtYWwsIHBvaW50ICkgewoKCQkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJCXRoaXMuY29uc3RhbnQgPSAtIHBvaW50LmRvdCggdGhpcy5ub3JtYWwgKTsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIHBsYW5lIGZyb20gdGhyZWUgY29wbGFuYXIgcG9pbnRzLiBUaGUgd2luZGluZyBvcmRlciBpcwoJCSAqIGFzc3VtZWQgdG8gYmUgY291bnRlci1jbG9ja3dpc2UsIGFuZCBkZXRlcm1pbmVzIHRoZSBkaXJlY3Rpb24gb2YKCQkgKiB0aGUgcGxhbmUgbm9ybWFsLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBhIC0gVGhlIGZpcnN0IGNvcGxhbmFyIHBvaW50LgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gYiAtIFRoZSBzZWNvbmQgY29wbGFuYXIgcG9pbnQuCgkJICogQHBhcmFtIHtWZWN0b3IzfSBjIC0gVGhlIHRoaXJkIGNvcGxhbmFyIHBvaW50LgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXNldEZyb21Db3BsYW5hclBvaW50cyggYSwgYiwgYyApIHsKCgkJCWNvbnN0IG5vcm1hbCA9IF92ZWN0b3IxLnN1YlZlY3RvcnMoIGMsIGIgKS5jcm9zcyggX3ZlY3RvcjIuc3ViVmVjdG9ycyggYSwgYiApICkubm9ybWFsaXplKCk7CgoJCQkvLyBROiBzaG91bGQgYW4gZXJyb3IgYmUgdGhyb3duIGlmIG5vcm1hbCBpcyB6ZXJvIChlLmcuIGRlZ2VuZXJhdGUgcGxhbmUpPwoKCQkJdGhpcy5zZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBhICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBDb3BpZXMgdGhlIHZhbHVlcyBvZiB0aGUgZ2l2ZW4gcGxhbmUgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IHBsYW5lIC0gVGhlIHBsYW5lIHRvIGNvcHkuCgkJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCgkJICovCgkJY29weSggcGxhbmUgKSB7CgoJCQl0aGlzLm5vcm1hbC5jb3B5KCBwbGFuZS5ub3JtYWwgKTsKCQkJdGhpcy5jb25zdGFudCA9IHBsYW5lLmNvbnN0YW50OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogTm9ybWFsaXplcyB0aGUgcGxhbmUgbm9ybWFsIGFuZCBhZGp1c3RzIHRoZSBjb25zdGFudCBhY2NvcmRpbmdseS4KCQkgKgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCW5vcm1hbGl6ZSgpIHsKCgkJCS8vIE5vdGU6IHdpbGwgbGVhZCB0byBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBwbGFuZSBpcyBpbnZhbGlkLgoKCQkJY29uc3QgaW52ZXJzZU5vcm1hbExlbmd0aCA9IDEuMCAvIHRoaXMubm9ybWFsLmxlbmd0aCgpOwoJCQl0aGlzLm5vcm1hbC5tdWx0aXBseVNjYWxhciggaW52ZXJzZU5vcm1hbExlbmd0aCApOwoJCQl0aGlzLmNvbnN0YW50ICo9IGludmVyc2VOb3JtYWxMZW5ndGg7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBOZWdhdGVzIGJvdGggdGhlIHBsYW5lIG5vcm1hbCBhbmQgdGhlIGNvbnN0YW50LgoJCSAqCgkJICogQHJldHVybiB7UGxhbmV9IEEgcmVmZXJlbmNlIHRvIHRoaXMgcGxhbmUuCgkJICovCgkJbmVnYXRlKCkgewoKCQkJdGhpcy5jb25zdGFudCAqPSAtMTsKCQkJdGhpcy5ub3JtYWwubmVnYXRlKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIHRoZSBzaWduZWQgZGlzdGFuY2UgZnJvbSB0aGUgZ2l2ZW4gcG9pbnQgdG8gdGhpcyBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gcG9pbnQgLSBUaGUgcG9pbnQgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgZm9yLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNpZ25lZCBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgewoKCQkJcmV0dXJuIHRoaXMubm9ybWFsLmRvdCggcG9pbnQgKSArIHRoaXMuY29uc3RhbnQ7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyB0aGUgc2lnbmVkIGRpc3RhbmNlIGZyb20gdGhlIGdpdmVuIHNwaGVyZSB0byB0aGlzIHBsYW5lLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBzcGhlcmUgdG8gY29tcHV0ZSB0aGUgZGlzdGFuY2UgZm9yLgoJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIHNpZ25lZCBkaXN0YW5jZS4KCQkgKi8KCQlkaXN0YW5jZVRvU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQlyZXR1cm4gdGhpcy5kaXN0YW5jZVRvUG9pbnQoIHNwaGVyZS5jZW50ZXIgKSAtIHNwaGVyZS5yYWRpdXM7CgoJCX0KCgkJLyoqCgkJICogUHJvamVjdHMgYSB0aGUgZ2l2ZW4gcG9pbnQgb250byB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IHBvaW50IC0gVGhlIHBvaW50IHRvIHByb2plY3QuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHtWZWN0b3IzfSBUaGUgcHJvamVjdGVkIHBvaW50IG9uIHRoZSBwbGFuZS4KCQkgKi8KCQlwcm9qZWN0UG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHBvaW50ICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLm5vcm1hbCwgLSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgdGhlIGludGVyc2VjdGlvbiBwb2ludCBvZiB0aGUgcGFzc2VkIGxpbmUgYW5kIHRoZSBwbGFuZS4gUmV0dXJucwoJCSAqIGBudWxsYCBpZiB0aGUgbGluZSBkb2VzIG5vdCBpbnRlcnNlY3QuIFJldHVybnMgdGhlIGxpbmUncyBzdGFydGluZyBwb2ludCBpZgoJCSAqIHRoZSBsaW5lIGlzIGNvcGxhbmFyIHdpdGggdGhlIHBsYW5lLgoJCSAqCgkJICogQHBhcmFtIHtMaW5lM30gbGluZSAtIFRoZSBsaW5lIHRvIGNvbXB1dGUgdGhlIGludGVyc2VjdGlvbiBmb3IuCgkJICogQHBhcmFtIHtWZWN0b3IzfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IHZlY3RvciB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgdGhlIG1ldGhvZCdzIHJlc3VsdC4KCQkgKiBAcmV0dXJuIHs/VmVjdG9yM30gVGhlIGludGVyc2VjdGlvbiBwb2ludC4KCQkgKi8KCQlpbnRlcnNlY3RMaW5lKCBsaW5lLCB0YXJnZXQgKSB7CgoJCQljb25zdCBkaXJlY3Rpb24gPSBsaW5lLmRlbHRhKCBfdmVjdG9yMSApOwoKCQkJY29uc3QgZGVub21pbmF0b3IgPSB0aGlzLm5vcm1hbC5kb3QoIGRpcmVjdGlvbiApOwoKCQkJaWYgKCBkZW5vbWluYXRvciA9PT0gMCApIHsKCgkJCQkvLyBsaW5lIGlzIGNvcGxhbmFyLCByZXR1cm4gb3JpZ2luCgkJCQlpZiAoIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICkgPT09IDAgKSB7CgoJCQkJCXJldHVybiB0YXJnZXQuY29weSggbGluZS5zdGFydCApOwoKCQkJCX0KCgkJCQkvLyBVbnN1cmUgaWYgdGhpcyBpcyB0aGUgY29ycmVjdCBtZXRob2QgdG8gaGFuZGxlIHRoaXMgY2FzZS4KCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQkJY29uc3QgdCA9IC0gKCBsaW5lLnN0YXJ0LmRvdCggdGhpcy5ub3JtYWwgKSArIHRoaXMuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQkJaWYgKCB0IDwgMCB8fCB0ID4gMSApIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJCXJldHVybiB0YXJnZXQuY29weSggbGluZS5zdGFydCApLmFkZFNjYWxlZFZlY3RvciggZGlyZWN0aW9uLCB0ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGxpbmUgc2VnbWVudCBpbnRlcnNlY3RzIHdpdGggKHBhc3NlcyB0aHJvdWdoKSB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge0xpbmUzfSBsaW5lIC0gVGhlIGxpbmUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBsaW5lIHNlZ21lbnQgaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0xpbmUoIGxpbmUgKSB7CgoJCQkvLyBOb3RlOiB0aGlzIHRlc3RzIGlmIGEgbGluZSBpbnRlcnNlY3RzIHRoZSBwbGFuZSwgbm90IHdoZXRoZXIgaXQgKG9yIGl0cyBlbmQtcG9pbnRzKSBhcmUgY29wbGFuYXIgd2l0aCBpdC4KCgkJCWNvbnN0IHN0YXJ0U2lnbiA9IHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICk7CgkJCWNvbnN0IGVuZFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5lbmQgKTsKCgkJCXJldHVybiAoIHN0YXJ0U2lnbiA8IDAgJiYgZW5kU2lnbiA+IDAgKSB8fCAoIGVuZFNpZ24gPCAwICYmIHN0YXJ0U2lnbiA+IDAgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBnaXZlbiBib3VuZGluZyBib3ggaW50ZXJzZWN0cyB3aXRoIHRoZSBwbGFuZSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJcmV0dXJuIGJveC5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgc3BoZXJlIGludGVyc2VjdHMgd2l0aCB0aGUgcGxhbmUuCgkJICoKCQkgKiBAcGFyYW0ge1NwaGVyZX0gc3BoZXJlIC0gVGhlIGJvdW5kaW5nIHNwaGVyZSB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpbnRlcnNlY3RzIHdpdGggdGhlIHBsYW5lIG9yIG5vdC4KCQkgKi8KCQlpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCQlyZXR1cm4gc3BoZXJlLmludGVyc2VjdHNQbGFuZSggdGhpcyApOwoKCQl9CgoJCS8qKgoJCSAqIFJldHVybnMgYSBjb3BsYW5hciB2ZWN0b3IgdG8gdGhlIHBsYW5lLCBieSBjYWxjdWxhdGluZyB0aGUKCQkgKiBwcm9qZWN0aW9uIG9mIHRoZSBub3JtYWwgYXQgdGhlIG9yaWdpbiBvbnRvIHRoZSBwbGFuZS4KCQkgKgoJCSAqIEBwYXJhbSB7VmVjdG9yM30gdGFyZ2V0IC0gVGhlIHRhcmdldCB2ZWN0b3IgdGhhdCBpcyB1c2VkIHRvIHN0b3JlIHRoZSBtZXRob2QncyByZXN1bHQuCgkJICogQHJldHVybiB7VmVjdG9yM30gVGhlIGNvcGxhbmFyIHBvaW50LgoJCSAqLwoJCWNvcGxhbmFyUG9pbnQoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5ub3JtYWwgKS5tdWx0aXBseVNjYWxhciggLSB0aGlzLmNvbnN0YW50ICk7CgoJCX0KCgkJLyoqCgkJICogQXBwbHkgYSA0eDQgbWF0cml4IHRvIHRoZSBwbGFuZS4gVGhlIG1hdHJpeCBtdXN0IGJlIGFuIGFmZmluZSwgaG9tb2dlbmVvdXMgdHJhbnNmb3JtLgoJCSAqCgkJICogVGhlIG9wdGlvbmFsIG5vcm1hbCBtYXRyaXggY2FuIGJlIHByZS1jb21wdXRlZCBsaWtlIHNvOgoJCSAqIGBgYGpzCgkJICogY29uc3Qgb3B0aW9uYWxOb3JtYWxNYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4MygpLmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgkJICogYGBgCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG1hdHJpeCAtIFRoZSB0cmFuc2Zvcm1hdGlvbiBtYXRyaXguCgkJICogQHBhcmFtIHtNYXRyaXg0fSBbb3B0aW9uYWxOb3JtYWxNYXRyaXhdIC0gQSBwcmUtY29tcHV0ZWQgbm9ybWFsIG1hdHJpeC4KCQkgKiBAcmV0dXJuIHtQbGFuZX0gQSByZWZlcmVuY2UgdG8gdGhpcyBwbGFuZS4KCQkgKi8KCQlhcHBseU1hdHJpeDQoIG1hdHJpeCwgb3B0aW9uYWxOb3JtYWxNYXRyaXggKSB7CgoJCQljb25zdCBub3JtYWxNYXRyaXggPSBvcHRpb25hbE5vcm1hbE1hdHJpeCB8fCBfbm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggbWF0cml4ICk7CgoJCQljb25zdCByZWZlcmVuY2VQb2ludCA9IHRoaXMuY29wbGFuYXJQb2ludCggX3ZlY3RvcjEgKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoKCQkJY29uc3Qgbm9ybWFsID0gdGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTsKCgkJCXRoaXMuY29uc3RhbnQgPSAtIHJlZmVyZW5jZVBvaW50LmRvdCggbm9ybWFsICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBUcmFuc2xhdGVzIHRoZSBwbGFuZSBieSB0aGUgZGlzdGFuY2UgZGVmaW5lZCBieSB0aGUgZ2l2ZW4gb2Zmc2V0IHZlY3Rvci4KCQkgKiBOb3RlIHRoYXQgdGhpcyBvbmx5IGFmZmVjdHMgdGhlIHBsYW5lIGNvbnN0YW50IGFuZCB3aWxsIG5vdCBhZmZlY3QgdGhlIG5vcm1hbCB2ZWN0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IG9mZnNldCAtIFRoZSBvZmZzZXQgdmVjdG9yLgoJCSAqIEByZXR1cm4ge1BsYW5lfSBBIHJlZmVyZW5jZSB0byB0aGlzIHBsYW5lLgoJCSAqLwoJCXRyYW5zbGF0ZSggb2Zmc2V0ICkgewoKCQkJdGhpcy5jb25zdGFudCAtPSBvZmZzZXQuZG90KCB0aGlzLm5vcm1hbCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhpcyBwbGFuZSBpcyBlcXVhbCB3aXRoIHRoZSBnaXZlbiBvbmUuCgkJICoKCQkgKiBAcGFyYW0ge1BsYW5lfSBwbGFuZSAtIFRoZSBwbGFuZSB0byB0ZXN0IGZvciBlcXVhbGl0eS4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoaXMgcGxhbmUgaXMgZXF1YWwgd2l0aCB0aGUgZ2l2ZW4gb25lLgoJCSAqLwoJCWVxdWFscyggcGxhbmUgKSB7CgoJCQlyZXR1cm4gcGxhbmUubm9ybWFsLmVxdWFscyggdGhpcy5ub3JtYWwgKSAmJiAoIHBsYW5lLmNvbnN0YW50ID09PSB0aGlzLmNvbnN0YW50ICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBwbGFuZSB3aXRoIGNvcGllZCB2YWx1ZXMgZnJvbSB0aGlzIGluc3RhbmNlLgoJCSAqCgkJICogQHJldHVybiB7UGxhbmV9IEEgY2xvbmUgb2YgdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQljbG9uZSgpIHsKCgkJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgkJfQoKCX0KCgljb25zdCBfc3BoZXJlJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKCWNvbnN0IF9kZWZhdWx0U3ByaXRlQ2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMC41LCAwLjUgKTsKCWNvbnN0IF92ZWN0b3IkNiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCgkvKioKCSAqIEZydXN0dW1zIGFyZSB1c2VkIHRvIGRldGVybWluZSB3aGF0IGlzIGluc2lkZSB0aGUgY2FtZXJhJ3MgZmllbGQgb2Ygdmlldy4KCSAqIFRoZXkgaGVscCBzcGVlZCB1cCB0aGUgcmVuZGVyaW5nIHByb2Nlc3MgLSBvYmplY3RzIHdoaWNoIGxpZSBvdXRzaWRlIGEgY2FtZXJhJ3MKCSAqIGZydXN0dW0gY2FuIHNhZmVseSBiZSBleGNsdWRlZCBmcm9tIHJlbmRlcmluZy4KCSAqCgkgKiBUaGlzIGNsYXNzIGlzIG1haW5seSBpbnRlbmRlZCBmb3IgdXNlIGludGVybmFsbHkgYnkgYSByZW5kZXJlci4KCSAqLwoJY2xhc3MgRnJ1c3R1bSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZnJ1c3R1bS4KCQkgKgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwMF0gLSBUaGUgZmlyc3QgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcGFyYW0ge1BsYW5lfSBbcDFdIC0gVGhlIHNlY29uZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwMl0gLSBUaGUgdGhpcmQgcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcGFyYW0ge1BsYW5lfSBbcDNdIC0gVGhlIGZvdXJ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwNF0gLSBUaGUgZmlmdGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcGFyYW0ge1BsYW5lfSBbcDVdIC0gVGhlIHNpeHRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCgkJICovCgkJY29uc3RydWN0b3IoIHAwID0gbmV3IFBsYW5lKCksIHAxID0gbmV3IFBsYW5lKCksIHAyID0gbmV3IFBsYW5lKCksIHAzID0gbmV3IFBsYW5lKCksIHA0ID0gbmV3IFBsYW5lKCksIHA1ID0gbmV3IFBsYW5lKCkgKSB7CgoJCQkvKioKCQkJICogVGhpcyBhcnJheSBob2xkcyB0aGUgcGxhbmVzIHRoYXQgZW5jbG9zZSB0aGUgZnJ1c3R1bS4KCQkJICoKCQkJICogQHR5cGUge0FycmF5PFBsYW5lPn0KCQkJICovCgkJCXRoaXMucGxhbmVzID0gWyBwMCwgcDEsIHAyLCBwMywgcDQsIHA1IF07CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgZnJ1c3R1bSBwbGFuZXMgYnkgY29weWluZyB0aGUgZ2l2ZW4gcGxhbmVzLgoJCSAqCgkJICogQHBhcmFtIHtQbGFuZX0gW3AwXSAtIFRoZSBmaXJzdCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwMV0gLSBUaGUgc2Vjb25kIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCgkJICogQHBhcmFtIHtQbGFuZX0gW3AyXSAtIFRoZSB0aGlyZCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwM10gLSBUaGUgZm91cnRoIHBsYW5lIHRoYXQgZW5jbG9zZXMgdGhlIGZydXN0dW0uCgkJICogQHBhcmFtIHtQbGFuZX0gW3A0XSAtIFRoZSBmaWZ0aCBwbGFuZSB0aGF0IGVuY2xvc2VzIHRoZSBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7UGxhbmV9IFtwNV0gLSBUaGUgc2l4dGggcGxhbmUgdGhhdCBlbmNsb3NlcyB0aGUgZnJ1c3R1bS4KCQkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIHJlZmVyZW5jZSB0byB0aGlzIGZydXN0dW0uCgkJICovCgkJc2V0KCBwMCwgcDEsIHAyLCBwMywgcDQsIHA1ICkgewoKCQkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgoJCQlwbGFuZXNbIDAgXS5jb3B5KCBwMCApOwoJCQlwbGFuZXNbIDEgXS5jb3B5KCBwMSApOwoJCQlwbGFuZXNbIDIgXS5jb3B5KCBwMiApOwoJCQlwbGFuZXNbIDMgXS5jb3B5KCBwMyApOwoJCQlwbGFuZXNbIDQgXS5jb3B5KCBwNCApOwoJCQlwbGFuZXNbIDUgXS5jb3B5KCBwNSApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogQ29waWVzIHRoZSB2YWx1ZXMgb2YgdGhlIGdpdmVuIGZydXN0dW0gdG8gdGhpcyBpbnN0YW5jZS4KCQkgKgoJCSAqIEBwYXJhbSB7RnJ1c3R1bX0gZnJ1c3R1bSAtIFRoZSBmcnVzdHVtIHRvIGNvcHkuCgkJICogQHJldHVybiB7RnJ1c3R1bX0gQSByZWZlcmVuY2UgdG8gdGhpcyBmcnVzdHVtLgoJCSAqLwoJCWNvcHkoIGZydXN0dW0gKSB7CgoJCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJcGxhbmVzWyBpIF0uY29weSggZnJ1c3R1bS5wbGFuZXNbIGkgXSApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogU2V0cyB0aGUgZnJ1c3R1bSBwbGFuZXMgZnJvbSB0aGUgZ2l2ZW4gcHJvamVjdGlvbiBtYXRyaXguCgkJICoKCQkgKiBAcGFyYW0ge01hdHJpeDR9IG0gLSBUaGUgcHJvamVjdGlvbiBtYXRyaXguCgkJICogQHBhcmFtIHsoV2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0pfSBjb29yZGluYXRlU3lzdGVtIC0gVGhlIGNvb3JkaW5hdGUgc3lzdGVtLgoJCSAqIEByZXR1cm4ge0ZydXN0dW19IEEgcmVmZXJlbmNlIHRvIHRoaXMgZnJ1c3R1bS4KCQkgKi8KCQlzZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggbSwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoJCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgkJCWNvbnN0IG1lMCA9IG1lWyAwIF0sIG1lMSA9IG1lWyAxIF0sIG1lMiA9IG1lWyAyIF0sIG1lMyA9IG1lWyAzIF07CgkJCWNvbnN0IG1lNCA9IG1lWyA0IF0sIG1lNSA9IG1lWyA1IF0sIG1lNiA9IG1lWyA2IF0sIG1lNyA9IG1lWyA3IF07CgkJCWNvbnN0IG1lOCA9IG1lWyA4IF0sIG1lOSA9IG1lWyA5IF0sIG1lMTAgPSBtZVsgMTAgXSwgbWUxMSA9IG1lWyAxMSBdOwoJCQljb25zdCBtZTEyID0gbWVbIDEyIF0sIG1lMTMgPSBtZVsgMTMgXSwgbWUxNCA9IG1lWyAxNCBdLCBtZTE1ID0gbWVbIDE1IF07CgoJCQlwbGFuZXNbIDAgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTAsIG1lNyAtIG1lNCwgbWUxMSAtIG1lOCwgbWUxNSAtIG1lMTIgKS5ub3JtYWxpemUoKTsKCQkJcGxhbmVzWyAxIF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUwLCBtZTcgKyBtZTQsIG1lMTEgKyBtZTgsIG1lMTUgKyBtZTEyICkubm9ybWFsaXplKCk7CgkJCXBsYW5lc1sgMiBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMSwgbWU3ICsgbWU1LCBtZTExICsgbWU5LCBtZTE1ICsgbWUxMyApLm5vcm1hbGl6ZSgpOwoJCQlwbGFuZXNbIDMgXS5zZXRDb21wb25lbnRzKCBtZTMgLSBtZTEsIG1lNyAtIG1lNSwgbWUxMSAtIG1lOSwgbWUxNSAtIG1lMTMgKS5ub3JtYWxpemUoKTsKCQkJcGxhbmVzWyA0IF0uc2V0Q29tcG9uZW50cyggbWUzIC0gbWUyLCBtZTcgLSBtZTYsIG1lMTEgLSBtZTEwLCBtZTE1IC0gbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQkJcGxhbmVzWyA1IF0uc2V0Q29tcG9uZW50cyggbWUzICsgbWUyLCBtZTcgKyBtZTYsIG1lMTEgKyBtZTEwLCBtZTE1ICsgbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQkJfSBlbHNlIGlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR1BVQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTIsIG1lNiwgbWUxMCwgbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQkJfSBlbHNlIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5GcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgM0Qgb2JqZWN0J3MgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0uCgkJICoKCQkgKiBOb3RlIHRoYXQgdGhlIDNEIG9iamVjdCBtdXN0IGhhdmUgYSBnZW9tZXRyeSBzbyB0aGF0IHRoZSBib3VuZGluZyBzcGhlcmUgY2FuIGJlIGNhbGN1bGF0ZWQuCgkJICoKCQkgKiBAcGFyYW0ge09iamVjdDNEfSBvYmplY3QgLSBUaGUgM0Qgb2JqZWN0IHRvIHRlc3QuCgkJICogQHJldHVybiB7Ym9vbGVhbn0gV2hldGhlciB0aGUgM0Qgb2JqZWN0J3MgYm91bmRpbmcgc3BoZXJlIGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0gb3Igbm90LgoJCSAqLwoJCWludGVyc2VjdHNPYmplY3QoIG9iamVjdCApIHsKCgkJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBvYmplY3QuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQkJX3NwaGVyZSQzLmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSApLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoKCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJCQlfc3BoZXJlJDMuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHNwcml0ZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgoJCSAqCgkJICogQHBhcmFtIHtTcHJpdGV9IHNwcml0ZSAtIFRoZSBzcHJpdGUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBzcHJpdGUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c1Nwcml0ZSggc3ByaXRlICkgewoKCQkJX3NwaGVyZSQzLmNlbnRlci5zZXQoIDAsIDAsIDAgKTsKCgkJCWNvbnN0IG9mZnNldCA9IF9kZWZhdWx0U3ByaXRlQ2VudGVyLmRpc3RhbmNlVG8oIHNwcml0ZS5jZW50ZXIgKTsKCgkJCV9zcGhlcmUkMy5yYWRpdXMgPSAwLjcwNzEwNjc4MTE4NjU0NzYgKyBvZmZzZXQ7CgkJCV9zcGhlcmUkMy5hcHBseU1hdHJpeDQoIHNwcml0ZS5tYXRyaXhXb3JsZCApOwoKCQkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQzICk7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIGJvdW5kaW5nIHNwaGVyZSBpcyBpbnRlcnNlY3RpbmcgdGhpcyBmcnVzdHVtLgoJCSAqCgkJICogQHBhcmFtIHtTcGhlcmV9IHNwaGVyZSAtIFRoZSBib3VuZGluZyBzcGhlcmUgdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBzcGhlcmUgaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c1NwaGVyZSggc3BoZXJlICkgewoKCQkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgkJCWNvbnN0IGNlbnRlciA9IHNwaGVyZS5jZW50ZXI7CgkJCWNvbnN0IG5lZ1JhZGl1cyA9IC0gc3BoZXJlLnJhZGl1czsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJY29uc3QgZGlzdGFuY2UgPSBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIGNlbnRlciApOwoKCQkJCWlmICggZGlzdGFuY2UgPCBuZWdSYWRpdXMgKSB7CgoJCQkJCXJldHVybiBmYWxzZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgZ2l2ZW4gYm91bmRpbmcgYm94IGlzIGludGVyc2VjdGluZyB0aGlzIGZydXN0dW0uCgkJICoKCQkgKiBAcGFyYW0ge0JveDN9IGJveCAtIFRoZSBib3VuZGluZyBib3ggdG8gdGVzdC4KCQkgKiBAcmV0dXJuIHtib29sZWFufSBXaGV0aGVyIHRoZSBib3VuZGluZyBib3ggaXMgaW50ZXJzZWN0aW5nIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCWNvbnN0IHBsYW5lID0gcGxhbmVzWyBpIF07CgoJCQkJLy8gY29ybmVyIGF0IG1heCBkaXN0YW5jZQoKCQkJCV92ZWN0b3IkNi54ID0gcGxhbmUubm9ybWFsLnggPiAwID8gYm94Lm1heC54IDogYm94Lm1pbi54OwoJCQkJX3ZlY3RvciQ2LnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CgkJCQlfdmVjdG9yJDYueiA9IHBsYW5lLm5vcm1hbC56ID4gMCA/IGJveC5tYXgueiA6IGJveC5taW4uejsKCgkJCQlpZiAoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggX3ZlY3RvciQ2ICkgPCAwICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGdpdmVuIHBvaW50IGxpZXMgd2l0aGluIHRoZSBmcnVzdHVtLgoJCSAqCgkJICogQHBhcmFtIHtWZWN0b3IzfSBwb2ludCAtIFRoZSBwb2ludCB0byB0ZXN0LgoJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHBvaW50IGxpZXMgd2l0aGluIHRoaXMgZnJ1c3R1bSBvciBub3QuCgkJICovCgkJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgoJCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJaWYgKCBwbGFuZXNbIGkgXS5kaXN0YW5jZVRvUG9pbnQoIHBvaW50ICkgPCAwICkgewoKCQkJCQlyZXR1cm4gZmFsc2U7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJLyoqCgkJICogUmV0dXJucyBhIG5ldyBmcnVzdHVtIHdpdGggY29waWVkIHZhbHVlcyBmcm9tIHRoaXMgaW5zdGFuY2UuCgkJICoKCQkgKiBAcmV0dXJuIHtGcnVzdHVtfSBBIGNsb25lIG9mIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIHRleHR1cmUgZm9yIHVzZSB3aXRoIGEgdmlkZW8uCgkgKgoJICogYGBganMKCSAqIC8vIGFzc3VtaW5nIHlvdSBoYXZlIGNyZWF0ZWQgYSBIVE1MIHZpZGVvIGVsZW1lbnQgd2l0aCBpZD0idmlkZW8iCgkgKiBjb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAndmlkZW8nICk7CgkgKiBjb25zdCB0ZXh0dXJlID0gbmV3IFRIUkVFLlZpZGVvVGV4dHVyZSggdmlkZW8gKTsKCSAqIGBgYAoJICoKCSAqIE5vdGU6IEFmdGVyIHRoZSBpbml0aWFsIHVzZSBvZiBhIHRleHR1cmUsIGl0cyBkaW1lbnNpb25zLCBmb3JtYXQsIGFuZCB0eXBlCgkgKiBjYW5ub3QgYmUgY2hhbmdlZC4gSW5zdGVhZCwgY2FsbCB7QGxpbmsgVGV4dHVyZSNkaXNwb3NlfSBvbiB0aGUgdGV4dHVyZSBhbmQgaW5zdGFudGlhdGUgYSBuZXcgb25lLgoJICoKCSAqIEBhdWdtZW50cyBUZXh0dXJlCgkgKi8KCWNsYXNzIFZpZGVvVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHZpZGVvIHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0ge0hUTUxWaWRlb0VsZW1lbnR9IHZpZGVvIC0gVGhlIHZpZGVvIGVsZW1lbnQgdG8gdXNlIGFzIGEgZGF0YSBzb3VyY2UgZm9yIHRoZSB0ZXh0dXJlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFwcGluZz1UZXh0dXJlLkRFRkFVTFRfTUFQUElOR10gLSBUaGUgdGV4dHVyZSBtYXBwaW5nLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd3JhcFM9Q2xhbXBUb0VkZ2VXcmFwcGluZ10gLSBUaGUgd3JhcFMgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwVD1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwVCB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21hZ0ZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1hZyBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttaW5GaWx0ZXI9TGluZWFyRmlsdGVyXSAtIFRoZSBtaW4gZmlsdGVyIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PVJHQkFGb3JtYXRdIC0gVGhlIHRleHR1cmUgZm9ybWF0LgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbdHlwZT1VbnNpZ25lZEJ5dGVUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIgPSBMaW5lYXJGaWx0ZXIsIG1pbkZpbHRlciA9IExpbmVhckZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICkgewoKCQkJc3VwZXIoIHZpZGVvLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCgkJCS8qKgoJCQkgKiBUaGlzIGZsYWcgY2FuIGJlIHVzZWQgZm9yIHR5cGUgdGVzdGluZy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmlzVmlkZW9UZXh0dXJlID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRvIGdlbmVyYXRlIG1pcG1hcHMgKGlmIHBvc3NpYmxlKSBmb3IgYSB0ZXh0dXJlLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkJZnVuY3Rpb24gdXBkYXRlVmlkZW8oKSB7CgoJCQkJc2NvcGUubmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJdmlkZW8ucmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjayggdXBkYXRlVmlkZW8gKTsKCgkJCX0KCgkJCWlmICggJ3JlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2snIGluIHZpZGVvICkgewoKCQkJCXZpZGVvLnJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2soIHVwZGF0ZVZpZGVvICk7CgoJCQl9CgoJCX0KCgkJY2xvbmUoKSB7CgoJCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuaW1hZ2UgKS5jb3B5KCB0aGlzICk7CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIGF1dG9tYXRpY2FsbHkgYnkgdGhlIHJlbmRlcmVyIGFuZCBzZXRzIHtAbGluayBUZXh0dXJlI25lZWRzVXBkYXRlfQoJCSAqIHRvIGB0cnVlYCBldmVyeSB0aW1lIGEgbmV3IGZyYW1lIGlzIGF2YWlsYWJsZS4KCQkgKgoJCSAqIE9ubHkgcmVsZXZhbnQgaWYgYHJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2tgIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhlIGJyb3dzZXIuCgkJICovCgkJdXBkYXRlKCkgewoKCQkJY29uc3QgdmlkZW8gPSB0aGlzLmltYWdlOwoJCQljb25zdCBoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPSAncmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjaycgaW4gdmlkZW87CgoJCQlpZiAoIGhhc1ZpZGVvRnJhbWVDYWxsYmFjayA9PT0gZmFsc2UgJiYgdmlkZW8ucmVhZHlTdGF0ZSA+PSB2aWRlby5IQVZFX0NVUlJFTlRfREFUQSApIHsKCgkJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJfQoKCX0KCgkvKioKCSAqIFRoaXMgY2xhc3MgY2FuIGJlIHVzZWQgdG8gYXV0b21hdGljYWxseSBzYXZlIHRoZSBkZXB0aCBpbmZvcm1hdGlvbiBvZiBhCgkgKiByZW5kZXJpbmcgaW50byBhIHRleHR1cmUuCgkgKgoJICogQGF1Z21lbnRzIFRleHR1cmUKCSAqLwoJY2xhc3MgRGVwdGhUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZGVwdGggdGV4dHVyZS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdGV4dHVyZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdGV4dHVyZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3R5cGU9VW5zaWduZWRJbnRUeXBlXSAtIFRoZSB0ZXh0dXJlIHR5cGUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFttYXBwaW5nPVRleHR1cmUuREVGQVVMVF9NQVBQSU5HXSAtIFRoZSB0ZXh0dXJlIG1hcHBpbmcuCgkJICogQHBhcmFtIHtudW1iZXJ9IFt3cmFwUz1DbGFtcFRvRWRnZVdyYXBwaW5nXSAtIFRoZSB3cmFwUyB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW3dyYXBUPUNsYW1wVG9FZGdlV3JhcHBpbmddIC0gVGhlIHdyYXBUIHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbWFnRmlsdGVyPUxpbmVhckZpbHRlcl0gLSBUaGUgbWFnIGZpbHRlciB2YWx1ZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW21pbkZpbHRlcj1MaW5lYXJGaWx0ZXJdIC0gVGhlIG1pbiBmaWx0ZXIgdmFsdWUuCgkJICogQHBhcmFtIHtudW1iZXJ9IFthbmlzb3Ryb3B5PVRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZXSAtIFRoZSBhbmlzb3Ryb3B5IHZhbHVlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZm9ybWF0PURlcHRoRm9ybWF0XSAtIFRoZSB0ZXh0dXJlIGZvcm1hdC4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2RlcHRoPTFdIC0gVGhlIGRlcHRoIG9mIHRoZSB0ZXh0dXJlLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB3aWR0aCwgaGVpZ2h0LCB0eXBlID0gVW5zaWduZWRJbnRUeXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIG1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIGFuaXNvdHJvcHksIGZvcm1hdCA9IERlcHRoRm9ybWF0LCBkZXB0aCA9IDEgKSB7CgoJCQlpZiAoIGZvcm1hdCAhPT0gRGVwdGhGb3JtYXQgJiYgZm9ybWF0ICE9PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnRGVwdGhUZXh0dXJlIGZvcm1hdCBtdXN0IGJlIGVpdGhlciBUSFJFRS5EZXB0aEZvcm1hdCBvciBUSFJFRS5EZXB0aFN0ZW5jaWxGb3JtYXQnICk7CgoJCQl9CgoJCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IGRlcHRoIH07CgoJCQlzdXBlciggaW1hZ2UsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNEZXB0aFRleHR1cmUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSB0ZXh0dXJlIGlzIGZsaXBwZWQgYWxvbmcgdGhlIHZlcnRpY2FsIGF4aXMgd2hlbgoJCQkgKiB1cGxvYWRlZCB0byB0aGUgR1BVLgoJCQkgKgoJCQkgKiBPdmVyd3JpdHRlbiBhbmQgc2V0IHRvIGBmYWxzZWAgYnkgZGVmYXVsdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmZsaXBZID0gZmFsc2U7CgoJCQkvKioKCQkJICogV2hldGhlciB0byBnZW5lcmF0ZSBtaXBtYXBzIChpZiBwb3NzaWJsZSkgZm9yIGEgdGV4dHVyZS4KCQkJICoKCQkJICogT3ZlcndyaXR0ZW4gYW5kIHNldCB0byBgZmFsc2VgIGJ5IGRlZmF1bHQuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBDb2RlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGRlcHRoIGNvbXBhcmUgZnVuY3Rpb24uCgkJCSAqCgkJCSAqIEB0eXBlIHs/KE5ldmVyQ29tcGFyZXxMZXNzQ29tcGFyZXxFcXVhbENvbXBhcmV8TGVzc0VxdWFsQ29tcGFyZXxHcmVhdGVyQ29tcGFyZXxOb3RFcXVhbENvbXBhcmV8R3JlYXRlckVxdWFsQ29tcGFyZXxBbHdheXNDb21wYXJlKX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBudWxsOwoKCQl9CgoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMuc291cmNlID0gbmV3IFNvdXJjZSggT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5pbWFnZSApICk7IC8vIHNlZSAjMzA1NDAKCQkJdGhpcy5jb21wYXJlRnVuY3Rpb24gPSBzb3VyY2UuY29tcGFyZUZ1bmN0aW9uOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJdG9KU09OKCBtZXRhICkgewoKCQkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQkJaWYgKCB0aGlzLmNvbXBhcmVGdW5jdGlvbiAhPT0gbnVsbCApIGRhdGEuY29tcGFyZUZ1bmN0aW9uID0gdGhpcy5jb21wYXJlRnVuY3Rpb247CgoJCQlyZXR1cm4gZGF0YTsKCgkJfQoKCX0KCgkvKioKCSAqIEEgZ2VvbWV0cnkgY2xhc3MgZm9yIHJlcHJlc2VudGluZyBhIHBsYW5lLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5QbGFuZUdlb21ldHJ5KCAxLCAxICk7CgkgKiBjb25zdCBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogMHhmZmZmMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSApOwoJICogY29uc3QgcGxhbmUgPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkgKiBzY2VuZS5hZGQoIHBsYW5lICk7CgkgKiBgYGAKCSAqCgkgKiBAYXVnbWVudHMgQnVmZmVyR2VvbWV0cnkKCSAqLwoJY2xhc3MgUGxhbmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBwbGFuZSBnZW9tZXRyeS4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGg9MV0gLSBUaGUgd2lkdGggYWxvbmcgdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodD0xXSAtIFRoZSBoZWlnaHQgYWxvbmcgdGhlIFkgYXhpcwoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbd2lkdGhTZWdtZW50cz0xXSAtIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgYWxvbmcgdGhlIFggYXhpcy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2hlaWdodFNlZ21lbnRzPTFdIC0gVGhlIG51bWJlciBvZiBzZWdtZW50cyBhbG9uZyB0aGUgWSBheGlzLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIHdpZHRoU2VnbWVudHMgPSAxLCBoZWlnaHRTZWdtZW50cyA9IDEgKSB7CgoJCQlzdXBlcigpOwoKCQkJdGhpcy50eXBlID0gJ1BsYW5lR2VvbWV0cnknOwoKCQkJLyoqCgkJCSAqIEhvbGRzIHRoZSBjb25zdHJ1Y3RvciBwYXJhbWV0ZXJzIHRoYXQgaGF2ZSBiZWVuCgkJCSAqIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIGdlb21ldHJ5LiBBbnkgbW9kaWZpY2F0aW9uCgkJCSAqIGFmdGVyIGluc3RhbnRpYXRpb24gZG9lcyBub3QgY2hhbmdlIHRoZSBnZW9tZXRyeS4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJCXdpZHRoOiB3aWR0aCwKCQkJCWhlaWdodDogaGVpZ2h0LAoJCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKCQkJCWhlaWdodFNlZ21lbnRzOiBoZWlnaHRTZWdtZW50cwoJCQl9OwoKCQkJY29uc3Qgd2lkdGhfaGFsZiA9IHdpZHRoIC8gMjsKCQkJY29uc3QgaGVpZ2h0X2hhbGYgPSBoZWlnaHQgLyAyOwoKCQkJY29uc3QgZ3JpZFggPSBNYXRoLmZsb29yKCB3aWR0aFNlZ21lbnRzICk7CgkJCWNvbnN0IGdyaWRZID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKTsKCgkJCWNvbnN0IGdyaWRYMSA9IGdyaWRYICsgMTsKCQkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKCQkJY29uc3Qgc2VnbWVudF93aWR0aCA9IHdpZHRoIC8gZ3JpZFg7CgkJCWNvbnN0IHNlZ21lbnRfaGVpZ2h0ID0gaGVpZ2h0IC8gZ3JpZFk7CgoJCQkvLwoKCQkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCQljb25zdCBub3JtYWxzID0gW107CgkJCWNvbnN0IHV2cyA9IFtdOwoKCQkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5ICsrICkgewoKCQkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRfaGVpZ2h0IC0gaGVpZ2h0X2hhbGY7CgoJCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKCQkJCQljb25zdCB4ID0gaXggKiBzZWdtZW50X3dpZHRoIC0gd2lkdGhfaGFsZjsKCgkJCQkJdmVydGljZXMucHVzaCggeCwgLSB5LCAwICk7CgoJCQkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJCXV2cy5wdXNoKCAxIC0gKCBpeSAvIGdyaWRZICkgKTsKCgkJCQl9CgoJCQl9CgoJCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZOyBpeSArKyApIHsKCgkJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCArKyApIHsKCgkJCQkJY29uc3QgYSA9IGl4ICsgZ3JpZFgxICogaXk7CgkJCQkJY29uc3QgYiA9IGl4ICsgZ3JpZFgxICogKCBpeSArIDEgKTsKCQkJCQljb25zdCBjID0gKCBpeCArIDEgKSArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQkJY29uc3QgZCA9ICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogRmFjdG9yeSBtZXRob2QgZm9yIGNyZWF0aW5nIGFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgZnJvbSB0aGUgZ2l2ZW4KCQkgKiBKU09OIG9iamVjdC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gQSBKU09OIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHNlcmlhbGl6ZWQgZ2VvbWV0cnkuCgkJICogQHJldHVybiB7UGxhbmVHZW9tZXRyeX0gQSBuZXcgaW5zdGFuY2UuCgkJICovCgkJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQkJcmV0dXJuIG5ldyBQbGFuZUdlb21ldHJ5KCBkYXRhLndpZHRoLCBkYXRhLmhlaWdodCwgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBBIG1hdGVyaWFsIGZvciBkcmF3aW5nIGdlb21ldHJ5IGJ5IGRlcHRoLiBEZXB0aCBpcyBiYXNlZCBvZmYgb2YgdGhlIGNhbWVyYQoJICogbmVhciBhbmQgZmFyIHBsYW5lLiBXaGl0ZSBpcyBuZWFyZXN0LCBibGFjayBpcyBmYXJ0aGVzdC4KCSAqCgkgKiBAYXVnbWVudHMgTWF0ZXJpYWwKCSAqLwoJY2xhc3MgTWVzaERlcHRoTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgbWVzaCBkZXB0aCBtYXRlcmlhbC4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbcGFyYW1ldGVyc10gLSBBbiBvYmplY3Qgd2l0aCBvbmUgb3IgbW9yZSBwcm9wZXJ0aWVzCgkJICogZGVmaW5pbmcgdGhlIG1hdGVyaWFsJ3MgYXBwZWFyYW5jZS4gQW55IHByb3BlcnR5IG9mIHRoZSBtYXRlcmlhbAoJCSAqIChpbmNsdWRpbmcgYW55IHByb3BlcnR5IGZyb20gaW5oZXJpdGVkIG1hdGVyaWFscykgY2FuIGJlIHBhc3NlZAoJCSAqIGluIGhlcmUuIENvbG9yIHZhbHVlcyBjYW4gYmUgcGFzc2VkIGFueSB0eXBlIG9mIHZhbHVlIGFjY2VwdGVkCgkJICogYnkge0BsaW5rIENvbG9yI3NldH0uCgkJICovCgkJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCQlzdXBlcigpOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNNZXNoRGVwdGhNYXRlcmlhbCA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnTWVzaERlcHRoTWF0ZXJpYWwnOwoKCQkJLyoqCgkJCSAqIFR5cGUgZm9yIGRlcHRoIHBhY2tpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHsoQmFzaWNEZXB0aFBhY2tpbmd8UkdCQURlcHRoUGFja2luZ3xSR0JEZXB0aFBhY2tpbmd8UkdEZXB0aFBhY2tpbmcpfQoJCQkgKiBAZGVmYXVsdCBCYXNpY0RlcHRoUGFja2luZwoJCQkgKi8KCQkJdGhpcy5kZXB0aFBhY2tpbmcgPSBCYXNpY0RlcHRoUGFja2luZzsKCgkJCS8qKgoJCQkgKiBUaGUgY29sb3IgbWFwLiBNYXkgb3B0aW9uYWxseSBpbmNsdWRlIGFuIGFscGhhIGNoYW5uZWwsIHR5cGljYWxseSBjb21iaW5lZAoJCQkgKiB3aXRoIHtAbGluayBNYXRlcmlhbCN0cmFuc3BhcmVudH0gb3Ige0BsaW5rIE1hdGVyaWFsI2FscGhhVGVzdH0uCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5tYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBhbHBoYSBtYXAgaXMgYSBncmF5c2NhbGUgdGV4dHVyZSB0aGF0IGNvbnRyb2xzIHRoZSBvcGFjaXR5IGFjcm9zcyB0aGUKCQkJICogc3VyZmFjZSAoYmxhY2s6IGZ1bGx5IHRyYW5zcGFyZW50OyB3aGl0ZTogZnVsbHkgb3BhcXVlKS4KCQkJICoKCQkJICogT25seSB0aGUgY29sb3Igb2YgdGhlIHRleHR1cmUgaXMgdXNlZCwgaWdub3JpbmcgdGhlIGFscGhhIGNoYW5uZWwgaWYgb25lCgkJCSAqIGV4aXN0cy4gRm9yIFJHQiBhbmQgUkdCQSB0ZXh0dXJlcywgdGhlIHJlbmRlcmVyIHdpbGwgdXNlIHRoZSBncmVlbiBjaGFubmVsCgkJCSAqIHdoZW4gc2FtcGxpbmcgdGhpcyB0ZXh0dXJlIGR1ZSB0byB0aGUgZXh0cmEgYml0IG9mIHByZWNpc2lvbiBwcm92aWRlZCBmb3IKCQkJICogZ3JlZW4gaW4gRFhULWNvbXByZXNzZWQgYW5kIHVuY29tcHJlc3NlZCBSR0IgNTY1IGZvcm1hdHMuIEx1bWluYW5jZS1vbmx5IGFuZAoJCQkgKiBsdW1pbmFuY2UvYWxwaGEgdGV4dHVyZXMgd2lsbCBhbHNvIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGRpc3BsYWNlbWVudCBtYXAgYWZmZWN0cyB0aGUgcG9zaXRpb24gb2YgdGhlIG1lc2gncyB2ZXJ0aWNlcy4gVW5saWtlCgkJCSAqIG90aGVyIG1hcHMgd2hpY2ggb25seSBhZmZlY3QgdGhlIGxpZ2h0IGFuZCBzaGFkZSBvZiB0aGUgbWF0ZXJpYWwgdGhlCgkJCSAqIGRpc3BsYWNlZCB2ZXJ0aWNlcyBjYW4gY2FzdCBzaGFkb3dzLCBibG9jayBvdGhlciBvYmplY3RzLCBhbmQgb3RoZXJ3aXNlCgkJCSAqIGFjdCBhcyByZWFsIGdlb21ldHJ5LiBUaGUgZGlzcGxhY2VtZW50IHRleHR1cmUgaXMgYW4gaW1hZ2Ugd2hlcmUgdGhlIHZhbHVlCgkJCSAqIG9mIGVhY2ggcGl4ZWwgKHdoaXRlIGJlaW5nIHRoZSBoaWdoZXN0KSBpcyBtYXBwZWQgYWdhaW5zdCwgYW5kCgkJCSAqIHJlcG9zaXRpb25zLCB0aGUgdmVydGljZXMgb2YgdGhlIG1lc2guCgkJCSAqCgkJCSAqIEB0eXBlIHs/VGV4dHVyZX0KCQkJICogQGRlZmF1bHQgbnVsbAoJCQkgKi8KCQkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIEhvdyBtdWNoIHRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIG1lc2ggKHdoZXJlIGJsYWNrIGlzIG5vCgkJCSAqIGRpc3BsYWNlbWVudCwgYW5kIHdoaXRlIGlzIG1heGltdW0gZGlzcGxhY2VtZW50KS4gV2l0aG91dCBhIGRpc3BsYWNlbWVudAoJCQkgKiBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCgkJCS8qKgoJCQkgKiBUaGUgb2Zmc2V0IG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwJ3MgdmFsdWVzIG9uIHRoZSBtZXNoJ3MgdmVydGljZXMuCgkJCSAqIFRoZSBiaWFzIGlzIGFkZGVkIHRvIHRoZSBzY2FsZWQgc2FtcGxlIG9mIHRoZSBkaXNwbGFjZW1lbnQgbWFwLgoJCQkgKiBXaXRob3V0IGEgZGlzcGxhY2VtZW50IG1hcCBzZXQsIHRoaXMgdmFsdWUgaXMgbm90IGFwcGxpZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDAKCQkJICovCgkJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCQkvKioKCQkJICogUmVuZGVycyB0aGUgZ2VvbWV0cnkgYXMgYSB3aXJlZnJhbWUuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBDb250cm9scyB0aGUgdGhpY2tuZXNzIG9mIHRoZSB3aXJlZnJhbWUuCgkJCSAqCgkJCSAqIFdlYkdMIGFuZCBXZWJHUFUgaWdub3JlIHRoaXMgcHJvcGVydHkgYW5kIGFsd2F5cyByZW5kZXIKCQkJICogMSBwaXhlbCB3aWRlIGxpbmVzLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCQl9CgoJCWNvcHkoIHNvdXJjZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQkJdGhpcy5kZXB0aFBhY2tpbmcgPSBzb3VyY2UuZGVwdGhQYWNraW5nOwoKCQkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJfQoKCS8qKgoJICogQSBtYXRlcmlhbCB1c2VkIGludGVybmFsbHkgZm9yIGltcGxlbWVudGluZyBzaGFkb3cgbWFwcGluZyB3aXRoCgkgKiBwb2ludCBsaWdodHMuCgkgKgoJICogQ2FuIGFsc28gYmUgdXNlZCB0byBjdXN0b21pemUgdGhlIHNoYWRvdyBjYXN0aW5nIG9mIGFuIG9iamVjdCBieSBhc3NpZ25pbmcKCSAqIGFuIGluc3RhbmNlIG9mIGBNZXNoRGlzdGFuY2VNYXRlcmlhbGAgdG8ge0BsaW5rIE9iamVjdDNEI2N1c3RvbURpc3RhbmNlTWF0ZXJpYWx9LgoJICogVGhlIGZvbGxvd2luZyBleGFtcGxlcyBkZW1vbnN0cmF0ZXMgdGhpcyBhcHByb2FjaCBpbiBvcmRlciB0byBlbnN1cmUKCSAqIHRyYW5zcGFyZW50IHBhcnRzIG9mIG9iamVjdHMgZG8gbm8gY2FzdCBzaGFkb3dzLgoJICoKCSAqIEBhdWdtZW50cyBNYXRlcmlhbAoJICovCgljbGFzcyBNZXNoRGlzdGFuY2VNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBtZXNoIGRpc3RhbmNlIG1hdGVyaWFsLgoJCSAqCgkJICogQHBhcmFtIHtPYmplY3R9IFtwYXJhbWV0ZXJzXSAtIEFuIG9iamVjdCB3aXRoIG9uZSBvciBtb3JlIHByb3BlcnRpZXMKCQkgKiBkZWZpbmluZyB0aGUgbWF0ZXJpYWwncyBhcHBlYXJhbmNlLiBBbnkgcHJvcGVydHkgb2YgdGhlIG1hdGVyaWFsCgkJICogKGluY2x1ZGluZyBhbnkgcHJvcGVydHkgZnJvbSBpbmhlcml0ZWQgbWF0ZXJpYWxzKSBjYW4gYmUgcGFzc2VkCgkJICogaW4gaGVyZS4gQ29sb3IgdmFsdWVzIGNhbiBiZSBwYXNzZWQgYW55IHR5cGUgb2YgdmFsdWUgYWNjZXB0ZWQKCQkgKiBieSB7QGxpbmsgQ29sb3Ijc2V0fS4KCQkgKi8KCQljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc01lc2hEaXN0YW5jZU1hdGVyaWFsID0gdHJ1ZTsKCgkJCXRoaXMudHlwZSA9ICdNZXNoRGlzdGFuY2VNYXRlcmlhbCc7CgoJCQkvKioKCQkJICogVGhlIGNvbG9yIG1hcC4gTWF5IG9wdGlvbmFsbHkgaW5jbHVkZSBhbiBhbHBoYSBjaGFubmVsLCB0eXBpY2FsbHkgY29tYmluZWQKCQkJICogd2l0aCB7QGxpbmsgTWF0ZXJpYWwjdHJhbnNwYXJlbnR9IG9yIHtAbGluayBNYXRlcmlhbCNhbHBoYVRlc3R9LgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMubWFwID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBUaGUgYWxwaGEgbWFwIGlzIGEgZ3JheXNjYWxlIHRleHR1cmUgdGhhdCBjb250cm9scyB0aGUgb3BhY2l0eSBhY3Jvc3MgdGhlCgkJCSAqIHN1cmZhY2UgKGJsYWNrOiBmdWxseSB0cmFuc3BhcmVudDsgd2hpdGU6IGZ1bGx5IG9wYXF1ZSkuCgkJCSAqCgkJCSAqIE9ubHkgdGhlIGNvbG9yIG9mIHRoZSB0ZXh0dXJlIGlzIHVzZWQsIGlnbm9yaW5nIHRoZSBhbHBoYSBjaGFubmVsIGlmIG9uZQoJCQkgKiBleGlzdHMuIEZvciBSR0IgYW5kIFJHQkEgdGV4dHVyZXMsIHRoZSByZW5kZXJlciB3aWxsIHVzZSB0aGUgZ3JlZW4gY2hhbm5lbAoJCQkgKiB3aGVuIHNhbXBsaW5nIHRoaXMgdGV4dHVyZSBkdWUgdG8gdGhlIGV4dHJhIGJpdCBvZiBwcmVjaXNpb24gcHJvdmlkZWQgZm9yCgkJCSAqIGdyZWVuIGluIERYVC1jb21wcmVzc2VkIGFuZCB1bmNvbXByZXNzZWQgUkdCIDU2NSBmb3JtYXRzLiBMdW1pbmFuY2Utb25seSBhbmQKCQkJICogbHVtaW5hbmNlL2FscGhhIHRleHR1cmVzIHdpbGwgYWxzbyBzdGlsbCB3b3JrIGFzIGV4cGVjdGVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBkaXNwbGFjZW1lbnQgbWFwIGFmZmVjdHMgdGhlIHBvc2l0aW9uIG9mIHRoZSBtZXNoJ3MgdmVydGljZXMuIFVubGlrZQoJCQkgKiBvdGhlciBtYXBzIHdoaWNoIG9ubHkgYWZmZWN0IHRoZSBsaWdodCBhbmQgc2hhZGUgb2YgdGhlIG1hdGVyaWFsIHRoZQoJCQkgKiBkaXNwbGFjZWQgdmVydGljZXMgY2FuIGNhc3Qgc2hhZG93cywgYmxvY2sgb3RoZXIgb2JqZWN0cywgYW5kIG90aGVyd2lzZQoJCQkgKiBhY3QgYXMgcmVhbCBnZW9tZXRyeS4gVGhlIGRpc3BsYWNlbWVudCB0ZXh0dXJlIGlzIGFuIGltYWdlIHdoZXJlIHRoZSB2YWx1ZQoJCQkgKiBvZiBlYWNoIHBpeGVsICh3aGl0ZSBiZWluZyB0aGUgaGlnaGVzdCkgaXMgbWFwcGVkIGFnYWluc3QsIGFuZAoJCQkgKiByZXBvc2l0aW9ucywgdGhlIHZlcnRpY2VzIG9mIHRoZSBtZXNoLgoJCQkgKgoJCQkgKiBAdHlwZSB7P1RleHR1cmV9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBIb3cgbXVjaCB0aGUgZGlzcGxhY2VtZW50IG1hcCBhZmZlY3RzIHRoZSBtZXNoICh3aGVyZSBibGFjayBpcyBubwoJCQkgKiBkaXNwbGFjZW1lbnQsIGFuZCB3aGl0ZSBpcyBtYXhpbXVtIGRpc3BsYWNlbWVudCkuIFdpdGhvdXQgYSBkaXNwbGFjZW1lbnQKCQkJICogbWFwIHNldCwgdGhpcyB2YWx1ZSBpcyBub3QgYXBwbGllZC4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMAoJCQkgKi8KCQkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgoJCQkvKioKCQkJICogVGhlIG9mZnNldCBvZiB0aGUgZGlzcGxhY2VtZW50IG1hcCdzIHZhbHVlcyBvbiB0aGUgbWVzaCdzIHZlcnRpY2VzLgoJCQkgKiBUaGUgYmlhcyBpcyBhZGRlZCB0byB0aGUgc2NhbGVkIHNhbXBsZSBvZiB0aGUgZGlzcGxhY2VtZW50IG1hcC4KCQkJICogV2l0aG91dCBhIGRpc3BsYWNlbWVudCBtYXAgc2V0LCB0aGlzIHZhbHVlIGlzIG5vdCBhcHBsaWVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwCgkJCSAqLwoJCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwoKCQkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UgKSB7CgoJCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgl9CgoJLyoqCgkgKiBAY2xhc3MKCSAqIEBjbGFzc2Rlc2MgQSBzaW1wbGUgY2FjaGluZyBzeXN0ZW0sIHVzZWQgaW50ZXJuYWxseSBieSB7QGxpbmsgRmlsZUxvYWRlcn0uCgkgKiBUbyBlbmFibGUgY2FjaGluZyBhY3Jvc3MgYWxsIGxvYWRlcnMgdGhhdCB1c2Uge0BsaW5rIEZpbGVMb2FkZXJ9LCBhZGQgYFRIUkVFLkNhY2hlLmVuYWJsZWQgPSB0cnVlLmAgb25jZSBpbiB5b3VyIGFwcC4KCSAqIEBoaWRlY29uc3RydWN0b3IKCSAqLwoJY29uc3QgQ2FjaGUgPSB7CgoJCS8qKgoJCSAqIFdoZXRoZXIgY2FjaGluZyBpcyBlbmFibGVkIG9yIG5vdC4KCQkgKgoJCSAqIEBzdGF0aWMKCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkgKiBAZGVmYXVsdCBmYWxzZQoJCSAqLwoJCWVuYWJsZWQ6IGZhbHNlLAoKCQkvKioKCQkgKiBBIGRpY3Rpb25hcnkgdGhhdCBob2xkcyBjYWNoZWQgZmlsZXMuCgkJICoKCQkgKiBAc3RhdGljCgkJICogQHR5cGUge09iamVjdDxzdHJpbmcsT2JqZWN0Pn0KCQkgKi8KCQlmaWxlczoge30sCgoJCS8qKgoJCSAqIEFkZHMgYSBjYWNoZSBlbnRyeSB3aXRoIGEga2V5IHRvIHJlZmVyZW5jZSB0aGUgZmlsZS4gSWYgdGhpcyBrZXkgYWxyZWFkeQoJCSAqIGhvbGRzIGEgZmlsZSwgaXQgaXMgb3ZlcndyaXR0ZW4uCgkJICoKCQkgKiBAc3RhdGljCgkJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KCQkgKiBAcGFyYW0ge09iamVjdH0gZmlsZSAtICBUaGUgZmlsZSB0byBiZSBjYWNoZWQuCgkJICovCgkJYWRkOiBmdW5jdGlvbiAoIGtleSwgZmlsZSApIHsKCgkJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCS8vIGNvbnNvbGUubG9nKCAnVEhSRUUuQ2FjaGUnLCAnQWRkaW5nIGtleTonLCBrZXkgKTsKCgkJCXRoaXMuZmlsZXNbIGtleSBdID0gZmlsZTsKCgkJfSwKCgkJLyoqCgkJICogR2V0cyB0aGUgY2FjaGVkIHZhbHVlIGZvciB0aGUgZ2l2ZW4ga2V5LgoJCSAqCgkJICogQHN0YXRpYwoJCSAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSBUaGUga2V5IHRvIHJlZmVyZW5jZSB0aGUgY2FjaGVkIGZpbGUuCgkJICogQHJldHVybiB7T2JqZWN0fHVuZGVmaW5lZH0gVGhlIGNhY2hlZCBmaWxlLiBJZiB0aGUga2V5IGRvZXMgbm90IGV4aXN0IGB1bmRlZmluZWRgIGlzIHJldHVybmVkLgoJCSAqLwoJCWdldDogZnVuY3Rpb24gKCBrZXkgKSB7CgoJCQlpZiAoIHRoaXMuZW5hYmxlZCA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLkNhY2hlJywgJ0NoZWNraW5nIGtleTonLCBrZXkgKTsKCgkJCXJldHVybiB0aGlzLmZpbGVzWyBrZXkgXTsKCgkJfSwKCgkJLyoqCgkJICogUmVtb3ZlcyB0aGUgY2FjaGVkIGZpbGUgYXNzb2NpYXRlZCB3aXRoIHRoZSBnaXZlbiBrZXkuCgkJICoKCQkgKiBAc3RhdGljCgkJICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIFRoZSBrZXkgdG8gcmVmZXJlbmNlIHRoZSBjYWNoZWQgZmlsZS4KCQkgKi8KCQlyZW1vdmU6IGZ1bmN0aW9uICgga2V5ICkgewoKCQkJZGVsZXRlIHRoaXMuZmlsZXNbIGtleSBdOwoKCQl9LAoKCQkvKioKCQkgKiBSZW1vdmUgYWxsIHZhbHVlcyBmcm9tIHRoZSBjYWNoZS4KCQkgKgoJCSAqIEBzdGF0aWMKCQkgKi8KCQljbGVhcjogZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5maWxlcyA9IHt9OwoKCQl9CgoJfTsKCgkvKioKCSAqIEhhbmRsZXMgYW5kIGtlZXBzIHRyYWNrIG9mIGxvYWRlZCBhbmQgcGVuZGluZyBkYXRhLiBBIGRlZmF1bHQgZ2xvYmFsCgkgKiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzIGlzIGNyZWF0ZWQgYW5kIHVzZWQgYnkgbG9hZGVycyBpZiBub3Qgc3VwcGxpZWQKCSAqIG1hbnVhbGx5LgoJICoKCSAqIEluIGdlbmVyYWwgdGhhdCBzaG91bGQgYmUgc3VmZmljaWVudCwgaG93ZXZlciB0aGVyZSBhcmUgdGltZXMgd2hlbiBpdCBjYW4KCSAqIGJlIHVzZWZ1bCB0byBoYXZlIHNlcGFyYXRlIGxvYWRlcnMgLSBmb3IgZXhhbXBsZSBpZiB5b3Ugd2FudCB0byBzaG93CgkgKiBzZXBhcmF0ZSBsb2FkaW5nIGJhcnMgZm9yIG9iamVjdHMgYW5kIHRleHR1cmVzLgoJICoKCSAqIGBgYGpzCgkgKiBjb25zdCBtYW5hZ2VyID0gbmV3IFRIUkVFLkxvYWRpbmdNYW5hZ2VyKCk7CgkgKiBtYW5hZ2VyLm9uTG9hZCA9ICgpID0+IGNvbnNvbGUubG9nKCAnTG9hZGluZyBjb21wbGV0ZSEnICk7CgkgKgoJICogY29uc3QgbG9hZGVyMSA9IG5ldyBPQkpMb2FkZXIoIG1hbmFnZXIgKTsKCSAqIGNvbnN0IGxvYWRlcjIgPSBuZXcgQ29sbGFkYUxvYWRlciggbWFuYWdlciApOwoJICogYGBgCgkgKi8KCWNsYXNzIExvYWRpbmdNYW5hZ2VyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBsb2FkaW5nIG1hbmFnZXIuCgkJICoKCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25Mb2FkXSAtIEV4ZWN1dGVzIHdoZW4gYWxsIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gW29uUHJvZ3Jlc3NdIC0gRXhlY3V0ZXMgd2hlbiBzaW5nbGUgaXRlbXMgaGF2ZSBiZWVuIGxvYWRlZC4KCQkgKiBAcGFyYW0ge0Z1bmN0aW9ufSBbb25FcnJvcl0gLSBFeGVjdXRlcyB3aGVuIGFuIGVycm9yIG9jY3Vycy4KCQkgKi8KCQljb25zdHJ1Y3Rvciggb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkJbGV0IGlzTG9hZGluZyA9IGZhbHNlOwoJCQlsZXQgaXRlbXNMb2FkZWQgPSAwOwoJCQlsZXQgaXRlbXNUb3RhbCA9IDA7CgkJCWxldCB1cmxNb2RpZmllciA9IHVuZGVmaW5lZDsKCQkJY29uc3QgaGFuZGxlcnMgPSBbXTsKCgkJCS8vIFJlZmVyIHRvICM1Njg5IGZvciB0aGUgcmVhc29uIHdoeSB3ZSBkb24ndCBzZXQgLm9uU3RhcnQKCQkJLy8gaW4gdGhlIGNvbnN0cnVjdG9yCgoJCQkvKioKCQkJICogRXhlY3V0ZXMgd2hlbiBhbiBpdGVtIHN0YXJ0cyBsb2FkaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMub25TdGFydCA9IHVuZGVmaW5lZDsKCgkJCS8qKgoJCQkgKiBFeGVjdXRlcyB3aGVuIGFsbCBpdGVtcyBoYXZlIGJlZW4gbG9hZGVkLgoJCQkgKgoJCQkgKiBAdHlwZSB7RnVuY3Rpb258dW5kZWZpbmVkfQoJCQkgKiBAZGVmYXVsdCB1bmRlZmluZWQKCQkJICovCgkJCXRoaXMub25Mb2FkID0gb25Mb2FkOwoKCQkJLyoqCgkJCSAqIEV4ZWN1dGVzIHdoZW4gc2luZ2xlIGl0ZW1zIGhhdmUgYmVlbiBsb2FkZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtGdW5jdGlvbnx1bmRlZmluZWR9CgkJCSAqIEBkZWZhdWx0IHVuZGVmaW5lZAoJCQkgKi8KCQkJdGhpcy5vblByb2dyZXNzID0gb25Qcm9ncmVzczsKCgkJCS8qKgoJCQkgKiBFeGVjdXRlcyB3aGVuIGFuIGVycm9yIG9jY3Vycy4KCQkJICoKCQkJICogQHR5cGUge0Z1bmN0aW9ufHVuZGVmaW5lZH0KCQkJICogQGRlZmF1bHQgdW5kZWZpbmVkCgkJCSAqLwoJCQl0aGlzLm9uRXJyb3IgPSBvbkVycm9yOwoKCQkJLyoqCgkJCSAqIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBieSBhbnkgbG9hZGVyIHVzaW5nIHRoZSBtYW5hZ2VyIHdoZW4gdGhlIGxvYWRlcgoJCQkgKiBzdGFydHMgbG9hZGluZyBhbiBpdGVtLgoJCQkgKgoJCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBsb2FkLgoJCQkgKi8KCQkJdGhpcy5pdGVtU3RhcnQgPSBmdW5jdGlvbiAoIHVybCApIHsKCgkJCQlpdGVtc1RvdGFsICsrOwoKCQkJCWlmICggaXNMb2FkaW5nID09PSBmYWxzZSApIHsKCgkJCQkJaWYgKCBzY29wZS5vblN0YXJ0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlzY29wZS5vblN0YXJ0KCB1cmwsIGl0ZW1zTG9hZGVkLCBpdGVtc1RvdGFsICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaXNMb2FkaW5nID0gdHJ1ZTsKCgkJCX07CgoJCQkvKioKCQkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCgkJCSAqIGVuZGVkIGxvYWRpbmcgYW4gaXRlbS4KCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgb2YgdGhlIGxvYWRlZCBpdGVtLgoJCQkgKi8KCQkJdGhpcy5pdGVtRW5kID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQkJaXRlbXNMb2FkZWQgKys7CgoJCQkJaWYgKCBzY29wZS5vblByb2dyZXNzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXNjb3BlLm9uUHJvZ3Jlc3MoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCgkJCQl9CgoJCQkJaWYgKCBpdGVtc0xvYWRlZCA9PT0gaXRlbXNUb3RhbCApIHsKCgkJCQkJaXNMb2FkaW5nID0gZmFsc2U7CgoJCQkJCWlmICggc2NvcGUub25Mb2FkICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlzY29wZS5vbkxvYWQoKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogVGhpcyBzaG91bGQgYmUgY2FsbGVkIGJ5IGFueSBsb2FkZXIgdXNpbmcgdGhlIG1hbmFnZXIgd2hlbiB0aGUgbG9hZGVyCgkJCSAqIGVuY291bnRlcnMgYW4gZXJyb3Igd2hlbiBsb2FkaW5nIGFuIGl0ZW0uCgkJCSAqCgkJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgVVJMIG9mIHRoZSBpdGVtIHRoYXQgcHJvZHVjZXMgYW4gZXJyb3IuCgkJCSAqLwoJCQl0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJCWlmICggc2NvcGUub25FcnJvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5vbkVycm9yKCB1cmwgKTsKCgkJCQl9CgoJCQl9OwoKCQkJLyoqCgkJCSAqIEdpdmVuIGEgVVJMLCB1c2VzIHRoZSBVUkwgbW9kaWZpZXIgY2FsbGJhY2sgKGlmIGFueSkgYW5kIHJldHVybnMgYQoJCQkgKiByZXNvbHZlZCBVUkwuIElmIG5vIFVSTCBtb2RpZmllciBpcyBzZXQsIHJldHVybnMgdGhlIG9yaWdpbmFsIFVSTC4KCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBVUkwgdG8gbG9hZC4KCQkJICogQHJldHVybiB7c3RyaW5nfSBUaGUgcmVzb2x2ZWQgVVJMLgoJCQkgKi8KCQkJdGhpcy5yZXNvbHZlVVJMID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQkJaWYgKCB1cmxNb2RpZmllciApIHsKCgkJCQkJcmV0dXJuIHVybE1vZGlmaWVyKCB1cmwgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHVybDsKCgkJCX07CgoJCQkvKioKCQkJICogSWYgcHJvdmlkZWQsIHRoZSBjYWxsYmFjayB3aWxsIGJlIHBhc3NlZCBlYWNoIHJlc291cmNlIFVSTCBiZWZvcmUgYQoJCQkgKiByZXF1ZXN0IGlzIHNlbnQuIFRoZSBjYWxsYmFjayBtYXkgcmV0dXJuIHRoZSBvcmlnaW5hbCBVUkwsIG9yIGEgbmV3IFVSTCB0bwoJCQkgKiBvdmVycmlkZSBsb2FkaW5nIGJlaGF2aW9yLiBUaGlzIGJlaGF2aW9yIGNhbiBiZSB1c2VkIHRvIGxvYWQgYXNzZXRzIGZyb20KCQkJICogLlpJUCBmaWxlcywgZHJhZy1hbmQtZHJvcCBBUElzLCBhbmQgRGF0YSBVUklzLgoJCQkgKgoJCQkgKiBgYGBqcwoJCQkgKiBjb25zdCBibG9icyA9IHsnZmlzaC5nbHRmJzogYmxvYjEsICdkaWZmdXNlLnBuZyc6IGJsb2IyLCAnbm9ybWFsLnBuZyc6IGJsb2IzfTsKCQkJICoKCQkJICogY29uc3QgbWFuYWdlciA9IG5ldyBUSFJFRS5Mb2FkaW5nTWFuYWdlcigpOwoJCQkgKgoJCQkgKiAvLyBJbml0aWFsaXplIGxvYWRpbmcgbWFuYWdlciB3aXRoIFVSTCBjYWxsYmFjay4KCQkJICogY29uc3Qgb2JqZWN0VVJMcyA9IFtdOwoJCQkgKiBtYW5hZ2VyLnNldFVSTE1vZGlmaWVyKCAoIHVybCApID0+IHsKCQkJICoKCQkJICogCXVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoIGJsb2JzWyB1cmwgXSApOwoJCQkgKiAJb2JqZWN0VVJMcy5wdXNoKCB1cmwgKTsKCQkJICogCXJldHVybiB1cmw7CgkJCSAqCgkJCSAqIH0gKTsKCQkJICoKCQkJICogLy8gTG9hZCBhcyB1c3VhbCwgdGhlbiByZXZva2UgdGhlIGJsb2IgVVJMcy4KCQkJICogY29uc3QgbG9hZGVyID0gbmV3IEdMVEZMb2FkZXIoIG1hbmFnZXIgKTsKCQkJICogbG9hZGVyLmxvYWQoICdmaXNoLmdsdGYnLCAoZ2x0ZikgPT4gewoJCQkgKgoJCQkgKiAJc2NlbmUuYWRkKCBnbHRmLnNjZW5lICk7CgkJCSAqIAlvYmplY3RVUkxzLmZvckVhY2goICggdXJsICkgPT4gVVJMLnJldm9rZU9iamVjdFVSTCggdXJsICkgKTsKCQkJICoKCQkJICogfSApOwoJCQkgKiBgYGAKCQkJICoKCQkJICogQHBhcmFtIHtmdW5jdGlvbihzdHJpbmcpOnN0cmluZ30gdHJhbnNmb3JtIC0gVVJMIG1vZGlmaWVyIGNhbGxiYWNrLiBDYWxsZWQgd2l0aCBhbiBVUkwgYW5kIG11c3QgcmV0dXJuIGEgcmVzb2x2ZWQgVVJMLgoJCQkgKiBAcmV0dXJuIHtMb2FkaW5nTWFuYWdlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBsb2FkaW5nIG1hbmFnZXIuCgkJCSAqLwoJCQl0aGlzLnNldFVSTE1vZGlmaWVyID0gZnVuY3Rpb24gKCB0cmFuc2Zvcm0gKSB7CgoJCQkJdXJsTW9kaWZpZXIgPSB0cmFuc2Zvcm07CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJlZ2lzdGVycyBhIGxvYWRlciB3aXRoIHRoZSBnaXZlbiByZWd1bGFyIGV4cHJlc3Npb24uIENhbiBiZSB1c2VkIHRvCgkJCSAqIGRlZmluZSB3aGF0IGxvYWRlciBzaG91bGQgYmUgdXNlZCBpbiBvcmRlciB0byBsb2FkIHNwZWNpZmljIGZpbGVzLiBBCgkJCSAqIHR5cGljYWwgdXNlIGNhc2UgaXMgdG8gb3ZlcndyaXRlIHRoZSBkZWZhdWx0IGxvYWRlciBmb3IgdGV4dHVyZXMuCgkJCSAqCgkJCSAqIGBgYGpzCgkJCSAqIC8vIGFkZCBoYW5kbGVyIGZvciBUR0EgdGV4dHVyZXMKCQkJICogbWFuYWdlci5hZGRIYW5kbGVyKCAvXC50Z2EkL2ksIG5ldyBUR0FMb2FkZXIoKSApOwoJCQkgKiBgYGAKCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IHJlZ2V4IC0gQSByZWd1bGFyIGV4cHJlc3Npb24uCgkJCSAqIEBwYXJhbSB7TG9hZGVyfSBsb2FkZXIgLSBBIGxvYWRlciB0aGF0IHNob3VsZCBoYW5kbGUgbWF0Y2hlZCBjYXNlcy4KCQkJICogQHJldHVybiB7TG9hZGluZ01hbmFnZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbG9hZGluZyBtYW5hZ2VyLgoJCQkgKi8KCQkJdGhpcy5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCwgbG9hZGVyICkgewoKCQkJCWhhbmRsZXJzLnB1c2goIHJlZ2V4LCBsb2FkZXIgKTsKCgkJCQlyZXR1cm4gdGhpczsKCgkJCX07CgoJCQkvKioKCQkJICogUmVtb3ZlcyB0aGUgbG9hZGVyIGZvciB0aGUgZ2l2ZW4gcmVndWxhciBleHByZXNzaW9uLgoJCQkgKgoJCQkgKiBAcGFyYW0ge3N0cmluZ30gcmVnZXggLSBBIHJlZ3VsYXIgZXhwcmVzc2lvbi4KCQkJICogQHJldHVybiB7TG9hZGluZ01hbmFnZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgbG9hZGluZyBtYW5hZ2VyLgoJCQkgKi8KCQkJdGhpcy5yZW1vdmVIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCApIHsKCgkJCQljb25zdCBpbmRleCA9IGhhbmRsZXJzLmluZGV4T2YoIHJlZ2V4ICk7CgoJCQkJaWYgKCBpbmRleCAhPT0gLTEgKSB7CgoJCQkJCWhhbmRsZXJzLnNwbGljZSggaW5kZXgsIDIgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIHRoaXM7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIENhbiBiZSB1c2VkIHRvIHJldHJpZXZlIHRoZSByZWdpc3RlcmVkIGxvYWRlciBmb3IgdGhlIGdpdmVuIGZpbGUgcGF0aC4KCQkJICoKCQkJICogQHBhcmFtIHtzdHJpbmd9IGZpbGUgLSBUaGUgZmlsZSBwYXRoLgoJCQkgKiBAcmV0dXJuIHs/TG9hZGVyfSBUaGUgcmVnaXN0ZXJlZCBsb2FkZXIuIFJldHVybnMgYG51bGxgIGlmIG5vIGxvYWRlciB3YXMgZm91bmQuCgkJCSAqLwoJCQl0aGlzLmdldEhhbmRsZXIgPSBmdW5jdGlvbiAoIGZpbGUgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyICkgewoKCQkJCQljb25zdCByZWdleCA9IGhhbmRsZXJzWyBpIF07CgkJCQkJY29uc3QgbG9hZGVyID0gaGFuZGxlcnNbIGkgKyAxIF07CgoJCQkJCWlmICggcmVnZXguZ2xvYmFsICkgcmVnZXgubGFzdEluZGV4ID0gMDsgLy8gc2VlICMxNzkyMAoKCQkJCQlpZiAoIHJlZ2V4LnRlc3QoIGZpbGUgKSApIHsKCgkJCQkJCXJldHVybiBsb2FkZXI7CgoJCQkJCX0KCgkJCQl9CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9OwoKCQl9CgoJfQoKCS8qKgoJICogVGhlIGdsb2JhbCBkZWZhdWx0IGxvYWRpbmcgbWFuYWdlci4KCSAqCgkgKiBAY29uc3RhbnQKCSAqIEB0eXBlIHtMb2FkaW5nTWFuYWdlcn0KCSAqLwoJY29uc3QgRGVmYXVsdExvYWRpbmdNYW5hZ2VyID0gLypAX19QVVJFX18qLyBuZXcgTG9hZGluZ01hbmFnZXIoKTsKCgkvKioKCSAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGxvYWRlcnMuCgkgKgoJICogQGFic3RyYWN0CgkgKi8KCWNsYXNzIExvYWRlciB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgbG9hZGVyLgoJCSAqCgkJICogQHBhcmFtIHtMb2FkaW5nTWFuYWdlcn0gW21hbmFnZXJdIC0gVGhlIGxvYWRpbmcgbWFuYWdlci4KCQkgKi8KCQljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJCS8qKgoJCQkgKiBUaGUgbG9hZGluZyBtYW5hZ2VyLgoJCQkgKgoJCQkgKiBAdHlwZSB7TG9hZGluZ01hbmFnZXJ9CgkJCSAqIEBkZWZhdWx0IERlZmF1bHRMb2FkaW5nTWFuYWdlcgoJCQkgKi8KCQkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCQkvKioKCQkJICogVGhlIGNyb3NzT3JpZ2luIHN0cmluZyB0byBpbXBsZW1lbnQgQ09SUyBmb3IgbG9hZGluZyB0aGUgdXJsIGZyb20gYQoJCQkgKiBkaWZmZXJlbnQgZG9tYWluIHRoYXQgYWxsb3dzIENPUlMuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqIEBkZWZhdWx0ICdhbm9ueW1vdXMnCgkJCSAqLwoJCQl0aGlzLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7CgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgWE1MSHR0cFJlcXVlc3QgdXNlcyBjcmVkZW50aWFscy4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFRoZSBiYXNlIHBhdGggZnJvbSB3aGljaCB0aGUgYXNzZXQgd2lsbCBiZSBsb2FkZWQuCgkJCSAqCgkJCSAqIEB0eXBlIHtzdHJpbmd9CgkJCSAqLwoJCQl0aGlzLnBhdGggPSAnJzsKCgkJCS8qKgoJCQkgKiBUaGUgYmFzZSBwYXRoIGZyb20gd2hpY2ggYWRkaXRpb25hbCByZXNvdXJjZXMgbGlrZSB0ZXh0dXJlcyB3aWxsIGJlIGxvYWRlZC4KCQkJICoKCQkJICogQHR5cGUge3N0cmluZ30KCQkJICovCgkJCXRoaXMucmVzb3VyY2VQYXRoID0gJyc7CgoJCQkvKioKCQkJICogVGhlIFtyZXF1ZXN0IGhlYWRlcl17QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9HbG9zc2FyeS9SZXF1ZXN0X2hlYWRlcn0KCQkJICogdXNlZCBpbiBIVFRQIHJlcXVlc3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtPYmplY3Q8c3RyaW5nLCBhbnk+fQoJCQkgKi8KCQkJdGhpcy5yZXF1ZXN0SGVhZGVyID0ge307CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYWxsIGNvbmNyZXRlIGxvYWRlcnMuIEl0IGhvbGRzIHRoZQoJCSAqIGxvZ2ljIGZvciBsb2FkaW5nIGFzc2V0cyBmcm9tIHRoZSBiYWNrZW5kLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHVybCAtIFRoZSBwYXRoL1VSTCBvZiB0aGUgZmlsZSB0byBiZSBsb2FkZWQuCgkJICogQHBhcmFtIHtGdW5jdGlvbn0gb25Mb2FkIC0gRXhlY3V0ZWQgd2hlbiB0aGUgbG9hZGluZyBwcm9jZXNzIGhhcyBiZWVuIGZpbmlzaGVkLgoJCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlZCB3aGlsZSB0aGUgbG9hZGluZyBpcyBpbiBwcm9ncmVzcy4KCQkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gW29uRXJyb3JdIC0gRXhlY3V0ZWQgd2hlbiBlcnJvcnMgb2NjdXIuCgkJICovCgkJbG9hZCggLyogdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKi8gKSB7fQoKCQkvKioKCQkgKiBBIGFzeW5jIHZlcnNpb24gb2Yge0BsaW5rIExvYWRlciNsb2FkfS4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLgoJCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBbb25Qcm9ncmVzc10gLSBFeGVjdXRlZCB3aGlsZSB0aGUgbG9hZGluZyBpcyBpbiBwcm9ncmVzcy4KCQkgKiBAcmV0dXJuIHtQcm9taXNlfSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBhc3NldCBoYXMgYmVlbiBsb2FkZWQuCgkJICovCgkJbG9hZEFzeW5jKCB1cmwsIG9uUHJvZ3Jlc3MgKSB7CgoJCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJCXNjb3BlLmxvYWQoIHVybCwgcmVzb2x2ZSwgb25Qcm9ncmVzcywgcmVqZWN0ICk7CgoJCQl9ICk7CgoJCX0KCgkJLyoqCgkJICogVGhpcyBtZXRob2QgbmVlZHMgdG8gYmUgaW1wbGVtZW50ZWQgYnkgYWxsIGNvbmNyZXRlIGxvYWRlcnMuIEl0IGhvbGRzIHRoZQoJCSAqIGxvZ2ljIGZvciBwYXJzaW5nIHRoZSBhc3NldCBpbnRvIHRocmVlLmpzIGVudGl0aWVzLgoJCSAqCgkJICogQHBhcmFtIHthbnl9IGRhdGEgLSBUaGUgZGF0YSB0byBwYXJzZS4KCQkgKi8KCQlwYXJzZSggLyogZGF0YSAqLyApIHt9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGBjcm9zc09yaWdpbmAgU3RyaW5nIHRvIGltcGxlbWVudCBDT1JTIGZvciBsb2FkaW5nIHRoZSBVUkwKCQkgKiBmcm9tIGEgZGlmZmVyZW50IGRvbWFpbiB0aGF0IGFsbG93cyBDT1JTLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IGNyb3NzT3JpZ2luIC0gVGhlIGBjcm9zc09yaWdpbmAgdmFsdWUuCgkJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldENyb3NzT3JpZ2luKCBjcm9zc09yaWdpbiApIHsKCgkJCXRoaXMuY3Jvc3NPcmlnaW4gPSBjcm9zc09yaWdpbjsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJLyoqCgkJICogV2hldGhlciB0aGUgWE1MSHR0cFJlcXVlc3QgdXNlcyBjcmVkZW50aWFscyBzdWNoIGFzIGNvb2tpZXMsIGF1dGhvcml6YXRpb24KCQkgKiBoZWFkZXJzIG9yIFRMUyBjbGllbnQgY2VydGlmaWNhdGVzLCBzZWUgW1hNTEh0dHBSZXF1ZXN0LndpdGhDcmVkZW50aWFsc117QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1hNTEh0dHBSZXF1ZXN0L3dpdGhDcmVkZW50aWFsc30uCgkJICoKCQkgKiBOb3RlOiBUaGlzIHNldHRpbmcgaGFzIG5vIGVmZmVjdCBpZiB5b3UgYXJlIGxvYWRpbmcgZmlsZXMgbG9jYWxseSBvciBmcm9tIHRoZSBzYW1lIGRvbWFpbi4KCQkgKgoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsdWUgLSBUaGUgYHdpdGhDcmVkZW50aWFsc2AgdmFsdWUuCgkJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFdpdGhDcmVkZW50aWFscyggdmFsdWUgKSB7CgoJCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IHZhbHVlOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBiYXNlIHBhdGggZm9yIHRoZSBhc3NldC4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIGJhc2UgcGF0aC4KCQkgKiBAcmV0dXJuIHtMb2FkZXJ9IEEgcmVmZXJlbmNlIHRvIHRoaXMgaW5zdGFuY2UuCgkJICovCgkJc2V0UGF0aCggcGF0aCApIHsKCgkJCXRoaXMucGF0aCA9IHBhdGg7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCS8qKgoJCSAqIFNldHMgdGhlIGJhc2UgcGF0aCBmb3IgZGVwZW5kZW50IHJlc291cmNlcyBsaWtlIHRleHR1cmVzLgoJCSAqCgkJICogQHBhcmFtIHtzdHJpbmd9IHJlc291cmNlUGF0aCAtIFRoZSByZXNvdXJjZSBwYXRoLgoJCSAqIEByZXR1cm4ge0xvYWRlcn0gQSByZWZlcmVuY2UgdG8gdGhpcyBpbnN0YW5jZS4KCQkgKi8KCQlzZXRSZXNvdXJjZVBhdGgoIHJlc291cmNlUGF0aCApIHsKCgkJCXRoaXMucmVzb3VyY2VQYXRoID0gcmVzb3VyY2VQYXRoOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIHRoZSBnaXZlbiByZXF1ZXN0IGhlYWRlci4KCQkgKgoJCSAqIEBwYXJhbSB7T2JqZWN0fSByZXF1ZXN0SGVhZGVyIC0gQSBbcmVxdWVzdCBoZWFkZXJde0BsaW5rIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvR2xvc3NhcnkvUmVxdWVzdF9oZWFkZXJ9CgkJICogZm9yIGNvbmZpZ3VyaW5nIHRoZSBIVFRQIHJlcXVlc3QuCgkJICogQHJldHVybiB7TG9hZGVyfSBBIHJlZmVyZW5jZSB0byB0aGlzIGluc3RhbmNlLgoJCSAqLwoJCXNldFJlcXVlc3RIZWFkZXIoIHJlcXVlc3RIZWFkZXIgKSB7CgoJCQl0aGlzLnJlcXVlc3RIZWFkZXIgPSByZXF1ZXN0SGVhZGVyOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCX0KCgkvKioKCSAqIENhbGxiYWNrIGZvciBvblByb2dyZXNzIGluIGxvYWRlcnMuCgkgKgoJICogQGNhbGxiYWNrIG9uUHJvZ3Jlc3NDYWxsYmFjawoJICogQHBhcmFtIHtQcm9ncmVzc0V2ZW50fSBldmVudCAtIEFuIGluc3RhbmNlIG9mIGBQcm9ncmVzc0V2ZW50YCB0aGF0IHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgbG9hZGluZyBzdGF0dXMuCgkgKi8KCgkvKioKCSAqIENhbGxiYWNrIGZvciBvbkVycm9yIGluIGxvYWRlcnMuCgkgKgoJICogQGNhbGxiYWNrIG9uRXJyb3JDYWxsYmFjawoJICogQHBhcmFtIHtFcnJvcn0gZXJyb3IgLSBUaGUgZXJyb3Igd2hpY2ggb2NjdXJyZWQgZHVyaW5nIHRoZSBsb2FkaW5nIHByb2Nlc3MuCgkgKi8KCgkvKioKCSAqIFRoZSBkZWZhdWx0IG1hdGVyaWFsIG5hbWUgdGhhdCBpcyB1c2VkIGJ5IGxvYWRlcnMKCSAqIHdoZW4gY3JlYXRpbmcgbWF0ZXJpYWxzIGZvciBsb2FkZWQgM0Qgb2JqZWN0cy4KCSAqCgkgKiBOb3RlOiBOb3QgYWxsIGxvYWRlcnMgbWlnaHQgaG9ub3IgdGhpcyBzZXR0aW5nLgoJICoKCSAqIEBzdGF0aWMKCSAqIEB0eXBlIHtzdHJpbmd9CgkgKiBAZGVmYXVsdCAnX19ERUZBVUxUJwoJICovCglMb2FkZXIuREVGQVVMVF9NQVRFUklBTF9OQU1FID0gJ19fREVGQVVMVCc7CgoJY29uc3QgX2xvYWRpbmcgPSBuZXcgV2Vha01hcCgpOwoKCS8qKgoJICogQSBsb2FkZXIgZm9yIGxvYWRpbmcgaW1hZ2VzLiBUaGUgY2xhc3MgbG9hZHMgaW1hZ2VzIHdpdGggdGhlIEhUTUwgYEltYWdlYCBBUEkuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IGxvYWRlciA9IG5ldyBUSFJFRS5JbWFnZUxvYWRlcigpOwoJICogY29uc3QgaW1hZ2UgPSBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCAnaW1hZ2UucG5nJyApOwoJICogYGBgCgkgKiBQbGVhc2Ugbm90ZSB0aGF0IGBJbWFnZUxvYWRlcmAgaGFzIGRyb3BwZWQgc3VwcG9ydCBmb3IgcHJvZ3Jlc3MKCSAqIGV2ZW50cyBpbiBgcjg0YC4gRm9yIGFuIGBJbWFnZUxvYWRlcmAgdGhhdCBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMsIHNlZQoJICogW3RoaXMgdGhyZWFkXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8xMDQzOSNpc3N1ZWNvbW1lbnQtMjc1Nzg1NjM5fS4KCSAqCgkgKiBAYXVnbWVudHMgTG9hZGVyCgkgKi8KCWNsYXNzIEltYWdlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBpbWFnZSBsb2FkZXIuCgkJICoKCQkgKiBAcGFyYW0ge0xvYWRpbmdNYW5hZ2VyfSBbbWFuYWdlcl0gLSBUaGUgbG9hZGluZyBtYW5hZ2VyLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQkJc3VwZXIoIG1hbmFnZXIgKTsKCgkJfQoKCQkvKioKCQkgKiBTdGFydHMgbG9hZGluZyBmcm9tIHRoZSBnaXZlbiBVUkwgYW5kIHBhc3NlcyB0aGUgbG9hZGVkIGltYWdlCgkJICogdG8gdGhlIGBvbkxvYWQoKWAgY2FsbGJhY2suIFRoZSBtZXRob2QgYWxzbyByZXR1cm5zIGEgbmV3IGBJbWFnZWAgb2JqZWN0IHdoaWNoIGNhbgoJCSAqIGRpcmVjdGx5IGJlIHVzZWQgZm9yIHRleHR1cmUgY3JlYXRpb24uIElmIHlvdSBkbyBpdCB0aGlzIHdheSwgdGhlIHRleHR1cmUKCQkgKiBtYXkgcG9wIHVwIGluIHlvdXIgc2NlbmUgb25jZSB0aGUgcmVzcGVjdGl2ZSBsb2FkaW5nIHByb2Nlc3MgaXMgZmluaXNoZWQuCgkJICoKCQkgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIHBhdGgvVVJMIG9mIHRoZSBmaWxlIHRvIGJlIGxvYWRlZC4gVGhpcyBjYW4gYWxzbyBiZSBhIGRhdGEgVVJJLgoJCSAqIEBwYXJhbSB7ZnVuY3Rpb24oSW1hZ2UpfSBvbkxvYWQgLSBFeGVjdXRlZCB3aGVuIHRoZSBsb2FkaW5nIHByb2Nlc3MgaGFzIGJlZW4gZmluaXNoZWQuCgkJICogQHBhcmFtIHtvblByb2dyZXNzQ2FsbGJhY2t9IG9uUHJvZ3Jlc3MgLSBVbnN1cHBvcnRlZCBpbiB0aGlzIGxvYWRlci4KCQkgKiBAcGFyYW0ge29uRXJyb3JDYWxsYmFja30gb25FcnJvciAtIEV4ZWN1dGVkIHdoZW4gZXJyb3JzIG9jY3VyLgoJCSAqIEByZXR1cm4ge0ltYWdlfSBUaGUgaW1hZ2UuCgkJICovCgkJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCQlpZiAoIHRoaXMucGF0aCAhPT0gdW5kZWZpbmVkICkgdXJsID0gdGhpcy5wYXRoICsgdXJsOwoKCQkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkJY29uc3QgY2FjaGVkID0gQ2FjaGUuZ2V0KCBgaW1hZ2U6JHt1cmx9YCApOwoKCQkJaWYgKCBjYWNoZWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlpZiAoIGNhY2hlZC5jb21wbGV0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKCQkJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgoJCQkJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggY2FjaGVkICk7CgoJCQkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJCQl9LCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJbGV0IGFyciA9IF9sb2FkaW5nLmdldCggY2FjaGVkICk7CgoJCQkJCWlmICggYXJyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlhcnIgPSBbXTsKCQkJCQkJX2xvYWRpbmcuc2V0KCBjYWNoZWQsIGFyciApOwoKCQkJCQl9CgoJCQkJCWFyci5wdXNoKCB7IG9uTG9hZCwgb25FcnJvciB9ICk7CgoJCQkJfQoKCQkJCXJldHVybiBjYWNoZWQ7CgoJCQl9CgoJCQljb25zdCBpbWFnZSA9IGNyZWF0ZUVsZW1lbnROUyggJ2ltZycgKTsKCgkJCWZ1bmN0aW9uIG9uSW1hZ2VMb2FkKCkgewoKCQkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgoJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRoaXMgKTsKCgkJCQkvLwoKCQkJCWNvbnN0IGNhbGxiYWNrcyA9IF9sb2FkaW5nLmdldCggdGhpcyApIHx8IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkxvYWQgKSBjYWxsYmFjay5vbkxvYWQoIHRoaXMgKTsKCgkJCQl9CgoJCQkJX2xvYWRpbmcuZGVsZXRlKCB0aGlzICk7CgoJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uSW1hZ2VFcnJvciggZXZlbnQgKSB7CgoJCQkJcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoKTsKCgkJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBldmVudCApOwoKCQkJCUNhY2hlLnJlbW92ZSggYGltYWdlOiR7dXJsfWAgKTsKCgkJCQkvLwoKCQkJCWNvbnN0IGNhbGxiYWNrcyA9IF9sb2FkaW5nLmdldCggdGhpcyApIHx8IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkVycm9yICkgY2FsbGJhY2sub25FcnJvciggZXZlbnQgKTsKCgkJCQl9CgoJCQkJX2xvYWRpbmcuZGVsZXRlKCB0aGlzICk7CgoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9CgoJCQlmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycygpIHsKCgkJCQlpbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnbG9hZCcsIG9uSW1hZ2VMb2FkLCBmYWxzZSApOwoJCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQkJfQoKCQkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKCQkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQkJaWYgKCB1cmwuc2xpY2UoIDAsIDUgKSAhPT0gJ2RhdGE6JyApIHsKCgkJCQlpZiAoIHRoaXMuY3Jvc3NPcmlnaW4gIT09IHVuZGVmaW5lZCApIGltYWdlLmNyb3NzT3JpZ2luID0gdGhpcy5jcm9zc09yaWdpbjsKCgkJCX0KCgkJCUNhY2hlLmFkZCggYGltYWdlOiR7dXJsfWAsIGltYWdlICk7CgkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCWltYWdlLnNyYyA9IHVybDsKCgkJCXJldHVybiBpbWFnZTsKCgkJfQoKCX0KCgkvKioKCSAqIENsYXNzIGZvciBsb2FkaW5nIHRleHR1cmVzLiBJbWFnZXMgYXJlIGludGVybmFsbHkKCSAqIGxvYWRlZCB2aWEge0BsaW5rIEltYWdlTG9hZGVyfS4KCSAqCgkgKiBgYGBqcwoJICogY29uc3QgbG9hZGVyID0gbmV3IFRIUkVFLlRleHR1cmVMb2FkZXIoKTsKCSAqIGNvbnN0IHRleHR1cmUgPSBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCAndGV4dHVyZXMvbGFuZF9vY2Vhbl9pY2VfY2xvdWRfMjA0OC5qcGcnICk7CgkgKgoJICogY29uc3QgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgbWFwOnRleHR1cmUgfSApOwoJICogYGBgCgkgKiBQbGVhc2Ugbm90ZSB0aGF0IGBUZXh0dXJlTG9hZGVyYCBoYXMgZHJvcHBlZCBzdXBwb3J0IGZvciBwcm9ncmVzcwoJICogZXZlbnRzIGluIGByODRgLiBGb3IgYSBgVGV4dHVyZUxvYWRlcmAgdGhhdCBzdXBwb3J0cyBwcm9ncmVzcyBldmVudHMsIHNlZQoJICogW3RoaXMgdGhyZWFkXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL2lzc3Vlcy8xMDQzOSNpc3N1ZWNvbW1lbnQtMjkzMjYwMTQ1fS4KCSAqCgkgKiBAYXVnbWVudHMgTG9hZGVyCgkgKi8KCWNsYXNzIFRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCQkvKioKCQkgKiBDb25zdHJ1Y3RzIGEgbmV3IHRleHR1cmUgbG9hZGVyLgoJCSAqCgkJICogQHBhcmFtIHtMb2FkaW5nTWFuYWdlcn0gW21hbmFnZXJdIC0gVGhlIGxvYWRpbmcgbWFuYWdlci4KCQkgKi8KCQljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJCXN1cGVyKCBtYW5hZ2VyICk7CgoJCX0KCgkJLyoqCgkJICogU3RhcnRzIGxvYWRpbmcgZnJvbSB0aGUgZ2l2ZW4gVVJMIGFuZCBwYXNzIHRoZSBmdWxseSBsb2FkZWQgdGV4dHVyZQoJCSAqIHRvIHRoZSBgb25Mb2FkKClgIGNhbGxiYWNrLiBUaGUgbWV0aG9kIGFsc28gcmV0dXJucyBhIG5ldyB0ZXh0dXJlIG9iamVjdCB3aGljaCBjYW4KCQkgKiBkaXJlY3RseSBiZSB1c2VkIGZvciBtYXRlcmlhbCBjcmVhdGlvbi4gSWYgeW91IGRvIGl0IHRoaXMgd2F5LCB0aGUgdGV4dHVyZQoJCSAqIG1heSBwb3AgdXAgaW4geW91ciBzY2VuZSBvbmNlIHRoZSByZXNwZWN0aXZlIGxvYWRpbmcgcHJvY2VzcyBpcyBmaW5pc2hlZC4KCQkgKgoJCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSBUaGUgcGF0aC9VUkwgb2YgdGhlIGZpbGUgdG8gYmUgbG9hZGVkLiBUaGlzIGNhbiBhbHNvIGJlIGEgZGF0YSBVUkkuCgkJICogQHBhcmFtIHtmdW5jdGlvbihUZXh0dXJlKX0gb25Mb2FkIC0gRXhlY3V0ZWQgd2hlbiB0aGUgbG9hZGluZyBwcm9jZXNzIGhhcyBiZWVuIGZpbmlzaGVkLgoJCSAqIEBwYXJhbSB7b25Qcm9ncmVzc0NhbGxiYWNrfSBvblByb2dyZXNzIC0gVW5zdXBwb3J0ZWQgaW4gdGhpcyBsb2FkZXIuCgkJICogQHBhcmFtIHtvbkVycm9yQ2FsbGJhY2t9IG9uRXJyb3IgLSBFeGVjdXRlZCB3aGVuIGVycm9ycyBvY2N1ci4KCQkgKiBAcmV0dXJuIHtUZXh0dXJlfSBUaGUgdGV4dHVyZS4KCQkgKi8KCQlsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQkJY29uc3QgbG9hZGVyID0gbmV3IEltYWdlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQkJbG9hZGVyLnNldENyb3NzT3JpZ2luKCB0aGlzLmNyb3NzT3JpZ2luICk7CgkJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCgkJCWxvYWRlci5sb2FkKCB1cmwsIGZ1bmN0aW9uICggaW1hZ2UgKSB7CgoJCQkJdGV4dHVyZS5pbWFnZSA9IGltYWdlOwoJCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQkJfQoKCQkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0KCgl9CgoJLyoqCgkgKiBDYW1lcmEgdGhhdCB1c2VzIFtvcnRob2dyYXBoaWMgcHJvamVjdGlvbl17QGxpbmsgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvT3J0aG9ncmFwaGljX3Byb2plY3Rpb259LgoJICoKCSAqIEluIHRoaXMgcHJvamVjdGlvbiBtb2RlLCBhbiBvYmplY3QncyBzaXplIGluIHRoZSByZW5kZXJlZCBpbWFnZSBzdGF5cwoJICogY29uc3RhbnQgcmVnYXJkbGVzcyBvZiBpdHMgZGlzdGFuY2UgZnJvbSB0aGUgY2FtZXJhLiBUaGlzIGNhbiBiZSB1c2VmdWwKCSAqIGZvciByZW5kZXJpbmcgMkQgc2NlbmVzIGFuZCBVSSBlbGVtZW50cywgYW1vbmdzdCBvdGhlciB0aGluZ3MuCgkgKgoJICogYGBganMKCSAqIGNvbnN0IGNhbWVyYSA9IG5ldyBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEoIHdpZHRoIC8gLSAyLCB3aWR0aCAvIDIsIGhlaWdodCAvIDIsIGhlaWdodCAvIC0gMiwgMSwgMTAwMCApOwoJICogc2NlbmUuYWRkKCBjYW1lcmEgKTsKCSAqIGBgYAoJICoKCSAqIEBhdWdtZW50cyBDYW1lcmEKCSAqLwoJY2xhc3MgT3J0aG9ncmFwaGljQ2FtZXJhIGV4dGVuZHMgQ2FtZXJhIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBvcnRob2dyYXBoaWMgY2FtZXJhLgoJCSAqCgkJICogQHBhcmFtIHtudW1iZXJ9IFtsZWZ0PS0xXSAtIFRoZSBsZWZ0IHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbcmlnaHQ9MV0gLSBUaGUgcmlnaHQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJICogQHBhcmFtIHtudW1iZXJ9IFt0b3A9MV0gLSBUaGUgdG9wIHBsYW5lIG9mIHRoZSBjYW1lcmEncyBmcnVzdHVtLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYm90dG9tPS0xXSAtIFRoZSBib3R0b20gcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuZWFyPTAuMV0gLSBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4KCQkgKiBAcGFyYW0ge251bWJlcn0gW2Zhcj0yMDAwXSAtIFRoZSBjYW1lcmEncyBmYXIgcGxhbmUuCgkJICovCgkJY29uc3RydWN0b3IoIGxlZnQgPSAtMSwgcmlnaHQgPSAxLCB0b3AgPSAxLCBib3R0b20gPSAtMSwgbmVhciA9IDAuMSwgZmFyID0gMjAwMCApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9IHRydWU7CgoJCQl0aGlzLnR5cGUgPSAnT3J0aG9ncmFwaGljQ2FtZXJhJzsKCgkJCS8qKgoJCQkgKiBUaGUgem9vbSBmYWN0b3Igb2YgdGhlIGNhbWVyYS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy56b29tID0gMTsKCgkJCS8qKgoJCQkgKiBSZXByZXNlbnRzIHRoZSBmcnVzdHVtIHdpbmRvdyBzcGVjaWZpY2F0aW9uLiBUaGlzIHByb3BlcnR5IHNob3VsZCBub3QgYmUgZWRpdGVkCgkJCSAqIGRpcmVjdGx5IGJ1dCB2aWEge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhI3NldFZpZXdPZmZzZXR9IGFuZCB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjY2xlYXJWaWV3T2Zmc2V0fS4KCQkJICoKCQkJICogQHR5cGUgez9PYmplY3R9CgkJCSAqIEBkZWZhdWx0IG51bGwKCQkJICovCgkJCXRoaXMudmlldyA9IG51bGw7CgoJCQkvKioKCQkJICogVGhlIGxlZnQgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IC0xCgkJCSAqLwoJCQl0aGlzLmxlZnQgPSBsZWZ0OwoKCQkJLyoqCgkJCSAqIFRoZSByaWdodCBwbGFuZSBvZiB0aGUgY2FtZXJhJ3MgZnJ1c3R1bS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMQoJCQkgKi8KCQkJdGhpcy5yaWdodCA9IHJpZ2h0OwoKCQkJLyoqCgkJCSAqIFRoZSB0b3AgcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IDEKCQkJICovCgkJCXRoaXMudG9wID0gdG9wOwoKCQkJLyoqCgkJCSAqIFRoZSBib3R0b20gcGxhbmUgb2YgdGhlIGNhbWVyYSdzIGZydXN0dW0uCgkJCSAqCgkJCSAqIEB0eXBlIHtudW1iZXJ9CgkJCSAqIEBkZWZhdWx0IC0xCgkJCSAqLwoJCQl0aGlzLmJvdHRvbSA9IGJvdHRvbTsKCgkJCS8qKgoJCQkgKiBUaGUgY2FtZXJhJ3MgbmVhciBwbGFuZS4gVGhlIHZhbGlkIHJhbmdlIGlzIGdyZWF0ZXIgdGhhbiBgMGAKCQkJICogYW5kIGxlc3MgdGhhbiB0aGUgY3VycmVudCB2YWx1ZSBvZiB7QGxpbmsgT3J0aG9ncmFwaGljQ2FtZXJhI2Zhcn0uCgkJCSAqCgkJCSAqIE5vdGUgdGhhdCwgdW5saWtlIGZvciB0aGUge0BsaW5rIFBlcnNwZWN0aXZlQ2FtZXJhfSwgYDBgIGlzIGEKCQkJICogdmFsaWQgdmFsdWUgZm9yIGFuIG9ydGhvZ3JhcGhpYyBjYW1lcmEncyBuZWFyIHBsYW5lLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAwLjEKCQkJICovCgkJCXRoaXMubmVhciA9IG5lYXI7CgoJCQkvKioKCQkJICogVGhlIGNhbWVyYSdzIGZhciBwbGFuZS4gTXVzdCBiZSBncmVhdGVyIHRoYW4gdGhlCgkJCSAqIGN1cnJlbnQgdmFsdWUgb2Yge0BsaW5rIE9ydGhvZ3JhcGhpY0NhbWVyYSNuZWFyfS4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICogQGRlZmF1bHQgMjAwMAoJCQkgKi8KCQkJdGhpcy5mYXIgPSBmYXI7CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfQoKCQljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCQl0aGlzLmxlZnQgPSBzb3VyY2UubGVmdDsKCQkJdGhpcy5yaWdodCA9IHNvdXJjZS5yaWdodDsKCQkJdGhpcy50b3AgPSBzb3VyY2UudG9wOwoJCQl0aGlzLmJvdHRvbSA9IHNvdXJjZS5ib3R0b207CgkJCXRoaXMubmVhciA9IHNvdXJjZS5uZWFyOwoJCQl0aGlzLmZhciA9IHNvdXJjZS5mYXI7CgoJCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKCQkJdGhpcy52aWV3ID0gc291cmNlLnZpZXcgPT09IG51bGwgPyBudWxsIDogT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS52aWV3ICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQkvKioKCQkgKiBTZXRzIGFuIG9mZnNldCBpbiBhIGxhcmdlciBmcnVzdHVtLiBUaGlzIGlzIHVzZWZ1bCBmb3IgbXVsdGktd2luZG93IG9yCgkJICogbXVsdGktbW9uaXRvci9tdWx0aS1tYWNoaW5lIHNldHVwcy4KCQkgKgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBmdWxsV2lkdGggLSBUaGUgZnVsbCB3aWR0aCBvZiBtdWx0aXZpZXcgc2V0dXAuCgkJICogQHBhcmFtIHtudW1iZXJ9IGZ1bGxIZWlnaHQgLSBUaGUgZnVsbCBoZWlnaHQgb2YgbXVsdGl2aWV3IHNldHVwLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gVGhlIGhvcml6b250YWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgb2Zmc2V0IG9mIHRoZSBzdWJjYW1lcmEuCgkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHN1YmNhbWVyYS4KCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiBzdWJjYW1lcmEuCgkJICogQHNlZSB7QGxpbmsgUGVyc3BlY3RpdmVDYW1lcmEjc2V0Vmlld09mZnNldH0KCQkgKi8KCQlzZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHRoaXMudmlldyA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLnZpZXcgPSB7CgkJCQkJZW5hYmxlZDogdHJ1ZSwKCQkJCQlmdWxsV2lkdGg6IDEsCgkJCQkJZnVsbEhlaWdodDogMSwKCQkJCQlvZmZzZXRYOiAwLAoJCQkJCW9mZnNldFk6IDAsCgkJCQkJd2lkdGg6IDEsCgkJCQkJaGVpZ2h0OiAxCgkJCQl9OwoKCQkJfQoKCQkJdGhpcy52aWV3LmVuYWJsZWQgPSB0cnVlOwoJCQl0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwoJCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CgkJCXRoaXMudmlldy5vZmZzZXRYID0geDsKCQkJdGhpcy52aWV3Lm9mZnNldFkgPSB5OwoJCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKCQkJdGhpcy52aWV3LmhlaWdodCA9IGhlaWdodDsKCgkJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCS8qKgoJCSAqIFJlbW92ZXMgdGhlIHZpZXcgb2Zmc2V0IGZyb20gdGhlIHByb2plY3Rpb24gbWF0cml4LgoJCSAqLwoJCWNsZWFyVmlld09mZnNldCgpIHsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgewoKCQkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgoJCQl9CgoJCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgkJfQoKCQkvKioKCQkgKiBVcGRhdGVzIHRoZSBjYW1lcmEncyBwcm9qZWN0aW9uIG1hdHJpeC4gTXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYW55IGNoYW5nZSBvZgoJCSAqIGNhbWVyYSBwcm9wZXJ0aWVzLgoJCSAqLwoJCXVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKSB7CgoJCQljb25zdCBkeCA9ICggdGhpcy5yaWdodCAtIHRoaXMubGVmdCApIC8gKCAyICogdGhpcy56b29tICk7CgkJCWNvbnN0IGR5ID0gKCB0aGlzLnRvcCAtIHRoaXMuYm90dG9tICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKCQkJY29uc3QgY3ggPSAoIHRoaXMucmlnaHQgKyB0aGlzLmxlZnQgKSAvIDI7CgkJCWNvbnN0IGN5ID0gKCB0aGlzLnRvcCArIHRoaXMuYm90dG9tICkgLyAyOwoKCQkJbGV0IGxlZnQgPSBjeCAtIGR4OwoJCQlsZXQgcmlnaHQgPSBjeCArIGR4OwoJCQlsZXQgdG9wID0gY3kgKyBkeTsKCQkJbGV0IGJvdHRvbSA9IGN5IC0gZHk7CgoJCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCAmJiB0aGlzLnZpZXcuZW5hYmxlZCApIHsKCgkJCQljb25zdCBzY2FsZVcgPSAoIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQgKSAvIHRoaXMudmlldy5mdWxsV2lkdGggLyB0aGlzLnpvb207CgkJCQljb25zdCBzY2FsZUggPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvIHRoaXMudmlldy5mdWxsSGVpZ2h0IC8gdGhpcy56b29tOwoKCQkJCWxlZnQgKz0gc2NhbGVXICogdGhpcy52aWV3Lm9mZnNldFg7CgkJCQlyaWdodCA9IGxlZnQgKyBzY2FsZVcgKiB0aGlzLnZpZXcud2lkdGg7CgkJCQl0b3AgLT0gc2NhbGVIICogdGhpcy52aWV3Lm9mZnNldFk7CgkJCQlib3R0b20gPSB0b3AgLSBzY2FsZUggKiB0aGlzLnZpZXcuaGVpZ2h0OwoKCQkJfQoKCQkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VPcnRob2dyYXBoaWMoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgdGhpcy5uZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgoJCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCQl9CgoJCXRvSlNPTiggbWV0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJCWRhdGEub2JqZWN0Lnpvb20gPSB0aGlzLnpvb207CgkJCWRhdGEub2JqZWN0LmxlZnQgPSB0aGlzLmxlZnQ7CgkJCWRhdGEub2JqZWN0LnJpZ2h0ID0gdGhpcy5yaWdodDsKCQkJZGF0YS5vYmplY3QudG9wID0gdGhpcy50b3A7CgkJCWRhdGEub2JqZWN0LmJvdHRvbSA9IHRoaXMuYm90dG9tOwoJCQlkYXRhLm9iamVjdC5uZWFyID0gdGhpcy5uZWFyOwoJCQlkYXRhLm9iamVjdC5mYXIgPSB0aGlzLmZhcjsKCgkJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgZGF0YS5vYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCB0aGlzLnZpZXcgKTsKCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJfQoKCS8qKgoJICogVGhpcyB0eXBlIG9mIGNhbWVyYSBjYW4gYmUgdXNlZCBpbiBvcmRlciB0byBlZmZpY2llbnRseSByZW5kZXIgYSBzY2VuZSB3aXRoIGEKCSAqIHByZWRlZmluZWQgc2V0IG9mIGNhbWVyYXMuIFRoaXMgaXMgYW4gaW1wb3J0YW50IHBlcmZvcm1hbmNlIGFzcGVjdCBmb3IKCSAqIHJlbmRlcmluZyBWUiBzY2VuZXMuCgkgKgoJICogQW4gaW5zdGFuY2Ugb2YgYEFycmF5Q2FtZXJhYCBhbHdheXMgaGFzIGFuIGFycmF5IG9mIHN1YiBjYW1lcmFzLiBJdCdzIG1hbmRhdG9yeQoJICogdG8gZGVmaW5lIGZvciBlYWNoIHN1YiBjYW1lcmEgdGhlIGB2aWV3cG9ydGAgcHJvcGVydHkgd2hpY2ggZGV0ZXJtaW5lcyB0aGUKCSAqIHBhcnQgb2YgdGhlIHZpZXdwb3J0IHRoYXQgaXMgcmVuZGVyZWQgd2l0aCB0aGlzIGNhbWVyYS4KCSAqCgkgKiBAYXVnbWVudHMgUGVyc3BlY3RpdmVDYW1lcmEKCSAqLwoJY2xhc3MgQXJyYXlDYW1lcmEgZXh0ZW5kcyBQZXJzcGVjdGl2ZUNhbWVyYSB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgYXJyYXkgY2FtZXJhLgoJCSAqCgkJICogQHBhcmFtIHtBcnJheTxQZXJzcGVjdGl2ZUNhbWVyYT59IFthcnJheT1bXV0gLSBBbiBhcnJheSBvZiBwZXJzcGVjdGl2ZSBzdWIgY2FtZXJhcy4KCQkgKi8KCQljb25zdHJ1Y3RvciggYXJyYXkgPSBbXSApIHsKCgkJCXN1cGVyKCk7CgoJCQkvKioKCQkJICogVGhpcyBmbGFnIGNhbiBiZSB1c2VkIGZvciB0eXBlIHRlc3RpbmcuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAcmVhZG9ubHkKCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5pc0FycmF5Q2FtZXJhID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIHRoaXMgY2FtZXJhIGlzIHVzZWQgd2l0aCBtdWx0aXZpZXcgcmVuZGVyaW5nIG9yIG5vdC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEByZWFkb25seQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5pc011bHRpVmlld0NhbWVyYSA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIEFuIGFycmF5IG9mIHBlcnNwZWN0aXZlIHN1YiBjYW1lcmFzLgoJCQkgKgoJCQkgKiBAdHlwZSB7QXJyYXk8UGVyc3BlY3RpdmVDYW1lcmE+fQoJCQkgKi8KCQkJdGhpcy5jYW1lcmFzID0gYXJyYXk7CgoJCX0KCgl9CgoJLyoqCgkgKiBEZXRlcm1pbmVzIGhvdyBtYW55IGJ5dGVzIG11c3QgYmUgdXNlZCB0byByZXByZXNlbnQgdGhlIHRleHR1cmUuCgkgKgoJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSB0ZXh0dXJlLgoJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgb2YgdGhlIHRleHR1cmUuCgkgKiBAcGFyYW0ge251bWJlcn0gZm9ybWF0IC0gVGhlIHRleHR1cmUncyBmb3JtYXQuCgkgKiBAcGFyYW0ge251bWJlcn0gdHlwZSAtIFRoZSB0ZXh0dXJlJ3MgdHlwZS4KCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGJ5dGUgbGVuZ3RoLgoJICovCglmdW5jdGlvbiBnZXRCeXRlTGVuZ3RoKCB3aWR0aCwgaGVpZ2h0LCBmb3JtYXQsIHR5cGUgKSB7CgoJCWNvbnN0IHR5cGVCeXRlTGVuZ3RoID0gZ2V0VGV4dHVyZVR5cGVCeXRlTGVuZ3RoKCB0eXBlICk7CgoJCXN3aXRjaCAoIGZvcm1hdCApIHsKCgkJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvT3BlbkdMLVJlZnBhZ2VzL2VzMy4wL2h0bWwvZ2xUZXhJbWFnZTJELnhodG1sCgkJCWNhc2UgQWxwaGFGb3JtYXQ6CgkJCQlyZXR1cm4gd2lkdGggKiBoZWlnaHQ7CgkJCWNhc2UgUmVkRm9ybWF0OgoJCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKCQkJY2FzZSBSZWRJbnRlZ2VyRm9ybWF0OgoJCQkJcmV0dXJuICggKCB3aWR0aCAqIGhlaWdodCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKCQkJY2FzZSBSR0Zvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAyICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoJCQljYXNlIFJHSW50ZWdlckZvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAyICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoJCQljYXNlIFJHQkZvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiAzICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoJCQljYXNlIFJHQkFGb3JtYXQ6CgkJCQlyZXR1cm4gKCAoIHdpZHRoICogaGVpZ2h0ICogNCApIC8gdHlwZUJ5dGVMZW5ndGguY29tcG9uZW50cyApICogdHlwZUJ5dGVMZW5ndGguYnl0ZUxlbmd0aDsKCQkJY2FzZSBSR0JBSW50ZWdlckZvcm1hdDoKCQkJCXJldHVybiAoICggd2lkdGggKiBoZWlnaHQgKiA0ICkgLyB0eXBlQnl0ZUxlbmd0aC5jb21wb25lbnRzICkgKiB0eXBlQnl0ZUxlbmd0aC5ieXRlTGVuZ3RoOwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2IvCgkJCWNhc2UgUkdCX1MzVENfRFhUMV9Gb3JtYXQ6CgkJCWNhc2UgUkdCQV9TM1RDX0RYVDFfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDg7CgkJCWNhc2UgUkdCQV9TM1RDX0RYVDNfRm9ybWF0OgoJCQljYXNlIFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMyApIC8gNCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAzICkgLyA0ICkgKiAxNjsKCgkJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvd2ViZ2wvZXh0ZW5zaW9ucy9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMvCgkJCWNhc2UgUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQ6CgkJCWNhc2UgUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0OgoJCQkJcmV0dXJuICggTWF0aC5tYXgoIHdpZHRoLCAxNiApICogTWF0aC5tYXgoIGhlaWdodCwgOCApICkgLyA0OwoJCQljYXNlIFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0OgoJCQljYXNlIFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdDoKCQkJCXJldHVybiAoIE1hdGgubWF4KCB3aWR0aCwgOCApICogTWF0aC5tYXgoIGhlaWdodCwgOCApICkgLyAyOwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMvCgkJCWNhc2UgUkdCX0VUQzFfRm9ybWF0OgoJCQljYXNlIFJHQl9FVEMyX0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgMyApIC8gNCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAzICkgLyA0ICkgKiA4OwoJCQljYXNlIFJHQkFfRVRDMl9FQUNfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjLwoJCQljYXNlIFJHQkFfQVNUQ180eDRfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAzICkgLyA0ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ181eDRfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA0ICkgLyA1ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDMgKSAvIDQgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ181eDVfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA0ICkgLyA1ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ182eDVfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA1ICkgLyA2ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ182eDZfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA1ICkgLyA2ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ184eDVfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDQgKSAvIDUgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ184eDZfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDUgKSAvIDYgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ184eDhfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA3ICkgLyA4ICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDcgKSAvIDggKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ18xMHg1X0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmZsb29yKCAoIHdpZHRoICsgOSApIC8gMTAgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgNCApIC8gNSApICogMTY7CgkJCWNhc2UgUkdCQV9BU1RDXzEweDZfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyA5ICkgLyAxMCApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyA1ICkgLyA2ICkgKiAxNjsKCQkJY2FzZSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDcgKSAvIDggKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDkgKSAvIDEwICkgKiBNYXRoLmZsb29yKCAoIGhlaWdodCArIDkgKSAvIDEwICkgKiAxNjsKCQkJY2FzZSBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguZmxvb3IoICggd2lkdGggKyAxMSApIC8gMTIgKSAqIE1hdGguZmxvb3IoICggaGVpZ2h0ICsgOSApIC8gMTAgKSAqIDE2OwoJCQljYXNlIFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5mbG9vciggKCB3aWR0aCArIDExICkgLyAxMiApICogTWF0aC5mbG9vciggKCBoZWlnaHQgKyAxMSApIC8gMTIgKSAqIDE2OwoKCQkJLy8gaHR0cHM6Ly9yZWdpc3RyeS5raHJvbm9zLm9yZy93ZWJnbC9leHRlbnNpb25zL0VYVF90ZXh0dXJlX2NvbXByZXNzaW9uX2JwdGMvCgkJCWNhc2UgUkdCQV9CUFRDX0Zvcm1hdDoKCQkJY2FzZSBSR0JfQlBUQ19TSUdORURfRm9ybWF0OgoJCQljYXNlIFJHQl9CUFRDX1VOU0lHTkVEX0Zvcm1hdDoKCQkJCXJldHVybiBNYXRoLmNlaWwoIHdpZHRoIC8gNCApICogTWF0aC5jZWlsKCBoZWlnaHQgLyA0ICkgKiAxNjsKCgkJCS8vIGh0dHBzOi8vcmVnaXN0cnkua2hyb25vcy5vcmcvd2ViZ2wvZXh0ZW5zaW9ucy9FWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9yZ3RjLwoJCQljYXNlIFJFRF9SR1RDMV9Gb3JtYXQ6CgkJCWNhc2UgU0lHTkVEX1JFRF9SR1RDMV9Gb3JtYXQ6CgkJCQlyZXR1cm4gTWF0aC5jZWlsKCB3aWR0aCAvIDQgKSAqIE1hdGguY2VpbCggaGVpZ2h0IC8gNCApICogODsKCQkJY2FzZSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0OgoJCQljYXNlIFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0OgoJCQkJcmV0dXJuIE1hdGguY2VpbCggd2lkdGggLyA0ICkgKiBNYXRoLmNlaWwoIGhlaWdodCAvIDQgKSAqIDE2OwoKCQl9CgoJCXRocm93IG5ldyBFcnJvcigKCQkJYFVuYWJsZSB0byBkZXRlcm1pbmUgdGV4dHVyZSBieXRlIGxlbmd0aCBmb3IgJHtmb3JtYXR9IGZvcm1hdC5gLAoJCSk7CgoJfQoKCWZ1bmN0aW9uIGdldFRleHR1cmVUeXBlQnl0ZUxlbmd0aCggdHlwZSApIHsKCgkJc3dpdGNoICggdHlwZSApIHsKCgkJCWNhc2UgVW5zaWduZWRCeXRlVHlwZToKCQkJY2FzZSBCeXRlVHlwZToKCQkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDEsIGNvbXBvbmVudHM6IDEgfTsKCQkJY2FzZSBVbnNpZ25lZFNob3J0VHlwZToKCQkJY2FzZSBTaG9ydFR5cGU6CgkJCWNhc2UgSGFsZkZsb2F0VHlwZToKCQkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDIsIGNvbXBvbmVudHM6IDEgfTsKCQkJY2FzZSBVbnNpZ25lZFNob3J0NDQ0NFR5cGU6CgkJCWNhc2UgVW5zaWduZWRTaG9ydDU1NTFUeXBlOgoJCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogMiwgY29tcG9uZW50czogNCB9OwoJCQljYXNlIFVuc2lnbmVkSW50VHlwZToKCQkJY2FzZSBJbnRUeXBlOgoJCQljYXNlIEZsb2F0VHlwZToKCQkJCXJldHVybiB7IGJ5dGVMZW5ndGg6IDQsIGNvbXBvbmVudHM6IDEgfTsKCQkJY2FzZSBVbnNpZ25lZEludDU5OTlUeXBlOgoJCQkJcmV0dXJuIHsgYnl0ZUxlbmd0aDogNCwgY29tcG9uZW50czogMyB9OwoKCQl9CgoJCXRocm93IG5ldyBFcnJvciggYFVua25vd24gdGV4dHVyZSB0eXBlICR7dHlwZX0uYCApOwoKCX0KCglpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKCQlfX1RIUkVFX0RFVlRPT0xTX18uZGlzcGF0Y2hFdmVudCggbmV3IEN1c3RvbUV2ZW50KCAncmVnaXN0ZXInLCB7IGRldGFpbDogewoJCQlyZXZpc2lvbjogUkVWSVNJT04sCgkJfSB9ICkgKTsKCgl9CgoJaWYgKCB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyApIHsKCgkJaWYgKCB3aW5kb3cuX19USFJFRV9fICkgewoKCQkJY29uc29sZS53YXJuKCAnV0FSTklORzogTXVsdGlwbGUgaW5zdGFuY2VzIG9mIFRocmVlLmpzIGJlaW5nIGltcG9ydGVkLicgKTsKCgkJfSBlbHNlIHsKCgkJCXdpbmRvdy5fX1RIUkVFX18gPSBSRVZJU0lPTjsKCgkJfQoKCX0KCgkvKioKCSAqIEBsaWNlbnNlCgkgKiBDb3B5cmlnaHQgMjAxMC0yMDI1IFRocmVlLmpzIEF1dGhvcnMKCSAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBNSVQKCSAqLwoKCWZ1bmN0aW9uIFdlYkdMQW5pbWF0aW9uKCkgewoKCQlsZXQgY29udGV4dCA9IG51bGw7CgkJbGV0IGlzQW5pbWF0aW5nID0gZmFsc2U7CgkJbGV0IGFuaW1hdGlvbkxvb3AgPSBudWxsOwoJCWxldCByZXF1ZXN0SWQgPSBudWxsOwoKCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lLCBmcmFtZSApIHsKCgkJCWFuaW1hdGlvbkxvb3AoIHRpbWUsIGZyYW1lICk7CgoJCQlyZXF1ZXN0SWQgPSBjb250ZXh0LnJlcXVlc3RBbmltYXRpb25GcmFtZSggb25BbmltYXRpb25GcmFtZSApOwoKCQl9CgoJCXJldHVybiB7CgoJCQlzdGFydDogZnVuY3Rpb24gKCkgewoKCQkJCWlmICggaXNBbmltYXRpbmcgPT09IHRydWUgKSByZXR1cm47CgkJCQlpZiAoIGFuaW1hdGlvbkxvb3AgPT09IG51bGwgKSByZXR1cm47CgoJCQkJcmVxdWVzdElkID0gY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgkJCQlpc0FuaW1hdGluZyA9IHRydWU7CgoJCQl9LAoKCQkJc3RvcDogZnVuY3Rpb24gKCkgewoKCQkJCWNvbnRleHQuY2FuY2VsQW5pbWF0aW9uRnJhbWUoIHJlcXVlc3RJZCApOwoKCQkJCWlzQW5pbWF0aW5nID0gZmFsc2U7CgoJCQl9LAoKCQkJc2V0QW5pbWF0aW9uTG9vcDogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCQlhbmltYXRpb25Mb29wID0gY2FsbGJhY2s7CgoJCQl9LAoKCQkJc2V0Q29udGV4dDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQljb250ZXh0ID0gdmFsdWU7CgoJCQl9CgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQXR0cmlidXRlcyggZ2wgKSB7CgoJCWNvbnN0IGJ1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApIHsKCgkJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCQljb25zdCB1c2FnZSA9IGF0dHJpYnV0ZS51c2FnZTsKCQkJY29uc3Qgc2l6ZSA9IGFycmF5LmJ5dGVMZW5ndGg7CgoJCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCgkJCWdsLmJpbmRCdWZmZXIoIGJ1ZmZlclR5cGUsIGJ1ZmZlciApOwoJCQlnbC5idWZmZXJEYXRhKCBidWZmZXJUeXBlLCBhcnJheSwgdXNhZ2UgKTsKCgkJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgoJCQlsZXQgdHlwZTsKCgkJCWlmICggYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXkgKSB7CgoJCQkJdHlwZSA9IGdsLkZMT0FUOwoKCQkJfSBlbHNlIGlmICggdHlwZW9mIEZsb2F0MTZBcnJheSAhPT0gJ3VuZGVmaW5lZCcgJiYgYXJyYXkgaW5zdGFuY2VvZiBGbG9hdDE2QXJyYXkgKSB7CgoJCQkJdHlwZSA9IGdsLkhBTEZfRkxPQVQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5ICkgewoKCQkJCWlmICggYXR0cmlidXRlLmlzRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJdHlwZSA9IGdsLkhBTEZfRkxPQVQ7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUOwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50MTZBcnJheSApIHsKCgkJCQl0eXBlID0gZ2wuU0hPUlQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQzMkFycmF5ICkgewoKCQkJCXR5cGUgPSBnbC5VTlNJR05FRF9JTlQ7CgoJCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkgKSB7CgoJCQkJdHlwZSA9IGdsLklOVDsKCgkJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgSW50OEFycmF5ICkgewoKCQkJCXR5cGUgPSBnbC5CWVRFOwoKCQkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OEFycmF5ICkgewoKCQkJCXR5cGUgPSBnbC5VTlNJR05FRF9CWVRFOwoKCQkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSApIHsKCgkJCQl0eXBlID0gZ2wuVU5TSUdORURfQllURTsKCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVbnN1cHBvcnRlZCBidWZmZXIgZGF0YSBmb3JtYXQ6ICcgKyBhcnJheSApOwoKCQkJfQoKCQkJcmV0dXJuIHsKCQkJCWJ1ZmZlcjogYnVmZmVyLAoJCQkJdHlwZTogdHlwZSwKCQkJCWJ5dGVzUGVyRWxlbWVudDogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCgkJCQl2ZXJzaW9uOiBhdHRyaWJ1dGUudmVyc2lvbiwKCQkJCXNpemU6IHNpemUKCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVCdWZmZXIoIGJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQkJY29uc3QgYXJyYXkgPSBhdHRyaWJ1dGUuYXJyYXk7CgkJCWNvbnN0IHVwZGF0ZVJhbmdlcyA9IGF0dHJpYnV0ZS51cGRhdGVSYW5nZXM7CgoJCQlnbC5iaW5kQnVmZmVyKCBidWZmZXJUeXBlLCBidWZmZXIgKTsKCgkJCWlmICggdXBkYXRlUmFuZ2VzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQkvLyBOb3QgdXNpbmcgdXBkYXRlIHJhbmdlcwoJCQkJZ2wuYnVmZmVyU3ViRGF0YSggYnVmZmVyVHlwZSwgMCwgYXJyYXkgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gQmVmb3JlIGFwcGx5aW5nIHVwZGF0ZSByYW5nZXMsIHdlIG1lcmdlIGFueSBhZGphY2VudCAvIG92ZXJsYXBwaW5nCgkJCQkvLyByYW5nZXMgdG8gcmVkdWNlIGxvYWQgb24gYGdsLmJ1ZmZlclN1YkRhdGFgLiBFbXBpcmljYWxseSwgdGhpcyBoYXMgbGVkCgkJCQkvLyB0byBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBtYWtlIGhlYXZ5IHVzZSBvZgoJCQkJLy8gdXBkYXRlIHJhbmdlcy4gTGlrZWx5IGR1ZSB0byBHUFUgY29tbWFuZCBvdmVyaGVhZC4KCQkJCS8vCgkJCQkvLyBOb3RlIHRoYXQgdG8gcmVkdWNlIGdhcmJhZ2UgY29sbGVjdGlvbiBiZXR3ZWVuIGZyYW1lcywgd2UgbWVyZ2UgdGhlCgkJCQkvLyB1cGRhdGUgcmFuZ2VzIGluLXBsYWNlLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB0aGlzIG1ldGhvZCB3aWxsIGNsZWFyIHRoZQoJCQkJLy8gdXBkYXRlIHJhbmdlcyBvbmNlIHVwZGF0ZWQuCgoJCQkJdXBkYXRlUmFuZ2VzLnNvcnQoICggYSwgYiApID0+IGEuc3RhcnQgLSBiLnN0YXJ0ICk7CgoJCQkJLy8gVG8gbWVyZ2UgdGhlIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UsIHdlIHdvcmsgZnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZQoJCQkJLy8gZXhpc3RpbmcgdXBkYXRlUmFuZ2VzIGFycmF5LCBtZXJnaW5nIHJhbmdlcy4gVGhpcyBtYXkgcmVzdWx0IGluIGEgZmluYWwKCQkJCS8vIGFycmF5IHdoaWNoIGlzIHNtYWxsZXIgdGhhbiB0aGUgb3JpZ2luYWwuIFRoaXMgaW5kZXggdHJhY2tzIHRoZSBsYXN0CgkJCQkvLyBpbmRleCByZXByZXNlbnRpbmcgYSBtZXJnZWQgcmFuZ2UsIGFueSBkYXRhIGFmdGVyIHRoaXMgaW5kZXggY2FuIGJlCgkJCQkvLyB0cmltbWVkIG9uY2UgdGhlIG1lcmdlIGFsZ29yaXRobSBpcyBjb21wbGV0ZWQuCgkJCQlsZXQgbWVyZ2VJbmRleCA9IDA7CgoJCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgcHJldmlvdXNSYW5nZSA9IHVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdOwoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCS8vIFdlIGFkZCBvbmUgaGVyZSB0byBtZXJnZSBhZGphY2VudCByYW5nZXMuIFRoaXMgaXMgc2FmZSBiZWNhdXNlIHJhbmdlcwoJCQkJCS8vIG9wZXJhdGUgb3ZlciBwb3NpdGl2ZSBpbnRlZ2Vycy4KCQkJCQlpZiAoIHJhbmdlLnN0YXJ0IDw9IHByZXZpb3VzUmFuZ2Uuc3RhcnQgKyBwcmV2aW91c1JhbmdlLmNvdW50ICsgMSApIHsKCgkJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQgPSBNYXRoLm1heCgKCQkJCQkJCXByZXZpb3VzUmFuZ2UuY291bnQsCgkJCQkJCQlyYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gcHJldmlvdXNSYW5nZS5zdGFydAoJCQkJCQkpOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJKysgbWVyZ2VJbmRleDsKCQkJCQkJdXBkYXRlUmFuZ2VzWyBtZXJnZUluZGV4IF0gPSByYW5nZTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyBUcmltIHRoZSBhcnJheSB0byBvbmx5IGNvbnRhaW4gdGhlIG1lcmdlZCByYW5nZXMuCgkJCQl1cGRhdGVSYW5nZXMubGVuZ3RoID0gbWVyZ2VJbmRleCArIDE7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHJhbmdlLnN0YXJ0ICogYXJyYXkuQllURVNfUEVSX0VMRU1FTlQsCgkJCQkJCWFycmF5LCByYW5nZS5zdGFydCwgcmFuZ2UuY291bnQgKTsKCgkJCQl9CgoJCQkJYXR0cmlidXRlLmNsZWFyVXBkYXRlUmFuZ2VzKCk7CgoJCQl9CgoJCQlhdHRyaWJ1dGUub25VcGxvYWRDYWxsYmFjaygpOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIGdldCggYXR0cmlidXRlICkgewoKCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZS5kYXRhOwoKCQkJcmV0dXJuIGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgkJfQoKCQlmdW5jdGlvbiByZW1vdmUoIGF0dHJpYnV0ZSApIHsKCgkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCQlpZiAoIGRhdGEgKSB7CgoJCQkJZ2wuZGVsZXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciApOwoKCQkJCWJ1ZmZlcnMuZGVsZXRlKCBhdHRyaWJ1dGUgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGUoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApIHsKCgkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCWlmICggYXR0cmlidXRlLmlzR0xCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJY29uc3QgY2FjaGVkID0gYnVmZmVycy5nZXQoIGF0dHJpYnV0ZSApOwoKCQkJCWlmICggISBjYWNoZWQgfHwgY2FjaGVkLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCQkJYnVmZmVycy5zZXQoIGF0dHJpYnV0ZSwgewoJCQkJCQlidWZmZXI6IGF0dHJpYnV0ZS5idWZmZXIsCgkJCQkJCXR5cGU6IGF0dHJpYnV0ZS50eXBlLAoJCQkJCQlieXRlc1BlckVsZW1lbnQ6IGF0dHJpYnV0ZS5lbGVtZW50U2l6ZSwKCQkJCQkJdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KCQkJCQl9ICk7CgoJCQkJfQoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlidWZmZXJzLnNldCggYXR0cmlidXRlLCBjcmVhdGVCdWZmZXIoIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApICk7CgoJCQl9IGVsc2UgaWYgKCBkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCQlpZiAoIGRhdGEuc2l6ZSAhPT0gYXR0cmlidXRlLmFycmF5LmJ5dGVMZW5ndGggKSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMQXR0cmlidXRlczogVGhlIHNpemUgb2YgdGhlIGJ1ZmZlciBhdHRyaWJ1dGVcJ3MgYXJyYXkgYnVmZmVyIGRvZXMgbm90IG1hdGNoIHRoZSBvcmlnaW5hbCBzaXplLiBSZXNpemluZyBidWZmZXIgYXR0cmlidXRlcyBpcyBub3Qgc3VwcG9ydGVkLicgKTsKCgkJCQl9CgoJCQkJdXBkYXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciwgYXR0cmlidXRlLCBidWZmZXJUeXBlICk7CgoJCQkJZGF0YS52ZXJzaW9uID0gYXR0cmlidXRlLnZlcnNpb247CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCgkJCWdldDogZ2V0LAoJCQlyZW1vdmU6IHJlbW92ZSwKCQkJdXBkYXRlOiB1cGRhdGUKCgkJfTsKCgl9CgoJdmFyIGFscGhhaGFzaF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2UG9zaXRpb24gKSApIGRpc2NhcmQ7XG4jZW5kaWYiOwoKCXZhciBhbHBoYWhhc2hfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRjb25zdCBmbG9hdCBBTFBIQV9IQVNIX1NDQUxFID0gMC4wNTtcblx0ZmxvYXQgaGFzaDJEKCB2ZWMyIHZhbHVlICkge1xuXHRcdHJldHVybiBmcmFjdCggMS4wZTQgKiBzaW4oIDE3LjAgKiB2YWx1ZS54ICsgMC4xICogdmFsdWUueSApICogKCAwLjEgKyBhYnMoIHNpbiggMTMuMCAqIHZhbHVlLnkgKyB2YWx1ZS54ICkgKSApICk7XG5cdH1cblx0ZmxvYXQgaGFzaDNEKCB2ZWMzIHZhbHVlICkge1xuXHRcdHJldHVybiBoYXNoMkQoIHZlYzIoIGhhc2gyRCggdmFsdWUueHkgKSwgdmFsdWUueiApICk7XG5cdH1cblx0ZmxvYXQgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2ZWMzIHBvc2l0aW9uICkge1xuXHRcdGZsb2F0IG1heERlcml2ID0gbWF4KFxuXHRcdFx0bGVuZ3RoKCBkRmR4KCBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0bGVuZ3RoKCBkRmR5KCBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBwaXhTY2FsZSA9IDEuMCAvICggQUxQSEFfSEFTSF9TQ0FMRSAqIG1heERlcml2ICk7XG5cdFx0dmVjMiBwaXhTY2FsZXMgPSB2ZWMyKFxuXHRcdFx0ZXhwMiggZmxvb3IoIGxvZzIoIHBpeFNjYWxlICkgKSApLFxuXHRcdFx0ZXhwMiggY2VpbCggbG9nMiggcGl4U2NhbGUgKSApIClcblx0XHQpO1xuXHRcdHZlYzIgYWxwaGEgPSB2ZWMyKFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnggKiBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnkgKiBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBsZXJwRmFjdG9yID0gZnJhY3QoIGxvZzIoIHBpeFNjYWxlICkgKTtcblx0XHRmbG9hdCB4ID0gKCAxLjAgLSBsZXJwRmFjdG9yICkgKiBhbHBoYS54ICsgbGVycEZhY3RvciAqIGFscGhhLnk7XG5cdFx0ZmxvYXQgYSA9IG1pbiggbGVycEZhY3RvciwgMS4wIC0gbGVycEZhY3RvciApO1xuXHRcdHZlYzMgY2FzZXMgPSB2ZWMzKFxuXHRcdFx0eCAqIHggLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApLFxuXHRcdFx0KCB4IC0gMC41ICogYSApIC8gKCAxLjAgLSBhICksXG5cdFx0XHQxLjAgLSAoICggMS4wIC0geCApICogKCAxLjAgLSB4ICkgLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApIClcblx0XHQpO1xuXHRcdGZsb2F0IHRocmVzaG9sZCA9ICggeCA8ICggMS4wIC0gYSApIClcblx0XHRcdD8gKCAoIHggPCBhICkgPyBjYXNlcy54IDogY2FzZXMueSApXG5cdFx0XHQ6IGNhc2VzLno7XG5cdFx0cmV0dXJuIGNsYW1wKCB0aHJlc2hvbGQgLCAxLjBlLTYsIDEuMCApO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBhbHBoYW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBTUFQXG5cdGRpZmZ1c2VDb2xvci5hICo9IHRleHR1cmUyRCggYWxwaGFNYXAsIHZBbHBoYU1hcFV2ICkuZztcbiNlbmRpZiI7CgoJdmFyIGFscGhhbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgoJdmFyIGFscGhhdGVzdF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHQjaWZkZWYgQUxQSEFfVE9fQ09WRVJBR0Vcblx0ZGlmZnVzZUNvbG9yLmEgPSBzbW9vdGhzdGVwKCBhbHBoYVRlc3QsIGFscGhhVGVzdCArIGZ3aWR0aCggZGlmZnVzZUNvbG9yLmEgKSwgZGlmZnVzZUNvbG9yLmEgKTtcblx0aWYgKCBkaWZmdXNlQ29sb3IuYSA9PSAwLjAgKSBkaXNjYXJkO1xuXHQjZWxzZVxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgYWxwaGFUZXN0ICkgZGlzY2FyZDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBhbHBoYXRlc3RfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHR1bmlmb3JtIGZsb2F0IGFscGhhVGVzdDtcbiNlbmRpZiI7CgoJdmFyIGFvbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQU9NQVBcblx0ZmxvYXQgYW1iaWVudE9jY2x1c2lvbiA9ICggdGV4dHVyZTJEKCBhb01hcCwgdkFvTWFwVXYgKS5yIC0gMS4wICkgKiBhb01hcEludGVuc2l0eSArIDEuMDtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGFtYmllbnRPY2NsdXNpb247XG5cdCNpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUICkgXG5cdFx0Y2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9TSEVFTiApIFxuXHRcdHNoZWVuU3BlY3VsYXJJbmRpcmVjdCAqPSBhbWJpZW50T2NjbHVzaW9uO1xuXHQjZW5kaWZcblx0I2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSAmJiBkZWZpbmVkKCBTVEFOREFSRCApXG5cdFx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyICkgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyICo9IGNvbXB1dGVTcGVjdWxhck9jY2x1c2lvbiggZG90TlYsIGFtYmllbnRPY2NsdXNpb24sIG1hdGVyaWFsLnJvdWdobmVzcyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGFvbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhb01hcDtcblx0dW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7CgoJdmFyIGJhdGNoaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0I2lmICEgZGVmaW5lZCggR0xfQU5HTEVfbXVsdGlfZHJhdyApXG5cdCNkZWZpbmUgZ2xfRHJhd0lEIF9nbF9EcmF3SURcblx0dW5pZm9ybSBpbnQgX2dsX0RyYXdJRDtcblx0I2VuZGlmXG5cdHVuaWZvcm0gaGlnaHAgc2FtcGxlcjJEIGJhdGNoaW5nVGV4dHVyZTtcblx0dW5pZm9ybSBoaWdocCB1c2FtcGxlcjJEIGJhdGNoaW5nSWRUZXh0dXJlO1xuXHRtYXQ0IGdldEJhdGNoaW5nTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKTtcblx0XHR2ZWM0IHYyID0gdGV4ZWxGZXRjaCggYmF0Y2hpbmdUZXh0dXJlLCBpdmVjMiggeCArIDEsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjMgPSB0ZXhlbEZldGNoKCBiYXRjaGluZ1RleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJhdGNoaW5nVGV4dHVyZSwgaXZlYzIoIHggKyAzLCB5ICksIDAgKTtcblx0XHRyZXR1cm4gbWF0NCggdjEsIHYyLCB2MywgdjQgKTtcblx0fVxuXHRmbG9hdCBnZXRJbmRpcmVjdEluZGV4KCBjb25zdCBpbiBpbnQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBiYXRjaGluZ0lkVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IHggPSBpICUgc2l6ZTtcblx0XHRpbnQgeSA9IGkgLyBzaXplO1xuXHRcdHJldHVybiBmbG9hdCggdGV4ZWxGZXRjaCggYmF0Y2hpbmdJZFRleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKS5yICk7XG5cdH1cbiNlbmRpZlxuI2lmZGVmIFVTRV9CQVRDSElOR19DT0xPUlxuXHR1bmlmb3JtIHNhbXBsZXIyRCBiYXRjaGluZ0NvbG9yVGV4dHVyZTtcblx0dmVjMyBnZXRCYXRjaGluZ0NvbG9yKCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGludCBzaXplID0gdGV4dHVyZVNpemUoIGJhdGNoaW5nQ29sb3JUZXh0dXJlLCAwICkueDtcblx0XHRpbnQgaiA9IGludCggaSApO1xuXHRcdGludCB4ID0gaiAlIHNpemU7XG5cdFx0aW50IHkgPSBqIC8gc2l6ZTtcblx0XHRyZXR1cm4gdGV4ZWxGZXRjaCggYmF0Y2hpbmdDb2xvclRleHR1cmUsIGl2ZWMyKCB4LCB5ICksIDAgKS5yZ2I7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGJhdGNoaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0JBVENISU5HXG5cdG1hdDQgYmF0Y2hpbmdNYXRyaXggPSBnZXRCYXRjaGluZ01hdHJpeCggZ2V0SW5kaXJlY3RJbmRleCggZ2xfRHJhd0lEICkgKTtcbiNlbmRpZiI7CgoJdmFyIGJlZ2luX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkID0gdmVjMyggcG9zaXRpb24gKTtcbiNpZmRlZiBVU0VfQUxQSEFIQVNIXG5cdHZQb3NpdGlvbiA9IHZlYzMoIHBvc2l0aW9uICk7XG4jZW5kaWYiOwoKCXZhciBiZWdpbm5vcm1hbF92ZXJ0ZXggPSAidmVjMyBvYmplY3ROb3JtYWwgPSB2ZWMzKCBub3JtYWwgKTtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIG9iamVjdFRhbmdlbnQgPSB2ZWMzKCB0YW5nZW50Lnh5eiApO1xuI2VuZGlmIjsKCgl2YXIgYnNkZnMgPSAiZmxvYXQgR19CbGlublBob25nX0ltcGxpY2l0KCApIHtcblx0cmV0dXJuIDAuMjU7XG59XG5mbG9hdCBEX0JsaW5uUGhvbmcoIGNvbnN0IGluIGZsb2F0IHNoaW5pbmVzcywgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogKCBzaGluaW5lc3MgKiAwLjUgKyAxLjAgKSAqIHBvdyggZG90TkgsIHNoaW5pbmVzcyApO1xufVxudmVjMyBCUkRGX0JsaW5uUGhvbmcoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzICkge1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggc3BlY3VsYXJDb2xvciwgMS4wLCBkb3RWSCApO1xuXHRmbG9hdCBHID0gR19CbGlublBob25nX0ltcGxpY2l0KCApO1xuXHRmbG9hdCBEID0gRF9CbGlublBob25nKCBzaGluaW5lc3MsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKCXZhciBpcmlkZXNjZW5jZV9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdGNvbnN0IG1hdDMgWFlaX1RPX1JFQzcwOSA9IG1hdDMoXG5cdFx0IDMuMjQwNDU0MiwgLTAuOTY5MjY2MCwgIDAuMDU1NjQzNCxcblx0XHQtMS41MzcxMzg1LCAgMS44NzYwMTA4LCAtMC4yMDQwMjU5LFxuXHRcdC0wLjQ5ODUzMTQsICAwLjA0MTU1NjAsICAxLjA1NzIyNTJcblx0KTtcblx0dmVjMyBGcmVzbmVsMFRvSW9yKCB2ZWMzIGZyZXNuZWwwICkge1xuXHRcdHZlYzMgc3FydEYwID0gc3FydCggZnJlc25lbDAgKTtcblx0XHRyZXR1cm4gKCB2ZWMzKCAxLjAgKSArIHNxcnRGMCApIC8gKCB2ZWMzKCAxLjAgKSAtIHNxcnRGMCApO1xuXHR9XG5cdHZlYzMgSW9yVG9GcmVzbmVsMCggdmVjMyB0cmFuc21pdHRlZElvciwgZmxvYXQgaW5jaWRlbnRJb3IgKSB7XG5cdFx0cmV0dXJuIHBvdzIoICggdHJhbnNtaXR0ZWRJb3IgLSB2ZWMzKCBpbmNpZGVudElvciApICkgLyAoIHRyYW5zbWl0dGVkSW9yICsgdmVjMyggaW5jaWRlbnRJb3IgKSApICk7XG5cdH1cblx0ZmxvYXQgSW9yVG9GcmVzbmVsMCggZmxvYXQgdHJhbnNtaXR0ZWRJb3IsIGZsb2F0IGluY2lkZW50SW9yICkge1xuXHRcdHJldHVybiBwb3cyKCAoIHRyYW5zbWl0dGVkSW9yIC0gaW5jaWRlbnRJb3IgKSAvICggdHJhbnNtaXR0ZWRJb3IgKyBpbmNpZGVudElvciApKTtcblx0fVxuXHR2ZWMzIGV2YWxTZW5zaXRpdml0eSggZmxvYXQgT1BELCB2ZWMzIHNoaWZ0ICkge1xuXHRcdGZsb2F0IHBoYXNlID0gMi4wICogUEkgKiBPUEQgKiAxLjBlLTk7XG5cdFx0dmVjMyB2YWwgPSB2ZWMzKCA1LjQ4NTZlLTEzLCA0LjQyMDFlLTEzLCA1LjI0ODFlLTEzICk7XG5cdFx0dmVjMyBwb3MgPSB2ZWMzKCAxLjY4MTBlKzA2LCAxLjc5NTNlKzA2LCAyLjIwODRlKzA2ICk7XG5cdFx0dmVjMyB2YXIgPSB2ZWMzKCA0LjMyNzhlKzA5LCA5LjMwNDZlKzA5LCA2LjYxMjFlKzA5ICk7XG5cdFx0dmVjMyB4eXogPSB2YWwgKiBzcXJ0KCAyLjAgKiBQSSAqIHZhciApICogY29zKCBwb3MgKiBwaGFzZSArIHNoaWZ0ICkgKiBleHAoIC0gcG93MiggcGhhc2UgKSAqIHZhciApO1xuXHRcdHh5ei54ICs9IDkuNzQ3MGUtMTQgKiBzcXJ0KCAyLjAgKiBQSSAqIDQuNTI4MmUrMDkgKSAqIGNvcyggMi4yMzk5ZSswNiAqIHBoYXNlICsgc2hpZnRbIDAgXSApICogZXhwKCAtIDQuNTI4MmUrMDkgKiBwb3cyKCBwaGFzZSApICk7XG5cdFx0eHl6IC89IDEuMDY4NWUtNztcblx0XHR2ZWMzIHJnYiA9IFhZWl9UT19SRUM3MDkgKiB4eXo7XG5cdFx0cmV0dXJuIHJnYjtcblx0fVxuXHR2ZWMzIGV2YWxJcmlkZXNjZW5jZSggZmxvYXQgb3V0c2lkZUlPUiwgZmxvYXQgZXRhMiwgZmxvYXQgY29zVGhldGExLCBmbG9hdCB0aGluRmlsbVRoaWNrbmVzcywgdmVjMyBiYXNlRjAgKSB7XG5cdFx0dmVjMyBJO1xuXHRcdGZsb2F0IGlyaWRlc2NlbmNlSU9SID0gbWl4KCBvdXRzaWRlSU9SLCBldGEyLCBzbW9vdGhzdGVwKCAwLjAsIDAuMDMsIHRoaW5GaWxtVGhpY2tuZXNzICkgKTtcblx0XHRmbG9hdCBzaW5UaGV0YTJTcSA9IHBvdzIoIG91dHNpZGVJT1IgLyBpcmlkZXNjZW5jZUlPUiApICogKCAxLjAgLSBwb3cyKCBjb3NUaGV0YTEgKSApO1xuXHRcdGZsb2F0IGNvc1RoZXRhMlNxID0gMS4wIC0gc2luVGhldGEyU3E7XG5cdFx0aWYgKCBjb3NUaGV0YTJTcSA8IDAuMCApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9XG5cdFx0ZmxvYXQgY29zVGhldGEyID0gc3FydCggY29zVGhldGEyU3EgKTtcblx0XHRmbG9hdCBSMCA9IElvclRvRnJlc25lbDAoIGlyaWRlc2NlbmNlSU9SLCBvdXRzaWRlSU9SICk7XG5cdFx0ZmxvYXQgUjEyID0gRl9TY2hsaWNrKCBSMCwgMS4wLCBjb3NUaGV0YTEgKTtcblx0XHRmbG9hdCBUMTIxID0gMS4wIC0gUjEyO1xuXHRcdGZsb2F0IHBoaTEyID0gMC4wO1xuXHRcdGlmICggaXJpZGVzY2VuY2VJT1IgPCBvdXRzaWRlSU9SICkgcGhpMTIgPSBQSTtcblx0XHRmbG9hdCBwaGkyMSA9IFBJIC0gcGhpMTI7XG5cdFx0dmVjMyBiYXNlSU9SID0gRnJlc25lbDBUb0lvciggY2xhbXAoIGJhc2VGMCwgMC4wLCAwLjk5OTkgKSApO1x0XHR2ZWMzIFIxID0gSW9yVG9GcmVzbmVsMCggYmFzZUlPUiwgaXJpZGVzY2VuY2VJT1IgKTtcblx0XHR2ZWMzIFIyMyA9IEZfU2NobGljayggUjEsIDEuMCwgY29zVGhldGEyICk7XG5cdFx0dmVjMyBwaGkyMyA9IHZlYzMoIDAuMCApO1xuXHRcdGlmICggYmFzZUlPUlsgMCBdIDwgaXJpZGVzY2VuY2VJT1IgKSBwaGkyM1sgMCBdID0gUEk7XG5cdFx0aWYgKCBiYXNlSU9SWyAxIF0gPCBpcmlkZXNjZW5jZUlPUiApIHBoaTIzWyAxIF0gPSBQSTtcblx0XHRpZiAoIGJhc2VJT1JbIDIgXSA8IGlyaWRlc2NlbmNlSU9SICkgcGhpMjNbIDIgXSA9IFBJO1xuXHRcdGZsb2F0IE9QRCA9IDIuMCAqIGlyaWRlc2NlbmNlSU9SICogdGhpbkZpbG1UaGlja25lc3MgKiBjb3NUaGV0YTI7XG5cdFx0dmVjMyBwaGkgPSB2ZWMzKCBwaGkyMSApICsgcGhpMjM7XG5cdFx0dmVjMyBSMTIzID0gY2xhbXAoIFIxMiAqIFIyMywgMWUtNSwgMC45OTk5ICk7XG5cdFx0dmVjMyByMTIzID0gc3FydCggUjEyMyApO1xuXHRcdHZlYzMgUnMgPSBwb3cyKCBUMTIxICkgKiBSMjMgLyAoIHZlYzMoIDEuMCApIC0gUjEyMyApO1xuXHRcdHZlYzMgQzAgPSBSMTIgKyBScztcblx0XHRJID0gQzA7XG5cdFx0dmVjMyBDbSA9IFJzIC0gVDEyMTtcblx0XHRmb3IgKCBpbnQgbSA9IDE7IG0gPD0gMjsgKysgbSApIHtcblx0XHRcdENtICo9IHIxMjM7XG5cdFx0XHR2ZWMzIFNtID0gMi4wICogZXZhbFNlbnNpdGl2aXR5KCBmbG9hdCggbSApICogT1BELCBmbG9hdCggbSApICogcGhpICk7XG5cdFx0XHRJICs9IENtICogU207XG5cdFx0fVxuXHRcdHJldHVybiBtYXgoIEksIHZlYzMoIDAuMCApICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGJ1bXBtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0JVTVBNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgYnVtcE1hcDtcblx0dW5pZm9ybSBmbG9hdCBidW1wU2NhbGU7XG5cdHZlYzIgZEhkeHlfZndkKCkge1xuXHRcdHZlYzIgZFNUZHggPSBkRmR4KCB2QnVtcE1hcFV2ICk7XG5cdFx0dmVjMiBkU1RkeSA9IGRGZHkoIHZCdW1wTWFwVXYgKTtcblx0XHRmbG9hdCBIbGwgPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKS54O1xuXHRcdGZsb2F0IGRCeCA9IGJ1bXBTY2FsZSAqIHRleHR1cmUyRCggYnVtcE1hcCwgdkJ1bXBNYXBVdiArIGRTVGR4ICkueCAtIEhsbDtcblx0XHRmbG9hdCBkQnkgPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKyBkU1RkeSApLnggLSBIbGw7XG5cdFx0cmV0dXJuIHZlYzIoIGRCeCwgZEJ5ICk7XG5cdH1cblx0dmVjMyBwZXJ0dXJiTm9ybWFsQXJiKCB2ZWMzIHN1cmZfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiBkSGR4eSwgZmxvYXQgZmFjZURpcmVjdGlvbiApIHtcblx0XHR2ZWMzIHZTaWdtYVggPSBub3JtYWxpemUoIGRGZHgoIHN1cmZfcG9zLnh5eiApICk7XG5cdFx0dmVjMyB2U2lnbWFZID0gbm9ybWFsaXplKCBkRmR5KCBzdXJmX3Bvcy54eXogKSApO1xuXHRcdHZlYzMgdk4gPSBzdXJmX25vcm07XG5cdFx0dmVjMyBSMSA9IGNyb3NzKCB2U2lnbWFZLCB2TiApO1xuXHRcdHZlYzMgUjIgPSBjcm9zcyggdk4sIHZTaWdtYVggKTtcblx0XHRmbG9hdCBmRGV0ID0gZG90KCB2U2lnbWFYLCBSMSApICogZmFjZURpcmVjdGlvbjtcblx0XHR2ZWMzIHZHcmFkID0gc2lnbiggZkRldCApICogKCBkSGR4eS54ICogUjEgKyBkSGR4eS55ICogUjIgKTtcblx0XHRyZXR1cm4gbm9ybWFsaXplKCBhYnMoIGZEZXQgKSAqIHN1cmZfbm9ybSAtIHZHcmFkICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dmVjNCBwbGFuZTtcblx0I2lmZGVmIEFMUEhBX1RPX0NPVkVSQUdFXG5cdFx0ZmxvYXQgZGlzdGFuY2VUb1BsYW5lLCBkaXN0YW5jZUdyYWRpZW50O1xuXHRcdGZsb2F0IGNsaXBPcGFjaXR5ID0gMS4wO1xuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBVTklPTl9DTElQUElOR19QTEFORVM7IGkgKysgKSB7XG5cdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRkaXN0YW5jZVRvUGxhbmUgPSAtIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgKyBwbGFuZS53O1xuXHRcdFx0ZGlzdGFuY2VHcmFkaWVudCA9IGZ3aWR0aCggZGlzdGFuY2VUb1BsYW5lICkgLyAyLjA7XG5cdFx0XHRjbGlwT3BhY2l0eSAqPSBzbW9vdGhzdGVwKCAtIGRpc3RhbmNlR3JhZGllbnQsIGRpc3RhbmNlR3JhZGllbnQsIGRpc3RhbmNlVG9QbGFuZSApO1xuXHRcdFx0aWYgKCBjbGlwT3BhY2l0eSA9PSAwLjAgKSBkaXNjYXJkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0XHRmbG9hdCB1bmlvbkNsaXBPcGFjaXR5ID0gMS4wO1xuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRcdGRpc3RhbmNlVG9QbGFuZSA9IC0gZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSArIHBsYW5lLnc7XG5cdFx0XHRcdGRpc3RhbmNlR3JhZGllbnQgPSBmd2lkdGgoIGRpc3RhbmNlVG9QbGFuZSApIC8gMi4wO1xuXHRcdFx0XHR1bmlvbkNsaXBPcGFjaXR5ICo9IDEuMCAtIHNtb290aHN0ZXAoIC0gZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VHcmFkaWVudCwgZGlzdGFuY2VUb1BsYW5lICk7XG5cdFx0XHR9XG5cdFx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdFx0Y2xpcE9wYWNpdHkgKj0gMS4wIC0gdW5pb25DbGlwT3BhY2l0eTtcblx0XHQjZW5kaWZcblx0XHRkaWZmdXNlQ29sb3IuYSAqPSBjbGlwT3BhY2l0eTtcblx0XHRpZiAoIGRpZmZ1c2VDb2xvci5hID09IDAuMCApIGRpc2NhcmQ7XG5cdCNlbHNlXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IFVOSU9OX0NMSVBQSU5HX1BMQU5FUzsgaSArKyApIHtcblx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdGlmICggZG90KCB2Q2xpcFBvc2l0aW9uLCBwbGFuZS54eXogKSA+IHBsYW5lLncgKSBkaXNjYXJkO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHRcdCNpZiBVTklPTl9DTElQUElOR19QTEFORVMgPCBOVU1fQ0xJUFBJTkdfUExBTkVTXG5cdFx0XHRib29sIGNsaXBwZWQgPSB0cnVlO1xuXHRcdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdFx0Zm9yICggaW50IGkgPSBVTklPTl9DTElQUElOR19QTEFORVM7IGkgPCBOVU1fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdFx0XHRwbGFuZSA9IGNsaXBwaW5nUGxhbmVzWyBpIF07XG5cdFx0XHRcdGNsaXBwZWQgPSAoIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgPiBwbGFuZS53ICkgJiYgY2xpcHBlZDtcblx0XHRcdH1cblx0XHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdFx0XHRpZiAoIGNsaXBwZWQgKSBkaXNjYXJkO1xuXHRcdCNlbmRpZlxuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2YXJ5aW5nIHZlYzMgdkNsaXBQb3NpdGlvbjtcblx0dW5pZm9ybSB2ZWM0IGNsaXBwaW5nUGxhbmVzWyBOVU1fQ0xJUFBJTkdfUExBTkVTIF07XG4jZW5kaWYiOwoKCXZhciBjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZhcnlpbmcgdmVjMyB2Q2xpcFBvc2l0aW9uO1xuI2VuZGlmIjsKCgl2YXIgY2xpcHBpbmdfcGxhbmVzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dkNsaXBQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWYiOwoKCXZhciBjb2xvcl9mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0ZGlmZnVzZUNvbG9yICo9IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdGRpZmZ1c2VDb2xvci5yZ2IgKj0gdkNvbG9yO1xuI2VuZGlmIjsKCgl2YXIgY29sb3JfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdHZhcnlpbmcgdmVjMyB2Q29sb3I7XG4jZW5kaWYiOwoKCXZhciBjb2xvcl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SICkgfHwgZGVmaW5lZCggVVNFX0JBVENISU5HX0NPTE9SIClcblx0dmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7CgoJdmFyIGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dkNvbG9yID0gdmVjNCggMS4wICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKSB8fCBkZWZpbmVkKCBVU0VfSU5TVEFOQ0lOR19DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9CQVRDSElOR19DT0xPUiApXG5cdHZDb2xvciA9IHZlYzMoIDEuMCApO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NPTE9SXG5cdHZDb2xvciAqPSBjb2xvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JTlNUQU5DSU5HX0NPTE9SXG5cdHZDb2xvci54eXogKj0gaW5zdGFuY2VDb2xvci54eXo7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdfQ09MT1Jcblx0dmVjMyBiYXRjaGluZ0NvbG9yID0gZ2V0QmF0Y2hpbmdDb2xvciggZ2V0SW5kaXJlY3RJbmRleCggZ2xfRHJhd0lEICkgKTtcblx0dkNvbG9yLnh5eiAqPSBiYXRjaGluZ0NvbG9yLnh5ejtcbiNlbmRpZiI7CgoJdmFyIGNvbW1vbiA9ICIjZGVmaW5lIFBJIDMuMTQxNTkyNjUzNTg5NzkzXG4jZGVmaW5lIFBJMiA2LjI4MzE4NTMwNzE3OTU4NlxuI2RlZmluZSBQSV9IQUxGIDEuNTcwNzk2MzI2Nzk0ODk2NlxuI2RlZmluZSBSRUNJUFJPQ0FMX1BJIDAuMzE4MzA5ODg2MTgzNzkwN1xuI2RlZmluZSBSRUNJUFJPQ0FMX1BJMiAwLjE1OTE1NDk0MzA5MTg5NTM1XG4jZGVmaW5lIEVQU0lMT04gMWUtNlxuI2lmbmRlZiBzYXR1cmF0ZVxuI2RlZmluZSBzYXR1cmF0ZSggYSApIGNsYW1wKCBhLCAwLjAsIDEuMCApXG4jZW5kaWZcbiNkZWZpbmUgd2hpdGVDb21wbGVtZW50KCBhICkgKCAxLjAgLSBzYXR1cmF0ZSggYSApIClcbmZsb2F0IHBvdzIoIGNvbnN0IGluIGZsb2F0IHggKSB7IHJldHVybiB4Kng7IH1cbnZlYzMgcG93MiggY29uc3QgaW4gdmVjMyB4ICkgeyByZXR1cm4geCp4OyB9XG5mbG9hdCBwb3czKCBjb25zdCBpbiBmbG9hdCB4ICkgeyByZXR1cm4geCp4Kng7IH1cbmZsb2F0IHBvdzQoIGNvbnN0IGluIGZsb2F0IHggKSB7IGZsb2F0IHgyID0geCp4OyByZXR1cm4geDIqeDI7IH1cbmZsb2F0IG1heDMoIGNvbnN0IGluIHZlYzMgdiApIHsgcmV0dXJuIG1heCggbWF4KCB2LngsIHYueSApLCB2LnogKTsgfVxuZmxvYXQgYXZlcmFnZSggY29uc3QgaW4gdmVjMyB2ICkgeyByZXR1cm4gZG90KCB2LCB2ZWMzKCAwLjMzMzMzMzMgKSApOyB9XG5oaWdocCBmbG9hdCByYW5kKCBjb25zdCBpbiB2ZWMyIHV2ICkge1xuXHRjb25zdCBoaWdocCBmbG9hdCBhID0gMTIuOTg5OCwgYiA9IDc4LjIzMywgYyA9IDQzNzU4LjU0NTM7XG5cdGhpZ2hwIGZsb2F0IGR0ID0gZG90KCB1di54eSwgdmVjMiggYSxiICkgKSwgc24gPSBtb2QoIGR0LCBQSSApO1xuXHRyZXR1cm4gZnJhY3QoIHNpbiggc24gKSAqIGMgKTtcbn1cbiNpZmRlZiBISUdIX1BSRUNJU0lPTlxuXHRmbG9hdCBwcmVjaXNpb25TYWZlTGVuZ3RoKCB2ZWMzIHYgKSB7IHJldHVybiBsZW5ndGgoIHYgKTsgfVxuI2Vsc2Vcblx0ZmxvYXQgcHJlY2lzaW9uU2FmZUxlbmd0aCggdmVjMyB2ICkge1xuXHRcdGZsb2F0IG1heENvbXBvbmVudCA9IG1heDMoIGFicyggdiApICk7XG5cdFx0cmV0dXJuIGxlbmd0aCggdiAvIG1heENvbXBvbmVudCApICogbWF4Q29tcG9uZW50O1xuXHR9XG4jZW5kaWZcbnN0cnVjdCBJbmNpZGVudExpZ2h0IHtcblx0dmVjMyBjb2xvcjtcblx0dmVjMyBkaXJlY3Rpb247XG5cdGJvb2wgdmlzaWJsZTtcbn07XG5zdHJ1Y3QgUmVmbGVjdGVkTGlnaHQge1xuXHR2ZWMzIGRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgZGlyZWN0U3BlY3VsYXI7XG5cdHZlYzMgaW5kaXJlY3REaWZmdXNlO1xuXHR2ZWMzIGluZGlyZWN0U3BlY3VsYXI7XG59O1xuI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0dmFyeWluZyB2ZWMzIHZQb3NpdGlvbjtcbiNlbmRpZlxudmVjMyB0cmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCBtYXRyaXggKiB2ZWM0KCBkaXIsIDAuMCApICkueHl6ICk7XG59XG52ZWMzIGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIGluIHZlYzMgZGlyLCBpbiBtYXQ0IG1hdHJpeCApIHtcblx0cmV0dXJuIG5vcm1hbGl6ZSggKCB2ZWM0KCBkaXIsIDAuMCApICogbWF0cml4ICkueHl6ICk7XG59XG5tYXQzIHRyYW5zcG9zZU1hdDMoIGNvbnN0IGluIG1hdDMgbSApIHtcblx0bWF0MyB0bXA7XG5cdHRtcFsgMCBdID0gdmVjMyggbVsgMCBdLngsIG1bIDEgXS54LCBtWyAyIF0ueCApO1xuXHR0bXBbIDEgXSA9IHZlYzMoIG1bIDAgXS55LCBtWyAxIF0ueSwgbVsgMiBdLnkgKTtcblx0dG1wWyAyIF0gPSB2ZWMzKCBtWyAwIF0ueiwgbVsgMSBdLnosIG1bIDIgXS56ICk7XG5cdHJldHVybiB0bXA7XG59XG5ib29sIGlzUGVyc3BlY3RpdmVNYXRyaXgoIG1hdDQgbSApIHtcblx0cmV0dXJuIG1bIDIgXVsgMyBdID09IC0gMS4wO1xufVxudmVjMiBlcXVpcmVjdFV2KCBpbiB2ZWMzIGRpciApIHtcblx0ZmxvYXQgdSA9IGF0YW4oIGRpci56LCBkaXIueCApICogUkVDSVBST0NBTF9QSTIgKyAwLjU7XG5cdGZsb2F0IHYgPSBhc2luKCBjbGFtcCggZGlyLnksIC0gMS4wLCAxLjAgKSApICogUkVDSVBST0NBTF9QSSArIDAuNTtcblx0cmV0dXJuIHZlYzIoIHUsIHYgKTtcbn1cbnZlYzMgQlJERl9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvciApIHtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBkaWZmdXNlQ29sb3I7XG59XG52ZWMzIEZfU2NobGljayggY29uc3QgaW4gdmVjMyBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufVxuZmxvYXQgRl9TY2hsaWNrKCBjb25zdCBpbiBmbG9hdCBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKCXZhciBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQgPSAiI2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0I2RlZmluZSBjdWJlVVZfbWluTWlwTGV2ZWwgNC4wXG5cdCNkZWZpbmUgY3ViZVVWX21pblRpbGVTaXplIDE2LjBcblx0ZmxvYXQgZ2V0RmFjZSggdmVjMyBkaXJlY3Rpb24gKSB7XG5cdFx0dmVjMyBhYnNEaXJlY3Rpb24gPSBhYnMoIGRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGZhY2UgPSAtIDEuMDtcblx0XHRpZiAoIGFic0RpcmVjdGlvbi54ID4gYWJzRGlyZWN0aW9uLnogKSB7XG5cdFx0XHRpZiAoIGFic0RpcmVjdGlvbi54ID4gYWJzRGlyZWN0aW9uLnkgKVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnggPiAwLjAgPyAwLjAgOiAzLjA7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKCBhYnNEaXJlY3Rpb24ueiA+IGFic0RpcmVjdGlvbi55IClcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi56ID4gMC4wID8gMi4wIDogNS4wO1xuXHRcdFx0ZWxzZVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnkgPiAwLjAgPyAxLjAgOiA0LjA7XG5cdFx0fVxuXHRcdHJldHVybiBmYWNlO1xuXHR9XG5cdHZlYzIgZ2V0VVYoIHZlYzMgZGlyZWN0aW9uLCBmbG9hdCBmYWNlICkge1xuXHRcdHZlYzIgdXY7XG5cdFx0aWYgKCBmYWNlID09IDAuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggZGlyZWN0aW9uLnosIGRpcmVjdGlvbi55ICkgLyBhYnMoIGRpcmVjdGlvbi54ICk7XG5cdFx0fSBlbHNlIGlmICggZmFjZSA9PSAxLjAgKSB7XG5cdFx0XHR1diA9IHZlYzIoIC0gZGlyZWN0aW9uLngsIC0gZGlyZWN0aW9uLnogKSAvIGFicyggZGlyZWN0aW9uLnkgKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDIuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnggKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDQuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnogKSAvIGFicyggZGlyZWN0aW9uLnkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dXYgPSB2ZWMyKCBkaXJlY3Rpb24ueCwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnogKTtcblx0XHR9XG5cdFx0cmV0dXJuIDAuNSAqICggdXYgKyAxLjAgKTtcblx0fVxuXHR2ZWMzIGJpbGluZWFyQ3ViZVVWKCBzYW1wbGVyMkQgZW52TWFwLCB2ZWMzIGRpcmVjdGlvbiwgZmxvYXQgbWlwSW50ICkge1xuXHRcdGZsb2F0IGZhY2UgPSBnZXRGYWNlKCBkaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBmaWx0ZXJJbnQgPSBtYXgoIGN1YmVVVl9taW5NaXBMZXZlbCAtIG1pcEludCwgMC4wICk7XG5cdFx0bWlwSW50ID0gbWF4KCBtaXBJbnQsIGN1YmVVVl9taW5NaXBMZXZlbCApO1xuXHRcdGZsb2F0IGZhY2VTaXplID0gZXhwMiggbWlwSW50ICk7XG5cdFx0aGlnaHAgdmVjMiB1diA9IGdldFVWKCBkaXJlY3Rpb24sIGZhY2UgKSAqICggZmFjZVNpemUgLSAyLjAgKSArIDEuMDtcblx0XHRpZiAoIGZhY2UgPiAyLjAgKSB7XG5cdFx0XHR1di55ICs9IGZhY2VTaXplO1xuXHRcdFx0ZmFjZSAtPSAzLjA7XG5cdFx0fVxuXHRcdHV2LnggKz0gZmFjZSAqIGZhY2VTaXplO1xuXHRcdHV2LnggKz0gZmlsdGVySW50ICogMy4wICogY3ViZVVWX21pblRpbGVTaXplO1xuXHRcdHV2LnkgKz0gNC4wICogKCBleHAyKCBDVUJFVVZfTUFYX01JUCApIC0gZmFjZVNpemUgKTtcblx0XHR1di54ICo9IENVQkVVVl9URVhFTF9XSURUSDtcblx0XHR1di55ICo9IENVQkVVVl9URVhFTF9IRUlHSFQ7XG5cdFx0I2lmZGVmIHRleHR1cmUyREdyYWRFWFRcblx0XHRcdHJldHVybiB0ZXh0dXJlMkRHcmFkRVhUKCBlbnZNYXAsIHV2LCB2ZWMyKCAwLjAgKSwgdmVjMiggMC4wICkgKS5yZ2I7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB0ZXh0dXJlMkQoIGVudk1hcCwgdXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdH1cblx0I2RlZmluZSBjdWJlVVZfcjAgMS4wXG5cdCNkZWZpbmUgY3ViZVVWX20wIC0gMi4wXG5cdCNkZWZpbmUgY3ViZVVWX3IxIDAuOFxuXHQjZGVmaW5lIGN1YmVVVl9tMSAtIDEuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNCAwLjRcblx0I2RlZmluZSBjdWJlVVZfbTQgMi4wXG5cdCNkZWZpbmUgY3ViZVVWX3I1IDAuMzA1XG5cdCNkZWZpbmUgY3ViZVVWX201IDMuMFxuXHQjZGVmaW5lIGN1YmVVVl9yNiAwLjIxXG5cdCNkZWZpbmUgY3ViZVVWX202IDQuMFxuXHRmbG9hdCByb3VnaG5lc3NUb01pcCggZmxvYXQgcm91Z2huZXNzICkge1xuXHRcdGZsb2F0IG1pcCA9IDAuMDtcblx0XHRpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjEgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yMCAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTEgLSBjdWJlVVZfbTAgKSAvICggY3ViZVVWX3IwIC0gY3ViZVVWX3IxICkgKyBjdWJlVVZfbTA7XG5cdFx0fSBlbHNlIGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yNCApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3IxIC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tNCAtIGN1YmVVVl9tMSApIC8gKCBjdWJlVVZfcjEgLSBjdWJlVVZfcjQgKSArIGN1YmVVVl9tMTtcblx0XHR9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3I1ICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjQgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX201IC0gY3ViZVVWX200ICkgLyAoIGN1YmVVVl9yNCAtIGN1YmVVVl9yNSApICsgY3ViZVVWX200O1xuXHRcdH0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjYgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yNSAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTYgLSBjdWJlVVZfbTUgKSAvICggY3ViZVVWX3I1IC0gY3ViZVVWX3I2ICkgKyBjdWJlVVZfbTU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1pcCA9IC0gMi4wICogbG9nMiggMS4xNiAqIHJvdWdobmVzcyApO1x0XHR9XG5cdFx0cmV0dXJuIG1pcDtcblx0fVxuXHR2ZWM0IHRleHR1cmVDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgc2FtcGxlRGlyLCBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0ZmxvYXQgbWlwID0gY2xhbXAoIHJvdWdobmVzc1RvTWlwKCByb3VnaG5lc3MgKSwgY3ViZVVWX20wLCBDVUJFVVZfTUFYX01JUCApO1xuXHRcdGZsb2F0IG1pcEYgPSBmcmFjdCggbWlwICk7XG5cdFx0ZmxvYXQgbWlwSW50ID0gZmxvb3IoIG1pcCApO1xuXHRcdHZlYzMgY29sb3IwID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKTtcblx0XHRpZiAoIG1pcEYgPT0gMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzQoIGNvbG9yMCwgMS4wICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZlYzMgY29sb3IxID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKyAxLjAgKTtcblx0XHRcdHJldHVybiB2ZWM0KCBtaXgoIGNvbG9yMCwgY29sb3IxLCBtaXBGICksIDEuMCApO1xuXHRcdH1cblx0fVxuI2VuZGlmIjsKCgl2YXIgZGVmYXVsdG5vcm1hbF92ZXJ0ZXggPSAidmVjMyB0cmFuc2Zvcm1lZE5vcm1hbCA9IG9iamVjdE5vcm1hbDtcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIHRyYW5zZm9ybWVkVGFuZ2VudCA9IG9iamVjdFRhbmdlbnQ7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQkFUQ0hJTkdcblx0bWF0MyBibSA9IG1hdDMoIGJhdGNoaW5nTWF0cml4ICk7XG5cdHRyYW5zZm9ybWVkTm9ybWFsIC89IHZlYzMoIGRvdCggYm1bIDAgXSwgYm1bIDAgXSApLCBkb3QoIGJtWyAxIF0sIGJtWyAxIF0gKSwgZG90KCBibVsgMiBdLCBibVsgMiBdICkgKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgPSBibSAqIHRyYW5zZm9ybWVkTm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSBibSAqIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfSU5TVEFOQ0lOR1xuXHRtYXQzIGltID0gbWF0MyggaW5zdGFuY2VNYXRyaXggKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgLz0gdmVjMyggZG90KCBpbVsgMCBdLCBpbVsgMCBdICksIGRvdCggaW1bIDEgXSwgaW1bIDEgXSApLCBkb3QoIGltWyAyIF0sIGltWyAyIF0gKSApO1xuXHR0cmFuc2Zvcm1lZE5vcm1hbCA9IGltICogdHJhbnNmb3JtZWROb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHRyYW5zZm9ybWVkVGFuZ2VudCA9IGltICogdHJhbnNmb3JtZWRUYW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZlxudHJhbnNmb3JtZWROb3JtYWwgPSBub3JtYWxNYXRyaXggKiB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNpZmRlZiBGTElQX1NJREVEXG5cdHRyYW5zZm9ybWVkTm9ybWFsID0gLSB0cmFuc2Zvcm1lZE5vcm1hbDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UQU5HRU5UXG5cdHRyYW5zZm9ybWVkVGFuZ2VudCA9ICggbW9kZWxWaWV3TWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWRUYW5nZW50LCAwLjAgKSApLnh5ejtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHR0cmFuc2Zvcm1lZFRhbmdlbnQgPSAtIHRyYW5zZm9ybWVkVGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZGlzcGxhY2VtZW50TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudFNjYWxlO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudEJpYXM7XG4jZW5kaWYiOwoKCXZhciBkaXNwbGFjZW1lbnRtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHRyYW5zZm9ybWVkICs9IG5vcm1hbGl6ZSggb2JqZWN0Tm9ybWFsICkgKiAoIHRleHR1cmUyRCggZGlzcGxhY2VtZW50TWFwLCB2RGlzcGxhY2VtZW50TWFwVXYgKS54ICogZGlzcGxhY2VtZW50U2NhbGUgKyBkaXNwbGFjZW1lbnRCaWFzICk7XG4jZW5kaWYiOwoKCXZhciBlbWlzc2l2ZW1hcF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHZlYzQgZW1pc3NpdmVDb2xvciA9IHRleHR1cmUyRCggZW1pc3NpdmVNYXAsIHZFbWlzc2l2ZU1hcFV2ICk7XG5cdCNpZmRlZiBERUNPREVfVklERU9fVEVYVFVSRV9FTUlTU0lWRVxuXHRcdGVtaXNzaXZlQ29sb3IgPSBzUkdCVHJhbnNmZXJFT1RGKCBlbWlzc2l2ZUNvbG9yICk7XG5cdCNlbmRpZlxuXHR0b3RhbEVtaXNzaXZlUmFkaWFuY2UgKj0gZW1pc3NpdmVDb2xvci5yZ2I7XG4jZW5kaWYiOwoKCXZhciBlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZW1pc3NpdmVNYXA7XG4jZW5kaWYiOwoKCXZhciBjb2xvcnNwYWNlX2ZyYWdtZW50ID0gImdsX0ZyYWdDb2xvciA9IGxpbmVhclRvT3V0cHV0VGV4ZWwoIGdsX0ZyYWdDb2xvciApOyI7CgoJdmFyIGNvbG9yc3BhY2VfcGFyc19mcmFnbWVudCA9ICJ2ZWM0IExpbmVhclRyYW5zZmVyT0VURiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZhbHVlO1xufVxudmVjNCBzUkdCVHJhbnNmZXJFT1RGKCBpbiB2ZWM0IHZhbHVlICkge1xuXHRyZXR1cm4gdmVjNCggbWl4KCBwb3coIHZhbHVlLnJnYiAqIDAuOTQ3ODY3Mjk4NiArIHZlYzMoIDAuMDUyMTMyNzAxNCApLCB2ZWMzKCAyLjQgKSApLCB2YWx1ZS5yZ2IgKiAwLjA3NzM5OTM4MDgsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wNDA0NSApICkgKSApLCB2YWx1ZS5hICk7XG59XG52ZWM0IHNSR0JUcmFuc2Zlck9FVEYoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCBtaXgoIHBvdyggdmFsdWUucmdiLCB2ZWMzKCAwLjQxNjY2ICkgKSAqIDEuMDU1IC0gdmVjMyggMC4wNTUgKSwgdmFsdWUucmdiICogMTIuOTIsIHZlYzMoIGxlc3NUaGFuRXF1YWwoIHZhbHVlLnJnYiwgdmVjMyggMC4wMDMxMzA4ICkgKSApICksIHZhbHVlLmEgKTtcbn0iOwoKCXZhciBlbnZtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdHZlYzMgY2FtZXJhVG9GcmFnO1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZlYzMoIC0gdmlld01hdHJpeFsgMCBdWyAyIF0sIC0gdmlld01hdHJpeFsgMSBdWyAyIF0sIC0gdmlld01hdHJpeFsgMiBdWyAyIF0gKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRjYW1lcmFUb0ZyYWcgPSBub3JtYWxpemUoIHZXb3JsZFBvc2l0aW9uIC0gY2FtZXJhUG9zaXRpb24gKTtcblx0XHR9XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZnJhY3QoIGNhbWVyYVRvRnJhZywgd29ybGROb3JtYWwsIHJlZnJhY3Rpb25SYXRpbyApO1xuXHRcdCNlbmRpZlxuXHQjZWxzZVxuXHRcdHZlYzMgcmVmbGVjdFZlYyA9IHZSZWZsZWN0O1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IGVudkNvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiB2ZWMzKCBmbGlwRW52TWFwICogcmVmbGVjdFZlYy54LCByZWZsZWN0VmVjLnl6ICkgKTtcblx0I2Vsc2Vcblx0XHR2ZWM0IGVudkNvbG9yID0gdmVjNCggMC4wICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZXG5cdFx0b3V0Z29pbmdMaWdodCA9IG1peCggb3V0Z29pbmdMaWdodCwgb3V0Z29pbmdMaWdodCAqIGVudkNvbG9yLnh5eiwgc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfTUlYIClcblx0XHRvdXRnb2luZ0xpZ2h0ID0gbWl4KCBvdXRnb2luZ0xpZ2h0LCBlbnZDb2xvci54eXosIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX0JMRU5ESU5HX0FERCApXG5cdFx0b3V0Z29pbmdMaWdodCArPSBlbnZDb2xvci54eXogKiBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IGVudk1hcEludGVuc2l0eTtcblx0dW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwO1xuXHR1bmlmb3JtIG1hdDMgZW52TWFwUm90YXRpb247XG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dW5pZm9ybSBzYW1wbGVyQ3ViZSBlbnZNYXA7XG5cdCNlbHNlXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgZW52TWFwO1xuXHQjZW5kaWZcblx0XG4jZW5kaWYiOwoKCXZhciBlbnZtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHR1bmlmb3JtIGZsb2F0IHJlZmxlY3Rpdml0eTtcblx0I2lmIGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFBIT05HICkgfHwgZGVmaW5lZCggTEFNQkVSVCApXG5cdFx0I2RlZmluZSBFTlZfV09STERQT1Ncblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbHNlXG5cdFx0dmFyeWluZyB2ZWMzIHZSZWZsZWN0O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIGVudm1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggUEhPTkcgKSB8fCBkZWZpbmVkKCBMQU1CRVJUIClcblx0XHQjZGVmaW5lIEVOVl9XT1JMRFBPU1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdFxuXHRcdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcblx0I2Vsc2Vcblx0XHR2YXJ5aW5nIHZlYzMgdlJlZmxlY3Q7XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgZW52bWFwX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcblx0I2Vsc2Vcblx0XHR2ZWMzIGNhbWVyYVRvVmVydGV4O1xuXHRcdGlmICggaXNPcnRob2dyYXBoaWMgKSB7XG5cdFx0XHRjYW1lcmFUb1ZlcnRleCA9IG5vcm1hbGl6ZSggdmVjMyggLSB2aWV3TWF0cml4WyAwIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAxIF1bIDIgXSwgLSB2aWV3TWF0cml4WyAyIF1bIDIgXSApICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB3b3JsZFBvc2l0aW9uLnh5eiAtIGNhbWVyYVBvc2l0aW9uICk7XG5cdFx0fVxuXHRcdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCB0cmFuc2Zvcm1lZE5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdCNpZmRlZiBFTlZNQVBfTU9ERV9SRUZMRUNUSU9OXG5cdFx0XHR2UmVmbGVjdCA9IHJlZmxlY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCApO1xuXHRcdCNlbHNlXG5cdFx0XHR2UmVmbGVjdCA9IHJlZnJhY3QoIGNhbWVyYVRvVmVydGV4LCB3b3JsZE5vcm1hbCwgcmVmcmFjdGlvblJhdGlvICk7XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgZm9nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2Rm9nRGVwdGggPSAtIG12UG9zaXRpb24uejtcbiNlbmRpZiI7CgoJdmFyIGZvZ19wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcbiNlbmRpZiI7CgoJdmFyIGZvZ19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHQjaWZkZWYgRk9HX0VYUDJcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSAxLjAgLSBleHAoIC0gZm9nRGVuc2l0eSAqIGZvZ0RlbnNpdHkgKiB2Rm9nRGVwdGggKiB2Rm9nRGVwdGggKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBmb2dGYWN0b3IgPSBzbW9vdGhzdGVwKCBmb2dOZWFyLCBmb2dGYXIsIHZGb2dEZXB0aCApO1xuXHQjZW5kaWZcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IG1peCggZ2xfRnJhZ0NvbG9yLnJnYiwgZm9nQ29sb3IsIGZvZ0ZhY3RvciApO1xuI2VuZGlmIjsKCgl2YXIgZm9nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9GT0dcblx0dW5pZm9ybSB2ZWMzIGZvZ0NvbG9yO1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcblx0I2lmZGVmIEZPR19FWFAyXG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dEZW5zaXR5O1xuXHQjZWxzZVxuXHRcdHVuaWZvcm0gZmxvYXQgZm9nTmVhcjtcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ0Zhcjtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfR1JBRElFTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZ3JhZGllbnRNYXA7XG4jZW5kaWZcbnZlYzMgZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCB2ZWMzIG5vcm1hbCwgdmVjMyBsaWdodERpcmVjdGlvbiApIHtcblx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgbGlnaHREaXJlY3Rpb24gKTtcblx0dmVjMiBjb29yZCA9IHZlYzIoIGRvdE5MICogMC41ICsgMC41LCAwLjAgKTtcblx0I2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuXHRcdHJldHVybiB2ZWMzKCB0ZXh0dXJlMkQoIGdyYWRpZW50TWFwLCBjb29yZCApLnIgKTtcblx0I2Vsc2Vcblx0XHR2ZWMyIGZ3ID0gZndpZHRoKCBjb29yZCApICogMC41O1xuXHRcdHJldHVybiBtaXgoIHZlYzMoIDAuNyApLCB2ZWMzKCAxLjAgKSwgc21vb3Roc3RlcCggMC43IC0gZncueCwgMC43ICsgZncueCwgY29vcmQueCApICk7XG5cdCNlbmRpZlxufSI7CgoJdmFyIGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBsaWdodE1hcDtcblx0dW5pZm9ybSBmbG9hdCBsaWdodE1hcEludGVuc2l0eTtcbiNlbmRpZiI7CgoJdmFyIGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50ID0gIkxhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwoKCXZhciBsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50ID0gInZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuc3RydWN0IExhbWJlcnRNYXRlcmlhbCB7XG5cdHZlYzMgZGlmZnVzZUNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclN0cmVuZ3RoO1xufTtcbnZvaWQgUkVfRGlyZWN0X0xhbWJlcnQoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0RGlmZnVzZV9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIExhbWJlcnRNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfTGFtYmVydFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX0xhbWJlcnQiOwoKCXZhciBsaWdodHNfcGFyc19iZWdpbiA9ICJ1bmlmb3JtIGJvb2wgcmVjZWl2ZVNoYWRvdztcbnVuaWZvcm0gdmVjMyBhbWJpZW50TGlnaHRDb2xvcjtcbiNpZiBkZWZpbmVkKCBVU0VfTElHSFRfUFJPQkVTIClcblx0dW5pZm9ybSB2ZWMzIGxpZ2h0UHJvYmVbIDkgXTtcbiNlbmRpZlxudmVjMyBzaEdldElycmFkaWFuY2VBdCggaW4gdmVjMyBub3JtYWwsIGluIHZlYzMgc2hDb2VmZmljaWVudHNbIDkgXSApIHtcblx0ZmxvYXQgeCA9IG5vcm1hbC54LCB5ID0gbm9ybWFsLnksIHogPSBub3JtYWwuejtcblx0dmVjMyByZXN1bHQgPSBzaENvZWZmaWNpZW50c1sgMCBdICogMC44ODYyMjc7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMSBdICogMi4wICogMC41MTE2NjQgKiB5O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDIgXSAqIDIuMCAqIDAuNTExNjY0ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyAzIF0gKiAyLjAgKiAwLjUxMTY2NCAqIHg7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNCBdICogMi4wICogMC40MjkwNDMgKiB4ICogeTtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA1IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHkgKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDYgXSAqICggMC43NDMxMjUgKiB6ICogeiAtIDAuMjQ3NzA4ICk7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNyBdICogMi4wICogMC40MjkwNDMgKiB4ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA4IF0gKiAwLjQyOTA0MyAqICggeCAqIHggLSB5ICogeSApO1xuXHRyZXR1cm4gcmVzdWx0O1xufVxudmVjMyBnZXRMaWdodFByb2JlSXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBsaWdodFByb2JlWyA5IF0sIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IHNoR2V0SXJyYWRpYW5jZUF0KCB3b3JsZE5vcm1hbCwgbGlnaHRQcm9iZSApO1xuXHRyZXR1cm4gaXJyYWRpYW5jZTtcbn1cbnZlYzMgZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBhbWJpZW50TGlnaHRDb2xvciApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gYW1iaWVudExpZ2h0Q29sb3I7XG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxuZmxvYXQgZ2V0RGlzdGFuY2VBdHRlbnVhdGlvbiggY29uc3QgaW4gZmxvYXQgbGlnaHREaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgY3V0b2ZmRGlzdGFuY2UsIGNvbnN0IGluIGZsb2F0IGRlY2F5RXhwb25lbnQgKSB7XG5cdGZsb2F0IGRpc3RhbmNlRmFsbG9mZiA9IDEuMCAvIG1heCggcG93KCBsaWdodERpc3RhbmNlLCBkZWNheUV4cG9uZW50ICksIDAuMDEgKTtcblx0aWYgKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCApIHtcblx0XHRkaXN0YW5jZUZhbGxvZmYgKj0gcG93Miggc2F0dXJhdGUoIDEuMCAtIHBvdzQoIGxpZ2h0RGlzdGFuY2UgLyBjdXRvZmZEaXN0YW5jZSApICkgKTtcblx0fVxuXHRyZXR1cm4gZGlzdGFuY2VGYWxsb2ZmO1xufVxuZmxvYXQgZ2V0U3BvdEF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCBjb25lQ29zaW5lLCBjb25zdCBpbiBmbG9hdCBwZW51bWJyYUNvc2luZSwgY29uc3QgaW4gZmxvYXQgYW5nbGVDb3NpbmUgKSB7XG5cdHJldHVybiBzbW9vdGhzdGVwKCBjb25lQ29zaW5lLCBwZW51bWJyYUNvc2luZSwgYW5nbGVDb3NpbmUgKTtcbn1cbiNpZiBOVU1fRElSX0xJR0hUUyA+IDBcblx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdH07XG5cdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0c1sgTlVNX0RJUl9MSUdIVFMgXTtcblx0dm9pZCBnZXREaXJlY3Rpb25hbExpZ2h0SW5mbyggY29uc3QgaW4gRGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0LCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHRsaWdodC5jb2xvciA9IGRpcmVjdGlvbmFsTGlnaHQuY29sb3I7XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gZGlyZWN0aW9uYWxMaWdodC5kaXJlY3Rpb247XG5cdFx0bGlnaHQudmlzaWJsZSA9IHRydWU7XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9QT0lOVF9MSUdIVFMgPiAwXG5cdHN0cnVjdCBQb2ludExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdH07XG5cdHVuaWZvcm0gUG9pbnRMaWdodCBwb2ludExpZ2h0c1sgTlVNX1BPSU5UX0xJR0hUUyBdO1xuXHR2b2lkIGdldFBvaW50TGlnaHRJbmZvKCBjb25zdCBpbiBQb2ludExpZ2h0IHBvaW50TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgb3V0IEluY2lkZW50TGlnaHQgbGlnaHQgKSB7XG5cdFx0dmVjMyBsVmVjdG9yID0gcG9pbnRMaWdodC5wb3NpdGlvbiAtIGdlb21ldHJ5UG9zaXRpb247XG5cdFx0bGlnaHQuZGlyZWN0aW9uID0gbm9ybWFsaXplKCBsVmVjdG9yICk7XG5cdFx0ZmxvYXQgbGlnaHREaXN0YW5jZSA9IGxlbmd0aCggbFZlY3RvciApO1xuXHRcdGxpZ2h0LmNvbG9yID0gcG9pbnRMaWdodC5jb2xvcjtcblx0XHRsaWdodC5jb2xvciAqPSBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBsaWdodERpc3RhbmNlLCBwb2ludExpZ2h0LmRpc3RhbmNlLCBwb2ludExpZ2h0LmRlY2F5ICk7XG5cdFx0bGlnaHQudmlzaWJsZSA9ICggbGlnaHQuY29sb3IgIT0gdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRTID4gMFxuXHRzdHJ1Y3QgU3BvdExpZ2h0IHtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgY29sb3I7XG5cdFx0ZmxvYXQgZGlzdGFuY2U7XG5cdFx0ZmxvYXQgZGVjYXk7XG5cdFx0ZmxvYXQgY29uZUNvcztcblx0XHRmbG9hdCBwZW51bWJyYUNvcztcblx0fTtcblx0dW5pZm9ybSBTcG90TGlnaHQgc3BvdExpZ2h0c1sgTlVNX1NQT1RfTElHSFRTIF07XG5cdHZvaWQgZ2V0U3BvdExpZ2h0SW5mbyggY29uc3QgaW4gU3BvdExpZ2h0IHNwb3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBvdXQgSW5jaWRlbnRMaWdodCBsaWdodCApIHtcblx0XHR2ZWMzIGxWZWN0b3IgPSBzcG90TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdGxpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuXHRcdGZsb2F0IGFuZ2xlQ29zID0gZG90KCBsaWdodC5kaXJlY3Rpb24sIHNwb3RMaWdodC5kaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBzcG90QXR0ZW51YXRpb24gPSBnZXRTcG90QXR0ZW51YXRpb24oIHNwb3RMaWdodC5jb25lQ29zLCBzcG90TGlnaHQucGVudW1icmFDb3MsIGFuZ2xlQ29zICk7XG5cdFx0aWYgKCBzcG90QXR0ZW51YXRpb24gPiAwLjAgKSB7XG5cdFx0XHRmbG9hdCBsaWdodERpc3RhbmNlID0gbGVuZ3RoKCBsVmVjdG9yICk7XG5cdFx0XHRsaWdodC5jb2xvciA9IHNwb3RMaWdodC5jb2xvciAqIHNwb3RBdHRlbnVhdGlvbjtcblx0XHRcdGxpZ2h0LmNvbG9yICo9IGdldERpc3RhbmNlQXR0ZW51YXRpb24oIGxpZ2h0RGlzdGFuY2UsIHNwb3RMaWdodC5kaXN0YW5jZSwgc3BvdExpZ2h0LmRlY2F5ICk7XG5cdFx0XHRsaWdodC52aXNpYmxlID0gKCBsaWdodC5jb2xvciAhPSB2ZWMzKCAwLjAgKSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsaWdodC5jb2xvciA9IHZlYzMoIDAuMCApO1xuXHRcdFx0bGlnaHQudmlzaWJsZSA9IGZhbHNlO1xuXHRcdH1cblx0fVxuI2VuZGlmXG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBSZWN0QXJlYUxpZ2h0IHtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdHZlYzMgcG9zaXRpb247XG5cdFx0dmVjMyBoYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0O1xuXHR9O1xuXHR1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMTtcdHVuaWZvcm0gc2FtcGxlcjJEIGx0Y18yO1xuXHR1bmlmb3JtIFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodHNbIE5VTV9SRUNUX0FSRUFfTElHSFRTIF07XG4jZW5kaWZcbiNpZiBOVU1fSEVNSV9MSUdIVFMgPiAwXG5cdHN0cnVjdCBIZW1pc3BoZXJlTGlnaHQge1xuXHRcdHZlYzMgZGlyZWN0aW9uO1xuXHRcdHZlYzMgc2t5Q29sb3I7XG5cdFx0dmVjMyBncm91bmRDb2xvcjtcblx0fTtcblx0dW5pZm9ybSBIZW1pc3BoZXJlTGlnaHQgaGVtaXNwaGVyZUxpZ2h0c1sgTlVNX0hFTUlfTElHSFRTIF07XG5cdHZlYzMgZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gSGVtaXNwaGVyZUxpZ2h0IGhlbWlMaWdodCwgY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdFx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgaGVtaUxpZ2h0LmRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGhlbWlEaWZmdXNlV2VpZ2h0ID0gMC41ICogZG90TkwgKyAwLjU7XG5cdFx0dmVjMyBpcnJhZGlhbmNlID0gbWl4KCBoZW1pTGlnaHQuZ3JvdW5kQ29sb3IsIGhlbWlMaWdodC5za3lDb2xvciwgaGVtaURpZmZ1c2VXZWlnaHQgKTtcblx0XHRyZXR1cm4gaXJyYWRpYW5jZTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0dmVjMyBnZXRJQkxJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgZW52TWFwUm90YXRpb24gKiB3b3JsZE5vcm1hbCwgMS4wICk7XG5cdFx0XHRyZXR1cm4gUEkgKiBlbnZNYXBDb2xvci5yZ2IgKiBlbnZNYXBJbnRlbnNpdHk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHQjZW5kaWZcblx0fVxuXHR2ZWMzIGdldElCTFJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVfVVZcblx0XHRcdHZlYzMgcmVmbGVjdFZlYyA9IHJlZmxlY3QoIC0gdmlld0Rpciwgbm9ybWFsICk7XG5cdFx0XHRyZWZsZWN0VmVjID0gbm9ybWFsaXplKCBtaXgoIHJlZmxlY3RWZWMsIG5vcm1hbCwgcm91Z2huZXNzICogcm91Z2huZXNzKSApO1xuXHRcdFx0cmVmbGVjdFZlYyA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHJlZmxlY3RWZWMsIHZpZXdNYXRyaXggKTtcblx0XHRcdHZlYzQgZW52TWFwQ29sb3IgPSB0ZXh0dXJlQ3ViZVVWKCBlbnZNYXAsIGVudk1hcFJvdGF0aW9uICogcmVmbGVjdFZlYywgcm91Z2huZXNzICk7XG5cdFx0XHRyZXR1cm4gZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdmVjMyggMC4wICk7XG5cdFx0I2VuZGlmXG5cdH1cblx0I2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdFx0dmVjMyBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgY29uc3QgaW4gdmVjMyBiaXRhbmdlbnQsIGNvbnN0IGluIGZsb2F0IGFuaXNvdHJvcHkgKSB7XG5cdFx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0XHR2ZWMzIGJlbnROb3JtYWwgPSBjcm9zcyggYml0YW5nZW50LCB2aWV3RGlyICk7XG5cdFx0XHRcdGJlbnROb3JtYWwgPSBub3JtYWxpemUoIGNyb3NzKCBiZW50Tm9ybWFsLCBiaXRhbmdlbnQgKSApO1xuXHRcdFx0XHRiZW50Tm9ybWFsID0gbm9ybWFsaXplKCBtaXgoIGJlbnROb3JtYWwsIG5vcm1hbCwgcG93MiggcG93MiggMS4wIC0gYW5pc290cm9weSAqICggMS4wIC0gcm91Z2huZXNzICkgKSApICkgKTtcblx0XHRcdFx0cmV0dXJuIGdldElCTFJhZGlhbmNlKCB2aWV3RGlyLCBiZW50Tm9ybWFsLCByb3VnaG5lc3MgKTtcblx0XHRcdCNlbHNlXG5cdFx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHRcdCNlbmRpZlxuXHRcdH1cblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBsaWdodHNfdG9vbl9mcmFnbWVudCA9ICJUb29uTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiOyI7CgoJdmFyIGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5zdHJ1Y3QgVG9vbk1hdGVyaWFsIHtcblx0dmVjMyBkaWZmdXNlQ29sb3I7XG59O1xudm9pZCBSRV9EaXJlY3RfVG9vbiggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX1Rvb24oIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9Ub29uXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiI7CgoJdmFyIGxpZ2h0c19waG9uZ19mcmFnbWVudCA9ICJCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiO1xubWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IHNwZWN1bGFyO1xubWF0ZXJpYWwuc3BlY3VsYXJTaGluaW5lc3MgPSBzaGluaW5lc3M7XG5tYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoID0gc3BlY3VsYXJTdHJlbmd0aDsiOwoKCXZhciBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBCbGlublBob25nTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0dmVjMyBzcGVjdWxhckNvbG9yO1xuXHRmbG9hdCBzcGVjdWxhclNoaW5pbmVzcztcblx0ZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbn07XG52b2lkIFJFX0RpcmVjdF9CbGlublBob25nKCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogQlJERl9CbGlublBob25nKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IsIG1hdGVyaWFsLnNwZWN1bGFyU2hpbmluZXNzICkgKiBtYXRlcmlhbC5zcGVjdWxhclN0cmVuZ3RoO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZyggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBCbGlublBob25nTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X0JsaW5uUGhvbmdcbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9CbGlublBob25nIjsKCgl2YXIgbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50ID0gIlBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiICogKCAxLjAgLSBtZXRhbG5lc3NGYWN0b3IgKTtcbnZlYzMgZHh5ID0gbWF4KCBhYnMoIGRGZHgoIG5vblBlcnR1cmJlZE5vcm1hbCApICksIGFicyggZEZkeSggbm9uUGVydHVyYmVkTm9ybWFsICkgKSApO1xuZmxvYXQgZ2VvbWV0cnlSb3VnaG5lc3MgPSBtYXgoIG1heCggZHh5LngsIGR4eS55ICksIGR4eS56ICk7XG5tYXRlcmlhbC5yb3VnaG5lc3MgPSBtYXgoIHJvdWdobmVzc0ZhY3RvciwgMC4wNTI1ICk7bWF0ZXJpYWwucm91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xubWF0ZXJpYWwucm91Z2huZXNzID0gbWluKCBtYXRlcmlhbC5yb3VnaG5lc3MsIDEuMCApO1xuI2lmZGVmIElPUlxuXHRtYXRlcmlhbC5pb3IgPSBpb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0XHRmbG9hdCBzcGVjdWxhckludGVuc2l0eUZhY3RvciA9IHNwZWN1bGFySW50ZW5zaXR5O1xuXHRcdHZlYzMgc3BlY3VsYXJDb2xvckZhY3RvciA9IHNwZWN1bGFyQ29sb3I7XG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdFx0c3BlY3VsYXJDb2xvckZhY3RvciAqPSB0ZXh0dXJlMkQoIHNwZWN1bGFyQ29sb3JNYXAsIHZTcGVjdWxhckNvbG9yTWFwVXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHRcdHNwZWN1bGFySW50ZW5zaXR5RmFjdG9yICo9IHRleHR1cmUyRCggc3BlY3VsYXJJbnRlbnNpdHlNYXAsIHZTcGVjdWxhckludGVuc2l0eU1hcFV2ICkuYTtcblx0XHQjZW5kaWZcblx0XHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IG1peCggc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIDEuMCwgbWV0YWxuZXNzRmFjdG9yICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IgPSAxLjA7XG5cdFx0dmVjMyBzcGVjdWxhckNvbG9yRmFjdG9yID0gdmVjMyggMS4wICk7XG5cdFx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCBtaW4oIHBvdzIoICggbWF0ZXJpYWwuaW9yIC0gMS4wICkgLyAoIG1hdGVyaWFsLmlvciArIDEuMCApICkgKiBzcGVjdWxhckNvbG9yRmFjdG9yLCB2ZWMzKCAxLjAgKSApICogc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuI2Vsc2Vcblx0bWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IG1peCggdmVjMyggMC4wNCApLCBkaWZmdXNlQ29sb3IucmdiLCBtZXRhbG5lc3NGYWN0b3IgKTtcblx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IGNsZWFyY29hdDtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gY2xlYXJjb2F0Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRGMCA9IHZlYzMoIDAuMDQgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0RjkwID0gMS4wO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdCAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE1hcCwgdkNsZWFyY29hdE1hcFV2ICkueDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdFJvdWdobmVzc01hcCwgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2ICkueTtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IHNhdHVyYXRlKCBtYXRlcmlhbC5jbGVhcmNvYXQgKTtcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IG1heCggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCAwLjA1MjUgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRElTUEVSU0lPTlxuXHRtYXRlcmlhbC5kaXNwZXJzaW9uID0gZGlzcGVyc2lvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IGlyaWRlc2NlbmNlO1xuXHRtYXRlcmlhbC5pcmlkZXNjZW5jZUlPUiA9IGlyaWRlc2NlbmNlSU9SO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFTUFQXG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgKj0gdGV4dHVyZTJEKCBpcmlkZXNjZW5jZU1hcCwgdklyaWRlc2NlbmNlTWFwVXYgKS5yO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcyA9IChpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0gLSBpcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0pICogdGV4dHVyZTJEKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcCwgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgKS5nICsgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHQjZWxzZVxuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID0gaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHRtYXRlcmlhbC5zaGVlbkNvbG9yID0gc2hlZW5Db2xvcjtcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdG1hdGVyaWFsLnNoZWVuQ29sb3IgKj0gdGV4dHVyZTJEKCBzaGVlbkNvbG9yTWFwLCB2U2hlZW5Db2xvck1hcFV2ICkucmdiO1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgPSBjbGFtcCggc2hlZW5Sb3VnaG5lc3MsIDAuMDcsIDEuMCApO1xuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzICo9IHRleHR1cmUyRCggc2hlZW5Sb3VnaG5lc3NNYXAsIHZTaGVlblJvdWdobmVzc01hcFV2ICkuYTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHRtYXQyIGFuaXNvdHJvcHlNYXQgPSBtYXQyKCBhbmlzb3Ryb3B5VmVjdG9yLngsIGFuaXNvdHJvcHlWZWN0b3IueSwgLSBhbmlzb3Ryb3B5VmVjdG9yLnksIGFuaXNvdHJvcHlWZWN0b3IueCApO1xuXHRcdHZlYzMgYW5pc290cm9weVBvbGFyID0gdGV4dHVyZTJEKCBhbmlzb3Ryb3B5TWFwLCB2QW5pc290cm9weU1hcFV2ICkucmdiO1xuXHRcdHZlYzIgYW5pc290cm9weVYgPSBhbmlzb3Ryb3B5TWF0ICogbm9ybWFsaXplKCAyLjAgKiBhbmlzb3Ryb3B5UG9sYXIucmcgLSB2ZWMyKCAxLjAgKSApICogYW5pc290cm9weVBvbGFyLmI7XG5cdCNlbHNlXG5cdFx0dmVjMiBhbmlzb3Ryb3B5ViA9IGFuaXNvdHJvcHlWZWN0b3I7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5hbmlzb3Ryb3B5ID0gbGVuZ3RoKCBhbmlzb3Ryb3B5ViApO1xuXHRpZiggbWF0ZXJpYWwuYW5pc290cm9weSA9PSAwLjAgKSB7XG5cdFx0YW5pc290cm9weVYgPSB2ZWMyKCAxLjAsIDAuMCApO1xuXHR9IGVsc2Uge1xuXHRcdGFuaXNvdHJvcHlWIC89IG1hdGVyaWFsLmFuaXNvdHJvcHk7XG5cdFx0bWF0ZXJpYWwuYW5pc290cm9weSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICk7XG5cdH1cblx0bWF0ZXJpYWwuYWxwaGFUID0gbWl4KCBwb3cyKCBtYXRlcmlhbC5yb3VnaG5lc3MgKSwgMS4wLCBwb3cyKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICkgKTtcblx0bWF0ZXJpYWwuYW5pc290cm9weVQgPSB0Ym5bIDAgXSAqIGFuaXNvdHJvcHlWLnggKyB0Ym5bIDEgXSAqIGFuaXNvdHJvcHlWLnk7XG5cdG1hdGVyaWFsLmFuaXNvdHJvcHlCID0gdGJuWyAxIF0gKiBhbmlzb3Ryb3B5Vi54IC0gdGJuWyAwIF0gKiBhbmlzb3Ryb3B5Vi55O1xuI2VuZGlmIjsKCgl2YXIgbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAic3RydWN0IFBoeXNpY2FsTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0ZmxvYXQgcm91Z2huZXNzO1xuXHR2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdGZsb2F0IHNwZWN1bGFyRjkwO1xuXHRmbG9hdCBkaXNwZXJzaW9uO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGZsb2F0IGNsZWFyY29hdDtcblx0XHRmbG9hdCBjbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0dmVjMyBjbGVhcmNvYXRGMDtcblx0XHRmbG9hdCBjbGVhcmNvYXRGOTA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2U7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3M7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUZyZXNuZWw7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUYwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHZlYzMgc2hlZW5Db2xvcjtcblx0XHRmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2VuZGlmXG5cdCNpZmRlZiBJT1Jcblx0XHRmbG9hdCBpb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRcdGZsb2F0IHRyYW5zbWlzc2lvbjtcblx0XHRmbG9hdCB0cmFuc21pc3Npb25BbHBoYTtcblx0XHRmbG9hdCB0aGlja25lc3M7XG5cdFx0ZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHR2ZWMzIGF0dGVudWF0aW9uQ29sb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRmbG9hdCBhbmlzb3Ryb3B5O1xuXHRcdGZsb2F0IGFscGhhVDtcblx0XHR2ZWMzIGFuaXNvdHJvcHlUO1xuXHRcdHZlYzMgYW5pc290cm9weUI7XG5cdCNlbmRpZlxufTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXJEaXJlY3QgPSB2ZWMzKCAwLjAgKTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXJJbmRpcmVjdCA9IHZlYzMoIDAuMCApO1xudmVjMyBzaGVlblNwZWN1bGFyRGlyZWN0ID0gdmVjMyggMC4wICk7XG52ZWMzIHNoZWVuU3BlY3VsYXJJbmRpcmVjdCA9IHZlYzMoMC4wICk7XG52ZWMzIFNjaGxpY2tfdG9fRjAoIGNvbnN0IGluIHZlYzMgZiwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcbiAgICBmbG9hdCB4ID0gY2xhbXAoIDEuMCAtIGRvdFZILCAwLjAsIDEuMCApO1xuICAgIGZsb2F0IHgyID0geCAqIHg7XG4gICAgZmxvYXQgeDUgPSBjbGFtcCggeCAqIHgyICogeDIsIDAuMCwgMC45OTk5ICk7XG4gICAgcmV0dXJuICggZiAtIHZlYzMoIGY5MCApICogeDUgKSAvICggMS4wIC0geDUgKTtcbn1cbmZsb2F0IFZfR0dYX1NtaXRoQ29ycmVsYXRlZCggY29uc3QgaW4gZmxvYXQgYWxwaGEsIGNvbnN0IGluIGZsb2F0IGRvdE5MLCBjb25zdCBpbiBmbG9hdCBkb3ROViApIHtcblx0ZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuXHRmbG9hdCBndiA9IGRvdE5MICogc3FydCggYTIgKyAoIDEuMCAtIGEyICkgKiBwb3cyKCBkb3ROViApICk7XG5cdGZsb2F0IGdsID0gZG90TlYgKiBzcXJ0KCBhMiArICggMS4wIC0gYTIgKSAqIHBvdzIoIGRvdE5MICkgKTtcblx0cmV0dXJuIDAuNSAvIG1heCggZ3YgKyBnbCwgRVBTSUxPTiApO1xufVxuZmxvYXQgRF9HR1goIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROSCApIHtcblx0ZmxvYXQgYTIgPSBwb3cyKCBhbHBoYSApO1xuXHRmbG9hdCBkZW5vbSA9IHBvdzIoIGRvdE5IICkgKiAoIGEyIC0gMS4wICkgKyAxLjA7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogYTIgLyBwb3cyKCBkZW5vbSApO1xufVxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdGZsb2F0IFZfR0dYX1NtaXRoQ29ycmVsYXRlZF9Bbmlzb3Ryb3BpYyggY29uc3QgaW4gZmxvYXQgYWxwaGFULCBjb25zdCBpbiBmbG9hdCBhbHBoYUIsIGNvbnN0IGluIGZsb2F0IGRvdFRWLCBjb25zdCBpbiBmbG9hdCBkb3RCViwgY29uc3QgaW4gZmxvYXQgZG90VEwsIGNvbnN0IGluIGZsb2F0IGRvdEJMLCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgZG90TkwgKSB7XG5cdFx0ZmxvYXQgZ3YgPSBkb3ROTCAqIGxlbmd0aCggdmVjMyggYWxwaGFUICogZG90VFYsIGFscGhhQiAqIGRvdEJWLCBkb3ROViApICk7XG5cdFx0ZmxvYXQgZ2wgPSBkb3ROViAqIGxlbmd0aCggdmVjMyggYWxwaGFUICogZG90VEwsIGFscGhhQiAqIGRvdEJMLCBkb3ROTCApICk7XG5cdFx0ZmxvYXQgdiA9IDAuNSAvICggZ3YgKyBnbCApO1xuXHRcdHJldHVybiBzYXR1cmF0ZSh2KTtcblx0fVxuXHRmbG9hdCBEX0dHWF9Bbmlzb3Ryb3BpYyggY29uc3QgaW4gZmxvYXQgYWxwaGFULCBjb25zdCBpbiBmbG9hdCBhbHBoYUIsIGNvbnN0IGluIGZsb2F0IGRvdE5ILCBjb25zdCBpbiBmbG9hdCBkb3RUSCwgY29uc3QgaW4gZmxvYXQgZG90QkggKSB7XG5cdFx0ZmxvYXQgYTIgPSBhbHBoYVQgKiBhbHBoYUI7XG5cdFx0aGlnaHAgdmVjMyB2ID0gdmVjMyggYWxwaGFCICogZG90VEgsIGFscGhhVCAqIGRvdEJILCBhMiAqIGRvdE5IICk7XG5cdFx0aGlnaHAgZmxvYXQgdjIgPSBkb3QoIHYsIHYgKTtcblx0XHRmbG9hdCB3MiA9IGEyIC8gdjI7XG5cdFx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBhMiAqIHBvdzIgKCB3MiApO1xuXHR9XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHZlYzMgQlJERl9HR1hfQ2xlYXJjb2F0KCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsKSB7XG5cdFx0dmVjMyBmMCA9IG1hdGVyaWFsLmNsZWFyY29hdEYwO1xuXHRcdGZsb2F0IGY5MCA9IG1hdGVyaWFsLmNsZWFyY29hdEY5MDtcblx0XHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0XHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRcdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdFx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRcdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0XHRmbG9hdCBkb3RWSCA9IHNhdHVyYXRlKCBkb3QoIHZpZXdEaXIsIGhhbGZEaXIgKSApO1xuXHRcdHZlYzMgRiA9IEZfU2NobGljayggZjAsIGY5MCwgZG90VkggKTtcblx0XHRmbG9hdCBWID0gVl9HR1hfU21pdGhDb3JyZWxhdGVkKCBhbHBoYSwgZG90TkwsIGRvdE5WICk7XG5cdFx0ZmxvYXQgRCA9IERfR0dYKCBhbHBoYSwgZG90TkggKTtcblx0XHRyZXR1cm4gRiAqICggViAqIEQgKTtcblx0fVxuI2VuZGlmXG52ZWMzIEJSREZfR0dYKCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsICkge1xuXHR2ZWMzIGYwID0gbWF0ZXJpYWwuc3BlY3VsYXJDb2xvcjtcblx0ZmxvYXQgZjkwID0gbWF0ZXJpYWwuc3BlY3VsYXJGOTA7XG5cdGZsb2F0IHJvdWdobmVzcyA9IG1hdGVyaWFsLnJvdWdobmVzcztcblx0ZmxvYXQgYWxwaGEgPSBwb3cyKCByb3VnaG5lc3MgKTtcblx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBsaWdodERpciArIHZpZXdEaXIgKTtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGxpZ2h0RGlyICkgKTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggZjAsIGY5MCwgZG90VkggKTtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRcdEYgPSBtaXgoIEYsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRcdGZsb2F0IGRvdFRMID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5VCwgbGlnaHREaXIgKTtcblx0XHRmbG9hdCBkb3RUViA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIHZpZXdEaXIgKTtcblx0XHRmbG9hdCBkb3RUSCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIGhhbGZEaXIgKTtcblx0XHRmbG9hdCBkb3RCTCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weUIsIGxpZ2h0RGlyICk7XG5cdFx0ZmxvYXQgZG90QlYgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCB2aWV3RGlyICk7XG5cdFx0ZmxvYXQgZG90QkggPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCBoYWxmRGlyICk7XG5cdFx0ZmxvYXQgViA9IFZfR0dYX1NtaXRoQ29ycmVsYXRlZF9Bbmlzb3Ryb3BpYyggbWF0ZXJpYWwuYWxwaGFULCBhbHBoYSwgZG90VFYsIGRvdEJWLCBkb3RUTCwgZG90QkwsIGRvdE5WLCBkb3ROTCApO1xuXHRcdGZsb2F0IEQgPSBEX0dHWF9Bbmlzb3Ryb3BpYyggbWF0ZXJpYWwuYWxwaGFULCBhbHBoYSwgZG90TkgsIGRvdFRILCBkb3RCSCApO1xuXHQjZWxzZVxuXHRcdGZsb2F0IFYgPSBWX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGFscGhhLCBkb3ROTCwgZG90TlYgKTtcblx0XHRmbG9hdCBEID0gRF9HR1goIGFscGhhLCBkb3ROSCApO1xuXHQjZW5kaWZcblx0cmV0dXJuIEYgKiAoIFYgKiBEICk7XG59XG52ZWMyIExUQ19VdiggY29uc3QgaW4gdmVjMyBOLCBjb25zdCBpbiB2ZWMzIFYsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0Y29uc3QgZmxvYXQgTFVUX1NJWkUgPSA2NC4wO1xuXHRjb25zdCBmbG9hdCBMVVRfU0NBTEUgPSAoIExVVF9TSVpFIC0gMS4wICkgLyBMVVRfU0laRTtcblx0Y29uc3QgZmxvYXQgTFVUX0JJQVMgPSAwLjUgLyBMVVRfU0laRTtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBOLCBWICkgKTtcblx0dmVjMiB1diA9IHZlYzIoIHJvdWdobmVzcywgc3FydCggMS4wIC0gZG90TlYgKSApO1xuXHR1diA9IHV2ICogTFVUX1NDQUxFICsgTFVUX0JJQVM7XG5cdHJldHVybiB1djtcbn1cbmZsb2F0IExUQ19DbGlwcGVkU3BoZXJlRm9ybUZhY3RvciggY29uc3QgaW4gdmVjMyBmICkge1xuXHRmbG9hdCBsID0gbGVuZ3RoKCBmICk7XG5cdHJldHVybiBtYXgoICggbCAqIGwgKyBmLnogKSAvICggbCArIDEuMCApLCAwLjAgKTtcbn1cbnZlYzMgTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb25zdCBpbiB2ZWMzIHYxLCBjb25zdCBpbiB2ZWMzIHYyICkge1xuXHRmbG9hdCB4ID0gZG90KCB2MSwgdjIgKTtcblx0ZmxvYXQgeSA9IGFicyggeCApO1xuXHRmbG9hdCBhID0gMC44NTQzOTg1ICsgKCAwLjQ5NjUxNTUgKyAwLjAxNDUyMDYgKiB5ICkgKiB5O1xuXHRmbG9hdCBiID0gMy40MTc1OTQwICsgKCA0LjE2MTY3MjQgKyB5ICkgKiB5O1xuXHRmbG9hdCB2ID0gYSAvIGI7XG5cdGZsb2F0IHRoZXRhX3NpbnRoZXRhID0gKCB4ID4gMC4wICkgPyB2IDogMC41ICogaW52ZXJzZXNxcnQoIG1heCggMS4wIC0geCAqIHgsIDFlLTcgKSApIC0gdjtcblx0cmV0dXJuIGNyb3NzKCB2MSwgdjIgKSAqIHRoZXRhX3NpbnRoZXRhO1xufVxudmVjMyBMVENfRXZhbHVhdGUoIGNvbnN0IGluIHZlYzMgTiwgY29uc3QgaW4gdmVjMyBWLCBjb25zdCBpbiB2ZWMzIFAsIGNvbnN0IGluIG1hdDMgbUludiwgY29uc3QgaW4gdmVjMyByZWN0Q29vcmRzWyA0IF0gKSB7XG5cdHZlYzMgdjEgPSByZWN0Q29vcmRzWyAxIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgdjIgPSByZWN0Q29vcmRzWyAzIF0gLSByZWN0Q29vcmRzWyAwIF07XG5cdHZlYzMgbGlnaHROb3JtYWwgPSBjcm9zcyggdjEsIHYyICk7XG5cdGlmKCBkb3QoIGxpZ2h0Tm9ybWFsLCBQIC0gcmVjdENvb3Jkc1sgMCBdICkgPCAwLjAgKSByZXR1cm4gdmVjMyggMC4wICk7XG5cdHZlYzMgVDEsIFQyO1xuXHRUMSA9IG5vcm1hbGl6ZSggViAtIE4gKiBkb3QoIFYsIE4gKSApO1xuXHRUMiA9IC0gY3Jvc3MoIE4sIFQxICk7XG5cdG1hdDMgbWF0ID0gbUludiAqIHRyYW5zcG9zZU1hdDMoIG1hdDMoIFQxLCBUMiwgTiApICk7XG5cdHZlYzMgY29vcmRzWyA0IF07XG5cdGNvb3Jkc1sgMCBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAwIF0gLSBQICk7XG5cdGNvb3Jkc1sgMSBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAxIF0gLSBQICk7XG5cdGNvb3Jkc1sgMiBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAyIF0gLSBQICk7XG5cdGNvb3Jkc1sgMyBdID0gbWF0ICogKCByZWN0Q29vcmRzWyAzIF0gLSBQICk7XG5cdGNvb3Jkc1sgMCBdID0gbm9ybWFsaXplKCBjb29yZHNbIDAgXSApO1xuXHRjb29yZHNbIDEgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAxIF0gKTtcblx0Y29vcmRzWyAyIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMiBdICk7XG5cdGNvb3Jkc1sgMyBdID0gbm9ybWFsaXplKCBjb29yZHNbIDMgXSApO1xuXHR2ZWMzIHZlY3RvckZvcm1GYWN0b3IgPSB2ZWMzKCAwLjAgKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMCBdLCBjb29yZHNbIDEgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAxIF0sIGNvb3Jkc1sgMiBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDIgXSwgY29vcmRzWyAzIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMyBdLCBjb29yZHNbIDAgXSApO1xuXHRmbG9hdCByZXN1bHQgPSBMVENfQ2xpcHBlZFNwaGVyZUZvcm1GYWN0b3IoIHZlY3RvckZvcm1GYWN0b3IgKTtcblx0cmV0dXJuIHZlYzMoIHJlc3VsdCApO1xufVxuI2lmIGRlZmluZWQoIFVTRV9TSEVFTiApXG5mbG9hdCBEX0NoYXJsaWUoIGZsb2F0IHJvdWdobmVzcywgZmxvYXQgZG90TkggKSB7XG5cdGZsb2F0IGFscGhhID0gcG93Miggcm91Z2huZXNzICk7XG5cdGZsb2F0IGludkFscGhhID0gMS4wIC8gYWxwaGE7XG5cdGZsb2F0IGNvczJoID0gZG90TkggKiBkb3ROSDtcblx0ZmxvYXQgc2luMmggPSBtYXgoIDEuMCAtIGNvczJoLCAwLjAwNzgxMjUgKTtcblx0cmV0dXJuICggMi4wICsgaW52QWxwaGEgKSAqIHBvdyggc2luMmgsIGludkFscGhhICogMC41ICkgLyAoIDIuMCAqIFBJICk7XG59XG5mbG9hdCBWX05ldWJlbHQoIGZsb2F0IGRvdE5WLCBmbG9hdCBkb3ROTCApIHtcblx0cmV0dXJuIHNhdHVyYXRlKCAxLjAgLyAoIDQuMCAqICggZG90TkwgKyBkb3ROViAtIGRvdE5MICogZG90TlYgKSApICk7XG59XG52ZWMzIEJSREZfU2hlZW4oIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIHZlYzMgc2hlZW5Db2xvciwgY29uc3QgaW4gZmxvYXQgc2hlZW5Sb3VnaG5lc3MgKSB7XG5cdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRmbG9hdCBEID0gRF9DaGFybGllKCBzaGVlblJvdWdobmVzcywgZG90TkggKTtcblx0ZmxvYXQgViA9IFZfTmV1YmVsdCggZG90TlYsIGRvdE5MICk7XG5cdHJldHVybiBzaGVlbkNvbG9yICogKCBEICogViApO1xufVxuI2VuZGlmXG5mbG9hdCBJQkxTaGVlbkJSREYoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0ZmxvYXQgZG90TlYgPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIHZpZXdEaXIgKSApO1xuXHRmbG9hdCByMiA9IHJvdWdobmVzcyAqIHJvdWdobmVzcztcblx0ZmxvYXQgYSA9IHJvdWdobmVzcyA8IDAuMjUgPyAtMzM5LjIgKiByMiArIDE2MS40ICogcm91Z2huZXNzIC0gMjUuOSA6IC04LjQ4ICogcjIgKyAxNC4zICogcm91Z2huZXNzIC0gOS45NTtcblx0ZmxvYXQgYiA9IHJvdWdobmVzcyA8IDAuMjUgPyA0NC4wICogcjIgLSAyMy43ICogcm91Z2huZXNzICsgMy4yNiA6IDEuOTcgKiByMiAtIDMuMjcgKiByb3VnaG5lc3MgKyAwLjcyO1xuXHRmbG9hdCBERyA9IGV4cCggYSAqIGRvdE5WICsgYiApICsgKCByb3VnaG5lc3MgPCAwLjI1ID8gMC4wIDogMC4xICogKCByb3VnaG5lc3MgLSAwLjI1ICkgKTtcblx0cmV0dXJuIHNhdHVyYXRlKCBERyAqIFJFQ0lQUk9DQUxfUEkgKTtcbn1cbnZlYzIgREZHQXBwcm94KCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0Y29uc3QgdmVjNCBjMCA9IHZlYzQoIC0gMSwgLSAwLjAyNzUsIC0gMC41NzIsIDAuMDIyICk7XG5cdGNvbnN0IHZlYzQgYzEgPSB2ZWM0KCAxLCAwLjA0MjUsIDEuMDQsIC0gMC4wNCApO1xuXHR2ZWM0IHIgPSByb3VnaG5lc3MgKiBjMCArIGMxO1xuXHRmbG9hdCBhMDA0ID0gbWluKCByLnggKiByLngsIGV4cDIoIC0gOS4yOCAqIGRvdE5WICkgKSAqIHIueCArIHIueTtcblx0dmVjMiBmYWIgPSB2ZWMyKCAtIDEuMDQsIDEuMDQgKSAqIGEwMDQgKyByLnp3O1xuXHRyZXR1cm4gZmFiO1xufVxudmVjMyBFbnZpcm9ubWVudEJSREYoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcyApIHtcblx0dmVjMiBmYWIgPSBERkdBcHByb3goIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG5cdHJldHVybiBzcGVjdWxhckNvbG9yICogZmFiLnggKyBzcGVjdWxhckY5MCAqIGZhYi55O1xufVxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxudm9pZCBjb21wdXRlTXVsdGlzY2F0dGVyaW5nSXJpZGVzY2VuY2UoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IGlyaWRlc2NlbmNlLCBjb25zdCBpbiB2ZWMzIGlyaWRlc2NlbmNlRjAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgaW5vdXQgdmVjMyBzaW5nbGVTY2F0dGVyLCBpbm91dCB2ZWMzIG11bHRpU2NhdHRlciApIHtcbiNlbHNlXG52b2lkIGNvbXB1dGVNdWx0aXNjYXR0ZXJpbmcoIGNvbnN0IGluIHZlYzMgbm9ybWFsLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc3BlY3VsYXJGOTAsIGNvbnN0IGluIGZsb2F0IHJvdWdobmVzcywgaW5vdXQgdmVjMyBzaW5nbGVTY2F0dGVyLCBpbm91dCB2ZWMzIG11bHRpU2NhdHRlciApIHtcbiNlbmRpZlxuXHR2ZWMyIGZhYiA9IERGR0FwcHJveCggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHRcdHZlYzMgRnIgPSBtaXgoIHNwZWN1bGFyQ29sb3IsIGlyaWRlc2NlbmNlRjAsIGlyaWRlc2NlbmNlICk7XG5cdCNlbHNlXG5cdFx0dmVjMyBGciA9IHNwZWN1bGFyQ29sb3I7XG5cdCNlbmRpZlxuXHR2ZWMzIEZzc0VzcyA9IEZyICogZmFiLnggKyBzcGVjdWxhckY5MCAqIGZhYi55O1xuXHRmbG9hdCBFc3MgPSBmYWIueCArIGZhYi55O1xuXHRmbG9hdCBFbXMgPSAxLjAgLSBFc3M7XG5cdHZlYzMgRmF2ZyA9IEZyICsgKCAxLjAgLSBGciApICogMC4wNDc2MTk7XHR2ZWMzIEZtcyA9IEZzc0VzcyAqIEZhdmcgLyAoIDEuMCAtIEVtcyAqIEZhdmcgKTtcblx0c2luZ2xlU2NhdHRlciArPSBGc3NFc3M7XG5cdG11bHRpU2NhdHRlciArPSBGbXMgKiBFbXM7XG59XG4jaWYgTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwXG5cdHZvaWQgUkVfRGlyZWN0X1JlY3RBcmVhX1BoeXNpY2FsKCBjb25zdCBpbiBSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRcdHZlYzMgbm9ybWFsID0gZ2VvbWV0cnlOb3JtYWw7XG5cdFx0dmVjMyB2aWV3RGlyID0gZ2VvbWV0cnlWaWV3RGlyO1xuXHRcdHZlYzMgcG9zaXRpb24gPSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdHZlYzMgbGlnaHRQb3MgPSByZWN0QXJlYUxpZ2h0LnBvc2l0aW9uO1xuXHRcdHZlYzMgaGFsZldpZHRoID0gcmVjdEFyZWFMaWdodC5oYWxmV2lkdGg7XG5cdFx0dmVjMyBoYWxmSGVpZ2h0ID0gcmVjdEFyZWFMaWdodC5oYWxmSGVpZ2h0O1xuXHRcdHZlYzMgbGlnaHRDb2xvciA9IHJlY3RBcmVhTGlnaHQuY29sb3I7XG5cdFx0ZmxvYXQgcm91Z2huZXNzID0gbWF0ZXJpYWwucm91Z2huZXNzO1xuXHRcdHZlYzMgcmVjdENvb3Jkc1sgNCBdO1xuXHRcdHJlY3RDb29yZHNbIDAgXSA9IGxpZ2h0UG9zICsgaGFsZldpZHRoIC0gaGFsZkhlaWdodDtcdFx0cmVjdENvb3Jkc1sgMSBdID0gbGlnaHRQb3MgLSBoYWxmV2lkdGggLSBoYWxmSGVpZ2h0O1xuXHRcdHJlY3RDb29yZHNbIDIgXSA9IGxpZ2h0UG9zIC0gaGFsZldpZHRoICsgaGFsZkhlaWdodDtcblx0XHRyZWN0Q29vcmRzWyAzIF0gPSBsaWdodFBvcyArIGhhbGZXaWR0aCArIGhhbGZIZWlnaHQ7XG5cdFx0dmVjMiB1diA9IExUQ19Vdiggbm9ybWFsLCB2aWV3RGlyLCByb3VnaG5lc3MgKTtcblx0XHR2ZWM0IHQxID0gdGV4dHVyZTJEKCBsdGNfMSwgdXYgKTtcblx0XHR2ZWM0IHQyID0gdGV4dHVyZTJEKCBsdGNfMiwgdXYgKTtcblx0XHRtYXQzIG1JbnYgPSBtYXQzKFxuXHRcdFx0dmVjMyggdDEueCwgMCwgdDEueSApLFxuXHRcdFx0dmVjMyggICAgMCwgMSwgICAgMCApLFxuXHRcdFx0dmVjMyggdDEueiwgMCwgdDEudyApXG5cdFx0KTtcblx0XHR2ZWMzIGZyZXNuZWwgPSAoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKiB0Mi54ICsgKCB2ZWMzKCAxLjAgKSAtIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3IgKSAqIHQyLnkgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBsaWdodENvbG9yICogZnJlc25lbCAqIExUQ19FdmFsdWF0ZSggbm9ybWFsLCB2aWV3RGlyLCBwb3NpdGlvbiwgbUludiwgcmVjdENvb3JkcyApO1xuXHRcdHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKz0gbGlnaHRDb2xvciAqIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciAqIExUQ19FdmFsdWF0ZSggbm9ybWFsLCB2aWV3RGlyLCBwb3NpdGlvbiwgbWF0MyggMS4wICksIHJlY3RDb29yZHMgKTtcblx0fVxuI2VuZGlmXG52b2lkIFJFX0RpcmVjdF9QaHlzaWNhbCggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiApICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGRvdE5MICogZGlyZWN0TGlnaHQuY29sb3I7XG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgZG90TkxjYyA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHRcdHZlYzMgY2NJcnJhZGlhbmNlID0gZG90TkxjYyAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRcdGNsZWFyY29hdFNwZWN1bGFyRGlyZWN0ICs9IGNjSXJyYWRpYW5jZSAqIEJSREZfR0dYX0NsZWFyY29hdCggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHNoZWVuU3BlY3VsYXJEaXJlY3QgKz0gaXJyYWRpYW5jZSAqIEJSREZfU2hlZW4oIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwuc2hlZW5Db2xvciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICs9IGlycmFkaWFuY2UgKiBCUkRGX0dHWCggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbCApO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfUGh5c2ljYWwoIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgKSB7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbCggY29uc3QgaW4gdmVjMyByYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGNsZWFyY29hdFJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCkge1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKz0gY2xlYXJjb2F0UmFkaWFuY2UgKiBFbnZpcm9ubWVudEJSREYoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIG1hdGVyaWFsLmNsZWFyY29hdEYwLCBtYXRlcmlhbC5jbGVhcmNvYXRGOTAsIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyApO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHNoZWVuU3BlY3VsYXJJbmRpcmVjdCArPSBpcnJhZGlhbmNlICogbWF0ZXJpYWwuc2hlZW5Db2xvciAqIElCTFNoZWVuQlJERiggZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHZlYzMgc2luZ2xlU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIG11bHRpU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZSA9IGlycmFkaWFuY2UgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0Y29tcHV0ZU11bHRpc2NhdHRlcmluZ0lyaWRlc2NlbmNlKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2Vsc2Vcblx0XHRjb21wdXRlTXVsdGlzY2F0dGVyaW5nKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2VuZGlmXG5cdHZlYzMgdG90YWxTY2F0dGVyaW5nID0gc2luZ2xlU2NhdHRlcmluZyArIG11bHRpU2NhdHRlcmluZztcblx0dmVjMyBkaWZmdXNlID0gbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogKCAxLjAgLSBtYXgoIG1heCggdG90YWxTY2F0dGVyaW5nLnIsIHRvdGFsU2NhdHRlcmluZy5nICksIHRvdGFsU2NhdHRlcmluZy5iICkgKTtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSByYWRpYW5jZSAqIHNpbmdsZVNjYXR0ZXJpbmc7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gbXVsdGlTY2F0dGVyaW5nICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gZGlmZnVzZSAqIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfUGh5c2ljYWxcbiNkZWZpbmUgUkVfRGlyZWN0X1JlY3RBcmVhXHRcdFJFX0RpcmVjdF9SZWN0QXJlYV9QaHlzaWNhbFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0U3BlY3VsYXJcdFx0UkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbFxuZmxvYXQgY29tcHV0ZVNwZWN1bGFyT2NjbHVzaW9uKCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgYW1iaWVudE9jY2x1c2lvbiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHBvdyggZG90TlYgKyBhbWJpZW50T2NjbHVzaW9uLCBleHAyKCAtIDE2LjAgKiByb3VnaG5lc3MgLSAxLjAgKSApIC0gMS4wICsgYW1iaWVudE9jY2x1c2lvbiApO1xufSI7CgoJdmFyIGxpZ2h0c19mcmFnbWVudF9iZWdpbiA9ICJcbnZlYzMgZ2VvbWV0cnlQb3NpdGlvbiA9IC0gdlZpZXdQb3NpdGlvbjtcbnZlYzMgZ2VvbWV0cnlOb3JtYWwgPSBub3JtYWw7XG52ZWMzIGdlb21ldHJ5Vmlld0RpciA9ICggaXNPcnRob2dyYXBoaWMgKSA/IHZlYzMoIDAsIDAsIDEgKSA6IG5vcm1hbGl6ZSggdlZpZXdQb3NpdGlvbiApO1xudmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCA9IHZlYzMoIDAuMCApO1xuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0Z2VvbWV0cnlDbGVhcmNvYXROb3JtYWwgPSBjbGVhcmNvYXROb3JtYWw7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0ZmxvYXQgZG90TlZpID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID09IDAuMCApIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IDAuMDtcblx0fSBlbHNlIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSApO1xuXHR9XG5cdGlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPiAwLjAgKSB7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsID0gZXZhbElyaWRlc2NlbmNlKCAxLjAsIG1hdGVyaWFsLmlyaWRlc2NlbmNlSU9SLCBkb3ROVmksIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICk7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGMCA9IFNjaGxpY2tfdG9fRjAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgMS4wLCBkb3ROVmkgKTtcblx0fVxuI2VuZGlmXG5JbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0O1xuI2lmICggTlVNX1BPSU5UX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3QgKVxuXHRQb2ludExpZ2h0IHBvaW50TGlnaHQ7XG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUUzsgaSArKyApIHtcblx0XHRwb2ludExpZ2h0ID0gcG9pbnRMaWdodHNbIGkgXTtcblx0XHRnZXRQb2ludExpZ2h0SW5mbyggcG9pbnRMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIClcblx0XHRwb2ludExpZ2h0U2hhZG93ID0gcG9pbnRMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSAoIGRpcmVjdExpZ2h0LnZpc2libGUgJiYgcmVjZWl2ZVNoYWRvdyApID8gZ2V0UG9pbnRTaGFkb3coIHBvaW50U2hhZG93TWFwWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dJbnRlbnNpdHksIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93QmlhcywgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93Q2FtZXJhTmVhciwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFGYXIgKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1NQT1RfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdFNwb3RMaWdodCBzcG90TGlnaHQ7XG5cdHZlYzQgc3BvdENvbG9yO1xuXHR2ZWMzIHNwb3RMaWdodENvb3JkO1xuXHRib29sIGluU3BvdExpZ2h0TWFwO1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3c7XG5cdCNlbmRpZlxuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUUzsgaSArKyApIHtcblx0XHRzcG90TGlnaHQgPSBzcG90TGlnaHRzWyBpIF07XG5cdFx0Z2V0U3BvdExpZ2h0SW5mbyggc3BvdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBkaXJlY3RMaWdodCApO1xuXHRcdCNpZiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBVTlJPTExFRF9MT09QX0lOREVYXG5cdFx0I2VsaWYgKCBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0I2RlZmluZSBTUE9UX0xJR0hUX01BUF9JTkRFWCBOVU1fU1BPVF9MSUdIVF9NQVBTXG5cdFx0I2Vsc2Vcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYICggVU5ST0xMRURfTE9PUF9JTkRFWCAtIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgKyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTX1dJVEhfTUFQUyApXG5cdFx0I2VuZGlmXG5cdFx0I2lmICggU1BPVF9MSUdIVF9NQVBfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9NQVBTIClcblx0XHRcdHNwb3RMaWdodENvb3JkID0gdlNwb3RMaWdodENvb3JkWyBpIF0ueHl6IC8gdlNwb3RMaWdodENvb3JkWyBpIF0udztcblx0XHRcdGluU3BvdExpZ2h0TWFwID0gYWxsKCBsZXNzVGhhbiggYWJzKCBzcG90TGlnaHRDb29yZCAqIDIuIC0gMS4gKSwgdmVjMyggMS4wICkgKSApO1xuXHRcdFx0c3BvdENvbG9yID0gdGV4dHVyZTJEKCBzcG90TGlnaHRNYXBbIFNQT1RfTElHSFRfTUFQX0lOREVYIF0sIHNwb3RMaWdodENvb3JkLnh5ICk7XG5cdFx0XHRkaXJlY3RMaWdodC5jb2xvciA9IGluU3BvdExpZ2h0TWFwID8gZGlyZWN0TGlnaHQuY29sb3IgKiBzcG90Q29sb3IucmdiIDogZGlyZWN0TGlnaHQuY29sb3I7XG5cdFx0I2VuZGlmXG5cdFx0I3VuZGVmIFNQT1RfTElHSFRfTUFQX0lOREVYXG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRzcG90TGlnaHRTaGFkb3cgPSBzcG90TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFNoYWRvdyggc3BvdFNoYWRvd01hcFsgaSBdLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0ludGVuc2l0eSwgc3BvdExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZTcG90TGlnaHRDb29yZFsgaSBdICkgOiAxLjA7XG5cdFx0I2VuZGlmXG5cdFx0UkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiAoIE5VTV9ESVJfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdCApXG5cdERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodDtcblx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVFM7IGkgKysgKSB7XG5cdFx0ZGlyZWN0aW9uYWxMaWdodCA9IGRpcmVjdGlvbmFsTGlnaHRzWyBpIF07XG5cdFx0Z2V0RGlyZWN0aW9uYWxMaWdodEluZm8oIGRpcmVjdGlvbmFsTGlnaHQsIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fRElSX0xJR0hUX1NIQURPV1MgKVxuXHRcdGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdGRpcmVjdExpZ2h0LmNvbG9yICo9ICggZGlyZWN0TGlnaHQudmlzaWJsZSAmJiByZWNlaXZlU2hhZG93ICkgPyBnZXRTaGFkb3coIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBpIF0sIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dJbnRlbnNpdHksIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93QmlhcywgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dSYWRpdXMsIHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBpIF0gKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX1JFQ1RfQVJFQV9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0X1JlY3RBcmVhIClcblx0UmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9SRUNUX0FSRUFfTElHSFRTOyBpICsrICkge1xuXHRcdHJlY3RBcmVhTGlnaHQgPSByZWN0QXJlYUxpZ2h0c1sgaSBdO1xuXHRcdFJFX0RpcmVjdF9SZWN0QXJlYSggcmVjdEFyZWFMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHR2ZWMzIGlibElycmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggYW1iaWVudExpZ2h0Q29sb3IgKTtcblx0I2lmIGRlZmluZWQoIFVTRV9MSUdIVF9QUk9CRVMgKVxuXHRcdGlycmFkaWFuY2UgKz0gZ2V0TGlnaHRQcm9iZUlycmFkaWFuY2UoIGxpZ2h0UHJvYmUsIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuXHQjaWYgKCBOVU1fSEVNSV9MSUdIVFMgPiAwIClcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0hFTUlfTElHSFRTOyBpICsrICkge1xuXHRcdFx0aXJyYWRpYW5jZSArPSBnZXRIZW1pc3BoZXJlTGlnaHRJcnJhZGlhbmNlKCBoZW1pc3BoZXJlTGlnaHRzWyBpIF0sIGdlb21ldHJ5Tm9ybWFsICk7XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdHZlYzMgcmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcblx0dmVjMyBjbGVhcmNvYXRSYWRpYW5jZSA9IHZlYzMoIDAuMCApO1xuI2VuZGlmIjsKCgl2YXIgbGlnaHRzX2ZyYWdtZW50X21hcHMgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdCNpZmRlZiBVU0VfTElHSFRNQVBcblx0XHR2ZWM0IGxpZ2h0TWFwVGV4ZWwgPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2TGlnaHRNYXBVdiApO1xuXHRcdHZlYzMgbGlnaHRNYXBJcnJhZGlhbmNlID0gbGlnaHRNYXBUZXhlbC5yZ2IgKiBsaWdodE1hcEludGVuc2l0eTtcblx0XHRpcnJhZGlhbmNlICs9IGxpZ2h0TWFwSXJyYWRpYW5jZTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKSAmJiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHRpYmxJcnJhZGlhbmNlICs9IGdldElCTElycmFkaWFuY2UoIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuYW5pc290cm9weUIsIG1hdGVyaWFsLmFuaXNvdHJvcHkgKTtcblx0I2Vsc2Vcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxSYWRpYW5jZSggZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwucm91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFJhZGlhbmNlICs9IGdldElCTFJhZGlhbmNlKCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKCXZhciBsaWdodHNfZnJhZ21lbnRfZW5kID0gIiNpZiBkZWZpbmVkKCBSRV9JbmRpcmVjdERpZmZ1c2UgKVxuXHRSRV9JbmRpcmVjdERpZmZ1c2UoIGlycmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHRSRV9JbmRpcmVjdFNwZWN1bGFyKCByYWRpYW5jZSwgaWJsSXJyYWRpYW5jZSwgY2xlYXJjb2F0UmFkaWFuY2UsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcbiNlbmRpZiI7CgoJdmFyIGxvZ2RlcHRoYnVmX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKVxuXHRnbF9GcmFnRGVwdGggPSB2SXNQZXJzcGVjdGl2ZSA9PSAwLjAgPyBnbF9GcmFnQ29vcmQueiA6IGxvZzIoIHZGcmFnRGVwdGggKSAqIGxvZ0RlcHRoQnVmRkMgKiAwLjU7XG4jZW5kaWYiOwoKCXZhciBsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTE9HREVQVEhCVUYgKVxuXHR1bmlmb3JtIGZsb2F0IGxvZ0RlcHRoQnVmRkM7XG5cdHZhcnlpbmcgZmxvYXQgdkZyYWdEZXB0aDtcblx0dmFyeWluZyBmbG9hdCB2SXNQZXJzcGVjdGl2ZTtcbiNlbmRpZiI7CgoJdmFyIGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuXHR2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuI2VuZGlmIjsKCgl2YXIgbG9nZGVwdGhidWZfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0dkZyYWdEZXB0aCA9IDEuMCArIGdsX1Bvc2l0aW9uLnc7XG5cdHZJc1BlcnNwZWN0aXZlID0gZmxvYXQoIGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSApO1xuI2VuZGlmIjsKCgl2YXIgbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUFQXG5cdHZlYzQgc2FtcGxlZERpZmZ1c2VDb2xvciA9IHRleHR1cmUyRCggbWFwLCB2TWFwVXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0c2FtcGxlZERpZmZ1c2VDb2xvciA9IHNSR0JUcmFuc2ZlckVPVEYoIHNhbXBsZWREaWZmdXNlQ29sb3IgKTtcblx0I2VuZGlmXG5cdGRpZmZ1c2VDb2xvciAqPSBzYW1wbGVkRGlmZnVzZUNvbG9yO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnRpY2xlX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQIClcblx0I2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHRcdHZlYzIgdXYgPSB2VXY7XG5cdCNlbHNlXG5cdFx0dmVjMiB1diA9ICggdXZUcmFuc2Zvcm0gKiB2ZWMzKCBnbF9Qb2ludENvb3JkLngsIDEuMCAtIGdsX1BvaW50Q29vcmQueSwgMSApICkueHk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHRkaWZmdXNlQ29sb3IgKj0gdGV4dHVyZTJEKCBtYXAsIHV2ICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdXYgKS5nO1xuI2VuZGlmIjsKCgl2YXIgbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9QT0lOVFNfVVYgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2Vsc2Vcblx0I2lmIGRlZmluZWQoIFVTRV9NQVAgKSB8fCBkZWZpbmVkKCBVU0VfQUxQSEFNQVAgKVxuXHRcdHVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhbHBoYU1hcDtcbiNlbmRpZiI7CgoJdmFyIG1ldGFsbmVzc21hcF9mcmFnbWVudCA9ICJmbG9hdCBtZXRhbG5lc3NGYWN0b3IgPSBtZXRhbG5lc3M7XG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2ZWM0IHRleGVsTWV0YWxuZXNzID0gdGV4dHVyZTJEKCBtZXRhbG5lc3NNYXAsIHZNZXRhbG5lc3NNYXBVdiApO1xuXHRtZXRhbG5lc3NGYWN0b3IgKj0gdGV4ZWxNZXRhbG5lc3MuYjtcbiNlbmRpZiI7CgoJdmFyIG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG1ldGFsbmVzc01hcDtcbiNlbmRpZiI7CgoJdmFyIG1vcnBoaW5zdGFuY2VfdmVydGV4ID0gIiNpZmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSFxuXHRmbG9hdCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIE1PUlBIVEFSR0VUU19DT1VOVCBdO1xuXHRmbG9hdCBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UgPSB0ZXhlbEZldGNoKCBtb3JwaFRleHR1cmUsIGl2ZWMyKCAwLCBnbF9JbnN0YW5jZUlEICksIDAgKS5yO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0bW9ycGhUYXJnZXRJbmZsdWVuY2VzW2ldID0gIHRleGVsRmV0Y2goIG1vcnBoVGV4dHVyZSwgaXZlYzIoIGkgKyAxLCBnbF9JbnN0YW5jZUlEICksIDAgKS5yO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBtb3JwaGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX01PUlBIQ09MT1JTIClcblx0dkNvbG9yICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTU9SUEhUQVJHRVRTX0NPVU5UOyBpICsrICkge1xuXHRcdCNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKVxuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSB2Q29sb3IgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAyICkucmdiICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdFx0I2VuZGlmXG5cdH1cbiNlbmRpZiI7CgoJdmFyIG1vcnBobm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBITk9STUFMU1xuXHRvYmplY3ROb3JtYWwgKj0gbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSBvYmplY3ROb3JtYWwgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAxICkueHl6ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdH1cbiNlbmRpZiI7CgoJdmFyIG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTXG5cdCNpZm5kZWYgVVNFX0lOU1RBTkNJTkdfTU9SUEhcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgTU9SUEhUQVJHRVRTX0NPVU5UIF07XG5cdCNlbmRpZlxuXHR1bmlmb3JtIHNhbXBsZXIyREFycmF5IG1vcnBoVGFyZ2V0c1RleHR1cmU7XG5cdHVuaWZvcm0gaXZlYzIgbW9ycGhUYXJnZXRzVGV4dHVyZVNpemU7XG5cdHZlYzQgZ2V0TW9ycGgoIGNvbnN0IGluIGludCB2ZXJ0ZXhJbmRleCwgY29uc3QgaW4gaW50IG1vcnBoVGFyZ2V0SW5kZXgsIGNvbnN0IGluIGludCBvZmZzZXQgKSB7XG5cdFx0aW50IHRleGVsSW5kZXggPSB2ZXJ0ZXhJbmRleCAqIE1PUlBIVEFSR0VUU19URVhUVVJFX1NUUklERSArIG9mZnNldDtcblx0XHRpbnQgeSA9IHRleGVsSW5kZXggLyBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdGludCB4ID0gdGV4ZWxJbmRleCAtIHkgKiBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdGl2ZWMzIG1vcnBoVVYgPSBpdmVjMyggeCwgeSwgbW9ycGhUYXJnZXRJbmRleCApO1xuXHRcdHJldHVybiB0ZXhlbEZldGNoKCBtb3JwaFRhcmdldHNUZXh0dXJlLCBtb3JwaFVWLCAwICk7XG5cdH1cbiNlbmRpZiI7CgoJdmFyIG1vcnBodGFyZ2V0X3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuXHR0cmFuc2Zvcm1lZCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHRyYW5zZm9ybWVkICs9IGdldE1vcnBoKCBnbF9WZXJ0ZXhJRCwgaSwgMCApLnh5eiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBub3JtYWxfZnJhZ21lbnRfYmVnaW4gPSAiZmxvYXQgZmFjZURpcmVjdGlvbiA9IGdsX0Zyb250RmFjaW5nID8gMS4wIDogLSAxLjA7XG4jaWZkZWYgRkxBVF9TSEFERURcblx0dmVjMyBmZHggPSBkRmR4KCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgZmR5ID0gZEZkeSggdlZpZXdQb3NpdGlvbiApO1xuXHR2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGZkeCwgZmR5ICkgKTtcbiNlbHNlXG5cdHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7XG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibiA9IG1hdDMoIG5vcm1hbGl6ZSggdlRhbmdlbnQgKSwgbm9ybWFsaXplKCB2Qml0YW5nZW50ICksIG5vcm1hbCApO1xuXHQjZWxzZVxuXHRcdG1hdDMgdGJuID0gZ2V0VGFuZ2VudEZyYW1lKCAtIHZWaWV3UG9zaXRpb24sIG5vcm1hbCxcblx0XHQjaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApXG5cdFx0XHR2Tm9ybWFsTWFwVXZcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApXG5cdFx0XHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXZcblx0XHQjZWxzZVxuXHRcdFx0dlV2XG5cdFx0I2VuZGlmXG5cdFx0KTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym5bMF0gKj0gZmFjZURpcmVjdGlvbjtcblx0XHR0Ym5bMV0gKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibjIgPSBtYXQzKCBub3JtYWxpemUoIHZUYW5nZW50ICksIG5vcm1hbGl6ZSggdkJpdGFuZ2VudCApLCBub3JtYWwgKTtcblx0I2Vsc2Vcblx0XHRtYXQzIHRibjIgPSBnZXRUYW5nZW50RnJhbWUoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym4yWzBdICo9IGZhY2VEaXJlY3Rpb247XG5cdFx0dGJuMlsxXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcbiNlbmRpZlxudmVjMyBub25QZXJ0dXJiZWROb3JtYWwgPSBub3JtYWw7IjsKCgl2YXIgbm9ybWFsX2ZyYWdtZW50X21hcHMgPSAiI2lmZGVmIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0Vcblx0bm9ybWFsID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0I2lmZGVmIEZMSVBfU0lERURcblx0XHRub3JtYWwgPSAtIG5vcm1hbDtcblx0I2VuZGlmXG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgPSBub3JtYWwgKiBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcblx0bm9ybWFsID0gbm9ybWFsaXplKCBub3JtYWxNYXRyaXggKiBub3JtYWwgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmVjMyBtYXBOID0gdGV4dHVyZTJEKCBub3JtYWxNYXAsIHZOb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0bWFwTi54eSAqPSBub3JtYWxTY2FsZTtcblx0bm9ybWFsID0gbm9ybWFsaXplKCB0Ym4gKiBtYXBOICk7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApXG5cdG5vcm1hbCA9IHBlcnR1cmJOb3JtYWxBcmIoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCBkSGR4eV9md2QoKSwgZmFjZURpcmVjdGlvbiApO1xuI2VuZGlmIjsKCgl2YXIgbm9ybWFsX3BhcnNfZnJhZ21lbnQgPSAiI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dmFyeWluZyB2ZWMzIHZUYW5nZW50O1xuXHRcdHZhcnlpbmcgdmVjMyB2Qml0YW5nZW50O1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG5vcm1hbF9wYXJzX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgbm9ybWFsX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZOb3JtYWwgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkTm9ybWFsICk7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZUYW5nZW50ID0gbm9ybWFsaXplKCB0cmFuc2Zvcm1lZFRhbmdlbnQgKTtcblx0XHR2Qml0YW5nZW50ID0gbm9ybWFsaXplKCBjcm9zcyggdk5vcm1hbCwgdlRhbmdlbnQgKSAqIHRhbmdlbnQudyApO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIG5vcm1hbE1hcDtcblx0dW5pZm9ybSB2ZWMyIG5vcm1hbFNjYWxlO1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRVxuXHR1bmlmb3JtIG1hdDMgbm9ybWFsTWF0cml4O1xuI2VuZGlmXG4jaWYgISBkZWZpbmVkICggVVNFX1RBTkdFTlQgKSAmJiAoIGRlZmluZWQgKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQgKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZICkgKVxuXHRtYXQzIGdldFRhbmdlbnRGcmFtZSggdmVjMyBleWVfcG9zLCB2ZWMzIHN1cmZfbm9ybSwgdmVjMiB1diApIHtcblx0XHR2ZWMzIHEwID0gZEZkeCggZXllX3Bvcy54eXogKTtcblx0XHR2ZWMzIHExID0gZEZkeSggZXllX3Bvcy54eXogKTtcblx0XHR2ZWMyIHN0MCA9IGRGZHgoIHV2LnN0ICk7XG5cdFx0dmVjMiBzdDEgPSBkRmR5KCB1di5zdCApO1xuXHRcdHZlYzMgTiA9IHN1cmZfbm9ybTtcblx0XHR2ZWMzIHExcGVycCA9IGNyb3NzKCBxMSwgTiApO1xuXHRcdHZlYzMgcTBwZXJwID0gY3Jvc3MoIE4sIHEwICk7XG5cdFx0dmVjMyBUID0gcTFwZXJwICogc3QwLnggKyBxMHBlcnAgKiBzdDEueDtcblx0XHR2ZWMzIEIgPSBxMXBlcnAgKiBzdDAueSArIHEwcGVycCAqIHN0MS55O1xuXHRcdGZsb2F0IGRldCA9IG1heCggZG90KCBULCBUICksIGRvdCggQiwgQiApICk7XG5cdFx0ZmxvYXQgc2NhbGUgPSAoIGRldCA9PSAwLjAgKSA/IDAuMCA6IGludmVyc2VzcXJ0KCBkZXQgKTtcblx0XHRyZXR1cm4gbWF0MyggVCAqIHNjYWxlLCBCICogc2NhbGUsIE4gKTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHR2ZWMzIGNsZWFyY29hdE5vcm1hbCA9IG5vblBlcnR1cmJlZE5vcm1hbDtcbiNlbmRpZiI7CgoJdmFyIGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dmVjMyBjbGVhcmNvYXRNYXBOID0gdGV4dHVyZTJEKCBjbGVhcmNvYXROb3JtYWxNYXAsIHZDbGVhcmNvYXROb3JtYWxNYXBVdiApLnh5eiAqIDIuMCAtIDEuMDtcblx0Y2xlYXJjb2F0TWFwTi54eSAqPSBjbGVhcmNvYXROb3JtYWxTY2FsZTtcblx0Y2xlYXJjb2F0Tm9ybWFsID0gbm9ybWFsaXplKCB0Ym4yICogY2xlYXJjb2F0TWFwTiApO1xuI2VuZGlmIjsKCgl2YXIgY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0TWFwO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0Tm9ybWFsTWFwO1xuXHR1bmlmb3JtIHZlYzIgY2xlYXJjb2F0Tm9ybWFsU2NhbGU7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBjbGVhcmNvYXRSb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKCXZhciBpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgaXJpZGVzY2VuY2VNYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwO1xuI2VuZGlmIjsKCgl2YXIgb3BhcXVlX2ZyYWdtZW50ID0gIiNpZmRlZiBPUEFRVUVcbmRpZmZ1c2VDb2xvci5hID0gMS4wO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuZGlmZnVzZUNvbG9yLmEgKj0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGE7XG4jZW5kaWZcbmdsX0ZyYWdDb2xvciA9IHZlYzQoIG91dGdvaW5nTGlnaHQsIGRpZmZ1c2VDb2xvci5hICk7IjsKCgl2YXIgcGFja2luZyA9ICJ2ZWMzIHBhY2tOb3JtYWxUb1JHQiggY29uc3QgaW4gdmVjMyBub3JtYWwgKSB7XG5cdHJldHVybiBub3JtYWxpemUoIG5vcm1hbCApICogMC41ICsgMC41O1xufVxudmVjMyB1bnBhY2tSR0JUb05vcm1hbCggY29uc3QgaW4gdmVjMyByZ2IgKSB7XG5cdHJldHVybiAyLjAgKiByZ2IueHl6IC0gMS4wO1xufVxuY29uc3QgZmxvYXQgUGFja1Vwc2NhbGUgPSAyNTYuIC8gMjU1Ljtjb25zdCBmbG9hdCBVbnBhY2tEb3duc2NhbGUgPSAyNTUuIC8gMjU2Ljtjb25zdCBmbG9hdCBTaGlmdFJpZ2h0OCA9IDEuIC8gMjU2LjtcbmNvbnN0IGZsb2F0IEludjI1NSA9IDEuIC8gMjU1LjtcbmNvbnN0IHZlYzQgUGFja0ZhY3RvcnMgPSB2ZWM0KCAxLjAsIDI1Ni4wLCAyNTYuMCAqIDI1Ni4wLCAyNTYuMCAqIDI1Ni4wICogMjU2LjAgKTtcbmNvbnN0IHZlYzIgVW5wYWNrRmFjdG9yczIgPSB2ZWMyKCBVbnBhY2tEb3duc2NhbGUsIDEuMCAvIFBhY2tGYWN0b3JzLmcgKTtcbmNvbnN0IHZlYzMgVW5wYWNrRmFjdG9yczMgPSB2ZWMzKCBVbnBhY2tEb3duc2NhbGUgLyBQYWNrRmFjdG9ycy5yZywgMS4wIC8gUGFja0ZhY3RvcnMuYiApO1xuY29uc3QgdmVjNCBVbnBhY2tGYWN0b3JzNCA9IHZlYzQoIFVucGFja0Rvd25zY2FsZSAvIFBhY2tGYWN0b3JzLnJnYiwgMS4wIC8gUGFja0ZhY3RvcnMuYSApO1xudmVjNCBwYWNrRGVwdGhUb1JHQkEoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdGlmKCB2IDw9IDAuMCApXG5cdFx0cmV0dXJuIHZlYzQoIDAuLCAwLiwgMC4sIDAuICk7XG5cdGlmKCB2ID49IDEuMCApXG5cdFx0cmV0dXJuIHZlYzQoIDEuLCAxLiwgMS4sIDEuICk7XG5cdGZsb2F0IHZ1Zjtcblx0ZmxvYXQgYWYgPSBtb2RmKCB2ICogUGFja0ZhY3RvcnMuYSwgdnVmICk7XG5cdGZsb2F0IGJmID0gbW9kZiggdnVmICogU2hpZnRSaWdodDgsIHZ1ZiApO1xuXHRmbG9hdCBnZiA9IG1vZGYoIHZ1ZiAqIFNoaWZ0UmlnaHQ4LCB2dWYgKTtcblx0cmV0dXJuIHZlYzQoIHZ1ZiAqIEludjI1NSwgZ2YgKiBQYWNrVXBzY2FsZSwgYmYgKiBQYWNrVXBzY2FsZSwgYWYgKTtcbn1cbnZlYzMgcGFja0RlcHRoVG9SR0IoIGNvbnN0IGluIGZsb2F0IHYgKSB7XG5cdGlmKCB2IDw9IDAuMCApXG5cdFx0cmV0dXJuIHZlYzMoIDAuLCAwLiwgMC4gKTtcblx0aWYoIHYgPj0gMS4wIClcblx0XHRyZXR1cm4gdmVjMyggMS4sIDEuLCAxLiApO1xuXHRmbG9hdCB2dWY7XG5cdGZsb2F0IGJmID0gbW9kZiggdiAqIFBhY2tGYWN0b3JzLmIsIHZ1ZiApO1xuXHRmbG9hdCBnZiA9IG1vZGYoIHZ1ZiAqIFNoaWZ0UmlnaHQ4LCB2dWYgKTtcblx0cmV0dXJuIHZlYzMoIHZ1ZiAqIEludjI1NSwgZ2YgKiBQYWNrVXBzY2FsZSwgYmYgKTtcbn1cbnZlYzIgcGFja0RlcHRoVG9SRyggY29uc3QgaW4gZmxvYXQgdiApIHtcblx0aWYoIHYgPD0gMC4wIClcblx0XHRyZXR1cm4gdmVjMiggMC4sIDAuICk7XG5cdGlmKCB2ID49IDEuMCApXG5cdFx0cmV0dXJuIHZlYzIoIDEuLCAxLiApO1xuXHRmbG9hdCB2dWY7XG5cdGZsb2F0IGdmID0gbW9kZiggdiAqIDI1Ni4sIHZ1ZiApO1xuXHRyZXR1cm4gdmVjMiggdnVmICogSW52MjU1LCBnZiApO1xufVxuZmxvYXQgdW5wYWNrUkdCQVRvRGVwdGgoIGNvbnN0IGluIHZlYzQgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9yczQgKTtcbn1cbmZsb2F0IHVucGFja1JHQlRvRGVwdGgoIGNvbnN0IGluIHZlYzMgdiApIHtcblx0cmV0dXJuIGRvdCggdiwgVW5wYWNrRmFjdG9yczMgKTtcbn1cbmZsb2F0IHVucGFja1JHVG9EZXB0aCggY29uc3QgaW4gdmVjMiB2ICkge1xuXHRyZXR1cm4gdi5yICogVW5wYWNrRmFjdG9yczIuciArIHYuZyAqIFVucGFja0ZhY3RvcnMyLmc7XG59XG52ZWM0IHBhY2sySGFsZlRvUkdCQSggY29uc3QgaW4gdmVjMiB2ICkge1xuXHR2ZWM0IHIgPSB2ZWM0KCB2LngsIGZyYWN0KCB2LnggKiAyNTUuMCApLCB2LnksIGZyYWN0KCB2LnkgKiAyNTUuMCApICk7XG5cdHJldHVybiB2ZWM0KCByLnggLSByLnkgLyAyNTUuMCwgci55LCByLnogLSByLncgLyAyNTUuMCwgci53ICk7XG59XG52ZWMyIHVucGFja1JHQkFUbzJIYWxmKCBjb25zdCBpbiB2ZWM0IHYgKSB7XG5cdHJldHVybiB2ZWMyKCB2LnggKyAoIHYueSAvIDI1NS4wICksIHYueiArICggdi53IC8gMjU1LjAgKSApO1xufVxuZmxvYXQgdmlld1pUb09ydGhvZ3JhcGhpY0RlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCB2aWV3WiArIG5lYXIgKSAvICggbmVhciAtIGZhciApO1xufVxuZmxvYXQgb3J0aG9ncmFwaGljRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBkZXB0aCwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gZGVwdGggKiAoIG5lYXIgLSBmYXIgKSAtIG5lYXI7XG59XG5mbG9hdCB2aWV3WlRvUGVyc3BlY3RpdmVEZXB0aCggY29uc3QgaW4gZmxvYXQgdmlld1osIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggKCBuZWFyICsgdmlld1ogKSAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIHZpZXdaICk7XG59XG5mbG9hdCBwZXJzcGVjdGl2ZURlcHRoVG9WaWV3WiggY29uc3QgaW4gZmxvYXQgZGVwdGgsIGNvbnN0IGluIGZsb2F0IG5lYXIsIGNvbnN0IGluIGZsb2F0IGZhciApIHtcblx0cmV0dXJuICggbmVhciAqIGZhciApIC8gKCAoIGZhciAtIG5lYXIgKSAqIGRlcHRoIC0gZmFyICk7XG59IjsKCgl2YXIgcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCA9ICIjaWZkZWYgUFJFTVVMVElQTElFRF9BTFBIQVxuXHRnbF9GcmFnQ29sb3IucmdiICo9IGdsX0ZyYWdDb2xvci5hO1xuI2VuZGlmIjsKCgl2YXIgcHJvamVjdF92ZXJ0ZXggPSAidmVjNCBtdlBvc2l0aW9uID0gdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuI2lmZGVmIFVTRV9CQVRDSElOR1xuXHRtdlBvc2l0aW9uID0gYmF0Y2hpbmdNYXRyaXggKiBtdlBvc2l0aW9uO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lOU1RBTkNJTkdcblx0bXZQb3NpdGlvbiA9IGluc3RhbmNlTWF0cml4ICogbXZQb3NpdGlvbjtcbiNlbmRpZlxubXZQb3NpdGlvbiA9IG1vZGVsVmlld01hdHJpeCAqIG12UG9zaXRpb247XG5nbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uOyI7CgoJdmFyIGRpdGhlcmluZ19mcmFnbWVudCA9ICIjaWZkZWYgRElUSEVSSU5HXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSBkaXRoZXJpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7CgoJdmFyIGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBESVRIRVJJTkdcblx0dmVjMyBkaXRoZXJpbmcoIHZlYzMgY29sb3IgKSB7XG5cdFx0ZmxvYXQgZ3JpZF9wb3NpdGlvbiA9IHJhbmQoIGdsX0ZyYWdDb29yZC54eSApO1xuXHRcdHZlYzMgZGl0aGVyX3NoaWZ0X1JHQiA9IHZlYzMoIDAuMjUgLyAyNTUuMCwgLTAuMjUgLyAyNTUuMCwgMC4yNSAvIDI1NS4wICk7XG5cdFx0ZGl0aGVyX3NoaWZ0X1JHQiA9IG1peCggMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgLTIuMCAqIGRpdGhlcl9zaGlmdF9SR0IsIGdyaWRfcG9zaXRpb24gKTtcblx0XHRyZXR1cm4gY29sb3IgKyBkaXRoZXJfc2hpZnRfUkdCO1xuXHR9XG4jZW5kaWYiOwoKCXZhciByb3VnaG5lc3NtYXBfZnJhZ21lbnQgPSAiZmxvYXQgcm91Z2huZXNzRmFjdG9yID0gcm91Z2huZXNzO1xuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dmVjNCB0ZXhlbFJvdWdobmVzcyA9IHRleHR1cmUyRCggcm91Z2huZXNzTWFwLCB2Um91Z2huZXNzTWFwVXYgKTtcblx0cm91Z2huZXNzRmFjdG9yICo9IHRleGVsUm91Z2huZXNzLmc7XG4jZW5kaWYiOwoKCXZhciByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCByb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXBfcGFyc19mcmFnbWVudCA9ICIjaWYgTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMFxuXHR2YXJ5aW5nIHZlYzQgdlNwb3RMaWdodENvb3JkWyBOVU1fU1BPVF9MSUdIVF9DT09SRFMgXTtcbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUX01BUFMgPiAwXG5cdHVuaWZvcm0gc2FtcGxlcjJEIHNwb3RMaWdodE1hcFsgTlVNX1NQT1RfTElHSFRfTUFQUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIGRpcmVjdGlvbmFsU2hhZG93TWFwWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBEaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwb3RTaGFkb3dNYXBbIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHBvaW50U2hhZG93TWFwWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2UG9pbnRTaGFkb3dDb29yZFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgUG9pbnRMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYU5lYXI7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFGYXI7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvd3NbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHRmbG9hdCB0ZXh0dXJlMkRDb21wYXJlKCBzYW1wbGVyMkQgZGVwdGhzLCB2ZWMyIHV2LCBmbG9hdCBjb21wYXJlICkge1xuXHRcdHJldHVybiBzdGVwKCBjb21wYXJlLCB1bnBhY2tSR0JBVG9EZXB0aCggdGV4dHVyZTJEKCBkZXB0aHMsIHV2ICkgKSApO1xuXHR9XG5cdHZlYzIgdGV4dHVyZTJERGlzdHJpYnV0aW9uKCBzYW1wbGVyMkQgc2hhZG93LCB2ZWMyIHV2ICkge1xuXHRcdHJldHVybiB1bnBhY2tSR0JBVG8ySGFsZiggdGV4dHVyZTJEKCBzaGFkb3csIHV2ICkgKTtcblx0fVxuXHRmbG9hdCBWU01TaGFkb3cgKHNhbXBsZXIyRCBzaGFkb3csIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKXtcblx0XHRmbG9hdCBvY2NsdXNpb24gPSAxLjA7XG5cdFx0dmVjMiBkaXN0cmlidXRpb24gPSB0ZXh0dXJlMkREaXN0cmlidXRpb24oIHNoYWRvdywgdXYgKTtcblx0XHRmbG9hdCBoYXJkX3NoYWRvdyA9IHN0ZXAoIGNvbXBhcmUgLCBkaXN0cmlidXRpb24ueCApO1xuXHRcdGlmIChoYXJkX3NoYWRvdyAhPSAxLjAgKSB7XG5cdFx0XHRmbG9hdCBkaXN0YW5jZSA9IGNvbXBhcmUgLSBkaXN0cmlidXRpb24ueCA7XG5cdFx0XHRmbG9hdCB2YXJpYW5jZSA9IG1heCggMC4wMDAwMCwgZGlzdHJpYnV0aW9uLnkgKiBkaXN0cmlidXRpb24ueSApO1xuXHRcdFx0ZmxvYXQgc29mdG5lc3NfcHJvYmFiaWxpdHkgPSB2YXJpYW5jZSAvICh2YXJpYW5jZSArIGRpc3RhbmNlICogZGlzdGFuY2UgKTtcdFx0XHRzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IGNsYW1wKCAoIHNvZnRuZXNzX3Byb2JhYmlsaXR5IC0gMC4zICkgLyAoIDAuOTUgLSAwLjMgKSwgMC4wLCAxLjAgKTtcdFx0XHRvY2NsdXNpb24gPSBjbGFtcCggbWF4KCBoYXJkX3NoYWRvdywgc29mdG5lc3NfcHJvYmFiaWxpdHkgKSwgMC4wLCAxLjAgKTtcblx0XHR9XG5cdFx0cmV0dXJuIG9jY2x1c2lvbjtcblx0fVxuXHRmbG9hdCBnZXRTaGFkb3coIHNhbXBsZXIyRCBzaGFkb3dNYXAsIHZlYzIgc2hhZG93TWFwU2l6ZSwgZmxvYXQgc2hhZG93SW50ZW5zaXR5LCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHNoYWRvd0Nvb3JkLnh5eiAvPSBzaGFkb3dDb29yZC53O1xuXHRcdHNoYWRvd0Nvb3JkLnogKz0gc2hhZG93Qmlhcztcblx0XHRib29sIGluRnJ1c3R1bSA9IHNoYWRvd0Nvb3JkLnggPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnggPD0gMS4wICYmIHNoYWRvd0Nvb3JkLnkgPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnkgPD0gMS4wO1xuXHRcdGJvb2wgZnJ1c3R1bVRlc3QgPSBpbkZydXN0dW0gJiYgc2hhZG93Q29vcmQueiA8PSAxLjA7XG5cdFx0aWYgKCBmcnVzdHVtVGVzdCApIHtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHgwID0gLSB0ZXhlbFNpemUueCAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR5MCA9IC0gdGV4ZWxTaXplLnkgKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeDEgPSArIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkxID0gKyB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MiA9IGR4MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MiA9IGR5MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR4MyA9IGR4MSAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MyA9IGR5MSAvIDIuMDtcblx0XHRcdHNoYWRvdyA9IChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkyICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCBkeTIgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIGR5MyApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTMgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gMTcuMCApO1xuXHRcdCNlbGlmIGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRl9TT0ZUIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHggPSB0ZXhlbFNpemUueDtcblx0XHRcdGZsb2F0IGR5ID0gdGV4ZWxTaXplLnk7XG5cdFx0XHR2ZWMyIHV2ID0gc2hhZG93Q29vcmQueHk7XG5cdFx0XHR2ZWMyIGYgPSBmcmFjdCggdXYgKiBzaGFkb3dNYXBTaXplICsgMC41ICk7XG5cdFx0XHR1diAtPSBmICogdGV4ZWxTaXplO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCBkeSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdGV4ZWxTaXplLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi54ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueCApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueSApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCBmLnkgKSArXG5cdFx0XHRcdG1peCggbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggLWR4LCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdFx0ICB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBmLnkgKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcblx0XHRcdHNoYWRvdyA9IFZTTVNoYWRvdyggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuXHRcdCNlbHNlXG5cdFx0XHRzaGFkb3cgPSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICk7XG5cdFx0I2VuZGlmXG5cdFx0fVxuXHRcdHJldHVybiBtaXgoIDEuMCwgc2hhZG93LCBzaGFkb3dJbnRlbnNpdHkgKTtcblx0fVxuXHR2ZWMyIGN1YmVUb1VWKCB2ZWMzIHYsIGZsb2F0IHRleGVsU2l6ZVkgKSB7XG5cdFx0dmVjMyBhYnNWID0gYWJzKCB2ICk7XG5cdFx0ZmxvYXQgc2NhbGVUb0N1YmUgPSAxLjAgLyBtYXgoIGFic1YueCwgbWF4KCBhYnNWLnksIGFic1YueiApICk7XG5cdFx0YWJzViAqPSBzY2FsZVRvQ3ViZTtcblx0XHR2ICo9IHNjYWxlVG9DdWJlICogKCAxLjAgLSAyLjAgKiB0ZXhlbFNpemVZICk7XG5cdFx0dmVjMiBwbGFuYXIgPSB2Lnh5O1xuXHRcdGZsb2F0IGFsbW9zdEFUZXhlbCA9IDEuNSAqIHRleGVsU2l6ZVk7XG5cdFx0ZmxvYXQgYWxtb3N0T25lID0gMS4wIC0gYWxtb3N0QVRleGVsO1xuXHRcdGlmICggYWJzVi56ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGlmICggdi56ID4gMC4wIClcblx0XHRcdFx0cGxhbmFyLnggPSA0LjAgLSB2Lng7XG5cdFx0fSBlbHNlIGlmICggYWJzVi54ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25YID0gc2lnbiggdi54ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueiAqIHNpZ25YICsgMi4wICogc2lnblg7XG5cdFx0fSBlbHNlIGlmICggYWJzVi55ID49IGFsbW9zdE9uZSApIHtcblx0XHRcdGZsb2F0IHNpZ25ZID0gc2lnbiggdi55ICk7XG5cdFx0XHRwbGFuYXIueCA9IHYueCArIDIuMCAqIHNpZ25ZICsgMi4wO1xuXHRcdFx0cGxhbmFyLnkgPSB2LnogKiBzaWduWSAtIDIuMDtcblx0XHR9XG5cdFx0cmV0dXJuIHZlYzIoIDAuMTI1LCAwLjI1ICkgKiBwbGFuYXIgKyB2ZWMyKCAwLjM3NSwgMC43NSApO1xuXHR9XG5cdGZsb2F0IGdldFBvaW50U2hhZG93KCBzYW1wbGVyMkQgc2hhZG93TWFwLCB2ZWMyIHNoYWRvd01hcFNpemUsIGZsb2F0IHNoYWRvd0ludGVuc2l0eSwgZmxvYXQgc2hhZG93QmlhcywgZmxvYXQgc2hhZG93UmFkaXVzLCB2ZWM0IHNoYWRvd0Nvb3JkLCBmbG9hdCBzaGFkb3dDYW1lcmFOZWFyLCBmbG9hdCBzaGFkb3dDYW1lcmFGYXIgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHZlYzMgbGlnaHRUb1Bvc2l0aW9uID0gc2hhZG93Q29vcmQueHl6O1xuXHRcdFxuXHRcdGZsb2F0IGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCA9IGxlbmd0aCggbGlnaHRUb1Bvc2l0aW9uICk7XG5cdFx0aWYgKCBsaWdodFRvUG9zaXRpb25MZW5ndGggLSBzaGFkb3dDYW1lcmFGYXIgPD0gMC4wICYmIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYU5lYXIgPj0gMC4wICkge1xuXHRcdFx0ZmxvYXQgZHAgPSAoIGxpZ2h0VG9Qb3NpdGlvbkxlbmd0aCAtIHNoYWRvd0NhbWVyYU5lYXIgKSAvICggc2hhZG93Q2FtZXJhRmFyIC0gc2hhZG93Q2FtZXJhTmVhciApO1x0XHRcdGRwICs9IHNoYWRvd0JpYXM7XG5cdFx0XHR2ZWMzIGJkM0QgPSBub3JtYWxpemUoIGxpZ2h0VG9Qb3NpdGlvbiApO1xuXHRcdFx0dmVjMiB0ZXhlbFNpemUgPSB2ZWMyKCAxLjAgKSAvICggc2hhZG93TWFwU2l6ZSAqIHZlYzIoIDQuMCwgMi4wICkgKTtcblx0XHRcdCNpZiBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0YgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCApIHx8IGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1ZTTSApXG5cdFx0XHRcdHZlYzIgb2Zmc2V0ID0gdmVjMiggLSAxLCAxICkgKiBzaGFkb3dSYWRpdXMgKiB0ZXhlbFNpemUueTtcblx0XHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHl5LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueXl4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnh4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eHksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eCwgdGV4ZWxTaXplLnkgKSwgZHAgKVxuXHRcdFx0XHQpICogKCAxLjAgLyA5LjAgKTtcblx0XHRcdCNlbHNlXG5cdFx0XHRcdHNoYWRvdyA9IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QsIHRleGVsU2l6ZS55ICksIGRwICk7XG5cdFx0XHQjZW5kaWZcblx0XHR9XG5cdFx0cmV0dXJuIG1peCggMS4wLCBzaGFkb3csIHNoYWRvd0ludGVuc2l0eSApO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXBfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0dW5pZm9ybSBtYXQ0IHNwb3RMaWdodE1hdHJpeFsgTlVNX1NQT1RfTElHSFRfQ09PUkRTIF07XG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dJbnRlbnNpdHk7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHR9O1xuXHRcdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0ludGVuc2l0eTtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBwb2ludFNoYWRvd01hdHJpeFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IFBvaW50TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93SW50ZW5zaXR5O1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhRmFyO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHRTaGFkb3dzWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7CgoJdmFyIHNoYWRvd21hcF92ZXJ0ZXggPSAiI2lmICggZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMCB8fCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyA+IDAgKSApIHx8ICggTlVNX1NQT1RfTElHSFRfQ09PUkRTID4gMCApXG5cdHZlYzMgc2hhZG93V29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCB0cmFuc2Zvcm1lZE5vcm1hbCwgdmlld01hdHJpeCApO1xuXHR2ZWM0IHNoYWRvd1dvcmxkUG9zaXRpb247XG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQIClcblx0I2lmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24gKyB2ZWM0KCBzaGFkb3dXb3JsZE5vcm1hbCAqIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBpIF0uc2hhZG93Tm9ybWFsQmlhcywgMCApO1xuXHRcdFx0dkRpcmVjdGlvbmFsU2hhZG93Q29vcmRbIGkgXSA9IGRpcmVjdGlvbmFsU2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRcdHNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uICsgdmVjNCggc2hhZG93V29ybGROb3JtYWwgKiBwb2ludExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXMsIDAgKTtcblx0XHRcdHZQb2ludFNoYWRvd0Nvb3JkWyBpIF0gPSBwb2ludFNoYWRvd01hdHJpeFsgaSBdICogc2hhZG93V29ybGRQb3NpdGlvbjtcblx0XHR9XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRfQ09PUkRTOyBpICsrICkge1xuXHRcdHNoYWRvd1dvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uO1xuXHRcdCNpZiAoIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKSAmJiBVTlJPTExFRF9MT09QX0lOREVYIDwgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyApXG5cdFx0XHRzaGFkb3dXb3JsZFBvc2l0aW9uLnh5eiArPSBzaGFkb3dXb3JsZE5vcm1hbCAqIHNwb3RMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzO1xuXHRcdCNlbmRpZlxuXHRcdHZTcG90TGlnaHRDb29yZFsgaSBdID0gc3BvdExpZ2h0TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWYiOwoKCXZhciBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQgPSAiZmxvYXQgZ2V0U2hhZG93TWFzaygpIHtcblx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHQjaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHREaXJlY3Rpb25hbExpZ2h0U2hhZG93IGRpcmVjdGlvbmFsTGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX0RJUl9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdGRpcmVjdGlvbmFsTGlnaHQgPSBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBkaXJlY3Rpb25hbFNoYWRvd01hcFsgaSBdLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd01hcFNpemUsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93SW50ZW5zaXR5LCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0c3BvdExpZ2h0ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodC5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHQuc2hhZG93SW50ZW5zaXR5LCBzcG90TGlnaHQuc2hhZG93Qmlhcywgc3BvdExpZ2h0LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0ludGVuc2l0eSwgcG9pbnRMaWdodC5zaGFkb3dCaWFzLCBwb2ludExpZ2h0LnNoYWRvd1JhZGl1cywgdlBvaW50U2hhZG93Q29vcmRbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dDYW1lcmFOZWFyLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYUZhciApIDogMS4wO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjZW5kaWZcblx0cmV0dXJuIHNoYWRvdztcbn0iOwoKCXZhciBza2luYmFzZV92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHRtYXQ0IGJvbmVNYXRYID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnggKTtcblx0bWF0NCBib25lTWF0WSA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC55ICk7XG5cdG1hdDQgYm9uZU1hdFogPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueiApO1xuXHRtYXQ0IGJvbmVNYXRXID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LncgKTtcbiNlbmRpZiI7CgoJdmFyIHNraW5uaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBiaW5kTWF0cml4SW52ZXJzZTtcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYm9uZVRleHR1cmU7XG5cdG1hdDQgZ2V0Qm9uZU1hdHJpeCggY29uc3QgaW4gZmxvYXQgaSApIHtcblx0XHRpbnQgc2l6ZSA9IHRleHR1cmVTaXplKCBib25lVGV4dHVyZSwgMCApLng7XG5cdFx0aW50IGogPSBpbnQoIGkgKSAqIDQ7XG5cdFx0aW50IHggPSBqICUgc2l6ZTtcblx0XHRpbnQgeSA9IGogLyBzaXplO1xuXHRcdHZlYzQgdjEgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHgsIHkgKSwgMCApO1xuXHRcdHZlYzQgdjIgPSB0ZXhlbEZldGNoKCBib25lVGV4dHVyZSwgaXZlYzIoIHggKyAxLCB5ICksIDAgKTtcblx0XHR2ZWM0IHYzID0gdGV4ZWxGZXRjaCggYm9uZVRleHR1cmUsIGl2ZWMyKCB4ICsgMiwgeSApLCAwICk7XG5cdFx0dmVjNCB2NCA9IHRleGVsRmV0Y2goIGJvbmVUZXh0dXJlLCBpdmVjMiggeCArIDMsIHkgKSwgMCApO1xuXHRcdHJldHVybiBtYXQ0KCB2MSwgdjIsIHYzLCB2NCApO1xuXHR9XG4jZW5kaWYiOwoKCXZhciBza2lubmluZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHR2ZWM0IHNraW5WZXJ0ZXggPSBiaW5kTWF0cml4ICogdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuXHR2ZWM0IHNraW5uZWQgPSB2ZWM0KCAwLjAgKTtcblx0c2tpbm5lZCArPSBib25lTWF0WCAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lng7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFkgKiBza2luVmVydGV4ICogc2tpbldlaWdodC55O1xuXHRza2lubmVkICs9IGJvbmVNYXRaICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQuejtcblx0c2tpbm5lZCArPSBib25lTWF0VyAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnc7XG5cdHRyYW5zZm9ybWVkID0gKCBiaW5kTWF0cml4SW52ZXJzZSAqIHNraW5uZWQgKS54eXo7XG4jZW5kaWYiOwoKCXZhciBza2lubm9ybWFsX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdG1hdDQgc2tpbk1hdHJpeCA9IG1hdDQoIDAuMCApO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueCAqIGJvbmVNYXRYO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueSAqIGJvbmVNYXRZO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQueiAqIGJvbmVNYXRaO1xuXHRza2luTWF0cml4ICs9IHNraW5XZWlnaHQudyAqIGJvbmVNYXRXO1xuXHRza2luTWF0cml4ID0gYmluZE1hdHJpeEludmVyc2UgKiBza2luTWF0cml4ICogYmluZE1hdHJpeDtcblx0b2JqZWN0Tm9ybWFsID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdE5vcm1hbCwgMC4wICkgKS54eXo7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdG9iamVjdFRhbmdlbnQgPSB2ZWM0KCBza2luTWF0cml4ICogdmVjNCggb2JqZWN0VGFuZ2VudCwgMC4wICkgKS54eXo7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCgl2YXIgc3BlY3VsYXJtYXBfZnJhZ21lbnQgPSAiZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dmVjNCB0ZXhlbFNwZWN1bGFyID0gdGV4dHVyZTJEKCBzcGVjdWxhck1hcCwgdlNwZWN1bGFyTWFwVXYgKTtcblx0c3BlY3VsYXJTdHJlbmd0aCA9IHRleGVsU3BlY3VsYXIucjtcbiNlbHNlXG5cdHNwZWN1bGFyU3RyZW5ndGggPSAxLjA7XG4jZW5kaWYiOwoKCXZhciBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgc3BlY3VsYXJNYXA7XG4jZW5kaWYiOwoKCXZhciB0b25lbWFwcGluZ19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVE9ORV9NQVBQSU5HIClcblx0Z2xfRnJhZ0NvbG9yLnJnYiA9IHRvbmVNYXBwaW5nKCBnbF9GcmFnQ29sb3IucmdiICk7XG4jZW5kaWYiOwoKCXZhciB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZm5kZWYgc2F0dXJhdGVcbiNkZWZpbmUgc2F0dXJhdGUoIGEgKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG51bmlmb3JtIGZsb2F0IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG52ZWMzIExpbmVhclRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvciApO1xufVxudmVjMyBSZWluaGFyZFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRyZXR1cm4gc2F0dXJhdGUoIGNvbG9yIC8gKCB2ZWMzKCAxLjAgKSArIGNvbG9yICkgKTtcbn1cbnZlYzMgQ2luZW9uVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGNvbG9yID0gbWF4KCB2ZWMzKCAwLjAgKSwgY29sb3IgLSAwLjAwNCApO1xuXHRyZXR1cm4gcG93KCAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDAuNSApICkgLyAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDEuNyApICsgMC4wNiApLCB2ZWMzKCAyLjIgKSApO1xufVxudmVjMyBSUlRBbmRPRFRGaXQoIHZlYzMgdiApIHtcblx0dmVjMyBhID0gdiAqICggdiArIDAuMDI0NTc4NiApIC0gMC4wMDAwOTA1Mzc7XG5cdHZlYzMgYiA9IHYgKiAoIDAuOTgzNzI5ICogdiArIDAuNDMyOTUxMCApICsgMC4yMzgwODE7XG5cdHJldHVybiBhIC8gYjtcbn1cbnZlYzMgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBtYXQzIEFDRVNJbnB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggMC41OTcxOSwgMC4wNzYwMCwgMC4wMjg0MCApLFx0XHR2ZWMzKCAwLjM1NDU4LCAwLjkwODM0LCAwLjEzMzgzICksXG5cdFx0dmVjMyggMC4wNDgyMywgMC4wMTU2NiwgMC44Mzc3NyApXG5cdCk7XG5cdGNvbnN0IG1hdDMgQUNFU091dHB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggIDEuNjA0NzUsIC0wLjEwMjA4LCAtMC4wMDMyNyApLFx0XHR2ZWMzKCAtMC41MzEwOCwgIDEuMTA4MTMsIC0wLjA3Mjc2ICksXG5cdFx0dmVjMyggLTAuMDczNjcsIC0wLjAwNjA1LCAgMS4wNzYwMiApXG5cdCk7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmUgLyAwLjY7XG5cdGNvbG9yID0gQUNFU0lucHV0TWF0ICogY29sb3I7XG5cdGNvbG9yID0gUlJUQW5kT0RURml0KCBjb2xvciApO1xuXHRjb2xvciA9IEFDRVNPdXRwdXRNYXQgKiBjb2xvcjtcblx0cmV0dXJuIHNhdHVyYXRlKCBjb2xvciApO1xufVxuY29uc3QgbWF0MyBMSU5FQVJfUkVDMjAyMF9UT19MSU5FQVJfU1JHQiA9IG1hdDMoXG5cdHZlYzMoIDEuNjYwNSwgLSAwLjEyNDYsIC0gMC4wMTgyICksXG5cdHZlYzMoIC0gMC41ODc2LCAxLjEzMjksIC0gMC4xMDA2ICksXG5cdHZlYzMoIC0gMC4wNzI4LCAtIDAuMDA4MywgMS4xMTg3IClcbik7XG5jb25zdCBtYXQzIExJTkVBUl9TUkdCX1RPX0xJTkVBUl9SRUMyMDIwID0gbWF0Myhcblx0dmVjMyggMC42Mjc0LCAwLjA2OTEsIDAuMDE2NCApLFxuXHR2ZWMzKCAwLjMyOTMsIDAuOTE5NSwgMC4wODgwICksXG5cdHZlYzMoIDAuMDQzMywgMC4wMTEzLCAwLjg5NTYgKVxuKTtcbnZlYzMgYWd4RGVmYXVsdENvbnRyYXN0QXBwcm94KCB2ZWMzIHggKSB7XG5cdHZlYzMgeDIgPSB4ICogeDtcblx0dmVjMyB4NCA9IHgyICogeDI7XG5cdHJldHVybiArIDE1LjUgKiB4NCAqIHgyXG5cdFx0LSA0MC4xNCAqIHg0ICogeFxuXHRcdCsgMzEuOTYgKiB4NFxuXHRcdC0gNi44NjggKiB4MiAqIHhcblx0XHQrIDAuNDI5OCAqIHgyXG5cdFx0KyAwLjExOTEgKiB4XG5cdFx0LSAwLjAwMjMyO1xufVxudmVjMyBBZ1hUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgbWF0MyBBZ1hJbnNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMC44NTY2MjcxNTMzMTU5ODMsIDAuMTM3MzE4OTcyOTI5ODQ3LCAwLjExMTg5ODIxMjk5OTk1ICksXG5cdFx0dmVjMyggMC4wOTUxMjEyNDA1MzgxNTg4LCAwLjc2MTI0MTk5MDYwMjU5MSwgMC4wNzY3OTk0MTg2MDMxOTAzICksXG5cdFx0dmVjMyggMC4wNDgyNTE2MDYxNDU4NTgzLCAwLjEwMTQzOTAzNjQ2NzU2MiwgMC44MTEzMDIzNjgzOTY4NTkgKVxuXHQpO1xuXHRjb25zdCBtYXQzIEFnWE91dHNldE1hdHJpeCA9IG1hdDMoXG5cdFx0dmVjMyggMS4xMjcxMDA1ODE4MTQ0MzY4LCAtIDAuMTQxMzI5NzYzNDk4NDM4MywgLSAwLjE0MTMyOTc2MzQ5ODQzODI2ICksXG5cdFx0dmVjMyggLSAwLjExMDYwNjY0MzA5NjYwMzIzLCAxLjE1NzgyMzcwMjIxNjI3MiwgLSAwLjExMDYwNjY0MzA5NjYwMjk0ICksXG5cdFx0dmVjMyggLSAwLjAxNjQ5MzkzODcxNzgzNDU3MywgLSAwLjAxNjQ5MzkzODcxNzgzNDI1NywgMS4yNTE5MzY0MDY1OTUwNDA1IClcblx0KTtcblx0Y29uc3QgZmxvYXQgQWd4TWluRXYgPSAtIDEyLjQ3MzkzO1x0Y29uc3QgZmxvYXQgQWd4TWF4RXYgPSA0LjAyNjA2OTtcblx0Y29sb3IgKj0gdG9uZU1hcHBpbmdFeHBvc3VyZTtcblx0Y29sb3IgPSBMSU5FQVJfU1JHQl9UT19MSU5FQVJfUkVDMjAyMCAqIGNvbG9yO1xuXHRjb2xvciA9IEFnWEluc2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gbWF4KCBjb2xvciwgMWUtMTAgKTtcdGNvbG9yID0gbG9nMiggY29sb3IgKTtcblx0Y29sb3IgPSAoIGNvbG9yIC0gQWd4TWluRXYgKSAvICggQWd4TWF4RXYgLSBBZ3hNaW5FdiApO1xuXHRjb2xvciA9IGNsYW1wKCBjb2xvciwgMC4wLCAxLjAgKTtcblx0Y29sb3IgPSBhZ3hEZWZhdWx0Q29udHJhc3RBcHByb3goIGNvbG9yICk7XG5cdGNvbG9yID0gQWdYT3V0c2V0TWF0cml4ICogY29sb3I7XG5cdGNvbG9yID0gcG93KCBtYXgoIHZlYzMoIDAuMCApLCBjb2xvciApLCB2ZWMzKCAyLjIgKSApO1xuXHRjb2xvciA9IExJTkVBUl9SRUMyMDIwX1RPX0xJTkVBUl9TUkdCICogY29sb3I7XG5cdGNvbG9yID0gY2xhbXAoIGNvbG9yLCAwLjAsIDEuMCApO1xuXHRyZXR1cm4gY29sb3I7XG59XG52ZWMzIE5ldXRyYWxUb25lTWFwcGluZyggdmVjMyBjb2xvciApIHtcblx0Y29uc3QgZmxvYXQgU3RhcnRDb21wcmVzc2lvbiA9IDAuOCAtIDAuMDQ7XG5cdGNvbnN0IGZsb2F0IERlc2F0dXJhdGlvbiA9IDAuMTU7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGZsb2F0IHggPSBtaW4oIGNvbG9yLnIsIG1pbiggY29sb3IuZywgY29sb3IuYiApICk7XG5cdGZsb2F0IG9mZnNldCA9IHggPCAwLjA4ID8geCAtIDYuMjUgKiB4ICogeCA6IDAuMDQ7XG5cdGNvbG9yIC09IG9mZnNldDtcblx0ZmxvYXQgcGVhayA9IG1heCggY29sb3IuciwgbWF4KCBjb2xvci5nLCBjb2xvci5iICkgKTtcblx0aWYgKCBwZWFrIDwgU3RhcnRDb21wcmVzc2lvbiApIHJldHVybiBjb2xvcjtcblx0ZmxvYXQgZCA9IDEuIC0gU3RhcnRDb21wcmVzc2lvbjtcblx0ZmxvYXQgbmV3UGVhayA9IDEuIC0gZCAqIGQgLyAoIHBlYWsgKyBkIC0gU3RhcnRDb21wcmVzc2lvbiApO1xuXHRjb2xvciAqPSBuZXdQZWFrIC8gcGVhaztcblx0ZmxvYXQgZyA9IDEuIC0gMS4gLyAoIERlc2F0dXJhdGlvbiAqICggcGVhayAtIG5ld1BlYWsgKSArIDEuICk7XG5cdHJldHVybiBtaXgoIGNvbG9yLCB2ZWMzKCBuZXdQZWFrICksIGcgKTtcbn1cbnZlYzMgQ3VzdG9tVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7IHJldHVybiBjb2xvcjsgfSI7CgoJdmFyIHRyYW5zbWlzc2lvbl9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRtYXRlcmlhbC50cmFuc21pc3Npb24gPSB0cmFuc21pc3Npb247XG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhID0gMS4wO1xuXHRtYXRlcmlhbC50aGlja25lc3MgPSB0aGlja25lc3M7XG5cdG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2UgPSBhdHRlbnVhdGlvbkRpc3RhbmNlO1xuXHRtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yID0gYXR0ZW51YXRpb25Db2xvcjtcblx0I2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0XHRtYXRlcmlhbC50cmFuc21pc3Npb24gKj0gdGV4dHVyZTJEKCB0cmFuc21pc3Npb25NYXAsIHZUcmFuc21pc3Npb25NYXBVdiApLnI7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHRcdG1hdGVyaWFsLnRoaWNrbmVzcyAqPSB0ZXh0dXJlMkQoIHRoaWNrbmVzc01hcCwgdlRoaWNrbmVzc01hcFV2ICkuZztcblx0I2VuZGlmXG5cdHZlYzMgcG9zID0gdldvcmxkUG9zaXRpb247XG5cdHZlYzMgdiA9IG5vcm1hbGl6ZSggY2FtZXJhUG9zaXRpb24gLSBwb3MgKTtcblx0dmVjMyBuID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzQgdHJhbnNtaXR0ZWQgPSBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKFxuXHRcdG4sIHYsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuZGlmZnVzZUNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCxcblx0XHRwb3MsIG1vZGVsTWF0cml4LCB2aWV3TWF0cml4LCBwcm9qZWN0aW9uTWF0cml4LCBtYXRlcmlhbC5kaXNwZXJzaW9uLCBtYXRlcmlhbC5pb3IsIG1hdGVyaWFsLnRoaWNrbmVzcyxcblx0XHRtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yLCBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlICk7XG5cdG1hdGVyaWFsLnRyYW5zbWlzc2lvbkFscGhhID0gbWl4KCBtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYSwgdHJhbnNtaXR0ZWQuYSwgbWF0ZXJpYWwudHJhbnNtaXNzaW9uICk7XG5cdHRvdGFsRGlmZnVzZSA9IG1peCggdG90YWxEaWZmdXNlLCB0cmFuc21pdHRlZC5yZ2IsIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiApO1xuI2VuZGlmIjsKCgl2YXIgdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dW5pZm9ybSBmbG9hdCB0cmFuc21pc3Npb247XG5cdHVuaWZvcm0gZmxvYXQgdGhpY2tuZXNzO1xuXHR1bmlmb3JtIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdHVuaWZvcm0gdmVjMyBhdHRlbnVhdGlvbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHRyYW5zbWlzc2lvbk1hcDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgdGhpY2tuZXNzTWFwO1xuXHQjZW5kaWZcblx0dW5pZm9ybSB2ZWMyIHRyYW5zbWlzc2lvblNhbXBsZXJTaXplO1xuXHR1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25TYW1wbGVyTWFwO1xuXHR1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4O1xuXHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdGZsb2F0IHcwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogKCBhICogKCAtIGEgKyAzLjAgKSAtIDMuMCApICsgMS4wICk7XG5cdH1cblx0ZmxvYXQgdzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiAgYSAqICggMy4wICogYSAtIDYuMCApICsgNC4wICk7XG5cdH1cblx0ZmxvYXQgdzIoIGZsb2F0IGEgKXtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqICggYSAqICggLSAzLjAgKiBhICsgMy4wICkgKyAzLjAgKSArIDEuMCApO1xuXHR9XG5cdGZsb2F0IHczKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogYSAqIGEgKTtcblx0fVxuXHRmbG9hdCBnMCggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gdzAoIGEgKSArIHcxKCBhICk7XG5cdH1cblx0ZmxvYXQgZzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIHcyKCBhICkgKyB3MyggYSApO1xuXHR9XG5cdGZsb2F0IGgwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAtIDEuMCArIHcxKCBhICkgLyAoIHcwKCBhICkgKyB3MSggYSApICk7XG5cdH1cblx0ZmxvYXQgaDEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIDEuMCArIHczKCBhICkgLyAoIHcyKCBhICkgKyB3MyggYSApICk7XG5cdH1cblx0dmVjNCBiaWN1YmljKCBzYW1wbGVyMkQgdGV4LCB2ZWMyIHV2LCB2ZWM0IHRleGVsU2l6ZSwgZmxvYXQgbG9kICkge1xuXHRcdHV2ID0gdXYgKiB0ZXhlbFNpemUuencgKyAwLjU7XG5cdFx0dmVjMiBpdXYgPSBmbG9vciggdXYgKTtcblx0XHR2ZWMyIGZ1diA9IGZyYWN0KCB1diApO1xuXHRcdGZsb2F0IGcweCA9IGcwKCBmdXYueCApO1xuXHRcdGZsb2F0IGcxeCA9IGcxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweCA9IGgwKCBmdXYueCApO1xuXHRcdGZsb2F0IGgxeCA9IGgxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweSA9IGgwKCBmdXYueSApO1xuXHRcdGZsb2F0IGgxeSA9IGgxKCBmdXYueSApO1xuXHRcdHZlYzIgcDAgPSAoIHZlYzIoIGl1di54ICsgaDB4LCBpdXYueSArIGgweSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0dmVjMiBwMSA9ICggdmVjMiggaXV2LnggKyBoMXgsIGl1di55ICsgaDB5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHR2ZWMyIHAyID0gKCB2ZWMyKCBpdXYueCArIGgweCwgaXV2LnkgKyBoMXkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHZlYzIgcDMgPSAoIHZlYzIoIGl1di54ICsgaDF4LCBpdXYueSArIGgxeSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0cmV0dXJuIGcwKCBmdXYueSApICogKCBnMHggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAwLCBsb2QgKSArIGcxeCAqIHRleHR1cmVMb2QoIHRleCwgcDEsIGxvZCApICkgK1xuXHRcdFx0ZzEoIGZ1di55ICkgKiAoIGcweCAqIHRleHR1cmVMb2QoIHRleCwgcDIsIGxvZCApICsgZzF4ICogdGV4dHVyZUxvZCggdGV4LCBwMywgbG9kICkgKTtcblx0fVxuXHR2ZWM0IHRleHR1cmVCaWN1YmljKCBzYW1wbGVyMkQgc2FtcGxlciwgdmVjMiB1diwgZmxvYXQgbG9kICkge1xuXHRcdHZlYzIgZkxvZFNpemUgPSB2ZWMyKCB0ZXh0dXJlU2l6ZSggc2FtcGxlciwgaW50KCBsb2QgKSApICk7XG5cdFx0dmVjMiBjTG9kU2l6ZSA9IHZlYzIoIHRleHR1cmVTaXplKCBzYW1wbGVyLCBpbnQoIGxvZCArIDEuMCApICkgKTtcblx0XHR2ZWMyIGZMb2RTaXplSW52ID0gMS4wIC8gZkxvZFNpemU7XG5cdFx0dmVjMiBjTG9kU2l6ZUludiA9IDEuMCAvIGNMb2RTaXplO1xuXHRcdHZlYzQgZlNhbXBsZSA9IGJpY3ViaWMoIHNhbXBsZXIsIHV2LCB2ZWM0KCBmTG9kU2l6ZUludiwgZkxvZFNpemUgKSwgZmxvb3IoIGxvZCApICk7XG5cdFx0dmVjNCBjU2FtcGxlID0gYmljdWJpYyggc2FtcGxlciwgdXYsIHZlYzQoIGNMb2RTaXplSW52LCBjTG9kU2l6ZSApLCBjZWlsKCBsb2QgKSApO1xuXHRcdHJldHVybiBtaXgoIGZTYW1wbGUsIGNTYW1wbGUsIGZyYWN0KCBsb2QgKSApO1xuXHR9XG5cdHZlYzMgZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgdGhpY2tuZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIG1hdDQgbW9kZWxNYXRyaXggKSB7XG5cdFx0dmVjMyByZWZyYWN0aW9uVmVjdG9yID0gcmVmcmFjdCggLSB2LCBub3JtYWxpemUoIG4gKSwgMS4wIC8gaW9yICk7XG5cdFx0dmVjMyBtb2RlbFNjYWxlO1xuXHRcdG1vZGVsU2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueSA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueiA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDIgXS54eXogKSApO1xuXHRcdHJldHVybiBub3JtYWxpemUoIHJlZnJhY3Rpb25WZWN0b3IgKSAqIHRoaWNrbmVzcyAqIG1vZGVsU2NhbGU7XG5cdH1cblx0ZmxvYXQgYXBwbHlJb3JUb1JvdWdobmVzcyggY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IgKSB7XG5cdFx0cmV0dXJuIHJvdWdobmVzcyAqIGNsYW1wKCBpb3IgKiAyLjAgLSAyLjAsIDAuMCwgMS4wICk7XG5cdH1cblx0dmVjNCBnZXRUcmFuc21pc3Npb25TYW1wbGUoIGNvbnN0IGluIHZlYzIgZnJhZ0Nvb3JkLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIGZsb2F0IGlvciApIHtcblx0XHRmbG9hdCBsb2QgPSBsb2cyKCB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZS54ICkgKiBhcHBseUlvclRvUm91Z2huZXNzKCByb3VnaG5lc3MsIGlvciApO1xuXHRcdHJldHVybiB0ZXh0dXJlQmljdWJpYyggdHJhbnNtaXNzaW9uU2FtcGxlck1hcCwgZnJhZ0Nvb3JkLnh5LCBsb2QgKTtcblx0fVxuXHR2ZWMzIHZvbHVtZUF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCB0cmFuc21pc3Npb25EaXN0YW5jZSwgY29uc3QgaW4gdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlICkge1xuXHRcdGlmICggaXNpbmYoIGF0dGVudWF0aW9uRGlzdGFuY2UgKSApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmVjMyBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ID0gLWxvZyggYXR0ZW51YXRpb25Db2xvciApIC8gYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHRcdHZlYzMgdHJhbnNtaXR0YW5jZSA9IGV4cCggLSBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ICogdHJhbnNtaXNzaW9uRGlzdGFuY2UgKTtcdFx0XHRyZXR1cm4gdHJhbnNtaXR0YW5jZTtcblx0XHR9XG5cdH1cblx0dmVjNCBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvcixcblx0XHRjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiB2ZWMzIHBvc2l0aW9uLCBjb25zdCBpbiBtYXQ0IG1vZGVsTWF0cml4LFxuXHRcdGNvbnN0IGluIG1hdDQgdmlld01hdHJpeCwgY29uc3QgaW4gbWF0NCBwcm9qTWF0cml4LCBjb25zdCBpbiBmbG9hdCBkaXNwZXJzaW9uLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIGZsb2F0IHRoaWNrbmVzcyxcblx0XHRjb25zdCBpbiB2ZWMzIGF0dGVudWF0aW9uQ29sb3IsIGNvbnN0IGluIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2UgKSB7XG5cdFx0dmVjNCB0cmFuc21pdHRlZExpZ2h0O1xuXHRcdHZlYzMgdHJhbnNtaXR0YW5jZTtcblx0XHQjaWZkZWYgVVNFX0RJU1BFUlNJT05cblx0XHRcdGZsb2F0IGhhbGZTcHJlYWQgPSAoIGlvciAtIDEuMCApICogMC4wMjUgKiBkaXNwZXJzaW9uO1xuXHRcdFx0dmVjMyBpb3JzID0gdmVjMyggaW9yIC0gaGFsZlNwcmVhZCwgaW9yLCBpb3IgKyBoYWxmU3ByZWFkICk7XG5cdFx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCAzOyBpICsrICkge1xuXHRcdFx0XHR2ZWMzIHRyYW5zbWlzc2lvblJheSA9IGdldFZvbHVtZVRyYW5zbWlzc2lvblJheSggbiwgdiwgdGhpY2tuZXNzLCBpb3JzWyBpIF0sIG1vZGVsTWF0cml4ICk7XG5cdFx0XHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdFx0XHR2ZWM0IG5kY1BvcyA9IHByb2pNYXRyaXggKiB2aWV3TWF0cml4ICogdmVjNCggcmVmcmFjdGVkUmF5RXhpdCwgMS4wICk7XG5cdFx0XHRcdHZlYzIgcmVmcmFjdGlvbkNvb3JkcyA9IG5kY1Bvcy54eSAvIG5kY1Bvcy53O1xuXHRcdFx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRcdFx0cmVmcmFjdGlvbkNvb3JkcyAvPSAyLjA7XG5cdFx0XHRcdHZlYzQgdHJhbnNtaXNzaW9uU2FtcGxlID0gZ2V0VHJhbnNtaXNzaW9uU2FtcGxlKCByZWZyYWN0aW9uQ29vcmRzLCByb3VnaG5lc3MsIGlvcnNbIGkgXSApO1xuXHRcdFx0XHR0cmFuc21pdHRlZExpZ2h0WyBpIF0gPSB0cmFuc21pc3Npb25TYW1wbGVbIGkgXTtcblx0XHRcdFx0dHJhbnNtaXR0ZWRMaWdodC5hICs9IHRyYW5zbWlzc2lvblNhbXBsZS5hO1xuXHRcdFx0XHR0cmFuc21pdHRhbmNlWyBpIF0gPSBkaWZmdXNlQ29sb3JbIGkgXSAqIHZvbHVtZUF0dGVudWF0aW9uKCBsZW5ndGgoIHRyYW5zbWlzc2lvblJheSApLCBhdHRlbnVhdGlvbkNvbG9yLCBhdHRlbnVhdGlvbkRpc3RhbmNlIClbIGkgXTtcblx0XHRcdH1cblx0XHRcdHRyYW5zbWl0dGVkTGlnaHQuYSAvPSAzLjA7XG5cdFx0I2Vsc2Vcblx0XHRcdHZlYzMgdHJhbnNtaXNzaW9uUmF5ID0gZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBuLCB2LCB0aGlja25lc3MsIGlvciwgbW9kZWxNYXRyaXggKTtcblx0XHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdFx0dmVjNCBuZGNQb3MgPSBwcm9qTWF0cml4ICogdmlld01hdHJpeCAqIHZlYzQoIHJlZnJhY3RlZFJheUV4aXQsIDEuMCApO1xuXHRcdFx0dmVjMiByZWZyYWN0aW9uQ29vcmRzID0gbmRjUG9zLnh5IC8gbmRjUG9zLnc7XG5cdFx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRcdHJlZnJhY3Rpb25Db29yZHMgLz0gMi4wO1xuXHRcdFx0dHJhbnNtaXR0ZWRMaWdodCA9IGdldFRyYW5zbWlzc2lvblNhbXBsZSggcmVmcmFjdGlvbkNvb3Jkcywgcm91Z2huZXNzLCBpb3IgKTtcblx0XHRcdHRyYW5zbWl0dGFuY2UgPSBkaWZmdXNlQ29sb3IgKiB2b2x1bWVBdHRlbnVhdGlvbiggbGVuZ3RoKCB0cmFuc21pc3Npb25SYXkgKSwgYXR0ZW51YXRpb25Db2xvciwgYXR0ZW51YXRpb25EaXN0YW5jZSApO1xuXHRcdCNlbmRpZlxuXHRcdHZlYzMgYXR0ZW51YXRlZENvbG9yID0gdHJhbnNtaXR0YW5jZSAqIHRyYW5zbWl0dGVkTGlnaHQucmdiO1xuXHRcdHZlYzMgRiA9IEVudmlyb25tZW50QlJERiggbiwgdiwgc3BlY3VsYXJDb2xvciwgc3BlY3VsYXJGOTAsIHJvdWdobmVzcyApO1xuXHRcdGZsb2F0IHRyYW5zbWl0dGFuY2VGYWN0b3IgPSAoIHRyYW5zbWl0dGFuY2UuciArIHRyYW5zbWl0dGFuY2UuZyArIHRyYW5zbWl0dGFuY2UuYiApIC8gMy4wO1xuXHRcdHJldHVybiB2ZWM0KCAoIDEuMCAtIEYgKSAqIGF0dGVudWF0ZWRDb2xvciwgMS4wIC0gKCAxLjAgLSB0cmFuc21pdHRlZExpZ2h0LmEgKSAqIHRyYW5zbWl0dGFuY2VGYWN0b3IgKTtcblx0fVxuI2VuZGlmIjsKCgl2YXIgdXZfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkxpZ2h0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dmFyeWluZyB2ZWMyIHZBb01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dmFyeWluZyB2ZWMyIHZCdW1wTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHZhcnlpbmcgdmVjMiB2Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dmFyeWluZyB2ZWMyIHZFbWlzc2l2ZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1ldGFsbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdlJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dmFyeWluZyB2ZWMyIHZBbmlzb3Ryb3B5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZTaGVlblJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhckludGVuc2l0eU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHR1bmlmb3JtIG1hdDMgdHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRyYW5zbWlzc2lvbk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgdGhpY2tuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRoaWNrbmVzc01hcFV2O1xuI2VuZGlmIjsKCgl2YXIgdXZfcGFyc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBtYXQzIG1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR1bmlmb3JtIG1hdDMgYWxwaGFNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIG1hdDMgbGlnaHRNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2TGlnaHRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIG1hdDMgYW9NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QW9NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHVuaWZvcm0gbWF0MyBidW1wTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkJ1bXBNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dW5pZm9ybSBtYXQzIG5vcm1hbE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZOb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBtYXQzIGRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZEaXNwbGFjZW1lbnRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR1bmlmb3JtIG1hdDMgZW1pc3NpdmVNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2RW1pc3NpdmVNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIG1ldGFsbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZNZXRhbG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHJvdWdobmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdHVuaWZvcm0gbWF0MyBhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkFuaXNvdHJvcHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dW5pZm9ybSBtYXQzIGNsZWFyY29hdE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHVuaWZvcm0gbWF0MyBjbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzaGVlbkNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuUm91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBtYXQzIGlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhck1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdHVuaWZvcm0gbWF0MyBzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFySW50ZW5zaXR5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdHVuaWZvcm0gbWF0MyB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VHJhbnNtaXNzaW9uTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyB0aGlja25lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2VGhpY2tuZXNzTWFwVXY7XG4jZW5kaWYiOwoKCXZhciB1dl92ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9VViApIHx8IGRlZmluZWQoIFVTRV9BTklTT1RST1BZIClcblx0dlV2ID0gdmVjMyggdXYsIDEgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9NQVBcblx0dk1hcFV2ID0gKCBtYXBUcmFuc2Zvcm0gKiB2ZWMzKCBNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZBbHBoYU1hcFV2ID0gKCBhbHBoYU1hcFRyYW5zZm9ybSAqIHZlYzMoIEFMUEhBTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2TGlnaHRNYXBVdiA9ICggbGlnaHRNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBMSUdIVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dkFvTWFwVXYgPSAoIGFvTWFwVHJhbnNmb3JtICogdmVjMyggQU9NQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dkJ1bXBNYXBVdiA9ICggYnVtcE1hcFRyYW5zZm9ybSAqIHZlYzMoIEJVTVBNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR2Tm9ybWFsTWFwVXYgPSAoIG5vcm1hbE1hcFRyYW5zZm9ybSAqIHZlYzMoIE5PUk1BTE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRElTUExBQ0VNRU5UTUFQXG5cdHZEaXNwbGFjZW1lbnRNYXBVdiA9ICggZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtICogdmVjMyggRElTUExBQ0VNRU5UTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR2RW1pc3NpdmVNYXBVdiA9ICggZW1pc3NpdmVNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBFTUlTU0lWRU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTUVUQUxORVNTTUFQXG5cdHZNZXRhbG5lc3NNYXBVdiA9ICggbWV0YWxuZXNzTWFwVHJhbnNmb3JtICogdmVjMyggTUVUQUxORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9ST1VHSE5FU1NNQVBcblx0dlJvdWdobmVzc01hcFV2ID0gKCByb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBST1VHSE5FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dkFuaXNvdHJvcHlNYXBVdiA9ICggYW5pc290cm9weU1hcFRyYW5zZm9ybSAqIHZlYzMoIEFOSVNPVFJPUFlNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR2Q2xlYXJjb2F0TWFwVXYgPSAoIGNsZWFyY29hdE1hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgPSAoIGNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSAqIHZlYzMoIENMRUFSQ09BVF9OT1JNQUxNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dkNsZWFyY29hdFJvdWdobmVzc01hcFV2ID0gKCBjbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBDTEVBUkNPQVRfUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2SXJpZGVzY2VuY2VNYXBVdiA9ICggaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBJUklERVNDRU5DRU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ID0gKCBpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIElSSURFU0NFTkNFX1RISUNLTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0dlNoZWVuQ29sb3JNYXBVdiA9ICggc2hlZW5Db2xvck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNIRUVOX0NPTE9STUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dlNoZWVuUm91Z2huZXNzTWFwVXYgPSAoIHNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtICogdmVjMyggU0hFRU5fUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR2U3BlY3VsYXJNYXBVdiA9ICggc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTUEVDVUxBUk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0dlNwZWN1bGFyQ29sb3JNYXBVdiA9ICggc3BlY3VsYXJDb2xvck1hcFRyYW5zZm9ybSAqIHZlYzMoIFNQRUNVTEFSX0NPTE9STUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dlNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPSAoIHNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtICogdmVjMyggU1BFQ1VMQVJfSU5URU5TSVRZTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0dlRyYW5zbWlzc2lvbk1hcFV2ID0gKCB0cmFuc21pc3Npb25NYXBUcmFuc2Zvcm0gKiB2ZWMzKCBUUkFOU01JU1NJT05NQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR2VGhpY2tuZXNzTWFwVXYgPSAoIHRoaWNrbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIFRISUNLTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWYiOwoKCXZhciB3b3JsZHBvc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSB8fCBkZWZpbmVkKCBESVNUQU5DRSApIHx8IGRlZmluZWQgKCBVU0VfU0hBRE9XTUFQICkgfHwgZGVmaW5lZCAoIFVTRV9UUkFOU01JU1NJT04gKSB8fCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZlYzQgd29ybGRQb3NpdGlvbiA9IHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcblx0I2lmZGVmIFVTRV9CQVRDSElOR1xuXHRcdHdvcmxkUG9zaXRpb24gPSBiYXRjaGluZ01hdHJpeCAqIHdvcmxkUG9zaXRpb247XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lOU1RBTkNJTkdcblx0XHR3b3JsZFBvc2l0aW9uID0gaW5zdGFuY2VNYXRyaXggKiB3b3JsZFBvc2l0aW9uO1xuXHQjZW5kaWZcblx0d29ybGRQb3NpdGlvbiA9IG1vZGVsTWF0cml4ICogd29ybGRQb3NpdGlvbjtcbiNlbmRpZiI7CgoJY29uc3QgdmVydGV4JGggPSAidmFyeWluZyB2ZWMyIHZVdjtcbnVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbnZvaWQgbWFpbigpIHtcblx0dlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbi54eSwgMS4wLCAxLjAgKTtcbn0iOwoKCWNvbnN0IGZyYWdtZW50JGggPSAidW5pZm9ybSBzYW1wbGVyMkQgdDJEO1xudW5pZm9ybSBmbG9hdCBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xudmFyeWluZyB2ZWMyIHZVdjtcbnZvaWQgbWFpbigpIHtcblx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmUyRCggdDJELCB2VXYgKTtcblx0I2lmZGVmIERFQ09ERV9WSURFT19URVhUVVJFXG5cdFx0dGV4Q29sb3IgPSB2ZWM0KCBtaXgoIHBvdyggdGV4Q29sb3IucmdiICogMC45NDc4NjcyOTg2ICsgdmVjMyggMC4wNTIxMzI3MDE0ICksIHZlYzMoIDIuNCApICksIHRleENvbG9yLnJnYiAqIDAuMDc3Mzk5MzgwOCwgdmVjMyggbGVzc1RoYW5FcXVhbCggdGV4Q29sb3IucmdiLCB2ZWMzKCAwLjA0MDQ1ICkgKSApICksIHRleENvbG9yLncgKTtcblx0I2VuZGlmXG5cdHRleENvbG9yLnJnYiAqPSBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXhDb2xvcjtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCRnID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1Bvc2l0aW9uLnogPSBnbF9Qb3NpdGlvbi53O1xufSI7CgoJY29uc3QgZnJhZ21lbnQkZyA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcbiNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcbnVuaWZvcm0gZmxvYXQgYmFja2dyb3VuZEJsdXJyaW5lc3M7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG51bmlmb3JtIG1hdDMgYmFja2dyb3VuZFJvdGF0aW9uO1xudmFyeWluZyB2ZWMzIHZXb3JsZERpcmVjdGlvbjtcbiNpbmNsdWRlIDxjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIGJhY2tncm91bmRSb3RhdGlvbiAqIHZlYzMoIGZsaXBFbnZNYXAgKiB2V29ybGREaXJlY3Rpb24ueCwgdldvcmxkRGlyZWN0aW9uLnl6ICkgKTtcblx0I2VsaWYgZGVmaW5lZCggRU5WTUFQX1RZUEVfQ1VCRV9VViApXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgYmFja2dyb3VuZFJvdGF0aW9uICogdldvcmxkRGlyZWN0aW9uLCBiYWNrZ3JvdW5kQmx1cnJpbmVzcyApO1xuXHQjZWxzZVxuXHRcdHZlYzQgdGV4Q29sb3IgPSB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTtcblx0I2VuZGlmXG5cdHRleENvbG9yLnJnYiAqPSBiYWNrZ3JvdW5kSW50ZW5zaXR5O1xuXHRnbF9GcmFnQ29sb3IgPSB0ZXhDb2xvcjtcblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCRmID0gInZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2V29ybGREaXJlY3Rpb24gPSB0cmFuc2Zvcm1EaXJlY3Rpb24oIHBvc2l0aW9uLCBtb2RlbE1hdHJpeCApO1xuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdGdsX1Bvc2l0aW9uLnogPSBnbF9Qb3NpdGlvbi53O1xufSI7CgoJY29uc3QgZnJhZ21lbnQkZiA9ICJ1bmlmb3JtIHNhbXBsZXJDdWJlIHRDdWJlO1xudW5pZm9ybSBmbG9hdCB0RmxpcDtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlQ3ViZSggdEN1YmUsIHZlYzMoIHRGbGlwICogdldvcmxkRGlyZWN0aW9uLngsIHZXb3JsZERpcmVjdGlvbi55eiApICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHRnbF9GcmFnQ29sb3IuYSAqPSBvcGFjaXR5O1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JGUgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4PlxudmFyeWluZyB2ZWMyIHZIaWdoUHJlY2lzaW9uWlc7XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZIaWdoUHJlY2lzaW9uWlcgPSBnbF9Qb3NpdGlvbi56dztcbn0iOwoKCWNvbnN0IGZyYWdtZW50JGUgPSAiI2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHR1bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZhcnlpbmcgdmVjMiB2SGlnaFByZWNpc2lvblpXO1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdFx0ZGlmZnVzZUNvbG9yLmEgPSBvcGFjaXR5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdGZsb2F0IGZyYWdDb29yZFogPSAwLjUgKiB2SGlnaFByZWNpc2lvblpXWzBdIC8gdkhpZ2hQcmVjaXNpb25aV1sxXSArIDAuNTtcblx0I2lmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMFxuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHZlYzMoIDEuMCAtIGZyYWdDb29yZFogKSwgb3BhY2l0eSApO1xuXHQjZWxpZiBERVBUSF9QQUNLSU5HID09IDMyMDFcblx0XHRnbF9GcmFnQ29sb3IgPSBwYWNrRGVwdGhUb1JHQkEoIGZyYWdDb29yZFogKTtcblx0I2VsaWYgREVQVEhfUEFDS0lORyA9PSAzMjAyXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja0RlcHRoVG9SR0IoIGZyYWdDb29yZFogKSwgMS4wICk7XG5cdCNlbGlmIERFUFRIX1BBQ0tJTkcgPT0gMzIwM1xuXHRcdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tEZXB0aFRvUkcoIGZyYWdDb29yZFogKSwgMC4wLCAxLjAgKTtcblx0I2VuZGlmXG59IjsKCgljb25zdCB2ZXJ0ZXgkZCA9ICIjZGVmaW5lIERJU1RBTkNFXG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG59IjsKCgljb25zdCBmcmFnbWVudCRkID0gIiNkZWZpbmUgRElTVEFOQ0VcbnVuaWZvcm0gdmVjMyByZWZlcmVuY2VQb3NpdGlvbjtcbnVuaWZvcm0gZmxvYXQgbmVhckRpc3RhbmNlO1xudW5pZm9ybSBmbG9hdCBmYXJEaXN0YW5jZTtcbnZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4gKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDEuMCApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdGZsb2F0IGRpc3QgPSBsZW5ndGgoIHZXb3JsZFBvc2l0aW9uIC0gcmVmZXJlbmNlUG9zaXRpb24gKTtcblx0ZGlzdCA9ICggZGlzdCAtIG5lYXJEaXN0YW5jZSApIC8gKCBmYXJEaXN0YW5jZSAtIG5lYXJEaXN0YW5jZSApO1xuXHRkaXN0ID0gc2F0dXJhdGUoIGRpc3QgKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFja0RlcHRoVG9SR0JBKCBkaXN0ICk7XG59IjsKCgljb25zdCB2ZXJ0ZXgkYyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkYyA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0RXF1aXJlY3Q7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dmVjMyBkaXJlY3Rpb24gPSBub3JtYWxpemUoIHZXb3JsZERpcmVjdGlvbiApO1xuXHR2ZWMyIHNhbXBsZVVWID0gZXF1aXJlY3RVdiggZGlyZWN0aW9uICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRCggdEVxdWlyZWN0LCBzYW1wbGVVViApO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JGIgPSAidW5pZm9ybSBmbG9hdCBzY2FsZTtcbmF0dHJpYnV0ZSBmbG9hdCBsaW5lRGlzdGFuY2U7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdHZMaW5lRGlzdGFuY2UgPSBzY2FsZSAqIGxpbmVEaXN0YW5jZTtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkYiA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gZmxvYXQgZGFzaFNpemU7XG51bmlmb3JtIGZsb2F0IHRvdGFsU2l6ZTtcbnZhcnlpbmcgZmxvYXQgdkxpbmVEaXN0YW5jZTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSwgdG90YWxTaXplICkgPiBkYXNoU2l6ZSApIHtcblx0XHRkaXNjYXJkO1xuXHR9XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JGEgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpZiBkZWZpbmVkICggVVNFX0VOVk1BUCApIHx8IGRlZmluZWQgKCBVU0VfU0tJTk5JTkcgKVxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgljb25zdCBmcmFnbWVudCRhID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHkgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjZWxzZVxuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSB2ZWMzKCAxLjAgKTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkOSA9ICIjZGVmaW5lIExBTUJFUlRcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkOSA9ICIjZGVmaW5lIExBTUJFUlRcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCA9IFJlZmxlY3RlZExpZ2h0KCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSApO1xuXHR2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8c3BlY3VsYXJtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkOCA9ICIjZGVmaW5lIE1BVENBUFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbn0iOwoKCWNvbnN0IGZyYWdtZW50JDggPSAiI2RlZmluZSBNQVRDQVBcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xudW5pZm9ybSBzYW1wbGVyMkQgbWF0Y2FwO1xudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHR2ZWMzIHZpZXdEaXIgPSBub3JtYWxpemUoIHZWaWV3UG9zaXRpb24gKTtcblx0dmVjMyB4ID0gbm9ybWFsaXplKCB2ZWMzKCB2aWV3RGlyLnosIDAuMCwgLSB2aWV3RGlyLnggKSApO1xuXHR2ZWMzIHkgPSBjcm9zcyggdmlld0RpciwgeCApO1xuXHR2ZWMyIHV2ID0gdmVjMiggZG90KCB4LCBub3JtYWwgKSwgZG90KCB5LCBub3JtYWwgKSApICogMC40OTUgKyAwLjU7XG5cdCNpZmRlZiBVU0VfTUFUQ0FQXG5cdFx0dmVjNCBtYXRjYXBDb2xvciA9IHRleHR1cmUyRCggbWF0Y2FwLCB1diApO1xuXHQjZWxzZVxuXHRcdHZlYzQgbWF0Y2FwQ29sb3IgPSB2ZWM0KCB2ZWMzKCBtaXgoIDAuMiwgMC44LCB1di55ICkgKSwgMS4wICk7XG5cdCNlbmRpZlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiICogbWF0Y2FwQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCQ3ID0gIiNkZWZpbmUgTk9STUFMXG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cbiNpZiBkZWZpbmVkKCBGTEFUX1NIQURFRCApIHx8IGRlZmluZWQoIFVTRV9CVU1QTUFQICkgfHwgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKVxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcbiNlbmRpZlxufSI7CgoJY29uc3QgZnJhZ21lbnQkNyA9ICIjZGVmaW5lIE5PUk1BTFxudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApXG5cdHZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIHBhY2tOb3JtYWxUb1JHQiggbm9ybWFsICksIGRpZmZ1c2VDb2xvci5hICk7XG5cdCNpZmRlZiBPUEFRVUVcblx0XHRnbF9GcmFnQ29sb3IuYSA9IDEuMDtcblx0I2VuZGlmXG59IjsKCgljb25zdCB2ZXJ0ZXgkNiA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkZWZhdWx0bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfdmVydGV4PlxuXHR2Vmlld1Bvc2l0aW9uID0gLSBtdlBvc2l0aW9uLnh5ejtcblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGVudm1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKCWNvbnN0IGZyYWdtZW50JDYgPSAiI2RlZmluZSBQSE9OR1xudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIHZlYzMgc3BlY3VsYXI7XG51bmlmb3JtIGZsb2F0IHNoaW5pbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkNSA9ICIjZGVmaW5lIFNUQU5EQVJEXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxiYXRjaGluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhpbnN0YW5jZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJhdGNoaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKCWNvbnN0IGZyYWdtZW50JDUgPSAiI2RlZmluZSBTVEFOREFSRFxuI2lmZGVmIFBIWVNJQ0FMXG5cdCNkZWZpbmUgSU9SXG5cdCNkZWZpbmUgVVNFX1NQRUNVTEFSXG4jZW5kaWZcbnVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSB2ZWMzIGVtaXNzaXZlO1xudW5pZm9ybSBmbG9hdCByb3VnaG5lc3M7XG51bmlmb3JtIGZsb2F0IG1ldGFsbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpZmRlZiBJT1Jcblx0dW5pZm9ybSBmbG9hdCBpb3I7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0dW5pZm9ybSBmbG9hdCBzcGVjdWxhckludGVuc2l0eTtcblx0dW5pZm9ybSB2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhckNvbG9yTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhckludGVuc2l0eU1hcDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdHVuaWZvcm0gZmxvYXQgY2xlYXJjb2F0O1xuXHR1bmlmb3JtIGZsb2F0IGNsZWFyY29hdFJvdWdobmVzcztcbiNlbmRpZlxuI2lmZGVmIFVTRV9ESVNQRVJTSU9OXG5cdHVuaWZvcm0gZmxvYXQgZGlzcGVyc2lvbjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRVxuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlSU9SO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bTtcblx0dW5pZm9ybSBmbG9hdCBpcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5cblx0dW5pZm9ybSB2ZWMzIHNoZWVuQ29sb3I7XG5cdHVuaWZvcm0gZmxvYXQgc2hlZW5Sb3VnaG5lc3M7XG5cdCNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzaGVlbkNvbG9yTWFwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBzaGVlblJvdWdobmVzc01hcDtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHR1bmlmb3JtIHZlYzIgYW5pc290cm9weVZlY3Rvcjtcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgYW5pc290cm9weU1hcDtcblx0I2VuZGlmXG4jZW5kaWZcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFvbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGlyaWRlc2NlbmNlX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsZWFyY29hdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGlyaWRlc2NlbmNlX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8cm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIHRvdGFsRGlmZnVzZSA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgdG90YWxTcGVjdWxhciA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhcjtcblx0I2luY2x1ZGUgPHRyYW5zbWlzc2lvbl9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdG90YWxEaWZmdXNlICsgdG90YWxTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdGZsb2F0IHNoZWVuRW5lcmd5Q29tcCA9IDEuMCAtIDAuMTU3ICogbWF4MyggbWF0ZXJpYWwuc2hlZW5Db2xvciApO1xuXHRcdG91dGdvaW5nTGlnaHQgPSBvdXRnb2luZ0xpZ2h0ICogc2hlZW5FbmVyZ3lDb21wICsgc2hlZW5TcGVjdWxhckRpcmVjdCArIHNoZWVuU3BlY3VsYXJJbmRpcmVjdDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdFx0ZmxvYXQgZG90TlZjYyA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRcdHZlYzMgRmNjID0gRl9TY2hsaWNrKCBtYXRlcmlhbC5jbGVhcmNvYXRGMCwgbWF0ZXJpYWwuY2xlYXJjb2F0RjkwLCBkb3ROVmNjICk7XG5cdFx0b3V0Z29pbmdMaWdodCA9IG91dGdvaW5nTGlnaHQgKiAoIDEuMCAtIG1hdGVyaWFsLmNsZWFyY29hdCAqIEZjYyApICsgKCBjbGVhcmNvYXRTcGVjdWxhckRpcmVjdCArIGNsZWFyY29hdFNwZWN1bGFySW5kaXJlY3QgKSAqIG1hdGVyaWFsLmNsZWFyY29hdDtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7CgoJY29uc3QgdmVydGV4JDQgPSAiI2RlZmluZSBUT09OXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8YmF0Y2hpbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgljb25zdCBmcmFnbWVudCQ0ID0gIiNkZWZpbmUgVE9PTlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Z3JhZGllbnRtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxic2Rmcz5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfdG9vbl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKCWNvbnN0IHZlcnRleCQzID0gInVuaWZvcm0gZmxvYXQgc2l6ZTtcbnVuaWZvcm0gZmxvYXQgc2NhbGU7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG4jaWZkZWYgVVNFX1BPSU5UU19VVlxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuXHR1bmlmb3JtIG1hdDMgdXZUcmFuc2Zvcm07XG4jZW5kaWZcbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIFVTRV9QT0lOVFNfVVZcblx0XHR2VXYgPSAoIHV2VHJhbnNmb3JtICogdmVjMyggdXYsIDEgKSApLnh5O1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoaW5zdGFuY2VfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0Z2xfUG9pbnRTaXplID0gc2l6ZTtcblx0I2lmZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgZ2xfUG9pbnRTaXplICo9ICggc2NhbGUgLyAtIG12UG9zaXRpb24ueiApO1xuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkMyA9ICJ1bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFydGljbGVfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9wYXJ0aWNsZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkMiA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGJhdGNoaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxiYXRjaGluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGluc3RhbmNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaHRhcmdldF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubmluZ192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7CgoJY29uc3QgZnJhZ21lbnQkMiA9ICJ1bmlmb3JtIHZlYzMgY29sb3I7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggY29sb3IsIG9wYWNpdHkgKiAoIDEuMCAtIGdldFNoYWRvd01hc2soKSApICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCgljb25zdCB2ZXJ0ZXgkMSA9ICJ1bmlmb3JtIGZsb2F0IHJvdGF0aW9uO1xudW5pZm9ybSB2ZWMyIGNlbnRlcjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0dmVjNCBtdlBvc2l0aW9uID0gbW9kZWxWaWV3TWF0cml4WyAzIF07XG5cdHZlYzIgc2NhbGUgPSB2ZWMyKCBsZW5ndGgoIG1vZGVsTWF0cml4WyAwIF0ueHl6ICksIGxlbmd0aCggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHQjaWZuZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgc2NhbGUgKj0gLSBtdlBvc2l0aW9uLno7XG5cdCNlbmRpZlxuXHR2ZWMyIGFsaWduZWRQb3NpdGlvbiA9ICggcG9zaXRpb24ueHkgLSAoIGNlbnRlciAtIHZlYzIoIDAuNSApICkgKSAqIHNjYWxlO1xuXHR2ZWMyIHJvdGF0ZWRQb3NpdGlvbjtcblx0cm90YXRlZFBvc2l0aW9uLnggPSBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueCAtIHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi55O1xuXHRyb3RhdGVkUG9zaXRpb24ueSA9IHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54ICsgY29zKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdG12UG9zaXRpb24ueHkgKz0gcm90YXRlZFBvc2l0aW9uO1xuXHRnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCgljb25zdCBmcmFnbWVudCQxID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCgljb25zdCBTaGFkZXJDaHVuayA9IHsKCQlhbHBoYWhhc2hfZnJhZ21lbnQ6IGFscGhhaGFzaF9mcmFnbWVudCwKCQlhbHBoYWhhc2hfcGFyc19mcmFnbWVudDogYWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQsCgkJYWxwaGFtYXBfZnJhZ21lbnQ6IGFscGhhbWFwX2ZyYWdtZW50LAoJCWFscGhhbWFwX3BhcnNfZnJhZ21lbnQ6IGFscGhhbWFwX3BhcnNfZnJhZ21lbnQsCgkJYWxwaGF0ZXN0X2ZyYWdtZW50OiBhbHBoYXRlc3RfZnJhZ21lbnQsCgkJYWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ6IGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50LAoJCWFvbWFwX2ZyYWdtZW50OiBhb21hcF9mcmFnbWVudCwKCQlhb21hcF9wYXJzX2ZyYWdtZW50OiBhb21hcF9wYXJzX2ZyYWdtZW50LAoJCWJhdGNoaW5nX3BhcnNfdmVydGV4OiBiYXRjaGluZ19wYXJzX3ZlcnRleCwKCQliYXRjaGluZ192ZXJ0ZXg6IGJhdGNoaW5nX3ZlcnRleCwKCQliZWdpbl92ZXJ0ZXg6IGJlZ2luX3ZlcnRleCwKCQliZWdpbm5vcm1hbF92ZXJ0ZXg6IGJlZ2lubm9ybWFsX3ZlcnRleCwKCQlic2RmczogYnNkZnMsCgkJaXJpZGVzY2VuY2VfZnJhZ21lbnQ6IGlyaWRlc2NlbmNlX2ZyYWdtZW50LAoJCWJ1bXBtYXBfcGFyc19mcmFnbWVudDogYnVtcG1hcF9wYXJzX2ZyYWdtZW50LAoJCWNsaXBwaW5nX3BsYW5lc19mcmFnbWVudDogY2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50LAoJCWNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCwKCQljbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg6IGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleCwKCQljbGlwcGluZ19wbGFuZXNfdmVydGV4OiBjbGlwcGluZ19wbGFuZXNfdmVydGV4LAoJCWNvbG9yX2ZyYWdtZW50OiBjb2xvcl9mcmFnbWVudCwKCQljb2xvcl9wYXJzX2ZyYWdtZW50OiBjb2xvcl9wYXJzX2ZyYWdtZW50LAoJCWNvbG9yX3BhcnNfdmVydGV4OiBjb2xvcl9wYXJzX3ZlcnRleCwKCQljb2xvcl92ZXJ0ZXg6IGNvbG9yX3ZlcnRleCwKCQljb21tb246IGNvbW1vbiwKCQljdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ6IGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCwKCQlkZWZhdWx0bm9ybWFsX3ZlcnRleDogZGVmYXVsdG5vcm1hbF92ZXJ0ZXgsCgkJZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4OiBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXgsCgkJZGlzcGxhY2VtZW50bWFwX3ZlcnRleDogZGlzcGxhY2VtZW50bWFwX3ZlcnRleCwKCQllbWlzc2l2ZW1hcF9mcmFnbWVudDogZW1pc3NpdmVtYXBfZnJhZ21lbnQsCgkJZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudDogZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudCwKCQljb2xvcnNwYWNlX2ZyYWdtZW50OiBjb2xvcnNwYWNlX2ZyYWdtZW50LAoJCWNvbG9yc3BhY2VfcGFyc19mcmFnbWVudDogY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50LAoJCWVudm1hcF9mcmFnbWVudDogZW52bWFwX2ZyYWdtZW50LAoJCWVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudDogZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50LAoJCWVudm1hcF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGFyc19mcmFnbWVudCwKCQllbnZtYXBfcGFyc192ZXJ0ZXg6IGVudm1hcF9wYXJzX3ZlcnRleCwKCQllbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCgkJZW52bWFwX3ZlcnRleDogZW52bWFwX3ZlcnRleCwKCQlmb2dfdmVydGV4OiBmb2dfdmVydGV4LAoJCWZvZ19wYXJzX3ZlcnRleDogZm9nX3BhcnNfdmVydGV4LAoJCWZvZ19mcmFnbWVudDogZm9nX2ZyYWdtZW50LAoJCWZvZ19wYXJzX2ZyYWdtZW50OiBmb2dfcGFyc19mcmFnbWVudCwKCQlncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50OiBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50LAoJCWxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X2ZyYWdtZW50LAoJCWxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX3BhcnNfYmVnaW46IGxpZ2h0c19wYXJzX2JlZ2luLAoJCWxpZ2h0c190b29uX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9mcmFnbWVudCwKCQlsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50OiBsaWdodHNfdG9vbl9wYXJzX2ZyYWdtZW50LAoJCWxpZ2h0c19waG9uZ19mcmFnbWVudDogbGlnaHRzX3Bob25nX2ZyYWdtZW50LAoJCWxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50OiBsaWdodHNfcGhvbmdfcGFyc19mcmFnbWVudCwKCQlsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQ6IGxpZ2h0c19waHlzaWNhbF9mcmFnbWVudCwKCQlsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCgkJbGlnaHRzX2ZyYWdtZW50X2JlZ2luOiBsaWdodHNfZnJhZ21lbnRfYmVnaW4sCgkJbGlnaHRzX2ZyYWdtZW50X21hcHM6IGxpZ2h0c19mcmFnbWVudF9tYXBzLAoJCWxpZ2h0c19mcmFnbWVudF9lbmQ6IGxpZ2h0c19mcmFnbWVudF9lbmQsCgkJbG9nZGVwdGhidWZfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX2ZyYWdtZW50LAoJCWxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ6IGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQsCgkJbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg6IGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4LAoJCWxvZ2RlcHRoYnVmX3ZlcnRleDogbG9nZGVwdGhidWZfdmVydGV4LAoJCW1hcF9mcmFnbWVudDogbWFwX2ZyYWdtZW50LAoJCW1hcF9wYXJzX2ZyYWdtZW50OiBtYXBfcGFyc19mcmFnbWVudCwKCQltYXBfcGFydGljbGVfZnJhZ21lbnQ6IG1hcF9wYXJ0aWNsZV9mcmFnbWVudCwKCQltYXBfcGFydGljbGVfcGFyc19mcmFnbWVudDogbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQsCgkJbWV0YWxuZXNzbWFwX2ZyYWdtZW50OiBtZXRhbG5lc3NtYXBfZnJhZ21lbnQsCgkJbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQ6IG1ldGFsbmVzc21hcF9wYXJzX2ZyYWdtZW50LAoJCW1vcnBoaW5zdGFuY2VfdmVydGV4OiBtb3JwaGluc3RhbmNlX3ZlcnRleCwKCQltb3JwaGNvbG9yX3ZlcnRleDogbW9ycGhjb2xvcl92ZXJ0ZXgsCgkJbW9ycGhub3JtYWxfdmVydGV4OiBtb3JwaG5vcm1hbF92ZXJ0ZXgsCgkJbW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg6IG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4LAoJCW1vcnBodGFyZ2V0X3ZlcnRleDogbW9ycGh0YXJnZXRfdmVydGV4LAoJCW5vcm1hbF9mcmFnbWVudF9iZWdpbjogbm9ybWFsX2ZyYWdtZW50X2JlZ2luLAoJCW5vcm1hbF9mcmFnbWVudF9tYXBzOiBub3JtYWxfZnJhZ21lbnRfbWFwcywKCQlub3JtYWxfcGFyc19mcmFnbWVudDogbm9ybWFsX3BhcnNfZnJhZ21lbnQsCgkJbm9ybWFsX3BhcnNfdmVydGV4OiBub3JtYWxfcGFyc192ZXJ0ZXgsCgkJbm9ybWFsX3ZlcnRleDogbm9ybWFsX3ZlcnRleCwKCQlub3JtYWxtYXBfcGFyc19mcmFnbWVudDogbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQsCgkJY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbjogY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiwKCQljbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHM6IGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcywKCQljbGVhcmNvYXRfcGFyc19mcmFnbWVudDogY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQsCgkJaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudDogaXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudCwKCQlvcGFxdWVfZnJhZ21lbnQ6IG9wYXF1ZV9mcmFnbWVudCwKCQlwYWNraW5nOiBwYWNraW5nLAoJCXByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ6IHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQsCgkJcHJvamVjdF92ZXJ0ZXg6IHByb2plY3RfdmVydGV4LAoJCWRpdGhlcmluZ19mcmFnbWVudDogZGl0aGVyaW5nX2ZyYWdtZW50LAoJCWRpdGhlcmluZ19wYXJzX2ZyYWdtZW50OiBkaXRoZXJpbmdfcGFyc19mcmFnbWVudCwKCQlyb3VnaG5lc3NtYXBfZnJhZ21lbnQ6IHJvdWdobmVzc21hcF9mcmFnbWVudCwKCQlyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudDogcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQsCgkJc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50LAoJCXNoYWRvd21hcF9wYXJzX3ZlcnRleDogc2hhZG93bWFwX3BhcnNfdmVydGV4LAoJCXNoYWRvd21hcF92ZXJ0ZXg6IHNoYWRvd21hcF92ZXJ0ZXgsCgkJc2hhZG93bWFza19wYXJzX2ZyYWdtZW50OiBzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQsCgkJc2tpbmJhc2VfdmVydGV4OiBza2luYmFzZV92ZXJ0ZXgsCgkJc2tpbm5pbmdfcGFyc192ZXJ0ZXg6IHNraW5uaW5nX3BhcnNfdmVydGV4LAoJCXNraW5uaW5nX3ZlcnRleDogc2tpbm5pbmdfdmVydGV4LAoJCXNraW5ub3JtYWxfdmVydGV4OiBza2lubm9ybWFsX3ZlcnRleCwKCQlzcGVjdWxhcm1hcF9mcmFnbWVudDogc3BlY3VsYXJtYXBfZnJhZ21lbnQsCgkJc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudDogc3BlY3VsYXJtYXBfcGFyc19mcmFnbWVudCwKCQl0b25lbWFwcGluZ19mcmFnbWVudDogdG9uZW1hcHBpbmdfZnJhZ21lbnQsCgkJdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudDogdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCwKCQl0cmFuc21pc3Npb25fZnJhZ21lbnQ6IHRyYW5zbWlzc2lvbl9mcmFnbWVudCwKCQl0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudDogdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQsCgkJdXZfcGFyc19mcmFnbWVudDogdXZfcGFyc19mcmFnbWVudCwKCQl1dl9wYXJzX3ZlcnRleDogdXZfcGFyc192ZXJ0ZXgsCgkJdXZfdmVydGV4OiB1dl92ZXJ0ZXgsCgkJd29ybGRwb3NfdmVydGV4OiB3b3JsZHBvc192ZXJ0ZXgsCgoJCWJhY2tncm91bmRfdmVydDogdmVydGV4JGgsCgkJYmFja2dyb3VuZF9mcmFnOiBmcmFnbWVudCRoLAoJCWJhY2tncm91bmRDdWJlX3ZlcnQ6IHZlcnRleCRnLAoJCWJhY2tncm91bmRDdWJlX2ZyYWc6IGZyYWdtZW50JGcsCgkJY3ViZV92ZXJ0OiB2ZXJ0ZXgkZiwKCQljdWJlX2ZyYWc6IGZyYWdtZW50JGYsCgkJZGVwdGhfdmVydDogdmVydGV4JGUsCgkJZGVwdGhfZnJhZzogZnJhZ21lbnQkZSwKCQlkaXN0YW5jZVJHQkFfdmVydDogdmVydGV4JGQsCgkJZGlzdGFuY2VSR0JBX2ZyYWc6IGZyYWdtZW50JGQsCgkJZXF1aXJlY3RfdmVydDogdmVydGV4JGMsCgkJZXF1aXJlY3RfZnJhZzogZnJhZ21lbnQkYywKCQlsaW5lZGFzaGVkX3ZlcnQ6IHZlcnRleCRiLAoJCWxpbmVkYXNoZWRfZnJhZzogZnJhZ21lbnQkYiwKCQltZXNoYmFzaWNfdmVydDogdmVydGV4JGEsCgkJbWVzaGJhc2ljX2ZyYWc6IGZyYWdtZW50JGEsCgkJbWVzaGxhbWJlcnRfdmVydDogdmVydGV4JDksCgkJbWVzaGxhbWJlcnRfZnJhZzogZnJhZ21lbnQkOSwKCQltZXNobWF0Y2FwX3ZlcnQ6IHZlcnRleCQ4LAoJCW1lc2htYXRjYXBfZnJhZzogZnJhZ21lbnQkOCwKCQltZXNobm9ybWFsX3ZlcnQ6IHZlcnRleCQ3LAoJCW1lc2hub3JtYWxfZnJhZzogZnJhZ21lbnQkNywKCQltZXNocGhvbmdfdmVydDogdmVydGV4JDYsCgkJbWVzaHBob25nX2ZyYWc6IGZyYWdtZW50JDYsCgkJbWVzaHBoeXNpY2FsX3ZlcnQ6IHZlcnRleCQ1LAoJCW1lc2hwaHlzaWNhbF9mcmFnOiBmcmFnbWVudCQ1LAoJCW1lc2h0b29uX3ZlcnQ6IHZlcnRleCQ0LAoJCW1lc2h0b29uX2ZyYWc6IGZyYWdtZW50JDQsCgkJcG9pbnRzX3ZlcnQ6IHZlcnRleCQzLAoJCXBvaW50c19mcmFnOiBmcmFnbWVudCQzLAoJCXNoYWRvd192ZXJ0OiB2ZXJ0ZXgkMiwKCQlzaGFkb3dfZnJhZzogZnJhZ21lbnQkMiwKCQlzcHJpdGVfdmVydDogdmVydGV4JDEsCgkJc3ByaXRlX2ZyYWc6IGZyYWdtZW50JDEKCX07CgoJLy8gVW5pZm9ybXMgbGlicmFyeSBmb3Igc2hhcmVkIHdlYmdsIHNoYWRlcnMKCWNvbnN0IFVuaWZvcm1zTGliID0gewoKCQljb21tb246IHsKCgkJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCgkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoKCQkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCW1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgoJCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlhbHBoYU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgoJCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKCQl9LAoKCQlzcGVjdWxhcm1hcDogewoKCQkJc3BlY3VsYXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJc3BlY3VsYXJNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCWVudm1hcDogewoKCQkJZW52TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWVudk1hcFJvdGF0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJZmxpcEVudk1hcDogeyB2YWx1ZTogLTEgfSwKCQkJcmVmbGVjdGl2aXR5OiB7IHZhbHVlOiAxLjAgfSwgLy8gYmFzaWMsIGxhbWJlcnQsIHBob25nCgkJCWlvcjogeyB2YWx1ZTogMS41IH0sIC8vIHBoeXNpY2FsCgkJCXJlZnJhY3Rpb25SYXRpbzogeyB2YWx1ZTogMC45OCB9LCAvLyBiYXNpYywgbGFtYmVydCwgcGhvbmcKCgkJfSwKCgkJYW9tYXA6IHsKCgkJCWFvTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFvTWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCgkJCWFvTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCQl9LAoKCQlsaWdodG1hcDogewoKCQkJbGlnaHRNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJbGlnaHRNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKCQkJbGlnaHRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCWJ1bXBtYXA6IHsKCgkJCWJ1bXBNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJYnVtcE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCWJ1bXBTY2FsZTogeyB2YWx1ZTogMSB9CgoJCX0sCgoJCW5vcm1hbG1hcDogewoKCQkJbm9ybWFsTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCW5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCW5vcm1hbFNjYWxlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCAxLCAxICkgfQoKCQl9LAoKCQlkaXNwbGFjZW1lbnRtYXA6IHsKCgkJCWRpc3BsYWNlbWVudE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlkaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlkaXNwbGFjZW1lbnRTY2FsZTogeyB2YWx1ZTogMSB9LAoJCQlkaXNwbGFjZW1lbnRCaWFzOiB7IHZhbHVlOiAwIH0KCgkJfSwKCgkJZW1pc3NpdmVtYXA6IHsKCgkJCWVtaXNzaXZlTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWVtaXNzaXZlTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCQl9LAoKCQltZXRhbG5lc3NtYXA6IHsKCgkJCW1ldGFsbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQltZXRhbG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJCX0sCgoJCXJvdWdobmVzc21hcDogewoKCQkJcm91Z2huZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXJvdWdobmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgkJfSwKCgkJZ3JhZGllbnRtYXA6IHsKCgkJCWdyYWRpZW50TWFwOiB7IHZhbHVlOiBudWxsIH0KCgkJfSwKCgkJZm9nOiB7CgoJCQlmb2dEZW5zaXR5OiB7IHZhbHVlOiAwLjAwMDI1IH0sCgkJCWZvZ05lYXI6IHsgdmFsdWU6IDEgfSwKCQkJZm9nRmFyOiB7IHZhbHVlOiAyMDAwIH0sCgkJCWZvZ0NvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9CgoJCX0sCgoJCWxpZ2h0czogewoKCQkJYW1iaWVudExpZ2h0Q29sb3I6IHsgdmFsdWU6IFtdIH0sCgoJCQlsaWdodFByb2JlOiB7IHZhbHVlOiBbXSB9LAoKCQkJZGlyZWN0aW9uYWxMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlkaXJlY3Rpb246IHt9LAoJCQkJY29sb3I6IHt9CgkJCX0gfSwKCgkJCWRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAoJCQkJc2hhZG93Qmlhczoge30sCgkJCQlzaGFkb3dOb3JtYWxCaWFzOiB7fSwKCQkJCXNoYWRvd1JhZGl1czoge30sCgkJCQlzaGFkb3dNYXBTaXplOiB7fQoJCQl9IH0sCgoJCQlkaXJlY3Rpb25hbFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQkJZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCgoJCQlzcG90TGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQkJY29sb3I6IHt9LAoJCQkJcG9zaXRpb246IHt9LAoJCQkJZGlyZWN0aW9uOiB7fSwKCQkJCWRpc3RhbmNlOiB7fSwKCQkJCWNvbmVDb3M6IHt9LAoJCQkJcGVudW1icmFDb3M6IHt9LAoJCQkJZGVjYXk6IHt9CgkJCX0gfSwKCgkJCXNwb3RMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCgkJCQlzaGFkb3dCaWFzOiB7fSwKCQkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJCXNoYWRvd01hcFNpemU6IHt9CgkJCX0gfSwKCgkJCXNwb3RMaWdodE1hcDogeyB2YWx1ZTogW10gfSwKCQkJc3BvdFNoYWRvd01hcDogeyB2YWx1ZTogW10gfSwKCQkJc3BvdExpZ2h0TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKCQkJcG9pbnRMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQljb2xvcjoge30sCgkJCQlwb3NpdGlvbjoge30sCgkJCQlkZWNheToge30sCgkJCQlkaXN0YW5jZToge30KCQkJfSB9LAoKCQkJcG9pbnRMaWdodFNoYWRvd3M6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlzaGFkb3dJbnRlbnNpdHk6IDEsCgkJCQlzaGFkb3dCaWFzOiB7fSwKCQkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQkJc2hhZG93UmFkaXVzOiB7fSwKCQkJCXNoYWRvd01hcFNpemU6IHt9LAoJCQkJc2hhZG93Q2FtZXJhTmVhcjoge30sCgkJCQlzaGFkb3dDYW1lcmFGYXI6IHt9CgkJCX0gfSwKCgkJCXBvaW50U2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAoJCQlwb2ludFNoYWRvd01hdHJpeDogeyB2YWx1ZTogW10gfSwKCgkJCWhlbWlzcGhlcmVMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQlkaXJlY3Rpb246IHt9LAoJCQkJc2t5Q29sb3I6IHt9LAoJCQkJZ3JvdW5kQ29sb3I6IHt9CgkJCX0gfSwKCgkJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBSZWN0QXJlYUxpZ2h0IEJSREYgZGF0YSBuZWVkcyB0byBiZSBtb3ZlZCBmcm9tIGV4YW1wbGUgdG8gbWFpbiBzcmMKCQkJcmVjdEFyZWFMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCQljb2xvcjoge30sCgkJCQlwb3NpdGlvbjoge30sCgkJCQl3aWR0aDoge30sCgkJCQloZWlnaHQ6IHt9CgkJCX0gfSwKCgkJCWx0Y18xOiB7IHZhbHVlOiBudWxsIH0sCgkJCWx0Y18yOiB7IHZhbHVlOiBudWxsIH0KCgkJfSwKCgkJcG9pbnRzOiB7CgoJCQlkaWZmdXNlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9LAoJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfSwKCQkJc2l6ZTogeyB2YWx1ZTogMS4wIH0sCgkJCXNjYWxlOiB7IHZhbHVlOiAxLjAgfSwKCQkJbWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFscGhhTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJYWxwaGFUZXN0OiB7IHZhbHVlOiAwIH0sCgkJCXV2VHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCQl9LAoKCQlzcHJpdGU6IHsKCgkJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCgkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoJCQljZW50ZXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoIDAuNSwgMC41ICkgfSwKCQkJcm90YXRpb246IHsgdmFsdWU6IDAuMCB9LAoJCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJbWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJYWxwaGFNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJYWxwaGFNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKCQl9CgoJfTsKCgljb25zdCBTaGFkZXJMaWIgPSB7CgoJCWJhc2ljOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKCQkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5mb2cKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNoYmFzaWNfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY19mcmFnCgoJCX0sCgoJCWxhbWJlcnQ6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hsYW1iZXJ0X3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobGFtYmVydF9mcmFnCgoJCX0sCgoJCXBob25nOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKCQkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCQl7CgkJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQkJc3BlY3VsYXI6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDExMTExMSApIH0sCgkJCQkJc2hpbmluZXNzOiB7IHZhbHVlOiAzMCB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBob25nX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfZnJhZwoKCQl9LAoKCQlzdGFuZGFyZDogewoKCQkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLnJvdWdobmVzc21hcCwKCQkJCVVuaWZvcm1zTGliLm1ldGFsbmVzc21hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKCQkJCQlyb3VnaG5lc3M6IHsgdmFsdWU6IDEuMCB9LAoJCQkJCW1ldGFsbmVzczogeyB2YWx1ZTogMC4wIH0sCgkJCQkJZW52TWFwSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0KCQkJCX0KCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF9mcmFnCgoJCX0sCgoJCXRvb246IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ncmFkaWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCXsKCQkJCQllbWlzc2l2ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2h0b29uX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNodG9vbl9mcmFnCgoJCX0sCgoJCW1hdGNhcDogewoKCQkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCXsKCQkJCQltYXRjYXA6IHsgdmFsdWU6IG51bGwgfQoJCQkJfQoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2htYXRjYXBfZnJhZwoKCQl9LAoKCQlwb2ludHM6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLnBvaW50cywKCQkJCVVuaWZvcm1zTGliLmZvZwoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnBvaW50c192ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsucG9pbnRzX2ZyYWcKCgkJfSwKCgkJZGFzaGVkOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCQl7CgkJCQkJc2NhbGU6IHsgdmFsdWU6IDEgfSwKCQkJCQlkYXNoU2l6ZTogeyB2YWx1ZTogMSB9LAoJCQkJCXRvdGFsU2l6ZTogeyB2YWx1ZTogMiB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubGluZWRhc2hlZF9mcmFnCgoJCX0sCgoJCWRlcHRoOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZGVwdGhfZnJhZwoKCQl9LAoKCQlub3JtYWw6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCQl7CgkJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJCX0KCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobm9ybWFsX2ZyYWcKCgkJfSwKCgkJc3ByaXRlOiB7CgoJCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCQlVbmlmb3Jtc0xpYi5zcHJpdGUsCgkJCQlVbmlmb3Jtc0xpYi5mb2cKCQkJXSApLAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zcHJpdGVfdmVydCwKCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLnNwcml0ZV9mcmFnCgoJCX0sCgoJCWJhY2tncm91bmQ6IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQl1dlRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQl0MkQ6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWJhY2tncm91bmRJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfQoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX2ZyYWcKCgkJfSwKCgkJYmFja2dyb3VuZEN1YmU6IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQllbnZNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWZsaXBFbnZNYXA6IHsgdmFsdWU6IC0xIH0sCgkJCQliYWNrZ3JvdW5kQmx1cnJpbmVzczogeyB2YWx1ZTogMCB9LAoJCQkJYmFja2dyb3VuZEludGVuc2l0eTogeyB2YWx1ZTogMSB9LAoJCQkJYmFja2dyb3VuZFJvdGF0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kQ3ViZV92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuYmFja2dyb3VuZEN1YmVfZnJhZwoKCQl9LAoKCQljdWJlOiB7CgoJCQl1bmlmb3JtczogewoJCQkJdEN1YmU6IHsgdmFsdWU6IG51bGwgfSwKCQkJCXRGbGlwOiB7IHZhbHVlOiAtMSB9LAoJCQkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0KCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV92ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV9mcmFnCgoJCX0sCgoJCWVxdWlyZWN0OiB7CgoJCQl1bmlmb3JtczogewoJCQkJdEVxdWlyZWN0OiB7IHZhbHVlOiBudWxsIH0sCgkJCX0sCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmVxdWlyZWN0X3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5lcXVpcmVjdF9mcmFnCgoJCX0sCgoJCWRpc3RhbmNlUkdCQTogewoKCQkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQkJewoJCQkJCXJlZmVyZW5jZVBvc2l0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkgfSwKCQkJCQluZWFyRGlzdGFuY2U6IHsgdmFsdWU6IDEgfSwKCQkJCQlmYXJEaXN0YW5jZTogeyB2YWx1ZTogMTAwMCB9CgkJCQl9CgkJCV0gKSwKCgkJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZGlzdGFuY2VSR0JBX3ZlcnQsCgkJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfZnJhZwoKCQl9LAoKCQlzaGFkb3c6IHsKCgkJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJCVVuaWZvcm1zTGliLmZvZywKCQkJCXsKCQkJCQljb2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAgKSB9LAoJCQkJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9CgkJCQl9LAoJCQldICksCgoJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnNoYWRvd192ZXJ0LAoJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X2ZyYWcKCgkJfQoKCX07CgoJU2hhZGVyTGliLnBoeXNpY2FsID0gewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVNoYWRlckxpYi5zdGFuZGFyZC51bmlmb3JtcywKCQkJewoJCQkJY2xlYXJjb2F0OiB7IHZhbHVlOiAwIH0sCgkJCQljbGVhcmNvYXRNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWNsZWFyY29hdE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQljbGVhcmNvYXROb3JtYWxNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCWNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQljbGVhcmNvYXROb3JtYWxTY2FsZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMSwgMSApIH0sCgkJCQljbGVhcmNvYXRSb3VnaG5lc3M6IHsgdmFsdWU6IDAgfSwKCQkJCWNsZWFyY29hdFJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCWRpc3BlcnNpb246IHsgdmFsdWU6IDAgfSwKCQkJCWlyaWRlc2NlbmNlOiB7IHZhbHVlOiAwIH0sCgkJCQlpcmlkZXNjZW5jZU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJaXJpZGVzY2VuY2VJT1I6IHsgdmFsdWU6IDEuMyB9LAoJCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtOiB7IHZhbHVlOiAxMDAgfSwKCQkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTogeyB2YWx1ZTogNDAwIH0sCgkJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJc2hlZW46IHsgdmFsdWU6IDAgfSwKCQkJCXNoZWVuQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQlzaGVlbkNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlzaGVlbkNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCXNoZWVuUm91Z2huZXNzOiB7IHZhbHVlOiAxIH0sCgkJCQlzaGVlblJvdWdobmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJdHJhbnNtaXNzaW9uOiB7IHZhbHVlOiAwIH0sCgkJCQl0cmFuc21pc3Npb25NYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJCXRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCQl0cmFuc21pc3Npb25TYW1wbGVyU2l6ZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCgkJCQl0cmFuc21pc3Npb25TYW1wbGVyTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQl0aGlja25lc3M6IHsgdmFsdWU6IDAgfSwKCQkJCXRoaWNrbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJdGhpY2tuZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCWF0dGVudWF0aW9uRGlzdGFuY2U6IHsgdmFsdWU6IDAgfSwKCQkJCWF0dGVudWF0aW9uQ29sb3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQlzcGVjdWxhckNvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMSwgMSwgMSApIH0sCgkJCQlzcGVjdWxhckNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlzcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJCXNwZWN1bGFySW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0sCgkJCQlzcGVjdWxhckludGVuc2l0eU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQkJYW5pc290cm9weVZlY3RvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpIH0sCgkJCQlhbmlzb3Ryb3B5TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlhbmlzb3Ryb3B5TWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaHBoeXNpY2FsX2ZyYWcKCgl9OwoKCWNvbnN0IF9yZ2IgPSB7IHI6IDAsIGI6IDAsIGc6IDAgfTsKCWNvbnN0IF9lMSQxID0gLypAX19QVVJFX18qLyBuZXcgRXVsZXIoKTsKCWNvbnN0IF9tMSQxID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKCWZ1bmN0aW9uIFdlYkdMQmFja2dyb3VuZCggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBzdGF0ZSwgb2JqZWN0cywgYWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJY29uc3QgY2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQlsZXQgY2xlYXJBbHBoYSA9IGFscGhhID09PSB0cnVlID8gMCA6IDE7CgoJCWxldCBwbGFuZU1lc2g7CgkJbGV0IGJveE1lc2g7CgoJCWxldCBjdXJyZW50QmFja2dyb3VuZCA9IG51bGw7CgkJbGV0IGN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IDA7CgkJbGV0IGN1cnJlbnRUb25lbWFwcGluZyA9IG51bGw7CgoJCWZ1bmN0aW9uIGdldEJhY2tncm91bmQoIHNjZW5lICkgewoKCQkJbGV0IGJhY2tncm91bmQgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUuYmFja2dyb3VuZCA6IG51bGw7CgoJCQlpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc1RleHR1cmUgKSB7CgoJCQkJY29uc3QgdXNlUE1SRU0gPSBzY2VuZS5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDA7IC8vIHVzZSBQTVJFTSBpZiB0aGUgdXNlciB3YW50cyB0byBibHVyIHRoZSBiYWNrZ3JvdW5kCgkJCQliYWNrZ3JvdW5kID0gKCB1c2VQTVJFTSA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggYmFja2dyb3VuZCApOwoKCQkJfQoKCQkJcmV0dXJuIGJhY2tncm91bmQ7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyKCBzY2VuZSApIHsKCgkJCWxldCBmb3JjZUNsZWFyID0gZmFsc2U7CgkJCWNvbnN0IGJhY2tncm91bmQgPSBnZXRCYWNrZ3JvdW5kKCBzY2VuZSApOwoKCQkJaWYgKCBiYWNrZ3JvdW5kID09PSBudWxsICkgewoKCQkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCQl9IGVsc2UgaWYgKCBiYWNrZ3JvdW5kICYmIGJhY2tncm91bmQuaXNDb2xvciApIHsKCgkJCQlzZXRDbGVhciggYmFja2dyb3VuZCwgMSApOwoJCQkJZm9yY2VDbGVhciA9IHRydWU7CgoJCQl9CgoJCQljb25zdCBlbnZpcm9ubWVudEJsZW5kTW9kZSA9IHJlbmRlcmVyLnhyLmdldEVudmlyb25tZW50QmxlbmRNb2RlKCk7CgoJCQlpZiAoIGVudmlyb25tZW50QmxlbmRNb2RlID09PSAnYWRkaXRpdmUnICkgewoKCQkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0Q2xlYXIoIDAsIDAsIDAsIDEsIHByZW11bHRpcGxpZWRBbHBoYSApOwoKCQkJfSBlbHNlIGlmICggZW52aXJvbm1lbnRCbGVuZE1vZGUgPT09ICdhbHBoYS1ibGVuZCcgKSB7CgoJCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMCwgMCwgMCwgMCwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJCQl9CgoJCQlpZiAoIHJlbmRlcmVyLmF1dG9DbGVhciB8fCBmb3JjZUNsZWFyICkgewoKCQkJCS8vIGJ1ZmZlcnMgbWlnaHQgbm90IGJlIHdyaXRhYmxlIHdoaWNoIGlzIHJlcXVpcmVkIHRvIGVuc3VyZSBhIGNvcnJlY3QgY2xlYXIKCgkJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQkJCXN0YXRlLmJ1ZmZlcnMuZGVwdGguc2V0TWFzayggdHJ1ZSApOwoJCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRNYXNrKCB0cnVlICk7CgoJCQkJcmVuZGVyZXIuY2xlYXIoIHJlbmRlcmVyLmF1dG9DbGVhckNvbG9yLCByZW5kZXJlci5hdXRvQ2xlYXJEZXB0aCwgcmVuZGVyZXIuYXV0b0NsZWFyU3RlbmNpbCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGFkZFRvUmVuZGVyTGlzdCggcmVuZGVyTGlzdCwgc2NlbmUgKSB7CgoJCQljb25zdCBiYWNrZ3JvdW5kID0gZ2V0QmFja2dyb3VuZCggc2NlbmUgKTsKCgkJCWlmICggYmFja2dyb3VuZCAmJiAoIGJhY2tncm91bmQuaXNDdWJlVGV4dHVyZSB8fCBiYWNrZ3JvdW5kLm1hcHBpbmcgPT09IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nICkgKSB7CgoJCQkJaWYgKCBib3hNZXNoID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWJveE1lc2ggPSBuZXcgTWVzaCgKCQkJCQkJbmV3IEJveEdlb21ldHJ5KCAxLCAxLCAxICksCgkJCQkJCW5ldyBTaGFkZXJNYXRlcmlhbCggewoJCQkJCQkJbmFtZTogJ0JhY2tncm91bmRDdWJlTWF0ZXJpYWwnLAoJCQkJCQkJdW5pZm9ybXM6IGNsb25lVW5pZm9ybXMoIFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS51bmlmb3JtcyApLAoJCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZEN1YmUudmVydGV4U2hhZGVyLAoJCQkJCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kQ3ViZS5mcmFnbWVudFNoYWRlciwKCQkJCQkJCXNpZGU6IEJhY2tTaWRlLAoJCQkJCQkJZGVwdGhUZXN0OiBmYWxzZSwKCQkJCQkJCWRlcHRoV3JpdGU6IGZhbHNlLAoJCQkJCQkJZm9nOiBmYWxzZSwKCQkJCQkJCWFsbG93T3ZlcnJpZGU6IGZhbHNlCgkJCQkJCX0gKQoJCQkJCSk7CgoJCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAnbm9ybWFsJyApOwoJCQkJCWJveE1lc2guZ2VvbWV0cnkuZGVsZXRlQXR0cmlidXRlKCAndXYnICk7CgoJCQkJCWJveE1lc2gub25CZWZvcmVSZW5kZXIgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5UG9zaXRpb24oIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKCQkJCQl9OwoKCQkJCQkvLyBhZGQgImVudk1hcCIgbWF0ZXJpYWwgcHJvcGVydHkgc28gdGhlIHJlbmRlcmVyIGNhbiBldmFsdWF0ZSBpdCBsaWtlIGZvciBidWlsdC1pbiBtYXRlcmlhbHMKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIGJveE1lc2gubWF0ZXJpYWwsICdlbnZNYXAnLCB7CgoJCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5lbnZNYXAudmFsdWU7CgoJCQkJCQl9CgoJCQkJCX0gKTsKCgkJCQkJb2JqZWN0cy51cGRhdGUoIGJveE1lc2ggKTsKCgkJCQl9CgoJCQkJX2UxJDEuY29weSggc2NlbmUuYmFja2dyb3VuZFJvdGF0aW9uICk7CgoJCQkJLy8gYWNjb21tb2RhdGUgbGVmdC1oYW5kZWQgZnJhbWUKCQkJCV9lMSQxLnggKj0gLTE7IF9lMSQxLnkgKj0gLTE7IF9lMSQxLnogKj0gLTE7CgoJCQkJaWYgKCBiYWNrZ3JvdW5kLmlzQ3ViZVRleHR1cmUgJiYgYmFja2dyb3VuZC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgewoKCQkJCQkvLyBlbnZpcm9ubWVudCBtYXBzIHdoaWNoIGFyZSBub3QgY3ViZSByZW5kZXIgdGFyZ2V0cyBvciBQTVJFTXMgZm9sbG93IGEgZGlmZmVyZW50IGNvbnZlbnRpb24KCQkJCQlfZTEkMS55ICo9IC0xOwoJCQkJCV9lMSQxLnogKj0gLTE7CgoJCQkJfQoKCQkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZW52TWFwLnZhbHVlID0gYmFja2dyb3VuZDsKCQkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggYmFja2dyb3VuZC5pc0N1YmVUZXh0dXJlICYmIGJhY2tncm91bmQuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLTEgOiAxOwoJCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcy52YWx1ZSA9IHNjZW5lLmJhY2tncm91bmRCbHVycmluZXNzOwoJCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuYmFja2dyb3VuZFJvdGF0aW9uLnZhbHVlLnNldEZyb21NYXRyaXg0KCBfbTEkMS5tYWtlUm90YXRpb25Gcm9tRXVsZXIoIF9lMSQxICkgKTsKCQkJCWJveE1lc2gubWF0ZXJpYWwudG9uZU1hcHBlZCA9IENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggYmFja2dyb3VuZC5jb2xvclNwYWNlICkgIT09IFNSR0JUcmFuc2ZlcjsKCgkJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKCQkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKCQkJCQlib3hNZXNoLm1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJY3VycmVudEJhY2tncm91bmQgPSBiYWNrZ3JvdW5kOwoJCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IGJhY2tncm91bmQudmVyc2lvbjsKCQkJCQljdXJyZW50VG9uZW1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCgkJCQl9CgoJCQkJYm94TWVzaC5sYXllcnMuZW5hYmxlQWxsKCk7CgoJCQkJLy8gcHVzaCB0byB0aGUgcHJlLXNvcnRlZCBvcGFxdWUgcmVuZGVyIGxpc3QKCQkJCXJlbmRlckxpc3QudW5zaGlmdCggYm94TWVzaCwgYm94TWVzaC5nZW9tZXRyeSwgYm94TWVzaC5tYXRlcmlhbCwgMCwgMCwgbnVsbCApOwoKCQkJfSBlbHNlIGlmICggYmFja2dyb3VuZCAmJiBiYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCgkJCQlpZiAoIHBsYW5lTWVzaCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlwbGFuZU1lc2ggPSBuZXcgTWVzaCgKCQkJCQkJbmV3IFBsYW5lR2VvbWV0cnkoIDIsIDIgKSwKCQkJCQkJbmV3IFNoYWRlck1hdGVyaWFsKCB7CgkJCQkJCQluYW1lOiAnQmFja2dyb3VuZE1hdGVyaWFsJywKCQkJCQkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBTaGFkZXJMaWIuYmFja2dyb3VuZC51bmlmb3JtcyApLAoJCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZC52ZXJ0ZXhTaGFkZXIsCgkJCQkJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyTGliLmJhY2tncm91bmQuZnJhZ21lbnRTaGFkZXIsCgkJCQkJCQlzaWRlOiBGcm9udFNpZGUsCgkJCQkJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQkJCQkJZGVwdGhXcml0ZTogZmFsc2UsCgkJCQkJCQlmb2c6IGZhbHNlLAoJCQkJCQkJYWxsb3dPdmVycmlkZTogZmFsc2UKCQkJCQkJfSApCgkJCQkJKTsKCgkJCQkJcGxhbmVNZXNoLmdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSggJ25vcm1hbCcgKTsKCgkJCQkJLy8gYWRkICJtYXAiIG1hdGVyaWFsIHByb3BlcnR5IHNvIHRoZSByZW5kZXJlciBjYW4gZXZhbHVhdGUgaXQgbGlrZSBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzCgkJCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCBwbGFuZU1lc2gubWF0ZXJpYWwsICdtYXAnLCB7CgoJCQkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy50MkQudmFsdWU7CgoJCQkJCQl9CgoJCQkJCX0gKTsKCgkJCQkJb2JqZWN0cy51cGRhdGUoIHBsYW5lTWVzaCApOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudDJELnZhbHVlID0gYmFja2dyb3VuZDsKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC50b25lTWFwcGVkID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBiYWNrZ3JvdW5kLmNvbG9yU3BhY2UgKSAhPT0gU1JHQlRyYW5zZmVyOwoKCQkJCWlmICggYmFja2dyb3VuZC5tYXRyaXhBdXRvVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQliYWNrZ3JvdW5kLnVwZGF0ZU1hdHJpeCgpOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubWF0ZXJpYWwudW5pZm9ybXMudXZUcmFuc2Zvcm0udmFsdWUuY29weSggYmFja2dyb3VuZC5tYXRyaXggKTsKCgkJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uICE9PSBiYWNrZ3JvdW5kLnZlcnNpb24gfHwKCQkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKCQkJCQlwbGFuZU1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCQljdXJyZW50QmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CgkJCQkJY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gYmFja2dyb3VuZC52ZXJzaW9uOwoJCQkJCWN1cnJlbnRUb25lbWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKCQkJCX0KCgkJCQlwbGFuZU1lc2gubGF5ZXJzLmVuYWJsZUFsbCgpOwoKCQkJCS8vIHB1c2ggdG8gdGhlIHByZS1zb3J0ZWQgb3BhcXVlIHJlbmRlciBsaXN0CgkJCQlyZW5kZXJMaXN0LnVuc2hpZnQoIHBsYW5lTWVzaCwgcGxhbmVNZXNoLmdlb21ldHJ5LCBwbGFuZU1lc2gubWF0ZXJpYWwsIDAsIDAsIG51bGwgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXRDbGVhciggY29sb3IsIGFscGhhICkgewoKCQkJY29sb3IuZ2V0UkdCKCBfcmdiLCBnZXRVbmxpdFVuaWZvcm1Db2xvclNwYWNlKCByZW5kZXJlciApICk7CgoJCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCBfcmdiLnIsIF9yZ2IuZywgX3JnYi5iLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCWlmICggYm94TWVzaCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWJveE1lc2guZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCQkJYm94TWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQkJYm94TWVzaCA9IHVuZGVmaW5lZDsKCgkJCX0KCgkJCWlmICggcGxhbmVNZXNoICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcGxhbmVNZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQkJCXBsYW5lTWVzaC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQkJcGxhbmVNZXNoID0gdW5kZWZpbmVkOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7CgoJCQlnZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGNsZWFyQ29sb3I7CgoJCQl9LAoJCQlzZXRDbGVhckNvbG9yOiBmdW5jdGlvbiAoIGNvbG9yLCBhbHBoYSA9IDEgKSB7CgoJCQkJY2xlYXJDb2xvci5zZXQoIGNvbG9yICk7CgkJCQljbGVhckFscGhhID0gYWxwaGE7CgkJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKCQkJfSwKCQkJZ2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBjbGVhckFscGhhOwoKCQkJfSwKCQkJc2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCBhbHBoYSApIHsKCgkJCQljbGVhckFscGhhID0gYWxwaGE7CgkJCQlzZXRDbGVhciggY2xlYXJDb2xvciwgY2xlYXJBbHBoYSApOwoKCQkJfSwKCQkJcmVuZGVyOiByZW5kZXIsCgkJCWFkZFRvUmVuZGVyTGlzdDogYWRkVG9SZW5kZXJMaXN0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQmluZGluZ1N0YXRlcyggZ2wsIGF0dHJpYnV0ZXMgKSB7CgoJCWNvbnN0IG1heFZlcnRleEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwoKCQljb25zdCBiaW5kaW5nU3RhdGVzID0ge307CgoJCWNvbnN0IGRlZmF1bHRTdGF0ZSA9IGNyZWF0ZUJpbmRpbmdTdGF0ZSggbnVsbCApOwoJCWxldCBjdXJyZW50U3RhdGUgPSBkZWZhdWx0U3RhdGU7CgkJbGV0IGZvcmNlVXBkYXRlID0gZmFsc2U7CgoJCWZ1bmN0aW9uIHNldHVwKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSwgaW5kZXggKSB7CgoJCQlsZXQgdXBkYXRlQnVmZmVycyA9IGZhbHNlOwoKCQkJY29uc3Qgc3RhdGUgPSBnZXRCaW5kaW5nU3RhdGUoIGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCApOwoKCQkJaWYgKCBjdXJyZW50U3RhdGUgIT09IHN0YXRlICkgewoKCQkJCWN1cnJlbnRTdGF0ZSA9IHN0YXRlOwoJCQkJYmluZFZlcnRleEFycmF5T2JqZWN0KCBjdXJyZW50U3RhdGUub2JqZWN0ICk7CgoJCQl9CgoJCQl1cGRhdGVCdWZmZXJzID0gbmVlZHNVcGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0sIGluZGV4ICk7CgoJCQlpZiAoIHVwZGF0ZUJ1ZmZlcnMgKSBzYXZlQ2FjaGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0sIGluZGV4ICk7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBpbmRleCwgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIgKTsKCgkJCX0KCgkJCWlmICggdXBkYXRlQnVmZmVycyB8fCBmb3JjZVVwZGF0ZSApIHsKCgkJCQlmb3JjZVVwZGF0ZSA9IGZhbHNlOwoKCQkJCXNldHVwVmVydGV4QXR0cmlidXRlcyggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnkgKTsKCgkJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCQlnbC5iaW5kQnVmZmVyKCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYXR0cmlidXRlcy5nZXQoIGluZGV4ICkuYnVmZmVyICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgewoKCQkJcmV0dXJuIGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7CgoJCX0KCgkJZnVuY3Rpb24gYmluZFZlcnRleEFycmF5T2JqZWN0KCB2YW8gKSB7CgoJCQlyZXR1cm4gZ2wuYmluZFZlcnRleEFycmF5KCB2YW8gKTsKCgkJfQoKCQlmdW5jdGlvbiBkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCggdmFvICkgewoKCQkJcmV0dXJuIGdsLmRlbGV0ZVZlcnRleEFycmF5KCB2YW8gKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRCaW5kaW5nU3RhdGUoIGdlb21ldHJ5LCBwcm9ncmFtLCBtYXRlcmlhbCApIHsKCgkJCWNvbnN0IHdpcmVmcmFtZSA9ICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICk7CgoJCQlsZXQgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCQlpZiAoIHByb2dyYW1NYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwcm9ncmFtTWFwID0ge307CgkJCQliaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdID0gcHJvZ3JhbU1hcDsKCgkJCX0KCgkJCWxldCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCgkJCWlmICggc3RhdGVNYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlzdGF0ZU1hcCA9IHt9OwoJCQkJcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID0gc3RhdGVNYXA7CgoJCQl9CgoJCQlsZXQgc3RhdGUgPSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgoJCQlpZiAoIHN0YXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc3RhdGUgPSBjcmVhdGVCaW5kaW5nU3RhdGUoIGNyZWF0ZVZlcnRleEFycmF5T2JqZWN0KCkgKTsKCQkJCXN0YXRlTWFwWyB3aXJlZnJhbWUgXSA9IHN0YXRlOwoKCQkJfQoKCQkJcmV0dXJuIHN0YXRlOwoKCQl9CgoJCWZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdTdGF0ZSggdmFvICkgewoKCQkJY29uc3QgbmV3QXR0cmlidXRlcyA9IFtdOwoJCQljb25zdCBlbmFibGVkQXR0cmlidXRlcyA9IFtdOwoJCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbWF4VmVydGV4QXR0cmlidXRlczsgaSArKyApIHsKCgkJCQluZXdBdHRyaWJ1dGVzWyBpIF0gPSAwOwoJCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSA9IDA7CgkJCQlhdHRyaWJ1dGVEaXZpc29yc1sgaSBdID0gMDsKCgkJCX0KCgkJCXJldHVybiB7CgoJCQkJLy8gZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgb24gbm9uLVZBTyBzdXBwb3J0IGJyb3dzZXIKCQkJCWdlb21ldHJ5OiBudWxsLAoJCQkJcHJvZ3JhbTogbnVsbCwKCQkJCXdpcmVmcmFtZTogZmFsc2UsCgoJCQkJbmV3QXR0cmlidXRlczogbmV3QXR0cmlidXRlcywKCQkJCWVuYWJsZWRBdHRyaWJ1dGVzOiBlbmFibGVkQXR0cmlidXRlcywKCQkJCWF0dHJpYnV0ZURpdmlzb3JzOiBhdHRyaWJ1dGVEaXZpc29ycywKCQkJCW9iamVjdDogdmFvLAoJCQkJYXR0cmlidXRlczoge30sCgkJCQlpbmRleDogbnVsbAoKCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiBuZWVkc1VwZGF0ZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgoJCQljb25zdCBjYWNoZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmF0dHJpYnV0ZXM7CgkJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgoJCQlsZXQgYXR0cmlidXRlc051bSA9IDA7CgoJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBwcm9ncmFtQXR0cmlidXRlcyApIHsKCgkJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gPj0gMCApIHsKCgkJCQkJY29uc3QgY2FjaGVkQXR0cmlidXRlID0gY2FjaGVkQXR0cmlidXRlc1sgbmFtZSBdOwoJCQkJCWxldCBnZW9tZXRyeUF0dHJpYnV0ZSA9IGdlb21ldHJ5QXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CgkJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlQ29sb3InICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VDb2xvcjsKCgkJCQkJfQoKCQkJCQlpZiAoIGNhY2hlZEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIHRydWU7CgoJCQkJCWlmICggY2FjaGVkQXR0cmlidXRlLmF0dHJpYnV0ZSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUgKSByZXR1cm4gdHJ1ZTsKCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSAmJiBjYWNoZWRBdHRyaWJ1dGUuZGF0YSAhPT0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YSApIHJldHVybiB0cnVlOwoKCQkJCQlhdHRyaWJ1dGVzTnVtICsrOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggY3VycmVudFN0YXRlLmF0dHJpYnV0ZXNOdW0gIT09IGF0dHJpYnV0ZXNOdW0gKSByZXR1cm4gdHJ1ZTsKCgkJCWlmICggY3VycmVudFN0YXRlLmluZGV4ICE9PSBpbmRleCApIHJldHVybiB0cnVlOwoKCQkJcmV0dXJuIGZhbHNlOwoKCQl9CgoJCWZ1bmN0aW9uIHNhdmVDYWNoZSggb2JqZWN0LCBnZW9tZXRyeSwgcHJvZ3JhbSwgaW5kZXggKSB7CgoJCQljb25zdCBjYWNoZSA9IHt9OwoJCQljb25zdCBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCQkJbGV0IGF0dHJpYnV0ZXNOdW0gPSAwOwoKCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJCWZvciAoIGNvbnN0IG5hbWUgaW4gcHJvZ3JhbUF0dHJpYnV0ZXMgKSB7CgoJCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uID49IDAgKSB7CgoJCQkJCWxldCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJCWlmICggYXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgYXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKCQkJCQl9CgoJCQkJCWNvbnN0IGRhdGEgPSB7fTsKCQkJCQlkYXRhLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTsKCgkJCQkJaWYgKCBhdHRyaWJ1dGUgJiYgYXR0cmlidXRlLmRhdGEgKSB7CgoJCQkJCQlkYXRhLmRhdGEgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJCQkJfQoKCQkJCQljYWNoZVsgbmFtZSBdID0gZGF0YTsKCgkJCQkJYXR0cmlidXRlc051bSArKzsKCgkJCQl9CgoJCQl9CgoJCQljdXJyZW50U3RhdGUuYXR0cmlidXRlcyA9IGNhY2hlOwoJCQljdXJyZW50U3RhdGUuYXR0cmlidXRlc051bSA9IGF0dHJpYnV0ZXNOdW07CgoJCQljdXJyZW50U3RhdGUuaW5kZXggPSBpbmRleDsKCgkJfQoKCQlmdW5jdGlvbiBpbml0QXR0cmlidXRlcygpIHsKCgkJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBuZXdBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCW5ld0F0dHJpYnV0ZXNbIGkgXSA9IDA7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZW5hYmxlQXR0cmlidXRlKCBhdHRyaWJ1dGUgKSB7CgoJCQllbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIDAgKTsKCgkJfQoKCQlmdW5jdGlvbiBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKSB7CgoJCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CgkJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwoJCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVEaXZpc29yczsKCgkJCW5ld0F0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCgkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID09PSAwICkgewoKCQkJCWdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KCBhdHRyaWJ1dGUgKTsKCQkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBhdHRyaWJ1dGUgXSA9IDE7CgoJCQl9CgoJCQlpZiAoIGF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSAhPT0gbWVzaFBlckF0dHJpYnV0ZSApIHsKCgkJCQlnbC52ZXJ0ZXhBdHRyaWJEaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKTsKCQkJCWF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSA9IG1lc2hQZXJBdHRyaWJ1dGU7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKSB7CgoJCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLm5ld0F0dHJpYnV0ZXM7CgkJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGVuYWJsZWRBdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWlmICggZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSAhPT0gbmV3QXR0cmlidXRlc1sgaSBdICkgewoKCQkJCQlnbC5kaXNhYmxlVmVydGV4QXR0cmliQXJyYXkoIGkgKTsKCQkJCQllbmFibGVkQXR0cmlidXRlc1sgaSBdID0gMDsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0LCBpbnRlZ2VyICkgewoKCQkJaWYgKCBpbnRlZ2VyID09PSB0cnVlICkgewoKCQkJCWdsLnZlcnRleEF0dHJpYklQb2ludGVyKCBpbmRleCwgc2l6ZSwgdHlwZSwgc3RyaWRlLCBvZmZzZXQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJZ2wudmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSApIHsKCgkJCWluaXRBdHRyaWJ1dGVzKCk7CgoJCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJCWNvbnN0IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyA9IG1hdGVyaWFsLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXM7CgoJCQlmb3IgKCBjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKCQkJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGUgPSBwcm9ncmFtQXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJCWlmICggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiA+PSAwICkgewoKCQkJCQlsZXQgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBnZW9tZXRyeUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VNYXRyaXgnICYmIG9iamVjdC5pbnN0YW5jZU1hdHJpeCApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlTWF0cml4OwoJCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlQ29sb3I7CgoJCQkJCX0KCgkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJY29uc3Qgbm9ybWFsaXplZCA9IGdlb21ldHJ5QXR0cmlidXRlLm5vcm1hbGl6ZWQ7CgkJCQkJCWNvbnN0IHNpemUgPSBnZW9tZXRyeUF0dHJpYnV0ZS5pdGVtU2l6ZTsKCgkJCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeUF0dHJpYnV0ZSApOwoKCQkJCQkJLy8gVE9ETyBBdHRyaWJ1dGUgbWF5IG5vdCBiZSBhdmFpbGFibGUgb24gY29udGV4dCByZXN0b3JlCgoJCQkJCQlpZiAoIGF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgY29udGludWU7CgoJCQkJCQljb25zdCBidWZmZXIgPSBhdHRyaWJ1dGUuYnVmZmVyOwoJCQkJCQljb25zdCB0eXBlID0gYXR0cmlidXRlLnR5cGU7CgkJCQkJCWNvbnN0IGJ5dGVzUGVyRWxlbWVudCA9IGF0dHJpYnV0ZS5ieXRlc1BlckVsZW1lbnQ7CgoJCQkJCQkvLyBjaGVjayBmb3IgaW50ZWdlciBhdHRyaWJ1dGVzCgoJCQkJCQljb25zdCBpbnRlZ2VyID0gKCB0eXBlID09PSBnbC5JTlQgfHwgdHlwZSA9PT0gZ2wuVU5TSUdORURfSU5UIHx8IGdlb21ldHJ5QXR0cmlidXRlLmdwdVR5cGUgPT09IEludFR5cGUgKTsKCgkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJCQljb25zdCBkYXRhID0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YTsKCQkJCQkJCWNvbnN0IHN0cmlkZSA9IGRhdGEuc3RyaWRlOwoJCQkJCQkJY29uc3Qgb2Zmc2V0ID0gZ2VvbWV0cnlBdHRyaWJ1dGUub2Zmc2V0OwoKCQkJCQkJCWlmICggZGF0YS5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyICkgewoKCQkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLCBkYXRhLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZGF0YS5tZXNoUGVyQXR0cmlidXRlICogZGF0YS5jb3VudDsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCQkJZW5hYmxlQXR0cmlidXRlKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJCWdsLmJpbmRCdWZmZXIoIGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyICk7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCXZlcnRleEF0dHJpYlBvaW50ZXIoCgkJCQkJCQkJCXByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLAoJCQkJCQkJCQlzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUsCgkJCQkJCQkJCXR5cGUsCgkJCQkJCQkJCW5vcm1hbGl6ZWQsCgkJCQkJCQkJCXN0cmlkZSAqIGJ5dGVzUGVyRWxlbWVudCwKCQkJCQkJCQkJKCBvZmZzZXQgKyAoIHNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSApICogaSApICogYnl0ZXNQZXJFbGVtZW50LAoJCQkJCQkJCQlpbnRlZ2VyCgkJCQkJCQkJKTsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUuaXNJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCQkJZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksIGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggIT09IHRydWUgJiYgZ2VvbWV0cnkuX21heEluc3RhbmNlQ291bnQgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZ2VvbWV0cnlBdHRyaWJ1dGUubWVzaFBlckF0dHJpYnV0ZSAqIGdlb21ldHJ5QXR0cmlidXRlLmNvdW50OwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCQllbmFibGVBdHRyaWJ1dGUoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9CgoJCQkJCQkJZ2wuYmluZEJ1ZmZlciggZ2wuQVJSQVlfQlVGRkVSLCBidWZmZXIgKTsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJdmVydGV4QXR0cmliUG9pbnRlcigKCQkJCQkJCQkJcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksCgkJCQkJCQkJCXNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSwKCQkJCQkJCQkJdHlwZSwKCQkJCQkJCQkJbm9ybWFsaXplZCwKCQkJCQkJCQkJc2l6ZSAqIGJ5dGVzUGVyRWxlbWVudCwKCQkJCQkJCQkJKCBzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUgKSAqIGkgKiBieXRlc1BlckVsZW1lbnQsCgkJCQkJCQkJCWludGVnZXIKCQkJCQkJCQkpOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxEZWZhdWx0QXR0cmlidXRlVmFsdWVzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQljb25zdCB2YWx1ZSA9IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlc1sgbmFtZSBdOwoKCQkJCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCXN3aXRjaCAoIHZhbHVlLmxlbmd0aCApIHsKCgkJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWIyZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CgkJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCQljYXNlIDM6CgkJCQkJCQkJCWdsLnZlcnRleEF0dHJpYjNmdiggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiwgdmFsdWUgKTsKCQkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJCWNhc2UgNDoKCQkJCQkJCQkJZ2wudmVydGV4QXR0cmliNGZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoJCQkJCQkJCQlicmVhazsKCgkJCQkJCQkJZGVmYXVsdDoKCQkJCQkJCQkJZ2wudmVydGV4QXR0cmliMWZ2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzKCk7CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCXJlc2V0KCk7CgoJCQlmb3IgKCBjb25zdCBnZW9tZXRyeUlkIGluIGJpbmRpbmdTdGF0ZXMgKSB7CgoJCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5SWQgXTsKCgkJCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCgkJCQkJY29uc3Qgc3RhdGVNYXAgPSBwcm9ncmFtTWFwWyBwcm9ncmFtSWQgXTsKCgkJCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKCQkJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQkJCWRlbGV0ZSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgoJCQkJCX0KCgkJCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJCX0KCgkJCQlkZWxldGUgYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlbGVhc2VTdGF0ZXNPZkdlb21ldHJ5KCBnZW9tZXRyeSApIHsKCgkJCWlmICggYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCgkJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJCWZvciAoIGNvbnN0IHdpcmVmcmFtZSBpbiBzdGF0ZU1hcCApIHsKCgkJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQkJZGVsZXRlIHN0YXRlTWFwWyB3aXJlZnJhbWUgXTsKCgkJCQl9CgoJCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQkJfQoKCQkJZGVsZXRlIGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF07CgoJCX0KCgkJZnVuY3Rpb24gcmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJCWZvciAoIGNvbnN0IGdlb21ldHJ5SWQgaW4gYmluZGluZ1N0YXRlcyApIHsKCgkJCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKCQkJCWlmICggcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCgkJCQljb25zdCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCgkJCQlmb3IgKCBjb25zdCB3aXJlZnJhbWUgaW4gc3RhdGVNYXAgKSB7CgoJCQkJCWRlbGV0ZVZlcnRleEFycmF5T2JqZWN0KCBzdGF0ZU1hcFsgd2lyZWZyYW1lIF0ub2JqZWN0ICk7CgoJCQkJCWRlbGV0ZSBzdGF0ZU1hcFsgd2lyZWZyYW1lIF07CgoJCQkJfQoKCQkJCWRlbGV0ZSBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF07CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVzZXQoKSB7CgoJCQlyZXNldERlZmF1bHRTdGF0ZSgpOwoJCQlmb3JjZVVwZGF0ZSA9IHRydWU7CgoJCQlpZiAoIGN1cnJlbnRTdGF0ZSA9PT0gZGVmYXVsdFN0YXRlICkgcmV0dXJuOwoKCQkJY3VycmVudFN0YXRlID0gZGVmYXVsdFN0YXRlOwoJCQliaW5kVmVydGV4QXJyYXlPYmplY3QoIGN1cnJlbnRTdGF0ZS5vYmplY3QgKTsKCgkJfQoKCQkvLyBmb3IgYmFja3dhcmQtY29tcGF0aWJpbGl0eQoKCQlmdW5jdGlvbiByZXNldERlZmF1bHRTdGF0ZSgpIHsKCgkJCWRlZmF1bHRTdGF0ZS5nZW9tZXRyeSA9IG51bGw7CgkJCWRlZmF1bHRTdGF0ZS5wcm9ncmFtID0gbnVsbDsKCQkJZGVmYXVsdFN0YXRlLndpcmVmcmFtZSA9IGZhbHNlOwoKCQl9CgoJCXJldHVybiB7CgoJCQlzZXR1cDogc2V0dXAsCgkJCXJlc2V0OiByZXNldCwKCQkJcmVzZXREZWZhdWx0U3RhdGU6IHJlc2V0RGVmYXVsdFN0YXRlLAoJCQlkaXNwb3NlOiBkaXNwb3NlLAoJCQlyZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeTogcmVsZWFzZVN0YXRlc09mR2VvbWV0cnksCgkJCXJlbGVhc2VTdGF0ZXNPZlByb2dyYW06IHJlbGVhc2VTdGF0ZXNPZlByb2dyYW0sCgoJCQlpbml0QXR0cmlidXRlczogaW5pdEF0dHJpYnV0ZXMsCgkJCWVuYWJsZUF0dHJpYnV0ZTogZW5hYmxlQXR0cmlidXRlLAoJCQlkaXNhYmxlVW51c2VkQXR0cmlidXRlczogZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMKCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xCdWZmZXJSZW5kZXJlciggZ2wsIGV4dGVuc2lvbnMsIGluZm8gKSB7CgoJCWxldCBtb2RlOwoKCQlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCgkJCW1vZGUgPSB2YWx1ZTsKCgkJfQoKCQlmdW5jdGlvbiByZW5kZXIoIHN0YXJ0LCBjb3VudCApIHsKCgkJCWdsLmRyYXdBcnJheXMoIG1vZGUsIHN0YXJ0LCBjb3VudCApOwoKCQkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCAxICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKCBzdGFydCwgY291bnQsIHByaW1jb3VudCApIHsKCgkJCWlmICggcHJpbWNvdW50ID09PSAwICkgcmV0dXJuOwoKCQkJZ2wuZHJhd0FycmF5c0luc3RhbmNlZCggbW9kZSwgc3RhcnQsIGNvdW50LCBwcmltY291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3KCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50ICkgewoKCQkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgoJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CgkJCWV4dGVuc2lvbi5tdWx0aURyYXdBcnJheXNXRUJHTCggbW9kZSwgc3RhcnRzLCAwLCBjb3VudHMsIDAsIGRyYXdDb3VudCApOwoKCQkJbGV0IGVsZW1lbnRDb3VudCA9IDA7CgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCgkJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF07CgoJCQl9CgoJCQlpbmZvLnVwZGF0ZSggZWxlbWVudENvdW50LCBtb2RlLCAxICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzKCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50LCBwcmltY291bnQgKSB7CgoJCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCgkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHN0YXJ0cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXJlbmRlckluc3RhbmNlcyggc3RhcnRzWyBpIF0sIGNvdW50c1sgaSBdLCBwcmltY291bnRbIGkgXSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0FycmF5c0luc3RhbmNlZFdFQkdMKCBtb2RlLCBzdGFydHMsIDAsIGNvdW50cywgMCwgcHJpbWNvdW50LCAwLCBkcmF3Q291bnQgKTsKCgkJCQlsZXQgZWxlbWVudENvdW50ID0gMDsKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRyYXdDb3VudDsgaSArKyApIHsKCgkJCQkJZWxlbWVudENvdW50ICs9IGNvdW50c1sgaSBdICogcHJpbWNvdW50WyBpIF07CgoJCQkJfQoKCQkJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQl0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwoJCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3ID0gcmVuZGVyTXVsdGlEcmF3OwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzID0gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzOwoKCX0KCglmdW5jdGlvbiBXZWJHTENhcGFiaWxpdGllcyggZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHV0aWxzICkgewoKCQlsZXQgbWF4QW5pc290cm9weTsKCgkJZnVuY3Rpb24gZ2V0TWF4QW5pc290cm9weSgpIHsKCgkJCWlmICggbWF4QW5pc290cm9weSAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIG1heEFuaXNvdHJvcHk7CgoJCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApID09PSB0cnVlICkgewoKCQkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwoKCQkJCW1heEFuaXNvdHJvcHkgPSBnbC5nZXRQYXJhbWV0ZXIoIGV4dGVuc2lvbi5NQVhfVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJbWF4QW5pc290cm9weSA9IDA7CgoJCQl9CgoJCQlyZXR1cm4gbWF4QW5pc290cm9weTsKCgkJfQoKCQlmdW5jdGlvbiB0ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSB7CgoJCQlpZiAoIHRleHR1cmVGb3JtYXQgIT09IFJHQkFGb3JtYXQgJiYgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApICE9PSBnbC5nZXRQYXJhbWV0ZXIoIGdsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfRk9STUFUICkgKSB7CgoJCQkJcmV0dXJuIGZhbHNlOwoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJZnVuY3Rpb24gdGV4dHVyZVR5cGVSZWFkYWJsZSggdGV4dHVyZVR5cGUgKSB7CgoJCQljb25zdCBoYWxmRmxvYXRTdXBwb3J0ZWRCeUV4dCA9ICggdGV4dHVyZVR5cGUgPT09IEhhbGZGbG9hdFR5cGUgKSAmJiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApOwoKCQkJaWYgKCB0ZXh0dXJlVHlwZSAhPT0gVW5zaWduZWRCeXRlVHlwZSAmJiB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApICE9PSBnbC5nZXRQYXJhbWV0ZXIoIGdsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfVFlQRSApICYmIC8vIEVkZ2UgYW5kIENocm9tZSBNYWMgPCA1MiAoIzk1MTMpCgkJCQl0ZXh0dXJlVHlwZSAhPT0gRmxvYXRUeXBlICYmICEgaGFsZkZsb2F0U3VwcG9ydGVkQnlFeHQgKSB7CgoJCQkJcmV0dXJuIGZhbHNlOwoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0TWF4UHJlY2lzaW9uKCBwcmVjaXNpb24gKSB7CgoJCQlpZiAoIHByZWNpc2lvbiA9PT0gJ2hpZ2hwJyApIHsKCgkJCQlpZiAoIGdsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCggZ2wuVkVSVEVYX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgJiYKCQkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgoJCQkJCXJldHVybiAnaGlnaHAnOwoKCQkJCX0KCgkJCQlwcmVjaXNpb24gPSAnbWVkaXVtcCc7CgoJCQl9CgoJCQlpZiAoIHByZWNpc2lvbiA9PT0gJ21lZGl1bXAnICkgewoKCQkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5WRVJURVhfU0hBREVSLCBnbC5NRURJVU1fRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCgkJCQkJZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5GUkFHTUVOVF9TSEFERVIsIGdsLk1FRElVTV9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgoJCQkJCXJldHVybiAnbWVkaXVtcCc7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuICdsb3dwJzsKCgkJfQoKCQlsZXQgcHJlY2lzaW9uID0gcGFyYW1ldGVycy5wcmVjaXNpb24gIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucHJlY2lzaW9uIDogJ2hpZ2hwJzsKCQljb25zdCBtYXhQcmVjaXNpb24gPSBnZXRNYXhQcmVjaXNpb24oIHByZWNpc2lvbiApOwoKCQlpZiAoIG1heFByZWNpc2lvbiAhPT0gcHJlY2lzaW9uICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjonLCBwcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIG1heFByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoJCQlwcmVjaXNpb24gPSBtYXhQcmVjaXNpb247CgoJCX0KCgkJY29uc3QgbG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9IHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciA9PT0gdHJ1ZTsKCQljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSBwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA9PT0gdHJ1ZSAmJiBleHRlbnNpb25zLmhhcyggJ0VYVF9jbGlwX2NvbnRyb2wnICk7CgoJCWNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoJCWNvbnN0IG1heFZlcnRleFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkVSVEVYX1RFWFRVUkVfSU1BR0VfVU5JVFMgKTsKCQljb25zdCBtYXhUZXh0dXJlU2l6ZSA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1RFWFRVUkVfU0laRSApOwoJCWNvbnN0IG1heEN1YmVtYXBTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfQ1VCRV9NQVBfVEVYVFVSRV9TSVpFICk7CgoJCWNvbnN0IG1heEF0dHJpYnV0ZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfQVRUUklCUyApOwoJCWNvbnN0IG1heFZlcnRleFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkVSVEVYX1VOSUZPUk1fVkVDVE9SUyApOwoJCWNvbnN0IG1heFZhcnlpbmdzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkFSWUlOR19WRUNUT1JTICk7CgkJY29uc3QgbWF4RnJhZ21lbnRVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX0ZSQUdNRU5UX1VOSUZPUk1fVkVDVE9SUyApOwoKCQljb25zdCB2ZXJ0ZXhUZXh0dXJlcyA9IG1heFZlcnRleFRleHR1cmVzID4gMDsKCgkJY29uc3QgbWF4U2FtcGxlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1NBTVBMRVMgKTsKCgkJcmV0dXJuIHsKCgkJCWlzV2ViR0wyOiB0cnVlLCAvLyBrZWVwaW5nIHRoaXMgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CgoJCQlnZXRNYXhBbmlzb3Ryb3B5OiBnZXRNYXhBbmlzb3Ryb3B5LAoJCQlnZXRNYXhQcmVjaXNpb246IGdldE1heFByZWNpc2lvbiwKCgkJCXRleHR1cmVGb3JtYXRSZWFkYWJsZTogdGV4dHVyZUZvcm1hdFJlYWRhYmxlLAoJCQl0ZXh0dXJlVHlwZVJlYWRhYmxlOiB0ZXh0dXJlVHlwZVJlYWRhYmxlLAoKCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgkJCWxvZ2FyaXRobWljRGVwdGhCdWZmZXI6IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIsCgkJCXJldmVyc2VEZXB0aEJ1ZmZlcjogcmV2ZXJzZURlcHRoQnVmZmVyLAoKCQkJbWF4VGV4dHVyZXM6IG1heFRleHR1cmVzLAoJCQltYXhWZXJ0ZXhUZXh0dXJlczogbWF4VmVydGV4VGV4dHVyZXMsCgkJCW1heFRleHR1cmVTaXplOiBtYXhUZXh0dXJlU2l6ZSwKCQkJbWF4Q3ViZW1hcFNpemU6IG1heEN1YmVtYXBTaXplLAoKCQkJbWF4QXR0cmlidXRlczogbWF4QXR0cmlidXRlcywKCQkJbWF4VmVydGV4VW5pZm9ybXM6IG1heFZlcnRleFVuaWZvcm1zLAoJCQltYXhWYXJ5aW5nczogbWF4VmFyeWluZ3MsCgkJCW1heEZyYWdtZW50VW5pZm9ybXM6IG1heEZyYWdtZW50VW5pZm9ybXMsCgoJCQl2ZXJ0ZXhUZXh0dXJlczogdmVydGV4VGV4dHVyZXMsCgoJCQltYXhTYW1wbGVzOiBtYXhTYW1wbGVzCgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJbGV0IGdsb2JhbFN0YXRlID0gbnVsbCwKCQkJbnVtR2xvYmFsUGxhbmVzID0gMCwKCQkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZSwKCQkJcmVuZGVyaW5nU2hhZG93cyA9IGZhbHNlOwoKCQljb25zdCBwbGFuZSA9IG5ldyBQbGFuZSgpLAoJCQl2aWV3Tm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDMoKSwKCgkJCXVuaWZvcm0gPSB7IHZhbHVlOiBudWxsLCBuZWVkc1VwZGF0ZTogZmFsc2UgfTsKCgkJdGhpcy51bmlmb3JtID0gdW5pZm9ybTsKCQl0aGlzLm51bVBsYW5lcyA9IDA7CgkJdGhpcy5udW1JbnRlcnNlY3Rpb24gPSAwOwoKCQl0aGlzLmluaXQgPSBmdW5jdGlvbiAoIHBsYW5lcywgZW5hYmxlTG9jYWxDbGlwcGluZyApIHsKCgkJCWNvbnN0IGVuYWJsZWQgPQoJCQkJcGxhbmVzLmxlbmd0aCAhPT0gMCB8fAoJCQkJZW5hYmxlTG9jYWxDbGlwcGluZyB8fAoJCQkJLy8gZW5hYmxlIHN0YXRlIG9mIHByZXZpb3VzIGZyYW1lIC0gdGhlIGNsaXBwaW5nIGNvZGUgaGFzIHRvCgkJCQkvLyBydW4gYW5vdGhlciBmcmFtZSBpbiBvcmRlciB0byByZXNldCB0aGUgc3RhdGU6CgkJCQludW1HbG9iYWxQbGFuZXMgIT09IDAgfHwKCQkJCWxvY2FsQ2xpcHBpbmdFbmFibGVkOwoKCQkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBlbmFibGVMb2NhbENsaXBwaW5nOwoKCQkJbnVtR2xvYmFsUGxhbmVzID0gcGxhbmVzLmxlbmd0aDsKCgkJCXJldHVybiBlbmFibGVkOwoKCQl9OwoKCQl0aGlzLmJlZ2luU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJlbmRlcmluZ1NoYWRvd3MgPSB0cnVlOwoJCQlwcm9qZWN0UGxhbmVzKCBudWxsICk7CgoJCX07CgoJCXRoaXMuZW5kU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJlbmRlcmluZ1NoYWRvd3MgPSBmYWxzZTsKCgkJfTsKCgkJdGhpcy5zZXRHbG9iYWxTdGF0ZSA9IGZ1bmN0aW9uICggcGxhbmVzLCBjYW1lcmEgKSB7CgoJCQlnbG9iYWxTdGF0ZSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCAwICk7CgoJCX07CgoJCXRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsLCBjYW1lcmEsIHVzZUNhY2hlICkgewoKCQkJY29uc3QgcGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXMsCgkJCQljbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbiwKCQkJCWNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CgoJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCgkJCWlmICggISBsb2NhbENsaXBwaW5nRW5hYmxlZCB8fCBwbGFuZXMgPT09IG51bGwgfHwgcGxhbmVzLmxlbmd0aCA9PT0gMCB8fCByZW5kZXJpbmdTaGFkb3dzICYmICEgY2xpcFNoYWRvd3MgKSB7CgoJCQkJLy8gdGhlcmUncyBubyBsb2NhbCBjbGlwcGluZwoKCQkJCWlmICggcmVuZGVyaW5nU2hhZG93cyApIHsKCgkJCQkJLy8gdGhlcmUncyBubyBnbG9iYWwgY2xpcHBpbmcKCgkJCQkJcHJvamVjdFBsYW5lcyggbnVsbCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJlc2V0R2xvYmFsU3RhdGUoKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IG5HbG9iYWwgPSByZW5kZXJpbmdTaGFkb3dzID8gMCA6IG51bUdsb2JhbFBsYW5lcywKCQkJCQlsR2xvYmFsID0gbkdsb2JhbCAqIDQ7CgoJCQkJbGV0IGRzdEFycmF5ID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmNsaXBwaW5nU3RhdGUgfHwgbnVsbDsKCgkJCQl1bmlmb3JtLnZhbHVlID0gZHN0QXJyYXk7IC8vIGVuc3VyZSB1bmlxdWUgc3RhdGUKCgkJCQlkc3RBcnJheSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBsR2xvYmFsLCB1c2VDYWNoZSApOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbEdsb2JhbDsgKysgaSApIHsKCgkJCQkJZHN0QXJyYXlbIGkgXSA9IGdsb2JhbFN0YXRlWyBpIF07CgoJCQkJfQoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5jbGlwcGluZ1N0YXRlID0gZHN0QXJyYXk7CgkJCQl0aGlzLm51bUludGVyc2VjdGlvbiA9IGNsaXBJbnRlcnNlY3Rpb24gPyB0aGlzLm51bVBsYW5lcyA6IDA7CgkJCQl0aGlzLm51bVBsYW5lcyArPSBuR2xvYmFsOwoKCQkJfQoKCgkJfTsKCgkJZnVuY3Rpb24gcmVzZXRHbG9iYWxTdGF0ZSgpIHsKCgkJCWlmICggdW5pZm9ybS52YWx1ZSAhPT0gZ2xvYmFsU3RhdGUgKSB7CgoJCQkJdW5pZm9ybS52YWx1ZSA9IGdsb2JhbFN0YXRlOwoJCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IG51bUdsb2JhbFBsYW5lcyA+IDA7CgoJCQl9CgoJCQlzY29wZS5udW1QbGFuZXMgPSBudW1HbG9iYWxQbGFuZXM7CgkJCXNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CgoJCX0KCgkJZnVuY3Rpb24gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIGRzdE9mZnNldCwgc2tpcFRyYW5zZm9ybSApIHsKCgkJCWNvbnN0IG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMDsKCQkJbGV0IGRzdEFycmF5ID0gbnVsbDsKCgkJCWlmICggblBsYW5lcyAhPT0gMCApIHsKCgkJCQlkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CgoJCQkJaWYgKCBza2lwVHJhbnNmb3JtICE9PSB0cnVlIHx8IGRzdEFycmF5ID09PSBudWxsICkgewoKCQkJCQljb25zdCBmbGF0U2l6ZSA9IGRzdE9mZnNldCArIG5QbGFuZXMgKiA0LAoJCQkJCQl2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCQkJdmlld05vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIHZpZXdNYXRyaXggKTsKCgkJCQkJaWYgKCBkc3RBcnJheSA9PT0gbnVsbCB8fCBkc3RBcnJheS5sZW5ndGggPCBmbGF0U2l6ZSApIHsKCgkJCQkJCWRzdEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggZmxhdFNpemUgKTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGk0ID0gZHN0T2Zmc2V0OyBpICE9PSBuUGxhbmVzOyArKyBpLCBpNCArPSA0ICkgewoKCQkJCQkJcGxhbmUuY29weSggcGxhbmVzWyBpIF0gKS5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXgsIHZpZXdOb3JtYWxNYXRyaXggKTsKCgkJCQkJCXBsYW5lLm5vcm1hbC50b0FycmF5KCBkc3RBcnJheSwgaTQgKTsKCQkJCQkJZHN0QXJyYXlbIGk0ICsgMyBdID0gcGxhbmUuY29uc3RhbnQ7CgoJCQkJCX0KCgkJCQl9CgoJCQkJdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OwoJCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQl9CgoJCQlzY29wZS5udW1QbGFuZXMgPSBuUGxhbmVzOwoJCQlzY29wZS5udW1JbnRlcnNlY3Rpb24gPSAwOwoKCQkJcmV0dXJuIGRzdEFycmF5OwoKCQl9CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQ3ViZU1hcHMoIHJlbmRlcmVyICkgewoKCQlsZXQgY3ViZW1hcHMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBtYXBUZXh0dXJlTWFwcGluZyggdGV4dHVyZSwgbWFwcGluZyApIHsKCgkJCWlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgKSB7CgoJCQkJdGV4dHVyZS5tYXBwaW5nID0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOwoKCQkJfSBlbHNlIGlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKSB7CgoJCQkJdGV4dHVyZS5tYXBwaW5nID0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOwoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCB0ZXh0dXJlICkgewoKCQkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKCQkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgoJCQkJaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyB8fCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyApIHsKCgkJCQkJaWYgKCBjdWJlbWFwcy5oYXMoIHRleHR1cmUgKSApIHsKCgkJCQkJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKS50ZXh0dXJlOwoJCQkJCQlyZXR1cm4gbWFwVGV4dHVyZU1hcHBpbmcoIGN1YmVtYXAsIHRleHR1cmUubWFwcGluZyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc3QgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKCQkJCQkJaWYgKCBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgewoKCQkJCQkJCWNvbnN0IHJlbmRlclRhcmdldCA9IG5ldyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQoIGltYWdlLmhlaWdodCApOwoJCQkJCQkJcmVuZGVyVGFyZ2V0LmZyb21FcXVpcmVjdGFuZ3VsYXJUZXh0dXJlKCByZW5kZXJlciwgdGV4dHVyZSApOwoJCQkJCQkJY3ViZW1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCQl0ZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKCQkJCQkJCXJldHVybiBtYXBUZXh0dXJlTWFwcGluZyggcmVuZGVyVGFyZ2V0LnRleHR1cmUsIHRleHR1cmUubWFwcGluZyApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkvLyBpbWFnZSBub3QgeWV0IHJlYWR5LiB0cnkgdGhlIGNvbnZlcnNpb24gbmV4dCBmcmFtZQoKCQkJCQkJCXJldHVybiBudWxsOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmU7CgoJCX0KCgkJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggY3ViZW1hcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWN1YmVtYXBzLmRlbGV0ZSggdGV4dHVyZSApOwoJCQkJY3ViZW1hcC5kaXNwb3NlKCk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCWN1YmVtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJfQoKCQlyZXR1cm4gewoJCQlnZXQ6IGdldCwKCQkJZGlzcG9zZTogZGlzcG9zZQoJCX07CgoJfQoKCWNvbnN0IExPRF9NSU4gPSA0OwoKCS8vIFRoZSBzdGFuZGFyZCBkZXZpYXRpb25zIChyYWRpYW5zKSBhc3NvY2lhdGVkIHdpdGggdGhlIGV4dHJhIG1pcHMuIFRoZXNlIGFyZQoJLy8gY2hvc2VuIHRvIGFwcHJveGltYXRlIGEgVHJvd2JyaWRnZS1SZWl0eiBkaXN0cmlidXRpb24gZnVuY3Rpb24gdGltZXMgdGhlCgkvLyBnZW9tZXRyaWMgc2hhZG93aW5nIGZ1bmN0aW9uLiBUaGVzZSBzaWdtYSB2YWx1ZXMgc3F1YXJlZCBtdXN0IG1hdGNoIHRoZQoJLy8gdmFyaWFuY2UgI2RlZmluZXMgaW4gY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50Lmdsc2wuanMuCgljb25zdCBFWFRSQV9MT0RfU0lHTUEgPSBbIDAuMTI1LCAwLjIxNSwgMC4zNSwgMC40NDYsIDAuNTI2LCAwLjU4MiBdOwoKCS8vIFRoZSBtYXhpbXVtIGxlbmd0aCBvZiB0aGUgYmx1ciBmb3IgbG9vcC4gU21hbGxlciBzaWdtYXMgd2lsbCB1c2UgZmV3ZXIKCS8vIHNhbXBsZXMgYW5kIGV4aXQgZWFybHksIGJ1dCBub3QgcmVjb21waWxlIHRoZSBzaGFkZXIuCgljb25zdCBNQVhfU0FNUExFUyA9IDIwOwoKCWNvbnN0IF9mbGF0Q2FtZXJhID0gLypAX19QVVJFX18qLyBuZXcgT3J0aG9ncmFwaGljQ2FtZXJhKCk7Cgljb25zdCBfY2xlYXJDb2xvciA9IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCk7CglsZXQgX29sZFRhcmdldCA9IG51bGw7CglsZXQgX29sZEFjdGl2ZUN1YmVGYWNlID0gMDsKCWxldCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoJbGV0IF9vbGRYckVuYWJsZWQgPSBmYWxzZTsKCgkvLyBHb2xkZW4gUmF0aW8KCWNvbnN0IFBISSA9ICggMSArIE1hdGguc3FydCggNSApICkgLyAyOwoJY29uc3QgSU5WX1BISSA9IDEgLyBQSEk7CgoJLy8gVmVydGljZXMgb2YgYSBkb2RlY2FoZWRyb24gKGV4Y2VwdCB0aGUgb3Bwb3NpdGVzLCB3aGljaCByZXByZXNlbnQgdGhlCgkvLyBzYW1lIGF4aXMpLCB1c2VkIGFzIGF4aXMgZGlyZWN0aW9ucyBldmVubHkgc3ByZWFkIG9uIGEgc3BoZXJlLgoJY29uc3QgX2F4aXNEaXJlY3Rpb25zID0gWwoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0gUEhJLCBJTlZfUEhJLCAwICksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggUEhJLCBJTlZfUEhJLCAwICksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLSBJTlZfUEhJLCAwLCBQSEkgKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCBJTlZfUEhJLCAwLCBQSEkgKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCBQSEksIC0gSU5WX1BISSApLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIFBISSwgSU5WX1BISSApLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0xLCAxLCAtMSApLAoJCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIC0xICksCgkJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggLTEsIDEsIDEgKSwKCQkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAxLCAxLCAxICkgXTsKCgljb25zdCBfb3JpZ2luID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKCS8qKgoJICogVGhpcyBjbGFzcyBnZW5lcmF0ZXMgYSBQcmVmaWx0ZXJlZCwgTWlwbWFwcGVkIFJhZGlhbmNlIEVudmlyb25tZW50IE1hcAoJICogKFBNUkVNKSBmcm9tIGEgY3ViZU1hcCBlbnZpcm9ubWVudCB0ZXh0dXJlLiBUaGlzIGFsbG93cyBkaWZmZXJlbnQgbGV2ZWxzIG9mCgkgKiBibHVyIHRvIGJlIHF1aWNrbHkgYWNjZXNzZWQgYmFzZWQgb24gbWF0ZXJpYWwgcm91Z2huZXNzLiBJdCBpcyBwYWNrZWQgaW50byBhCgkgKiBzcGVjaWFsIEN1YmVVViBmb3JtYXQgdGhhdCBhbGxvd3MgdXMgdG8gcGVyZm9ybSBjdXN0b20gaW50ZXJwb2xhdGlvbiBzbyB0aGF0CgkgKiB3ZSBjYW4gc3VwcG9ydCBub25saW5lYXIgZm9ybWF0cyBzdWNoIGFzIFJHQkUuIFVubGlrZSBhIHRyYWRpdGlvbmFsIG1pcG1hcAoJICogY2hhaW4sIGl0IG9ubHkgZ29lcyBkb3duIHRvIHRoZSBMT0RfTUlOIGxldmVsIChhYm92ZSksIGFuZCB0aGVuIGNyZWF0ZXMgZXh0cmEKCSAqIGV2ZW4gbW9yZSBmaWx0ZXJlZCAnbWlwcycgYXQgdGhlIHNhbWUgTE9EX01JTiByZXNvbHV0aW9uLCBhc3NvY2lhdGVkIHdpdGgKCSAqIGhpZ2hlciByb3VnaG5lc3MgbGV2ZWxzLiBJbiB0aGlzIHdheSB3ZSBtYWludGFpbiByZXNvbHV0aW9uIHRvIHNtb290aGx5CgkgKiBpbnRlcnBvbGF0ZSBkaWZmdXNlIGxpZ2h0aW5nIHdoaWxlIGxpbWl0aW5nIHNhbXBsaW5nIGNvbXB1dGF0aW9uLgoJICoKCSAqIFBhcGVyOiBGYXN0LCBBY2N1cmF0ZSBJbWFnZS1CYXNlZCBMaWdodGluZzoKCSAqIHtAbGluayBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vZmlsZS9kLzE1eThyX1VwS2xVOVN2VjRJTGIwQzNxQ1BlY1M4cHZMei92aWV3fQoJKi8KCWNsYXNzIFBNUkVNR2VuZXJhdG9yIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBQTVJFTSBnZW5lcmF0b3IuCgkJICoKCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyZXJ9IHJlbmRlcmVyIC0gVGhlIHJlbmRlcmVyLgoJCSAqLwoJCWNvbnN0cnVjdG9yKCByZW5kZXJlciApIHsKCgkJCXRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CgkJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCXRoaXMuX2xvZE1heCA9IDA7CgkJCXRoaXMuX2N1YmVTaXplID0gMDsKCQkJdGhpcy5fbG9kUGxhbmVzID0gW107CgkJCXRoaXMuX3NpemVMb2RzID0gW107CgkJCXRoaXMuX3NpZ21hcyA9IFtdOwoKCQkJdGhpcy5fYmx1ck1hdGVyaWFsID0gbnVsbDsKCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gbnVsbDsKCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IG51bGw7CgoJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2JsdXJNYXRlcmlhbCApOwoKCQl9CgoJCS8qKgoJCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYSBzdXBwbGllZCBTY2VuZSwgd2hpY2ggY2FuIGJlIGZhc3RlciB0aGFuIHVzaW5nIGFuCgkJICogaW1hZ2UgaWYgbmV0d29ya2luZyBiYW5kd2lkdGggaXMgbG93LiBPcHRpb25hbCBzaWdtYSBzcGVjaWZpZXMgYSBibHVyIHJhZGl1cwoJCSAqIGluIHJhZGlhbnMgdG8gYmUgYXBwbGllZCB0byB0aGUgc2NlbmUgYmVmb3JlIFBNUkVNIGdlbmVyYXRpb24uIE9wdGlvbmFsIG5lYXIKCQkgKiBhbmQgZmFyIHBsYW5lcyBlbnN1cmUgdGhlIHNjZW5lIGlzIHJlbmRlcmVkIGluIGl0cyBlbnRpcmV0eS4KCQkgKgoJCSAqIEBwYXJhbSB7U2NlbmV9IHNjZW5lIC0gVGhlIHNjZW5lIHRvIGJlIGNhcHR1cmVkLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbc2lnbWE9MF0gLSBUaGUgYmx1ciByYWRpdXMgaW4gcmFkaWFucy4KCQkgKiBAcGFyYW0ge251bWJlcn0gW25lYXI9MC4xXSAtIFRoZSBuZWFyIHBsYW5lIGRpc3RhbmNlLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbZmFyPTEwMF0gLSBUaGUgZmFyIHBsYW5lIGRpc3RhbmNlLgoJCSAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gLSBUaGUgY29uZmlndXJhdGlvbiBvcHRpb25zLgoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5zaXplPTI1Nl0gLSBUaGUgdGV4dHVyZSBzaXplIG9mIHRoZSBQTVJFTS4KCQkgKiBAcGFyYW0ge1ZlY3RvcjN9IFtvcHRpb25zLnJlbmRlclRhcmdldD1vcmlnaW5dIC0gVGhlIHBvc2l0aW9uIG9mIHRoZSBpbnRlcm5hbCBjdWJlIGNhbWVyYSB0aGF0IHJlbmRlcnMgdGhlIHNjZW5lLgoJCSAqIEByZXR1cm4ge1dlYkdMUmVuZGVyVGFyZ2V0fSBUaGUgcmVzdWx0aW5nIFBNUkVNLgoJCSAqLwoJCWZyb21TY2VuZSggc2NlbmUsIHNpZ21hID0gMCwgbmVhciA9IDAuMSwgZmFyID0gMTAwLCBvcHRpb25zID0ge30gKSB7CgoJCQljb25zdCB7CgkJCQlzaXplID0gMjU2LAoJCQkJcG9zaXRpb24gPSBfb3JpZ2luLAoJCQl9ID0gb3B0aW9uczsKCgkJCV9vbGRUYXJnZXQgPSB0aGlzLl9yZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJX29sZEFjdGl2ZUN1YmVGYWNlID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQkJX29sZEFjdGl2ZU1pcG1hcExldmVsID0gdGhpcy5fcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCQkJX29sZFhyRW5hYmxlZCA9IHRoaXMuX3JlbmRlcmVyLnhyLmVuYWJsZWQ7CgoJCQl0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkID0gZmFsc2U7CgoJCQl0aGlzLl9zZXRTaXplKCBzaXplICk7CgoJCQljb25zdCBjdWJlVVZSZW5kZXJUYXJnZXQgPSB0aGlzLl9hbGxvY2F0ZVRhcmdldHMoKTsKCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyID0gdHJ1ZTsKCgkJCXRoaXMuX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCwgcG9zaXRpb24gKTsKCgkJCWlmICggc2lnbWEgPiAwICkgewoKCQkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgc2lnbWEgKTsKCgkJCX0KCgkJCXRoaXMuX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCQl0aGlzLl9jbGVhbnVwKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCgkJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgoJCX0KCgkJLyoqCgkJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhbiBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSwgd2hpY2ggY2FuIGJlIGVpdGhlciBMRFIKCQkgKiBvciBIRFIuIFRoZSBpZGVhbCBpbnB1dCBpbWFnZSBzaXplIGlzIDFrICgxMDI0IHggNTEyKSwKCQkgKiBhcyB0aGlzIG1hdGNoZXMgYmVzdCB3aXRoIHRoZSAyNTYgeCAyNTYgY3ViZW1hcCBvdXRwdXQuCgkJICoKCQkgKiBAcGFyYW0ge1RleHR1cmV9IGVxdWlyZWN0YW5ndWxhciAtIFRoZSBlcXVpcmVjdGFuZ3VsYXIgdGV4dHVyZSB0byBiZSBjb252ZXJ0ZWQuCgkJICogQHBhcmFtIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFtyZW5kZXJUYXJnZXQ9bnVsbF0gLSBUaGUgcmVuZGVyIHRhcmdldCB0byB1c2UuCgkJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCgkJICovCgkJZnJvbUVxdWlyZWN0YW5ndWxhciggZXF1aXJlY3Rhbmd1bGFyLCByZW5kZXJUYXJnZXQgPSBudWxsICkgewoKCQkJcmV0dXJuIHRoaXMuX2Zyb21UZXh0dXJlKCBlcXVpcmVjdGFuZ3VsYXIsIHJlbmRlclRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYW4gY3ViZW1hcCB0ZXh0dXJlLCB3aGljaCBjYW4gYmUgZWl0aGVyIExEUgoJCSAqIG9yIEhEUi4gVGhlIGlkZWFsIGlucHV0IGN1YmUgc2l6ZSBpcyAyNTYgeCAyNTYsCgkJICogYXMgdGhpcyBtYXRjaGVzIGJlc3Qgd2l0aCB0aGUgMjU2IHggMjU2IGN1YmVtYXAgb3V0cHV0LgoJCSAqCgkJICogQHBhcmFtIHtUZXh0dXJlfSBjdWJlbWFwIC0gVGhlIGN1YmVtYXAgdGV4dHVyZSB0byBiZSBjb252ZXJ0ZWQuCgkJICogQHBhcmFtIHs/V2ViR0xSZW5kZXJUYXJnZXR9IFtyZW5kZXJUYXJnZXQ9bnVsbF0gLSBUaGUgcmVuZGVyIHRhcmdldCB0byB1c2UuCgkJICogQHJldHVybiB7V2ViR0xSZW5kZXJUYXJnZXR9IFRoZSByZXN1bHRpbmcgUE1SRU0uCgkJICovCgkJZnJvbUN1YmVtYXAoIGN1YmVtYXAsIHJlbmRlclRhcmdldCA9IG51bGwgKSB7CgoJCQlyZXR1cm4gdGhpcy5fZnJvbVRleHR1cmUoIGN1YmVtYXAsIHJlbmRlclRhcmdldCApOwoKCQl9CgoJCS8qKgoJCSAqIFByZS1jb21waWxlcyB0aGUgY3ViZW1hcCBzaGFkZXIuIFlvdSBjYW4gZ2V0IGZhc3RlciBzdGFydC11cCBieSBpbnZva2luZyB0aGlzIG1ldGhvZCBkdXJpbmcKCQkgKiB5b3VyIHRleHR1cmUncyBuZXR3b3JrIGZldGNoIGZvciBpbmNyZWFzZWQgY29uY3VycmVuY3kuCgkJICovCgkJY29tcGlsZUN1YmVtYXBTaGFkZXIoKSB7CgoJCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPSBfZ2V0Q3ViZW1hcE1hdGVyaWFsKCk7CgkJCQl0aGlzLl9jb21waWxlTWF0ZXJpYWwoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCApOwoKCQkJfQoKCQl9CgoJCS8qKgoJCSAqIFByZS1jb21waWxlcyB0aGUgZXF1aXJlY3Rhbmd1bGFyIHNoYWRlci4gWW91IGNhbiBnZXQgZmFzdGVyIHN0YXJ0LXVwIGJ5IGludm9raW5nIHRoaXMgbWV0aG9kIGR1cmluZwoJCSAqIHlvdXIgdGV4dHVyZSdzIG5ldHdvcmsgZmV0Y2ggZm9yIGluY3JlYXNlZCBjb25jdXJyZW5jeS4KCQkgKi8KCQljb21waWxlRXF1aXJlY3Rhbmd1bGFyU2hhZGVyKCkgewoKCQkJaWYgKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID09PSBudWxsICkgewoKCQkJCXRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPSBfZ2V0RXF1aXJlY3RNYXRlcmlhbCgpOwoJCQkJdGhpcy5fY29tcGlsZU1hdGVyaWFsKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsICk7CgoJCQl9CgoJCX0KCgkJLyoqCgkJICogRGlzcG9zZXMgb2YgdGhlIFBNUkVNR2VuZXJhdG9yJ3MgaW50ZXJuYWwgbWVtb3J5LiBOb3RlIHRoYXQgUE1SRU1HZW5lcmF0b3IgaXMgYSBzdGF0aWMgY2xhc3MsCgkJICogc28geW91IHNob3VsZCBub3QgbmVlZCBtb3JlIHRoYW4gb25lIFBNUkVNR2VuZXJhdG9yIG9iamVjdC4gSWYgeW91IGRvLCBjYWxsaW5nIGRpc3Bvc2UoKSBvbgoJCSAqIG9uZSBvZiB0aGVtIHdpbGwgY2F1c2UgYW55IG90aGVycyB0byBhbHNvIGJlY29tZSB1bnVzYWJsZS4KCQkgKi8KCQlkaXNwb3NlKCkgewoKCQkJdGhpcy5fZGlzcG9zZSgpOwoKCQkJaWYgKCB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwuZGlzcG9zZSgpOwoJCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgIT09IG51bGwgKSB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJfQoKCQkvLyBwcml2YXRlIGludGVyZmFjZQoKCQlfc2V0U2l6ZSggY3ViZVNpemUgKSB7CgoJCQl0aGlzLl9sb2RNYXggPSBNYXRoLmZsb29yKCBNYXRoLmxvZzIoIGN1YmVTaXplICkgKTsKCQkJdGhpcy5fY3ViZVNpemUgPSBNYXRoLnBvdyggMiwgdGhpcy5fbG9kTWF4ICk7CgoJCX0KCgkJX2Rpc3Bvc2UoKSB7CgoJCQlpZiAoIHRoaXMuX2JsdXJNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMuX2JsdXJNYXRlcmlhbC5kaXNwb3NlKCk7CgoJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQuZGlzcG9zZSgpOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fbG9kUGxhbmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl0aGlzLl9sb2RQbGFuZXNbIGkgXS5kaXNwb3NlKCk7CgoJCQl9CgoJCX0KCgkJX2NsZWFudXAoIG91dHB1dFRhcmdldCApIHsKCgkJCXRoaXMuX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggX29sZFRhcmdldCwgX29sZEFjdGl2ZUN1YmVGYWNlLCBfb2xkQWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQkJdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZCA9IF9vbGRYckVuYWJsZWQ7CgoJCQlvdXRwdXRUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsKCQkJX3NldFZpZXdwb3J0KCBvdXRwdXRUYXJnZXQsIDAsIDAsIG91dHB1dFRhcmdldC53aWR0aCwgb3V0cHV0VGFyZ2V0LmhlaWdodCApOwoKCQl9CgoJCV9mcm9tVGV4dHVyZSggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgewoKCQkJaWYgKCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZsZWN0aW9uTWFwcGluZyB8fCB0ZXh0dXJlLm1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApIHsKCgkJCQl0aGlzLl9zZXRTaXplKCB0ZXh0dXJlLmltYWdlLmxlbmd0aCA9PT0gMCA/IDE2IDogKCB0ZXh0dXJlLmltYWdlWyAwIF0ud2lkdGggfHwgdGV4dHVyZS5pbWFnZVsgMCBdLmltYWdlLndpZHRoICkgKTsKCgkJCX0gZWxzZSB7IC8vIEVxdWlyZWN0YW5ndWxhcgoKCQkJCXRoaXMuX3NldFNpemUoIHRleHR1cmUuaW1hZ2Uud2lkdGggLyA0ICk7CgoJCQl9CgoJCQlfb2xkVGFyZ2V0ID0gdGhpcy5fcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJCV9vbGRBY3RpdmVDdWJlRmFjZSA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CgkJCV9vbGRBY3RpdmVNaXBtYXBMZXZlbCA9IHRoaXMuX3JlbmRlcmVyLmdldEFjdGl2ZU1pcG1hcExldmVsKCk7CgkJCV9vbGRYckVuYWJsZWQgPSB0aGlzLl9yZW5kZXJlci54ci5lbmFibGVkOwoKCQkJdGhpcy5fcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKCQkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0IHx8IHRoaXMuX2FsbG9jYXRlVGFyZ2V0cygpOwoJCQl0aGlzLl90ZXh0dXJlVG9DdWJlVVYoIHRleHR1cmUsIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCQl0aGlzLl9hcHBseVBNUkVNKCBjdWJlVVZSZW5kZXJUYXJnZXQgKTsKCQkJdGhpcy5fY2xlYW51cCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgoJCQlyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKCQl9CgoJCV9hbGxvY2F0ZVRhcmdldHMoKSB7CgoJCQljb25zdCB3aWR0aCA9IDMgKiBNYXRoLm1heCggdGhpcy5fY3ViZVNpemUsIDE2ICogNyApOwoJCQljb25zdCBoZWlnaHQgPSA0ICogdGhpcy5fY3ViZVNpemU7CgoJCQljb25zdCBwYXJhbXMgPSB7CgkJCQltYWdGaWx0ZXI6IExpbmVhckZpbHRlciwKCQkJCW1pbkZpbHRlcjogTGluZWFyRmlsdGVyLAoJCQkJZ2VuZXJhdGVNaXBtYXBzOiBmYWxzZSwKCQkJCXR5cGU6IEhhbGZGbG9hdFR5cGUsCgkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCQljb2xvclNwYWNlOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSwKCQkJCWRlcHRoQnVmZmVyOiBmYWxzZQoJCQl9OwoKCQkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgoJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0LndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldC5oZWlnaHQgIT09IGhlaWdodCApIHsKCgkJCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgewoKCQkJCQl0aGlzLl9kaXNwb3NlKCk7CgoJCQkJfQoKCQkJCXRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID0gX2NyZWF0ZVJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgoJCQkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwoJCQkJKCB7IHNpemVMb2RzOiB0aGlzLl9zaXplTG9kcywgbG9kUGxhbmVzOiB0aGlzLl9sb2RQbGFuZXMsIHNpZ21hczogdGhpcy5fc2lnbWFzIH0gPSBfY3JlYXRlUGxhbmVzKCBfbG9kTWF4ICkgKTsKCgkJCQl0aGlzLl9ibHVyTWF0ZXJpYWwgPSBfZ2V0Qmx1clNoYWRlciggX2xvZE1heCwgd2lkdGgsIGhlaWdodCApOwoKCQkJfQoKCQkJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCgkJfQoKCQlfY29tcGlsZU1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCgkJCWNvbnN0IHRtcE1lc2ggPSBuZXcgTWVzaCggdGhpcy5fbG9kUGxhbmVzWyAwIF0sIG1hdGVyaWFsICk7CgkJCXRoaXMuX3JlbmRlcmVyLmNvbXBpbGUoIHRtcE1lc2gsIF9mbGF0Q2FtZXJhICk7CgoJCX0KCgkJX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCwgcG9zaXRpb24gKSB7CgoJCQljb25zdCBmb3YgPSA5MDsKCQkJY29uc3QgYXNwZWN0ID0gMTsKCQkJY29uc3QgY3ViZUNhbWVyYSA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggZm92LCBhc3BlY3QsIG5lYXIsIGZhciApOwoJCQljb25zdCB1cFNpZ24gPSBbIDEsIC0xLCAxLCAxLCAxLCAxIF07CgkJCWNvbnN0IGZvcndhcmRTaWduID0gWyAxLCAxLCAxLCAtMSwgLTEsIC0xIF07CgkJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgoJCQljb25zdCBvcmlnaW5hbEF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKCQkJY29uc3QgdG9uZU1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCQkJcmVuZGVyZXIuZ2V0Q2xlYXJDb2xvciggX2NsZWFyQ29sb3IgKTsKCgkJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgoJCQljb25zdCBiYWNrZ3JvdW5kTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsKCQkJCW5hbWU6ICdQTVJFTS5CYWNrZ3JvdW5kJywKCQkJCXNpZGU6IEJhY2tTaWRlLAoJCQkJZGVwdGhXcml0ZTogZmFsc2UsCgkJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQl9ICk7CgoJCQljb25zdCBiYWNrZ3JvdW5kQm94ID0gbmV3IE1lc2goIG5ldyBCb3hHZW9tZXRyeSgpLCBiYWNrZ3JvdW5kTWF0ZXJpYWwgKTsKCgkJCWxldCB1c2VTb2xpZENvbG9yID0gZmFsc2U7CgkJCWNvbnN0IGJhY2tncm91bmQgPSBzY2VuZS5iYWNrZ3JvdW5kOwoKCQkJaWYgKCBiYWNrZ3JvdW5kICkgewoKCQkJCWlmICggYmFja2dyb3VuZC5pc0NvbG9yICkgewoKCQkJCQliYWNrZ3JvdW5kTWF0ZXJpYWwuY29sb3IuY29weSggYmFja2dyb3VuZCApOwoJCQkJCXNjZW5lLmJhY2tncm91bmQgPSBudWxsOwoJCQkJCXVzZVNvbGlkQ29sb3IgPSB0cnVlOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJYmFja2dyb3VuZE1hdGVyaWFsLmNvbG9yLmNvcHkoIF9jbGVhckNvbG9yICk7CgkJCQl1c2VTb2xpZENvbG9yID0gdHJ1ZTsKCgkJCX0KCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJY29uc3QgY29sID0gaSAlIDM7CgoJCQkJaWYgKCBjb2wgPT09IDAgKSB7CgoJCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCB1cFNpZ25bIGkgXSwgMCApOwoJCQkJCWN1YmVDYW1lcmEucG9zaXRpb24uc2V0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CgkJCQkJY3ViZUNhbWVyYS5sb29rQXQoIHBvc2l0aW9uLnggKyBmb3J3YXJkU2lnblsgaSBdLCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICk7CgoJCQkJfSBlbHNlIGlmICggY29sID09PSAxICkgewoKCQkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgMCwgdXBTaWduWyBpIF0gKTsKCQkJCQljdWJlQ2FtZXJhLnBvc2l0aW9uLnNldCggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwoJCQkJCWN1YmVDYW1lcmEubG9va0F0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55ICsgZm9yd2FyZFNpZ25bIGkgXSwgcG9zaXRpb24ueiApOwoKCgkJCQl9IGVsc2UgewoKCQkJCQljdWJlQ2FtZXJhLnVwLnNldCggMCwgdXBTaWduWyBpIF0sIDAgKTsKCQkJCQljdWJlQ2FtZXJhLnBvc2l0aW9uLnNldCggcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiApOwoJCQkJCWN1YmVDYW1lcmEubG9va0F0KCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56ICsgZm9yd2FyZFNpZ25bIGkgXSApOwoKCQkJCX0KCgkJCQljb25zdCBzaXplID0gdGhpcy5fY3ViZVNpemU7CgoJCQkJX3NldFZpZXdwb3J0KCBjdWJlVVZSZW5kZXJUYXJnZXQsIGNvbCAqIHNpemUsIGkgPiAyID8gc2l6ZSA6IDAsIHNpemUsIHNpemUgKTsKCgkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKCQkJCWlmICggdXNlU29saWRDb2xvciApIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVyKCBiYWNrZ3JvdW5kQm94LCBjdWJlQ2FtZXJhICk7CgoJCQkJfQoKCQkJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGN1YmVDYW1lcmEgKTsKCgkJCX0KCgkJCWJhY2tncm91bmRCb3guZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCQliYWNrZ3JvdW5kQm94Lm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gdG9uZU1hcHBpbmc7CgkJCXJlbmRlcmVyLmF1dG9DbGVhciA9IG9yaWdpbmFsQXV0b0NsZWFyOwoJCQlzY2VuZS5iYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCgkJfQoKCQlfdGV4dHVyZVRvQ3ViZVVWKCB0ZXh0dXJlLCBjdWJlVVZSZW5kZXJUYXJnZXQgKSB7CgoJCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoKCQkJY29uc3QgaXNDdWJlVGV4dHVyZSA9ICggdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgfHwgdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmcmFjdGlvbk1hcHBpbmcgKTsKCgkJCWlmICggaXNDdWJlVGV4dHVyZSApIHsKCgkJCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gX2dldEN1YmVtYXBNYXRlcmlhbCgpOwoKCQkJCX0KCgkJCQl0aGlzLl9jdWJlbWFwTWF0ZXJpYWwudW5pZm9ybXMuZmxpcEVudk1hcC52YWx1ZSA9ICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IF9nZXRFcXVpcmVjdE1hdGVyaWFsKCk7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgbWF0ZXJpYWwgPSBpc0N1YmVUZXh0dXJlID8gdGhpcy5fY3ViZW1hcE1hdGVyaWFsIDogdGhpcy5fZXF1aXJlY3RNYXRlcmlhbDsKCQkJY29uc3QgbWVzaCA9IG5ldyBNZXNoKCB0aGlzLl9sb2RQbGFuZXNbIDAgXSwgbWF0ZXJpYWwgKTsKCgkJCWNvbnN0IHVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgoJCQl1bmlmb3Jtc1sgJ2Vudk1hcCcgXS52YWx1ZSA9IHRleHR1cmU7CgoJCQljb25zdCBzaXplID0gdGhpcy5fY3ViZVNpemU7CgoJCQlfc2V0Vmlld3BvcnQoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgMyAqIHNpemUsIDIgKiBzaXplICk7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIG1lc2gsIF9mbGF0Q2FtZXJhICk7CgoJCX0KCgkJX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCgkJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgkJCWNvbnN0IGF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gZmFsc2U7CgkJCWNvbnN0IG4gPSB0aGlzLl9sb2RQbGFuZXMubGVuZ3RoOwoKCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgbjsgaSArKyApIHsKCgkJCQljb25zdCBzaWdtYSA9IE1hdGguc3FydCggdGhpcy5fc2lnbWFzWyBpIF0gKiB0aGlzLl9zaWdtYXNbIGkgXSAtIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSAqIHRoaXMuX3NpZ21hc1sgaSAtIDEgXSApOwoKCQkJCWNvbnN0IHBvbGVBeGlzID0gX2F4aXNEaXJlY3Rpb25zWyAoIG4gLSBpIC0gMSApICUgX2F4aXNEaXJlY3Rpb25zLmxlbmd0aCBdOwoKCQkJCXRoaXMuX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgaSAtIDEsIGksIHNpZ21hLCBwb2xlQXhpcyApOwoKCQkJfQoKCQkJcmVuZGVyZXIuYXV0b0NsZWFyID0gYXV0b0NsZWFyOwoKCQl9CgoJCS8qKgoJCSAqIFRoaXMgaXMgYSB0d28tcGFzcyBHYXVzc2lhbiBibHVyIGZvciBhIGN1YmVtYXAuIE5vcm1hbGx5IHRoaXMgaXMgZG9uZQoJCSAqIHZlcnRpY2FsbHkgYW5kIGhvcml6b250YWxseSwgYnV0IHRoaXMgYnJlYWtzIGRvd24gb24gYSBjdWJlLiBIZXJlIHdlIGFwcGx5CgkJICogdGhlIGJsdXIgbGF0aXR1ZGluYWxseSAoYXJvdW5kIHRoZSBwb2xlcyksIGFuZCB0aGVuIGxvbmdpdHVkaW5hbGx5ICh0b3dhcmRzCgkJICogdGhlIHBvbGVzKSB0byBhcHByb3hpbWF0ZSB0aGUgb3J0aG9nb25hbGx5LXNlcGFyYWJsZSBibHVyLiBJdCBpcyBsZWFzdAoJCSAqIGFjY3VyYXRlIGF0IHRoZSBwb2xlcywgYnV0IHN0aWxsIGRvZXMgYSBkZWNlbnQgam9iLgoJCSAqCgkJICogQHByaXZhdGUKCQkgKiBAcGFyYW0ge1dlYkdMUmVuZGVyVGFyZ2V0fSBjdWJlVVZSZW5kZXJUYXJnZXQKCQkgKiBAcGFyYW0ge251bWJlcn0gbG9kSW4KCQkgKiBAcGFyYW0ge251bWJlcn0gbG9kT3V0CgkJICogQHBhcmFtIHtudW1iZXJ9IHNpZ21hCgkJICogQHBhcmFtIHtWZWN0b3IzfSBbcG9sZUF4aXNdCgkJICovCgkJX2JsdXIoIGN1YmVVVlJlbmRlclRhcmdldCwgbG9kSW4sIGxvZE91dCwgc2lnbWEsIHBvbGVBeGlzICkgewoKCQkJY29uc3QgcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldDsKCgkJCXRoaXMuX2hhbGZCbHVyKAoJCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LAoJCQkJcGluZ1BvbmdSZW5kZXJUYXJnZXQsCgkJCQlsb2RJbiwKCQkJCWxvZE91dCwKCQkJCXNpZ21hLAoJCQkJJ2xhdGl0dWRpbmFsJywKCQkJCXBvbGVBeGlzICk7CgoJCQl0aGlzLl9oYWxmQmx1cigKCQkJCXBpbmdQb25nUmVuZGVyVGFyZ2V0LAoJCQkJY3ViZVVWUmVuZGVyVGFyZ2V0LAoJCQkJbG9kT3V0LAoJCQkJbG9kT3V0LAoJCQkJc2lnbWEsCgkJCQknbG9uZ2l0dWRpbmFsJywKCQkJCXBvbGVBeGlzICk7CgoJCX0KCgkJX2hhbGZCbHVyKCB0YXJnZXRJbiwgdGFyZ2V0T3V0LCBsb2RJbiwgbG9kT3V0LCBzaWdtYVJhZGlhbnMsIGRpcmVjdGlvbiwgcG9sZUF4aXMgKSB7CgoJCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoJCQljb25zdCBibHVyTWF0ZXJpYWwgPSB0aGlzLl9ibHVyTWF0ZXJpYWw7CgoJCQlpZiAoIGRpcmVjdGlvbiAhPT0gJ2xhdGl0dWRpbmFsJyAmJiBkaXJlY3Rpb24gIT09ICdsb25naXR1ZGluYWwnICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoCgkJCQkJJ2JsdXIgZGlyZWN0aW9uIG11c3QgYmUgZWl0aGVyIGxhdGl0dWRpbmFsIG9yIGxvbmdpdHVkaW5hbCEnICk7CgoJCQl9CgoJCQkvLyBOdW1iZXIgb2Ygc3RhbmRhcmQgZGV2aWF0aW9ucyBhdCB3aGljaCB0byBjdXQgb2ZmIHRoZSBkaXNjcmV0ZSBhcHByb3hpbWF0aW9uLgoJCQljb25zdCBTVEFOREFSRF9ERVZJQVRJT05TID0gMzsKCgkJCWNvbnN0IGJsdXJNZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgbG9kT3V0IF0sIGJsdXJNYXRlcmlhbCApOwoJCQljb25zdCBibHVyVW5pZm9ybXMgPSBibHVyTWF0ZXJpYWwudW5pZm9ybXM7CgoJCQljb25zdCBwaXhlbHMgPSB0aGlzLl9zaXplTG9kc1sgbG9kSW4gXSAtIDE7CgkJCWNvbnN0IHJhZGlhbnNQZXJQaXhlbCA9IGlzRmluaXRlKCBzaWdtYVJhZGlhbnMgKSA/IE1hdGguUEkgLyAoIDIgKiBwaXhlbHMgKSA6IDIgKiBNYXRoLlBJIC8gKCAyICogTUFYX1NBTVBMRVMgLSAxICk7CgkJCWNvbnN0IHNpZ21hUGl4ZWxzID0gc2lnbWFSYWRpYW5zIC8gcmFkaWFuc1BlclBpeGVsOwoJCQljb25zdCBzYW1wbGVzID0gaXNGaW5pdGUoIHNpZ21hUmFkaWFucyApID8gMSArIE1hdGguZmxvb3IoIFNUQU5EQVJEX0RFVklBVElPTlMgKiBzaWdtYVBpeGVscyApIDogTUFYX1NBTVBMRVM7CgoJCQlpZiAoIHNhbXBsZXMgPiBNQVhfU0FNUExFUyApIHsKCgkJCQljb25zb2xlLndhcm4oIGBzaWdtYVJhZGlhbnMsICR7CgkJCQlzaWdtYVJhZGlhbnN9LCBpcyB0b28gbGFyZ2UgYW5kIHdpbGwgY2xpcCwgYXMgaXQgcmVxdWVzdGVkICR7CgkJCQlzYW1wbGVzfSBzYW1wbGVzIHdoZW4gdGhlIG1heGltdW0gaXMgc2V0IHRvICR7TUFYX1NBTVBMRVN9YCApOwoKCQkJfQoKCQkJY29uc3Qgd2VpZ2h0cyA9IFtdOwoJCQlsZXQgc3VtID0gMDsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IE1BWF9TQU1QTEVTOyArKyBpICkgewoKCQkJCWNvbnN0IHggPSBpIC8gc2lnbWFQaXhlbHM7CgkJCQljb25zdCB3ZWlnaHQgPSBNYXRoLmV4cCggLSB4ICogeCAvIDIgKTsKCQkJCXdlaWdodHMucHVzaCggd2VpZ2h0ICk7CgoJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQlzdW0gKz0gd2VpZ2h0OwoKCQkJCX0gZWxzZSBpZiAoIGkgPCBzYW1wbGVzICkgewoKCQkJCQlzdW0gKz0gMiAqIHdlaWdodDsKCgkJCQl9CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB3ZWlnaHRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl3ZWlnaHRzWyBpIF0gPSB3ZWlnaHRzWyBpIF0gLyBzdW07CgoJCQl9CgoJCQlibHVyVW5pZm9ybXNbICdlbnZNYXAnIF0udmFsdWUgPSB0YXJnZXRJbi50ZXh0dXJlOwoJCQlibHVyVW5pZm9ybXNbICdzYW1wbGVzJyBdLnZhbHVlID0gc2FtcGxlczsKCQkJYmx1clVuaWZvcm1zWyAnd2VpZ2h0cycgXS52YWx1ZSA9IHdlaWdodHM7CgkJCWJsdXJVbmlmb3Jtc1sgJ2xhdGl0dWRpbmFsJyBdLnZhbHVlID0gZGlyZWN0aW9uID09PSAnbGF0aXR1ZGluYWwnOwoKCQkJaWYgKCBwb2xlQXhpcyApIHsKCgkJCQlibHVyVW5pZm9ybXNbICdwb2xlQXhpcycgXS52YWx1ZSA9IHBvbGVBeGlzOwoKCQkJfQoKCQkJY29uc3QgeyBfbG9kTWF4IH0gPSB0aGlzOwoJCQlibHVyVW5pZm9ybXNbICdkVGhldGEnIF0udmFsdWUgPSByYWRpYW5zUGVyUGl4ZWw7CgkJCWJsdXJVbmlmb3Jtc1sgJ21pcEludCcgXS52YWx1ZSA9IF9sb2RNYXggLSBsb2RJbjsKCgkJCWNvbnN0IG91dHB1dFNpemUgPSB0aGlzLl9zaXplTG9kc1sgbG9kT3V0IF07CgkJCWNvbnN0IHggPSAzICogb3V0cHV0U2l6ZSAqICggbG9kT3V0ID4gX2xvZE1heCAtIExPRF9NSU4gPyBsb2RPdXQgLSBfbG9kTWF4ICsgTE9EX01JTiA6IDAgKTsKCQkJY29uc3QgeSA9IDQgKiAoIHRoaXMuX2N1YmVTaXplIC0gb3V0cHV0U2l6ZSApOwoKCQkJX3NldFZpZXdwb3J0KCB0YXJnZXRPdXQsIHgsIHksIDMgKiBvdXRwdXRTaXplLCAyICogb3V0cHV0U2l6ZSApOwoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHRhcmdldE91dCApOwoJCQlyZW5kZXJlci5yZW5kZXIoIGJsdXJNZXNoLCBfZmxhdENhbWVyYSApOwoKCQl9CgoJfQoKCgoJZnVuY3Rpb24gX2NyZWF0ZVBsYW5lcyggbG9kTWF4ICkgewoKCQljb25zdCBsb2RQbGFuZXMgPSBbXTsKCQljb25zdCBzaXplTG9kcyA9IFtdOwoJCWNvbnN0IHNpZ21hcyA9IFtdOwoKCQlsZXQgbG9kID0gbG9kTWF4OwoKCQljb25zdCB0b3RhbExvZHMgPSBsb2RNYXggLSBMT0RfTUlOICsgMSArIEVYVFJBX0xPRF9TSUdNQS5sZW5ndGg7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRvdGFsTG9kczsgaSArKyApIHsKCgkJCWNvbnN0IHNpemVMb2QgPSBNYXRoLnBvdyggMiwgbG9kICk7CgkJCXNpemVMb2RzLnB1c2goIHNpemVMb2QgKTsKCQkJbGV0IHNpZ21hID0gMS4wIC8gc2l6ZUxvZDsKCgkJCWlmICggaSA+IGxvZE1heCAtIExPRF9NSU4gKSB7CgoJCQkJc2lnbWEgPSBFWFRSQV9MT0RfU0lHTUFbIGkgLSBsb2RNYXggKyBMT0RfTUlOIC0gMSBdOwoKCQkJfSBlbHNlIGlmICggaSA9PT0gMCApIHsKCgkJCQlzaWdtYSA9IDA7CgoJCQl9CgoJCQlzaWdtYXMucHVzaCggc2lnbWEgKTsKCgkJCWNvbnN0IHRleGVsU2l6ZSA9IDEuMCAvICggc2l6ZUxvZCAtIDIgKTsKCQkJY29uc3QgbWluID0gLSB0ZXhlbFNpemU7CgkJCWNvbnN0IG1heCA9IDEgKyB0ZXhlbFNpemU7CgkJCWNvbnN0IHV2MSA9IFsgbWluLCBtaW4sIG1heCwgbWluLCBtYXgsIG1heCwgbWluLCBtaW4sIG1heCwgbWF4LCBtaW4sIG1heCBdOwoKCQkJY29uc3QgY3ViZUZhY2VzID0gNjsKCQkJY29uc3QgdmVydGljZXMgPSA2OwoJCQljb25zdCBwb3NpdGlvblNpemUgPSAzOwoJCQljb25zdCB1dlNpemUgPSAyOwoJCQljb25zdCBmYWNlSW5kZXhTaXplID0gMTsKCgkJCWNvbnN0IHBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25TaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCQkJY29uc3QgdXYgPSBuZXcgRmxvYXQzMkFycmF5KCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGN1YmVGYWNlcyApOwoJCQljb25zdCBmYWNlSW5kZXggPSBuZXcgRmxvYXQzMkFycmF5KCBmYWNlSW5kZXhTaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCgkJCWZvciAoIGxldCBmYWNlID0gMDsgZmFjZSA8IGN1YmVGYWNlczsgZmFjZSArKyApIHsKCgkJCQljb25zdCB4ID0gKCBmYWNlICUgMyApICogMiAvIDMgLSAxOwoJCQkJY29uc3QgeSA9IGZhY2UgPiAyID8gMCA6IC0xOwoJCQkJY29uc3QgY29vcmRpbmF0ZXMgPSBbCgkJCQkJeCwgeSwgMCwKCQkJCQl4ICsgMiAvIDMsIHksIDAsCgkJCQkJeCArIDIgLyAzLCB5ICsgMSwgMCwKCQkJCQl4LCB5LCAwLAoJCQkJCXggKyAyIC8gMywgeSArIDEsIDAsCgkJCQkJeCwgeSArIDEsIDAKCQkJCV07CgkJCQlwb3NpdGlvbi5zZXQoIGNvb3JkaW5hdGVzLCBwb3NpdGlvblNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCQkJCXV2LnNldCggdXYxLCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCQkJCWNvbnN0IGZpbGwgPSBbIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UsIGZhY2UgXTsKCQkJCWZhY2VJbmRleC5zZXQoIGZpbGwsIGZhY2VJbmRleFNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCgkJCX0KCgkJCWNvbnN0IHBsYW5lcyA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCQlwbGFuZXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgcG9zaXRpb25TaXplICkgKTsKCQkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdXYsIHV2U2l6ZSApICk7CgkJCXBsYW5lcy5zZXRBdHRyaWJ1dGUoICdmYWNlSW5kZXgnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBmYWNlSW5kZXgsIGZhY2VJbmRleFNpemUgKSApOwoJCQlsb2RQbGFuZXMucHVzaCggcGxhbmVzICk7CgoJCQlpZiAoIGxvZCA+IExPRF9NSU4gKSB7CgoJCQkJbG9kIC0tOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7IGxvZFBsYW5lcywgc2l6ZUxvZHMsIHNpZ21hcyB9OwoKCX0KCglmdW5jdGlvbiBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKSB7CgoJCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggd2lkdGgsIGhlaWdodCwgcGFyYW1zICk7CgkJY3ViZVVWUmVuZGVyVGFyZ2V0LnRleHR1cmUubWFwcGluZyA9IEN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOwoJCWN1YmVVVlJlbmRlclRhcmdldC50ZXh0dXJlLm5hbWUgPSAnUE1SRU0uY3ViZVV2JzsKCQljdWJlVVZSZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSB0cnVlOwoJCXJldHVybiBjdWJlVVZSZW5kZXJUYXJnZXQ7CgoJfQoKCWZ1bmN0aW9uIF9zZXRWaWV3cG9ydCggdGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCQl0YXJnZXQudmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgkJdGFyZ2V0LnNjaXNzb3Iuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJfQoKCWZ1bmN0aW9uIF9nZXRCbHVyU2hhZGVyKCBsb2RNYXgsIHdpZHRoLCBoZWlnaHQgKSB7CgoJCWNvbnN0IHdlaWdodHMgPSBuZXcgRmxvYXQzMkFycmF5KCBNQVhfU0FNUExFUyApOwoJCWNvbnN0IHBvbGVBeGlzID0gbmV3IFZlY3RvcjMoIDAsIDEsIDAgKTsKCQljb25zdCBzaGFkZXJNYXRlcmlhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoKCQkJbmFtZTogJ1NwaGVyaWNhbEdhdXNzaWFuQmx1cicsCgoJCQlkZWZpbmVzOiB7CgkJCQknbic6IE1BWF9TQU1QTEVTLAoJCQkJJ0NVQkVVVl9URVhFTF9XSURUSCc6IDEuMCAvIHdpZHRoLAoJCQkJJ0NVQkVVVl9URVhFTF9IRUlHSFQnOiAxLjAgLyBoZWlnaHQsCgkJCQknQ1VCRVVWX01BWF9NSVAnOiBgJHtsb2RNYXh9LjBgLAoJCQl9LAoKCQkJdW5pZm9ybXM6IHsKCQkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0sCgkJCQknc2FtcGxlcyc6IHsgdmFsdWU6IDEgfSwKCQkJCSd3ZWlnaHRzJzogeyB2YWx1ZTogd2VpZ2h0cyB9LAoJCQkJJ2xhdGl0dWRpbmFsJzogeyB2YWx1ZTogZmFsc2UgfSwKCQkJCSdkVGhldGEnOiB7IHZhbHVlOiAwIH0sCgkJCQknbWlwSW50JzogeyB2YWx1ZTogMCB9LAoJCQkJJ3BvbGVBeGlzJzogeyB2YWx1ZTogcG9sZUF4aXMgfQoJCQl9LAoKCQkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgoJCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDsKCQkJdW5pZm9ybSBpbnQgc2FtcGxlczsKCQkJdW5pZm9ybSBmbG9hdCB3ZWlnaHRzWyBuIF07CgkJCXVuaWZvcm0gYm9vbCBsYXRpdHVkaW5hbDsKCQkJdW5pZm9ybSBmbG9hdCBkVGhldGE7CgkJCXVuaWZvcm0gZmxvYXQgbWlwSW50OwoJCQl1bmlmb3JtIHZlYzMgcG9sZUF4aXM7CgoJCQkjZGVmaW5lIEVOVk1BUF9UWVBFX0NVQkVfVVYKCQkJI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD4KCgkJCXZlYzMgZ2V0U2FtcGxlKCBmbG9hdCB0aGV0YSwgdmVjMyBheGlzICkgewoKCQkJCWZsb2F0IGNvc1RoZXRhID0gY29zKCB0aGV0YSApOwoJCQkJLy8gUm9kcmlndWVzJyBheGlzLWFuZ2xlIHJvdGF0aW9uCgkJCQl2ZWMzIHNhbXBsZURpcmVjdGlvbiA9IHZPdXRwdXREaXJlY3Rpb24gKiBjb3NUaGV0YQoJCQkJCSsgY3Jvc3MoIGF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKSAqIHNpbiggdGhldGEgKQoJCQkJCSsgYXhpcyAqIGRvdCggYXhpcywgdk91dHB1dERpcmVjdGlvbiApICogKCAxLjAgLSBjb3NUaGV0YSApOwoKCQkJCXJldHVybiBiaWxpbmVhckN1YmVVViggZW52TWFwLCBzYW1wbGVEaXJlY3Rpb24sIG1pcEludCApOwoKCQkJfQoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgYXhpcyA9IGxhdGl0dWRpbmFsID8gcG9sZUF4aXMgOiBjcm9zcyggcG9sZUF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKTsKCgkJCQlpZiAoIGFsbCggZXF1YWwoIGF4aXMsIHZlYzMoIDAuMCApICkgKSApIHsKCgkJCQkJYXhpcyA9IHZlYzMoIHZPdXRwdXREaXJlY3Rpb24ueiwgMC4wLCAtIHZPdXRwdXREaXJlY3Rpb24ueCApOwoKCQkJCX0KCgkJCQlheGlzID0gbm9ybWFsaXplKCBheGlzICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggMC4wLCAwLjAsIDAuMCwgMS4wICk7CgkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIDAgXSAqIGdldFNhbXBsZSggMC4wLCBheGlzICk7CgoJCQkJZm9yICggaW50IGkgPSAxOyBpIDwgbjsgaSsrICkgewoKCQkJCQlpZiAoIGkgPj0gc2FtcGxlcyApIHsKCgkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJCWZsb2F0IHRoZXRhID0gZFRoZXRhICogZmxvYXQoIGkgKTsKCQkJCQlnbF9GcmFnQ29sb3IucmdiICs9IHdlaWdodHNbIGkgXSAqIGdldFNhbXBsZSggLTEuMCAqIHRoZXRhLCBheGlzICk7CgkJCQkJZ2xfRnJhZ0NvbG9yLnJnYiArPSB3ZWlnaHRzWyBpIF0gKiBnZXRTYW1wbGUoIHRoZXRhLCBheGlzICk7CgoJCQkJfQoKCQkJfQoJCWAsCgoJCQlibGVuZGluZzogTm9CbGVuZGluZywKCQkJZGVwdGhUZXN0OiBmYWxzZSwKCQkJZGVwdGhXcml0ZTogZmFsc2UKCgkJfSApOwoKCQlyZXR1cm4gc2hhZGVyTWF0ZXJpYWw7CgoJfQoKCWZ1bmN0aW9uIF9nZXRFcXVpcmVjdE1hdGVyaWFsKCkgewoKCQlyZXR1cm4gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgoJCQluYW1lOiAnRXF1aXJlY3Rhbmd1bGFyVG9DdWJlVVYnLAoKCQkJdW5pZm9ybXM6IHsKCQkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0KCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7CgoJCQkjaW5jbHVkZSA8Y29tbW9uPgoKCQkJdm9pZCBtYWluKCkgewoKCQkJCXZlYzMgb3V0cHV0RGlyZWN0aW9uID0gbm9ybWFsaXplKCB2T3V0cHV0RGlyZWN0aW9uICk7CgkJCQl2ZWMyIHV2ID0gZXF1aXJlY3RVdiggb3V0cHV0RGlyZWN0aW9uICk7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdmVjNCggdGV4dHVyZTJEICggZW52TWFwLCB1diApLnJnYiwgMS4wICk7CgoJCQl9CgkJYCwKCgkJCWJsZW5kaW5nOiBOb0JsZW5kaW5nLAoJCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCQlkZXB0aFdyaXRlOiBmYWxzZQoKCQl9ICk7CgoJfQoKCWZ1bmN0aW9uIF9nZXRDdWJlbWFwTWF0ZXJpYWwoKSB7CgoJCXJldHVybiBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCgkJCW5hbWU6ICdDdWJlbWFwVG9DdWJlVVYnLAoKCQkJdW5pZm9ybXM6IHsKCQkJCSdlbnZNYXAnOiB7IHZhbHVlOiBudWxsIH0sCgkJCQknZmxpcEVudk1hcCc6IHsgdmFsdWU6IC0xIH0KCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKCQkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdW5pZm9ybSBmbG9hdCBmbGlwRW52TWFwOwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDsKCgkJCXZvaWQgbWFpbigpIHsKCgkJCQlnbF9GcmFnQ29sb3IgPSB0ZXh0dXJlQ3ViZSggZW52TWFwLCB2ZWMzKCBmbGlwRW52TWFwICogdk91dHB1dERpcmVjdGlvbi54LCB2T3V0cHV0RGlyZWN0aW9uLnl6ICkgKTsKCgkJCX0KCQlgLAoKCQkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCgkJCWRlcHRoVGVzdDogZmFsc2UsCgkJCWRlcHRoV3JpdGU6IGZhbHNlCgoJCX0gKTsKCgl9CgoJZnVuY3Rpb24gX2dldENvbW1vblZlcnRleFNoYWRlcigpIHsKCgkJcmV0dXJuIC8qIGdsc2wgKi9gCgoJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJYXR0cmlidXRlIGZsb2F0IGZhY2VJbmRleDsKCgkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCS8vIFJIIGNvb3JkaW5hdGUgc3lzdGVtOyBQTVJFTSBmYWNlLWluZGV4aW5nIGNvbnZlbnRpb24KCQl2ZWMzIGdldERpcmVjdGlvbiggdmVjMiB1diwgZmxvYXQgZmFjZSApIHsKCgkJCXV2ID0gMi4wICogdXYgLSAxLjA7CgoJCQl2ZWMzIGRpcmVjdGlvbiA9IHZlYzMoIHV2LCAxLjAgKTsKCgkJCWlmICggZmFjZSA9PSAwLjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnp5eDsgLy8gKCAxLCB2LCB1ICkgcG9zIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gMS4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHogKj0gLTEuMDsgLy8gKCAtdSwgMSwgLXYgKSBwb3MgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSAyLjAgKSB7CgoJCQkJZGlyZWN0aW9uLnggKj0gLTEuMDsgLy8gKCAtdSwgdiwgMSApIHBvcyB6CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24uenl4OwoJCQkJZGlyZWN0aW9uLnh6ICo9IC0xLjA7IC8vICggLTEsIHYsIC11ICkgbmVnIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHkgKj0gLTEuMDsgLy8gKCAtdSwgLTEsIHYgKSBuZWcgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSA1LjAgKSB7CgoJCQkJZGlyZWN0aW9uLnogKj0gLTEuMDsgLy8gKCB1LCB2LCAtMSApIG5lZyB6CgoJCQl9CgoJCQlyZXR1cm4gZGlyZWN0aW9uOwoKCQl9CgoJCXZvaWQgbWFpbigpIHsKCgkJCXZPdXRwdXREaXJlY3Rpb24gPSBnZXREaXJlY3Rpb24oIHV2LCBmYWNlSW5kZXggKTsKCQkJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7CgoJCX0KCWA7CgoJfQoKCWZ1bmN0aW9uIFdlYkdMQ3ViZVVWTWFwcyggcmVuZGVyZXIgKSB7CgoJCWxldCBjdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJbGV0IHBtcmVtR2VuZXJhdG9yID0gbnVsbDsKCgkJZnVuY3Rpb24gZ2V0KCB0ZXh0dXJlICkgewoKCQkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKCQkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgoJCQkJY29uc3QgaXNFcXVpcmVjdE1hcCA9ICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcgfHwgbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKTsKCQkJCWNvbnN0IGlzQ3ViZU1hcCA9ICggbWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApOwoKCQkJCS8vIGVxdWlyZWN0L2N1YmUgbWFwIHRvIGN1YmVVViBjb252ZXJzaW9uCgoJCQkJaWYgKCBpc0VxdWlyZWN0TWFwIHx8IGlzQ3ViZU1hcCApIHsKCgkJCQkJbGV0IHJlbmRlclRhcmdldCA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgoJCQkJCWNvbnN0IGN1cnJlbnRQTVJFTVZlcnNpb24gPSByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCA/IHJlbmRlclRhcmdldC50ZXh0dXJlLnBtcmVtVmVyc2lvbiA6IDA7CgoJCQkJCWlmICggdGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgJiYgdGV4dHVyZS5wbXJlbVZlcnNpb24gIT09IGN1cnJlbnRQTVJFTVZlcnNpb24gKSB7CgoJCQkJCQlpZiAoIHBtcmVtR2VuZXJhdG9yID09PSBudWxsICkgcG1yZW1HZW5lcmF0b3IgPSBuZXcgUE1SRU1HZW5lcmF0b3IoIHJlbmRlcmVyICk7CgoJCQkJCQlyZW5kZXJUYXJnZXQgPSBpc0VxdWlyZWN0TWFwID8gcG1yZW1HZW5lcmF0b3IuZnJvbUVxdWlyZWN0YW5ndWxhciggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgOiBwbXJlbUdlbmVyYXRvci5mcm9tQ3ViZW1hcCggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICk7CgkJCQkJCXJlbmRlclRhcmdldC50ZXh0dXJlLnBtcmVtVmVyc2lvbiA9IHRleHR1cmUucG1yZW1WZXJzaW9uOwoKCQkJCQkJY3ViZVVWbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKCQkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKCgkJCQkJCQlpZiAoICggaXNFcXVpcmVjdE1hcCAmJiBpbWFnZSAmJiBpbWFnZS5oZWlnaHQgPiAwICkgfHwgKCBpc0N1YmVNYXAgJiYgaW1hZ2UgJiYgaXNDdWJlVGV4dHVyZUNvbXBsZXRlKCBpbWFnZSApICkgKSB7CgoJCQkJCQkJCWlmICggcG1yZW1HZW5lcmF0b3IgPT09IG51bGwgKSBwbXJlbUdlbmVyYXRvciA9IG5ldyBQTVJFTUdlbmVyYXRvciggcmVuZGVyZXIgKTsKCgkJCQkJCQkJcmVuZGVyVGFyZ2V0ID0gaXNFcXVpcmVjdE1hcCA/IHBtcmVtR2VuZXJhdG9yLmZyb21FcXVpcmVjdGFuZ3VsYXIoIHRleHR1cmUgKSA6IHBtcmVtR2VuZXJhdG9yLmZyb21DdWJlbWFwKCB0ZXh0dXJlICk7CgkJCQkJCQkJcmVuZGVyVGFyZ2V0LnRleHR1cmUucG1yZW1WZXJzaW9uID0gdGV4dHVyZS5wbXJlbVZlcnNpb247CgoJCQkJCQkJCWN1YmVVVm1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCQkJdGV4dHVyZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCQkJCQkJcmV0dXJuIHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCS8vIGltYWdlIG5vdCB5ZXQgcmVhZHkuIHRyeSB0aGUgY29udmVyc2lvbiBuZXh0IGZyYW1lCgoJCQkJCQkJCXJldHVybiBudWxsOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiB0ZXh0dXJlOwoKCQl9CgoJCWZ1bmN0aW9uIGlzQ3ViZVRleHR1cmVDb21wbGV0ZSggaW1hZ2UgKSB7CgoJCQlsZXQgY291bnQgPSAwOwoJCQljb25zdCBsZW5ndGggPSA2OwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKCQkJCWlmICggaW1hZ2VbIGkgXSAhPT0gdW5kZWZpbmVkICkgY291bnQgKys7CgoJCQl9CgoJCQlyZXR1cm4gY291bnQgPT09IGxlbmd0aDsKCgoJCX0KCgkJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCWNvbnN0IGN1YmVtYXBVViA9IGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlpZiAoIGN1YmVtYXBVViAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWN1YmVVVm1hcHMuZGVsZXRlKCB0ZXh0dXJlICk7CgkJCQljdWJlbWFwVVYuZGlzcG9zZSgpOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQljdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJCWlmICggcG1yZW1HZW5lcmF0b3IgIT09IG51bGwgKSB7CgoJCQkJcG1yZW1HZW5lcmF0b3IuZGlzcG9zZSgpOwoJCQkJcG1yZW1HZW5lcmF0b3IgPSBudWxsOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7CgkJCWdldDogZ2V0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xFeHRlbnNpb25zKCBnbCApIHsKCgkJY29uc3QgZXh0ZW5zaW9ucyA9IHt9OwoKCQlmdW5jdGlvbiBnZXRFeHRlbnNpb24oIG5hbWUgKSB7CgoJCQlpZiAoIGV4dGVuc2lvbnNbIG5hbWUgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBleHRlbnNpb25zWyBuYW1lIF07CgoJCQl9CgoJCQlsZXQgZXh0ZW5zaW9uOwoKCQkJc3dpdGNoICggbmFtZSApIHsKCgkJCQljYXNlICdXRUJHTF9kZXB0aF90ZXh0dXJlJzoKCQkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9kZXB0aF90ZXh0dXJlJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9XRUJHTF9kZXB0aF90ZXh0dXJlJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9kZXB0aF90ZXh0dXJlJyApOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYyc6CgkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Yyc6CgkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnTU9aX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnOgoJCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApOwoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgkJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCBuYW1lICk7CgoJCQl9CgoJCQlleHRlbnNpb25zWyBuYW1lIF0gPSBleHRlbnNpb247CgoJCQlyZXR1cm4gZXh0ZW5zaW9uOwoKCQl9CgoJCXJldHVybiB7CgoJCQloYXM6IGZ1bmN0aW9uICggbmFtZSApIHsKCgkJCQlyZXR1cm4gZ2V0RXh0ZW5zaW9uKCBuYW1lICkgIT09IG51bGw7CgoJCQl9LAoKCQkJaW5pdDogZnVuY3Rpb24gKCkgewoKCQkJCWdldEV4dGVuc2lvbiggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9jbGlwX2N1bGxfZGlzdGFuY2UnICk7CgkJCQlnZXRFeHRlbnNpb24oICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICk7CgkJCQlnZXRFeHRlbnNpb24oICdFWFRfY29sb3JfYnVmZmVyX2hhbGZfZmxvYXQnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICk7CgkJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9yZW5kZXJfc2hhcmVkX2V4cG9uZW50JyApOwoKCQkJfSwKCgkJCWdldDogZnVuY3Rpb24gKCBuYW1lICkgewoKCQkJCWNvbnN0IGV4dGVuc2lvbiA9IGdldEV4dGVuc2lvbiggbmFtZSApOwoKCQkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMUmVuZGVyZXI6ICcgKyBuYW1lICsgJyBleHRlbnNpb24gbm90IHN1cHBvcnRlZC4nICk7CgoJCQkJfQoKCQkJCXJldHVybiBleHRlbnNpb247CgoJCQl9CgoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMR2VvbWV0cmllcyggZ2wsIGF0dHJpYnV0ZXMsIGluZm8sIGJpbmRpbmdTdGF0ZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJpZXMgPSB7fTsKCQljb25zdCB3aXJlZnJhbWVBdHRyaWJ1dGVzID0gbmV3IFdlYWtNYXAoKTsKCgkJZnVuY3Rpb24gb25HZW9tZXRyeURpc3Bvc2UoIGV2ZW50ICkgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBldmVudC50YXJnZXQ7CgoJCQlpZiAoIGdlb21ldHJ5LmluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBnZW9tZXRyeS5pbmRleCApOwoKCQkJfQoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBnZW9tZXRyeS5hdHRyaWJ1dGVzICkgewoKCQkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBnZW9tZXRyeS5hdHRyaWJ1dGVzWyBuYW1lIF0gKTsKCgkJCX0KCgkJCWdlb21ldHJ5LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25HZW9tZXRyeURpc3Bvc2UgKTsKCgkJCWRlbGV0ZSBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdOwoKCQkJY29uc3QgYXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgoJCQlpZiAoIGF0dHJpYnV0ZSApIHsKCgkJCQlhdHRyaWJ1dGVzLnJlbW92ZSggYXR0cmlidXRlICk7CgkJCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCgkJCX0KCgkJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mR2VvbWV0cnkoIGdlb21ldHJ5ICk7CgoJCQlpZiAoIGdlb21ldHJ5LmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgPT09IHRydWUgKSB7CgoJCQkJZGVsZXRlIGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50OwoKCQkJfQoKCQkJLy8KCgkJCWluZm8ubWVtb3J5Lmdlb21ldHJpZXMgLS07CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICkgewoKCQkJaWYgKCBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdID09PSB0cnVlICkgcmV0dXJuIGdlb21ldHJ5OwoKCQkJZ2VvbWV0cnkuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkdlb21ldHJ5RGlzcG9zZSApOwoKCQkJZ2VvbWV0cmllc1sgZ2VvbWV0cnkuaWQgXSA9IHRydWU7CgoJCQlpbmZvLm1lbW9yeS5nZW9tZXRyaWVzICsrOwoKCQkJcmV0dXJuIGdlb21ldHJ5OwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZSggZ2VvbWV0cnkgKSB7CgoJCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQkJLy8gVXBkYXRpbmcgaW5kZXggYnVmZmVyIGluIFZBTyBub3cuIFNlZSBXZWJHTEJpbmRpbmdTdGF0ZXMuCgoJCQlmb3IgKCBjb25zdCBuYW1lIGluIGdlb21ldHJ5QXR0cmlidXRlcyApIHsKCgkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF0sIGdsLkFSUkFZX0JVRkZFUiApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgoJCQljb25zdCBpbmRpY2VzID0gW107CgoJCQljb25zdCBnZW9tZXRyeUluZGV4ID0gZ2VvbWV0cnkuaW5kZXg7CgkJCWNvbnN0IGdlb21ldHJ5UG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQlsZXQgdmVyc2lvbiA9IDA7CgoJCQlpZiAoIGdlb21ldHJ5SW5kZXggIT09IG51bGwgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeUluZGV4LmFycmF5OwoJCQkJdmVyc2lvbiA9IGdlb21ldHJ5SW5kZXgudmVyc2lvbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpICs9IDMgKSB7CgoJCQkJCWNvbnN0IGEgPSBhcnJheVsgaSArIDAgXTsKCQkJCQljb25zdCBiID0gYXJyYXlbIGkgKyAxIF07CgkJCQkJY29uc3QgYyA9IGFycmF5WyBpICsgMiBdOwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBnZW9tZXRyeVBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeVBvc2l0aW9uLmFycmF5OwoJCQkJdmVyc2lvbiA9IGdlb21ldHJ5UG9zaXRpb24udmVyc2lvbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSAoIGFycmF5Lmxlbmd0aCAvIDMgKSAtIDE7IGkgPCBsOyBpICs9IDMgKSB7CgoJCQkJCWNvbnN0IGEgPSBpICsgMDsKCQkJCQljb25zdCBiID0gaSArIDE7CgkJCQkJY29uc3QgYyA9IGkgKyAyOwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybjsKCgkJCX0KCgkJCWNvbnN0IGF0dHJpYnV0ZSA9IG5ldyAoIGFycmF5TmVlZHNVaW50MzIoIGluZGljZXMgKSA/IFVpbnQzMkJ1ZmZlckF0dHJpYnV0ZSA6IFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSApKCBpbmRpY2VzLCAxICk7CgkJCWF0dHJpYnV0ZS52ZXJzaW9uID0gdmVyc2lvbjsKCgkJCS8vIFVwZGF0aW5nIGluZGV4IGJ1ZmZlciBpbiBWQU8gbm93LiBTZWUgV2ViR0xCaW5kaW5nU3RhdGVzCgoJCQkvLwoKCQkJY29uc3QgcHJldmlvdXNBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCgkJCWlmICggcHJldmlvdXNBdHRyaWJ1dGUgKSBhdHRyaWJ1dGVzLnJlbW92ZSggcHJldmlvdXNBdHRyaWJ1dGUgKTsKCgkJCS8vCgoJCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLnNldCggZ2VvbWV0cnksIGF0dHJpYnV0ZSApOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgoJCQljb25zdCBjdXJyZW50QXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgoJCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUgKSB7CgoJCQkJY29uc3QgZ2VvbWV0cnlJbmRleCA9IGdlb21ldHJ5LmluZGV4OwoKCQkJCWlmICggZ2VvbWV0cnlJbmRleCAhPT0gbnVsbCApIHsKCgkJCQkJLy8gaWYgdGhlIGF0dHJpYnV0ZSBpcyBvYnNvbGV0ZSwgY3JlYXRlIGEgbmV3IG9uZQoKCQkJCQlpZiAoIGN1cnJlbnRBdHRyaWJ1dGUudmVyc2lvbiA8IGdlb21ldHJ5SW5kZXgudmVyc2lvbiApIHsKCgkJCQkJCXVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdXBkYXRlV2lyZWZyYW1lQXR0cmlidXRlKCBnZW9tZXRyeSApOwoKCQkJfQoKCQkJcmV0dXJuIHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQl9CgoJCXJldHVybiB7CgoJCQlnZXQ6IGdldCwKCQkJdXBkYXRlOiB1cGRhdGUsCgoJCQlnZXRXaXJlZnJhbWVBdHRyaWJ1dGU6IGdldFdpcmVmcmFtZUF0dHJpYnV0ZQoKCQl9OwoKCX0KCglmdW5jdGlvbiBXZWJHTEluZGV4ZWRCdWZmZXJSZW5kZXJlciggZ2wsIGV4dGVuc2lvbnMsIGluZm8gKSB7CgoJCWxldCBtb2RlOwoKCQlmdW5jdGlvbiBzZXRNb2RlKCB2YWx1ZSApIHsKCgkJCW1vZGUgPSB2YWx1ZTsKCgkJfQoKCQlsZXQgdHlwZSwgYnl0ZXNQZXJFbGVtZW50OwoKCQlmdW5jdGlvbiBzZXRJbmRleCggdmFsdWUgKSB7CgoJCQl0eXBlID0gdmFsdWUudHlwZTsKCQkJYnl0ZXNQZXJFbGVtZW50ID0gdmFsdWUuYnl0ZXNQZXJFbGVtZW50OwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlciggc3RhcnQsIGNvdW50ICkgewoKCQkJZ2wuZHJhd0VsZW1lbnRzKCBtb2RlLCBjb3VudCwgdHlwZSwgc3RhcnQgKiBieXRlc1BlckVsZW1lbnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgMSApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlckluc3RhbmNlcyggc3RhcnQsIGNvdW50LCBwcmltY291bnQgKSB7CgoJCQlpZiAoIHByaW1jb3VudCA9PT0gMCApIHJldHVybjsKCgkJCWdsLmRyYXdFbGVtZW50c0luc3RhbmNlZCggbW9kZSwgY291bnQsIHR5cGUsIHN0YXJ0ICogYnl0ZXNQZXJFbGVtZW50LCBwcmltY291bnQgKTsKCgkJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3KCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50ICkgewoKCQkJaWYgKCBkcmF3Q291bnQgPT09IDAgKSByZXR1cm47CgoJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICk7CgkJCWV4dGVuc2lvbi5tdWx0aURyYXdFbGVtZW50c1dFQkdMKCBtb2RlLCBjb3VudHMsIDAsIHR5cGUsIHN0YXJ0cywgMCwgZHJhd0NvdW50ICk7CgoJCQlsZXQgZWxlbWVudENvdW50ID0gMDsKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKCQkJCWVsZW1lbnRDb3VudCArPSBjb3VudHNbIGkgXTsKCgkJCX0KCgkJCWluZm8udXBkYXRlKCBlbGVtZW50Q291bnQsIG1vZGUsIDEgKTsKCgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzKCBzdGFydHMsIGNvdW50cywgZHJhd0NvdW50LCBwcmltY291bnQgKSB7CgoJCQlpZiAoIGRyYXdDb3VudCA9PT0gMCApIHJldHVybjsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlfZHJhdycgKTsKCgkJCWlmICggZXh0ZW5zaW9uID09PSBudWxsICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHN0YXJ0cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXJlbmRlckluc3RhbmNlcyggc3RhcnRzWyBpIF0gLyBieXRlc1BlckVsZW1lbnQsIGNvdW50c1sgaSBdLCBwcmltY291bnRbIGkgXSApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9uLm11bHRpRHJhd0VsZW1lbnRzSW5zdGFuY2VkV0VCR0woIG1vZGUsIGNvdW50cywgMCwgdHlwZSwgc3RhcnRzLCAwLCBwcmltY291bnQsIDAsIGRyYXdDb3VudCApOwoKCQkJCWxldCBlbGVtZW50Q291bnQgPSAwOwoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZHJhd0NvdW50OyBpICsrICkgewoKCQkJCQllbGVtZW50Q291bnQgKz0gY291bnRzWyBpIF0gKiBwcmltY291bnRbIGkgXTsKCgkJCQl9CgoJCQkJaW5mby51cGRhdGUoIGVsZW1lbnRDb3VudCwgbW9kZSwgMSApOwoKCQkJfQoKCQl9CgoJCS8vCgoJCXRoaXMuc2V0TW9kZSA9IHNldE1vZGU7CgkJdGhpcy5zZXRJbmRleCA9IHNldEluZGV4OwoJCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJCXRoaXMucmVuZGVySW5zdGFuY2VzID0gcmVuZGVySW5zdGFuY2VzOwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3ID0gcmVuZGVyTXVsdGlEcmF3OwoJCXRoaXMucmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzID0gcmVuZGVyTXVsdGlEcmF3SW5zdGFuY2VzOwoKCX0KCglmdW5jdGlvbiBXZWJHTEluZm8oIGdsICkgewoKCQljb25zdCBtZW1vcnkgPSB7CgkJCWdlb21ldHJpZXM6IDAsCgkJCXRleHR1cmVzOiAwCgkJfTsKCgkJY29uc3QgcmVuZGVyID0gewoJCQlmcmFtZTogMCwKCQkJY2FsbHM6IDAsCgkJCXRyaWFuZ2xlczogMCwKCQkJcG9pbnRzOiAwLAoJCQlsaW5lczogMAoJCX07CgoJCWZ1bmN0aW9uIHVwZGF0ZSggY291bnQsIG1vZGUsIGluc3RhbmNlQ291bnQgKSB7CgoJCQlyZW5kZXIuY2FsbHMgKys7CgoJCQlzd2l0Y2ggKCBtb2RlICkgewoKCQkJCWNhc2UgZ2wuVFJJQU5HTEVTOgoJCQkJCXJlbmRlci50cmlhbmdsZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLyAzICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBnbC5MSU5FUzoKCQkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqICggY291bnQgLyAyICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBnbC5MSU5FX1NUUklQOgoJCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAtIDEgKTsKCQkJCQlicmVhazsKCgkJCQljYXNlIGdsLkxJTkVfTE9PUDoKCQkJCQlyZW5kZXIubGluZXMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgZ2wuUE9JTlRTOgoJCQkJCXJlbmRlci5wb2ludHMgKz0gaW5zdGFuY2VDb3VudCAqIGNvdW50OwoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMSW5mbzogVW5rbm93biBkcmF3IG1vZGU6JywgbW9kZSApOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlc2V0KCkgewoKCQkJcmVuZGVyLmNhbGxzID0gMDsKCQkJcmVuZGVyLnRyaWFuZ2xlcyA9IDA7CgkJCXJlbmRlci5wb2ludHMgPSAwOwoJCQlyZW5kZXIubGluZXMgPSAwOwoKCQl9CgoJCXJldHVybiB7CgkJCW1lbW9yeTogbWVtb3J5LAoJCQlyZW5kZXI6IHJlbmRlciwKCQkJcHJvZ3JhbXM6IG51bGwsCgkJCWF1dG9SZXNldDogdHJ1ZSwKCQkJcmVzZXQ6IHJlc2V0LAoJCQl1cGRhdGU6IHVwZGF0ZQoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMTW9ycGh0YXJnZXRzKCBnbCwgY2FwYWJpbGl0aWVzLCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgbW9ycGhUZXh0dXJlcyA9IG5ldyBXZWFrTWFwKCk7CgkJY29uc3QgbW9ycGggPSBuZXcgVmVjdG9yNCgpOwoKCQlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKSB7CgoJCQljb25zdCBvYmplY3RJbmZsdWVuY2VzID0gb2JqZWN0Lm1vcnBoVGFyZ2V0SW5mbHVlbmNlczsKCgkJCS8vIHRoZSBmb2xsb3dpbmcgZW5jb2RlcyBtb3JwaCB0YXJnZXRzIGludG8gYW4gYXJyYXkgb2YgZGF0YSB0ZXh0dXJlcy4gRWFjaCBsYXllciByZXByZXNlbnRzIGEgc2luZ2xlIG1vcnBoIHRhcmdldC4KCgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoJCQljb25zdCBtb3JwaFRhcmdldHNDb3VudCA9ICggbW9ycGhBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApID8gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoIDogMDsKCgkJCWxldCBlbnRyeSA9IG1vcnBoVGV4dHVyZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQkJaWYgKCBlbnRyeSA9PT0gdW5kZWZpbmVkIHx8IGVudHJ5LmNvdW50ICE9PSBtb3JwaFRhcmdldHNDb3VudCApIHsKCgkJCQlpZiAoIGVudHJ5ICE9PSB1bmRlZmluZWQgKSBlbnRyeS50ZXh0dXJlLmRpc3Bvc2UoKTsKCgkJCQljb25zdCBoYXNNb3JwaFBvc2l0aW9uID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQ7CgkJCQljb25zdCBoYXNNb3JwaE5vcm1hbHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQ7CgkJCQljb25zdCBoYXNNb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkOwoKCQkJCWNvbnN0IG1vcnBoVGFyZ2V0cyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBbXTsKCQkJCWNvbnN0IG1vcnBoTm9ybWFscyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgW107CgkJCQljb25zdCBtb3JwaENvbG9ycyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvciB8fCBbXTsKCgkJCQlsZXQgdmVydGV4RGF0YUNvdW50ID0gMDsKCgkJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAxOwoJCQkJaWYgKCBoYXNNb3JwaE5vcm1hbHMgPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAyOwoJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHZlcnRleERhdGFDb3VudCA9IDM7CgoJCQkJbGV0IHdpZHRoID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbi5jb3VudCAqIHZlcnRleERhdGFDb3VudDsKCQkJCWxldCBoZWlnaHQgPSAxOwoKCQkJCWlmICggd2lkdGggPiBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKSB7CgoJCQkJCWhlaWdodCA9IE1hdGguY2VpbCggd2lkdGggLyBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKCQkJCQl3aWR0aCA9IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCgkJCQl9CgoJCQkJY29uc3QgYnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSggd2lkdGggKiBoZWlnaHQgKiA0ICogbW9ycGhUYXJnZXRzQ291bnQgKTsKCgkJCQljb25zdCB0ZXh0dXJlID0gbmV3IERhdGFBcnJheVRleHR1cmUoIGJ1ZmZlciwgd2lkdGgsIGhlaWdodCwgbW9ycGhUYXJnZXRzQ291bnQgKTsKCQkJCXRleHR1cmUudHlwZSA9IEZsb2F0VHlwZTsKCQkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCS8vIGZpbGwgYnVmZmVyCgoJCQkJY29uc3QgdmVydGV4RGF0YVN0cmlkZSA9IHZlcnRleERhdGFDb3VudCAqIDQ7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbW9ycGhUYXJnZXRzQ291bnQ7IGkgKysgKSB7CgoJCQkJCWNvbnN0IG1vcnBoVGFyZ2V0ID0gbW9ycGhUYXJnZXRzWyBpIF07CgkJCQkJY29uc3QgbW9ycGhOb3JtYWwgPSBtb3JwaE5vcm1hbHNbIGkgXTsKCQkJCQljb25zdCBtb3JwaENvbG9yID0gbW9ycGhDb2xvcnNbIGkgXTsKCgkJCQkJY29uc3Qgb2Zmc2V0ID0gd2lkdGggKiBoZWlnaHQgKiA0ICogaTsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbW9ycGhUYXJnZXQuY291bnQ7IGogKysgKSB7CgoJCQkJCQljb25zdCBzdHJpZGUgPSBqICogdmVydGV4RGF0YVN0cmlkZTsKCgkJCQkJCWlmICggaGFzTW9ycGhQb3NpdGlvbiA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaFRhcmdldCwgaiApOwoKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMCBdID0gbW9ycGgueDsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMSBdID0gbW9ycGgueTsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMiBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMyBdID0gMDsKCgkJCQkJCX0KCgkJCQkJCWlmICggaGFzTW9ycGhOb3JtYWxzID09PSB0cnVlICkgewoKCQkJCQkJCW1vcnBoLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoTm9ybWFsLCBqICk7CgoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA0IF0gPSBtb3JwaC54OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA1IF0gPSBtb3JwaC55OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA2IF0gPSBtb3JwaC56OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA3IF0gPSAwOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBoYXNNb3JwaENvbG9ycyA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaENvbG9yLCBqICk7CgoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA4IF0gPSBtb3JwaC54OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyA5IF0gPSBtb3JwaC55OwoJCQkJCQkJYnVmZmVyWyBvZmZzZXQgKyBzdHJpZGUgKyAxMCBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMTEgXSA9ICggbW9ycGhDb2xvci5pdGVtU2l6ZSA9PT0gNCApID8gbW9ycGgudyA6IDE7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJZW50cnkgPSB7CgkJCQkJY291bnQ6IG1vcnBoVGFyZ2V0c0NvdW50LAoJCQkJCXRleHR1cmU6IHRleHR1cmUsCgkJCQkJc2l6ZTogbmV3IFZlY3RvcjIoIHdpZHRoLCBoZWlnaHQgKQoJCQkJfTsKCgkJCQltb3JwaFRleHR1cmVzLnNldCggZ2VvbWV0cnksIGVudHJ5ICk7CgoJCQkJZnVuY3Rpb24gZGlzcG9zZVRleHR1cmUoKSB7CgoJCQkJCXRleHR1cmUuZGlzcG9zZSgpOwoKCQkJCQltb3JwaFRleHR1cmVzLmRlbGV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJZ2VvbWV0cnkucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlVGV4dHVyZSApOwoKCQkJCX0KCgkJCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIGRpc3Bvc2VUZXh0dXJlICk7CgoJCQl9CgoJCQkvLwoJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWUgJiYgb2JqZWN0Lm1vcnBoVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUZXh0dXJlJywgb2JqZWN0Lm1vcnBoVGV4dHVyZSwgdGV4dHVyZXMgKTsKCgkJCX0gZWxzZSB7CgoJCQkJbGV0IG1vcnBoSW5mbHVlbmNlc1N1bSA9IDA7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgb2JqZWN0SW5mbHVlbmNlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCW1vcnBoSW5mbHVlbmNlc1N1bSArPSBvYmplY3RJbmZsdWVuY2VzWyBpIF07CgoJCQkJfQoKCQkJCWNvbnN0IG1vcnBoQmFzZUluZmx1ZW5jZSA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlID8gMSA6IDEgLSBtb3JwaEluZmx1ZW5jZXNTdW07CgoKCQkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2UnLCBtb3JwaEJhc2VJbmZsdWVuY2UgKTsKCQkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnLCBvYmplY3RJbmZsdWVuY2VzICk7CgoJCQl9CgoJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRzVGV4dHVyZScsIGVudHJ5LnRleHR1cmUsIHRleHR1cmVzICk7CgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZScsIGVudHJ5LnNpemUgKTsKCgkJfQoKCQlyZXR1cm4gewoKCQkJdXBkYXRlOiB1cGRhdGUKCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xPYmplY3RzKCBnbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApIHsKCgkJbGV0IHVwZGF0ZU1hcCA9IG5ldyBXZWFrTWFwKCk7CgoJCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0ICkgewoKCQkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0Lmdlb21ldHJ5OwoJCQljb25zdCBidWZmZXJnZW9tZXRyeSA9IGdlb21ldHJpZXMuZ2V0KCBvYmplY3QsIGdlb21ldHJ5ICk7CgoJCQkvLyBVcGRhdGUgb25jZSBwZXIgZnJhbWUKCgkJCWlmICggdXBkYXRlTWFwLmdldCggYnVmZmVyZ2VvbWV0cnkgKSAhPT0gZnJhbWUgKSB7CgoJCQkJZ2VvbWV0cmllcy51cGRhdGUoIGJ1ZmZlcmdlb21ldHJ5ICk7CgoJCQkJdXBkYXRlTWFwLnNldCggYnVmZmVyZ2VvbWV0cnksIGZyYW1lICk7CgoJCQl9CgoJCQlpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggKSB7CgoJCQkJaWYgKCBvYmplY3QuaGFzRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICkgPT09IGZhbHNlICkgewoKCQkJCQlvYmplY3QuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICk7CgoJCQkJfQoKCQkJCWlmICggdXBkYXRlTWFwLmdldCggb2JqZWN0ICkgIT09IGZyYW1lICkgewoKCQkJCQlhdHRyaWJ1dGVzLnVwZGF0ZSggb2JqZWN0Lmluc3RhbmNlTWF0cml4LCBnbC5BUlJBWV9CVUZGRVIgKTsKCgkJCQkJaWYgKCBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCApIHsKCgkJCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBvYmplY3QuaW5zdGFuY2VDb2xvciwgZ2wuQVJSQVlfQlVGRkVSICk7CgoJCQkJCX0KCgkJCQkJdXBkYXRlTWFwLnNldCggb2JqZWN0LCBmcmFtZSApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJY29uc3Qgc2tlbGV0b24gPSBvYmplY3Quc2tlbGV0b247CgoJCQkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBza2VsZXRvbiApICE9PSBmcmFtZSApIHsKCgkJCQkJc2tlbGV0b24udXBkYXRlKCk7CgoJCQkJCXVwZGF0ZU1hcC5zZXQoIHNrZWxldG9uLCBmcmFtZSApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBidWZmZXJnZW9tZXRyeTsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJdXBkYXRlTWFwID0gbmV3IFdlYWtNYXAoKTsKCgkJfQoKCQlmdW5jdGlvbiBvbkluc3RhbmNlZE1lc2hEaXNwb3NlKCBldmVudCApIHsKCgkJCWNvbnN0IGluc3RhbmNlZE1lc2ggPSBldmVudC50YXJnZXQ7CgoJCQlpbnN0YW5jZWRNZXNoLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25JbnN0YW5jZWRNZXNoRGlzcG9zZSApOwoKCQkJYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VNYXRyaXggKTsKCgkJCWlmICggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VDb2xvciApOwoKCQl9CgoJCXJldHVybiB7CgoJCQl1cGRhdGU6IHVwZGF0ZSwKCQkJZGlzcG9zZTogZGlzcG9zZQoKCQl9OwoKCX0KCgkvKioKCSAqIFVuaWZvcm1zIG9mIGEgcHJvZ3JhbS4KCSAqIFRob3NlIGZvcm0gYSB0cmVlIHN0cnVjdHVyZSB3aXRoIGEgc3BlY2lhbCB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciB0aGUgcm9vdCwKCSAqIHdoaWNoIHlvdSBnZXQgYnkgY2FsbGluZyAnbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICknLgoJICoKCSAqCgkgKiBQcm9wZXJ0aWVzIG9mIGlubmVyIG5vZGVzIGluY2x1ZGluZyB0aGUgdG9wLWxldmVsIGNvbnRhaW5lcjoKCSAqCgkgKiAuc2VxIC0gYXJyYXkgb2YgbmVzdGVkIHVuaWZvcm1zCgkgKiAubWFwIC0gbmVzdGVkIHVuaWZvcm1zIGJ5IG5hbWUKCSAqCgkgKgoJICogTWV0aG9kcyBvZiBhbGwgbm9kZXMgZXhjZXB0IHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyOgoJICoKCSAqIC5zZXRWYWx1ZSggZ2wsIHZhbHVlLCBbdGV4dHVyZXNdICkKCSAqCgkgKiAJCXVwbG9hZHMgYSB1bmlmb3JtIHZhbHVlKHMpCgkgKiAgCXRoZSAndGV4dHVyZXMnIHBhcmFtZXRlciBpcyBuZWVkZWQgZm9yIHNhbXBsZXIgdW5pZm9ybXMKCSAqCgkgKgoJICogU3RhdGljIG1ldGhvZHMgb2YgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgKHRleHR1cmVzIGZhY3Rvcml6YXRpb25zKToKCSAqCgkgKiAudXBsb2FkKCBnbCwgc2VxLCB2YWx1ZXMsIHRleHR1cmVzICkKCSAqCgkgKiAJCXNldHMgdW5pZm9ybXMgaW4gJ3NlcScgdG8gJ3ZhbHVlc1tpZF0udmFsdWUnCgkgKgoJICogLnNlcVdpdGhWYWx1ZSggc2VxLCB2YWx1ZXMgKSA6IGZpbHRlcmVkU2VxCgkgKgoJICogCQlmaWx0ZXJzICdzZXEnIGVudHJpZXMgd2l0aCBjb3JyZXNwb25kaW5nIGVudHJ5IGluIHZhbHVlcwoJICoKCSAqCgkgKiBNZXRob2RzIG9mIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyICh0ZXh0dXJlcyBmYWN0b3JpemF0aW9ucyk6CgkgKgoJICogLnNldFZhbHVlKCBnbCwgbmFtZSwgdmFsdWUsIHRleHR1cmVzICkKCSAqCgkgKiAJCXNldHMgdW5pZm9ybSB3aXRoICBuYW1lICduYW1lJyB0byAndmFsdWUnCgkgKgoJICogLnNldE9wdGlvbmFsKCBnbCwgb2JqLCBwcm9wICkKCSAqCgkgKiAJCWxpa2UgLnNldCBmb3IgYW4gb3B0aW9uYWwgcHJvcGVydHkgb2YgdGhlIG9iamVjdAoJICoKCSAqLwoKCgljb25zdCBlbXB0eVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBUZXh0dXJlKCk7CgoJY29uc3QgZW1wdHlTaGFkb3dUZXh0dXJlID0gLypAX19QVVJFX18qLyBuZXcgRGVwdGhUZXh0dXJlKCAxLCAxICk7CgoJY29uc3QgZW1wdHlBcnJheVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEYXRhQXJyYXlUZXh0dXJlKCk7Cgljb25zdCBlbXB0eTNkVGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IERhdGEzRFRleHR1cmUoKTsKCWNvbnN0IGVtcHR5Q3ViZVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBDdWJlVGV4dHVyZSgpOwoKCS8vIC0tLSBVdGlsaXRpZXMgLS0tCgoJLy8gQXJyYXkgQ2FjaGVzIChwcm92aWRlIHR5cGVkIGFycmF5cyBmb3IgdGVtcG9yYXJ5IGJ5IHNpemUpCgoJY29uc3QgYXJyYXlDYWNoZUYzMiA9IFtdOwoJY29uc3QgYXJyYXlDYWNoZUkzMiA9IFtdOwoKCS8vIEZsb2F0MzJBcnJheSBjYWNoZXMgdXNlZCBmb3IgdXBsb2FkaW5nIE1hdHJpeCB1bmlmb3JtcwoKCWNvbnN0IG1hdDRhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDE2ICk7Cgljb25zdCBtYXQzYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA5ICk7Cgljb25zdCBtYXQyYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA0ICk7CgoJLy8gRmxhdHRlbmluZyBmb3IgYXJyYXlzIG9mIHZlY3RvcnMgYW5kIG1hdHJpY2VzCgoJZnVuY3Rpb24gZmxhdHRlbiggYXJyYXksIG5CbG9ja3MsIGJsb2NrU2l6ZSApIHsKCgkJY29uc3QgZmlyc3RFbGVtID0gYXJyYXlbIDAgXTsKCgkJaWYgKCBmaXJzdEVsZW0gPD0gMCB8fCBmaXJzdEVsZW0gPiAwICkgcmV0dXJuIGFycmF5OwoJCS8vIHVub3B0aW1pemVkOiAhIGlzTmFOKCBmaXJzdEVsZW0gKQoJCS8vIHNlZSBodHRwOi8vamFja3NvbmR1bnN0YW4uY29tL2FydGljbGVzLzk4MwoKCQljb25zdCBuID0gbkJsb2NrcyAqIGJsb2NrU2l6ZTsKCQlsZXQgciA9IGFycmF5Q2FjaGVGMzJbIG4gXTsKCgkJaWYgKCByID09PSB1bmRlZmluZWQgKSB7CgoJCQlyID0gbmV3IEZsb2F0MzJBcnJheSggbiApOwoJCQlhcnJheUNhY2hlRjMyWyBuIF0gPSByOwoKCQl9CgoJCWlmICggbkJsb2NrcyAhPT0gMCApIHsKCgkJCWZpcnN0RWxlbS50b0FycmF5KCByLCAwICk7CgoJCQlmb3IgKCBsZXQgaSA9IDEsIG9mZnNldCA9IDA7IGkgIT09IG5CbG9ja3M7ICsrIGkgKSB7CgoJCQkJb2Zmc2V0ICs9IGJsb2NrU2l6ZTsKCQkJCWFycmF5WyBpIF0udG9BcnJheSggciwgb2Zmc2V0ICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHI7CgoJfQoKCWZ1bmN0aW9uIGFycmF5c0VxdWFsKCBhLCBiICkgewoKCQlpZiAoIGEubGVuZ3RoICE9PSBiLmxlbmd0aCApIHJldHVybiBmYWxzZTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJaWYgKCBhWyBpIF0gIT09IGJbIGkgXSApIHJldHVybiBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJZnVuY3Rpb24gY29weUFycmF5KCBhLCBiICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBiLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlhWyBpIF0gPSBiWyBpIF07CgoJCX0KCgl9CgoJLy8gVGV4dHVyZSB1bml0IGFsbG9jYXRpb24KCglmdW5jdGlvbiBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApIHsKCgkJbGV0IHIgPSBhcnJheUNhY2hlSTMyWyBuIF07CgoJCWlmICggciA9PT0gdW5kZWZpbmVkICkgewoKCQkJciA9IG5ldyBJbnQzMkFycmF5KCBuICk7CgkJCWFycmF5Q2FjaGVJMzJbIG4gXSA9IHI7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJclsgaSBdID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwoKCQl9CgoJCXJldHVybiByOwoKCX0KCgkvLyAtLS0gU2V0dGVycyAtLS0KCgkvLyBOb3RlOiBEZWZpbmluZyB0aGVzZSBtZXRob2RzIGV4dGVybmFsbHksIGJlY2F1c2UgdGhleSBjb21lIGluIGEgYnVuY2gKCS8vIGFuZCB0aGlzIHdheSB0aGVpciBuYW1lcyBtaW5pZnkuCgoJLy8gU2luZ2xlIHNjYWxhcgoKCWZ1bmN0aW9uIHNldFZhbHVlVjFmKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0xZiggdGhpcy5hZGRyLCB2ICk7CgoJCWNhY2hlWyAwIF0gPSB2OwoKCX0KCgkvLyBTaW5nbGUgZmxvYXQgdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCglmdW5jdGlvbiBzZXRWYWx1ZVYyZiggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCQlnbC51bmlmb3JtMmYoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMmZ2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVYzZiggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgoJCQkJZ2wudW5pZm9ybTNmKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCQl9CgoJCX0gZWxzZSBpZiAoIHYuciAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnIgfHwgY2FjaGVbIDEgXSAhPT0gdi5nIHx8IGNhY2hlWyAyIF0gIT09IHYuYiApIHsKCgkJCQlnbC51bmlmb3JtM2YoIHRoaXMuYWRkciwgdi5yLCB2LmcsIHYuYiApOwoKCQkJCWNhY2hlWyAwIF0gPSB2LnI7CgkJCQljYWNoZVsgMSBdID0gdi5nOwoJCQkJY2FjaGVbIDIgXSA9IHYuYjsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtM2Z2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0ZiggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKCQkJCWdsLnVuaWZvcm00ZiggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgkJCQljYWNoZVsgMyBdID0gdi53OwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJCWdsLnVuaWZvcm00ZnYoIHRoaXMuYWRkciwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9CgoJfQoKCS8vIFNpbmdsZSBtYXRyaXggKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5NYXRyaXhOKQoKCWZ1bmN0aW9uIHNldFZhbHVlTTIoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCQlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCQltYXQyYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0MmFycmF5ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlTTMoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCQlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCQltYXQzYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0M2FycmF5ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlTTQoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCQlpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCQltYXQ0YXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0NGFycmF5ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCQl9CgoJfQoKCS8vIFNpbmdsZSBpbnRlZ2VyIC8gYm9vbGVhbgoKCWZ1bmN0aW9uIHNldFZhbHVlVjFpKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB2ICk7CgoJCWNhY2hlWyAwIF0gPSB2OwoKCX0KCgkvLyBTaW5nbGUgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCglmdW5jdGlvbiBzZXRWYWx1ZVYyaSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSApIHsKCgkJCQlnbC51bmlmb3JtMmkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVYzaSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgoJCQkJZ2wudW5pZm9ybTNpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybTNpdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVWNGkoIGdsLCB2ICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgfHwgY2FjaGVbIDIgXSAhPT0gdi56IHx8IGNhY2hlWyAzIF0gIT09IHYudyApIHsKCgkJCQlnbC51bmlmb3JtNGkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgoJCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCQljYWNoZVsgMiBdID0gdi56OwoJCQkJY2FjaGVbIDMgXSA9IHYudzsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtNGl2KCB0aGlzLmFkZHIsIHYgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgkJfQoKCX0KCgkvLyBTaW5nbGUgdW5zaWduZWQgaW50ZWdlcgoKCWZ1bmN0aW9uIHNldFZhbHVlVjF1aSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCBjYWNoZVsgMCBdID09PSB2ICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMXVpKCB0aGlzLmFkZHIsIHYgKTsKCgkJY2FjaGVbIDAgXSA9IHY7CgoJfQoKCS8vIFNpbmdsZSB1bnNpZ25lZCBpbnRlZ2VyIHZlY3RvciAoZnJvbSBmbGF0IGFycmF5IG9yIFRIUkVFLlZlY3Rvck4pCgoJZnVuY3Rpb24gc2V0VmFsdWVWMnVpKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55ICkgewoKCQkJCWdsLnVuaWZvcm0ydWkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVWM3VpKCBnbCwgdiApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQlpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCgkJCQlnbC51bmlmb3JtM3VpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnogKTsKCgkJCQljYWNoZVsgMCBdID0gdi54OwoJCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJCWNhY2hlWyAyIF0gPSB2Lno7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQkJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKCQkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjR1aSggZ2wsIHYgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKCQkJCWdsLnVuaWZvcm00dWkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgoJCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCQljYWNoZVsgMiBdID0gdi56OwoJCQkJY2FjaGVbIDMgXSA9IHYudzsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCQlnbC51bmlmb3JtNHVpdiggdGhpcy5hZGRyLCB2ICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJCX0KCgl9CgoKCS8vIFNpbmdsZSB0ZXh0dXJlICgyRCAvIEN1YmUpCgoJZnVuY3Rpb24gc2V0VmFsdWVUMSggZ2wsIHYsIHRleHR1cmVzICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJbGV0IGVtcHR5VGV4dHVyZTJEOwoKCQlpZiAoIHRoaXMudHlwZSA9PT0gZ2wuU0FNUExFUl8yRF9TSEFET1cgKSB7CgoJCQllbXB0eVNoYWRvd1RleHR1cmUuY29tcGFyZUZ1bmN0aW9uID0gTGVzc0VxdWFsQ29tcGFyZTsgLy8gIzI4NjcwCgkJCWVtcHR5VGV4dHVyZTJEID0gZW1wdHlTaGFkb3dUZXh0dXJlOwoKCQl9IGVsc2UgewoKCQkJZW1wdHlUZXh0dXJlMkQgPSBlbXB0eVRleHR1cmU7CgoJCX0KCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2IHx8IGVtcHR5VGV4dHVyZTJELCB1bml0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDNEMSggZ2wsIHYsIHRleHR1cmVzICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgkJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJCX0KCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB2IHx8IGVtcHR5M2RUZXh0dXJlLCB1bml0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDYoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCgkJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJCWNhY2hlWyAwIF0gPSB1bml0OwoKCQl9CgoJCXRleHR1cmVzLnNldFRleHR1cmVDdWJlKCB2IHx8IGVtcHR5Q3ViZVRleHR1cmUsIHVuaXQgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheTEoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCgkJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJCWNhY2hlWyAwIF0gPSB1bml0OwoKCQl9CgoJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB2IHx8IGVtcHR5QXJyYXlUZXh0dXJlLCB1bml0ICk7CgoJfQoKCS8vIEhlbHBlciB0byBwaWNrIHRoZSByaWdodCBzZXR0ZXIgZm9yIHRoZSBzaW5ndWxhciBjYXNlCgoJZnVuY3Rpb24gZ2V0U2luZ3VsYXJTZXR0ZXIoIHR5cGUgKSB7CgoJCXN3aXRjaCAoIHR5cGUgKSB7CgoJCQljYXNlIDB4MTQwNjogcmV0dXJuIHNldFZhbHVlVjFmOyAvLyBGTE9BVAoJCQljYXNlIDB4OGI1MDogcmV0dXJuIHNldFZhbHVlVjJmOyAvLyBfVkVDMgoJCQljYXNlIDB4OGI1MTogcmV0dXJuIHNldFZhbHVlVjNmOyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1MjogcmV0dXJuIHNldFZhbHVlVjRmOyAvLyBfVkVDNAoKCQkJY2FzZSAweDhiNWE6IHJldHVybiBzZXRWYWx1ZU0yOyAvLyBfTUFUMgoJCQljYXNlIDB4OGI1YjogcmV0dXJuIHNldFZhbHVlTTM7IC8vIF9NQVQzCgkJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNDsgLy8gX01BVDQKCgkJCWNhc2UgMHgxNDA0OiBjYXNlIDB4OGI1NjogcmV0dXJuIHNldFZhbHVlVjFpOyAvLyBJTlQsIEJPT0wKCQkJY2FzZSAweDhiNTM6IGNhc2UgMHg4YjU3OiByZXR1cm4gc2V0VmFsdWVWMmk7IC8vIF9WRUMyCgkJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlVjNpOyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZVY0aTsgLy8gX1ZFQzQKCgkJCWNhc2UgMHgxNDA1OiByZXR1cm4gc2V0VmFsdWVWMXVpOyAvLyBVSU5UCgkJCWNhc2UgMHg4ZGM2OiByZXR1cm4gc2V0VmFsdWVWMnVpOyAvLyBfVkVDMgoJCQljYXNlIDB4OGRjNzogcmV0dXJuIHNldFZhbHVlVjN1aTsgLy8gX1ZFQzMKCQkJY2FzZSAweDhkYzg6IHJldHVybiBzZXRWYWx1ZVY0dWk7IC8vIF9WRUM0CgoJCQljYXNlIDB4OGI1ZTogLy8gU0FNUExFUl8yRAoJCQljYXNlIDB4OGQ2NjogLy8gU0FNUExFUl9FWFRFUk5BTF9PRVMKCQkJY2FzZSAweDhkY2E6IC8vIElOVF9TQU1QTEVSXzJECgkJCWNhc2UgMHg4ZGQyOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRAoJCQljYXNlIDB4OGI2MjogLy8gU0FNUExFUl8yRF9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQxOwoKCQkJY2FzZSAweDhiNWY6IC8vIFNBTVBMRVJfM0QKCQkJY2FzZSAweDhkY2I6IC8vIElOVF9TQU1QTEVSXzNECgkJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQkJcmV0dXJuIHNldFZhbHVlVDNEMTsKCgkJCWNhc2UgMHg4YjYwOiAvLyBTQU1QTEVSX0NVQkUKCQkJY2FzZSAweDhkY2M6IC8vIElOVF9TQU1QTEVSX0NVQkUKCQkJY2FzZSAweDhkZDQ6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSX0NVQkUKCQkJY2FzZSAweDhkYzU6IC8vIFNBTVBMRVJfQ1VCRV9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQ2OwoKCQkJY2FzZSAweDhkYzE6IC8vIFNBTVBMRVJfMkRfQVJSQVkKCQkJY2FzZSAweDhkY2Y6IC8vIElOVF9TQU1QTEVSXzJEX0FSUkFZCgkJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCQljYXNlIDB4OGRjNDogLy8gU0FNUExFUl8yRF9BUlJBWV9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQyREFycmF5MTsKCgkJfQoKCX0KCgoJLy8gQXJyYXkgb2Ygc2NhbGFycwoKCWZ1bmN0aW9uIHNldFZhbHVlVjFmQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMWZ2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLlZlY3Rvck4pCgoJZnVuY3Rpb24gc2V0VmFsdWVWMmZBcnJheSggZ2wsIHYgKSB7CgoJCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDIgKTsKCgkJZ2wudW5pZm9ybTJmdiggdGhpcy5hZGRyLCBkYXRhICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjNmQXJyYXkoIGdsLCB2ICkgewoKCQljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAzICk7CgoJCWdsLnVuaWZvcm0zZnYoIHRoaXMuYWRkciwgZGF0YSApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0ZkFycmF5KCBnbCwgdiApIHsKCgkJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgNCApOwoKCQlnbC51bmlmb3JtNGZ2KCB0aGlzLmFkZHIsIGRhdGEgKTsKCgl9CgoJLy8gQXJyYXkgb2YgbWF0cmljZXMgKGZyb20gZmxhdCBhcnJheSBvciBhcnJheSBvZiBUSFJFRS5NYXRyaXhOKQoKCWZ1bmN0aW9uIHNldFZhbHVlTTJBcnJheSggZ2wsIHYgKSB7CgoJCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDQgKTsKCgkJZ2wudW5pZm9ybU1hdHJpeDJmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZU0zQXJyYXkoIGdsLCB2ICkgewoKCQljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA5ICk7CgoJCWdsLnVuaWZvcm1NYXRyaXgzZnYoIHRoaXMuYWRkciwgZmFsc2UsIGRhdGEgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVNNEFycmF5KCBnbCwgdiApIHsKCgkJY29uc3QgZGF0YSA9IGZsYXR0ZW4oIHYsIHRoaXMuc2l6ZSwgMTYgKTsKCgkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKCX0KCgkvLyBBcnJheSBvZiBpbnRlZ2VyIC8gYm9vbGVhbgoKCWZ1bmN0aW9uIHNldFZhbHVlVjFpQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKCWZ1bmN0aW9uIHNldFZhbHVlVjJpQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVWM2lBcnJheSggZ2wsIHYgKSB7CgoJCWdsLnVuaWZvcm0zaXYoIHRoaXMuYWRkciwgdiApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0aUFycmF5KCBnbCwgdiApIHsKCgkJZ2wudW5pZm9ybTRpdiggdGhpcy5hZGRyLCB2ICk7CgoJfQoKCS8vIEFycmF5IG9mIHVuc2lnbmVkIGludGVnZXIKCglmdW5jdGlvbiBzZXRWYWx1ZVYxdWlBcnJheSggZ2wsIHYgKSB7CgoJCWdsLnVuaWZvcm0xdWl2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoJLy8gQXJyYXkgb2YgdW5zaWduZWQgaW50ZWdlciB2ZWN0b3JzIChmcm9tIGZsYXQgYXJyYXkpCgoJZnVuY3Rpb24gc2V0VmFsdWVWMnVpQXJyYXkoIGdsLCB2ICkgewoKCQlnbC51bmlmb3JtMnVpdiggdGhpcy5hZGRyLCB2ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVjN1aUFycmF5KCBnbCwgdiApIHsKCgkJZ2wudW5pZm9ybTN1aXYoIHRoaXMuYWRkciwgdiApOwoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVY0dWlBcnJheSggZ2wsIHYgKSB7CgoJCWdsLnVuaWZvcm00dWl2KCB0aGlzLmFkZHIsIHYgKTsKCgl9CgoKCS8vIEFycmF5IG9mIHRleHR1cmVzICgyRCAvIDNEIC8gQ3ViZSAvIDJEQXJyYXkpCgoJZnVuY3Rpb24gc2V0VmFsdWVUMUFycmF5KCBnbCwgdiwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJY29uc3QgbiA9IHYubGVuZ3RoOwoKCQljb25zdCB1bml0cyA9IGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICk7CgoJCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB1bml0cyApOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCXRleHR1cmVzLnNldFRleHR1cmUyRCggdlsgaSBdIHx8IGVtcHR5VGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFZhbHVlVDNEQXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQljb25zdCBuID0gdi5sZW5ndGg7CgoJCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCgkJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCgkJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB2WyBpIF0gfHwgZW1wdHkzZFRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRWYWx1ZVQ2QXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCQljb25zdCBuID0gdi5sZW5ndGg7CgoJCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCgkJaWYgKCAhIGFycmF5c0VxdWFsKCBjYWNoZSwgdW5pdHMgKSApIHsKCgkJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHZbIGkgXSB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0c1sgaSBdICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0VmFsdWVUMkRBcnJheUFycmF5KCBnbCwgdiwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgkJY29uc3QgbiA9IHYubGVuZ3RoOwoKCQljb25zdCB1bml0cyA9IGFsbG9jVGV4VW5pdHMoIHRleHR1cmVzLCBuICk7CgoJCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCQljb3B5QXJyYXkoIGNhY2hlLCB1bml0cyApOwoKCQl9CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB2WyBpIF0gfHwgZW1wdHlBcnJheVRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCgkJfQoKCX0KCgoJLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgYSBwdXJlIChib3R0b20tbGV2ZWwpIGFycmF5CgoJZnVuY3Rpb24gZ2V0UHVyZUFycmF5U2V0dGVyKCB0eXBlICkgewoKCQlzd2l0Y2ggKCB0eXBlICkgewoKCQkJY2FzZSAweDE0MDY6IHJldHVybiBzZXRWYWx1ZVYxZkFycmF5OyAvLyBGTE9BVAoJCQljYXNlIDB4OGI1MDogcmV0dXJuIHNldFZhbHVlVjJmQXJyYXk7IC8vIF9WRUMyCgkJCWNhc2UgMHg4YjUxOiByZXR1cm4gc2V0VmFsdWVWM2ZBcnJheTsgLy8gX1ZFQzMKCQkJY2FzZSAweDhiNTI6IHJldHVybiBzZXRWYWx1ZVY0ZkFycmF5OyAvLyBfVkVDNAoKCQkJY2FzZSAweDhiNWE6IHJldHVybiBzZXRWYWx1ZU0yQXJyYXk7IC8vIF9NQVQyCgkJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNM0FycmF5OyAvLyBfTUFUMwoJCQljYXNlIDB4OGI1YzogcmV0dXJuIHNldFZhbHVlTTRBcnJheTsgLy8gX01BVDQKCgkJCWNhc2UgMHgxNDA0OiBjYXNlIDB4OGI1NjogcmV0dXJuIHNldFZhbHVlVjFpQXJyYXk7IC8vIElOVCwgQk9PTAoJCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZVYyaUFycmF5OyAvLyBfVkVDMgoJCQljYXNlIDB4OGI1NDogY2FzZSAweDhiNTg6IHJldHVybiBzZXRWYWx1ZVYzaUFycmF5OyAvLyBfVkVDMwoJCQljYXNlIDB4OGI1NTogY2FzZSAweDhiNTk6IHJldHVybiBzZXRWYWx1ZVY0aUFycmF5OyAvLyBfVkVDNAoKCQkJY2FzZSAweDE0MDU6IHJldHVybiBzZXRWYWx1ZVYxdWlBcnJheTsgLy8gVUlOVAoJCQljYXNlIDB4OGRjNjogcmV0dXJuIHNldFZhbHVlVjJ1aUFycmF5OyAvLyBfVkVDMgoJCQljYXNlIDB4OGRjNzogcmV0dXJuIHNldFZhbHVlVjN1aUFycmF5OyAvLyBfVkVDMwoJCQljYXNlIDB4OGRjODogcmV0dXJuIHNldFZhbHVlVjR1aUFycmF5OyAvLyBfVkVDNAoKCQkJY2FzZSAweDhiNWU6IC8vIFNBTVBMRVJfMkQKCQkJY2FzZSAweDhkNjY6IC8vIFNBTVBMRVJfRVhURVJOQUxfT0VTCgkJCWNhc2UgMHg4ZGNhOiAvLyBJTlRfU0FNUExFUl8yRAoJCQljYXNlIDB4OGRkMjogLy8gVU5TSUdORURfSU5UX1NBTVBMRVJfMkQKCQkJY2FzZSAweDhiNjI6IC8vIFNBTVBMRVJfMkRfU0hBRE9XCgkJCQlyZXR1cm4gc2V0VmFsdWVUMUFycmF5OwoKCQkJY2FzZSAweDhiNWY6IC8vIFNBTVBMRVJfM0QKCQkJY2FzZSAweDhkY2I6IC8vIElOVF9TQU1QTEVSXzNECgkJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQkJcmV0dXJuIHNldFZhbHVlVDNEQXJyYXk7CgoJCQljYXNlIDB4OGI2MDogLy8gU0FNUExFUl9DVUJFCgkJCWNhc2UgMHg4ZGNjOiAvLyBJTlRfU0FNUExFUl9DVUJFCgkJCWNhc2UgMHg4ZGQ0OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl9DVUJFCgkJCWNhc2UgMHg4ZGM1OiAvLyBTQU1QTEVSX0NVQkVfU0hBRE9XCgkJCQlyZXR1cm4gc2V0VmFsdWVUNkFycmF5OwoKCQkJY2FzZSAweDhkYzE6IC8vIFNBTVBMRVJfMkRfQVJSQVkKCQkJY2FzZSAweDhkY2Y6IC8vIElOVF9TQU1QTEVSXzJEX0FSUkFZCgkJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCQljYXNlIDB4OGRjNDogLy8gU0FNUExFUl8yRF9BUlJBWV9TSEFET1cKCQkJCXJldHVybiBzZXRWYWx1ZVQyREFycmF5QXJyYXk7CgoJCX0KCgl9CgoJLy8gLS0tIFVuaWZvcm0gQ2xhc3NlcyAtLS0KCgljbGFzcyBTaW5nbGVVbmlmb3JtIHsKCgkJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKCQkJdGhpcy5pZCA9IGlkOwoJCQl0aGlzLmFkZHIgPSBhZGRyOwoJCQl0aGlzLmNhY2hlID0gW107CgkJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKCQkJdGhpcy5zZXRWYWx1ZSA9IGdldFNpbmd1bGFyU2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCgkJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCgkJfQoKCX0KCgljbGFzcyBQdXJlQXJyYXlVbmlmb3JtIHsKCgkJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKCQkJdGhpcy5pZCA9IGlkOwoJCQl0aGlzLmFkZHIgPSBhZGRyOwoJCQl0aGlzLmNhY2hlID0gW107CgkJCXRoaXMudHlwZSA9IGFjdGl2ZUluZm8udHlwZTsKCQkJdGhpcy5zaXplID0gYWN0aXZlSW5mby5zaXplOwoJCQl0aGlzLnNldFZhbHVlID0gZ2V0UHVyZUFycmF5U2V0dGVyKCBhY3RpdmVJbmZvLnR5cGUgKTsKCgkJCS8vIHRoaXMucGF0aCA9IGFjdGl2ZUluZm8ubmFtZTsgLy8gREVCVUcKCgkJfQoKCX0KCgljbGFzcyBTdHJ1Y3R1cmVkVW5pZm9ybSB7CgoJCWNvbnN0cnVjdG9yKCBpZCApIHsKCgkJCXRoaXMuaWQgPSBpZDsKCgkJCXRoaXMuc2VxID0gW107CgkJCXRoaXMubWFwID0ge307CgoJCX0KCgkJc2V0VmFsdWUoIGdsLCB2YWx1ZSwgdGV4dHVyZXMgKSB7CgoJCQljb25zdCBzZXEgPSB0aGlzLnNlcTsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgdSA9IHNlcVsgaSBdOwoJCQkJdS5zZXRWYWx1ZSggZ2wsIHZhbHVlWyB1LmlkIF0sIHRleHR1cmVzICk7CgoJCQl9CgoJCX0KCgl9CgoJLy8gLS0tIFRvcC1sZXZlbCAtLS0KCgkvLyBQYXJzZXIgLSBidWlsZHMgdXAgdGhlIHByb3BlcnR5IHRyZWUgZnJvbSB0aGUgcGF0aCBzdHJpbmdzCgoJY29uc3QgUmVQYXRoUGFydCA9IC8oXHcrKShcXSk/KFxbfFwuKT8vZzsKCgkvLyBleHRyYWN0cwoJLy8gCS0gdGhlIGlkZW50aWZpZXIgKG1lbWJlciBuYW1lIG9yIGFycmF5IGluZGV4KQoJLy8gIC0gZm9sbG93ZWQgYnkgYW4gb3B0aW9uYWwgcmlnaHQgYnJhY2tldCAoZm91bmQgd2hlbiBhcnJheSBpbmRleCkKCS8vICAtIGZvbGxvd2VkIGJ5IGFuIG9wdGlvbmFsIGxlZnQgYnJhY2tldCBvciBkb3QgKHR5cGUgb2Ygc3Vic2NyaXB0KQoJLy8KCS8vIE5vdGU6IFRoZXNlIHBvcnRpb25zIGNhbiBiZSByZWFkIGluIGEgbm9uLW92ZXJsYXBwaW5nIGZhc2hpb24gYW5kCgkvLyBhbGxvdyBzdHJhaWdodGZvcndhcmQgcGFyc2luZyBvZiB0aGUgaGllcmFyY2h5IHRoYXQgV2ViR0wgZW5jb2RlcwoJLy8gaW4gdGhlIHVuaWZvcm0gbmFtZXMuCgoJZnVuY3Rpb24gYWRkVW5pZm9ybSggY29udGFpbmVyLCB1bmlmb3JtT2JqZWN0ICkgewoKCQljb250YWluZXIuc2VxLnB1c2goIHVuaWZvcm1PYmplY3QgKTsKCQljb250YWluZXIubWFwWyB1bmlmb3JtT2JqZWN0LmlkIF0gPSB1bmlmb3JtT2JqZWN0OwoKCX0KCglmdW5jdGlvbiBwYXJzZVVuaWZvcm0oIGFjdGl2ZUluZm8sIGFkZHIsIGNvbnRhaW5lciApIHsKCgkJY29uc3QgcGF0aCA9IGFjdGl2ZUluZm8ubmFtZSwKCQkJcGF0aExlbmd0aCA9IHBhdGgubGVuZ3RoOwoKCQkvLyByZXNldCBSZWdFeHAgb2JqZWN0LCBiZWNhdXNlIG9mIHRoZSBlYXJseSBleGl0IG9mIGEgcHJldmlvdXMgcnVuCgkJUmVQYXRoUGFydC5sYXN0SW5kZXggPSAwOwoKCQl3aGlsZSAoIHRydWUgKSB7CgoJCQljb25zdCBtYXRjaCA9IFJlUGF0aFBhcnQuZXhlYyggcGF0aCApLAoJCQkJbWF0Y2hFbmQgPSBSZVBhdGhQYXJ0Lmxhc3RJbmRleDsKCgkJCWxldCBpZCA9IG1hdGNoWyAxIF07CgkJCWNvbnN0IGlkSXNJbmRleCA9IG1hdGNoWyAyIF0gPT09ICddJywKCQkJCXN1YnNjcmlwdCA9IG1hdGNoWyAzIF07CgoJCQlpZiAoIGlkSXNJbmRleCApIGlkID0gaWQgfCAwOyAvLyBjb252ZXJ0IHRvIGludGVnZXIKCgkJCWlmICggc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgfHwgc3Vic2NyaXB0ID09PSAnWycgJiYgbWF0Y2hFbmQgKyAyID09PSBwYXRoTGVuZ3RoICkgewoKCQkJCS8vIGJhcmUgbmFtZSBvciAicHVyZSIgYm90dG9tLWxldmVsIGFycmF5ICJbMF0iIHN1ZmZpeAoKCQkJCWFkZFVuaWZvcm0oIGNvbnRhaW5lciwgc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgPwoJCQkJCW5ldyBTaW5nbGVVbmlmb3JtKCBpZCwgYWN0aXZlSW5mbywgYWRkciApIDoKCQkJCQluZXcgUHVyZUFycmF5VW5pZm9ybSggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSApOwoKCQkJCWJyZWFrOwoKCQkJfSBlbHNlIHsKCgkJCQkvLyBzdGVwIGludG8gaW5uZXIgbm9kZSAvIGNyZWF0ZSBpdCBpbiBjYXNlIGl0IGRvZXNuJ3QgZXhpc3QKCgkJCQljb25zdCBtYXAgPSBjb250YWluZXIubWFwOwoJCQkJbGV0IG5leHQgPSBtYXBbIGlkIF07CgoJCQkJaWYgKCBuZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCW5leHQgPSBuZXcgU3RydWN0dXJlZFVuaWZvcm0oIGlkICk7CgkJCQkJYWRkVW5pZm9ybSggY29udGFpbmVyLCBuZXh0ICk7CgoJCQkJfQoKCQkJCWNvbnRhaW5lciA9IG5leHQ7CgoJCQl9CgoJCX0KCgl9CgoJLy8gUm9vdCBDb250YWluZXIKCgljbGFzcyBXZWJHTFVuaWZvcm1zIHsKCgkJY29uc3RydWN0b3IoIGdsLCBwcm9ncmFtICkgewoKCQkJdGhpcy5zZXEgPSBbXTsKCQkJdGhpcy5tYXAgPSB7fTsKCgkJCWNvbnN0IG4gPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5BQ1RJVkVfVU5JRk9STVMgKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZVVuaWZvcm0oIHByb2dyYW0sIGkgKSwKCQkJCQlhZGRyID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKCBwcm9ncmFtLCBpbmZvLm5hbWUgKTsKCgkJCQlwYXJzZVVuaWZvcm0oIGluZm8sIGFkZHIsIHRoaXMgKTsKCgkJCX0KCgkJfQoKCQlzZXRWYWx1ZSggZ2wsIG5hbWUsIHZhbHVlLCB0ZXh0dXJlcyApIHsKCgkJCWNvbnN0IHUgPSB0aGlzLm1hcFsgbmFtZSBdOwoKCQkJaWYgKCB1ICE9PSB1bmRlZmluZWQgKSB1LnNldFZhbHVlKCBnbCwgdmFsdWUsIHRleHR1cmVzICk7CgoJCX0KCgkJc2V0T3B0aW9uYWwoIGdsLCBvYmplY3QsIG5hbWUgKSB7CgoJCQljb25zdCB2ID0gb2JqZWN0WyBuYW1lIF07CgoJCQlpZiAoIHYgIT09IHVuZGVmaW5lZCApIHRoaXMuc2V0VmFsdWUoIGdsLCBuYW1lLCB2ICk7CgoJCX0KCgkJc3RhdGljIHVwbG9hZCggZ2wsIHNlcSwgdmFsdWVzLCB0ZXh0dXJlcyApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IHNlcS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgdSA9IHNlcVsgaSBdLAoJCQkJCXYgPSB2YWx1ZXNbIHUuaWQgXTsKCgkJCQlpZiAoIHYubmVlZHNVcGRhdGUgIT09IGZhbHNlICkgewoKCQkJCQkvLyBub3RlOiBhbHdheXMgdXBkYXRpbmcgd2hlbiAubmVlZHNVcGRhdGUgaXMgdW5kZWZpbmVkCgkJCQkJdS5zZXRWYWx1ZSggZ2wsIHYudmFsdWUsIHRleHR1cmVzICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXN0YXRpYyBzZXFXaXRoVmFsdWUoIHNlcSwgdmFsdWVzICkgewoKCQkJY29uc3QgciA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQljb25zdCB1ID0gc2VxWyBpIF07CgkJCQlpZiAoIHUuaWQgaW4gdmFsdWVzICkgci5wdXNoKCB1ICk7CgoJCQl9CgoJCQlyZXR1cm4gcjsKCgkJfQoKCX0KCglmdW5jdGlvbiBXZWJHTFNoYWRlciggZ2wsIHR5cGUsIHN0cmluZyApIHsKCgkJY29uc3Qgc2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKCB0eXBlICk7CgoJCWdsLnNoYWRlclNvdXJjZSggc2hhZGVyLCBzdHJpbmcgKTsKCQlnbC5jb21waWxlU2hhZGVyKCBzaGFkZXIgKTsKCgkJcmV0dXJuIHNoYWRlcjsKCgl9CgoJLy8gRnJvbSBodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9leHRlbnNpb25zL0tIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZS8KCWNvbnN0IENPTVBMRVRJT05fU1RBVFVTX0tIUiA9IDB4OTFCMTsKCglsZXQgcHJvZ3JhbUlkQ291bnQgPSAwOwoKCWZ1bmN0aW9uIGhhbmRsZVNvdXJjZSggc3RyaW5nLCBlcnJvckxpbmUgKSB7CgoJCWNvbnN0IGxpbmVzID0gc3RyaW5nLnNwbGl0KCAnXG4nICk7CgkJY29uc3QgbGluZXMyID0gW107CgoJCWNvbnN0IGZyb20gPSBNYXRoLm1heCggZXJyb3JMaW5lIC0gNiwgMCApOwoJCWNvbnN0IHRvID0gTWF0aC5taW4oIGVycm9yTGluZSArIDYsIGxpbmVzLmxlbmd0aCApOwoKCQlmb3IgKCBsZXQgaSA9IGZyb207IGkgPCB0bzsgaSArKyApIHsKCgkJCWNvbnN0IGxpbmUgPSBpICsgMTsKCQkJbGluZXMyLnB1c2goIGAke2xpbmUgPT09IGVycm9yTGluZSA/ICc+JyA6ICcgJ30gJHtsaW5lfTogJHtsaW5lc1sgaSBdfWAgKTsKCgkJfQoKCQlyZXR1cm4gbGluZXMyLmpvaW4oICdcbicgKTsKCgl9CgoJY29uc3QgX20wID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpOwoKCWZ1bmN0aW9uIGdldEVuY29kaW5nQ29tcG9uZW50cyggY29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50Ll9nZXRNYXRyaXgoIF9tMCwgQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlLCBjb2xvclNwYWNlICk7CgoJCWNvbnN0IGVuY29kaW5nTWF0cml4ID0gYG1hdDMoICR7IF9tMC5lbGVtZW50cy5tYXAoICggdiApID0+IHYudG9GaXhlZCggNCApICkgfSApYDsKCgkJc3dpdGNoICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICkgKSB7CgoJCQljYXNlIExpbmVhclRyYW5zZmVyOgoJCQkJcmV0dXJuIFsgZW5jb2RpbmdNYXRyaXgsICdMaW5lYXJUcmFuc2Zlck9FVEYnIF07CgoJCQljYXNlIFNSR0JUcmFuc2ZlcjoKCQkJCXJldHVybiBbIGVuY29kaW5nTWF0cml4LCAnc1JHQlRyYW5zZmVyT0VURicgXTsKCgkJCWRlZmF1bHQ6CgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IFVuc3VwcG9ydGVkIGNvbG9yIHNwYWNlOiAnLCBjb2xvclNwYWNlICk7CgkJCQlyZXR1cm4gWyBlbmNvZGluZ01hdHJpeCwgJ0xpbmVhclRyYW5zZmVyT0VURicgXTsKCgkJfQoKCX0KCglmdW5jdGlvbiBnZXRTaGFkZXJFcnJvcnMoIGdsLCBzaGFkZXIsIHR5cGUgKSB7CgoJCWNvbnN0IHN0YXR1cyA9IGdsLmdldFNoYWRlclBhcmFtZXRlciggc2hhZGVyLCBnbC5DT01QSUxFX1NUQVRVUyApOwoJCWNvbnN0IGVycm9ycyA9IGdsLmdldFNoYWRlckluZm9Mb2coIHNoYWRlciApLnRyaW0oKTsKCgkJaWYgKCBzdGF0dXMgJiYgZXJyb3JzID09PSAnJyApIHJldHVybiAnJzsKCgkJY29uc3QgZXJyb3JNYXRjaGVzID0gL0VSUk9SOiAwOihcZCspLy5leGVjKCBlcnJvcnMgKTsKCQlpZiAoIGVycm9yTWF0Y2hlcyApIHsKCgkJCS8vIC0tZW5hYmxlLXByaXZpbGVnZWQtd2ViZ2wtZXh0ZW5zaW9uCgkJCS8vIGNvbnNvbGUubG9nKCAnKionICsgdHlwZSArICcqKicsIGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2RlYnVnX3NoYWRlcnMnICkuZ2V0VHJhbnNsYXRlZFNoYWRlclNvdXJjZSggc2hhZGVyICkgKTsKCgkJCWNvbnN0IGVycm9yTGluZSA9IHBhcnNlSW50KCBlcnJvck1hdGNoZXNbIDEgXSApOwoJCQlyZXR1cm4gdHlwZS50b1VwcGVyQ2FzZSgpICsgJ1xuXG4nICsgZXJyb3JzICsgJ1xuXG4nICsgaGFuZGxlU291cmNlKCBnbC5nZXRTaGFkZXJTb3VyY2UoIHNoYWRlciApLCBlcnJvckxpbmUgKTsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBlcnJvcnM7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGNvbG9yU3BhY2UgKSB7CgoJCWNvbnN0IGNvbXBvbmVudHMgPSBnZXRFbmNvZGluZ0NvbXBvbmVudHMoIGNvbG9yU3BhY2UgKTsKCgkJcmV0dXJuIFsKCgkJCWB2ZWM0ICR7ZnVuY3Rpb25OYW1lfSggdmVjNCB2YWx1ZSApIHtgLAoKCQkJYAlyZXR1cm4gJHtjb21wb25lbnRzWyAxIF19KCB2ZWM0KCB2YWx1ZS5yZ2IgKiAke2NvbXBvbmVudHNbIDAgXX0sIHZhbHVlLmEgKSApO2AsCgoJCQknfScsCgoJCV0uam9pbiggJ1xuJyApOwoKCX0KCglmdW5jdGlvbiBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIHRvbmVNYXBwaW5nICkgewoKCQlsZXQgdG9uZU1hcHBpbmdOYW1lOwoKCQlzd2l0Y2ggKCB0b25lTWFwcGluZyApIHsKCgkJCWNhc2UgTGluZWFyVG9uZU1hcHBpbmc6CgkJCQl0b25lTWFwcGluZ05hbWUgPSAnTGluZWFyJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBSZWluaGFyZFRvbmVNYXBwaW5nOgoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ1JlaW5oYXJkJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBDaW5lb25Ub25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDaW5lb24nOwoJCQkJYnJlYWs7CgoJCQljYXNlIEFDRVNGaWxtaWNUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBQ0VTRmlsbWljJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBBZ1hUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBZ1gnOwoJCQkJYnJlYWs7CgoJCQljYXNlIE5ldXRyYWxUb25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdOZXV0cmFsJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBDdXN0b21Ub25lTWFwcGluZzoKCQkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDdXN0b20nOwoJCQkJYnJlYWs7CgoJCQlkZWZhdWx0OgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xQcm9ncmFtOiBVbnN1cHBvcnRlZCB0b25lTWFwcGluZzonLCB0b25lTWFwcGluZyApOwoJCQkJdG9uZU1hcHBpbmdOYW1lID0gJ0xpbmVhcic7CgoJCX0KCgkJcmV0dXJuICd2ZWMzICcgKyBmdW5jdGlvbk5hbWUgKyAnKCB2ZWMzIGNvbG9yICkgeyByZXR1cm4gJyArIHRvbmVNYXBwaW5nTmFtZSArICdUb25lTWFwcGluZyggY29sb3IgKTsgfSc7CgoJfQoKCWNvbnN0IF92MCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCglmdW5jdGlvbiBnZXRMdW1pbmFuY2VGdW5jdGlvbigpIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmdldEx1bWluYW5jZUNvZWZmaWNpZW50cyggX3YwICk7CgoJCWNvbnN0IHIgPSBfdjAueC50b0ZpeGVkKCA0ICk7CgkJY29uc3QgZyA9IF92MC55LnRvRml4ZWQoIDQgKTsKCQljb25zdCBiID0gX3YwLnoudG9GaXhlZCggNCApOwoKCQlyZXR1cm4gWwoKCQkJJ2Zsb2F0IGx1bWluYW5jZSggY29uc3QgaW4gdmVjMyByZ2IgKSB7JywKCgkJCWAJY29uc3QgdmVjMyB3ZWlnaHRzID0gdmVjMyggJHsgciB9LCAkeyBnIH0sICR7IGIgfSApO2AsCgoJCQknCXJldHVybiBkb3QoIHdlaWdodHMsIHJnYiApOycsCgoJCQknfScKCgkJXS5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlVmVydGV4RXh0ZW5zaW9ucyggcGFyYW1ldGVycyApIHsKCgkJY29uc3QgY2h1bmtzID0gWwoJCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2UgPyAnI2V4dGVuc2lvbiBHTF9BTkdMRV9jbGlwX2N1bGxfZGlzdGFuY2UgOiByZXF1aXJlJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmV4dGVuc2lvbk11bHRpRHJhdyA/ICcjZXh0ZW5zaW9uIEdMX0FOR0xFX211bHRpX2RyYXcgOiByZXF1aXJlJyA6ICcnLAoJCV07CgoJCXJldHVybiBjaHVua3MuZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApIHsKCgkJY29uc3QgY2h1bmtzID0gW107CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gZGVmaW5lcyApIHsKCgkJCWNvbnN0IHZhbHVlID0gZGVmaW5lc1sgbmFtZSBdOwoKCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCgkJCWNodW5rcy5wdXNoKCAnI2RlZmluZSAnICsgbmFtZSArICcgJyArIHZhbHVlICk7CgoJCX0KCgkJcmV0dXJuIGNodW5rcy5qb2luKCAnXG4nICk7CgoJfQoKCWZ1bmN0aW9uIGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApIHsKCgkJY29uc3QgYXR0cmlidXRlcyA9IHt9OwoKCQljb25zdCBuID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuQUNUSVZFX0FUVFJJQlVURVMgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgaSArKyApIHsKCgkJCWNvbnN0IGluZm8gPSBnbC5nZXRBY3RpdmVBdHRyaWIoIHByb2dyYW0sIGkgKTsKCQkJY29uc3QgbmFtZSA9IGluZm8ubmFtZTsKCgkJCWxldCBsb2NhdGlvblNpemUgPSAxOwoJCQlpZiAoIGluZm8udHlwZSA9PT0gZ2wuRkxPQVRfTUFUMiApIGxvY2F0aW9uU2l6ZSA9IDI7CgkJCWlmICggaW5mby50eXBlID09PSBnbC5GTE9BVF9NQVQzICkgbG9jYXRpb25TaXplID0gMzsKCQkJaWYgKCBpbmZvLnR5cGUgPT09IGdsLkZMT0FUX01BVDQgKSBsb2NhdGlvblNpemUgPSA0OwoKCQkJLy8gY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFByb2dyYW06IEFDVElWRSBWRVJURVggQVRUUklCVVRFOicsIG5hbWUsIGkgKTsKCgkJCWF0dHJpYnV0ZXNbIG5hbWUgXSA9IHsKCQkJCXR5cGU6IGluZm8udHlwZSwKCQkJCWxvY2F0aW9uOiBnbC5nZXRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgbmFtZSApLAoJCQkJbG9jYXRpb25TaXplOiBsb2NhdGlvblNpemUKCQkJfTsKCgkJfQoKCQlyZXR1cm4gYXR0cmlidXRlczsKCgl9CgoJZnVuY3Rpb24gZmlsdGVyRW1wdHlMaW5lKCBzdHJpbmcgKSB7CgoJCXJldHVybiBzdHJpbmcgIT09ICcnOwoKCX0KCglmdW5jdGlvbiByZXBsYWNlTGlnaHROdW1zKCBzdHJpbmcsIHBhcmFtZXRlcnMgKSB7CgoJCWNvbnN0IG51bVNwb3RMaWdodENvb3JkcyA9IHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cyArIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0TWFwcyAtIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOwoKCQlyZXR1cm4gc3RyaW5nCgkJCS5yZXBsYWNlKCAvTlVNX0RJUl9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICkKCQkJLnJlcGxhY2UoIC9OVU1fU1BPVF9MSUdIVF9DT09SRFMvZywgbnVtU3BvdExpZ2h0Q29vcmRzICkKCQkJLnJlcGxhY2UoIC9OVU1fUkVDVF9BUkVBX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bVJlY3RBcmVhTGlnaHRzICkKCQkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9IRU1JX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bUhlbWlMaWdodHMgKQoJCQkucmVwbGFjZSggL05VTV9ESVJfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0U2hhZG93cyApCgkJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XU19XSVRIX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKQoJCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzICkKCQkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRTaGFkb3dzICk7CgoJfQoKCWZ1bmN0aW9uIHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggc3RyaW5nLCBwYXJhbWV0ZXJzICkgewoKCQlyZXR1cm4gc3RyaW5nCgkJCS5yZXBsYWNlKCAvTlVNX0NMSVBQSU5HX1BMQU5FUy9nLCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICkKCQkJLnJlcGxhY2UoIC9VTklPTl9DTElQUElOR19QTEFORVMvZywgKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzIC0gcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uICkgKTsKCgl9CgoJLy8gUmVzb2x2ZSBJbmNsdWRlcwoKCWNvbnN0IGluY2x1ZGVQYXR0ZXJuID0gL15bIFx0XSojaW5jbHVkZSArPChbXHdcZC4vXSspPi9nbTsKCglmdW5jdGlvbiByZXNvbHZlSW5jbHVkZXMoIHN0cmluZyApIHsKCgkJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCBpbmNsdWRlUGF0dGVybiwgaW5jbHVkZVJlcGxhY2VyICk7CgoJfQoKCWNvbnN0IHNoYWRlckNodW5rTWFwID0gbmV3IE1hcCgpOwoKCWZ1bmN0aW9uIGluY2x1ZGVSZXBsYWNlciggbWF0Y2gsIGluY2x1ZGUgKSB7CgoJCWxldCBzdHJpbmcgPSBTaGFkZXJDaHVua1sgaW5jbHVkZSBdOwoKCQlpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgbmV3SW5jbHVkZSA9IHNoYWRlckNodW5rTWFwLmdldCggaW5jbHVkZSApOwoKCQkJaWYgKCBuZXdJbmNsdWRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJc3RyaW5nID0gU2hhZGVyQ2h1bmtbIG5ld0luY2x1ZGUgXTsKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFNoYWRlciBjaHVuayAiJXMiIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAiJXMiIGluc3RlYWQuJywgaW5jbHVkZSwgbmV3SW5jbHVkZSApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aHJvdyBuZXcgRXJyb3IoICdDYW4gbm90IHJlc29sdmUgI2luY2x1ZGUgPCcgKyBpbmNsdWRlICsgJz4nICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHJlc29sdmVJbmNsdWRlcyggc3RyaW5nICk7CgoJfQoKCS8vIFVucm9sbCBMb29wcwoKCWNvbnN0IHVucm9sbExvb3BQYXR0ZXJuID0gLyNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRccytmb3JccypcKFxzKmludFxzK2lccyo9XHMqKFxkKylccyo7XHMqaVxzKjxccyooXGQrKVxzKjtccyppXHMqXCtcK1xzKlwpXHMqeyhbXHNcU10rPyl9XHMrI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmQvZzsKCglmdW5jdGlvbiB1bnJvbGxMb29wcyggc3RyaW5nICkgewoKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHVucm9sbExvb3BQYXR0ZXJuLCBsb29wUmVwbGFjZXIgKTsKCgl9CgoJZnVuY3Rpb24gbG9vcFJlcGxhY2VyKCBtYXRjaCwgc3RhcnQsIGVuZCwgc25pcHBldCApIHsKCgkJbGV0IHN0cmluZyA9ICcnOwoKCQlmb3IgKCBsZXQgaSA9IHBhcnNlSW50KCBzdGFydCApOyBpIDwgcGFyc2VJbnQoIGVuZCApOyBpICsrICkgewoKCQkJc3RyaW5nICs9IHNuaXBwZXQKCQkJCS5yZXBsYWNlKCAvXFtccyppXHMqXF0vZywgJ1sgJyArIGkgKyAnIF0nICkKCQkJCS5yZXBsYWNlKCAvVU5ST0xMRURfTE9PUF9JTkRFWC9nLCBpICk7CgoJCX0KCgkJcmV0dXJuIHN0cmluZzsKCgl9CgoJLy8KCglmdW5jdGlvbiBnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApIHsKCgkJbGV0IHByZWNpc2lvbnN0cmluZyA9IGBwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gZmxvYXQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaW50OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIyRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyQ3ViZTsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBzYW1wbGVyM0Q7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEQXJyYXk7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gc2FtcGxlcjJEU2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXJDdWJlU2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHNhbXBsZXIyREFycmF5U2hhZG93OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IGlzYW1wbGVyMkQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSBpc2FtcGxlckN1YmU7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gaXNhbXBsZXIyREFycmF5OwoJcHJlY2lzaW9uICR7cGFyYW1ldGVycy5wcmVjaXNpb259IHVzYW1wbGVyMkQ7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIzRDsKCXByZWNpc2lvbiAke3BhcmFtZXRlcnMucHJlY2lzaW9ufSB1c2FtcGxlckN1YmU7CglwcmVjaXNpb24gJHtwYXJhbWV0ZXJzLnByZWNpc2lvbn0gdXNhbXBsZXIyREFycmF5OwoJYDsKCgkJaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2hpZ2hwJyApIHsKCgkJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIEhJR0hfUFJFQ0lTSU9OJzsKCgkJfSBlbHNlIGlmICggcGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICdtZWRpdW1wJyApIHsKCgkJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIE1FRElVTV9QUkVDSVNJT04nOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2xvd3AnICkgewoKCQkJcHJlY2lzaW9uc3RyaW5nICs9ICdcbiNkZWZpbmUgTE9XX1BSRUNJU0lPTic7CgoJCX0KCgkJcmV0dXJuIHByZWNpc2lvbnN0cmluZzsKCgl9CgoJZnVuY3Rpb24gZ2VuZXJhdGVTaGFkb3dNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCQlsZXQgc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9CQVNJQyc7CgoJCWlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBQQ0ZTaGFkb3dNYXAgKSB7CgoJCQlzaGFkb3dNYXBUeXBlRGVmaW5lID0gJ1NIQURPV01BUF9UWVBFX1BDRic7CgoJCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gUENGU29mdFNoYWRvd01hcCApIHsKCgkJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQnOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfVlNNJzsKCgkJfQoKCQlyZXR1cm4gc2hhZG93TWFwVHlwZURlZmluZTsKCgl9CgoJZnVuY3Rpb24gZ2VuZXJhdGVFbnZNYXBUeXBlRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCQlsZXQgZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCgkJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJCXN3aXRjaCAoIHBhcmFtZXRlcnMuZW52TWFwTW9kZSApIHsKCgkJCQljYXNlIEN1YmVSZWZsZWN0aW9uTWFwcGluZzoKCQkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoJCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRSc7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzoKCQkJCQllbnZNYXBUeXBlRGVmaW5lID0gJ0VOVk1BUF9UWVBFX0NVQkVfVVYnOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCXJldHVybiBlbnZNYXBUeXBlRGVmaW5lOwoKCX0KCglmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgoJCWxldCBlbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRkxFQ1RJT04nOwoKCQlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKCQkJc3dpdGNoICggcGFyYW1ldGVycy5lbnZNYXBNb2RlICkgewoKCQkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoKCQkJCQllbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRlJBQ1RJT04nOwoJCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCXJldHVybiBlbnZNYXBNb2RlRGVmaW5lOwoKCX0KCglmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCQlsZXQgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX05PTkUnOwoKCQlpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKCQkJc3dpdGNoICggcGFyYW1ldGVycy5jb21iaW5lICkgewoKCQkJCWNhc2UgTXVsdGlwbHlPcGVyYXRpb246CgkJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX01VTFRJUExZJzsKCQkJCQlicmVhazsKCgkJCQljYXNlIE1peE9wZXJhdGlvbjoKCQkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTUlYJzsKCQkJCQlicmVhazsKCgkJCQljYXNlIEFkZE9wZXJhdGlvbjoKCQkJCQllbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfQUREJzsKCQkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gZW52TWFwQmxlbmRpbmdEZWZpbmU7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApIHsKCgkJY29uc3QgaW1hZ2VIZWlnaHQgPSBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVVkhlaWdodDsKCgkJaWYgKCBpbWFnZUhlaWdodCA9PT0gbnVsbCApIHJldHVybiBudWxsOwoKCQljb25zdCBtYXhNaXAgPSBNYXRoLmxvZzIoIGltYWdlSGVpZ2h0ICkgLSAyOwoKCQljb25zdCB0ZXhlbEhlaWdodCA9IDEuMCAvIGltYWdlSGVpZ2h0OwoKCQljb25zdCB0ZXhlbFdpZHRoID0gMS4wIC8gKCAzICogTWF0aC5tYXgoIE1hdGgucG93KCAyLCBtYXhNaXAgKSwgNyAqIDE2ICkgKTsKCgkJcmV0dXJuIHsgdGV4ZWxXaWR0aCwgdGV4ZWxIZWlnaHQsIG1heE1pcCB9OwoKCX0KCglmdW5jdGlvbiBXZWJHTFByb2dyYW0oIHJlbmRlcmVyLCBjYWNoZUtleSwgcGFyYW1ldGVycywgYmluZGluZ1N0YXRlcyApIHsKCgkJLy8gVE9ETyBTZW5kIHRoaXMgZXZlbnQgdG8gVGhyZWUuanMgRGV2VG9vbHMKCQkvLyBjb25zb2xlLmxvZyggJ1dlYkdMUHJvZ3JhbScsIGNhY2hlS2V5ICk7CgoJCWNvbnN0IGdsID0gcmVuZGVyZXIuZ2V0Q29udGV4dCgpOwoKCQljb25zdCBkZWZpbmVzID0gcGFyYW1ldGVycy5kZWZpbmVzOwoKCQlsZXQgdmVydGV4U2hhZGVyID0gcGFyYW1ldGVycy52ZXJ0ZXhTaGFkZXI7CgkJbGV0IGZyYWdtZW50U2hhZGVyID0gcGFyYW1ldGVycy5mcmFnbWVudFNoYWRlcjsKCgkJY29uc3Qgc2hhZG93TWFwVHlwZURlZmluZSA9IGdlbmVyYXRlU2hhZG93TWFwVHlwZURlZmluZSggcGFyYW1ldGVycyApOwoJCWNvbnN0IGVudk1hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCQljb25zdCBlbnZNYXBNb2RlRGVmaW5lID0gZ2VuZXJhdGVFbnZNYXBNb2RlRGVmaW5lKCBwYXJhbWV0ZXJzICk7CgkJY29uc3QgZW52TWFwQmxlbmRpbmdEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICk7CgkJY29uc3QgZW52TWFwQ3ViZVVWU2l6ZSA9IGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApOwoKCQljb25zdCBjdXN0b21WZXJ0ZXhFeHRlbnNpb25zID0gZ2VuZXJhdGVWZXJ0ZXhFeHRlbnNpb25zKCBwYXJhbWV0ZXJzICk7CgoJCWNvbnN0IGN1c3RvbURlZmluZXMgPSBnZW5lcmF0ZURlZmluZXMoIGRlZmluZXMgKTsKCgkJY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTsKCgkJbGV0IHByZWZpeFZlcnRleCwgcHJlZml4RnJhZ21lbnQ7CgkJbGV0IHZlcnNpb25TdHJpbmcgPSBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID8gJyN2ZXJzaW9uICcgKyBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uICsgJ1xuJyA6ICcnOwoKCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCgkJCXByZWZpeFZlcnRleCA9IFsKCgkJCQknI2RlZmluZSBTSEFERVJfVFlQRSAnICsgcGFyYW1ldGVycy5zaGFkZXJUeXBlLAoJCQkJJyNkZWZpbmUgU0hBREVSX05BTUUgJyArIHBhcmFtZXRlcnMuc2hhZGVyTmFtZSwKCgkJCQljdXN0b21EZWZpbmVzCgoJCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKCQkJaWYgKCBwcmVmaXhWZXJ0ZXgubGVuZ3RoID4gMCApIHsKCgkJCQlwcmVmaXhWZXJ0ZXggKz0gJ1xuJzsKCgkJCX0KCgkJCXByZWZpeEZyYWdtZW50ID0gWwoKCQkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJCWN1c3RvbURlZmluZXMKCgkJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCQlpZiAoIHByZWZpeEZyYWdtZW50Lmxlbmd0aCA+IDAgKSB7CgoJCQkJcHJlZml4RnJhZ21lbnQgKz0gJ1xuJzsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCXByZWZpeFZlcnRleCA9IFsKCgkJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKCQkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJCWN1c3RvbURlZmluZXMsCgoJCQkJcGFyYW1ldGVycy5leHRlbnNpb25DbGlwQ3VsbERpc3RhbmNlID8gJyNkZWZpbmUgVVNFX0NMSVBfRElTVEFOQ0UnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmJhdGNoaW5nID8gJyNkZWZpbmUgVVNFX0JBVENISU5HJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yID8gJyNkZWZpbmUgVVNFX0JBVENISU5HX0NPTE9SJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nID8gJyNkZWZpbmUgVVNFX0lOU1RBTkNJTkcnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9JTlNUQU5DSU5HX0NPTE9SJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nTW9ycGggPyAnI2RlZmluZSBVU0VfSU5TVEFOQ0lOR19NT1JQSCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZyA/ICcjZGVmaW5lIFVTRV9GT0cnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm1hcCA/ICcjZGVmaW5lIFVTRV9NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lIFVTRV9FTlZNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBNb2RlRGVmaW5lIDogJycsCgkJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYnVtcE1hcCA/ICcjZGVmaW5lIFVTRV9CVU1QTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBPYmplY3RTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0UnIDogJycsCgkJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFRhbmdlbnRTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXAgPyAnI2RlZmluZSBVU0VfRElTUExBQ0VNRU5UTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5lbWlzc2l2ZU1hcCA/ICcjZGVmaW5lIFVTRV9FTUlTU0lWRU1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWScgOiAnJywKCQkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcCA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0NPTE9STUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zcGVjdWxhckludGVuc2l0eU1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfTUVUQUxORVNTTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT04nIDogJycsCgkJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcCA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT05NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9USElDS05FU1NNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX0NPTE9STUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgoJCQkJLy8KCgkJCQlwYXJhbWV0ZXJzLm1hcFV2ID8gJyNkZWZpbmUgTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmFscGhhTWFwVXYgPyAnI2RlZmluZSBBTFBIQU1BUF9VViAnICsgcGFyYW1ldGVycy5hbHBoYU1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwVXYgPyAnI2RlZmluZSBMSUdIVE1BUF9VViAnICsgcGFyYW1ldGVycy5saWdodE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmFvTWFwVXYgPyAnI2RlZmluZSBBT01BUF9VViAnICsgcGFyYW1ldGVycy5hb01hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgPyAnI2RlZmluZSBFTUlTU0lWRU1BUF9VViAnICsgcGFyYW1ldGVycy5lbWlzc2l2ZU1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmJ1bXBNYXBVdiA/ICcjZGVmaW5lIEJVTVBNQVBfVVYgJyArIHBhcmFtZXRlcnMuYnVtcE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2ID8gJyNkZWZpbmUgTk9STUFMTUFQX1VWICcgKyBwYXJhbWV0ZXJzLm5vcm1hbE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ID8gJyNkZWZpbmUgRElTUExBQ0VNRU5UTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2IDogJycsCgoJCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA/ICcjZGVmaW5lIE1FVEFMTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA6ICcnLAoJCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIFJPVUdITkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2ID8gJyNkZWZpbmUgQU5JU09UUk9QWU1BUF9VViAnICsgcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUX05PUk1BTE1BUF9VViAnICsgcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXBVdiA6ICcnLAoJCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiA/ICcjZGVmaW5lIENMRUFSQ09BVF9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRU1BUF9VViAnICsgcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRV9USElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2ID8gJyNkZWZpbmUgU0hFRU5fQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Db2xvck1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgPyAnI2RlZmluZSBTSEVFTl9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXBVdiA/ICcjZGVmaW5lIFNQRUNVTEFSTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgOiAnJywKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ID8gJyNkZWZpbmUgU1BFQ1VMQVJfQ09MT1JNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2IDogJycsCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPyAnI2RlZmluZSBTUEVDVUxBUl9JTlRFTlNJVFlNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA6ICcnLAoKCQkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgPyAnI2RlZmluZSBUUkFOU01JU1NJT05NQVBfVVYgJyArIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgOiAnJywKCQkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgPyAnI2RlZmluZSBUSElDS05FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgOiAnJywKCgkJCQkvLwoKCQkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzID8gJyNkZWZpbmUgVVNFX0NPTE9SJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAnI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPyAnI2RlZmluZSBVU0VfVVYxJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjJzID8gJyNkZWZpbmUgVVNFX1VWMicgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4VXYzcyA/ICcjZGVmaW5lIFVTRV9VVjMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5wb2ludHNVdnMgPyAnI2RlZmluZSBVU0VfUE9JTlRTX1VWJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNraW5uaW5nID8gJyNkZWZpbmUgVVNFX1NLSU5OSU5HJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMubW9ycGhUYXJnZXRzID8gJyNkZWZpbmUgVVNFX01PUlBIVEFSR0VUUycgOiAnJywKCQkJCXBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICYmIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPT09IGZhbHNlID8gJyNkZWZpbmUgVVNFX01PUlBITk9STUFMUycgOiAnJywKCQkJCSggcGFyYW1ldGVycy5tb3JwaENvbG9ycyApID8gJyNkZWZpbmUgVVNFX01PUlBIQ09MT1JTJyA6ICcnLAoJCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX1RFWFRVUkVfU1RSSURFICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGV4dHVyZVN0cmlkZSA6ICcnLAoJCQkJKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ID4gMCApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX0NPVU5UICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50IDogJycsCgkJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2l6ZUF0dGVudWF0aW9uID8gJyNkZWZpbmUgVVNFX1NJWkVBVFRFTlVBVElPTicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5yZXZlcnNlRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfUkVWRVJTRURFUFRIQlVGJyA6ICcnLAoKCQkJCSd1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7JywKCQkJCSd1bmlmb3JtIG1hdDQgbW9kZWxWaWV3TWF0cml4OycsCgkJCQkndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7JywKCQkJCSd1bmlmb3JtIG1hdDQgdmlld01hdHJpeDsnLAoJCQkJJ3VuaWZvcm0gbWF0MyBub3JtYWxNYXRyaXg7JywKCQkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKCQkJCSd1bmlmb3JtIGJvb2wgaXNPcnRob2dyYXBoaWM7JywKCgkJCQknI2lmZGVmIFVTRV9JTlNUQU5DSU5HJywKCgkJCQknCWF0dHJpYnV0ZSBtYXQ0IGluc3RhbmNlTWF0cml4OycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19DT0xPUicsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjMyBpbnN0YW5jZUNvbG9yOycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lOR19NT1JQSCcsCgoJCQkJJwl1bmlmb3JtIHNhbXBsZXIyRCBtb3JwaFRleHR1cmU7JywKCgkJCQknI2VuZGlmJywKCgkJCQknYXR0cmlidXRlIHZlYzMgcG9zaXRpb247JywKCQkJCSdhdHRyaWJ1dGUgdmVjMyBub3JtYWw7JywKCQkJCSdhdHRyaWJ1dGUgdmVjMiB1djsnLAoKCQkJCScjaWZkZWYgVVNFX1VWMScsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjMiB1djE7JywKCgkJCQknI2VuZGlmJywKCgkJCQknI2lmZGVmIFVTRV9VVjInLAoKCQkJCScJYXR0cmlidXRlIHZlYzIgdXYyOycsCgoJCQkJJyNlbmRpZicsCgoJCQkJJyNpZmRlZiBVU0VfVVYzJywKCgkJCQknCWF0dHJpYnV0ZSB2ZWMyIHV2MzsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCScjaWZkZWYgVVNFX1RBTkdFTlQnLAoKCQkJCScJYXR0cmlidXRlIHZlYzQgdGFuZ2VudDsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCScjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBICknLAoKCQkJCScJYXR0cmlidXRlIHZlYzQgY29sb3I7JywKCgkJCQknI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICknLAoKCQkJCScJYXR0cmlidXRlIHZlYzMgY29sb3I7JywKCgkJCQknI2VuZGlmJywKCgkJCQknI2lmZGVmIFVTRV9TS0lOTklORycsCgoJCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luSW5kZXg7JywKCQkJCScJYXR0cmlidXRlIHZlYzQgc2tpbldlaWdodDsnLAoKCQkJCScjZW5kaWYnLAoKCQkJCSdcbicKCgkJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCgkJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKCQkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCQknI2RlZmluZSBTSEFERVJfTkFNRSAnICsgcGFyYW1ldGVycy5zaGFkZXJOYW1lLAoKCQkJCWN1c3RvbURlZmluZXMsCgoJCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2cgPyAnI2RlZmluZSBVU0VfRk9HJyA6ICcnLAoJCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2dFeHAyID8gJyNkZWZpbmUgRk9HX0VYUDInIDogJycsCgoJCQkJcGFyYW1ldGVycy5hbHBoYVRvQ292ZXJhZ2UgPyAnI2RlZmluZSBBTFBIQV9UT19DT1ZFUkFHRScgOiAnJywKCQkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubWF0Y2FwID8gJyNkZWZpbmUgVVNFX01BVENBUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcFR5cGVEZWZpbmUgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcE1vZGVEZWZpbmUgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcEJsZW5kaW5nRGVmaW5lIDogJycsCgkJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX1RFWEVMX1dJRFRIICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsV2lkdGggOiAnJywKCQkJCWVudk1hcEN1YmVVVlNpemUgPyAnI2RlZmluZSBDVUJFVVZfVEVYRUxfSEVJR0hUICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsSGVpZ2h0IDogJycsCgkJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX01BWF9NSVAgJyArIGVudk1hcEN1YmVVVlNpemUubWF4TWlwICsgJy4wJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5saWdodE1hcCA/ICcjZGVmaW5lIFVTRV9MSUdIVE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYW9NYXAgPyAnI2RlZmluZSBVU0VfQU9NQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX09CSkVDVFNQQUNFJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRScgOiAnJywKCQkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5ID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFknIDogJycsCgkJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXAgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWU1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVQnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRpc3BlcnNpb24gPyAnI2RlZmluZSBVU0VfRElTUEVSU0lPTicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlID8gJyNkZWZpbmUgVVNFX0lSSURFU0NFTkNFJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRU1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc3BlY3VsYXJNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfQ09MT1JNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9ST1VHSE5FU1NNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFUZXN0ID8gJyNkZWZpbmUgVVNFX0FMUEhBVEVTVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLnNoZWVuID8gJyNkZWZpbmUgVVNFX1NIRUVOJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NIRUVOX0NPTE9STUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5zaGVlblJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVAnIDogJycsCgoJCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb24gPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OJyA6ICcnLAoJCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXAgPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OTUFQJyA6ICcnLAoJCQkJcGFyYW1ldGVycy50aGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4Q29sb3JzIHx8IHBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yIHx8IHBhcmFtZXRlcnMuYmF0Y2hpbmdDb2xvciA/ICcjZGVmaW5lIFVTRV9DT0xPUicgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4QWxwaGFzID8gJyNkZWZpbmUgVVNFX0NPTE9SX0FMUEhBJyA6ICcnLAoJCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjFzID8gJyNkZWZpbmUgVVNFX1VWMScgOiAnJywKCQkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA/ICcjZGVmaW5lIFVTRV9VVjInIDogJycsCgkJCQlwYXJhbWV0ZXJzLnZlcnRleFV2M3MgPyAnI2RlZmluZSBVU0VfVVYzJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMucG9pbnRzVXZzID8gJyNkZWZpbmUgVVNFX1BPSU5UU19VVicgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmdyYWRpZW50TWFwID8gJyNkZWZpbmUgVVNFX0dSQURJRU5UTUFQJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAoJCQkJcGFyYW1ldGVycy5mbGlwU2lkZWQgPyAnI2RlZmluZSBGTElQX1NJREVEJyA6ICcnLAoKCQkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKCQkJCXBhcmFtZXRlcnMucHJlbXVsdGlwbGllZEFscGhhID8gJyNkZWZpbmUgUFJFTVVMVElQTElFRF9BTFBIQScgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgoJCQkJcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmUgPyAnI2RlZmluZSBERUNPREVfVklERU9fVEVYVFVSRScgOiAnJywKCQkJCXBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlRW1pc3NpdmUgPyAnI2RlZmluZSBERUNPREVfVklERU9fVEVYVFVSRV9FTUlTU0lWRScgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUYnIDogJycsCgkJCQlwYXJhbWV0ZXJzLnJldmVyc2VEZXB0aEJ1ZmZlciA/ICcjZGVmaW5lIFVTRV9SRVZFUlNFREVQVEhCVUYnIDogJycsCgoJCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCgkJCQkndW5pZm9ybSB2ZWMzIGNhbWVyYVBvc2l0aW9uOycsCgkJCQkndW5pZm9ybSBib29sIGlzT3J0aG9ncmFwaGljOycsCgoJCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyAnI2RlZmluZSBUT05FX01BUFBJTkcnIDogJycsCgkJCQkoIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgIT09IE5vVG9uZU1hcHBpbmcgKSA/IFNoYWRlckNodW5rWyAndG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCcgXSA6ICcnLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHRvbmVNYXBwaW5nKCkgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwoJCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyBnZXRUb25lTWFwcGluZ0Z1bmN0aW9uKCAndG9uZU1hcHBpbmcnLCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICkgOiAnJywKCgkJCQlwYXJhbWV0ZXJzLmRpdGhlcmluZyA/ICcjZGVmaW5lIERJVEhFUklORycgOiAnJywKCQkJCXBhcmFtZXRlcnMub3BhcXVlID8gJyNkZWZpbmUgT1BBUVVFJyA6ICcnLAoKCQkJCVNoYWRlckNodW5rWyAnY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50JyBdLCAvLyB0aGlzIGNvZGUgaXMgcmVxdWlyZWQgaGVyZSBiZWNhdXNlIGl0IGlzIHVzZWQgYnkgdGhlIHZhcmlvdXMgZW5jb2RpbmcvZGVjb2RpbmcgZnVuY3Rpb24gZGVmaW5lZCBiZWxvdwoJCQkJZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCAnbGluZWFyVG9PdXRwdXRUZXhlbCcsIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApLAoJCQkJZ2V0THVtaW5hbmNlRnVuY3Rpb24oKSwKCgkJCQlwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyA/ICcjZGVmaW5lIERFUFRIX1BBQ0tJTkcgJyArIHBhcmFtZXRlcnMuZGVwdGhQYWNraW5nIDogJycsCgoJCQkJJ1xuJwoKCQkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJfQoKCQl2ZXJ0ZXhTaGFkZXIgPSByZXNvbHZlSW5jbHVkZXMoIHZlcnRleFNoYWRlciApOwoJCXZlcnRleFNoYWRlciA9IHJlcGxhY2VMaWdodE51bXMoIHZlcnRleFNoYWRlciwgcGFyYW1ldGVycyApOwoJCXZlcnRleFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggdmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzICk7CgoJCWZyYWdtZW50U2hhZGVyID0gcmVzb2x2ZUluY2x1ZGVzKCBmcmFnbWVudFNoYWRlciApOwoJCWZyYWdtZW50U2hhZGVyID0gcmVwbGFjZUxpZ2h0TnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCQlmcmFnbWVudFNoYWRlciA9IHJlcGxhY2VDbGlwcGluZ1BsYW5lTnVtcyggZnJhZ21lbnRTaGFkZXIsIHBhcmFtZXRlcnMgKTsKCgkJdmVydGV4U2hhZGVyID0gdW5yb2xsTG9vcHMoIHZlcnRleFNoYWRlciApOwoJCWZyYWdtZW50U2hhZGVyID0gdW5yb2xsTG9vcHMoIGZyYWdtZW50U2hhZGVyICk7CgoJCWlmICggcGFyYW1ldGVycy5pc1Jhd1NoYWRlck1hdGVyaWFsICE9PSB0cnVlICkgewoKCQkJLy8gR0xTTCAzLjAgY29udmVyc2lvbiBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzIGFuZCBTaGFkZXJNYXRlcmlhbAoKCQkJdmVyc2lvblN0cmluZyA9ICcjdmVyc2lvbiAzMDAgZXNcbic7CgoJCQlwcmVmaXhWZXJ0ZXggPSBbCgkJCQljdXN0b21WZXJ0ZXhFeHRlbnNpb25zLAoJCQkJJyNkZWZpbmUgYXR0cmlidXRlIGluJywKCQkJCScjZGVmaW5lIHZhcnlpbmcgb3V0JywKCQkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJwoJCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhWZXJ0ZXg7CgoJCQlwcmVmaXhGcmFnbWVudCA9IFsKCQkJCScjZGVmaW5lIHZhcnlpbmcgaW4nLAoJCQkJKCBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID09PSBHTFNMMyApID8gJycgOiAnbGF5b3V0KGxvY2F0aW9uID0gMCkgb3V0IGhpZ2hwIHZlYzQgcGNfZnJhZ0NvbG9yOycsCgkJCQkoIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPT09IEdMU0wzICkgPyAnJyA6ICcjZGVmaW5lIGdsX0ZyYWdDb2xvciBwY19mcmFnQ29sb3InLAoJCQkJJyNkZWZpbmUgZ2xfRnJhZ0RlcHRoRVhUIGdsX0ZyYWdEZXB0aCcsCgkJCQknI2RlZmluZSB0ZXh0dXJlMkQgdGV4dHVyZScsCgkJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZSB0ZXh0dXJlJywKCQkJCScjZGVmaW5lIHRleHR1cmUyRFByb2ogdGV4dHVyZVByb2onLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJETG9kRVhUIHRleHR1cmVMb2QnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvakxvZEVYVCB0ZXh0dXJlUHJvakxvZCcsCgkJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZUxvZEVYVCB0ZXh0dXJlTG9kJywKCQkJCScjZGVmaW5lIHRleHR1cmUyREdyYWRFWFQgdGV4dHVyZUdyYWQnLAoJCQkJJyNkZWZpbmUgdGV4dHVyZTJEUHJvakdyYWRFWFQgdGV4dHVyZVByb2pHcmFkJywKCQkJCScjZGVmaW5lIHRleHR1cmVDdWJlR3JhZEVYVCB0ZXh0dXJlR3JhZCcKCQkJXS5qb2luKCAnXG4nICkgKyAnXG4nICsgcHJlZml4RnJhZ21lbnQ7CgoJCX0KCgkJY29uc3QgdmVydGV4R2xzbCA9IHZlcnNpb25TdHJpbmcgKyBwcmVmaXhWZXJ0ZXggKyB2ZXJ0ZXhTaGFkZXI7CgkJY29uc3QgZnJhZ21lbnRHbHNsID0gdmVyc2lvblN0cmluZyArIHByZWZpeEZyYWdtZW50ICsgZnJhZ21lbnRTaGFkZXI7CgoJCS8vIGNvbnNvbGUubG9nKCAnKlZFUlRFWConLCB2ZXJ0ZXhHbHNsICk7CgkJLy8gY29uc29sZS5sb2coICcqRlJBR01FTlQqJywgZnJhZ21lbnRHbHNsICk7CgoJCWNvbnN0IGdsVmVydGV4U2hhZGVyID0gV2ViR0xTaGFkZXIoIGdsLCBnbC5WRVJURVhfU0hBREVSLCB2ZXJ0ZXhHbHNsICk7CgkJY29uc3QgZ2xGcmFnbWVudFNoYWRlciA9IFdlYkdMU2hhZGVyKCBnbCwgZ2wuRlJBR01FTlRfU0hBREVSLCBmcmFnbWVudEdsc2wgKTsKCgkJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJCWdsLmF0dGFjaFNoYWRlciggcHJvZ3JhbSwgZ2xGcmFnbWVudFNoYWRlciApOwoKCQkvLyBGb3JjZSBhIHBhcnRpY3VsYXIgYXR0cmlidXRlIHRvIGluZGV4IDAuCgoJCWlmICggcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICE9PSB1bmRlZmluZWQgKSB7CgoJCQlnbC5iaW5kQXR0cmliTG9jYXRpb24oIHByb2dyYW0sIDAsIHBhcmFtZXRlcnMuaW5kZXgwQXR0cmlidXRlTmFtZSApOwoKCQl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0cyA9PT0gdHJ1ZSApIHsKCgkJCS8vIHByb2dyYW1zIHdpdGggbW9ycGhUYXJnZXRzIGRpc3BsYWNlIHBvc2l0aW9uIG91dCBvZiBhdHRyaWJ1dGUgMAoJCQlnbC5iaW5kQXR0cmliTG9jYXRpb24oIHByb2dyYW0sIDAsICdwb3NpdGlvbicgKTsKCgkJfQoKCQlnbC5saW5rUHJvZ3JhbSggcHJvZ3JhbSApOwoKCQlmdW5jdGlvbiBvbkZpcnN0VXNlKCBzZWxmICkgewoKCQkJLy8gY2hlY2sgZm9yIGxpbmsgZXJyb3JzCgkJCWlmICggcmVuZGVyZXIuZGVidWcuY2hlY2tTaGFkZXJFcnJvcnMgKSB7CgoJCQkJY29uc3QgcHJvZ3JhbUxvZyA9IGdsLmdldFByb2dyYW1JbmZvTG9nKCBwcm9ncmFtICkudHJpbSgpOwoJCQkJY29uc3QgdmVydGV4TG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggZ2xWZXJ0ZXhTaGFkZXIgKS50cmltKCk7CgkJCQljb25zdCBmcmFnbWVudExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsRnJhZ21lbnRTaGFkZXIgKS50cmltKCk7CgoJCQkJbGV0IHJ1bm5hYmxlID0gdHJ1ZTsKCQkJCWxldCBoYXZlRGlhZ25vc3RpY3MgPSB0cnVlOwoKCQkJCWlmICggZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuTElOS19TVEFUVVMgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCXJ1bm5hYmxlID0gZmFsc2U7CgoJCQkJCWlmICggdHlwZW9mIHJlbmRlcmVyLmRlYnVnLm9uU2hhZGVyRXJyb3IgPT09ICdmdW5jdGlvbicgKSB7CgoJCQkJCQlyZW5kZXJlci5kZWJ1Zy5vblNoYWRlckVycm9yKCBnbCwgcHJvZ3JhbSwgZ2xWZXJ0ZXhTaGFkZXIsIGdsRnJhZ21lbnRTaGFkZXIgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGRlZmF1bHQgZXJyb3IgcmVwb3J0aW5nCgoJCQkJCQljb25zdCB2ZXJ0ZXhFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbFZlcnRleFNoYWRlciwgJ3ZlcnRleCcgKTsKCQkJCQkJY29uc3QgZnJhZ21lbnRFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbEZyYWdtZW50U2hhZGVyLCAnZnJhZ21lbnQnICk7CgoJCQkJCQljb25zb2xlLmVycm9yKAoJCQkJCQkJJ1RIUkVFLldlYkdMUHJvZ3JhbTogU2hhZGVyIEVycm9yICcgKyBnbC5nZXRFcnJvcigpICsgJyAtICcgKwoJCQkJCQkJJ1ZBTElEQVRFX1NUQVRVUyAnICsgZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuVkFMSURBVEVfU1RBVFVTICkgKyAnXG5cbicgKwoJCQkJCQkJJ01hdGVyaWFsIE5hbWU6ICcgKyBzZWxmLm5hbWUgKyAnXG4nICsKCQkJCQkJCSdNYXRlcmlhbCBUeXBlOiAnICsgc2VsZi50eXBlICsgJ1xuXG4nICsKCQkJCQkJCSdQcm9ncmFtIEluZm8gTG9nOiAnICsgcHJvZ3JhbUxvZyArICdcbicgKwoJCQkJCQkJdmVydGV4RXJyb3JzICsgJ1xuJyArCgkJCQkJCQlmcmFnbWVudEVycm9ycwoJCQkJCQkpOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggcHJvZ3JhbUxvZyAhPT0gJycgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogUHJvZ3JhbSBJbmZvIExvZzonLCBwcm9ncmFtTG9nICk7CgoJCQkJfSBlbHNlIGlmICggdmVydGV4TG9nID09PSAnJyB8fCBmcmFnbWVudExvZyA9PT0gJycgKSB7CgoJCQkJCWhhdmVEaWFnbm9zdGljcyA9IGZhbHNlOwoKCQkJCX0KCgkJCQlpZiAoIGhhdmVEaWFnbm9zdGljcyApIHsKCgkJCQkJc2VsZi5kaWFnbm9zdGljcyA9IHsKCgkJCQkJCXJ1bm5hYmxlOiBydW5uYWJsZSwKCgkJCQkJCXByb2dyYW1Mb2c6IHByb2dyYW1Mb2csCgoJCQkJCQl2ZXJ0ZXhTaGFkZXI6IHsKCgkJCQkJCQlsb2c6IHZlcnRleExvZywKCQkJCQkJCXByZWZpeDogcHJlZml4VmVydGV4CgoJCQkJCQl9LAoKCQkJCQkJZnJhZ21lbnRTaGFkZXI6IHsKCgkJCQkJCQlsb2c6IGZyYWdtZW50TG9nLAoJCQkJCQkJcHJlZml4OiBwcmVmaXhGcmFnbWVudAoKCQkJCQkJfQoKCQkJCQl9OwoKCQkJCX0KCgkJCX0KCgkJCS8vIENsZWFuIHVwCgoJCQkvLyBDcmFzaGVzIGluIGlPUzkgYW5kIGlPUzEwLiAjMTg0MDIKCQkJLy8gZ2wuZGV0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJCQkvLyBnbC5kZXRhY2hTaGFkZXIoIHByb2dyYW0sIGdsRnJhZ21lbnRTaGFkZXIgKTsKCgkJCWdsLmRlbGV0ZVNoYWRlciggZ2xWZXJ0ZXhTaGFkZXIgKTsKCQkJZ2wuZGVsZXRlU2hhZGVyKCBnbEZyYWdtZW50U2hhZGVyICk7CgoJCQljYWNoZWRVbmlmb3JtcyA9IG5ldyBXZWJHTFVuaWZvcm1zKCBnbCwgcHJvZ3JhbSApOwoJCQljYWNoZWRBdHRyaWJ1dGVzID0gZmV0Y2hBdHRyaWJ1dGVMb2NhdGlvbnMoIGdsLCBwcm9ncmFtICk7CgoJCX0KCgkJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIHVuaWZvcm0gbG9jYXRpb25zCgoJCWxldCBjYWNoZWRVbmlmb3JtczsKCgkJdGhpcy5nZXRVbmlmb3JtcyA9IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggY2FjaGVkVW5pZm9ybXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBQb3B1bGF0ZXMgY2FjaGVkVW5pZm9ybXMgYW5kIGNhY2hlZEF0dHJpYnV0ZXMKCQkJCW9uRmlyc3RVc2UoIHRoaXMgKTsKCgkJCX0KCgkJCXJldHVybiBjYWNoZWRVbmlmb3JtczsKCgkJfTsKCgkJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIGF0dHJpYnV0ZSBsb2NhdGlvbnMKCgkJbGV0IGNhY2hlZEF0dHJpYnV0ZXM7CgoJCXRoaXMuZ2V0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggY2FjaGVkQXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIFBvcHVsYXRlcyBjYWNoZWRBdHRyaWJ1dGVzIGFuZCBjYWNoZWRVbmlmb3JtcwoJCQkJb25GaXJzdFVzZSggdGhpcyApOwoKCQkJfQoKCQkJcmV0dXJuIGNhY2hlZEF0dHJpYnV0ZXM7CgoJCX07CgoJCS8vIGluZGljYXRlIHdoZW4gdGhlIHByb2dyYW0gaXMgcmVhZHkgdG8gYmUgdXNlZC4gaWYgdGhlIEtIUl9wYXJhbGxlbF9zaGFkZXJfY29tcGlsZSBleHRlbnNpb24gaXNuJ3Qgc3VwcG9ydGVkLAoJCS8vIGZsYWcgdGhlIHByb2dyYW0gYXMgcmVhZHkgaW1tZWRpYXRlbHkuIEl0IG1heSBjYXVzZSBhIHN0YWxsIHdoZW4gaXQncyBmaXJzdCB1c2VkLgoKCQlsZXQgcHJvZ3JhbVJlYWR5ID0gKCBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uUGFyYWxsZWxTaGFkZXJDb21waWxlID09PSBmYWxzZSApOwoKCQl0aGlzLmlzUmVhZHkgPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIHByb2dyYW1SZWFkeSA9PT0gZmFsc2UgKSB7CgoJCQkJcHJvZ3JhbVJlYWR5ID0gZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgQ09NUExFVElPTl9TVEFUVVNfS0hSICk7CgoJCQl9CgoJCQlyZXR1cm4gcHJvZ3JhbVJlYWR5OwoKCQl9OwoKCQkvLyBmcmVlIHJlc291cmNlCgoJCXRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKCgkJCWJpbmRpbmdTdGF0ZXMucmVsZWFzZVN0YXRlc09mUHJvZ3JhbSggdGhpcyApOwoKCQkJZ2wuZGVsZXRlUHJvZ3JhbSggcHJvZ3JhbSApOwoJCQl0aGlzLnByb2dyYW0gPSB1bmRlZmluZWQ7CgoJCX07CgoJCS8vCgoJCXRoaXMudHlwZSA9IHBhcmFtZXRlcnMuc2hhZGVyVHlwZTsKCQl0aGlzLm5hbWUgPSBwYXJhbWV0ZXJzLnNoYWRlck5hbWU7CgkJdGhpcy5pZCA9IHByb2dyYW1JZENvdW50ICsrOwoJCXRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsKCQl0aGlzLnVzZWRUaW1lcyA9IDE7CgkJdGhpcy5wcm9ncmFtID0gcHJvZ3JhbTsKCQl0aGlzLnZlcnRleFNoYWRlciA9IGdsVmVydGV4U2hhZGVyOwoJCXRoaXMuZnJhZ21lbnRTaGFkZXIgPSBnbEZyYWdtZW50U2hhZGVyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGV0IF9pZCA9IDA7CgoJY2xhc3MgV2ViR0xTaGFkZXJDYWNoZSB7CgoJCWNvbnN0cnVjdG9yKCkgewoKCQkJdGhpcy5zaGFkZXJDYWNoZSA9IG5ldyBNYXAoKTsKCQkJdGhpcy5tYXRlcmlhbENhY2hlID0gbmV3IE1hcCgpOwoKCQl9CgoJCXVwZGF0ZSggbWF0ZXJpYWwgKSB7CgoJCQljb25zdCB2ZXJ0ZXhTaGFkZXIgPSBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXI7CgkJCWNvbnN0IGZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgoJCQljb25zdCB2ZXJ0ZXhTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCB2ZXJ0ZXhTaGFkZXIgKTsKCQkJY29uc3QgZnJhZ21lbnRTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCBmcmFnbWVudFNoYWRlciApOwoKCQkJY29uc3QgbWF0ZXJpYWxTaGFkZXJzID0gdGhpcy5fZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKTsKCgkJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggdmVydGV4U2hhZGVyU3RhZ2UgKSA9PT0gZmFsc2UgKSB7CgoJCQkJbWF0ZXJpYWxTaGFkZXJzLmFkZCggdmVydGV4U2hhZGVyU3RhZ2UgKTsKCQkJCXZlcnRleFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggZnJhZ21lbnRTaGFkZXJTdGFnZSApID09PSBmYWxzZSApIHsKCgkJCQltYXRlcmlhbFNoYWRlcnMuYWRkKCBmcmFnbWVudFNoYWRlclN0YWdlICk7CgkJCQlmcmFnbWVudFNoYWRlclN0YWdlLnVzZWRUaW1lcyArKzsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCXJlbW92ZSggbWF0ZXJpYWwgKSB7CgoJCQljb25zdCBtYXRlcmlhbFNoYWRlcnMgPSB0aGlzLm1hdGVyaWFsQ2FjaGUuZ2V0KCBtYXRlcmlhbCApOwoKCQkJZm9yICggY29uc3Qgc2hhZGVyU3RhZ2Ugb2YgbWF0ZXJpYWxTaGFkZXJzICkgewoKCQkJCXNoYWRlclN0YWdlLnVzZWRUaW1lcyAtLTsKCgkJCQlpZiAoIHNoYWRlclN0YWdlLnVzZWRUaW1lcyA9PT0gMCApIHRoaXMuc2hhZGVyQ2FjaGUuZGVsZXRlKCBzaGFkZXJTdGFnZS5jb2RlICk7CgoJCQl9CgoJCQl0aGlzLm1hdGVyaWFsQ2FjaGUuZGVsZXRlKCBtYXRlcmlhbCApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICkgewoKCQkJcmV0dXJuIHRoaXMuX2dldFNoYWRlclN0YWdlKCBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXIgKS5pZDsKCgkJfQoKCQlnZXRGcmFnbWVudFNoYWRlcklEKCBtYXRlcmlhbCApIHsKCgkJCXJldHVybiB0aGlzLl9nZXRTaGFkZXJTdGFnZSggbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXIgKS5pZDsKCgkJfQoKCQlkaXNwb3NlKCkgewoKCQkJdGhpcy5zaGFkZXJDYWNoZS5jbGVhcigpOwoJCQl0aGlzLm1hdGVyaWFsQ2FjaGUuY2xlYXIoKTsKCgkJfQoKCQlfZ2V0U2hhZGVyQ2FjaGVGb3JNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgoJCQljb25zdCBjYWNoZSA9IHRoaXMubWF0ZXJpYWxDYWNoZTsKCQkJbGV0IHNldCA9IGNhY2hlLmdldCggbWF0ZXJpYWwgKTsKCgkJCWlmICggc2V0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc2V0ID0gbmV3IFNldCgpOwoJCQkJY2FjaGUuc2V0KCBtYXRlcmlhbCwgc2V0ICk7CgoJCQl9CgoJCQlyZXR1cm4gc2V0OwoKCQl9CgoJCV9nZXRTaGFkZXJTdGFnZSggY29kZSApIHsKCgkJCWNvbnN0IGNhY2hlID0gdGhpcy5zaGFkZXJDYWNoZTsKCQkJbGV0IHN0YWdlID0gY2FjaGUuZ2V0KCBjb2RlICk7CgoJCQlpZiAoIHN0YWdlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJc3RhZ2UgPSBuZXcgV2ViR0xTaGFkZXJTdGFnZSggY29kZSApOwoJCQkJY2FjaGUuc2V0KCBjb2RlLCBzdGFnZSApOwoKCQkJfQoKCQkJcmV0dXJuIHN0YWdlOwoKCQl9CgoJfQoKCWNsYXNzIFdlYkdMU2hhZGVyU3RhZ2UgewoKCQljb25zdHJ1Y3RvciggY29kZSApIHsKCgkJCXRoaXMuaWQgPSBfaWQgKys7CgoJCQl0aGlzLmNvZGUgPSBjb2RlOwoJCQl0aGlzLnVzZWRUaW1lcyA9IDA7CgoJCX0KCgl9CgoJZnVuY3Rpb24gV2ViR0xQcm9ncmFtcyggcmVuZGVyZXIsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIGJpbmRpbmdTdGF0ZXMsIGNsaXBwaW5nICkgewoKCQljb25zdCBfcHJvZ3JhbUxheWVycyA9IG5ldyBMYXllcnMoKTsKCQljb25zdCBfY3VzdG9tU2hhZGVycyA9IG5ldyBXZWJHTFNoYWRlckNhY2hlKCk7CgkJY29uc3QgX2FjdGl2ZUNoYW5uZWxzID0gbmV3IFNldCgpOwoJCWNvbnN0IHByb2dyYW1zID0gW107CgoJCWNvbnN0IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPSBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjsKCQljb25zdCBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMgPSBjYXBhYmlsaXRpZXMudmVydGV4VGV4dHVyZXM7CgoJCWxldCBwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMucHJlY2lzaW9uOwoKCQljb25zdCBzaGFkZXJJRHMgPSB7CgkJCU1lc2hEZXB0aE1hdGVyaWFsOiAnZGVwdGgnLAoJCQlNZXNoRGlzdGFuY2VNYXRlcmlhbDogJ2Rpc3RhbmNlUkdCQScsCgkJCU1lc2hOb3JtYWxNYXRlcmlhbDogJ25vcm1hbCcsCgkJCU1lc2hCYXNpY01hdGVyaWFsOiAnYmFzaWMnLAoJCQlNZXNoTGFtYmVydE1hdGVyaWFsOiAnbGFtYmVydCcsCgkJCU1lc2hQaG9uZ01hdGVyaWFsOiAncGhvbmcnLAoJCQlNZXNoVG9vbk1hdGVyaWFsOiAndG9vbicsCgkJCU1lc2hTdGFuZGFyZE1hdGVyaWFsOiAncGh5c2ljYWwnLAoJCQlNZXNoUGh5c2ljYWxNYXRlcmlhbDogJ3BoeXNpY2FsJywKCQkJTWVzaE1hdGNhcE1hdGVyaWFsOiAnbWF0Y2FwJywKCQkJTGluZUJhc2ljTWF0ZXJpYWw6ICdiYXNpYycsCgkJCUxpbmVEYXNoZWRNYXRlcmlhbDogJ2Rhc2hlZCcsCgkJCVBvaW50c01hdGVyaWFsOiAncG9pbnRzJywKCQkJU2hhZG93TWF0ZXJpYWw6ICdzaGFkb3cnLAoJCQlTcHJpdGVNYXRlcmlhbDogJ3Nwcml0ZScKCQl9OwoKCQlmdW5jdGlvbiBnZXRDaGFubmVsKCB2YWx1ZSApIHsKCgkJCV9hY3RpdmVDaGFubmVscy5hZGQoIHZhbHVlICk7CgoJCQlpZiAoIHZhbHVlID09PSAwICkgcmV0dXJuICd1dic7CgoJCQlyZXR1cm4gYHV2JHsgdmFsdWUgfWA7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0UGFyYW1ldGVycyggbWF0ZXJpYWwsIGxpZ2h0cywgc2hhZG93cywgc2NlbmUsIG9iamVjdCApIHsKCgkJCWNvbnN0IGZvZyA9IHNjZW5lLmZvZzsKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgkJCWNvbnN0IGVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKCgkJCWNvbnN0IGVudk1hcCA9ICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggbWF0ZXJpYWwuZW52TWFwIHx8IGVudmlyb25tZW50ICk7CgkJCWNvbnN0IGVudk1hcEN1YmVVVkhlaWdodCA9ICggISEgZW52TWFwICkgJiYgKCBlbnZNYXAubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSA/IGVudk1hcC5pbWFnZS5oZWlnaHQgOiBudWxsOwoKCQkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKCgkJCS8vIGhldXJpc3RpY3MgdG8gY3JlYXRlIHNoYWRlciBwYXJhbWV0ZXJzIGFjY29yZGluZyB0byBsaWdodHMgaW4gdGhlIHNjZW5lCgkJCS8vIChub3QgdG8gYmxvdyBvdmVyIG1heExpZ2h0cyBidWRnZXQpCgoJCQlpZiAoIG1hdGVyaWFsLnByZWNpc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlwcmVjaXNpb24gPSBjYXBhYmlsaXRpZXMuZ2V0TWF4UHJlY2lzaW9uKCBtYXRlcmlhbC5wcmVjaXNpb24gKTsKCgkJCQlpZiAoIHByZWNpc2lvbiAhPT0gbWF0ZXJpYWwucHJlY2lzaW9uICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW0uZ2V0UGFyYW1ldGVyczonLCBtYXRlcmlhbC5wcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIHByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvcjsKCQkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgoJCQlsZXQgbW9ycGhUZXh0dXJlU3RyaWRlID0gMDsKCgkJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAxOwoJCQlpZiAoIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDI7CgkJCWlmICggZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yICE9PSB1bmRlZmluZWQgKSBtb3JwaFRleHR1cmVTdHJpZGUgPSAzOwoKCQkJLy8KCgkJCWxldCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyOwoJCQlsZXQgY3VzdG9tVmVydGV4U2hhZGVySUQsIGN1c3RvbUZyYWdtZW50U2hhZGVySUQ7CgoJCQlpZiAoIHNoYWRlcklEICkgewoKCQkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKCgkJCQl2ZXJ0ZXhTaGFkZXIgPSBzaGFkZXIudmVydGV4U2hhZGVyOwoJCQkJZnJhZ21lbnRTaGFkZXIgPSBzaGFkZXIuZnJhZ21lbnRTaGFkZXI7CgoJCQl9IGVsc2UgewoKCQkJCXZlcnRleFNoYWRlciA9IG1hdGVyaWFsLnZlcnRleFNoYWRlcjsKCQkJCWZyYWdtZW50U2hhZGVyID0gbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXI7CgoJCQkJX2N1c3RvbVNoYWRlcnMudXBkYXRlKCBtYXRlcmlhbCApOwoKCQkJCWN1c3RvbVZlcnRleFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICk7CgkJCQljdXN0b21GcmFnbWVudFNoYWRlcklEID0gX2N1c3RvbVNoYWRlcnMuZ2V0RnJhZ21lbnRTaGFkZXJJRCggbWF0ZXJpYWwgKTsKCgkJCX0KCgkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJY29uc3QgcmV2ZXJzZURlcHRoQnVmZmVyID0gcmVuZGVyZXIuc3RhdGUuYnVmZmVycy5kZXB0aC5nZXRSZXZlcnNlZCgpOwoKCQkJY29uc3QgSVNfSU5TVEFOQ0VETUVTSCA9IG9iamVjdC5pc0luc3RhbmNlZE1lc2ggPT09IHRydWU7CgkJCWNvbnN0IElTX0JBVENIRURNRVNIID0gb2JqZWN0LmlzQmF0Y2hlZE1lc2ggPT09IHRydWU7CgoJCQljb25zdCBIQVNfTUFQID0gISEgbWF0ZXJpYWwubWFwOwoJCQljb25zdCBIQVNfTUFUQ0FQID0gISEgbWF0ZXJpYWwubWF0Y2FwOwoJCQljb25zdCBIQVNfRU5WTUFQID0gISEgZW52TWFwOwoJCQljb25zdCBIQVNfQU9NQVAgPSAhISBtYXRlcmlhbC5hb01hcDsKCQkJY29uc3QgSEFTX0xJR0hUTUFQID0gISEgbWF0ZXJpYWwubGlnaHRNYXA7CgkJCWNvbnN0IEhBU19CVU1QTUFQID0gISEgbWF0ZXJpYWwuYnVtcE1hcDsKCQkJY29uc3QgSEFTX05PUk1BTE1BUCA9ICEhIG1hdGVyaWFsLm5vcm1hbE1hcDsKCQkJY29uc3QgSEFTX0RJU1BMQUNFTUVOVE1BUCA9ICEhIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQkJY29uc3QgSEFTX0VNSVNTSVZFTUFQID0gISEgbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQljb25zdCBIQVNfTUVUQUxORVNTTUFQID0gISEgbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwoJCQljb25zdCBIQVNfUk9VR0hORVNTTUFQID0gISEgbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQkJY29uc3QgSEFTX0FOSVNPVFJPUFkgPSBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMDsKCQkJY29uc3QgSEFTX0NMRUFSQ09BVCA9IG1hdGVyaWFsLmNsZWFyY29hdCA+IDA7CgkJCWNvbnN0IEhBU19ESVNQRVJTSU9OID0gbWF0ZXJpYWwuZGlzcGVyc2lvbiA+IDA7CgkJCWNvbnN0IEhBU19JUklERVNDRU5DRSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMDsKCQkJY29uc3QgSEFTX1NIRUVOID0gbWF0ZXJpYWwuc2hlZW4gPiAwOwoJCQljb25zdCBIQVNfVFJBTlNNSVNTSU9OID0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMDsKCgkJCWNvbnN0IEhBU19BTklTT1RST1BZTUFQID0gSEFTX0FOSVNPVFJPUFkgJiYgISEgbWF0ZXJpYWwuYW5pc290cm9weU1hcDsKCgkJCWNvbnN0IEhBU19DTEVBUkNPQVRNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdE1hcDsKCQkJY29uc3QgSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKCQkJY29uc3QgSEFTX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJCWNvbnN0IEhBU19JUklERVNDRU5DRU1BUCA9IEhBU19JUklERVNDRU5DRSAmJiAhISBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcDsKCQkJY29uc3QgSEFTX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCA9IEhBU19JUklERVNDRU5DRSAmJiAhISBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcDsKCgkJCWNvbnN0IEhBU19TSEVFTl9DT0xPUk1BUCA9IEhBU19TSEVFTiAmJiAhISBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoJCQljb25zdCBIQVNfU0hFRU5fUk9VR0hORVNTTUFQID0gSEFTX1NIRUVOICYmICEhIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKCQkJY29uc3QgSEFTX1NQRUNVTEFSTUFQID0gISEgbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CgkJCWNvbnN0IEhBU19TUEVDVUxBUl9DT0xPUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXA7CgkJCWNvbnN0IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAgPSAhISBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcDsKCgkJCWNvbnN0IEhBU19UUkFOU01JU1NJT05NQVAgPSBIQVNfVFJBTlNNSVNTSU9OICYmICEhIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKCQkJY29uc3QgSEFTX1RISUNLTkVTU01BUCA9IEhBU19UUkFOU01JU1NJT04gJiYgISEgbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKCQkJY29uc3QgSEFTX0dSQURJRU5UTUFQID0gISEgbWF0ZXJpYWwuZ3JhZGllbnRNYXA7CgoJCQljb25zdCBIQVNfQUxQSEFNQVAgPSAhISBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCWNvbnN0IEhBU19BTFBIQVRFU1QgPSBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwOwoKCQkJY29uc3QgSEFTX0FMUEhBSEFTSCA9ICEhIG1hdGVyaWFsLmFscGhhSGFzaDsKCgkJCWNvbnN0IEhBU19FWFRFTlNJT05TID0gISEgbWF0ZXJpYWwuZXh0ZW5zaW9uczsKCgkJCWxldCB0b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQlpZiAoIG1hdGVyaWFsLnRvbmVNYXBwZWQgKSB7CgoJCQkJaWYgKCBjdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IGN1cnJlbnRSZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApIHsKCgkJCQkJdG9uZU1hcHBpbmcgPSByZW5kZXJlci50b25lTWFwcGluZzsKCgkJCQl9CgoJCQl9CgoJCQljb25zdCBwYXJhbWV0ZXJzID0gewoKCQkJCXNoYWRlcklEOiBzaGFkZXJJRCwKCQkJCXNoYWRlclR5cGU6IG1hdGVyaWFsLnR5cGUsCgkJCQlzaGFkZXJOYW1lOiBtYXRlcmlhbC5uYW1lLAoKCQkJCXZlcnRleFNoYWRlcjogdmVydGV4U2hhZGVyLAoJCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50U2hhZGVyLAoJCQkJZGVmaW5lczogbWF0ZXJpYWwuZGVmaW5lcywKCgkJCQljdXN0b21WZXJ0ZXhTaGFkZXJJRDogY3VzdG9tVmVydGV4U2hhZGVySUQsCgkJCQljdXN0b21GcmFnbWVudFNoYWRlcklEOiBjdXN0b21GcmFnbWVudFNoYWRlcklELAoKCQkJCWlzUmF3U2hhZGVyTWF0ZXJpYWw6IG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgPT09IHRydWUsCgkJCQlnbHNsVmVyc2lvbjogbWF0ZXJpYWwuZ2xzbFZlcnNpb24sCgoJCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgoJCQkJYmF0Y2hpbmc6IElTX0JBVENIRURNRVNILAoJCQkJYmF0Y2hpbmdDb2xvcjogSVNfQkFUQ0hFRE1FU0ggJiYgb2JqZWN0Ll9jb2xvcnNUZXh0dXJlICE9PSBudWxsLAoJCQkJaW5zdGFuY2luZzogSVNfSU5TVEFOQ0VETUVTSCwKCQkJCWluc3RhbmNpbmdDb2xvcjogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCwKCQkJCWluc3RhbmNpbmdNb3JwaDogSVNfSU5TVEFOQ0VETUVTSCAmJiBvYmplY3QubW9ycGhUZXh0dXJlICE9PSBudWxsLAoKCQkJCXN1cHBvcnRzVmVydGV4VGV4dHVyZXM6IFNVUFBPUlRTX1ZFUlRFWF9URVhUVVJFUywKCQkJCW91dHB1dENvbG9yU3BhY2U6ICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApID8gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSA6ICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlID8gY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApLAoJCQkJYWxwaGFUb0NvdmVyYWdlOiAhISBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UsCgoJCQkJbWFwOiBIQVNfTUFQLAoJCQkJbWF0Y2FwOiBIQVNfTUFUQ0FQLAoJCQkJZW52TWFwOiBIQVNfRU5WTUFQLAoJCQkJZW52TWFwTW9kZTogSEFTX0VOVk1BUCAmJiBlbnZNYXAubWFwcGluZywKCQkJCWVudk1hcEN1YmVVVkhlaWdodDogZW52TWFwQ3ViZVVWSGVpZ2h0LAoJCQkJYW9NYXA6IEhBU19BT01BUCwKCQkJCWxpZ2h0TWFwOiBIQVNfTElHSFRNQVAsCgkJCQlidW1wTWFwOiBIQVNfQlVNUE1BUCwKCQkJCW5vcm1hbE1hcDogSEFTX05PUk1BTE1BUCwKCQkJCWRpc3BsYWNlbWVudE1hcDogU1VQUE9SVFNfVkVSVEVYX1RFWFRVUkVTICYmIEhBU19ESVNQTEFDRU1FTlRNQVAsCgkJCQllbWlzc2l2ZU1hcDogSEFTX0VNSVNTSVZFTUFQLAoKCQkJCW5vcm1hbE1hcE9iamVjdFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IE9iamVjdFNwYWNlTm9ybWFsTWFwLAoJCQkJbm9ybWFsTWFwVGFuZ2VudFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCwKCgkJCQltZXRhbG5lc3NNYXA6IEhBU19NRVRBTE5FU1NNQVAsCgkJCQlyb3VnaG5lc3NNYXA6IEhBU19ST1VHSE5FU1NNQVAsCgoJCQkJYW5pc290cm9weTogSEFTX0FOSVNPVFJPUFksCgkJCQlhbmlzb3Ryb3B5TWFwOiBIQVNfQU5JU09UUk9QWU1BUCwKCgkJCQljbGVhcmNvYXQ6IEhBU19DTEVBUkNPQVQsCgkJCQljbGVhcmNvYXRNYXA6IEhBU19DTEVBUkNPQVRNQVAsCgkJCQljbGVhcmNvYXROb3JtYWxNYXA6IEhBU19DTEVBUkNPQVRfTk9STUFMTUFQLAoJCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwOiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCwKCgkJCQlkaXNwZXJzaW9uOiBIQVNfRElTUEVSU0lPTiwKCgkJCQlpcmlkZXNjZW5jZTogSEFTX0lSSURFU0NFTkNFLAoJCQkJaXJpZGVzY2VuY2VNYXA6IEhBU19JUklERVNDRU5DRU1BUCwKCQkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQLAoKCQkJCXNoZWVuOiBIQVNfU0hFRU4sCgkJCQlzaGVlbkNvbG9yTWFwOiBIQVNfU0hFRU5fQ09MT1JNQVAsCgkJCQlzaGVlblJvdWdobmVzc01hcDogSEFTX1NIRUVOX1JPVUdITkVTU01BUCwKCgkJCQlzcGVjdWxhck1hcDogSEFTX1NQRUNVTEFSTUFQLAoJCQkJc3BlY3VsYXJDb2xvck1hcDogSEFTX1NQRUNVTEFSX0NPTE9STUFQLAoJCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXA6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAsCgoJCQkJdHJhbnNtaXNzaW9uOiBIQVNfVFJBTlNNSVNTSU9OLAoJCQkJdHJhbnNtaXNzaW9uTWFwOiBIQVNfVFJBTlNNSVNTSU9OTUFQLAoJCQkJdGhpY2tuZXNzTWFwOiBIQVNfVEhJQ0tORVNTTUFQLAoKCQkJCWdyYWRpZW50TWFwOiBIQVNfR1JBRElFTlRNQVAsCgoJCQkJb3BhcXVlOiBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gZmFsc2UgJiYgbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gZmFsc2UsCgoJCQkJYWxwaGFNYXA6IEhBU19BTFBIQU1BUCwKCQkJCWFscGhhVGVzdDogSEFTX0FMUEhBVEVTVCwKCQkJCWFscGhhSGFzaDogSEFTX0FMUEhBSEFTSCwKCgkJCQljb21iaW5lOiBtYXRlcmlhbC5jb21iaW5lLAoKCQkJCS8vCgoJCQkJbWFwVXY6IEhBU19NQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubWFwLmNoYW5uZWwgKSwKCQkJCWFvTWFwVXY6IEhBU19BT01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5hb01hcC5jaGFubmVsICksCgkJCQlsaWdodE1hcFV2OiBIQVNfTElHSFRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubGlnaHRNYXAuY2hhbm5lbCApLAoJCQkJYnVtcE1hcFV2OiBIQVNfQlVNUE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5idW1wTWFwLmNoYW5uZWwgKSwKCQkJCW5vcm1hbE1hcFV2OiBIQVNfTk9STUFMTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLm5vcm1hbE1hcC5jaGFubmVsICksCgkJCQlkaXNwbGFjZW1lbnRNYXBVdjogSEFTX0RJU1BMQUNFTUVOVE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAuY2hhbm5lbCApLAoJCQkJZW1pc3NpdmVNYXBVdjogSEFTX0VNSVNTSVZFTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmNoYW5uZWwgKSwKCgkJCQltZXRhbG5lc3NNYXBVdjogSEFTX01FVEFMTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAuY2hhbm5lbCApLAoJCQkJcm91Z2huZXNzTWFwVXY6IEhBU19ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwucm91Z2huZXNzTWFwLmNoYW5uZWwgKSwKCgkJCQlhbmlzb3Ryb3B5TWFwVXY6IEhBU19BTklTT1RST1BZTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAuY2hhbm5lbCApLAoKCQkJCWNsZWFyY29hdE1hcFV2OiBIQVNfQ0xFQVJDT0FUTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmNsZWFyY29hdE1hcC5jaGFubmVsICksCgkJCQljbGVhcmNvYXROb3JtYWxNYXBVdjogSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwLmNoYW5uZWwgKSwKCQkJCWNsZWFyY29hdFJvdWdobmVzc01hcFV2OiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKCQkJCWlyaWRlc2NlbmNlTWFwVXY6IEhBU19JUklERVNDRU5DRU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcC5jaGFubmVsICksCgkJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2OiBIQVNfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLmNoYW5uZWwgKSwKCgkJCQlzaGVlbkNvbG9yTWFwVXY6IEhBU19TSEVFTl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwLmNoYW5uZWwgKSwKCQkJCXNoZWVuUm91Z2huZXNzTWFwVXY6IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKCQkJCXNwZWN1bGFyTWFwVXY6IEhBU19TUEVDVUxBUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhck1hcC5jaGFubmVsICksCgkJCQlzcGVjdWxhckNvbG9yTWFwVXY6IEhBU19TUEVDVUxBUl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLmNoYW5uZWwgKSwKCQkJCXNwZWN1bGFySW50ZW5zaXR5TWFwVXY6IEhBU19TUEVDVUxBUl9JTlRFTlNJVFlNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAuY2hhbm5lbCApLAoKCQkJCXRyYW5zbWlzc2lvbk1hcFV2OiBIQVNfVFJBTlNNSVNTSU9OTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcC5jaGFubmVsICksCgkJCQl0aGlja25lc3NNYXBVdjogSEFTX1RISUNLTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC50aGlja25lc3NNYXAuY2hhbm5lbCApLAoKCQkJCWFscGhhTWFwVXY6IEhBU19BTFBIQU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5hbHBoYU1hcC5jaGFubmVsICksCgoJCQkJLy8KCgkJCQl2ZXJ0ZXhUYW5nZW50czogISEgZ2VvbWV0cnkuYXR0cmlidXRlcy50YW5nZW50ICYmICggSEFTX05PUk1BTE1BUCB8fCBIQVNfQU5JU09UUk9QWSApLAoJCQkJdmVydGV4Q29sb3JzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMsCgkJCQl2ZXJ0ZXhBbHBoYXM6IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQsCgoJCQkJcG9pbnRzVXZzOiBvYmplY3QuaXNQb2ludHMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy51diAmJiAoIEhBU19NQVAgfHwgSEFTX0FMUEhBTUFQICksCgoJCQkJZm9nOiAhISBmb2csCgkJCQl1c2VGb2c6IG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSwKCQkJCWZvZ0V4cDI6ICggISEgZm9nICYmIGZvZy5pc0ZvZ0V4cDIgKSwKCgkJCQlmbGF0U2hhZGluZzogKCBtYXRlcmlhbC5mbGF0U2hhZGluZyA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC53aXJlZnJhbWUgPT09IGZhbHNlICksCgoJCQkJc2l6ZUF0dGVudWF0aW9uOiBtYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPT09IHRydWUsCgkJCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoJCQkJcmV2ZXJzZURlcHRoQnVmZmVyOiByZXZlcnNlRGVwdGhCdWZmZXIsCgoJCQkJc2tpbm5pbmc6IG9iamVjdC5pc1NraW5uZWRNZXNoID09PSB0cnVlLAoKCQkJCW1vcnBoVGFyZ2V0czogZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQsCgkJCQltb3JwaE5vcm1hbHM6IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCwKCQkJCW1vcnBoQ29sb3JzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCwKCQkJCW1vcnBoVGFyZ2V0c0NvdW50OiBtb3JwaFRhcmdldHNDb3VudCwKCQkJCW1vcnBoVGV4dHVyZVN0cmlkZTogbW9ycGhUZXh0dXJlU3RyaWRlLAoKCQkJCW51bURpckxpZ2h0czogbGlnaHRzLmRpcmVjdGlvbmFsLmxlbmd0aCwKCQkJCW51bVBvaW50TGlnaHRzOiBsaWdodHMucG9pbnQubGVuZ3RoLAoJCQkJbnVtU3BvdExpZ2h0czogbGlnaHRzLnNwb3QubGVuZ3RoLAoJCQkJbnVtU3BvdExpZ2h0TWFwczogbGlnaHRzLnNwb3RMaWdodE1hcC5sZW5ndGgsCgkJCQludW1SZWN0QXJlYUxpZ2h0czogbGlnaHRzLnJlY3RBcmVhLmxlbmd0aCwKCQkJCW51bUhlbWlMaWdodHM6IGxpZ2h0cy5oZW1pLmxlbmd0aCwKCgkJCQludW1EaXJMaWdodFNoYWRvd3M6IGxpZ2h0cy5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGgsCgkJCQludW1Qb2ludExpZ2h0U2hhZG93czogbGlnaHRzLnBvaW50U2hhZG93TWFwLmxlbmd0aCwKCQkJCW51bVNwb3RMaWdodFNoYWRvd3M6IGxpZ2h0cy5zcG90U2hhZG93TWFwLmxlbmd0aCwKCQkJCW51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwczogbGlnaHRzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcywKCgkJCQludW1MaWdodFByb2JlczogbGlnaHRzLm51bUxpZ2h0UHJvYmVzLAoKCQkJCW51bUNsaXBwaW5nUGxhbmVzOiBjbGlwcGluZy5udW1QbGFuZXMsCgkJCQludW1DbGlwSW50ZXJzZWN0aW9uOiBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24sCgoJCQkJZGl0aGVyaW5nOiBtYXRlcmlhbC5kaXRoZXJpbmcsCgoJCQkJc2hhZG93TWFwRW5hYmxlZDogcmVuZGVyZXIuc2hhZG93TWFwLmVuYWJsZWQgJiYgc2hhZG93cy5sZW5ndGggPiAwLAoJCQkJc2hhZG93TWFwVHlwZTogcmVuZGVyZXIuc2hhZG93TWFwLnR5cGUsCgoJCQkJdG9uZU1hcHBpbmc6IHRvbmVNYXBwaW5nLAoKCQkJCWRlY29kZVZpZGVvVGV4dHVyZTogSEFTX01BUCAmJiAoIG1hdGVyaWFsLm1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5tYXAuY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSwKCQkJCWRlY29kZVZpZGVvVGV4dHVyZUVtaXNzaXZlOiBIQVNfRU1JU1NJVkVNQVAgJiYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcC5jb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApLAoKCQkJCXByZW11bHRpcGxpZWRBbHBoYTogbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhLAoKCQkJCWRvdWJsZVNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlLAoJCQkJZmxpcFNpZGVkOiBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSwKCgkJCQl1c2VEZXB0aFBhY2tpbmc6IG1hdGVyaWFsLmRlcHRoUGFja2luZyA+PSAwLAoJCQkJZGVwdGhQYWNraW5nOiBtYXRlcmlhbC5kZXB0aFBhY2tpbmcgfHwgMCwKCgkJCQlpbmRleDBBdHRyaWJ1dGVOYW1lOiBtYXRlcmlhbC5pbmRleDBBdHRyaWJ1dGVOYW1lLAoKCQkJCWV4dGVuc2lvbkNsaXBDdWxsRGlzdGFuY2U6IEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuY2xpcEN1bGxEaXN0YW5jZSA9PT0gdHJ1ZSAmJiBleHRlbnNpb25zLmhhcyggJ1dFQkdMX2NsaXBfY3VsbF9kaXN0YW5jZScgKSwKCQkJCWV4dGVuc2lvbk11bHRpRHJhdzogKCBIQVNfRVhURU5TSU9OUyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLm11bHRpRHJhdyA9PT0gdHJ1ZSB8fCBJU19CQVRDSEVETUVTSCApICYmIGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlfZHJhdycgKSwKCgkJCQlyZW5kZXJlckV4dGVuc2lvblBhcmFsbGVsU2hhZGVyQ29tcGlsZTogZXh0ZW5zaW9ucy5oYXMoICdLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUnICksCgoJCQkJY3VzdG9tUHJvZ3JhbUNhY2hlS2V5OiBtYXRlcmlhbC5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkoKQoKCQkJfTsKCgkJCS8vIHRoZSB1c2FnZSBvZiBnZXRDaGFubmVsKCkgZGV0ZXJtaW5lcyB0aGUgYWN0aXZlIHRleHR1cmUgY2hhbm5lbHMgZm9yIHRoaXMgc2hhZGVyCgoJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPSBfYWN0aXZlQ2hhbm5lbHMuaGFzKCAxICk7CgkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA9IF9hY3RpdmVDaGFubmVscy5oYXMoIDIgKTsKCQkJcGFyYW1ldGVycy52ZXJ0ZXhVdjNzID0gX2FjdGl2ZUNoYW5uZWxzLmhhcyggMyApOwoKCQkJX2FjdGl2ZUNoYW5uZWxzLmNsZWFyKCk7CgoJCQlyZXR1cm4gcGFyYW1ldGVyczsKCgkJfQoKCQlmdW5jdGlvbiBnZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKSB7CgoJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRlcklEICkgewoKCQkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hhZGVySUQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21WZXJ0ZXhTaGFkZXJJRCApOwoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21GcmFnbWVudFNoYWRlcklEICk7CgoJCQl9CgoJCQlpZiAoIHBhcmFtZXRlcnMuZGVmaW5lcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWZvciAoIGNvbnN0IG5hbWUgaW4gcGFyYW1ldGVycy5kZWZpbmVzICkgewoKCQkJCQlhcnJheS5wdXNoKCBuYW1lICk7CgkJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZWZpbmVzWyBuYW1lIF0gKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gZmFsc2UgKSB7CgoJCQkJZ2V0UHJvZ3JhbUNhY2hlS2V5UGFyYW1ldGVycyggYXJyYXksIHBhcmFtZXRlcnMgKTsKCQkJCWdldFByb2dyYW1DYWNoZUtleUJvb2xlYW5zKCBhcnJheSwgcGFyYW1ldGVycyApOwoJCQkJYXJyYXkucHVzaCggcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSApOwoKCQkJfQoKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21Qcm9ncmFtQ2FjaGVLZXkgKTsKCgkJCXJldHVybiBhcnJheS5qb2luKCk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0UHJvZ3JhbUNhY2hlS2V5UGFyYW1ldGVycyggYXJyYXksIHBhcmFtZXRlcnMgKSB7CgoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm91dHB1dENvbG9yU3BhY2UgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5lbnZNYXBNb2RlICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWSGVpZ2h0ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5hbHBoYU1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubGlnaHRNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmFvTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5idW1wTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5ub3JtYWxNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRpc3BsYWNlbWVudE1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMucm91Z2huZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jbGVhcmNvYXRNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zcGVjdWxhck1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJDb2xvck1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcFV2ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudGhpY2tuZXNzTWFwVXYgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jb21iaW5lICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZm9nRXhwMiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNpemVBdHRlbnVhdGlvbiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubW9ycGhBdHRyaWJ1dGVDb3VudCApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0cyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRzICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0cyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodE1hcHMgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1IZW1pTGlnaHRzICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtUmVjdEFyZWFMaWdodHMgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1EaXJMaWdodFNoYWRvd3MgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1MaWdodFByb2JlcyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgKTsKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy50b25lTWFwcGluZyApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICk7CgkJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbiApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmRlcHRoUGFja2luZyApOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleUJvb2xlYW5zKCBhcnJheSwgcGFyYW1ldGVycyApIHsKCgkJCV9wcm9ncmFtTGF5ZXJzLmRpc2FibGVBbGwoKTsKCgkJCWlmICggcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvciApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmdNb3JwaCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDMgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLm1hdGNhcCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDQgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLm5vcm1hbE1hcE9iamVjdFNwYWNlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNiApOwoJCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNyApOwoJCQlpZiAoIHBhcmFtZXRlcnMuY2xlYXJjb2F0ICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuaXJpZGVzY2VuY2UgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA5ICk7CgkJCWlmICggcGFyYW1ldGVycy5hbHBoYVRlc3QgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4Q29sb3JzICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTEgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleEFscGhhcyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEyICk7CgkJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjFzICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTMgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleFV2MnMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4VXYzcyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE1ICk7CgkJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE2ICk7CgkJCWlmICggcGFyYW1ldGVycy5hbmlzb3Ryb3B5ICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhSGFzaCApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE4ICk7CgkJCWlmICggcGFyYW1ldGVycy5iYXRjaGluZyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE5ICk7CgkJCWlmICggcGFyYW1ldGVycy5kaXNwZXJzaW9uICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjAgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmJhdGNoaW5nQ29sb3IgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMSApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZ3JhZGllbnRNYXAgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyMiApOwoKCQkJYXJyYXkucHVzaCggX3Byb2dyYW1MYXllcnMubWFzayApOwoJCQlfcHJvZ3JhbUxheWVycy5kaXNhYmxlQWxsKCk7CgoJCQlpZiAoIHBhcmFtZXRlcnMuZm9nICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudXNlRm9nICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMSApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAyICk7CgkJCWlmICggcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMyApOwoJCQlpZiAoIHBhcmFtZXRlcnMucmV2ZXJzZURlcHRoQnVmZmVyICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuc2tpbm5pbmcgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA1ICk7CgkJCWlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA2ICk7CgkJCWlmICggcGFyYW1ldGVycy5tb3JwaE5vcm1hbHMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CgkJCWlmICggcGFyYW1ldGVycy5tb3JwaENvbG9ycyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDggKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDkgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMSApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZmxpcFNpZGVkICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTIgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnVzZURlcHRoUGFja2luZyApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEzICk7CgkJCWlmICggcGFyYW1ldGVycy5kaXRoZXJpbmcgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwoJCQlpZiAoIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTUgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLnNoZWVuICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTYgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLm9wYXF1ZSApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE3ICk7CgkJCWlmICggcGFyYW1ldGVycy5wb2ludHNVdnMgKQoJCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOCApOwoJCQlpZiAoIHBhcmFtZXRlcnMuZGVjb2RlVmlkZW9UZXh0dXJlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTkgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmRlY29kZVZpZGVvVGV4dHVyZUVtaXNzaXZlICkKCQkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMjAgKTsKCQkJaWYgKCBwYXJhbWV0ZXJzLmFscGhhVG9Db3ZlcmFnZSApCgkJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIxICk7CgoJCQlhcnJheS5wdXNoKCBfcHJvZ3JhbUxheWVycy5tYXNrICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICkgewoKCQkJY29uc3Qgc2hhZGVySUQgPSBzaGFkZXJJRHNbIG1hdGVyaWFsLnR5cGUgXTsKCQkJbGV0IHVuaWZvcm1zOwoKCQkJaWYgKCBzaGFkZXJJRCApIHsKCgkJCQljb25zdCBzaGFkZXIgPSBTaGFkZXJMaWJbIHNoYWRlcklEIF07CgkJCQl1bmlmb3JtcyA9IFVuaWZvcm1zVXRpbHMuY2xvbmUoIHNoYWRlci51bmlmb3JtcyApOwoKCQkJfSBlbHNlIHsKCgkJCQl1bmlmb3JtcyA9IG1hdGVyaWFsLnVuaWZvcm1zOwoKCQkJfQoKCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQl9CgoJCWZ1bmN0aW9uIGFjcXVpcmVQcm9ncmFtKCBwYXJhbWV0ZXJzLCBjYWNoZUtleSApIHsKCgkJCWxldCBwcm9ncmFtOwoKCQkJLy8gQ2hlY2sgaWYgY29kZSBoYXMgYmVlbiBhbHJlYWR5IGNvbXBpbGVkCgkJCWZvciAoIGxldCBwID0gMCwgcGwgPSBwcm9ncmFtcy5sZW5ndGg7IHAgPCBwbDsgcCArKyApIHsKCgkJCQljb25zdCBwcmVleGlzdGluZ1Byb2dyYW0gPSBwcm9ncmFtc1sgcCBdOwoKCQkJCWlmICggcHJlZXhpc3RpbmdQcm9ncmFtLmNhY2hlS2V5ID09PSBjYWNoZUtleSApIHsKCgkJCQkJcHJvZ3JhbSA9IHByZWV4aXN0aW5nUHJvZ3JhbTsKCQkJCQkrKyBwcm9ncmFtLnVzZWRUaW1lczsKCgkJCQkJYnJlYWs7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBwcm9ncmFtID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJvZ3JhbSA9IG5ldyBXZWJHTFByb2dyYW0oIHJlbmRlcmVyLCBjYWNoZUtleSwgcGFyYW1ldGVycywgYmluZGluZ1N0YXRlcyApOwoJCQkJcHJvZ3JhbXMucHVzaCggcHJvZ3JhbSApOwoKCQkJfQoKCQkJcmV0dXJuIHByb2dyYW07CgoJCX0KCgkJZnVuY3Rpb24gcmVsZWFzZVByb2dyYW0oIHByb2dyYW0gKSB7CgoJCQlpZiAoIC0tIHByb2dyYW0udXNlZFRpbWVzID09PSAwICkgewoKCQkJCS8vIFJlbW92ZSBmcm9tIHVub3JkZXJlZCBzZXQKCQkJCWNvbnN0IGkgPSBwcm9ncmFtcy5pbmRleE9mKCBwcm9ncmFtICk7CgkJCQlwcm9ncmFtc1sgaSBdID0gcHJvZ3JhbXNbIHByb2dyYW1zLmxlbmd0aCAtIDEgXTsKCQkJCXByb2dyYW1zLnBvcCgpOwoKCQkJCS8vIEZyZWUgV2ViR0wgcmVzb3VyY2VzCgkJCQlwcm9ncmFtLmRlc3Ryb3koKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWxlYXNlU2hhZGVyQ2FjaGUoIG1hdGVyaWFsICkgewoKCQkJX2N1c3RvbVNoYWRlcnMucmVtb3ZlKCBtYXRlcmlhbCApOwoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQlfY3VzdG9tU2hhZGVycy5kaXNwb3NlKCk7CgoJCX0KCgkJcmV0dXJuIHsKCQkJZ2V0UGFyYW1ldGVyczogZ2V0UGFyYW1ldGVycywKCQkJZ2V0UHJvZ3JhbUNhY2hlS2V5OiBnZXRQcm9ncmFtQ2FjaGVLZXksCgkJCWdldFVuaWZvcm1zOiBnZXRVbmlmb3JtcywKCQkJYWNxdWlyZVByb2dyYW06IGFjcXVpcmVQcm9ncmFtLAoJCQlyZWxlYXNlUHJvZ3JhbTogcmVsZWFzZVByb2dyYW0sCgkJCXJlbGVhc2VTaGFkZXJDYWNoZTogcmVsZWFzZVNoYWRlckNhY2hlLAoJCQkvLyBFeHBvc2VkIGZvciByZXNvdXJjZSBtb25pdG9yaW5nICYgZXJyb3IgZmVlZGJhY2sgdmlhIHJlbmRlcmVyLmluZm86CgkJCXByb2dyYW1zOiBwcm9ncmFtcywKCQkJZGlzcG9zZTogZGlzcG9zZQoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMUHJvcGVydGllcygpIHsKCgkJbGV0IHByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCQlmdW5jdGlvbiBoYXMoIG9iamVjdCApIHsKCgkJCXJldHVybiBwcm9wZXJ0aWVzLmhhcyggb2JqZWN0ICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0KCBvYmplY3QgKSB7CgoJCQlsZXQgbWFwID0gcHJvcGVydGllcy5nZXQoIG9iamVjdCApOwoKCQkJaWYgKCBtYXAgPT09IHVuZGVmaW5lZCApIHsKCgkJCQltYXAgPSB7fTsKCQkJCXByb3BlcnRpZXMuc2V0KCBvYmplY3QsIG1hcCApOwoKCQkJfQoKCQkJcmV0dXJuIG1hcDsKCgkJfQoKCQlmdW5jdGlvbiByZW1vdmUoIG9iamVjdCApIHsKCgkJCXByb3BlcnRpZXMuZGVsZXRlKCBvYmplY3QgKTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwga2V5LCB2YWx1ZSApIHsKCgkJCXByb3BlcnRpZXMuZ2V0KCBvYmplY3QgKVsga2V5IF0gPSB2YWx1ZTsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJcHJvcGVydGllcyA9IG5ldyBXZWFrTWFwKCk7CgoJCX0KCgkJcmV0dXJuIHsKCQkJaGFzOiBoYXMsCgkJCWdldDogZ2V0LAoJCQlyZW1vdmU6IHJlbW92ZSwKCQkJdXBkYXRlOiB1cGRhdGUsCgkJCWRpc3Bvc2U6IGRpc3Bvc2UKCQl9OwoKCX0KCglmdW5jdGlvbiBwYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCgkJaWYgKCBhLmdyb3VwT3JkZXIgIT09IGIuZ3JvdXBPcmRlciApIHsKCgkJCXJldHVybiBhLmdyb3VwT3JkZXIgLSBiLmdyb3VwT3JkZXI7CgoJCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCQlyZXR1cm4gYS5yZW5kZXJPcmRlciAtIGIucmVuZGVyT3JkZXI7CgoJCX0gZWxzZSBpZiAoIGEubWF0ZXJpYWwuaWQgIT09IGIubWF0ZXJpYWwuaWQgKSB7CgoJCQlyZXR1cm4gYS5tYXRlcmlhbC5pZCAtIGIubWF0ZXJpYWwuaWQ7CgoJCX0gZWxzZSBpZiAoIGEueiAhPT0gYi56ICkgewoKCQkJcmV0dXJuIGEueiAtIGIuejsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBhLmlkIC0gYi5pZDsKCgkJfQoKCX0KCglmdW5jdGlvbiByZXZlcnNlUGFpbnRlclNvcnRTdGFibGUoIGEsIGIgKSB7CgoJCWlmICggYS5ncm91cE9yZGVyICE9PSBiLmdyb3VwT3JkZXIgKSB7CgoJCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCQl9IGVsc2UgaWYgKCBhLnJlbmRlck9yZGVyICE9PSBiLnJlbmRlck9yZGVyICkgewoKCQkJcmV0dXJuIGEucmVuZGVyT3JkZXIgLSBiLnJlbmRlck9yZGVyOwoKCQl9IGVsc2UgaWYgKCBhLnogIT09IGIueiApIHsKCgkJCXJldHVybiBiLnogLSBhLno7CgoJCX0gZWxzZSB7CgoJCQlyZXR1cm4gYS5pZCAtIGIuaWQ7CgoJCX0KCgl9CgoKCWZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdCgpIHsKCgkJY29uc3QgcmVuZGVySXRlbXMgPSBbXTsKCQlsZXQgcmVuZGVySXRlbXNJbmRleCA9IDA7CgoJCWNvbnN0IG9wYXF1ZSA9IFtdOwoJCWNvbnN0IHRyYW5zbWlzc2l2ZSA9IFtdOwoJCWNvbnN0IHRyYW5zcGFyZW50ID0gW107CgoJCWZ1bmN0aW9uIGluaXQoKSB7CgoJCQlyZW5kZXJJdGVtc0luZGV4ID0gMDsKCgkJCW9wYXF1ZS5sZW5ndGggPSAwOwoJCQl0cmFuc21pc3NpdmUubGVuZ3RoID0gMDsKCQkJdHJhbnNwYXJlbnQubGVuZ3RoID0gMDsKCgkJfQoKCQlmdW5jdGlvbiBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQkJbGV0IHJlbmRlckl0ZW0gPSByZW5kZXJJdGVtc1sgcmVuZGVySXRlbXNJbmRleCBdOwoKCQkJaWYgKCByZW5kZXJJdGVtID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcmVuZGVySXRlbSA9IHsKCQkJCQlpZDogb2JqZWN0LmlkLAoJCQkJCW9iamVjdDogb2JqZWN0LAoJCQkJCWdlb21ldHJ5OiBnZW9tZXRyeSwKCQkJCQltYXRlcmlhbDogbWF0ZXJpYWwsCgkJCQkJZ3JvdXBPcmRlcjogZ3JvdXBPcmRlciwKCQkJCQlyZW5kZXJPcmRlcjogb2JqZWN0LnJlbmRlck9yZGVyLAoJCQkJCXo6IHosCgkJCQkJZ3JvdXA6IGdyb3VwCgkJCQl9OwoKCQkJCXJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF0gPSByZW5kZXJJdGVtOwoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwoJCQkJcmVuZGVySXRlbS5vYmplY3QgPSBvYmplY3Q7CgkJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gZ2VvbWV0cnk7CgkJCQlyZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgkJCQlyZW5kZXJJdGVtLmdyb3VwT3JkZXIgPSBncm91cE9yZGVyOwoJCQkJcmVuZGVySXRlbS5yZW5kZXJPcmRlciA9IG9iamVjdC5yZW5kZXJPcmRlcjsKCQkJCXJlbmRlckl0ZW0ueiA9IHo7CgkJCQlyZW5kZXJJdGVtLmdyb3VwID0gZ3JvdXA7CgoJCQl9CgoJCQlyZW5kZXJJdGVtc0luZGV4ICsrOwoKCQkJcmV0dXJuIHJlbmRlckl0ZW07CgoJCX0KCgkJZnVuY3Rpb24gcHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQkJY29uc3QgcmVuZGVySXRlbSA9IGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKTsKCgkJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKCQkJCXRyYW5zbWlzc2l2ZS5wdXNoKCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIHsKCgkJCQl0cmFuc3BhcmVudC5wdXNoKCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgewoKCQkJCW9wYXF1ZS5wdXNoKCByZW5kZXJJdGVtICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdW5zaGlmdCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQkJY29uc3QgcmVuZGVySXRlbSA9IGdldE5leHRSZW5kZXJJdGVtKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKTsKCgkJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKCQkJCXRyYW5zbWlzc2l2ZS51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSApIHsKCgkJCQl0cmFuc3BhcmVudC51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCQl9IGVsc2UgewoKCQkJCW9wYXF1ZS51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc29ydCggY3VzdG9tT3BhcXVlU29ydCwgY3VzdG9tVHJhbnNwYXJlbnRTb3J0ICkgewoKCQkJaWYgKCBvcGFxdWUubGVuZ3RoID4gMSApIG9wYXF1ZS5zb3J0KCBjdXN0b21PcGFxdWVTb3J0IHx8IHBhaW50ZXJTb3J0U3RhYmxlICk7CgkJCWlmICggdHJhbnNtaXNzaXZlLmxlbmd0aCA+IDEgKSB0cmFuc21pc3NpdmUuc29ydCggY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSApOwoJCQlpZiAoIHRyYW5zcGFyZW50Lmxlbmd0aCA+IDEgKSB0cmFuc3BhcmVudC5zb3J0KCBjdXN0b21UcmFuc3BhcmVudFNvcnQgfHwgcmV2ZXJzZVBhaW50ZXJTb3J0U3RhYmxlICk7CgoJCX0KCgkJZnVuY3Rpb24gZmluaXNoKCkgewoKCQkJLy8gQ2xlYXIgcmVmZXJlbmNlcyBmcm9tIGluYWN0aXZlIHJlbmRlckl0ZW1zIGluIHRoZSBsaXN0CgoJCQlmb3IgKCBsZXQgaSA9IHJlbmRlckl0ZW1zSW5kZXgsIGlsID0gcmVuZGVySXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckl0ZW1zWyBpIF07CgoJCQkJaWYgKCByZW5kZXJJdGVtLmlkID09PSBudWxsICkgYnJlYWs7CgoJCQkJcmVuZGVySXRlbS5pZCA9IG51bGw7CgkJCQlyZW5kZXJJdGVtLm9iamVjdCA9IG51bGw7CgkJCQlyZW5kZXJJdGVtLmdlb21ldHJ5ID0gbnVsbDsKCQkJCXJlbmRlckl0ZW0ubWF0ZXJpYWwgPSBudWxsOwoJCQkJcmVuZGVySXRlbS5ncm91cCA9IG51bGw7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCgkJCW9wYXF1ZTogb3BhcXVlLAoJCQl0cmFuc21pc3NpdmU6IHRyYW5zbWlzc2l2ZSwKCQkJdHJhbnNwYXJlbnQ6IHRyYW5zcGFyZW50LAoKCQkJaW5pdDogaW5pdCwKCQkJcHVzaDogcHVzaCwKCQkJdW5zaGlmdDogdW5zaGlmdCwKCQkJZmluaXNoOiBmaW5pc2gsCgoJCQlzb3J0OiBzb3J0CgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0cygpIHsKCgkJbGV0IGxpc3RzID0gbmV3IFdlYWtNYXAoKTsKCgkJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgcmVuZGVyQ2FsbERlcHRoICkgewoKCQkJY29uc3QgbGlzdEFycmF5ID0gbGlzdHMuZ2V0KCBzY2VuZSApOwoJCQlsZXQgbGlzdDsKCgkJCWlmICggbGlzdEFycmF5ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKCQkJCWxpc3RzLnNldCggc2NlbmUsIFsgbGlzdCBdICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IGxpc3RBcnJheS5sZW5ndGggKSB7CgoJCQkJCWxpc3QgPSBuZXcgV2ViR0xSZW5kZXJMaXN0KCk7CgkJCQkJbGlzdEFycmF5LnB1c2goIGxpc3QgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlsaXN0ID0gbGlzdEFycmF5WyByZW5kZXJDYWxsRGVwdGggXTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbGlzdDsKCgkJfQoKCQlmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQkJbGlzdHMgPSBuZXcgV2Vha01hcCgpOwoKCQl9CgoJCXJldHVybiB7CgkJCWdldDogZ2V0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJZnVuY3Rpb24gVW5pZm9ybXNDYWNoZSgpIHsKCgkJY29uc3QgbGlnaHRzID0ge307CgoJCXJldHVybiB7CgoJCQlnZXQ6IGZ1bmN0aW9uICggbGlnaHQgKSB7CgoJCQkJaWYgKCBsaWdodHNbIGxpZ2h0LmlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcmV0dXJuIGxpZ2h0c1sgbGlnaHQuaWQgXTsKCgkJCQl9CgoJCQkJbGV0IHVuaWZvcm1zOwoKCQkJCXN3aXRjaCAoIGxpZ2h0LnR5cGUgKSB7CgoJCQkJCWNhc2UgJ0RpcmVjdGlvbmFsTGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnU3BvdExpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlwb3NpdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWRpcmVjdGlvbjogbmV3IFZlY3RvcjMoKSwKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCWRpc3RhbmNlOiAwLAoJCQkJCQkJY29uZUNvczogMCwKCQkJCQkJCXBlbnVtYnJhQ29zOiAwLAoJCQkJCQkJZGVjYXk6IDAKCQkJCQkJfTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ1BvaW50TGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJY29sb3I6IG5ldyBDb2xvcigpLAoJCQkJCQkJZGlzdGFuY2U6IDAsCgkJCQkJCQlkZWNheTogMAoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnSGVtaXNwaGVyZUxpZ2h0JzoKCQkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCQlkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCQlza3lDb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCQlncm91bmRDb2xvcjogbmV3IENvbG9yKCkKCQkJCQkJfTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ1JlY3RBcmVhTGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJaGFsZldpZHRoOiBuZXcgVmVjdG9yMygpLAoJCQkJCQkJaGFsZkhlaWdodDogbmV3IFZlY3RvcjMoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQl9CgoJCQkJbGlnaHRzWyBsaWdodC5pZCBdID0gdW5pZm9ybXM7CgoJCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQkJfQoKCQl9OwoKCX0KCglmdW5jdGlvbiBTaGFkb3dVbmlmb3Jtc0NhY2hlKCkgewoKCQljb25zdCBsaWdodHMgPSB7fTsKCgkJcmV0dXJuIHsKCgkJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCgkJCQlpZiAoIGxpZ2h0c1sgbGlnaHQuaWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKCQkJCX0KCgkJCQlsZXQgdW5pZm9ybXM7CgoJCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCgkJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CgkJCQkJCXVuaWZvcm1zID0gewoJCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAoJCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCgkJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCgkJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCgkJCQkJCX07CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdTcG90TGlnaHQnOgoJCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJCXNoYWRvd0ludGVuc2l0eTogMSwKCQkJCQkJCXNoYWRvd0JpYXM6IDAsCgkJCQkJCQlzaGFkb3dOb3JtYWxCaWFzOiAwLAoJCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQkJc2hhZG93TWFwU2l6ZTogbmV3IFZlY3RvcjIoKQoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnUG9pbnRMaWdodCc6CgkJCQkJCXVuaWZvcm1zID0gewoJCQkJCQkJc2hhZG93SW50ZW5zaXR5OiAxLAoJCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCgkJCQkJCQlzaGFkb3dSYWRpdXM6IDEsCgkJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAoJCQkJCQkJc2hhZG93Q2FtZXJhTmVhcjogMSwKCQkJCQkJCXNoYWRvd0NhbWVyYUZhcjogMTAwMAoJCQkJCQl9OwoJCQkJCQlicmVhazsKCgkJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IHNldCBSZWN0QXJlYUxpZ2h0IHNoYWRvdyB1bmlmb3JtcwoKCQkJCX0KCgkJCQlsaWdodHNbIGxpZ2h0LmlkIF0gPSB1bmlmb3JtczsKCgkJCQlyZXR1cm4gdW5pZm9ybXM7CgoJCQl9CgoJCX07CgoJfQoKCgoJbGV0IG5leHRWZXJzaW9uID0gMDsKCglmdW5jdGlvbiBzaGFkb3dDYXN0aW5nQW5kVGV4dHVyaW5nTGlnaHRzRmlyc3QoIGxpZ2h0QSwgbGlnaHRCICkgewoKCQlyZXR1cm4gKCBsaWdodEIuY2FzdFNoYWRvdyA/IDIgOiAwICkgLSAoIGxpZ2h0QS5jYXN0U2hhZG93ID8gMiA6IDAgKSArICggbGlnaHRCLm1hcCA/IDEgOiAwICkgLSAoIGxpZ2h0QS5tYXAgPyAxIDogMCApOwoKCX0KCglmdW5jdGlvbiBXZWJHTExpZ2h0cyggZXh0ZW5zaW9ucyApIHsKCgkJY29uc3QgY2FjaGUgPSBuZXcgVW5pZm9ybXNDYWNoZSgpOwoKCQljb25zdCBzaGFkb3dDYWNoZSA9IFNoYWRvd1VuaWZvcm1zQ2FjaGUoKTsKCgkJY29uc3Qgc3RhdGUgPSB7CgoJCQl2ZXJzaW9uOiAwLAoKCQkJaGFzaDogewoJCQkJZGlyZWN0aW9uYWxMZW5ndGg6IC0xLAoJCQkJcG9pbnRMZW5ndGg6IC0xLAoJCQkJc3BvdExlbmd0aDogLTEsCgkJCQlyZWN0QXJlYUxlbmd0aDogLTEsCgkJCQloZW1pTGVuZ3RoOiAtMSwKCgkJCQludW1EaXJlY3Rpb25hbFNoYWRvd3M6IC0xLAoJCQkJbnVtUG9pbnRTaGFkb3dzOiAtMSwKCQkJCW51bVNwb3RTaGFkb3dzOiAtMSwKCQkJCW51bVNwb3RNYXBzOiAtMSwKCgkJCQludW1MaWdodFByb2JlczogLTEKCQkJfSwKCgkJCWFtYmllbnQ6IFsgMCwgMCwgMCBdLAoJCQlwcm9iZTogW10sCgkJCWRpcmVjdGlvbmFsOiBbXSwKCQkJZGlyZWN0aW9uYWxTaGFkb3c6IFtdLAoJCQlkaXJlY3Rpb25hbFNoYWRvd01hcDogW10sCgkJCWRpcmVjdGlvbmFsU2hhZG93TWF0cml4OiBbXSwKCQkJc3BvdDogW10sCgkJCXNwb3RMaWdodE1hcDogW10sCgkJCXNwb3RTaGFkb3c6IFtdLAoJCQlzcG90U2hhZG93TWFwOiBbXSwKCQkJc3BvdExpZ2h0TWF0cml4OiBbXSwKCQkJcmVjdEFyZWE6IFtdLAoJCQlyZWN0QXJlYUxUQzE6IG51bGwsCgkJCXJlY3RBcmVhTFRDMjogbnVsbCwKCQkJcG9pbnQ6IFtdLAoJCQlwb2ludFNoYWRvdzogW10sCgkJCXBvaW50U2hhZG93TWFwOiBbXSwKCQkJcG9pbnRTaGFkb3dNYXRyaXg6IFtdLAoJCQloZW1pOiBbXSwKCQkJbnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzOiAwLAoJCQludW1MaWdodFByb2JlczogMAoKCQl9OwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgc3RhdGUucHJvYmUucHVzaCggbmV3IFZlY3RvcjMoKSApOwoKCQljb25zdCB2ZWN0b3IzID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBtYXRyaXg0ID0gbmV3IE1hdHJpeDQoKTsKCQljb25zdCBtYXRyaXg0MiA9IG5ldyBNYXRyaXg0KCk7CgoJCWZ1bmN0aW9uIHNldHVwKCBsaWdodHMgKSB7CgoJCQlsZXQgciA9IDAsIGcgPSAwLCBiID0gMDsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSBzdGF0ZS5wcm9iZVsgaSBdLnNldCggMCwgMCwgMCApOwoKCQkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKCQkJbGV0IHBvaW50TGVuZ3RoID0gMDsKCQkJbGV0IHNwb3RMZW5ndGggPSAwOwoJCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwoJCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgoJCQlsZXQgbnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gMDsKCQkJbGV0IG51bVBvaW50U2hhZG93cyA9IDA7CgkJCWxldCBudW1TcG90U2hhZG93cyA9IDA7CgkJCWxldCBudW1TcG90TWFwcyA9IDA7CgkJCWxldCBudW1TcG90U2hhZG93c1dpdGhNYXBzID0gMDsKCgkJCWxldCBudW1MaWdodFByb2JlcyA9IDA7CgoJCQkvLyBvcmRlcmluZyA6IFtzaGFkb3cgY2FzdGluZyArIG1hcCB0ZXh0dXJpbmcsIG1hcCB0ZXh0dXJpbmcsIHNoYWRvdyBjYXN0aW5nLCBub25lIF0KCQkJbGlnaHRzLnNvcnQoIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gbGlnaHRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgbGlnaHQgPSBsaWdodHNbIGkgXTsKCgkJCQljb25zdCBjb2xvciA9IGxpZ2h0LmNvbG9yOwoJCQkJY29uc3QgaW50ZW5zaXR5ID0gbGlnaHQuaW50ZW5zaXR5OwoJCQkJY29uc3QgZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCgkJCQljb25zdCBzaGFkb3dNYXAgPSAoIGxpZ2h0LnNoYWRvdyAmJiBsaWdodC5zaGFkb3cubWFwICkgPyBsaWdodC5zaGFkb3cubWFwLnRleHR1cmUgOiBudWxsOwoKCQkJCWlmICggbGlnaHQuaXNBbWJpZW50TGlnaHQgKSB7CgoJCQkJCXIgKz0gY29sb3IuciAqIGludGVuc2l0eTsKCQkJCQlnICs9IGNvbG9yLmcgKiBpbnRlbnNpdHk7CgkJCQkJYiArPSBjb2xvci5iICogaW50ZW5zaXR5OwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzTGlnaHRQcm9iZSApIHsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgOTsgaiArKyApIHsKCgkJCQkJCXN0YXRlLnByb2JlWyBqIF0uYWRkU2NhbGVkVmVjdG9yKCBsaWdodC5zaC5jb2VmZmljaWVudHNbIGogXSwgaW50ZW5zaXR5ICk7CgoJCQkJCX0KCgkJCQkJbnVtTGlnaHRQcm9iZXMgKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNEaXJlY3Rpb25hbExpZ2h0ICkgewoKCQkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJdW5pZm9ybXMuY29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggbGlnaHQuaW50ZW5zaXR5ICk7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCgkJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93WyBkaXJlY3Rpb25hbExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CgkJCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwWyBkaXJlY3Rpb25hbExlbmd0aCBdID0gc2hhZG93TWFwOwoJCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CgoJCQkJCQludW1EaXJlY3Rpb25hbFNoYWRvd3MgKys7CgoJCQkJCX0KCgkJCQkJc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJZGlyZWN0aW9uYWxMZW5ndGggKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNTcG90TGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgoJCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoJCQkJCXVuaWZvcm1zLmRpc3RhbmNlID0gZGlzdGFuY2U7CgoJCQkJCXVuaWZvcm1zLmNvbmVDb3MgPSBNYXRoLmNvcyggbGlnaHQuYW5nbGUgKTsKCQkJCQl1bmlmb3Jtcy5wZW51bWJyYUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSAqICggMSAtIGxpZ2h0LnBlbnVtYnJhICkgKTsKCQkJCQl1bmlmb3Jtcy5kZWNheSA9IGxpZ2h0LmRlY2F5OwoKCQkJCQlzdGF0ZS5zcG90WyBzcG90TGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCQlpZiAoIGxpZ2h0Lm1hcCApIHsKCgkJCQkJCXN0YXRlLnNwb3RMaWdodE1hcFsgbnVtU3BvdE1hcHMgXSA9IGxpZ2h0Lm1hcDsKCQkJCQkJbnVtU3BvdE1hcHMgKys7CgoJCQkJCQkvLyBtYWtlIHN1cmUgdGhlIGxpZ2h0TWF0cml4IGlzIHVwIHRvIGRhdGUKCQkJCQkJLy8gVE9ETyA6IGRvIGl0IGlmIHJlcXVpcmVkIG9ubHkKCQkJCQkJc2hhZG93LnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKCQkJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgbnVtU3BvdFNoYWRvd3NXaXRoTWFwcyArKzsKCgkJCQkJfQoKCQkJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXhbIHNwb3RMZW5ndGggXSA9IHNoYWRvdy5tYXRyaXg7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJCXN0YXRlLnNwb3RTaGFkb3dbIHNwb3RMZW5ndGggXSA9IHNoYWRvd1VuaWZvcm1zOwoJCQkJCQlzdGF0ZS5zcG90U2hhZG93TWFwWyBzcG90TGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgoJCQkJCQludW1TcG90U2hhZG93cyArKzsKCgkJCQkJfQoKCQkJCQlzcG90TGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCgkJCQkJY29uc3QgdW5pZm9ybXMgPSBjYWNoZS5nZXQoIGxpZ2h0ICk7CgoJCQkJCXVuaWZvcm1zLmNvbG9yLmNvcHkoIGNvbG9yICkubXVsdGlwbHlTY2FsYXIoIGludGVuc2l0eSApOwoKCQkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKCQkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKCQkJCQlzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXSA9IHVuaWZvcm1zOwoKCQkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKTsKCQkJCQl1bmlmb3Jtcy5kaXN0YW5jZSA9IGxpZ2h0LmRpc3RhbmNlOwoJCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCgkJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93SW50ZW5zaXR5ID0gc2hhZG93LmludGVuc2l0eTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dOb3JtYWxCaWFzID0gc2hhZG93Lm5vcm1hbEJpYXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhTmVhciA9IHNoYWRvdy5jYW1lcmEubmVhcjsKCQkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhRmFyID0gc2hhZG93LmNhbWVyYS5mYXI7CgoJCQkJCQlzdGF0ZS5wb2ludFNoYWRvd1sgcG9pbnRMZW5ndGggXSA9IHNoYWRvd1VuaWZvcm1zOwoJCQkJCQlzdGF0ZS5wb2ludFNoYWRvd01hcFsgcG9pbnRMZW5ndGggXSA9IHNoYWRvd01hcDsKCQkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXhbIHBvaW50TGVuZ3RoIF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwoKCQkJCQkJbnVtUG9pbnRTaGFkb3dzICsrOwoKCQkJCQl9CgoJCQkJCXN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJCXBvaW50TGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzSGVtaXNwaGVyZUxpZ2h0ICkgewoKCQkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJdW5pZm9ybXMuc2t5Q29sb3IuY29weSggbGlnaHQuY29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgkJCQkJdW5pZm9ybXMuZ3JvdW5kQ29sb3IuY29weSggbGlnaHQuZ3JvdW5kQ29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICk7CgoJCQkJCXN0YXRlLmhlbWlbIGhlbWlMZW5ndGggXSA9IHVuaWZvcm1zOwoKCQkJCQloZW1pTGVuZ3RoICsrOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggcmVjdEFyZWFMZW5ndGggPiAwICkgewoKCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IHRydWUgKSB7CgoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8xOwoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8yOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzE7CgkJCQkJc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0hBTEZfMjsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5hbWJpZW50WyAwIF0gPSByOwoJCQlzdGF0ZS5hbWJpZW50WyAxIF0gPSBnOwoJCQlzdGF0ZS5hbWJpZW50WyAyIF0gPSBiOwoKCQkJY29uc3QgaGFzaCA9IHN0YXRlLmhhc2g7CgoJCQlpZiAoIGhhc2guZGlyZWN0aW9uYWxMZW5ndGggIT09IGRpcmVjdGlvbmFsTGVuZ3RoIHx8CgkJCQloYXNoLnBvaW50TGVuZ3RoICE9PSBwb2ludExlbmd0aCB8fAoJCQkJaGFzaC5zcG90TGVuZ3RoICE9PSBzcG90TGVuZ3RoIHx8CgkJCQloYXNoLnJlY3RBcmVhTGVuZ3RoICE9PSByZWN0QXJlYUxlbmd0aCB8fAoJCQkJaGFzaC5oZW1pTGVuZ3RoICE9PSBoZW1pTGVuZ3RoIHx8CgkJCQloYXNoLm51bURpcmVjdGlvbmFsU2hhZG93cyAhPT0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzIHx8CgkJCQloYXNoLm51bVBvaW50U2hhZG93cyAhPT0gbnVtUG9pbnRTaGFkb3dzIHx8CgkJCQloYXNoLm51bVNwb3RTaGFkb3dzICE9PSBudW1TcG90U2hhZG93cyB8fAoJCQkJaGFzaC5udW1TcG90TWFwcyAhPT0gbnVtU3BvdE1hcHMgfHwKCQkJCWhhc2gubnVtTGlnaHRQcm9iZXMgIT09IG51bUxpZ2h0UHJvYmVzICkgewoKCQkJCXN0YXRlLmRpcmVjdGlvbmFsLmxlbmd0aCA9IGRpcmVjdGlvbmFsTGVuZ3RoOwoJCQkJc3RhdGUuc3BvdC5sZW5ndGggPSBzcG90TGVuZ3RoOwoJCQkJc3RhdGUucmVjdEFyZWEubGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCQlzdGF0ZS5wb2ludC5sZW5ndGggPSBwb2ludExlbmd0aDsKCQkJCXN0YXRlLmhlbWkubGVuZ3RoID0gaGVtaUxlbmd0aDsKCgkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdy5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CgkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CgkJCQlzdGF0ZS5wb2ludFNoYWRvdy5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CgkJCQlzdGF0ZS5wb2ludFNoYWRvd01hcC5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CgkJCQlzdGF0ZS5zcG90U2hhZG93Lmxlbmd0aCA9IG51bVNwb3RTaGFkb3dzOwoJCQkJc3RhdGUuc3BvdFNoYWRvd01hcC5sZW5ndGggPSBudW1TcG90U2hhZG93czsKCQkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJCXN0YXRlLnBvaW50U2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bVBvaW50U2hhZG93czsKCQkJCXN0YXRlLnNwb3RMaWdodE1hdHJpeC5sZW5ndGggPSBudW1TcG90U2hhZG93cyArIG51bVNwb3RNYXBzIC0gbnVtU3BvdFNoYWRvd3NXaXRoTWFwczsKCQkJCXN0YXRlLnNwb3RMaWdodE1hcC5sZW5ndGggPSBudW1TcG90TWFwczsKCQkJCXN0YXRlLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcyA9IG51bVNwb3RTaGFkb3dzV2l0aE1hcHM7CgkJCQlzdGF0ZS5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKCQkJCWhhc2guZGlyZWN0aW9uYWxMZW5ndGggPSBkaXJlY3Rpb25hbExlbmd0aDsKCQkJCWhhc2gucG9pbnRMZW5ndGggPSBwb2ludExlbmd0aDsKCQkJCWhhc2guc3BvdExlbmd0aCA9IHNwb3RMZW5ndGg7CgkJCQloYXNoLnJlY3RBcmVhTGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCQloYXNoLmhlbWlMZW5ndGggPSBoZW1pTGVuZ3RoOwoKCQkJCWhhc2gubnVtRGlyZWN0aW9uYWxTaGFkb3dzID0gbnVtRGlyZWN0aW9uYWxTaGFkb3dzOwoJCQkJaGFzaC5udW1Qb2ludFNoYWRvd3MgPSBudW1Qb2ludFNoYWRvd3M7CgkJCQloYXNoLm51bVNwb3RTaGFkb3dzID0gbnVtU3BvdFNoYWRvd3M7CgkJCQloYXNoLm51bVNwb3RNYXBzID0gbnVtU3BvdE1hcHM7CgoJCQkJaGFzaC5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKCQkJCXN0YXRlLnZlcnNpb24gPSBuZXh0VmVyc2lvbiArKzsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXR1cFZpZXcoIGxpZ2h0cywgY2FtZXJhICkgewoKCQkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKCQkJbGV0IHBvaW50TGVuZ3RoID0gMDsKCQkJbGV0IHNwb3RMZW5ndGggPSAwOwoJCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwoJCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgoJCQljb25zdCB2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgoJCQkJaWYgKCBsaWdodC5pc0RpcmVjdGlvbmFsTGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF07CgoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQkJdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zdWIoIHZlY3RvcjMgKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCB2aWV3TWF0cml4ICk7CgoJCQkJCWRpcmVjdGlvbmFsTGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzU3BvdExpZ2h0ICkgewoKCQkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnNwb3RbIHNwb3RMZW5ndGggXTsKCgkJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC50YXJnZXQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKCB2ZWN0b3IzICk7CgkJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKCQkJCQlzcG90TGVuZ3RoICsrOwoKCQkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCgkJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXTsKCgkJCQkJdW5pZm9ybXMucG9zaXRpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKCQkJCQkvLyBleHRyYWN0IGxvY2FsIHJvdGF0aW9uIG9mIGxpZ2h0IHRvIGRlcml2ZSB3aWR0aC9oZWlnaHQgaGFsZiB2ZWN0b3JzCgkJCQkJbWF0cml4NDIuaWRlbnRpdHkoKTsKCQkJCQltYXRyaXg0LmNvcHkoIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQkJbWF0cml4NC5wcmVtdWx0aXBseSggdmlld01hdHJpeCApOwoJCQkJCW1hdHJpeDQyLmV4dHJhY3RSb3RhdGlvbiggbWF0cml4NCApOwoKCQkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKCQkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKCQkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguYXBwbHlNYXRyaXg0KCBtYXRyaXg0MiApOwoJCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuYXBwbHlNYXRyaXg0KCBtYXRyaXg0MiApOwoKCQkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUucG9pbnRbIHBvaW50TGVuZ3RoIF07CgoJCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkJcG9pbnRMZW5ndGggKys7CgoJCQkJfSBlbHNlIGlmICggbGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm1zID0gc3RhdGUuaGVtaVsgaGVtaUxlbmd0aCBdOwoKCQkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCgkJCQkJaGVtaUxlbmd0aCArKzsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHsKCQkJc2V0dXA6IHNldHVwLAoJCQlzZXR1cFZpZXc6IHNldHVwVmlldywKCQkJc3RhdGU6IHN0YXRlCgkJfTsKCgl9CgoJZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZSggZXh0ZW5zaW9ucyApIHsKCgkJY29uc3QgbGlnaHRzID0gbmV3IFdlYkdMTGlnaHRzKCBleHRlbnNpb25zICk7CgoJCWNvbnN0IGxpZ2h0c0FycmF5ID0gW107CgkJY29uc3Qgc2hhZG93c0FycmF5ID0gW107CgoJCWZ1bmN0aW9uIGluaXQoIGNhbWVyYSApIHsKCgkJCXN0YXRlLmNhbWVyYSA9IGNhbWVyYTsKCgkJCWxpZ2h0c0FycmF5Lmxlbmd0aCA9IDA7CgkJCXNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2hMaWdodCggbGlnaHQgKSB7CgoJCQlsaWdodHNBcnJheS5wdXNoKCBsaWdodCApOwoKCQl9CgoJCWZ1bmN0aW9uIHB1c2hTaGFkb3coIHNoYWRvd0xpZ2h0ICkgewoKCQkJc2hhZG93c0FycmF5LnB1c2goIHNoYWRvd0xpZ2h0ICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBMaWdodHMoKSB7CgoJCQlsaWdodHMuc2V0dXAoIGxpZ2h0c0FycmF5ICk7CgoJCX0KCgkJZnVuY3Rpb24gc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKSB7CgoJCQlsaWdodHMuc2V0dXBWaWV3KCBsaWdodHNBcnJheSwgY2FtZXJhICk7CgoJCX0KCgkJY29uc3Qgc3RhdGUgPSB7CgkJCWxpZ2h0c0FycmF5OiBsaWdodHNBcnJheSwKCQkJc2hhZG93c0FycmF5OiBzaGFkb3dzQXJyYXksCgoJCQljYW1lcmE6IG51bGwsCgoJCQlsaWdodHM6IGxpZ2h0cywKCgkJCXRyYW5zbWlzc2lvblJlbmRlclRhcmdldDoge30KCQl9OwoKCQlyZXR1cm4gewoJCQlpbml0OiBpbml0LAoJCQlzdGF0ZTogc3RhdGUsCgkJCXNldHVwTGlnaHRzOiBzZXR1cExpZ2h0cywKCQkJc2V0dXBMaWdodHNWaWV3OiBzZXR1cExpZ2h0c1ZpZXcsCgoJCQlwdXNoTGlnaHQ6IHB1c2hMaWdodCwKCQkJcHVzaFNoYWRvdzogcHVzaFNoYWRvdwoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMUmVuZGVyU3RhdGVzKCBleHRlbnNpb25zICkgewoKCQlsZXQgcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCgkJZnVuY3Rpb24gZ2V0KCBzY2VuZSwgcmVuZGVyQ2FsbERlcHRoID0gMCApIHsKCgkJCWNvbnN0IHJlbmRlclN0YXRlQXJyYXkgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSApOwoJCQlsZXQgcmVuZGVyU3RhdGU7CgoJCQlpZiAoIHJlbmRlclN0YXRlQXJyYXkgPT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICk7CgkJCQlyZW5kZXJTdGF0ZXMuc2V0KCBzY2VuZSwgWyByZW5kZXJTdGF0ZSBdICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IHJlbmRlclN0YXRlQXJyYXkubGVuZ3RoICkgewoKCQkJCQlyZW5kZXJTdGF0ZSA9IG5ldyBXZWJHTFJlbmRlclN0YXRlKCBleHRlbnNpb25zICk7CgkJCQkJcmVuZGVyU3RhdGVBcnJheS5wdXNoKCByZW5kZXJTdGF0ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJlbmRlclN0YXRlID0gcmVuZGVyU3RhdGVBcnJheVsgcmVuZGVyQ2FsbERlcHRoIF07CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHJlbmRlclN0YXRlOwoKCQl9CgoJCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCQlyZW5kZXJTdGF0ZXMgPSBuZXcgV2Vha01hcCgpOwoKCQl9CgoJCXJldHVybiB7CgkJCWdldDogZ2V0LAoJCQlkaXNwb3NlOiBkaXNwb3NlCgkJfTsKCgl9CgoJY29uc3QgdmVydGV4ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7XG59IjsKCgljb25zdCBmcmFnbWVudCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCBzaGFkb3dfcGFzcztcbnVuaWZvcm0gdmVjMiByZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCByYWRpdXM7XG4jaW5jbHVkZSA8cGFja2luZz5cbnZvaWQgbWFpbigpIHtcblx0Y29uc3QgZmxvYXQgc2FtcGxlcyA9IGZsb2F0KCBWU01fU0FNUExFUyApO1xuXHRmbG9hdCBtZWFuID0gMC4wO1xuXHRmbG9hdCBzcXVhcmVkX21lYW4gPSAwLjA7XG5cdGZsb2F0IHV2U3RyaWRlID0gc2FtcGxlcyA8PSAxLjAgPyAwLjAgOiAyLjAgLyAoIHNhbXBsZXMgLSAxLjAgKTtcblx0ZmxvYXQgdXZTdGFydCA9IHNhbXBsZXMgPD0gMS4wID8gMC4wIDogLSAxLjA7XG5cdGZvciAoIGZsb2F0IGkgPSAwLjA7IGkgPCBzYW1wbGVzOyBpICsrICkge1xuXHRcdGZsb2F0IHV2T2Zmc2V0ID0gdXZTdGFydCArIGkgKiB1dlN0cmlkZTtcblx0XHQjaWZkZWYgSE9SSVpPTlRBTF9QQVNTXG5cdFx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIHV2T2Zmc2V0LCAwLjAgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRpc3RyaWJ1dGlvbi54O1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRpc3RyaWJ1dGlvbi55ICogZGlzdHJpYnV0aW9uLnkgKyBkaXN0cmlidXRpb24ueCAqIGRpc3RyaWJ1dGlvbi54O1xuXHRcdCNlbHNlXG5cdFx0XHRmbG9hdCBkZXB0aCA9IHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIDAuMCwgdXZPZmZzZXQgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRlcHRoO1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRlcHRoICogZGVwdGg7XG5cdFx0I2VuZGlmXG5cdH1cblx0bWVhbiA9IG1lYW4gLyBzYW1wbGVzO1xuXHRzcXVhcmVkX21lYW4gPSBzcXVhcmVkX21lYW4gLyBzYW1wbGVzO1xuXHRmbG9hdCBzdGRfZGV2ID0gc3FydCggc3F1YXJlZF9tZWFuIC0gbWVhbiAqIG1lYW4gKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFjazJIYWxmVG9SR0JBKCB2ZWMyKCBtZWFuLCBzdGRfZGV2ICkgKTtcbn0iOwoKCWZ1bmN0aW9uIFdlYkdMU2hhZG93TWFwKCByZW5kZXJlciwgb2JqZWN0cywgY2FwYWJpbGl0aWVzICkgewoKCQlsZXQgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKCQljb25zdCBfc2hhZG93TWFwU2l6ZSA9IG5ldyBWZWN0b3IyKCksCgkJCV92aWV3cG9ydFNpemUgPSBuZXcgVmVjdG9yMigpLAoKCQkJX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKSwKCgkJCV9kZXB0aE1hdGVyaWFsID0gbmV3IE1lc2hEZXB0aE1hdGVyaWFsKCB7IGRlcHRoUGFja2luZzogUkdCQURlcHRoUGFja2luZyB9ICksCgkJCV9kaXN0YW5jZU1hdGVyaWFsID0gbmV3IE1lc2hEaXN0YW5jZU1hdGVyaWFsKCksCgoJCQlfbWF0ZXJpYWxDYWNoZSA9IHt9LAoKCQkJX21heFRleHR1cmVTaXplID0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplOwoKCQljb25zdCBzaGFkb3dTaWRlID0geyBbIEZyb250U2lkZSBdOiBCYWNrU2lkZSwgWyBCYWNrU2lkZSBdOiBGcm9udFNpZGUsIFsgRG91YmxlU2lkZSBdOiBEb3VibGVTaWRlIH07CgoJCWNvbnN0IHNoYWRvd01hdGVyaWFsVmVydGljYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCQkJZGVmaW5lczogewoJCQkJVlNNX1NBTVBMRVM6IDgKCQkJfSwKCQkJdW5pZm9ybXM6IHsKCQkJCXNoYWRvd19wYXNzOiB7IHZhbHVlOiBudWxsIH0sCgkJCQlyZXNvbHV0aW9uOiB7IHZhbHVlOiBuZXcgVmVjdG9yMigpIH0sCgkJCQlyYWRpdXM6IHsgdmFsdWU6IDQuMCB9CgkJCX0sCgoJCQl2ZXJ0ZXhTaGFkZXI6IHZlcnRleCwKCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50CgoJCX0gKTsKCgkJY29uc3Qgc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsID0gc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5jbG9uZSgpOwoJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5kZWZpbmVzLkhPUklaT05UQUxfUEFTUyA9IDE7CgoJCWNvbnN0IGZ1bGxTY3JlZW5UcmkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlmdWxsU2NyZWVuVHJpLnNldEF0dHJpYnV0ZSgKCQkJJ3Bvc2l0aW9uJywKCQkJbmV3IEJ1ZmZlckF0dHJpYnV0ZSgKCQkJCW5ldyBGbG9hdDMyQXJyYXkoIFsgLTEsIC0xLCAwLjUsIDMsIC0xLCAwLjUsIC0xLCAzLCAwLjUgXSApLAoJCQkJMwoJCQkpCgkJKTsKCgkJY29uc3QgZnVsbFNjcmVlbk1lc2ggPSBuZXcgTWVzaCggZnVsbFNjcmVlblRyaSwgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCApOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCQl0aGlzLmF1dG9VcGRhdGUgPSB0cnVlOwoJCXRoaXMubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy50eXBlID0gUENGU2hhZG93TWFwOwoJCWxldCBfcHJldmlvdXNUeXBlID0gdGhpcy50eXBlOwoKCQl0aGlzLnJlbmRlciA9IGZ1bmN0aW9uICggbGlnaHRzLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCQkJaWYgKCBzY29wZS5hdXRvVXBkYXRlID09PSBmYWxzZSAmJiBzY29wZS5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQlpZiAoIGxpZ2h0cy5sZW5ndGggPT09IDAgKSByZXR1cm47CgoJCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJCWNvbnN0IGFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQkJY29uc3QgYWN0aXZlTWlwbWFwTGV2ZWwgPSByZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQkJY29uc3QgX3N0YXRlID0gcmVuZGVyZXIuc3RhdGU7CgoJCQkvLyBTZXQgR0wgc3RhdGUgZm9yIGRlcHRoIG1hcC4KCQkJX3N0YXRlLnNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICk7CgkJCV9zdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCAxLCAxLCAxLCAxICk7CgkJCV9zdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQkJX3N0YXRlLnNldFNjaXNzb3JUZXN0KCBmYWxzZSApOwoKCQkJLy8gY2hlY2sgZm9yIHNoYWRvdyBtYXAgdHlwZSBjaGFuZ2VzCgoJCQljb25zdCB0b1ZTTSA9ICggX3ByZXZpb3VzVHlwZSAhPT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwICk7CgkJCWNvbnN0IGZyb21WU00gPSAoIF9wcmV2aW91c1R5cGUgPT09IFZTTVNoYWRvd01hcCAmJiB0aGlzLnR5cGUgIT09IFZTTVNoYWRvd01hcCApOwoKCQkJLy8gcmVuZGVyIGRlcHRoIG1hcAoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBsaWdodCA9IGxpZ2h0c1sgaSBdOwoJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCWlmICggc2hhZG93ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMU2hhZG93TWFwOicsIGxpZ2h0LCAnaGFzIG5vIHNoYWRvdy4nICk7CgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCWlmICggc2hhZG93LmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNoYWRvdy5uZWVkc1VwZGF0ZSA9PT0gZmFsc2UgKSBjb250aW51ZTsKCgkJCQlfc2hhZG93TWFwU2l6ZS5jb3B5KCBzaGFkb3cubWFwU2l6ZSApOwoKCQkJCWNvbnN0IHNoYWRvd0ZyYW1lRXh0ZW50cyA9IHNoYWRvdy5nZXRGcmFtZUV4dGVudHMoKTsKCgkJCQlfc2hhZG93TWFwU2l6ZS5tdWx0aXBseSggc2hhZG93RnJhbWVFeHRlbnRzICk7CgoJCQkJX3ZpZXdwb3J0U2l6ZS5jb3B5KCBzaGFkb3cubWFwU2l6ZSApOwoKCQkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSB8fCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCQlpZiAoIF9zaGFkb3dNYXBTaXplLnggPiBfbWF4VGV4dHVyZVNpemUgKSB7CgoJCQkJCQlfdmlld3BvcnRTaXplLnggPSBNYXRoLmZsb29yKCBfbWF4VGV4dHVyZVNpemUgLyBzaGFkb3dGcmFtZUV4dGVudHMueCApOwoJCQkJCQlfc2hhZG93TWFwU2l6ZS54ID0gX3ZpZXdwb3J0U2l6ZS54ICogc2hhZG93RnJhbWVFeHRlbnRzLng7CgkJCQkJCXNoYWRvdy5tYXBTaXplLnggPSBfdmlld3BvcnRTaXplLng7CgoJCQkJCX0KCgkJCQkJaWYgKCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCQkJX3ZpZXdwb3J0U2l6ZS55ID0gTWF0aC5mbG9vciggX21heFRleHR1cmVTaXplIC8gc2hhZG93RnJhbWVFeHRlbnRzLnkgKTsKCQkJCQkJX3NoYWRvd01hcFNpemUueSA9IF92aWV3cG9ydFNpemUueSAqIHNoYWRvd0ZyYW1lRXh0ZW50cy55OwoJCQkJCQlzaGFkb3cubWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55OwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggc2hhZG93Lm1hcCA9PT0gbnVsbCB8fCB0b1ZTTSA9PT0gdHJ1ZSB8fCBmcm9tVlNNID09PSB0cnVlICkgewoKCQkJCQljb25zdCBwYXJzID0gKCB0aGlzLnR5cGUgIT09IFZTTVNoYWRvd01hcCApID8geyBtaW5GaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsIG1hZ0ZpbHRlcjogTmVhcmVzdEZpbHRlciB9IDoge307CgoJCQkJCWlmICggc2hhZG93Lm1hcCAhPT0gbnVsbCApIHsKCgkJCQkJCXNoYWRvdy5tYXAuZGlzcG9zZSgpOwoKCQkJCQl9CgoJCQkJCXNoYWRvdy5tYXAgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIF9zaGFkb3dNYXBTaXplLngsIF9zaGFkb3dNYXBTaXplLnksIHBhcnMgKTsKCQkJCQlzaGFkb3cubWFwLnRleHR1cmUubmFtZSA9IGxpZ2h0Lm5hbWUgKyAnLnNoYWRvd01hcCc7CgoJCQkJCXNoYWRvdy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQkJCX0KCgkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXAgKTsKCQkJCXJlbmRlcmVyLmNsZWFyKCk7CgoJCQkJY29uc3Qgdmlld3BvcnRDb3VudCA9IHNoYWRvdy5nZXRWaWV3cG9ydENvdW50KCk7CgoJCQkJZm9yICggbGV0IHZwID0gMDsgdnAgPCB2aWV3cG9ydENvdW50OyB2cCArKyApIHsKCgkJCQkJY29uc3Qgdmlld3BvcnQgPSBzaGFkb3cuZ2V0Vmlld3BvcnQoIHZwICk7CgoJCQkJCV92aWV3cG9ydC5zZXQoCgkJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LngsCgkJCQkJCV92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LnksCgkJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LnosCgkJCQkJCV92aWV3cG9ydFNpemUueSAqIHZpZXdwb3J0LncKCQkJCQkpOwoKCQkJCQlfc3RhdGUudmlld3BvcnQoIF92aWV3cG9ydCApOwoKCQkJCQlzaGFkb3cudXBkYXRlTWF0cmljZXMoIGxpZ2h0LCB2cCApOwoKCQkJCQlfZnJ1c3R1bSA9IHNoYWRvdy5nZXRGcnVzdHVtKCk7CgoJCQkJCXJlbmRlck9iamVjdCggc2NlbmUsIGNhbWVyYSwgc2hhZG93LmNhbWVyYSwgbGlnaHQsIHRoaXMudHlwZSApOwoKCQkJCX0KCgkJCQkvLyBkbyBibHVyIHBhc3MgZm9yIFZTTQoKCQkJCWlmICggc2hhZG93LmlzUG9pbnRMaWdodFNoYWRvdyAhPT0gdHJ1ZSAmJiB0aGlzLnR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCQkJVlNNUGFzcyggc2hhZG93LCBjYW1lcmEgKTsKCgkJCQl9CgoJCQkJc2hhZG93Lm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCQl9CgoJCQlfcHJldmlvdXNUeXBlID0gdGhpcy50eXBlOwoKCQkJc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJCX07CgoJCWZ1bmN0aW9uIFZTTVBhc3MoIHNoYWRvdywgY2FtZXJhICkgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggZnVsbFNjcmVlbk1lc2ggKTsKCgkJCWlmICggc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTICE9PSBzaGFkb3cuYmx1clNhbXBsZXMgKSB7CgoJCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTID0gc2hhZG93LmJsdXJTYW1wbGVzOwoJCQkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLmRlZmluZXMuVlNNX1NBTVBMRVMgPSBzaGFkb3cuYmx1clNhbXBsZXM7CgoJCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQlzaGFkb3dNYXRlcmlhbEhvcml6b250YWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCBzaGFkb3cubWFwUGFzcyA9PT0gbnVsbCApIHsKCgkJCQlzaGFkb3cubWFwUGFzcyA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggX3NoYWRvd01hcFNpemUueCwgX3NoYWRvd01hcFNpemUueSApOwoKCQkJfQoKCQkJLy8gdmVydGljYWwgcGFzcwoKCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5zaGFkb3dfcGFzcy52YWx1ZSA9IHNoYWRvdy5tYXAudGV4dHVyZTsKCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CgkJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmFkaXVzLnZhbHVlID0gc2hhZG93LnJhZGl1czsKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwUGFzcyApOwoJCQlyZW5kZXJlci5jbGVhcigpOwoJCQlyZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsVmVydGljYWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgoJCQkvLyBob3Jpem9udGFsIHBhc3MKCgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5zaGFkb3dfcGFzcy52YWx1ZSA9IHNoYWRvdy5tYXBQYXNzLnRleHR1cmU7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yYWRpdXMudmFsdWUgPSBzaGFkb3cucmFkaXVzOwoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHNoYWRvdy5tYXAgKTsKCQkJcmVuZGVyZXIuY2xlYXIoKTsKCQkJcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgbGlnaHQsIHR5cGUgKSB7CgoJCQlsZXQgcmVzdWx0ID0gbnVsbDsKCgkJCWNvbnN0IGN1c3RvbU1hdGVyaWFsID0gKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgKSA/IG9iamVjdC5jdXN0b21EaXN0YW5jZU1hdGVyaWFsIDogb2JqZWN0LmN1c3RvbURlcHRoTWF0ZXJpYWw7CgoJCQlpZiAoIGN1c3RvbU1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmVzdWx0ID0gY3VzdG9tTWF0ZXJpYWw7CgoJCQl9IGVsc2UgewoKCQkJCXJlc3VsdCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBfZGlzdGFuY2VNYXRlcmlhbCA6IF9kZXB0aE1hdGVyaWFsOwoKCQkJCWlmICggKCByZW5kZXJlci5sb2NhbENsaXBwaW5nRW5hYmxlZCAmJiBtYXRlcmlhbC5jbGlwU2hhZG93cyA9PT0gdHJ1ZSAmJiBBcnJheS5pc0FycmF5KCBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcyApICYmIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzLmxlbmd0aCAhPT0gMCApIHx8CgkJCQkJKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAgJiYgbWF0ZXJpYWwuZGlzcGxhY2VtZW50U2NhbGUgIT09IDAgKSB8fAoJCQkJCSggbWF0ZXJpYWwuYWxwaGFNYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHx8CgkJCQkJKCBtYXRlcmlhbC5tYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHx8CgkJCQkJKCBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSApIHsKCgkJCQkJLy8gaW4gdGhpcyBjYXNlIHdlIG5lZWQgYSB1bmlxdWUgbWF0ZXJpYWwgaW5zdGFuY2UgcmVmbGVjdGluZyB0aGUKCQkJCQkvLyBhcHByb3ByaWF0ZSBzdGF0ZQoKCQkJCQljb25zdCBrZXlBID0gcmVzdWx0LnV1aWQsIGtleUIgPSBtYXRlcmlhbC51dWlkOwoKCQkJCQlsZXQgbWF0ZXJpYWxzRm9yVmFyaWFudCA9IF9tYXRlcmlhbENhY2hlWyBrZXlBIF07CgoJCQkJCWlmICggbWF0ZXJpYWxzRm9yVmFyaWFudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudCA9IHt9OwoJCQkJCQlfbWF0ZXJpYWxDYWNoZVsga2V5QSBdID0gbWF0ZXJpYWxzRm9yVmFyaWFudDsKCgkJCQkJfQoKCQkJCQlsZXQgY2FjaGVkTWF0ZXJpYWwgPSBtYXRlcmlhbHNGb3JWYXJpYW50WyBrZXlCIF07CgoJCQkJCWlmICggY2FjaGVkTWF0ZXJpYWwgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNhY2hlZE1hdGVyaWFsID0gcmVzdWx0LmNsb25lKCk7CgkJCQkJCW1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXSA9IGNhY2hlZE1hdGVyaWFsOwoJCQkJCQltYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uTWF0ZXJpYWxEaXNwb3NlICk7CgoJCQkJCX0KCgkJCQkJcmVzdWx0ID0gY2FjaGVkTWF0ZXJpYWw7CgoJCQkJfQoKCQkJfQoKCQkJcmVzdWx0LnZpc2libGUgPSBtYXRlcmlhbC52aXNpYmxlOwoJCQlyZXN1bHQud2lyZWZyYW1lID0gbWF0ZXJpYWwud2lyZWZyYW1lOwoKCQkJaWYgKCB0eXBlID09PSBWU01TaGFkb3dNYXAgKSB7CgoJCQkJcmVzdWx0LnNpZGUgPSAoIG1hdGVyaWFsLnNoYWRvd1NpZGUgIT09IG51bGwgKSA/IG1hdGVyaWFsLnNoYWRvd1NpZGUgOiBtYXRlcmlhbC5zaWRlOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXN1bHQuc2lkZSA9ICggbWF0ZXJpYWwuc2hhZG93U2lkZSAhPT0gbnVsbCApID8gbWF0ZXJpYWwuc2hhZG93U2lkZSA6IHNoYWRvd1NpZGVbIG1hdGVyaWFsLnNpZGUgXTsKCgkJCX0KCgkJCXJlc3VsdC5hbHBoYU1hcCA9IG1hdGVyaWFsLmFscGhhTWFwOwoJCQlyZXN1bHQuYWxwaGFUZXN0ID0gKCBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUgKSA/IDAuNSA6IG1hdGVyaWFsLmFscGhhVGVzdDsgLy8gYXBwcm94aW1hdGUgYWxwaGFUb0NvdmVyYWdlIGJ5IHVzaW5nIGEgZml4ZWQgYWxwaGFUZXN0IHZhbHVlCgkJCXJlc3VsdC5tYXAgPSBtYXRlcmlhbC5tYXA7CgoJCQlyZXN1bHQuY2xpcFNoYWRvd3MgPSBtYXRlcmlhbC5jbGlwU2hhZG93czsKCQkJcmVzdWx0LmNsaXBwaW5nUGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXM7CgkJCXJlc3VsdC5jbGlwSW50ZXJzZWN0aW9uID0gbWF0ZXJpYWwuY2xpcEludGVyc2VjdGlvbjsKCgkJCXJlc3VsdC5kaXNwbGFjZW1lbnRNYXAgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXA7CgkJCXJlc3VsdC5kaXNwbGFjZW1lbnRTY2FsZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQlyZXN1bHQuZGlzcGxhY2VtZW50QmlhcyA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCQlyZXN1bHQud2lyZWZyYW1lTGluZXdpZHRoID0gbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoOwoJCQlyZXN1bHQubGluZXdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKCQkJaWYgKCBsaWdodC5pc1BvaW50TGlnaHQgPT09IHRydWUgJiYgcmVzdWx0LmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgPT09IHRydWUgKSB7CgoJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHJlc3VsdCApOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0ID0gbGlnaHQ7CgoJCQl9CgoJCQlyZXR1cm4gcmVzdWx0OwoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKSB7CgoJCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJCWNvbnN0IHZpc2libGUgPSBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKTsKCgkJCWlmICggdmlzaWJsZSAmJiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSApIHsKCgkJCQlpZiAoICggb2JqZWN0LmNhc3RTaGFkb3cgfHwgKCBvYmplY3QucmVjZWl2ZVNoYWRvdyAmJiB0eXBlID09PSBWU01TaGFkb3dNYXAgKSApICYmICggISBvYmplY3QuZnJ1c3R1bUN1bGxlZCB8fCBfZnJ1c3R1bS5pbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSApICkgewoKCQkJCQlvYmplY3QubW9kZWxWaWV3TWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIHNoYWRvd0NhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKCQkJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IGdyb3Vwcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCgkJCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgayBdOwoJCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQkJaWYgKCBncm91cE1hdGVyaWFsICYmIGdyb3VwTWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQkJY29uc3QgZGVwdGhNYXRlcmlhbCA9IGdldERlcHRoTWF0ZXJpYWwoIG9iamVjdCwgZ3JvdXBNYXRlcmlhbCwgbGlnaHQsIHR5cGUgKTsKCgkJCQkJCQkJb2JqZWN0Lm9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIGdyb3VwICk7CgoJCQkJCQkJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBncm91cCApOwoKCQkJCQkJCQlvYmplY3Qub25BZnRlclNoYWRvdyggcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBncm91cCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCWNvbnN0IGRlcHRoTWF0ZXJpYWwgPSBnZXREZXB0aE1hdGVyaWFsKCBvYmplY3QsIG1hdGVyaWFsLCBsaWdodCwgdHlwZSApOwoKCQkJCQkJb2JqZWN0Lm9uQmVmb3JlU2hhZG93KCByZW5kZXJlciwgb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIG51bGwgKTsKCgkJCQkJCXJlbmRlcmVyLnJlbmRlckJ1ZmZlckRpcmVjdCggc2hhZG93Q2FtZXJhLCBudWxsLCBnZW9tZXRyeSwgZGVwdGhNYXRlcmlhbCwgb2JqZWN0LCBudWxsICk7CgoJCQkJCQlvYmplY3Qub25BZnRlclNoYWRvdyggcmVuZGVyZXIsIG9iamVjdCwgY2FtZXJhLCBzaGFkb3dDYW1lcmEsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBudWxsICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJcmVuZGVyT2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBvbk1hdGVyaWFsRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCBtYXRlcmlhbCA9IGV2ZW50LnRhcmdldDsKCgkJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCS8vIG1ha2Ugc3VyZSB0byByZW1vdmUgdGhlIHVuaXF1ZSBkaXN0YW5jZS9kZXB0aCBtYXRlcmlhbHMgdXNlZCBmb3Igc2hhZG93IG1hcCByZW5kZXJpbmcKCgkJCWZvciAoIGNvbnN0IGlkIGluIF9tYXRlcmlhbENhY2hlICkgewoKCQkJCWNvbnN0IGNhY2hlID0gX21hdGVyaWFsQ2FjaGVbIGlkIF07CgoJCQkJY29uc3QgdXVpZCA9IGV2ZW50LnRhcmdldC51dWlkOwoKCQkJCWlmICggdXVpZCBpbiBjYWNoZSApIHsKCgkJCQkJY29uc3Qgc2hhZG93TWF0ZXJpYWwgPSBjYWNoZVsgdXVpZCBdOwoJCQkJCXNoYWRvd01hdGVyaWFsLmRpc3Bvc2UoKTsKCQkJCQlkZWxldGUgY2FjaGVbIHV1aWQgXTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJY29uc3QgcmV2ZXJzZWRGdW5jcyA9IHsKCQlbIE5ldmVyRGVwdGggXTogQWx3YXlzRGVwdGgsCgkJWyBMZXNzRGVwdGggXTogR3JlYXRlckRlcHRoLAoJCVsgRXF1YWxEZXB0aCBdOiBOb3RFcXVhbERlcHRoLAoJCVsgTGVzc0VxdWFsRGVwdGggXTogR3JlYXRlckVxdWFsRGVwdGgsCgoJCVsgQWx3YXlzRGVwdGggXTogTmV2ZXJEZXB0aCwKCQlbIEdyZWF0ZXJEZXB0aCBdOiBMZXNzRGVwdGgsCgkJWyBOb3RFcXVhbERlcHRoIF06IEVxdWFsRGVwdGgsCgkJWyBHcmVhdGVyRXF1YWxEZXB0aCBdOiBMZXNzRXF1YWxEZXB0aCwKCX07CgoJZnVuY3Rpb24gV2ViR0xTdGF0ZSggZ2wsIGV4dGVuc2lvbnMgKSB7CgoJCWZ1bmN0aW9uIENvbG9yQnVmZmVyKCkgewoKCQkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKCQkJY29uc3QgY29sb3IgPSBuZXcgVmVjdG9yNCgpOwoJCQlsZXQgY3VycmVudENvbG9yTWFzayA9IG51bGw7CgkJCWNvbnN0IGN1cnJlbnRDb2xvckNsZWFyID0gbmV3IFZlY3RvcjQoIDAsIDAsIDAsIDAgKTsKCgkJCXJldHVybiB7CgoJCQkJc2V0TWFzazogZnVuY3Rpb24gKCBjb2xvck1hc2sgKSB7CgoJCQkJCWlmICggY3VycmVudENvbG9yTWFzayAhPT0gY29sb3JNYXNrICYmICEgbG9ja2VkICkgewoKCQkJCQkJZ2wuY29sb3JNYXNrKCBjb2xvck1hc2ssIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2sgKTsKCQkJCQkJY3VycmVudENvbG9yTWFzayA9IGNvbG9yTWFzazsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCByLCBnLCBiLCBhLCBwcmVtdWx0aXBsaWVkQWxwaGEgKSB7CgoJCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgewoKCQkJCQkJciAqPSBhOyBnICo9IGE7IGIgKj0gYTsKCgkJCQkJfQoKCQkJCQljb2xvci5zZXQoIHIsIGcsIGIsIGEgKTsKCgkJCQkJaWYgKCBjdXJyZW50Q29sb3JDbGVhci5lcXVhbHMoIGNvbG9yICkgPT09IGZhbHNlICkgewoKCQkJCQkJZ2wuY2xlYXJDb2xvciggciwgZywgYiwgYSApOwoJCQkJCQljdXJyZW50Q29sb3JDbGVhci5jb3B5KCBjb2xvciApOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKCQkJCQlsb2NrZWQgPSBmYWxzZTsKCgkJCQkJY3VycmVudENvbG9yTWFzayA9IG51bGw7CgkJCQkJY3VycmVudENvbG9yQ2xlYXIuc2V0KCAtMSwgMCwgMCwgMCApOyAvLyBzZXQgdG8gaW52YWxpZCBzdGF0ZQoKCQkJCX0KCgkJCX07CgoJCX0KCgkJZnVuY3Rpb24gRGVwdGhCdWZmZXIoKSB7CgoJCQlsZXQgbG9ja2VkID0gZmFsc2U7CgoJCQlsZXQgY3VycmVudFJldmVyc2VkID0gZmFsc2U7CgkJCWxldCBjdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKCQkJbGV0IGN1cnJlbnREZXB0aEZ1bmMgPSBudWxsOwoJCQlsZXQgY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwoKCQkJcmV0dXJuIHsKCgkJCQlzZXRSZXZlcnNlZDogZnVuY3Rpb24gKCByZXZlcnNlZCApIHsKCgkJCQkJaWYgKCBjdXJyZW50UmV2ZXJzZWQgIT09IHJldmVyc2VkICkgewoKCQkJCQkJY29uc3QgZXh0ID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfY2xpcF9jb250cm9sJyApOwoKCQkJCQkJaWYgKCByZXZlcnNlZCApIHsKCgkJCQkJCQlleHQuY2xpcENvbnRyb2xFWFQoIGV4dC5MT1dFUl9MRUZUX0VYVCwgZXh0LlpFUk9fVE9fT05FX0VYVCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlleHQuY2xpcENvbnRyb2xFWFQoIGV4dC5MT1dFUl9MRUZUX0VYVCwgZXh0Lk5FR0FUSVZFX09ORV9UT19PTkVfRVhUICk7CgoJCQkJCQl9CgoJCQkJCQljdXJyZW50UmV2ZXJzZWQgPSByZXZlcnNlZDsKCgkJCQkJCWNvbnN0IG9sZERlcHRoID0gY3VycmVudERlcHRoQ2xlYXI7CgkJCQkJCWN1cnJlbnREZXB0aENsZWFyID0gbnVsbDsKCQkJCQkJdGhpcy5zZXRDbGVhciggb2xkRGVwdGggKTsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJZ2V0UmV2ZXJzZWQ6IGZ1bmN0aW9uICgpIHsKCgkJCQkJcmV0dXJuIGN1cnJlbnRSZXZlcnNlZDsKCgkJCQl9LAoKCQkJCXNldFRlc3Q6IGZ1bmN0aW9uICggZGVwdGhUZXN0ICkgewoKCQkJCQlpZiAoIGRlcHRoVGVzdCApIHsKCgkJCQkJCWVuYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRNYXNrOiBmdW5jdGlvbiAoIGRlcHRoTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhNYXNrICE9PSBkZXB0aE1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCQlnbC5kZXB0aE1hc2soIGRlcHRoTWFzayApOwoJCQkJCQljdXJyZW50RGVwdGhNYXNrID0gZGVwdGhNYXNrOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIGRlcHRoRnVuYyApIHsKCgkJCQkJaWYgKCBjdXJyZW50UmV2ZXJzZWQgKSBkZXB0aEZ1bmMgPSByZXZlcnNlZEZ1bmNzWyBkZXB0aEZ1bmMgXTsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhGdW5jICE9PSBkZXB0aEZ1bmMgKSB7CgoJCQkJCQlzd2l0Y2ggKCBkZXB0aEZ1bmMgKSB7CgoJCQkJCQkJY2FzZSBOZXZlckRlcHRoOgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLk5FVkVSICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBBbHdheXNEZXB0aDoKCgkJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5BTFdBWVMgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIExlc3NEZXB0aDoKCgkJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVNTICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBMZXNzRXF1YWxEZXB0aDoKCgkJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVFVQUwgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEVxdWFsRGVwdGg6CgoJCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuRVFVQUwgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEdyZWF0ZXJFcXVhbERlcHRoOgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdFUVVBTCApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgR3JlYXRlckRlcHRoOgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdSRUFURVIgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIE5vdEVxdWFsRGVwdGg6CgoJCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTk9URVFVQUwgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQlkZWZhdWx0OgoKCQkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFUVVBTCApOwoKCQkJCQkJfQoKCQkJCQkJY3VycmVudERlcHRoRnVuYyA9IGRlcHRoRnVuYzsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBkZXB0aCApIHsKCgkJCQkJaWYgKCBjdXJyZW50RGVwdGhDbGVhciAhPT0gZGVwdGggKSB7CgoJCQkJCQlpZiAoIGN1cnJlbnRSZXZlcnNlZCApIHsKCgkJCQkJCQlkZXB0aCA9IDEgLSBkZXB0aDsKCgkJCQkJCX0KCgkJCQkJCWdsLmNsZWFyRGVwdGgoIGRlcHRoICk7CgkJCQkJCWN1cnJlbnREZXB0aENsZWFyID0gZGVwdGg7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCQljdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKCQkJCQljdXJyZW50RGVwdGhGdW5jID0gbnVsbDsKCQkJCQljdXJyZW50RGVwdGhDbGVhciA9IG51bGw7CgkJCQkJY3VycmVudFJldmVyc2VkID0gZmFsc2U7CgoJCQkJfQoKCQkJfTsKCgkJfQoKCQlmdW5jdGlvbiBTdGVuY2lsQnVmZmVyKCkgewoKCQkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKCQkJbGV0IGN1cnJlbnRTdGVuY2lsTWFzayA9IG51bGw7CgkJCWxldCBjdXJyZW50U3RlbmNpbEZ1bmMgPSBudWxsOwoJCQlsZXQgY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwoJCQlsZXQgY3VycmVudFN0ZW5jaWxGdW5jTWFzayA9IG51bGw7CgkJCWxldCBjdXJyZW50U3RlbmNpbEZhaWwgPSBudWxsOwoJCQlsZXQgY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CgkJCWxldCBjdXJyZW50U3RlbmNpbFpQYXNzID0gbnVsbDsKCQkJbGV0IGN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBudWxsOwoKCQkJcmV0dXJuIHsKCgkJCQlzZXRUZXN0OiBmdW5jdGlvbiAoIHN0ZW5jaWxUZXN0ICkgewoKCQkJCQlpZiAoICEgbG9ja2VkICkgewoKCQkJCQkJaWYgKCBzdGVuY2lsVGVzdCApIHsKCgkJCQkJCQllbmFibGUoIGdsLlNURU5DSUxfVEVTVCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlkaXNhYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TWFzazogZnVuY3Rpb24gKCBzdGVuY2lsTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50U3RlbmNpbE1hc2sgIT09IHN0ZW5jaWxNYXNrICYmICEgbG9ja2VkICkgewoKCQkJCQkJZ2wuc3RlbmNpbE1hc2soIHN0ZW5jaWxNYXNrICk7CgkJCQkJCWN1cnJlbnRTdGVuY2lsTWFzayA9IHN0ZW5jaWxNYXNrOwoKCQkJCQl9CgoJCQkJfSwKCgkJCQlzZXRGdW5jOiBmdW5jdGlvbiAoIHN0ZW5jaWxGdW5jLCBzdGVuY2lsUmVmLCBzdGVuY2lsTWFzayApIHsKCgkJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZ1bmMgIT09IHN0ZW5jaWxGdW5jIHx8CgkJCQkJICAgICBjdXJyZW50U3RlbmNpbFJlZiAhPT0gc3RlbmNpbFJlZiB8fAoJCQkJCSAgICAgY3VycmVudFN0ZW5jaWxGdW5jTWFzayAhPT0gc3RlbmNpbE1hc2sgKSB7CgoJCQkJCQlnbC5zdGVuY2lsRnVuYyggc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrICk7CgoJCQkJCQljdXJyZW50U3RlbmNpbEZ1bmMgPSBzdGVuY2lsRnVuYzsKCQkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBzdGVuY2lsUmVmOwoJCQkJCQljdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gc3RlbmNpbE1hc2s7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXNldE9wOiBmdW5jdGlvbiAoIHN0ZW5jaWxGYWlsLCBzdGVuY2lsWkZhaWwsIHN0ZW5jaWxaUGFzcyApIHsKCgkJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZhaWwgIT09IHN0ZW5jaWxGYWlsIHx8CgkJCQkJICAgICBjdXJyZW50U3RlbmNpbFpGYWlsICE9PSBzdGVuY2lsWkZhaWwgfHwKCQkJCQkgICAgIGN1cnJlbnRTdGVuY2lsWlBhc3MgIT09IHN0ZW5jaWxaUGFzcyApIHsKCgkJCQkJCWdsLnN0ZW5jaWxPcCggc3RlbmNpbEZhaWwsIHN0ZW5jaWxaRmFpbCwgc3RlbmNpbFpQYXNzICk7CgoJCQkJCQljdXJyZW50U3RlbmNpbEZhaWwgPSBzdGVuY2lsRmFpbDsKCQkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IHN0ZW5jaWxaRmFpbDsKCQkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IHN0ZW5jaWxaUGFzczsKCgkJCQkJfQoKCQkJCX0sCgoJCQkJc2V0TG9ja2VkOiBmdW5jdGlvbiAoIGxvY2sgKSB7CgoJCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQkJfSwKCgkJCQlzZXRDbGVhcjogZnVuY3Rpb24gKCBzdGVuY2lsICkgewoKCQkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsQ2xlYXIgIT09IHN0ZW5jaWwgKSB7CgoJCQkJCQlnbC5jbGVhclN0ZW5jaWwoIHN0ZW5jaWwgKTsKCQkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IHN0ZW5jaWw7CgoJCQkJCX0KCgkJCQl9LAoKCQkJCXJlc2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCQljdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuYyA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxSZWYgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwoJCQkJCWN1cnJlbnRTdGVuY2lsRmFpbCA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CgkJCQkJY3VycmVudFN0ZW5jaWxDbGVhciA9IG51bGw7CgoJCQkJfQoKCQkJfTsKCgkJfQoKCQkvLwoKCQljb25zdCBjb2xvckJ1ZmZlciA9IG5ldyBDb2xvckJ1ZmZlcigpOwoJCWNvbnN0IGRlcHRoQnVmZmVyID0gbmV3IERlcHRoQnVmZmVyKCk7CgkJY29uc3Qgc3RlbmNpbEJ1ZmZlciA9IG5ldyBTdGVuY2lsQnVmZmVyKCk7CgoJCWNvbnN0IHVib0JpbmRpbmdzID0gbmV3IFdlYWtNYXAoKTsKCQljb25zdCB1Ym9Qcm9ncmFtTWFwID0gbmV3IFdlYWtNYXAoKTsKCgkJbGV0IGVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKCgkJbGV0IGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVycyA9IHt9OwoJCWxldCBjdXJyZW50RHJhd2J1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwoJCWxldCBkZWZhdWx0RHJhd2J1ZmZlcnMgPSBbXTsKCgkJbGV0IGN1cnJlbnRQcm9ncmFtID0gbnVsbDsKCgkJbGV0IGN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCQlsZXQgY3VycmVudEJsZW5kaW5nID0gbnVsbDsKCQlsZXQgY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmRTcmMgPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmREc3QgPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKCQlsZXQgY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCWxldCBjdXJyZW50QmxlbmREc3RBbHBoYSA9IG51bGw7CgkJbGV0IGN1cnJlbnRCbGVuZENvbG9yID0gbmV3IENvbG9yKCAwLCAwLCAwICk7CgkJbGV0IGN1cnJlbnRCbGVuZEFscGhhID0gMDsKCQlsZXQgY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gZmFsc2U7CgoJCWxldCBjdXJyZW50RmxpcFNpZGVkID0gbnVsbDsKCQlsZXQgY3VycmVudEN1bGxGYWNlID0gbnVsbDsKCgkJbGV0IGN1cnJlbnRMaW5lV2lkdGggPSBudWxsOwoKCQlsZXQgY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBudWxsOwoJCWxldCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gbnVsbDsKCgkJY29uc3QgbWF4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9DT01CSU5FRF9URVhUVVJFX0lNQUdFX1VOSVRTICk7CgoJCWxldCBsaW5lV2lkdGhBdmFpbGFibGUgPSBmYWxzZTsKCQlsZXQgdmVyc2lvbiA9IDA7CgkJY29uc3QgZ2xWZXJzaW9uID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5WRVJTSU9OICk7CgoJCWlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdXZWJHTCcgKSAhPT0gLTEgKSB7CgoJCQl2ZXJzaW9uID0gcGFyc2VGbG9hdCggL15XZWJHTCAoXGQpLy5leGVjKCBnbFZlcnNpb24gKVsgMSBdICk7CgkJCWxpbmVXaWR0aEF2YWlsYWJsZSA9ICggdmVyc2lvbiA+PSAxLjAgKTsKCgkJfSBlbHNlIGlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdPcGVuR0wgRVMnICkgIT09IC0xICkgewoKCQkJdmVyc2lvbiA9IHBhcnNlRmxvYXQoIC9eT3BlbkdMIEVTIChcZCkvLmV4ZWMoIGdsVmVyc2lvbiApWyAxIF0gKTsKCQkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDIuMCApOwoKCQl9CgoJCWxldCBjdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJCWxldCBjdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCQljb25zdCBzY2lzc29yUGFyYW0gPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLlNDSVNTT1JfQk9YICk7CgkJY29uc3Qgdmlld3BvcnRQYXJhbSA9IGdsLmdldFBhcmFtZXRlciggZ2wuVklFV1BPUlQgKTsKCgkJY29uc3QgY3VycmVudFNjaXNzb3IgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggc2Npc3NvclBhcmFtICk7CgkJY29uc3QgY3VycmVudFZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKS5mcm9tQXJyYXkoIHZpZXdwb3J0UGFyYW0gKTsKCgkJZnVuY3Rpb24gY3JlYXRlVGV4dHVyZSggdHlwZSwgdGFyZ2V0LCBjb3VudCwgZGltZW5zaW9ucyApIHsKCgkJCWNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSggNCApOyAvLyA0IGlzIHJlcXVpcmVkIHRvIG1hdGNoIGRlZmF1bHQgdW5wYWNrIGFsaWdubWVudCBvZiA0LgoJCQljb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJZ2wuYmluZFRleHR1cmUoIHR5cGUsIHRleHR1cmUgKTsKCQkJZ2wudGV4UGFyYW1ldGVyaSggdHlwZSwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUICk7CgkJCWdsLnRleFBhcmFtZXRlcmkoIHR5cGUsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVCApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgoJCQkJaWYgKCB0eXBlID09PSBnbC5URVhUVVJFXzNEIHx8IHR5cGUgPT09IGdsLlRFWFRVUkVfMkRfQVJSQVkgKSB7CgoJCQkJCWdsLnRleEltYWdlM0QoIHRhcmdldCwgMCwgZ2wuUkdCQSwgMSwgMSwgZGltZW5zaW9ucywgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgZGF0YSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWdsLnRleEltYWdlMkQoIHRhcmdldCArIGksIDAsIGdsLlJHQkEsIDEsIDEsIDAsIGdsLlJHQkEsIGdsLlVOU0lHTkVEX0JZVEUsIGRhdGEgKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gdGV4dHVyZTsKCgkJfQoKCQljb25zdCBlbXB0eVRleHR1cmVzID0ge307CgkJZW1wdHlUZXh0dXJlc1sgZ2wuVEVYVFVSRV8yRCBdID0gY3JlYXRlVGV4dHVyZSggZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV8yRCwgMSApOwoJCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfQ1VCRV9NQVAgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCwgNiApOwoJCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfMkRfQVJSQVkgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfMkRfQVJSQVksIGdsLlRFWFRVUkVfMkRfQVJSQVksIDEsIDEgKTsKCQllbXB0eVRleHR1cmVzWyBnbC5URVhUVVJFXzNEIF0gPSBjcmVhdGVUZXh0dXJlKCBnbC5URVhUVVJFXzNELCBnbC5URVhUVVJFXzNELCAxLCAxICk7CgoJCS8vIGluaXQKCgkJY29sb3JCdWZmZXIuc2V0Q2xlYXIoIDAsIDAsIDAsIDEgKTsKCQlkZXB0aEJ1ZmZlci5zZXRDbGVhciggMSApOwoJCXN0ZW5jaWxCdWZmZXIuc2V0Q2xlYXIoIDAgKTsKCgkJZW5hYmxlKCBnbC5ERVBUSF9URVNUICk7CgkJZGVwdGhCdWZmZXIuc2V0RnVuYyggTGVzc0VxdWFsRGVwdGggKTsKCgkJc2V0RmxpcFNpZGVkKCBmYWxzZSApOwoJCXNldEN1bGxGYWNlKCBDdWxsRmFjZUJhY2sgKTsKCQllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQlzZXRCbGVuZGluZyggTm9CbGVuZGluZyApOwoKCQkvLwoKCQlmdW5jdGlvbiBlbmFibGUoIGlkICkgewoKCQkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSB0cnVlICkgewoKCQkJCWdsLmVuYWJsZSggaWQgKTsKCQkJCWVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gPSB0cnVlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGRpc2FibGUoIGlkICkgewoKCQkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSBmYWxzZSApIHsKCgkJCQlnbC5kaXNhYmxlKCBpZCApOwoJCQkJZW5hYmxlZENhcGFiaWxpdGllc1sgaWQgXSA9IGZhbHNlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGJpbmRGcmFtZWJ1ZmZlciggdGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCgkJCWlmICggY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSAhPT0gZnJhbWVidWZmZXIgKSB7CgoJCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCB0YXJnZXQsIGZyYW1lYnVmZmVyICk7CgoJCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSA9IGZyYW1lYnVmZmVyOwoKCQkJCS8vIGdsLkRSQVdfRlJBTUVCVUZGRVIgaXMgZXF1aXZhbGVudCB0byBnbC5GUkFNRUJVRkZFUgoKCQkJCWlmICggdGFyZ2V0ID09PSBnbC5EUkFXX0ZSQU1FQlVGRkVSICkgewoKCQkJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIGdsLkZSQU1FQlVGRkVSIF0gPSBmcmFtZWJ1ZmZlcjsKCgkJCQl9CgoJCQkJaWYgKCB0YXJnZXQgPT09IGdsLkZSQU1FQlVGRkVSICkgewoKCQkJCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnNbIGdsLkRSQVdfRlJBTUVCVUZGRVIgXSA9IGZyYW1lYnVmZmVyOwoKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0KCgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCQlmdW5jdGlvbiBkcmF3QnVmZmVycyggcmVuZGVyVGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCgkJCWxldCBkcmF3QnVmZmVycyA9IGRlZmF1bHREcmF3YnVmZmVyczsKCgkJCWxldCBuZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJCQkJZHJhd0J1ZmZlcnMgPSBjdXJyZW50RHJhd2J1ZmZlcnMuZ2V0KCBmcmFtZWJ1ZmZlciApOwoKCQkJCWlmICggZHJhd0J1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJZHJhd0J1ZmZlcnMgPSBbXTsKCQkJCQljdXJyZW50RHJhd2J1ZmZlcnMuc2V0KCBmcmFtZWJ1ZmZlciwgZHJhd0J1ZmZlcnMgKTsKCgkJCQl9CgoJCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgoJCQkJaWYgKCBkcmF3QnVmZmVycy5sZW5ndGggIT09IHRleHR1cmVzLmxlbmd0aCB8fCBkcmF3QnVmZmVyc1sgMCBdICE9PSBnbC5DT0xPUl9BVFRBQ0hNRU5UMCApIHsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJZHJhd0J1ZmZlcnNbIGkgXSA9IGdsLkNPTE9SX0FUVEFDSE1FTlQwICsgaTsKCgkJCQkJfQoKCQkJCQlkcmF3QnVmZmVycy5sZW5ndGggPSB0ZXh0dXJlcy5sZW5ndGg7CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggZHJhd0J1ZmZlcnNbIDAgXSAhPT0gZ2wuQkFDSyApIHsKCgkJCQkJZHJhd0J1ZmZlcnNbIDAgXSA9IGdsLkJBQ0s7CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIG5lZWRzVXBkYXRlICkgewoKCQkJCWdsLmRyYXdCdWZmZXJzKCBkcmF3QnVmZmVycyApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVzZVByb2dyYW0oIHByb2dyYW0gKSB7CgoJCQlpZiAoIGN1cnJlbnRQcm9ncmFtICE9PSBwcm9ncmFtICkgewoKCQkJCWdsLnVzZVByb2dyYW0oIHByb2dyYW0gKTsKCgkJCQljdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CgoJCQkJcmV0dXJuIHRydWU7CgoJCQl9CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJY29uc3QgZXF1YXRpb25Ub0dMID0gewoJCQlbIEFkZEVxdWF0aW9uIF06IGdsLkZVTkNfQURELAoJCQlbIFN1YnRyYWN0RXF1YXRpb24gXTogZ2wuRlVOQ19TVUJUUkFDVCwKCQkJWyBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiBdOiBnbC5GVU5DX1JFVkVSU0VfU1VCVFJBQ1QKCQl9OwoKCQllcXVhdGlvblRvR0xbIE1pbkVxdWF0aW9uIF0gPSBnbC5NSU47CgkJZXF1YXRpb25Ub0dMWyBNYXhFcXVhdGlvbiBdID0gZ2wuTUFYOwoKCQljb25zdCBmYWN0b3JUb0dMID0gewoJCQlbIFplcm9GYWN0b3IgXTogZ2wuWkVSTywKCQkJWyBPbmVGYWN0b3IgXTogZ2wuT05FLAoJCQlbIFNyY0NvbG9yRmFjdG9yIF06IGdsLlNSQ19DT0xPUiwKCQkJWyBTcmNBbHBoYUZhY3RvciBdOiBnbC5TUkNfQUxQSEEsCgkJCVsgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciBdOiBnbC5TUkNfQUxQSEFfU0FUVVJBVEUsCgkJCVsgRHN0Q29sb3JGYWN0b3IgXTogZ2wuRFNUX0NPTE9SLAoJCQlbIERzdEFscGhhRmFjdG9yIF06IGdsLkRTVF9BTFBIQSwKCQkJWyBPbmVNaW51c1NyY0NvbG9yRmFjdG9yIF06IGdsLk9ORV9NSU5VU19TUkNfQ09MT1IsCgkJCVsgT25lTWludXNTcmNBbHBoYUZhY3RvciBdOiBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLAoJCQlbIE9uZU1pbnVzRHN0Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0RTVF9DT0xPUiwKCQkJWyBPbmVNaW51c0RzdEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19EU1RfQUxQSEEsCgkJCVsgQ29uc3RhbnRDb2xvckZhY3RvciBdOiBnbC5DT05TVEFOVF9DT0xPUiwKCQkJWyBPbmVNaW51c0NvbnN0YW50Q29sb3JGYWN0b3IgXTogZ2wuT05FX01JTlVTX0NPTlNUQU5UX0NPTE9SLAoJCQlbIENvbnN0YW50QWxwaGFGYWN0b3IgXTogZ2wuQ09OU1RBTlRfQUxQSEEsCgkJCVsgT25lTWludXNDb25zdGFudEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19DT05TVEFOVF9BTFBIQQoJCX07CgoJCWZ1bmN0aW9uIHNldEJsZW5kaW5nKCBibGVuZGluZywgYmxlbmRFcXVhdGlvbiwgYmxlbmRTcmMsIGJsZW5kRHN0LCBibGVuZEVxdWF0aW9uQWxwaGEsIGJsZW5kU3JjQWxwaGEsIGJsZW5kRHN0QWxwaGEsIGJsZW5kQ29sb3IsIGJsZW5kQWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJCWlmICggYmxlbmRpbmcgPT09IE5vQmxlbmRpbmcgKSB7CgoJCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSB0cnVlICkgewoKCQkJCQlkaXNhYmxlKCBnbC5CTEVORCApOwoJCQkJCWN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCgkJCQl9CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSBmYWxzZSApIHsKCgkJCQllbmFibGUoIGdsLkJMRU5EICk7CgkJCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICggYmxlbmRpbmcgIT09IEN1c3RvbUJsZW5kaW5nICkgewoKCQkJCWlmICggYmxlbmRpbmcgIT09IGN1cnJlbnRCbGVuZGluZyB8fCBwcmVtdWx0aXBsaWVkQWxwaGEgIT09IGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSApIHsKCgkJCQkJaWYgKCBjdXJyZW50QmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gfHwgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSAhPT0gQWRkRXF1YXRpb24gKSB7CgoJCQkJCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwoKCQkJCQkJY3VycmVudEJsZW5kRXF1YXRpb24gPSBBZGRFcXVhdGlvbjsKCQkJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IEFkZEVxdWF0aW9uOwoKCQkJCQl9CgoJCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgoJCQkJCQkJY2FzZSBOb3JtYWxCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIEFkZGl0aXZlQmxlbmRpbmc6CgkJCQkJCQkJZ2wuYmxlbmRGdW5jKCBnbC5PTkUsIGdsLk9ORSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgU3VidHJhY3RpdmVCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwgZ2wuWkVSTywgZ2wuT05FICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBNdWx0aXBseUJsZW5kaW5nOgoJCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5EU1RfQ09MT1IsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLlpFUk8sIGdsLk9ORSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWRlZmF1bHQ6CgkJCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6IEludmFsaWQgYmxlbmRpbmc6ICcsIGJsZW5kaW5nICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzd2l0Y2ggKCBibGVuZGluZyApIHsKCgkJCQkJCQljYXNlIE5vcm1hbEJsZW5kaW5nOgoJCQkJCQkJCWdsLmJsZW5kRnVuY1NlcGFyYXRlKCBnbC5TUkNfQUxQSEEsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKCQkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORSwgZ2wuT05FICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgoJCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBTdWJ0cmFjdGl2ZUJsZW5kaW5nIHJlcXVpcmVzIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUnICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJY2FzZSBNdWx0aXBseUJsZW5kaW5nOgoJCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBNdWx0aXBseUJsZW5kaW5nIHJlcXVpcmVzIG1hdGVyaWFsLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUnICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJZGVmYXVsdDoKCQkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTogSW52YWxpZCBibGVuZGluZzogJywgYmxlbmRpbmcgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQljdXJyZW50QmxlbmRTcmMgPSBudWxsOwoJCQkJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CgkJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCQkJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKCQkJCQljdXJyZW50QmxlbmRDb2xvci5zZXQoIDAsIDAsIDAgKTsKCQkJCQljdXJyZW50QmxlbmRBbHBoYSA9IDA7CgoJCQkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCQkJCWN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IHByZW11bHRpcGxpZWRBbHBoYTsKCgkJCQl9CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJLy8gY3VzdG9tIGJsZW5kaW5nCgoJCQlibGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGEgfHwgYmxlbmRFcXVhdGlvbjsKCQkJYmxlbmRTcmNBbHBoYSA9IGJsZW5kU3JjQWxwaGEgfHwgYmxlbmRTcmM7CgkJCWJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhIHx8IGJsZW5kRHN0OwoKCQkJaWYgKCBibGVuZEVxdWF0aW9uICE9PSBjdXJyZW50QmxlbmRFcXVhdGlvbiB8fCBibGVuZEVxdWF0aW9uQWxwaGEgIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgKSB7CgoJCQkJZ2wuYmxlbmRFcXVhdGlvblNlcGFyYXRlKCBlcXVhdGlvblRvR0xbIGJsZW5kRXF1YXRpb24gXSwgZXF1YXRpb25Ub0dMWyBibGVuZEVxdWF0aW9uQWxwaGEgXSApOwoKCQkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gYmxlbmRFcXVhdGlvbjsKCQkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGE7CgoJCQl9CgoJCQlpZiAoIGJsZW5kU3JjICE9PSBjdXJyZW50QmxlbmRTcmMgfHwgYmxlbmREc3QgIT09IGN1cnJlbnRCbGVuZERzdCB8fCBibGVuZFNyY0FscGhhICE9PSBjdXJyZW50QmxlbmRTcmNBbHBoYSB8fCBibGVuZERzdEFscGhhICE9PSBjdXJyZW50QmxlbmREc3RBbHBoYSApIHsKCgkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZmFjdG9yVG9HTFsgYmxlbmRTcmMgXSwgZmFjdG9yVG9HTFsgYmxlbmREc3QgXSwgZmFjdG9yVG9HTFsgYmxlbmRTcmNBbHBoYSBdLCBmYWN0b3JUb0dMWyBibGVuZERzdEFscGhhIF0gKTsKCgkJCQljdXJyZW50QmxlbmRTcmMgPSBibGVuZFNyYzsKCQkJCWN1cnJlbnRCbGVuZERzdCA9IGJsZW5kRHN0OwoJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBibGVuZFNyY0FscGhhOwoJCQkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBibGVuZERzdEFscGhhOwoKCQkJfQoKCQkJaWYgKCBibGVuZENvbG9yLmVxdWFscyggY3VycmVudEJsZW5kQ29sb3IgKSA9PT0gZmFsc2UgfHwgYmxlbmRBbHBoYSAhPT0gY3VycmVudEJsZW5kQWxwaGEgKSB7CgoJCQkJZ2wuYmxlbmRDb2xvciggYmxlbmRDb2xvci5yLCBibGVuZENvbG9yLmcsIGJsZW5kQ29sb3IuYiwgYmxlbmRBbHBoYSApOwoKCQkJCWN1cnJlbnRCbGVuZENvbG9yLmNvcHkoIGJsZW5kQ29sb3IgKTsKCQkJCWN1cnJlbnRCbGVuZEFscGhhID0gYmxlbmRBbHBoYTsKCgkJCX0KCgkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCgkJfQoKCQlmdW5jdGlvbiBzZXRNYXRlcmlhbCggbWF0ZXJpYWwsIGZyb250RmFjZUNXICkgewoKCQkJbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZQoJCQkJPyBkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKQoJCQkJOiBlbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQkJbGV0IGZsaXBTaWRlZCA9ICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKTsKCQkJaWYgKCBmcm9udEZhY2VDVyApIGZsaXBTaWRlZCA9ICEgZmxpcFNpZGVkOwoKCQkJc2V0RmxpcFNpZGVkKCBmbGlwU2lkZWQgKTsKCgkJCSggbWF0ZXJpYWwuYmxlbmRpbmcgPT09IE5vcm1hbEJsZW5kaW5nICYmIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSBmYWxzZSApCgkJCQk/IHNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICkKCQkJCTogc2V0QmxlbmRpbmcoIG1hdGVyaWFsLmJsZW5kaW5nLCBtYXRlcmlhbC5ibGVuZEVxdWF0aW9uLCBtYXRlcmlhbC5ibGVuZFNyYywgbWF0ZXJpYWwuYmxlbmREc3QsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb25BbHBoYSwgbWF0ZXJpYWwuYmxlbmRTcmNBbHBoYSwgbWF0ZXJpYWwuYmxlbmREc3RBbHBoYSwgbWF0ZXJpYWwuYmxlbmRDb2xvciwgbWF0ZXJpYWwuYmxlbmRBbHBoYSwgbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhICk7CgoJCQlkZXB0aEJ1ZmZlci5zZXRGdW5jKCBtYXRlcmlhbC5kZXB0aEZ1bmMgKTsKCQkJZGVwdGhCdWZmZXIuc2V0VGVzdCggbWF0ZXJpYWwuZGVwdGhUZXN0ICk7CgkJCWRlcHRoQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLmRlcHRoV3JpdGUgKTsKCQkJY29sb3JCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuY29sb3JXcml0ZSApOwoKCQkJY29uc3Qgc3RlbmNpbFdyaXRlID0gbWF0ZXJpYWwuc3RlbmNpbFdyaXRlOwoJCQlzdGVuY2lsQnVmZmVyLnNldFRlc3QoIHN0ZW5jaWxXcml0ZSApOwoJCQlpZiAoIHN0ZW5jaWxXcml0ZSApIHsKCgkJCQlzdGVuY2lsQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLnN0ZW5jaWxXcml0ZU1hc2sgKTsKCQkJCXN0ZW5jaWxCdWZmZXIuc2V0RnVuYyggbWF0ZXJpYWwuc3RlbmNpbEZ1bmMsIG1hdGVyaWFsLnN0ZW5jaWxSZWYsIG1hdGVyaWFsLnN0ZW5jaWxGdW5jTWFzayApOwoJCQkJc3RlbmNpbEJ1ZmZlci5zZXRPcCggbWF0ZXJpYWwuc3RlbmNpbEZhaWwsIG1hdGVyaWFsLnN0ZW5jaWxaRmFpbCwgbWF0ZXJpYWwuc3RlbmNpbFpQYXNzICk7CgoJCQl9CgoJCQlzZXRQb2x5Z29uT2Zmc2V0KCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0LCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0RmFjdG9yLCBtYXRlcmlhbC5wb2x5Z29uT2Zmc2V0VW5pdHMgKTsKCgkJCW1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZSA9PT0gdHJ1ZQoJCQkJPyBlbmFibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApCgkJCQk6IGRpc2FibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIHNldEZsaXBTaWRlZCggZmxpcFNpZGVkICkgewoKCQkJaWYgKCBjdXJyZW50RmxpcFNpZGVkICE9PSBmbGlwU2lkZWQgKSB7CgoJCQkJaWYgKCBmbGlwU2lkZWQgKSB7CgoJCQkJCWdsLmZyb250RmFjZSggZ2wuQ1cgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKCQkJCX0KCgkJCQljdXJyZW50RmxpcFNpZGVkID0gZmxpcFNpZGVkOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHNldEN1bGxGYWNlKCBjdWxsRmFjZSApIHsKCgkJCWlmICggY3VsbEZhY2UgIT09IEN1bGxGYWNlTm9uZSApIHsKCgkJCQllbmFibGUoIGdsLkNVTExfRkFDRSApOwoKCQkJCWlmICggY3VsbEZhY2UgIT09IGN1cnJlbnRDdWxsRmFjZSApIHsKCgkJCQkJaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VCYWNrICkgewoKCQkJCQkJZ2wuY3VsbEZhY2UoIGdsLkJBQ0sgKTsKCgkJCQkJfSBlbHNlIGlmICggY3VsbEZhY2UgPT09IEN1bGxGYWNlRnJvbnQgKSB7CgoJCQkJCQlnbC5jdWxsRmFjZSggZ2wuRlJPTlQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWdsLmN1bGxGYWNlKCBnbC5GUk9OVF9BTkRfQkFDSyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCgkJCX0KCgkJCWN1cnJlbnRDdWxsRmFjZSA9IGN1bGxGYWNlOwoKCQl9CgoJCWZ1bmN0aW9uIHNldExpbmVXaWR0aCggd2lkdGggKSB7CgoJCQlpZiAoIHdpZHRoICE9PSBjdXJyZW50TGluZVdpZHRoICkgewoKCQkJCWlmICggbGluZVdpZHRoQXZhaWxhYmxlICkgZ2wubGluZVdpZHRoKCB3aWR0aCApOwoKCQkJCWN1cnJlbnRMaW5lV2lkdGggPSB3aWR0aDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBzZXRQb2x5Z29uT2Zmc2V0KCBwb2x5Z29uT2Zmc2V0LCBmYWN0b3IsIHVuaXRzICkgewoKCQkJaWYgKCBwb2x5Z29uT2Zmc2V0ICkgewoKCQkJCWVuYWJsZSggZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCApOwoKCQkJCWlmICggY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgIT09IGZhY3RvciB8fCBjdXJyZW50UG9seWdvbk9mZnNldFVuaXRzICE9PSB1bml0cyApIHsKCgkJCQkJZ2wucG9seWdvbk9mZnNldCggZmFjdG9yLCB1bml0cyApOwoKCQkJCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IGZhY3RvcjsKCQkJCQljdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gdW5pdHM7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc2V0U2Npc3NvclRlc3QoIHNjaXNzb3JUZXN0ICkgewoKCQkJaWYgKCBzY2lzc29yVGVzdCApIHsKCgkJCQllbmFibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoKCQkJfSBlbHNlIHsKCgkJCQlkaXNhYmxlKCBnbC5TQ0lTU09SX1RFU1QgKTsKCgkJCX0KCgkJfQoKCQkvLyB0ZXh0dXJlCgoJCWZ1bmN0aW9uIGFjdGl2ZVRleHR1cmUoIHdlYmdsU2xvdCApIHsKCgkJCWlmICggd2ViZ2xTbG90ID09PSB1bmRlZmluZWQgKSB3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCgkJCWlmICggY3VycmVudFRleHR1cmVTbG90ICE9PSB3ZWJnbFNsb3QgKSB7CgoJCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CgkJCQljdXJyZW50VGV4dHVyZVNsb3QgPSB3ZWJnbFNsb3Q7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gYmluZFRleHR1cmUoIHdlYmdsVHlwZSwgd2ViZ2xUZXh0dXJlLCB3ZWJnbFNsb3QgKSB7CgoJCQlpZiAoIHdlYmdsU2xvdCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWlmICggY3VycmVudFRleHR1cmVTbG90ID09PSBudWxsICkgewoKCQkJCQl3ZWJnbFNsb3QgPSBnbC5URVhUVVJFMCArIG1heFRleHR1cmVzIC0gMTsKCgkJCQl9IGVsc2UgewoKCQkJCQl3ZWJnbFNsb3QgPSBjdXJyZW50VGV4dHVyZVNsb3Q7CgoJCQkJfQoKCQkJfQoKCQkJbGV0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzWyB3ZWJnbFNsb3QgXTsKCgkJCWlmICggYm91bmRUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJYm91bmRUZXh0dXJlID0geyB0eXBlOiB1bmRlZmluZWQsIHRleHR1cmU6IHVuZGVmaW5lZCB9OwoJCQkJY3VycmVudEJvdW5kVGV4dHVyZXNbIHdlYmdsU2xvdCBdID0gYm91bmRUZXh0dXJlOwoKCQkJfQoKCQkJaWYgKCBib3VuZFRleHR1cmUudHlwZSAhPT0gd2ViZ2xUeXBlIHx8IGJvdW5kVGV4dHVyZS50ZXh0dXJlICE9PSB3ZWJnbFRleHR1cmUgKSB7CgoJCQkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCgkJCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CgkJCQkJY3VycmVudFRleHR1cmVTbG90ID0gd2ViZ2xTbG90OwoKCQkJCX0KCgkJCQlnbC5iaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUgfHwgZW1wdHlUZXh0dXJlc1sgd2ViZ2xUeXBlIF0gKTsKCgkJCQlib3VuZFRleHR1cmUudHlwZSA9IHdlYmdsVHlwZTsKCQkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gd2ViZ2xUZXh0dXJlOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVuYmluZFRleHR1cmUoKSB7CgoJCQljb25zdCBib3VuZFRleHR1cmUgPSBjdXJyZW50Qm91bmRUZXh0dXJlc1sgY3VycmVudFRleHR1cmVTbG90IF07CgoJCQlpZiAoIGJvdW5kVGV4dHVyZSAhPT0gdW5kZWZpbmVkICYmIGJvdW5kVGV4dHVyZS50eXBlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZ2wuYmluZFRleHR1cmUoIGJvdW5kVGV4dHVyZS50eXBlLCBudWxsICk7CgoJCQkJYm91bmRUZXh0dXJlLnR5cGUgPSB1bmRlZmluZWQ7CgkJCQlib3VuZFRleHR1cmUudGV4dHVyZSA9IHVuZGVmaW5lZDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBjb21wcmVzc2VkVGV4SW1hZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wuY29tcHJlc3NlZFRleEltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29tcHJlc3NlZFRleEltYWdlM0QoKSB7CgoJCQl0cnkgewoKCQkJCWdsLmNvbXByZXNzZWRUZXhJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleFN1YkltYWdlMkQoKSB7CgoJCQl0cnkgewoKCQkJCWdsLnRleFN1YkltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdGV4U3ViSW1hZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4U3ViSW1hZ2UzRCggLi4uYXJndW1lbnRzICk7CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29tcHJlc3NlZFRleFN1YkltYWdlM0QoKSB7CgoJCQl0cnkgewoKCQkJCWdsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleFN0b3JhZ2UyRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4U3RvcmFnZTJEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleFN0b3JhZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4U3RvcmFnZTNEKCAuLi5hcmd1bWVudHMgKTsKCgkJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRleEltYWdlMkQoKSB7CgoJCQl0cnkgewoKCQkJCWdsLnRleEltYWdlMkQoIC4uLmFyZ3VtZW50cyApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdGV4SW1hZ2UzRCgpIHsKCgkJCXRyeSB7CgoJCQkJZ2wudGV4SW1hZ2UzRCggLi4uYXJndW1lbnRzICk7CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiBzY2lzc29yKCBzY2lzc29yICkgewoKCQkJaWYgKCBjdXJyZW50U2Npc3Nvci5lcXVhbHMoIHNjaXNzb3IgKSA9PT0gZmFsc2UgKSB7CgoJCQkJZ2wuc2Npc3Nvciggc2Npc3Nvci54LCBzY2lzc29yLnksIHNjaXNzb3Iueiwgc2Npc3Nvci53ICk7CgkJCQljdXJyZW50U2Npc3Nvci5jb3B5KCBzY2lzc29yICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdmlld3BvcnQoIHZpZXdwb3J0ICkgewoKCQkJaWYgKCBjdXJyZW50Vmlld3BvcnQuZXF1YWxzKCB2aWV3cG9ydCApID09PSBmYWxzZSApIHsKCgkJCQlnbC52aWV3cG9ydCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQueiwgdmlld3BvcnQudyApOwoJCQkJY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlVUJPTWFwcGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJCWxldCBtYXBwaW5nID0gdWJvUHJvZ3JhbU1hcC5nZXQoIHByb2dyYW0gKTsKCgkJCWlmICggbWFwcGluZyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCW1hcHBpbmcgPSBuZXcgV2Vha01hcCgpOwoKCQkJCXVib1Byb2dyYW1NYXAuc2V0KCBwcm9ncmFtLCBtYXBwaW5nICk7CgoJCQl9CgoJCQlsZXQgYmxvY2tJbmRleCA9IG1hcHBpbmcuZ2V0KCB1bmlmb3Jtc0dyb3VwICk7CgoJCQlpZiAoIGJsb2NrSW5kZXggPT09IHVuZGVmaW5lZCApIHsKCgkJCQlibG9ja0luZGV4ID0gZ2wuZ2V0VW5pZm9ybUJsb2NrSW5kZXgoIHByb2dyYW0sIHVuaWZvcm1zR3JvdXAubmFtZSApOwoKCQkJCW1hcHBpbmcuc2V0KCB1bmlmb3Jtc0dyb3VwLCBibG9ja0luZGV4ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJCWNvbnN0IG1hcHBpbmcgPSB1Ym9Qcm9ncmFtTWFwLmdldCggcHJvZ3JhbSApOwoJCQljb25zdCBibG9ja0luZGV4ID0gbWFwcGluZy5nZXQoIHVuaWZvcm1zR3JvdXAgKTsKCgkJCWlmICggdWJvQmluZGluZ3MuZ2V0KCBwcm9ncmFtICkgIT09IGJsb2NrSW5kZXggKSB7CgoJCQkJLy8gYmluZCBzaGFkZXIgc3BlY2lmaWMgYmxvY2sgaW5kZXggdG8gZ2xvYmFsIGJsb2NrIHBvaW50CgkJCQlnbC51bmlmb3JtQmxvY2tCaW5kaW5nKCBwcm9ncmFtLCBibG9ja0luZGV4LCB1bmlmb3Jtc0dyb3VwLl9fYmluZGluZ1BvaW50SW5kZXggKTsKCgkJCQl1Ym9CaW5kaW5ncy5zZXQoIHByb2dyYW0sIGJsb2NrSW5kZXggKTsKCgkJCX0KCgkJfQoKCQkvLwoKCQlmdW5jdGlvbiByZXNldCgpIHsKCgkJCS8vIHJlc2V0IHN0YXRlCgoJCQlnbC5kaXNhYmxlKCBnbC5CTEVORCApOwoJCQlnbC5kaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCQkJZ2wuZGlzYWJsZSggZ2wuREVQVEhfVEVTVCApOwoJCQlnbC5kaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgkJCWdsLmRpc2FibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoJCQlnbC5kaXNhYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKCQkJZ2wuZGlzYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICk7CgoJCQlnbC5ibGVuZEVxdWF0aW9uKCBnbC5GVU5DX0FERCApOwoJCQlnbC5ibGVuZEZ1bmMoIGdsLk9ORSwgZ2wuWkVSTyApOwoJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5aRVJPLCBnbC5PTkUsIGdsLlpFUk8gKTsKCQkJZ2wuYmxlbmRDb2xvciggMCwgMCwgMCwgMCApOwoKCQkJZ2wuY29sb3JNYXNrKCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlICk7CgkJCWdsLmNsZWFyQ29sb3IoIDAsIDAsIDAsIDAgKTsKCgkJCWdsLmRlcHRoTWFzayggdHJ1ZSApOwoJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFU1MgKTsKCgkJCWRlcHRoQnVmZmVyLnNldFJldmVyc2VkKCBmYWxzZSApOwoKCQkJZ2wuY2xlYXJEZXB0aCggMSApOwoKCQkJZ2wuc3RlbmNpbE1hc2soIDB4ZmZmZmZmZmYgKTsKCQkJZ2wuc3RlbmNpbEZ1bmMoIGdsLkFMV0FZUywgMCwgMHhmZmZmZmZmZiApOwoJCQlnbC5zdGVuY2lsT3AoIGdsLktFRVAsIGdsLktFRVAsIGdsLktFRVAgKTsKCQkJZ2wuY2xlYXJTdGVuY2lsKCAwICk7CgoJCQlnbC5jdWxsRmFjZSggZ2wuQkFDSyApOwoJCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKCQkJZ2wucG9seWdvbk9mZnNldCggMCwgMCApOwoKCQkJZ2wuYWN0aXZlVGV4dHVyZSggZ2wuVEVYVFVSRTAgKTsKCgkJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgkJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoKCQkJZ2wudXNlUHJvZ3JhbSggbnVsbCApOwoKCQkJZ2wubGluZVdpZHRoKCAxICk7CgoJCQlnbC5zY2lzc29yKCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCQkJZ2wudmlld3BvcnQoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoKCQkJLy8gcmVzZXQgaW50ZXJuYWxzCgoJCQllbmFibGVkQ2FwYWJpbGl0aWVzID0ge307CgoJCQljdXJyZW50VGV4dHVyZVNsb3QgPSBudWxsOwoJCQljdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCQkJY3VycmVudEJvdW5kRnJhbWVidWZmZXJzID0ge307CgkJCWN1cnJlbnREcmF3YnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgkJCWRlZmF1bHREcmF3YnVmZmVycyA9IFtdOwoKCQkJY3VycmVudFByb2dyYW0gPSBudWxsOwoKCQkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwoJCQljdXJyZW50QmxlbmRpbmcgPSBudWxsOwoJCQljdXJyZW50QmxlbmRFcXVhdGlvbiA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBudWxsOwoJCQljdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CgkJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKCQkJY3VycmVudEJsZW5kQ29sb3IgPSBuZXcgQ29sb3IoIDAsIDAsIDAgKTsKCQkJY3VycmVudEJsZW5kQWxwaGEgPSAwOwoJCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCgkJCWN1cnJlbnRGbGlwU2lkZWQgPSBudWxsOwoJCQljdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKCQkJY3VycmVudExpbmVXaWR0aCA9IG51bGw7CgoJCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IG51bGw7CgkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKCQkJY3VycmVudFNjaXNzb3Iuc2V0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCQkJY3VycmVudFZpZXdwb3J0LnNldCggMCwgMCwgZ2wuY2FudmFzLndpZHRoLCBnbC5jYW52YXMuaGVpZ2h0ICk7CgoJCQljb2xvckJ1ZmZlci5yZXNldCgpOwoJCQlkZXB0aEJ1ZmZlci5yZXNldCgpOwoJCQlzdGVuY2lsQnVmZmVyLnJlc2V0KCk7CgoJCX0KCgkJcmV0dXJuIHsKCgkJCWJ1ZmZlcnM6IHsKCQkJCWNvbG9yOiBjb2xvckJ1ZmZlciwKCQkJCWRlcHRoOiBkZXB0aEJ1ZmZlciwKCQkJCXN0ZW5jaWw6IHN0ZW5jaWxCdWZmZXIKCQkJfSwKCgkJCWVuYWJsZTogZW5hYmxlLAoJCQlkaXNhYmxlOiBkaXNhYmxlLAoKCQkJYmluZEZyYW1lYnVmZmVyOiBiaW5kRnJhbWVidWZmZXIsCgkJCWRyYXdCdWZmZXJzOiBkcmF3QnVmZmVycywKCgkJCXVzZVByb2dyYW06IHVzZVByb2dyYW0sCgoJCQlzZXRCbGVuZGluZzogc2V0QmxlbmRpbmcsCgkJCXNldE1hdGVyaWFsOiBzZXRNYXRlcmlhbCwKCgkJCXNldEZsaXBTaWRlZDogc2V0RmxpcFNpZGVkLAoJCQlzZXRDdWxsRmFjZTogc2V0Q3VsbEZhY2UsCgoJCQlzZXRMaW5lV2lkdGg6IHNldExpbmVXaWR0aCwKCQkJc2V0UG9seWdvbk9mZnNldDogc2V0UG9seWdvbk9mZnNldCwKCgkJCXNldFNjaXNzb3JUZXN0OiBzZXRTY2lzc29yVGVzdCwKCgkJCWFjdGl2ZVRleHR1cmU6IGFjdGl2ZVRleHR1cmUsCgkJCWJpbmRUZXh0dXJlOiBiaW5kVGV4dHVyZSwKCQkJdW5iaW5kVGV4dHVyZTogdW5iaW5kVGV4dHVyZSwKCQkJY29tcHJlc3NlZFRleEltYWdlMkQ6IGNvbXByZXNzZWRUZXhJbWFnZTJELAoJCQljb21wcmVzc2VkVGV4SW1hZ2UzRDogY29tcHJlc3NlZFRleEltYWdlM0QsCgkJCXRleEltYWdlMkQ6IHRleEltYWdlMkQsCgkJCXRleEltYWdlM0Q6IHRleEltYWdlM0QsCgoJCQl1cGRhdGVVQk9NYXBwaW5nOiB1cGRhdGVVQk9NYXBwaW5nLAoJCQl1bmlmb3JtQmxvY2tCaW5kaW5nOiB1bmlmb3JtQmxvY2tCaW5kaW5nLAoKCQkJdGV4U3RvcmFnZTJEOiB0ZXhTdG9yYWdlMkQsCgkJCXRleFN0b3JhZ2UzRDogdGV4U3RvcmFnZTNELAoJCQl0ZXhTdWJJbWFnZTJEOiB0ZXhTdWJJbWFnZTJELAoJCQl0ZXhTdWJJbWFnZTNEOiB0ZXhTdWJJbWFnZTNELAoJCQljb21wcmVzc2VkVGV4U3ViSW1hZ2UyRDogY29tcHJlc3NlZFRleFN1YkltYWdlMkQsCgkJCWNvbXByZXNzZWRUZXhTdWJJbWFnZTNEOiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCwKCgkJCXNjaXNzb3I6IHNjaXNzb3IsCgkJCXZpZXdwb3J0OiB2aWV3cG9ydCwKCgkJCXJlc2V0OiByZXNldAoKCQl9OwoKCX0KCglmdW5jdGlvbiBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICkgewoKCQljb25zdCBtdWx0aXNhbXBsZWRSVFRFeHQgPSBleHRlbnNpb25zLmhhcyggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA/IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApIDogbnVsbDsKCQljb25zdCBzdXBwb3J0c0ludmFsaWRhdGVGcmFtZWJ1ZmZlciA9IHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnID8gZmFsc2UgOiAvT2N1bHVzQnJvd3Nlci9nLnRlc3QoIG5hdmlnYXRvci51c2VyQWdlbnQgKTsKCgkJY29uc3QgX2ltYWdlRGltZW5zaW9ucyA9IG5ldyBWZWN0b3IyKCk7CgkJY29uc3QgX3ZpZGVvVGV4dHVyZXMgPSBuZXcgV2Vha01hcCgpOwoJCWxldCBfY2FudmFzOwoKCQljb25zdCBfc291cmNlcyA9IG5ldyBXZWFrTWFwKCk7IC8vIG1hcHMgV2ViZ2xUZXh0dXJlIG9iamVjdHMgdG8gaW5zdGFuY2VzIG9mIFNvdXJjZQoKCQkvLyBjb3Jkb3ZhIGlPUyAoYXMgb2YgNS4wKSBzdGlsbCB1c2VzIFVJV2ViVmlldywgd2hpY2ggcHJvdmlkZXMgT2Zmc2NyZWVuQ2FudmFzLAoJCS8vIGFsc28gT2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIndlYmdsIiksIGJ1dCBub3QgT2Zmc2NyZWVuQ2FudmFzLmdldENvbnRleHQoIjJkIikhCgkJLy8gU29tZSBpbXBsZW1lbnRhdGlvbnMgbWF5IG9ubHkgaW1wbGVtZW50IE9mZnNjcmVlbkNhbnZhcyBwYXJ0aWFsbHkgKGUuZy4gbGFja2luZyAyZCkuCgoJCWxldCB1c2VPZmZzY3JlZW5DYW52YXMgPSBmYWxzZTsKCgkJdHJ5IHsKCgkJCXVzZU9mZnNjcmVlbkNhbnZhcyA9IHR5cGVvZiBPZmZzY3JlZW5DYW52YXMgIT09ICd1bmRlZmluZWQnCgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGF0L2NvbXBhdAoJCQkJJiYgKCBuZXcgT2Zmc2NyZWVuQ2FudmFzKCAxLCAxICkuZ2V0Q29udGV4dCggJzJkJyApICkgIT09IG51bGw7CgoJCX0gY2F0Y2ggKCBlcnIgKSB7CgoJCQkvLyBJZ25vcmUgYW55IGVycm9ycwoKCQl9CgoJCWZ1bmN0aW9uIGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIHsKCgkJCS8vIFVzZSBPZmZzY3JlZW5DYW52YXMgd2hlbiBhdmFpbGFibGUuIFNwZWNpYWxseSBuZWVkZWQgaW4gd2ViIHdvcmtlcnMKCgkJCXJldHVybiB1c2VPZmZzY3JlZW5DYW52YXMgPwoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNvbXBhdC9jb21wYXQKCQkJCW5ldyBPZmZzY3JlZW5DYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgkJfQoKCQlmdW5jdGlvbiByZXNpemVJbWFnZSggaW1hZ2UsIG5lZWRzTmV3Q2FudmFzLCBtYXhTaXplICkgewoKCQkJbGV0IHNjYWxlID0gMTsKCgkJCWNvbnN0IGRpbWVuc2lvbnMgPSBnZXREaW1lbnNpb25zKCBpbWFnZSApOwoKCQkJLy8gaGFuZGxlIGNhc2UgaWYgdGV4dHVyZSBleGNlZWRzIG1heCBzaXplCgoJCQlpZiAoIGRpbWVuc2lvbnMud2lkdGggPiBtYXhTaXplIHx8IGRpbWVuc2lvbnMuaGVpZ2h0ID4gbWF4U2l6ZSApIHsKCgkJCQlzY2FsZSA9IG1heFNpemUgLyBNYXRoLm1heCggZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCgkJCX0KCgkJCS8vIG9ubHkgcGVyZm9ybSByZXNpemUgaWYgbmVjZXNzYXJ5CgoJCQlpZiAoIHNjYWxlIDwgMSApIHsKCgkJCQkvLyBvbmx5IHBlcmZvcm0gcmVzaXplIGZvciBjZXJ0YWluIGltYWdlIHR5cGVzCgoJCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCQkJCSggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgfHwKCQkJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApIHx8CgkJCQkJKCB0eXBlb2YgVmlkZW9GcmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lICkgKSB7CgoJCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggc2NhbGUgKiBkaW1lbnNpb25zLndpZHRoICk7CgkJCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5mbG9vciggc2NhbGUgKiBkaW1lbnNpb25zLmhlaWdodCApOwoKCQkJCQlpZiAoIF9jYW52YXMgPT09IHVuZGVmaW5lZCApIF9jYW52YXMgPSBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkJLy8gY3ViZSB0ZXh0dXJlcyBjYW4ndCByZXVzZSB0aGUgc2FtZSBjYW52YXMKCgkJCQkJY29uc3QgY2FudmFzID0gbmVlZHNOZXdDYW52YXMgPyBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IF9jYW52YXM7CgoJCQkJCWNhbnZhcy53aWR0aCA9IHdpZHRoOwoJCQkJCWNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CgoJCQkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggJzJkJyApOwoJCQkJCWNvbnRleHQuZHJhd0ltYWdlKCBpbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGhhcyBiZWVuIHJlc2l6ZWQgZnJvbSAoJyArIGRpbWVuc2lvbnMud2lkdGggKyAneCcgKyBkaW1lbnNpb25zLmhlaWdodCArICcpIHRvICgnICsgd2lkdGggKyAneCcgKyBoZWlnaHQgKyAnKS4nICk7CgoJCQkJCXJldHVybiBjYW52YXM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCAnZGF0YScgaW4gaW1hZ2UgKSB7CgoJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBJbWFnZSBpbiBEYXRhVGV4dHVyZSBpcyB0b28gYmlnICgnICsgZGltZW5zaW9ucy53aWR0aCArICd4JyArIGRpbWVuc2lvbnMuaGVpZ2h0ICsgJykuJyApOwoKCQkJCQl9CgoJCQkJCXJldHVybiBpbWFnZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gaW1hZ2U7CgoJCX0KCgkJZnVuY3Rpb24gdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgewoKCQkJcmV0dXJuIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKSB7CgoJCQlfZ2wuZ2VuZXJhdGVNaXBtYXAoIHRhcmdldCApOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFRhcmdldFR5cGUoIHRleHR1cmUgKSB7CgoJCQlpZiAoIHRleHR1cmUuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgKSByZXR1cm4gX2dsLlRFWFRVUkVfQ1VCRV9NQVA7CgkJCWlmICggdGV4dHVyZS5pc1dlYkdMM0RSZW5kZXJUYXJnZXQgKSByZXR1cm4gX2dsLlRFWFRVUkVfM0Q7CgkJCWlmICggdGV4dHVyZS5pc1dlYkdMQXJyYXlSZW5kZXJUYXJnZXQgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSByZXR1cm4gX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgkJCXJldHVybiBfZ2wuVEVYVFVSRV8yRDsKCgkJfQoKCQlmdW5jdGlvbiBnZXRJbnRlcm5hbEZvcm1hdCggaW50ZXJuYWxGb3JtYXROYW1lLCBnbEZvcm1hdCwgZ2xUeXBlLCBjb2xvclNwYWNlLCBmb3JjZUxpbmVhclRyYW5zZmVyID0gZmFsc2UgKSB7CgoJCQlpZiAoIGludGVybmFsRm9ybWF0TmFtZSAhPT0gbnVsbCApIHsKCgkJCQlpZiAoIF9nbFsgaW50ZXJuYWxGb3JtYXROYW1lIF0gIT09IHVuZGVmaW5lZCApIHJldHVybiBfZ2xbIGludGVybmFsRm9ybWF0TmFtZSBdOwoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gdXNlIG5vbi1leGlzdGluZyBXZWJHTCBpbnRlcm5hbCBmb3JtYXQgXCcnICsgaW50ZXJuYWxGb3JtYXROYW1lICsgJ1wnJyApOwoKCQkJfQoKCQkJbGV0IGludGVybmFsRm9ybWF0ID0gZ2xGb3JtYXQ7CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkVEICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMzJGOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2RjsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4OwoKCQkJfQoKCQkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJFRF9JTlRFR0VSICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjhJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIxNkk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMkk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkcgKSB7CgoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJGOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkY7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzg7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdfSU5URUdFUiApIHsKCgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0JZVEUgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzhVSTsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzE2VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJVSTsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHOEk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHMzJJOwoKCQkJfQoKCQkJaWYgKCBnbEZvcm1hdCA9PT0gX2dsLlJHQl9JTlRFR0VSICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjhVSTsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IxNlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IzMlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOEk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCMTZJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0IzMkk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCQV9JTlRFR0VSICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkE4VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTE2VUk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX0lOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMlVJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQThJOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5TSE9SVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkExNkk7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLklOVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMkk7CgoJCQl9CgoJCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCICkgewoKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfSU5UXzVfOV85XzlfUkVWICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCOV9FNTsKCgkJCX0KCgkJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SR0JBICkgewoKCQkJCWNvbnN0IHRyYW5zZmVyID0gZm9yY2VMaW5lYXJUcmFuc2ZlciA/IExpbmVhclRyYW5zZmVyIDogQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkEzMkY7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkhBTEZfRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBMTZGOwoJCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IF9nbC5TUkdCOF9BTFBIQTggOiBfZ2wuUkdCQTg7CgkJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUXzRfNF80XzQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0JBNDsKCQkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQjVfQTE7CgoJCQl9CgoJCQlpZiAoIGludGVybmFsRm9ybWF0ID09PSBfZ2wuUjE2RiB8fCBpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlIzMkYgfHwKCQkJCWludGVybmFsRm9ybWF0ID09PSBfZ2wuUkcxNkYgfHwgaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SRzMyRiB8fAoJCQkJaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SR0JBMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUkdCQTMyRiApIHsKCgkJCQlleHRlbnNpb25zLmdldCggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICk7CgoJCQl9CgoJCQlyZXR1cm4gaW50ZXJuYWxGb3JtYXQ7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0SW50ZXJuYWxEZXB0aEZvcm1hdCggdXNlU3RlbmNpbCwgZGVwdGhUeXBlICkgewoKCQkJbGV0IGdsSW50ZXJuYWxGb3JtYXQ7CgkJCWlmICggdXNlU3RlbmNpbCApIHsKCgkJCQlpZiAoIGRlcHRoVHlwZSA9PT0gbnVsbCB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSDI0X1NURU5DSUw4OwoKCQkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gRmxvYXRUeXBlICkgewoKCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIMzJGX1NURU5DSUw4OwoKCQkJCX0gZWxzZSBpZiAoIGRlcHRoVHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSB7CgoJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBfZ2wuREVQVEgyNF9TVEVOQ0lMODsKCQkJCQljb25zb2xlLndhcm4oICdEZXB0aFRleHR1cmU6IDE2IGJpdCBkZXB0aCBhdHRhY2htZW50IGlzIG5vdCBzdXBwb3J0ZWQgd2l0aCBzdGVuY2lsLiBVc2luZyAyNC1iaXQgYXR0YWNobWVudC4nICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIGRlcHRoVHlwZSA9PT0gbnVsbCB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fCBkZXB0aFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQyNDsKCgkJCQl9IGVsc2UgaWYgKCBkZXB0aFR5cGUgPT09IEZsb2F0VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQzMkY7CgoJCQkJfSBlbHNlIGlmICggZGVwdGhUeXBlID09PSBVbnNpZ25lZFNob3J0VHlwZSApIHsKCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQxNjsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gZ2xJbnRlcm5hbEZvcm1hdDsKCgkJfQoKCQlmdW5jdGlvbiBnZXRNaXBMZXZlbHMoIHRleHR1cmUsIGltYWdlICkgewoKCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSA9PT0gdHJ1ZSB8fCAoIHRleHR1cmUuaXNGcmFtZWJ1ZmZlclRleHR1cmUgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlciApICkgewoKCQkJCXJldHVybiBNYXRoLmxvZzIoIE1hdGgubWF4KCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICkgKSArIDE7CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLm1pcG1hcHMgIT09IHVuZGVmaW5lZCAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkvLyB1c2VyLWRlZmluZWQgbWlwbWFwcwoKCQkJCXJldHVybiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOwoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICYmIEFycmF5LmlzQXJyYXkoIHRleHR1cmUuaW1hZ2UgKSApIHsKCgkJCQlyZXR1cm4gaW1hZ2UubWlwbWFwcy5sZW5ndGg7CgoJCQl9IGVsc2UgewoKCQkJCS8vIHRleHR1cmUgd2l0aG91dCBtaXBtYXBzIChvbmx5IGJhc2UgbGV2ZWwpCgoJCQkJcmV0dXJuIDE7CgoJCQl9CgoJCX0KCgkJLy8KCgkJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCWRlYWxsb2NhdGVUZXh0dXJlKCB0ZXh0dXJlICk7CgoJCQlpZiAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKSB7CgoJCQkJX3ZpZGVvVGV4dHVyZXMuZGVsZXRlKCB0ZXh0dXJlICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gb25SZW5kZXJUYXJnZXREaXNwb3NlKCBldmVudCApIHsKCgkJCWNvbnN0IHJlbmRlclRhcmdldCA9IGV2ZW50LnRhcmdldDsKCgkJCXJlbmRlclRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uUmVuZGVyVGFyZ2V0RGlzcG9zZSApOwoKCQkJZGVhbGxvY2F0ZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCX0KCgkJLy8KCgkJZnVuY3Rpb24gZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKSB7CgoJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZW1vdmUgdGhlIFdlYkdMVGV4dHVyZSBvYmplY3QKCgkJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoJCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCgkJCWlmICggd2ViZ2xUZXh0dXJlcyApIHsKCgkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5IF07CgkJCQl3ZWJnbFRleHR1cmUudXNlZFRpbWVzIC0tOwoKCQkJCS8vIHRoZSBXZWJHTFRleHR1cmUgb2JqZWN0IGlzIG5vdCB1c2VkIGFueW1vcmUsIHJlbW92ZSBpdAoKCQkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCQkJZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApOwoKCQkJCX0KCgkJCQkvLyByZW1vdmUgdGhlIHdlYWsgbWFwIGVudHJ5IGlmIG5vIFdlYkdMVGV4dHVyZSB1c2VzIHRoZSBzb3VyY2UgYW55bW9yZQoKCQkJCWlmICggT2JqZWN0LmtleXMoIHdlYmdsVGV4dHVyZXMgKS5sZW5ndGggPT09IDAgKSB7CgoJCQkJCV9zb3VyY2VzLmRlbGV0ZSggc291cmNlICk7CgoJCQkJfQoKCQkJfQoKCQkJcHJvcGVydGllcy5yZW1vdmUoIHRleHR1cmUgKTsKCgkJfQoKCQlmdW5jdGlvbiBkZWxldGVUZXh0dXJlKCB0ZXh0dXJlICkgewoKCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoJCQlfZ2wuZGVsZXRlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCgkJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoJCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCQkJZGVsZXRlIHdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXTsKCgkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQl9CgoJCWZ1bmN0aW9uIGRlYWxsb2NhdGVSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKSB7CgoJCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5kaXNwb3NlKCk7CgoJCQkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKTsKCgkJCX0KCgkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApICkgewoKCQkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdLmxlbmd0aDsgbGV2ZWwgKysgKSBfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF1bIGxldmVsIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoKCQkJCQl9CgoJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgoJCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIubGVuZ3RoOyBsZXZlbCArKyApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0gKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJfQoKCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApOwoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApIF9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCgkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlci5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyICk7CgoJCQl9CgoJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgoJCQkJaWYgKCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApIHsKCgkJCQkJX2dsLmRlbGV0ZVRleHR1cmUoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQkJCX0KCgkJCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZXNbIGkgXSApOwoKCQkJfQoKCQkJcHJvcGVydGllcy5yZW1vdmUoIHJlbmRlclRhcmdldCApOwoKCQl9CgoJCS8vCgoJCWxldCB0ZXh0dXJlVW5pdHMgPSAwOwoKCQlmdW5jdGlvbiByZXNldFRleHR1cmVVbml0cygpIHsKCgkJCXRleHR1cmVVbml0cyA9IDA7CgoJCX0KCgkJZnVuY3Rpb24gYWxsb2NhdGVUZXh0dXJlVW5pdCgpIHsKCgkJCWNvbnN0IHRleHR1cmVVbml0ID0gdGV4dHVyZVVuaXRzOwoKCQkJaWYgKCB0ZXh0dXJlVW5pdCA+PSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZXMgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVHJ5aW5nIHRvIHVzZSAnICsgdGV4dHVyZVVuaXQgKyAnIHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAnICsgY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzICk7CgoJCQl9CgoJCQl0ZXh0dXJlVW5pdHMgKz0gMTsKCgkJCXJldHVybiB0ZXh0dXJlVW5pdDsKCgkJfQoKCQlmdW5jdGlvbiBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKSB7CgoJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJYXJyYXkucHVzaCggdGV4dHVyZS53cmFwUyApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLndyYXBUICk7CgkJCWFycmF5LnB1c2goIHRleHR1cmUud3JhcFIgfHwgMCApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1hZ0ZpbHRlciApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1pbkZpbHRlciApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmFuaXNvdHJvcHkgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmZvcm1hdCApOwoJCQlhcnJheS5wdXNoKCB0ZXh0dXJlLnR5cGUgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CgkJCWFycmF5LnB1c2goIHRleHR1cmUuZmxpcFkgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCQkJYXJyYXkucHVzaCggdGV4dHVyZS5jb2xvclNwYWNlICk7CgoJCQlyZXR1cm4gYXJyYXkuam9pbigpOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIHNldFRleHR1cmUyRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApIHVwZGF0ZVZpZGVvVGV4dHVyZSggdGV4dHVyZSApOwoKCQkJaWYgKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgJiYgdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQljb25zdCBpbWFnZSA9IHRleHR1cmUuaW1hZ2U7CgoJCQkJaWYgKCBpbWFnZSA9PT0gbnVsbCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBtYXJrZWQgZm9yIHVwZGF0ZSBidXQgbm8gaW1hZ2UgZGF0YSBmb3VuZC4nICk7CgoJCQkJfSBlbHNlIGlmICggaW1hZ2UuY29tcGxldGUgPT09IGZhbHNlICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBpbWFnZSBpcyBpbmNvbXBsZXRlJyApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJfQoKCQlmdW5jdGlvbiBzZXRUZXh0dXJlMkRBcnJheSggdGV4dHVyZSwgc2xvdCApIHsKCgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQl9CgoJCWZ1bmN0aW9uIHNldFRleHR1cmUzRCggdGV4dHVyZSwgc2xvdCApIHsKCgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzNELCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQl9CgoJCWZ1bmN0aW9uIHNldFRleHR1cmVDdWJlKCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKCQkJCXVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQl9CgoJCWNvbnN0IHdyYXBwaW5nVG9HTCA9IHsKCQkJWyBSZXBlYXRXcmFwcGluZyBdOiBfZ2wuUkVQRUFULAoJCQlbIENsYW1wVG9FZGdlV3JhcHBpbmcgXTogX2dsLkNMQU1QX1RPX0VER0UsCgkJCVsgTWlycm9yZWRSZXBlYXRXcmFwcGluZyBdOiBfZ2wuTUlSUk9SRURfUkVQRUFUCgkJfTsKCgkJY29uc3QgZmlsdGVyVG9HTCA9IHsKCQkJWyBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNULAoJCQlbIE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNUX01JUE1BUF9ORUFSRVNULAoJCQlbIE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgXTogX2dsLk5FQVJFU1RfTUlQTUFQX0xJTkVBUiwKCgkJCVsgTGluZWFyRmlsdGVyIF06IF9nbC5MSU5FQVIsCgkJCVsgTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9ORUFSRVNULAoJCQlbIExpbmVhck1pcG1hcExpbmVhckZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9MSU5FQVIKCQl9OwoKCQljb25zdCBjb21wYXJlVG9HTCA9IHsKCQkJWyBOZXZlckNvbXBhcmUgXTogX2dsLk5FVkVSLAoJCQlbIEFsd2F5c0NvbXBhcmUgXTogX2dsLkFMV0FZUywKCQkJWyBMZXNzQ29tcGFyZSBdOiBfZ2wuTEVTUywKCQkJWyBMZXNzRXF1YWxDb21wYXJlIF06IF9nbC5MRVFVQUwsCgkJCVsgRXF1YWxDb21wYXJlIF06IF9nbC5FUVVBTCwKCQkJWyBHcmVhdGVyRXF1YWxDb21wYXJlIF06IF9nbC5HRVFVQUwsCgkJCVsgR3JlYXRlckNvbXBhcmUgXTogX2dsLkdSRUFURVIsCgkJCVsgTm90RXF1YWxDb21wYXJlIF06IF9nbC5OT1RFUVVBTAoJCX07CgoJCWZ1bmN0aW9uIHNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSApIHsKCgkJCWlmICggdGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IGZhbHNlICYmCgkJCQkoIHRleHR1cmUubWFnRmlsdGVyID09PSBMaW5lYXJGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgfHwgdGV4dHVyZS5tYWdGaWx0ZXIgPT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciB8fAoJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPT09IExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciB8fCB0ZXh0dXJlLm1pbkZpbHRlciA9PT0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyICkgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5hYmxlIHRvIHVzZSBsaW5lYXIgZmlsdGVyaW5nIHdpdGggZmxvYXRpbmcgcG9pbnQgdGV4dHVyZXMuIE9FU190ZXh0dXJlX2Zsb2F0X2xpbmVhciBub3Qgc3VwcG9ydGVkIG9uIHRoaXMgZGV2aWNlLicgKTsKCgkJCX0KCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9TLCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFMgXSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfVCwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBUIF0gKTsKCgkJCWlmICggdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUeXBlID09PSBfZ2wuVEVYVFVSRV8yRF9BUlJBWSApIHsKCgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX1dSQVBfUiwgd3JhcHBpbmdUb0dMWyB0ZXh0dXJlLndyYXBSIF0gKTsKCgkJCX0KCgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZmlsdGVyVG9HTFsgdGV4dHVyZS5tYWdGaWx0ZXIgXSApOwoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX01JTl9GSUxURVIsIGZpbHRlclRvR0xbIHRleHR1cmUubWluRmlsdGVyIF0gKTsKCgkJCWlmICggdGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gKSB7CgoJCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9DT01QQVJFX01PREUsIF9nbC5DT01QQVJFX1JFRl9UT19URVhUVVJFICk7CgkJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX0NPTVBBUkVfRlVOQywgY29tcGFyZVRvR0xbIHRleHR1cmUuY29tcGFyZUZ1bmN0aW9uIF0gKTsKCgkJCX0KCgkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICkgPT09IHRydWUgKSB7CgoJCQkJaWYgKCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTmVhcmVzdEZpbHRlciApIHJldHVybjsKCQkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhck1pcG1hcExpbmVhckZpbHRlciApIHJldHVybjsKCQkJCWlmICggdGV4dHVyZS50eXBlID09PSBGbG9hdFR5cGUgJiYgZXh0ZW5zaW9ucy5oYXMoICdPRVNfdGV4dHVyZV9mbG9hdF9saW5lYXInICkgPT09IGZhbHNlICkgcmV0dXJuOyAvLyB2ZXJpZnkgZXh0ZW5zaW9uCgoJCQkJaWYgKCB0ZXh0dXJlLmFuaXNvdHJvcHkgPiAxIHx8IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSApIHsKCgkJCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgkJCQkJX2dsLnRleFBhcmFtZXRlcmYoIHRleHR1cmVUeXBlLCBleHRlbnNpb24uVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIE1hdGgubWluKCB0ZXh0dXJlLmFuaXNvdHJvcHksIGNhcGFiaWxpdGllcy5nZXRNYXhBbmlzb3Ryb3B5KCkgKSApOwoJCQkJCXByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX19jdXJyZW50QW5pc290cm9weSA9IHRleHR1cmUuYW5pc290cm9weTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICkgewoKCQkJbGV0IGZvcmNlVXBsb2FkID0gZmFsc2U7CgoJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPSB0cnVlOwoKCQkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCQl9CgoJCQkvLyBjcmVhdGUgU291cmNlIDwtPiBXZWJHTFRleHR1cmVzIG1hcHBpbmcgaWYgbmVjZXNzYXJ5CgoJCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCQkJbGV0IHdlYmdsVGV4dHVyZXMgPSBfc291cmNlcy5nZXQoIHNvdXJjZSApOwoKCQkJaWYgKCB3ZWJnbFRleHR1cmVzID09PSB1bmRlZmluZWQgKSB7CgoJCQkJd2ViZ2xUZXh0dXJlcyA9IHt9OwoJCQkJX3NvdXJjZXMuc2V0KCBzb3VyY2UsIHdlYmdsVGV4dHVyZXMgKTsKCgkJCX0KCgkJCS8vIGNoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBXZWJHTFRleHR1cmUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gdGV4dHVyZSBwYXJhbWV0ZXJzCgoJCQljb25zdCB0ZXh0dXJlQ2FjaGVLZXkgPSBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKTsKCgkJCWlmICggdGV4dHVyZUNhY2hlS2V5ICE9PSB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5ICkgewoKCQkJCS8vIGlmIG5vdCwgY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIFdlYkdMVGV4dHVyZQoKCQkJCWlmICggd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZUNhY2hlS2V5IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gY3JlYXRlIG5ldyBlbnRyeQoKCQkJCQl3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXSA9IHsKCQkJCQkJdGV4dHVyZTogX2dsLmNyZWF0ZVRleHR1cmUoKSwKCQkJCQkJdXNlZFRpbWVzOiAwCgkJCQkJfTsKCgkJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgoJCQkJCS8vIHdoZW4gYSBuZXcgaW5zdGFuY2Ugb2YgV2ViR0xUZXh0dXJlIHdhcyBjcmVhdGVkLCBhIHRleHR1cmUgdXBsb2FkIGlzIHJlcXVpcmVkCgkJCQkJLy8gZXZlbiBpZiB0aGUgaW1hZ2UgY29udGVudHMgYXJlIGlkZW50aWNhbAoKCQkJCQlmb3JjZVVwbG9hZCA9IHRydWU7CgoJCQkJfQoKCQkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnVzZWRUaW1lcyArKzsKCgkJCQkvLyBldmVyeSB0aW1lIHRoZSB0ZXh0dXJlIGNhY2hlIGtleSBjaGFuZ2VzLCBpdCdzIG5lY2Vzc2FyeSB0byBjaGVjayBpZiBhbiBpbnN0YW5jZSBvZgoJCQkJLy8gV2ViR0xUZXh0dXJlIGNhbiBiZSBkZWxldGVkIGluIG9yZGVyIHRvIGF2b2lkIGEgbWVtb3J5IGxlYWsuCgoJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoKCQkJCWlmICggd2ViZ2xUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXS51c2VkVGltZXMgLS07CgoJCQkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCQkJCWRlbGV0ZVRleHR1cmUoIHRleHR1cmUgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyBzdG9yZSByZWZlcmVuY2VzIHRvIGNhY2hlIGtleSBhbmQgV2ViR0xUZXh0dXJlIG9iamVjdAoKCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgPSB0ZXh0dXJlQ2FjaGVLZXk7CgkJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnRleHR1cmU7CgoJCQl9CgoJCQlyZXR1cm4gZm9yY2VVcGxvYWQ7CgoJCX0KCgkJZnVuY3Rpb24gZ2V0Um93KCBpbmRleCwgcm93TGVuZ3RoLCBjb21wb25lbnRTdHJpZGUgKSB7CgoJCQlyZXR1cm4gTWF0aC5mbG9vciggTWF0aC5mbG9vciggaW5kZXggLyBjb21wb25lbnRTdHJpZGUgKSAvIHJvd0xlbmd0aCApOwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVRleHR1cmUoIHRleHR1cmUsIGltYWdlLCBnbEZvcm1hdCwgZ2xUeXBlICkgewoKCQkJY29uc3QgY29tcG9uZW50U3RyaWRlID0gNDsgLy8gb25seSBSR0JBIHN1cHBvcnRlZAoKCQkJY29uc3QgdXBkYXRlUmFuZ2VzID0gdGV4dHVyZS51cGRhdGVSYW5nZXM7CgoJCQlpZiAoIHVwZGF0ZVJhbmdlcy5sZW5ndGggPT09IDAgKSB7CgoJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gQmVmb3JlIGFwcGx5aW5nIHVwZGF0ZSByYW5nZXMsIHdlIG1lcmdlIGFueSBhZGphY2VudCAvIG92ZXJsYXBwaW5nCgkJCQkvLyByYW5nZXMgdG8gcmVkdWNlIGxvYWQgb24gYGdsLnRleFN1YkltYWdlMkRgLiBFbXBpcmljYWxseSwgdGhpcyBoYXMgbGVkCgkJCQkvLyB0byBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudHMgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBtYWtlIGhlYXZ5IHVzZSBvZgoJCQkJLy8gdXBkYXRlIHJhbmdlcy4gTGlrZWx5IGR1ZSB0byBHUFUgY29tbWFuZCBvdmVyaGVhZC4KCQkJCS8vCgkJCQkvLyBOb3RlIHRoYXQgdG8gcmVkdWNlIGdhcmJhZ2UgY29sbGVjdGlvbiBiZXR3ZWVuIGZyYW1lcywgd2UgbWVyZ2UgdGhlCgkJCQkvLyB1cGRhdGUgcmFuZ2VzIGluLXBsYWNlLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSB0aGlzIG1ldGhvZCB3aWxsIGNsZWFyIHRoZQoJCQkJLy8gdXBkYXRlIHJhbmdlcyBvbmNlIHVwZGF0ZWQuCgoJCQkJdXBkYXRlUmFuZ2VzLnNvcnQoICggYSwgYiApID0+IGEuc3RhcnQgLSBiLnN0YXJ0ICk7CgoJCQkJLy8gVG8gbWVyZ2UgdGhlIHVwZGF0ZSByYW5nZXMgaW4tcGxhY2UsIHdlIHdvcmsgZnJvbSBsZWZ0IHRvIHJpZ2h0IGluIHRoZQoJCQkJLy8gZXhpc3RpbmcgdXBkYXRlUmFuZ2VzIGFycmF5LCBtZXJnaW5nIHJhbmdlcy4gVGhpcyBtYXkgcmVzdWx0IGluIGEgZmluYWwKCQkJCS8vIGFycmF5IHdoaWNoIGlzIHNtYWxsZXIgdGhhbiB0aGUgb3JpZ2luYWwuIFRoaXMgaW5kZXggdHJhY2tzIHRoZSBsYXN0CgkJCQkvLyBpbmRleCByZXByZXNlbnRpbmcgYSBtZXJnZWQgcmFuZ2UsIGFueSBkYXRhIGFmdGVyIHRoaXMgaW5kZXggY2FuIGJlCgkJCQkvLyB0cmltbWVkIG9uY2UgdGhlIG1lcmdlIGFsZ29yaXRobSBpcyBjb21wbGV0ZWQuCgkJCQlsZXQgbWVyZ2VJbmRleCA9IDA7CgoJCQkJZm9yICggbGV0IGkgPSAxOyBpIDwgdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgcHJldmlvdXNSYW5nZSA9IHVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdOwoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCS8vIE9ubHkgbWVyZ2UgaWYgaW4gdGhlIHNhbWUgcm93IGFuZCBvdmVybGFwcGluZy9hZGphY2VudAoJCQkJCWNvbnN0IHByZXZpb3VzRW5kID0gcHJldmlvdXNSYW5nZS5zdGFydCArIHByZXZpb3VzUmFuZ2UuY291bnQ7CgkJCQkJY29uc3QgY3VycmVudFJvdyA9IGdldFJvdyggcmFuZ2Uuc3RhcnQsIGltYWdlLndpZHRoLCBjb21wb25lbnRTdHJpZGUgKTsKCQkJCQljb25zdCBwcmV2aW91c1JvdyA9IGdldFJvdyggcHJldmlvdXNSYW5nZS5zdGFydCwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApOwoKCQkJCQkvLyBXZSBhZGQgb25lIGhlcmUgdG8gbWVyZ2UgYWRqYWNlbnQgcmFuZ2VzLiBUaGlzIGlzIHNhZmUgYmVjYXVzZSByYW5nZXMKCQkJCQkvLyBvcGVyYXRlIG92ZXIgcG9zaXRpdmUgaW50ZWdlcnMuCgkJCQkJaWYgKAoJCQkJCQlyYW5nZS5zdGFydCA8PSBwcmV2aW91c0VuZCArIDEgJiYKCQkJCQkJY3VycmVudFJvdyA9PT0gcHJldmlvdXNSb3cgJiYKCQkJCQkJZ2V0Um93KCByYW5nZS5zdGFydCArIHJhbmdlLmNvdW50IC0gMSwgaW1hZ2Uud2lkdGgsIGNvbXBvbmVudFN0cmlkZSApID09PSBjdXJyZW50Um93IC8vIGVuc3VyZSByYW5nZSBkb2Vzbid0IHNwaWxsCgkJCQkJKSB7CgoJCQkJCQlwcmV2aW91c1JhbmdlLmNvdW50ID0gTWF0aC5tYXgoCgkJCQkJCQlwcmV2aW91c1JhbmdlLmNvdW50LAoJCQkJCQkJcmFuZ2Uuc3RhcnQgKyByYW5nZS5jb3VudCAtIHByZXZpb3VzUmFuZ2Uuc3RhcnQKCQkJCQkJKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCSsrIG1lcmdlSW5kZXg7CgkJCQkJCXVwZGF0ZVJhbmdlc1sgbWVyZ2VJbmRleCBdID0gcmFuZ2U7CgoJCQkJCX0KCgoJCQkJfQoKCQkJCS8vIFRyaW0gdGhlIGFycmF5IHRvIG9ubHkgY29udGFpbiB0aGUgbWVyZ2VkIHJhbmdlcy4KCQkJCXVwZGF0ZVJhbmdlcy5sZW5ndGggPSBtZXJnZUluZGV4ICsgMTsKCgkJCQljb25zdCBjdXJyZW50VW5wYWNrUm93TGVuID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19ST1dfTEVOR1RIICk7CgkJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGltYWdlLndpZHRoICk7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdXBkYXRlUmFuZ2VzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHJhbmdlID0gdXBkYXRlUmFuZ2VzWyBpIF07CgoJCQkJCWNvbnN0IHBpeGVsU3RhcnQgPSBNYXRoLmZsb29yKCByYW5nZS5zdGFydCAvIGNvbXBvbmVudFN0cmlkZSApOwoJCQkJCWNvbnN0IHBpeGVsQ291bnQgPSBNYXRoLmNlaWwoIHJhbmdlLmNvdW50IC8gY29tcG9uZW50U3RyaWRlICk7CgoJCQkJCWNvbnN0IHggPSBwaXhlbFN0YXJ0ICUgaW1hZ2Uud2lkdGg7CgkJCQkJY29uc3QgeSA9IE1hdGguZmxvb3IoIHBpeGVsU3RhcnQgLyBpbWFnZS53aWR0aCApOwoKCQkJCQkvLyBBc3N1bWVzIHVwZGF0ZSByYW5nZXMgcmVmZXIgdG8gY29udGlndW91cyBtZW1vcnkKCQkJCQljb25zdCB3aWR0aCA9IHBpeGVsQ291bnQ7CgkJCQkJY29uc3QgaGVpZ2h0ID0gMTsKCgkJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCB4ICk7CgkJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUk9XUywgeSApOwoKCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCX0KCgkJCQl0ZXh0dXJlLmNsZWFyVXBkYXRlUmFuZ2VzKCk7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEgsIGN1cnJlbnRVbnBhY2tSb3dMZW4gKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgY3VycmVudFVucGFja1NraXBQaXhlbHMgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIGN1cnJlbnRVbnBhY2tTa2lwUm93cyApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICkgewoKCQkJbGV0IHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfMkQ7CgoJCQlpZiAoIHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlIHx8IHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgdGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCQkJaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfM0Q7CgoJCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwoJCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgoJCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCgkJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwoJCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgoJCQkJbGV0IGltYWdlID0gcmVzaXplSW1hZ2UoIHRleHR1cmUuaW1hZ2UsIGZhbHNlLCBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemUgKTsKCQkJCWltYWdlID0gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgaW1hZ2UgKTsKCgkJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCgkJCQljb25zdCBnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKTsKCQkJCWxldCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApOwoKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSApOwoKCQkJCWxldCBtaXBtYXA7CgkJCQljb25zdCBtaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKCQkJCWNvbnN0IHVzZVRleFN0b3JhZ2UgPSAoIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgIT09IHRydWUgKTsKCQkJCWNvbnN0IGFsbG9jYXRlTWVtb3J5ID0gKCBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9PT0gdW5kZWZpbmVkICkgfHwgKCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApOwoJCQkJY29uc3QgZGF0YVJlYWR5ID0gc291cmNlLmRhdGFSZWFkeTsKCQkJCWNvbnN0IGxldmVscyA9IGdldE1pcExldmVscyggdGV4dHVyZSwgaW1hZ2UgKTsKCgkJCQlpZiAoIHRleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbERlcHRoRm9ybWF0KCB0ZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0LCB0ZXh0dXJlLnR5cGUgKTsKCgkJCQkJLy8KCgkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCAxLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YVRleHR1cmUgKSB7CgoJCQkJCS8vIHVzZSBtYW51YWxseSBjcmVhdGVkIG1pcG1hcHMgaWYgYXZhaWxhYmxlCgkJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCgkJCQkJLy8gc2V0IDAgbGV2ZWwgbWlwbWFwIGFuZCB0aGVuIHVzZSBHTCB0byBnZW5lcmF0ZSBvdGhlciBtaXBtYXAgbGV2ZWxzCgoJCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCQl9CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCgkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCX0KCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQl1cGRhdGVUZXh0dXJlKCB0ZXh0dXJlLCBpbWFnZSwgZ2xGb3JtYXQsIGdsVHlwZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCgkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCgkJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKCQkJCQkJCQlpZiAoIGdsRm9ybWF0ICE9PSBudWxsICkgewoKCQkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCQlpZiAoIHRleHR1cmUubGF5ZXJVcGRhdGVzLnNpemUgPiAwICkgewoKCQkJCQkJCQkJCQkJY29uc3QgbGF5ZXJCeXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aCggbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS50eXBlICk7CgoJCQkJCQkJCQkJCQlmb3IgKCBjb25zdCBsYXllckluZGV4IG9mIHRleHR1cmUubGF5ZXJVcGRhdGVzICkgewoKCQkJCQkJCQkJCQkJCWNvbnN0IGxheWVyRGF0YSA9IG1pcG1hcC5kYXRhLnN1YmFycmF5KAoJCQkJCQkJCQkJCQkJCWxheWVySW5kZXggKiBsYXllckJ5dGVMZW5ndGggLyBtaXBtYXAuZGF0YS5CWVRFU19QRVJfRUxFTUVOVCwKCQkJCQkJCQkJCQkJCQkoIGxheWVySW5kZXggKyAxICkgKiBsYXllckJ5dGVMZW5ndGggLyBtaXBtYXAuZGF0YS5CWVRFU19QRVJfRUxFTUVOVAoJCQkJCQkJCQkJCQkJKTsKCQkJCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgMCwgMCwgbGF5ZXJJbmRleCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAxLCBnbEZvcm1hdCwgbGF5ZXJEYXRhICk7CgoJCQkJCQkJCQkJCQl9CgoJCQkJCQkJCQkJCQl0ZXh0dXJlLmNsZWFyTGF5ZXJVcGRhdGVzKCk7CgoJCQkJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIDAsIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQkJCQl9CgoJCQkJCQkJCQkJfQoKCQkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCQlzdGF0ZS5jb21wcmVzc2VkVGV4SW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIG1pcG1hcC5kYXRhLCAwLCAwICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAudXBsb2FkVGV4dHVyZSgpJyApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGksIDAsIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCApOwoKCQkJCQkJfQoKCQkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQkJbWlwbWFwID0gbWlwbWFwc1sgaSBdOwoKCQkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgKSB7CgoJCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgoJCQkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJCQl9CgoJCQkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQkJfQoKCQkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnVwbG9hZFRleHR1cmUoKScgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBpLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJaWYgKCB0ZXh0dXJlLmxheWVyVXBkYXRlcy5zaXplID4gMCApIHsKCgkJCQkJCQkJY29uc3QgbGF5ZXJCeXRlTGVuZ3RoID0gZ2V0Qnl0ZUxlbmd0aCggaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUudHlwZSApOwoKCQkJCQkJCQlmb3IgKCBjb25zdCBsYXllckluZGV4IG9mIHRleHR1cmUubGF5ZXJVcGRhdGVzICkgewoKCQkJCQkJCQkJY29uc3QgbGF5ZXJEYXRhID0gaW1hZ2UuZGF0YS5zdWJhcnJheSgKCQkJCQkJCQkJCWxheWVySW5kZXggKiBsYXllckJ5dGVMZW5ndGggLyBpbWFnZS5kYXRhLkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCQkJCQkJKCBsYXllckluZGV4ICsgMSApICogbGF5ZXJCeXRlTGVuZ3RoIC8gaW1hZ2UuZGF0YS5CWVRFU19QRVJfRUxFTUVOVAoJCQkJCQkJCQkpOwoJCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgMCwgMCwgbGF5ZXJJbmRleCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgMSwgZ2xGb3JtYXQsIGdsVHlwZSwgbGF5ZXJEYXRhICk7CgoJCQkJCQkJCX0KCgkJCQkJCQkJdGV4dHVyZS5jbGVhckxheWVyVXBkYXRlcygpOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCAwLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCAwLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0LCBpbWFnZS5kZXB0aCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8zRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNGcmFtZWJ1ZmZlclRleHR1cmUgKSB7CgoJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWxldCB3aWR0aCA9IGltYWdlLndpZHRoLCBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGV2ZWxzOyBpICsrICkgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbnVsbCApOwoKCQkJCQkJCQl3aWR0aCA+Pj0gMTsKCQkJCQkJCQloZWlnaHQgPj49IDE7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gcmVndWxhciBUZXh0dXJlIChpbWFnZSwgdmlkZW8sIGNhbnZhcykKCgkJCQkJLy8gdXNlIG1hbnVhbGx5IGNyZWF0ZWQgbWlwbWFwcyBpZiBhdmFpbGFibGUKCQkJCQkvLyBpZiB0aGVyZSBhcmUgbm8gbWFudWFsIG1pcG1hcHMKCQkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCgkJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIG1pcG1hcHNbIDAgXSApOwoKCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtaXBtYXBzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGltYWdlICk7CgoJCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgZGltZW5zaW9ucy53aWR0aCwgZGltZW5zaW9ucy5oZWlnaHQgKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZSApOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCgkJCQkJZ2VuZXJhdGVNaXBtYXAoIHRleHR1cmVUeXBlICk7CgoJCQkJfQoKCQkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgoJCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQkJfQoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCQl9CgoJCWZ1bmN0aW9uIHVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApIHsKCgkJCWlmICggdGV4dHVyZS5pbWFnZS5sZW5ndGggIT09IDYgKSByZXR1cm47CgoJCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwoJCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCgkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgoJCQlpZiAoIHNvdXJjZS52ZXJzaW9uICE9PSBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiB8fCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApIHsKCgkJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwoJCQkJY29uc3QgdGV4dHVyZVByaW1hcmllcyA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlID8gbnVsbCA6IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCB0ZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgoJCQkJY29uc3QgaXNDb21wcmVzc2VkID0gKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgfHwgdGV4dHVyZS5pbWFnZVsgMCBdLmlzQ29tcHJlc3NlZFRleHR1cmUgKTsKCQkJCWNvbnN0IGlzRGF0YVRleHR1cmUgPSAoIHRleHR1cmUuaW1hZ2VbIDAgXSAmJiB0ZXh0dXJlLmltYWdlWyAwIF0uaXNEYXRhVGV4dHVyZSApOwoKCQkJCWNvbnN0IGN1YmVJbWFnZSA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCWlmICggISBpc0NvbXByZXNzZWQgJiYgISBpc0RhdGFUZXh0dXJlICkgewoKCQkJCQkJY3ViZUltYWdlWyBpIF0gPSByZXNpemVJbWFnZSggdGV4dHVyZS5pbWFnZVsgaSBdLCB0cnVlLCBjYXBhYmlsaXRpZXMubWF4Q3ViZW1hcFNpemUgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWN1YmVJbWFnZVsgaSBdID0gaXNEYXRhVGV4dHVyZSA/IHRleHR1cmUuaW1hZ2VbIGkgXS5pbWFnZSA6IHRleHR1cmUuaW1hZ2VbIGkgXTsKCgkJCQkJfQoKCQkJCQljdWJlSW1hZ2VbIGkgXSA9IHZlcmlmeUNvbG9yU3BhY2UoIHRleHR1cmUsIGN1YmVJbWFnZVsgaSBdICk7CgoJCQkJfQoKCQkJCWNvbnN0IGltYWdlID0gY3ViZUltYWdlWyAwIF0sCgkJCQkJZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICksCgkJCQkJZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICksCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCgkJCQljb25zdCB1c2VUZXhTdG9yYWdlID0gKCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICE9PSB0cnVlICk7CgkJCQljb25zdCBhbGxvY2F0ZU1lbW9yeSA9ICggc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPT09IHVuZGVmaW5lZCApIHx8ICggZm9yY2VVcGxvYWQgPT09IHRydWUgKTsKCQkJCWNvbnN0IGRhdGFSZWFkeSA9IHNvdXJjZS5kYXRhUmVhZHk7CgkJCQlsZXQgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSApOwoKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZSApOwoKCQkJCWxldCBtaXBtYXBzOwoKCQkJCWlmICggaXNDb21wcmVzc2VkICkgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQkJbWlwbWFwcyA9IGN1YmVJbWFnZVsgaSBdLm1pcG1hcHM7CgoJCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBtaXBtYXBzLmxlbmd0aDsgaiArKyApIHsKCgkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgoJCQkJCQkJaWYgKCB0ZXh0dXJlLmZvcm1hdCAhPT0gUkdCQUZvcm1hdCApIHsKCgkJCQkJCQkJaWYgKCBnbEZvcm1hdCAhPT0gbnVsbCApIHsKCgkJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCgkJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQkJCX0KCgkJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIDAsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBdHRlbXB0IHRvIGxvYWQgdW5zdXBwb3J0ZWQgY29tcHJlc3NlZCB0ZXh0dXJlIGZvcm1hdCBpbiAuc2V0VGV4dHVyZUN1YmUoKScgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJbWlwbWFwcyA9IHRleHR1cmUubWlwbWFwczsKCgkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkJLy8gVE9ETzogVW5pZm9ybWx5IGhhbmRsZSBtaXBtYXAgZGVmaW5pdGlvbnMKCQkJCQkJLy8gTm9ybWFsIHRleHR1cmVzIGFuZCBjb21wcmVzc2VkIGN1YmUgdGV4dHVyZXMgZGVmaW5lIGJhc2UgbGV2ZWwgKyBtaXBzIHdpdGggdGhlaXIgbWlwbWFwIGFycmF5CgkJCQkJCS8vIFVuY29tcHJlc3NlZCBjdWJlIHRleHR1cmVzIHVzZSB0aGVpciBtaXBtYXAgYXJyYXkgb25seSBmb3IgbWlwcyAobm8gYmFzZSBsZXZlbCkKCgkJCQkJCWlmICggbWlwbWFwcy5sZW5ndGggPiAwICkgbGV2ZWxzICsrOwoKCQkJCQkJY29uc3QgZGltZW5zaW9ucyA9IGdldERpbWVuc2lvbnMoIGN1YmVJbWFnZVsgMCBdICk7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGRpbWVuc2lvbnMud2lkdGgsIGRpbWVuc2lvbnMuaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQkJCWlmICggaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIDAsIDAsIGN1YmVJbWFnZVsgaSBdLndpZHRoLCBjdWJlSW1hZ2VbIGkgXS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCBnbEludGVybmFsRm9ybWF0LCBjdWJlSW1hZ2VbIGkgXS53aWR0aCwgY3ViZUltYWdlWyBpIF0uaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXS5kYXRhICk7CgoJCQkJCQkJfQoKCQkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgkJCQkJCQkJY29uc3QgbWlwbWFwSW1hZ2UgPSBtaXBtYXAuaW1hZ2VbIGkgXS5pbWFnZTsKCgkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJaWYgKCBkYXRhUmVhZHkgKSB7CgoJCQkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCAwLCAwLCBtaXBtYXBJbWFnZS53aWR0aCwgbWlwbWFwSW1hZ2UuaGVpZ2h0LCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXBJbWFnZS5kYXRhICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQlpZiAoIGRhdGFSZWFkeSApIHsKCgkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdICk7CgoJCQkJCQkJfQoKCQkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCWlmICggZGF0YVJlYWR5ICkgewoKCQkJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgMCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCgkJCQkJCQkJCX0KCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSApICkgewoKCQkJCQkvLyBXZSBhc3N1bWUgaW1hZ2VzIGZvciBjdWJlIG1hcCBoYXZlIHRoZSBzYW1lIHNpemUuCgkJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFX0NVQkVfTUFQICk7CgoJCQkJfQoKCQkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgoJCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQkJfQoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCQl9CgoJCS8vIFJlbmRlciB0YXJnZXRzCgoJCS8vIFNldHVwIHN0b3JhZ2UgZm9yIHRhcmdldCB0ZXh0dXJlIGFuZCBiaW5kIGl0IHRvIGNvcnJlY3QgZnJhbWVidWZmZXIKCQlmdW5jdGlvbiBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgbGV2ZWwgKSB7CgoJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggdGV4dHVyZS50eXBlICk7CgkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoKCQkJaWYgKCAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC53aWR0aCA+PiBsZXZlbCApOwoJCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5tYXgoIDEsIHJlbmRlclRhcmdldC5oZWlnaHQgPj4gbGV2ZWwgKTsKCgkJCQlpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCB0ZXh0dXJlVGFyZ2V0LCBsZXZlbCwgZ2xJbnRlcm5hbEZvcm1hdCwgd2lkdGgsIGhlaWdodCwgcmVuZGVyVGFyZ2V0LmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBudWxsICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3RhdGUudGV4SW1hZ2UyRCggdGV4dHVyZVRhcmdldCwgbGV2ZWwsIGdsSW50ZXJuYWxGb3JtYXQsIHdpZHRoLCBoZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBhdHRhY2htZW50LCB0ZXh0dXJlVGFyZ2V0LCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgMCwgZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICkgKTsKCgkJCX0gZWxzZSBpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEIHx8ICggdGV4dHVyZVRhcmdldCA+PSBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICYmIHRleHR1cmVUYXJnZXQgPD0gX2dsLlRFWFRVUkVfQ1VCRV9NQVBfTkVHQVRJVkVfWiApICkgeyAvLyBzZWUgIzI0NzUzCgoJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIGF0dGFjaG1lbnQsIHRleHR1cmVUYXJnZXQsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBsZXZlbCApOwoKCQkJfQoKCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJfQoKCQkvLyBTZXR1cCBzdG9yYWdlIGZvciBpbnRlcm5hbCBkZXB0aC9zdGVuY2lsIGJ1ZmZlcnMgYW5kIGJpbmQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgoJCWZ1bmN0aW9uIHNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyYnVmZmVyLCByZW5kZXJUYXJnZXQsIGlzTXVsdGlzYW1wbGUgKSB7CgoJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCgkJCQkvLyByZXRyaWV2ZSB0aGUgZGVwdGggYXR0YWNobWVudCB0eXBlcwoJCQkJY29uc3QgZGVwdGhUZXh0dXJlID0gcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZTsKCQkJCWNvbnN0IGRlcHRoVHlwZSA9IGRlcHRoVGV4dHVyZSAmJiBkZXB0aFRleHR1cmUuaXNEZXB0aFRleHR1cmUgPyBkZXB0aFRleHR1cmUudHlwZSA6IG51bGw7CgkJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxEZXB0aEZvcm1hdCggcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIsIGRlcHRoVHlwZSApOwoJCQkJY29uc3QgZ2xBdHRhY2htZW50VHlwZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwoKCQkJCS8vIHNldCB1cCB0aGUgYXR0YWNobWVudAoJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoJCQkJY29uc3QgaXNVc2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApOwoJCQkJaWYgKCBpc1VzZU11bHRpc2FtcGxlZFJUVCApIHsKCgkJCQkJbXVsdGlzYW1wbGVkUlRURXh0LnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZUVYVCggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfSBlbHNlIGlmICggaXNNdWx0aXNhbXBsZSApIHsKCgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZSggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgZ2xJbnRlcm5hbEZvcm1hdCwgcmVuZGVyVGFyZ2V0LndpZHRoLCByZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0KCgkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZ2xBdHRhY2htZW50VHlwZSwgX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgoJCQkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCQkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKCQkJCQlpZiAoIGlzTXVsdGlzYW1wbGUgJiYgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQkJfSBlbHNlIGlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGVFWFQoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgkJfQoKCQkvLyBTZXR1cCByZXNvdXJjZXMgZm9yIGEgRGVwdGggVGV4dHVyZSBmb3IgYSBGQk8gKG5lZWRzIGFuIGV4dGVuc2lvbikKCQlmdW5jdGlvbiBzZXR1cERlcHRoVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCApIHsKCgkJCWNvbnN0IGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApOwoJCQlpZiAoIGlzQ3ViZSApIHRocm93IG5ldyBFcnJvciggJ0RlcHRoIFRleHR1cmUgd2l0aCBjdWJlIHJlbmRlciB0YXJnZXRzIGlzIG5vdCBzdXBwb3J0ZWQnICk7CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCWlmICggISAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApICkgewoKCQkJCXRocm93IG5ldyBFcnJvciggJ3JlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgbXVzdCBiZSBhbiBpbnN0YW5jZSBvZiBUSFJFRS5EZXB0aFRleHR1cmUnICk7CgoJCQl9CgoJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICk7CgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fcmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoKCQkJLy8gdXBsb2FkIGFuIGVtcHR5IGRlcHRoIHRleHR1cmUgd2l0aCBmcmFtZWJ1ZmZlciBzaXplCgkJCWlmICggISB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSB8fAoJCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggIT09IHJlbmRlclRhcmdldC53aWR0aCB8fAoJCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ICE9PSByZW5kZXJUYXJnZXQuaGVpZ2h0ICkgewoKCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2Uud2lkdGggPSByZW5kZXJUYXJnZXQud2lkdGg7CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLmhlaWdodCA9IHJlbmRlclRhcmdldC5oZWlnaHQ7CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCX0KCgkJCXNldFRleHR1cmUyRCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSwgMCApOwoKCQkJY29uc3Qgd2ViZ2xEZXB0aFRleHR1cmUgPSB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZTsKCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhGb3JtYXQgKSB7CgoJCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCQltdWx0aXNhbXBsZWRSVFRFeHQuZnJhbWVidWZmZXJUZXh0dXJlMkRNdWx0aXNhbXBsZUVYVCggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwLCBzYW1wbGVzICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuVEVYVFVSRV8yRCwgd2ViZ2xEZXB0aFRleHR1cmUsIDAgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgewoKCQkJCWlmICggdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQkJbXVsdGlzYW1wbGVkUlRURXh0LmZyYW1lYnVmZmVyVGV4dHVyZTJETXVsdGlzYW1wbGVFWFQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwLCBzYW1wbGVzICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdGhyb3cgbmV3IEVycm9yKCAnVW5rbm93biBkZXB0aFRleHR1cmUgZm9ybWF0JyApOwoKCQkJfQoKCQl9CgoJCS8vIFNldHVwIEdMIHJlc291cmNlcyBmb3IgYSBub24tdGV4dHVyZSBkZXB0aCBidWZmZXIKCQlmdW5jdGlvbiBzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKSB7CgoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQljb25zdCBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwoKCQkJLy8gaWYgdGhlIGJvdW5kIGRlcHRoIHRleHR1cmUgaGFzIGNoYW5nZWQKCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmUgIT09IHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKSB7CgoJCQkJLy8gZmlyZSB0aGUgZGlzcG9zZSBldmVudCB0byBnZXQgcmlkIG9mIHN0b3JlZCBzdGF0ZSBhc3NvY2lhdGVkIHdpdGggdGhlIHByZXZpb3VzbHkgYm91bmQgZGVwdGggYnVmZmVyCgkJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fZGVwdGhEaXNwb3NlQ2FsbGJhY2sgKSB7CgoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19kZXB0aERpc3Bvc2VDYWxsYmFjaygpOwoKCQkJCX0KCgkJCQkvLyBzZXQgdXAgZGlzcG9zZSBsaXN0ZW5lcnMgdG8gdHJhY2sgd2hlbiB0aGUgY3VycmVudGx5IGF0dGFjaGVkIGJ1ZmZlciBpcyBpbXBsaWNpdGx5IHVuYm91bmQKCQkJCWlmICggZGVwdGhUZXh0dXJlICkgewoKCQkJCQljb25zdCBkaXNwb3NlRXZlbnQgPSAoKSA9PiB7CgoJCQkJCQlkZWxldGUgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2JvdW5kRGVwdGhUZXh0dXJlOwoJCQkJCQlkZWxldGUgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrOwoJCQkJCQlkZXB0aFRleHR1cmUucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlRXZlbnQgKTsKCgkJCQkJfTsKCgkJCQkJZGVwdGhUZXh0dXJlLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgZGlzcG9zZUV2ZW50ICk7CgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2RlcHRoRGlzcG9zZUNhbGxiYWNrID0gZGlzcG9zZUV2ZW50OwoKCQkJCX0KCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYm91bmREZXB0aFRleHR1cmUgPSBkZXB0aFRleHR1cmU7CgoJCQl9CgoJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgJiYgISByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYXV0b0FsbG9jYXRlRGVwdGhCdWZmZXIgKSB7CgoJCQkJaWYgKCBpc0N1YmUgKSB0aHJvdyBuZXcgRXJyb3IoICd0YXJnZXQuZGVwdGhUZXh0dXJlIG5vdCBzdXBwb3J0ZWQgaW4gQ3ViZSByZW5kZXIgdGFyZ2V0cycgKTsKCgkJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCgkJCQlpZiAoIG1pcG1hcHMgJiYgbWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCQlzZXR1cERlcHRoVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSwgcmVuZGVyVGFyZ2V0ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc2V0dXBEZXB0aFRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLCByZW5kZXJUYXJnZXQgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWlmICggaXNDdWJlICkgewoKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9IFtdOwoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gKTsKCgkJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXJbIGkgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJCQlzZXR1cFJlbmRlckJ1ZmZlclN0b3JhZ2UoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJLy8gYXR0YWNoIGJ1ZmZlciBpZiBpdCdzIGJlZW4gY3JlYXRlZCBhbHJlYWR5CgkJCQkJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgkJCQkJCQljb25zdCByZW5kZXJidWZmZXIgPSByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdOwoJCQkJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGdsQXR0YWNobWVudFR5cGUsIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc3QgbWlwbWFwcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlLm1pcG1hcHM7CgoJCQkJCWlmICggbWlwbWFwcyAmJiBtaXBtYXBzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIDAgXSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJCX0KCgkJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJCXNldHVwUmVuZGVyQnVmZmVyU3RvcmFnZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIsIHJlbmRlclRhcmdldCwgZmFsc2UgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGF0dGFjaCBidWZmZXIgaWYgaXQncyBiZWVuIGNyZWF0ZWQgYWxyZWFkeQoJCQkJCQljb25zdCBnbEF0dGFjaG1lbnRUeXBlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgkJCQkJCWNvbnN0IHJlbmRlcmJ1ZmZlciA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyOwoJCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyYnVmZmVyICk7CgkJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBnbEF0dGFjaG1lbnRUeXBlLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgoJCX0KCgkJLy8gcmViaW5kIGZyYW1lYnVmZmVyIHdpdGggZXh0ZXJuYWwgdGV4dHVyZXMKCQlmdW5jdGlvbiByZWJpbmRUZXh0dXJlcyggcmVuZGVyVGFyZ2V0LCBjb2xvclRleHR1cmUsIGRlcHRoVGV4dHVyZSApIHsKCgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQlpZiAoIGNvbG9yVGV4dHVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCByZW5kZXJUYXJnZXQudGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKCQkJfQoKCQkJaWYgKCBkZXB0aFRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCgkJCX0KCgkJfQoKCQkvLyBTZXQgdXAgR0wgcmVzb3VyY2VzIGZvciB0aGUgcmVuZGVyIHRhcmdldAoJCWZ1bmN0aW9uIHNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCQlyZW5kZXJUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblJlbmRlclRhcmdldERpc3Bvc2UgKTsKCgkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzOwoKCQkJY29uc3QgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKCQkJY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSAoIHRleHR1cmVzLmxlbmd0aCA+IDEgKTsKCgkJCWlmICggISBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID0gX2dsLmNyZWF0ZVRleHR1cmUoKTsKCgkJCQl9CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoJCQkJaW5mby5tZW1vcnkudGV4dHVyZXMgKys7CgoJCQl9CgoJCQkvLyBTZXR1cCBmcmFtZWJ1ZmZlcgoKCQkJaWYgKCBpc0N1YmUgKSB7CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gPSBbXTsKCgkJCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsgbGV2ZWwgKysgKSB7CgoJCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBbXTsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBsZXZlbCBdID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCX0KCgkJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgoJCQkJCQlpZiAoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzICsrOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggKCByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlciA9IFtdOwoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgkJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgoJCQkJCQlfZ2wuYmluZFJlbmRlcmJ1ZmZlciggX2dsLlJFTkRFUkJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApOwoKCQkJCQkJY29uc3QgZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCQkJCQljb25zdCBnbEludGVybmFsRm9ybWF0ID0gZ2V0SW50ZXJuYWxGb3JtYXQoIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQsIGdsRm9ybWF0LCBnbFR5cGUsIHRleHR1cmUuY29sb3JTcGFjZSwgcmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKTsKCQkJCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoJCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCX0KCgkJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgKSB7CgoJCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciA9IF9nbC5jcmVhdGVSZW5kZXJidWZmZXIoKTsKCQkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0cnVlICk7CgoJCQkJCX0KCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBTZXR1cCBjb2xvciBidWZmZXIKCgkJCWlmICggaXNDdWJlICkgewoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZSApOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQkJCWlmICggdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBsZXZlbCApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0sIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgMCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgoJCQkJCWdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCApOwoKCQkJCX0KCgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9IGVsc2UgaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGF0dGFjaG1lbnQgPSB0ZXh0dXJlc1sgaSBdOwoJCQkJCWNvbnN0IGF0dGFjaG1lbnRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGF0dGFjaG1lbnQgKTsKCgkJCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJELCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBfZ2wuVEVYVFVSRV8yRCwgYXR0YWNobWVudCApOwoJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBhdHRhY2htZW50LCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKCQkJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggYXR0YWNobWVudCApICkgewoKCQkJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFXzJEICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQkJfSBlbHNlIHsKCgkJCQlsZXQgZ2xUZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzJEOwoKCQkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCB8fCByZW5kZXJUYXJnZXQuaXNXZWJHTEFycmF5UmVuZGVyVGFyZ2V0ICkgewoKCQkJCQlnbFRleHR1cmVUeXBlID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCA/IF9nbC5URVhUVVJFXzNEIDogX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgoJCQkJfQoKCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCBnbFRleHR1cmVUeXBlLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIGdsVGV4dHVyZVR5cGUsIHRleHR1cmUgKTsKCgkJCQlpZiAoIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsVGV4dHVyZVR5cGUsIGxldmVsICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbFRleHR1cmVUeXBlLCAwICk7CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlICkgKSB7CgoJCQkJCWdlbmVyYXRlTWlwbWFwKCBnbFRleHR1cmVUeXBlICk7CgoJCQkJfQoKCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCX0KCgkJCS8vIFNldHVwIGRlcHRoIGFuZCBzdGVuY2lsIGJ1ZmZlcnMKCgkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKCQkJCXNldHVwRGVwdGhSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggcmVuZGVyVGFyZ2V0ICkgewoKCQkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQudGV4dHVyZXM7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgdGV4dHVyZSA9IHRleHR1cmVzWyBpIF07CgoJCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUgKSApIHsKCgkJCQkJY29uc3QgdGFyZ2V0VHlwZSA9IGdldFRhcmdldFR5cGUoIHJlbmRlclRhcmdldCApOwoJCQkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICkuX193ZWJnbFRleHR1cmU7CgoJCQkJCXN0YXRlLmJpbmRUZXh0dXJlKCB0YXJnZXRUeXBlLCB3ZWJnbFRleHR1cmUgKTsKCQkJCQlnZW5lcmF0ZU1pcG1hcCggdGFyZ2V0VHlwZSApOwoJCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJY29uc3QgaW52YWxpZGF0aW9uQXJyYXlSZWFkID0gW107CgkJY29uc3QgaW52YWxpZGF0aW9uQXJyYXlEcmF3ID0gW107CgoJCWZ1bmN0aW9uIHVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKSB7CgoJCQlpZiAoIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCApIHsKCgkJCQlpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKCQkJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlczsKCQkJCQljb25zdCB3aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKCQkJCQljb25zdCBoZWlnaHQgPSByZW5kZXJUYXJnZXQuaGVpZ2h0OwoJCQkJCWxldCBtYXNrID0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CgkJCQkJY29uc3QgZGVwdGhTdHlsZSA9IHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyID8gX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCA6IF9nbC5ERVBUSF9BVFRBQ0hNRU5UOwoJCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJCQkJY29uc3QgaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgPSAoIHRleHR1cmVzLmxlbmd0aCA+IDEgKTsKCgkJCQkJLy8gSWYgTVJUIHdlIG5lZWQgdG8gcmVtb3ZlIEZCTyBhdHRhY2htZW50cwoJCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgkJCQkJCQlfZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlJFTkRFUkJVRkZFUiwgbnVsbCApOwoKCQkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIG51bGwsIDAgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKCQkJCQljb25zdCBtaXBtYXBzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmUubWlwbWFwczsKCgkJCQkJaWYgKCBtaXBtYXBzICYmIG1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyAwIF0gKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQucmVzb2x2ZURlcHRoQnVmZmVyICkgewoKCQkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgbWFzayB8PSBfZ2wuREVQVEhfQlVGRkVSX0JJVDsKCgkJCQkJCQkvLyByZXNvbHZpbmcgc3RlbmNpbCBpcyBzbG93IHdpdGggYSBEM0QgYmFja2VuZC4gZGlzYWJsZSBpdCBmb3IgYWxsIHRyYW5zbWlzc2lvbiByZW5kZXIgdGFyZ2V0cyAoc2VlICMyNzc5OSkKCgkJCQkJCQlpZiAoIHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyICYmIHJlbmRlclRhcmdldC5yZXNvbHZlU3RlbmNpbEJ1ZmZlciApIG1hc2sgfD0gX2dsLlNURU5DSUxfQlVGRkVSX0JJVDsKCgkJCQkJCX0KCgkJCQkJCWlmICggaXNNdWx0aXBsZVJlbmRlclRhcmdldHMgKSB7CgoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmVzWyBpIF0gKS5fX3dlYmdsVGV4dHVyZTsKCQkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKCQkJCQkJfQoKCQkJCQkJX2dsLmJsaXRGcmFtZWJ1ZmZlciggMCwgMCwgd2lkdGgsIGhlaWdodCwgMCwgMCwgd2lkdGgsIGhlaWdodCwgbWFzaywgX2dsLk5FQVJFU1QgKTsKCgkJCQkJCWlmICggc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgPT09IHRydWUgKSB7CgoJCQkJCQkJaW52YWxpZGF0aW9uQXJyYXlSZWFkLmxlbmd0aCA9IDA7CgkJCQkJCQlpbnZhbGlkYXRpb25BcnJheURyYXcubGVuZ3RoID0gMDsKCgkJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQucHVzaCggX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSApOwoKCQkJCQkJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICYmIHJlbmRlclRhcmdldC5yZXNvbHZlRGVwdGhCdWZmZXIgPT09IGZhbHNlICkgewoKCQkJCQkJCQlpbnZhbGlkYXRpb25BcnJheVJlYWQucHVzaCggZGVwdGhTdHlsZSApOwoJCQkJCQkJCWludmFsaWRhdGlvbkFycmF5RHJhdy5wdXNoKCBkZXB0aFN0eWxlICk7CgoJCQkJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBpbnZhbGlkYXRpb25BcnJheURyYXcgKTsKCgkJCQkJCQl9CgoJCQkJCQkJX2dsLmludmFsaWRhdGVGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIGludmFsaWRhdGlvbkFycmF5UmVhZCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgoJCQkJCS8vIElmIE1SVCBzaW5jZSBwcmUtYmxpdCB3ZSByZW1vdmVkIHRoZSBGQk8gd2UgbmVlZCB0byByZWNvbnN0cnVjdCB0aGUgYXR0YWNobWVudHMKCQkJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCgkJCQkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApLl9fd2ViZ2xUZXh0dXJlOwoKCQkJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhCdWZmZXIgJiYgcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgJiYgc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgKSB7CgoJCQkJCQljb25zdCBkZXB0aFN0eWxlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgoJCQkJCQlfZ2wuaW52YWxpZGF0ZUZyYW1lYnVmZmVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgWyBkZXB0aFN0eWxlIF0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKSB7CgoJCQlyZXR1cm4gTWF0aC5taW4oIGNhcGFiaWxpdGllcy5tYXhTYW1wbGVzLCByZW5kZXJUYXJnZXQuc2FtcGxlcyApOwoKCQl9CgoJCWZ1bmN0aW9uIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgewoKCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJCXJldHVybiByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgJiYgZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IHRydWUgJiYgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZVJlbmRlclRvVGV4dHVyZSAhPT0gZmFsc2U7CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlVmlkZW9UZXh0dXJlKCB0ZXh0dXJlICkgewoKCQkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJCS8vIENoZWNrIHRoZSBsYXN0IGZyYW1lIHdlIHVwZGF0ZWQgdGhlIFZpZGVvVGV4dHVyZQoKCQkJaWYgKCBfdmlkZW9UZXh0dXJlcy5nZXQoIHRleHR1cmUgKSAhPT0gZnJhbWUgKSB7CgoJCQkJX3ZpZGVvVGV4dHVyZXMuc2V0KCB0ZXh0dXJlLCBmcmFtZSApOwoJCQkJdGV4dHVyZS51cGRhdGUoKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiB2ZXJpZnlDb2xvclNwYWNlKCB0ZXh0dXJlLCBpbWFnZSApIHsKCgkJCWNvbnN0IGNvbG9yU3BhY2UgPSB0ZXh0dXJlLmNvbG9yU3BhY2U7CgkJCWNvbnN0IGZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwoJCQljb25zdCB0eXBlID0gdGV4dHVyZS50eXBlOwoKCQkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgPT09IHRydWUgfHwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApIHJldHVybiBpbWFnZTsKCgkJCWlmICggY29sb3JTcGFjZSAhPT0gTGluZWFyU1JHQkNvbG9yU3BhY2UgJiYgY29sb3JTcGFjZSAhPT0gTm9Db2xvclNwYWNlICkgewoKCQkJCS8vIHNSR0IKCgkJCQlpZiAoIENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSB7CgoJCQkJCS8vIGluIFdlYkdMIDIgdW5jb21wcmVzc2VkIHRleHR1cmVzIGNhbiBvbmx5IGJlIHNSR0IgZW5jb2RlZCBpZiB0aGV5IGhhdmUgdGhlIFJHQkE4IGZvcm1hdAoKCQkJCQlpZiAoIGZvcm1hdCAhPT0gUkdCQUZvcm1hdCB8fCB0eXBlICE9PSBVbnNpZ25lZEJ5dGVUeXBlICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogc1JHQiBlbmNvZGVkIHRleHR1cmVzIGhhdmUgdG8gdXNlIFJHQkFGb3JtYXQgYW5kIFVuc2lnbmVkQnl0ZVR5cGUuJyApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMVGV4dHVyZXM6IFVuc3VwcG9ydGVkIHRleHR1cmUgY29sb3Igc3BhY2U6JywgY29sb3JTcGFjZSApOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBpbWFnZTsKCgkJfQoKCQlmdW5jdGlvbiBnZXREaW1lbnNpb25zKCBpbWFnZSApIHsKCgkJCWlmICggdHlwZW9mIEhUTUxJbWFnZUVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHsKCgkJCQkvLyBpZiBpbnRyaW5zaWMgZGF0YSBhcmUgbm90IGF2YWlsYWJsZSwgZmFsbGJhY2sgdG8gd2lkdGgvaGVpZ2h0CgoJCQkJX2ltYWdlRGltZW5zaW9ucy53aWR0aCA9IGltYWdlLm5hdHVyYWxXaWR0aCB8fCBpbWFnZS53aWR0aDsKCQkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UubmF0dXJhbEhlaWdodCB8fCBpbWFnZS5oZWlnaHQ7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgVmlkZW9GcmFtZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBWaWRlb0ZyYW1lICkgewoKCQkJCV9pbWFnZURpbWVuc2lvbnMud2lkdGggPSBpbWFnZS5kaXNwbGF5V2lkdGg7CgkJCQlfaW1hZ2VEaW1lbnNpb25zLmhlaWdodCA9IGltYWdlLmRpc3BsYXlIZWlnaHQ7CgoJCQl9IGVsc2UgewoKCQkJCV9pbWFnZURpbWVuc2lvbnMud2lkdGggPSBpbWFnZS53aWR0aDsKCQkJCV9pbWFnZURpbWVuc2lvbnMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwoKCQkJfQoKCQkJcmV0dXJuIF9pbWFnZURpbWVuc2lvbnM7CgoJCX0KCgkJLy8KCgkJdGhpcy5hbGxvY2F0ZVRleHR1cmVVbml0ID0gYWxsb2NhdGVUZXh0dXJlVW5pdDsKCQl0aGlzLnJlc2V0VGV4dHVyZVVuaXRzID0gcmVzZXRUZXh0dXJlVW5pdHM7CgoJCXRoaXMuc2V0VGV4dHVyZTJEID0gc2V0VGV4dHVyZTJEOwoJCXRoaXMuc2V0VGV4dHVyZTJEQXJyYXkgPSBzZXRUZXh0dXJlMkRBcnJheTsKCQl0aGlzLnNldFRleHR1cmUzRCA9IHNldFRleHR1cmUzRDsKCQl0aGlzLnNldFRleHR1cmVDdWJlID0gc2V0VGV4dHVyZUN1YmU7CgkJdGhpcy5yZWJpbmRUZXh0dXJlcyA9IHJlYmluZFRleHR1cmVzOwoJCXRoaXMuc2V0dXBSZW5kZXJUYXJnZXQgPSBzZXR1cFJlbmRlclRhcmdldDsKCQl0aGlzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCA9IHVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcDsKCQl0aGlzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0ID0gdXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQ7CgkJdGhpcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyID0gc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlcjsKCQl0aGlzLnNldHVwRnJhbWVCdWZmZXJUZXh0dXJlID0gc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmU7CgkJdGhpcy51c2VNdWx0aXNhbXBsZWRSVFQgPSB1c2VNdWx0aXNhbXBsZWRSVFQ7CgoJfQoKCWZ1bmN0aW9uIFdlYkdMVXRpbHMoIGdsLCBleHRlbnNpb25zICkgewoKCQlmdW5jdGlvbiBjb252ZXJ0KCBwLCBjb2xvclNwYWNlID0gTm9Db2xvclNwYWNlICkgewoKCQkJbGV0IGV4dGVuc2lvbjsKCgkJCWNvbnN0IHRyYW5zZmVyID0gQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgoJCQlpZiAoIHAgPT09IFVuc2lnbmVkQnl0ZVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfQllURTsKCQkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NDQ0NFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNF80XzRfNDsKCQkJaWYgKCBwID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlRfNV81XzVfMTsKCQkJaWYgKCBwID09PSBVbnNpZ25lZEludDU5OTlUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVF81XzlfOV85X1JFVjsKCgkJCWlmICggcCA9PT0gQnl0ZVR5cGUgKSByZXR1cm4gZ2wuQllURTsKCQkJaWYgKCBwID09PSBTaG9ydFR5cGUgKSByZXR1cm4gZ2wuU0hPUlQ7CgkJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfU0hPUlQ7CgkJCWlmICggcCA9PT0gSW50VHlwZSApIHJldHVybiBnbC5JTlQ7CgkJCWlmICggcCA9PT0gVW5zaWduZWRJbnRUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVDsKCQkJaWYgKCBwID09PSBGbG9hdFR5cGUgKSByZXR1cm4gZ2wuRkxPQVQ7CgkJCWlmICggcCA9PT0gSGFsZkZsb2F0VHlwZSApIHJldHVybiBnbC5IQUxGX0ZMT0FUOwoKCQkJaWYgKCBwID09PSBBbHBoYUZvcm1hdCApIHJldHVybiBnbC5BTFBIQTsKCQkJaWYgKCBwID09PSBSR0JGb3JtYXQgKSByZXR1cm4gZ2wuUkdCOwoJCQlpZiAoIHAgPT09IFJHQkFGb3JtYXQgKSByZXR1cm4gZ2wuUkdCQTsKCQkJaWYgKCBwID09PSBEZXB0aEZvcm1hdCApIHJldHVybiBnbC5ERVBUSF9DT01QT05FTlQ7CgkJCWlmICggcCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgcmV0dXJuIGdsLkRFUFRIX1NURU5DSUw7CgoJCQkvLyBXZWJHTDIgZm9ybWF0cy4KCgkJCWlmICggcCA9PT0gUmVkRm9ybWF0ICkgcmV0dXJuIGdsLlJFRDsKCQkJaWYgKCBwID09PSBSZWRJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJFRF9JTlRFR0VSOwoJCQlpZiAoIHAgPT09IFJHRm9ybWF0ICkgcmV0dXJuIGdsLlJHOwoJCQlpZiAoIHAgPT09IFJHSW50ZWdlckZvcm1hdCApIHJldHVybiBnbC5SR19JTlRFR0VSOwoJCQlpZiAoIHAgPT09IFJHQkFJbnRlZ2VyRm9ybWF0ICkgcmV0dXJuIGdsLlJHQkFfSU5URUdFUjsKCgkJCS8vIFMzVEMKCgkJCWlmICggcCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSB7CgoJCQkJaWYgKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgewoKCQkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjX3NyZ2InICk7CgoJCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX1MzVENfRFhUMV9FWFQ7CgkJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfQUxQSEFfUzNUQ19EWFQxX0VYVDsKCQkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUM19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9TM1RDX0RYVDNfRVhUOwoJCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX1MzVENfRFhUNV9FWFQ7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICk7CgoJCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQkJaWYgKCBwID09PSBSR0JfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUzNUQ19EWFQxX0VYVDsKCQkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDFfRVhUOwoJCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUM19FWFQ7CgkJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQ1X0VYVDsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXJldHVybiBudWxsOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gUFZSVEMKCgkJCWlmICggcCA9PT0gUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUFZSVENfNEJQUFYxX0lNRzsKCQkJCQlpZiAoIHAgPT09IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9QVlJUQ18yQlBQVjFfSU1HOwoJCQkJCWlmICggcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUFZSVENfNEJQUFYxX0lNRzsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1BWUlRDXzJCUFBWMV9JTUc7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQkJLy8gRVRDCgoJCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCB8fCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfZXRjJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHAgPT09IFJHQl9FVEMxX0Zvcm1hdCB8fCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9FVEMyIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCOF9FVEMyOwoJCQkJCWlmICggcCA9PT0gUkdCQV9FVEMyX0VBQ19Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfRVRDMl9FQUMgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBOF9FVEMyX0VBQzsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQl9CgoJCQkvLyBBU1RDCgoJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ181eDRfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ181eDVfRm9ybWF0IHx8CgkJCQlwID09PSBSR0JBX0FTVENfNng1X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfNng2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCB8fAoJCQkJcCA9PT0gUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDVfRm9ybWF0IHx8CgkJCQlwID09PSBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgfHwKCQkJCXAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHsKCgkJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ180eDRfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNHg0X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ180eDRfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ181eDRfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzV4NF9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNXg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzV4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNXg1X0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ182eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNng1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ182eDVfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ182eDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzZ4Nl9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfOHg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzh4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfOHg1X0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ184eDZfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfOHg2X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ184eDZfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ184eDhfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzh4OF9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHg1X0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDZfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4OF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4OF9LSFI7CgkJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4MTBfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4MTBfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDEwX0tIUjsKCQkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMngxMF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTJ4MTBfS0hSOwoJCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEyeDEyX0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMngxMl9LSFI7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQkJLy8gQlBUQwoKCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0IHx8IHAgPT09IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgfHwgcCA9PT0gUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ICkgewoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fYnB0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9CUFRDX1VOT1JNX0VYVCA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQlBUQ19VTk9STV9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19TSUdORURfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9CUFRDX1NJR05FRF9GTE9BVF9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JfQlBUQ19VTlNJR05FRF9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0JQVENfVU5TSUdORURfRkxPQVRfRVhUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJldHVybiBudWxsOwoKCQkJCX0KCgkJCX0KCgkJCS8vIFJHVEMKCgkJCWlmICggcCA9PT0gUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCB8fCBwID09PSBSRURfR1JFRU5fUkdUQzJfRm9ybWF0IHx8IHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgewoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fcmd0YycgKTsKCgkJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JFRF9SR1RDMV9FWFQ7CgkJCQkJaWYgKCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TSUdORURfUkVEX1JHVEMxX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkVEX0dSRUVOX1JHVEMyX0VYVDsKCQkJCQlpZiAoIHAgPT09IFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NJR05FRF9SRURfR1JFRU5fUkdUQzJfRVhUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXJldHVybiBudWxsOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlpZiAoIHAgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9JTlRfMjRfODsKCgkJCS8vIGlmICJwIiBjYW4ndCBiZSByZXNvbHZlZCwgYXNzdW1lIHRoZSB1c2VyIGRlZmluZXMgYSBXZWJHTCBjb25zdGFudCBhcyBhIHN0cmluZyAoZmFsbGJhY2svd29ya2Fyb3VuZCBmb3IgcGFja2VkIFJHQiBmb3JtYXRzKQoKCQkJcmV0dXJuICggZ2xbIHAgXSAhPT0gdW5kZWZpbmVkICkgPyBnbFsgcCBdIDogbnVsbDsKCgkJfQoKCQlyZXR1cm4geyBjb252ZXJ0OiBjb252ZXJ0IH07CgoJfQoKCWNvbnN0IF9vY2NsdXNpb25fdmVydGV4ID0gYAp2b2lkIG1haW4oKSB7CgoJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7Cgp9YDsKCgljb25zdCBfb2NjbHVzaW9uX2ZyYWdtZW50ID0gYAp1bmlmb3JtIHNhbXBsZXIyREFycmF5IGRlcHRoQ29sb3I7CnVuaWZvcm0gZmxvYXQgZGVwdGhXaWR0aDsKdW5pZm9ybSBmbG9hdCBkZXB0aEhlaWdodDsKCnZvaWQgbWFpbigpIHsKCgl2ZWMyIGNvb3JkID0gdmVjMiggZ2xfRnJhZ0Nvb3JkLnggLyBkZXB0aFdpZHRoLCBnbF9GcmFnQ29vcmQueSAvIGRlcHRoSGVpZ2h0ICk7CgoJaWYgKCBjb29yZC54ID49IDEuMCApIHsKCgkJZ2xfRnJhZ0RlcHRoID0gdGV4dHVyZSggZGVwdGhDb2xvciwgdmVjMyggY29vcmQueCAtIDEuMCwgY29vcmQueSwgMSApICkucjsKCgl9IGVsc2UgewoKCQlnbF9GcmFnRGVwdGggPSB0ZXh0dXJlKCBkZXB0aENvbG9yLCB2ZWMzKCBjb29yZC54LCBjb29yZC55LCAwICkgKS5yOwoKCX0KCn1gOwoKCS8qKgoJICogQSBYUiBtb2R1bGUgdGhhdCBtYW5hZ2VzIHRoZSBhY2Nlc3MgdG8gdGhlIERlcHRoIFNlbnNpbmcgQVBJLgoJICovCgljbGFzcyBXZWJYUkRlcHRoU2Vuc2luZyB7CgoJCS8qKgoJCSAqIENvbnN0cnVjdHMgYSBuZXcgZGVwdGggc2Vuc2luZyBtb2R1bGUuCgkJICovCgkJY29uc3RydWN0b3IoKSB7CgoJCQkvKioKCQkJICogQSB0ZXh0dXJlIHJlcHJlc2VudGluZyB0aGUgZGVwdGggb2YgdGhlIHVzZXIncyBlbnZpcm9ubWVudC4KCQkJICoKCQkJICogQHR5cGUgez9UZXh0dXJlfQoJCQkgKi8KCQkJdGhpcy50ZXh0dXJlID0gbnVsbDsKCgkJCS8qKgoJCQkgKiBBIHBsYW5lIG1lc2ggZm9yIHZpc3VhbGl6aW5nIHRoZSBkZXB0aCB0ZXh0dXJlLgoJCQkgKgoJCQkgKiBAdHlwZSB7P01lc2h9CgkJCSAqLwoJCQl0aGlzLm1lc2ggPSBudWxsOwoKCQkJLyoqCgkJCSAqIFRoZSBkZXB0aCBuZWFyIHZhbHVlLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKi8KCQkJdGhpcy5kZXB0aE5lYXIgPSAwOwoKCQkJLyoqCgkJCSAqIFRoZSBkZXB0aCBuZWFyIGZhci4KCQkJICoKCQkJICogQHR5cGUge251bWJlcn0KCQkJICovCgkJCXRoaXMuZGVwdGhGYXIgPSAwOwoKCQl9CgoJCS8qKgoJCSAqIEluaXRzIHRoZSBkZXB0aCBzZW5zaW5nIG1vZHVsZQoJCSAqCgkJICogQHBhcmFtIHtXZWJHTFJlbmRlcmVyfSByZW5kZXJlciAtIFRoZSByZW5kZXJlci4KCQkgKiBAcGFyYW0ge1hSV2ViR0xEZXB0aEluZm9ybWF0aW9ufSBkZXB0aERhdGEgLSBUaGUgWFIgZGVwdGggZGF0YS4KCQkgKiBAcGFyYW0ge1hSUmVuZGVyU3RhdGV9IHJlbmRlclN0YXRlIC0gVGhlIFhSIHJlbmRlciBzdGF0ZS4KCQkgKi8KCQlpbml0KCByZW5kZXJlciwgZGVwdGhEYXRhLCByZW5kZXJTdGF0ZSApIHsKCgkJCWlmICggdGhpcy50ZXh0dXJlID09PSBudWxsICkgewoKCQkJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQkJCWNvbnN0IHRleFByb3BzID0gcmVuZGVyZXIucHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCQkJCXRleFByb3BzLl9fd2ViZ2xUZXh0dXJlID0gZGVwdGhEYXRhLnRleHR1cmU7CgoJCQkJaWYgKCAoIGRlcHRoRGF0YS5kZXB0aE5lYXIgIT09IHJlbmRlclN0YXRlLmRlcHRoTmVhciApIHx8ICggZGVwdGhEYXRhLmRlcHRoRmFyICE9PSByZW5kZXJTdGF0ZS5kZXB0aEZhciApICkgewoKCQkJCQl0aGlzLmRlcHRoTmVhciA9IGRlcHRoRGF0YS5kZXB0aE5lYXI7CgkJCQkJdGhpcy5kZXB0aEZhciA9IGRlcHRoRGF0YS5kZXB0aEZhcjsKCgkJCQl9CgoJCQkJdGhpcy50ZXh0dXJlID0gdGV4dHVyZTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgcGxhbmUgbWVzaCB0aGF0IHZpc3VhbGl6ZXMgdGhlIGRlcHRoIHRleHR1cmUuCgkJICoKCQkgKiBAcGFyYW0ge0FycmF5Q2FtZXJhfSBjYW1lcmFYUiAtIFRoZSBYUiBjYW1lcmEuCgkJICogQHJldHVybiB7P01lc2h9IFRoZSBwbGFuZSBtZXNoLgoJCSAqLwoJCWdldE1lc2goIGNhbWVyYVhSICkgewoKCQkJaWYgKCB0aGlzLnRleHR1cmUgIT09IG51bGwgKSB7CgoJCQkJaWYgKCB0aGlzLm1lc2ggPT09IG51bGwgKSB7CgoJCQkJCWNvbnN0IHZpZXdwb3J0ID0gY2FtZXJhWFIuY2FtZXJhc1sgMCBdLnZpZXdwb3J0OwoJCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgkJCQkJCXZlcnRleFNoYWRlcjogX29jY2x1c2lvbl92ZXJ0ZXgsCgkJCQkJCWZyYWdtZW50U2hhZGVyOiBfb2NjbHVzaW9uX2ZyYWdtZW50LAoJCQkJCQl1bmlmb3JtczogewoJCQkJCQkJZGVwdGhDb2xvcjogeyB2YWx1ZTogdGhpcy50ZXh0dXJlIH0sCgkJCQkJCQlkZXB0aFdpZHRoOiB7IHZhbHVlOiB2aWV3cG9ydC56IH0sCgkJCQkJCQlkZXB0aEhlaWdodDogeyB2YWx1ZTogdmlld3BvcnQudyB9CgkJCQkJCX0KCQkJCQl9ICk7CgoJCQkJCXRoaXMubWVzaCA9IG5ldyBNZXNoKCBuZXcgUGxhbmVHZW9tZXRyeSggMjAsIDIwICksIG1hdGVyaWFsICk7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRoaXMubWVzaDsKCgkJfQoKCQkvKioKCQkgKiBSZXNldHMgdGhlIG1vZHVsZQoJCSAqLwoJCXJlc2V0KCkgewoKCQkJdGhpcy50ZXh0dXJlID0gbnVsbDsKCQkJdGhpcy5tZXNoID0gbnVsbDsKCgkJfQoKCQkvKioKCQkgKiBSZXR1cm5zIGEgdGV4dHVyZSByZXByZXNlbnRpbmcgdGhlIGRlcHRoIG9mIHRoZSB1c2VyJ3MgZW52aXJvbm1lbnQuCgkJICoKCQkgKiBAcmV0dXJuIHs/VGV4dHVyZX0gVGhlIGRlcHRoIHRleHR1cmUuCgkJICovCgkJZ2V0RGVwdGhUZXh0dXJlKCkgewoKCQkJcmV0dXJuIHRoaXMudGV4dHVyZTsKCgkJfQoKCX0KCgkvKioKCSAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyBhbiBhYnN0cmFjdGlvbiBvZiB0aGUgV2ViWFIgRGV2aWNlIEFQSSBhbmQgaXMKCSAqIGludGVybmFsbHkgdXNlZCBieSB7QGxpbmsgV2ViR0xSZW5kZXJlcn0uIGBXZWJYUk1hbmFnZXJgIGFsc28gcHJvdmlkZXMgYSBwdWJsaWMKCSAqIGludGVyZmFjZSB0aGF0IGFsbG93cyB1c2VycyB0byBlbmFibGUvZGlzYWJsZSBYUiBhbmQgcGVyZm9ybSBYUiByZWxhdGVkCgkgKiB0YXNrcyBsaWtlIGZvciBpbnN0YW5jZSByZXRyaWV2aW5nIGNvbnRyb2xsZXJzLgoJICoKCSAqIEBhdWdtZW50cyBFdmVudERpc3BhdGNoZXIKCSAqIEBoaWRlY29uc3RydWN0b3IKCSAqLwoJY2xhc3MgV2ViWFJNYW5hZ2VyIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBXZWJHTCByZW5kZXJlci4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn0gcmVuZGVyZXIgLSBUaGUgcmVuZGVyZXIuCgkJICogQHBhcmFtIHtXZWJHTDJSZW5kZXJpbmdDb250ZXh0fSBnbCAtIFRoZSByZW5kZXJpbmcgY29udGV4dC4KCQkgKi8KCQljb25zdHJ1Y3RvciggcmVuZGVyZXIsIGdsICkgewoKCQkJc3VwZXIoKTsKCgkJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJCWxldCBzZXNzaW9uID0gbnVsbDsKCgkJCWxldCBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gMS4wOwoKCQkJbGV0IHJlZmVyZW5jZVNwYWNlID0gbnVsbDsKCQkJbGV0IHJlZmVyZW5jZVNwYWNlVHlwZSA9ICdsb2NhbC1mbG9vcic7CgkJCS8vIFNldCBkZWZhdWx0IGZvdmVhdGlvbiB0byBtYXhpbXVtLgoJCQlsZXQgZm92ZWF0aW9uID0gMS4wOwoJCQlsZXQgY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwoKCQkJbGV0IHBvc2UgPSBudWxsOwoJCQlsZXQgZ2xCaW5kaW5nID0gbnVsbDsKCQkJbGV0IGdsUHJvakxheWVyID0gbnVsbDsKCQkJbGV0IGdsQmFzZUxheWVyID0gbnVsbDsKCQkJbGV0IHhyRnJhbWUgPSBudWxsOwoKCQkJY29uc3QgZGVwdGhTZW5zaW5nID0gbmV3IFdlYlhSRGVwdGhTZW5zaW5nKCk7CgkJCWNvbnN0IGF0dHJpYnV0ZXMgPSBnbC5nZXRDb250ZXh0QXR0cmlidXRlcygpOwoKCQkJbGV0IGluaXRpYWxSZW5kZXJUYXJnZXQgPSBudWxsOwoJCQlsZXQgbmV3UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCWNvbnN0IGNvbnRyb2xsZXJzID0gW107CgkJCWNvbnN0IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMgPSBbXTsKCgkJCWNvbnN0IGN1cnJlbnRTaXplID0gbmV3IFZlY3RvcjIoKTsKCQkJbGV0IGN1cnJlbnRQaXhlbFJhdGlvID0gbnVsbDsKCgkJCS8vCgoJCQljb25zdCBjYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJCWNhbWVyYUwudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKCQkJY29uc3QgY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCQljYW1lcmFSLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKCgkJCWNvbnN0IGNhbWVyYXMgPSBbIGNhbWVyYUwsIGNhbWVyYVIgXTsKCgkJCWNvbnN0IGNhbWVyYVhSID0gbmV3IEFycmF5Q2FtZXJhKCk7CgoJCQlsZXQgX2N1cnJlbnREZXB0aE5lYXIgPSBudWxsOwoJCQlsZXQgX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CgoJCQkvLwoKCQkJLyoqCgkJCSAqIFdoZXRoZXIgdGhlIG1hbmFnZXIncyBYUiBjYW1lcmEgc2hvdWxkIGJlIGF1dG9tYXRpY2FsbHkgdXBkYXRlZCBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmNhbWVyYUF1dG9VcGRhdGUgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBub3RpZmllcyB0aGUgcmVuZGVyZXIgdG8gYmUgcmVhZHkgZm9yIFhSIHJlbmRlcmluZy4gU2V0IGl0IHRvIGB0cnVlYAoJCQkgKiBpZiB5b3UgYXJlIGdvaW5nIHRvIHVzZSBYUiBpbiB5b3VyIGFwcC4KCQkJICoKCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJCS8qKgoJCQkgKiBXaGV0aGVyIFhSIHByZXNlbnRhdGlvbiBpcyBhY3RpdmUgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IGZhbHNlCgkJCSAqLwoJCQl0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwoKCQkJLyoqCgkJCSAqIFJldHVybnMgYSBncm91cCByZXByZXNlbnRpbmcgdGhlIGB0YXJnZXQgcmF5YCBzcGFjZSBvZiB0aGUgWFIgY29udHJvbGxlci4KCQkJICogVXNlIHRoaXMgc3BhY2UgZm9yIHZpc3VhbGl6aW5nIDNEIG9iamVjdHMgdGhhdCBzdXBwb3J0IHRoZSB1c2VyIGluIHBvaW50aW5nCgkJCSAqIHRhc2tzIGxpa2UgVUkgaW50ZXJhY3Rpb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgY29udHJvbGxlci4KCQkJICogQHJldHVybiB7R3JvdXB9IEEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgdGFyZ2V0IHJheWAgc3BhY2UuCgkJCSAqLwoJCQl0aGlzLmdldENvbnRyb2xsZXIgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgoJCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CgkJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKCQkJCX0KCgkJCQlyZXR1cm4gY29udHJvbGxlci5nZXRUYXJnZXRSYXlTcGFjZSgpOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIGEgZ3JvdXAgcmVwcmVzZW50aW5nIHRoZSBgZ3JpcGAgc3BhY2Ugb2YgdGhlIFhSIGNvbnRyb2xsZXIuCgkJCSAqIFVzZSB0aGlzIHNwYWNlIGZvciB2aXN1YWxpemluZyAzRCBvYmplY3RzIHRoYXQgc3VwcG9ydCB0aGUgdXNlciBpbiBwb2ludGluZwoJCQkgKiB0YXNrcyBsaWtlIFVJIGludGVyYWN0aW9uLgoJCQkgKgoJCQkgKiBOb3RlOiBJZiB5b3Ugd2FudCB0byBzaG93IHNvbWV0aGluZyBpbiB0aGUgdXNlcidzIGhhbmQgQU5EIG9mZmVyIGEKCQkJICogcG9pbnRpbmcgcmF5IGF0IHRoZSBzYW1lIHRpbWUsIHlvdSdsbCB3YW50IHRvIGF0dGFjaGVkIHRoZSBoYW5kaGVsZCBvYmplY3QKCQkJICogdG8gdGhlIGdyb3VwIHJldHVybmVkIGJ5IGBnZXRDb250cm9sbGVyR3JpcCgpYCBhbmQgdGhlIHJheSB0byB0aGUKCQkJICogZ3JvdXAgcmV0dXJuZWQgYnkgYGdldENvbnRyb2xsZXIoKWAuIFRoZSBpZGVhIGlzIHRvIGhhdmUgdHdvCgkJCSAqIGRpZmZlcmVudCBncm91cHMgaW4gdHdvIGRpZmZlcmVudCBjb29yZGluYXRlIHNwYWNlcyBmb3IgdGhlIHNhbWUgV2ViWFIKCQkJICogY29udHJvbGxlci4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgoJCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBncmlwYCBzcGFjZS4KCQkJICovCgkJCXRoaXMuZ2V0Q29udHJvbGxlckdyaXAgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgoJCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CgkJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKCQkJCX0KCgkJCQlyZXR1cm4gY29udHJvbGxlci5nZXRHcmlwU3BhY2UoKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyBhIGdyb3VwIHJlcHJlc2VudGluZyB0aGUgYGhhbmRgIHNwYWNlIG9mIHRoZSBYUiBjb250cm9sbGVyLgoJCQkgKiBVc2UgdGhpcyBzcGFjZSBmb3IgdmlzdWFsaXppbmcgM0Qgb2JqZWN0cyB0aGF0IHN1cHBvcnQgdGhlIHVzZXIgaW4gcG9pbnRpbmcKCQkJICogdGFza3MgbGlrZSBVSSBpbnRlcmFjdGlvbi4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gVGhlIGluZGV4IG9mIHRoZSBjb250cm9sbGVyLgoJCQkgKiBAcmV0dXJuIHtHcm91cH0gQSBncm91cCByZXByZXNlbnRpbmcgdGhlIGBoYW5kYCBzcGFjZS4KCQkJICovCgkJCXRoaXMuZ2V0SGFuZCA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCgkJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKCQkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgoJCQkJfQoKCQkJCXJldHVybiBjb250cm9sbGVyLmdldEhhbmRTcGFjZSgpOwoKCQkJfTsKCgkJCS8vCgoJCQlmdW5jdGlvbiBvblNlc3Npb25FdmVudCggZXZlbnQgKSB7CgoJCQkJY29uc3QgY29udHJvbGxlckluZGV4ID0gY29udHJvbGxlcklucHV0U291cmNlcy5pbmRleE9mKCBldmVudC5pbnB1dFNvdXJjZSApOwoKCQkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtMSApIHsKCgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQljb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGNvbnRyb2xsZXJJbmRleCBdOwoKCQkJCWlmICggY29udHJvbGxlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljb250cm9sbGVyLnVwZGF0ZSggZXZlbnQuaW5wdXRTb3VyY2UsIGV2ZW50LmZyYW1lLCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwoJCQkJCWNvbnRyb2xsZXIuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiBldmVudC50eXBlLCBkYXRhOiBldmVudC5pbnB1dFNvdXJjZSB9ICk7CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gb25TZXNzaW9uRW5kKCkgewoKCQkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3NlbGVjdCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZScsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzcXVlZXplc3RhcnQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZWVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdlbmQnLCBvblNlc3Npb25FbmQgKTsKCQkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIG9uSW5wdXRTb3VyY2VzQ2hhbmdlICk7CgoJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKCQkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXTsKCgkJCQkJaWYgKCBpbnB1dFNvdXJjZSA9PT0gbnVsbCApIGNvbnRpbnVlOwoKCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBudWxsOwoKCQkJCQljb250cm9sbGVyc1sgaSBdLmRpc2Nvbm5lY3QoIGlucHV0U291cmNlICk7CgoJCQkJfQoKCQkJCV9jdXJyZW50RGVwdGhOZWFyID0gbnVsbDsKCQkJCV9jdXJyZW50RGVwdGhGYXIgPSBudWxsOwoKCQkJCWRlcHRoU2Vuc2luZy5yZXNldCgpOwoKCQkJCS8vIHJlc3RvcmUgZnJhbWVidWZmZXIvcmVuZGVyaW5nIHN0YXRlCgoJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBpbml0aWFsUmVuZGVyVGFyZ2V0ICk7CgoJCQkJZ2xCYXNlTGF5ZXIgPSBudWxsOwoJCQkJZ2xQcm9qTGF5ZXIgPSBudWxsOwoJCQkJZ2xCaW5kaW5nID0gbnVsbDsKCQkJCXNlc3Npb24gPSBudWxsOwoJCQkJbmV3UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCQkvLwoKCQkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCQkJc2NvcGUuaXNQcmVzZW50aW5nID0gZmFsc2U7CgoJCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggY3VycmVudFBpeGVsUmF0aW8gKTsKCQkJCXJlbmRlcmVyLnNldFNpemUoIGN1cnJlbnRTaXplLndpZHRoLCBjdXJyZW50U2l6ZS5oZWlnaHQsIGZhbHNlICk7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc2Vzc2lvbmVuZCcgfSApOwoKCQkJfQoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIGZyYW1lYnVmZmVyIHNjYWxlIGZhY3Rvci4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgY2FuIG5vdCBiZSB1c2VkIGR1cmluZyBhIFhSIHNlc3Npb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB2YWx1ZSAtIFRoZSBmcmFtZWJ1ZmZlciBzY2FsZSBmYWN0b3IuCgkJCSAqLwoJCQl0aGlzLnNldEZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3IgPSB2YWx1ZTsKCgkJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIGZyYW1lYnVmZmVyIHNjYWxlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgcmVmZXJlbmNlIHNwYWNlIHR5cGUuIENhbiBiZSB1c2VkIHRvIGNvbmZpZ3VyZSBhIHNwYXRpYWwgcmVsYXRpb25zaGlwIHdpdGggdGhlIHVzZXIncyBwaHlzaWNhbAoJCQkgKiBlbnZpcm9ubWVudC4gRGVwZW5kaW5nIG9uIGhvdyB0aGUgdXNlciBtb3ZlcyBpbiAzRCBzcGFjZSwgc2V0dGluZyBhbiBhcHByb3ByaWF0ZSByZWZlcmVuY2Ugc3BhY2UgY2FuCgkJCSAqIGltcHJvdmUgdHJhY2tpbmcuIERlZmF1bHQgaXMgYGxvY2FsLWZsb29yYC4gVmFsaWQgdmFsdWVzIGNhbiBiZSBmb3VuZCBoZXJlCgkJCSAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9YUlJlZmVyZW5jZVNwYWNlI3JlZmVyZW5jZV9zcGFjZV90eXBlcy4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgY2FuIG5vdCBiZSB1c2VkIGR1cmluZyBhIFhSIHNlc3Npb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSByZWZlcmVuY2Ugc3BhY2UgdHlwZS4KCQkJICovCgkJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2VUeXBlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCQlyZWZlcmVuY2VTcGFjZVR5cGUgPSB2YWx1ZTsKCgkJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIHJlZmVyZW5jZSBzcGFjZSB0eXBlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgWFIgcmVmZXJlbmNlIHNwYWNlLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHtYUlJlZmVyZW5jZVNwYWNlfSBUaGUgWFIgcmVmZXJlbmNlIHNwYWNlLgoJCQkgKi8KCQkJdGhpcy5nZXRSZWZlcmVuY2VTcGFjZSA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2U7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgYSBjdXN0b20gWFIgcmVmZXJlbmNlIHNwYWNlLgoJCQkgKgoJCQkgKiBAcGFyYW0ge1hSUmVmZXJlbmNlU3BhY2V9IHNwYWNlIC0gVGhlIFhSIHJlZmVyZW5jZSBzcGFjZS4KCQkJICovCgkJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2UgPSBmdW5jdGlvbiAoIHNwYWNlICkgewoKCQkJCWN1c3RvbVJlZmVyZW5jZVNwYWNlID0gc3BhY2U7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgYmFzZSBsYXllci4KCQkJICoKCQkJICogQHJldHVybiB7PyhYUldlYkdMTGF5ZXJ8WFJQcm9qZWN0aW9uTGF5ZXIpfSBUaGUgWFIgYmFzZSBsYXllci4KCQkJICovCgkJCXRoaXMuZ2V0QmFzZUxheWVyID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBnbFByb2pMYXllciAhPT0gbnVsbCA/IGdsUHJvakxheWVyIDogZ2xCYXNlTGF5ZXI7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgWFIgYmluZGluZy4KCQkJICoKCQkJICogQHJldHVybiB7P1hSV2ViR0xCaW5kaW5nfSBUaGUgWFIgYmluZGluZy4KCQkJICovCgkJCXRoaXMuZ2V0QmluZGluZyA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gZ2xCaW5kaW5nOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IFhSIGZyYW1lLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHs/WFJGcmFtZX0gVGhlIFhSIGZyYW1lLiBSZXR1cm5zIGBudWxsYCB3aGVuIHVzZWQgb3V0c2lkZSBhIFhSIHNlc3Npb24uCgkJCSAqLwoJCQl0aGlzLmdldEZyYW1lID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiB4ckZyYW1lOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IFhSIHNlc3Npb24uCgkJCSAqCgkJCSAqIEByZXR1cm4gez9YUlNlc3Npb259IFRoZSBYUiBzZXNzaW9uLiBSZXR1cm5zIGBudWxsYCB3aGVuIHVzZWQgb3V0c2lkZSBhIFhSIHNlc3Npb24uCgkJCSAqLwoJCQl0aGlzLmdldFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIHNlc3Npb247CgoJCQl9OwoKCQkJLyoqCgkJCSAqIEFmdGVyIGEgWFIgc2Vzc2lvbiBoYXMgYmVlbiByZXF1ZXN0ZWQgdXN1YWxseSB3aXRoIG9uZSBvZiB0aGUgYCpCdXR0b25gIG1vZHVsZXMsIGl0CgkJCSAqIGlzIGluamVjdGVkIGludG8gdGhlIHJlbmRlcmVyIHdpdGggdGhpcyBtZXRob2QuIFRoaXMgbWV0aG9kIHRyaWdnZXJzIHRoZSBzdGFydCBvZgoJCQkgKiB0aGUgYWN0dWFsIFhSIHJlbmRlcmluZy4KCQkJICoKCQkJICogQGFzeW5jCgkJCSAqIEBwYXJhbSB7WFJTZXNzaW9ufSB2YWx1ZSAtIFRoZSBYUiBzZXNzaW9uIHRvIHNldC4KCQkJICogQHJldHVybiB7UHJvbWlzZX0gQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgc2Vzc2lvbiBoYXMgYmVlbiBzZXQuCgkJCSAqLwoJCQl0aGlzLnNldFNlc3Npb24gPSBhc3luYyBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCXNlc3Npb24gPSB2YWx1ZTsKCgkJCQlpZiAoIHNlc3Npb24gIT09IG51bGwgKSB7CgoJCQkJCWluaXRpYWxSZW5kZXJUYXJnZXQgPSByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKTsKCgkJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzZWxlY3RzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0ZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplc3RhcnQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZCApOwoJCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2lucHV0c291cmNlc2NoYW5nZScsIG9uSW5wdXRTb3VyY2VzQ2hhbmdlICk7CgoJCQkJCWlmICggYXR0cmlidXRlcy54ckNvbXBhdGlibGUgIT09IHRydWUgKSB7CgoJCQkJCQlhd2FpdCBnbC5tYWtlWFJDb21wYXRpYmxlKCk7CgoJCQkJCX0KCgkJCQkJY3VycmVudFBpeGVsUmF0aW8gPSByZW5kZXJlci5nZXRQaXhlbFJhdGlvKCk7CgkJCQkJcmVuZGVyZXIuZ2V0U2l6ZSggY3VycmVudFNpemUgKTsKCgkJCQkJLy8gQ2hlY2sgdGhhdCB0aGUgYnJvd3NlciBpbXBsZW1lbnRzIHRoZSBuZWNlc3NhcnkgQVBJcyB0byB1c2UgYW4KCQkJCQkvLyBYUlByb2plY3Rpb25MYXllciByYXRoZXIgdGhhbiBhbiBYUldlYkdMTGF5ZXIKCQkJCQljb25zdCB1c2VMYXllcnMgPSB0eXBlb2YgWFJXZWJHTEJpbmRpbmcgIT09ICd1bmRlZmluZWQnICYmICdjcmVhdGVQcm9qZWN0aW9uTGF5ZXInIGluIFhSV2ViR0xCaW5kaW5nLnByb3RvdHlwZTsKCgkJCQkJaWYgKCAhIHVzZUxheWVycyApIHsKCgkJCQkJCWNvbnN0IGxheWVySW5pdCA9IHsKCQkJCQkJCWFudGlhbGlhczogYXR0cmlidXRlcy5hbnRpYWxpYXMsCgkJCQkJCQlhbHBoYTogdHJ1ZSwKCQkJCQkJCWRlcHRoOiBhdHRyaWJ1dGVzLmRlcHRoLAoJCQkJCQkJc3RlbmNpbDogYXR0cmlidXRlcy5zdGVuY2lsLAoJCQkJCQkJZnJhbWVidWZmZXJTY2FsZUZhY3RvcjogZnJhbWVidWZmZXJTY2FsZUZhY3RvcgoJCQkJCQl9OwoKCQkJCQkJZ2xCYXNlTGF5ZXIgPSBuZXcgWFJXZWJHTExheWVyKCBzZXNzaW9uLCBnbCwgbGF5ZXJJbml0ICk7CgoJCQkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7IGJhc2VMYXllcjogZ2xCYXNlTGF5ZXIgfSApOwoKCQkJCQkJcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggMSApOwoJCQkJCQlyZW5kZXJlci5zZXRTaXplKCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlcldpZHRoLCBnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwgZmFsc2UgKTsKCgkJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKCQkJCQkJCWdsQmFzZUxheWVyLmZyYW1lYnVmZmVyV2lkdGgsCgkJCQkJCQlnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwKCQkJCQkJCXsKCQkJCQkJCQlmb3JtYXQ6IFJHQkFGb3JtYXQsCgkJCQkJCQkJdHlwZTogVW5zaWduZWRCeXRlVHlwZSwKCQkJCQkJCQljb2xvclNwYWNlOiByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlLAoJCQkJCQkJCXN0ZW5jaWxCdWZmZXI6IGF0dHJpYnV0ZXMuc3RlbmNpbCwKCQkJCQkJCQlyZXNvbHZlRGVwdGhCdWZmZXI6ICggZ2xCYXNlTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICksCgkJCQkJCQkJcmVzb2x2ZVN0ZW5jaWxCdWZmZXI6ICggZ2xCYXNlTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICkKCgkJCQkJCQl9CgkJCQkJCSk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlsZXQgZGVwdGhGb3JtYXQgPSBudWxsOwoJCQkJCQlsZXQgZGVwdGhUeXBlID0gbnVsbDsKCQkJCQkJbGV0IGdsRGVwdGhGb3JtYXQgPSBudWxsOwoKCQkJCQkJaWYgKCBhdHRyaWJ1dGVzLmRlcHRoICkgewoKCQkJCQkJCWdsRGVwdGhGb3JtYXQgPSBhdHRyaWJ1dGVzLnN0ZW5jaWwgPyBnbC5ERVBUSDI0X1NURU5DSUw4IDogZ2wuREVQVEhfQ09NUE9ORU5UMjQ7CgkJCQkJCQlkZXB0aEZvcm1hdCA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IERlcHRoU3RlbmNpbEZvcm1hdCA6IERlcHRoRm9ybWF0OwoJCQkJCQkJZGVwdGhUeXBlID0gYXR0cmlidXRlcy5zdGVuY2lsID8gVW5zaWduZWRJbnQyNDhUeXBlIDogVW5zaWduZWRJbnRUeXBlOwoKCQkJCQkJfQoKCQkJCQkJY29uc3QgcHJvamVjdGlvbmxheWVySW5pdCA9IHsKCQkJCQkJCWNvbG9yRm9ybWF0OiBnbC5SR0JBOCwKCQkJCQkJCWRlcHRoRm9ybWF0OiBnbERlcHRoRm9ybWF0LAoJCQkJCQkJc2NhbGVGYWN0b3I6IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IKCQkJCQkJfTsKCgkJCQkJCWdsQmluZGluZyA9IG5ldyBYUldlYkdMQmluZGluZyggc2Vzc2lvbiwgZ2wgKTsKCgkJCQkJCWdsUHJvakxheWVyID0gZ2xCaW5kaW5nLmNyZWF0ZVByb2plY3Rpb25MYXllciggcHJvamVjdGlvbmxheWVySW5pdCApOwoKCQkJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggeyBsYXllcnM6IFsgZ2xQcm9qTGF5ZXIgXSB9ICk7CgoJCQkJCQlyZW5kZXJlci5zZXRQaXhlbFJhdGlvKCAxICk7CgkJCQkJCXJlbmRlcmVyLnNldFNpemUoIGdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwgZ2xQcm9qTGF5ZXIudGV4dHVyZUhlaWdodCwgZmFsc2UgKTsKCgkJCQkJCW5ld1JlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCgKCQkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwKCQkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsCgkJCQkJCQl7CgkJCQkJCQkJZm9ybWF0OiBSR0JBRm9ybWF0LAoJCQkJCQkJCXR5cGU6IFVuc2lnbmVkQnl0ZVR5cGUsCgkJCQkJCQkJZGVwdGhUZXh0dXJlOiBuZXcgRGVwdGhUZXh0dXJlKCBnbFByb2pMYXllci50ZXh0dXJlV2lkdGgsIGdsUHJvakxheWVyLnRleHR1cmVIZWlnaHQsIGRlcHRoVHlwZSwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgZGVwdGhGb3JtYXQgKSwKCQkJCQkJCQlzdGVuY2lsQnVmZmVyOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCgkJCQkJCQkJY29sb3JTcGFjZTogcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSwKCQkJCQkJCQlzYW1wbGVzOiBhdHRyaWJ1dGVzLmFudGlhbGlhcyA/IDQgOiAwLAoJCQkJCQkJCXJlc29sdmVEZXB0aEJ1ZmZlcjogKCBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKSwKCQkJCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogKCBnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA9PT0gZmFsc2UgKQoJCQkJCQkJfSApOwoKCQkJCQl9CgoJCQkJCW5ld1JlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsgLy8gVE9ETyBSZW1vdmUgdGhpcyB3aGVuIHBvc3NpYmxlLCBzZWUgIzIzMjc4CgoJCQkJCXRoaXMuc2V0Rm92ZWF0aW9uKCBmb3ZlYXRpb24gKTsKCgkJCQkJY3VzdG9tUmVmZXJlbmNlU3BhY2UgPSBudWxsOwoJCQkJCXJlZmVyZW5jZVNwYWNlID0gYXdhaXQgc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UoIHJlZmVyZW5jZVNwYWNlVHlwZSApOwoKCQkJCQlhbmltYXRpb24uc2V0Q29udGV4dCggc2Vzc2lvbiApOwoJCQkJCWFuaW1hdGlvbi5zdGFydCgpOwoKCQkJCQlzY29wZS5pc1ByZXNlbnRpbmcgPSB0cnVlOwoKCQkJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdzZXNzaW9uc3RhcnQnIH0gKTsKCgkJCQl9CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGVudmlyb25tZW50IGJsZW5kIG1vZGUgZnJvbSB0aGUgY3VycmVudCBYUiBzZXNzaW9uLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHsnb3BhcXVlJ3wnYWRkaXRpdmUnfCdhbHBoYS1ibGVuZCd8dW5kZWZpbmVkfSBUaGUgZW52aXJvbm1lbnQgYmxlbmQgbW9kZS4gUmV0dXJucyBgdW5kZWZpbmVkYCB3aGVuIHVzZWQgb3V0c2lkZSBvZiBhIFhSIHNlc3Npb24uCgkJCSAqLwoJCQl0aGlzLmdldEVudmlyb25tZW50QmxlbmRNb2RlID0gZnVuY3Rpb24gKCkgewoKCQkJCWlmICggc2Vzc2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJcmV0dXJuIHNlc3Npb24uZW52aXJvbm1lbnRCbGVuZE1vZGU7CgoJCQkJfQoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGRlcHRoIHRleHR1cmUgY29tcHV0ZWQgdmlhIGRlcHRoIHNlbnNpbmcuCgkJCSAqCgkJCSAqIEByZXR1cm4gez9UZXh0dXJlfSBUaGUgZGVwdGggdGV4dHVyZS4KCQkJICovCgkJCXRoaXMuZ2V0RGVwdGhUZXh0dXJlID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBkZXB0aFNlbnNpbmcuZ2V0RGVwdGhUZXh0dXJlKCk7CgoJCQl9OwoKCQkJZnVuY3Rpb24gb25JbnB1dFNvdXJjZXNDaGFuZ2UoIGV2ZW50ICkgewoKCQkJCS8vIE5vdGlmeSBkaXNjb25uZWN0ZWQKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5yZW1vdmVkLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBldmVudC5yZW1vdmVkWyBpIF07CgkJCQkJY29uc3QgaW5kZXggPSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmluZGV4T2YoIGlucHV0U291cmNlICk7CgoJCQkJCWlmICggaW5kZXggPj0gMCApIHsKCgkJCQkJCWNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGluZGV4IF0gPSBudWxsOwoJCQkJCQljb250cm9sbGVyc1sgaW5kZXggXS5kaXNjb25uZWN0KCBpbnB1dFNvdXJjZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIE5vdGlmeSBjb25uZWN0ZWQKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5hZGRlZC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGlucHV0U291cmNlID0gZXZlbnQuYWRkZWRbIGkgXTsKCgkJCQkJbGV0IGNvbnRyb2xsZXJJbmRleCA9IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMuaW5kZXhPZiggaW5wdXRTb3VyY2UgKTsKCgkJCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0xICkgewoKCQkJCQkJLy8gQXNzaWduIGlucHV0IHNvdXJjZSBhIGNvbnRyb2xsZXIgdGhhdCBjdXJyZW50bHkgaGFzIG5vIGlucHV0IHNvdXJjZQoKCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKCQkJCQkJCWlmICggaSA+PSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmxlbmd0aCApIHsKCgkJCQkJCQkJY29udHJvbGxlcklucHV0U291cmNlcy5wdXNoKCBpbnB1dFNvdXJjZSApOwoJCQkJCQkJCWNvbnRyb2xsZXJJbmRleCA9IGk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJfSBlbHNlIGlmICggY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdID09PSBudWxsICkgewoKCQkJCQkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBpbnB1dFNvdXJjZTsKCQkJCQkJCQljb250cm9sbGVySW5kZXggPSBpOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCS8vIElmIGFsbCBjb250cm9sbGVycyBkbyBjdXJyZW50bHkgcmVjZWl2ZSBpbnB1dCB3ZSBpZ25vcmUgbmV3IG9uZXMKCgkJCQkJCWlmICggY29udHJvbGxlckluZGV4ID09PSAtMSApIGJyZWFrOwoKCQkJCQl9CgoJCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgY29udHJvbGxlckluZGV4IF07CgoJCQkJCWlmICggY29udHJvbGxlciApIHsKCgkJCQkJCWNvbnRyb2xsZXIuY29ubmVjdCggaW5wdXRTb3VyY2UgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQljb25zdCBjYW1lcmFMUG9zID0gbmV3IFZlY3RvcjMoKTsKCQkJY29uc3QgY2FtZXJhUlBvcyA9IG5ldyBWZWN0b3IzKCk7CgoJCQkvKioKCQkJICogQXNzdW1lcyAyIGNhbWVyYXMgdGhhdCBhcmUgcGFyYWxsZWwgYW5kIHNoYXJlIGFuIFgtYXhpcywgYW5kIHRoYXQKCQkJICogdGhlIGNhbWVyYXMnIHByb2plY3Rpb24gYW5kIHdvcmxkIG1hdHJpY2VzIGhhdmUgYWxyZWFkeSBiZWVuIHNldC4KCQkJICogQW5kIHRoYXQgbmVhciBhbmQgZmFyIHBsYW5lcyBhcmUgaWRlbnRpY2FsIGZvciBib3RoIGNhbWVyYXMuCgkJCSAqIFZpc3VhbGl6YXRpb24gb2YgdGhpcyB0ZWNobmlxdWU6IGh0dHBzOi8vY29tcHV0ZXJncmFwaGljcy5zdGFja2V4Y2hhbmdlLmNvbS9hLzQ3NjUKCQkJICoKCQkJICogQHBhcmFtIHtBcnJheUNhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYSB0byB1cGRhdGUuCgkJCSAqIEBwYXJhbSB7UGVyc3BlY3RpdmVDYW1lcmF9IGNhbWVyYUwgLSBUaGUgbGVmdCBjYW1lcmEuCgkJCSAqIEBwYXJhbSB7UGVyc3BlY3RpdmVDYW1lcmF9IGNhbWVyYVIgLSBUaGUgcmlnaHQgY2FtZXJhLgoJCQkgKi8KCQkJZnVuY3Rpb24gc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhLCBjYW1lcmFMLCBjYW1lcmFSICkgewoKCQkJCWNhbWVyYUxQb3Muc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmFMLm1hdHJpeFdvcmxkICk7CgkJCQljYW1lcmFSUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhUi5tYXRyaXhXb3JsZCApOwoKCQkJCWNvbnN0IGlwZCA9IGNhbWVyYUxQb3MuZGlzdGFuY2VUbyggY2FtZXJhUlBvcyApOwoKCQkJCWNvbnN0IHByb2pMID0gY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzOwoJCQkJY29uc3QgcHJvalIgPSBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgoJCQkJLy8gVlIgc3lzdGVtcyB3aWxsIGhhdmUgaWRlbnRpY2FsIGZhciBhbmQgbmVhciBwbGFuZXMsIGFuZAoJCQkJLy8gbW9zdCBsaWtlbHkgaWRlbnRpY2FsIHRvcCBhbmQgYm90dG9tIGZydXN0dW0gZXh0ZW50cy4KCQkJCS8vIFVzZSB0aGUgbGVmdCBjYW1lcmEgZm9yIHRoZXNlIHZhbHVlcy4KCQkJCWNvbnN0IG5lYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gLSAxICk7CgkJCQljb25zdCBmYXIgPSBwcm9qTFsgMTQgXSAvICggcHJvakxbIDEwIF0gKyAxICk7CgkJCQljb25zdCB0b3BGb3YgPSAoIHByb2pMWyA5IF0gKyAxICkgLyBwcm9qTFsgNSBdOwoJCQkJY29uc3QgYm90dG9tRm92ID0gKCBwcm9qTFsgOSBdIC0gMSApIC8gcHJvakxbIDUgXTsKCgkJCQljb25zdCBsZWZ0Rm92ID0gKCBwcm9qTFsgOCBdIC0gMSApIC8gcHJvakxbIDAgXTsKCQkJCWNvbnN0IHJpZ2h0Rm92ID0gKCBwcm9qUlsgOCBdICsgMSApIC8gcHJvalJbIDAgXTsKCQkJCWNvbnN0IGxlZnQgPSBuZWFyICogbGVmdEZvdjsKCQkJCWNvbnN0IHJpZ2h0ID0gbmVhciAqIHJpZ2h0Rm92OwoKCQkJCS8vIENhbGN1bGF0ZSB0aGUgbmV3IGNhbWVyYSdzIHBvc2l0aW9uIG9mZnNldCBmcm9tIHRoZQoJCQkJLy8gbGVmdCBjYW1lcmEuIHhPZmZzZXQgc2hvdWxkIGJlIHJvdWdobHkgaGFsZiBgaXBkYC4KCQkJCWNvbnN0IHpPZmZzZXQgPSBpcGQgLyAoIC0gbGVmdEZvdiArIHJpZ2h0Rm92ICk7CgkJCQljb25zdCB4T2Zmc2V0ID0gek9mZnNldCAqIC0gbGVmdEZvdjsKCgkJCQkvLyBUT0RPOiBCZXR0ZXIgd2F5IHRvIGFwcGx5IHRoaXMgb2Zmc2V0PwoJCQkJY2FtZXJhTC5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQkJY2FtZXJhLnRyYW5zbGF0ZVgoIHhPZmZzZXQgKTsKCQkJCWNhbWVyYS50cmFuc2xhdGVaKCB6T2Zmc2V0ICk7CgkJCQljYW1lcmEubWF0cml4V29ybGQuY29tcG9zZSggY2FtZXJhLnBvc2l0aW9uLCBjYW1lcmEucXVhdGVybmlvbiwgY2FtZXJhLnNjYWxlICk7CgkJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQkJCS8vIENoZWNrIGlmIHRoZSBwcm9qZWN0aW9uIHVzZXMgYW4gaW5maW5pdGUgZmFyIHBsYW5lLgoJCQkJaWYgKCBwcm9qTFsgMTAgXSA9PT0gLTEgKSB7CgoJCQkJCS8vIFVzZSB0aGUgcHJvamVjdGlvbiBtYXRyaXggZnJvbSB0aGUgbGVmdCBleWUuCgkJCQkJLy8gVGhlIGNhbWVyYSBvZmZzZXQgaXMgc3VmZmljaWVudCB0byBpbmNsdWRlIHRoZSB2aWV3IHZvbHVtZXMKCQkJCQkvLyBvZiBib3RoIGV5ZXMgKGFzc3VtaW5nIHN5bW1ldHJpYyBwcm9qZWN0aW9ucykuCgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBGaW5kIHRoZSB1bmlvbiBvZiB0aGUgZnJ1c3R1bSB2YWx1ZXMgb2YgdGhlIGNhbWVyYXMgYW5kIHNjYWxlCgkJCQkJLy8gdGhlIHZhbHVlcyBzbyB0aGF0IHRoZSBuZWFyIHBsYW5lJ3MgcG9zaXRpb24gZG9lcyBub3QgY2hhbmdlIGluIHdvcmxkIHNwYWNlLAoJCQkJCS8vIGFsdGhvdWdoIG11c3Qgbm93IGJlIHJlbGF0aXZlIHRvIHRoZSBuZXcgdW5pb24gY2FtZXJhLgoJCQkJCWNvbnN0IG5lYXIyID0gbmVhciArIHpPZmZzZXQ7CgkJCQkJY29uc3QgZmFyMiA9IGZhciArIHpPZmZzZXQ7CgkJCQkJY29uc3QgbGVmdDIgPSBsZWZ0IC0geE9mZnNldDsKCQkJCQljb25zdCByaWdodDIgPSByaWdodCArICggaXBkIC0geE9mZnNldCApOwoJCQkJCWNvbnN0IHRvcDIgPSB0b3BGb3YgKiBmYXIgLyBmYXIyICogbmVhcjI7CgkJCQkJY29uc3QgYm90dG9tMiA9IGJvdHRvbUZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKCgkJCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXgubWFrZVBlcnNwZWN0aXZlKCBsZWZ0MiwgcmlnaHQyLCB0b3AyLCBib3R0b20yLCBuZWFyMiwgZmFyMiApOwoJCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIHVwZGF0ZUNhbWVyYSggY2FtZXJhLCBwYXJlbnQgKSB7CgoJCQkJaWYgKCBwYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJCWNhbWVyYS5tYXRyaXhXb3JsZC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY2FtZXJhLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHBhcmVudC5tYXRyaXhXb3JsZCwgY2FtZXJhLm1hdHJpeCApOwoKCQkJCX0KCgkJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQkJfQoKCQkJLyoqCgkJCSAqIFVwZGF0ZXMgdGhlIHN0YXRlIG9mIHRoZSBYUiBjYW1lcmEuIFVzZSB0aGlzIG1ldGhvZCBvbiBhcHAgbGV2ZWwgaWYgeW91CgkJCSAqIHNldCBjYW1lcmFBdXRvVXBkYXRlYCB0byBgZmFsc2VgLiBUaGUgbWV0aG9kIHJlcXVpcmVzIHRoZSBub24tWFIKCQkJICogY2FtZXJhIG9mIHRoZSBzY2VuZSBhcyBhIHBhcmFtZXRlci4gVGhlIHBhc3NlZCBpbiBjYW1lcmEncyB0cmFuc2Zvcm1hdGlvbgoJCQkgKiBpcyBhdXRvbWF0aWNhbGx5IGFkanVzdGVkIHRvIHRoZSBwb3NpdGlvbiBvZiB0aGUgWFIgY2FtZXJhIHdoZW4gY2FsbGluZwoJCQkgKiB0aGlzIG1ldGhvZC4KCQkJICoKCQkJICogQHBhcmFtIHtDYW1lcmF9IGNhbWVyYSAtIFRoZSBjYW1lcmEuCgkJCSAqLwoJCQl0aGlzLnVwZGF0ZUNhbWVyYSA9IGZ1bmN0aW9uICggY2FtZXJhICkgewoKCQkJCWlmICggc2Vzc2lvbiA9PT0gbnVsbCApIHJldHVybjsKCgkJCQlsZXQgZGVwdGhOZWFyID0gY2FtZXJhLm5lYXI7CgkJCQlsZXQgZGVwdGhGYXIgPSBjYW1lcmEuZmFyOwoKCQkJCWlmICggZGVwdGhTZW5zaW5nLnRleHR1cmUgIT09IG51bGwgKSB7CgoJCQkJCWlmICggZGVwdGhTZW5zaW5nLmRlcHRoTmVhciA+IDAgKSBkZXB0aE5lYXIgPSBkZXB0aFNlbnNpbmcuZGVwdGhOZWFyOwoJCQkJCWlmICggZGVwdGhTZW5zaW5nLmRlcHRoRmFyID4gMCApIGRlcHRoRmFyID0gZGVwdGhTZW5zaW5nLmRlcHRoRmFyOwoKCQkJCX0KCgkJCQljYW1lcmFYUi5uZWFyID0gY2FtZXJhUi5uZWFyID0gY2FtZXJhTC5uZWFyID0gZGVwdGhOZWFyOwoJCQkJY2FtZXJhWFIuZmFyID0gY2FtZXJhUi5mYXIgPSBjYW1lcmFMLmZhciA9IGRlcHRoRmFyOwoKCQkJCWlmICggX2N1cnJlbnREZXB0aE5lYXIgIT09IGNhbWVyYVhSLm5lYXIgfHwgX2N1cnJlbnREZXB0aEZhciAhPT0gY2FtZXJhWFIuZmFyICkgewoKCQkJCQkvLyBOb3RlIHRoYXQgdGhlIG5ldyByZW5kZXJTdGF0ZSB3b24ndCBhcHBseSB1bnRpbCB0aGUgbmV4dCBmcmFtZS4gU2VlICMxODMyMAoKCQkJCQlzZXNzaW9uLnVwZGF0ZVJlbmRlclN0YXRlKCB7CgkJCQkJCWRlcHRoTmVhcjogY2FtZXJhWFIubmVhciwKCQkJCQkJZGVwdGhGYXI6IGNhbWVyYVhSLmZhcgoJCQkJCX0gKTsKCgkJCQkJX2N1cnJlbnREZXB0aE5lYXIgPSBjYW1lcmFYUi5uZWFyOwoJCQkJCV9jdXJyZW50RGVwdGhGYXIgPSBjYW1lcmFYUi5mYXI7CgoJCQkJfQoKCQkJCWNhbWVyYUwubGF5ZXJzLm1hc2sgPSBjYW1lcmEubGF5ZXJzLm1hc2sgfCAwYjAxMDsKCQkJCWNhbWVyYVIubGF5ZXJzLm1hc2sgPSBjYW1lcmEubGF5ZXJzLm1hc2sgfCAwYjEwMDsKCQkJCWNhbWVyYVhSLmxheWVycy5tYXNrID0gY2FtZXJhTC5sYXllcnMubWFzayB8IGNhbWVyYVIubGF5ZXJzLm1hc2s7CgoJCQkJY29uc3QgcGFyZW50ID0gY2FtZXJhLnBhcmVudDsKCQkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmFYUi5jYW1lcmFzOwoKCQkJCXVwZGF0ZUNhbWVyYSggY2FtZXJhWFIsIHBhcmVudCApOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNhbWVyYXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQl1cGRhdGVDYW1lcmEoIGNhbWVyYXNbIGkgXSwgcGFyZW50ICk7CgoJCQkJfQoKCQkJCS8vIHVwZGF0ZSBwcm9qZWN0aW9uIG1hdHJpeCBmb3IgcHJvcGVyIHZpZXcgZnJ1c3R1bSBjdWxsaW5nCgoJCQkJaWYgKCBjYW1lcmFzLmxlbmd0aCA9PT0gMiApIHsKCgkJCQkJc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhWFIsIGNhbWVyYUwsIGNhbWVyYVIgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBhc3N1bWUgc2luZ2xlIGNhbWVyYSBzZXR1cCAoQVIpCgoJCQkJCWNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkJfQoKCQkJCS8vIHVwZGF0ZSB1c2VyIGNhbWVyYSBhbmQgaXRzIGNoaWxkcmVuCgoJCQkJdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICk7CgoJCQl9OwoKCQkJZnVuY3Rpb24gdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICkgewoKCQkJCWlmICggcGFyZW50ID09PSBudWxsICkgewoKCQkJCQljYW1lcmEubWF0cml4LmNvcHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY2FtZXJhLm1hdHJpeC5jb3B5KCBwYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCQljYW1lcmEubWF0cml4LmludmVydCgpOwoJCQkJCWNhbWVyYS5tYXRyaXgubXVsdGlwbHkoIGNhbWVyYVhSLm1hdHJpeFdvcmxkICk7CgoJCQkJfQoKCQkJCWNhbWVyYS5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUgKTsKCQkJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCggdHJ1ZSApOwoKCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXggKTsKCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmFYUi5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSApOwoKCQkJCWlmICggY2FtZXJhLmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgoJCQkJCWNhbWVyYS5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggMSAvIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyA1IF0gKTsKCQkJCQljYW1lcmEuem9vbSA9IDE7CgoJCQkJfQoKCQkJfQoKCQkJLyoqCgkJCSAqIFJldHVybnMgYW4gaW5zdGFuY2Ugb2Yge0BsaW5rIEFycmF5Q2FtZXJhfSB3aGljaCByZXByZXNlbnRzIHRoZSBYUiBjYW1lcmEKCQkJICogb2YgdGhlIGFjdGl2ZSBYUiBzZXNzaW9uLiBGb3IgZWFjaCB2aWV3IGl0IGhvbGRzIGEgc2VwYXJhdGUgY2FtZXJhIG9iamVjdC4KCQkJICoKCQkJICogVGhlIGNhbWVyYSdzIGBmb3ZgIGlzIGN1cnJlbnRseSBub3QgdXNlZCBhbmQgZG9lcyBub3QgcmVmbGVjdCB0aGUgZm92IG9mCgkJCSAqIHRoZSBYUiBjYW1lcmEuIElmIHlvdSBuZWVkIHRoZSBmb3Ygb24gYXBwIGxldmVsLCB5b3UgaGF2ZSB0byBjb21wdXRlIGluCgkJCSAqIG1hbnVhbGx5IGZyb20gdGhlIFhSIGNhbWVyYSdzIHByb2plY3Rpb24gbWF0cmljZXMuCgkJCSAqCgkJCSAqIEByZXR1cm4ge0FycmF5Q2FtZXJhfSBUaGUgWFIgY2FtZXJhLgoJCQkgKi8KCQkJdGhpcy5nZXRDYW1lcmEgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGNhbWVyYVhSOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBhbW91bnQgb2YgZm92ZWF0aW9uIHVzZWQgYnkgdGhlIFhSIGNvbXBvc2l0b3IgZm9yIHRoZSBwcm9qZWN0aW9uIGxheWVyLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBhbW91bnQgb2YgZm92ZWF0aW9uLgoJCQkgKi8KCQkJdGhpcy5nZXRGb3ZlYXRpb24gPSBmdW5jdGlvbiAoKSB7CgoJCQkJaWYgKCBnbFByb2pMYXllciA9PT0gbnVsbCAmJiBnbEJhc2VMYXllciA9PT0gbnVsbCApIHsKCgkJCQkJcmV0dXJuIHVuZGVmaW5lZDsKCgkJCQl9CgoJCQkJcmV0dXJuIGZvdmVhdGlvbjsKCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgZm92ZWF0aW9uIHZhbHVlLgoJCQkgKgoJCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBBIG51bWJlciBpbiB0aGUgcmFuZ2UgYFswLDFdYCB3aGVyZSBgMGAgbWVhbnMgbm8gZm92ZWF0aW9uIChmdWxsIHJlc29sdXRpb24pCgkJCSAqIGFuZCBgMWAgbWVhbnMgbWF4aW11bSBmb3ZlYXRpb24gKHRoZSBlZGdlcyByZW5kZXIgYXQgbG93ZXIgcmVzb2x1dGlvbikuCgkJCSAqLwoJCQl0aGlzLnNldEZvdmVhdGlvbiA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkJLy8gMCA9IG5vIGZvdmVhdGlvbiA9IGZ1bGwgcmVzb2x1dGlvbgoJCQkJLy8gMSA9IG1heGltdW0gZm92ZWF0aW9uID0gdGhlIGVkZ2VzIHJlbmRlciBhdCBsb3dlciByZXNvbHV0aW9uCgoJCQkJZm92ZWF0aW9uID0gdmFsdWU7CgoJCQkJaWYgKCBnbFByb2pMYXllciAhPT0gbnVsbCApIHsKCgkJCQkJZ2xQcm9qTGF5ZXIuZml4ZWRGb3ZlYXRpb24gPSB2YWx1ZTsKCgkJCQl9CgoJCQkJaWYgKCBnbEJhc2VMYXllciAhPT0gbnVsbCAmJiBnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlnbEJhc2VMYXllci5maXhlZEZvdmVhdGlvbiA9IHZhbHVlOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyBgdHJ1ZWAgaWYgZGVwdGggc2Vuc2luZyBpcyBzdXBwb3J0ZWQuCgkJCSAqCgkJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgZGVwdGggc2Vuc2luZyBpcyBzdXBwb3J0ZWQgb3Igbm90LgoJCQkgKi8KCQkJdGhpcy5oYXNEZXB0aFNlbnNpbmcgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy50ZXh0dXJlICE9PSBudWxsOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBkZXB0aCBzZW5zaW5nIG1lc2guCgkJCSAqCgkJCSAqIEByZXR1cm4ge01lc2h9IFRoZSBkZXB0aCBzZW5zaW5nIG1lc2guCgkJCSAqLwoJCQl0aGlzLmdldERlcHRoU2Vuc2luZ01lc2ggPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIGRlcHRoU2Vuc2luZy5nZXRNZXNoKCBjYW1lcmFYUiApOwoKCQkJfTsKCgkJCS8vIEFuaW1hdGlvbiBMb29wCgoJCQlsZXQgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gbnVsbDsKCgkJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKCQkJCXBvc2UgPSBmcmFtZS5nZXRWaWV3ZXJQb3NlKCBjdXN0b21SZWZlcmVuY2VTcGFjZSB8fCByZWZlcmVuY2VTcGFjZSApOwoJCQkJeHJGcmFtZSA9IGZyYW1lOwoKCQkJCWlmICggcG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJY29uc3Qgdmlld3MgPSBwb3NlLnZpZXdzOwoKCQkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0RnJhbWVidWZmZXIoIG5ld1JlbmRlclRhcmdldCwgZ2xCYXNlTGF5ZXIuZnJhbWVidWZmZXIgKTsKCQkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBuZXdSZW5kZXJUYXJnZXQgKTsKCgkJCQkJfQoKCQkJCQlsZXQgY2FtZXJhWFJOZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZWJ1aWxkIGNhbWVyYVhSJ3MgY2FtZXJhIGxpc3QKCgkJCQkJaWYgKCB2aWV3cy5sZW5ndGggIT09IGNhbWVyYVhSLmNhbWVyYXMubGVuZ3RoICkgewoKCQkJCQkJY2FtZXJhWFIuY2FtZXJhcy5sZW5ndGggPSAwOwoJCQkJCQljYW1lcmFYUk5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB2aWV3cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQljb25zdCB2aWV3ID0gdmlld3NbIGkgXTsKCgkJCQkJCWxldCB2aWV3cG9ydCA9IG51bGw7CgoJCQkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKCQkJCQkJCXZpZXdwb3J0ID0gZ2xCYXNlTGF5ZXIuZ2V0Vmlld3BvcnQoIHZpZXcgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJY29uc3QgZ2xTdWJJbWFnZSA9IGdsQmluZGluZy5nZXRWaWV3U3ViSW1hZ2UoIGdsUHJvakxheWVyLCB2aWV3ICk7CgkJCQkJCQl2aWV3cG9ydCA9IGdsU3ViSW1hZ2Uudmlld3BvcnQ7CgoJCQkJCQkJLy8gRm9yIHNpZGUtYnktc2lkZSBwcm9qZWN0aW9uLCB3ZSBvbmx5IHByb2R1Y2UgYSBzaW5nbGUgdGV4dHVyZSBmb3IgYm90aCBleWVzLgoJCQkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXRUZXh0dXJlcygKCQkJCQkJCQkJbmV3UmVuZGVyVGFyZ2V0LAoJCQkJCQkJCQlnbFN1YkltYWdlLmNvbG9yVGV4dHVyZSwKCQkJCQkJCQkJZ2xTdWJJbWFnZS5kZXB0aFN0ZW5jaWxUZXh0dXJlICk7CgoJCQkJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggbmV3UmVuZGVyVGFyZ2V0ICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQkJbGV0IGNhbWVyYSA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJCWlmICggY2FtZXJhID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJY2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJCQkJCQljYW1lcmEubGF5ZXJzLmVuYWJsZSggaSApOwoJCQkJCQkJY2FtZXJhLnZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoKTsKCQkJCQkJCWNhbWVyYXNbIGkgXSA9IGNhbWVyYTsKCgkJCQkJCX0KCgkJCQkJCWNhbWVyYS5tYXRyaXguZnJvbUFycmF5KCB2aWV3LnRyYW5zZm9ybS5tYXRyaXggKTsKCQkJCQkJY2FtZXJhLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5mcm9tQXJyYXkoIHZpZXcucHJvamVjdGlvbk1hdHJpeCApOwoJCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKS5pbnZlcnQoKTsKCQkJCQkJY2FtZXJhLnZpZXdwb3J0LnNldCggdmlld3BvcnQueCwgdmlld3BvcnQueSwgdmlld3BvcnQud2lkdGgsIHZpZXdwb3J0LmhlaWdodCApOwoKCQkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJCWNhbWVyYVhSLm1hdHJpeC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CgkJCQkJCQljYW1lcmFYUi5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmFYUi5wb3NpdGlvbiwgY2FtZXJhWFIucXVhdGVybmlvbiwgY2FtZXJhWFIuc2NhbGUgKTsKCgkJCQkJCX0KCgkJCQkJCWlmICggY2FtZXJhWFJOZWVkc1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJCQljYW1lcmFYUi5jYW1lcmFzLnB1c2goIGNhbWVyYSApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCS8vCgoJCQkJCWNvbnN0IGVuYWJsZWRGZWF0dXJlcyA9IHNlc3Npb24uZW5hYmxlZEZlYXR1cmVzOwoJCQkJCWNvbnN0IGdwdURlcHRoU2Vuc2luZ0VuYWJsZWQgPSBlbmFibGVkRmVhdHVyZXMgJiYKCQkJCQkJZW5hYmxlZEZlYXR1cmVzLmluY2x1ZGVzKCAnZGVwdGgtc2Vuc2luZycgKSAmJgoJCQkJCQlzZXNzaW9uLmRlcHRoVXNhZ2UgPT0gJ2dwdS1vcHRpbWl6ZWQnOwoKCQkJCQlpZiAoIGdwdURlcHRoU2Vuc2luZ0VuYWJsZWQgJiYgZ2xCaW5kaW5nICkgewoKCQkJCQkJY29uc3QgZGVwdGhEYXRhID0gZ2xCaW5kaW5nLmdldERlcHRoSW5mb3JtYXRpb24oIHZpZXdzWyAwIF0gKTsKCgkJCQkJCWlmICggZGVwdGhEYXRhICYmIGRlcHRoRGF0YS5pc1ZhbGlkICYmIGRlcHRoRGF0YS50ZXh0dXJlICkgewoKCQkJCQkJCWRlcHRoU2Vuc2luZy5pbml0KCByZW5kZXJlciwgZGVwdGhEYXRhLCBzZXNzaW9uLnJlbmRlclN0YXRlICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8KCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGlucHV0U291cmNlID0gY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdOwoJCQkJCWNvbnN0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaSBdOwoKCQkJCQlpZiAoIGlucHV0U291cmNlICE9PSBudWxsICYmIGNvbnRyb2xsZXIgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNvbnRyb2xsZXIudXBkYXRlKCBpbnB1dFNvdXJjZSwgZnJhbWUsIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgKSBvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2soIHRpbWUsIGZyYW1lICk7CgoJCQkJaWYgKCBmcmFtZS5kZXRlY3RlZFBsYW5lcyApIHsKCgkJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAncGxhbmVzZGV0ZWN0ZWQnLCBkYXRhOiBmcmFtZSB9ICk7CgoJCQkJfQoKCQkJCXhyRnJhbWUgPSBudWxsOwoKCQkJfQoKCQkJY29uc3QgYW5pbWF0aW9uID0gbmV3IFdlYkdMQW5pbWF0aW9uKCk7CgoJCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKCQkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJCX07CgoJCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7fTsKCgkJfQoKCX0KCgljb25zdCBfZTEgPSAvKkBfX1BVUkVfXyovIG5ldyBFdWxlcigpOwoJY29uc3QgX20xID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKCWZ1bmN0aW9uIFdlYkdMTWF0ZXJpYWxzKCByZW5kZXJlciwgcHJvcGVydGllcyApIHsKCgkJZnVuY3Rpb24gcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hcCwgdW5pZm9ybSApIHsKCgkJCWlmICggbWFwLm1hdHJpeEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJbWFwLnVwZGF0ZU1hdHJpeCgpOwoKCQkJfQoKCQkJdW5pZm9ybS52YWx1ZS5jb3B5KCBtYXAubWF0cml4ICk7CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaEZvZ1VuaWZvcm1zKCB1bmlmb3JtcywgZm9nICkgewoKCQkJZm9nLmNvbG9yLmdldFJHQiggdW5pZm9ybXMuZm9nQ29sb3IudmFsdWUsIGdldFVubGl0VW5pZm9ybUNvbG9yU3BhY2UoIHJlbmRlcmVyICkgKTsKCgkJCWlmICggZm9nLmlzRm9nICkgewoKCQkJCXVuaWZvcm1zLmZvZ05lYXIudmFsdWUgPSBmb2cubmVhcjsKCQkJCXVuaWZvcm1zLmZvZ0Zhci52YWx1ZSA9IGZvZy5mYXI7CgoJCQl9IGVsc2UgaWYgKCBmb2cuaXNGb2dFeHAyICkgewoKCQkJCXVuaWZvcm1zLmZvZ0RlbnNpdHkudmFsdWUgPSBmb2cuZGVuc2l0eTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCgkJCWlmICggbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTGFtYmVydE1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJCXJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQkJcmVmcmVzaFVuaWZvcm1zUGhvbmcoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQkJcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJCWlmICggbWF0ZXJpYWwuaXNNZXNoUGh5c2ljYWxNYXRlcmlhbCApIHsKCgkJCQkJcmVmcmVzaFVuaWZvcm1zUGh5c2ljYWwoIHVuaWZvcm1zLCBtYXRlcmlhbCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTWF0Y2FwTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJCXJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEZXB0aE1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hEaXN0YW5jZU1hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgkJCQlyZWZyZXNoVW5pZm9ybXNEaXN0YW5jZSggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc01lc2hOb3JtYWxNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNMaW5lQmFzaWNNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNMaW5lKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQlpZiAoIG1hdGVyaWFsLmlzTGluZURhc2hlZE1hdGVyaWFsICkgewoKCQkJCQlyZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1BvaW50c01hdGVyaWFsICkgewoKCQkJCXJlZnJlc2hVbmlmb3Jtc1BvaW50cyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQgKTsKCgkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU3ByaXRlTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1NoYWRvd01hdGVyaWFsICkgewoKCQkJCXVuaWZvcm1zLmNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CgkJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCgkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7IC8vICMxNTU4MQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgoJCQlpZiAoIG1hdGVyaWFsLmNvbG9yICkgewoKCQkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZW1pc3NpdmUgKSB7CgoJCQkJdW5pZm9ybXMuZW1pc3NpdmUudmFsdWUuY29weSggbWF0ZXJpYWwuZW1pc3NpdmUgKS5tdWx0aXBseVNjYWxhciggbWF0ZXJpYWwuZW1pc3NpdmVJbnRlbnNpdHkgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmJ1bXBNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmJ1bXBNYXAsIHVuaWZvcm1zLmJ1bXBNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgPSBtYXRlcmlhbC5idW1wU2NhbGU7CgoJCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCgkJCQkJdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlICo9IC0xOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubm9ybWFsTWFwICkgewoKCQkJCXVuaWZvcm1zLm5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLm5vcm1hbE1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubm9ybWFsTWFwLCB1bmlmb3Jtcy5ub3JtYWxNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5ub3JtYWxTY2FsZSApOwoKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgoJCQkJCXVuaWZvcm1zLm5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwLCB1bmlmb3Jtcy5kaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5kaXNwbGFjZW1lbnRTY2FsZS52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmVtaXNzaXZlTWFwICkgewoKCQkJCXVuaWZvcm1zLmVtaXNzaXZlTWFwLnZhbHVlID0gbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmVtaXNzaXZlTWFwLCB1bmlmb3Jtcy5lbWlzc2l2ZU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhck1hcCApIHsKCgkJCQl1bmlmb3Jtcy5zcGVjdWxhck1hcC52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFyTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhck1hcCwgdW5pZm9ybXMuc3BlY3VsYXJNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApIHsKCgkJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgoJCQl9CgoJCQljb25zdCBtYXRlcmlhbFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKTsKCgkJCWNvbnN0IGVudk1hcCA9IG1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXA7CgkJCWNvbnN0IGVudk1hcFJvdGF0aW9uID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudk1hcFJvdGF0aW9uOwoKCQkJaWYgKCBlbnZNYXAgKSB7CgoJCQkJdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKCQkJCV9lMS5jb3B5KCBlbnZNYXBSb3RhdGlvbiApOwoKCQkJCS8vIGFjY29tbW9kYXRlIGxlZnQtaGFuZGVkIGZyYW1lCgkJCQlfZTEueCAqPSAtMTsgX2UxLnkgKj0gLTE7IF9lMS56ICo9IC0xOwoKCQkJCWlmICggZW52TWFwLmlzQ3ViZVRleHR1cmUgJiYgZW52TWFwLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSA9PT0gZmFsc2UgKSB7CgoJCQkJCS8vIGVudmlyb25tZW50IG1hcHMgd2hpY2ggYXJlIG5vdCBjdWJlIHJlbmRlciB0YXJnZXRzIG9yIFBNUkVNcyBmb2xsb3cgYSBkaWZmZXJlbnQgY29udmVudGlvbgoJCQkJCV9lMS55ICo9IC0xOwoJCQkJCV9lMS56ICo9IC0xOwoKCQkJCX0KCgkJCQl1bmlmb3Jtcy5lbnZNYXBSb3RhdGlvbi52YWx1ZS5zZXRGcm9tTWF0cml4NCggX20xLm1ha2VSb3RhdGlvbkZyb21FdWxlciggX2UxICkgKTsKCgkJCQl1bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBlbnZNYXAuaXNDdWJlVGV4dHVyZSAmJiBlbnZNYXAuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLTEgOiAxOwoKCQkJCXVuaWZvcm1zLnJlZmxlY3Rpdml0eS52YWx1ZSA9IG1hdGVyaWFsLnJlZmxlY3Rpdml0eTsKCQkJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsKCQkJCXVuaWZvcm1zLnJlZnJhY3Rpb25SYXRpby52YWx1ZSA9IG1hdGVyaWFsLnJlZnJhY3Rpb25SYXRpbzsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwubGlnaHRNYXAgKSB7CgoJCQkJdW5pZm9ybXMubGlnaHRNYXAudmFsdWUgPSBtYXRlcmlhbC5saWdodE1hcDsKCQkJCXVuaWZvcm1zLmxpZ2h0TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHk7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmxpZ2h0TWFwLCB1bmlmb3Jtcy5saWdodE1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5hb01hcCApIHsKCgkJCQl1bmlmb3Jtcy5hb01hcC52YWx1ZSA9IG1hdGVyaWFsLmFvTWFwOwoJCQkJdW5pZm9ybXMuYW9NYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5hb01hcEludGVuc2l0eTsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW9NYXAsIHVuaWZvcm1zLmFvTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTGluZSggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoJCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCgkJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJCXVuaWZvcm1zLm1hcC52YWx1ZSA9IG1hdGVyaWFsLm1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQl1bmlmb3Jtcy5kYXNoU2l6ZS52YWx1ZSA9IG1hdGVyaWFsLmRhc2hTaXplOwoJCQl1bmlmb3Jtcy50b3RhbFNpemUudmFsdWUgPSBtYXRlcmlhbC5kYXNoU2l6ZSArIG1hdGVyaWFsLmdhcFNpemU7CgkJCXVuaWZvcm1zLnNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuc2NhbGU7CgoJCX0KCgkJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUG9pbnRzKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHBpeGVsUmF0aW8sIGhlaWdodCApIHsKCgkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgkJCXVuaWZvcm1zLnNpemUudmFsdWUgPSBtYXRlcmlhbC5zaXplICogcGl4ZWxSYXRpbzsKCQkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBoZWlnaHQgKiAwLjU7CgoJCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMudXZUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYWxwaGFNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuYWxwaGFUZXN0LnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFUZXN0OwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Nwcml0ZXMoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgkJCXVuaWZvcm1zLnJvdGF0aW9uLnZhbHVlID0gbWF0ZXJpYWwucm90YXRpb247CgoJCQlpZiAoIG1hdGVyaWFsLm1hcCApIHsKCgkJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMubWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJCXVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFscGhhTWFwLCB1bmlmb3Jtcy5hbHBoYU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgewoKCQkJCXVuaWZvcm1zLmFscGhhVGVzdC52YWx1ZSA9IG1hdGVyaWFsLmFscGhhVGVzdDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNQaG9uZyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuc3BlY3VsYXIudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXIgKTsKCQkJdW5pZm9ybXMuc2hpbmluZXNzLnZhbHVlID0gTWF0aC5tYXgoIG1hdGVyaWFsLnNoaW5pbmVzcywgMWUtNCApOyAvLyB0byBwcmV2ZW50IHBvdyggMC4wLCAwLjAgKQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJCWlmICggbWF0ZXJpYWwuZ3JhZGllbnRNYXAgKSB7CgoJCQkJdW5pZm9ybXMuZ3JhZGllbnRNYXAudmFsdWUgPSBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMubWV0YWxuZXNzLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzOwoKCQkJaWYgKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAgKSB7CgoJCQkJdW5pZm9ybXMubWV0YWxuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAsIHVuaWZvcm1zLm1ldGFsbmVzc01hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJdW5pZm9ybXMucm91Z2huZXNzLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzOwoKCQkJaWYgKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAgKSB7CgoJCQkJdW5pZm9ybXMucm91Z2huZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnJvdWdobmVzc01hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5lbnZNYXAgKSB7CgoJCQkJLy91bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXA7IC8vIHBhcnQgb2YgdW5pZm9ybXMgY29tbW9uCgoJCQkJdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuZW52TWFwSW50ZW5zaXR5OwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BoeXNpY2FsKCB1bmlmb3JtcywgbWF0ZXJpYWwsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCgkJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsgLy8gYWxzbyBwYXJ0IG9mIHVuaWZvcm1zIGNvbW1vbgoKCQkJaWYgKCBtYXRlcmlhbC5zaGVlbiA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuc2hlZW5Db2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5zaGVlbkNvbG9yICkubXVsdGlwbHlTY2FsYXIoIG1hdGVyaWFsLnNoZWVuICk7CgoJCQkJdW5pZm9ybXMuc2hlZW5Sb3VnaG5lc3MudmFsdWUgPSBtYXRlcmlhbC5zaGVlblJvdWdobmVzczsKCgkJCQlpZiAoIG1hdGVyaWFsLnNoZWVuQ29sb3JNYXAgKSB7CgoJCQkJCXVuaWZvcm1zLnNoZWVuQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Db2xvck1hcCwgdW5pZm9ybXMuc2hlZW5Db2xvck1hcFRyYW5zZm9ybSApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwICkgewoKCQkJCQl1bmlmb3Jtcy5zaGVlblJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXAsIHVuaWZvcm1zLnNoZWVuUm91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXQgPiAwICkgewoKCQkJCXVuaWZvcm1zLmNsZWFyY29hdC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdDsKCQkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzczsKCgkJCQlpZiAoIG1hdGVyaWFsLmNsZWFyY29hdE1hcCApIHsKCgkJCQkJdW5pZm9ybXMuY2xlYXJjb2F0TWFwLnZhbHVlID0gbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXRNYXBUcmFuc2Zvcm0gKTsKCgkJCQl9CgoJCQkJaWYgKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgKSB7CgoJCQkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcCwgdW5pZm9ybXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwICkgewoKCQkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxNYXAudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXA7CgoJCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXAsIHVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybSApOwoKCQkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKCQkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICkgewoKCQkJCQkJdW5pZm9ybXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUudmFsdWUubmVnYXRlKCk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLmRpc3BlcnNpb24gPiAwICkgewoKCQkJCXVuaWZvcm1zLmRpc3BlcnNpb24udmFsdWUgPSBtYXRlcmlhbC5kaXNwZXJzaW9uOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2UudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZTsKCQkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlSU9SLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1I7CgkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01pbmltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAwIF07CgkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01heGltdW0udmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlWyAxIF07CgoJCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcCApIHsKCgkJCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VNYXAudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcDsKCgkJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwLCB1bmlmb3Jtcy5pcmlkZXNjZW5jZU1hcFRyYW5zZm9ybSApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwICkgewoKCQkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAsIHVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwICkgewoKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbi52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbjsKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJNYXAudmFsdWUgPSB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQudGV4dHVyZTsKCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJTaXplLnZhbHVlLnNldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LndpZHRoLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb25NYXAgKSB7CgoJCQkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvbk1hcC52YWx1ZSA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcDsKCgkJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCwgdW5pZm9ybXMudHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtICk7CgoJCQkJfQoKCQkJCXVuaWZvcm1zLnRoaWNrbmVzcy52YWx1ZSA9IG1hdGVyaWFsLnRoaWNrbmVzczsKCgkJCQlpZiAoIG1hdGVyaWFsLnRoaWNrbmVzc01hcCApIHsKCgkJCQkJdW5pZm9ybXMudGhpY2tuZXNzTWFwLnZhbHVlID0gbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwudGhpY2tuZXNzTWFwLCB1bmlmb3Jtcy50aGlja25lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJCQl9CgoJCQkJdW5pZm9ybXMuYXR0ZW51YXRpb25EaXN0YW5jZS52YWx1ZSA9IG1hdGVyaWFsLmF0dGVudWF0aW9uRGlzdGFuY2U7CgkJCQl1bmlmb3Jtcy5hdHRlbnVhdGlvbkNvbG9yLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmF0dGVudWF0aW9uQ29sb3IgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuYW5pc290cm9weSA+IDAgKSB7CgoJCQkJdW5pZm9ybXMuYW5pc290cm9weVZlY3Rvci52YWx1ZS5zZXQoIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLmNvcyggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICksIG1hdGVyaWFsLmFuaXNvdHJvcHkgKiBNYXRoLnNpbiggbWF0ZXJpYWwuYW5pc290cm9weVJvdGF0aW9uICkgKTsKCgkJCQlpZiAoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAgKSB7CgoJCQkJCXVuaWZvcm1zLmFuaXNvdHJvcHlNYXAudmFsdWUgPSBtYXRlcmlhbC5hbmlzb3Ryb3B5TWFwOwoKCQkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYW5pc290cm9weU1hcCwgdW5pZm9ybXMuYW5pc290cm9weU1hcFRyYW5zZm9ybSApOwoKCQkJCX0KCgkJCX0KCgkJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHk7CgkJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApOwoKCQkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwICkgewoKCQkJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3JNYXAudmFsdWUgPSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLCB1bmlmb3Jtcy5zcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwICkgewoKCQkJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5TWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwLCB1bmlmb3Jtcy5zcGVjdWxhckludGVuc2l0eU1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc01hdGNhcCggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQkJaWYgKCBtYXRlcmlhbC5tYXRjYXAgKSB7CgoJCQkJdW5pZm9ybXMubWF0Y2FwLnZhbHVlID0gbWF0ZXJpYWwubWF0Y2FwOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCQljb25zdCBsaWdodCA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmxpZ2h0OwoKCQkJdW5pZm9ybXMucmVmZXJlbmNlUG9zaXRpb24udmFsdWUuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQl1bmlmb3Jtcy5uZWFyRGlzdGFuY2UudmFsdWUgPSBsaWdodC5zaGFkb3cuY2FtZXJhLm5lYXI7CgkJCXVuaWZvcm1zLmZhckRpc3RhbmNlLnZhbHVlID0gbGlnaHQuc2hhZG93LmNhbWVyYS5mYXI7CgoJCX0KCgkJcmV0dXJuIHsKCQkJcmVmcmVzaEZvZ1VuaWZvcm1zOiByZWZyZXNoRm9nVW5pZm9ybXMsCgkJCXJlZnJlc2hNYXRlcmlhbFVuaWZvcm1zOiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcwoJCX07CgoJfQoKCWZ1bmN0aW9uIFdlYkdMVW5pZm9ybXNHcm91cHMoIGdsLCBpbmZvLCBjYXBhYmlsaXRpZXMsIHN0YXRlICkgewoKCQlsZXQgYnVmZmVycyA9IHt9OwoJCWxldCB1cGRhdGVMaXN0ID0ge307CgkJbGV0IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMgPSBbXTsKCgkJY29uc3QgbWF4QmluZGluZ1BvaW50cyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1VOSUZPUk1fQlVGRkVSX0JJTkRJTkdTICk7IC8vIGJpbmRpbmcgcG9pbnRzIGFyZSBnbG9iYWwgd2hlcmVhcyBibG9jayBpbmRpY2VzIGFyZSBwZXIgc2hhZGVyIHByb2dyYW0KCgkJZnVuY3Rpb24gYmluZCggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJCWNvbnN0IHdlYmdsUHJvZ3JhbSA9IHByb2dyYW0ucHJvZ3JhbTsKCQkJc3RhdGUudW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgd2ViZ2xQcm9ncmFtICk7CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKCQkJbGV0IGJ1ZmZlciA9IGJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXTsKCgkJCWlmICggYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKTsKCgkJCQlidWZmZXIgPSBjcmVhdGVCdWZmZXIoIHVuaWZvcm1zR3JvdXAgKTsKCQkJCWJ1ZmZlcnNbIHVuaWZvcm1zR3JvdXAuaWQgXSA9IGJ1ZmZlcjsKCgkJCQl1bmlmb3Jtc0dyb3VwLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25Vbmlmb3Jtc0dyb3Vwc0Rpc3Bvc2UgKTsKCgkJCX0KCgkJCS8vIGVuc3VyZSB0byB1cGRhdGUgdGhlIGJpbmRpbmcgcG9pbnRzL2Jsb2NrIGluZGljZXMgbWFwcGluZyBmb3IgdGhpcyBwcm9ncmFtCgoJCQljb25zdCB3ZWJnbFByb2dyYW0gPSBwcm9ncmFtLnByb2dyYW07CgkJCXN0YXRlLnVwZGF0ZVVCT01hcHBpbmcoIHVuaWZvcm1zR3JvdXAsIHdlYmdsUHJvZ3JhbSApOwoKCQkJLy8gdXBkYXRlIFVCTyBvbmNlIHBlciBmcmFtZQoKCQkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJCWlmICggdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdICE9PSBmcmFtZSApIHsKCgkJCQl1cGRhdGVCdWZmZXJEYXRhKCB1bmlmb3Jtc0dyb3VwICk7CgoJCQkJdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdID0gZnJhbWU7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY3JlYXRlQnVmZmVyKCB1bmlmb3Jtc0dyb3VwICkgewoKCQkJLy8gdGhlIHNldHVwIG9mIGFuIFVCTyBpcyBpbmRlcGVuZGVudCBvZiBhIHBhcnRpY3VsYXIgc2hhZGVyIHByb2dyYW0gYnV0IGdsb2JhbAoKCQkJY29uc3QgYmluZGluZ1BvaW50SW5kZXggPSBhbGxvY2F0ZUJpbmRpbmdQb2ludEluZGV4KCk7CgkJCXVuaWZvcm1zR3JvdXAuX19iaW5kaW5nUG9pbnRJbmRleCA9IGJpbmRpbmdQb2ludEluZGV4OwoKCQkJY29uc3QgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCWNvbnN0IHNpemUgPSB1bmlmb3Jtc0dyb3VwLl9fc2l6ZTsKCQkJY29uc3QgdXNhZ2UgPSB1bmlmb3Jtc0dyb3VwLnVzYWdlOwoKCQkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIGJ1ZmZlciApOwoJCQlnbC5idWZmZXJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgc2l6ZSwgdXNhZ2UgKTsKCQkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCQkJZ2wuYmluZEJ1ZmZlckJhc2UoIGdsLlVOSUZPUk1fQlVGRkVSLCBiaW5kaW5nUG9pbnRJbmRleCwgYnVmZmVyICk7CgoJCQlyZXR1cm4gYnVmZmVyOwoKCQl9CgoJCWZ1bmN0aW9uIGFsbG9jYXRlQmluZGluZ1BvaW50SW5kZXgoKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXhCaW5kaW5nUG9pbnRzOyBpICsrICkgewoKCQkJCWlmICggYWxsb2NhdGVkQmluZGluZ1BvaW50cy5pbmRleE9mKCBpICkgPT09IC0xICkgewoKCQkJCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLnB1c2goIGkgKTsKCQkJCQlyZXR1cm4gaTsKCgkJCQl9CgoJCQl9CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogTWF4aW11bSBudW1iZXIgb2Ygc2ltdWx0YW5lb3VzbHkgdXNhYmxlIHVuaWZvcm1zIGdyb3VwcyByZWFjaGVkLicgKTsKCgkJCXJldHVybiAwOwoKCQl9CgoJCWZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlckRhdGEoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCQljb25zdCBidWZmZXIgPSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgkJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCQkJY29uc3QgY2FjaGUgPSB1bmlmb3Jtc0dyb3VwLl9fY2FjaGU7CgoJCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgYnVmZmVyICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdW5pZm9ybXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgdW5pZm9ybUFycmF5ID0gQXJyYXkuaXNBcnJheSggdW5pZm9ybXNbIGkgXSApID8gdW5pZm9ybXNbIGkgXSA6IFsgdW5pZm9ybXNbIGkgXSBdOwoKCQkJCWZvciAoIGxldCBqID0gMCwgamwgPSB1bmlmb3JtQXJyYXkubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJCWNvbnN0IHVuaWZvcm0gPSB1bmlmb3JtQXJyYXlbIGogXTsKCgkJCQkJaWYgKCBoYXNVbmlmb3JtQ2hhbmdlZCggdW5pZm9ybSwgaSwgaiwgY2FjaGUgKSA9PT0gdHJ1ZSApIHsKCgkJCQkJCWNvbnN0IG9mZnNldCA9IHVuaWZvcm0uX19vZmZzZXQ7CgoJCQkJCQljb25zdCB2YWx1ZXMgPSBBcnJheS5pc0FycmF5KCB1bmlmb3JtLnZhbHVlICkgPyB1bmlmb3JtLnZhbHVlIDogWyB1bmlmb3JtLnZhbHVlIF07CgoJCQkJCQlsZXQgYXJyYXlPZmZzZXQgPSAwOwoKCQkJCQkJZm9yICggbGV0IGsgPSAwOyBrIDwgdmFsdWVzLmxlbmd0aDsgayArKyApIHsKCgkJCQkJCQljb25zdCB2YWx1ZSA9IHZhbHVlc1sgayBdOwoKCQkJCQkJCWNvbnN0IGluZm8gPSBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKTsKCgkJCQkJCQkvLyBUT0RPIGFkZCBpbnRlZ2VyIGFuZCBzdHJ1Y3Qgc3VwcG9ydAoJCQkJCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMCBdID0gdmFsdWU7CgkJCQkJCQkJZ2wuYnVmZmVyU3ViRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIG9mZnNldCArIGFycmF5T2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKCQkJCQkJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4MyApIHsKCgkJCQkJCQkJLy8gbWFudWFsbHkgY29udmVydGluZyAzeDMgdG8gM3g0CgoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZS5lbGVtZW50c1sgMCBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxIF0gPSB2YWx1ZS5lbGVtZW50c1sgMSBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAyIF0gPSB2YWx1ZS5lbGVtZW50c1sgMiBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAzIF0gPSAwOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA0IF0gPSB2YWx1ZS5lbGVtZW50c1sgMyBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA1IF0gPSB2YWx1ZS5lbGVtZW50c1sgNCBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA2IF0gPSB2YWx1ZS5lbGVtZW50c1sgNSBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA3IF0gPSAwOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA4IF0gPSB2YWx1ZS5lbGVtZW50c1sgNiBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyA5IF0gPSB2YWx1ZS5lbGVtZW50c1sgNyBdOwoJCQkJCQkJCXVuaWZvcm0uX19kYXRhWyAxMCBdID0gdmFsdWUuZWxlbWVudHNbIDggXTsKCQkJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMTEgXSA9IDA7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJdmFsdWUudG9BcnJheSggdW5pZm9ybS5fX2RhdGEsIGFycmF5T2Zmc2V0ICk7CgoJCQkJCQkJCWFycmF5T2Zmc2V0ICs9IGluZm8uc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCQlnbC5idWZmZXJTdWJEYXRhKCBnbC5VTklGT1JNX0JVRkZFUiwgb2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYXNVbmlmb3JtQ2hhbmdlZCggdW5pZm9ybSwgaW5kZXgsIGluZGV4QXJyYXksIGNhY2hlICkgewoKCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoJCQljb25zdCBpbmRleFN0cmluZyA9IGluZGV4ICsgJ18nICsgaW5kZXhBcnJheTsKCgkJCWlmICggY2FjaGVbIGluZGV4U3RyaW5nIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBjYWNoZSBlbnRyeSBkb2VzIG5vdCBleGlzdCBzbyBmYXIKCgkJCQlpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgKSB7CgoJCQkJCWNhY2hlWyBpbmRleFN0cmluZyBdID0gdmFsdWU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY2FjaGVbIGluZGV4U3RyaW5nIF0gPSB2YWx1ZS5jbG9uZSgpOwoKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgY2FjaGVkT2JqZWN0ID0gY2FjaGVbIGluZGV4U3RyaW5nIF07CgoJCQkJLy8gY29tcGFyZSBjdXJyZW50IHZhbHVlIHdpdGggY2FjaGVkIGVudHJ5CgoJCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJCQlpZiAoIGNhY2hlZE9iamVjdCAhPT0gdmFsdWUgKSB7CgoJCQkJCQljYWNoZVsgaW5kZXhTdHJpbmcgXSA9IHZhbHVlOwoJCQkJCQlyZXR1cm4gdHJ1ZTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggY2FjaGVkT2JqZWN0LmVxdWFscyggdmFsdWUgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCQljYWNoZWRPYmplY3QuY29weSggdmFsdWUgKTsKCQkJCQkJcmV0dXJuIHRydWU7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJZnVuY3Rpb24gcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCQkvLyBkZXRlcm1pbmUgdG90YWwgYnVmZmVyIHNpemUgYWNjb3JkaW5nIHRvIHRoZSBTVEQxNDAgbGF5b3V0CgkJCS8vIEhpbnQ6IFNURDE0MCBpcyB0aGUgb25seSBzdXBwb3J0ZWQgbGF5b3V0IGluIFdlYkdMIDIKCgkJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCgkJCWxldCBvZmZzZXQgPSAwOyAvLyBnbG9iYWwgYnVmZmVyIG9mZnNldCBpbiBieXRlcwoJCQljb25zdCBjaHVua1NpemUgPSAxNjsgLy8gc2l6ZSBvZiBhIGNodW5rIGluIGJ5dGVzCgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1bmlmb3Jtcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IHVuaWZvcm1BcnJheSA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm1zWyBpIF0gKSA/IHVuaWZvcm1zWyBpIF0gOiBbIHVuaWZvcm1zWyBpIF0gXTsKCgkJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gdW5pZm9ybUFycmF5Lmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQljb25zdCB1bmlmb3JtID0gdW5pZm9ybUFycmF5WyBqIF07CgoJCQkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm0udmFsdWUgKSA/IHVuaWZvcm0udmFsdWUgOiBbIHVuaWZvcm0udmFsdWUgXTsKCgkJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IHZhbHVlcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCgkJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBrIF07CgoJCQkJCQljb25zdCBpbmZvID0gZ2V0VW5pZm9ybVNpemUoIHZhbHVlICk7CgoJCQkJCQljb25zdCBjaHVua09mZnNldCA9IG9mZnNldCAlIGNodW5rU2l6ZTsgLy8gb2Zmc2V0IGluIHRoZSBjdXJyZW50IGNodW5rCgkJCQkJCWNvbnN0IGNodW5rUGFkZGluZyA9IGNodW5rT2Zmc2V0ICUgaW5mby5ib3VuZGFyeTsgLy8gcmVxdWlyZWQgcGFkZGluZyB0byBtYXRjaCBib3VuZGFyeQoJCQkJCQljb25zdCBjaHVua1N0YXJ0ID0gY2h1bmtPZmZzZXQgKyBjaHVua1BhZGRpbmc7IC8vIHRoZSBzdGFydCBwb3NpdGlvbiBpbiB0aGUgY3VycmVudCBjaHVuayBmb3IgdGhlIGRhdGEKCgkJCQkJCW9mZnNldCArPSBjaHVua1BhZGRpbmc7CgoJCQkJCQkvLyBDaGVjayBmb3IgY2h1bmsgb3ZlcmZsb3cKCQkJCQkJaWYgKCBjaHVua1N0YXJ0ICE9PSAwICYmICggY2h1bmtTaXplIC0gY2h1bmtTdGFydCApIDwgaW5mby5zdG9yYWdlICkgewoKCQkJCQkJCS8vIEFkZCBwYWRkaW5nIGFuZCBhZGp1c3Qgb2Zmc2V0CgkJCQkJCQlvZmZzZXQgKz0gKCBjaHVua1NpemUgLSBjaHVua1N0YXJ0ICk7CgoJCQkJCQl9CgoJCQkJCQkvLyB0aGUgZm9sbG93aW5nIHR3byBwcm9wZXJ0aWVzIHdpbGwgYmUgdXNlZCBmb3IgcGFydGlhbCBidWZmZXIgdXBkYXRlcwoJCQkJCQl1bmlmb3JtLl9fZGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoIGluZm8uc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCApOwoJCQkJCQl1bmlmb3JtLl9fb2Zmc2V0ID0gb2Zmc2V0OwoKCQkJCQkJLy8gVXBkYXRlIHRoZSBnbG9iYWwgb2Zmc2V0CgkJCQkJCW9mZnNldCArPSBpbmZvLnN0b3JhZ2U7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvLyBlbnN1cmUgY29ycmVjdCBmaW5hbCBwYWRkaW5nCgoJCQljb25zdCBjaHVua09mZnNldCA9IG9mZnNldCAlIGNodW5rU2l6ZTsKCgkJCWlmICggY2h1bmtPZmZzZXQgPiAwICkgb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXQgKTsKCgkJCS8vCgoJCQl1bmlmb3Jtc0dyb3VwLl9fc2l6ZSA9IG9mZnNldDsKCQkJdW5pZm9ybXNHcm91cC5fX2NhY2hlID0ge307CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlmdW5jdGlvbiBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKSB7CgoJCQljb25zdCBpbmZvID0gewoJCQkJYm91bmRhcnk6IDAsIC8vIGJ5dGVzCgkJCQlzdG9yYWdlOiAwIC8vIGJ5dGVzCgkJCX07CgoJCQkvLyBkZXRlcm1pbmUgc2l6ZXMgYWNjb3JkaW5nIHRvIFNURDE0MAoKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICkgewoKCQkJCS8vIGZsb2F0L2ludC9ib29sCgoJCQkJaW5mby5ib3VuZGFyeSA9IDQ7CgkJCQlpbmZvLnN0b3JhZ2UgPSA0OwoKCQkJfSBlbHNlIGlmICggdmFsdWUuaXNWZWN0b3IyICkgewoKCQkJCS8vIHZlYzIKCgkJCQlpbmZvLmJvdW5kYXJ5ID0gODsKCQkJCWluZm8uc3RvcmFnZSA9IDg7CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1ZlY3RvcjMgfHwgdmFsdWUuaXNDb2xvciApIHsKCgkJCQkvLyB2ZWMzCgoJCQkJaW5mby5ib3VuZGFyeSA9IDE2OwoJCQkJaW5mby5zdG9yYWdlID0gMTI7IC8vIGV2aWw6IHZlYzMgbXVzdCBzdGFydCBvbiBhIDE2LWJ5dGUgYm91bmRhcnkgYnV0IGl0IG9ubHkgY29uc3VtZXMgMTIgYnl0ZXMKCgkJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVmVjdG9yNCApIHsKCgkJCQkvLyB2ZWM0CgoJCQkJaW5mby5ib3VuZGFyeSA9IDE2OwoJCQkJaW5mby5zdG9yYWdlID0gMTY7CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDMgKSB7CgoJCQkJLy8gbWF0MyAoaW4gU1REMTQwIGEgM3gzIG1hdHJpeCBpcyByZXByZXNlbnRlZCBhcyAzeDQpCgoJCQkJaW5mby5ib3VuZGFyeSA9IDQ4OwoJCQkJaW5mby5zdG9yYWdlID0gNDg7CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDQgKSB7CgoJCQkJLy8gbWF0NAoKCQkJCWluZm8uYm91bmRhcnkgPSA2NDsKCQkJCWluZm8uc3RvcmFnZSA9IDY0OwoKCQkJfSBlbHNlIGlmICggdmFsdWUuaXNUZXh0dXJlICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgc2FtcGxlcnMgY2FuIG5vdCBiZSBwYXJ0IG9mIGFuIHVuaWZvcm1zIGdyb3VwLicgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5zdXBwb3J0ZWQgdW5pZm9ybSB2YWx1ZSB0eXBlLicsIHZhbHVlICk7CgoJCQl9CgoJCQlyZXR1cm4gaW5mbzsKCgkJfQoKCQlmdW5jdGlvbiBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSggZXZlbnQgKSB7CgoJCQljb25zdCB1bmlmb3Jtc0dyb3VwID0gZXZlbnQudGFyZ2V0OwoKCQkJdW5pZm9ybXNHcm91cC5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVW5pZm9ybXNHcm91cHNEaXNwb3NlICk7CgoJCQljb25zdCBpbmRleCA9IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMuaW5kZXhPZiggdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ICk7CgkJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMuc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF0gKTsKCgkJCWRlbGV0ZSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgkJCWRlbGV0ZSB1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF07CgoJCX0KCgkJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJCWZvciAoIGNvbnN0IGlkIGluIGJ1ZmZlcnMgKSB7CgoJCQkJZ2wuZGVsZXRlQnVmZmVyKCBidWZmZXJzWyBpZCBdICk7CgoJCQl9CgoJCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzID0gW107CgkJCWJ1ZmZlcnMgPSB7fTsKCQkJdXBkYXRlTGlzdCA9IHt9OwoKCQl9CgoJCXJldHVybiB7CgoJCQliaW5kOiBiaW5kLAoJCQl1cGRhdGU6IHVwZGF0ZSwKCgkJCWRpc3Bvc2U6IGRpc3Bvc2UKCgkJfTsKCgl9CgoJLyoqCgkgKiBUaGlzIHJlbmRlcmVyIHVzZXMgV2ViR0wgMiB0byBkaXNwbGF5IHNjZW5lcy4KCSAqCgkgKiBXZWJHTCAxIGlzIG5vdCBzdXBwb3J0ZWQgc2luY2UgYHIxNjNgLgoJICovCgljbGFzcyBXZWJHTFJlbmRlcmVyIHsKCgkJLyoqCgkJICogQ29uc3RydWN0cyBhIG5ldyBXZWJHTCByZW5kZXJlci4KCQkgKgoJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJlcn5PcHRpb25zfSBbcGFyYW1ldGVyc10gLSBUaGUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIuCgkJICovCgkJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgPSB7fSApIHsKCgkJCWNvbnN0IHsKCQkJCWNhbnZhcyA9IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKSwKCQkJCWNvbnRleHQgPSBudWxsLAoJCQkJZGVwdGggPSB0cnVlLAoJCQkJc3RlbmNpbCA9IGZhbHNlLAoJCQkJYWxwaGEgPSBmYWxzZSwKCQkJCWFudGlhbGlhcyA9IGZhbHNlLAoJCQkJcHJlbXVsdGlwbGllZEFscGhhID0gdHJ1ZSwKCQkJCXByZXNlcnZlRHJhd2luZ0J1ZmZlciA9IGZhbHNlLAoJCQkJcG93ZXJQcmVmZXJlbmNlID0gJ2RlZmF1bHQnLAoJCQkJZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCA9IGZhbHNlLAoJCQkJcmV2ZXJzZURlcHRoQnVmZmVyID0gZmFsc2UsCgkJCX0gPSBwYXJhbWV0ZXJzOwoKCQkJLyoqCgkJCSAqIFRoaXMgZmxhZyBjYW4gYmUgdXNlZCBmb3IgdHlwZSB0ZXN0aW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQHJlYWRvbmx5CgkJCSAqIEBkZWZhdWx0IHRydWUKCQkJICovCgkJCXRoaXMuaXNXZWJHTFJlbmRlcmVyID0gdHJ1ZTsKCgkJCWxldCBfYWxwaGE7CgoJCQlpZiAoIGNvbnRleHQgIT09IG51bGwgKSB7CgoJCQkJaWYgKCB0eXBlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICE9PSAndW5kZWZpbmVkJyAmJiBjb250ZXh0IGluc3RhbmNlb2YgV2ViR0xSZW5kZXJpbmdDb250ZXh0ICkgewoKCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBXZWJHTCAxIGlzIG5vdCBzdXBwb3J0ZWQgc2luY2UgcjE2My4nICk7CgoJCQkJfQoKCQkJCV9hbHBoYSA9IGNvbnRleHQuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKS5hbHBoYTsKCgkJCX0gZWxzZSB7CgoJCQkJX2FscGhhID0gYWxwaGE7CgoJCQl9CgoJCQljb25zdCB1aW50Q2xlYXJDb2xvciA9IG5ldyBVaW50MzJBcnJheSggNCApOwoJCQljb25zdCBpbnRDbGVhckNvbG9yID0gbmV3IEludDMyQXJyYXkoIDQgKTsKCgkJCWxldCBjdXJyZW50UmVuZGVyTGlzdCA9IG51bGw7CgkJCWxldCBjdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkJLy8gcmVuZGVyKCkgY2FuIGJlIGNhbGxlZCBmcm9tIHdpdGhpbiBhIGNhbGxiYWNrIHRyaWdnZXJlZCBieSBhbm90aGVyIHJlbmRlci4KCQkJLy8gV2UgdHJhY2sgdGhpcyBzbyB0aGF0IHRoZSBuZXN0ZWQgcmVuZGVyIGNhbGwgZ2V0cyBpdHMgbGlzdCBhbmQgc3RhdGUgaXNvbGF0ZWQgZnJvbSB0aGUgcGFyZW50IHJlbmRlciBjYWxsLgoKCQkJY29uc3QgcmVuZGVyTGlzdFN0YWNrID0gW107CgkJCWNvbnN0IHJlbmRlclN0YXRlU3RhY2sgPSBbXTsKCgkJCS8vIHB1YmxpYyBwcm9wZXJ0aWVzCgoJCQkvKioKCQkJICogQSBjYW52YXMgd2hlcmUgdGhlIHJlbmRlcmVyIGRyYXdzIGl0cyBvdXRwdXQuVGhpcyBpcyBhdXRvbWF0aWNhbGx5IGNyZWF0ZWQgYnkgdGhlIHJlbmRlcmVyCgkJCSAqIGluIHRoZSBjb25zdHJ1Y3RvciAoaWYgbm90IHByb3ZpZGVkIGFscmVhZHkpOyB5b3UganVzdCBuZWVkIHRvIGFkZCBpdCB0byB5b3VyIHBhZ2UgbGlrZSBzbzoKCQkJICogYGBganMKCQkJICogZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCggcmVuZGVyZXIuZG9tRWxlbWVudCApOwoJCQkgKiBgYGAKCQkJICoKCQkJICogQHR5cGUge0RPTUVsZW1lbnR9CgkJCSAqLwoJCQl0aGlzLmRvbUVsZW1lbnQgPSBjYW52YXM7CgoJCQkvKioKCQkJICogQSBvYmplY3Qgd2l0aCBkZWJ1ZyBjb25maWd1cmF0aW9uIHNldHRpbmdzLgoJCQkgKgoJCQkgKiAtIGBjaGVja1NoYWRlckVycm9yc2A6IElmIGl0IGlzIGB0cnVlYCwgZGVmaW5lcyB3aGV0aGVyIG1hdGVyaWFsIHNoYWRlciBwcm9ncmFtcyBhcmUKCQkJICogY2hlY2tlZCBmb3IgZXJyb3JzIGR1cmluZyBjb21waWxhdGlvbiBhbmQgbGlua2FnZSBwcm9jZXNzLiBJdCBtYXkgYmUgdXNlZnVsIHRvIGRpc2FibGUKCQkJICogdGhpcyBjaGVjayBpbiBwcm9kdWN0aW9uIGZvciBwZXJmb3JtYW5jZSBnYWluLiBJdCBpcyBzdHJvbmdseSByZWNvbW1lbmRlZCB0byBrZWVwIHRoZXNlCgkJCSAqIGNoZWNrcyBlbmFibGVkIGR1cmluZyBkZXZlbG9wbWVudC4gSWYgdGhlIHNoYWRlciBkb2VzIG5vdCBjb21waWxlIGFuZCBsaW5rIC0gaXQgd2lsbCBub3QKCQkJICogd29yayBhbmQgYXNzb2NpYXRlZCBtYXRlcmlhbCB3aWxsIG5vdCByZW5kZXIuCgkJCSAqIC0gYG9uU2hhZGVyRXJyb3IoZ2wsIHByb2dyYW0sIGdsVmVydGV4U2hhZGVyLGdsRnJhZ21lbnRTaGFkZXIpYDogQSBjYWxsYmFjayBmdW5jdGlvbiB0aGF0CgkJCSAqIGNhbiBiZSB1c2VkIGZvciBjdXN0b20gZXJyb3IgcmVwb3J0aW5nLiBUaGUgY2FsbGJhY2sgcmVjZWl2ZXMgdGhlIFdlYkdMIGNvbnRleHQsIGFuIGluc3RhbmNlCgkJCSAqIG9mIFdlYkdMUHJvZ3JhbSBhcyB3ZWxsIHR3byBpbnN0YW5jZXMgb2YgV2ViR0xTaGFkZXIgcmVwcmVzZW50aW5nIHRoZSB2ZXJ0ZXggYW5kIGZyYWdtZW50IHNoYWRlci4KCQkJICogQXNzaWduaW5nIGEgY3VzdG9tIGZ1bmN0aW9uIGRpc2FibGVzIHRoZSBkZWZhdWx0IGVycm9yIHJlcG9ydGluZy4KCQkJICoKCQkJICogQHR5cGUge09iamVjdH0KCQkJICovCgkJCXRoaXMuZGVidWcgPSB7CgoJCQkJLyoqCgkJCQkgKiBFbmFibGVzIGVycm9yIGNoZWNraW5nIGFuZCByZXBvcnRpbmcgd2hlbiBzaGFkZXIgcHJvZ3JhbXMgYXJlIGJlaW5nIGNvbXBpbGVkLgoJCQkJICogQHR5cGUge2Jvb2xlYW59CgkJCQkgKi8KCQkJCWNoZWNrU2hhZGVyRXJyb3JzOiB0cnVlLAoJCQkJLyoqCgkJCQkgKiBDYWxsYmFjayBmb3IgY3VzdG9tIGVycm9yIHJlcG9ydGluZy4KCQkJCSAqIEB0eXBlIHs/RnVuY3Rpb259CgkJCQkgKi8KCQkJCW9uU2hhZGVyRXJyb3I6IG51bGwKCQkJfTsKCgkJCS8vIGNsZWFyaW5nCgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGF1dG9tYXRpY2FsbHkgY2xlYXIgaXRzIG91dHB1dCBiZWZvcmUgcmVuZGVyaW5nIGEgZnJhbWUgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5hdXRvQ2xlYXIgPSB0cnVlOwoKCQkJLyoqCgkJCSAqIElmIHtAbGluayBXZWJHTFJlbmRlcmVyI2F1dG9DbGVhcn0gc2V0IHRvIGB0cnVlYCwgd2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIGNsZWFyCgkJCSAqIHRoZSBjb2xvciBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5hdXRvQ2xlYXJDb2xvciA9IHRydWU7CgoJCQkvKioKCQkJICogSWYge0BsaW5rIFdlYkdMUmVuZGVyZXIjYXV0b0NsZWFyfSBzZXQgdG8gYHRydWVgLCB3aGV0aGVyIHRoZSByZW5kZXJlciBzaG91bGQgY2xlYXIKCQkJICogdGhlIGRlcHRoIGJ1ZmZlciBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLmF1dG9DbGVhckRlcHRoID0gdHJ1ZTsKCgkJCS8qKgoJCQkgKiBJZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNhdXRvQ2xlYXJ9IHNldCB0byBgdHJ1ZWAsIHdoZXRoZXIgdGhlIHJlbmRlcmVyIHNob3VsZCBjbGVhcgoJCQkgKiB0aGUgc3RlbmNpbCBidWZmZXIgb3Igbm90LgoJCQkgKgoJCQkgKiBAdHlwZSB7Ym9vbGVhbn0KCQkJICogQGRlZmF1bHQgdHJ1ZQoJCQkgKi8KCQkJdGhpcy5hdXRvQ2xlYXJTdGVuY2lsID0gdHJ1ZTsKCgkJCS8vIHNjZW5lIGdyYXBoCgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgc2hvdWxkIHNvcnQgb2JqZWN0cyBvciBub3QuCgkJCSAqCgkJCSAqIE5vdGU6IFNvcnRpbmcgaXMgdXNlZCB0byBhdHRlbXB0IHRvIHByb3Blcmx5IHJlbmRlciBvYmplY3RzIHRoYXQgaGF2ZSBzb21lCgkJCSAqIGRlZ3JlZSBvZiB0cmFuc3BhcmVuY3kuIEJ5IGRlZmluaXRpb24sIHNvcnRpbmcgb2JqZWN0cyBtYXkgbm90IHdvcmsgaW4gYWxsCgkJCSAqIGNhc2VzLiBEZXBlbmRpbmcgb24gdGhlIG5lZWRzIG9mIGFwcGxpY2F0aW9uLCBpdCBtYXkgYmUgbmVjZXNzYXJ5IHRvIHR1cm4KCQkJICogb2ZmIHNvcnRpbmcgYW5kIHVzZSBvdGhlciBtZXRob2RzIHRvIGRlYWwgd2l0aCB0cmFuc3BhcmVuY3kgcmVuZGVyaW5nIGUuZy4KCQkJICogbWFudWFsbHkgZGV0ZXJtaW5pbmcgZWFjaCBvYmplY3QncyByZW5kZXJpbmcgb3JkZXIuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCB0cnVlCgkJCSAqLwoJCQl0aGlzLnNvcnRPYmplY3RzID0gdHJ1ZTsKCgkJCS8vIHVzZXItZGVmaW5lZCBjbGlwcGluZwoKCQkJLyoqCgkJCSAqIFVzZXItZGVmaW5lZCBjbGlwcGluZyBwbGFuZXMgc3BlY2lmaWVkIGluIHdvcmxkIHNwYWNlLiBUaGVzZSBwbGFuZXMgYXBwbHkgZ2xvYmFsbHkuCgkJCSAqIFBvaW50cyBpbiBzcGFjZSB3aG9zZSBkb3QgcHJvZHVjdCB3aXRoIHRoZSBwbGFuZSBpcyBuZWdhdGl2ZSBhcmUgY3V0IGF3YXkuCgkJCSAqCgkJCSAqIEB0eXBlIHtBcnJheTxQbGFuZT59CgkJCSAqLwoJCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gW107CgoJCQkvKioKCQkJICogV2hldGhlciB0aGUgcmVuZGVyZXIgcmVzcGVjdHMgb2JqZWN0LWxldmVsIGNsaXBwaW5nIHBsYW5lcyBvciBub3QuCgkJCSAqCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKiBAZGVmYXVsdCBmYWxzZQoJCQkgKi8KCQkJdGhpcy5sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwoKCQkJLy8gdG9uZSBtYXBwaW5nCgoJCQkvKioKCQkJICogVGhlIHRvbmUgbWFwcGluZyB0ZWNobmlxdWUgb2YgdGhlIHJlbmRlcmVyLgoJCQkgKgoJCQkgKiBAdHlwZSB7KE5vVG9uZU1hcHBpbmd8TGluZWFyVG9uZU1hcHBpbmd8UmVpbmhhcmRUb25lTWFwcGluZ3xDaW5lb25Ub25lTWFwcGluZ3xBQ0VTRmlsbWljVG9uZU1hcHBpbmd8Q3VzdG9tVG9uZU1hcHBpbmd8QWdYVG9uZU1hcHBpbmd8TmV1dHJhbFRvbmVNYXBwaW5nKX0KCQkJICogQGRlZmF1bHQgTm9Ub25lTWFwcGluZwoJCQkgKi8KCQkJdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQkvKioKCQkJICogRXhwb3N1cmUgbGV2ZWwgb2YgdG9uZSBtYXBwaW5nLgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnRvbmVNYXBwaW5nRXhwb3N1cmUgPSAxLjA7CgoJCQkvLyB0cmFuc21pc3Npb24KCgkJCS8qKgoJCQkgKiBUaGUgbm9ybWFsaXplZCByZXNvbHV0aW9uIHNjYWxlIGZvciB0aGUgdHJhbnNtaXNzaW9uIHJlbmRlciB0YXJnZXQsIG1lYXN1cmVkIGluIHBlcmNlbnRhZ2UKCQkJICogb2Ygdmlld3BvcnQgZGltZW5zaW9ucy4gTG93ZXJpbmcgdGhpcyB2YWx1ZSBjYW4gcmVzdWx0IGluIHNpZ25pZmljYW50IHBlcmZvcm1hbmNlIGltcHJvdmVtZW50cwoJCQkgKiB3aGVuIHVzaW5nIHtAbGluayBNZXNoUGh5c2ljYWxNYXRlcmlhbCN0cmFuc21pc3Npb259LgoJCQkgKgoJCQkgKiBAdHlwZSB7bnVtYmVyfQoJCQkgKiBAZGVmYXVsdCAxCgkJCSAqLwoJCQl0aGlzLnRyYW5zbWlzc2lvblJlc29sdXRpb25TY2FsZSA9IDEuMDsKCgkJCS8vIGludGVybmFsIHByb3BlcnRpZXMKCgkJCWNvbnN0IF90aGlzID0gdGhpczsKCgkJCWxldCBfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKCQkJLy8gaW50ZXJuYWwgc3RhdGUgY2FjaGUKCgkJCXRoaXMuX291dHB1dENvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZTsKCgkJCWxldCBfY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gMDsKCQkJbGV0IF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSAwOwoJCQlsZXQgX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwoJCQlsZXQgX2N1cnJlbnRNYXRlcmlhbElkID0gLTE7CgoJCQlsZXQgX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKCQkJY29uc3QgX2N1cnJlbnRWaWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgkJCWNvbnN0IF9jdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCk7CgkJCWxldCBfY3VycmVudFNjaXNzb3JUZXN0ID0gbnVsbDsKCgkJCWNvbnN0IF9jdXJyZW50Q2xlYXJDb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQkJbGV0IF9jdXJyZW50Q2xlYXJBbHBoYSA9IDA7CgoJCQkvLwoKCQkJbGV0IF93aWR0aCA9IGNhbnZhcy53aWR0aDsKCQkJbGV0IF9oZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwoKCQkJbGV0IF9waXhlbFJhdGlvID0gMTsKCQkJbGV0IF9vcGFxdWVTb3J0ID0gbnVsbDsKCQkJbGV0IF90cmFuc3BhcmVudFNvcnQgPSBudWxsOwoKCQkJY29uc3QgX3ZpZXdwb3J0ID0gbmV3IFZlY3RvcjQoIDAsIDAsIF93aWR0aCwgX2hlaWdodCApOwoJCQljb25zdCBfc2Npc3NvciA9IG5ldyBWZWN0b3I0KCAwLCAwLCBfd2lkdGgsIF9oZWlnaHQgKTsKCQkJbGV0IF9zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQkJLy8gZnJ1c3R1bQoKCQkJY29uc3QgX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoKCQkJLy8gY2xpcHBpbmcKCgkJCWxldCBfY2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CgkJCWxldCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZTsKCgkJCS8vIGNhbWVyYSBtYXRyaWNlcyBjYWNoZQoKCQkJY29uc3QgX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCQkJY29uc3QgX3Byb2pTY3JlZW5NYXRyaXggPSBuZXcgTWF0cml4NCgpOwoKCQkJY29uc3QgX3ZlY3RvcjMgPSBuZXcgVmVjdG9yMygpOwoKCQkJY29uc3QgX3ZlY3RvcjQgPSBuZXcgVmVjdG9yNCgpOwoKCQkJY29uc3QgX2VtcHR5U2NlbmUgPSB7IGJhY2tncm91bmQ6IG51bGwsIGZvZzogbnVsbCwgZW52aXJvbm1lbnQ6IG51bGwsIG92ZXJyaWRlTWF0ZXJpYWw6IG51bGwsIGlzU2NlbmU6IHRydWUgfTsKCgkJCWxldCBfcmVuZGVyQmFja2dyb3VuZCA9IGZhbHNlOwoKCQkJZnVuY3Rpb24gZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpIHsKCgkJCQlyZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfcGl4ZWxSYXRpbyA6IDE7CgoJCQl9CgoJCQkvLyBpbml0aWFsaXplCgoJCQlsZXQgX2dsID0gY29udGV4dDsKCgkJCWZ1bmN0aW9uIGdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApIHsKCgkJCQlyZXR1cm4gY2FudmFzLmdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApOwoKCQkJfQoKCQkJdHJ5IHsKCgkJCQljb25zdCBjb250ZXh0QXR0cmlidXRlcyA9IHsKCQkJCQlhbHBoYTogdHJ1ZSwKCQkJCQlkZXB0aCwKCQkJCQlzdGVuY2lsLAoJCQkJCWFudGlhbGlhcywKCQkJCQlwcmVtdWx0aXBsaWVkQWxwaGEsCgkJCQkJcHJlc2VydmVEcmF3aW5nQnVmZmVyLAoJCQkJCXBvd2VyUHJlZmVyZW5jZSwKCQkJCQlmYWlsSWZNYWpvclBlcmZvcm1hbmNlQ2F2ZWF0LAoJCQkJfTsKCgkJCQkvLyBPZmZzY3JlZW5DYW52YXMgZG9lcyBub3QgaGF2ZSBzZXRBdHRyaWJ1dGUsIHNlZSAjMjI4MTEKCQkJCWlmICggJ3NldEF0dHJpYnV0ZScgaW4gY2FudmFzICkgY2FudmFzLnNldEF0dHJpYnV0ZSggJ2RhdGEtZW5naW5lJywgYHRocmVlLmpzIHIke1JFVklTSU9OfWAgKTsKCgkJCQkvLyBldmVudCBsaXN0ZW5lcnMgbXVzdCBiZSByZWdpc3RlcmVkIGJlZm9yZSBXZWJHTCBjb250ZXh0IGlzIGNyZWF0ZWQsIHNlZSAjMTI3NTMKCQkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0bG9zdCcsIG9uQ29udGV4dExvc3QsIGZhbHNlICk7CgkJCQljYW52YXMuYWRkRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKCQkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0Y3JlYXRpb25lcnJvcicsIG9uQ29udGV4dENyZWF0aW9uRXJyb3IsIGZhbHNlICk7CgoJCQkJaWYgKCBfZ2wgPT09IG51bGwgKSB7CgoJCQkJCWNvbnN0IGNvbnRleHROYW1lID0gJ3dlYmdsMic7CgoJCQkJCV9nbCA9IGdldENvbnRleHQoIGNvbnRleHROYW1lLCBjb250ZXh0QXR0cmlidXRlcyApOwoKCQkJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCgkJCQkJCWlmICggZ2V0Q29udGV4dCggY29udGV4dE5hbWUgKSApIHsKCgkJCQkJCQl0aHJvdyBuZXcgRXJyb3IoICdFcnJvciBjcmVhdGluZyBXZWJHTCBjb250ZXh0IHdpdGggeW91ciBzZWxlY3RlZCBhdHRyaWJ1dGVzLicgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4nICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6ICcgKyBlcnJvci5tZXNzYWdlICk7CgkJCQl0aHJvdyBlcnJvcjsKCgkJCX0KCgkJCWxldCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMsIHN0YXRlLCBpbmZvOwoJCQlsZXQgcHJvcGVydGllcywgdGV4dHVyZXMsIGN1YmVtYXBzLCBjdWJldXZtYXBzLCBhdHRyaWJ1dGVzLCBnZW9tZXRyaWVzLCBvYmplY3RzOwoJCQlsZXQgcHJvZ3JhbUNhY2hlLCBtYXRlcmlhbHMsIHJlbmRlckxpc3RzLCByZW5kZXJTdGF0ZXMsIGNsaXBwaW5nLCBzaGFkb3dNYXA7CgoJCQlsZXQgYmFja2dyb3VuZCwgbW9ycGh0YXJnZXRzLCBidWZmZXJSZW5kZXJlciwgaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwoKCQkJbGV0IHV0aWxzLCBiaW5kaW5nU3RhdGVzLCB1bmlmb3Jtc0dyb3VwczsKCgkJCWZ1bmN0aW9uIGluaXRHTENvbnRleHQoKSB7CgoJCQkJZXh0ZW5zaW9ucyA9IG5ldyBXZWJHTEV4dGVuc2lvbnMoIF9nbCApOwoJCQkJZXh0ZW5zaW9ucy5pbml0KCk7CgoJCQkJdXRpbHMgPSBuZXcgV2ViR0xVdGlscyggX2dsLCBleHRlbnNpb25zICk7CgoJCQkJY2FwYWJpbGl0aWVzID0gbmV3IFdlYkdMQ2FwYWJpbGl0aWVzKCBfZ2wsIGV4dGVuc2lvbnMsIHBhcmFtZXRlcnMsIHV0aWxzICk7CgoJCQkJc3RhdGUgPSBuZXcgV2ViR0xTdGF0ZSggX2dsLCBleHRlbnNpb25zICk7CgoJCQkJaWYgKCBjYXBhYmlsaXRpZXMucmV2ZXJzZURlcHRoQnVmZmVyICYmIHJldmVyc2VEZXB0aEJ1ZmZlciApIHsKCgkJCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRSZXZlcnNlZCggdHJ1ZSApOwoKCQkJCX0KCgkJCQlpbmZvID0gbmV3IFdlYkdMSW5mbyggX2dsICk7CgkJCQlwcm9wZXJ0aWVzID0gbmV3IFdlYkdMUHJvcGVydGllcygpOwoJCQkJdGV4dHVyZXMgPSBuZXcgV2ViR0xUZXh0dXJlcyggX2dsLCBleHRlbnNpb25zLCBzdGF0ZSwgcHJvcGVydGllcywgY2FwYWJpbGl0aWVzLCB1dGlscywgaW5mbyApOwoJCQkJY3ViZW1hcHMgPSBuZXcgV2ViR0xDdWJlTWFwcyggX3RoaXMgKTsKCQkJCWN1YmV1dm1hcHMgPSBuZXcgV2ViR0xDdWJlVVZNYXBzKCBfdGhpcyApOwoJCQkJYXR0cmlidXRlcyA9IG5ldyBXZWJHTEF0dHJpYnV0ZXMoIF9nbCApOwoJCQkJYmluZGluZ1N0YXRlcyA9IG5ldyBXZWJHTEJpbmRpbmdTdGF0ZXMoIF9nbCwgYXR0cmlidXRlcyApOwoJCQkJZ2VvbWV0cmllcyA9IG5ldyBXZWJHTEdlb21ldHJpZXMoIF9nbCwgYXR0cmlidXRlcywgaW5mbywgYmluZGluZ1N0YXRlcyApOwoJCQkJb2JqZWN0cyA9IG5ldyBXZWJHTE9iamVjdHMoIF9nbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApOwoJCQkJbW9ycGh0YXJnZXRzID0gbmV3IFdlYkdMTW9ycGh0YXJnZXRzKCBfZ2wsIGNhcGFiaWxpdGllcywgdGV4dHVyZXMgKTsKCQkJCWNsaXBwaW5nID0gbmV3IFdlYkdMQ2xpcHBpbmcoIHByb3BlcnRpZXMgKTsKCQkJCXByb2dyYW1DYWNoZSA9IG5ldyBXZWJHTFByb2dyYW1zKCBfdGhpcywgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcgKTsKCQkJCW1hdGVyaWFscyA9IG5ldyBXZWJHTE1hdGVyaWFscyggX3RoaXMsIHByb3BlcnRpZXMgKTsKCQkJCXJlbmRlckxpc3RzID0gbmV3IFdlYkdMUmVuZGVyTGlzdHMoKTsKCQkJCXJlbmRlclN0YXRlcyA9IG5ldyBXZWJHTFJlbmRlclN0YXRlcyggZXh0ZW5zaW9ucyApOwoJCQkJYmFja2dyb3VuZCA9IG5ldyBXZWJHTEJhY2tncm91bmQoIF90aGlzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgc3RhdGUsIG9iamVjdHMsIF9hbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgkJCQlzaGFkb3dNYXAgPSBuZXcgV2ViR0xTaGFkb3dNYXAoIF90aGlzLCBvYmplY3RzLCBjYXBhYmlsaXRpZXMgKTsKCQkJCXVuaWZvcm1zR3JvdXBzID0gbmV3IFdlYkdMVW5pZm9ybXNHcm91cHMoIF9nbCwgaW5mbywgY2FwYWJpbGl0aWVzLCBzdGF0ZSApOwoKCQkJCWJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMQnVmZmVyUmVuZGVyZXIoIF9nbCwgZXh0ZW5zaW9ucywgaW5mbyApOwoJCQkJaW5kZXhlZEJ1ZmZlclJlbmRlcmVyID0gbmV3IFdlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyKCBfZ2wsIGV4dGVuc2lvbnMsIGluZm8gKTsKCgkJCQlpbmZvLnByb2dyYW1zID0gcHJvZ3JhbUNhY2hlLnByb2dyYW1zOwoKCQkJCS8qKgoJCQkJICogSG9sZHMgZGV0YWlscyBhYm91dCB0aGUgY2FwYWJpbGl0aWVzIG9mIHRoZSBjdXJyZW50IHJlbmRlcmluZyBjb250ZXh0LgoJCQkJICoKCQkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjY2FwYWJpbGl0aWVzCgkJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5DYXBhYmlsaXRpZXN9CgkJCQkgKi8KCQkJCV90aGlzLmNhcGFiaWxpdGllcyA9IGNhcGFiaWxpdGllczsKCgkJCQkvKioKCQkJCSAqIFByb3ZpZGVzIG1ldGhvZHMgZm9yIHJldHJpZXZpbmcgYW5kIHRlc3RpbmcgV2ViR0wgZXh0ZW5zaW9ucy4KCQkJCSAqCgkJCQkgKiAtIGBnZXQoZXh0ZW5zaW9uTmFtZTpzdHJpbmcpYDogVXNlZCB0byBjaGVjayB3aGV0aGVyIGEgV2ViR0wgZXh0ZW5zaW9uIGlzIHN1cHBvcnRlZAoJCQkJICogYW5kIHJldHVybiB0aGUgZXh0ZW5zaW9uIG9iamVjdCBpZiBhdmFpbGFibGUuCgkJCQkgKiAtIGBoYXMoZXh0ZW5zaW9uTmFtZTpzdHJpbmcpYDogcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIGV4dGVuc2lvbiBpcyBzdXBwb3J0ZWQuCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNleHRlbnNpb25zCgkJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkJICovCgkJCQlfdGhpcy5leHRlbnNpb25zID0gZXh0ZW5zaW9uczsKCgkJCQkvKioKCQkJCSAqIFVzZWQgdG8gdHJhY2sgcHJvcGVydGllcyBvZiBvdGhlciBvYmplY3RzIGxpa2UgbmF0aXZlIFdlYkdMIG9iamVjdHMuCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNwcm9wZXJ0aWVzCgkJCQkgKiBAdHlwZSB7T2JqZWN0fQoJCQkJICovCgkJCQlfdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKCgkJCQkvKioKCQkJCSAqIE1hbmFnZXMgdGhlIHJlbmRlciBsaXN0cyBvZiB0aGUgcmVuZGVyZXIuCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNyZW5kZXJMaXN0cwoJCQkJICogQHR5cGUge09iamVjdH0KCQkJCSAqLwoJCQkJX3RoaXMucmVuZGVyTGlzdHMgPSByZW5kZXJMaXN0czsKCgoKCQkJCS8qKgoJCQkJICogSW50ZXJmYWNlIGZvciBtYW5hZ2luZyBzaGFkb3dzLgoJCQkJICoKCQkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjc2hhZG93TWFwCgkJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5TaGFkb3dNYXB9CgkJCQkgKi8KCQkJCV90aGlzLnNoYWRvd01hcCA9IHNoYWRvd01hcDsKCgkJCQkvKioKCQkJCSAqIEludGVyZmFjZSBmb3IgbWFuYWdpbmcgdGhlIFdlYkdMIHN0YXRlLgoJCQkJICoKCQkJCSAqIEBuYW1lIFdlYkdMUmVuZGVyZXIjc3RhdGUKCQkJCSAqIEB0eXBlIHtPYmplY3R9CgkJCQkgKi8KCQkJCV90aGlzLnN0YXRlID0gc3RhdGU7CgoJCQkJLyoqCgkJCQkgKiBIb2xkcyBhIHNlcmllcyBvZiBzdGF0aXN0aWNhbCBpbmZvcm1hdGlvbiBhYm91dCB0aGUgR1BVIG1lbW9yeQoJCQkJICogYW5kIHRoZSByZW5kZXJpbmcgcHJvY2Vzcy4gVXNlZnVsIGZvciBkZWJ1Z2dpbmcgYW5kIG1vbml0b3JpbmcuCgkJCQkgKgoJCQkJICogQnkgZGVmYXVsdCB0aGVzZSBkYXRhIGFyZSByZXNldCBhdCBlYWNoIHJlbmRlciBjYWxsIGJ1dCB3aGVuIGhhdmluZwoJCQkJICogbXVsdGlwbGUgcmVuZGVyIHBhc3NlcyBwZXIgZnJhbWUgKGUuZy4gd2hlbiB1c2luZyBwb3N0IHByb2Nlc3NpbmcpIGl0IGNhbgoJCQkJICogYmUgcHJlZmVycmVkIHRvIHJlc2V0IHdpdGggYSBjdXN0b20gcGF0dGVybi4gRmlyc3QsIHNldCBgYXV0b1Jlc2V0YCB0bwoJCQkJICogYGZhbHNlYC4KCQkJCSAqIGBgYGpzCgkJCQkgKiByZW5kZXJlci5pbmZvLmF1dG9SZXNldCA9IGZhbHNlOwoJCQkJICogYGBgCgkJCQkgKiBDYWxsIGByZXNldCgpYCB3aGVuZXZlciB5b3UgaGF2ZSBmaW5pc2hlZCB0byByZW5kZXIgYSBzaW5nbGUgZnJhbWUuCgkJCQkgKiBgYGBqcwoJCQkJICogcmVuZGVyZXIuaW5mby5yZXNldCgpOwoJCQkJICogYGBgCgkJCQkgKgoJCQkJICogQG5hbWUgV2ViR0xSZW5kZXJlciNpbmZvCgkJCQkgKiBAdHlwZSB7V2ViR0xSZW5kZXJlcn5JbmZvfQoJCQkJICovCgkJCQlfdGhpcy5pbmZvID0gaW5mbzsKCgkJCX0KCgkJCWluaXRHTENvbnRleHQoKTsKCgkJCS8vIHhyCgoJCQljb25zdCB4ciA9IG5ldyBXZWJYUk1hbmFnZXIoIF90aGlzLCBfZ2wgKTsKCgkJCS8qKgoJCQkgKiBBIHJlZmVyZW5jZSB0byB0aGUgWFIgbWFuYWdlci4KCQkJICoKCQkJICogQHR5cGUge1dlYlhSTWFuYWdlcn0KCQkJICovCgkJCXRoaXMueHIgPSB4cjsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSByZW5kZXJpbmcgY29udGV4dC4KCQkJICoKCQkJICogQHJldHVybiB7V2ViR0wyUmVuZGVyaW5nQ29udGV4dH0gVGhlIHJlbmRlcmluZyBjb250ZXh0LgoJCQkgKi8KCQkJdGhpcy5nZXRDb250ZXh0ID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBfZ2w7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIHJlbmRlcmluZyBjb250ZXh0IGF0dHJpYnV0ZXMuCgkJCSAqCgkJCSAqIEByZXR1cm4ge1dlYkdMQ29udGV4dEF0dHJpYnV0ZXN9IFRoZSByZW5kZXJpbmcgY29udGV4dCBhdHRyaWJ1dGVzLgoJCQkgKi8KCQkJdGhpcy5nZXRDb250ZXh0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gX2dsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNpbXVsYXRlcyBhIGxvc3Mgb2YgdGhlIFdlYkdMIGNvbnRleHQuIFRoaXMgcmVxdWlyZXMgc3VwcG9ydCBmb3IgdGhlIGBXRUJHTF9sb3NlX2NvbnRleHRgIGV4dGVuc2lvbi4KCQkJICovCgkJCXRoaXMuZm9yY2VDb250ZXh0TG9zcyA9IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKCQkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLmxvc2VDb250ZXh0KCk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNpbXVsYXRlcyBhIHJlc3RvcmUgb2YgdGhlIFdlYkdMIGNvbnRleHQuIFRoaXMgcmVxdWlyZXMgc3VwcG9ydCBmb3IgdGhlIGBXRUJHTF9sb3NlX2NvbnRleHRgIGV4dGVuc2lvbi4KCQkJICovCgkJCXRoaXMuZm9yY2VDb250ZXh0UmVzdG9yZSA9IGZ1bmN0aW9uICgpIHsKCgkJCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2xvc2VfY29udGV4dCcgKTsKCQkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLnJlc3RvcmVDb250ZXh0KCk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIHBpeGVsIHJhdGlvLgoJCQkgKgoJCQkgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBwaXhlbCByYXRpby4KCQkJICovCgkJCXRoaXMuZ2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gX3BpeGVsUmF0aW87CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIGdpdmVuIHBpeGVsIHJhdGlvIGFuZCByZXNpemVzIHRoZSBjYW52YXMgaWYgbmVjZXNzYXJ5LgoJCQkgKgoJCQkgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgLSBUaGUgcGl4ZWwgcmF0aW8uCgkJCSAqLwoJCQl0aGlzLnNldFBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoIHZhbHVlICkgewoKCQkJCWlmICggdmFsdWUgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJCQlfcGl4ZWxSYXRpbyA9IHZhbHVlOwoKCQkJCXRoaXMuc2V0U2l6ZSggX3dpZHRoLCBfaGVpZ2h0LCBmYWxzZSApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSByZW5kZXJlcidzIHNpemUgaW4gbG9naWNhbCBwaXhlbHMuIFRoaXMgbWV0aG9kIGRvZXMgbm90IGhvbm9yIHRoZSBwaXhlbCByYXRpby4KCQkJICoKCQkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KCQkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIHJlbmRlcmVyJ3Mgc2l6ZSBpbiBsb2dpY2FsIHBpeGVscy4KCQkJICovCgkJCXRoaXMuZ2V0U2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGgsIF9oZWlnaHQgKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmVzaXplcyB0aGUgb3V0cHV0IGNhbnZhcyB0byAod2lkdGgsIGhlaWdodCkgd2l0aCBkZXZpY2UgcGl4ZWwgcmF0aW8gdGFrZW4KCQkJICogaW50byBhY2NvdW50LCBhbmQgYWxzbyBzZXRzIHRoZSB2aWV3cG9ydCB0byBmaXQgdGhhdCBzaXplLCBzdGFydGluZyBpbiAoMCwKCQkJICogMCkuIFNldHRpbmcgYHVwZGF0ZVN0eWxlYCB0byBmYWxzZSBwcmV2ZW50cyBhbnkgc3R5bGUgY2hhbmdlcyB0byB0aGUgb3V0cHV0IGNhbnZhcy4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIGluIGxvZ2ljYWwgcGl4ZWxzLgoJCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBpbiBsb2dpY2FsIHBpeGVscy4KCQkJICogQHBhcmFtIHtib29sZWFufSBbdXBkYXRlU3R5bGU9dHJ1ZV0gLSBXaGV0aGVyIHRvIHVwZGF0ZSB0aGUgYHN0eWxlYCBhdHRyaWJ1dGUgb2YgdGhlIGNhbnZhcyBvciBub3QuCgkJCSAqLwoJCQl0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQsIHVwZGF0ZVN0eWxlID0gdHJ1ZSApIHsKCgkJCQlpZiAoIHhyLmlzUHJlc2VudGluZyApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQ2FuXCd0IGNoYW5nZSBzaXplIHdoaWxlIFZSIGRldmljZSBpcyBwcmVzZW50aW5nLicgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCV93aWR0aCA9IHdpZHRoOwoJCQkJX2hlaWdodCA9IGhlaWdodDsKCgkJCQljYW52YXMud2lkdGggPSBNYXRoLmZsb29yKCB3aWR0aCAqIF9waXhlbFJhdGlvICk7CgkJCQljYW52YXMuaGVpZ2h0ID0gTWF0aC5mbG9vciggaGVpZ2h0ICogX3BpeGVsUmF0aW8gKTsKCgkJCQlpZiAoIHVwZGF0ZVN0eWxlID09PSB0cnVlICkgewoKCQkJCQljYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7CgkJCQkJY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CgoJCQkJfQoKCQkJCXRoaXMuc2V0Vmlld3BvcnQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgZHJhd2luZyBidWZmZXIgc2l6ZSBpbiBwaHlzaWNhbCBwaXhlbHMuIFRoaXMgbWV0aG9kIGhvbm9ycyB0aGUgcGl4ZWwgcmF0aW8uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VmVjdG9yMn0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCgkJCSAqIEByZXR1cm4ge1ZlY3RvcjJ9IFRoZSBkcmF3aW5nIGJ1ZmZlciBzaXplLgoJCQkgKi8KCQkJdGhpcy5nZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuc2V0KCBfd2lkdGggKiBfcGl4ZWxSYXRpbywgX2hlaWdodCAqIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCgkJCX07CgoJCQkvKioKCQkJICogVGhpcyBtZXRob2QgYWxsb3dzIHRvIGRlZmluZSB0aGUgZHJhd2luZyBidWZmZXIgc2l6ZSBieSBzcGVjaWZ5aW5nCgkJCSAqIHdpZHRoLCBoZWlnaHQgYW5kIHBpeGVsIHJhdGlvIGFsbCBhdCBvbmNlLiBUaGUgc2l6ZSBvZiB0aGUgZHJhd2luZwoJCQkgKiBidWZmZXIgaXMgY29tcHV0ZWQgd2l0aCB0aGlzIGZvcm11bGE6CgkJCSAqIGBgYGpzCgkJCSAqIHNpemUueCA9IHdpZHRoICogcGl4ZWxSYXRpbzsKCQkJICogc2l6ZS55ID0gaGVpZ2h0ICogcGl4ZWxSYXRpbzsKCQkJICogYGBgCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBpbiBsb2dpY2FsIHBpeGVscy4KCQkJICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodCAtIFRoZSBoZWlnaHQgaW4gbG9naWNhbCBwaXhlbHMuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBwaXhlbFJhdGlvIC0gVGhlIHBpeGVsIHJhdGlvLgoJCQkgKi8KCQkJdGhpcy5zZXREcmF3aW5nQnVmZmVyU2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgcGl4ZWxSYXRpbyApIHsKCgkJCQlfd2lkdGggPSB3aWR0aDsKCQkJCV9oZWlnaHQgPSBoZWlnaHQ7CgoJCQkJX3BpeGVsUmF0aW8gPSBwaXhlbFJhdGlvOwoKCQkJCWNhbnZhcy53aWR0aCA9IE1hdGguZmxvb3IoIHdpZHRoICogcGl4ZWxSYXRpbyApOwoJCQkJY2FudmFzLmhlaWdodCA9IE1hdGguZmxvb3IoIGhlaWdodCAqIHBpeGVsUmF0aW8gKTsKCgkJCQl0aGlzLnNldFZpZXdwb3J0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGN1cnJlbnQgdmlld3BvcnQgZGVmaW5pdGlvbi4KCQkJICoKCQkJICogQHBhcmFtIHtWZWN0b3IyfSB0YXJnZXQgLSBUaGUgbWV0aG9kIHdyaXRlcyB0aGUgcmVzdWx0IGluIHRoaXMgdGFyZ2V0IG9iamVjdC4KCQkJICogQHJldHVybiB7VmVjdG9yMn0gVGhlIGN1cnJlbnQgdmlld3BvcnQgZGVmaW5pdGlvbi4KCQkJICovCgkJCXRoaXMuZ2V0Q3VycmVudFZpZXdwb3J0ID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfY3VycmVudFZpZXdwb3J0ICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIHZpZXdwb3J0IGRlZmluaXRpb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCgkJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IFRoZSB2aWV3cG9ydCBkZWZpbml0aW9uLgoJCQkgKi8KCQkJdGhpcy5nZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuY29weSggX3ZpZXdwb3J0ICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgdGhlIHZpZXdwb3J0IHRvIHJlbmRlciBmcm9tIGAoeCwgeSlgIHRvIGAoeCArIHdpZHRoLCB5ICsgaGVpZ2h0KWAuCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyIHwgVmVjdG9yNH0geCAtIFRoZSBob3Jpem9udGFsIGNvb3JkaW5hdGUgZm9yIHRoZSBsb3dlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlld3BvcnQgb3JpZ2luIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KCQkJICogT3IgYWx0ZXJuYXRpdmVseSBhIGZvdXItY29tcG9uZW50IHZlY3RvciBzcGVjaWZ5aW5nIGFsbCB0aGUgcGFyYW1ldGVycyBvZiB0aGUgdmlld3BvcnQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gVGhlIHZlcnRpY2FsIGNvb3JkaW5hdGUgZm9yIHRoZSBsb3dlciBsZWZ0IGNvcm5lciBvZiB0aGUgdmlld3BvcnQgb3JpZ2luICBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdmlld3BvcnQgaW4gbG9naWNhbCBwaXhlbCB1bml0LgoJCQkgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgdmlld3BvcnQgaW4gbG9naWNhbCBwaXhlbCB1bml0LgoJCQkgKi8KCQkJdGhpcy5zZXRWaWV3cG9ydCA9IGZ1bmN0aW9uICggeCwgeSwgd2lkdGgsIGhlaWdodCApIHsKCgkJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKCQkJCQlfdmlld3BvcnQuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfdmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQkJfQoKCQkJCXN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLnJvdW5kKCkgKTsKCgkJCX07CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgc2Npc3NvciByZWdpb24uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VmVjdG9yNH0gdGFyZ2V0IC0gVGhlIG1ldGhvZCB3cml0ZXMgdGhlIHJlc3VsdCBpbiB0aGlzIHRhcmdldCBvYmplY3QuCgkJCSAqIEByZXR1cm4ge1ZlY3RvcjR9IFRoZSBzY2lzc29yIHJlZ2lvbi4KCQkJICovCgkJCXRoaXMuZ2V0U2Npc3NvciA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJCXJldHVybiB0YXJnZXQuY29weSggX3NjaXNzb3IgKTsKCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgc2Npc3NvciByZWdpb24gdG8gcmVuZGVyIGZyb20gYCh4LCB5KWAgdG8gYCh4ICsgd2lkdGgsIHkgKyBoZWlnaHQpYC4KCQkJICoKCQkJICogQHBhcmFtIHtudW1iZXIgfCBWZWN0b3I0fSB4IC0gVGhlIGhvcml6b250YWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBvcmlnaW4gaW4gbG9naWNhbCBwaXhlbCB1bml0LgoJCQkgKiBPciBhbHRlcm5hdGl2ZWx5IGEgZm91ci1jb21wb25lbnQgdmVjdG9yIHNwZWNpZnlpbmcgYWxsIHRoZSBwYXJhbWV0ZXJzIG9mIHRoZSBzY2lzc29yIHJlZ2lvbi4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHkgLSBUaGUgdmVydGljYWwgY29vcmRpbmF0ZSBmb3IgdGhlIGxvd2VyIGxlZnQgY29ybmVyIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBvcmlnaW4gIGluIGxvZ2ljYWwgcGl4ZWwgdW5pdC4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGhlIHdpZHRoIG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBzY2lzc29yIHJlZ2lvbiBpbiBsb2dpY2FsIHBpeGVsIHVuaXQuCgkJCSAqLwoJCQl0aGlzLnNldFNjaXNzb3IgPSBmdW5jdGlvbiAoIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQkJaWYgKCB4LmlzVmVjdG9yNCApIHsKCgkJCQkJX3NjaXNzb3Iuc2V0KCB4LngsIHgueSwgeC56LCB4LncgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfc2Npc3Nvci5zZXQoIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQl9CgoJCQkJc3RhdGUuc2Npc3NvciggX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkucm91bmQoKSApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIGB0cnVlYCBpZiB0aGUgc2Npc3NvciB0ZXN0IGlzIGVuYWJsZWQuCgkJCSAqCgkJCSAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgdGhlIHNjaXNzb3IgdGVzdCBpcyBlbmFibGVkIG9yIG5vdC4KCQkJICovCgkJCXRoaXMuZ2V0U2Npc3NvclRlc3QgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIF9zY2lzc29yVGVzdDsKCgkJCX07CgoJCQkvKioKCQkJICogRW5hYmxlIG9yIGRpc2FibGUgdGhlIHNjaXNzb3IgdGVzdC4gV2hlbiB0aGlzIGlzIGVuYWJsZWQsIG9ubHkgdGhlIHBpeGVscwoJCQkgKiB3aXRoaW4gdGhlIGRlZmluZWQgc2Npc3NvciBhcmVhIHdpbGwgYmUgYWZmZWN0ZWQgYnkgZnVydGhlciByZW5kZXJlcgoJCQkgKiBhY3Rpb25zLgoJCQkgKgoJCQkgKiBAcGFyYW0ge2Jvb2xlYW59IGJvb2xlYW4gLSBXaGV0aGVyIHRoZSBzY2lzc29yIHRlc3QgaXMgZW5hYmxlZCBvciBub3QuCgkJCSAqLwoJCQl0aGlzLnNldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCBib29sZWFuICkgewoKCQkJCXN0YXRlLnNldFNjaXNzb3JUZXN0KCBfc2Npc3NvclRlc3QgPSBib29sZWFuICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgYSBjdXN0b20gb3BhcXVlIHNvcnQgZnVuY3Rpb24gZm9yIHRoZSByZW5kZXIgbGlzdHMuIFBhc3MgYG51bGxgCgkJCSAqIHRvIHVzZSB0aGUgZGVmYXVsdCBgcGFpbnRlclNvcnRTdGFibGVgIGZ1bmN0aW9uLgoJCQkgKgoJCQkgKiBAcGFyYW0gez9GdW5jdGlvbn0gbWV0aG9kIC0gVGhlIG9wYXF1ZSBzb3J0IGZ1bmN0aW9uLgoJCQkgKi8KCQkJdGhpcy5zZXRPcGFxdWVTb3J0ID0gZnVuY3Rpb24gKCBtZXRob2QgKSB7CgoJCQkJX29wYXF1ZVNvcnQgPSBtZXRob2Q7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFNldHMgYSBjdXN0b20gdHJhbnNwYXJlbnQgc29ydCBmdW5jdGlvbiBmb3IgdGhlIHJlbmRlciBsaXN0cy4gUGFzcyBgbnVsbGAKCQkJICogdG8gdXNlIHRoZSBkZWZhdWx0IGByZXZlcnNlUGFpbnRlclNvcnRTdGFibGVgIGZ1bmN0aW9uLgoJCQkgKgoJCQkgKiBAcGFyYW0gez9GdW5jdGlvbn0gbWV0aG9kIC0gVGhlIG9wYXF1ZSBzb3J0IGZ1bmN0aW9uLgoJCQkgKi8KCQkJdGhpcy5zZXRUcmFuc3BhcmVudFNvcnQgPSBmdW5jdGlvbiAoIG1ldGhvZCApIHsKCgkJCQlfdHJhbnNwYXJlbnRTb3J0ID0gbWV0aG9kOwoKCQkJfTsKCgkJCS8vIENsZWFyaW5nCgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgY2xlYXIgY29sb3IuCgkJCSAqCgkJCSAqIEBwYXJhbSB7Q29sb3J9IHRhcmdldCAtIFRoZSBtZXRob2Qgd3JpdGVzIHRoZSByZXN1bHQgaW4gdGhpcyB0YXJnZXQgb2JqZWN0LgoJCQkgKiBAcmV0dXJuIHtDb2xvcn0gVGhlIGNsZWFyIGNvbG9yLgoJCQkgKi8KCQkJdGhpcy5nZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKSApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBTZXRzIHRoZSBjbGVhciBjb2xvciBhbmQgYWxwaGEuCgkJCSAqCgkJCSAqIEBwYXJhbSB7Q29sb3J9IGNvbG9yIC0gVGhlIGNsZWFyIGNvbG9yLgoJCQkgKiBAcGFyYW0ge251bWJlcn0gW2FscGhhPTFdIC0gVGhlIGNsZWFyIGFscGhhLgoJCQkgKi8KCQkJdGhpcy5zZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKCQkJCWJhY2tncm91bmQuc2V0Q2xlYXJDb2xvciggLi4uYXJndW1lbnRzICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGNsZWFyIGFscGhhLiBSYW5nZXMgd2l0aGluIGBbMCwxXWAuCgkJCSAqCgkJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGNsZWFyIGFscGhhLgoJCQkgKi8KCQkJdGhpcy5nZXRDbGVhckFscGhhID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKCgkJCX07CgoJCQkvKioKCQkJICogU2V0cyB0aGUgY2xlYXIgYWxwaGEuCgkJCSAqCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBhbHBoYSAtIFRoZSBjbGVhciBhbHBoYS4KCQkJICovCgkJCXRoaXMuc2V0Q2xlYXJBbHBoYSA9IGZ1bmN0aW9uICgpIHsKCgkJCQliYWNrZ3JvdW5kLnNldENsZWFyQWxwaGEoIC4uLmFyZ3VtZW50cyApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBUZWxscyB0aGUgcmVuZGVyZXIgdG8gY2xlYXIgaXRzIGNvbG9yLCBkZXB0aCBvciBzdGVuY2lsIGRyYXdpbmcgYnVmZmVyKHMpLgoJCQkgKiBUaGlzIG1ldGhvZCBpbml0aWFsaXplcyB0aGUgYnVmZmVycyB0byB0aGUgY3VycmVudCBjbGVhciBjb2xvciB2YWx1ZXMuCgkJCSAqCgkJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2NvbG9yPXRydWVdIC0gV2hldGhlciB0aGUgY29sb3IgYnVmZmVyIHNob3VsZCBiZSBjbGVhcmVkIG9yIG5vdC4KCQkJICogQHBhcmFtIHtib29sZWFufSBbZGVwdGg9dHJ1ZV0gLSBXaGV0aGVyIHRoZSBkZXB0aCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgoJCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtzdGVuY2lsPXRydWVdIC0gV2hldGhlciB0aGUgc3RlbmNpbCBidWZmZXIgc2hvdWxkIGJlIGNsZWFyZWQgb3Igbm90LgoJCQkgKi8KCQkJdGhpcy5jbGVhciA9IGZ1bmN0aW9uICggY29sb3IgPSB0cnVlLCBkZXB0aCA9IHRydWUsIHN0ZW5jaWwgPSB0cnVlICkgewoKCQkJCWxldCBiaXRzID0gMDsKCgkJCQlpZiAoIGNvbG9yICkgewoKCQkJCQkvLyBjaGVjayBpZiB3ZSdyZSB0cnlpbmcgdG8gY2xlYXIgYW4gaW50ZWdlciB0YXJnZXQKCQkJCQlsZXQgaXNJbnRlZ2VyRm9ybWF0ID0gZmFsc2U7CgkJCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApIHsKCgkJCQkJCWNvbnN0IHRhcmdldEZvcm1hdCA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0LnRleHR1cmUuZm9ybWF0OwoJCQkJCQlpc0ludGVnZXJGb3JtYXQgPSB0YXJnZXRGb3JtYXQgPT09IFJHQkFJbnRlZ2VyRm9ybWF0IHx8CgkJCQkJCQl0YXJnZXRGb3JtYXQgPT09IFJHSW50ZWdlckZvcm1hdCB8fAoJCQkJCQkJdGFyZ2V0Rm9ybWF0ID09PSBSZWRJbnRlZ2VyRm9ybWF0OwoKCQkJCQl9CgoJCQkJCS8vIHVzZSB0aGUgYXBwcm9wcmlhdGUgY2xlYXIgZnVuY3Rpb25zIHRvIGNsZWFyIHRoZSB0YXJnZXQgaWYgaXQncyBhIHNpZ25lZAoJCQkJCS8vIG9yIHVuc2lnbmVkIGludGVnZXIgdGFyZ2V0CgkJCQkJaWYgKCBpc0ludGVnZXJGb3JtYXQgKSB7CgoJCQkJCQljb25zdCB0YXJnZXRUeXBlID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS50eXBlOwoJCQkJCQljb25zdCBpc1Vuc2lnbmVkVHlwZSA9IHRhcmdldFR5cGUgPT09IFVuc2lnbmVkQnl0ZVR5cGUgfHwKCQkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50VHlwZSB8fAoJCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgfHwKCQkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkSW50MjQ4VHlwZSB8fAoJCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydDQ0NDRUeXBlIHx8CgkJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGU7CgoJCQkJCQljb25zdCBjbGVhckNvbG9yID0gYmFja2dyb3VuZC5nZXRDbGVhckNvbG9yKCk7CgkJCQkJCWNvbnN0IGEgPSBiYWNrZ3JvdW5kLmdldENsZWFyQWxwaGEoKTsKCQkJCQkJY29uc3QgciA9IGNsZWFyQ29sb3IucjsKCQkJCQkJY29uc3QgZyA9IGNsZWFyQ29sb3IuZzsKCQkJCQkJY29uc3QgYiA9IGNsZWFyQ29sb3IuYjsKCgkJCQkJCWlmICggaXNVbnNpZ25lZFR5cGUgKSB7CgoJCQkJCQkJdWludENsZWFyQ29sb3JbIDAgXSA9IHI7CgkJCQkJCQl1aW50Q2xlYXJDb2xvclsgMSBdID0gZzsKCQkJCQkJCXVpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwoJCQkJCQkJdWludENsZWFyQ29sb3JbIDMgXSA9IGE7CgkJCQkJCQlfZ2wuY2xlYXJCdWZmZXJ1aXYoIF9nbC5DT0xPUiwgMCwgdWludENsZWFyQ29sb3IgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaW50Q2xlYXJDb2xvclsgMCBdID0gcjsKCQkJCQkJCWludENsZWFyQ29sb3JbIDEgXSA9IGc7CgkJCQkJCQlpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwoJCQkJCQkJaW50Q2xlYXJDb2xvclsgMyBdID0gYTsKCQkJCQkJCV9nbC5jbGVhckJ1ZmZlcml2KCBfZ2wuQ09MT1IsIDAsIGludENsZWFyQ29sb3IgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWJpdHMgfD0gX2dsLkNPTE9SX0JVRkZFUl9CSVQ7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBkZXB0aCApIHsKCgkJCQkJYml0cyB8PSBfZ2wuREVQVEhfQlVGRkVSX0JJVDsKCgkJCQl9CgoJCQkJaWYgKCBzdGVuY2lsICkgewoKCQkJCQliaXRzIHw9IF9nbC5TVEVOQ0lMX0JVRkZFUl9CSVQ7CgkJCQkJdGhpcy5zdGF0ZS5idWZmZXJzLnN0ZW5jaWwuc2V0TWFzayggMHhmZmZmZmZmZiApOwoKCQkJCX0KCgkJCQlfZ2wuY2xlYXIoIGJpdHMgKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2xlYXJzIHRoZSBjb2xvciBidWZmZXIuIEVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVuZGVyZXIuY2xlYXIoIHRydWUsIGZhbHNlLCBmYWxzZSApYC4KCQkJICovCgkJCXRoaXMuY2xlYXJDb2xvciA9IGZ1bmN0aW9uICgpIHsKCgkJCQl0aGlzLmNsZWFyKCB0cnVlLCBmYWxzZSwgZmFsc2UgKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2xlYXJzIHRoZSBkZXB0aCBidWZmZXIuIEVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVuZGVyZXIuY2xlYXIoIGZhbHNlLCB0cnVlLCBmYWxzZSApYC4KCQkJICovCgkJCXRoaXMuY2xlYXJEZXB0aCA9IGZ1bmN0aW9uICgpIHsKCgkJCQl0aGlzLmNsZWFyKCBmYWxzZSwgdHJ1ZSwgZmFsc2UgKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2xlYXJzIHRoZSBzdGVuY2lsIGJ1ZmZlci4gRXF1aXZhbGVudCB0byBjYWxsaW5nIGByZW5kZXJlci5jbGVhciggZmFsc2UsIGZhbHNlLCB0cnVlIClgLgoJCQkgKi8KCQkJdGhpcy5jbGVhclN0ZW5jaWwgPSBmdW5jdGlvbiAoKSB7CgoJCQkJdGhpcy5jbGVhciggZmFsc2UsIGZhbHNlLCB0cnVlICk7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIEZyZWVzIHRoZSBHUFUtcmVsYXRlZCByZXNvdXJjZXMgYWxsb2NhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuIENhbGwgdGhpcwoJCQkgKiBtZXRob2Qgd2hlbmV2ZXIgdGhpcyBpbnN0YW5jZSBpcyBubyBsb25nZXIgdXNlZCBpbiB5b3VyIGFwcC4KCQkJICovCgkJCXRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKCgkJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGxvc3QnLCBvbkNvbnRleHRMb3N0LCBmYWxzZSApOwoJCQkJY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRyZXN0b3JlZCcsIG9uQ29udGV4dFJlc3RvcmUsIGZhbHNlICk7CgkJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGNyZWF0aW9uZXJyb3InLCBvbkNvbnRleHRDcmVhdGlvbkVycm9yLCBmYWxzZSApOwoKCQkJCWJhY2tncm91bmQuZGlzcG9zZSgpOwoJCQkJcmVuZGVyTGlzdHMuZGlzcG9zZSgpOwoJCQkJcmVuZGVyU3RhdGVzLmRpc3Bvc2UoKTsKCQkJCXByb3BlcnRpZXMuZGlzcG9zZSgpOwoJCQkJY3ViZW1hcHMuZGlzcG9zZSgpOwoJCQkJY3ViZXV2bWFwcy5kaXNwb3NlKCk7CgkJCQlvYmplY3RzLmRpc3Bvc2UoKTsKCQkJCWJpbmRpbmdTdGF0ZXMuZGlzcG9zZSgpOwoJCQkJdW5pZm9ybXNHcm91cHMuZGlzcG9zZSgpOwoJCQkJcHJvZ3JhbUNhY2hlLmRpc3Bvc2UoKTsKCgkJCQl4ci5kaXNwb3NlKCk7CgoJCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKCQkJCXhyLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCgkJCQlhbmltYXRpb24uc3RvcCgpOwoKCQkJfTsKCgkJCS8vIEV2ZW50cwoKCQkJZnVuY3Rpb24gb25Db250ZXh0TG9zdCggZXZlbnQgKSB7CgoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQljb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IENvbnRleHQgTG9zdC4nICk7CgoJCQkJX2lzQ29udGV4dExvc3QgPSB0cnVlOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25Db250ZXh0UmVzdG9yZSggLyogZXZlbnQgKi8gKSB7CgoJCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IFJlc3RvcmVkLicgKTsKCgkJCQlfaXNDb250ZXh0TG9zdCA9IGZhbHNlOwoKCQkJCWNvbnN0IGluZm9BdXRvUmVzZXQgPSBpbmZvLmF1dG9SZXNldDsKCQkJCWNvbnN0IHNoYWRvd01hcEVuYWJsZWQgPSBzaGFkb3dNYXAuZW5hYmxlZDsKCQkJCWNvbnN0IHNoYWRvd01hcEF1dG9VcGRhdGUgPSBzaGFkb3dNYXAuYXV0b1VwZGF0ZTsKCQkJCWNvbnN0IHNoYWRvd01hcE5lZWRzVXBkYXRlID0gc2hhZG93TWFwLm5lZWRzVXBkYXRlOwoJCQkJY29uc3Qgc2hhZG93TWFwVHlwZSA9IHNoYWRvd01hcC50eXBlOwoKCQkJCWluaXRHTENvbnRleHQoKTsKCgkJCQlpbmZvLmF1dG9SZXNldCA9IGluZm9BdXRvUmVzZXQ7CgkJCQlzaGFkb3dNYXAuZW5hYmxlZCA9IHNoYWRvd01hcEVuYWJsZWQ7CgkJCQlzaGFkb3dNYXAuYXV0b1VwZGF0ZSA9IHNoYWRvd01hcEF1dG9VcGRhdGU7CgkJCQlzaGFkb3dNYXAubmVlZHNVcGRhdGUgPSBzaGFkb3dNYXBOZWVkc1VwZGF0ZTsKCQkJCXNoYWRvd01hcC50eXBlID0gc2hhZG93TWFwVHlwZTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG9uQ29udGV4dENyZWF0aW9uRXJyb3IoIGV2ZW50ICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBIFdlYkdMIGNvbnRleHQgY291bGQgbm90IGJlIGNyZWF0ZWQuIFJlYXNvbjogJywgZXZlbnQuc3RhdHVzTWVzc2FnZSApOwoKCQkJfQoKCQkJZnVuY3Rpb24gb25NYXRlcmlhbERpc3Bvc2UoIGV2ZW50ICkgewoKCQkJCWNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwoKCQkJCW1hdGVyaWFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCQlkZWFsbG9jYXRlTWF0ZXJpYWwoIG1hdGVyaWFsICk7CgoJCQl9CgoJCQkvLyBCdWZmZXIgZGVhbGxvY2F0aW9uCgoJCQlmdW5jdGlvbiBkZWFsbG9jYXRlTWF0ZXJpYWwoIG1hdGVyaWFsICkgewoKCQkJCXJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApOwoKCQkJCXByb3BlcnRpZXMucmVtb3ZlKCBtYXRlcmlhbCApOwoKCQkJfQoKCgkJCWZ1bmN0aW9uIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApIHsKCgkJCQljb25zdCBwcm9ncmFtcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLnByb2dyYW1zOwoKCQkJCWlmICggcHJvZ3JhbXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJcHJvZ3JhbXMuZm9yRWFjaCggZnVuY3Rpb24gKCBwcm9ncmFtICkgewoKCQkJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VQcm9ncmFtKCBwcm9ncmFtICk7CgoJCQkJCX0gKTsKCgkJCQkJaWYgKCBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICkgewoKCQkJCQkJcHJvZ3JhbUNhY2hlLnJlbGVhc2VTaGFkZXJDYWNoZSggbWF0ZXJpYWwgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vIEJ1ZmZlciByZW5kZXJpbmcKCgkJCXRoaXMucmVuZGVyQnVmZmVyRGlyZWN0ID0gZnVuY3Rpb24gKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKSB7CgoJCQkJaWYgKCBzY2VuZSA9PT0gbnVsbCApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHJlbmRlckJ1ZmZlckRpcmVjdCBzZWNvbmQgcGFyYW1ldGVyIHVzZWQgdG8gYmUgZm9nIChjb3VsZCBiZSBudWxsKQoKCQkJCWNvbnN0IGZyb250RmFjZUNXID0gKCBvYmplY3QuaXNNZXNoICYmIG9iamVjdC5tYXRyaXhXb3JsZC5kZXRlcm1pbmFudCgpIDwgMCApOwoKCQkJCWNvbnN0IHByb2dyYW0gPSBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApOwoKCQkJCXN0YXRlLnNldE1hdGVyaWFsKCBtYXRlcmlhbCwgZnJvbnRGYWNlQ1cgKTsKCgkJCQkvLwoKCQkJCWxldCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCQkJbGV0IHJhbmdlRmFjdG9yID0gMTsKCgkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJaW5kZXggPSBnZW9tZXRyaWVzLmdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQkJaWYgKCBpbmRleCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkJCQlyYW5nZUZhY3RvciA9IDI7CgoJCQkJfQoKCQkJCS8vCgoJCQkJY29uc3QgZHJhd1JhbmdlID0gZ2VvbWV0cnkuZHJhd1JhbmdlOwoJCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJCWxldCBkcmF3U3RhcnQgPSBkcmF3UmFuZ2Uuc3RhcnQgKiByYW5nZUZhY3RvcjsKCQkJCWxldCBkcmF3RW5kID0gKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSAqIHJhbmdlRmFjdG9yOwoKCQkJCWlmICggZ3JvdXAgIT09IG51bGwgKSB7CgoJCQkJCWRyYXdTdGFydCA9IE1hdGgubWF4KCBkcmF3U3RhcnQsIGdyb3VwLnN0YXJ0ICogcmFuZ2VGYWN0b3IgKTsKCQkJCQlkcmF3RW5kID0gTWF0aC5taW4oIGRyYXdFbmQsICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApICogcmFuZ2VGYWN0b3IgKTsKCgkJCQl9CgoJCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgMCApOwoJCQkJCWRyYXdFbmQgPSBNYXRoLm1pbiggZHJhd0VuZCwgaW5kZXguY291bnQgKTsKCgkJCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICYmIHBvc2l0aW9uICE9PSBudWxsICkgewoKCQkJCQlkcmF3U3RhcnQgPSBNYXRoLm1heCggZHJhd1N0YXJ0LCAwICk7CgkJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCBwb3NpdGlvbi5jb3VudCApOwoKCQkJCX0KCgkJCQljb25zdCBkcmF3Q291bnQgPSBkcmF3RW5kIC0gZHJhd1N0YXJ0OwoKCQkJCWlmICggZHJhd0NvdW50IDwgMCB8fCBkcmF3Q291bnQgPT09IEluZmluaXR5ICkgcmV0dXJuOwoKCQkJCS8vCgoJCQkJYmluZGluZ1N0YXRlcy5zZXR1cCggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnksIGluZGV4ICk7CgoJCQkJbGV0IGF0dHJpYnV0ZTsKCQkJCWxldCByZW5kZXJlciA9IGJ1ZmZlclJlbmRlcmVyOwoKCQkJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQkJCWF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApOwoKCQkJCQlyZW5kZXJlciA9IGluZGV4ZWRCdWZmZXJSZW5kZXJlcjsKCQkJCQlyZW5kZXJlci5zZXRJbmRleCggYXR0cmlidXRlICk7CgoJCQkJfQoKCQkJCS8vCgoJCQkJaWYgKCBvYmplY3QuaXNNZXNoICkgewoKCQkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgkJCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5MSU5FUyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlRSSUFOR0xFUyApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZSApIHsKCgkJCQkJbGV0IGxpbmVXaWR0aCA9IG1hdGVyaWFsLmxpbmV3aWR0aDsKCgkJCQkJaWYgKCBsaW5lV2lkdGggPT09IHVuZGVmaW5lZCApIGxpbmVXaWR0aCA9IDE7IC8vIE5vdCB1c2luZyBMaW5lKk1hdGVyaWFsCgoJCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbGluZVdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgoJCQkJCWlmICggb2JqZWN0LmlzTGluZVNlZ21lbnRzICkgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVTICk7CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpbmVMb29wICkgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfTE9PUCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfU1RSSVAgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1BvaW50cyApIHsKCgkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlBPSU5UUyApOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1Nwcml0ZSApIHsKCgkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlRSSUFOR0xFUyApOwoKCQkJCX0KCgkJCQlpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICkgewoKCQkJCQlpZiAoIG9iamVjdC5fbXVsdGlEcmF3SW5zdGFuY2VzICE9PSBudWxsICkgewoKCQkJCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNzQKCQkJCQkJd2Fybk9uY2UoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiByZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMgaGFzIGJlZW4gZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHIxODQuIEFwcGVuZCB0byByZW5kZXJNdWx0aURyYXcgYXJndW1lbnRzIGFuZCB1c2UgaW5kaXJlY3Rpb24uJyApOwoJCQkJCQlyZW5kZXJlci5yZW5kZXJNdWx0aURyYXdJbnN0YW5jZXMoIG9iamVjdC5fbXVsdGlEcmF3U3RhcnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudCwgb2JqZWN0Ll9tdWx0aURyYXdJbnN0YW5jZXMgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggISBleHRlbnNpb25zLmdldCggJ1dFQkdMX211bHRpX2RyYXcnICkgKSB7CgoJCQkJCQkJY29uc3Qgc3RhcnRzID0gb2JqZWN0Ll9tdWx0aURyYXdTdGFydHM7CgkJCQkJCQljb25zdCBjb3VudHMgPSBvYmplY3QuX211bHRpRHJhd0NvdW50czsKCQkJCQkJCWNvbnN0IGRyYXdDb3VudCA9IG9iamVjdC5fbXVsdGlEcmF3Q291bnQ7CgkJCQkJCQljb25zdCBieXRlc1BlckVsZW1lbnQgPSBpbmRleCA/IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApLmJ5dGVzUGVyRWxlbWVudCA6IDE7CgkJCQkJCQljb25zdCB1bmlmb3JtcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmN1cnJlbnRQcm9ncmFtLmdldFVuaWZvcm1zKCk7CgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkcmF3Q291bnQ7IGkgKysgKSB7CgoJCQkJCQkJCXVuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdfZ2xfRHJhd0lEJywgaSApOwoJCQkJCQkJCXJlbmRlcmVyLnJlbmRlciggc3RhcnRzWyBpIF0gLyBieXRlc1BlckVsZW1lbnQsIGNvdW50c1sgaSBdICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlyZW5kZXJlci5yZW5kZXJNdWx0aURyYXcoIG9iamVjdC5fbXVsdGlEcmF3U3RhcnRzLCBvYmplY3QuX211bHRpRHJhd0NvdW50cywgb2JqZWN0Ll9tdWx0aURyYXdDb3VudCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCApIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVySW5zdGFuY2VzKCBkcmF3U3RhcnQsIGRyYXdDb3VudCwgb2JqZWN0LmNvdW50ICk7CgoJCQkJfSBlbHNlIGlmICggZ2VvbWV0cnkuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSApIHsKCgkJCQkJY29uc3QgbWF4SW5zdGFuY2VDb3VudCA9IGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ICE9PSB1bmRlZmluZWQgPyBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA6IEluZmluaXR5OwoJCQkJCWNvbnN0IGluc3RhbmNlQ291bnQgPSBNYXRoLm1pbiggZ2VvbWV0cnkuaW5zdGFuY2VDb3VudCwgbWF4SW5zdGFuY2VDb3VudCApOwoKCQkJCQlyZW5kZXJlci5yZW5kZXJJbnN0YW5jZXMoIGRyYXdTdGFydCwgZHJhd0NvdW50LCBpbnN0YW5jZUNvdW50ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyZXIucmVuZGVyKCBkcmF3U3RhcnQsIGRyYXdDb3VudCApOwoKCQkJCX0KCgkJCX07CgoJCQkvLyBDb21waWxlCgoJCQlmdW5jdGlvbiBwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICkgewoKCQkJCWlmICggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IHRydWUgJiYgbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSAmJiBtYXRlcmlhbC5mb3JjZVNpbmdsZVBhc3MgPT09IGZhbHNlICkgewoKCQkJCQltYXRlcmlhbC5zaWRlID0gQmFja1NpZGU7CgkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBGcm9udFNpZGU7CgkJCQkJbWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBEb3VibGVTaWRlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJfQoKCQkJfQoKCQkJLyoqCgkJCSAqIENvbXBpbGVzIGFsbCBtYXRlcmlhbHMgaW4gdGhlIHNjZW5lIHdpdGggdGhlIGNhbWVyYS4gVGhpcyBpcyB1c2VmdWwgdG8gcHJlY29tcGlsZSBzaGFkZXJzCgkJCSAqIGJlZm9yZSB0aGUgZmlyc3QgcmVuZGVyaW5nLiBJZiB5b3Ugd2FudCB0byBhZGQgYSAzRCBvYmplY3QgdG8gYW4gZXhpc3Rpbmcgc2NlbmUsIHVzZSB0aGUgdGhpcmQKCQkJICogb3B0aW9uYWwgcGFyYW1ldGVyIGZvciBhcHBseWluZyB0aGUgdGFyZ2V0IHNjZW5lLgoJCQkgKgoJCQkgKiBOb3RlIHRoYXQgdGhlICh0YXJnZXQpIHNjZW5lJ3MgbGlnaHRpbmcgYW5kIGVudmlyb25tZW50IG11c3QgYmUgY29uZmlndXJlZCBiZWZvcmUgY2FsbGluZyB0aGlzIG1ldGhvZC4KCQkJICoKCQkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgb3IgYW5vdGhlciB0eXBlIG9mIDNEIG9iamVjdCB0byBwcmVjb21waWxlLgoJCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkJICogQHBhcmFtIHs/U2NlbmV9IFt0YXJnZXRTY2VuZT1udWxsXSAtIFRoZSB0YXJnZXQgc2NlbmUuCgkJCSAqIEByZXR1cm4ge1NldDxNYXRlcmlhbD59IFRoZSBwcmVjb21waWxlZCBtYXRlcmlhbHMuCgkJCSAqLwoJCQl0aGlzLmNvbXBpbGUgPSBmdW5jdGlvbiAoIHNjZW5lLCBjYW1lcmEsIHRhcmdldFNjZW5lID0gbnVsbCApIHsKCgkJCQlpZiAoIHRhcmdldFNjZW5lID09PSBudWxsICkgdGFyZ2V0U2NlbmUgPSBzY2VuZTsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCB0YXJnZXRTY2VuZSApOwoJCQkJY3VycmVudFJlbmRlclN0YXRlLmluaXQoIGNhbWVyYSApOwoKCQkJCXJlbmRlclN0YXRlU3RhY2sucHVzaCggY3VycmVudFJlbmRlclN0YXRlICk7CgoJCQkJLy8gZ2F0aGVyIGxpZ2h0cyBmcm9tIGJvdGggdGhlIHRhcmdldCBzY2VuZSBhbmQgdGhlIG5ldyBvYmplY3QgdGhhdCB3aWxsIGJlIGFkZGVkIHRvIHRoZSBzY2VuZS4KCgkJCQl0YXJnZXRTY2VuZS50cmF2ZXJzZVZpc2libGUoIGZ1bmN0aW9uICggb2JqZWN0ICkgewoKCQkJCQlpZiAoIG9iamVjdC5pc0xpZ2h0ICYmIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgoJCQkJCQlpZiAoIG9iamVjdC5jYXN0U2hhZG93ICkgewoKCQkJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoU2hhZG93KCBvYmplY3QgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gKTsKCgkJCQlpZiAoIHNjZW5lICE9PSB0YXJnZXRTY2VuZSApIHsKCgkJCQkJc2NlbmUudHJhdmVyc2VWaXNpYmxlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQkJCWlmICggb2JqZWN0LmlzTGlnaHQgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgoJCQkJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyApIHsKCgkJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfSApOwoKCQkJCX0KCgkJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoKTsKCgkJCQkvLyBPbmx5IGluaXRpYWxpemUgbWF0ZXJpYWxzIGluIHRoZSBuZXcgc2NlbmUsIG5vdCB0aGUgdGFyZ2V0U2NlbmUuCgoJCQkJY29uc3QgbWF0ZXJpYWxzID0gbmV3IFNldCgpOwoKCQkJCXNjZW5lLnRyYXZlcnNlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQkJaWYgKCAhICggb2JqZWN0LmlzTWVzaCB8fCBvYmplY3QuaXNQb2ludHMgfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNTcHJpdGUgKSApIHsKCgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJaWYgKCBtYXRlcmlhbCApIHsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXRlcmlhbC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQkJCWNvbnN0IG1hdGVyaWFsMiA9IG1hdGVyaWFsWyBpIF07CgoJCQkJCQkJCXByZXBhcmVNYXRlcmlhbCggbWF0ZXJpYWwyLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CgkJCQkJCQkJbWF0ZXJpYWxzLmFkZCggbWF0ZXJpYWwyICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlwcmVwYXJlTWF0ZXJpYWwoIG1hdGVyaWFsLCB0YXJnZXRTY2VuZSwgb2JqZWN0ICk7CgkJCQkJCQltYXRlcmlhbHMuYWRkKCBtYXRlcmlhbCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSApOwoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2sucG9wKCk7CgoJCQkJcmV0dXJuIG1hdGVyaWFsczsKCgkJCX07CgoJCQkvLyBjb21waWxlQXN5bmMKCgkJCS8qKgoJCQkgKiBBc3luY2hyb25vdXMgdmVyc2lvbiBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNjb21waWxlfS4KCQkJICoKCQkJICogVGhpcyBtZXRob2QgbWFrZXMgdXNlIG9mIHRoZSBgS0hSX3BhcmFsbGVsX3NoYWRlcl9jb21waWxlYCBXZWJHTCBleHRlbnNpb24uIEhlbmNlLAoJCQkgKiBpdCBpcyByZWNvbW1lbmRlZCB0byB1c2UgdGhpcyB2ZXJzaW9uIG9mIGBjb21waWxlKClgIHdoZW5ldmVyIHBvc3NpYmxlLgoJCQkgKgoJCQkgKiBAYXN5bmMKCQkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgb3IgYW5vdGhlciB0eXBlIG9mIDNEIG9iamVjdCB0byBwcmVjb21waWxlLgoJCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkJICogQHBhcmFtIHs/U2NlbmV9IFt0YXJnZXRTY2VuZT1udWxsXSAtIFRoZSB0YXJnZXQgc2NlbmUuCgkJCSAqIEByZXR1cm4ge1Byb21pc2V9IEEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIGdpdmVuIHNjZW5lIGNhbiBiZSByZW5kZXJlZCB3aXRob3V0IHVubmVjZXNzYXJ5IHN0YWxsaW5nIGR1ZSB0byBzaGFkZXIgY29tcGlsYXRpb24uCgkJCSAqLwoJCQl0aGlzLmNvbXBpbGVBc3luYyA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgPSBudWxsICkgewoKCQkJCWNvbnN0IG1hdGVyaWFscyA9IHRoaXMuY29tcGlsZSggc2NlbmUsIGNhbWVyYSwgdGFyZ2V0U2NlbmUgKTsKCgkJCQkvLyBXYWl0IGZvciBhbGwgdGhlIG1hdGVyaWFscyBpbiB0aGUgbmV3IG9iamVjdCB0byBpbmRpY2F0ZSB0aGF0IHRoZXkncmUKCQkJCS8vIHJlYWR5IHRvIGJlIHVzZWQgYmVmb3JlIHJlc29sdmluZyB0aGUgcHJvbWlzZS4KCgkJCQlyZXR1cm4gbmV3IFByb21pc2UoICggcmVzb2x2ZSApID0+IHsKCgkJCQkJZnVuY3Rpb24gY2hlY2tNYXRlcmlhbHNSZWFkeSgpIHsKCgkJCQkJCW1hdGVyaWFscy5mb3JFYWNoKCBmdW5jdGlvbiAoIG1hdGVyaWFsICkgewoKCQkJCQkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoJCQkJCQkJY29uc3QgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCgkJCQkJCQlpZiAoIHByb2dyYW0uaXNSZWFkeSgpICkgewoKCQkJCQkJCQkvLyByZW1vdmUgYW55IHByb2dyYW1zIHRoYXQgcmVwb3J0IHRoZXkncmUgcmVhZHkgdG8gdXNlIGZyb20gdGhlIGxpc3QKCQkJCQkJCQltYXRlcmlhbHMuZGVsZXRlKCBtYXRlcmlhbCApOwoKCQkJCQkJCX0KCgkJCQkJCX0gKTsKCgkJCQkJCS8vIG9uY2UgdGhlIGxpc3Qgb2YgY29tcGlsaW5nIG1hdGVyaWFscyBpcyBlbXB0eSwgY2FsbCB0aGUgY2FsbGJhY2sKCgkJCQkJCWlmICggbWF0ZXJpYWxzLnNpemUgPT09IDAgKSB7CgoJCQkJCQkJcmVzb2x2ZSggc2NlbmUgKTsKCQkJCQkJCXJldHVybjsKCgkJCQkJCX0KCgkJCQkJCS8vIGlmIHNvbWUgbWF0ZXJpYWxzIGFyZSBzdGlsbCBub3QgcmVhZHksIHdhaXQgYSBiaXQgYW5kIGNoZWNrIGFnYWluCgoJCQkJCQlzZXRUaW1lb3V0KCBjaGVja01hdGVyaWFsc1JlYWR5LCAxMCApOwoKCQkJCQl9CgoJCQkJCWlmICggZXh0ZW5zaW9ucy5nZXQoICdLSFJfcGFyYWxsZWxfc2hhZGVyX2NvbXBpbGUnICkgIT09IG51bGwgKSB7CgoJCQkJCQkvLyBJZiB3ZSBjYW4gY2hlY2sgdGhlIGNvbXBpbGF0aW9uIHN0YXR1cyBvZiB0aGUgbWF0ZXJpYWxzIHdpdGhvdXQKCQkJCQkJLy8gYmxvY2tpbmcgdGhlbiBkbyBzbyByaWdodCBhd2F5LgoKCQkJCQkJY2hlY2tNYXRlcmlhbHNSZWFkeSgpOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJLy8gT3RoZXJ3aXNlIHN0YXJ0IGJ5IHdhaXRpbmcgYSBiaXQgdG8gZ2l2ZSB0aGUgbWF0ZXJpYWxzIHdlIGp1c3QKCQkJCQkJLy8gaW5pdGlhbGl6ZWQgYSBjaGFuY2UgdG8gZmluaXNoLgoKCQkJCQkJc2V0VGltZW91dCggY2hlY2tNYXRlcmlhbHNSZWFkeSwgMTAgKTsKCgkJCQkJfQoKCQkJCX0gKTsKCgkJCX07CgoJCQkvLyBBbmltYXRpb24gTG9vcAoKCQkJbGV0IG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IG51bGw7CgoJCQlmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lICkgewoKCQkJCWlmICggb25BbmltYXRpb25GcmFtZUNhbGxiYWNrICkgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKCB0aW1lICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvblhSU2Vzc2lvblN0YXJ0KCkgewoKCQkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCQl9CgoJCQlmdW5jdGlvbiBvblhSU2Vzc2lvbkVuZCgpIHsKCgkJCQlhbmltYXRpb24uc3RhcnQoKTsKCgkJCX0KCgkJCWNvbnN0IGFuaW1hdGlvbiA9IG5ldyBXZWJHTEFuaW1hdGlvbigpOwoJCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKCQkJaWYgKCB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgKSBhbmltYXRpb24uc2V0Q29udGV4dCggc2VsZiApOwoKCQkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCQkJCXhyLnNldEFuaW1hdGlvbkxvb3AoIGNhbGxiYWNrICk7CgoJCQkJKCBjYWxsYmFjayA9PT0gbnVsbCApID8gYW5pbWF0aW9uLnN0b3AoKSA6IGFuaW1hdGlvbi5zdGFydCgpOwoKCQkJfTsKCgkJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uc3RhcnQnLCBvblhSU2Vzc2lvblN0YXJ0ICk7CgkJCXhyLmFkZEV2ZW50TGlzdGVuZXIoICdzZXNzaW9uZW5kJywgb25YUlNlc3Npb25FbmQgKTsKCgkJCS8vIFJlbmRlcmluZwoKCQkJLyoqCgkJCSAqIFJlbmRlcnMgdGhlIGdpdmVuIHNjZW5lIChvciBvdGhlciB0eXBlIG9mIDNEIG9iamVjdCkgdXNpbmcgdGhlIGdpdmVuIGNhbWVyYS4KCQkJICoKCQkJICogVGhlIHJlbmRlciBpcyBkb25lIHRvIGEgcHJldmlvdXNseSBzcGVjaWZpZWQgcmVuZGVyIHRhcmdldCBzZXQgYnkgY2FsbGluZyB7QGxpbmsgV2ViR0xSZW5kZXJlciNzZXRSZW5kZXJUYXJnZXR9CgkJCSAqIG9yIHRvIHRoZSBjYW52YXMgYXMgdXN1YWwuCgkJCSAqCgkJCSAqIEJ5IGRlZmF1bHQgcmVuZGVyIGJ1ZmZlcnMgYXJlIGNsZWFyZWQgYmVmb3JlIHJlbmRlcmluZyBidXQgeW91IGNhbiBwcmV2ZW50CgkJCSAqIHRoaXMgYnkgc2V0dGluZyB0aGUgcHJvcGVydHkgYGF1dG9DbGVhcmAgdG8gYGZhbHNlYC4gSWYgeW91IHdhbnQgdG8gcHJldmVudAoJCQkgKiBvbmx5IGNlcnRhaW4gYnVmZmVycyBiZWluZyBjbGVhcmVkIHlvdSBjYW4gYGF1dG9DbGVhckNvbG9yYCwgYGF1dG9DbGVhckRlcHRoYAoJCQkgKiBvciBgYXV0b0NsZWFyU3RlbmNpbGAgdG8gYGZhbHNlYC4gVG8gZm9yY2UgYSBjbGVhciwgdXNlIHtAbGluayBXZWJHTFJlbmRlcmVyI2NsZWFyfS4KCQkJICoKCQkJICogQHBhcmFtIHtPYmplY3QzRH0gc2NlbmUgLSBUaGUgc2NlbmUgdG8gcmVuZGVyLgoJCQkgKiBAcGFyYW0ge0NhbWVyYX0gY2FtZXJhIC0gVGhlIGNhbWVyYS4KCQkJICovCgkJCXRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCWlmICggY2FtZXJhICE9PSB1bmRlZmluZWQgJiYgY2FtZXJhLmlzQ2FtZXJhICE9PSB0cnVlICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZW5kZXI6IGNhbWVyYSBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuQ2FtZXJhLicgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCWlmICggX2lzQ29udGV4dExvc3QgPT09IHRydWUgKSByZXR1cm47CgoJCQkJLy8gdXBkYXRlIHNjZW5lIGdyYXBoCgoJCQkJaWYgKCBzY2VuZS5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJCS8vIHVwZGF0ZSBjYW1lcmEgbWF0cmljZXMgYW5kIGZydXN0dW0KCgkJCQlpZiAoIGNhbWVyYS5wYXJlbnQgPT09IG51bGwgJiYgY2FtZXJhLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgoJCQkJCWlmICggeHIuY2FtZXJhQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHhyLnVwZGF0ZUNhbWVyYSggY2FtZXJhICk7CgoJCQkJCWNhbWVyYSA9IHhyLmdldENhbWVyYSgpOyAvLyB1c2UgWFIgY2FtZXJhIGZvciByZW5kZXJpbmcKCgkJCQl9CgoJCQkJLy8KCQkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggKTsKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5pbml0KCBjYW1lcmEgKTsKCgkJCQlyZW5kZXJTdGF0ZVN0YWNrLnB1c2goIGN1cnJlbnRSZW5kZXJTdGF0ZSApOwoKCQkJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJCQlfZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQlfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSB0aGlzLmxvY2FsQ2xpcHBpbmdFbmFibGVkOwoJCQkJX2NsaXBwaW5nRW5hYmxlZCA9IGNsaXBwaW5nLmluaXQoIHRoaXMuY2xpcHBpbmdQbGFuZXMsIF9sb2NhbENsaXBwaW5nRW5hYmxlZCApOwoKCQkJCWN1cnJlbnRSZW5kZXJMaXN0ID0gcmVuZGVyTGlzdHMuZ2V0KCBzY2VuZSwgcmVuZGVyTGlzdFN0YWNrLmxlbmd0aCApOwoJCQkJY3VycmVudFJlbmRlckxpc3QuaW5pdCgpOwoKCQkJCXJlbmRlckxpc3RTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyTGlzdCApOwoKCQkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgoJCQkJCWNvbnN0IGRlcHRoU2Vuc2luZ01lc2ggPSBfdGhpcy54ci5nZXREZXB0aFNlbnNpbmdNZXNoKCk7CgoJCQkJCWlmICggZGVwdGhTZW5zaW5nTWVzaCAhPT0gbnVsbCApIHsKCgkJCQkJCXByb2plY3RPYmplY3QoIGRlcHRoU2Vuc2luZ01lc2gsIGNhbWVyYSwgLSBJbmZpbml0eSwgX3RoaXMuc29ydE9iamVjdHMgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlwcm9qZWN0T2JqZWN0KCBzY2VuZSwgY2FtZXJhLCAwLCBfdGhpcy5zb3J0T2JqZWN0cyApOwoKCQkJCWN1cnJlbnRSZW5kZXJMaXN0LmZpbmlzaCgpOwoKCQkJCWlmICggX3RoaXMuc29ydE9iamVjdHMgPT09IHRydWUgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnNvcnQoIF9vcGFxdWVTb3J0LCBfdHJhbnNwYXJlbnRTb3J0ICk7CgoJCQkJfQoKCQkJCV9yZW5kZXJCYWNrZ3JvdW5kID0geHIuZW5hYmxlZCA9PT0gZmFsc2UgfHwgeHIuaXNQcmVzZW50aW5nID09PSBmYWxzZSB8fCB4ci5oYXNEZXB0aFNlbnNpbmcoKSA9PT0gZmFsc2U7CgkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgewoKCQkJCQliYWNrZ3JvdW5kLmFkZFRvUmVuZGVyTGlzdCggY3VycmVudFJlbmRlckxpc3QsIHNjZW5lICk7CgoJCQkJfQoKCQkJCS8vCgoJCQkJdGhpcy5pbmZvLnJlbmRlci5mcmFtZSArKzsKCgkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5iZWdpblNoYWRvd3MoKTsKCgkJCQljb25zdCBzaGFkb3dzQXJyYXkgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUuc2hhZG93c0FycmF5OwoKCQkJCXNoYWRvd01hcC5yZW5kZXIoIHNoYWRvd3NBcnJheSwgc2NlbmUsIGNhbWVyYSApOwoKCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLmVuZFNoYWRvd3MoKTsKCgkJCQkvLwoKCQkJCWlmICggdGhpcy5pbmZvLmF1dG9SZXNldCA9PT0gdHJ1ZSApIHRoaXMuaW5mby5yZXNldCgpOwoKCQkJCS8vIHJlbmRlciBzY2VuZQoKCQkJCWNvbnN0IG9wYXF1ZU9iamVjdHMgPSBjdXJyZW50UmVuZGVyTGlzdC5vcGFxdWU7CgkJCQljb25zdCB0cmFuc21pc3NpdmVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNtaXNzaXZlOwoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0cygpOwoKCQkJCWlmICggY2FtZXJhLmlzQXJyYXlDYW1lcmEgKSB7CgoJCQkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmEuY2FtZXJhczsKCgkJCQkJaWYgKCB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aCA+IDAgKSB7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjYW1lcmFzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJCQlyZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhMiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWlmICggX3JlbmRlckJhY2tncm91bmQgKSBiYWNrZ3JvdW5kLnJlbmRlciggc2NlbmUgKTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2FtZXJhcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJY29uc3QgY2FtZXJhMiA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYTIsIGNhbWVyYTIudmlld3BvcnQgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyVHJhbnNtaXNzaW9uUGFzcyggb3BhcXVlT2JqZWN0cywgdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgYmFja2dyb3VuZC5yZW5kZXIoIHNjZW5lICk7CgoJCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApOwoKCQkJCX0KCgkJCQkvLwoKCQkJCWlmICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgIT09IG51bGwgJiYgX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9PT0gMCApIHsKCgkJCQkJLy8gcmVzb2x2ZSBtdWx0aXNhbXBsZSByZW5kZXJidWZmZXJzIHRvIGEgc2luZ2xlLXNhbXBsZSB0ZXh0dXJlIGlmIG5lY2Vzc2FyeQoKCQkJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgkJCQkJLy8gR2VuZXJhdGUgbWlwbWFwIGlmIHdlJ3JlIHVzaW5nIGFueSBraW5kIG9mIG1pcG1hcCBmaWx0ZXJpbmcKCgkJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKCQkJCX0KCgkJCQkvLwoKCQkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhICk7CgoJCQkJLy8gX2dsLmZpbmlzaCgpOwoKCQkJCWJpbmRpbmdTdGF0ZXMucmVzZXREZWZhdWx0U3RhdGUoKTsKCQkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0xOwoJCQkJX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKCQkJCXJlbmRlclN0YXRlU3RhY2sucG9wKCk7CgoJCQkJaWYgKCByZW5kZXJTdGF0ZVN0YWNrLmxlbmd0aCA+IDAgKSB7CgoJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2tbIHJlbmRlclN0YXRlU3RhY2subGVuZ3RoIC0gMSBdOwoKCQkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5zZXRHbG9iYWxTdGF0ZSggX3RoaXMuY2xpcHBpbmdQbGFuZXMsIGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5jYW1lcmEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkJCX0KCgkJCQlyZW5kZXJMaXN0U3RhY2sucG9wKCk7CgoJCQkJaWYgKCByZW5kZXJMaXN0U3RhY2subGVuZ3RoID4gMCApIHsKCgkJCQkJY3VycmVudFJlbmRlckxpc3QgPSByZW5kZXJMaXN0U3RhY2tbIHJlbmRlckxpc3RTdGFjay5sZW5ndGggLSAxIF07CgoJCQkJfSBlbHNlIHsKCgkJCQkJY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwoKCQkJCX0KCgkJCX07CgoJCQlmdW5jdGlvbiBwcm9qZWN0T2JqZWN0KCBvYmplY3QsIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMgKSB7CgoJCQkJaWYgKCBvYmplY3QudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJY29uc3QgdmlzaWJsZSA9IG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApOwoKCQkJCWlmICggdmlzaWJsZSApIHsKCgkJCQkJaWYgKCBvYmplY3QuaXNHcm91cCApIHsKCgkJCQkJCWdyb3VwT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xPRCApIHsKCgkJCQkJCWlmICggb2JqZWN0LmF1dG9VcGRhdGUgPT09IHRydWUgKSBvYmplY3QudXBkYXRlKCBjYW1lcmEgKTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGlnaHQgKSB7CgoJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KCBvYmplY3QgKTsKCgkJCQkJCWlmICggb2JqZWN0LmNhc3RTaGFkb3cgKSB7CgoJCQkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hTaGFkb3coIG9iamVjdCApOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTcHJpdGUgKSB7CgoJCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c1Nwcml0ZSggb2JqZWN0ICkgKSB7CgoJCQkJCQkJaWYgKCBzb3J0T2JqZWN0cyApIHsKCgkJCQkJCQkJX3ZlY3RvcjQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBvYmplY3QubWF0cml4V29ybGQgKQoJCQkJCQkJCQkuYXBwbHlNYXRyaXg0KCBfcHJvalNjcmVlbk1hdHJpeCApOwoKCQkJCQkJCX0KCgkJCQkJCQljb25zdCBnZW9tZXRyeSA9IG9iamVjdHMudXBkYXRlKCBvYmplY3QgKTsKCQkJCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKCQkJCQkJCWlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQkJY3VycmVudFJlbmRlckxpc3QucHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3I0LnosIG51bGwgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSB7CgoJCQkJCQlpZiAoICEgb2JqZWN0LmZydXN0dW1DdWxsZWQgfHwgX2ZydXN0dW0uaW50ZXJzZWN0c09iamVjdCggb2JqZWN0ICkgKSB7CgoJCQkJCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CgkJCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJCQlpZiAoIHNvcnRPYmplY3RzICkgewoKCQkJCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQkJaWYgKCBvYmplY3QuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBvYmplY3QuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgkJCQkJCQkJCV92ZWN0b3I0LmNvcHkoIG9iamVjdC5ib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCQkJCQkJCQkJX3ZlY3RvcjQuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUuY2VudGVyICk7CgoJCQkJCQkJCX0KCgkJCQkJCQkJX3ZlY3RvcjQKCQkJCQkJCQkJLmFwcGx5TWF0cml4NCggb2JqZWN0Lm1hdHJpeFdvcmxkICkKCQkJCQkJCQkJLmFwcGx5TWF0cml4NCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBBcnJheS5pc0FycmF5KCBtYXRlcmlhbCApICkgewoKCQkJCQkJCQljb25zdCBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQkJCQlpZiAoIGdyb3VwTWF0ZXJpYWwgJiYgZ3JvdXBNYXRlcmlhbC52aXNpYmxlICkgewoKCQkJCQkJCQkJCWN1cnJlbnRSZW5kZXJMaXN0LnB1c2goIG9iamVjdCwgZ2VvbWV0cnksIGdyb3VwTWF0ZXJpYWwsIGdyb3VwT3JkZXIsIF92ZWN0b3I0LnosIGdyb3VwICk7CgoJCQkJCQkJCQl9CgoJCQkJCQkJCX0KCgkJCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC52aXNpYmxlICkgewoKCQkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjQueiwgbnVsbCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQlwcm9qZWN0T2JqZWN0KCBjaGlsZHJlblsgaSBdLCBjYW1lcmEsIGdyb3VwT3JkZXIsIHNvcnRPYmplY3RzICk7CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gcmVuZGVyU2NlbmUoIGN1cnJlbnRSZW5kZXJMaXN0LCBzY2VuZSwgY2FtZXJhLCB2aWV3cG9ydCApIHsKCgkJCQljb25zdCBvcGFxdWVPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3Qub3BhcXVlOwoJCQkJY29uc3QgdHJhbnNtaXNzaXZlT2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zbWlzc2l2ZTsKCQkJCWNvbnN0IHRyYW5zcGFyZW50T2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zcGFyZW50OwoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5zZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApOwoKCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLnNldEdsb2JhbFN0YXRlKCBfdGhpcy5jbGlwcGluZ1BsYW5lcywgY2FtZXJhICk7CgoJCQkJaWYgKCB2aWV3cG9ydCApIHN0YXRlLnZpZXdwb3J0KCBfY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICkgKTsKCgkJCQlpZiAoIG9wYXF1ZU9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCQkJCWlmICggdHJhbnNtaXNzaXZlT2JqZWN0cy5sZW5ndGggPiAwICkgcmVuZGVyT2JqZWN0cyggdHJhbnNtaXNzaXZlT2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoJCQkJaWYgKCB0cmFuc3BhcmVudE9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIHRyYW5zcGFyZW50T2JqZWN0cywgc2NlbmUsIGNhbWVyYSApOwoKCQkJCS8vIEVuc3VyZSBkZXB0aCBidWZmZXIgd3JpdGluZyBpcyBlbmFibGVkIHNvIGl0IGNhbiBiZSBjbGVhcmVkIG9uIG5leHQgcmVuZGVyCgoJCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRUZXN0KCB0cnVlICk7CgkJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldE1hc2soIHRydWUgKTsKCQkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0TWFzayggdHJ1ZSApOwoKCQkJCXN0YXRlLnNldFBvbHlnb25PZmZzZXQoIGZhbHNlICk7CgoJCQl9CgoJCQlmdW5jdGlvbiByZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCWNvbnN0IG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA6IG51bGw7CgoJCQkJaWYgKCBvdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgewoKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCWlmICggY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoIDEsIDEsIHsKCQkJCQkJZ2VuZXJhdGVNaXBtYXBzOiB0cnVlLAoJCQkJCQl0eXBlOiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKSApID8gSGFsZkZsb2F0VHlwZSA6IFVuc2lnbmVkQnl0ZVR5cGUsCgkJCQkJCW1pbkZpbHRlcjogTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyLAoJCQkJCQlzYW1wbGVzOiA0LAoJCQkJCQlzdGVuY2lsQnVmZmVyOiBzdGVuY2lsLAoJCQkJCQlyZXNvbHZlRGVwdGhCdWZmZXI6IGZhbHNlLAoJCQkJCQlyZXNvbHZlU3RlbmNpbEJ1ZmZlcjogZmFsc2UsCgkJCQkJCWNvbG9yU3BhY2U6IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSwKCQkJCQl9ICk7CgoJCQkJCS8vIGRlYnVnCgoJCQkJCS8qCgkJCQkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeSgpOwoJCQkJCWNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IG1hcDogX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldC50ZXh0dXJlIH0gKTsKCgkJCQkJY29uc3QgbWVzaCA9IG5ldyBNZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCQkJCQlzY2VuZS5hZGQoIG1lc2ggKTsKCQkJCQkqLwoKCQkJCX0KCgkJCQljb25zdCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUudHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0WyBjYW1lcmEuaWQgXTsKCgkJCQljb25zdCBhY3RpdmVWaWV3cG9ydCA9IGNhbWVyYS52aWV3cG9ydCB8fCBfY3VycmVudFZpZXdwb3J0OwoJCQkJdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnNldFNpemUoIGFjdGl2ZVZpZXdwb3J0LnogKiBfdGhpcy50cmFuc21pc3Npb25SZXNvbHV0aW9uU2NhbGUsIGFjdGl2ZVZpZXdwb3J0LncgKiBfdGhpcy50cmFuc21pc3Npb25SZXNvbHV0aW9uU2NhbGUgKTsKCgkJCQkvLwoKCQkJCWNvbnN0IGN1cnJlbnRSZW5kZXJUYXJnZXQgPSBfdGhpcy5nZXRSZW5kZXJUYXJnZXQoKTsKCQkJCWNvbnN0IGN1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IF90aGlzLmdldEFjdGl2ZUN1YmVGYWNlKCk7CgkJCQljb25zdCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSBfdGhpcy5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQkJCV90aGlzLnNldFJlbmRlclRhcmdldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQkJX3RoaXMuZ2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yICk7CgkJCQlfY3VycmVudENsZWFyQWxwaGEgPSBfdGhpcy5nZXRDbGVhckFscGhhKCk7CgkJCQlpZiAoIF9jdXJyZW50Q2xlYXJBbHBoYSA8IDEgKSBfdGhpcy5zZXRDbGVhckNvbG9yKCAweGZmZmZmZiwgMC41ICk7CgoJCQkJX3RoaXMuY2xlYXIoKTsKCgkJCQlpZiAoIF9yZW5kZXJCYWNrZ3JvdW5kICkgYmFja2dyb3VuZC5yZW5kZXIoIHNjZW5lICk7CgoJCQkJLy8gVHVybiBvZmYgdGhlIGZlYXR1cmVzIHdoaWNoIGNhbiBhZmZlY3QgdGhlIGZyYWcgY29sb3IgZm9yIG9wYXF1ZSBvYmplY3RzIHBhc3MuCgkJCQkvLyBPdGhlcndpc2UgdGhleSBhcmUgYXBwbGllZCB0d2ljZSBpbiBvcGFxdWUgb2JqZWN0cyBwYXNzIGFuZCB0cmFuc21pc3Npb24gb2JqZWN0cyBwYXNzLgoJCQkJY29uc3QgY3VycmVudFRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CgkJCQlfdGhpcy50b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQkJLy8gUmVtb3ZlIHZpZXdwb3J0IGZyb20gY2FtZXJhIHRvIGF2b2lkIG5lc3RlZCByZW5kZXIgY2FsbHMgcmVzZXR0aW5nIHZpZXdwb3J0IHRvIGl0IChlLmcgUmVmbGVjdG9yKS4KCQkJCS8vIFRyYW5zbWlzc2lvbiByZW5kZXIgcGFzcyByZXF1aXJlcyB2aWV3cG9ydCB0byBtYXRjaCB0aGUgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LgoJCQkJY29uc3QgY3VycmVudENhbWVyYVZpZXdwb3J0ID0gY2FtZXJhLnZpZXdwb3J0OwoJCQkJaWYgKCBjYW1lcmEudmlld3BvcnQgIT09IHVuZGVmaW5lZCApIGNhbWVyYS52aWV3cG9ydCA9IHVuZGVmaW5lZDsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKTsKCgkJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5zZXRHbG9iYWxTdGF0ZSggX3RoaXMuY2xpcHBpbmdQbGFuZXMsIGNhbWVyYSApOwoKCQkJCXJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCQl0ZXh0dXJlcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgkJCQl0ZXh0dXJlcy51cGRhdGVSZW5kZXJUYXJnZXRNaXBtYXAoIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKCQkJCWlmICggZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgPT09IGZhbHNlICkgeyAvLyBzZWUgIzI4MTMxCgoJCQkJCWxldCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQljb25zdCByZW5kZXJJdGVtID0gdHJhbnNtaXNzaXZlT2JqZWN0c1sgaSBdOwoKCQkJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQkJCWNvbnN0IGdlb21ldHJ5ID0gcmVuZGVySXRlbS5nZW9tZXRyeTsKCQkJCQkJY29uc3QgbWF0ZXJpYWwgPSByZW5kZXJJdGVtLm1hdGVyaWFsOwoJCQkJCQljb25zdCBncm91cCA9IHJlbmRlckl0ZW0uZ3JvdXA7CgoJCQkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCQkJY29uc3QgY3VycmVudFNpZGUgPSBtYXRlcmlhbC5zaWRlOwoKCQkJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJCQlyZW5kZXJPYmplY3QoIG9iamVjdCwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKCQkJCQkJCW1hdGVyaWFsLnNpZGUgPSBjdXJyZW50U2lkZTsKCQkJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJCQlyZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJaWYgKCByZW5kZXJUYXJnZXROZWVkc1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCQkJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlfdGhpcy5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQsIGN1cnJlbnRBY3RpdmVDdWJlRmFjZSwgY3VycmVudEFjdGl2ZU1pcG1hcExldmVsICk7CgoJCQkJX3RoaXMuc2V0Q2xlYXJDb2xvciggX2N1cnJlbnRDbGVhckNvbG9yLCBfY3VycmVudENsZWFyQWxwaGEgKTsKCgkJCQlpZiAoIGN1cnJlbnRDYW1lcmFWaWV3cG9ydCAhPT0gdW5kZWZpbmVkICkgY2FtZXJhLnZpZXdwb3J0ID0gY3VycmVudENhbWVyYVZpZXdwb3J0OwoKCQkJCV90aGlzLnRvbmVNYXBwaW5nID0gY3VycmVudFRvbmVNYXBwaW5nOwoKCQkJfQoKCQkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0cyggcmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApIHsKCgkJCQljb25zdCBvdmVycmlkZU1hdGVyaWFsID0gc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSA/IHNjZW5lLm92ZXJyaWRlTWF0ZXJpYWwgOiBudWxsOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHJlbmRlckxpc3QubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckxpc3RbIGkgXTsKCgkJCQkJY29uc3Qgb2JqZWN0ID0gcmVuZGVySXRlbS5vYmplY3Q7CgkJCQkJY29uc3QgZ2VvbWV0cnkgPSByZW5kZXJJdGVtLmdlb21ldHJ5OwoJCQkJCWNvbnN0IGdyb3VwID0gcmVuZGVySXRlbS5ncm91cDsKCQkJCQlsZXQgbWF0ZXJpYWwgPSByZW5kZXJJdGVtLm1hdGVyaWFsOwoKCQkJCQlpZiAoIG1hdGVyaWFsLmFsbG93T3ZlcnJpZGUgPT09IHRydWUgJiYgb3ZlcnJpZGVNYXRlcmlhbCAhPT0gbnVsbCApIHsKCgkJCQkJCW1hdGVyaWFsID0gb3ZlcnJpZGVNYXRlcmlhbDsKCgkJCQkJfQoKCQkJCQlpZiAoIG9iamVjdC5sYXllcnMudGVzdCggY2FtZXJhLmxheWVycyApICkgewoKCQkJCQkJcmVuZGVyT2JqZWN0KCBvYmplY3QsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICkgewoKCQkJCW9iamVjdC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJCQlvYmplY3QubW9kZWxWaWV3TWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoJCQkJb2JqZWN0Lm5vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIG9iamVjdC5tb2RlbFZpZXdNYXRyaXggKTsKCgkJCQltYXRlcmlhbC5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICk7CgoJCQkJaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlICYmIG1hdGVyaWFsLmZvcmNlU2luZ2xlUGFzcyA9PT0gZmFsc2UgKSB7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX3RoaXMucmVuZGVyQnVmZmVyRGlyZWN0KCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQl9CgoJCQkJb2JqZWN0Lm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApIHsKCgkJCQlpZiAoIHNjZW5lLmlzU2NlbmUgIT09IHRydWUgKSBzY2VuZSA9IF9lbXB0eVNjZW5lOyAvLyBzY2VuZSBjb3VsZCBiZSBhIE1lc2gsIExpbmUsIFBvaW50cywgLi4uCgoJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgoJCQkJY29uc3QgbGlnaHRzID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLmxpZ2h0czsKCQkJCWNvbnN0IHNoYWRvd3NBcnJheSA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5zaGFkb3dzQXJyYXk7CgoJCQkJY29uc3QgbGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzLnN0YXRlLnZlcnNpb247CgoJCQkJY29uc3QgcGFyYW1ldGVycyA9IHByb2dyYW1DYWNoZS5nZXRQYXJhbWV0ZXJzKCBtYXRlcmlhbCwgbGlnaHRzLnN0YXRlLCBzaGFkb3dzQXJyYXksIHNjZW5lLCBvYmplY3QgKTsKCQkJCWNvbnN0IHByb2dyYW1DYWNoZUtleSA9IHByb2dyYW1DYWNoZS5nZXRQcm9ncmFtQ2FjaGVLZXkoIHBhcmFtZXRlcnMgKTsKCgkJCQlsZXQgcHJvZ3JhbXMgPSBtYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbXM7CgoJCQkJLy8gYWx3YXlzIHVwZGF0ZSBlbnZpcm9ubWVudCBhbmQgZm9nIC0gY2hhbmdpbmcgdGhlc2UgdHJpZ2dlciBhbiBnZXRQcm9ncmFtIGNhbGwsIGJ1dCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHByb2dyYW0gZG9lc24ndCBjaGFuZ2UKCgkJCQltYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyA9IHNjZW5lLmZvZzsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBtYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgKTsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXBSb3RhdGlvbiA9ICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmVudmlyb25tZW50ICE9PSBudWxsICYmIG1hdGVyaWFsLmVudk1hcCA9PT0gbnVsbCApID8gc2NlbmUuZW52aXJvbm1lbnRSb3RhdGlvbiA6IG1hdGVyaWFsLmVudk1hcFJvdGF0aW9uOwoKCQkJCWlmICggcHJvZ3JhbXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gbmV3IG1hdGVyaWFsCgoJCQkJCW1hdGVyaWFsLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25NYXRlcmlhbERpc3Bvc2UgKTsKCgkJCQkJcHJvZ3JhbXMgPSBuZXcgTWFwKCk7CgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW1zID0gcHJvZ3JhbXM7CgoJCQkJfQoKCQkJCWxldCBwcm9ncmFtID0gcHJvZ3JhbXMuZ2V0KCBwcm9ncmFtQ2FjaGVLZXkgKTsKCgkJCQlpZiAoIHByb2dyYW0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gZWFybHkgb3V0IGlmIHByb2dyYW0gYW5kIGxpZ2h0IHN0YXRlIGlzIGlkZW50aWNhbAoKCQkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9PT0gcHJvZ3JhbSAmJiBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID09PSBsaWdodHNTdGF0ZVZlcnNpb24gKSB7CgoJCQkJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgoJCQkJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCXBhcmFtZXRlcnMudW5pZm9ybXMgPSBwcm9ncmFtQ2FjaGUuZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICk7CgoJCQkJCW1hdGVyaWFsLm9uQmVmb3JlQ29tcGlsZSggcGFyYW1ldGVycywgX3RoaXMgKTsKCgkJCQkJcHJvZ3JhbSA9IHByb2dyYW1DYWNoZS5hY3F1aXJlUHJvZ3JhbSggcGFyYW1ldGVycywgcHJvZ3JhbUNhY2hlS2V5ICk7CgkJCQkJcHJvZ3JhbXMuc2V0KCBwcm9ncmFtQ2FjaGVLZXksIHByb2dyYW0gKTsKCgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zID0gcGFyYW1ldGVycy51bmlmb3JtczsKCgkJCQl9CgoJCQkJY29uc3QgdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgoJCQkJaWYgKCAoICEgbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiAhIG1hdGVyaWFsLmlzUmF3U2hhZGVyTWF0ZXJpYWwgKSB8fCBtYXRlcmlhbC5jbGlwcGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJdW5pZm9ybXMuY2xpcHBpbmdQbGFuZXMgPSBjbGlwcGluZy51bmlmb3JtOwoKCQkJCX0KCgkJCQl1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICk7CgoJCQkJLy8gc3RvcmUgdGhlIGxpZ2h0IHNldHVwIGl0IHdhcyBjcmVhdGVkIGZvcgoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyA9IG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICk7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID0gbGlnaHRzU3RhdGVWZXJzaW9uOwoKCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICkgewoKCQkJCQkvLyB3aXJlIHVwIHRoZSBtYXRlcmlhbCB0byB0aGlzIHJlbmRlcmVyJ3MgbGlnaHRpbmcgc3RhdGUKCgkJCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IudmFsdWUgPSBsaWdodHMuc3RhdGUuYW1iaWVudDsKCQkJCQl1bmlmb3Jtcy5saWdodFByb2JlLnZhbHVlID0gbGlnaHRzLnN0YXRlLnByb2JlOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93OwoJCQkJCXVuaWZvcm1zLnNwb3RMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdDsKCQkJCQl1bmlmb3Jtcy5zcG90TGlnaHRTaGFkb3dzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RTaGFkb3c7CgkJCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWE7CgkJCQkJdW5pZm9ybXMubHRjXzEudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWFMVEMxOwoJCQkJCXVuaWZvcm1zLmx0Y18yLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhTFRDMjsKCQkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludDsKCQkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvdzsKCQkJCQl1bmlmb3Jtcy5oZW1pc3BoZXJlTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLmhlbWk7CgoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWFwLnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwOwoJCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4OwoJCQkJCXVuaWZvcm1zLnNwb3RTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvd01hcDsKCQkJCQl1bmlmb3Jtcy5zcG90TGlnaHRNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdExpZ2h0TWF0cml4OwoJCQkJCXVuaWZvcm1zLnNwb3RMaWdodE1hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90TGlnaHRNYXA7CgkJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXAudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXA7CgkJCQkJdW5pZm9ybXMucG9pbnRTaGFkb3dNYXRyaXgudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnRTaGFkb3dNYXRyaXg7CgkJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IGFkZCBhcmVhIGxpZ2h0cyBzaGFkb3cgaW5mbyB0byB1bmlmb3JtcwoKCQkJCX0KCgkJCQltYXRlcmlhbFByb3BlcnRpZXMuY3VycmVudFByb2dyYW0gPSBwcm9ncmFtOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9IG51bGw7CgoJCQkJcmV0dXJuIHByb2dyYW07CgoJCQl9CgoJCQlmdW5jdGlvbiBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICkgewoKCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9PT0gbnVsbCApIHsKCgkJCQkJY29uc3QgcHJvZ1VuaWZvcm1zID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtLmdldFVuaWZvcm1zKCk7CgkJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCA9IFdlYkdMVW5pZm9ybXMuc2VxV2l0aFZhbHVlKCBwcm9nVW5pZm9ybXMuc2VxLCBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXMgKTsKCgkJCQl9CgoJCQkJcmV0dXJuIG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3Q7CgoJCQl9CgoJCQlmdW5jdGlvbiB1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICkgewoKCQkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlID0gcGFyYW1ldGVycy5vdXRwdXRDb2xvclNwYWNlOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID0gcGFyYW1ldGVycy5iYXRjaGluZzsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZ0NvbG9yID0gcGFyYW1ldGVycy5iYXRjaGluZ0NvbG9yOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmc7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ0NvbG9yID0gcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3I7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ01vcnBoID0gcGFyYW1ldGVycy5pbnN0YW5jaW5nTW9ycGg7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPSBwYXJhbWV0ZXJzLnNraW5uaW5nOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0cyA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoTm9ybWFscyA9IHBhcmFtZXRlcnMubW9ycGhOb3JtYWxzOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoQ29sb3JzID0gcGFyYW1ldGVycy5tb3JwaENvbG9yczsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQ7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgPSBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzOwoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUludGVyc2VjdGlvbiA9IHBhcmFtZXRlcnMubnVtQ2xpcEludGVyc2VjdGlvbjsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgPSBwYXJhbWV0ZXJzLnZlcnRleEFscGhhczsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyA9IHBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHM7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMudG9uZU1hcHBpbmcgPSBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nOwoKCQkJfQoKCQkJZnVuY3Rpb24gc2V0UHJvZ3JhbSggY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QgKSB7CgoJCQkJaWYgKCBzY2VuZS5pc1NjZW5lICE9PSB0cnVlICkgc2NlbmUgPSBfZW1wdHlTY2VuZTsgLy8gc2NlbmUgY291bGQgYmUgYSBNZXNoLCBMaW5lLCBQb2ludHMsIC4uLgoKCQkJCXRleHR1cmVzLnJlc2V0VGV4dHVyZVVuaXRzKCk7CgoJCQkJY29uc3QgZm9nID0gc2NlbmUuZm9nOwoJCQkJY29uc3QgZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoJCQkJY29uc3QgY29sb3JTcGFjZSA9ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgKSA/IF90aGlzLm91dHB1dENvbG9yU3BhY2UgOiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApOwoJCQkJY29uc3QgZW52TWFwID0gKCBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gY3ViZXV2bWFwcyA6IGN1YmVtYXBzICkuZ2V0KCBtYXRlcmlhbC5lbnZNYXAgfHwgZW52aXJvbm1lbnQgKTsKCQkJCWNvbnN0IHZlcnRleEFscGhhcyA9IG1hdGVyaWFsLnZlcnRleENvbG9ycyA9PT0gdHJ1ZSAmJiAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IuaXRlbVNpemUgPT09IDQ7CgkJCQljb25zdCB2ZXJ0ZXhUYW5nZW50cyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudGFuZ2VudCAmJiAoICEhIG1hdGVyaWFsLm5vcm1hbE1hcCB8fCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApOwoJCQkJY29uc3QgbW9ycGhUYXJnZXRzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQkJY29uc3QgbW9ycGhOb3JtYWxzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbDsKCQkJCWNvbnN0IG1vcnBoQ29sb3JzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoKCQkJCWxldCB0b25lTWFwcGluZyA9IE5vVG9uZU1hcHBpbmc7CgoJCQkJaWYgKCBtYXRlcmlhbC50b25lTWFwcGVkICkgewoKCQkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKSB7CgoJCQkJCQl0b25lTWFwcGluZyA9IF90aGlzLnRvbmVNYXBwaW5nOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoJCQkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgoJCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgkJCQljb25zdCBsaWdodHMgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUubGlnaHRzOwoKCQkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIHsKCgkJCQkJaWYgKCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgfHwgY2FtZXJhICE9PSBfY3VycmVudENhbWVyYSApIHsKCgkJCQkJCWNvbnN0IHVzZUNhY2hlID0KCQkJCQkJCWNhbWVyYSA9PT0gX2N1cnJlbnRDYW1lcmEgJiYKCQkJCQkJCW1hdGVyaWFsLmlkID09PSBfY3VycmVudE1hdGVyaWFsSWQ7CgoJCQkJCQkvLyB3ZSBtaWdodCB3YW50IHRvIGNhbGwgdGhpcyBmdW5jdGlvbiB3aXRoIHNvbWUgQ2xpcHBpbmdHcm91cAoJCQkJCQkvLyBvYmplY3QgaW5zdGVhZCBvZiB0aGUgbWF0ZXJpYWwsIG9uY2UgaXQgYmVjb21lcyBmZWFzaWJsZQoJCQkJCQkvLyAoIzg0NjUsICM4Mzc5KQoJCQkJCQljbGlwcGluZy5zZXRTdGF0ZSggbWF0ZXJpYWwsIGNhbWVyYSwgdXNlQ2FjaGUgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLwoKCQkJCWxldCBuZWVkc1Byb2dyYW1DaGFuZ2UgPSBmYWxzZTsKCgkJCQlpZiAoIG1hdGVyaWFsLnZlcnNpb24gPT09IG1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gKSB7CgoJCQkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICYmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiAhPT0gbGlnaHRzLnN0YXRlLnZlcnNpb24gKSApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlICE9PSBjb2xvclNwYWNlICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID09PSBmYWxzZSApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoICEgb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nID09PSB0cnVlICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzQmF0Y2hlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmJhdGNoaW5nQ29sb3IgPT09IHRydWUgJiYgb2JqZWN0LmNvbG9yVGV4dHVyZSA9PT0gbnVsbCApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0JhdGNoZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5iYXRjaGluZ0NvbG9yID09PSBmYWxzZSAmJiBvYmplY3QuY29sb3JUZXh0dXJlICE9PSBudWxsICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gZmFsc2UgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCAhIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPT09IHRydWUgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IGZhbHNlICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggISBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IHRydWUgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IHRydWUgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgPT09IG51bGwgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IGZhbHNlICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZ01vcnBoID09PSB0cnVlICYmIG9iamVjdC5tb3JwaFRleHR1cmUgPT09IG51bGwgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nTW9ycGggPT09IGZhbHNlICYmIG9iamVjdC5tb3JwaFRleHR1cmUgIT09IG51bGwgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMuZW52TWFwICE9PSBlbnZNYXAgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5mb2cgPT09IHRydWUgJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyAhPT0gZm9nICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm51bUNsaXBwaW5nUGxhbmVzICE9PSB1bmRlZmluZWQgJiYKCQkJCQkJKCBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IGNsaXBwaW5nLm51bVBsYW5lcyB8fAoJCQkJCQltYXRlcmlhbFByb3BlcnRpZXMubnVtSW50ZXJzZWN0aW9uICE9PSBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24gKSApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgIT09IHZlcnRleEFscGhhcyApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhUYW5nZW50cyAhPT0gdmVydGV4VGFuZ2VudHMgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhUYXJnZXRzICE9PSBtb3JwaFRhcmdldHMgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzICE9PSBtb3JwaE5vcm1hbHMgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhDb2xvcnMgIT09IG1vcnBoQ29sb3JzICkgewoKCQkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLnRvbmVNYXBwaW5nICE9PSB0b25lTWFwcGluZyApIHsKCgkJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCAhPT0gbW9ycGhUYXJnZXRzQ291bnQgKSB7CgoJCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCQkJCQltYXRlcmlhbFByb3BlcnRpZXMuX192ZXJzaW9uID0gbWF0ZXJpYWwudmVyc2lvbjsKCgkJCQl9CgoJCQkJLy8KCgkJCQlsZXQgcHJvZ3JhbSA9IG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbTsKCgkJCQlpZiAoIG5lZWRzUHJvZ3JhbUNoYW5nZSA9PT0gdHJ1ZSApIHsKCgkJCQkJcHJvZ3JhbSA9IGdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJfQoKCQkJCWxldCByZWZyZXNoUHJvZ3JhbSA9IGZhbHNlOwoJCQkJbGV0IHJlZnJlc2hNYXRlcmlhbCA9IGZhbHNlOwoJCQkJbGV0IHJlZnJlc2hMaWdodHMgPSBmYWxzZTsKCgkJCQljb25zdCBwX3VuaWZvcm1zID0gcHJvZ3JhbS5nZXRVbmlmb3JtcygpLAoJCQkJCW1fdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgoJCQkJaWYgKCBzdGF0ZS51c2VQcm9ncmFtKCBwcm9ncmFtLnByb2dyYW0gKSApIHsKCgkJCQkJcmVmcmVzaFByb2dyYW0gPSB0cnVlOwoJCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgkJCQkJcmVmcmVzaExpZ2h0cyA9IHRydWU7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuaWQgIT09IF9jdXJyZW50TWF0ZXJpYWxJZCApIHsKCgkJCQkJX2N1cnJlbnRNYXRlcmlhbElkID0gbWF0ZXJpYWwuaWQ7CgoJCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgoJCQkJfQoKCQkJCWlmICggcmVmcmVzaFByb2dyYW0gfHwgX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCgkJCQkJLy8gY29tbW9uIGNhbWVyYSB1bmlmb3JtcwoKCQkJCQljb25zdCByZXZlcnNlRGVwdGhCdWZmZXIgPSBzdGF0ZS5idWZmZXJzLmRlcHRoLmdldFJldmVyc2VkKCk7CgoJCQkJCWlmICggcmV2ZXJzZURlcHRoQnVmZmVyICkgewoKCQkJCQkJX2N1cnJlbnRQcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkJCQl0b05vcm1hbGl6ZWRQcm9qZWN0aW9uTWF0cml4KCBfY3VycmVudFByb2plY3Rpb25NYXRyaXggKTsKCQkJCQkJdG9SZXZlcnNlZFByb2plY3Rpb25NYXRyaXgoIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwoKCQkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncHJvamVjdGlvbk1hdHJpeCcsIF9jdXJyZW50UHJvamVjdGlvbk1hdHJpeCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAncHJvamVjdGlvbk1hdHJpeCcsIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQkJCX0KCgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAndmlld01hdHJpeCcsIGNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJCQkJY29uc3QgdUNhbVBvcyA9IHBfdW5pZm9ybXMubWFwLmNhbWVyYVBvc2l0aW9uOwoKCQkJCQlpZiAoIHVDYW1Qb3MgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCXVDYW1Qb3Muc2V0VmFsdWUoIF9nbCwgX3ZlY3RvcjMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKSApOwoKCQkJCQl9CgoJCQkJCWlmICggY2FwYWJpbGl0aWVzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgKSB7CgoJCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdsb2dEZXB0aEJ1ZkZDJywKCQkJCQkJCTIuMCAvICggTWF0aC5sb2coIGNhbWVyYS5mYXIgKyAxLjAgKSAvIE1hdGguTE4yICkgKTsKCgkJCQkJfQoKCQkJCQkvLyBjb25zaWRlciBtb3ZpbmcgaXNPcnRob2dyYXBoaWMgdG8gVW5pZm9ybUxpYiBhbmQgV2ViR0xNYXRlcmlhbHMsIHNlZSBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjY0NjcjaXNzdWVjb21tZW50LTE2NDUxODUwNjcKCgkJCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsIHx8CgkJCQkJCW1hdGVyaWFsLmlzTWVzaFRvb25NYXRlcmlhbCB8fAoJCQkJCQltYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwKCQkJCQkJbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCB8fAoJCQkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8CgkJCQkJCW1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdpc09ydGhvZ3JhcGhpYycsIGNhbWVyYS5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9PT0gdHJ1ZSApOwoKCQkJCQl9CgoJCQkJCWlmICggX2N1cnJlbnRDYW1lcmEgIT09IGNhbWVyYSApIHsKCgkJCQkJCV9jdXJyZW50Q2FtZXJhID0gY2FtZXJhOwoKCQkJCQkJLy8gbGlnaHRpbmcgdW5pZm9ybXMgZGVwZW5kIG9uIHRoZSBjYW1lcmEgc28gZW5mb3JjZSBhbiB1cGRhdGUKCQkJCQkJLy8gbm93LCBpbiBjYXNlIHRoaXMgbWF0ZXJpYWwgc3VwcG9ydHMgbGlnaHRzIC0gb3IgbGF0ZXIsIHdoZW4KCQkJCQkJLy8gdGhlIG5leHQgbWF0ZXJpYWwgdGhhdCBkb2VzIGdldHMgYWN0aXZhdGVkOgoKCQkJCQkJcmVmcmVzaE1hdGVyaWFsID0gdHJ1ZTsJCS8vIHNldCB0byB0cnVlIG9uIG1hdGVyaWFsIGNoYW5nZQoJCQkJCQlyZWZyZXNoTGlnaHRzID0gdHJ1ZTsJCS8vIHJlbWFpbnMgc2V0IHVudGlsIHVwZGF0ZSBkb25lCgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gc2tpbm5pbmcgYW5kIG1vcnBoIHRhcmdldCB1bmlmb3JtcyBtdXN0IGJlIHNldCBldmVuIGlmIG1hdGVyaWFsIGRpZG4ndCBjaGFuZ2UKCQkJCS8vIGF1dG8tc2V0dGluZyBvZiB0ZXh0dXJlIHVuaXQgZm9yIGJvbmUgYW5kIG1vcnBoIHRleHR1cmUgbXVzdCBnbyBiZWZvcmUgb3RoZXIgdGV4dHVyZXMKCQkJCS8vIG90aGVyd2lzZSB0ZXh0dXJlcyB1c2VkIGZvciBza2lubmluZyBhbmQgbW9ycGhpbmcgY2FuIHRha2Ugb3ZlciB0ZXh0dXJlIHVuaXRzIHJlc2VydmVkIGZvciBvdGhlciBtYXRlcmlhbCB0ZXh0dXJlcwoKCQkJCWlmICggb2JqZWN0LmlzU2tpbm5lZE1lc2ggKSB7CgoJCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeCcgKTsKCQkJCQlwX3VuaWZvcm1zLnNldE9wdGlvbmFsKCBfZ2wsIG9iamVjdCwgJ2JpbmRNYXRyaXhJbnZlcnNlJyApOwoKCQkJCQljb25zdCBza2VsZXRvbiA9IG9iamVjdC5za2VsZXRvbjsKCgkJCQkJaWYgKCBza2VsZXRvbiApIHsKCgkJCQkJCWlmICggc2tlbGV0b24uYm9uZVRleHR1cmUgPT09IG51bGwgKSBza2VsZXRvbi5jb21wdXRlQm9uZVRleHR1cmUoKTsKCgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JvbmVUZXh0dXJlJywgc2tlbGV0b24uYm9uZVRleHR1cmUsIHRleHR1cmVzICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJaWYgKCBvYmplY3QuaXNCYXRjaGVkTWVzaCApIHsKCgkJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ1RleHR1cmUnICk7CgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdUZXh0dXJlJywgb2JqZWN0Ll9tYXRyaWNlc1RleHR1cmUsIHRleHR1cmVzICk7CgoJCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmF0Y2hpbmdJZFRleHR1cmUnICk7CgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnYmF0Y2hpbmdJZFRleHR1cmUnLCBvYmplY3QuX2luZGlyZWN0VGV4dHVyZSwgdGV4dHVyZXMgKTsKCgkJCQkJcF91bmlmb3Jtcy5zZXRPcHRpb25hbCggX2dsLCBvYmplY3QsICdiYXRjaGluZ0NvbG9yVGV4dHVyZScgKTsKCQkJCQlpZiAoIG9iamVjdC5fY29sb3JzVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JhdGNoaW5nQ29sb3JUZXh0dXJlJywgb2JqZWN0Ll9jb2xvcnNUZXh0dXJlLCB0ZXh0dXJlcyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlczsKCgkJCQlpZiAoIG1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkIHx8IG1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCB8fCAoIG1vcnBoQXR0cmlidXRlcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgKSB7CgoJCQkJCW1vcnBodGFyZ2V0cy51cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKTsKCgkJCQl9CgoJCQkJaWYgKCByZWZyZXNoTWF0ZXJpYWwgfHwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgIT09IG9iamVjdC5yZWNlaXZlU2hhZG93ICkgewoKCQkJCQltYXRlcmlhbFByb3BlcnRpZXMucmVjZWl2ZVNoYWRvdyA9IG9iamVjdC5yZWNlaXZlU2hhZG93OwoJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3JlY2VpdmVTaGFkb3cnLCBvYmplY3QucmVjZWl2ZVNoYWRvdyApOwoKCQkJCX0KCgkJCQkvLyBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL3RocmVlLmpzL3B1bGwvMjQ0NjcjaXNzdWVjb21tZW50LTEyMDkwMzE1MTIKCgkJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaEdvdXJhdWRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgIT09IG51bGwgKSB7CgoJCQkJCW1fdW5pZm9ybXMuZW52TWFwLnZhbHVlID0gZW52TWFwOwoKCQkJCQltX3VuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSAoIGVudk1hcC5pc0N1YmVUZXh0dXJlICYmIGVudk1hcC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtMSA6IDE7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgPT09IG51bGwgJiYgc2NlbmUuZW52aXJvbm1lbnQgIT09IG51bGwgKSB7CgoJCQkJCW1fdW5pZm9ybXMuZW52TWFwSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuZW52aXJvbm1lbnRJbnRlbnNpdHk7CgoJCQkJfQoKCQkJCWlmICggcmVmcmVzaE1hdGVyaWFsICkgewoKCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICd0b25lTWFwcGluZ0V4cG9zdXJlJywgX3RoaXMudG9uZU1hcHBpbmdFeHBvc3VyZSApOwoKCQkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5uZWVkc0xpZ2h0cyApIHsKCgkJCQkJCS8vIHRoZSBjdXJyZW50IG1hdGVyaWFsIHJlcXVpcmVzIGxpZ2h0aW5nIGluZm8KCgkJCQkJCS8vIG5vdGU6IGFsbCBsaWdodGluZyB1bmlmb3JtcyBhcmUgYWx3YXlzIHNldCBjb3JyZWN0bHkKCQkJCQkJLy8gdGhleSBzaW1wbHkgcmVmZXJlbmNlIHRoZSByZW5kZXJlcidzIHN0YXRlIGZvciB0aGVpcgoJCQkJCQkvLyB2YWx1ZXMKCQkJCQkJLy8KCQkJCQkJLy8gdXNlIHRoZSBjdXJyZW50IG1hdGVyaWFsJ3MgLm5lZWRzVXBkYXRlIGZsYWdzIHRvIHNldAoJCQkJCQkvLyB0aGUgR0wgc3RhdGUgd2hlbiByZXF1aXJlZAoKCQkJCQkJbWFya1VuaWZvcm1zTGlnaHRzTmVlZHNVcGRhdGUoIG1fdW5pZm9ybXMsIHJlZnJlc2hMaWdodHMgKTsKCgkJCQkJfQoKCQkJCQkvLyByZWZyZXNoIHVuaWZvcm1zIGNvbW1vbiB0byBzZXZlcmFsIG1hdGVyaWFscwoKCQkJCQlpZiAoIGZvZyAmJiBtYXRlcmlhbC5mb2cgPT09IHRydWUgKSB7CgoJCQkJCQltYXRlcmlhbHMucmVmcmVzaEZvZ1VuaWZvcm1zKCBtX3VuaWZvcm1zLCBmb2cgKTsKCgkJCQkJfQoKCQkJCQltYXRlcmlhbHMucmVmcmVzaE1hdGVyaWFsVW5pZm9ybXMoIG1fdW5pZm9ybXMsIG1hdGVyaWFsLCBfcGl4ZWxSYXRpbywgX2hlaWdodCwgY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnRyYW5zbWlzc2lvblJlbmRlclRhcmdldFsgY2FtZXJhLmlkIF0gKTsKCgkJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgZ2V0VW5pZm9ybUxpc3QoIG1hdGVyaWFsUHJvcGVydGllcyApLCBtX3VuaWZvcm1zLCB0ZXh0dXJlcyApOwoKCQkJCX0KCgkJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQlXZWJHTFVuaWZvcm1zLnVwbG9hZCggX2dsLCBnZXRVbmlmb3JtTGlzdCggbWF0ZXJpYWxQcm9wZXJ0aWVzICksIG1fdW5pZm9ybXMsIHRleHR1cmVzICk7CgkJCQkJbWF0ZXJpYWwudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCQkJfQoKCQkJCWlmICggbWF0ZXJpYWwuaXNTcHJpdGVNYXRlcmlhbCApIHsKCgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnY2VudGVyJywgb2JqZWN0LmNlbnRlciApOwoKCQkJCX0KCgkJCQkvLyBjb21tb24gbWF0cmljZXMKCgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbFZpZXdNYXRyaXgnLCBvYmplY3QubW9kZWxWaWV3TWF0cml4ICk7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdub3JtYWxNYXRyaXgnLCBvYmplY3Qubm9ybWFsTWF0cml4ICk7CgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdtb2RlbE1hdHJpeCcsIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCS8vIFVCT3MKCgkJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCgkJCQkJY29uc3QgZ3JvdXBzID0gbWF0ZXJpYWwudW5pZm9ybXNHcm91cHM7CgoJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCgkJCQkJCXVuaWZvcm1zR3JvdXBzLnVwZGF0ZSggZ3JvdXAsIHByb2dyYW0gKTsKCQkJCQkJdW5pZm9ybXNHcm91cHMuYmluZCggZ3JvdXAsIHByb2dyYW0gKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJCX0KCgkJCS8vIElmIHVuaWZvcm1zIGFyZSBtYXJrZWQgYXMgY2xlYW4sIHRoZXkgZG9uJ3QgbmVlZCB0byBiZSBsb2FkZWQgdG8gdGhlIEdQVS4KCgkJCWZ1bmN0aW9uIG1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKCB1bmlmb3JtcywgdmFsdWUgKSB7CgoJCQkJdW5pZm9ybXMuYW1iaWVudExpZ2h0Q29sb3IubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJCXVuaWZvcm1zLmxpZ2h0UHJvYmUubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodFNoYWRvd3MubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJCXVuaWZvcm1zLnBvaW50TGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMuc3BvdExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMuc3BvdExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJCXVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCgkJCX0KCgkJCWZ1bmN0aW9uIG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICkgewoKCQkJCXJldHVybiBtYXRlcmlhbC5pc01lc2hMYW1iZXJ0TWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsIHx8IG1hdGVyaWFsLmlzU2hhZG93TWF0ZXJpYWwgfHwKCQkJCQkoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwubGlnaHRzID09PSB0cnVlICk7CgoJCQl9CgoJCQkvKioKCQkJICogUmV0dXJucyB0aGUgYWN0aXZlIGN1YmUgZmFjZS4KCQkJICoKCQkJICogQHJldHVybiB7bnVtYmVyfSBUaGUgYWN0aXZlIGN1YmUgZmFjZS4KCQkJICovCgkJCXRoaXMuZ2V0QWN0aXZlQ3ViZUZhY2UgPSBmdW5jdGlvbiAoKSB7CgoJCQkJcmV0dXJuIF9jdXJyZW50QWN0aXZlQ3ViZUZhY2U7CgoJCQl9OwoKCQkJLyoqCgkJCSAqIFJldHVybnMgdGhlIGFjdGl2ZSBtaXBtYXAgbGV2ZWwuCgkJCSAqCgkJCSAqIEByZXR1cm4ge251bWJlcn0gVGhlIGFjdGl2ZSBtaXBtYXAgbGV2ZWwuCgkJCSAqLwoJCQl0aGlzLmdldEFjdGl2ZU1pcG1hcExldmVsID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBSZXR1cm5zIHRoZSBhY3RpdmUgcmVuZGVyIHRhcmdldC4KCQkJICoKCQkJICogQHJldHVybiB7P1dlYkdMUmVuZGVyVGFyZ2V0fSBUaGUgYWN0aXZlIHJlbmRlciB0YXJnZXQuIFJldHVybnMgYG51bGxgIGlmIG5vIHJlbmRlciB0YXJnZXQKCQkJICogaXMgY3VycmVudGx5IHNldC4KCQkJICovCgkJCXRoaXMuZ2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkgewoKCQkJCXJldHVybiBfY3VycmVudFJlbmRlclRhcmdldDsKCgkJCX07CgoJCQl0aGlzLnNldFJlbmRlclRhcmdldFRleHR1cmVzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGNvbG9yVGV4dHVyZSwgZGVwdGhUZXh0dXJlICkgewoKCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2F1dG9BbGxvY2F0ZURlcHRoQnVmZmVyID0gcmVuZGVyVGFyZ2V0LnJlc29sdmVEZXB0aEJ1ZmZlciA9PT0gZmFsc2U7CgkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA9PT0gZmFsc2UgKSB7CgoJCQkJCS8vIFRoZSBtdWx0aXNhbXBsZV9yZW5kZXJfdG9fdGV4dHVyZSBleHRlbnNpb24gZG9lc24ndCB3b3JrIHByb3Blcmx5IGlmIHRoZXJlCgkJCQkJLy8gYXJlIG1pZGZyYW1lIGZsdXNoZXMgYW5kIGFuIGV4dGVybmFsIGRlcHRoIGJ1ZmZlci4gRGlzYWJsZSB1c2Ugb2YgdGhlIGV4dGVuc2lvbi4KCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlUmVuZGVyVG9UZXh0dXJlID0gZmFsc2U7CgoJCQkJfQoKCQkJCXByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlID0gY29sb3JUZXh0dXJlOwoJCQkJcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSA9IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA/IHVuZGVmaW5lZCA6IGRlcHRoVGV4dHVyZTsKCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faGFzRXh0ZXJuYWxUZXh0dXJlcyA9IHRydWU7CgoJCQl9OwoKCQkJdGhpcy5zZXRSZW5kZXJUYXJnZXRGcmFtZWJ1ZmZlciA9IGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCBkZWZhdWx0RnJhbWVidWZmZXIgKSB7CgoJCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gZGVmYXVsdEZyYW1lYnVmZmVyOwoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciA9IGRlZmF1bHRGcmFtZWJ1ZmZlciA9PT0gdW5kZWZpbmVkOwoKCQkJfTsKCgkJCWNvbnN0IF9zY3JhdGNoRnJhbWVCdWZmZXIgPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCgkJCS8qKgoJCQkgKiBTZXRzIHRoZSBhY3RpdmUgcmVuZGVydGFyZ2V0LgoJCQkgKgoJCQkgKiBAcGFyYW0gez9XZWJHTFJlbmRlclRhcmdldH0gcmVuZGVyVGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQgdG8gc2V0LiBXaGVuIGBudWxsYCBpcyBnaXZlbiwKCQkJICogdGhlIGNhbnZhcyBpcyBzZXQgYXMgdGhlIGFjdGl2ZSByZW5kZXIgdGFyZ2V0IGluc3RlYWQuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWN0aXZlQ3ViZUZhY2U9MF0gLSBUaGUgYWN0aXZlIGN1YmUgZmFjZSB3aGVuIHVzaW5nIGEgY3ViZSByZW5kZXIgdGFyZ2V0LgoJCQkgKiBJbmRpY2F0ZXMgdGhlIHogbGF5ZXIgdG8gcmVuZGVyIGluIHRvIHdoZW4gdXNpbmcgM0Qgb3IgYXJyYXkgcmVuZGVyIHRhcmdldHMuCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBbYWN0aXZlTWlwbWFwTGV2ZWw9MF0gLSBUaGUgYWN0aXZlIG1pcG1hcCBsZXZlbC4KCQkJICovCgkJCXRoaXMuc2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGFjdGl2ZUN1YmVGYWNlID0gMCwgYWN0aXZlTWlwbWFwTGV2ZWwgPSAwICkgewoKCQkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoJCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IGFjdGl2ZUN1YmVGYWNlOwoJCQkJX2N1cnJlbnRBY3RpdmVNaXBtYXBMZXZlbCA9IGFjdGl2ZU1pcG1hcExldmVsOwoKCQkJCWxldCB1c2VEZWZhdWx0RnJhbWVidWZmZXIgPSB0cnVlOwoJCQkJbGV0IGZyYW1lYnVmZmVyID0gbnVsbDsKCQkJCWxldCBpc0N1YmUgPSBmYWxzZTsKCQkJCWxldCBpc1JlbmRlclRhcmdldDNEID0gZmFsc2U7CgoJCQkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3VzZURlZmF1bHRGcmFtZWJ1ZmZlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJLy8gV2UgbmVlZCB0byBtYWtlIHN1cmUgdG8gcmViaW5kIHRoZSBmcmFtZWJ1ZmZlci4KCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJCQkJdXNlRGVmYXVsdEZyYW1lYnVmZmVyID0gZmFsc2U7CgoJCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQl0ZXh0dXJlcy5zZXR1cFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJCQkJLy8gQ29sb3IgYW5kIGRlcHRoIHRleHR1cmUgbXVzdCBiZSByZWJvdW5kIGluIG9yZGVyIGZvciB0aGUgc3dhcGNoYWluIHRvIHVwZGF0ZS4KCQkJCQkJdGV4dHVyZXMucmViaW5kVGV4dHVyZXMoIHJlbmRlclRhcmdldCwgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkuX193ZWJnbFRleHR1cmUgKTsKCgkJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKCQkJCQkJLy8gY2hlY2sgaWYgdGhlIGRlcHRoIHRleHR1cmUgaXMgYWxyZWFkeSBib3VuZCB0byB0aGUgZnJhbWUgYnVmZmVyIGFuZCB0aGF0IGl0J3MgYmVlbiBpbml0aWFsaXplZAoJCQkJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwoJCQkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19ib3VuZERlcHRoVGV4dHVyZSAhPT0gZGVwdGhUZXh0dXJlICkgewoKCQkJCQkJCS8vIGNoZWNrIGlmIHRoZSBkZXB0aCB0ZXh0dXJlIGlzIGNvbXBhdGlibGUKCQkJCQkJCWlmICgKCQkJCQkJCQlkZXB0aFRleHR1cmUgIT09IG51bGwgJiYKCQkJCQkJCQlwcm9wZXJ0aWVzLmhhcyggZGVwdGhUZXh0dXJlICkgJiYKCQkJCQkJCQkoIHJlbmRlclRhcmdldC53aWR0aCAhPT0gZGVwdGhUZXh0dXJlLmltYWdlLndpZHRoIHx8IHJlbmRlclRhcmdldC5oZWlnaHQgIT09IGRlcHRoVGV4dHVyZS5pbWFnZS5oZWlnaHQgKQoJCQkJCQkJKSB7CgoJCQkJCQkJCXRocm93IG5ldyBFcnJvciggJ1dlYkdMUmVuZGVyVGFyZ2V0OiBBdHRhY2hlZCBEZXB0aFRleHR1cmUgaXMgaW5pdGlhbGl6ZWQgdG8gdGhlIGluY29ycmVjdCBzaXplLicgKTsKCgkJCQkJCQl9CgoJCQkJCQkJLy8gU3dhcCB0aGUgZGVwdGggYnVmZmVyIHRvIHRoZSBjdXJyZW50bHkgYXR0YWNoZWQgb25lCgkJCQkJCQl0ZXh0dXJlcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJCWlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgfHwgdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCQlpc1JlbmRlclRhcmdldDNEID0gdHJ1ZTsKCgkJCQkJfQoKCQkJCQljb25zdCBfX3dlYmdsRnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCApIHsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdICkgKSB7CgoJCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlIF1bIGFjdGl2ZU1pcG1hcExldmVsIF07CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdOwoKCQkJCQkJfQoKCQkJCQkJaXNDdWJlID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIGlmICggKCByZW5kZXJUYXJnZXQuc2FtcGxlcyA+IDAgKSAmJiB0ZXh0dXJlcy51c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApID09PSBmYWxzZSApIHsKCgkJCQkJCWZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlcjsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyICkgKSB7CgoJCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZU1pcG1hcExldmVsIF07CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCV9jdXJyZW50Vmlld3BvcnQuY29weSggcmVuZGVyVGFyZ2V0LnZpZXdwb3J0ICk7CgkJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIHJlbmRlclRhcmdldC5zY2lzc29yICk7CgkJCQkJX2N1cnJlbnRTY2lzc29yVGVzdCA9IHJlbmRlclRhcmdldC5zY2lzc29yVGVzdDsKCgkJCQl9IGVsc2UgewoKCQkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLmZsb29yKCk7CgkJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkuZmxvb3IoKTsKCQkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gX3NjaXNzb3JUZXN0OwoKCQkJCX0KCgkJCQkvLyBVc2UgYSBzY3JhdGNoIGZyYW1lIGJ1ZmZlciBpZiByZW5kZXJpbmcgdG8gYSBtaXAgbGV2ZWwgdG8gYXZvaWQgZGVwdGggYnVmZmVycwoJCQkJLy8gYmVpbmcgYm91bmQgdGhhdCBhcmUgZGlmZmVyZW50IHNpemVzLgoJCQkJaWYgKCBhY3RpdmVNaXBtYXBMZXZlbCAhPT0gMCApIHsKCgkJCQkJZnJhbWVidWZmZXIgPSBfc2NyYXRjaEZyYW1lQnVmZmVyOwoKCQkJCX0KCgkJCQljb25zdCBmcmFtZWJ1ZmZlckJvdW5kID0gc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCQkJaWYgKCBmcmFtZWJ1ZmZlckJvdW5kICYmIHVzZURlZmF1bHRGcmFtZWJ1ZmZlciApIHsKCgkJCQkJc3RhdGUuZHJhd0J1ZmZlcnMoIHJlbmRlclRhcmdldCwgZnJhbWVidWZmZXIgKTsKCgkJCQl9CgoJCQkJc3RhdGUudmlld3BvcnQoIF9jdXJyZW50Vmlld3BvcnQgKTsKCQkJCXN0YXRlLnNjaXNzb3IoIF9jdXJyZW50U2Npc3NvciApOwoJCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9jdXJyZW50U2Npc3NvclRlc3QgKTsKCgkJCQlpZiAoIGlzQ3ViZSApIHsKCgkJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgYWN0aXZlQ3ViZUZhY2UsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBhY3RpdmVNaXBtYXBMZXZlbCApOwoKCQkJCX0gZWxzZSBpZiAoIGlzUmVuZGVyVGFyZ2V0M0QgKSB7CgoJCQkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgkJCQkJY29uc3QgbGF5ZXIgPSBhY3RpdmVDdWJlRmFjZTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgYWN0aXZlTWlwbWFwTGV2ZWwsIGxheWVyICk7CgoJCQkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0ICE9PSBudWxsICYmIGFjdGl2ZU1pcG1hcExldmVsICE9PSAwICkgewoKCQkJCQkvLyBPbmx5IGJpbmQgdGhlIGZyYW1lIGJ1ZmZlciBpZiB3ZSBhcmUgdXNpbmcgYSBzY3JhdGNoIGZyYW1lIGJ1ZmZlciB0byByZW5kZXIgdG8gYSBtaXBtYXAuCgkJCQkJLy8gSWYgd2UgcmViaW5kIHRoZSB0ZXh0dXJlIHdoZW4gdXNpbmcgYSBtdWx0aSBzYW1wbGUgYnVmZmVyIHRoZW4gYW4gZXJyb3IgYWJvdXQgaW5jb25zaXN0ZW50IHNhbXBsZXMgd2lsbCBiZSB0aHJvd24uCgkJCQkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKTsKCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJCQkJfQoKCQkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0xOyAvLyByZXNldCBjdXJyZW50IG1hdGVyaWFsIHRvIGVuc3VyZSBjb3JyZWN0IHVuaWZvcm0gYmluZGluZ3MKCgkJCX07CgoJCQkvKioKCQkJICogUmVhZHMgdGhlIHBpeGVsIGRhdGEgZnJvbSB0aGUgZ2l2ZW4gcmVuZGVyIHRhcmdldCBpbnRvIHRoZSBnaXZlbiBidWZmZXIuCgkJCSAqCgkJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHJlYWQgZnJvbS4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYHhgIGNvb3JkaW5hdGUgb2YgdGhlIGNvcHkgcmVnaW9uJ3Mgb3JpZ2luLgoJCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBgeWAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgY29weSByZWdpb24uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjb3B5IHJlZ2lvbi4KCQkJICogQHBhcmFtIHtUeXBlZEFycmF5fSBidWZmZXIgLSBUaGUgcmVzdWx0IGJ1ZmZlci4KCQkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZUluZGV4XSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIGluZGV4LgoJCQkgKiBAcGFyYW0ge251bWJlcn0gW3RleHR1cmVJbmRleD0wXSAtIFRoZSB0ZXh0dXJlIGluZGV4IG9mIGFuIE1SVCByZW5kZXIgdGFyZ2V0LgoJCQkgKi8KCQkJdGhpcy5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGJ1ZmZlciwgYWN0aXZlQ3ViZUZhY2VJbmRleCwgdGV4dHVyZUluZGV4ID0gMCApIHsKCgkJCQlpZiAoICEgKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xSZW5kZXJUYXJnZXQgKSApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCQlsZXQgZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICYmIGFjdGl2ZUN1YmVGYWNlSW5kZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJZnJhbWVidWZmZXIgPSBmcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2VJbmRleCBdOwoKCQkJCX0KCgkJCQlpZiAoIGZyYW1lYnVmZmVyICkgewoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCQkJdHJ5IHsKCgkJCQkJCWNvbnN0IHRleHR1cmUgPSByZW5kZXJUYXJnZXQudGV4dHVyZXNbIHRleHR1cmVJbmRleCBdOwoJCQkJCQljb25zdCB0ZXh0dXJlRm9ybWF0ID0gdGV4dHVyZS5mb3JtYXQ7CgkJCQkJCWNvbnN0IHRleHR1cmVUeXBlID0gdGV4dHVyZS50eXBlOwoKCQkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlRm9ybWF0UmVhZGFibGUoIHRleHR1cmVGb3JtYXQgKSApIHsKCgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IGluIFJHQkEgb3IgaW1wbGVtZW50YXRpb24gZGVmaW5lZCBmb3JtYXQuJyApOwoJCQkJCQkJcmV0dXJuOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCAhIGNhcGFiaWxpdGllcy50ZXh0dXJlVHlwZVJlYWRhYmxlKCB0ZXh0dXJlVHlwZSApICkgewoKCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwoJCQkJCQkJcmV0dXJuOwoKCQkJCQkJfQoKCQkJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQoKCQkJCQkJaWYgKCAoIHggPj0gMCAmJiB4IDw9ICggcmVuZGVyVGFyZ2V0LndpZHRoIC0gd2lkdGggKSApICYmICggeSA+PSAwICYmIHkgPD0gKCByZW5kZXJUYXJnZXQuaGVpZ2h0IC0gaGVpZ2h0ICkgKSApIHsKCgkJCQkJCQkvLyB3aGVuIHVzaW5nIE1SVCwgc2VsZWN0IHRoZSBjb3JyZWN0IGNvbG9yIGJ1ZmZlciBmb3IgdGhlIHN1YnNlcXVlbnQgcmVhZCBjb21tYW5kCgoJCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQudGV4dHVyZXMubGVuZ3RoID4gMSApIF9nbC5yZWFkQnVmZmVyKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyB0ZXh0dXJlSW5kZXggKTsKCgkJCQkJCQlfZ2wucmVhZFBpeGVscyggeCwgeSwgd2lkdGgsIGhlaWdodCwgdXRpbHMuY29udmVydCggdGV4dHVyZUZvcm1hdCApLCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlVHlwZSApLCBidWZmZXIgKTsKCgkJCQkJCX0KCgkJCQkJfSBmaW5hbGx5IHsKCgkJCQkJCS8vIHJlc3RvcmUgZnJhbWVidWZmZXIgb2YgY3VycmVudCByZW5kZXIgdGFyZ2V0IGlmIG5lY2Vzc2FyeQoKCQkJCQkJY29uc3QgZnJhbWVidWZmZXIgPSAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsICkgPyBwcm9wZXJ0aWVzLmdldCggX2N1cnJlbnRSZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgOiBudWxsOwoJCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogQXN5bmNocm9ub3VzLCBub24tYmxvY2tpbmcgdmVyc2lvbiBvZiB7QGxpbmsgV2ViR0xSZW5kZXJlciNyZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzfS4KCQkJICoKCQkJICogSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoaXMgdmVyc2lvbiBvZiBgcmVhZFJlbmRlclRhcmdldFBpeGVscygpYCB3aGVuZXZlciBwb3NzaWJsZS4KCQkJICoKCQkJICogQGFzeW5jCgkJCSAqIEBwYXJhbSB7V2ViR0xSZW5kZXJUYXJnZXR9IHJlbmRlclRhcmdldCAtIFRoZSByZW5kZXIgdGFyZ2V0IHRvIHJlYWQgZnJvbS4KCQkJICogQHBhcmFtIHtudW1iZXJ9IHggLSBUaGUgYHhgIGNvb3JkaW5hdGUgb2YgdGhlIGNvcHkgcmVnaW9uJ3Mgb3JpZ2luLgoJCQkgKiBAcGFyYW0ge251bWJlcn0geSAtIFRoZSBgeWAgY29vcmRpbmF0ZSBvZiB0aGUgY29weSByZWdpb24ncyBvcmlnaW4uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgY29weSByZWdpb24uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBjb3B5IHJlZ2lvbi4KCQkJICogQHBhcmFtIHtUeXBlZEFycmF5fSBidWZmZXIgLSBUaGUgcmVzdWx0IGJ1ZmZlci4KCQkJICogQHBhcmFtIHtudW1iZXJ9IFthY3RpdmVDdWJlRmFjZUluZGV4XSAtIFRoZSBhY3RpdmUgY3ViZSBmYWNlIGluZGV4LgoJCQkgKiBAcGFyYW0ge251bWJlcn0gW3RleHR1cmVJbmRleD0wXSAtIFRoZSB0ZXh0dXJlIGluZGV4IG9mIGFuIE1SVCByZW5kZXIgdGFyZ2V0LgoJCQkgKiBAcmV0dXJuIHtQcm9taXNlPFR5cGVkQXJyYXk+fSBBIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSByZWFkIGhhcyBiZWVuIGZpbmlzaGVkLiBUaGUgcmVzb2x2ZSBwcm92aWRlcyB0aGUgcmVhZCBkYXRhIGFzIGEgdHlwZWQgYXJyYXkuCgkJCSAqLwoJCQl0aGlzLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHNBc3luYyA9IGFzeW5jIGZ1bmN0aW9uICggcmVuZGVyVGFyZ2V0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBidWZmZXIsIGFjdGl2ZUN1YmVGYWNlSW5kZXgsIHRleHR1cmVJbmRleCA9IDAgKSB7CgoJCQkJaWYgKCAhICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CgoJCQkJfQoKCQkJCWxldCBmcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CgkJCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCAmJiBhY3RpdmVDdWJlRmFjZUluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlSW5kZXggXTsKCgkJCQl9CgoJCQkJaWYgKCBmcmFtZWJ1ZmZlciApIHsKCgkJCQkJLy8gdGhlIGZvbGxvd2luZyBpZiBzdGF0ZW1lbnQgZW5zdXJlcyB2YWxpZCByZWFkIHJlcXVlc3RzIChubyBvdXQtb2YtYm91bmRzIHBpeGVscywgc2VlICM4NjA0KQoJCQkJCWlmICggKCB4ID49IDAgJiYgeCA8PSAoIHJlbmRlclRhcmdldC53aWR0aCAtIHdpZHRoICkgKSAmJiAoIHkgPj0gMCAmJiB5IDw9ICggcmVuZGVyVGFyZ2V0LmhlaWdodCAtIGhlaWdodCApICkgKSB7CgoJCQkJCQkvLyBzZXQgdGhlIGFjdGl2ZSBmcmFtZSBidWZmZXIgdG8gdGhlIG9uZSB3ZSB3YW50IHRvIHJlYWQKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCQkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmVzWyB0ZXh0dXJlSW5kZXggXTsKCQkJCQkJY29uc3QgdGV4dHVyZUZvcm1hdCA9IHRleHR1cmUuZm9ybWF0OwoJCQkJCQljb25zdCB0ZXh0dXJlVHlwZSA9IHRleHR1cmUudHlwZTsKCgkJCQkJCWlmICggISBjYXBhYmlsaXRpZXMudGV4dHVyZUZvcm1hdFJlYWRhYmxlKCB0ZXh0dXJlRm9ybWF0ICkgKSB7CgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gUkdCQSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIGZvcm1hdC4nICk7CgoJCQkJCQl9CgoJCQkJCQlpZiAoICEgY2FwYWJpbGl0aWVzLnRleHR1cmVUeXBlUmVhZGFibGUoIHRleHR1cmVUeXBlICkgKSB7CgoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlbmRlclRhcmdldCBpcyBub3QgaW4gVW5zaWduZWRCeXRlVHlwZSBvciBpbXBsZW1lbnRhdGlvbiBkZWZpbmVkIHR5cGUuJyApOwoKCQkJCQkJfQoKCQkJCQkJY29uc3QgZ2xCdWZmZXIgPSBfZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCQkJCV9nbC5iaW5kQnVmZmVyKCBfZ2wuUElYRUxfUEFDS19CVUZGRVIsIGdsQnVmZmVyICk7CgkJCQkJCV9nbC5idWZmZXJEYXRhKCBfZ2wuUElYRUxfUEFDS19CVUZGRVIsIGJ1ZmZlci5ieXRlTGVuZ3RoLCBfZ2wuU1RSRUFNX1JFQUQgKTsKCgkJCQkJCS8vIHdoZW4gdXNpbmcgTVJULCBzZWxlY3QgdGhlIGNvcmVjdCBjb2xvciBidWZmZXIgZm9yIHRoZSBzdWJzZXF1ZW50IHJlYWQgY29tbWFuZAoKCQkJCQkJaWYgKCByZW5kZXJUYXJnZXQudGV4dHVyZXMubGVuZ3RoID4gMSApIF9nbC5yZWFkQnVmZmVyKCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyB0ZXh0dXJlSW5kZXggKTsKCgkJCQkJCV9nbC5yZWFkUGl4ZWxzKCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICksIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICksIDAgKTsKCgkJCQkJCS8vIHJlc2V0IHRoZSBmcmFtZSBidWZmZXIgdG8gdGhlIGN1cnJlbnRseSBzZXQgYnVmZmVyIGJlZm9yZSB3YWl0aW5nCgkJCQkJCWNvbnN0IGN1cnJGcmFtZWJ1ZmZlciA9IF9jdXJyZW50UmVuZGVyVGFyZ2V0ICE9PSBudWxsID8gcHJvcGVydGllcy5nZXQoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyIDogbnVsbDsKCQkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGN1cnJGcmFtZWJ1ZmZlciApOwoKCQkJCQkJLy8gY2hlY2sgaWYgdGhlIGNvbW1hbmRzIGhhdmUgZmluaXNoZWQgZXZlcnkgOCBtcwoJCQkJCQljb25zdCBzeW5jID0gX2dsLmZlbmNlU3luYyggX2dsLlNZTkNfR1BVX0NPTU1BTkRTX0NPTVBMRVRFLCAwICk7CgoJCQkJCQlfZ2wuZmx1c2goKTsKCgkJCQkJCWF3YWl0IHByb2JlQXN5bmMoIF9nbCwgc3luYywgNCApOwoKCQkJCQkJLy8gcmVhZCB0aGUgZGF0YSBhbmQgZGVsZXRlIHRoZSBidWZmZXIKCQkJCQkJX2dsLmJpbmRCdWZmZXIoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgZ2xCdWZmZXIgKTsKCQkJCQkJX2dsLmdldEJ1ZmZlclN1YkRhdGEoIF9nbC5QSVhFTF9QQUNLX0JVRkZFUiwgMCwgYnVmZmVyICk7CgkJCQkJCV9nbC5kZWxldGVCdWZmZXIoIGdsQnVmZmVyICk7CgkJCQkJCV9nbC5kZWxldGVTeW5jKCBzeW5jICk7CgoJCQkJCQlyZXR1cm4gYnVmZmVyOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzQXN5bmM6IHJlcXVlc3RlZCByZWFkIGJvdW5kcyBhcmUgb3V0IG9mIHJhbmdlLicgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogQ29waWVzIHBpeGVscyBmcm9tIHRoZSBjdXJyZW50IGJvdW5kIGZyYW1lYnVmZmVyIGludG8gdGhlIGdpdmVuIHRleHR1cmUuCgkJCSAqCgkJCSAqIEBwYXJhbSB7RnJhbWVidWZmZXJUZXh0dXJlfSB0ZXh0dXJlIC0gVGhlIHRleHR1cmUuCgkJCSAqIEBwYXJhbSB7P1ZlY3RvcjJ9IFtwb3NpdGlvbj1udWxsXSAtIFRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgY29weSBvcGVyYXRpb24uCgkJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbGV2ZWw9MF0gLSBUaGUgbWlwIGxldmVsLiBUaGUgZGVmYXVsdCByZXByZXNlbnRzIHRoZSBiYXNlIG1pcC4KCQkJICovCgkJCXRoaXMuY29weUZyYW1lYnVmZmVyVG9UZXh0dXJlID0gZnVuY3Rpb24gKCB0ZXh0dXJlLCBwb3NpdGlvbiA9IG51bGwsIGxldmVsID0gMCApIHsKCgkJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gbGV2ZWwgKTsKCQkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggdGV4dHVyZS5pbWFnZS53aWR0aCAqIGxldmVsU2NhbGUgKTsKCQkJCWNvbnN0IGhlaWdodCA9IE1hdGguZmxvb3IoIHRleHR1cmUuaW1hZ2UuaGVpZ2h0ICogbGV2ZWxTY2FsZSApOwoKCQkJCWNvbnN0IHggPSBwb3NpdGlvbiAhPT0gbnVsbCA/IHBvc2l0aW9uLnggOiAwOwoJCQkJY29uc3QgeSA9IHBvc2l0aW9uICE9PSBudWxsID8gcG9zaXRpb24ueSA6IDA7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgoJCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWwsIDAsIDAsIHgsIHksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9OwoKCQkJY29uc3QgX3NyY0ZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgkJCWNvbnN0IF9kc3RGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJLyoqCgkJCSAqIENvcGllcyBkYXRhIG9mIHRoZSBnaXZlbiBzb3VyY2UgdGV4dHVyZSBpbnRvIGEgZGVzdGluYXRpb24gdGV4dHVyZS4KCQkJICoKCQkJICogV2hlbiB1c2luZyByZW5kZXIgdGFyZ2V0IHRleHR1cmVzIGFzIGBzcmNUZXh0dXJlYCBhbmQgYGRzdFRleHR1cmVgLCB5b3UgbXVzdCBtYWtlIHN1cmUgYm90aCByZW5kZXIgdGFyZ2V0cyBhcmUgaW5pdGlhbGl6ZWQKCQkJICoge0BsaW5rIFdlYkdMUmVuZGVyZXIjaW5pdFJlbmRlclRhcmdldH0uCgkJCSAqCgkJCSAqIEBwYXJhbSB7VGV4dHVyZX0gc3JjVGV4dHVyZSAtIFRoZSBzb3VyY2UgdGV4dHVyZS4KCQkJICogQHBhcmFtIHtUZXh0dXJlfSBkc3RUZXh0dXJlIC0gVGhlIGRlc3RpbmF0aW9uIHRleHR1cmUuCgkJCSAqIEBwYXJhbSB7PyhCb3gyfEJveDMpfSBbc3JjUmVnaW9uPW51bGxdIC0gQSBib3VuZGluZyBib3ggd2hpY2ggZGVzY3JpYmVzIHRoZSBzb3VyY2UgcmVnaW9uLiBDYW4gYmUgdHdvIG9yIHRocmVlLWRpbWVuc2lvbmFsLgoJCQkgKiBAcGFyYW0gez8oVmVjdG9yMnxWZWN0b3IzKX0gW2RzdFBvc2l0aW9uPW51bGxdIC0gQSB2ZWN0b3IgdGhhdCByZXByZXNlbnRzIHRoZSBvcmlnaW4gb2YgdGhlIGRlc3RpbmF0aW9uIHJlZ2lvbi4gQ2FuIGJlIHR3byBvciB0aHJlZS1kaW1lbnNpb25hbC4KCQkJICogQHBhcmFtIHtudW1iZXJ9IFtzcmNMZXZlbD0wXSAtIFRoZSBzb3VyY2UgbWlwbWFwIGxldmVsIHRvIGNvcHkuCgkJCSAqIEBwYXJhbSB7P251bWJlcn0gW2RzdExldmVsPW51bGxdIC0gVGhlIGRlc3RpbmF0aW9uIG1pcG1hcCBsZXZlbC4KCQkJICovCgkJCXRoaXMuY29weVRleHR1cmVUb1RleHR1cmUgPSBmdW5jdGlvbiAoIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIHNyY1JlZ2lvbiA9IG51bGwsIGRzdFBvc2l0aW9uID0gbnVsbCwgc3JjTGV2ZWwgPSAwLCBkc3RMZXZlbCA9IG51bGwgKSB7CgoJCQkJLy8gc3VwcG9ydCB0aGUgcHJldmlvdXMgc2lnbmF0dXJlIHdpdGgganVzdCBhIHNpbmdsZSBkc3QgbWlwbWFwIGxldmVsCgkJCQlpZiAoIGRzdExldmVsID09PSBudWxsICkgewoKCQkJCQlpZiAoIHNyY0xldmVsICE9PSAwICkgewoKCQkJCQkJLy8gQGRlcHJlY2F0ZWQsIHIxNzEKCQkJCQkJd2Fybk9uY2UoICdXZWJHTFJlbmRlcmVyOiBjb3B5VGV4dHVyZVRvVGV4dHVyZSBmdW5jdGlvbiBzaWduYXR1cmUgaGFzIGNoYW5nZWQgdG8gc3VwcG9ydCBzcmMgYW5kIGRzdCBtaXBtYXAgbGV2ZWxzLicgKTsKCQkJCQkJZHN0TGV2ZWwgPSBzcmNMZXZlbDsKCQkJCQkJc3JjTGV2ZWwgPSAwOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZHN0TGV2ZWwgPSAwOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGdhdGhlciB0aGUgbmVjZXNzYXJ5IGRpbWVuc2lvbnMgdG8gY29weQoJCQkJbGV0IHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBtaW5YLCBtaW5ZLCBtaW5aOwoJCQkJbGV0IGRzdFgsIGRzdFksIGRzdFo7CgkJCQljb25zdCBpbWFnZSA9IHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSA/IHNyY1RleHR1cmUubWlwbWFwc1sgZHN0TGV2ZWwgXSA6IHNyY1RleHR1cmUuaW1hZ2U7CgkJCQlpZiAoIHNyY1JlZ2lvbiAhPT0gbnVsbCApIHsKCgkJCQkJd2lkdGggPSBzcmNSZWdpb24ubWF4LnggLSBzcmNSZWdpb24ubWluLng7CgkJCQkJaGVpZ2h0ID0gc3JjUmVnaW9uLm1heC55IC0gc3JjUmVnaW9uLm1pbi55OwoJCQkJCWRlcHRoID0gc3JjUmVnaW9uLmlzQm94MyA/IHNyY1JlZ2lvbi5tYXgueiAtIHNyY1JlZ2lvbi5taW4ueiA6IDE7CgkJCQkJbWluWCA9IHNyY1JlZ2lvbi5taW4ueDsKCQkJCQltaW5ZID0gc3JjUmVnaW9uLm1pbi55OwoJCQkJCW1pblogPSBzcmNSZWdpb24uaXNCb3gzID8gc3JjUmVnaW9uLm1pbi56IDogMDsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zdCBsZXZlbFNjYWxlID0gTWF0aC5wb3coIDIsIC0gc3JjTGV2ZWwgKTsKCQkJCQl3aWR0aCA9IE1hdGguZmxvb3IoIGltYWdlLndpZHRoICogbGV2ZWxTY2FsZSApOwoJCQkJCWhlaWdodCA9IE1hdGguZmxvb3IoIGltYWdlLmhlaWdodCAqIGxldmVsU2NhbGUgKTsKCQkJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlICkgewoKCQkJCQkJZGVwdGggPSBpbWFnZS5kZXB0aDsKCgkJCQkJfSBlbHNlIGlmICggc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJCQlkZXB0aCA9IE1hdGguZmxvb3IoIGltYWdlLmRlcHRoICogbGV2ZWxTY2FsZSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJZGVwdGggPSAxOwoKCQkJCQl9CgoJCQkJCW1pblggPSAwOwoJCQkJCW1pblkgPSAwOwoJCQkJCW1pblogPSAwOwoKCQkJCX0KCgkJCQlpZiAoIGRzdFBvc2l0aW9uICE9PSBudWxsICkgewoKCQkJCQlkc3RYID0gZHN0UG9zaXRpb24ueDsKCQkJCQlkc3RZID0gZHN0UG9zaXRpb24ueTsKCQkJCQlkc3RaID0gZHN0UG9zaXRpb24uejsKCgkJCQl9IGVsc2UgewoKCQkJCQlkc3RYID0gMDsKCQkJCQlkc3RZID0gMDsKCQkJCQlkc3RaID0gMDsKCgkJCQl9CgoJCQkJLy8gU2V0IHVwIHRoZSBkZXN0aW5hdGlvbiB0YXJnZXQKCQkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS5mb3JtYXQgKTsKCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIGRzdFRleHR1cmUudHlwZSApOwoJCQkJbGV0IGdsVGFyZ2V0OwoKCQkJCWlmICggZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJCXRleHR1cmVzLnNldFRleHR1cmUzRCggZHN0VGV4dHVyZSwgMCApOwoJCQkJCWdsVGFyZ2V0ID0gX2dsLlRFWFRVUkVfM0Q7CgoJCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgZHN0VGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCBkc3RUZXh0dXJlLCAwICk7CgkJCQkJZ2xUYXJnZXQgPSBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIGRzdFRleHR1cmUsIDAgKTsKCQkJCQlnbFRhcmdldCA9IF9nbC5URVhUVVJFXzJEOwoKCQkJCX0KCgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBkc3RUZXh0dXJlLmZsaXBZICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGRzdFRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgZHN0VGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCgkJCQkvLyB1c2VkIGZvciBjb3B5aW5nIGRhdGEgZnJvbSBjcHUKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tSb3dMZW4gPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1JPV19MRU5HVEggKTsKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tJbWFnZUhlaWdodCA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfSU1BR0VfSEVJR0hUICk7CgkJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKCQkJCWNvbnN0IGN1cnJlbnRVbnBhY2tTa2lwUm93cyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTICk7CgkJCQljb25zdCBjdXJyZW50VW5wYWNrU2tpcEltYWdlcyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMgKTsKCgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgaW1hZ2Uud2lkdGggKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQsIGltYWdlLmhlaWdodCApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfUElYRUxTLCBtaW5YICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTLCBtaW5ZICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIG1pblogKTsKCgkJCQkvLyBzZXQgdXAgdGhlIHNyYyB0ZXh0dXJlCgkJCQljb25zdCBpc1NyYzNEID0gc3JjVGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmU7CgkJCQljb25zdCBpc0RzdDNEID0gZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmU7CgkJCQlpZiAoIHNyY1RleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJCWNvbnN0IHNyY1RleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHNyY1RleHR1cmUgKTsKCQkJCQljb25zdCBkc3RUZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBkc3RUZXh0dXJlICk7CgkJCQkJY29uc3Qgc3JjUmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlUHJvcGVydGllcy5fX3JlbmRlclRhcmdldCApOwoJCQkJCWNvbnN0IGRzdFJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZVByb3BlcnRpZXMuX19yZW5kZXJUYXJnZXQgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBzcmNSZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIGRzdFJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGRlcHRoOyBpICsrICkgewoKCQkJCQkJLy8gaWYgdGhlIHNvdXJjZSBvciBkZXN0aW5hdGlvbiBhcmUgYSAzZCB0YXJnZXQgdGhlbiBhIGxheWVyIG5lZWRzIHRvIGJlIGJvdW5kCgkJCQkJCWlmICggaXNTcmMzRCApIHsKCgkJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlTGF5ZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIHByb3BlcnRpZXMuZ2V0KCBzcmNUZXh0dXJlICkuX193ZWJnbFRleHR1cmUsIHNyY0xldmVsLCBtaW5aICsgaSApOwoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBwcm9wZXJ0aWVzLmdldCggZHN0VGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlLCBkc3RMZXZlbCwgZHN0WiArIGkgKTsKCgkJCQkJCX0KCgkJCQkJCV9nbC5ibGl0RnJhbWVidWZmZXIoIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIF9nbC5ERVBUSF9CVUZGRVJfQklULCBfZ2wuTkVBUkVTVCApOwoKCQkJCQl9CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLlJFQURfRlJBTUVCVUZGRVIsIG51bGwgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgoJCQkJfSBlbHNlIGlmICggc3JjTGV2ZWwgIT09IDAgfHwgc3JjVGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgfHwgcHJvcGVydGllcy5oYXMoIHNyY1RleHR1cmUgKSApIHsKCgkJCQkJLy8gZ2V0IHRoZSBhcHByb3ByaWF0ZSBmcmFtZSBidWZmZXJzCgkJCQkJY29uc3Qgc3JjVGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc3JjVGV4dHVyZSApOwoJCQkJCWNvbnN0IGRzdFRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIGRzdFRleHR1cmUgKTsKCgkJCQkJLy8gYmluZCB0aGUgZnJhbWUgYnVmZmVyIHRhcmdldHMKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBfc3JjRnJhbWVidWZmZXIgKTsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZHN0RnJhbWVidWZmZXIgKTsKCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGVwdGg7IGkgKysgKSB7CgoJCQkJCQkvLyBhc3NpZ24gdGhlIGNvcnJlY3QgbGF5ZXJzIGFuZCBtaXAgbWFwcyB0byB0aGUgZnJhbWUgYnVmZmVycwoJCQkJCQlpZiAoIGlzU3JjM0QgKSB7CgoJCQkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBzcmNUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgc3JjTGV2ZWwsIG1pblogKyBpICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLlJFQURfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHNyY1RleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBzcmNMZXZlbCApOwoKCQkJCQkJfQoKCQkJCQkJaWYgKCBpc0RzdDNEICkgewoKCQkJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmVMYXllciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgZHN0VGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGRzdExldmVsLCBkc3RaICsgaSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFXzJELCBkc3RUZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgZHN0TGV2ZWwgKTsKCgkJCQkJCX0KCgkJCQkJCS8vIGNvcHkgdGhlIGRhdGEgdXNpbmcgdGhlIGZhc3Rlc3QgZnVuY3Rpb24gdGhhdCBjYW4gYWNoaWV2ZSB0aGUgY29weQoJCQkJCQlpZiAoIHNyY0xldmVsICE9PSAwICkgewoKCQkJCQkJCV9nbC5ibGl0RnJhbWVidWZmZXIoIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIF9nbC5DT0xPUl9CVUZGRVJfQklULCBfZ2wuTkVBUkVTVCApOwoKCQkJCQkJfSBlbHNlIGlmICggaXNEc3QzRCApIHsKCgkJCQkJCQlfZ2wuY29weVRleFN1YkltYWdlM0QoIGdsVGFyZ2V0LCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgZHN0WiArIGksIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJX2dsLmNvcHlUZXhTdWJJbWFnZTJEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIG1pblgsIG1pblksIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQkvLyB1bmJpbmQgcmVhZCwgZHJhdyBidWZmZXJzCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIGlzRHN0M0QgKSB7CgoJCQkJCQkvLyBjb3B5IGRhdGEgaW50byB0aGUgM2QgdGV4dHVyZQoJCQkJCQlpZiAoIHNyY1RleHR1cmUuaXNEYXRhVGV4dHVyZSB8fCBzcmNUZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCQkJX2dsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCBnbFRhcmdldCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIGRzdFosIHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBnbEZvcm1hdCwgaW1hZ2UuZGF0YSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGRzdExldmVsLCBkc3RYLCBkc3RZLCBkc3RaLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGNvcHkgZGF0YSBpbnRvIHRoZSAyZCB0ZXh0dXJlCgkJCQkJCWlmICggc3JjVGV4dHVyZS5pc0RhdGFUZXh0dXJlICkgewoKCQkJCQkJCV9nbC50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgZHN0TGV2ZWwsIGRzdFgsIGRzdFksIHdpZHRoLCBoZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSBpZiAoIHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQkJCQlfZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgZ2xGb3JtYXQsIGltYWdlLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJX2dsLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBkc3RMZXZlbCwgZHN0WCwgZHN0WSwgd2lkdGgsIGhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyByZXNldCB2YWx1ZXMKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19ST1dfTEVOR1RILCBjdXJyZW50VW5wYWNrUm93TGVuICk7CgkJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfSU1BR0VfSEVJR0hULCBjdXJyZW50VW5wYWNrSW1hZ2VIZWlnaHQgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgY3VycmVudFVucGFja1NraXBQaXhlbHMgKTsKCQkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIGN1cnJlbnRVbnBhY2tTa2lwUm93cyApOwoJCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1NLSVBfSU1BR0VTLCBjdXJyZW50VW5wYWNrU2tpcEltYWdlcyApOwoKCQkJCS8vIEdlbmVyYXRlIG1pcG1hcHMgb25seSB3aGVuIGNvcHlpbmcgbGV2ZWwgMAoJCQkJaWYgKCBkc3RMZXZlbCA9PT0gMCAmJiBkc3RUZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyApIHsKCgkJCQkJX2dsLmdlbmVyYXRlTWlwbWFwKCBnbFRhcmdldCApOwoKCQkJCX0KCgkJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCQl9OwoKCQkJdGhpcy5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEID0gZnVuY3Rpb24gKCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBzcmNSZWdpb24gPSBudWxsLCBkc3RQb3NpdGlvbiA9IG51bGwsIGxldmVsID0gMCApIHsKCgkJCQkvLyBAZGVwcmVjYXRlZCwgcjE3MAoJCQkJd2Fybk9uY2UoICdXZWJHTFJlbmRlcmVyOiBjb3B5VGV4dHVyZVRvVGV4dHVyZTNEIGZ1bmN0aW9uIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAiY29weVRleHR1cmVUb1RleHR1cmUiIGluc3RlYWQuJyApOwoKCQkJCXJldHVybiB0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlKCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBzcmNSZWdpb24sIGRzdFBvc2l0aW9uLCBsZXZlbCApOwoKCQkJfTsKCgkJCS8qKgoJCQkgKiBJbml0aWFsaXplcyB0aGUgZ2l2ZW4gV2ViR0xSZW5kZXJUYXJnZXQgbWVtb3J5LiBVc2VmdWwgZm9yIGluaXRpYWxpemluZyBhIHJlbmRlciB0YXJnZXQgc28gZGF0YQoJCQkgKiBjYW4gYmUgY29waWVkIGludG8gaXQgdXNpbmcge0BsaW5rIFdlYkdMUmVuZGVyZXIjY29weVRleHR1cmVUb1RleHR1cmV9IGJlZm9yZSBpdCBoYXMgYmVlbgoJCQkgKiByZW5kZXJlZCB0by4KCQkJICoKCQkJICogQHBhcmFtIHtXZWJHTFJlbmRlclRhcmdldH0gdGFyZ2V0IC0gVGhlIHJlbmRlciB0YXJnZXQuCgkJCSAqLwoJCQl0aGlzLmluaXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCQlpZiAoIHByb3BlcnRpZXMuZ2V0KCB0YXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGV4dHVyZXMuc2V0dXBSZW5kZXJUYXJnZXQoIHRhcmdldCApOwoKCQkJCX0KCgkJCX07CgoJCQkvKioKCQkJICogSW5pdGlhbGl6ZXMgdGhlIGdpdmVuIHRleHR1cmUuIFVzZWZ1bCBmb3IgcHJlbG9hZGluZyBhIHRleHR1cmUgcmF0aGVyIHRoYW4gd2FpdGluZyB1bnRpbCBmaXJzdAoJCQkgKiByZW5kZXIgKHdoaWNoIGNhbiBjYXVzZSBub3RpY2VhYmxlIGxhZ3MgZHVlIHRvIGRlY29kZSBhbmQgR1BVIHVwbG9hZCBvdmVyaGVhZCkuCgkJCSAqCgkJCSAqIEBwYXJhbSB7VGV4dHVyZX0gdGV4dHVyZSAtIFRoZSB0ZXh0dXJlLgoJCQkgKi8KCQkJdGhpcy5pbml0VGV4dHVyZSA9IGZ1bmN0aW9uICggdGV4dHVyZSApIHsKCgkJCQlpZiAoIHRleHR1cmUuaXNDdWJlVGV4dHVyZSApIHsKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIDAgKTsKCgkJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCB0ZXh0dXJlLCAwICk7CgoJCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJCXRleHR1cmVzLnNldFRleHR1cmUyREFycmF5KCB0ZXh0dXJlLCAwICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgoJCQkJfQoKCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCX07CgoJCQkvKioKCQkJICogQ2FuIGJlIHVzZWQgdG8gcmVzZXQgdGhlIGludGVybmFsIFdlYkdMIHN0YXRlLiBUaGlzIG1ldGhvZCBpcyBtb3N0bHkKCQkJICogcmVsZXZhbnQgZm9yIGFwcGxpY2F0aW9ucyB3aGljaCBzaGFyZSBhIHNpbmdsZSBXZWJHTCBjb250ZXh0IGFjcm9zcwoJCQkgKiBtdWx0aXBsZSBXZWJHTCBsaWJyYXJpZXMuCgkJCSAqLwoJCQl0aGlzLnJlc2V0U3RhdGUgPSBmdW5jdGlvbiAoKSB7CgoJCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IDA7CgkJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKCQkJCV9jdXJyZW50UmVuZGVyVGFyZ2V0ID0gbnVsbDsKCgkJCQlzdGF0ZS5yZXNldCgpOwoJCQkJYmluZGluZ1N0YXRlcy5yZXNldCgpOwoKCQkJfTsKCgkJCWlmICggdHlwZW9mIF9fVEhSRUVfREVWVE9PTFNfXyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgoJCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJCX0KCgkJfQoKCQkvKioKCQkgKiBEZWZpbmVzIHRoZSBjb29yZGluYXRlIHN5c3RlbSBvZiB0aGUgcmVuZGVyZXIuCgkJICoKCQkgKiBJbiBgV2ViR0xSZW5kZXJlcmAsIHRoZSB2YWx1ZSBpcyBhbHdheXMgYFdlYkdMQ29vcmRpbmF0ZVN5c3RlbWAuCgkJICoKCQkgKiBAdHlwZSB7V2ViR0xDb29yZGluYXRlU3lzdGVtfFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW19CgkJICogQGRlZmF1bHQgV2ViR0xDb29yZGluYXRlU3lzdGVtCgkJICogQHJlYWRvbmx5CgkJICovCgkJZ2V0IGNvb3JkaW5hdGVTeXN0ZW0oKSB7CgoJCQlyZXR1cm4gV2ViR0xDb29yZGluYXRlU3lzdGVtOwoKCQl9CgoJCS8qKgoJCSAqIERlZmluZXMgdGhlIG91dHB1dCBjb2xvciBzcGFjZSBvZiB0aGUgcmVuZGVyZXIuCgkJICoKCQkgKiBAdHlwZSB7U1JHQkNvbG9yU3BhY2V8TGluZWFyU1JHQkNvbG9yU3BhY2V9CgkJICogQGRlZmF1bHQgU1JHQkNvbG9yU3BhY2UKCQkgKi8KCQlnZXQgb3V0cHV0Q29sb3JTcGFjZSgpIHsKCgkJCXJldHVybiB0aGlzLl9vdXRwdXRDb2xvclNwYWNlOwoKCQl9CgoJCXNldCBvdXRwdXRDb2xvclNwYWNlKCBjb2xvclNwYWNlICkgewoKCQkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgoJCQljb25zdCBnbCA9IHRoaXMuZ2V0Q29udGV4dCgpOwoJCQlnbC5kcmF3aW5nQnVmZmVyQ29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC5fZ2V0RHJhd2luZ0J1ZmZlckNvbG9yU3BhY2UoIGNvbG9yU3BhY2UgKTsKCQkJZ2wudW5wYWNrQ29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC5fZ2V0VW5wYWNrQ29sb3JTcGFjZSgpOwoKCQl9CgoJfQoKCXZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9OwoKCWZ1bmN0aW9uIGdldERlZmF1bHRFeHBvcnRGcm9tQ2pzICh4KSB7CgkJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKCX0KCgl2YXIgd2VidnJQb2x5ZmlsbCQxID0ge2V4cG9ydHM6IHt9fTsKCgkvKioKCSAqIEBsaWNlbnNlCgkgKiB3ZWJ2ci1wb2x5ZmlsbAoJICogQ29weXJpZ2h0IChjKSAyMDE1LTIwMTcgR29vZ2xlCgkgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJICoKCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJICoKCSAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCSAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJICovCgl2YXIgd2VidnJQb2x5ZmlsbCA9IHdlYnZyUG9seWZpbGwkMS5leHBvcnRzOwoKCXZhciBoYXNSZXF1aXJlZFdlYnZyUG9seWZpbGw7CgoJZnVuY3Rpb24gcmVxdWlyZVdlYnZyUG9seWZpbGwgKCkgewoJCWlmIChoYXNSZXF1aXJlZFdlYnZyUG9seWZpbGwpIHJldHVybiB3ZWJ2clBvbHlmaWxsJDEuZXhwb3J0czsKCQloYXNSZXF1aXJlZFdlYnZyUG9seWZpbGwgPSAxOwoJCShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiBjYXJkYm9hcmQtdnItZGlzcGxheQoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKCQkJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkJCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCQkJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkJCSAqCgkJCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCQkgKgoJCQkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkJCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkJCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJCQkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkJCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJCQkgKi8KCgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiB3ZWJ2ci1wb2x5ZmlsbC1kcGRiIAoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTcgR29vZ2xlCgkJCSAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOwoJCQkgKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCgkJCSAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAoJCQkgKgoJCQkgKiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKCQkJICoKCQkJICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZQoJCQkgKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAoJCQkgKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KCQkJICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAoJCQkgKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KCQkJICovCgoJCQkvKioKCQkJICogQGxpY2Vuc2UKCQkJICogd2dsdS1wcmVzZXJ2ZS1zdGF0ZQoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTYsIEJyYW5kb24gSm9uZXMuCgkJCSAqCgkJCSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKCQkJICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKCQkJICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwoJCQkgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCgkJCSAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoJCQkgKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoJCQkgKgoJCQkgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgoJCQkgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCQkJICoKCQkJICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKCQkJICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCgkJCSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQoJCQkgKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCgkJCSAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCgkJCSAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KCQkJICogVEhFIFNPRlRXQVJFLgoJCQkgKi8KCgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiBub3NsZWVwLmpzCgkJCSAqIENvcHlyaWdodCAoYykgMjAxNywgUmljaCBUaWJiZXR0CgkJCSAqCgkJCSAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkKCQkJICogb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwKCQkJICogaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cwoJCQkgKiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsCgkJCSAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcwoJCQkgKiBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoJCQkgKgoJCQkgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbgoJCQkgKiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KCQkJICoKCQkJICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKCQkJICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksCgkJCSAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRQoJCQkgKiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSCgkJCSAqIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sCgkJCSAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4KCQkJICogVEhFIFNPRlRXQVJFLgoJCQkgKi8KCgkJCShmdW5jdGlvbiAoZ2xvYmFsLCBmYWN0b3J5KSB7CgkJCQltb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA7CgkJCX0od2VidnJQb2x5ZmlsbCwgKGZ1bmN0aW9uICgpIHsKCQkJdmFyIGNvbW1vbmpzR2xvYmFsJDEgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBjb21tb25qc0dsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBjb21tb25qc0dsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB7fTsKCgoKCQkJZnVuY3Rpb24gdW53cmFwRXhwb3J0cyAoeCkgewoJCQkJcmV0dXJuIHggJiYgeC5fX2VzTW9kdWxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh4LCAnZGVmYXVsdCcpID8geFsnZGVmYXVsdCddIDogeDsKCQkJfQoKCQkJZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUoZm4sIG1vZHVsZSkgewoJCQkJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwoJCQl9CgoJCQl2YXIgaXNNb2JpbGUgPSBmdW5jdGlvbiBpc01vYmlsZSgpIHsKCQkJICByZXR1cm4gKC9BbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSB8fCAvaVBob25lfGlQYWR8aVBvZC9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkKCQkJICApOwoJCQl9OwoJCQl2YXIgY29weUFycmF5ID0gZnVuY3Rpb24gY29weUFycmF5KHNvdXJjZSwgZGVzdCkgewoJCQkgIGZvciAodmFyIGkgPSAwLCBuID0gc291cmNlLmxlbmd0aDsgaSA8IG47IGkrKykgewoJCQkgICAgZGVzdFtpXSA9IHNvdXJjZVtpXTsKCQkJICB9CgkJCX07CgkJCXZhciBleHRlbmQgPSBmdW5jdGlvbiBleHRlbmQoZGVzdCwgc3JjKSB7CgkJCSAgZm9yICh2YXIga2V5IGluIHNyYykgewoJCQkgICAgaWYgKHNyYy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CgkJCSAgICAgIGRlc3Rba2V5XSA9IHNyY1trZXldOwoJCQkgICAgfQoJCQkgIH0KCQkJICByZXR1cm4gZGVzdDsKCQkJfTsKCgkJCXZhciBjYXJkYm9hcmRWckRpc3BsYXkgPSBjcmVhdGVDb21tb25qc01vZHVsZShmdW5jdGlvbiAobW9kdWxlLCBleHBvcnRzKSB7CgkJCS8qKgoJCQkgKiBAbGljZW5zZQoJCQkgKiBjYXJkYm9hcmQtdnItZGlzcGxheQoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKCQkJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkJCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCQkJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkJCSAqCgkJCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCQkgKgoJCQkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkJCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkJCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJCQkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkJCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJCQkgKi8KCQkJLyoqCgkJCSAqIEBsaWNlbnNlCgkJCSAqIGdsLXByZXNlcnZlLXN0YXRlCgkJCSAqIENvcHlyaWdodCAoYykgMjAxNiwgQnJhbmRvbiBKb25lcy4KCQkJICoKCQkJICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQoJCQkgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAoJCQkgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCgkJCSAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKCQkJICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCgkJCSAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgkJCSAqCgkJCSAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCgkJCSAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoJCQkgKgoJCQkgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgoJCQkgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKCQkJICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCgkJCSAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKCQkJICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKCQkJICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgoJCQkgKiBUSEUgU09GVFdBUkUuCgkJCSAqLwoJCQkvKioKCQkJICogQGxpY2Vuc2UKCQkJICogd2VidnItcG9seWZpbGwtZHBkYgoJCQkgKiBDb3B5cmlnaHQgKGMpIDIwMTUtMjAxNyBHb29nbGUKCQkJICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7CgkJCSAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4KCQkJICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgkJCSAqCgkJCSAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoJCQkgKgoJCQkgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCgkJCSAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCgkJCSAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgoJCQkgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCgkJCSAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgoJCQkgKi8KCQkJLyoqCgkJCSAqIEBsaWNlbnNlCgkJCSAqIG5vc2xlZXAuanMKCQkJICogQ29weXJpZ2h0IChjKSAyMDE3LCBSaWNoIFRpYmJldHQKCQkJICoKCQkJICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQoJCQkgKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAoJCQkgKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCgkJCSAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKCQkJICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCgkJCSAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CgkJCSAqCgkJCSAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluCgkJCSAqIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoJCQkgKgoJCQkgKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgoJCQkgKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwKCQkJICogRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFCgkJCSAqIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIKCQkJICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwKCQkJICogT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTgoJCQkgKiBUSEUgU09GVFdBUkUuCgkJCSAqLwoJCQkoZnVuY3Rpb24gKGdsb2JhbCwgZmFjdG9yeSkgewoJCQkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CgkJCX0oY29tbW9uanNHbG9iYWwkMSwgKGZ1bmN0aW9uICgpIHsgdmFyIGNsYXNzQ2FsbENoZWNrID0gZnVuY3Rpb24gKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewoJCQkgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CgkJCSAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsKCQkJICB9CgkJCX07CgkJCXZhciBjcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsKCQkJICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKCQkJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKCQkJICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsKCQkJICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwoJCQkgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CgkJCSAgICAgIGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOwoJCQkgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CgkJCSAgICB9CgkJCSAgfQoJCQkgIHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CgkJCSAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOwoJCQkgICAgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CgkJCSAgICByZXR1cm4gQ29uc3RydWN0b3I7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgc2xpY2VkVG9BcnJheSA9IGZ1bmN0aW9uICgpIHsKCQkJICBmdW5jdGlvbiBzbGljZUl0ZXJhdG9yKGFyciwgaSkgewoJCQkgICAgdmFyIF9hcnIgPSBbXTsKCQkJICAgIHZhciBfbiA9IHRydWU7CgkJCSAgICB2YXIgX2QgPSBmYWxzZTsKCQkJICAgIHZhciBfZSA9IHVuZGVmaW5lZDsKCQkJICAgIHRyeSB7CgkJCSAgICAgIGZvciAodmFyIF9pID0gYXJyW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3M7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHsKCQkJICAgICAgICBfYXJyLnB1c2goX3MudmFsdWUpOwoJCQkgICAgICAgIGlmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazsKCQkJICAgICAgfQoJCQkgICAgfSBjYXRjaCAoZXJyKSB7CgkJCSAgICAgIF9kID0gdHJ1ZTsKCQkJICAgICAgX2UgPSBlcnI7CgkJCSAgICB9IGZpbmFsbHkgewoJCQkgICAgICB0cnkgewoJCQkgICAgICAgIGlmICghX24gJiYgX2lbInJldHVybiJdKSBfaVsicmV0dXJuIl0oKTsKCQkJICAgICAgfSBmaW5hbGx5IHsKCQkJICAgICAgICBpZiAoX2QpIHRocm93IF9lOwoJCQkgICAgICB9CgkJCSAgICB9CgkJCSAgICByZXR1cm4gX2FycjsKCQkJICB9CgkJCSAgcmV0dXJuIGZ1bmN0aW9uIChhcnIsIGkpIHsKCQkJICAgIGlmIChBcnJheS5pc0FycmF5KGFycikpIHsKCQkJICAgICAgcmV0dXJuIGFycjsKCQkJICAgIH0gZWxzZSBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChhcnIpKSB7CgkJCSAgICAgIHJldHVybiBzbGljZUl0ZXJhdG9yKGFyciwgaSk7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlIik7CgkJCSAgICB9CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgTUlOX1RJTUVTVEVQID0gMC4wMDE7CgkJCXZhciBNQVhfVElNRVNURVAgPSAxOwoJCQl2YXIgZGF0YVVyaSA9IGZ1bmN0aW9uIGRhdGFVcmkobWltZVR5cGUsIHN2ZykgewoJCQkgIHJldHVybiAnZGF0YTonICsgbWltZVR5cGUgKyAnLCcgKyBlbmNvZGVVUklDb21wb25lbnQoc3ZnKTsKCQkJfTsKCQkJdmFyIGxlcnAgPSBmdW5jdGlvbiBsZXJwKGEsIGIsIHQpIHsKCQkJICByZXR1cm4gYSArIChiIC0gYSkgKiB0OwoJCQl9OwoJCQl2YXIgaXNJT1MgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGlzSU9TID0gL2lQYWR8aVBob25lfGlQb2QvLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKTsKCQkJICByZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkgICAgcmV0dXJuIGlzSU9TOwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGlzV2ViVmlld0FuZHJvaWQgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGlzV2ViVmlld0FuZHJvaWQgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1ZlcnNpb24nKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdBbmRyb2lkJykgIT09IC0xICYmIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgIT09IC0xOwoJCQkgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJCSAgICByZXR1cm4gaXNXZWJWaWV3QW5kcm9pZDsKCQkJICB9OwoJCQl9KCk7CgkJCXZhciBpc1NhZmFyaSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaXNTYWZhcmkgPSAvXigoPyFjaHJvbWV8YW5kcm9pZCkuKSpzYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwoJCQkgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJCSAgICByZXR1cm4gaXNTYWZhcmk7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgaXNGaXJlZm94QW5kcm9pZCA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaXNGaXJlZm94QW5kcm9pZCA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpICE9PSAtMSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0FuZHJvaWQnKSAhPT0gLTE7CgkJCSAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJICAgIHJldHVybiBpc0ZpcmVmb3hBbmRyb2lkOwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGdldENocm9tZVZlcnNpb24gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIG1hdGNoID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvLipDaHJvbWVcLyhbMC05XSspLyk7CgkJCSAgdmFyIHZhbHVlID0gbWF0Y2ggPyBwYXJzZUludChtYXRjaFsxXSwgMTApIDogbnVsbDsKCQkJICByZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkgICAgcmV0dXJuIHZhbHVlOwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGlzU2FmYXJpV2l0aG91dERldmljZU1vdGlvbiA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgdmFsdWUgPSBmYWxzZTsKCQkJICB2YWx1ZSA9IGlzSU9TKCkgJiYgaXNTYWZhcmkoKSAmJiBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJzEzXzQnKSAhPT0gLTE7CgkJCSAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJICAgIHJldHVybiB2YWx1ZTsKCQkJICB9OwoJCQl9KCk7CgkJCXZhciBpc0Nocm9tZVdpdGhvdXREZXZpY2VNb3Rpb24gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHZhbHVlID0gZmFsc2U7CgkJCSAgaWYgKGdldENocm9tZVZlcnNpb24oKSA9PT0gNjUpIHsKCQkJICAgIHZhciBtYXRjaCA9IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goLy4qQ2hyb21lXC8oWzAtOVwuXSopLyk7CgkJCSAgICBpZiAobWF0Y2gpIHsKCQkJICAgICAgdmFyIF9tYXRjaCQxJHNwbGl0ID0gbWF0Y2hbMV0uc3BsaXQoJy4nKSwKCQkJICAgICAgICAgIF9tYXRjaCQxJHNwbGl0MiA9IHNsaWNlZFRvQXJyYXkoX21hdGNoJDEkc3BsaXQsIDQpOwoJCQkgICAgICAgICAgX21hdGNoJDEkc3BsaXQyWzBdOwoJCQkgICAgICAgICAgX21hdGNoJDEkc3BsaXQyWzFdOwoJCQkgICAgICAgICAgdmFyIGJyYW5jaCA9IF9tYXRjaCQxJHNwbGl0MlsyXSwKCQkJICAgICAgICAgIGJ1aWxkID0gX21hdGNoJDEkc3BsaXQyWzNdOwoJCQkgICAgICB2YWx1ZSA9IHBhcnNlSW50KGJyYW5jaCwgMTApID09PSAzMzI1ICYmIHBhcnNlSW50KGJ1aWxkLCAxMCkgPCAxNDg7CgkJCSAgICB9CgkJCSAgfQoJCQkgIHJldHVybiBmdW5jdGlvbiAoKSB7CgkJCSAgICByZXR1cm4gdmFsdWU7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgaXNSNyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaXNSNyA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignUjcgQnVpbGQnKSAhPT0gLTE7CgkJCSAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJICAgIHJldHVybiBpc1I3OwoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGlzTGFuZHNjYXBlTW9kZSA9IGZ1bmN0aW9uIGlzTGFuZHNjYXBlTW9kZSgpIHsKCQkJICB2YXIgcnRuID0gd2luZG93Lm9yaWVudGF0aW9uID09IDkwIHx8IHdpbmRvdy5vcmllbnRhdGlvbiA9PSAtOTA7CgkJCSAgcmV0dXJuIGlzUjcoKSA/ICFydG4gOiBydG47CgkJCX07CgkJCXZhciBpc1RpbWVzdGFtcERlbHRhVmFsaWQgPSBmdW5jdGlvbiBpc1RpbWVzdGFtcERlbHRhVmFsaWQodGltZXN0YW1wRGVsdGFTKSB7CgkJCSAgaWYgKGlzTmFOKHRpbWVzdGFtcERlbHRhUykpIHsKCQkJICAgIHJldHVybiBmYWxzZTsKCQkJICB9CgkJCSAgaWYgKHRpbWVzdGFtcERlbHRhUyA8PSBNSU5fVElNRVNURVApIHsKCQkJICAgIHJldHVybiBmYWxzZTsKCQkJICB9CgkJCSAgaWYgKHRpbWVzdGFtcERlbHRhUyA+IE1BWF9USU1FU1RFUCkgewoJCQkgICAgcmV0dXJuIGZhbHNlOwoJCQkgIH0KCQkJICByZXR1cm4gdHJ1ZTsKCQkJfTsKCQkJdmFyIGdldFNjcmVlbldpZHRoID0gZnVuY3Rpb24gZ2V0U2NyZWVuV2lkdGgoKSB7CgkJCSAgcmV0dXJuIE1hdGgubWF4KHdpbmRvdy5zY3JlZW4ud2lkdGgsIHdpbmRvdy5zY3JlZW4uaGVpZ2h0KSAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwoJCQl9OwoJCQl2YXIgZ2V0U2NyZWVuSGVpZ2h0ID0gZnVuY3Rpb24gZ2V0U2NyZWVuSGVpZ2h0KCkgewoJCQkgIHJldHVybiBNYXRoLm1pbih3aW5kb3cuc2NyZWVuLndpZHRoLCB3aW5kb3cuc2NyZWVuLmhlaWdodCkgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzsKCQkJfTsKCQkJdmFyIHJlcXVlc3RGdWxsc2NyZWVuID0gZnVuY3Rpb24gcmVxdWVzdEZ1bGxzY3JlZW4oZWxlbWVudCkgewoJCQkgIHJldHVybiB0cnVlOwoJCQl9OwoJCQl2YXIgZXhpdEZ1bGxzY3JlZW4gPSBmdW5jdGlvbiBleGl0RnVsbHNjcmVlbigpIHsKCQkJICBpZiAoZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4pIHsKCQkJICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CgkJCSAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRFeGl0RnVsbHNjcmVlbikgewoJCQkgICAgZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTsKCQkJICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4pIHsKCQkJICAgIGRvY3VtZW50Lm1vekNhbmNlbEZ1bGxTY3JlZW4oKTsKCQkJICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4pIHsKCQkJICAgIGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW4oKTsKCQkJICB9IGVsc2UgewoJCQkgICAgcmV0dXJuIGZhbHNlOwoJCQkgIH0KCQkJICByZXR1cm4gdHJ1ZTsKCQkJfTsKCQkJdmFyIGdldEZ1bGxzY3JlZW5FbGVtZW50ID0gZnVuY3Rpb24gZ2V0RnVsbHNjcmVlbkVsZW1lbnQoKSB7CgkJCSAgcmV0dXJuIGRvY3VtZW50LmZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50LndlYmtpdEZ1bGxzY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbGVtZW50IHx8IGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVsZW1lbnQ7CgkJCX07CgkJCXZhciBsaW5rUHJvZ3JhbSA9IGZ1bmN0aW9uIGxpbmtQcm9ncmFtKGdsLCB2ZXJ0ZXhTb3VyY2UsIGZyYWdtZW50U291cmNlLCBhdHRyaWJMb2NhdGlvbk1hcCkgewoJCQkgIHZhciB2ZXJ0ZXhTaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIoZ2wuVkVSVEVYX1NIQURFUik7CgkJCSAgZ2wuc2hhZGVyU291cmNlKHZlcnRleFNoYWRlciwgdmVydGV4U291cmNlKTsKCQkJICBnbC5jb21waWxlU2hhZGVyKHZlcnRleFNoYWRlcik7CgkJCSAgdmFyIGZyYWdtZW50U2hhZGVyID0gZ2wuY3JlYXRlU2hhZGVyKGdsLkZSQUdNRU5UX1NIQURFUik7CgkJCSAgZ2wuc2hhZGVyU291cmNlKGZyYWdtZW50U2hhZGVyLCBmcmFnbWVudFNvdXJjZSk7CgkJCSAgZ2wuY29tcGlsZVNoYWRlcihmcmFnbWVudFNoYWRlcik7CgkJCSAgdmFyIHByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7CgkJCSAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRleFNoYWRlcik7CgkJCSAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTsKCQkJICBmb3IgKHZhciBhdHRyaWJOYW1lIGluIGF0dHJpYkxvY2F0aW9uTWFwKSB7CgkJCSAgICBnbC5iaW5kQXR0cmliTG9jYXRpb24ocHJvZ3JhbSwgYXR0cmliTG9jYXRpb25NYXBbYXR0cmliTmFtZV0sIGF0dHJpYk5hbWUpOwoJCQkgIH1nbC5saW5rUHJvZ3JhbShwcm9ncmFtKTsKCQkJICBnbC5kZWxldGVTaGFkZXIodmVydGV4U2hhZGVyKTsKCQkJICBnbC5kZWxldGVTaGFkZXIoZnJhZ21lbnRTaGFkZXIpOwoJCQkgIHJldHVybiBwcm9ncmFtOwoJCQl9OwoJCQl2YXIgZ2V0UHJvZ3JhbVVuaWZvcm1zID0gZnVuY3Rpb24gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCBwcm9ncmFtKSB7CgkJCSAgdmFyIHVuaWZvcm1zID0ge307CgkJCSAgdmFyIHVuaWZvcm1Db3VudCA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIocHJvZ3JhbSwgZ2wuQUNUSVZFX1VOSUZPUk1TKTsKCQkJICB2YXIgdW5pZm9ybU5hbWUgPSAnJzsKCQkJICBmb3IgKHZhciBpID0gMDsgaSA8IHVuaWZvcm1Db3VudDsgaSsrKSB7CgkJCSAgICB2YXIgdW5pZm9ybUluZm8gPSBnbC5nZXRBY3RpdmVVbmlmb3JtKHByb2dyYW0sIGkpOwoJCQkgICAgdW5pZm9ybU5hbWUgPSB1bmlmb3JtSW5mby5uYW1lLnJlcGxhY2UoJ1swXScsICcnKTsKCQkJICAgIHVuaWZvcm1zW3VuaWZvcm1OYW1lXSA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCB1bmlmb3JtTmFtZSk7CgkJCSAgfQoJCQkgIHJldHVybiB1bmlmb3JtczsKCQkJfTsKCQkJdmFyIG9ydGhvTWF0cml4ID0gZnVuY3Rpb24gb3J0aG9NYXRyaXgob3V0LCBsZWZ0LCByaWdodCwgYm90dG9tLCB0b3AsIG5lYXIsIGZhcikgewoJCQkgIHZhciBsciA9IDEgLyAobGVmdCAtIHJpZ2h0KSwKCQkJICAgICAgYnQgPSAxIC8gKGJvdHRvbSAtIHRvcCksCgkJCSAgICAgIG5mID0gMSAvIChuZWFyIC0gZmFyKTsKCQkJICBvdXRbMF0gPSAtMiAqIGxyOwoJCQkgIG91dFsxXSA9IDA7CgkJCSAgb3V0WzJdID0gMDsKCQkJICBvdXRbM10gPSAwOwoJCQkgIG91dFs0XSA9IDA7CgkJCSAgb3V0WzVdID0gLTIgKiBidDsKCQkJICBvdXRbNl0gPSAwOwoJCQkgIG91dFs3XSA9IDA7CgkJCSAgb3V0WzhdID0gMDsKCQkJICBvdXRbOV0gPSAwOwoJCQkgIG91dFsxMF0gPSAyICogbmY7CgkJCSAgb3V0WzExXSA9IDA7CgkJCSAgb3V0WzEyXSA9IChsZWZ0ICsgcmlnaHQpICogbHI7CgkJCSAgb3V0WzEzXSA9ICh0b3AgKyBib3R0b20pICogYnQ7CgkJCSAgb3V0WzE0XSA9IChmYXIgKyBuZWFyKSAqIG5mOwoJCQkgIG91dFsxNV0gPSAxOwoJCQkgIHJldHVybiBvdXQ7CgkJCX07CgkJCXZhciBpc01vYmlsZSA9IGZ1bmN0aW9uIGlzTW9iaWxlKCkgewoJCQkgIHZhciBjaGVjayA9IGZhbHNlOwoJCQkgIChmdW5jdGlvbiAoYSkgewoJCQkgICAgaWYgKC8oYW5kcm9pZHxiYlxkK3xtZWVnbykuK21vYmlsZXxhdmFudGdvfGJhZGFcL3xibGFja2JlcnJ5fGJsYXplcnxjb21wYWx8ZWxhaW5lfGZlbm5lY3xoaXB0b3B8aWVtb2JpbGV8aXAoaG9uZXxvZCl8aXJpc3xraW5kbGV8bGdlIHxtYWVtb3xtaWRwfG1tcHxtb2JpbGUuK2ZpcmVmb3h8bmV0ZnJvbnR8b3BlcmEgbShvYnxpbilpfHBhbG0oIG9zKT98cGhvbmV8cChpeGl8cmUpXC98cGx1Y2tlcnxwb2NrZXR8cHNwfHNlcmllcyg0fDYpMHxzeW1iaWFufHRyZW98dXBcLihicm93c2VyfGxpbmspfHZvZGFmb25lfHdhcHx3aW5kb3dzIGNlfHhkYXx4aWluby9pLnRlc3QoYSkgfHwgLzEyMDd8NjMxMHw2NTkwfDNnc298NHRocHw1MFsxLTZdaXw3NzBzfDgwMnN8YSB3YXxhYmFjfGFjKGVyfG9vfHNcLSl8YWkoa298cm4pfGFsKGF2fGNhfGNvKXxhbW9pfGFuKGV4fG55fHl3KXxhcHR1fGFyKGNofGdvKXxhcyh0ZXx1cyl8YXR0d3xhdShkaXxcLW18ciB8cyApfGF2YW58YmUoY2t8bGx8bnEpfGJpKGxifHJkKXxibChhY3xheil8YnIoZXx2KXd8YnVtYnxid1wtKG58dSl8YzU1XC98Y2FwaXxjY3dhfGNkbVwtfGNlbGx8Y2h0bXxjbGRjfGNtZFwtfGNvKG1wfG5kKXxjcmF3fGRhKGl0fGxsfG5nKXxkYnRlfGRjXC1zfGRldml8ZGljYXxkbW9ifGRvKGN8cClvfGRzKDEyfFwtZCl8ZWwoNDl8YWkpfGVtKGwyfHVsKXxlcihpY3xrMCl8ZXNsOHxleihbNC03XTB8b3N8d2F8emUpfGZldGN8Zmx5KFwtfF8pfGcxIHV8ZzU2MHxnZW5lfGdmXC01fGdcLW1vfGdvKFwud3xvZCl8Z3IoYWR8dW4pfGhhaWV8aGNpdHxoZFwtKG18cHx0KXxoZWlcLXxoaShwdHx0YSl8aHAoIGl8aXApfGhzXC1jfGh0KGMoXC18IHxffGF8Z3xwfHN8dCl8dHApfGh1KGF3fHRjKXxpXC0oMjB8Z298bWEpfGkyMzB8aWFjKCB8XC18XC8pfGlicm98aWRlYXxpZzAxfGlrb218aW0xa3xpbm5vfGlwYXF8aXJpc3xqYSh0fHYpYXxqYnJvfGplbXV8amlnc3xrZGRpfGtlaml8a2d0KCB8XC8pfGtsb258a3B0IHxrd2NcLXxreW8oY3xrKXxsZShub3x4aSl8bGcoIGd8XC8oa3xsfHUpfDUwfDU0fFwtW2Etd10pfGxpYnd8bHlueHxtMVwtd3xtM2dhfG01MFwvfG1hKHRlfHVpfHhvKXxtYygwMXwyMXxjYSl8bVwtY3J8bWUocmN8cmkpfG1pKG84fG9hfHRzKXxtbWVmfG1vKDAxfDAyfGJpfGRlfGRvfHQoXC18IHxvfHYpfHp6KXxtdCg1MHxwMXx2ICl8bXdicHxteXdhfG4xMFswLTJdfG4yMFsyLTNdfG4zMCgwfDIpfG41MCgwfDJ8NSl8bjcoMCgwfDEpfDEwKXxuZSgoY3xtKVwtfG9ufHRmfHdmfHdnfHd0KXxub2soNnxpKXxuenBofG8yaW18b3AodGl8d3YpfG9yYW58b3dnMXxwODAwfHBhbihhfGR8dCl8cGR4Z3xwZygxM3xcLShbMS04XXxjKSl8cGhpbHxwaXJlfHBsKGF5fHVjKXxwblwtMnxwbyhja3xydHxzZSl8cHJveHxwc2lvfHB0XC1nfHFhXC1hfHFjKDA3fDEyfDIxfDMyfDYwfFwtWzItN118aVwtKXxxdGVrfHIzODB8cjYwMHxyYWtzfHJpbTl8cm8odmV8em8pfHM1NVwvfHNhKGdlfG1hfG1tfG1zfG55fHZhKXxzYygwMXxoXC18b298cFwtKXxzZGtcL3xzZShjKFwtfDB8MSl8NDd8bWN8bmR8cmkpfHNnaFwtfHNoYXJ8c2llKFwtfG0pfHNrXC0wfHNsKDQ1fGlkKXxzbShhbHxhcnxiM3xpdHx0NSl8c28oZnR8bnkpfHNwKDAxfGhcLXx2XC18diApfHN5KDAxfG1iKXx0MigxOHw1MCl8dDYoMDB8MTB8MTgpfHRhKGd0fGxrKXx0Y2xcLXx0ZGdcLXx0ZWwoaXxtKXx0aW1cLXx0XC1tb3x0byhwbHxzaCl8dHMoNzB8bVwtfG0zfG01KXx0eFwtOXx1cChcLmJ8ZzF8c2kpfHV0c3R8djQwMHx2NzUwfHZlcml8dmkocmd8dGUpfHZrKDQwfDVbMC0zXXxcLXYpfHZtNDB8dm9kYXx2dWxjfHZ4KDUyfDUzfDYwfDYxfDcwfDgwfDgxfDgzfDg1fDk4KXx3M2MoXC18ICl8d2ViY3x3aGl0fHdpKGcgfG5jfG53KXx3bWxifHdvbnV8eDcwMHx5YXNcLXx5b3VyfHpldG98enRlXC0vaS50ZXN0KGEuc3Vic3RyKDAsIDQpKSkgY2hlY2sgPSB0cnVlOwoJCQkgIH0pKG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmEpOwoJCQkgIHJldHVybiBjaGVjazsKCQkJfTsKCQkJdmFyIGV4dGVuZCA9IGZ1bmN0aW9uIGV4dGVuZChkZXN0LCBzcmMpIHsKCQkJICBmb3IgKHZhciBrZXkgaW4gc3JjKSB7CgkJCSAgICBpZiAoc3JjLmhhc093blByb3BlcnR5KGtleSkpIHsKCQkJICAgICAgZGVzdFtrZXldID0gc3JjW2tleV07CgkJCSAgICB9CgkJCSAgfQoJCQkgIHJldHVybiBkZXN0OwoJCQl9OwoJCQl2YXIgc2FmYXJpQ3NzU2l6ZVdvcmthcm91bmQgPSBmdW5jdGlvbiBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpIHsKCQkJICBpZiAoaXNJT1MoKSkgewoJCQkgICAgdmFyIHdpZHRoID0gY2FudmFzLnN0eWxlLndpZHRoOwoJCQkgICAgdmFyIGhlaWdodCA9IGNhbnZhcy5zdHlsZS5oZWlnaHQ7CgkJCSAgICBjYW52YXMuc3R5bGUud2lkdGggPSBwYXJzZUludCh3aWR0aCkgKyAxICsgJ3B4JzsKCQkJICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQpICsgJ3B4JzsKCQkJICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkgICAgICBjYW52YXMuc3R5bGUud2lkdGggPSB3aWR0aDsKCQkJICAgICAgY2FudmFzLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKCQkJICAgIH0sIDEwMCk7CgkJCSAgfQoJCQkgIHdpbmRvdy5jYW52YXMgPSBjYW52YXM7CgkJCX07CgkJCXZhciBmcmFtZURhdGFGcm9tUG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgcGlPdmVyMTgwID0gTWF0aC5QSSAvIDE4MC4wOwoJCQkgIHZhciByYWQ0NSA9IE1hdGguUEkgKiAwLjI1OwoJCQkgIGZ1bmN0aW9uIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcob3V0LCBmb3YsIG5lYXIsIGZhcikgewoJCQkgICAgdmFyIHVwVGFuID0gTWF0aC50YW4oZm92ID8gZm92LnVwRGVncmVlcyAqIHBpT3ZlcjE4MCA6IHJhZDQ1KSwKCQkJICAgICAgICBkb3duVGFuID0gTWF0aC50YW4oZm92ID8gZm92LmRvd25EZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAoJCQkgICAgICAgIGxlZnRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YubGVmdERlZ3JlZXMgKiBwaU92ZXIxODAgOiByYWQ0NSksCgkJCSAgICAgICAgcmlnaHRUYW4gPSBNYXRoLnRhbihmb3YgPyBmb3YucmlnaHREZWdyZWVzICogcGlPdmVyMTgwIDogcmFkNDUpLAoJCQkgICAgICAgIHhTY2FsZSA9IDIuMCAvIChsZWZ0VGFuICsgcmlnaHRUYW4pLAoJCQkgICAgICAgIHlTY2FsZSA9IDIuMCAvICh1cFRhbiArIGRvd25UYW4pOwoJCQkgICAgb3V0WzBdID0geFNjYWxlOwoJCQkgICAgb3V0WzFdID0gMC4wOwoJCQkgICAgb3V0WzJdID0gMC4wOwoJCQkgICAgb3V0WzNdID0gMC4wOwoJCQkgICAgb3V0WzRdID0gMC4wOwoJCQkgICAgb3V0WzVdID0geVNjYWxlOwoJCQkgICAgb3V0WzZdID0gMC4wOwoJCQkgICAgb3V0WzddID0gMC4wOwoJCQkgICAgb3V0WzhdID0gLSgobGVmdFRhbiAtIHJpZ2h0VGFuKSAqIHhTY2FsZSAqIDAuNSk7CgkJCSAgICBvdXRbOV0gPSAodXBUYW4gLSBkb3duVGFuKSAqIHlTY2FsZSAqIDAuNTsKCQkJICAgIG91dFsxMF0gPSBmYXIgLyAobmVhciAtIGZhcik7CgkJCSAgICBvdXRbMTFdID0gLTE7CgkJCSAgICBvdXRbMTJdID0gMC4wOwoJCQkgICAgb3V0WzEzXSA9IDAuMDsKCQkJICAgIG91dFsxNF0gPSBmYXIgKiBuZWFyIC8gKG5lYXIgLSBmYXIpOwoJCQkgICAgb3V0WzE1XSA9IDAuMDsKCQkJICAgIHJldHVybiBvdXQ7CgkJCSAgfQoJCQkgIGZ1bmN0aW9uIG1hdDRfZnJvbVJvdGF0aW9uVHJhbnNsYXRpb24ob3V0LCBxLCB2KSB7CgkJCSAgICB2YXIgeCA9IHFbMF0sCgkJCSAgICAgICAgeSA9IHFbMV0sCgkJCSAgICAgICAgeiA9IHFbMl0sCgkJCSAgICAgICAgdyA9IHFbM10sCgkJCSAgICAgICAgeDIgPSB4ICsgeCwKCQkJICAgICAgICB5MiA9IHkgKyB5LAoJCQkgICAgICAgIHoyID0geiArIHosCgkJCSAgICAgICAgeHggPSB4ICogeDIsCgkJCSAgICAgICAgeHkgPSB4ICogeTIsCgkJCSAgICAgICAgeHogPSB4ICogejIsCgkJCSAgICAgICAgeXkgPSB5ICogeTIsCgkJCSAgICAgICAgeXogPSB5ICogejIsCgkJCSAgICAgICAgenogPSB6ICogejIsCgkJCSAgICAgICAgd3ggPSB3ICogeDIsCgkJCSAgICAgICAgd3kgPSB3ICogeTIsCgkJCSAgICAgICAgd3ogPSB3ICogejI7CgkJCSAgICBvdXRbMF0gPSAxIC0gKHl5ICsgenopOwoJCQkgICAgb3V0WzFdID0geHkgKyB3ejsKCQkJICAgIG91dFsyXSA9IHh6IC0gd3k7CgkJCSAgICBvdXRbM10gPSAwOwoJCQkgICAgb3V0WzRdID0geHkgLSB3ejsKCQkJICAgIG91dFs1XSA9IDEgLSAoeHggKyB6eik7CgkJCSAgICBvdXRbNl0gPSB5eiArIHd4OwoJCQkgICAgb3V0WzddID0gMDsKCQkJICAgIG91dFs4XSA9IHh6ICsgd3k7CgkJCSAgICBvdXRbOV0gPSB5eiAtIHd4OwoJCQkgICAgb3V0WzEwXSA9IDEgLSAoeHggKyB5eSk7CgkJCSAgICBvdXRbMTFdID0gMDsKCQkJICAgIG91dFsxMl0gPSB2WzBdOwoJCQkgICAgb3V0WzEzXSA9IHZbMV07CgkJCSAgICBvdXRbMTRdID0gdlsyXTsKCQkJICAgIG91dFsxNV0gPSAxOwoJCQkgICAgcmV0dXJuIG91dDsKCQkJICB9CgkJCSAgZnVuY3Rpb24gbWF0NF90cmFuc2xhdGUob3V0LCBhLCB2KSB7CgkJCSAgICB2YXIgeCA9IHZbMF0sCgkJCSAgICAgICAgeSA9IHZbMV0sCgkJCSAgICAgICAgeiA9IHZbMl0sCgkJCSAgICAgICAgYTAwLAoJCQkgICAgICAgIGEwMSwKCQkJICAgICAgICBhMDIsCgkJCSAgICAgICAgYTAzLAoJCQkgICAgICAgIGExMCwKCQkJICAgICAgICBhMTEsCgkJCSAgICAgICAgYTEyLAoJCQkgICAgICAgIGExMywKCQkJICAgICAgICBhMjAsCgkJCSAgICAgICAgYTIxLAoJCQkgICAgICAgIGEyMiwKCQkJICAgICAgICBhMjM7CgkJCSAgICBpZiAoYSA9PT0gb3V0KSB7CgkJCSAgICAgIG91dFsxMl0gPSBhWzBdICogeCArIGFbNF0gKiB5ICsgYVs4XSAqIHogKyBhWzEyXTsKCQkJICAgICAgb3V0WzEzXSA9IGFbMV0gKiB4ICsgYVs1XSAqIHkgKyBhWzldICogeiArIGFbMTNdOwoJCQkgICAgICBvdXRbMTRdID0gYVsyXSAqIHggKyBhWzZdICogeSArIGFbMTBdICogeiArIGFbMTRdOwoJCQkgICAgICBvdXRbMTVdID0gYVszXSAqIHggKyBhWzddICogeSArIGFbMTFdICogeiArIGFbMTVdOwoJCQkgICAgfSBlbHNlIHsKCQkJICAgICAgYTAwID0gYVswXTthMDEgPSBhWzFdO2EwMiA9IGFbMl07YTAzID0gYVszXTsKCQkJICAgICAgYTEwID0gYVs0XTthMTEgPSBhWzVdO2ExMiA9IGFbNl07YTEzID0gYVs3XTsKCQkJICAgICAgYTIwID0gYVs4XTthMjEgPSBhWzldO2EyMiA9IGFbMTBdO2EyMyA9IGFbMTFdOwoJCQkgICAgICBvdXRbMF0gPSBhMDA7b3V0WzFdID0gYTAxO291dFsyXSA9IGEwMjtvdXRbM10gPSBhMDM7CgkJCSAgICAgIG91dFs0XSA9IGExMDtvdXRbNV0gPSBhMTE7b3V0WzZdID0gYTEyO291dFs3XSA9IGExMzsKCQkJICAgICAgb3V0WzhdID0gYTIwO291dFs5XSA9IGEyMTtvdXRbMTBdID0gYTIyO291dFsxMV0gPSBhMjM7CgkJCSAgICAgIG91dFsxMl0gPSBhMDAgKiB4ICsgYTEwICogeSArIGEyMCAqIHogKyBhWzEyXTsKCQkJICAgICAgb3V0WzEzXSA9IGEwMSAqIHggKyBhMTEgKiB5ICsgYTIxICogeiArIGFbMTNdOwoJCQkgICAgICBvdXRbMTRdID0gYTAyICogeCArIGExMiAqIHkgKyBhMjIgKiB6ICsgYVsxNF07CgkJCSAgICAgIG91dFsxNV0gPSBhMDMgKiB4ICsgYTEzICogeSArIGEyMyAqIHogKyBhWzE1XTsKCQkJICAgIH0KCQkJICAgIHJldHVybiBvdXQ7CgkJCSAgfQoJCQkgIGZ1bmN0aW9uIG1hdDRfaW52ZXJ0KG91dCwgYSkgewoJCQkgICAgdmFyIGEwMCA9IGFbMF0sCgkJCSAgICAgICAgYTAxID0gYVsxXSwKCQkJICAgICAgICBhMDIgPSBhWzJdLAoJCQkgICAgICAgIGEwMyA9IGFbM10sCgkJCSAgICAgICAgYTEwID0gYVs0XSwKCQkJICAgICAgICBhMTEgPSBhWzVdLAoJCQkgICAgICAgIGExMiA9IGFbNl0sCgkJCSAgICAgICAgYTEzID0gYVs3XSwKCQkJICAgICAgICBhMjAgPSBhWzhdLAoJCQkgICAgICAgIGEyMSA9IGFbOV0sCgkJCSAgICAgICAgYTIyID0gYVsxMF0sCgkJCSAgICAgICAgYTIzID0gYVsxMV0sCgkJCSAgICAgICAgYTMwID0gYVsxMl0sCgkJCSAgICAgICAgYTMxID0gYVsxM10sCgkJCSAgICAgICAgYTMyID0gYVsxNF0sCgkJCSAgICAgICAgYTMzID0gYVsxNV0sCgkJCSAgICAgICAgYjAwID0gYTAwICogYTExIC0gYTAxICogYTEwLAoJCQkgICAgICAgIGIwMSA9IGEwMCAqIGExMiAtIGEwMiAqIGExMCwKCQkJICAgICAgICBiMDIgPSBhMDAgKiBhMTMgLSBhMDMgKiBhMTAsCgkJCSAgICAgICAgYjAzID0gYTAxICogYTEyIC0gYTAyICogYTExLAoJCQkgICAgICAgIGIwNCA9IGEwMSAqIGExMyAtIGEwMyAqIGExMSwKCQkJICAgICAgICBiMDUgPSBhMDIgKiBhMTMgLSBhMDMgKiBhMTIsCgkJCSAgICAgICAgYjA2ID0gYTIwICogYTMxIC0gYTIxICogYTMwLAoJCQkgICAgICAgIGIwNyA9IGEyMCAqIGEzMiAtIGEyMiAqIGEzMCwKCQkJICAgICAgICBiMDggPSBhMjAgKiBhMzMgLSBhMjMgKiBhMzAsCgkJCSAgICAgICAgYjA5ID0gYTIxICogYTMyIC0gYTIyICogYTMxLAoJCQkgICAgICAgIGIxMCA9IGEyMSAqIGEzMyAtIGEyMyAqIGEzMSwKCQkJICAgICAgICBiMTEgPSBhMjIgKiBhMzMgLSBhMjMgKiBhMzIsCgkJCSAgICBkZXQgPSBiMDAgKiBiMTEgLSBiMDEgKiBiMTAgKyBiMDIgKiBiMDkgKyBiMDMgKiBiMDggLSBiMDQgKiBiMDcgKyBiMDUgKiBiMDY7CgkJCSAgICBpZiAoIWRldCkgewoJCQkgICAgICByZXR1cm4gbnVsbDsKCQkJICAgIH0KCQkJICAgIGRldCA9IDEuMCAvIGRldDsKCQkJICAgIG91dFswXSA9IChhMTEgKiBiMTEgLSBhMTIgKiBiMTAgKyBhMTMgKiBiMDkpICogZGV0OwoJCQkgICAgb3V0WzFdID0gKGEwMiAqIGIxMCAtIGEwMSAqIGIxMSAtIGEwMyAqIGIwOSkgKiBkZXQ7CgkJCSAgICBvdXRbMl0gPSAoYTMxICogYjA1IC0gYTMyICogYjA0ICsgYTMzICogYjAzKSAqIGRldDsKCQkJICAgIG91dFszXSA9IChhMjIgKiBiMDQgLSBhMjEgKiBiMDUgLSBhMjMgKiBiMDMpICogZGV0OwoJCQkgICAgb3V0WzRdID0gKGExMiAqIGIwOCAtIGExMCAqIGIxMSAtIGExMyAqIGIwNykgKiBkZXQ7CgkJCSAgICBvdXRbNV0gPSAoYTAwICogYjExIC0gYTAyICogYjA4ICsgYTAzICogYjA3KSAqIGRldDsKCQkJICAgIG91dFs2XSA9IChhMzIgKiBiMDIgLSBhMzAgKiBiMDUgLSBhMzMgKiBiMDEpICogZGV0OwoJCQkgICAgb3V0WzddID0gKGEyMCAqIGIwNSAtIGEyMiAqIGIwMiArIGEyMyAqIGIwMSkgKiBkZXQ7CgkJCSAgICBvdXRbOF0gPSAoYTEwICogYjEwIC0gYTExICogYjA4ICsgYTEzICogYjA2KSAqIGRldDsKCQkJICAgIG91dFs5XSA9IChhMDEgKiBiMDggLSBhMDAgKiBiMTAgLSBhMDMgKiBiMDYpICogZGV0OwoJCQkgICAgb3V0WzEwXSA9IChhMzAgKiBiMDQgLSBhMzEgKiBiMDIgKyBhMzMgKiBiMDApICogZGV0OwoJCQkgICAgb3V0WzExXSA9IChhMjEgKiBiMDIgLSBhMjAgKiBiMDQgLSBhMjMgKiBiMDApICogZGV0OwoJCQkgICAgb3V0WzEyXSA9IChhMTEgKiBiMDcgLSBhMTAgKiBiMDkgLSBhMTIgKiBiMDYpICogZGV0OwoJCQkgICAgb3V0WzEzXSA9IChhMDAgKiBiMDkgLSBhMDEgKiBiMDcgKyBhMDIgKiBiMDYpICogZGV0OwoJCQkgICAgb3V0WzE0XSA9IChhMzEgKiBiMDEgLSBhMzAgKiBiMDMgLSBhMzIgKiBiMDApICogZGV0OwoJCQkgICAgb3V0WzE1XSA9IChhMjAgKiBiMDMgLSBhMjEgKiBiMDEgKyBhMjIgKiBiMDApICogZGV0OwoJCQkgICAgcmV0dXJuIG91dDsKCQkJICB9CgkJCSAgdmFyIGRlZmF1bHRPcmllbnRhdGlvbiA9IG5ldyBGbG9hdDMyQXJyYXkoWzAsIDAsIDAsIDFdKTsKCQkJICB2YXIgZGVmYXVsdFBvc2l0aW9uID0gbmV3IEZsb2F0MzJBcnJheShbMCwgMCwgMF0pOwoJCQkgIGZ1bmN0aW9uIHVwZGF0ZUV5ZU1hdHJpY2VzKHByb2plY3Rpb24sIHZpZXcsIHBvc2UsIGZvdiwgb2Zmc2V0LCB2ckRpc3BsYXkpIHsKCQkJICAgIG1hdDRfcGVyc3BlY3RpdmVGcm9tRmllbGRPZlZpZXcocHJvamVjdGlvbiwgZm92IHx8IG51bGwsIHZyRGlzcGxheS5kZXB0aE5lYXIsIHZyRGlzcGxheS5kZXB0aEZhcik7CgkJCSAgICB2YXIgb3JpZW50YXRpb24gPSBwb3NlLm9yaWVudGF0aW9uIHx8IGRlZmF1bHRPcmllbnRhdGlvbjsKCQkJICAgIHZhciBwb3NpdGlvbiA9IHBvc2UucG9zaXRpb24gfHwgZGVmYXVsdFBvc2l0aW9uOwoJCQkgICAgbWF0NF9mcm9tUm90YXRpb25UcmFuc2xhdGlvbih2aWV3LCBvcmllbnRhdGlvbiwgcG9zaXRpb24pOwoJCQkgICAgaWYgKG9mZnNldCkgbWF0NF90cmFuc2xhdGUodmlldywgdmlldywgb2Zmc2V0KTsKCQkJICAgIG1hdDRfaW52ZXJ0KHZpZXcsIHZpZXcpOwoJCQkgIH0KCQkJICByZXR1cm4gZnVuY3Rpb24gKGZyYW1lRGF0YSwgcG9zZSwgdnJEaXNwbGF5KSB7CgkJCSAgICBpZiAoIWZyYW1lRGF0YSB8fCAhcG9zZSkgcmV0dXJuIGZhbHNlOwoJCQkgICAgZnJhbWVEYXRhLnBvc2UgPSBwb3NlOwoJCQkgICAgZnJhbWVEYXRhLnRpbWVzdGFtcCA9IHBvc2UudGltZXN0YW1wOwoJCQkgICAgdXBkYXRlRXllTWF0cmljZXMoZnJhbWVEYXRhLmxlZnRQcm9qZWN0aW9uTWF0cml4LCBmcmFtZURhdGEubGVmdFZpZXdNYXRyaXgsIHBvc2UsIHZyRGlzcGxheS5fZ2V0RmllbGRPZlZpZXcoImxlZnQiKSwgdnJEaXNwbGF5Ll9nZXRFeWVPZmZzZXQoImxlZnQiKSwgdnJEaXNwbGF5KTsKCQkJICAgIHVwZGF0ZUV5ZU1hdHJpY2VzKGZyYW1lRGF0YS5yaWdodFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgsIHBvc2UsIHZyRGlzcGxheS5fZ2V0RmllbGRPZlZpZXcoInJpZ2h0IiksIHZyRGlzcGxheS5fZ2V0RXllT2Zmc2V0KCJyaWdodCIpLCB2ckRpc3BsYXkpOwoJCQkgICAgcmV0dXJuIHRydWU7CgkJCSAgfTsKCQkJfSgpOwoJCQl2YXIgaXNJbnNpZGVDcm9zc09yaWdpbklGcmFtZSA9IGZ1bmN0aW9uIGlzSW5zaWRlQ3Jvc3NPcmlnaW5JRnJhbWUoKSB7CgkJCSAgdmFyIGlzRnJhbWVkID0gd2luZG93LnNlbGYgIT09IHdpbmRvdy50b3A7CgkJCSAgdmFyIHJlZk9yaWdpbiA9IGdldE9yaWdpbkZyb21VcmwoZG9jdW1lbnQucmVmZXJyZXIpOwoJCQkgIHZhciB0aGlzT3JpZ2luID0gZ2V0T3JpZ2luRnJvbVVybCh3aW5kb3cubG9jYXRpb24uaHJlZik7CgkJCSAgcmV0dXJuIGlzRnJhbWVkICYmIHJlZk9yaWdpbiAhPT0gdGhpc09yaWdpbjsKCQkJfTsKCQkJdmFyIGdldE9yaWdpbkZyb21VcmwgPSBmdW5jdGlvbiBnZXRPcmlnaW5Gcm9tVXJsKHVybCkgewoJCQkgIHZhciBkb21haW5JZHg7CgkJCSAgdmFyIHByb3RvU2VwSWR4ID0gdXJsLmluZGV4T2YoIjovLyIpOwoJCQkgIGlmIChwcm90b1NlcElkeCAhPT0gLTEpIHsKCQkJICAgIGRvbWFpbklkeCA9IHByb3RvU2VwSWR4ICsgMzsKCQkJICB9IGVsc2UgewoJCQkgICAgZG9tYWluSWR4ID0gMDsKCQkJICB9CgkJCSAgdmFyIGRvbWFpbkVuZElkeCA9IHVybC5pbmRleE9mKCcvJywgZG9tYWluSWR4KTsKCQkJICBpZiAoZG9tYWluRW5kSWR4ID09PSAtMSkgewoJCQkgICAgZG9tYWluRW5kSWR4ID0gdXJsLmxlbmd0aDsKCQkJICB9CgkJCSAgcmV0dXJuIHVybC5zdWJzdHJpbmcoMCwgZG9tYWluRW5kSWR4KTsKCQkJfTsKCQkJdmFyIGdldFF1YXRlcm5pb25BbmdsZSA9IGZ1bmN0aW9uIGdldFF1YXRlcm5pb25BbmdsZShxdWF0KSB7CgkJCSAgaWYgKHF1YXQudyA+IDEpIHsKCQkJICAgIGNvbnNvbGUud2FybignZ2V0UXVhdGVybmlvbkFuZ2xlOiB3ID4gMScpOwoJCQkgICAgcmV0dXJuIDA7CgkJCSAgfQoJCQkgIHZhciBhbmdsZSA9IDIgKiBNYXRoLmFjb3MocXVhdC53KTsKCQkJICByZXR1cm4gYW5nbGU7CgkJCX07CgkJCXZhciB3YXJuT25jZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgb2JzZXJ2ZWRXYXJuaW5ncyA9IHt9OwoJCQkgIHJldHVybiBmdW5jdGlvbiAoa2V5LCBtZXNzYWdlKSB7CgkJCSAgICBpZiAob2JzZXJ2ZWRXYXJuaW5nc1trZXldID09PSB1bmRlZmluZWQpIHsKCQkJICAgICAgY29uc29sZS53YXJuKCd3ZWJ2ci1wb2x5ZmlsbDogJyArIG1lc3NhZ2UpOwoJCQkgICAgICBvYnNlcnZlZFdhcm5pbmdzW2tleV0gPSB0cnVlOwoJCQkgICAgfQoJCQkgIH07CgkJCX0oKTsKCQkJdmFyIGRlcHJlY2F0ZVdhcm5pbmcgPSBmdW5jdGlvbiBkZXByZWNhdGVXYXJuaW5nKGRlcHJlY2F0ZWQsIHN1Z2dlc3RlZCkgewoJCQkgIHZhciBhbHRlcm5hdGl2ZSA9IHN1Z2dlc3RlZCA/ICdQbGVhc2UgdXNlICcgKyBzdWdnZXN0ZWQgKyAnIGluc3RlYWQuJyA6ICcnOwoJCQkgIHdhcm5PbmNlKGRlcHJlY2F0ZWQsIGRlcHJlY2F0ZWQgKyAnIGhhcyBiZWVuIGRlcHJlY2F0ZWQuICcgKyAnVGhpcyBtYXkgbm90IHdvcmsgb24gbmF0aXZlIFdlYlZSIGRpc3BsYXlzLiAnICsgYWx0ZXJuYXRpdmUpOwoJCQl9OwoJCQlmdW5jdGlvbiBXR0xVUHJlc2VydmVHTFN0YXRlKGdsLCBiaW5kaW5ncywgY2FsbGJhY2spIHsKCQkJICBpZiAoIWJpbmRpbmdzKSB7CgkJCSAgICBjYWxsYmFjayhnbCk7CgkJCSAgICByZXR1cm47CgkJCSAgfQoJCQkgIHZhciBib3VuZFZhbHVlcyA9IFtdOwoJCQkgIHZhciBhY3RpdmVUZXh0dXJlID0gbnVsbDsKCQkJICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmRpbmdzLmxlbmd0aDsgKytpKSB7CgkJCSAgICB2YXIgYmluZGluZyA9IGJpbmRpbmdzW2ldOwoJCQkgICAgc3dpdGNoIChiaW5kaW5nKSB7CgkJCSAgICAgIGNhc2UgZ2wuVEVYVFVSRV9CSU5ESU5HXzJEOgoJCQkgICAgICBjYXNlIGdsLlRFWFRVUkVfQklORElOR19DVUJFX01BUDoKCQkJICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwoJCQkgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKSB7CgkJCSAgICAgICAgICBjb25zb2xlLmVycm9yKCJURVhUVVJFX0JJTkRJTkdfMkQgb3IgVEVYVFVSRV9CSU5ESU5HX0NVQkVfTUFQIG11c3QgYmUgZm9sbG93ZWQgYnkgYSB2YWxpZCB0ZXh0dXJlIHVuaXQiKTsKCQkJICAgICAgICAgIGJvdW5kVmFsdWVzLnB1c2gobnVsbCwgbnVsbCk7CgkJCSAgICAgICAgICBicmVhazsKCQkJICAgICAgICB9CgkJCSAgICAgICAgaWYgKCFhY3RpdmVUZXh0dXJlKSB7CgkJCSAgICAgICAgICBhY3RpdmVUZXh0dXJlID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkFDVElWRV9URVhUVVJFKTsKCQkJICAgICAgICB9CgkJCSAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CgkJCSAgICAgICAgYm91bmRWYWx1ZXMucHVzaChnbC5nZXRQYXJhbWV0ZXIoYmluZGluZyksIG51bGwpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLkFDVElWRV9URVhUVVJFOgoJCQkgICAgICAgIGFjdGl2ZVRleHR1cmUgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQUNUSVZFX1RFWFRVUkUpOwoJCQkgICAgICAgIGJvdW5kVmFsdWVzLnB1c2gobnVsbCk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGRlZmF1bHQ6CgkJCSAgICAgICAgYm91bmRWYWx1ZXMucHVzaChnbC5nZXRQYXJhbWV0ZXIoYmluZGluZykpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgfQoJCQkgIH0KCQkJICBjYWxsYmFjayhnbCk7CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW5kaW5ncy5sZW5ndGg7ICsraSkgewoJCQkgICAgdmFyIGJpbmRpbmcgPSBiaW5kaW5nc1tpXTsKCQkJICAgIHZhciBib3VuZFZhbHVlID0gYm91bmRWYWx1ZXNbaV07CgkJCSAgICBzd2l0Y2ggKGJpbmRpbmcpIHsKCQkJICAgICAgY2FzZSBnbC5BQ1RJVkVfVEVYVFVSRToKCQkJICAgICAgICBicmVhazsKCQkJICAgICAgY2FzZSBnbC5BUlJBWV9CVUZGRVJfQklORElORzoKCQkJICAgICAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgYm91bmRWYWx1ZSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQ09MT1JfQ0xFQVJfVkFMVUU6CgkJCSAgICAgICAgZ2wuY2xlYXJDb2xvcihib3VuZFZhbHVlWzBdLCBib3VuZFZhbHVlWzFdLCBib3VuZFZhbHVlWzJdLCBib3VuZFZhbHVlWzNdKTsKCQkJICAgICAgICBicmVhazsKCQkJICAgICAgY2FzZSBnbC5DT0xPUl9XUklURU1BU0s6CgkJCSAgICAgICAgZ2wuY29sb3JNYXNrKGJvdW5kVmFsdWVbMF0sIGJvdW5kVmFsdWVbMV0sIGJvdW5kVmFsdWVbMl0sIGJvdW5kVmFsdWVbM10pOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLkNVUlJFTlRfUFJPR1JBTToKCQkJICAgICAgICBnbC51c2VQcm9ncmFtKGJvdW5kVmFsdWUpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkc6CgkJCSAgICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYm91bmRWYWx1ZSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuRlJBTUVCVUZGRVJfQklORElORzoKCQkJICAgICAgICBnbC5iaW5kRnJhbWVidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGJvdW5kVmFsdWUpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLlJFTkRFUkJVRkZFUl9CSU5ESU5HOgoJCQkgICAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBib3VuZFZhbHVlKTsKCQkJICAgICAgICBicmVhazsKCQkJICAgICAgY2FzZSBnbC5URVhUVVJFX0JJTkRJTkdfMkQ6CgkJCSAgICAgICAgdmFyIHRleHR1cmVVbml0ID0gYmluZGluZ3NbKytpXTsKCQkJICAgICAgICBpZiAodGV4dHVyZVVuaXQgPCBnbC5URVhUVVJFMCB8fCB0ZXh0dXJlVW5pdCA+IGdsLlRFWFRVUkUzMSkKCQkJICAgICAgICAgIGJyZWFrOwoJCQkgICAgICAgIGdsLmFjdGl2ZVRleHR1cmUodGV4dHVyZVVuaXQpOwoJCQkgICAgICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIGJvdW5kVmFsdWUpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgICBjYXNlIGdsLlRFWFRVUkVfQklORElOR19DVUJFX01BUDoKCQkJICAgICAgICB2YXIgdGV4dHVyZVVuaXQgPSBiaW5kaW5nc1srK2ldOwoJCQkgICAgICAgIGlmICh0ZXh0dXJlVW5pdCA8IGdsLlRFWFRVUkUwIHx8IHRleHR1cmVVbml0ID4gZ2wuVEVYVFVSRTMxKQoJCQkgICAgICAgICAgYnJlYWs7CgkJCSAgICAgICAgZ2wuYWN0aXZlVGV4dHVyZSh0ZXh0dXJlVW5pdCk7CgkJCSAgICAgICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgYm91bmRWYWx1ZSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuVklFV1BPUlQ6CgkJCSAgICAgICAgZ2wudmlld3BvcnQoYm91bmRWYWx1ZVswXSwgYm91bmRWYWx1ZVsxXSwgYm91bmRWYWx1ZVsyXSwgYm91bmRWYWx1ZVszXSk7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQkxFTkQ6CgkJCSAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgoJCQkgICAgICBjYXNlIGdsLkRFUFRIX1RFU1Q6CgkJCSAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgoJCQkgICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKCQkJICAgICAgICBpZiAoYm91bmRWYWx1ZSkgewoJCQkgICAgICAgICAgZ2wuZW5hYmxlKGJpbmRpbmcpOwoJCQkgICAgICAgIH0gZWxzZSB7CgkJCSAgICAgICAgICBnbC5kaXNhYmxlKGJpbmRpbmcpOwoJCQkgICAgICAgIH0KCQkJICAgICAgICBicmVhazsKCQkJICAgICAgZGVmYXVsdDoKCQkJICAgICAgICBjb25zb2xlLmxvZygiTm8gR0wgcmVzdG9yZSBiZWhhdmlvciBmb3IgMHgiICsgYmluZGluZy50b1N0cmluZygxNikpOwoJCQkgICAgICAgIGJyZWFrOwoJCQkgICAgfQoJCQkgICAgaWYgKGFjdGl2ZVRleHR1cmUpIHsKCQkJICAgICAgZ2wuYWN0aXZlVGV4dHVyZShhY3RpdmVUZXh0dXJlKTsKCQkJICAgIH0KCQkJICB9CgkJCX0KCQkJdmFyIGdsUHJlc2VydmVTdGF0ZSA9IFdHTFVQcmVzZXJ2ZUdMU3RhdGU7CgkJCXZhciBkaXN0b3J0aW9uVlMgPSBbJ2F0dHJpYnV0ZSB2ZWMyIHBvc2l0aW9uOycsICdhdHRyaWJ1dGUgdmVjMyB0ZXhDb29yZDsnLCAndmFyeWluZyB2ZWMyIHZUZXhDb29yZDsnLCAndW5pZm9ybSB2ZWM0IHZpZXdwb3J0T2Zmc2V0U2NhbGVbMl07JywgJ3ZvaWQgbWFpbigpIHsnLCAnICB2ZWM0IHZpZXdwb3J0ID0gdmlld3BvcnRPZmZzZXRTY2FsZVtpbnQodGV4Q29vcmQueildOycsICcgIHZUZXhDb29yZCA9ICh0ZXhDb29yZC54eSAqIHZpZXdwb3J0Lnp3KSArIHZpZXdwb3J0Lnh5OycsICcgIGdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24sIDEuMCwgMS4wICk7JywgJ30nXS5qb2luKCdcbicpOwoJCQl2YXIgZGlzdG9ydGlvbkZTID0gWydwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsnLCAndW5pZm9ybSBzYW1wbGVyMkQgZGlmZnVzZTsnLCAndmFyeWluZyB2ZWMyIHZUZXhDb29yZDsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChkaWZmdXNlLCB2VGV4Q29vcmQpOycsICd9J10uam9pbignXG4nKTsKCQkJZnVuY3Rpb24gQ2FyZGJvYXJkRGlzdG9ydGVyKGdsLCBjYXJkYm9hcmRVSSwgYnVmZmVyU2NhbGUsIGRpcnR5U3VibWl0RnJhbWVCaW5kaW5ncykgewoJCQkgIHRoaXMuZ2wgPSBnbDsKCQkJICB0aGlzLmNhcmRib2FyZFVJID0gY2FyZGJvYXJkVUk7CgkJCSAgdGhpcy5idWZmZXJTY2FsZSA9IGJ1ZmZlclNjYWxlOwoJCQkgIHRoaXMuZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzID0gZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzOwoJCQkgIHRoaXMuY3R4QXR0cmlicyA9IGdsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgkJCSAgdGhpcy5pbnN0YW5jZUV4dCA9IGdsLmdldEV4dGVuc2lvbignQU5HTEVfaW5zdGFuY2VkX2FycmF5cycpOwoJCQkgIHRoaXMubWVzaFdpZHRoID0gMjA7CgkJCSAgdGhpcy5tZXNoSGVpZ2h0ID0gMjA7CgkJCSAgdGhpcy5idWZmZXJXaWR0aCA9IGdsLmRyYXdpbmdCdWZmZXJXaWR0aDsKCQkJICB0aGlzLmJ1ZmZlckhlaWdodCA9IGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQ7CgkJCSAgdGhpcy5yZWFsQmluZEZyYW1lYnVmZmVyID0gZ2wuYmluZEZyYW1lYnVmZmVyOwoJCQkgIHRoaXMucmVhbEVuYWJsZSA9IGdsLmVuYWJsZTsKCQkJICB0aGlzLnJlYWxEaXNhYmxlID0gZ2wuZGlzYWJsZTsKCQkJICB0aGlzLnJlYWxDb2xvck1hc2sgPSBnbC5jb2xvck1hc2s7CgkJCSAgdGhpcy5yZWFsQ2xlYXJDb2xvciA9IGdsLmNsZWFyQ29sb3I7CgkJCSAgdGhpcy5yZWFsVmlld3BvcnQgPSBnbC52aWV3cG9ydDsKCQkJICBpZiAoIWlzSU9TKCkpIHsKCQkJICAgIHRoaXMucmVhbENhbnZhc1dpZHRoID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihnbC5jYW52YXMuX19wcm90b19fLCAnd2lkdGgnKTsKCQkJICAgIHRoaXMucmVhbENhbnZhc0hlaWdodCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoZ2wuY2FudmFzLl9fcHJvdG9fXywgJ2hlaWdodCcpOwoJCQkgIH0KCQkJICB0aGlzLmlzUGF0Y2hlZCA9IGZhbHNlOwoJCQkgIHRoaXMubGFzdEJvdW5kRnJhbWVidWZmZXIgPSBudWxsOwoJCQkgIHRoaXMuY3VsbEZhY2UgPSBmYWxzZTsKCQkJICB0aGlzLmRlcHRoVGVzdCA9IGZhbHNlOwoJCQkgIHRoaXMuYmxlbmQgPSBmYWxzZTsKCQkJICB0aGlzLnNjaXNzb3JUZXN0ID0gZmFsc2U7CgkJCSAgdGhpcy5zdGVuY2lsVGVzdCA9IGZhbHNlOwoJCQkgIHRoaXMudmlld3BvcnQgPSBbMCwgMCwgMCwgMF07CgkJCSAgdGhpcy5jb2xvck1hc2sgPSBbdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZV07CgkJCSAgdGhpcy5jbGVhckNvbG9yID0gWzAsIDAsIDAsIDBdOwoJCQkgIHRoaXMuYXR0cmlicyA9IHsKCQkJICAgIHBvc2l0aW9uOiAwLAoJCQkgICAgdGV4Q29vcmQ6IDEKCQkJICB9OwoJCQkgIHRoaXMucHJvZ3JhbSA9IGxpbmtQcm9ncmFtKGdsLCBkaXN0b3J0aW9uVlMsIGRpc3RvcnRpb25GUywgdGhpcy5hdHRyaWJzKTsKCQkJICB0aGlzLnVuaWZvcm1zID0gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCB0aGlzLnByb2dyYW0pOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZSA9IG5ldyBGbG9hdDMyQXJyYXkoOCk7CgkJCSAgdGhpcy5zZXRUZXh0dXJlQm91bmRzKCk7CgkJCSAgdGhpcy52ZXJ0ZXhCdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCQkJICB0aGlzLmluZGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCSAgdGhpcy5pbmRleENvdW50ID0gMDsKCQkJICB0aGlzLnJlbmRlclRhcmdldCA9IGdsLmNyZWF0ZVRleHR1cmUoKTsKCQkJICB0aGlzLmZyYW1lYnVmZmVyID0gZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCQkJICB0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlciA9IG51bGw7CgkJCSAgdGhpcy5kZXB0aEJ1ZmZlciA9IG51bGw7CgkJCSAgdGhpcy5zdGVuY2lsQnVmZmVyID0gbnVsbDsKCQkJICBpZiAodGhpcy5jdHhBdHRyaWJzLmRlcHRoICYmIHRoaXMuY3R4QXR0cmlicy5zdGVuY2lsKSB7CgkJCSAgICB0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlciA9IGdsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkgIH0gZWxzZSBpZiAodGhpcy5jdHhBdHRyaWJzLmRlcHRoKSB7CgkJCSAgICB0aGlzLmRlcHRoQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCSAgfSBlbHNlIGlmICh0aGlzLmN0eEF0dHJpYnMuc3RlbmNpbCkgewoJCQkgICAgdGhpcy5zdGVuY2lsQnVmZmVyID0gZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCSAgfQoJCQkgIHRoaXMucGF0Y2goKTsKCQkJICB0aGlzLm9uUmVzaXplKCk7CgkJCX0KCQkJQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdGhpcy51bnBhdGNoKCk7CgkJCSAgZ2wuZGVsZXRlUHJvZ3JhbSh0aGlzLnByb2dyYW0pOwoJCQkgIGdsLmRlbGV0ZUJ1ZmZlcih0aGlzLnZlcnRleEJ1ZmZlcik7CgkJCSAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMuaW5kZXhCdWZmZXIpOwoJCQkgIGdsLmRlbGV0ZVRleHR1cmUodGhpcy5yZW5kZXJUYXJnZXQpOwoJCQkgIGdsLmRlbGV0ZUZyYW1lYnVmZmVyKHRoaXMuZnJhbWVidWZmZXIpOwoJCQkgIGlmICh0aGlzLmRlcHRoU3RlbmNpbEJ1ZmZlcikgewoJCQkgICAgZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHRoaXMuZGVwdGhTdGVuY2lsQnVmZmVyKTsKCQkJICB9CgkJCSAgaWYgKHRoaXMuZGVwdGhCdWZmZXIpIHsKCQkJICAgIGdsLmRlbGV0ZVJlbmRlcmJ1ZmZlcih0aGlzLmRlcHRoQnVmZmVyKTsKCQkJICB9CgkJCSAgaWYgKHRoaXMuc3RlbmNpbEJ1ZmZlcikgewoJCQkgICAgZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKHRoaXMuc3RlbmNpbEJ1ZmZlcik7CgkJCSAgfQoJCQkgIGlmICh0aGlzLmNhcmRib2FyZFVJKSB7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJLmRlc3Ryb3koKTsKCQkJICB9CgkJCX07CgkJCUNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGdsID0gdGhpcy5nbDsKCQkJICB2YXIgc2VsZiA9IHRoaXM7CgkJCSAgdmFyIGdsU3RhdGUgPSBbZ2wuUkVOREVSQlVGRkVSX0JJTkRJTkcsIGdsLlRFWFRVUkVfQklORElOR18yRCwgZ2wuVEVYVFVSRTBdOwoJCQkgIGdsUHJlc2VydmVTdGF0ZShnbCwgZ2xTdGF0ZSwgZnVuY3Rpb24gKGdsKSB7CgkJCSAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChnbCwgZ2wuRlJBTUVCVUZGRVIsIG51bGwpOwoJCQkgICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKCQkJICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5TQ0lTU09SX1RFU1QpOwoJCQkgICAgfQoJCQkgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHRydWUsIHRydWUsIHRydWUsIHRydWUpOwoJCQkgICAgc2VsZi5yZWFsVmlld3BvcnQuY2FsbChnbCwgMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKCQkJICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMSk7CgkJCSAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTsKCQkJICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5mcmFtZWJ1ZmZlcik7CgkJCSAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCk7CgkJCSAgICBnbC50ZXhJbWFnZTJEKGdsLlRFWFRVUkVfMkQsIDAsIHNlbGYuY3R4QXR0cmlicy5hbHBoYSA/IGdsLlJHQkEgOiBnbC5SR0IsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0LCAwLCBzZWxmLmN0eEF0dHJpYnMuYWxwaGEgPyBnbC5SR0JBIDogZ2wuUkdCLCBnbC5VTlNJR05FRF9CWVRFLCBudWxsKTsKCQkJICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5MSU5FQVIpOwoJCQkgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX01JTl9GSUxURVIsIGdsLkxJTkVBUik7CgkJCSAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTsKCQkJICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpOwoJCQkgICAgZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoZ2wuRlJBTUVCVUZGRVIsIGdsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCwgMCk7CgkJCSAgICBpZiAoc2VsZi5jdHhBdHRyaWJzLmRlcHRoICYmIHNlbGYuY3R4QXR0cmlicy5zdGVuY2lsKSB7CgkJCSAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLmRlcHRoU3RlbmNpbEJ1ZmZlcik7CgkJCSAgICAgIGdsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoZ2wuUkVOREVSQlVGRkVSLCBnbC5ERVBUSF9TVEVOQ0lMLCBzZWxmLmJ1ZmZlcldpZHRoLCBzZWxmLmJ1ZmZlckhlaWdodCk7CgkJCSAgICAgIGdsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCBnbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5kZXB0aFN0ZW5jaWxCdWZmZXIpOwoJCQkgICAgfSBlbHNlIGlmIChzZWxmLmN0eEF0dHJpYnMuZGVwdGgpIHsKCQkJICAgICAgZ2wuYmluZFJlbmRlcmJ1ZmZlcihnbC5SRU5ERVJCVUZGRVIsIHNlbGYuZGVwdGhCdWZmZXIpOwoJCQkgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuREVQVEhfQ09NUE9ORU5UMTYsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0KTsKCQkJICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLkRFUFRIX0FUVEFDSE1FTlQsIGdsLlJFTkRFUkJVRkZFUiwgc2VsZi5kZXB0aEJ1ZmZlcik7CgkJCSAgICB9IGVsc2UgaWYgKHNlbGYuY3R4QXR0cmlicy5zdGVuY2lsKSB7CgkJCSAgICAgIGdsLmJpbmRSZW5kZXJidWZmZXIoZ2wuUkVOREVSQlVGRkVSLCBzZWxmLnN0ZW5jaWxCdWZmZXIpOwoJCQkgICAgICBnbC5yZW5kZXJidWZmZXJTdG9yYWdlKGdsLlJFTkRFUkJVRkZFUiwgZ2wuU1RFTkNJTF9JTkRFWDgsIHNlbGYuYnVmZmVyV2lkdGgsIHNlbGYuYnVmZmVySGVpZ2h0KTsKCQkJICAgICAgZ2wuZnJhbWVidWZmZXJSZW5kZXJidWZmZXIoZ2wuRlJBTUVCVUZGRVIsIGdsLlNURU5DSUxfQVRUQUNITUVOVCwgZ2wuUkVOREVSQlVGRkVSLCBzZWxmLnN0ZW5jaWxCdWZmZXIpOwoJCQkgICAgfQoJCQkgICAgaWYgKCFnbC5jaGVja0ZyYW1lYnVmZmVyU3RhdHVzKGdsLkZSQU1FQlVGRkVSKSA9PT0gZ2wuRlJBTUVCVUZGRVJfQ09NUExFVEUpIHsKCQkJICAgICAgY29uc29sZS5lcnJvcignRnJhbWVidWZmZXIgaW5jb21wbGV0ZSEnKTsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CgkJCSAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU0NJU1NPUl9URVNUKTsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbENvbG9yTWFzay5hcHBseShnbCwgc2VsZi5jb2xvck1hc2spOwoJCQkgICAgc2VsZi5yZWFsVmlld3BvcnQuYXBwbHkoZ2wsIHNlbGYudmlld3BvcnQpOwoJCQkgICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5hcHBseShnbCwgc2VsZi5jbGVhckNvbG9yKTsKCQkJICB9KTsKCQkJICBpZiAodGhpcy5jYXJkYm9hcmRVSSkgewoJCQkgICAgdGhpcy5jYXJkYm9hcmRVSS5vblJlc2l6ZSgpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5wYXRjaCA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5pc1BhdGNoZWQpIHsKCQkJICAgIHJldHVybjsKCQkJICB9CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIGlmICghaXNJT1MoKSkgewoJCQkgICAgY2FudmFzLndpZHRoID0gZ2V0U2NyZWVuV2lkdGgoKSAqIHRoaXMuYnVmZmVyU2NhbGU7CgkJCSAgICBjYW52YXMuaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCkgKiB0aGlzLmJ1ZmZlclNjYWxlOwoJCQkgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ3dpZHRoJywgewoJCQkgICAgICBjb25maWd1cmFibGU6IHRydWUsCgkJCSAgICAgIGVudW1lcmFibGU6IHRydWUsCgkJCSAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkgICAgICAgIHJldHVybiBzZWxmLmJ1ZmZlcldpZHRoOwoJCQkgICAgICB9LAoJCQkgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2YWx1ZSkgewoJCQkgICAgICAgIHNlbGYuYnVmZmVyV2lkdGggPSB2YWx1ZTsKCQkJICAgICAgICBzZWxmLnJlYWxDYW52YXNXaWR0aC5zZXQuY2FsbChjYW52YXMsIHZhbHVlKTsKCQkJICAgICAgICBzZWxmLm9uUmVzaXplKCk7CgkJCSAgICAgIH0KCQkJICAgIH0pOwoJCQkgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNhbnZhcywgJ2hlaWdodCcsIHsKCQkJICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAoJCQkgICAgICBlbnVtZXJhYmxlOiB0cnVlLAoJCQkgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJICAgICAgICByZXR1cm4gc2VsZi5idWZmZXJIZWlnaHQ7CgkJCSAgICAgIH0sCgkJCSAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbHVlKSB7CgkJCSAgICAgICAgc2VsZi5idWZmZXJIZWlnaHQgPSB2YWx1ZTsKCQkJICAgICAgICBzZWxmLnJlYWxDYW52YXNIZWlnaHQuc2V0LmNhbGwoY2FudmFzLCB2YWx1ZSk7CgkJCSAgICAgICAgc2VsZi5vblJlc2l6ZSgpOwoJCQkgICAgICB9CgkJCSAgICB9KTsKCQkJICB9CgkJCSAgdGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IGdsLmdldFBhcmFtZXRlcihnbC5GUkFNRUJVRkZFUl9CSU5ESU5HKTsKCQkJICBpZiAodGhpcy5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9PSBudWxsKSB7CgkJCSAgICB0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID0gdGhpcy5mcmFtZWJ1ZmZlcjsKCQkJICAgIHRoaXMuZ2wuYmluZEZyYW1lYnVmZmVyKGdsLkZSQU1FQlVGRkVSLCB0aGlzLmZyYW1lYnVmZmVyKTsKCQkJICB9CgkJCSAgdGhpcy5nbC5iaW5kRnJhbWVidWZmZXIgPSBmdW5jdGlvbiAodGFyZ2V0LCBmcmFtZWJ1ZmZlcikgewoJCQkgICAgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlciA9IGZyYW1lYnVmZmVyID8gZnJhbWVidWZmZXIgOiBzZWxmLmZyYW1lYnVmZmVyOwoJCQkgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIHRhcmdldCwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CgkJCSAgfTsKCQkJICB0aGlzLmN1bGxGYWNlID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNVTExfRkFDRSk7CgkJCSAgdGhpcy5kZXB0aFRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuREVQVEhfVEVTVCk7CgkJCSAgdGhpcy5ibGVuZCA9IGdsLmdldFBhcmFtZXRlcihnbC5CTEVORCk7CgkJCSAgdGhpcy5zY2lzc29yVGVzdCA9IGdsLmdldFBhcmFtZXRlcihnbC5TQ0lTU09SX1RFU1QpOwoJCQkgIHRoaXMuc3RlbmNpbFRlc3QgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuU1RFTkNJTF9URVNUKTsKCQkJICBnbC5lbmFibGUgPSBmdW5jdGlvbiAocG5hbWUpIHsKCQkJICAgIHN3aXRjaCAocG5hbWUpIHsKCQkJICAgICAgY2FzZSBnbC5DVUxMX0ZBQ0U6CgkJCSAgICAgICAgc2VsZi5jdWxsRmFjZSA9IHRydWU7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuREVQVEhfVEVTVDoKCQkJICAgICAgICBzZWxmLmRlcHRoVGVzdCA9IHRydWU7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQkxFTkQ6CgkJCSAgICAgICAgc2VsZi5ibGVuZCA9IHRydWU7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuU0NJU1NPUl9URVNUOgoJCQkgICAgICAgIHNlbGYuc2Npc3NvclRlc3QgPSB0cnVlO2JyZWFrOwoJCQkgICAgICBjYXNlIGdsLlNURU5DSUxfVEVTVDoKCQkJICAgICAgICBzZWxmLnN0ZW5jaWxUZXN0ID0gdHJ1ZTticmVhazsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbEVuYWJsZS5jYWxsKGdsLCBwbmFtZSk7CgkJCSAgfTsKCQkJICBnbC5kaXNhYmxlID0gZnVuY3Rpb24gKHBuYW1lKSB7CgkJCSAgICBzd2l0Y2ggKHBuYW1lKSB7CgkJCSAgICAgIGNhc2UgZ2wuQ1VMTF9GQUNFOgoJCQkgICAgICAgIHNlbGYuY3VsbEZhY2UgPSBmYWxzZTticmVhazsKCQkJICAgICAgY2FzZSBnbC5ERVBUSF9URVNUOgoJCQkgICAgICAgIHNlbGYuZGVwdGhUZXN0ID0gZmFsc2U7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuQkxFTkQ6CgkJCSAgICAgICAgc2VsZi5ibGVuZCA9IGZhbHNlO2JyZWFrOwoJCQkgICAgICBjYXNlIGdsLlNDSVNTT1JfVEVTVDoKCQkJICAgICAgICBzZWxmLnNjaXNzb3JUZXN0ID0gZmFsc2U7YnJlYWs7CgkJCSAgICAgIGNhc2UgZ2wuU1RFTkNJTF9URVNUOgoJCQkgICAgICAgIHNlbGYuc3RlbmNpbFRlc3QgPSBmYWxzZTticmVhazsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgcG5hbWUpOwoJCQkgIH07CgkJCSAgdGhpcy5jb2xvck1hc2sgPSBnbC5nZXRQYXJhbWV0ZXIoZ2wuQ09MT1JfV1JJVEVNQVNLKTsKCQkJICBnbC5jb2xvck1hc2sgPSBmdW5jdGlvbiAociwgZywgYiwgYSkgewoJCQkgICAgc2VsZi5jb2xvck1hc2tbMF0gPSByOwoJCQkgICAgc2VsZi5jb2xvck1hc2tbMV0gPSBnOwoJCQkgICAgc2VsZi5jb2xvck1hc2tbMl0gPSBiOwoJCQkgICAgc2VsZi5jb2xvck1hc2tbM10gPSBhOwoJCQkgICAgc2VsZi5yZWFsQ29sb3JNYXNrLmNhbGwoZ2wsIHIsIGcsIGIsIGEpOwoJCQkgIH07CgkJCSAgdGhpcy5jbGVhckNvbG9yID0gZ2wuZ2V0UGFyYW1ldGVyKGdsLkNPTE9SX0NMRUFSX1ZBTFVFKTsKCQkJICBnbC5jbGVhckNvbG9yID0gZnVuY3Rpb24gKHIsIGcsIGIsIGEpIHsKCQkJICAgIHNlbGYuY2xlYXJDb2xvclswXSA9IHI7CgkJCSAgICBzZWxmLmNsZWFyQ29sb3JbMV0gPSBnOwoJCQkgICAgc2VsZi5jbGVhckNvbG9yWzJdID0gYjsKCQkJICAgIHNlbGYuY2xlYXJDb2xvclszXSA9IGE7CgkJCSAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmNhbGwoZ2wsIHIsIGcsIGIsIGEpOwoJCQkgIH07CgkJCSAgdGhpcy52aWV3cG9ydCA9IGdsLmdldFBhcmFtZXRlcihnbC5WSUVXUE9SVCk7CgkJCSAgZ2wudmlld3BvcnQgPSBmdW5jdGlvbiAoeCwgeSwgdywgaCkgewoJCQkgICAgc2VsZi52aWV3cG9ydFswXSA9IHg7CgkJCSAgICBzZWxmLnZpZXdwb3J0WzFdID0geTsKCQkJICAgIHNlbGYudmlld3BvcnRbMl0gPSB3OwoJCQkgICAgc2VsZi52aWV3cG9ydFszXSA9IGg7CgkJCSAgICBzZWxmLnJlYWxWaWV3cG9ydC5jYWxsKGdsLCB4LCB5LCB3LCBoKTsKCQkJICB9OwoJCQkgIHRoaXMuaXNQYXRjaGVkID0gdHJ1ZTsKCQkJICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpOwoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnVucGF0Y2ggPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKCF0aGlzLmlzUGF0Y2hlZCkgewoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKCQkJICBpZiAoIWlzSU9TKCkpIHsKCQkJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICd3aWR0aCcsIHRoaXMucmVhbENhbnZhc1dpZHRoKTsKCQkJICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjYW52YXMsICdoZWlnaHQnLCB0aGlzLnJlYWxDYW52YXNIZWlnaHQpOwoJCQkgIH0KCQkJICBjYW52YXMud2lkdGggPSB0aGlzLmJ1ZmZlcldpZHRoOwoJCQkgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLmJ1ZmZlckhlaWdodDsKCQkJICBnbC5iaW5kRnJhbWVidWZmZXIgPSB0aGlzLnJlYWxCaW5kRnJhbWVidWZmZXI7CgkJCSAgZ2wuZW5hYmxlID0gdGhpcy5yZWFsRW5hYmxlOwoJCQkgIGdsLmRpc2FibGUgPSB0aGlzLnJlYWxEaXNhYmxlOwoJCQkgIGdsLmNvbG9yTWFzayA9IHRoaXMucmVhbENvbG9yTWFzazsKCQkJICBnbC5jbGVhckNvbG9yID0gdGhpcy5yZWFsQ2xlYXJDb2xvcjsKCQkJICBnbC52aWV3cG9ydCA9IHRoaXMucmVhbFZpZXdwb3J0OwoJCQkgIGlmICh0aGlzLmxhc3RCb3VuZEZyYW1lYnVmZmVyID09IHRoaXMuZnJhbWVidWZmZXIpIHsKCQkJICAgIGdsLmJpbmRGcmFtZWJ1ZmZlcihnbC5GUkFNRUJVRkZFUiwgbnVsbCk7CgkJCSAgfQoJCQkgIHRoaXMuaXNQYXRjaGVkID0gZmFsc2U7CgkJCSAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCSAgICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChjYW52YXMpOwoJCQkgIH0sIDEpOwoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnNldFRleHR1cmVCb3VuZHMgPSBmdW5jdGlvbiAobGVmdEJvdW5kcywgcmlnaHRCb3VuZHMpIHsKCQkJICBpZiAoIWxlZnRCb3VuZHMpIHsKCQkJICAgIGxlZnRCb3VuZHMgPSBbMCwgMCwgMC41LCAxXTsKCQkJICB9CgkJCSAgaWYgKCFyaWdodEJvdW5kcykgewoJCQkgICAgcmlnaHRCb3VuZHMgPSBbMC41LCAwLCAwLjUsIDFdOwoJCQkgIH0KCQkJICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbMF0gPSBsZWZ0Qm91bmRzWzBdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVsxXSA9IGxlZnRCb3VuZHNbMV07CgkJCSAgdGhpcy52aWV3cG9ydE9mZnNldFNjYWxlWzJdID0gbGVmdEJvdW5kc1syXTsKCQkJICB0aGlzLnZpZXdwb3J0T2Zmc2V0U2NhbGVbM10gPSBsZWZ0Qm91bmRzWzNdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs0XSA9IHJpZ2h0Qm91bmRzWzBdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs1XSA9IHJpZ2h0Qm91bmRzWzFdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs2XSA9IHJpZ2h0Qm91bmRzWzJdOwoJCQkgIHRoaXMudmlld3BvcnRPZmZzZXRTY2FsZVs3XSA9IHJpZ2h0Qm91bmRzWzNdOwoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBnbFN0YXRlID0gW107CgkJCSAgaWYgKCF0aGlzLmRpcnR5U3VibWl0RnJhbWVCaW5kaW5ncykgewoJCQkgICAgZ2xTdGF0ZS5wdXNoKGdsLkNVUlJFTlRfUFJPR1JBTSwgZ2wuQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSX0JJTkRJTkcsIGdsLlRFWFRVUkVfQklORElOR18yRCwgZ2wuVEVYVFVSRTApOwoJCQkgIH0KCQkJICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewoJCQkgICAgc2VsZi5yZWFsQmluZEZyYW1lYnVmZmVyLmNhbGwoZ2wsIGdsLkZSQU1FQlVGRkVSLCBudWxsKTsKCQkJICAgIHZhciBwb3NpdGlvbkRpdmlzb3IgPSAwOwoJCQkgICAgdmFyIHRleENvb3JkRGl2aXNvciA9IDA7CgkJCSAgICBpZiAoc2VsZi5pbnN0YW5jZUV4dCkgewoJCQkgICAgICBwb3NpdGlvbkRpdmlzb3IgPSBnbC5nZXRWZXJ0ZXhBdHRyaWIoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCBzZWxmLmluc3RhbmNlRXh0LlZFUlRFWF9BVFRSSUJfQVJSQVlfRElWSVNPUl9BTkdMRSk7CgkJCSAgICAgIHRleENvb3JkRGl2aXNvciA9IGdsLmdldFZlcnRleEF0dHJpYihzZWxmLmF0dHJpYnMudGV4Q29vcmQsIHNlbGYuaW5zdGFuY2VFeHQuVkVSVEVYX0FUVFJJQl9BUlJBWV9ESVZJU09SX0FOR0xFKTsKCQkJICAgIH0KCQkJICAgIGlmIChzZWxmLmN1bGxGYWNlKSB7CgkJCSAgICAgIHNlbGYucmVhbERpc2FibGUuY2FsbChnbCwgZ2wuQ1VMTF9GQUNFKTsKCQkJICAgIH0KCQkJICAgIGlmIChzZWxmLmRlcHRoVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLkRFUFRIX1RFU1QpOwoJCQkgICAgfQoJCQkgICAgaWYgKHNlbGYuYmxlbmQpIHsKCQkJICAgICAgc2VsZi5yZWFsRGlzYWJsZS5jYWxsKGdsLCBnbC5CTEVORCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5zY2lzc29yVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5zdGVuY2lsVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxEaXNhYmxlLmNhbGwoZ2wsIGdsLlNURU5DSUxfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBzZWxmLnJlYWxDb2xvck1hc2suY2FsbChnbCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSk7CgkJCSAgICBzZWxmLnJlYWxWaWV3cG9ydC5jYWxsKGdsLCAwLCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwoJCQkgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5hbHBoYSB8fCBpc0lPUygpKSB7CgkJCSAgICAgIHNlbGYucmVhbENsZWFyQ29sb3IuY2FsbChnbCwgMCwgMCwgMCwgMSk7CgkJCSAgICAgIGdsLmNsZWFyKGdsLkNPTE9SX0JVRkZFUl9CSVQpOwoJCQkgICAgfQoJCQkgICAgZ2wudXNlUHJvZ3JhbShzZWxmLnByb2dyYW0pOwoJCQkgICAgZ2wuYmluZEJ1ZmZlcihnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgc2VsZi5pbmRleEJ1ZmZlcik7CgkJCSAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgc2VsZi52ZXJ0ZXhCdWZmZXIpOwoJCQkgICAgZ2wuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkoc2VsZi5hdHRyaWJzLnBvc2l0aW9uKTsKCQkJICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHNlbGYuYXR0cmlicy50ZXhDb29yZCk7CgkJCSAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHNlbGYuYXR0cmlicy5wb3NpdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAyMCwgMCk7CgkJCSAgICBnbC52ZXJ0ZXhBdHRyaWJQb2ludGVyKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgMywgZ2wuRkxPQVQsIGZhbHNlLCAyMCwgOCk7CgkJCSAgICBpZiAoc2VsZi5pbnN0YW5jZUV4dCkgewoJCQkgICAgICBpZiAocG9zaXRpb25EaXZpc29yICE9IDApIHsKCQkJICAgICAgICBzZWxmLmluc3RhbmNlRXh0LnZlcnRleEF0dHJpYkRpdmlzb3JBTkdMRShzZWxmLmF0dHJpYnMucG9zaXRpb24sIDApOwoJCQkgICAgICB9CgkJCSAgICAgIGlmICh0ZXhDb29yZERpdmlzb3IgIT0gMCkgewoJCQkgICAgICAgIHNlbGYuaW5zdGFuY2VFeHQudmVydGV4QXR0cmliRGl2aXNvckFOR0xFKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgMCk7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApOwoJCQkgICAgZ2wudW5pZm9ybTFpKHNlbGYudW5pZm9ybXMuZGlmZnVzZSwgMCk7CgkJCSAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzZWxmLnJlbmRlclRhcmdldCk7CgkJCSAgICBnbC51bmlmb3JtNGZ2KHNlbGYudW5pZm9ybXMudmlld3BvcnRPZmZzZXRTY2FsZSwgc2VsZi52aWV3cG9ydE9mZnNldFNjYWxlKTsKCQkJICAgIGdsLmRyYXdFbGVtZW50cyhnbC5UUklBTkdMRVMsIHNlbGYuaW5kZXhDb3VudCwgZ2wuVU5TSUdORURfU0hPUlQsIDApOwoJCQkgICAgaWYgKHNlbGYuY2FyZGJvYXJkVUkpIHsKCQkJICAgICAgc2VsZi5jYXJkYm9hcmRVSS5yZW5kZXJOb1N0YXRlKCk7CgkJCSAgICB9CgkJCSAgICBzZWxmLnJlYWxCaW5kRnJhbWVidWZmZXIuY2FsbChzZWxmLmdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5mcmFtZWJ1ZmZlcik7CgkJCSAgICBpZiAoIXNlbGYuY3R4QXR0cmlicy5wcmVzZXJ2ZURyYXdpbmdCdWZmZXIpIHsKCQkJICAgICAgc2VsZi5yZWFsQ2xlYXJDb2xvci5jYWxsKGdsLCAwLCAwLCAwLCAwKTsKCQkJICAgICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoIXNlbGYuZGlydHlTdWJtaXRGcmFtZUJpbmRpbmdzKSB7CgkJCSAgICAgIHNlbGYucmVhbEJpbmRGcmFtZWJ1ZmZlci5jYWxsKGdsLCBnbC5GUkFNRUJVRkZFUiwgc2VsZi5sYXN0Qm91bmRGcmFtZWJ1ZmZlcik7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5jdWxsRmFjZSkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuQ1VMTF9GQUNFKTsKCQkJICAgIH0KCQkJICAgIGlmIChzZWxmLmRlcHRoVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuREVQVEhfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5ibGVuZCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuQkxFTkQpOwoJCQkgICAgfQoJCQkgICAgaWYgKHNlbGYuc2Npc3NvclRlc3QpIHsKCQkJICAgICAgc2VsZi5yZWFsRW5hYmxlLmNhbGwoZ2wsIGdsLlNDSVNTT1JfVEVTVCk7CgkJCSAgICB9CgkJCSAgICBpZiAoc2VsZi5zdGVuY2lsVGVzdCkgewoJCQkgICAgICBzZWxmLnJlYWxFbmFibGUuY2FsbChnbCwgZ2wuU1RFTkNJTF9URVNUKTsKCQkJICAgIH0KCQkJICAgIHNlbGYucmVhbENvbG9yTWFzay5hcHBseShnbCwgc2VsZi5jb2xvck1hc2spOwoJCQkgICAgc2VsZi5yZWFsVmlld3BvcnQuYXBwbHkoZ2wsIHNlbGYudmlld3BvcnQpOwoJCQkgICAgaWYgKHNlbGYuY3R4QXR0cmlicy5hbHBoYSB8fCAhc2VsZi5jdHhBdHRyaWJzLnByZXNlcnZlRHJhd2luZ0J1ZmZlcikgewoJCQkgICAgICBzZWxmLnJlYWxDbGVhckNvbG9yLmFwcGx5KGdsLCBzZWxmLmNsZWFyQ29sb3IpOwoJCQkgICAgfQoJCQkgICAgaWYgKHNlbGYuaW5zdGFuY2VFeHQpIHsKCQkJICAgICAgaWYgKHBvc2l0aW9uRGl2aXNvciAhPSAwKSB7CgkJCSAgICAgICAgc2VsZi5pbnN0YW5jZUV4dC52ZXJ0ZXhBdHRyaWJEaXZpc29yQU5HTEUoc2VsZi5hdHRyaWJzLnBvc2l0aW9uLCBwb3NpdGlvbkRpdmlzb3IpOwoJCQkgICAgICB9CgkJCSAgICAgIGlmICh0ZXhDb29yZERpdmlzb3IgIT0gMCkgewoJCQkgICAgICAgIHNlbGYuaW5zdGFuY2VFeHQudmVydGV4QXR0cmliRGl2aXNvckFOR0xFKHNlbGYuYXR0cmlicy50ZXhDb29yZCwgdGV4Q29vcmREaXZpc29yKTsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgIH0pOwoJCQkgIGlmIChpc0lPUygpKSB7CgkJCSAgICB2YXIgY2FudmFzID0gZ2wuY2FudmFzOwoJCQkgICAgaWYgKGNhbnZhcy53aWR0aCAhPSBzZWxmLmJ1ZmZlcldpZHRoIHx8IGNhbnZhcy5oZWlnaHQgIT0gc2VsZi5idWZmZXJIZWlnaHQpIHsKCQkJICAgICAgc2VsZi5idWZmZXJXaWR0aCA9IGNhbnZhcy53aWR0aDsKCQkJICAgICAgc2VsZi5idWZmZXJIZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwoJCQkgICAgICBzZWxmLm9uUmVzaXplKCk7CgkJCSAgICB9CgkJCSAgfQoJCQl9OwoJCQlDYXJkYm9hcmREaXN0b3J0ZXIucHJvdG90eXBlLnVwZGF0ZURldmljZUluZm8gPSBmdW5jdGlvbiAoZGV2aWNlSW5mbykgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBnbFN0YXRlID0gW2dsLkFSUkFZX0JVRkZFUl9CSU5ESU5HLCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUl9CSU5ESU5HXTsKCQkJICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewoJCQkgICAgdmFyIHZlcnRpY2VzID0gc2VsZi5jb21wdXRlTWVzaFZlcnRpY2VzXyhzZWxmLm1lc2hXaWR0aCwgc2VsZi5tZXNoSGVpZ2h0LCBkZXZpY2VJbmZvKTsKCQkJICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBzZWxmLnZlcnRleEJ1ZmZlcik7CgkJCSAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdmVydGljZXMsIGdsLlNUQVRJQ19EUkFXKTsKCQkJICAgIGlmICghc2VsZi5pbmRleENvdW50KSB7CgkJCSAgICAgIHZhciBpbmRpY2VzID0gc2VsZi5jb21wdXRlTWVzaEluZGljZXNfKHNlbGYubWVzaFdpZHRoLCBzZWxmLm1lc2hIZWlnaHQpOwoJCQkgICAgICBnbC5iaW5kQnVmZmVyKGdsLkVMRU1FTlRfQVJSQVlfQlVGRkVSLCBzZWxmLmluZGV4QnVmZmVyKTsKCQkJICAgICAgZ2wuYnVmZmVyRGF0YShnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgaW5kaWNlcywgZ2wuU1RBVElDX0RSQVcpOwoJCQkgICAgICBzZWxmLmluZGV4Q291bnQgPSBpbmRpY2VzLmxlbmd0aDsKCQkJICAgIH0KCQkJICB9KTsKCQkJfTsKCQkJQ2FyZGJvYXJkRGlzdG9ydGVyLnByb3RvdHlwZS5jb21wdXRlTWVzaFZlcnRpY2VzXyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCBkZXZpY2VJbmZvKSB7CgkJCSAgdmFyIHZlcnRpY2VzID0gbmV3IEZsb2F0MzJBcnJheSgyICogd2lkdGggKiBoZWlnaHQgKiA1KTsKCQkJICB2YXIgbGVuc0ZydXN0dW0gPSBkZXZpY2VJbmZvLmdldExlZnRFeWVWaXNpYmxlVGFuQW5nbGVzKCk7CgkJCSAgdmFyIG5vTGVuc0ZydXN0dW0gPSBkZXZpY2VJbmZvLmdldExlZnRFeWVOb0xlbnNUYW5BbmdsZXMoKTsKCQkJICB2YXIgdmlld3BvcnQgPSBkZXZpY2VJbmZvLmdldExlZnRFeWVWaXNpYmxlU2NyZWVuUmVjdChub0xlbnNGcnVzdHVtKTsKCQkJICB2YXIgdmlkeCA9IDA7CgkJCSAgZm9yICh2YXIgZSA9IDA7IGUgPCAyOyBlKyspIHsKCQkJICAgIGZvciAodmFyIGogPSAwOyBqIDwgaGVpZ2h0OyBqKyspIHsKCQkJICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3aWR0aDsgaSsrLCB2aWR4KyspIHsKCQkJICAgICAgICB2YXIgdSA9IGkgLyAod2lkdGggLSAxKTsKCQkJICAgICAgICB2YXIgdiA9IGogLyAoaGVpZ2h0IC0gMSk7CgkJCSAgICAgICAgdmFyIHMgPSB1OwoJCQkgICAgICAgIHZhciB0ID0gdjsKCQkJICAgICAgICB2YXIgeCA9IGxlcnAobGVuc0ZydXN0dW1bMF0sIGxlbnNGcnVzdHVtWzJdLCB1KTsKCQkJICAgICAgICB2YXIgeSA9IGxlcnAobGVuc0ZydXN0dW1bM10sIGxlbnNGcnVzdHVtWzFdLCB2KTsKCQkJICAgICAgICB2YXIgZCA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTsKCQkJICAgICAgICB2YXIgciA9IGRldmljZUluZm8uZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShkKTsKCQkJICAgICAgICB2YXIgcCA9IHggKiByIC8gZDsKCQkJICAgICAgICB2YXIgcSA9IHkgKiByIC8gZDsKCQkJICAgICAgICB1ID0gKHAgLSBub0xlbnNGcnVzdHVtWzBdKSAvIChub0xlbnNGcnVzdHVtWzJdIC0gbm9MZW5zRnJ1c3R1bVswXSk7CgkJCSAgICAgICAgdiA9IChxIC0gbm9MZW5zRnJ1c3R1bVszXSkgLyAobm9MZW5zRnJ1c3R1bVsxXSAtIG5vTGVuc0ZydXN0dW1bM10pOwoJCQkgICAgICAgIHUgPSAodmlld3BvcnQueCArIHUgKiB2aWV3cG9ydC53aWR0aCAtIDAuNSkgKiAyLjA7CgkJCSAgICAgICAgdiA9ICh2aWV3cG9ydC55ICsgdiAqIHZpZXdwb3J0LmhlaWdodCAtIDAuNSkgKiAyLjA7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAwXSA9IHU7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAxXSA9IHY7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAyXSA9IHM7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyAzXSA9IHQ7CgkJCSAgICAgICAgdmVydGljZXNbdmlkeCAqIDUgKyA0XSA9IGU7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICAgIHZhciB3ID0gbGVuc0ZydXN0dW1bMl0gLSBsZW5zRnJ1c3R1bVswXTsKCQkJICAgIGxlbnNGcnVzdHVtWzBdID0gLSh3ICsgbGVuc0ZydXN0dW1bMF0pOwoJCQkgICAgbGVuc0ZydXN0dW1bMl0gPSB3IC0gbGVuc0ZydXN0dW1bMl07CgkJCSAgICB3ID0gbm9MZW5zRnJ1c3R1bVsyXSAtIG5vTGVuc0ZydXN0dW1bMF07CgkJCSAgICBub0xlbnNGcnVzdHVtWzBdID0gLSh3ICsgbm9MZW5zRnJ1c3R1bVswXSk7CgkJCSAgICBub0xlbnNGcnVzdHVtWzJdID0gdyAtIG5vTGVuc0ZydXN0dW1bMl07CgkJCSAgICB2aWV3cG9ydC54ID0gMSAtICh2aWV3cG9ydC54ICsgdmlld3BvcnQud2lkdGgpOwoJCQkgIH0KCQkJICByZXR1cm4gdmVydGljZXM7CgkJCX07CgkJCUNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuY29tcHV0ZU1lc2hJbmRpY2VzXyA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7CgkJCSAgdmFyIGluZGljZXMgPSBuZXcgVWludDE2QXJyYXkoMiAqICh3aWR0aCAtIDEpICogKGhlaWdodCAtIDEpICogNik7CgkJCSAgdmFyIGhhbGZ3aWR0aCA9IHdpZHRoIC8gMjsKCQkJICB2YXIgaGFsZmhlaWdodCA9IGhlaWdodCAvIDI7CgkJCSAgdmFyIHZpZHggPSAwOwoJCQkgIHZhciBpaWR4ID0gMDsKCQkJICBmb3IgKHZhciBlID0gMDsgZSA8IDI7IGUrKykgewoJCQkgICAgZm9yICh2YXIgaiA9IDA7IGogPCBoZWlnaHQ7IGorKykgewoJCQkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdpZHRoOyBpKyssIHZpZHgrKykgewoJCQkgICAgICAgIGlmIChpID09IDAgfHwgaiA9PSAwKSBjb250aW51ZTsKCQkJICAgICAgICBpZiAoaSA8PSBoYWxmd2lkdGggPT0gaiA8PSBoYWxmaGVpZ2h0KSB7CgkJCSAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aCAtIDE7CgkJCSAgICAgICAgICBpbmRpY2VzW2lpZHgrK10gPSB2aWR4OwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIDE7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoOwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeDsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSB3aWR0aDsKCQkJICAgICAgICAgIGluZGljZXNbaWlkeCsrXSA9IHZpZHggLSAxOwoJCQkgICAgICAgICAgaW5kaWNlc1tpaWR4KytdID0gdmlkeCAtIHdpZHRoIC0gMTsKCQkJICAgICAgICB9CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICB9CgkJCSAgcmV0dXJuIGluZGljZXM7CgkJCX07CgkJCUNhcmRib2FyZERpc3RvcnRlci5wcm90b3R5cGUuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yXyA9IGZ1bmN0aW9uIChwcm90bywgYXR0ck5hbWUpIHsKCQkJICB2YXIgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IocHJvdG8sIGF0dHJOYW1lKTsKCQkJICBpZiAoZGVzY3JpcHRvci5nZXQgPT09IHVuZGVmaW5lZCB8fCBkZXNjcmlwdG9yLnNldCA9PT0gdW5kZWZpbmVkKSB7CgkJCSAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7CgkJCSAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlOwoJCQkgICAgZGVzY3JpcHRvci5nZXQgPSBmdW5jdGlvbiAoKSB7CgkJCSAgICAgIHJldHVybiB0aGlzLmdldEF0dHJpYnV0ZShhdHRyTmFtZSk7CgkJCSAgICB9OwoJCQkgICAgZGVzY3JpcHRvci5zZXQgPSBmdW5jdGlvbiAodmFsKSB7CgkJCSAgICAgIHRoaXMuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCB2YWwpOwoJCQkgICAgfTsKCQkJICB9CgkJCSAgcmV0dXJuIGRlc2NyaXB0b3I7CgkJCX07CgkJCXZhciB1aVZTID0gWydhdHRyaWJ1dGUgdmVjMiBwb3NpdGlvbjsnLCAndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXQ7JywgJ3ZvaWQgbWFpbigpIHsnLCAnICBnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXQgKiB2ZWM0KCBwb3NpdGlvbiwgLTEuMCwgMS4wICk7JywgJ30nXS5qb2luKCdcbicpOwoJCQl2YXIgdWlGUyA9IFsncHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7JywgJ3VuaWZvcm0gdmVjNCBjb2xvcjsnLCAndm9pZCBtYWluKCkgeycsICcgIGdsX0ZyYWdDb2xvciA9IGNvbG9yOycsICd9J10uam9pbignXG4nKTsKCQkJdmFyIERFRzJSQUQgPSBNYXRoLlBJIC8gMTgwLjA7CgkJCXZhciBrQW5nbGVQZXJHZWFyU2VjdGlvbiA9IDYwOwoJCQl2YXIga091dGVyUmltRW5kQW5nbGUgPSAxMjsKCQkJdmFyIGtJbm5lclJpbUJlZ2luQW5nbGUgPSAyMDsKCQkJdmFyIGtPdXRlclJhZGl1cyA9IDE7CgkJCXZhciBrTWlkZGxlUmFkaXVzID0gMC43NTsKCQkJdmFyIGtJbm5lclJhZGl1cyA9IDAuMzEyNTsKCQkJdmFyIGtDZW50ZXJMaW5lVGhpY2tuZXNzRHAgPSA0OwoJCQl2YXIga0J1dHRvbldpZHRoRHAgPSAyODsKCQkJdmFyIGtUb3VjaFNsb3BGYWN0b3IgPSAxLjU7CgkJCWZ1bmN0aW9uIENhcmRib2FyZFVJKGdsKSB7CgkJCSAgdGhpcy5nbCA9IGdsOwoJCQkgIHRoaXMuYXR0cmlicyA9IHsKCQkJICAgIHBvc2l0aW9uOiAwCgkJCSAgfTsKCQkJICB0aGlzLnByb2dyYW0gPSBsaW5rUHJvZ3JhbShnbCwgdWlWUywgdWlGUywgdGhpcy5hdHRyaWJzKTsKCQkJICB0aGlzLnVuaWZvcm1zID0gZ2V0UHJvZ3JhbVVuaWZvcm1zKGdsLCB0aGlzLnByb2dyYW0pOwoJCQkgIHRoaXMudmVydGV4QnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7CgkJCSAgdGhpcy5nZWFyT2Zmc2V0ID0gMDsKCQkJICB0aGlzLmdlYXJWZXJ0ZXhDb3VudCA9IDA7CgkJCSAgdGhpcy5hcnJvd09mZnNldCA9IDA7CgkJCSAgdGhpcy5hcnJvd1ZlcnRleENvdW50ID0gMDsKCQkJICB0aGlzLnByb2pNYXQgPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKCQkJICB0aGlzLmxpc3RlbmVyID0gbnVsbDsKCQkJICB0aGlzLm9uUmVzaXplKCk7CgkJCX0KCQkJQ2FyZGJvYXJkVUkucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIGdsID0gdGhpcy5nbDsKCQkJICBpZiAodGhpcy5saXN0ZW5lcikgewoJCQkgICAgZ2wuY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5saXN0ZW5lciwgZmFsc2UpOwoJCQkgIH0KCQkJICBnbC5kZWxldGVQcm9ncmFtKHRoaXMucHJvZ3JhbSk7CgkJCSAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMudmVydGV4QnVmZmVyKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVUkucHJvdG90eXBlLmxpc3RlbiA9IGZ1bmN0aW9uIChvcHRpb25zQ2FsbGJhY2ssIGJhY2tDYWxsYmFjaykgewoJCQkgIHZhciBjYW52YXMgPSB0aGlzLmdsLmNhbnZhczsKCQkJICB0aGlzLmxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7CgkJCSAgICB2YXIgbWlkbGluZSA9IGNhbnZhcy5jbGllbnRXaWR0aCAvIDI7CgkJCSAgICB2YXIgYnV0dG9uU2l6ZSA9IGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvcjsKCQkJICAgIGlmIChldmVudC5jbGllbnRYID4gbWlkbGluZSAtIGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WCA8IG1pZGxpbmUgKyBidXR0b25TaXplICYmIGV2ZW50LmNsaWVudFkgPiBjYW52YXMuY2xpZW50SGVpZ2h0IC0gYnV0dG9uU2l6ZSkgewoJCQkgICAgICBvcHRpb25zQ2FsbGJhY2soZXZlbnQpOwoJCQkgICAgfQoJCQkgICAgZWxzZSBpZiAoZXZlbnQuY2xpZW50WCA8IGJ1dHRvblNpemUgJiYgZXZlbnQuY2xpZW50WSA8IGJ1dHRvblNpemUpIHsKCQkJICAgICAgICBiYWNrQ2FsbGJhY2soZXZlbnQpOwoJCQkgICAgICB9CgkJCSAgfTsKCQkJICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmxpc3RlbmVyLCBmYWxzZSk7CgkJCX07CgkJCUNhcmRib2FyZFVJLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIHZhciBzZWxmID0gdGhpczsKCQkJICB2YXIgZ2xTdGF0ZSA9IFtnbC5BUlJBWV9CVUZGRVJfQklORElOR107CgkJCSAgZ2xQcmVzZXJ2ZVN0YXRlKGdsLCBnbFN0YXRlLCBmdW5jdGlvbiAoZ2wpIHsKCQkJICAgIHZhciB2ZXJ0aWNlcyA9IFtdOwoJCQkgICAgdmFyIG1pZGxpbmUgPSBnbC5kcmF3aW5nQnVmZmVyV2lkdGggLyAyOwoJCQkgICAgdmFyIHBoeXNpY2FsUGl4ZWxzID0gTWF0aC5tYXgoc2NyZWVuLndpZHRoLCBzY3JlZW4uaGVpZ2h0KSAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwoJCQkgICAgdmFyIHNjYWxpbmdSYXRpbyA9IGdsLmRyYXdpbmdCdWZmZXJXaWR0aCAvIHBoeXNpY2FsUGl4ZWxzOwoJCQkgICAgdmFyIGRwcyA9IHNjYWxpbmdSYXRpbyAqIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvOwoJCQkgICAgdmFyIGxpbmVXaWR0aCA9IGtDZW50ZXJMaW5lVGhpY2tuZXNzRHAgKiBkcHMgLyAyOwoJCQkgICAgdmFyIGJ1dHRvblNpemUgPSBrQnV0dG9uV2lkdGhEcCAqIGtUb3VjaFNsb3BGYWN0b3IgKiBkcHM7CgkJCSAgICB2YXIgYnV0dG9uU2NhbGUgPSBrQnV0dG9uV2lkdGhEcCAqIGRwcyAvIDI7CgkJCSAgICB2YXIgYnV0dG9uQm9yZGVyID0gKGtCdXR0b25XaWR0aERwICoga1RvdWNoU2xvcEZhY3RvciAtIGtCdXR0b25XaWR0aERwKSAqIGRwczsKCQkJICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSAtIGxpbmVXaWR0aCwgYnV0dG9uU2l6ZSk7CgkJCSAgICB2ZXJ0aWNlcy5wdXNoKG1pZGxpbmUgLSBsaW5lV2lkdGgsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQpOwoJCQkgICAgdmVydGljZXMucHVzaChtaWRsaW5lICsgbGluZVdpZHRoLCBidXR0b25TaXplKTsKCQkJICAgIHZlcnRpY2VzLnB1c2gobWlkbGluZSArIGxpbmVXaWR0aCwgZ2wuZHJhd2luZ0J1ZmZlckhlaWdodCk7CgkJCSAgICBzZWxmLmdlYXJPZmZzZXQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyOwoJCQkgICAgZnVuY3Rpb24gYWRkR2VhclNlZ21lbnQodGhldGEsIHIpIHsKCQkJICAgICAgdmFyIGFuZ2xlID0gKDkwIC0gdGhldGEpICogREVHMlJBRDsKCQkJICAgICAgdmFyIHggPSBNYXRoLmNvcyhhbmdsZSk7CgkJCSAgICAgIHZhciB5ID0gTWF0aC5zaW4oYW5nbGUpOwoJCQkgICAgICB2ZXJ0aWNlcy5wdXNoKGtJbm5lclJhZGl1cyAqIHggKiBidXR0b25TY2FsZSArIG1pZGxpbmUsIGtJbm5lclJhZGl1cyAqIHkgKiBidXR0b25TY2FsZSArIGJ1dHRvblNjYWxlKTsKCQkJICAgICAgdmVydGljZXMucHVzaChyICogeCAqIGJ1dHRvblNjYWxlICsgbWlkbGluZSwgciAqIHkgKiBidXR0b25TY2FsZSArIGJ1dHRvblNjYWxlKTsKCQkJICAgIH0KCQkJICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IDY7IGkrKykgewoJCQkgICAgICB2YXIgc2VnbWVudFRoZXRhID0gaSAqIGtBbmdsZVBlckdlYXJTZWN0aW9uOwoJCQkgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEsIGtPdXRlclJhZGl1cyk7CgkJCSAgICAgIGFkZEdlYXJTZWdtZW50KHNlZ21lbnRUaGV0YSArIGtPdXRlclJpbUVuZEFuZ2xlLCBrT3V0ZXJSYWRpdXMpOwoJCQkgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyBrSW5uZXJSaW1CZWdpbkFuZ2xlLCBrTWlkZGxlUmFkaXVzKTsKCQkJICAgICAgYWRkR2VhclNlZ21lbnQoc2VnbWVudFRoZXRhICsgKGtBbmdsZVBlckdlYXJTZWN0aW9uIC0ga0lubmVyUmltQmVnaW5BbmdsZSksIGtNaWRkbGVSYWRpdXMpOwoJCQkgICAgICBhZGRHZWFyU2VnbWVudChzZWdtZW50VGhldGEgKyAoa0FuZ2xlUGVyR2VhclNlY3Rpb24gLSBrT3V0ZXJSaW1FbmRBbmdsZSksIGtPdXRlclJhZGl1cyk7CgkJCSAgICB9CgkJCSAgICBzZWxmLmdlYXJWZXJ0ZXhDb3VudCA9IHZlcnRpY2VzLmxlbmd0aCAvIDIgLSBzZWxmLmdlYXJPZmZzZXQ7CgkJCSAgICBzZWxmLmFycm93T2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMjsKCQkJICAgIGZ1bmN0aW9uIGFkZEFycm93VmVydGV4KHgsIHkpIHsKCQkJICAgICAgdmVydGljZXMucHVzaChidXR0b25Cb3JkZXIgKyB4LCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0IC0gYnV0dG9uQm9yZGVyIC0geSk7CgkJCSAgICB9CgkJCSAgICB2YXIgYW5nbGVkTGluZVdpZHRoID0gbGluZVdpZHRoIC8gTWF0aC5zaW4oNDUgKiBERUcyUkFEKTsKCQkJICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlLCAwKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlICsgYW5nbGVkTGluZVdpZHRoLCBhbmdsZWRMaW5lV2lkdGgpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoYW5nbGVkTGluZVdpZHRoLCBidXR0b25TY2FsZSArIGFuZ2xlZExpbmVXaWR0aCk7CgkJCSAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlIC0gYW5nbGVkTGluZVdpZHRoKTsKCQkJICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGJ1dHRvblNjYWxlLCBidXR0b25TY2FsZSAqIDIpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoYnV0dG9uU2NhbGUgKyBhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlICogMiAtIGFuZ2xlZExpbmVXaWR0aCk7CgkJCSAgICBhZGRBcnJvd1ZlcnRleChhbmdsZWRMaW5lV2lkdGgsIGJ1dHRvblNjYWxlIC0gYW5nbGVkTGluZVdpZHRoKTsKCQkJICAgIGFkZEFycm93VmVydGV4KDAsIGJ1dHRvblNjYWxlKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgLSBsaW5lV2lkdGgpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoa0J1dHRvbldpZHRoRHAgKiBkcHMsIGJ1dHRvblNjYWxlIC0gbGluZVdpZHRoKTsKCQkJICAgIGFkZEFycm93VmVydGV4KGFuZ2xlZExpbmVXaWR0aCwgYnV0dG9uU2NhbGUgKyBsaW5lV2lkdGgpOwoJCQkgICAgYWRkQXJyb3dWZXJ0ZXgoa0J1dHRvbldpZHRoRHAgKiBkcHMsIGJ1dHRvblNjYWxlICsgbGluZVdpZHRoKTsKCQkJICAgIHNlbGYuYXJyb3dWZXJ0ZXhDb3VudCA9IHZlcnRpY2VzLmxlbmd0aCAvIDIgLSBzZWxmLmFycm93T2Zmc2V0OwoJCQkgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHNlbGYudmVydGV4QnVmZmVyKTsKCQkJICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKSwgZ2wuU1RBVElDX0RSQVcpOwoJCQkgIH0pOwoJCQl9OwoJCQlDYXJkYm9hcmRVSS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMuZ2w7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIHZhciBnbFN0YXRlID0gW2dsLkNVTExfRkFDRSwgZ2wuREVQVEhfVEVTVCwgZ2wuQkxFTkQsIGdsLlNDSVNTT1JfVEVTVCwgZ2wuU1RFTkNJTF9URVNULCBnbC5DT0xPUl9XUklURU1BU0ssIGdsLlZJRVdQT1JULCBnbC5DVVJSRU5UX1BST0dSQU0sIGdsLkFSUkFZX0JVRkZFUl9CSU5ESU5HXTsKCQkJICBnbFByZXNlcnZlU3RhdGUoZ2wsIGdsU3RhdGUsIGZ1bmN0aW9uIChnbCkgewoJCQkgICAgZ2wuZGlzYWJsZShnbC5DVUxMX0ZBQ0UpOwoJCQkgICAgZ2wuZGlzYWJsZShnbC5ERVBUSF9URVNUKTsKCQkJICAgIGdsLmRpc2FibGUoZ2wuQkxFTkQpOwoJCQkgICAgZ2wuZGlzYWJsZShnbC5TQ0lTU09SX1RFU1QpOwoJCQkgICAgZ2wuZGlzYWJsZShnbC5TVEVOQ0lMX1RFU1QpOwoJCQkgICAgZ2wuY29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpOwoJCQkgICAgZ2wudmlld3BvcnQoMCwgMCwgZ2wuZHJhd2luZ0J1ZmZlcldpZHRoLCBnbC5kcmF3aW5nQnVmZmVySGVpZ2h0KTsKCQkJICAgIHNlbGYucmVuZGVyTm9TdGF0ZSgpOwoJCQkgIH0pOwoJCQl9OwoJCQlDYXJkYm9hcmRVSS5wcm90b3R5cGUucmVuZGVyTm9TdGF0ZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZ2wgPSB0aGlzLmdsOwoJCQkgIGdsLnVzZVByb2dyYW0odGhpcy5wcm9ncmFtKTsKCQkJICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy52ZXJ0ZXhCdWZmZXIpOwoJCQkgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KHRoaXMuYXR0cmlicy5wb3NpdGlvbik7CgkJCSAgZ2wudmVydGV4QXR0cmliUG9pbnRlcih0aGlzLmF0dHJpYnMucG9zaXRpb24sIDIsIGdsLkZMT0FULCBmYWxzZSwgOCwgMCk7CgkJCSAgZ2wudW5pZm9ybTRmKHRoaXMudW5pZm9ybXMuY29sb3IsIDEuMCwgMS4wLCAxLjAsIDEuMCk7CgkJCSAgb3J0aG9NYXRyaXgodGhpcy5wcm9qTWF0LCAwLCBnbC5kcmF3aW5nQnVmZmVyV2lkdGgsIDAsIGdsLmRyYXdpbmdCdWZmZXJIZWlnaHQsIDAuMSwgMTAyNC4wKTsKCQkJICBnbC51bmlmb3JtTWF0cml4NGZ2KHRoaXMudW5pZm9ybXMucHJvamVjdGlvbk1hdCwgZmFsc2UsIHRoaXMucHJvak1hdCk7CgkJCSAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgMCwgNCk7CgkJCSAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgdGhpcy5nZWFyT2Zmc2V0LCB0aGlzLmdlYXJWZXJ0ZXhDb3VudCk7CgkJCSAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRV9TVFJJUCwgdGhpcy5hcnJvd09mZnNldCwgdGhpcy5hcnJvd1ZlcnRleENvdW50KTsKCQkJfTsKCQkJZnVuY3Rpb24gRGlzdG9ydGlvbihjb2VmZmljaWVudHMpIHsKCQkJICB0aGlzLmNvZWZmaWNpZW50cyA9IGNvZWZmaWNpZW50czsKCQkJfQoJCQlEaXN0b3J0aW9uLnByb3RvdHlwZS5kaXN0b3J0SW52ZXJzZSA9IGZ1bmN0aW9uIChyYWRpdXMpIHsKCQkJICB2YXIgcjAgPSAwOwoJCQkgIHZhciByMSA9IDE7CgkJCSAgdmFyIGRyMCA9IHJhZGl1cyAtIHRoaXMuZGlzdG9ydChyMCk7CgkJCSAgd2hpbGUgKE1hdGguYWJzKHIxIC0gcjApID4gMC4wMDAxICAgICAgICAgICAgICkgewoJCQkgICAgdmFyIGRyMSA9IHJhZGl1cyAtIHRoaXMuZGlzdG9ydChyMSk7CgkJCSAgICB2YXIgcjIgPSByMSAtIGRyMSAqICgocjEgLSByMCkgLyAoZHIxIC0gZHIwKSk7CgkJCSAgICByMCA9IHIxOwoJCQkgICAgcjEgPSByMjsKCQkJICAgIGRyMCA9IGRyMTsKCQkJICB9CgkJCSAgcmV0dXJuIHIxOwoJCQl9OwoJCQlEaXN0b3J0aW9uLnByb3RvdHlwZS5kaXN0b3J0ID0gZnVuY3Rpb24gKHJhZGl1cykgewoJCQkgIHZhciByMiA9IHJhZGl1cyAqIHJhZGl1czsKCQkJICB2YXIgcmV0ID0gMDsKCQkJICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29lZmZpY2llbnRzLmxlbmd0aDsgaSsrKSB7CgkJCSAgICByZXQgPSByMiAqIChyZXQgKyB0aGlzLmNvZWZmaWNpZW50c1tpXSk7CgkJCSAgfQoJCQkgIHJldHVybiAocmV0ICsgMSkgKiByYWRpdXM7CgkJCX07CgkJCXZhciBkZWdUb1JhZCA9IE1hdGguUEkgLyAxODA7CgkJCXZhciByYWRUb0RlZyA9IDE4MCAvIE1hdGguUEk7CgkJCXZhciBWZWN0b3IzID0gZnVuY3Rpb24gVmVjdG9yMyh4LCB5LCB6KSB7CgkJCSAgdGhpcy54ID0geCB8fCAwOwoJCQkgIHRoaXMueSA9IHkgfHwgMDsKCQkJICB0aGlzLnogPSB6IHx8IDA7CgkJCX07CgkJCVZlY3RvcjMucHJvdG90eXBlID0gewoJCQkgIGNvbnN0cnVjdG9yOiBWZWN0b3IzLAoJCQkgIHNldDogZnVuY3Rpb24gc2V0KHgsIHksIHopIHsKCQkJICAgIHRoaXMueCA9IHg7CgkJCSAgICB0aGlzLnkgPSB5OwoJCQkgICAgdGhpcy56ID0gejsKCQkJICAgIHJldHVybiB0aGlzOwoJCQkgIH0sCgkJCSAgY29weTogZnVuY3Rpb24gY29weSh2KSB7CgkJCSAgICB0aGlzLnggPSB2Lng7CgkJCSAgICB0aGlzLnkgPSB2Lnk7CgkJCSAgICB0aGlzLnogPSB2Lno7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIGxlbmd0aDogZnVuY3Rpb24gbGVuZ3RoKCkgewoJCQkgICAgcmV0dXJuIE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnopOwoJCQkgIH0sCgkJCSAgbm9ybWFsaXplOiBmdW5jdGlvbiBub3JtYWxpemUoKSB7CgkJCSAgICB2YXIgc2NhbGFyID0gdGhpcy5sZW5ndGgoKTsKCQkJICAgIGlmIChzY2FsYXIgIT09IDApIHsKCQkJICAgICAgdmFyIGludlNjYWxhciA9IDEgLyBzY2FsYXI7CgkJCSAgICAgIHRoaXMubXVsdGlwbHlTY2FsYXIoaW52U2NhbGFyKTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMueCA9IDA7CgkJCSAgICAgIHRoaXMueSA9IDA7CgkJCSAgICAgIHRoaXMueiA9IDA7CgkJCSAgICB9CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIG11bHRpcGx5U2NhbGFyOiBmdW5jdGlvbiBtdWx0aXBseVNjYWxhcihzY2FsYXIpIHsKCQkJICAgIHRoaXMueCAqPSBzY2FsYXI7CgkJCSAgICB0aGlzLnkgKj0gc2NhbGFyOwoJCQkgICAgdGhpcy56ICo9IHNjYWxhcjsKCQkJICB9LAoJCQkgIGFwcGx5UXVhdGVybmlvbjogZnVuY3Rpb24gYXBwbHlRdWF0ZXJuaW9uKHEpIHsKCQkJICAgIHZhciB4ID0gdGhpcy54OwoJCQkgICAgdmFyIHkgPSB0aGlzLnk7CgkJCSAgICB2YXIgeiA9IHRoaXMuejsKCQkJICAgIHZhciBxeCA9IHEueDsKCQkJICAgIHZhciBxeSA9IHEueTsKCQkJICAgIHZhciBxeiA9IHEuejsKCQkJICAgIHZhciBxdyA9IHEudzsKCQkJICAgIHZhciBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKCQkJICAgIHZhciBpeSA9IHF3ICogeSArIHF6ICogeCAtIHF4ICogejsKCQkJICAgIHZhciBpeiA9IHF3ICogeiArIHF4ICogeSAtIHF5ICogeDsKCQkJICAgIHZhciBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CgkJCSAgICB0aGlzLnggPSBpeCAqIHF3ICsgaXcgKiAtcXggKyBpeSAqIC1xeiAtIGl6ICogLXF5OwoJCQkgICAgdGhpcy55ID0gaXkgKiBxdyArIGl3ICogLXF5ICsgaXogKiAtcXggLSBpeCAqIC1xejsKCQkJICAgIHRoaXMueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIGRvdDogZnVuY3Rpb24gZG90KHYpIHsKCQkJICAgIHJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2LnkgKyB0aGlzLnogKiB2Lno7CgkJCSAgfSwKCQkJICBjcm9zc1ZlY3RvcnM6IGZ1bmN0aW9uIGNyb3NzVmVjdG9ycyhhLCBiKSB7CgkJCSAgICB2YXIgYXggPSBhLngsCgkJCSAgICAgICAgYXkgPSBhLnksCgkJCSAgICAgICAgYXogPSBhLno7CgkJCSAgICB2YXIgYnggPSBiLngsCgkJCSAgICAgICAgYnkgPSBiLnksCgkJCSAgICAgICAgYnogPSBiLno7CgkJCSAgICB0aGlzLnggPSBheSAqIGJ6IC0gYXogKiBieTsKCQkJICAgIHRoaXMueSA9IGF6ICogYnggLSBheCAqIGJ6OwoJCQkgICAgdGhpcy56ID0gYXggKiBieSAtIGF5ICogYng7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9CgkJCX07CgkJCXZhciBRdWF0ZXJuaW9uID0gZnVuY3Rpb24gUXVhdGVybmlvbih4LCB5LCB6LCB3KSB7CgkJCSAgdGhpcy54ID0geCB8fCAwOwoJCQkgIHRoaXMueSA9IHkgfHwgMDsKCQkJICB0aGlzLnogPSB6IHx8IDA7CgkJCSAgdGhpcy53ID0gdyAhPT0gdW5kZWZpbmVkID8gdyA6IDE7CgkJCX07CgkJCVF1YXRlcm5pb24ucHJvdG90eXBlID0gewoJCQkgIGNvbnN0cnVjdG9yOiBRdWF0ZXJuaW9uLAoJCQkgIHNldDogZnVuY3Rpb24gc2V0KHgsIHksIHosIHcpIHsKCQkJICAgIHRoaXMueCA9IHg7CgkJCSAgICB0aGlzLnkgPSB5OwoJCQkgICAgdGhpcy56ID0gejsKCQkJICAgIHRoaXMudyA9IHc7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIGNvcHk6IGZ1bmN0aW9uIGNvcHkocXVhdGVybmlvbikgewoJCQkgICAgdGhpcy54ID0gcXVhdGVybmlvbi54OwoJCQkgICAgdGhpcy55ID0gcXVhdGVybmlvbi55OwoJCQkgICAgdGhpcy56ID0gcXVhdGVybmlvbi56OwoJCQkgICAgdGhpcy53ID0gcXVhdGVybmlvbi53OwoJCQkgICAgcmV0dXJuIHRoaXM7CgkJCSAgfSwKCQkJICBzZXRGcm9tRXVsZXJYWVo6IGZ1bmN0aW9uIHNldEZyb21FdWxlclhZWih4LCB5LCB6KSB7CgkJCSAgICB2YXIgYzEgPSBNYXRoLmNvcyh4IC8gMik7CgkJCSAgICB2YXIgYzIgPSBNYXRoLmNvcyh5IC8gMik7CgkJCSAgICB2YXIgYzMgPSBNYXRoLmNvcyh6IC8gMik7CgkJCSAgICB2YXIgczEgPSBNYXRoLnNpbih4IC8gMik7CgkJCSAgICB2YXIgczIgPSBNYXRoLnNpbih5IC8gMik7CgkJCSAgICB2YXIgczMgPSBNYXRoLnNpbih6IC8gMik7CgkJCSAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCSAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCSAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CgkJCSAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIHNldEZyb21FdWxlcllYWjogZnVuY3Rpb24gc2V0RnJvbUV1bGVyWVhaKHgsIHksIHopIHsKCQkJICAgIHZhciBjMSA9IE1hdGguY29zKHggLyAyKTsKCQkJICAgIHZhciBjMiA9IE1hdGguY29zKHkgLyAyKTsKCQkJICAgIHZhciBjMyA9IE1hdGguY29zKHogLyAyKTsKCQkJICAgIHZhciBzMSA9IE1hdGguc2luKHggLyAyKTsKCQkJICAgIHZhciBzMiA9IE1hdGguc2luKHkgLyAyKTsKCQkJICAgIHZhciBzMyA9IE1hdGguc2luKHogLyAyKTsKCQkJICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKCQkJICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCQkJICAgIHJldHVybiB0aGlzOwoJCQkgIH0sCgkJCSAgc2V0RnJvbUF4aXNBbmdsZTogZnVuY3Rpb24gc2V0RnJvbUF4aXNBbmdsZShheGlzLCBhbmdsZSkgewoJCQkgICAgdmFyIGhhbGZBbmdsZSA9IGFuZ2xlIC8gMiwKCQkJICAgICAgICBzID0gTWF0aC5zaW4oaGFsZkFuZ2xlKTsKCQkJICAgIHRoaXMueCA9IGF4aXMueCAqIHM7CgkJCSAgICB0aGlzLnkgPSBheGlzLnkgKiBzOwoJCQkgICAgdGhpcy56ID0gYXhpcy56ICogczsKCQkJICAgIHRoaXMudyA9IE1hdGguY29zKGhhbGZBbmdsZSk7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIG11bHRpcGx5OiBmdW5jdGlvbiBtdWx0aXBseShxKSB7CgkJCSAgICByZXR1cm4gdGhpcy5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMsIHEpOwoJCQkgIH0sCgkJCSAgbXVsdGlwbHlRdWF0ZXJuaW9uczogZnVuY3Rpb24gbXVsdGlwbHlRdWF0ZXJuaW9ucyhhLCBiKSB7CgkJCSAgICB2YXIgcWF4ID0gYS54LAoJCQkgICAgICAgIHFheSA9IGEueSwKCQkJICAgICAgICBxYXogPSBhLnosCgkJCSAgICAgICAgcWF3ID0gYS53OwoJCQkgICAgdmFyIHFieCA9IGIueCwKCQkJICAgICAgICBxYnkgPSBiLnksCgkJCSAgICAgICAgcWJ6ID0gYi56LAoJCQkgICAgICAgIHFidyA9IGIudzsKCQkJICAgIHRoaXMueCA9IHFheCAqIHFidyArIHFhdyAqIHFieCArIHFheSAqIHFieiAtIHFheiAqIHFieTsKCQkJICAgIHRoaXMueSA9IHFheSAqIHFidyArIHFhdyAqIHFieSArIHFheiAqIHFieCAtIHFheCAqIHFiejsKCQkJICAgIHRoaXMueiA9IHFheiAqIHFidyArIHFhdyAqIHFieiArIHFheCAqIHFieSAtIHFheSAqIHFieDsKCQkJICAgIHRoaXMudyA9IHFhdyAqIHFidyAtIHFheCAqIHFieCAtIHFheSAqIHFieSAtIHFheiAqIHFiejsKCQkJICAgIHJldHVybiB0aGlzOwoJCQkgIH0sCgkJCSAgaW52ZXJzZTogZnVuY3Rpb24gaW52ZXJzZSgpIHsKCQkJICAgIHRoaXMueCAqPSAtMTsKCQkJICAgIHRoaXMueSAqPSAtMTsKCQkJICAgIHRoaXMueiAqPSAtMTsKCQkJICAgIHRoaXMubm9ybWFsaXplKCk7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIG5vcm1hbGl6ZTogZnVuY3Rpb24gbm9ybWFsaXplKCkgewoJCQkgICAgdmFyIGwgPSBNYXRoLnNxcnQodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KTsKCQkJICAgIGlmIChsID09PSAwKSB7CgkJCSAgICAgIHRoaXMueCA9IDA7CgkJCSAgICAgIHRoaXMueSA9IDA7CgkJCSAgICAgIHRoaXMueiA9IDA7CgkJCSAgICAgIHRoaXMudyA9IDE7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICBsID0gMSAvIGw7CgkJCSAgICAgIHRoaXMueCA9IHRoaXMueCAqIGw7CgkJCSAgICAgIHRoaXMueSA9IHRoaXMueSAqIGw7CgkJCSAgICAgIHRoaXMueiA9IHRoaXMueiAqIGw7CgkJCSAgICAgIHRoaXMudyA9IHRoaXMudyAqIGw7CgkJCSAgICB9CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIHNsZXJwOiBmdW5jdGlvbiBzbGVycChxYiwgdCkgewoJCQkgICAgaWYgKHQgPT09IDApIHJldHVybiB0aGlzOwoJCQkgICAgaWYgKHQgPT09IDEpIHJldHVybiB0aGlzLmNvcHkocWIpOwoJCQkgICAgdmFyIHggPSB0aGlzLngsCgkJCSAgICAgICAgeSA9IHRoaXMueSwKCQkJICAgICAgICB6ID0gdGhpcy56LAoJCQkgICAgICAgIHcgPSB0aGlzLnc7CgkJCSAgICB2YXIgY29zSGFsZlRoZXRhID0gdyAqIHFiLncgKyB4ICogcWIueCArIHkgKiBxYi55ICsgeiAqIHFiLno7CgkJCSAgICBpZiAoY29zSGFsZlRoZXRhIDwgMCkgewoJCQkgICAgICB0aGlzLncgPSAtcWIudzsKCQkJICAgICAgdGhpcy54ID0gLXFiLng7CgkJCSAgICAgIHRoaXMueSA9IC1xYi55OwoJCQkgICAgICB0aGlzLnogPSAtcWIuejsKCQkJICAgICAgY29zSGFsZlRoZXRhID0gLWNvc0hhbGZUaGV0YTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMuY29weShxYik7CgkJCSAgICB9CgkJCSAgICBpZiAoY29zSGFsZlRoZXRhID49IDEuMCkgewoJCQkgICAgICB0aGlzLncgPSB3OwoJCQkgICAgICB0aGlzLnggPSB4OwoJCQkgICAgICB0aGlzLnkgPSB5OwoJCQkgICAgICB0aGlzLnogPSB6OwoJCQkgICAgICByZXR1cm4gdGhpczsKCQkJICAgIH0KCQkJICAgIHZhciBoYWxmVGhldGEgPSBNYXRoLmFjb3MoY29zSGFsZlRoZXRhKTsKCQkJICAgIHZhciBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoMS4wIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhKTsKCQkJICAgIGlmIChNYXRoLmFicyhzaW5IYWxmVGhldGEpIDwgMC4wMDEpIHsKCQkJICAgICAgdGhpcy53ID0gMC41ICogKHcgKyB0aGlzLncpOwoJCQkgICAgICB0aGlzLnggPSAwLjUgKiAoeCArIHRoaXMueCk7CgkJCSAgICAgIHRoaXMueSA9IDAuNSAqICh5ICsgdGhpcy55KTsKCQkJICAgICAgdGhpcy56ID0gMC41ICogKHogKyB0aGlzLnopOwoJCQkgICAgICByZXR1cm4gdGhpczsKCQkJICAgIH0KCQkJICAgIHZhciByYXRpb0EgPSBNYXRoLnNpbigoMSAtIHQpICogaGFsZlRoZXRhKSAvIHNpbkhhbGZUaGV0YSwKCQkJICAgICAgICByYXRpb0IgPSBNYXRoLnNpbih0ICogaGFsZlRoZXRhKSAvIHNpbkhhbGZUaGV0YTsKCQkJICAgIHRoaXMudyA9IHcgKiByYXRpb0EgKyB0aGlzLncgKiByYXRpb0I7CgkJCSAgICB0aGlzLnggPSB4ICogcmF0aW9BICsgdGhpcy54ICogcmF0aW9COwoJCQkgICAgdGhpcy55ID0geSAqIHJhdGlvQSArIHRoaXMueSAqIHJhdGlvQjsKCQkJICAgIHRoaXMueiA9IHogKiByYXRpb0EgKyB0aGlzLnogKiByYXRpb0I7CgkJCSAgICByZXR1cm4gdGhpczsKCQkJICB9LAoJCQkgIHNldEZyb21Vbml0VmVjdG9yczogZnVuY3Rpb24gKCkgewoJCQkgICAgdmFyIHYxLCByOwoJCQkgICAgdmFyIEVQUyA9IDAuMDAwMDAxOwoJCQkgICAgcmV0dXJuIGZ1bmN0aW9uICh2RnJvbSwgdlRvKSB7CgkJCSAgICAgIGlmICh2MSA9PT0gdW5kZWZpbmVkKSB2MSA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgICAgIHIgPSB2RnJvbS5kb3QodlRvKSArIDE7CgkJCSAgICAgIGlmIChyIDwgRVBTKSB7CgkJCSAgICAgICAgciA9IDA7CgkJCSAgICAgICAgaWYgKE1hdGguYWJzKHZGcm9tLngpID4gTWF0aC5hYnModkZyb20ueikpIHsKCQkJICAgICAgICAgIHYxLnNldCgtdkZyb20ueSwgdkZyb20ueCwgMCk7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIHYxLnNldCgwLCAtdkZyb20ueiwgdkZyb20ueSk7CgkJCSAgICAgICAgfQoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIHYxLmNyb3NzVmVjdG9ycyh2RnJvbSwgdlRvKTsKCQkJICAgICAgfQoJCQkgICAgICB0aGlzLnggPSB2MS54OwoJCQkgICAgICB0aGlzLnkgPSB2MS55OwoJCQkgICAgICB0aGlzLnogPSB2MS56OwoJCQkgICAgICB0aGlzLncgPSByOwoJCQkgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwoJCQkgICAgICByZXR1cm4gdGhpczsKCQkJICAgIH07CgkJCSAgfSgpCgkJCX07CgkJCWZ1bmN0aW9uIERldmljZShwYXJhbXMpIHsKCQkJICB0aGlzLndpZHRoID0gcGFyYW1zLndpZHRoIHx8IGdldFNjcmVlbldpZHRoKCk7CgkJCSAgdGhpcy5oZWlnaHQgPSBwYXJhbXMuaGVpZ2h0IHx8IGdldFNjcmVlbkhlaWdodCgpOwoJCQkgIHRoaXMud2lkdGhNZXRlcnMgPSBwYXJhbXMud2lkdGhNZXRlcnM7CgkJCSAgdGhpcy5oZWlnaHRNZXRlcnMgPSBwYXJhbXMuaGVpZ2h0TWV0ZXJzOwoJCQkgIHRoaXMuYmV2ZWxNZXRlcnMgPSBwYXJhbXMuYmV2ZWxNZXRlcnM7CgkJCX0KCQkJdmFyIERFRkFVTFRfQU5EUk9JRCA9IG5ldyBEZXZpY2UoewoJCQkgIHdpZHRoTWV0ZXJzOiAwLjExMCwKCQkJICBoZWlnaHRNZXRlcnM6IDAuMDYyLAoJCQkgIGJldmVsTWV0ZXJzOiAwLjAwNAoJCQl9KTsKCQkJdmFyIERFRkFVTFRfSU9TID0gbmV3IERldmljZSh7CgkJCSAgd2lkdGhNZXRlcnM6IDAuMTAzOCwKCQkJICBoZWlnaHRNZXRlcnM6IDAuMDU4NCwKCQkJICBiZXZlbE1ldGVyczogMC4wMDQKCQkJfSk7CgkJCXZhciBWaWV3ZXJzID0gewoJCQkgIENhcmRib2FyZFYxOiBuZXcgQ2FyZGJvYXJkVmlld2VyKHsKCQkJICAgIGlkOiAnQ2FyZGJvYXJkVjEnLAoJCQkgICAgbGFiZWw6ICdDYXJkYm9hcmQgSS9PIDIwMTQnLAoJCQkgICAgZm92OiA0MCwKCQkJICAgIGludGVyTGVuc0Rpc3RhbmNlOiAwLjA2MCwKCQkJICAgIGJhc2VsaW5lTGVuc0Rpc3RhbmNlOiAwLjAzNSwKCQkJICAgIHNjcmVlbkxlbnNEaXN0YW5jZTogMC4wNDIsCgkJCSAgICBkaXN0b3J0aW9uQ29lZmZpY2llbnRzOiBbMC40NDEsIDAuMTU2XSwKCQkJICAgIGludmVyc2VDb2VmZmljaWVudHM6IFstMC40NDEwMDM1LCAwLjQyNzU2MTU1LCAtMC40ODA0NDM5LCAwLjU0NjAxMzksIC0wLjU4ODIxMTgzLCAwLjU3MzM5MzgsIC0wLjQ4MzAzMjAyLCAwLjMzMjk5MDgzLCAtMC4xNzU3Mzg0MSwgMC4wNjUxNzcyLCAtMC4wMTQ4ODk2MywgMC4wMDE1NTk4MzRdCgkJCSAgfSksCgkJCSAgQ2FyZGJvYXJkVjI6IG5ldyBDYXJkYm9hcmRWaWV3ZXIoewoJCQkgICAgaWQ6ICdDYXJkYm9hcmRWMicsCgkJCSAgICBsYWJlbDogJ0NhcmRib2FyZCBJL08gMjAxNScsCgkJCSAgICBmb3Y6IDYwLAoJCQkgICAgaW50ZXJMZW5zRGlzdGFuY2U6IDAuMDY0LAoJCQkgICAgYmFzZWxpbmVMZW5zRGlzdGFuY2U6IDAuMDM1LAoJCQkgICAgc2NyZWVuTGVuc0Rpc3RhbmNlOiAwLjAzOSwKCQkJICAgIGRpc3RvcnRpb25Db2VmZmljaWVudHM6IFswLjM0LCAwLjU1XSwKCQkJICAgIGludmVyc2VDb2VmZmljaWVudHM6IFstMC4zMzgzNjcwNCwgLTAuMTgxNjIxODUsIDAuODYyNjU1LCAtMS4yNDYyMDUxLCAxLjA1NjA2MDIsIC0wLjU4MjA4MzE3LCAwLjIxNjA5MDc4LCAtMC4wNTQ0NDgyMywgMC4wMDkxNzc5NTYsIC05OTA0MTY5ZS0xMCwgNi4xODM1MzVFLTUsIC0xNjk4MTgwM2UtMTNdCgkJCSAgfSkKCQkJfTsKCQkJZnVuY3Rpb24gRGV2aWNlSW5mbyhkZXZpY2VQYXJhbXMsIGFkZGl0aW9uYWxWaWV3ZXJzKSB7CgkJCSAgdGhpcy52aWV3ZXIgPSBWaWV3ZXJzLkNhcmRib2FyZFYyOwoJCQkgIHRoaXMudXBkYXRlRGV2aWNlUGFyYW1zKGRldmljZVBhcmFtcyk7CgkJCSAgdGhpcy5kaXN0b3J0aW9uID0gbmV3IERpc3RvcnRpb24odGhpcy52aWV3ZXIuZGlzdG9ydGlvbkNvZWZmaWNpZW50cyk7CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBhZGRpdGlvbmFsVmlld2Vycy5sZW5ndGg7IGkrKykgewoJCQkgICAgdmFyIHZpZXdlciA9IGFkZGl0aW9uYWxWaWV3ZXJzW2ldOwoJCQkgICAgVmlld2Vyc1t2aWV3ZXIuaWRdID0gbmV3IENhcmRib2FyZFZpZXdlcih2aWV3ZXIpOwoJCQkgIH0KCQkJfQoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS51cGRhdGVEZXZpY2VQYXJhbXMgPSBmdW5jdGlvbiAoZGV2aWNlUGFyYW1zKSB7CgkJCSAgdGhpcy5kZXZpY2UgPSB0aGlzLmRldGVybWluZURldmljZV8oZGV2aWNlUGFyYW1zKSB8fCB0aGlzLmRldmljZTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RGV2aWNlID0gZnVuY3Rpb24gKCkgewoJCQkgIHJldHVybiB0aGlzLmRldmljZTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuc2V0Vmlld2VyID0gZnVuY3Rpb24gKHZpZXdlcikgewoJCQkgIHRoaXMudmlld2VyID0gdmlld2VyOwoJCQkgIHRoaXMuZGlzdG9ydGlvbiA9IG5ldyBEaXN0b3J0aW9uKHRoaXMudmlld2VyLmRpc3RvcnRpb25Db2VmZmljaWVudHMpOwoJCQl9OwoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS5kZXRlcm1pbmVEZXZpY2VfID0gZnVuY3Rpb24gKGRldmljZVBhcmFtcykgewoJCQkgIGlmICghZGV2aWNlUGFyYW1zKSB7CgkJCSAgICBpZiAoaXNJT1MoKSkgewoJCQkgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGZhbGxiYWNrIGlPUyBkZXZpY2UgbWVhc3VyZW1lbnRzLicpOwoJCQkgICAgICByZXR1cm4gREVGQVVMVF9JT1M7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICBjb25zb2xlLndhcm4oJ1VzaW5nIGZhbGxiYWNrIEFuZHJvaWQgZGV2aWNlIG1lYXN1cmVtZW50cy4nKTsKCQkJICAgICAgcmV0dXJuIERFRkFVTFRfQU5EUk9JRDsKCQkJICAgIH0KCQkJICB9CgkJCSAgdmFyIE1FVEVSU19QRVJfSU5DSCA9IDAuMDI1NDsKCQkJICB2YXIgbWV0ZXJzUGVyUGl4ZWxYID0gTUVURVJTX1BFUl9JTkNIIC8gZGV2aWNlUGFyYW1zLnhkcGk7CgkJCSAgdmFyIG1ldGVyc1BlclBpeGVsWSA9IE1FVEVSU19QRVJfSU5DSCAvIGRldmljZVBhcmFtcy55ZHBpOwoJCQkgIHZhciB3aWR0aCA9IGdldFNjcmVlbldpZHRoKCk7CgkJCSAgdmFyIGhlaWdodCA9IGdldFNjcmVlbkhlaWdodCgpOwoJCQkgIHJldHVybiBuZXcgRGV2aWNlKHsKCQkJICAgIHdpZHRoTWV0ZXJzOiBtZXRlcnNQZXJQaXhlbFggKiB3aWR0aCwKCQkJICAgIGhlaWdodE1ldGVyczogbWV0ZXJzUGVyUGl4ZWxZICogaGVpZ2h0LAoJCQkgICAgYmV2ZWxNZXRlcnM6IGRldmljZVBhcmFtcy5iZXZlbE1tICogMC4wMDEKCQkJICB9KTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RGlzdG9ydGVkRmllbGRPZlZpZXdMZWZ0RXllID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKCQkJICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CgkJCSAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CgkJCSAgdmFyIGV5ZVRvU2NyZWVuRGlzdGFuY2UgPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwoJCQkgIHZhciBvdXRlckRpc3QgPSAoZGV2aWNlLndpZHRoTWV0ZXJzIC0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlKSAvIDI7CgkJCSAgdmFyIGlubmVyRGlzdCA9IHZpZXdlci5pbnRlckxlbnNEaXN0YW5jZSAvIDI7CgkJCSAgdmFyIGJvdHRvbURpc3QgPSB2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnM7CgkJCSAgdmFyIHRvcERpc3QgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC0gYm90dG9tRGlzdDsKCQkJICB2YXIgb3V0ZXJBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydChvdXRlckRpc3QgLyBleWVUb1NjcmVlbkRpc3RhbmNlKSk7CgkJCSAgdmFyIGlubmVyQW5nbGUgPSByYWRUb0RlZyAqIE1hdGguYXRhbihkaXN0b3J0aW9uLmRpc3RvcnQoaW5uZXJEaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwoJCQkgIHZhciBib3R0b21BbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydChib3R0b21EaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwoJCQkgIHZhciB0b3BBbmdsZSA9IHJhZFRvRGVnICogTWF0aC5hdGFuKGRpc3RvcnRpb24uZGlzdG9ydCh0b3BEaXN0IC8gZXllVG9TY3JlZW5EaXN0YW5jZSkpOwoJCQkgIHJldHVybiB7CgkJCSAgICBsZWZ0RGVncmVlczogTWF0aC5taW4ob3V0ZXJBbmdsZSwgdmlld2VyLmZvdiksCgkJCSAgICByaWdodERlZ3JlZXM6IE1hdGgubWluKGlubmVyQW5nbGUsIHZpZXdlci5mb3YpLAoJCQkgICAgZG93bkRlZ3JlZXM6IE1hdGgubWluKGJvdHRvbUFuZ2xlLCB2aWV3ZXIuZm92KSwKCQkJICAgIHVwRGVncmVlczogTWF0aC5taW4odG9wQW5nbGUsIHZpZXdlci5mb3YpCgkJCSAgfTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0TGVmdEV5ZVZpc2libGVUYW5BbmdsZXMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwoJCQkgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKCQkJICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKCQkJICB2YXIgZm92TGVmdCA9IE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpOwoJCQkgIHZhciBmb3ZUb3AgPSBNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpOwoJCQkgIHZhciBmb3ZSaWdodCA9IE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdik7CgkJCSAgdmFyIGZvdkJvdHRvbSA9IE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpOwoJCQkgIHZhciBoYWxmV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyA0OwoJCQkgIHZhciBoYWxmSGVpZ2h0ID0gZGV2aWNlLmhlaWdodE1ldGVycyAvIDI7CgkJCSAgdmFyIHZlcnRpY2FsTGVuc09mZnNldCA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVycyAtIGhhbGZIZWlnaHQ7CgkJCSAgdmFyIGNlbnRlclggPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC0gaGFsZldpZHRoOwoJCQkgIHZhciBjZW50ZXJZID0gLXZlcnRpY2FsTGVuc09mZnNldDsKCQkJICB2YXIgY2VudGVyWiA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CgkJCSAgdmFyIHNjcmVlbkxlZnQgPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclggLSBoYWxmV2lkdGgpIC8gY2VudGVyWik7CgkJCSAgdmFyIHNjcmVlblRvcCA9IGRpc3RvcnRpb24uZGlzdG9ydCgoY2VudGVyWSArIGhhbGZIZWlnaHQpIC8gY2VudGVyWik7CgkJCSAgdmFyIHNjcmVlblJpZ2h0ID0gZGlzdG9ydGlvbi5kaXN0b3J0KChjZW50ZXJYICsgaGFsZldpZHRoKSAvIGNlbnRlclopOwoJCQkgIHZhciBzY3JlZW5Cb3R0b20gPSBkaXN0b3J0aW9uLmRpc3RvcnQoKGNlbnRlclkgLSBoYWxmSGVpZ2h0KSAvIGNlbnRlclopOwoJCQkgIHZhciByZXN1bHQgPSBuZXcgRmxvYXQzMkFycmF5KDQpOwoJCQkgIHJlc3VsdFswXSA9IE1hdGgubWF4KGZvdkxlZnQsIHNjcmVlbkxlZnQpOwoJCQkgIHJlc3VsdFsxXSA9IE1hdGgubWluKGZvdlRvcCwgc2NyZWVuVG9wKTsKCQkJICByZXN1bHRbMl0gPSBNYXRoLm1pbihmb3ZSaWdodCwgc2NyZWVuUmlnaHQpOwoJCQkgIHJlc3VsdFszXSA9IE1hdGgubWF4KGZvdkJvdHRvbSwgc2NyZWVuQm90dG9tKTsKCQkJICByZXR1cm4gcmVzdWx0OwoJCQl9OwoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRMZWZ0RXllTm9MZW5zVGFuQW5nbGVzID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciB2aWV3ZXIgPSB0aGlzLnZpZXdlcjsKCQkJICB2YXIgZGV2aWNlID0gdGhpcy5kZXZpY2U7CgkJCSAgdmFyIGRpc3RvcnRpb24gPSB0aGlzLmRpc3RvcnRpb247CgkJCSAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CgkJCSAgdmFyIGZvdkxlZnQgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKCQkJICB2YXIgZm92VG9wID0gZGlzdG9ydGlvbi5kaXN0b3J0SW52ZXJzZShNYXRoLnRhbihkZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKCQkJICB2YXIgZm92UmlnaHQgPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKGRlZ1RvUmFkICogdmlld2VyLmZvdikpOwoJCQkgIHZhciBmb3ZCb3R0b20gPSBkaXN0b3J0aW9uLmRpc3RvcnRJbnZlcnNlKE1hdGgudGFuKC1kZWdUb1JhZCAqIHZpZXdlci5mb3YpKTsKCQkJICB2YXIgaGFsZldpZHRoID0gZGV2aWNlLndpZHRoTWV0ZXJzIC8gNDsKCQkJICB2YXIgaGFsZkhlaWdodCA9IGRldmljZS5oZWlnaHRNZXRlcnMgLyAyOwoJCQkgIHZhciB2ZXJ0aWNhbExlbnNPZmZzZXQgPSB2aWV3ZXIuYmFzZWxpbmVMZW5zRGlzdGFuY2UgLSBkZXZpY2UuYmV2ZWxNZXRlcnMgLSBoYWxmSGVpZ2h0OwoJCQkgIHZhciBjZW50ZXJYID0gdmlld2VyLmludGVyTGVuc0Rpc3RhbmNlIC8gMiAtIGhhbGZXaWR0aDsKCQkJICB2YXIgY2VudGVyWSA9IC12ZXJ0aWNhbExlbnNPZmZzZXQ7CgkJCSAgdmFyIGNlbnRlclogPSB2aWV3ZXIuc2NyZWVuTGVuc0Rpc3RhbmNlOwoJCQkgIHZhciBzY3JlZW5MZWZ0ID0gKGNlbnRlclggLSBoYWxmV2lkdGgpIC8gY2VudGVyWjsKCQkJICB2YXIgc2NyZWVuVG9wID0gKGNlbnRlclkgKyBoYWxmSGVpZ2h0KSAvIGNlbnRlclo7CgkJCSAgdmFyIHNjcmVlblJpZ2h0ID0gKGNlbnRlclggKyBoYWxmV2lkdGgpIC8gY2VudGVyWjsKCQkJICB2YXIgc2NyZWVuQm90dG9tID0gKGNlbnRlclkgLSBoYWxmSGVpZ2h0KSAvIGNlbnRlclo7CgkJCSAgcmVzdWx0WzBdID0gTWF0aC5tYXgoZm92TGVmdCwgc2NyZWVuTGVmdCk7CgkJCSAgcmVzdWx0WzFdID0gTWF0aC5taW4oZm92VG9wLCBzY3JlZW5Ub3ApOwoJCQkgIHJlc3VsdFsyXSA9IE1hdGgubWluKGZvdlJpZ2h0LCBzY3JlZW5SaWdodCk7CgkJCSAgcmVzdWx0WzNdID0gTWF0aC5tYXgoZm92Qm90dG9tLCBzY3JlZW5Cb3R0b20pOwoJCQkgIHJldHVybiByZXN1bHQ7CgkJCX07CgkJCURldmljZUluZm8ucHJvdG90eXBlLmdldExlZnRFeWVWaXNpYmxlU2NyZWVuUmVjdCA9IGZ1bmN0aW9uICh1bmRpc3RvcnRlZEZydXN0dW0pIHsKCQkJICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CgkJCSAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwoJCQkgIHZhciBkaXN0ID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKCQkJICB2YXIgZXllWCA9IChkZXZpY2Uud2lkdGhNZXRlcnMgLSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UpIC8gMjsKCQkJICB2YXIgZXllWSA9IHZpZXdlci5iYXNlbGluZUxlbnNEaXN0YW5jZSAtIGRldmljZS5iZXZlbE1ldGVyczsKCQkJICB2YXIgbGVmdCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMF0gKiBkaXN0ICsgZXllWCkgLyBkZXZpY2Uud2lkdGhNZXRlcnM7CgkJCSAgdmFyIHRvcCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMV0gKiBkaXN0ICsgZXllWSkgLyBkZXZpY2UuaGVpZ2h0TWV0ZXJzOwoJCQkgIHZhciByaWdodCA9ICh1bmRpc3RvcnRlZEZydXN0dW1bMl0gKiBkaXN0ICsgZXllWCkgLyBkZXZpY2Uud2lkdGhNZXRlcnM7CgkJCSAgdmFyIGJvdHRvbSA9ICh1bmRpc3RvcnRlZEZydXN0dW1bM10gKiBkaXN0ICsgZXllWSkgLyBkZXZpY2UuaGVpZ2h0TWV0ZXJzOwoJCQkgIHJldHVybiB7CgkJCSAgICB4OiBsZWZ0LAoJCQkgICAgeTogYm90dG9tLAoJCQkgICAgd2lkdGg6IHJpZ2h0IC0gbGVmdCwKCQkJICAgIGhlaWdodDogdG9wIC0gYm90dG9tCgkJCSAgfTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RmllbGRPZlZpZXdMZWZ0RXllID0gZnVuY3Rpb24gKG9wdF9pc1VuZGlzdG9ydGVkKSB7CgkJCSAgcmV0dXJuIG9wdF9pc1VuZGlzdG9ydGVkID8gdGhpcy5nZXRVbmRpc3RvcnRlZEZpZWxkT2ZWaWV3TGVmdEV5ZSgpIDogdGhpcy5nZXREaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUoKTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0RmllbGRPZlZpZXdSaWdodEV5ZSA9IGZ1bmN0aW9uIChvcHRfaXNVbmRpc3RvcnRlZCkgewoJCQkgIHZhciBmb3YgPSB0aGlzLmdldEZpZWxkT2ZWaWV3TGVmdEV5ZShvcHRfaXNVbmRpc3RvcnRlZCk7CgkJCSAgcmV0dXJuIHsKCQkJICAgIGxlZnREZWdyZWVzOiBmb3YucmlnaHREZWdyZWVzLAoJCQkgICAgcmlnaHREZWdyZWVzOiBmb3YubGVmdERlZ3JlZXMsCgkJCSAgICB1cERlZ3JlZXM6IGZvdi51cERlZ3JlZXMsCgkJCSAgICBkb3duRGVncmVlczogZm92LmRvd25EZWdyZWVzCgkJCSAgfTsKCQkJfTsKCQkJRGV2aWNlSW5mby5wcm90b3R5cGUuZ2V0VW5kaXN0b3J0ZWRGaWVsZE9mVmlld0xlZnRFeWUgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHAgPSB0aGlzLmdldFVuZGlzdG9ydGVkUGFyYW1zXygpOwoJCQkgIHJldHVybiB7CgkJCSAgICBsZWZ0RGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC5vdXRlckRpc3QpLAoJCQkgICAgcmlnaHREZWdyZWVzOiByYWRUb0RlZyAqIE1hdGguYXRhbihwLmlubmVyRGlzdCksCgkJCSAgICBkb3duRGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC5ib3R0b21EaXN0KSwKCQkJICAgIHVwRGVncmVlczogcmFkVG9EZWcgKiBNYXRoLmF0YW4ocC50b3BEaXN0KQoJCQkgIH07CgkJCX07CgkJCURldmljZUluZm8ucHJvdG90eXBlLmdldFVuZGlzdG9ydGVkVmlld3BvcnRMZWZ0RXllID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBwID0gdGhpcy5nZXRVbmRpc3RvcnRlZFBhcmFtc18oKTsKCQkJICB2YXIgdmlld2VyID0gdGhpcy52aWV3ZXI7CgkJCSAgdmFyIGRldmljZSA9IHRoaXMuZGV2aWNlOwoJCQkgIHZhciBleWVUb1NjcmVlbkRpc3RhbmNlID0gdmlld2VyLnNjcmVlbkxlbnNEaXN0YW5jZTsKCQkJICB2YXIgc2NyZWVuV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwoJCQkgIHZhciBzY3JlZW5IZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKCQkJICB2YXIgeFB4UGVyVGFuQW5nbGUgPSBkZXZpY2Uud2lkdGggLyBzY3JlZW5XaWR0aDsKCQkJICB2YXIgeVB4UGVyVGFuQW5nbGUgPSBkZXZpY2UuaGVpZ2h0IC8gc2NyZWVuSGVpZ2h0OwoJCQkgIHZhciB4ID0gTWF0aC5yb3VuZCgocC5leWVQb3NYIC0gcC5vdXRlckRpc3QpICogeFB4UGVyVGFuQW5nbGUpOwoJCQkgIHZhciB5ID0gTWF0aC5yb3VuZCgocC5leWVQb3NZIC0gcC5ib3R0b21EaXN0KSAqIHlQeFBlclRhbkFuZ2xlKTsKCQkJICByZXR1cm4gewoJCQkgICAgeDogeCwKCQkJICAgIHk6IHksCgkJCSAgICB3aWR0aDogTWF0aC5yb3VuZCgocC5leWVQb3NYICsgcC5pbm5lckRpc3QpICogeFB4UGVyVGFuQW5nbGUpIC0geCwKCQkJICAgIGhlaWdodDogTWF0aC5yb3VuZCgocC5leWVQb3NZICsgcC50b3BEaXN0KSAqIHlQeFBlclRhbkFuZ2xlKSAtIHkKCQkJICB9OwoJCQl9OwoJCQlEZXZpY2VJbmZvLnByb3RvdHlwZS5nZXRVbmRpc3RvcnRlZFBhcmFtc18gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHZpZXdlciA9IHRoaXMudmlld2VyOwoJCQkgIHZhciBkZXZpY2UgPSB0aGlzLmRldmljZTsKCQkJICB2YXIgZGlzdG9ydGlvbiA9IHRoaXMuZGlzdG9ydGlvbjsKCQkJICB2YXIgZXllVG9TY3JlZW5EaXN0YW5jZSA9IHZpZXdlci5zY3JlZW5MZW5zRGlzdGFuY2U7CgkJCSAgdmFyIGhhbGZMZW5zRGlzdGFuY2UgPSB2aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgLyAyIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKCQkJICB2YXIgc2NyZWVuV2lkdGggPSBkZXZpY2Uud2lkdGhNZXRlcnMgLyBleWVUb1NjcmVlbkRpc3RhbmNlOwoJCQkgIHZhciBzY3JlZW5IZWlnaHQgPSBkZXZpY2UuaGVpZ2h0TWV0ZXJzIC8gZXllVG9TY3JlZW5EaXN0YW5jZTsKCQkJICB2YXIgZXllUG9zWCA9IHNjcmVlbldpZHRoIC8gMiAtIGhhbGZMZW5zRGlzdGFuY2U7CgkJCSAgdmFyIGV5ZVBvc1kgPSAodmlld2VyLmJhc2VsaW5lTGVuc0Rpc3RhbmNlIC0gZGV2aWNlLmJldmVsTWV0ZXJzKSAvIGV5ZVRvU2NyZWVuRGlzdGFuY2U7CgkJCSAgdmFyIG1heEZvdiA9IHZpZXdlci5mb3Y7CgkJCSAgdmFyIHZpZXdlck1heCA9IGRpc3RvcnRpb24uZGlzdG9ydEludmVyc2UoTWF0aC50YW4oZGVnVG9SYWQgKiBtYXhGb3YpKTsKCQkJICB2YXIgb3V0ZXJEaXN0ID0gTWF0aC5taW4oZXllUG9zWCwgdmlld2VyTWF4KTsKCQkJICB2YXIgaW5uZXJEaXN0ID0gTWF0aC5taW4oaGFsZkxlbnNEaXN0YW5jZSwgdmlld2VyTWF4KTsKCQkJICB2YXIgYm90dG9tRGlzdCA9IE1hdGgubWluKGV5ZVBvc1ksIHZpZXdlck1heCk7CgkJCSAgdmFyIHRvcERpc3QgPSBNYXRoLm1pbihzY3JlZW5IZWlnaHQgLSBleWVQb3NZLCB2aWV3ZXJNYXgpOwoJCQkgIHJldHVybiB7CgkJCSAgICBvdXRlckRpc3Q6IG91dGVyRGlzdCwKCQkJICAgIGlubmVyRGlzdDogaW5uZXJEaXN0LAoJCQkgICAgdG9wRGlzdDogdG9wRGlzdCwKCQkJICAgIGJvdHRvbURpc3Q6IGJvdHRvbURpc3QsCgkJCSAgICBleWVQb3NYOiBleWVQb3NYLAoJCQkgICAgZXllUG9zWTogZXllUG9zWQoJCQkgIH07CgkJCX07CgkJCWZ1bmN0aW9uIENhcmRib2FyZFZpZXdlcihwYXJhbXMpIHsKCQkJICB0aGlzLmlkID0gcGFyYW1zLmlkOwoJCQkgIHRoaXMubGFiZWwgPSBwYXJhbXMubGFiZWw7CgkJCSAgdGhpcy5mb3YgPSBwYXJhbXMuZm92OwoJCQkgIHRoaXMuaW50ZXJMZW5zRGlzdGFuY2UgPSBwYXJhbXMuaW50ZXJMZW5zRGlzdGFuY2U7CgkJCSAgdGhpcy5iYXNlbGluZUxlbnNEaXN0YW5jZSA9IHBhcmFtcy5iYXNlbGluZUxlbnNEaXN0YW5jZTsKCQkJICB0aGlzLnNjcmVlbkxlbnNEaXN0YW5jZSA9IHBhcmFtcy5zY3JlZW5MZW5zRGlzdGFuY2U7CgkJCSAgdGhpcy5kaXN0b3J0aW9uQ29lZmZpY2llbnRzID0gcGFyYW1zLmRpc3RvcnRpb25Db2VmZmljaWVudHM7CgkJCSAgdGhpcy5pbnZlcnNlQ29lZmZpY2llbnRzID0gcGFyYW1zLmludmVyc2VDb2VmZmljaWVudHM7CgkJCX0KCQkJRGV2aWNlSW5mby5WaWV3ZXJzID0gVmlld2VyczsKCQkJdmFyIGZvcm1hdCA9IDE7CgkJCXZhciBsYXN0X3VwZGF0ZWQgPSAiMjAxOS0xMS0wOVQxNzozNjoxNFoiOwoJCQl2YXIgZGV2aWNlcyA9IFt7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJhc3VzLyovTmV4dXMgNy8qIn0seyJ1YSI6Ik5leHVzIDcifV0sImRwaSI6WzMyMC44LDMyM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJhc3VzLyovQVNVU19YMDBQRC8qIn0seyJ1YSI6IkFTVVNfWDAwUEQifV0sImRwaSI6MjQ1LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiYXN1cy8qL0FTVVNfWDAwOEQvKiJ9LHsidWEiOiJBU1VTX1gwMDhEIn1dLCJkcGkiOjI4MiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6ImFzdXMvKi9BU1VTX1owMEFELyoifSx7InVhIjoiQVNVU19aMDBBRCJ9XSwiZHBpIjpbNDAzLDQwNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAyIFhMLyoifSx7InVhIjoiUGl4ZWwgMiBYTCJ9XSwiZHBpIjo1MzcuOSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJHb29nbGUvKi9QaXhlbCAzIFhMLyoifSx7InVhIjoiUGl4ZWwgMyBYTCJ9XSwiZHBpIjpbNTU4LjUsNTUzLjhdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikdvb2dsZS8qL1BpeGVsIFhMLyoifSx7InVhIjoiUGl4ZWwgWEwifV0sImRwaSI6WzUzNy45LDUzM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMy8qIn0seyJ1YSI6IlBpeGVsIDMifV0sImRwaSI6NDQyLjQsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwgMi8qIn0seyJ1YSI6IlBpeGVsIDIifV0sImRwaSI6NDQxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiR29vZ2xlLyovUGl4ZWwvKiJ9LHsidWEiOiJQaXhlbCJ9XSwiZHBpIjpbNDMyLjYsNDM2LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQzY0MzVMVlcvKiJ9LHsidWEiOiJIVEM2NDM1TFZXIn1dLCJkcGkiOls0NDkuNyw0NDMuM10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZSBYTC8qIn0seyJ1YSI6IkhUQyBPbmUgWEwifV0sImRwaSI6WzMxNS4zLDMxNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJodGMvKi9OZXh1cyA5LyoifSx7InVhIjoiTmV4dXMgOSJ9XSwiZHBpIjoyODksImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIVEMvKi9IVEMgT25lIE05LyoifSx7InVhIjoiSFRDIE9uZSBNOSJ9XSwiZHBpIjpbNDQyLjUsNDQzLjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSFRDLyovSFRDIE9uZV9NOC8qIn0seyJ1YSI6IkhUQyBPbmVfTTgifV0sImRwaSI6WzQ0OS43LDQ0Ny40XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkhUQy8qL0hUQyBPbmUvKiJ9LHsidWEiOiJIVEMgT25lIn1dLCJkcGkiOjQ3Mi44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ikh1YXdlaS8qL05leHVzIDZQLyoifSx7InVhIjoiTmV4dXMgNlAifV0sImRwaSI6WzUxNS4xLDUxOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiSHVhd2VpLyovQkxOLUwyNC8qIn0seyJ1YSI6IkhPTk9SQkxOLUwyNCJ9XSwiZHBpIjo0ODAsImJ3Ijo0LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9CS0wtTDA5LyoifSx7InVhIjoiQktMLUwwOSJ9XSwiZHBpIjo0MDMsImJ3IjozLjQ3LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMRU5PVk8vKi9MZW5vdm8gUEIyLTY5MFkvKiJ9LHsidWEiOiJMZW5vdm8gUEIyLTY5MFkifV0sImRwaSI6WzQ1Ny4yLDQ1NC43MTNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTmV4dXMgNVgvKiJ9LHsidWEiOiJOZXh1cyA1WCJ9XSwiZHBpIjpbNDIyLDQxOS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR01TMzQ1LyoifSx7InVhIjoiTEdNUzM0NSJ9XSwiZHBpIjpbMjIxLjcsMjE5LjFdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEctRDgwMC8qIn0seyJ1YSI6IkxHLUQ4MDAifV0sImRwaSI6WzQyMiw0MjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MRy1EODUwLyoifSx7InVhIjoiTEctRDg1MCJ9XSwiZHBpIjpbNTM3LjksNTQxLjldLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovVlM5ODUgNEcvKiJ9LHsidWEiOiJWUzk4NSA0RyJ9XSwiZHBpIjpbNTM3LjksNTM1LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL05leHVzIDUvKiJ9LHsidWEiOiJOZXh1cyA1IEIifV0sImRwaSI6WzQ0Mi40LDQ0NC44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9OZXh1cyA0LyoifSx7InVhIjoiTmV4dXMgNCJ9XSwiZHBpIjpbMzE5LjgsMzE4LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkxHRS8qL0xHLVA3NjkvKiJ9LHsidWEiOiJMRy1QNzY5In1dLCJkcGkiOlsyNDAuNiwyNDcuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTEdFLyovTEdNUzMyMy8qIn0seyJ1YSI6IkxHTVMzMjMifV0sImRwaSI6WzIwNi42LDIwNC42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJMR0UvKi9MR0xTOTk2LyoifSx7InVhIjoiTEdMUzk5NiJ9XSwiZHBpIjpbNDAzLjQsNDAxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik1pY3JvbWF4LyovNDU2ME1NWC8qIn0seyJ1YSI6IjQ1NjBNTVgifV0sImRwaSI6WzI0MCwyMTkuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiTWljcm9tYXgvKi9BMjUwLyoifSx7InVhIjoiTWljcm9tYXggQTI1MCJ9XSwiZHBpIjpbNDgwLDQ0Ni40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJNaWNyb21heC8qL01pY3JvbWF4IEFRNDUwMS8qIn0seyJ1YSI6Ik1pY3JvbWF4IEFRNDUwMSJ9XSwiZHBpIjoyNDAsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0c1LyoifSx7InVhIjoiTW90byBHICg1KSBQbHVzIn1dLCJkcGkiOls0MDMuNCw0MDNdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovRFJPSUQgUkFaUi8qIn0seyJ1YSI6IkRST0lEIFJBWlIifV0sImRwaSI6WzM2OC4xLDI1Ni43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUODMwQy8qIn0seyJ1YSI6IlhUODMwQyJ9XSwiZHBpIjpbMjU0LDI1NS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAyMS8qIn0seyJ1YSI6IlhUMTAyMSJ9XSwiZHBpIjpbMjU0LDI1Ni43XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDIzLyoifSx7InVhIjoiWFQxMDIzIn1dLCJkcGkiOlsyNTQsMjU2LjddLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwMjgvKiJ9LHsidWEiOiJYVDEwMjgifV0sImRwaSI6WzMyNi42LDMyNy42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTAzNC8qIn0seyJ1YSI6IlhUMTAzNCJ9XSwiZHBpIjpbMzI2LjYsMzI4LjRdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwNTMvKiJ9LHsidWEiOiJYVDEwNTMifV0sImRwaSI6WzMxNS4zLDMxNi4xXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTU2Mi8qIn0seyJ1YSI6IlhUMTU2MiJ9XSwiZHBpIjpbNDAzLjQsNDAyLjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovTmV4dXMgNi8qIn0seyJ1YSI6Ik5leHVzIDYgQiJ9XSwiZHBpIjpbNDk0LjMsNDg5LjddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDYzLyoifSx7InVhIjoiWFQxMDYzIn1dLCJkcGkiOlsyOTUsMjk2LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Im1vdG9yb2xhLyovWFQxMDY0LyoifSx7InVhIjoiWFQxMDY0In1dLCJkcGkiOlsyOTUsMjk1LjZdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoibW90b3JvbGEvKi9YVDEwOTIvKiJ9LHsidWEiOiJYVDEwOTIifV0sImRwaSI6WzQyMiw0MjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL1hUMTA5NS8qIn0seyJ1YSI6IlhUMTA5NSJ9XSwiZHBpIjpbNDIyLDQyMy40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJtb3Rvcm9sYS8qL0c0LyoifSx7InVhIjoiTW90byBHICg0KSJ9XSwiZHBpIjo0MDEsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL0EwMDAxLyoifSx7InVhIjoiQTAwMDEifV0sImRwaSI6WzQwMy40LDQwMV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBFMTAwMS8qIn0seyJ1YSI6Ik9ORSBFMTAwMSJ9XSwiZHBpIjpbNDQyLjQsNDQxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgRTEwMDMvKiJ9LHsidWEiOiJPTkUgRTEwMDMifV0sImRwaSI6WzQ0Mi40LDQ0MS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEUxMDA1LyoifSx7InVhIjoiT05FIEUxMDA1In1dLCJkcGkiOls0NDIuNCw0NDEuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORSBBMjAwMS8qIn0seyJ1YSI6Ik9ORSBBMjAwMSJ9XSwiZHBpIjpbMzkxLjksNDA1LjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkUgQTIwMDMvKiJ9LHsidWEiOiJPTkUgQTIwMDMifV0sImRwaSI6WzM5MS45LDQwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEEyMDA1LyoifSx7InVhIjoiT05FIEEyMDA1In1dLCJkcGkiOlszOTEuOSw0MDUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTMwMDAvKiJ9LHsidWEiOiJPTkVQTFVTIEEzMDAwIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEEzMDAzLyoifSx7InVhIjoiT05FUExVUyBBMzAwMyJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBMzAxMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTMwMTAifV0sImRwaSI6NDAxLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTUwMDAvKiJ9LHsidWEiOiJPTkVQTFVTIEE1MDAwICJ9XSwiZHBpIjpbNDAzLjQxMSwzOTkuNzM3XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FIEE1MDEwLyoifSx7InVhIjoiT05FUExVUyBBNTAxMCJ9XSwiZHBpIjpbNDAzLDQwMF0sImJ3IjoyLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTYwMDAvKiJ9LHsidWEiOiJPTkVQTFVTIEE2MDAwIn1dLCJkcGkiOjQwMSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9uZVBsdXMvKi9PTkVQTFVTIEE2MDAzLyoifSx7InVhIjoiT05FUExVUyBBNjAwMyJ9XSwiZHBpIjo0MDEsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJPbmVQbHVzLyovT05FUExVUyBBNjAxMC8qIn0seyJ1YSI6Ik9ORVBMVVMgQTYwMTAifV0sImRwaSI6NDAxLCJidyI6MiwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiT25lUGx1cy8qL09ORVBMVVMgQTYwMTMvKiJ9LHsidWEiOiJPTkVQTFVTIEE2MDEzIn1dLCJkcGkiOjQwMSwiYnciOjIsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6Ik9QUE8vKi9YOTA5LyoifSx7InVhIjoiWDkwOSJ9XSwiZHBpIjpbNDQyLjQsNDQ0LjFdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9HVC1JOTA4Mi8qIn0seyJ1YSI6IkdULUk5MDgyIn1dLCJkcGkiOlsxODQuNywxODUuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUczNjBQLyoifSx7InVhIjoiU00tRzM2MFAifV0sImRwaSI6WzE5Ni43LDIwNS40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovTmV4dXMgUy8qIn0seyJ1YSI6Ik5leHVzIFMifV0sImRwaSI6WzIzNC41LDIyOS44XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkzMDAvKiJ9LHsidWEiOiJHVC1JOTMwMCJ9XSwiZHBpIjpbMzA0LjgsMzAzLjldLCJidyI6NSwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLVQyMzBOVS8qIn0seyJ1YSI6IlNNLVQyMzBOVSJ9XSwiZHBpIjoyMTYsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0dILVQzOTkvKiJ9LHsidWEiOiJTR0gtVDM5OSJ9XSwiZHBpIjpbMjE3LjcsMjMxLjRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TR0gtTTkxOS8qIn0seyJ1YSI6IlNHSC1NOTE5In1dLCJkcGkiOls0NDAuOCw0MzcuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MDA1LyoifSx7InVhIjoiU00tTjkwMDUifV0sImRwaSI6WzM4Ni40LDM4N10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU0FNU1VORy1TTS1OOTAwQS8qIn0seyJ1YSI6IlNBTVNVTkctU00tTjkwMEEifV0sImRwaSI6WzM4Ni40LDM4Ny43XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTk1MDAvKiJ9LHsidWEiOiJHVC1JOTUwMCJ9XSwiZHBpIjpbNDQyLjUsNDQzLjNdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5NTA1LyoifSx7InVhIjoiR1QtSTk1MDUifV0sImRwaSI6NDM5LjQsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MDBGLyoifSx7InVhIjoiU00tRzkwMEYifV0sImRwaSI6WzQxNS42LDQzMS42XSwiYnciOjUsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkwME0vKiJ9LHsidWEiOiJTTS1HOTAwTSJ9XSwiZHBpIjpbNDE1LjYsNDMxLjZdLCJidyI6NSwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HODAwRi8qIn0seyJ1YSI6IlNNLUc4MDBGIn1dLCJkcGkiOjMyNi44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTA2Uy8qIn0seyJ1YSI6IlNNLUc5MDZTIn1dLCJkcGkiOls1NjIuNyw1NzIuNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MzAwLyoifSx7InVhIjoiR1QtSTkzMDAifV0sImRwaSI6WzMwNi43LDMwNC44XSwiYnciOjUsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tVDUzNS8qIn0seyJ1YSI6IlNNLVQ1MzUifV0sImRwaSI6WzE0Mi42LDEzNi40XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTIwQy8qIn0seyJ1YSI6IlNNLU45MjBDIn1dLCJkcGkiOls1MTUuMSw1MTguNF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLU45MjBQLyoifSx7InVhIjoiU00tTjkyMFAifV0sImRwaSI6WzM4Ni4zNjU1LDM5MC4xNDRdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTIwVzgvKiJ9LHsidWEiOiJTTS1OOTIwVzgifV0sImRwaSI6WzUxNS4xLDUxOC40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovR1QtSTkzMDBJLyoifSx7InVhIjoiR1QtSTkzMDBJIn1dLCJkcGkiOlszMDQuOCwzMDUuOF0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULUk5MTk1LyoifSx7InVhIjoiR1QtSTkxOTUifV0sImRwaSI6WzI0OS40LDI1Ni43XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TUEgtTDUyMC8qIn0seyJ1YSI6IlNQSC1MNTIwIn1dLCJkcGkiOlsyNDkuNCwyNTUuOV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NBTVNVTkctU0dILUk3MTcvKiJ9LHsidWEiOiJTQU1TVU5HLVNHSC1JNzE3In1dLCJkcGkiOjI4NS44LCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TUEgtRDcxMC8qIn0seyJ1YSI6IlNQSC1ENzEwIn1dLCJkcGkiOlsyMTcuNywyMDQuMl0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dULU43MTAwLyoifSx7InVhIjoiR1QtTjcxMDAifV0sImRwaSI6MjY1LjEsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NDSC1JNjA1LyoifSx7InVhIjoiU0NILUk2MDUifV0sImRwaSI6MjY1LjEsImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL0dhbGF4eSBOZXh1cy8qIn0seyJ1YSI6IkdhbGF4eSBOZXh1cyJ9XSwiZHBpIjpbMzE1LjMsMzE0LjJdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTEwSC8qIn0seyJ1YSI6IlNNLU45MTBIIn1dLCJkcGkiOls1MTUuMSw1MThdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1OOTEwQy8qIn0seyJ1YSI6IlNNLU45MTBDIn1dLCJkcGkiOls1MTUuMiw1MjAuMl0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzEzME0vKiJ9LHsidWEiOiJTTS1HMTMwTSJ9XSwiZHBpIjpbMTY1LjksMTY0LjhdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjhJLyoifSx7InVhIjoiU00tRzkyOEkifV0sImRwaSI6WzUxNS4xLDUxOC40XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkyMEYvKiJ9LHsidWEiOiJTTS1HOTIwRiJ9XSwiZHBpIjo1ODAuNiwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTIwUC8qIn0seyJ1YSI6IlNNLUc5MjBQIn1dLCJkcGkiOls1MjIuNSw1NzddLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTI1Ri8qIn0seyJ1YSI6IlNNLUc5MjVGIn1dLCJkcGkiOjU4MC42LCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5MjVWLyoifSx7InVhIjoiU00tRzkyNVYifV0sImRwaSI6WzUyMi41LDU3Ni42XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkzMEYvKiJ9LHsidWEiOiJTTS1HOTMwRiJ9XSwiZHBpIjo1NzYuNiwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzkzNUYvKiJ9LHsidWEiOiJTTS1HOTM1RiJ9XSwiZHBpIjo1MzMsImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk1MEYvKiJ9LHsidWEiOiJTTS1HOTUwRiJ9XSwiZHBpIjpbNTYyLjcwNyw1NjUuMjkzXSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTU1VS8qIn0seyJ1YSI6IlNNLUc5NTVVIn1dLCJkcGkiOls1MjIuNTE0LDUyNS43NjJdLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NTVGLyoifSx7InVhIjoiU00tRzk1NUYifV0sImRwaSI6WzUyMi41MTQsNTI1Ljc2Ml0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MEYvKiJ9LHsidWEiOiJTTS1HOTYwRiJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjAwLyoifSx7InVhIjoiU00tRzk2MDAifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwVC8qIn0seyJ1YSI6IlNNLUc5NjBUIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2ME4vKiJ9LHsidWEiOiJTTS1HOTYwTiJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjBVLyoifSx7InVhIjoiU00tRzk2MFUifV0sImRwaSI6WzU2OS41NzUsNTcxLjVdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTYwOC8qIn0seyJ1YSI6IlNNLUc5NjA4In1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MEZELyoifSx7InVhIjoiU00tRzk2MEZEIn1dLCJkcGkiOls1NjkuNTc1LDU3MS41XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk2MFcvKiJ9LHsidWEiOiJTTS1HOTYwVyJ9XSwiZHBpIjpbNTY5LjU3NSw1NzEuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NjVGLyoifSx7InVhIjoiU00tRzk2NUYifV0sImRwaSI6NTI5LCJidyI6MiwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9DNjkwMy8qIn0seyJ1YSI6IkM2OTAzIn1dLCJkcGkiOls0NDIuNSw0NDMuM10sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovRDY2NTMvKiJ9LHsidWEiOiJENjY1MyJ9XSwiZHBpIjpbNDI4LjYsNDI3LjZdLCJidyI6MywiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IlNvbnkvKi9FNjY1My8qIn0seyJ1YSI6IkU2NjUzIn1dLCJkcGkiOls0MjguNiw0MjUuN10sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiU29ueS8qL0U2ODUzLyoifSx7InVhIjoiRTY4NTMifV0sImRwaSI6WzQwMy40LDQwMS45XSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJTb255LyovU0dQMzIxLyoifSx7InVhIjoiU0dQMzIxIn1dLCJkcGkiOlsyMjQuNywyMjQuMV0sImJ3IjozLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJUQ1QvKi9BTENBVEVMIE9ORSBUT1VDSCBGaWVyY2UvKiJ9LHsidWEiOiJBTENBVEVMIE9ORSBUT1VDSCBGaWVyY2UifV0sImRwaSI6WzI0MCwyNDcuNV0sImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiVEhMLyovdGhsIDUwMDAvKiJ9LHsidWEiOiJ0aGwgNTAwMCJ9XSwiZHBpIjpbNDgwLDQ0My4zXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJGbHkvKi9JUTQ0MTIvKiJ9LHsidWEiOiJJUTQ0MTIifV0sImRwaSI6MzA3LjksImJ3IjozLCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoiWlRFLyovWlRFIEJsYWRlIEwyLyoifSx7InVhIjoiWlRFIEJsYWRlIEwyIn1dLCJkcGkiOjI0MCwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6IkJFTkVWRS8qL1ZSNTE4LyoifSx7InVhIjoiVlI1MTgifV0sImRwaSI6NDgwLCJidyI6MywiYWMiOjUwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzY0MCw5NjBdfV0sImRwaSI6WzMyNS4xLDMyOC40XSwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbNjQwLDExMzZdfV0sImRwaSI6WzMxNy4xLDMyMC4yXSwiYnciOjMsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbNzUwLDEzMzRdfV0sImRwaSI6MzI2LjQsImJ3Ijo0LCJhYyI6MTAwMH0seyJ0eXBlIjoiaW9zIiwicnVsZXMiOlt7InJlcyI6WzEyNDIsMjIwOF19XSwiZHBpIjpbNDUzLjYsNDU4LjRdLCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMTI1LDIwMDFdfV0sImRwaSI6WzQxMC45LDQxNS40XSwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJpb3MiLCJydWxlcyI6W3sicmVzIjpbMTEyNSwyNDM2XX1dLCJkcGkiOjQ1OCwiYnciOjQsImFjIjoxMDAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJIdWF3ZWkvKi9FTUwtTDI5LyoifSx7InVhIjoiRU1MLUwyOSJ9XSwiZHBpIjo0MjgsImJ3IjozLjQ1LCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJOb2tpYS8qL05va2lhIDcuMS8qIn0seyJ1YSI6Ik5va2lhIDcuMSJ9XSwiZHBpIjpbNDMyLDQzMS45XSwiYnciOjMsImFjIjo1MDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOlsxMjQyLDI2ODhdfV0sImRwaSI6NDU4LCJidyI6NCwiYWMiOjEwMDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HNTcwTS8qIn0seyJ1YSI6IlNNLUc1NzBNIn1dLCJkcGkiOjMyMCwiYnciOjMuNjg0LCJhYyI6MTAwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NzBGLyoifSx7InVhIjoiU00tRzk3MEYifV0sImRwaSI6NDM4LCJidyI6Mi4yODEsImFjIjo1MDB9LHsidHlwZSI6ImFuZHJvaWQiLCJydWxlcyI6W3sibWRtaCI6InNhbXN1bmcvKi9TTS1HOTczRi8qIn0seyJ1YSI6IlNNLUc5NzNGIn1dLCJkcGkiOjU1MCwiYnciOjIuMDAyLCJhYyI6NTAwfSx7InR5cGUiOiJhbmRyb2lkIiwicnVsZXMiOlt7Im1kbWgiOiJzYW1zdW5nLyovU00tRzk3NUYvKiJ9LHsidWEiOiJTTS1HOTc1RiJ9XSwiZHBpIjo1MjIsImJ3IjoyLjA1NCwiYWMiOjUwMH0seyJ0eXBlIjoiYW5kcm9pZCIsInJ1bGVzIjpbeyJtZG1oIjoic2Ftc3VuZy8qL1NNLUc5NzdGLyoifSx7InVhIjoiU00tRzk3N0YifV0sImRwaSI6NTA1LCJidyI6Mi4zMzQsImFjIjo1MDB9LHsidHlwZSI6ImlvcyIsInJ1bGVzIjpbeyJyZXMiOls4MjgsMTc5Ml19XSwiZHBpIjozMjYsImJ3Ijo1LCJhYyI6NTAwfV07CgkJCXZhciBEUERCX0NBQ0hFID0gewoJCQkJZm9ybWF0OiBmb3JtYXQsCgkJCQlsYXN0X3VwZGF0ZWQ6IGxhc3RfdXBkYXRlZCwKCQkJCWRldmljZXM6IGRldmljZXMKCQkJfTsKCQkJZnVuY3Rpb24gRHBkYih1cmwsIG9uRGV2aWNlUGFyYW1zVXBkYXRlZCkgewoJCQkgIHRoaXMuZHBkYiA9IERQREJfQ0FDSEU7CgkJCSAgdGhpcy5yZWNhbGN1bGF0ZURldmljZVBhcmFtc18oKTsKCQkJICBpZiAodXJsKSB7CgkJCSAgICB0aGlzLm9uRGV2aWNlUGFyYW1zVXBkYXRlZCA9IG9uRGV2aWNlUGFyYW1zVXBkYXRlZDsKCQkJICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQkJICAgIHZhciBvYmogPSB0aGlzOwoJCQkgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7CgkJCSAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHsKCQkJICAgICAgb2JqLmxvYWRpbmcgPSBmYWxzZTsKCQkJICAgICAgaWYgKHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPD0gMjk5KSB7CgkJCSAgICAgICAgb2JqLmRwZGIgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7CgkJCSAgICAgICAgb2JqLnJlY2FsY3VsYXRlRGV2aWNlUGFyYW1zXygpOwoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgb25saW5lIERQREIhJyk7CgkJCSAgICAgIH0KCQkJICAgIH0pOwoJCQkgICAgeGhyLnNlbmQoKTsKCQkJICB9CgkJCX0KCQkJRHBkYi5wcm90b3R5cGUuZ2V0RGV2aWNlUGFyYW1zID0gZnVuY3Rpb24gKCkgewoJCQkgIHJldHVybiB0aGlzLmRldmljZVBhcmFtczsKCQkJfTsKCQkJRHBkYi5wcm90b3R5cGUucmVjYWxjdWxhdGVEZXZpY2VQYXJhbXNfID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBuZXdEZXZpY2VQYXJhbXMgPSB0aGlzLmNhbGNEZXZpY2VQYXJhbXNfKCk7CgkJCSAgaWYgKG5ld0RldmljZVBhcmFtcykgewoJCQkgICAgdGhpcy5kZXZpY2VQYXJhbXMgPSBuZXdEZXZpY2VQYXJhbXM7CgkJCSAgICBpZiAodGhpcy5vbkRldmljZVBhcmFtc1VwZGF0ZWQpIHsKCQkJICAgICAgdGhpcy5vbkRldmljZVBhcmFtc1VwZGF0ZWQodGhpcy5kZXZpY2VQYXJhbXMpOwoJCQkgICAgfQoJCQkgIH0gZWxzZSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcmVjYWxjdWxhdGUgZGV2aWNlIHBhcmFtZXRlcnMuJyk7CgkJCSAgfQoJCQl9OwoJCQlEcGRiLnByb3RvdHlwZS5jYWxjRGV2aWNlUGFyYW1zXyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZGIgPSB0aGlzLmRwZGI7CgkJCSAgaWYgKCFkYikgewoJCQkgICAgY29uc29sZS5lcnJvcignRFBEQiBub3QgYXZhaWxhYmxlLicpOwoJCQkgICAgcmV0dXJuIG51bGw7CgkJCSAgfQoJCQkgIGlmIChkYi5mb3JtYXQgIT0gMSkgewoJCQkgICAgY29uc29sZS5lcnJvcignRFBEQiBoYXMgdW5leHBlY3RlZCBmb3JtYXQgdmVyc2lvbi4nKTsKCQkJICAgIHJldHVybiBudWxsOwoJCQkgIH0KCQkJICBpZiAoIWRiLmRldmljZXMgfHwgIWRiLmRldmljZXMubGVuZ3RoKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdEUERCIGRvZXMgbm90IGhhdmUgYSBkZXZpY2VzIHNlY3Rpb24uJyk7CgkJCSAgICByZXR1cm4gbnVsbDsKCQkJICB9CgkJCSAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCB3aW5kb3cub3BlcmE7CgkJCSAgdmFyIHdpZHRoID0gZ2V0U2NyZWVuV2lkdGgoKTsKCQkJICB2YXIgaGVpZ2h0ID0gZ2V0U2NyZWVuSGVpZ2h0KCk7CgkJCSAgaWYgKCFkYi5kZXZpY2VzKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdEUERCIGhhcyBubyBkZXZpY2VzIHNlY3Rpb24uJyk7CgkJCSAgICByZXR1cm4gbnVsbDsKCQkJICB9CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYi5kZXZpY2VzLmxlbmd0aDsgaSsrKSB7CgkJCSAgICB2YXIgZGV2aWNlID0gZGIuZGV2aWNlc1tpXTsKCQkJICAgIGlmICghZGV2aWNlLnJ1bGVzKSB7CgkJCSAgICAgIGNvbnNvbGUud2FybignRGV2aWNlWycgKyBpICsgJ10gaGFzIG5vIHJ1bGVzIHNlY3Rpb24uJyk7CgkJCSAgICAgIGNvbnRpbnVlOwoJCQkgICAgfQoJCQkgICAgaWYgKGRldmljZS50eXBlICE9ICdpb3MnICYmIGRldmljZS50eXBlICE9ICdhbmRyb2lkJykgewoJCQkgICAgICBjb25zb2xlLndhcm4oJ0RldmljZVsnICsgaSArICddIGhhcyBpbnZhbGlkIHR5cGUuJyk7CgkJCSAgICAgIGNvbnRpbnVlOwoJCQkgICAgfQoJCQkgICAgaWYgKGlzSU9TKCkgIT0gKGRldmljZS50eXBlID09ICdpb3MnKSkgY29udGludWU7CgkJCSAgICB2YXIgbWF0Y2hlZCA9IGZhbHNlOwoJCQkgICAgZm9yICh2YXIgaiA9IDA7IGogPCBkZXZpY2UucnVsZXMubGVuZ3RoOyBqKyspIHsKCQkJICAgICAgdmFyIHJ1bGUgPSBkZXZpY2UucnVsZXNbal07CgkJCSAgICAgIGlmICh0aGlzLnJ1bGVNYXRjaGVzXyhydWxlLCB1c2VyQWdlbnQsIHdpZHRoLCBoZWlnaHQpKSB7CgkJCSAgICAgICAgbWF0Y2hlZCA9IHRydWU7CgkJCSAgICAgICAgYnJlYWs7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICAgIGlmICghbWF0Y2hlZCkgY29udGludWU7CgkJCSAgICB2YXIgeGRwaSA9IGRldmljZS5kcGlbMF0gfHwgZGV2aWNlLmRwaTsKCQkJICAgIHZhciB5ZHBpID0gZGV2aWNlLmRwaVsxXSB8fCBkZXZpY2UuZHBpOwoJCQkgICAgcmV0dXJuIG5ldyBEZXZpY2VQYXJhbXMoeyB4ZHBpOiB4ZHBpLCB5ZHBpOiB5ZHBpLCBiZXZlbE1tOiBkZXZpY2UuYncgfSk7CgkJCSAgfQoJCQkgIGNvbnNvbGUud2FybignTm8gRFBEQiBkZXZpY2UgbWF0Y2guJyk7CgkJCSAgcmV0dXJuIG51bGw7CgkJCX07CgkJCURwZGIucHJvdG90eXBlLnJ1bGVNYXRjaGVzXyA9IGZ1bmN0aW9uIChydWxlLCB1YSwgc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgewoJCQkgIGlmICghcnVsZS51YSAmJiAhcnVsZS5yZXMpIHJldHVybiBmYWxzZTsKCQkJICBpZiAocnVsZS51YSAmJiBydWxlLnVhLnN1YnN0cmluZygwLCAyKSA9PT0gJ1NNJykgcnVsZS51YSA9IHJ1bGUudWEuc3Vic3RyaW5nKDAsIDcpOwoJCQkgIGlmIChydWxlLnVhICYmIHVhLmluZGV4T2YocnVsZS51YSkgPCAwKSByZXR1cm4gZmFsc2U7CgkJCSAgaWYgKHJ1bGUucmVzKSB7CgkJCSAgICBpZiAoIXJ1bGUucmVzWzBdIHx8ICFydWxlLnJlc1sxXSkgcmV0dXJuIGZhbHNlOwoJCQkgICAgdmFyIHJlc1ggPSBydWxlLnJlc1swXTsKCQkJICAgIHZhciByZXNZID0gcnVsZS5yZXNbMV07CgkJCSAgICBpZiAoTWF0aC5taW4oc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgIT0gTWF0aC5taW4ocmVzWCwgcmVzWSkgfHwgTWF0aC5tYXgoc2NyZWVuV2lkdGgsIHNjcmVlbkhlaWdodCkgIT0gTWF0aC5tYXgocmVzWCwgcmVzWSkpIHsKCQkJICAgICAgcmV0dXJuIGZhbHNlOwoJCQkgICAgfQoJCQkgIH0KCQkJICByZXR1cm4gdHJ1ZTsKCQkJfTsKCQkJZnVuY3Rpb24gRGV2aWNlUGFyYW1zKHBhcmFtcykgewoJCQkgIHRoaXMueGRwaSA9IHBhcmFtcy54ZHBpOwoJCQkgIHRoaXMueWRwaSA9IHBhcmFtcy55ZHBpOwoJCQkgIHRoaXMuYmV2ZWxNbSA9IHBhcmFtcy5iZXZlbE1tOwoJCQl9CgkJCWZ1bmN0aW9uIFNlbnNvclNhbXBsZShzYW1wbGUsIHRpbWVzdGFtcFMpIHsKCQkJICB0aGlzLnNldChzYW1wbGUsIHRpbWVzdGFtcFMpOwoJCQl9CgkJCVNlbnNvclNhbXBsZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKHNhbXBsZSwgdGltZXN0YW1wUykgewoJCQkgIHRoaXMuc2FtcGxlID0gc2FtcGxlOwoJCQkgIHRoaXMudGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CgkJCX07CgkJCVNlbnNvclNhbXBsZS5wcm90b3R5cGUuY29weSA9IGZ1bmN0aW9uIChzZW5zb3JTYW1wbGUpIHsKCQkJICB0aGlzLnNldChzZW5zb3JTYW1wbGUuc2FtcGxlLCBzZW5zb3JTYW1wbGUudGltZXN0YW1wUyk7CgkJCX07CgkJCWZ1bmN0aW9uIENvbXBsZW1lbnRhcnlGaWx0ZXIoa0ZpbHRlciwgaXNEZWJ1ZykgewoJCQkgIHRoaXMua0ZpbHRlciA9IGtGaWx0ZXI7CgkJCSAgdGhpcy5pc0RlYnVnID0gaXNEZWJ1ZzsKCQkJICB0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwoJCQkgIHRoaXMuY3VycmVudEd5cm9NZWFzdXJlbWVudCA9IG5ldyBTZW5zb3JTYW1wbGUoKTsKCQkJICB0aGlzLnByZXZpb3VzR3lyb01lYXN1cmVtZW50ID0gbmV3IFNlbnNvclNhbXBsZSgpOwoJCQkgIGlmIChpc0lPUygpKSB7CgkJCSAgICB0aGlzLmZpbHRlclEgPSBuZXcgUXVhdGVybmlvbigtMSwgMCwgMCwgMSk7CgkJCSAgfSBlbHNlIHsKCQkJICAgIHRoaXMuZmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKDEsIDAsIDAsIDEpOwoJCQkgIH0KCQkJICB0aGlzLnByZXZpb3VzRmlsdGVyUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgdGhpcy5wcmV2aW91c0ZpbHRlclEuY29weSh0aGlzLmZpbHRlclEpOwoJCQkgIHRoaXMuYWNjZWxRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCA9IGZhbHNlOwoJCQkgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eSA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgdGhpcy5tZWFzdXJlZEdyYXZpdHkgPSBuZXcgVmVjdG9yMygpOwoJCQkgIHRoaXMuZ3lyb0ludGVncmFsUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCX0KCQkJQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuYWRkQWNjZWxNZWFzdXJlbWVudCA9IGZ1bmN0aW9uICh2ZWN0b3IsIHRpbWVzdGFtcFMpIHsKCQkJICB0aGlzLmN1cnJlbnRBY2NlbE1lYXN1cmVtZW50LnNldCh2ZWN0b3IsIHRpbWVzdGFtcFMpOwoJCQl9OwoJCQlDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5hZGRHeXJvTWVhc3VyZW1lbnQgPSBmdW5jdGlvbiAodmVjdG9yLCB0aW1lc3RhbXBTKSB7CgkJCSAgdGhpcy5jdXJyZW50R3lyb01lYXN1cmVtZW50LnNldCh2ZWN0b3IsIHRpbWVzdGFtcFMpOwoJCQkgIHZhciBkZWx0YVQgPSB0aW1lc3RhbXBTIC0gdGhpcy5wcmV2aW91c0d5cm9NZWFzdXJlbWVudC50aW1lc3RhbXBTOwoJCQkgIGlmIChpc1RpbWVzdGFtcERlbHRhVmFsaWQoZGVsdGFUKSkgewoJCQkgICAgdGhpcy5ydW5fKCk7CgkJCSAgfQoJCQkgIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQuY29weSh0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQpOwoJCQl9OwoJCQlDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5ydW5fID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICghdGhpcy5pc09yaWVudGF0aW9uSW5pdGlhbGl6ZWQpIHsKCQkJICAgIHRoaXMuYWNjZWxRID0gdGhpcy5hY2NlbFRvUXVhdGVybmlvbl8odGhpcy5jdXJyZW50QWNjZWxNZWFzdXJlbWVudC5zYW1wbGUpOwoJCQkgICAgdGhpcy5wcmV2aW91c0ZpbHRlclEuY29weSh0aGlzLmFjY2VsUSk7CgkJCSAgICB0aGlzLmlzT3JpZW50YXRpb25Jbml0aWFsaXplZCA9IHRydWU7CgkJCSAgICByZXR1cm47CgkJCSAgfQoJCQkgIHZhciBkZWx0YVQgPSB0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUyAtIHRoaXMucHJldmlvdXNHeXJvTWVhc3VyZW1lbnQudGltZXN0YW1wUzsKCQkJICB2YXIgZ3lyb0RlbHRhUSA9IHRoaXMuZ3lyb1RvUXVhdGVybmlvbkRlbHRhXyh0aGlzLmN1cnJlbnRHeXJvTWVhc3VyZW1lbnQuc2FtcGxlLCBkZWx0YVQpOwoJCQkgIHRoaXMuZ3lyb0ludGVncmFsUS5tdWx0aXBseShneXJvRGVsdGFRKTsKCQkJICB0aGlzLmZpbHRlclEuY29weSh0aGlzLnByZXZpb3VzRmlsdGVyUSk7CgkJCSAgdGhpcy5maWx0ZXJRLm11bHRpcGx5KGd5cm9EZWx0YVEpOwoJCQkgIHZhciBpbnZGaWx0ZXJRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICBpbnZGaWx0ZXJRLmNvcHkodGhpcy5maWx0ZXJRKTsKCQkJICBpbnZGaWx0ZXJRLmludmVyc2UoKTsKCQkJICB0aGlzLmVzdGltYXRlZEdyYXZpdHkuc2V0KDAsIDAsIC0xKTsKCQkJICB0aGlzLmVzdGltYXRlZEdyYXZpdHkuYXBwbHlRdWF0ZXJuaW9uKGludkZpbHRlclEpOwoJCQkgIHRoaXMuZXN0aW1hdGVkR3Jhdml0eS5ub3JtYWxpemUoKTsKCQkJICB0aGlzLm1lYXN1cmVkR3Jhdml0eS5jb3B5KHRoaXMuY3VycmVudEFjY2VsTWVhc3VyZW1lbnQuc2FtcGxlKTsKCQkJICB0aGlzLm1lYXN1cmVkR3Jhdml0eS5ub3JtYWxpemUoKTsKCQkJICB2YXIgZGVsdGFRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICBkZWx0YVEuc2V0RnJvbVVuaXRWZWN0b3JzKHRoaXMuZXN0aW1hdGVkR3Jhdml0eSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkpOwoJCQkgIGRlbHRhUS5pbnZlcnNlKCk7CgkJCSAgaWYgKHRoaXMuaXNEZWJ1ZykgewoJCQkgICAgY29uc29sZS5sb2coJ0RlbHRhOiAlZCBkZWcsIEdfZXN0OiAoJXMsICVzLCAlcyksIEdfbWVhczogKCVzLCAlcywgJXMpJywgcmFkVG9EZWcgKiBnZXRRdWF0ZXJuaW9uQW5nbGUoZGVsdGFRKSwgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LngudG9GaXhlZCgxKSwgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LnkudG9GaXhlZCgxKSwgdGhpcy5lc3RpbWF0ZWRHcmF2aXR5LnoudG9GaXhlZCgxKSwgdGhpcy5tZWFzdXJlZEdyYXZpdHkueC50b0ZpeGVkKDEpLCB0aGlzLm1lYXN1cmVkR3Jhdml0eS55LnRvRml4ZWQoMSksIHRoaXMubWVhc3VyZWRHcmF2aXR5LnoudG9GaXhlZCgxKSk7CgkJCSAgfQoJCQkgIHZhciB0YXJnZXRRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0YXJnZXRRLmNvcHkodGhpcy5maWx0ZXJRKTsKCQkJICB0YXJnZXRRLm11bHRpcGx5KGRlbHRhUSk7CgkJCSAgdGhpcy5maWx0ZXJRLnNsZXJwKHRhcmdldFEsIDEgLSB0aGlzLmtGaWx0ZXIpOwoJCQkgIHRoaXMucHJldmlvdXNGaWx0ZXJRLmNvcHkodGhpcy5maWx0ZXJRKTsKCQkJfTsKCQkJQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuZ2V0T3JpZW50YXRpb24gPSBmdW5jdGlvbiAoKSB7CgkJCSAgcmV0dXJuIHRoaXMuZmlsdGVyUTsKCQkJfTsKCQkJQ29tcGxlbWVudGFyeUZpbHRlci5wcm90b3R5cGUuYWNjZWxUb1F1YXRlcm5pb25fID0gZnVuY3Rpb24gKGFjY2VsKSB7CgkJCSAgdmFyIG5vcm1BY2NlbCA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgbm9ybUFjY2VsLmNvcHkoYWNjZWwpOwoJCQkgIG5vcm1BY2NlbC5ub3JtYWxpemUoKTsKCQkJICB2YXIgcXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgcXVhdC5zZXRGcm9tVW5pdFZlY3RvcnMobmV3IFZlY3RvcjMoMCwgMCwgLTEpLCBub3JtQWNjZWwpOwoJCQkgIHF1YXQuaW52ZXJzZSgpOwoJCQkgIHJldHVybiBxdWF0OwoJCQl9OwoJCQlDb21wbGVtZW50YXJ5RmlsdGVyLnByb3RvdHlwZS5neXJvVG9RdWF0ZXJuaW9uRGVsdGFfID0gZnVuY3Rpb24gKGd5cm8sIGR0KSB7CgkJCSAgdmFyIHF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIHZhciBheGlzID0gbmV3IFZlY3RvcjMoKTsKCQkJICBheGlzLmNvcHkoZ3lybyk7CgkJCSAgYXhpcy5ub3JtYWxpemUoKTsKCQkJICBxdWF0LnNldEZyb21BeGlzQW5nbGUoYXhpcywgZ3lyby5sZW5ndGgoKSAqIGR0KTsKCQkJICByZXR1cm4gcXVhdDsKCQkJfTsKCQkJZnVuY3Rpb24gUG9zZVByZWRpY3RvcihwcmVkaWN0aW9uVGltZVMsIGlzRGVidWcpIHsKCQkJICB0aGlzLnByZWRpY3Rpb25UaW1lUyA9IHByZWRpY3Rpb25UaW1lUzsKCQkJICB0aGlzLmlzRGVidWcgPSBpc0RlYnVnOwoJCQkgIHRoaXMucHJldmlvdXNRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IG51bGw7CgkJCSAgdGhpcy5kZWx0YVEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIHRoaXMub3V0USA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCX0KCQkJUG9zZVByZWRpY3Rvci5wcm90b3R5cGUuZ2V0UHJlZGljdGlvbiA9IGZ1bmN0aW9uIChjdXJyZW50USwgZ3lybywgdGltZXN0YW1wUykgewoJCQkgIGlmICghdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMpIHsKCQkJICAgIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwoJCQkgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwoJCQkgICAgcmV0dXJuIGN1cnJlbnRROwoJCQkgIH0KCQkJICB2YXIgYXhpcyA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgYXhpcy5jb3B5KGd5cm8pOwoJCQkgIGF4aXMubm9ybWFsaXplKCk7CgkJCSAgdmFyIGFuZ3VsYXJTcGVlZCA9IGd5cm8ubGVuZ3RoKCk7CgkJCSAgaWYgKGFuZ3VsYXJTcGVlZCA8IGRlZ1RvUmFkICogMjApIHsKCQkJICAgIGlmICh0aGlzLmlzRGVidWcpIHsKCQkJICAgICAgY29uc29sZS5sb2coJ01vdmluZyBzbG93bHksIGF0ICVzIGRlZy9zOiBubyBwcmVkaWN0aW9uJywgKHJhZFRvRGVnICogYW5ndWxhclNwZWVkKS50b0ZpeGVkKDEpKTsKCQkJICAgIH0KCQkJICAgIHRoaXMub3V0US5jb3B5KGN1cnJlbnRRKTsKCQkJICAgIHRoaXMucHJldmlvdXNRLmNvcHkoY3VycmVudFEpOwoJCQkgICAgcmV0dXJuIHRoaXMub3V0UTsKCQkJICB9CgkJCSAgdmFyIHByZWRpY3RBbmdsZSA9IGFuZ3VsYXJTcGVlZCAqIHRoaXMucHJlZGljdGlvblRpbWVTOwoJCQkgIHRoaXMuZGVsdGFRLnNldEZyb21BeGlzQW5nbGUoYXhpcywgcHJlZGljdEFuZ2xlKTsKCQkJICB0aGlzLm91dFEuY29weSh0aGlzLnByZXZpb3VzUSk7CgkJCSAgdGhpcy5vdXRRLm11bHRpcGx5KHRoaXMuZGVsdGFRKTsKCQkJICB0aGlzLnByZXZpb3VzUS5jb3B5KGN1cnJlbnRRKTsKCQkJICB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyA9IHRpbWVzdGFtcFM7CgkJCSAgcmV0dXJuIHRoaXMub3V0UTsKCQkJfTsKCQkJZnVuY3Rpb24gRnVzaW9uUG9zZVNlbnNvcihrRmlsdGVyLCBwcmVkaWN0aW9uVGltZSwgeWF3T25seSwgaXNEZWJ1ZykgewoJCQkgIHRoaXMueWF3T25seSA9IHlhd09ubHk7CgkJCSAgdGhpcy5hY2NlbGVyb21ldGVyID0gbmV3IFZlY3RvcjMoKTsKCQkJICB0aGlzLmd5cm9zY29wZSA9IG5ldyBWZWN0b3IzKCk7CgkJCSAgdGhpcy5maWx0ZXIgPSBuZXcgQ29tcGxlbWVudGFyeUZpbHRlcihrRmlsdGVyLCBpc0RlYnVnKTsKCQkJICB0aGlzLnBvc2VQcmVkaWN0b3IgPSBuZXcgUG9zZVByZWRpY3RvcihwcmVkaWN0aW9uVGltZSwgaXNEZWJ1Zyk7CgkJCSAgdGhpcy5pc0ZpcmVmb3hBbmRyb2lkID0gaXNGaXJlZm94QW5kcm9pZCgpOwoJCQkgIHRoaXMuaXNJT1MgPSBpc0lPUygpOwoJCQkgIHZhciBjaHJvbWVWZXJzaW9uID0gZ2V0Q2hyb21lVmVyc2lvbigpOwoJCQkgIHRoaXMuaXNEZXZpY2VNb3Rpb25JblJhZGlhbnMgPSAhdGhpcy5pc0lPUyAmJiBjaHJvbWVWZXJzaW9uICYmIGNocm9tZVZlcnNpb24gPCA2NjsKCQkJICB0aGlzLmlzV2l0aG91dERldmljZU1vdGlvbiA9IGlzQ2hyb21lV2l0aG91dERldmljZU1vdGlvbigpIHx8IGlzU2FmYXJpV2l0aG91dERldmljZU1vdGlvbigpOwoJCQkgIHRoaXMuZmlsdGVyVG9Xb3JsZFEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIGlmIChpc0lPUygpKSB7CgkJCSAgICB0aGlzLmZpbHRlclRvV29ybGRRLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMSwgMCwgMCksIE1hdGguUEkgLyAyKTsKCQkJICB9IGVsc2UgewoJCQkgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDEsIDAsIDApLCAtTWF0aC5QSSAvIDIpOwoJCQkgIH0KCQkJICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgdGhpcy53b3JsZFRvU2NyZWVuUSA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCSAgdGhpcy5vcmlnaW5hbFBvc2VBZGp1c3RRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLm9yaWdpbmFsUG9zZUFkanVzdFEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgLXdpbmRvdy5vcmllbnRhdGlvbiAqIE1hdGguUEkgLyAxODApOwoJCQkgIHRoaXMuc2V0U2NyZWVuVHJhbnNmb3JtXygpOwoJCQkgIGlmIChpc0xhbmRzY2FwZU1vZGUoKSkgewoJCQkgICAgdGhpcy5maWx0ZXJUb1dvcmxkUS5tdWx0aXBseSh0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUSk7CgkJCSAgfQoJCQkgIHRoaXMucmVzZXRRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICB0aGlzLm9yaWVudGF0aW9uT3V0XyA9IG5ldyBGbG9hdDMyQXJyYXkoNCk7CgkJCSAgdGhpcy5zdGFydCgpOwoJCQl9CgkJCUZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLmdldFBvc2l0aW9uID0gZnVuY3Rpb24gKCkgewoJCQkgIHJldHVybiBudWxsOwoJCQl9OwoJCQlGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS5nZXRPcmllbnRhdGlvbiA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgb3JpZW50YXRpb24gPSB2b2lkIDA7CgkJCSAgaWYgKHRoaXMuaXNXaXRob3V0RGV2aWNlTW90aW9uICYmIHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSkgewoJCQkgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpeFEgPSB0aGlzLmRldmljZU9yaWVudGF0aW9uRml4USB8fCBmdW5jdGlvbiAoKSB7CgkJCSAgICAgIHZhciB6ID0gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDAsIC0xKSwgMCk7CgkJCSAgICAgIHZhciB5ID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICAgICAgaWYgKHdpbmRvdy5vcmllbnRhdGlvbiA9PT0gLTkwKSB7CgkJCSAgICAgICAgeS5zZXRGcm9tQXhpc0FuZ2xlKG5ldyBWZWN0b3IzKDAsIDEsIDApLCBNYXRoLlBJIC8gLTIpOwoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIHkuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAxLCAwKSwgTWF0aC5QSSAvIDIpOwoJCQkgICAgICB9CgkJCSAgICAgIHJldHVybiB6Lm11bHRpcGx5KHkpOwoJCQkgICAgfSgpOwoJCQkgICAgdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpbHRlclRvV29ybGRRID0gdGhpcy5kZXZpY2VPcmllbnRhdGlvbkZpbHRlclRvV29ybGRRIHx8IGZ1bmN0aW9uICgpIHsKCQkJICAgICAgdmFyIHEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgICAgICBxLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMSwgMCwgMCksIC1NYXRoLlBJIC8gMik7CgkJCSAgICAgIHJldHVybiBxOwoJCQkgICAgfSgpOwoJCQkgICAgb3JpZW50YXRpb24gPSB0aGlzLl9kZXZpY2VPcmllbnRhdGlvblE7CgkJCSAgICB2YXIgb3V0ID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICAgIG91dC5jb3B5KG9yaWVudGF0aW9uKTsKCQkJICAgIG91dC5tdWx0aXBseSh0aGlzLmRldmljZU9yaWVudGF0aW9uRmlsdGVyVG9Xb3JsZFEpOwoJCQkgICAgb3V0Lm11bHRpcGx5KHRoaXMucmVzZXRRKTsKCQkJICAgIG91dC5tdWx0aXBseSh0aGlzLndvcmxkVG9TY3JlZW5RKTsKCQkJICAgIG91dC5tdWx0aXBseVF1YXRlcm5pb25zKHRoaXMuZGV2aWNlT3JpZW50YXRpb25GaXhRLCBvdXQpOwoJCQkgICAgaWYgKHRoaXMueWF3T25seSkgewoJCQkgICAgICBvdXQueCA9IDA7CgkJCSAgICAgIG91dC56ID0gMDsKCQkJICAgICAgb3V0Lm5vcm1hbGl6ZSgpOwoJCQkgICAgfQoJCQkgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bMF0gPSBvdXQueDsKCQkJICAgIHRoaXMub3JpZW50YXRpb25PdXRfWzFdID0gb3V0Lnk7CgkJCSAgICB0aGlzLm9yaWVudGF0aW9uT3V0X1syXSA9IG91dC56OwoJCQkgICAgdGhpcy5vcmllbnRhdGlvbk91dF9bM10gPSBvdXQudzsKCQkJICAgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uT3V0XzsKCQkJICB9IGVsc2UgewoJCQkgICAgdmFyIGZpbHRlck9yaWVudGF0aW9uID0gdGhpcy5maWx0ZXIuZ2V0T3JpZW50YXRpb24oKTsKCQkJICAgIG9yaWVudGF0aW9uID0gdGhpcy5wb3NlUHJlZGljdG9yLmdldFByZWRpY3Rpb24oZmlsdGVyT3JpZW50YXRpb24sIHRoaXMuZ3lyb3Njb3BlLCB0aGlzLnByZXZpb3VzVGltZXN0YW1wUyk7CgkJCSAgfQoJCQkgIHZhciBvdXQgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgIG91dC5jb3B5KHRoaXMuZmlsdGVyVG9Xb3JsZFEpOwoJCQkgIG91dC5tdWx0aXBseSh0aGlzLnJlc2V0USk7CgkJCSAgb3V0Lm11bHRpcGx5KG9yaWVudGF0aW9uKTsKCQkJICBvdXQubXVsdGlwbHkodGhpcy53b3JsZFRvU2NyZWVuUSk7CgkJCSAgaWYgKHRoaXMueWF3T25seSkgewoJCQkgICAgb3V0LnggPSAwOwoJCQkgICAgb3V0LnogPSAwOwoJCQkgICAgb3V0Lm5vcm1hbGl6ZSgpOwoJCQkgIH0KCQkJICB0aGlzLm9yaWVudGF0aW9uT3V0X1swXSA9IG91dC54OwoJCQkgIHRoaXMub3JpZW50YXRpb25PdXRfWzFdID0gb3V0Lnk7CgkJCSAgdGhpcy5vcmllbnRhdGlvbk91dF9bMl0gPSBvdXQuejsKCQkJICB0aGlzLm9yaWVudGF0aW9uT3V0X1szXSA9IG91dC53OwoJCQkgIHJldHVybiB0aGlzLm9yaWVudGF0aW9uT3V0XzsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUucmVzZXRQb3NlID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMucmVzZXRRLmNvcHkodGhpcy5maWx0ZXIuZ2V0T3JpZW50YXRpb24oKSk7CgkJCSAgdGhpcy5yZXNldFEueCA9IDA7CgkJCSAgdGhpcy5yZXNldFEueSA9IDA7CgkJCSAgdGhpcy5yZXNldFEueiAqPSAtMTsKCQkJICB0aGlzLnJlc2V0US5ub3JtYWxpemUoKTsKCQkJICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkpIHsKCQkJICAgIHRoaXMucmVzZXRRLm11bHRpcGx5KHRoaXMuaW52ZXJzZVdvcmxkVG9TY3JlZW5RKTsKCQkJICB9CgkJCSAgdGhpcy5yZXNldFEubXVsdGlwbHkodGhpcy5vcmlnaW5hbFBvc2VBZGp1c3RRKTsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25EZXZpY2VPcmllbnRhdGlvbl8gPSBmdW5jdGlvbiAoZSkgewoJCQkgIHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSA9IHRoaXMuX2RldmljZU9yaWVudGF0aW9uUSB8fCBuZXcgUXVhdGVybmlvbigpOwoJCQkgIHZhciBhbHBoYSA9IGUuYWxwaGEsCgkJCSAgICAgIGJldGEgPSBlLmJldGEsCgkJCSAgICAgIGdhbW1hID0gZS5nYW1tYTsKCQkJICBhbHBoYSA9IChhbHBoYSB8fCAwKSAqIE1hdGguUEkgLyAxODA7CgkJCSAgYmV0YSA9IChiZXRhIHx8IDApICogTWF0aC5QSSAvIDE4MDsKCQkJICBnYW1tYSA9IChnYW1tYSB8fCAwKSAqIE1hdGguUEkgLyAxODA7CgkJCSAgdGhpcy5fZGV2aWNlT3JpZW50YXRpb25RLnNldEZyb21FdWxlcllYWihiZXRhLCBhbHBoYSwgLWdhbW1hKTsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25EZXZpY2VNb3Rpb25fID0gZnVuY3Rpb24gKGRldmljZU1vdGlvbikgewoJCQkgIHRoaXMudXBkYXRlRGV2aWNlTW90aW9uXyhkZXZpY2VNb3Rpb24pOwoJCQl9OwoJCQlGdXNpb25Qb3NlU2Vuc29yLnByb3RvdHlwZS51cGRhdGVEZXZpY2VNb3Rpb25fID0gZnVuY3Rpb24gKGRldmljZU1vdGlvbikgewoJCQkgIHZhciBhY2NHcmF2aXR5ID0gZGV2aWNlTW90aW9uLmFjY2VsZXJhdGlvbkluY2x1ZGluZ0dyYXZpdHk7CgkJCSAgdmFyIHJvdFJhdGUgPSBkZXZpY2VNb3Rpb24ucm90YXRpb25SYXRlOwoJCQkgIHZhciB0aW1lc3RhbXBTID0gZGV2aWNlTW90aW9uLnRpbWVTdGFtcCAvIDEwMDA7CgkJCSAgdmFyIGRlbHRhUyA9IHRpbWVzdGFtcFMgLSB0aGlzLnByZXZpb3VzVGltZXN0YW1wUzsKCQkJICBpZiAoZGVsdGFTIDwgMCkgewoJCQkgICAgd2Fybk9uY2UoJ2Z1c2lvbi1wb3NlLXNlbnNvcjppbnZhbGlkOm5vbi1tb25vdG9uaWMnLCAnSW52YWxpZCB0aW1lc3RhbXBzIGRldGVjdGVkOiBub24tbW9ub3RvbmljIHRpbWVzdGFtcCBmcm9tIGRldmljZW1vdGlvbicpOwoJCQkgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwoJCQkgICAgcmV0dXJuOwoJCQkgIH0gZWxzZSBpZiAoZGVsdGFTIDw9IE1JTl9USU1FU1RFUCB8fCBkZWx0YVMgPiBNQVhfVElNRVNURVApIHsKCQkJICAgIHdhcm5PbmNlKCdmdXNpb24tcG9zZS1zZW5zb3I6aW52YWxpZDpvdXRzaWRlLXRocmVzaG9sZCcsICdJbnZhbGlkIHRpbWVzdGFtcHMgZGV0ZWN0ZWQ6IFRpbWVzdGFtcCBmcm9tIGRldmljZW1vdGlvbiBvdXRzaWRlIGV4cGVjdGVkIHJhbmdlLicpOwoJCQkgICAgdGhpcy5wcmV2aW91c1RpbWVzdGFtcFMgPSB0aW1lc3RhbXBTOwoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB0aGlzLmFjY2VsZXJvbWV0ZXIuc2V0KC1hY2NHcmF2aXR5LngsIC1hY2NHcmF2aXR5LnksIC1hY2NHcmF2aXR5LnopOwoJCQkgIGlmIChyb3RSYXRlKSB7CgkJCSAgICBpZiAoaXNSNygpKSB7CgkJCSAgICAgIHRoaXMuZ3lyb3Njb3BlLnNldCgtcm90UmF0ZS5iZXRhLCByb3RSYXRlLmFscGhhLCByb3RSYXRlLmdhbW1hKTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMuZ3lyb3Njb3BlLnNldChyb3RSYXRlLmFscGhhLCByb3RSYXRlLmJldGEsIHJvdFJhdGUuZ2FtbWEpOwoJCQkgICAgfQoJCQkgICAgaWYgKCF0aGlzLmlzRGV2aWNlTW90aW9uSW5SYWRpYW5zKSB7CgkJCSAgICAgIHRoaXMuZ3lyb3Njb3BlLm11bHRpcGx5U2NhbGFyKE1hdGguUEkgLyAxODApOwoJCQkgICAgfQoJCQkgICAgdGhpcy5maWx0ZXIuYWRkR3lyb01lYXN1cmVtZW50KHRoaXMuZ3lyb3Njb3BlLCB0aW1lc3RhbXBTKTsKCQkJICB9CgkJCSAgdGhpcy5maWx0ZXIuYWRkQWNjZWxNZWFzdXJlbWVudCh0aGlzLmFjY2VsZXJvbWV0ZXIsIHRpbWVzdGFtcFMpOwoJCQkgIHRoaXMucHJldmlvdXNUaW1lc3RhbXBTID0gdGltZXN0YW1wUzsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25PcmllbnRhdGlvbkNoYW5nZV8gPSBmdW5jdGlvbiAoc2NyZWVuT3JpZW50YXRpb24pIHsKCQkJICB0aGlzLnNldFNjcmVlblRyYW5zZm9ybV8oKTsKCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUub25NZXNzYWdlXyA9IGZ1bmN0aW9uIChldmVudCkgewoJCQkgIHZhciBtZXNzYWdlID0gZXZlbnQuZGF0YTsKCQkJICBpZiAoIW1lc3NhZ2UgfHwgIW1lc3NhZ2UudHlwZSkgewoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB2YXIgdHlwZSA9IG1lc3NhZ2UudHlwZS50b0xvd2VyQ2FzZSgpOwoJCQkgIGlmICh0eXBlICE9PSAnZGV2aWNlbW90aW9uJykgewoJCQkgICAgcmV0dXJuOwoJCQkgIH0KCQkJICB0aGlzLnVwZGF0ZURldmljZU1vdGlvbl8obWVzc2FnZS5kZXZpY2VNb3Rpb25FdmVudCk7CgkJCX07CgkJCUZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnNldFNjcmVlblRyYW5zZm9ybV8gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdGhpcy53b3JsZFRvU2NyZWVuUS5zZXQoMCwgMCwgMCwgMSk7CgkJCSAgc3dpdGNoICh3aW5kb3cub3JpZW50YXRpb24pIHsKCQkJICAgIGNhc2UgMDoKCQkJICAgICAgYnJlYWs7CgkJCSAgICBjYXNlIDkwOgoJCQkgICAgICB0aGlzLndvcmxkVG9TY3JlZW5RLnNldEZyb21BeGlzQW5nbGUobmV3IFZlY3RvcjMoMCwgMCwgMSksIC1NYXRoLlBJIC8gMik7CgkJCSAgICAgIGJyZWFrOwoJCQkgICAgY2FzZSAtOTA6CgkJCSAgICAgIHRoaXMud29ybGRUb1NjcmVlblEuc2V0RnJvbUF4aXNBbmdsZShuZXcgVmVjdG9yMygwLCAwLCAxKSwgTWF0aC5QSSAvIDIpOwoJCQkgICAgICBicmVhazsKCQkJICB9CgkJCSAgdGhpcy5pbnZlcnNlV29ybGRUb1NjcmVlblEuY29weSh0aGlzLndvcmxkVG9TY3JlZW5RKTsKCQkJICB0aGlzLmludmVyc2VXb3JsZFRvU2NyZWVuUS5pbnZlcnNlKCk7CgkJCX07CgkJCUZ1c2lvblBvc2VTZW5zb3IucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMub25EZXZpY2VNb3Rpb25DYWxsYmFja18gPSB0aGlzLm9uRGV2aWNlTW90aW9uXy5iaW5kKHRoaXMpOwoJCQkgIHRoaXMub25PcmllbnRhdGlvbkNoYW5nZUNhbGxiYWNrXyA9IHRoaXMub25PcmllbnRhdGlvbkNoYW5nZV8uYmluZCh0aGlzKTsKCQkJICB0aGlzLm9uTWVzc2FnZUNhbGxiYWNrXyA9IHRoaXMub25NZXNzYWdlXy5iaW5kKHRoaXMpOwoJCQkgIHRoaXMub25EZXZpY2VPcmllbnRhdGlvbkNhbGxiYWNrXyA9IHRoaXMub25EZXZpY2VPcmllbnRhdGlvbl8uYmluZCh0aGlzKTsKCQkJICBpZiAoaXNJT1MoKSAmJiBpc0luc2lkZUNyb3NzT3JpZ2luSUZyYW1lKCkpIHsKCQkJICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbk1lc3NhZ2VDYWxsYmFja18pOwoJCQkgIH0KCQkJICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VDYWxsYmFja18pOwoJCQkgIGlmICh0aGlzLmlzV2l0aG91dERldmljZU1vdGlvbikgewoJCQkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfKTsKCQkJICB9IGVsc2UgewoJCQkgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RldmljZW1vdGlvbicsIHRoaXMub25EZXZpY2VNb3Rpb25DYWxsYmFja18pOwoJCQkgIH0KCQkJfTsKCQkJRnVzaW9uUG9zZVNlbnNvci5wcm90b3R5cGUuc3RvcCA9IGZ1bmN0aW9uICgpIHsKCQkJICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignZGV2aWNlbW90aW9uJywgdGhpcy5vbkRldmljZU1vdGlvbkNhbGxiYWNrXyk7CgkJCSAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2RldmljZW9yaWVudGF0aW9uJywgdGhpcy5vbkRldmljZU9yaWVudGF0aW9uQ2FsbGJhY2tfKTsKCQkJICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VDYWxsYmFja18pOwoJCQkgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbk1lc3NhZ2VDYWxsYmFja18pOwoJCQl9OwoJCQl2YXIgU0VOU09SX0ZSRVFVRU5DWSA9IDYwOwoJCQl2YXIgWF9BWElTID0gbmV3IFZlY3RvcjMoMSwgMCwgMCk7CgkJCXZhciBaX0FYSVMgPSBuZXcgVmVjdG9yMygwLCAwLCAxKTsKCQkJdmFyIFNFTlNPUl9UT19WUiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCVNFTlNPUl9UT19WUi5zZXRGcm9tQXhpc0FuZ2xlKFhfQVhJUywgLU1hdGguUEkgLyAyKTsKCQkJU0VOU09SX1RPX1ZSLm11bHRpcGx5KG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbUF4aXNBbmdsZShaX0FYSVMsIE1hdGguUEkgLyAyKSk7CgkJCXZhciBQb3NlU2Vuc29yID0gZnVuY3Rpb24gKCkgewoJCQkgIGZ1bmN0aW9uIFBvc2VTZW5zb3IoY29uZmlnKSB7CgkJCSAgICBjbGFzc0NhbGxDaGVjayh0aGlzLCBQb3NlU2Vuc29yKTsKCQkJICAgIHRoaXMuY29uZmlnID0gY29uZmlnOwoJCQkgICAgdGhpcy5zZW5zb3IgPSBudWxsOwoJCQkgICAgdGhpcy5mdXNpb25TZW5zb3IgPSBudWxsOwoJCQkgICAgdGhpcy5fb3V0ID0gbmV3IEZsb2F0MzJBcnJheSg0KTsKCQkJICAgIHRoaXMuYXBpID0gbnVsbDsKCQkJICAgIHRoaXMuZXJyb3JzID0gW107CgkJCSAgICB0aGlzLl9zZW5zb3JRID0gbmV3IFF1YXRlcm5pb24oKTsKCQkJICAgIHRoaXMuX291dFEgPSBuZXcgUXVhdGVybmlvbigpOwoJCQkgICAgdGhpcy5fb25TZW5zb3JSZWFkID0gdGhpcy5fb25TZW5zb3JSZWFkLmJpbmQodGhpcyk7CgkJCSAgICB0aGlzLl9vblNlbnNvckVycm9yID0gdGhpcy5fb25TZW5zb3JFcnJvci5iaW5kKHRoaXMpOwoJCQkgICAgdGhpcy5pbml0KCk7CgkJCSAgfQoJCQkgIGNyZWF0ZUNsYXNzKFBvc2VTZW5zb3IsIFt7CgkJCSAgICBrZXk6ICdpbml0JywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KCkgewoJCQkgICAgICB2YXIgc2Vuc29yID0gbnVsbDsKCQkJICAgICAgdHJ5IHsKCQkJICAgICAgICBzZW5zb3IgPSBuZXcgUmVsYXRpdmVPcmllbnRhdGlvblNlbnNvcih7CgkJCSAgICAgICAgICBmcmVxdWVuY3k6IFNFTlNPUl9GUkVRVUVOQ1ksCgkJCSAgICAgICAgICByZWZlcmVuY2VGcmFtZTogJ3NjcmVlbicKCQkJICAgICAgICB9KTsKCQkJICAgICAgICBzZW5zb3IuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCB0aGlzLl9vblNlbnNvckVycm9yKTsKCQkJICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKCQkJICAgICAgICB0aGlzLmVycm9ycy5wdXNoKGVycm9yKTsKCQkJICAgICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1NlY3VyaXR5RXJyb3InKSB7CgkJCSAgICAgICAgICBjb25zb2xlLmVycm9yKCdDYW5ub3QgY29uc3RydWN0IHNlbnNvcnMgZHVlIHRvIHRoZSBGZWF0dXJlIFBvbGljeScpOwoJCQkgICAgICAgICAgY29uc29sZS53YXJuKCdBdHRlbXB0aW5nIHRvIGZhbGwgYmFjayB1c2luZyAiZGV2aWNlbW90aW9uIjsgaG93ZXZlciB0aGlzIHdpbGwgJyArICdmYWlsIGluIHRoZSBmdXR1cmUgd2l0aG91dCBjb3JyZWN0IHBlcm1pc3Npb25zLicpOwoJCQkgICAgICAgICAgdGhpcy51c2VEZXZpY2VNb3Rpb24oKTsKCQkJICAgICAgICB9IGVsc2UgaWYgKGVycm9yLm5hbWUgPT09ICdSZWZlcmVuY2VFcnJvcicpIHsKCQkJICAgICAgICAgIHRoaXMudXNlRGV2aWNlTW90aW9uKCk7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwoJCQkgICAgICAgIH0KCQkJICAgICAgfQoJCQkgICAgICBpZiAoc2Vuc29yKSB7CgkJCSAgICAgICAgdGhpcy5hcGkgPSAnc2Vuc29yJzsKCQkJICAgICAgICB0aGlzLnNlbnNvciA9IHNlbnNvcjsKCQkJICAgICAgICB0aGlzLnNlbnNvci5hZGRFdmVudExpc3RlbmVyKCdyZWFkaW5nJywgdGhpcy5fb25TZW5zb3JSZWFkKTsKCQkJICAgICAgICB0aGlzLnNlbnNvci5zdGFydCgpOwoJCQkgICAgICB9CgkJCSAgICB9CgkJCSAgfSwgewoJCQkgICAga2V5OiAndXNlRGV2aWNlTW90aW9uJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiB1c2VEZXZpY2VNb3Rpb24oKSB7CgkJCSAgICAgIHRoaXMuYXBpID0gJ2RldmljZW1vdGlvbic7CgkJCSAgICAgIHRoaXMuZnVzaW9uU2Vuc29yID0gbmV3IEZ1c2lvblBvc2VTZW5zb3IodGhpcy5jb25maWcuS19GSUxURVIsIHRoaXMuY29uZmlnLlBSRURJQ1RJT05fVElNRV9TLCB0aGlzLmNvbmZpZy5ZQVdfT05MWSwgdGhpcy5jb25maWcuREVCVUcpOwoJCQkgICAgICBpZiAodGhpcy5zZW5zb3IpIHsKCQkJICAgICAgICB0aGlzLnNlbnNvci5yZW1vdmVFdmVudExpc3RlbmVyKCdyZWFkaW5nJywgdGhpcy5fb25TZW5zb3JSZWFkKTsKCQkJICAgICAgICB0aGlzLnNlbnNvci5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIHRoaXMuX29uU2Vuc29yRXJyb3IpOwoJCQkgICAgICAgIHRoaXMuc2Vuc29yID0gbnVsbDsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgIH0sIHsKCQkJICAgIGtleTogJ2dldE9yaWVudGF0aW9uJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRPcmllbnRhdGlvbigpIHsKCQkJICAgICAgaWYgKHRoaXMuZnVzaW9uU2Vuc29yKSB7CgkJCSAgICAgICAgcmV0dXJuIHRoaXMuZnVzaW9uU2Vuc29yLmdldE9yaWVudGF0aW9uKCk7CgkJCSAgICAgIH0KCQkJICAgICAgaWYgKCF0aGlzLnNlbnNvciB8fCAhdGhpcy5zZW5zb3IucXVhdGVybmlvbikgewoJCQkgICAgICAgIHRoaXMuX291dFswXSA9IHRoaXMuX291dFsxXSA9IHRoaXMuX291dFsyXSA9IDA7CgkJCSAgICAgICAgdGhpcy5fb3V0WzNdID0gMTsKCQkJICAgICAgICByZXR1cm4gdGhpcy5fb3V0OwoJCQkgICAgICB9CgkJCSAgICAgIHZhciBxID0gdGhpcy5zZW5zb3IucXVhdGVybmlvbjsKCQkJICAgICAgdGhpcy5fc2Vuc29yUS5zZXQocVswXSwgcVsxXSwgcVsyXSwgcVszXSk7CgkJCSAgICAgIHZhciBvdXQgPSB0aGlzLl9vdXRROwoJCQkgICAgICBvdXQuY29weShTRU5TT1JfVE9fVlIpOwoJCQkgICAgICBvdXQubXVsdGlwbHkodGhpcy5fc2Vuc29yUSk7CgkJCSAgICAgIGlmICh0aGlzLmNvbmZpZy5ZQVdfT05MWSkgewoJCQkgICAgICAgIG91dC54ID0gb3V0LnogPSAwOwoJCQkgICAgICAgIG91dC5ub3JtYWxpemUoKTsKCQkJICAgICAgfQoJCQkgICAgICB0aGlzLl9vdXRbMF0gPSBvdXQueDsKCQkJICAgICAgdGhpcy5fb3V0WzFdID0gb3V0Lnk7CgkJCSAgICAgIHRoaXMuX291dFsyXSA9IG91dC56OwoJCQkgICAgICB0aGlzLl9vdXRbM10gPSBvdXQudzsKCQkJICAgICAgcmV0dXJuIHRoaXMuX291dDsKCQkJICAgIH0KCQkJICB9LCB7CgkJCSAgICBrZXk6ICdfb25TZW5zb3JFcnJvcicsCgkJCSAgICB2YWx1ZTogZnVuY3Rpb24gX29uU2Vuc29yRXJyb3IoZXZlbnQpIHsKCQkJICAgICAgdGhpcy5lcnJvcnMucHVzaChldmVudC5lcnJvcik7CgkJCSAgICAgIGlmIChldmVudC5lcnJvci5uYW1lID09PSAnTm90QWxsb3dlZEVycm9yJykgewoJCQkgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1Blcm1pc3Npb24gdG8gYWNjZXNzIHNlbnNvciB3YXMgZGVuaWVkJyk7CgkJCSAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZXJyb3IubmFtZSA9PT0gJ05vdFJlYWRhYmxlRXJyb3InKSB7CgkJCSAgICAgICAgY29uc29sZS5lcnJvcignU2Vuc29yIGNvdWxkIG5vdCBiZSByZWFkJyk7CgkJCSAgICAgIH0gZWxzZSB7CgkJCSAgICAgICAgY29uc29sZS5lcnJvcihldmVudC5lcnJvcik7CgkJCSAgICAgIH0KCQkJICAgICAgdGhpcy51c2VEZXZpY2VNb3Rpb24oKTsKCQkJICAgIH0KCQkJICB9LCB7CgkJCSAgICBrZXk6ICdfb25TZW5zb3JSZWFkJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBfb25TZW5zb3JSZWFkKCkge30KCQkJICB9XSk7CgkJCSAgcmV0dXJuIFBvc2VTZW5zb3I7CgkJCX0oKTsKCQkJdmFyIHJvdGF0ZUluc3RydWN0aW9uc0Fzc2V0ID0gIjxzdmcgd2lkdGg9JzE5OCcgaGVpZ2h0PScyNDAnIHZpZXdCb3g9JzAgMCAxOTggMjQwJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnPjxnIGZpbGw9J25vbmUnIGZpbGwtcnVsZT0nZXZlbm9kZCc+PHBhdGggZD0nTTE0OS42MjUgMTA5LjUyN2w2LjczNyAzLjg5MXYuODg2YzAgLjE3Ny4wMTMuMzYuMDM4LjU0OS4wMS4wODEuMDIuMTYyLjAyNy4yNDIuMTQgMS40MTUuOTc0IDIuOTk4IDIuMTA1IDMuOTk5bDUuNzIgNS4wNjIuMDgxLS4wOXM0LjM4Mi0yLjUzIDUuMjM1LTMuMDI0bDI1Ljk3IDE0Ljk5M3Y1NC4wMDFjMCAuNzcxLS4zODYgMS4yMTctLjk0OCAxLjIxNy0uMjMzIDAtLjQ5NS0uMDc2LS43NzItLjIzNmwtMjMuOTY3LTEzLjgzOC0uMDE0LjAyNC0yNy4zMjIgMTUuNzc1LS44NS0xLjMyM2MtNC43MzEtMS41MjktOS43NDgtMi43NC0xNC45NTEtMy42MWEuMjcuMjcgMCAwIDAtLjAwNy4wMjRsLTUuMDY3IDE2Ljk2MS03Ljg5MSA0LjU1Ni0uMDM3LS4wNjN2MjcuNTljMCAuNzcyLS4zODYgMS4yMTctLjk0OCAxLjIxNy0uMjMyIDAtLjQ5NS0uMDc2LS43NzItLjIzNmwtNDIuNDczLTI0LjUyMmMtLjk1LS41NDktMS43Mi0xLjg3Ny0xLjcyLTIuOTY3di0xLjAzNWwtLjAyMS4wNDdhNS4xMTEgNS4xMTEgMCAwIDAtMS44MTYtLjM5OSA1LjY4MiA1LjY4MiAwIDAgMC0uNTQ2LjAwMSAxMy43MjQgMTMuNzI0IDAgMCAxLTEuOTE4LS4wNDFjLTEuNjU1LS4xNTMtMy4yLS42LTQuNDA0LTEuMjk2bC00Ni41NzYtMjYuODkuMDA1LjAxMi0xMC4yNzgtMTguNzVjLTEuMDAxLTEuODI3LS4yNDEtNC4yMTYgMS42OTgtNS4zMzZsNTYuMDExLTMyLjM0NWE0LjE5NCA0LjE5NCAwIDAgMSAyLjA5OS0uNTcyYzEuMzI2IDAgMi41NzIuNjU5IDMuMjI3IDEuODUzbC4wMDUtLjAwMy4yMjcuNDEzLS4wMDYuMDA0YTkuNjMgOS42MyAwIDAgMCAxLjQ3NyAyLjAxOGwuMjc3LjI3YzEuOTE0IDEuODUgNC40NjggMi44MDEgNy4xMTMgMi44MDEgMS45NDkgMCAzLjk0OC0uNTE3IDUuNzc1LTEuNTcyLjAxMyAwIDcuMzE5LTQuMjE5IDcuMzE5LTQuMjE5YTQuMTk0IDQuMTk0IDAgMCAxIDIuMDk5LS41NzJjMS4zMjYgMCAyLjU3Mi42NTggMy4yMjYgMS44NTNsMy4yNSA1LjkyOC4wMjItLjAxOCA2Ljc4NSAzLjkxNy0uMTA1LS4xODIgNDYuODgxLTI2Ljk2NW0wLTEuNjM1Yy0uMjgyIDAtLjU2My4wNzMtLjgxNS4yMThsLTQ2LjE2OSAyNi41NTYtNS40MS0zLjEyNC0zLjAwNS01LjQ4MWMtLjkxMy0xLjY2Ny0yLjY5OS0yLjcwMi00LjY2LTIuNzAzLTEuMDExIDAtMi4wMi4yNzQtMi45MTcuNzkyYTM4MjUgMzgyNSAwIDAgMS03LjI3NSA0LjE5NWwtLjA0NC4wMjRhOS45MzcgOS45MzcgMCAwIDEtNC45NTcgMS4zNTNjLTIuMjkyIDAtNC40MTQtLjgzMi01Ljk3Ni0yLjM0MmwtLjI1Mi0uMjQ1YTcuOTkyIDcuOTkyIDAgMCAxLTEuMTM5LTEuNTM0IDEuMzc5IDEuMzc5IDAgMCAwLS4wNi0uMTIybC0uMjI3LS40MTRhMS43MTggMS43MTggMCAwIDAtLjA5NS0uMTU0Yy0uOTM4LTEuNTc0LTIuNjczLTIuNTQ1LTQuNTcxLTIuNTQ1LTEuMDExIDAtMi4wMi4yNzQtMi45MTcuNzkyTDMuMTI1IDE1NS41MDJjLTIuNjk5IDEuNTU5LTMuNzM4IDQuOTQtMi4zMTQgNy41MzhsMTAuMjc4IDE4Ljc1Yy4xNzcuMzIzLjQ0OC41NjMuNzYxLjcwNGw0Ni40MjYgMjYuODA0YzEuNDAzLjgxIDMuMTU3IDEuMzMyIDUuMDcyIDEuNTA4YTE1LjY2MSAxNS42NjEgMCAwIDAgMi4xNDYuMDQ2IDQuNzY2IDQuNzY2IDAgMCAxIC4zOTYgMGMuMDk2LjAwNC4xOS4wMTEuMjgzLjAyMi4xMDkgMS41OTMgMS4xNTkgMy4zMjMgMi41MjkgNC4xMTRsNDIuNDcyIDI0LjUyMmMuNTI0LjMwMiAxLjA1OC40NTUgMS41OS40NTUgMS40OTcgMCAyLjU4My0xLjIgMi41ODMtMi44NTJ2LTI2LjU2Mmw3LjExMS00LjEwNWExLjY0IDEuNjQgMCAwIDAgLjc0OS0uOTQ4bDQuNjU4LTE1LjU5M2M0LjQxNC43OTcgOC42OTIgMS44NDggMTIuNzQyIDMuMTI4bC41MzMuODI5YTEuNjM0IDEuNjM0IDAgMCAwIDIuMTkzLjUzMWwyNi41MzItMTUuMzE3TDE5MyAxOTIuNDMzYy41MjMuMzAyIDEuMDU4LjQ1NSAxLjU5LjQ1NSAxLjQ5NyAwIDIuNTgzLTEuMTk5IDIuNTgzLTIuODUydi01NC4wMDFjMC0uNTg0LS4zMTItMS4xMjQtLjgxOC0xLjQxNmwtMjUuOTctMTQuOTkzYTEuNjMzIDEuNjMzIDAgMCAwLTEuNjM2LjAwMWMtLjYwNi4zNTEtMi45OTMgMS43My00LjMyNSAyLjQ5OGwtNC44MDktNC4yNTVjLS44MTktLjcyNS0xLjQ2MS0xLjkzMy0xLjU2MS0yLjkzNmE3Ljc3NiA3Ljc3NiAwIDAgMC0uMDMzLS4yOTQgMi40ODcgMi40ODcgMCAwIDEtLjAyMy0uMzM2di0uODg2YzAtLjU4NC0uMzEyLTEuMTIzLS44MTctMS40MTZsLTYuNzM5LTMuODkxYTEuNjMzIDEuNjMzIDAgMCAwLS44MTctLjIxOScgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J005Ni4wMjcgMTMyLjYzNmw0Ni41NzYgMjYuODkxYzEuMjA0LjY5NSAxLjk3OSAxLjU4NyAyLjI0MiAyLjU0MWwtLjAxLjAwNy04MS4zNzQgNDYuOTgyaC0uMDAxYy0xLjY1NC0uMTUyLTMuMTk5LS42LTQuNDAzLTEuMjk1bC00Ni41NzYtMjYuODkxIDgzLjU0Ni00OC4yMzUnIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNNjMuNDYxIDIwOS4xNzRjLS4wMDggMC0uMDE1IDAtLjAyMi0uMDAyLTEuNjkzLS4xNTYtMy4yMjgtLjYwOS00LjQ0MS0xLjMwOWwtNDYuNTc2LTI2Ljg5YS4xMTguMTE4IDAgMCAxIDAtLjIwM2w4My41NDYtNDguMjM1YS4xMTcuMTE3IDAgMCAxIC4xMTcgMGw0Ni41NzYgMjYuODkxYzEuMjI3LjcwOCAyLjAyMSAxLjYxMiAyLjI5NiAyLjYxMWEuMTE2LjExNiAwIDAgMS0uMDQyLjEyNGwtLjAyMS4wMTYtODEuMzc1IDQ2Ljk4MWEuMTEuMTEgMCAwIDEtLjA1OC4wMTZ6bS01MC43NDctMjguMzAzbDQ2LjQwMSAyNi43OWMxLjE3OC42OCAyLjY3MSAxLjEyMSA0LjMyIDEuMjc2bDgxLjI3Mi00Ni45MjJjLS4yNzktLjkwNy0xLjAyNS0xLjczLTIuMTYzLTIuMzg3bC00Ni41MTctMjYuODU3LTgzLjMxMyA0OC4xeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDguMzI3IDE2NS40NzFhNS44NSA1Ljg1IDAgMCAxLS41NDYuMDAxYy0xLjg5NC0uMDgzLTMuMzAyLTEuMDM4LTMuMTQ1LTIuMTMyYTIuNjkzIDIuNjkzIDAgMCAwLS4wNzItMS4xMDVsLTgxLjEwMyA0Ni44MjJjLjYyOC4wNTggMS4yNzIuMDczIDEuOTE4LjA0Mi4xODItLjAwOS4zNjQtLjAwOS41NDYtLjAwMSAxLjg5NC4wODMgMy4zMDIgMS4wMzggMy4xNDUgMi4xMzJsNzkuMjU3LTQ1Ljc1OScgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OS4wNyAyMTEuMzQ3YS4xMTguMTE4IDAgMCAxLS4xMTUtLjEzNGMuMDQ1LS4zMTctLjA1Ny0uNjM3LS4yOTctLjkyNS0uNTA1LS42MS0xLjU1NS0xLjAyMi0yLjczOC0xLjA3NGE1Ljk2NiA1Ljk2NiAwIDAgMC0uNTM1LjAwMSAxNC4wMyAxNC4wMyAwIDAgMS0xLjkzNS0uMDQxLjExNy4xMTcgMCAwIDEtLjEwMy0uMDkyLjExNi4xMTYgMCAwIDEgLjA1NS0uMTI2bDgxLjEwNC00Ni44MjJhLjExNy4xMTcgMCAwIDEgLjE3MS4wN2MuMTA0LjM4MS4xMjkuNzY4LjA3NCAxLjE1My0uMDQ1LjMxNi4wNTcuNjM3LjI5Ni45MjUuNTA2LjYxIDEuNTU1IDEuMDIxIDIuNzM5IDEuMDczLjE3OC4wMDguMzU3LjAwOC41MzUtLjAwMWEuMTE3LjExNyAwIDAgMSAuMDY0LjIxOGwtNzkuMjU2IDQ1Ljc1OWEuMTE0LjExNCAwIDAgMS0uMDU5LjAxNnptLTMuNDA1LTIuMzcyYy4wODkgMCAuMTc3LjAwMi4yNjUuMDA2IDEuMjY2LjA1NiAyLjM1My40ODggMi45MDggMS4xNTguMjI3LjI3NC4zNS41NzUuMzYuODgybDc4LjY4NS00NS40MjljLS4wMzYgMC0uMDcyLS4wMDEtLjEwNy0uMDAzLTEuMjY3LS4wNTYtMi4zNTQtLjQ4OS0yLjkwOS0xLjE1OC0uMjgyLS4zNC0uNDAyLS43MjQtLjM0Ny0xLjEwN2EyLjYwNCAyLjYwNCAwIDAgMC0uMDMyLS45MUw2My44NDYgMjA4Ljk3YTEzLjkxIDEzLjkxIDAgMCAwIDEuNTI4LjAxMmMuMDk3LS4wMDUuMTk0LS4wMDcuMjkxLS4wMDd6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTIuMjA4IDE2Mi4xMzRjLTEuMDAxLTEuODI3LS4yNDEtNC4yMTcgMS42OTgtNS4zMzdsNTYuMDExLTMyLjM0NGMxLjkzOS0xLjEyIDQuMzI0LS41NDYgNS4zMjYgMS4yODFsLjIzMi40MWE5LjM0NCA5LjM0NCAwIDAgMCAxLjQ3IDIuMDIxbC4yNzguMjdjMy4zMjUgMy4yMTQgOC41ODMgMy43MTYgMTIuODg4IDEuMjNsNy4zMTktNC4yMmMxLjk0LTEuMTE5IDQuMzI0LS41NDYgNS4zMjUgMS4yODJsMy4yNSA1LjkyOC04My41MTkgNDguMjI5LTEwLjI3OC0xOC43NXonIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNMTIuNDg2IDE4MS4wMDFhLjExMi4xMTIgMCAwIDEtLjAzMS0uMDA1LjExNC4xMTQgMCAwIDEtLjA3MS0uMDU2TDIuMTA2IDE2Mi4xOWMtMS4wMzEtMS44OC0uMjQ5LTQuMzQ1IDEuNzQyLTUuNDk0bDU2LjAxLTMyLjM0NGE0LjMyOCA0LjMyOCAwIDAgMSAyLjE1OC0uNTg4YzEuNDE1IDAgMi42NS43MDIgMy4zMTEgMS44ODIuMDEuMDA4LjAxOC4wMTcuMDI0LjAyOGwuMjI3LjQxNGEuMTIyLjEyMiAwIDAgMSAuMDEzLjAzOCA5LjUwOCA5LjUwOCAwIDAgMCAxLjQzOSAxLjk1OWwuMjc1LjI2NmMxLjg0NiAxLjc4NiA0LjM0NCAyLjc2OSA3LjAzMSAyLjc2OSAxLjk3NyAwIDMuOTU0LS41MzggNS43MTctMS41NTdhLjE0OC4xNDggMCAwIDEgLjAzNS0uMDEzbDcuMjg0LTQuMjA2YTQuMzIxIDQuMzIxIDAgMCAxIDIuMTU3LS41ODhjMS40MjcgMCAyLjY3Mi43MTYgMy4zMjkgMS45MTRsMy4yNDkgNS45MjlhLjExNi4xMTYgMCAwIDEtLjA0NC4xNTdsLTgzLjUxOCA0OC4yMjlhLjExNi4xMTYgMCAwIDEtLjA1OS4wMTZ6bTQ5LjUzLTU3LjAwNGMtLjcwNCAwLTEuNDEuMTkzLTIuMDQxLjU1N2wtNTYuMDEgMzIuMzQ1Yy0xLjg4MiAxLjA4Ni0yLjYyNCAzLjQwOS0xLjY1NSA1LjE3OWwxMC4yMjEgMTguNjQ1IDgzLjMxNy00OC4xMTItMy4xOTUtNS44MjljLS42MTUtMS4xMjItMS43ODMtMS43OTItMy4xMjQtMS43OTJhNC4wOCA0LjA4IDAgMCAwLTIuMDQuNTU3bC03LjMxNyA0LjIyNWEuMTQ4LjE0OCAwIDAgMS0uMDM1LjAxMyAxMS43IDExLjcgMCAwIDEtNS44MDEgMS41NjljLTIuNzQ4IDAtNS4zMDMtMS4wMDctNy4xOTQtMi44MzVsLS4yNzgtLjI3YTkuNzE2IDkuNzE2IDAgMCAxLTEuNDk3LTIuMDQ2LjA5Ni4wOTYgMCAwIDEtLjAxMy0uMDM3bC0uMTkxLS4zNDdhLjExLjExIDAgMCAxLS4wMjMtLjAyOWMtLjYxNS0xLjEyMy0xLjc4My0xLjc5My0zLjEyNC0xLjc5M3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNNDIuNDM0IDE1NS44MDhjLTIuNTEtLjAwMS00LjY5Ny0xLjI1OC01Ljg1Mi0zLjM2NS0xLjgxMS0zLjMwNC0uNDM4LTcuNjM0IDMuMDU5LTkuNjU0bDEyLjI5MS03LjA5OGE3LjU5OSA3LjU5OSAwIDAgMSAzLjc4OS0xLjAzM2MyLjUxIDAgNC42OTcgMS4yNTggNS44NTIgMy4zNjUgMS44MTEgMy4zMDQuNDM5IDcuNjM0LTMuMDU5IDkuNjU0bC0xMi4yOTEgNy4wOThhNy42MDYgNy42MDYgMCAwIDEtMy43ODkgMS4wMzN6bTEzLjI4Ny0yMC42ODNhNy4xMjggNy4xMjggMCAwIDAtMy41NTUuOTcxbC0xMi4yOTEgNy4wOThjLTMuMjc5IDEuODkzLTQuNTczIDUuOTQyLTIuODgzIDkuMDI0IDEuMDcxIDEuOTU1IDMuMTA2IDMuMTIyIDUuNDQyIDMuMTIyYTcuMTMgNy4xMyAwIDAgMCAzLjU1Ni0uOTdsMTIuMjkxLTcuMDk4YzMuMjc5LTEuODkzIDQuNTcyLTUuOTQyIDIuODgzLTkuMDI0LTEuMDcyLTEuOTU1LTMuMTA2LTMuMTIzLTUuNDQzLTMuMTIzeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNDkuNTg4IDEwOS40MDdsNi43MzcgMy44OXYuODg3YzAgLjE3Ni4wMTMuMzYuMDM3LjU0OS4wMTEuMDgxLjAyLjE2MS4wMjguMjQyLjE0IDEuNDE1Ljk3MyAyLjk5OCAyLjEwNSAzLjk5OWw3LjM5NiA2LjU0NWMuMTc3LjE1Ni4zNTguMjk1LjU0MS40MTUgMS41NzkgMS4wNCAyLjk1LjQ2NiAzLjA2Mi0xLjI4Mi4wNDktLjc4NC4wNTctMS41OTUuMDIzLTIuNDI5bC0uMDAzLS4xNnYtMS4xNTFsMjUuOTg3IDE1LjAwM3Y1NGMwIDEuMDktLjc3IDEuNTMtMS43Mi45ODJsLTQyLjQ3My0yNC41MjNjLS45NS0uNTQ4LTEuNzItMS44NzctMS43Mi0yLjk2NnYtMzQuMDMzJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE5NC41NTMgMTkxLjI1Yy0uMjU3IDAtLjU0LS4wODUtLjgzMS0uMjUzbC00Mi40NzItMjQuNTIxYy0uOTgxLS41NjctMS43NzktMS45NDMtMS43NzktMy4wNjh2LTM0LjAzM2guMjM0djM0LjAzM2MwIDEuMDUxLjc0NSAyLjMzNiAxLjY2MSAyLjg2Nmw0Mi40NzMgMjQuNTIxYy40MjQuMjQ1LjgxNi4yODggMS4xMDMuMTIyLjI4NS0uMTY0LjQ0Mi0uNTIuNDQyLTEuMDAydi01My45MzNsLTI1Ljc1My0xNC44NjguMDAzIDEuMTA2Yy4wMzQuODMyLjAyNiAxLjY1NC0uMDI0IDIuNDM5LS4wNTQuODQ0LS4zOTYgMS40NjQtLjk2MyAxLjc0Ni0uNjE5LjMwOS0xLjQ1LjE3My0yLjI4LS4zNzNhNS4wMjMgNS4wMjMgMCAwIDEtLjU1My0uNDI2bC03LjM5Ny02LjU0NGMtMS4xNTgtMS4wMjYtMS45OTktMi42MjUtMi4xNDMtNC4wNzZhOS42MjQgOS42MjQgMCAwIDAtLjAyNy0uMjM4IDQuMjQxIDQuMjQxIDAgMCAxLS4wMzgtLjU2NHYtLjgybC02LjY4LTMuODU2LjExNy0uMjAyIDYuNzM4IDMuODkuMDU4LjAzNHYuOTU0YzAgLjE3MS4wMTIuMzUxLjAzNi41MzMuMDExLjA4My4wMjEuMTY1LjAyOS4yNDYuMTM4IDEuMzk1Ljk0OCAyLjkzNSAyLjA2NSAzLjkyM2w3LjM5NyA2LjU0NWMuMTczLjE1My4zNS4yODkuNTI3LjQwNi43NTguNDk5IDEuNTA0LjYzIDIuMDQ3LjM1OS40OS0uMjQzLjc4Ni0uNzk1LjgzNC0xLjU1MS4wNS0uNzc4LjA1Ny0xLjU5MS4wMjQtMi40MTdsLS4wMDQtLjE2M3YtMS4zNTVsLjE3NS4xIDI1Ljk4NyAxNS4wMDQuMDU5LjAzM3Y1NC4wNjhjMCAuNTY5LS4xOTguOTk2LS41NTkgMS4yMDRhMS4wMDIgMS4wMDIgMCAwIDEtLjUwNi4xMzEnIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ1LjY4NSAxNjMuMTYxbDI0LjExNSAxMy45MjItMjUuOTc4IDE0Ljk5OC0xLjQ2Mi0uMzA3Yy02LjUzNC0yLjE3LTEzLjYyOC0zLjcyOC0yMS4wMTktNC42MTYtNC4zNjUtLjUyNC04LjY2MyAxLjA5Ni05LjU5OCAzLjYyYTIuNzQ2IDIuNzQ2IDAgMCAwLS4wMTEgMS45MjhjMS41MzggNC4yNjcgNC4yMzYgOC4zNjMgNy45OTUgMTIuMTM1bC41MzIuODQ1LTI1Ljk3NyAxNC45OTctMjQuMTE1LTEzLjkyMiA3NS41MTgtNDMuNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J005NC4yODIgMjIwLjgxOGwtLjA1OS0uMDMzLTI0LjI5LTE0LjAyNC4xNzUtLjEwMSA3NS41NzctNDMuNjM0LjA1OC4wMzMgMjQuMjkgMTQuMDI0LTI2LjE5MSAxNS4xMjItLjA0NS0uMDEtMS40NjEtLjMwN2MtNi41NDktMi4xNzQtMTMuNjEzLTMuNzI1LTIxLjAwOS00LjYxNGExMy43NDQgMTMuNzQ0IDAgMCAwLTEuNjM4LS4wOTdjLTMuNzU4IDAtNy4wNTQgMS41MzEtNy44MzcgMy42NDJhMi42MiAyLjYyIDAgMCAwLS4wMSAxLjg0OGMxLjUzNSA0LjI1OCA0LjIxNiA4LjMyNiA3Ljk2OCAxMi4wOTFsLjAxNi4wMjEuNTI2LjgzNS4wMDYuMDEuMDY0LjEwMi0uMTA1LjA2MS0yNS45NzcgMTQuOTk4LS4wNTguMDMzem0tMjMuODgxLTE0LjA1N2wyMy44ODEgMTMuNzg4IDI0LjgwMi0xNC4zMmMuNTQ2LS4zMTUuODQ2LS40ODkgMS4wMTctLjU3NWwtLjQ2Ni0uNzRjLTMuNzcxLTMuNzg3LTYuNDY3LTcuODgxLTguMDEzLTEyLjE2OGEyLjg1MSAyLjg1MSAwIDAgMSAuMDExLTIuMDA4Yy44MTUtMi4xOTkgNC4yMDMtMy43OTUgOC4wNTYtMy43OTUuNTU3IDAgMS4xMTcuMDMzIDEuNjY2LjA5OSA3LjQxMi44OTEgMTQuNDkxIDIuNDQ1IDIxLjA0MSA0LjYyMS44MzYuMTc1IDEuMjE1LjI1NCAxLjM5LjMwNGwyNS43OC0xNC44ODQtMjMuODgxLTEzLjc4OC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjcuMjMgMTI1Ljk3OXY1MC44NzFsLTI3LjMyMSAxNS43NzMtNi40NjEtMTQuMTY3Yy0uOTEtMS45OTYtMy40MjgtMS43MzgtNS42MjQuNTc0YTEwLjIzOCAxMC4yMzggMCAwIDAtMi4zMyA0LjAxOGwtNi40NiAyMS42MjgtMjcuMzIyIDE1Ljc3NHYtNTAuODcxbDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTkxLjcxMiAyMjAuNTY3YS4xMjcuMTI3IDAgMCAxLS4wNTktLjAxNi4xMTguMTE4IDAgMCAxLS4wNTgtLjEwMXYtNTAuODcxYzAtLjA0Mi4wMjMtLjA4LjA1OC0uMTAxbDc1LjUxOS00My42YS4xMTcuMTE3IDAgMCAxIC4xNzUuMTAxdjUwLjg3MWMwIC4wNDEtLjAyMy4wOC0uMDU5LjFsLTI3LjMyMSAxNS43NzVhLjExOC4xMTggMCAwIDEtLjA5NC4wMS4xMi4xMiAwIDAgMS0uMDcxLS4wNjNsLTYuNDYtMTQuMTY4Yy0uMzc1LS44MjItMS4wNjItMS4yNzUtMS45MzQtMS4yNzUtMS4wODkgMC0yLjM2NC42ODYtMy41IDEuODgxYTEwLjIwNiAxMC4yMDYgMCAwIDAtMi4zMDIgMy45NzJsLTYuNDYgMjEuNjI3YS4xMTguMTE4IDAgMCAxLS4wNTQuMDY4TDkxLjc3IDIyMC41NTFhLjEyLjEyIDAgMCAxLS4wNTguMDE2em0uMTE3LTUwLjkydjUwLjYwMWwyNy4xMDYtMTUuNjUgNi40NDctMjEuNTgzYTEwLjI4NiAxMC4yODYgMCAwIDEgMi4zNTctNC4wNjVjMS4xOC0xLjI0MiAyLjUxNy0xLjk1NCAzLjY2OS0xLjk1NC45NjkgMCAxLjczMS41MDEgMi4xNDYgMS40MTFsNi40MDcgMTQuMDUxIDI3LjE1Mi0xNS42NzZ2LTUwLjYwMWwtNzUuMjg0IDQzLjQ2NnonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTY4LjU0MyAxMjYuMjEzdjUwLjg3bC0yNy4zMjIgMTUuNzc0LTYuNDYtMTQuMTY4Yy0uOTEtMS45OTUtMy40MjgtMS43MzgtNS42MjQuNTc0YTEwLjI0OCAxMC4yNDggMCAwIDAtMi4zMyA0LjAxOWwtNi40NjEgMjEuNjI3LTI3LjMyMSAxNS43NzR2LTUwLjg3bDc1LjUxOC00My42JyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTkzLjAyNSAyMjAuOGEuMTIzLjEyMyAwIDAgMS0uMDU5LS4wMTUuMTIuMTIgMCAwIDEtLjA1OC0uMTAxdi01MC44NzFjMC0uMDQyLjAyMy0uMDguMDU4LS4xMDFsNzUuNTE4LTQzLjZhLjExMi4xMTIgMCAwIDEgLjExNyAwYy4wMzYuMDIuMDU5LjA1OS4wNTkuMXY1MC44NzFhLjExNi4xMTYgMCAwIDEtLjA1OS4xMDFsLTI3LjMyMSAxNS43NzRhLjExMS4xMTEgMCAwIDEtLjA5NC4wMS4xMTUuMTE1IDAgMCAxLS4wNzEtLjA2MmwtNi40Ni0xNC4xNjhjLS4zNzUtLjgyMy0xLjA2Mi0xLjI3NS0xLjkzNS0xLjI3NS0xLjA4OCAwLTIuMzYzLjY4NS0zLjQ5OSAxLjg4MWExMC4xOSAxMC4xOSAwIDAgMC0yLjMwMiAzLjk3MWwtNi40NjEgMjEuNjI4YS4xMDguMTA4IDAgMCAxLS4wNTMuMDY3bC0yNy4zMjIgMTUuNzc1YS4xMi4xMiAwIDAgMS0uMDU4LjAxNXptLjExNy01MC45MTl2NTAuNmwyNy4xMDYtMTUuNjQ5IDYuNDQ3LTIxLjU4NGExMC4yOTMgMTAuMjkzIDAgMCAxIDIuMzU3LTQuMDY1YzEuMTc5LTEuMjQxIDIuNTE2LTEuOTU0IDMuNjY4LTEuOTU0Ljk2OSAwIDEuNzMyLjUwMiAyLjE0NyAxLjQxMmw2LjQwNyAxNC4wNTEgMjcuMTUyLTE1LjY3NnYtNTAuNjAxbC03NS4yODQgNDMuNDY2eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjkuOCAxNzcuMDgzbC0yNy4zMjIgMTUuNzc0LTYuNDYtMTQuMTY4Yy0uOTEtMS45OTUtMy40MjgtMS43MzgtNS42MjUuNTc0YTEwLjI0NiAxMC4yNDYgMCAwIDAtMi4zMjkgNC4wMTlsLTYuNDYxIDIxLjYyNy0yNy4zMjEgMTUuNzc0di01MC44N2w3NS41MTgtNDMuNnY1MC44N3onIGZpbGw9JyNGQUZBRkEnLz48cGF0aCBkPSdNOTQuMjgyIDIyMC45MTdhLjIzNC4yMzQgMCAwIDEtLjIzNC0uMjMzdi01MC44NzFjMC0uMDgzLjA0NS0uMTYxLjExNy0uMjAybDc1LjUxOC00My42MDFhLjIzNC4yMzQgMCAxIDEgLjM1LjIwMnY1MC44NzFhLjIzMy4yMzMgMCAwIDEtLjExNi4yMDJsLTI3LjMyMiAxNS43NzVhLjIzMi4yMzIgMCAwIDEtLjMyOS0uMTA2bC02LjQ2MS0xNC4xNjhjLS4zNi0uNzg5LS45OTItMS4yMDYtMS44MjgtMS4yMDYtMS4wNTYgMC0yLjMwMS42NzItMy40MTUgMS44NDRhMTAuMDk5IDEwLjA5OSAwIDAgMC0yLjI3NSAzLjkyNGwtNi40NiAyMS42MjhhLjIzNS4yMzUgMCAwIDEtLjEwNy4xMzZsLTI3LjMyMiAxNS43NzRhLjIzLjIzIDAgMCAxLS4xMTYuMDMxem0uMjMzLTUwLjk2OXY1MC4zMzFsMjYuODkxLTE1LjUyNSA2LjQzNC0yMS41MzlhMTAuNDEgMTAuNDEgMCAwIDEgMi4zODQtNC4xMTJjMS4yMDEtMS4yNjUgMi41NjktMS45OTEgMy43NTMtMS45OTEgMS4wMTggMCAxLjgxOC41MjYgMi4yNTMgMS40OGw2LjM1NCAxMy45MzQgMjYuOTgyLTE1LjU3OHYtNTAuMzMxbC03NS4wNTEgNDMuMzMxeicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xMDkuODk0IDE5OS45NDNjLTEuNzc0IDAtMy4yNDEtLjcyNS00LjI0NC0yLjEyYS4yMjQuMjI0IDAgMCAxIC4wMjMtLjI5NC4yMzMuMjMzIDAgMCAxIC4zMDEtLjAyM2MuNzguNTQ3IDEuNzA1LjgyNyAyLjc1LjgyNyAxLjMyMyAwIDIuNzU0LS40MzkgNC4yNTYtMS4zMDYgNS4zMTEtMy4wNjcgOS42MzEtMTAuNTE4IDkuNjMxLTE2LjYxMSAwLTEuOTI3LS40NDItMy41Ni0xLjI3OC00LjcyNGEuMjMyLjIzMiAwIDAgMSAuMzIzLS4zMjdjMS42NzEgMS4xNzIgMi41OTEgMy4zODEgMi41OTEgNi4yMTkgMCA2LjI0Mi00LjQyNiAxMy44NjMtOS44NjUgMTcuMDAzLTEuNTc0LjkwOC0zLjA4NCAxLjM1Ni00LjQ4OCAxLjM1NnptLTIuOTY5LTEuNTQyYy44MTMuNjUxIDEuODIuODc3IDIuOTY4Ljg3N2guMDAxYzEuMzIxIDAgMi43NTMtLjMyNyA0LjI1NC0xLjE5NCA1LjMxMS0zLjA2NyA5LjYzMi0xMC40NjMgOS42MzItMTYuNTU2IDAtMS45NzktLjQ2My0zLjU5OS0xLjMyNi00Ljc2MS40MTEgMS4wMzUuNjI1IDIuMjc1LjYyNSAzLjYzNSAwIDYuMjQzLTQuNDI2IDEzLjg4My05Ljg2NSAxNy4wMjMtMS41NzQuOTA5LTMuMDg0IDEuMzE3LTQuNDkgMS4zMTctLjY0MSAwLTEuMjQzLS4xNDktMS43OTktLjM0MXonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTEzLjA5NyAxOTcuMjNjNS4zODQtMy4xMDggOS43NDgtMTAuNjM2IDkuNzQ4LTE2LjgxNCAwLTIuMDUxLS40ODMtMy42OTItMS4zMjMtNC44Ni0xLjc4NC0xLjI1Mi00LjM3NC0xLjE5NC03LjI1Ny40Ny01LjM4NCAzLjEwOC05Ljc0OCAxMC42MzYtOS43NDggMTYuODE0IDAgMi4wNTEuNDgzIDMuNjkyIDEuMzIzIDQuODYgMS43ODQgMS4yNTIgNC4zNzQgMS4xOTQgNy4yNTctLjQ3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTEwOC43MjQgMTk4LjYxNGMtMS4xNDIgMC0yLjE1OC0uMjEzLTMuMDE5LS44MTctLjAyMS0uMDE0LS4wNC4wMTQtLjA1NS0uMDA3LS44OTQtMS4yNDQtMS4zNjctMi45NDgtMS4zNjctNC45NzMgMC02LjI0MiA0LjQyNi0xMy44NjQgOS44NjUtMTcuMDA1IDEuNTc0LS45MDggMy4wODQtMS4zNjMgNC40OS0xLjM2MyAxLjE0MiAwIDIuMTU4LjMwOSAzLjAxOC45MTNhLjIzLjIzIDAgMCAxIC4wNTYuMDU2Yy44OTQgMS4yNDQgMS4zNjcgMi45NzIgMS4zNjcgNC45OTcgMCA2LjI0My00LjQyNiAxMy43ODMtOS44NjUgMTYuOTIzLTEuNTc0LjkwOS0zLjA4NCAxLjI3Ni00LjQ5IDEuMjc2em0tMi43MTgtMS4xMDljLjc3NC41MzIgMS42ODguNzc2IDIuNzE4Ljc3NiAxLjMyMyAwIDIuNzU0LS40MTMgNC4yNTYtMS4yOCA1LjMxMS0zLjA2NiA5LjYzMS0xMC41MDUgOS42MzEtMTYuNTk4IDAtMS45MDktLjQzNC0zLjUyMy0xLjI1NS00LjY4NS0uNzc0LS41MzMtMS42ODgtLjc5OS0yLjcxOC0uNzk5LTEuMzIzIDAtMi43NTUuNDQxLTQuMjU2IDEuMzA4LTUuMzExIDMuMDY2LTkuNjMxIDEwLjUwNi05LjYzMSAxNi41OTkgMCAxLjkwOS40MzQgMy41MTcgMS4yNTUgNC42Nzl6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTE0OS4zMTggMTE0LjI2MmwtOS45ODQgOC44NzggMTUuODkzIDExLjAzMSA1LjU4OS02LjExMi0xMS40OTgtMTMuNzk3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE2OS42NzYgMTIwLjg0bC05Ljc0OCA1LjYyN2MtMy42NDIgMi4xMDMtOS41MjggMi4xMTMtMTMuMTQ3LjAyNC0zLjYyLTIuMDg5LTMuNjAxLTUuNDg4LjA0MS03LjU5MWw5LjQ5NS01LjYwOC02LjcyOS0zLjg4NS04MS44MzYgNDcuMDcxIDQ1LjkyMyAyNi41MTQgMy4wODEtMS43NzljLjYzMS0uMzY1Ljg2OS0uODk4LjYxOC0xLjM5LTIuMzU3LTQuNjMyLTIuNTkzLTkuNTQ2LS42ODMtMTQuMjYyIDUuNjM4LTEzLjkyIDI0LjUwOS0yNC44MTUgNDguNjE4LTI4LjA3IDguMTY5LTEuMTAzIDE2LjY4LS45NjcgMjQuNzA0LjM5NC44NTIuMTQ1IDEuNzc2LjAwOCAyLjQwNy0uMzU3bDMuMDgxLTEuNzc4LTI1LjgyNS0xNC45MScgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xMTMuNjc1IDE4My40NTlhLjQ3LjQ3IDAgMCAxLS4yMzMtLjA2MmwtNDUuOTI0LTI2LjUxNWEuNDY4LjQ2OCAwIDAgMSAuMDAxLS44MDlsODEuODM2LTQ3LjA3MWEuNDY3LjQ2NyAwIDAgMSAuNDY2IDBsNi43MjkgMy44ODVhLjQ2Ny40NjcgMCAwIDEtLjQ2Ny44MDlsLTYuNDk2LTMuNzUtODAuOSA0Ni41MzMgNDQuOTg4IDI1Ljk3MyAyLjg0OC0xLjY0NGMuMTkyLS4xMTEuNjItLjQwOS40MzUtLjc3My0yLjQxNi00Ljc0OC0yLjY1OC05LjgxNC0uNy0xNC42NSAyLjgwNi02LjkyNyA4Ljg4NS0xMy4yNDIgMTcuNTgyLTE4LjI2MyA4LjY1Ny00Ljk5OCAxOS41MTgtOC40ODkgMzEuNDA3LTEwLjA5NCA4LjE5OC0xLjEwNyAxNi43OS0uOTcgMjQuODQ0LjM5Ny43MzkuMTI1IDEuNTYxLjAwNyAyLjA5NS0uMzAxbDIuMzgxLTEuMzc0LTI1LjEyNS0xNC41MDZhLjQ2Ny40NjcgMCAwIDEgLjQ2Ny0uODA5bDI1LjgyNSAxNC45MWEuNDY3LjQ2NyAwIDAgMSAwIC44MDlsLTMuMDgxIDEuNzc5Yy0uNzIxLjQxNy0xLjc2My41NzUtMi43MTguNDEzLTcuOTYzLTEuMzUxLTE2LjQ1Ny0xLjQ4Ni0yNC41NjMtLjM5Mi0xMS43NyAxLjU4OS0yMi41MTIgNS4wMzktMzEuMDY1IDkuOTc3LTguNTE0IDQuOTE2LTE0LjQ1NiAxMS4wNzMtMTcuMTgzIDE3LjgwNS0xLjg1NCA0LjU3OC0xLjYyMyA5LjM3Ni42NjYgMTMuODc1LjM3LjcyNS4wNTUgMS41MTMtLjggMi4wMDZsLTMuMDgxIDEuNzhhLjQ3Ni40NzYgMCAwIDEtLjIzNC4wNjInIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNMTUzLjMxNiAxMjguMjc5Yy0yLjQxMyAwLTQuODIxLS41MjgtNi42NTItMS41ODYtMS44MTgtMS4wNDktMi44Mi0yLjQ2MS0yLjgyLTMuOTc1IDAtMS41MjcgMS4wMTYtMi45NTUgMi44NjEtNC4wMmw5LjQ5My01LjYwN2EuMjMzLjIzMyAwIDEgMSAuMjM4LjQwMmwtOS40OTYgNS42MDljLTEuNjk2Ljk3OS0yLjYyOCAyLjI2My0yLjYyOCAzLjYxNiAwIDEuMzQuOTE4IDIuNjA4IDIuNTg1IDMuNTcxIDMuNTQ5IDIuMDQ5IDkuMzQzIDIuMDM4IDEyLjkxNC0uMDI0bDkuNzQ4LTUuNjI4YS4yMzQuMjM0IDAgMCAxIC4yMzQuNDA1bC05Ljc0OCA1LjYyOGMtMS44NTggMS4wNzItNC4yOTYgMS42MDktNi43MjkgMS42MDknIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTEzLjY3NSAxODIuOTkybC00NS45MTMtMjYuNTA4TTExMy42NzUgMTgzLjM0MmEuMzQ2LjM0NiAwIDAgMS0uMTc1LS4wNDdsLTQ1LjkxMy0yNi41MDhhLjM1LjM1IDAgMSAxIC4zNS0uNjA3bDQ1LjkxMyAyNi41MDhhLjM1LjM1IDAgMCAxLS4xNzUuNjU0JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTY3Ljc2MiAxNTYuNDg0djU0LjAwMWMwIDEuMDkuNzcgMi40MTggMS43MiAyLjk2N2w0Mi40NzMgMjQuNTIxYy45NS41NDkgMS43Mi4xMSAxLjcyLS45OHYtNTQuMDAxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTExMi43MjcgMjM4LjU2MWMtLjI5NyAwLS42Mi0uMDk1LS45NDctLjI4NWwtNDIuNDczLTI0LjUyMWMtMS4wNjMtLjYxMy0xLjg5NS0yLjA1LTEuODk1LTMuMjd2LTU0LjAwMWEuMzUuMzUgMCAxIDEgLjcwMSAwdjU0LjAwMWMwIC45Ni43MDcgMi4xOCAxLjU0NCAyLjY2M2w0Mi40NzMgMjQuNTIyYy4zNDQuMTk4LjY2MS4yNDMuODcuMTIyLjIwNi0uMTE5LjMyNS0uNDExLjMyNS0uNzk5di01NC4wMDFhLjM1LjM1IDAgMSAxIC43IDB2NTQuMDAxYzAgLjY1NS0uMjM5IDEuMTU0LS42NzUgMS40MDZhMS4yMzUgMS4yMzUgMCAwIDEtLjYyMy4xNjInIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNMTEyLjg2IDE0Ny41MTJoLS4wMDFjLTIuMzE4IDAtNC40OTktLjUyMi02LjE0Mi0xLjQ3MS0xLjcwNS0uOTg0LTIuNjQzLTIuMzE1LTIuNjQzLTMuNzQ5IDAtMS40NDUuOTUyLTIuNzkxIDIuNjgtMy43ODhsMTIuMDQxLTYuOTUzYzEuNjY4LS45NjIgMy44NzQtMS40OTMgNi4yMTItMS40OTMgMi4zMTggMCA0LjQ5OS41MjMgNi4xNDMgMS40NzIgMS43MDQuOTg0IDIuNjQzIDIuMzE1IDIuNjQzIDMuNzQ4IDAgMS40NDYtLjk1MiAyLjc5MS0yLjY4IDMuNzg5bC0xMi4wNDIgNi45NTJjLTEuNjY4Ljk2My0zLjg3NCAxLjQ5My02LjIxMSAxLjQ5M3ptMTIuMTQ3LTE2Ljc1M2MtMi4yMTcgMC00LjI5OC40OTctNS44NjEgMS4zOTlsLTEyLjA0MiA2Ljk1MmMtMS41MDIuODY4LTIuMzMgMS45OTgtMi4zMyAzLjE4MiAwIDEuMTczLjgxNSAyLjI4OSAyLjI5MyAzLjE0MiAxLjUzOC44ODkgMy41OTYgMS4zNzggNS43OTIgMS4zNzhoLjAwMWMyLjIxNiAwIDQuMjk4LS40OTcgNS44NjEtMS4zOTlsMTIuMDQxLTYuOTUzYzEuNTAyLS44NjcgMi4zMy0xLjk5NyAyLjMzLTMuMTgyIDAtMS4xNzItLjgxNC0yLjI4OC0yLjI5Mi0zLjE0Mi0xLjUzOS0uODg4LTMuNTk2LTEuMzc3LTUuNzkzLTEuMzc3eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNjUuNjMgMTIzLjIxOWwtNS43MzQgMy4zMTFjLTMuMTY3IDEuODI4LTguMjg2IDEuODM3LTExLjQzMy4wMi0zLjE0Ny0xLjgxNy0zLjEzMS00Ljc3Mi4wMzYtNi42MDFsNS43MzQtMy4zMSAxMS4zOTcgNi41OCcgZmlsbD0nI0ZBRkFGQScvPjxwYXRoIGQ9J00xNTQuMjMzIDExNy40NDhsOS45OTUgNS43NzEtNC42ODIgMi43MDRjLTEuNDM0LjgyNy0zLjM1MiAxLjI4My01LjM5OSAxLjI4My0yLjAyOSAwLTMuOTIzLS40NDktNS4zMzMtMS4yNjMtMS4yOS0uNzQ0LTItMS42OTQtMi0yLjY3NCAwLS45OTEuNzIzLTEuOTU1IDIuMDM2LTIuNzEzbDUuMzgzLTMuMTA4bTAtLjgwOWwtNS43MzQgMy4zMWMtMy4xNjcgMS44MjktMy4xODMgNC43ODQtLjAzNiA2LjYwMSAxLjU2OC45MDUgMy42MjMgMS4zNTcgNS42ODQgMS4zNTcgMi4wNzcgMCA0LjE1OS0uNDYgNS43NDktMS4zNzdsNS43MzQtMy4zMTEtMTEuMzk3LTYuNThNMTQ1LjQ0NSAxNzkuNjY3Yy0xLjc3MyAwLTMuMjQxLS44NS00LjI0My0yLjI0NS0uMDY3LS4wOTItLjA1Ny0uMjc1LjAyMy0uMzU2LjA4LS4wODEuMjA3LS4xMi4zLS4wNTUuNzgxLjU0OCAxLjcwNi44MTIgMi43NTEuODExIDEuMzIyIDAgMi43NTQtLjQ0NiA0LjI1Ni0xLjMxMyA1LjMxLTMuMDY2IDkuNjMxLTEwLjUyMiA5LjYzMS0xNi42MTUgMC0xLjkyNy0uNDQyLTMuNTYyLTEuMjc5LTQuNzI2YS4yMzUuMjM1IDAgMCAxIC4wMjQtLjMwMS4yMzIuMjMyIDAgMCAxIC4zLS4wMjdjMS42NyAxLjE3MiAyLjU5IDMuMzggMi41OSA2LjIxOSAwIDYuMjQyLTQuNDI1IDEzLjk4Ny05Ljg2NSAxNy4xMjctMS41NzMuOTA4LTMuMDgzIDEuNDgxLTQuNDg4IDEuNDgxek0xNDIuNDc2IDE3OGMuODE0LjY1MSAxLjgyIDEuMDAyIDIuOTY5IDEuMDAyIDEuMzIyIDAgMi43NTMtLjQ1MiA0LjI1NS0xLjMyIDUuMzEtMy4wNjUgOS42MzEtMTAuNTIzIDkuNjMxLTE2LjYxNyAwLTEuOTgtLjQ2My0zLjYzLTEuMzI1LTQuNzkzLjQxMSAxLjAzNS42MjQgMi4yNi42MjQgMy42MiAwIDYuMjQyLTQuNDI1IDEzLjg3NS05Ljg2NSAxNy4wMTUtMS41NzMuOTA5LTMuMDg0IDEuMzc2LTQuNDg5IDEuMzc2YTUuNDkgNS40OSAwIDAgMS0xLjgtLjI4M3onIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNMTQ4LjY0OCAxNzYuNzA0YzUuMzg0LTMuMTA4IDkuNzQ4LTEwLjYzNiA5Ljc0OC0xNi44MTMgMC0yLjA1Mi0uNDgzLTMuNjkzLTEuMzIyLTQuODYxLTEuNzg1LTEuMjUyLTQuMzc1LTEuMTk0LTcuMjU4LjQ3MS01LjM4MyAzLjEwOC05Ljc0OCAxMC42MzYtOS43NDggMTYuODEzIDAgMi4wNTEuNDg0IDMuNjkyIDEuMzIzIDQuODYgMS43ODUgMS4yNTMgNC4zNzQgMS4xOTUgNy4yNTctLjQ3JyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTE0NC4yNzYgMTc4LjI3NmMtMS4xNDMgMC0yLjE1OC0uMzA3LTMuMDE5LS45MTFhLjIxNy4yMTcgMCAwIDEtLjA1NS0uMDU0Yy0uODk1LTEuMjQ0LTEuMzY3LTIuOTcyLTEuMzY3LTQuOTk3IDAtNi4yNDEgNC40MjUtMTMuODc1IDkuODY1LTE3LjAxNiAxLjU3My0uOTA4IDMuMDg0LTEuMzY5IDQuNDg5LTEuMzY5IDEuMTQzIDAgMi4xNTguMzA3IDMuMDE5LjkxYS4yNC4yNCAwIDAgMSAuMDU1LjA1NWMuODk0IDEuMjQ0IDEuMzY3IDIuOTcxIDEuMzY3IDQuOTk3IDAgNi4yNDEtNC40MjUgMTMuODc1LTkuODY1IDE3LjAxNi0xLjU3My45MDgtMy4wODQgMS4zNjktNC40ODkgMS4zNjl6bS0yLjcxOC0xLjE3MmMuNzczLjUzMyAxLjY4Ny45MDEgMi43MTguOTAxIDEuMzIyIDAgMi43NTQtLjUzOCA0LjI1Ni0xLjQwNSA1LjMxLTMuMDY2IDkuNjMxLTEwLjU2NyA5LjYzMS0xNi42NjEgMC0xLjkwOC0uNDM0LTMuNTU0LTEuMjU2LTQuNzE2LS43NzQtLjUzMi0xLjY4OC0uODE0LTIuNzE4LS44MTQtMS4zMjIgMC0yLjc1NC40MzMtNC4yNTYgMS4zLTUuMzEgMy4wNjYtOS42MzEgMTAuNTY0LTkuNjMxIDE2LjY1NyAwIDEuOTEuNDM0IDMuNTc2IDEuMjU2IDQuNzM4eicgZmlsbD0nIzYwN0Q4QicvPjxwYXRoIGQ9J00xNTAuNzIgMTcyLjM2MWwtLjM2My0uMjk1YTI0LjEwNSAyNC4xMDUgMCAwIDAgMi4xNDgtMy4xMjggMjQuMDUgMjQuMDUgMCAwIDAgMS45NzctNC4zNzVsLjQ0My4xNDlhMjQuNTQgMjQuNTQgMCAwIDEtMi4wMTUgNC40NiAyNC42MSAyNC42MSAwIDAgMS0yLjE5IDMuMTg5TTExNS45MTcgMTkxLjUxNGwtLjM2My0uMjk0YTI0LjE3NCAyNC4xNzQgMCAwIDAgMi4xNDgtMy4xMjggMjQuMDM4IDI0LjAzOCAwIDAgMCAxLjk3Ni00LjM3NWwuNDQzLjE0OGEyNC40OCAyNC40OCAwIDAgMS0yLjAxNSA0LjQ2MSAyNC42NjIgMjQuNjYyIDAgMCAxLTIuMTg5IDMuMTg4TTExNCAyMzcuNDc2VjE4Mi41ODQgMjM3LjQ3NicgZmlsbD0nIzYwN0Q4QicvPjxnPjxwYXRoIGQ9J004MS44MjIgMzcuNDc0Yy4wMTctLjEzNS0uMDc1LS4yOC0uMjY3LS4zOTItLjMyNy0uMTg4LS44MjYtLjIxLTEuMTA5LS4wNDVsLTYuMDEyIDMuNDcxYy0uMTMxLjA3Ni0uMTk0LjE3OC0uMTkxLjI4NS4wMDIuMTMyLjAwMi40NjEuMDAyLjU3OHYuMDQzbC0uMDA3LjEyOC02LjU5MSAzLjc3OWMtLjAwMSAwLTIuMDc3IDEuMDQ2LTIuNzg3IDUuMTkyIDAgMC0uOTEyIDYuOTYxLS44OTggMTkuNzQ1LjAxNSAxMi41Ny42MDYgMTcuMDcgMS4xNjcgMjEuMzUxLjIyIDEuNjg0IDMuMDAxIDIuMTI1IDMuMDAxIDIuMTI1LjMzMS4wNC42OTgtLjAyNyAxLjA4LS4yNDhsNzUuMjczLTQzLjU1MWMxLjgwOC0xLjA2OSAyLjY2Ny0zLjcxOSAzLjA1Ni02LjI4NCAxLjIxMy03Ljk5IDEuNjc1LTMyLjk3OC0uMjc1LTM5Ljg3OC0uMTk2LS42OTMtLjUxLTEuMDgzLS44NjgtMS4yODJsLTIuMDg2LS43OWMtLjcyNy4wMjgtMS40MTYuNDY3LTEuNTM0LjUzNUw4Mi4wMzIgMzcuMDcybC0uMjEuNDAyJyBmaWxsPScjRkZGJy8+PHBhdGggZD0nTTE0NC4zMTEgMS43MDFsMi4wODUuNzljLjM1OC4xOTkuNjcyLjU4OS44NjggMS4yODIgMS45NDkgNi45IDEuNDg3IDMxLjg4Ny4yNzUgMzkuODc4LS4zOSAyLjU2NS0xLjI0OSA1LjIxNS0zLjA1NiA2LjI4NEw2OS4yMSA5My40ODZhMS43OCAxLjc4IDAgMCAxLS44OTYuMjU4bC0uMTgzLS4wMTFjMCAuMDAxLTIuNzgyLS40NC0zLjAwMy0yLjEyNC0uNTYtNC4yODItMS4xNTEtOC43ODEtMS4xNjUtMjEuMzUxLS4wMTUtMTIuNzg0Ljg5Ny0xOS43NDUuODk3LTE5Ljc0NS43MS00LjE0NiAyLjc4Ny01LjE5MiAyLjc4Ny01LjE5Mmw2LjU5MS0zLjc3OS4wMDctLjEyOHYtLjA0M2MwLS4xMTcgMC0uNDQ2LS4wMDItLjU3OC0uMDAzLS4xMDcuMDU5LS4yMS4xOTEtLjI4NWw2LjAxMi0zLjQ3MmEuOTguOTggMCAwIDEgLjQ4MS0uMTFjLjIxOCAwIC40NDkuMDUzLjYyNy4xNTYuMTkzLjExMi4yODUuMjU4LjI2OC4zOTJsLjIxMS0uNDAyIDYwLjc0NC0zNC44MzZjLjExNy0uMDY4LjgwNi0uNTA3IDEuNTM0LS41MzVtMC0uOTk3bC0uMDM5LjAwMWMtLjYxOC4wMjMtMS4yODMuMjQ0LTEuOTc0LjY1NmwtLjAyMS4wMTItNjAuNTE5IDM0LjcwNmEyLjM1OCAyLjM1OCAwIDAgMC0uODMxLS4xNWMtLjM2NSAwLS43MDQuMDg0LS45OC4yNDRsLTYuMDEyIDMuNDcxYy0uNDQyLjI1NS0uNjk5LjY5LS42ODkgMS4xNjZsLjAwMS4xNS02LjA4IDMuNDg3Yy0uMzczLjE5OS0yLjU0MiAxLjUzMS0zLjI5IDUuODk4bC0uMDA2LjAzOWMtLjAwOS4wNy0uOTIgNy4xNzMtLjkwNiAxOS44NzUuMDE0IDEyLjYyLjYwMyAxNy4xMTYgMS4xNzIgMjEuNDY1bC4wMDIuMDE1Yy4zMDggMi4zNTUgMy40NzUgMi45MjMgMy44MzYgMi45OGwuMDM0LjAwNGMuMTAxLjAxMy4yMDQuMDE5LjMwNS4wMTlhMi43NyAyLjc3IDAgMCAwIDEuMzk2LS4zOTJsNzUuMjczLTQzLjU1MmMxLjgxMS0xLjA3MSAyLjk5OS0zLjQyMyAzLjU0Mi02Ljk5NyAxLjE4Ni03LjgxNCAxLjczNC0zMy4wOTYtLjMwMS00MC4yOTktLjI1My0uODkzLS43MDQtMS41MjctMS4zNDMtMS44ODJsLS4xMzItLjA2Mi0yLjA4NS0uNzg5YS45NzMuOTczIDAgMCAwLS4zNTMtLjA2NScgZmlsbD0nIzQ1NUE2NCcvPjxwYXRoIGQ9J00xMjguMjY3IDExLjU2NWwxLjQ5NS40MzQtNTYuMzM5IDMyLjMyNicgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J003NC4yMDIgOTAuNTQ1YS41LjUgMCAwIDEtLjI1LS45MzFsMTguNDM3LTEwLjY0NWEuNDk5LjQ5OSAwIDEgMSAuNDk5Ljg2NEw3NC40NTEgOTAuNDc4bC0uMjQ5LjA2N003NS43NjQgNDIuNjU0bC0uMTA4LS4wNjIuMDQ2LS4xNzEgNS4xMzUtMi45NjQuMTcuMDQ1LS4wNDUuMTcxLTUuMTM1IDIuOTY0LS4wNjMuMDE3TTcwLjUyIDkwLjM3NVY0Ni40MjFsLjA2My0uMDM2TDEzNy44NCA3LjU1NHY0My45NTRsLS4wNjIuMDM2TDcwLjUyIDkwLjM3NXptLjI1LTQzLjgxMXY0My4zOGw2Ni44MjEtMzguNTc5VjcuOTg1TDcwLjc3IDQ2LjU2NHonIGZpbGw9JyM2MDdEOEInLz48cGF0aCBkPSdNODYuOTg2IDgzLjE4MmMtLjIzLjE0OS0uNjEyLjM4NC0uODQ5LjUyM2wtMTEuNTA1IDYuNzAxYy0uMjM3LjEzOS0uMjA2LjI1Mi4wNjguMjUyaC41NjVjLjI3NSAwIC42OTMtLjExMy45My0uMjUyTDg3LjcgODMuNzA1Yy4yMzctLjEzOS40MjgtLjI1My40MjUtLjI1NmExMS4yOSAxMS4yOSAwIDAgMS0uMDA2LS41MDNjMC0uMjc0LS4xODgtLjM3Ny0uNDE4LS4yMjdsLS43MTUuNDYzJyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTc1LjI2NiA5MC43ODJINzQuN2MtLjIgMC0uMzE2LS4wNTYtLjM0Ni0uMTY2LS4wMy0uMTEuMDQzLS4yMTcuMjE1LS4zMTdsMTEuNTA1LTYuNzAyYy4yMzYtLjEzOC42MTUtLjM3MS44NDQtLjUxOWwuNzE1LS40NjRhLjQ4OC40ODggMCAwIDEgLjI2Ni0uMDg5Yy4xNzIgMCAuMzQ1LjEzLjM0NS40MjEgMCAuMjE0LjAwMS4zNjMuMDAzLjQzN2wuMDA2LjAwNC0uMDA0LjA2OWMtLjAwMy4wNzUtLjAwMy4wNzUtLjQ4Ni4zNTZsLTExLjUwNSA2LjcwMmEyLjI4MiAyLjI4MiAwIDAgMS0uOTkyLjI2OHptLS42LS4yNWwuMDM0LjAwMWguNTY2Yy4yNTIgMCAuNjQ5LS4xMDguODY2LS4yMzRsMTEuNTA1LTYuNzAyYy4xNjgtLjA5OC4yOTQtLjE3My4zNjEtLjIxNC0uMDA0LS4wODQtLjAwNC0uMjE4LS4wMDQtLjQzN2wtLjA5NS0uMTcxLS4xMzEuMDQ5LS43MTQuNDYzYy0uMjMyLjE1LS42MTYuMzg2LS44NTQuNTI1bC0xMS41MDUgNi43MDItLjAyOS4wMTh6JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTc1LjI2NiA4OS44NzFINzQuN2MtLjIgMC0uMzE2LS4wNTYtLjM0Ni0uMTY2LS4wMy0uMTEuMDQzLS4yMTcuMjE1LS4zMTdsMTEuNTA1LTYuNzAyYy4yNTgtLjE1MS42OTQtLjI2OC45OTMtLjI2OGguNTY1Yy4yIDAgLjMxNi4wNTYuMzQ2LjE2Ni4wMy4xMS0uMDQzLjIxNy0uMjE1LjMxN2wtMTEuNTA1IDYuNzAyYTIuMjgyIDIuMjgyIDAgMCAxLS45OTIuMjY4em0tLjYtLjI1bC4wMzQuMDAxaC41NjZjLjI1MiAwIC42NDktLjEwNy44NjYtLjIzNGwxMS41MDUtNi43MDIuMDMtLjAxOC0uMDM1LS4wMDFoLS41NjVjLS4yNTIgMC0uNjQ5LjEwOC0uODY3LjIzNGwtMTEuNTA1IDYuNzAyLS4wMjkuMDE4ek03NC4zNyA5MC44MDF2LTEuMjQ3IDEuMjQ3JyBmaWxsPScjNjA3RDhCJy8+PHBhdGggZD0nTTY4LjEzIDkzLjkwMWMtLjc1MS0uMDkzLTEuMzE0LS43MzctMS40MzktMS4zNzYtLjgzMS00LjIzOC0xLjE1MS04Ljc4Mi0xLjE2NS0yMS4zNTItLjAxNS0xMi43ODQuODk3LTE5Ljc0NS44OTctMTkuNzQ1LjcxMS00LjE0NiAyLjc4Ny01LjE5MiAyLjc4Ny01LjE5Mmw3NC44NTktNDMuMjE5Yy4yMjMtLjEyOSAyLjQ4Ny0xLjU4NCAzLjE5NS45MjMgMS45NSA2LjkgMS40ODggMzEuODg3LjI3NSAzOS44NzgtLjM4OSAyLjU2NS0xLjI0OCA1LjIxNS0zLjA1NiA2LjI4M0w2OS4yMSA5My42NTNjLS4zODIuMjIxLS43NDkuMjg4LTEuMDguMjQ4IDAgMC0yLjc4MS0uNDQxLTMuMDAxLTIuMTI1LS41NjEtNC4yODEtMS4xNTItOC43ODEtMS4xNjctMjEuMzUxLS4wMTQtMTIuNzg0Ljg5OC0xOS43NDUuODk4LTE5Ljc0NS43MS00LjE0NiAyLjc4Ny01LjE5MSAyLjc4Ny01LjE5MWw2LjU5OC0zLjgxLjg3MS0uMTE5IDYuNTk5LTMuODMuMDQ2LS40NjFMNjguMTMgOTMuOTAxJyBmaWxsPScjRkFGQUZBJy8+PHBhdGggZD0nTTY4LjMxNyA5NC4xNjFsLS4yMTUtLjAxM2gtLjAwMWwtLjI0NC0uMDQ3Yy0uNzE5LS4xNTYtMi43NzItLjczNi0yLjk3Ni0yLjI5Mi0uNTY4LTQuMzQtMS4xNTQtOC44MTMtMS4xNjgtMjEuMzg0LS4wMTQtMTIuNjU0Ljg5MS0xOS43MDcuOS0xOS43NzcuNzI1LTQuMjMxIDIuODMyLTUuMzM4IDIuOTIyLTUuMzgybDYuNjI4LTMuODI3Ljg3LS4xMTkgNi40NDYtMy43NDIuMDM0LS4zMzRhLjI0OC4yNDggMCAwIDEgLjI3My0uMjIzLjI0OC4yNDggMCAwIDEgLjIyMy4yNzJsLS4wNTkuNTg5LTYuNzUyIDMuOTE5LS44Ny4xMTgtNi41NTYgMy43ODVjLS4wMzEuMDE2LTEuOTkgMS4wNjgtMi42NjYgNS4wMTgtLjAwNy4wNi0uOTA4IDcuMDg2LS44OTQgMTkuNzAyLjAxNCAxMi41MzkuNTk3IDE2Ljk5NiAxLjE2MSAyMS4zMDUuMDkxLjY5MS42ODkgMS4xNTQgMS4zMDkgMS40NTJhMS45NSAxLjk1IDAgMCAxLS4yMzYtLjYwOWMtLjc4MS0zLjk4NC0xLjE1NS04LjIwMi0xLjE3LTIxLjM5OS0uMDE0LTEyLjY1My44OTEtMTkuNzA3LjktMTkuNzc3LjcyNS00LjIzMSAyLjgzMi01LjMzNyAyLjkyMi01LjM4Mi0uMDA0LjAwMSA3NC40NDQtNDIuOTggNzQuODQ2LTQzLjIxMmwuMDI4LS4wMTdjLjkwNC0uNTM4IDEuNzItLjY4OCAyLjM2LS40MzMuNTU1LjIyMS45NDkuNzMzIDEuMTcyIDEuNTIgMi4wMTQgNy4xMjggMS40NiAzMi4yMTkuMjgxIDM5Ljk4My0uNTA3IDMuMzQxLTEuNTc1IDUuNTE1LTMuMTc1IDYuNDYyTDY5LjMzNSA5My44NjlhMi4wMjMgMi4wMjMgMCAwIDEtMS4wMTguMjkyem0tLjE0Ny0uNTA3Yy4yOTMuMDM2LjYwNC0uMDM3LjkxNS0uMjE3bDc1LjI3My00My41NTFjMS44MjMtMS4wNzggMi42MDItMy45MTUgMi45MzQtNi4xMDYgMS4xNzQtNy43MzEgMS43MzEtMzIuNjk1LS4yNjgtMzkuNzcyLS4xNzgtLjYzMS0uNDczLTEuMDMyLS44NzYtMS4xOTItLjQ4NC0uMTkzLTEuMTY2LS4wNTItMS45MjEuMzk3bC0uMDM0LjAyMS03NC44NTggNDMuMjE4Yy0uMDMxLjAxNy0xLjk4OSAxLjA2OS0yLjY2NiA1LjAxOS0uMDA3LjA1OS0uOTA4IDcuMDg1LS44OTQgMTkuNzAyLjAxNSAxMy4xNTUuMzg2IDE3LjM1MSAxLjE2MSAyMS4zMDMuMDkuNDYxLjQ3Ni45ODMgMS4wMzcgMS4xMzkuMTE0LjAyNS4xODUuMDM3LjE5Ni4wMzloLjAwMXonIGZpbGw9JyM0NTVBNjQnLz48cGF0aCBkPSdNNjkuMzE3IDY4Ljk4MmMuNDg5LS4yODEuODg1LS4wNTYuODg1LjUwNSAwIC41Ni0uMzk2IDEuMjQzLS44ODUgMS41MjUtLjQ4OC4yODItLjg4NC4wNTctLjg4NC0uNTA0IDAtLjU2LjM5Ni0xLjI0My44ODQtMS41MjYnIGZpbGw9JyNGRkYnLz48cGF0aCBkPSdNNjguOTIgNzEuMTMzYy0uMjg5IDAtLjQ4Ny0uMjI4LS40ODctLjYyNSAwLS41Ni4zOTYtMS4yNDMuODg0LTEuNTI2YS44MTIuODEyIDAgMCAxIC4zOTctLjEyMWMuMjg5IDAgLjQ4OC4yMjkuNDg4LjYyNiAwIC41Ni0uMzk2IDEuMjQzLS44ODUgMS41MjVhLjgxMi44MTIgMCAwIDEtLjM5Ny4xMjFtLjc5NC0yLjQ1OWEuOTc2Ljk3NiAwIDAgMC0uNDkuMTQ3Yy0uNTQ4LjMxNy0uOTc4IDEuMDU4LS45NzggMS42ODcgMCAuNDg2LjI3MS44MTIuNjc0LjgxMmEuOTg1Ljk4NSAwIDAgMCAuNDkxLS4xNDZjLjU0OC0uMzE3Ljk3OC0xLjA1Ny45NzgtMS42ODcgMC0uNDg2LS4yNzItLjgxMy0uNjc1LS44MTMnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNNjguOTIgNzAuOTQ3Yy0uMjcxIDAtLjI5OS0uMzA3LS4yOTktLjQzOSAwLS40OTEuMzYxLTEuMTE2Ljc5LTEuMzYzYS42MzIuNjMyIDAgMCAxIC4zMDMtLjA5NmMuMjcyIDAgLjMwMS4zMDYuMzAxLjQzOCAwIC40OTEtLjM2MyAxLjExNi0uNzkxIDEuMzY0YS42MjkuNjI5IDAgMCAxLS4zMDQuMDk2bS43OTQtMi4wODZhLjgxMi44MTIgMCAwIDAtLjM5Ny4xMjFjLS40ODguMjgzLS44ODQuOTY2LS44ODQgMS41MjYgMCAuMzk3LjE5OC42MjUuNDg3LjYyNWEuODEyLjgxMiAwIDAgMCAuMzk3LS4xMjFjLjQ4OS0uMjgyLjg4NS0uOTY1Ljg4NS0xLjUyNSAwLS4zOTctLjE5OS0uNjI2LS40ODgtLjYyNicgZmlsbD0nIzgwOTdBMicvPjxwYXRoIGQ9J002OS40NDQgODUuMzVjLjI2NC0uMTUyLjQ3Ny0uMDMxLjQ3Ny4yNzIgMCAuMzAzLS4yMTMuNjctLjQ3Ny44MjItLjI2My4xNTMtLjQ3Ny4wMzEtLjQ3Ny0uMjcxIDAtLjMwMi4yMTQtLjY3MS40NzctLjgyMycgZmlsbD0nI0ZGRicvPjxwYXRoIGQ9J002OS4yMyA4Ni41MWMtLjE1NiAwLS4yNjMtLjEyMy0uMjYzLS4zMzcgMC0uMzAyLjIxNC0uNjcxLjQ3Ny0uODIzYS40MzEuNDMxIDAgMCAxIC4yMTQtLjA2NmMuMTU2IDAgLjI2My4xMjQuMjYzLjMzOCAwIC4zMDMtLjIxMy42Ny0uNDc3LjgyMmEuNDMxLjQzMSAwIDAgMS0uMjE0LjA2Nm0uNDI4LTEuNDEyYy0uMSAwLS4yMDMuMDI5LS4zMDcuMDktLjMyLjE4NS0uNTcuNjE4LS41Ny45ODUgMCAuMzA5LjE4NS41MjQuNDQ5LjUyNGEuNjMuNjMgMCAwIDAgLjMwOC0uMDljLjMyLS4xODUuNTctLjYxOC41Ny0uOTg1IDAtLjMwOS0uMTg1LS41MjQtLjQ1LS41MjQnIGZpbGw9JyM4MDk3QTInLz48cGF0aCBkPSdNNjkuMjMgODYuMzIybC0uMDc2LS4xNDljMC0uMjM1LjE3OS0uNTQ0LjM4NC0uNjYxbC4xMi0uMDQxLjA3Ni4xNTFjMCAuMjM0LS4xNzkuNTQyLS4zODMuNjZsLS4xMjEuMDRtLjQyOC0xLjAzOGEuNDMxLjQzMSAwIDAgMC0uMjE0LjA2NmMtLjI2My4xNTItLjQ3Ny41MjEtLjQ3Ny44MjMgMCAuMjE0LjEwNy4zMzcuMjYzLjMzN2EuNDMxLjQzMSAwIDAgMCAuMjE0LS4wNjZjLjI2NC0uMTUyLjQ3Ny0uNTE5LjQ3Ny0uODIyIDAtLjIxNC0uMTA3LS4zMzgtLjI2My0uMzM4JyBmaWxsPScjODA5N0EyJy8+PHBhdGggZD0nTTEzOS4yNzggNy43Njl2NDMuNjY3TDcyLjIwOCA5MC4xNlY0Ni40OTNsNjcuMDctMzguNzI0JyBmaWxsPScjNDU1QTY0Jy8+PHBhdGggZD0nTTcyLjA4MyA5MC4zNzVWNDYuNDIxbC4wNjMtLjAzNiA2Ny4yNTctMzguODMxdjQzLjk1NGwtLjA2Mi4wMzYtNjcuMjU4IDM4LjgzMXptLjI1LTQzLjgxMXY0My4zOGw2Ni44MjEtMzguNTc5VjcuOTg1TDcyLjMzMyA0Ni41NjR6JyBmaWxsPScjNjA3RDhCJy8+PC9nPjxwYXRoIGQ9J00xMjUuNzM3IDg4LjY0N2wtNy42MzkgMy4zMzRWODRsLTExLjQ1OSA0LjcxM3Y4LjI2OUw5OSAxMDAuMzE1bDEzLjM2OSAzLjY0NiAxMy4zNjgtMTUuMzE0JyBmaWxsPScjNDU1QTY0Jy8+PC9nPjwvc3ZnPiI7CgkJCWZ1bmN0aW9uIFJvdGF0ZUluc3RydWN0aW9ucygpIHsKCQkJICB0aGlzLmxvYWRJY29uXygpOwoJCQkgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCSAgdmFyIHMgPSBvdmVybGF5LnN0eWxlOwoJCQkgIHMucG9zaXRpb24gPSAnZml4ZWQnOwoJCQkgIHMudG9wID0gMDsKCQkJICBzLnJpZ2h0ID0gMDsKCQkJICBzLmJvdHRvbSA9IDA7CgkJCSAgcy5sZWZ0ID0gMDsKCQkJICBzLmJhY2tncm91bmRDb2xvciA9ICdncmF5JzsKCQkJICBzLmZvbnRGYW1pbHkgPSAnc2Fucy1zZXJpZic7CgkJCSAgcy56SW5kZXggPSAxMDAwMDAwOwoJCQkgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKCQkJICBpbWcuc3JjID0gdGhpcy5pY29uOwoJCQkgIHZhciBzID0gaW1nLnN0eWxlOwoJCQkgIHMubWFyZ2luTGVmdCA9ICcyNSUnOwoJCQkgIHMubWFyZ2luVG9wID0gJzI1JSc7CgkJCSAgcy53aWR0aCA9ICc1MCUnOwoJCQkgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoaW1nKTsKCQkJICB2YXIgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkgIHZhciBzID0gdGV4dC5zdHlsZTsKCQkJICBzLnRleHRBbGlnbiA9ICdjZW50ZXInOwoJCQkgIHMuZm9udFNpemUgPSAnMTZweCc7CgkJCSAgcy5saW5lSGVpZ2h0ID0gJzI0cHgnOwoJCQkgIHMubWFyZ2luID0gJzI0cHggMjUlJzsKCQkJICBzLndpZHRoID0gJzUwJSc7CgkJCSAgdGV4dC5pbm5lckhUTUwgPSAnUGxhY2UgeW91ciBwaG9uZSBpbnRvIHlvdXIgQ2FyZGJvYXJkIHZpZXdlci4nOwoJCQkgIG92ZXJsYXkuYXBwZW5kQ2hpbGQodGV4dCk7CgkJCSAgdmFyIHNuYWNrYmFyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CgkJCSAgdmFyIHMgPSBzbmFja2Jhci5zdHlsZTsKCQkJICBzLmJhY2tncm91bmRDb2xvciA9ICcjQ0ZEOERDJzsKCQkJICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQkJICBzLmJvdHRvbSA9IDA7CgkJCSAgcy53aWR0aCA9ICcxMDAlJzsKCQkJICBzLmhlaWdodCA9ICc0OHB4JzsKCQkJICBzLnBhZGRpbmcgPSAnMTRweCAyNHB4JzsKCQkJICBzLmJveFNpemluZyA9ICdib3JkZXItYm94JzsKCQkJICBzLmNvbG9yID0gJyM2NTZBNkInOwoJCQkgIG92ZXJsYXkuYXBwZW5kQ2hpbGQoc25hY2tiYXIpOwoJCQkgIHZhciBzbmFja2JhclRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICBzbmFja2JhclRleHQuc3R5bGUuZmxvYXQgPSAnbGVmdCc7CgkJCSAgc25hY2tiYXJUZXh0LmlubmVySFRNTCA9ICdObyBDYXJkYm9hcmQgdmlld2VyPyc7CgkJCSAgdmFyIHNuYWNrYmFyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwoJCQkgIHNuYWNrYmFyQnV0dG9uLmhyZWYgPSAnaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9nZXQvY2FyZGJvYXJkL2dldC1jYXJkYm9hcmQvJzsKCQkJICBzbmFja2JhckJ1dHRvbi5pbm5lckhUTUwgPSAnZ2V0IG9uZSc7CgkJCSAgc25hY2tiYXJCdXR0b24udGFyZ2V0ID0gJ19ibGFuayc7CgkJCSAgdmFyIHMgPSBzbmFja2JhckJ1dHRvbi5zdHlsZTsKCQkJICBzLmZsb2F0ID0gJ3JpZ2h0JzsKCQkJICBzLmZvbnRXZWlnaHQgPSA2MDA7CgkJCSAgcy50ZXh0VHJhbnNmb3JtID0gJ3VwcGVyY2FzZSc7CgkJCSAgcy5ib3JkZXJMZWZ0ID0gJzFweCBzb2xpZCBncmF5JzsKCQkJICBzLnBhZGRpbmdMZWZ0ID0gJzI0cHgnOwoJCQkgIHMudGV4dERlY29yYXRpb24gPSAnbm9uZSc7CgkJCSAgcy5jb2xvciA9ICcjNjU2QTZCJzsKCQkJICBzbmFja2Jhci5hcHBlbmRDaGlsZChzbmFja2JhclRleHQpOwoJCQkgIHNuYWNrYmFyLmFwcGVuZENoaWxkKHNuYWNrYmFyQnV0dG9uKTsKCQkJICB0aGlzLm92ZXJsYXkgPSBvdmVybGF5OwoJCQkgIHRoaXMudGV4dCA9IHRleHQ7CgkJCSAgdGhpcy5oaWRlKCk7CgkJCX0KCQkJUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKHBhcmVudCkgewoJCQkgIGlmICghcGFyZW50ICYmICF0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudCkgewoJCQkgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm92ZXJsYXkpOwoJCQkgIH0gZWxzZSBpZiAocGFyZW50KSB7CgkJCSAgICBpZiAodGhpcy5vdmVybGF5LnBhcmVudEVsZW1lbnQgJiYgdGhpcy5vdmVybGF5LnBhcmVudEVsZW1lbnQgIT0gcGFyZW50KSB0aGlzLm92ZXJsYXkucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLm92ZXJsYXkpOwoJCQkgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMub3ZlcmxheSk7CgkJCSAgfQoJCQkgIHRoaXMub3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKCQkJICB2YXIgaW1nID0gdGhpcy5vdmVybGF5LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpOwoJCQkgIHZhciBzID0gaW1nLnN0eWxlOwoJCQkgIGlmIChpc0xhbmRzY2FwZU1vZGUoKSkgewoJCQkgICAgcy53aWR0aCA9ICcyMCUnOwoJCQkgICAgcy5tYXJnaW5MZWZ0ID0gJzQwJSc7CgkJCSAgICBzLm1hcmdpblRvcCA9ICczJSc7CgkJCSAgfSBlbHNlIHsKCQkJICAgIHMud2lkdGggPSAnNTAlJzsKCQkJICAgIHMubWFyZ2luTGVmdCA9ICcyNSUnOwoJCQkgICAgcy5tYXJnaW5Ub3AgPSAnMjUlJzsKCQkJICB9CgkJCX07CgkJCVJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB0aGlzLm92ZXJsYXkuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfTsKCQkJUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5zaG93VGVtcG9yYXJpbHkgPSBmdW5jdGlvbiAobXMsIHBhcmVudCkgewoJCQkgIHRoaXMuc2hvdyhwYXJlbnQpOwoJCQkgIHRoaXMudGltZXIgPSBzZXRUaW1lb3V0KHRoaXMuaGlkZS5iaW5kKHRoaXMpLCBtcyk7CgkJCX07CgkJCVJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUuZGlzYWJsZVNob3dUZW1wb3JhcmlseSA9IGZ1bmN0aW9uICgpIHsKCQkJICBjbGVhclRpbWVvdXQodGhpcy50aW1lcik7CgkJCX07CgkJCVJvdGF0ZUluc3RydWN0aW9ucy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMuZGlzYWJsZVNob3dUZW1wb3JhcmlseSgpOwoJCQkgIGlmICghaXNMYW5kc2NhcGVNb2RlKCkgJiYgaXNNb2JpbGUoKSkgewoJCQkgICAgdGhpcy5zaG93KCk7CgkJCSAgfSBlbHNlIHsKCQkJICAgIHRoaXMuaGlkZSgpOwoJCQkgIH0KCQkJfTsKCQkJUm90YXRlSW5zdHJ1Y3Rpb25zLnByb3RvdHlwZS5sb2FkSWNvbl8gPSBmdW5jdGlvbiAoKSB7CgkJCSAgdGhpcy5pY29uID0gZGF0YVVyaSgnaW1hZ2Uvc3ZnK3htbCcsIHJvdGF0ZUluc3RydWN0aW9uc0Fzc2V0KTsKCQkJfTsKCQkJdmFyIERFRkFVTFRfVklFV0VSID0gJ0NhcmRib2FyZFYxJzsKCQkJdmFyIFZJRVdFUl9LRVkgPSAnV0VCVlJfQ0FSREJPQVJEX1ZJRVdFUic7CgkJCXZhciBDTEFTU19OQU1FID0gJ3dlYnZyLXBvbHlmaWxsLXZpZXdlci1zZWxlY3Rvcic7CgkJCWZ1bmN0aW9uIFZpZXdlclNlbGVjdG9yKGRlZmF1bHRWaWV3ZXIpIHsKCQkJICB0cnkgewoJCQkgICAgdGhpcy5zZWxlY3RlZEtleSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFZJRVdFUl9LRVkpOwoJCQkgIH0gY2F0Y2ggKGVycm9yKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9hZCB2aWV3ZXIgcHJvZmlsZTogJXMnLCBlcnJvcik7CgkJCSAgfQoJCQkgIGlmICghdGhpcy5zZWxlY3RlZEtleSkgewoJCQkgICAgdGhpcy5zZWxlY3RlZEtleSA9IGRlZmF1bHRWaWV3ZXIgfHwgREVGQVVMVF9WSUVXRVI7CgkJCSAgfQoJCQkgIHRoaXMuZGlhbG9nID0gdGhpcy5jcmVhdGVEaWFsb2dfKERldmljZUluZm8uVmlld2Vycyk7CgkJCSAgdGhpcy5yb290ID0gbnVsbDsKCQkJICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXyA9IFtdOwoJCQl9CgkJCVZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24gKHJvb3QpIHsKCQkJICB0aGlzLnJvb3QgPSByb290OwoJCQkgIHJvb3QuYXBwZW5kQ2hpbGQodGhpcy5kaWFsb2cpOwoJCQkgIHZhciBzZWxlY3RlZCA9IHRoaXMuZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGhpcy5zZWxlY3RlZEtleSk7CgkJCSAgc2VsZWN0ZWQuY2hlY2tlZCA9IHRydWU7CgkJCSAgdGhpcy5kaWFsb2cuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CgkJCX07CgkJCVZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICh0aGlzLnJvb3QgJiYgdGhpcy5yb290LmNvbnRhaW5zKHRoaXMuZGlhbG9nKSkgewoJCQkgICAgdGhpcy5yb290LnJlbW92ZUNoaWxkKHRoaXMuZGlhbG9nKTsKCQkJICB9CgkJCSAgdGhpcy5kaWFsb2cuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmdldEN1cnJlbnRWaWV3ZXIgPSBmdW5jdGlvbiAoKSB7CgkJCSAgcmV0dXJuIERldmljZUluZm8uVmlld2Vyc1t0aGlzLnNlbGVjdGVkS2V5XTsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmdldFNlbGVjdGVkS2V5XyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgaW5wdXQgPSB0aGlzLmRpYWxvZy5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPWZpZWxkXTpjaGVja2VkJyk7CgkJCSAgaWYgKGlucHV0KSB7CgkJCSAgICByZXR1cm4gaW5wdXQuaWQ7CgkJCSAgfQoJCQkgIHJldHVybiBudWxsOwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUub25DaGFuZ2UgPSBmdW5jdGlvbiAoY2IpIHsKCQkJICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXy5wdXNoKGNiKTsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmZpcmVPbkNoYW5nZV8gPSBmdW5jdGlvbiAodmlld2VyKSB7CgkJCSAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2tzXy5sZW5ndGg7IGkrKykgewoJCQkgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrc19baV0odmlld2VyKTsKCQkJICB9CgkJCX07CgkJCVZpZXdlclNlbGVjdG9yLnByb3RvdHlwZS5vblNhdmVfID0gZnVuY3Rpb24gKCkgewoJCQkgIHRoaXMuc2VsZWN0ZWRLZXkgPSB0aGlzLmdldFNlbGVjdGVkS2V5XygpOwoJCQkgIGlmICghdGhpcy5zZWxlY3RlZEtleSB8fCAhRGV2aWNlSW5mby5WaWV3ZXJzW3RoaXMuc2VsZWN0ZWRLZXldKSB7CgkJCSAgICBjb25zb2xlLmVycm9yKCdWaWV3ZXJTZWxlY3Rvci5vblNhdmVfOiB0aGlzIHNob3VsZCBuZXZlciBoYXBwZW4hJyk7CgkJCSAgICByZXR1cm47CgkJCSAgfQoJCQkgIHRoaXMuZmlyZU9uQ2hhbmdlXyhEZXZpY2VJbmZvLlZpZXdlcnNbdGhpcy5zZWxlY3RlZEtleV0pOwoJCQkgIHRyeSB7CgkJCSAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShWSUVXRVJfS0VZLCB0aGlzLnNlbGVjdGVkS2V5KTsKCQkJICB9IGNhdGNoIChlcnJvcikgewoJCQkgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgdmlld2VyIHByb2ZpbGU6ICVzJywgZXJyb3IpOwoJCQkgIH0KCQkJICB0aGlzLmhpZGUoKTsKCQkJfTsKCQkJVmlld2VyU2VsZWN0b3IucHJvdG90eXBlLmNyZWF0ZURpYWxvZ18gPSBmdW5jdGlvbiAob3B0aW9ucykgewoJCQkgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICBjb250YWluZXIuY2xhc3NMaXN0LmFkZChDTEFTU19OQU1FKTsKCQkJICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCQkJICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwoJCQkgIHZhciBzID0gb3ZlcmxheS5zdHlsZTsKCQkJICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQkJICBzLmxlZnQgPSAwOwoJCQkgIHMudG9wID0gMDsKCQkJICBzLndpZHRoID0gJzEwMCUnOwoJCQkgIHMuaGVpZ2h0ID0gJzEwMCUnOwoJCQkgIHMuYmFja2dyb3VuZCA9ICdyZ2JhKDAsIDAsIDAsIDAuMyknOwoJCQkgIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhpZGUuYmluZCh0aGlzKSk7CgkJCSAgdmFyIHdpZHRoID0gMjgwOwoJCQkgIHZhciBkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICB2YXIgcyA9IGRpYWxvZy5zdHlsZTsKCQkJICBzLmJveFNpemluZyA9ICdib3JkZXItYm94JzsKCQkJICBzLnBvc2l0aW9uID0gJ2ZpeGVkJzsKCQkJICBzLnRvcCA9ICcyNHB4JzsKCQkJICBzLmxlZnQgPSAnNTAlJzsKCQkJICBzLm1hcmdpbkxlZnQgPSAtd2lkdGggLyAyICsgJ3B4JzsKCQkJICBzLndpZHRoID0gd2lkdGggKyAncHgnOwoJCQkgIHMucGFkZGluZyA9ICcyNHB4JzsKCQkJICBzLm92ZXJmbG93ID0gJ2hpZGRlbic7CgkJCSAgcy5iYWNrZ3JvdW5kID0gJyNmYWZhZmEnOwoJCQkgIHMuZm9udEZhbWlseSA9ICInUm9ib3RvJywgc2Fucy1zZXJpZiI7CgkJCSAgcy5ib3hTaGFkb3cgPSAnMHB4IDVweCAyMHB4ICM2NjYnOwoJCQkgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUgxXygnU2VsZWN0IHlvdXIgdmlld2VyJykpOwoJCQkgIGZvciAodmFyIGlkIGluIG9wdGlvbnMpIHsKCQkJICAgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUNob2ljZV8oaWQsIG9wdGlvbnNbaWRdLmxhYmVsKSk7CgkJCSAgfQoJCQkgIGRpYWxvZy5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUJ1dHRvbl8oJ1NhdmUnLCB0aGlzLm9uU2F2ZV8uYmluZCh0aGlzKSkpOwoJCQkgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChvdmVybGF5KTsKCQkJICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZGlhbG9nKTsKCQkJICByZXR1cm4gY29udGFpbmVyOwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlSDFfID0gZnVuY3Rpb24gKG5hbWUpIHsKCQkJICB2YXIgaDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpOwoJCQkgIHZhciBzID0gaDEuc3R5bGU7CgkJCSAgcy5jb2xvciA9ICdibGFjayc7CgkJCSAgcy5mb250U2l6ZSA9ICcyMHB4JzsKCQkJICBzLmZvbnRXZWlnaHQgPSAnYm9sZCc7CgkJCSAgcy5tYXJnaW5Ub3AgPSAwOwoJCQkgIHMubWFyZ2luQm90dG9tID0gJzI0cHgnOwoJCQkgIGgxLmlubmVySFRNTCA9IG5hbWU7CgkJCSAgcmV0dXJuIGgxOwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlQ2hvaWNlXyA9IGZ1bmN0aW9uIChpZCwgbmFtZSkgewoJCQkgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCQkJICBkaXYuc3R5bGUubWFyZ2luVG9wID0gJzhweCc7CgkJCSAgZGl2LnN0eWxlLmNvbG9yID0gJ2JsYWNrJzsKCQkJICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCQkgIGlucHV0LnN0eWxlLmZvbnRTaXplID0gJzMwcHgnOwoJCQkgIGlucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBpZCk7CgkJCSAgaW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3JhZGlvJyk7CgkJCSAgaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIGlkKTsKCQkJICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZmllbGQnKTsKCQkJICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwoJCQkgIGxhYmVsLnN0eWxlLm1hcmdpbkxlZnQgPSAnNHB4JzsKCQkJICBsYWJlbC5zZXRBdHRyaWJ1dGUoJ2ZvcicsIGlkKTsKCQkJICBsYWJlbC5pbm5lckhUTUwgPSBuYW1lOwoJCQkgIGRpdi5hcHBlbmRDaGlsZChpbnB1dCk7CgkJCSAgZGl2LmFwcGVuZENoaWxkKGxhYmVsKTsKCQkJICByZXR1cm4gZGl2OwoJCQl9OwoJCQlWaWV3ZXJTZWxlY3Rvci5wcm90b3R5cGUuY3JlYXRlQnV0dG9uXyA9IGZ1bmN0aW9uIChsYWJlbCwgb25jbGljaykgewoJCQkgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKCQkJICBidXR0b24uaW5uZXJIVE1MID0gbGFiZWw7CgkJCSAgdmFyIHMgPSBidXR0b24uc3R5bGU7CgkJCSAgcy5mbG9hdCA9ICdyaWdodCc7CgkJCSAgcy50ZXh0VHJhbnNmb3JtID0gJ3VwcGVyY2FzZSc7CgkJCSAgcy5jb2xvciA9ICcjMTA5NGY3JzsKCQkJICBzLmZvbnRTaXplID0gJzE0cHgnOwoJCQkgIHMubGV0dGVyU3BhY2luZyA9IDA7CgkJCSAgcy5ib3JkZXIgPSAwOwoJCQkgIHMuYmFja2dyb3VuZCA9ICdub25lJzsKCQkJICBzLm1hcmdpblRvcCA9ICcxNnB4JzsKCQkJICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbmNsaWNrKTsKCQkJICByZXR1cm4gYnV0dG9uOwoJCQl9OwoJCQl2YXIgY29tbW9uanNHbG9iYWwkJDEgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBjb21tb25qc0dsb2JhbCQxICE9PSAndW5kZWZpbmVkJyA/IGNvbW1vbmpzR2xvYmFsJDEgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgkJCWZ1bmN0aW9uIHVud3JhcEV4cG9ydHMkJDEgKHgpIHsKCQkJCXJldHVybiB4ICYmIHguX19lc01vZHVsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoeCwgJ2RlZmF1bHQnKSA/IHhbJ2RlZmF1bHQnXSA6IHg7CgkJCX0KCQkJZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUkJDEoZm4sIG1vZHVsZSkgewoJCQkJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwoJCQl9CgkJCXZhciBOb1NsZWVwID0gY3JlYXRlQ29tbW9uanNNb2R1bGUkJDEoZnVuY3Rpb24gKG1vZHVsZSwgZXhwb3J0cykgewoJCQkoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkgewoJCQkJbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7CgkJCX0pKGNvbW1vbmpzR2xvYmFsJCQxLCBmdW5jdGlvbigpIHsKCQkJcmV0dXJuICAgICAgICAgIChmdW5jdGlvbihtb2R1bGVzKSB7CgkJCSAgICAgICAgIAl2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9OwoJCQkgICAgICAgICAJZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewoJCQkgICAgICAgICAJCWlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7CgkJCSAgICAgICAgIAkJCXJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzOwoJCQkgICAgICAgICAJCX0KCQkJICAgICAgICAgCQl2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7CgkJCSAgICAgICAgIAkJCWk6IG1vZHVsZUlkLAoJCQkgICAgICAgICAJCQlsOiBmYWxzZSwKCQkJICAgICAgICAgCQkJZXhwb3J0czoge30KCQkJICAgICAgICAgCQl9OwoJCQkgICAgICAgICAJCW1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOwoJCQkgICAgICAgICAJCW1vZHVsZS5sID0gdHJ1ZTsKCQkJICAgICAgICAgCQlyZXR1cm4gbW9kdWxlLmV4cG9ydHM7CgkJCSAgICAgICAgIAl9CgkJCSAgICAgICAgIAlfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzOwoJCQkgICAgICAgICAJX193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlczsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikgewoJCQkgICAgICAgICAJCWlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHsKCQkJICAgICAgICAgCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsKCQkJICAgICAgICAgCQkJCWNvbmZpZ3VyYWJsZTogZmFsc2UsCgkJCSAgICAgICAgIAkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkgICAgICAgICAJCQkJZ2V0OiBnZXR0ZXIKCQkJICAgICAgICAgCQkJfSk7CgkJCSAgICAgICAgIAkJfQoJCQkgICAgICAgICAJfTsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkgewoJCQkgICAgICAgICAJCXZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPwoJCQkgICAgICAgICAJCQlmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOgoJCQkgICAgICAgICAJCQlmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9OwoJCQkgICAgICAgICAJCV9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTsKCQkJICAgICAgICAgCQlyZXR1cm4gZ2V0dGVyOwoJCQkgICAgICAgICAJfTsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTsKCQkJICAgICAgICAgCV9fd2VicGFja19yZXF1aXJlX18ucCA9ICIiOwoJCQkgICAgICAgICAJcmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7CgkJCSAgICAgICAgIH0pCgkJCSAgICAgICAgIChbCgkJCSAgICAgIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCQkJdmFyIF9jcmVhdGVDbGFzcyA9IGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7CgkJCWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7IH0gfQoJCQl2YXIgbWVkaWFGaWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXygxKTsKCQkJdmFyIG9sZElPUyA9IHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIHBhcnNlRmxvYXQoKCcnICsgKC9DUFUuKk9TIChbMC05X117Myw0fSlbMC05X117MCwxfXwoQ1BVIGxpa2UpLipBcHBsZVdlYktpdC4qTW9iaWxlL2kuZXhlYyhuYXZpZ2F0b3IudXNlckFnZW50KSB8fCBbMCwgJyddKVsxXSkucmVwbGFjZSgndW5kZWZpbmVkJywgJzNfMicpLnJlcGxhY2UoJ18nLCAnLicpLnJlcGxhY2UoJ18nLCAnJykpIDwgMTAgJiYgIXdpbmRvdy5NU1N0cmVhbTsKCQkJdmFyIE5vU2xlZXAgPSBmdW5jdGlvbiAoKSB7CgkJCSAgZnVuY3Rpb24gTm9TbGVlcCgpIHsKCQkJICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBOb1NsZWVwKTsKCQkJICAgIGlmIChvbGRJT1MpIHsKCQkJICAgICAgdGhpcy5ub1NsZWVwVGltZXIgPSBudWxsOwoJCQkgICAgfSBlbHNlIHsKCQkJICAgICAgdGhpcy5ub1NsZWVwVmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpOwoJCQkgICAgICB0aGlzLm5vU2xlZXBWaWRlby5zZXRBdHRyaWJ1dGUoJ3BsYXlzaW5saW5lJywgJycpOwoJCQkgICAgICB0aGlzLm5vU2xlZXBWaWRlby5zZXRBdHRyaWJ1dGUoJ3NyYycsIG1lZGlhRmlsZSk7CgkJCSAgICAgIHRoaXMubm9TbGVlcFZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCBmdW5jdGlvbiAoZSkgewoJCQkgICAgICAgIGlmICh0aGlzLm5vU2xlZXBWaWRlby5jdXJyZW50VGltZSA+IDAuNSkgewoJCQkgICAgICAgICAgdGhpcy5ub1NsZWVwVmlkZW8uY3VycmVudFRpbWUgPSBNYXRoLnJhbmRvbSgpOwoJCQkgICAgICAgIH0KCQkJICAgICAgfS5iaW5kKHRoaXMpKTsKCQkJICAgIH0KCQkJICB9CgkJCSAgX2NyZWF0ZUNsYXNzKE5vU2xlZXAsIFt7CgkJCSAgICBrZXk6ICdlbmFibGUnLAoJCQkgICAgdmFsdWU6IGZ1bmN0aW9uIGVuYWJsZSgpIHsKCQkJICAgICAgaWYgKG9sZElPUykgewoJCQkgICAgICAgIHRoaXMuZGlzYWJsZSgpOwoJCQkgICAgICAgIHRoaXMubm9TbGVlcFRpbWVyID0gd2luZG93LnNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCQkJICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy8nOwoJCQkgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQod2luZG93LnN0b3AsIDApOwoJCQkgICAgICAgIH0sIDE1MDAwKTsKCQkJICAgICAgfSBlbHNlIHsKCQkJICAgICAgICB0aGlzLm5vU2xlZXBWaWRlby5wbGF5KCk7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICB9LCB7CgkJCSAgICBrZXk6ICdkaXNhYmxlJywKCQkJICAgIHZhbHVlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewoJCQkgICAgICBpZiAob2xkSU9TKSB7CgkJCSAgICAgICAgaWYgKHRoaXMubm9TbGVlcFRpbWVyKSB7CgkJCSAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLm5vU2xlZXBUaW1lcik7CgkJCSAgICAgICAgICB0aGlzLm5vU2xlZXBUaW1lciA9IG51bGw7CgkJCSAgICAgICAgfQoJCQkgICAgICB9IGVsc2UgewoJCQkgICAgICAgIHRoaXMubm9TbGVlcFZpZGVvLnBhdXNlKCk7CgkJCSAgICAgIH0KCQkJICAgIH0KCQkJICB9XSk7CgkJCSAgcmV0dXJuIE5vU2xlZXA7CgkJCX0oKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBOb1NsZWVwOwoJCQkgICAgICB9KSwKCQkJICAgICAgKGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgewoJCQltb2R1bGUuZXhwb3J0cyA9ICdkYXRhOnZpZGVvL21wNDtiYXNlNjQsQUFBQUlHWjBlWEJ0Y0RReUFBQUNBR2x6YjIxcGMyOHlZWFpqTVcxd05ERUFBQUFJWm5KbFpRQUFDS0J0WkdGMEFBQUM4d1lGLy8vdjNFWHB2ZWJaU0xlV0xOZ2cyU1B1NzNneU5qUWdMU0JqYjNKbElERTBNaUJ5TWpRM09TQmtaRGM1WVRZeElDMGdTQzR5TmpRdlRWQkZSeTAwSUVGV1F5QmpiMlJsWXlBdElFTnZjSGxzWldaMElESXdNRE10TWpBeE5DQXRJR2gwZEhBNkx5OTNkM2N1ZG1sa1pXOXNZVzR1YjNKbkwzZ3lOalF1YUhSdGJDQXRJRzl3ZEdsdmJuTTZJR05oWW1GalBURWdjbVZtUFRFZ1pHVmliRzlqYXoweE9qQTZNQ0JoYm1Gc2VYTmxQVEI0TVRvd2VERXhNU0J0WlQxb1pYZ2djM1ZpYldVOU1pQndjM2s5TVNCd2MzbGZjbVE5TVM0d01Eb3dMakF3SUcxcGVHVmtYM0psWmowd0lHMWxYM0poYm1kbFBURTJJR05vY205dFlWOXRaVDB4SUhSeVpXeHNhWE05TUNBNGVEaGtZM1E5TUNCamNXMDlNQ0JrWldGa2VtOXVaVDB5TVN3eE1TQm1ZWE4wWDNCemEybHdQVEVnWTJoeWIyMWhYM0Z3WDI5bVpuTmxkRDB3SUhSb2NtVmhaSE05TmlCc2IyOXJZV2hsWVdSZmRHaHlaV0ZrY3oweElITnNhV05sWkY5MGFISmxZV1J6UFRBZ2JuSTlNQ0JrWldOcGJXRjBaVDB4SUdsdWRHVnliR0ZqWldROU1DQmliSFZ5WVhsZlkyOXRjR0YwUFRBZ1kyOXVjM1J5WVdsdVpXUmZhVzUwY21FOU1DQmlabkpoYldWelBUTWdZbDl3ZVhKaGJXbGtQVElnWWw5aFpHRndkRDB4SUdKZlltbGhjejB3SUdScGNtVmpkRDB4SUhkbGFXZG9kR0k5TVNCdmNHVnVYMmR2Y0Qwd0lIZGxhV2RvZEhBOU1TQnJaWGxwYm5ROU16QXdJR3RsZVdsdWRGOXRhVzQ5TXpBZ2MyTmxibVZqZFhROU5EQWdhVzUwY21GZmNtVm1jbVZ6YUQwd0lISmpYMnh2YjJ0aGFHVmhaRDB4TUNCeVl6MWpjbVlnYldKMGNtVmxQVEVnWTNKbVBUSXdMakFnY1dOdmJYQTlNQzQyTUNCeGNHMXBiajB3SUhGd2JXRjRQVFk1SUhGd2MzUmxjRDAwSUhaaWRsOXRZWGh5WVhSbFBUSXdNREF3SUhaaWRsOWlkV1p6YVhwbFBUSTFNREF3SUdOeVpsOXRZWGc5TUM0d0lHNWhiRjlvY21ROWJtOXVaU0JtYVd4c1pYSTlNQ0JwY0Y5eVlYUnBiejB4TGpRd0lHRnhQVEU2TVM0d01BQ0FBQUFBT1dXSWhBQTMvL3ArQzd2OHRERFNUamY5N3c1NWkzU2JSUE80WlkraGtqRDVoYmtBa0wzenBKNmgvTFIxQ0FBQnpnQjFrcXF6VW9ybGhRQUFBQXhCbWlRWWhuLytxWllBRExnQUFBQUpRWjVDUWhYL0FBajVJUUFEUUdnY0lRQURRR2djQUFBQUNRR2VZVVFuL3dBTEtDRUFBMEJvSEFBQUFBa0JubU5FSi84QUN5a2hBQU5BYUJ3aEFBTkFhQndBQUFBTlFacG9ORXhEUC82cGxnQU11U0VBQTBCb0hBQUFBQXRCbm9aRkVTd3Ivd0FJK1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbnFWRUovOEFDeWtoQUFOQWFCd0FBQUFKQVo2blJDZi9BQXNvSVFBRFFHZ2NJUUFEUUdnY0FBQUFEVUdhckRSTVF6LytxWllBRExnaEFBTkFhQndBQUFBTFFaN0tSUlVzSy84QUNQa2hBQU5BYUJ3QUFBQUpBWjdwUkNmL0FBc29JUUFEUUdnY0lRQURRR2djQUFBQUNRR2U2MFFuL3dBTEtDRUFBMEJvSEFBQUFBMUJtdkEwVEVNLy9xbVdBQXk1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDMEdmRGtVVkxDdi9BQWo1SVFBRFFHZ2NBQUFBQ1FHZkxVUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQWtCbnk5RUovOEFDeWdoQUFOQWFCd0FBQUFOUVpzME5FeERQLzZwbGdBTXVDRUFBMEJvSEFBQUFBdEJuMUpGRlN3ci93QUkrU0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuM0ZFSi84QUN5Z2hBQU5BYUJ3QUFBQUpBWjl6UkNmL0FBc29JUUFEUUdnY0lRQURRR2djQUFBQURVR2JlRFJNUXovK3FaWUFETGtoQUFOQWFCd0FBQUFMUVorV1JSVXNLLzhBQ1BnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVorMVJDZi9BQXNwSVFBRFFHZ2NBQUFBQ1FHZnQwUW4vd0FMS1NFQUEwQm9IQ0VBQTBCb0hBQUFBQTFCbTd3MFRFTS8vcW1XQUF5NElRQURRR2djQUFBQUMwR2Yya1VWTEN2L0FBajVJUUFEUUdnY0FBQUFDUUdmK1VRbi93QUxLQ0VBQTBCb0hDRUFBMEJvSEFBQUFBa0JuL3RFSi84QUN5a2hBQU5BYUJ3QUFBQU5RWnZnTkV4RFAvNnBsZ0FNdVNFQUEwQm9IQ0VBQTBCb0hBQUFBQXRCbmg1RkZTd3Ivd0FJK0NFQUEwQm9IQUFBQUFrQm5qMUVKLzhBQ3lnaEFBTkFhQndoQUFOQWFCd0FBQUFKQVo0L1JDZi9BQXNwSVFBRFFHZ2NBQUFBRFVHYUpEUk1Rei8rcVpZQURMZ2hBQU5BYUJ3QUFBQUxRWjVDUlJVc0svOEFDUGtoQUFOQWFCd2hBQU5BYUJ3QUFBQUpBWjVoUkNmL0FBc29JUUFEUUdnY0FBQUFDUUdlWTBRbi93QUxLU0VBQTBCb0hDRUFBMEJvSEFBQUFBMUJtbWcwVEVNLy9xbVdBQXk1SVFBRFFHZ2NBQUFBQzBHZWhrVVZMQ3YvQUFqNUlRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZXBVUW4vd0FMS1NFQUEwQm9IQUFBQUFrQm5xZEVKLzhBQ3lnaEFBTkFhQndBQUFBTlFacXNORXhEUC82cGxnQU11Q0VBQTBCb0hDRUFBMEJvSEFBQUFBdEJuc3BGRlN3ci93QUkrU0VBQTBCb0hBQUFBQWtCbnVsRUovOEFDeWdoQUFOQWFCd2hBQU5BYUJ3QUFBQUpBWjdyUkNmL0FBc29JUUFEUUdnY0FBQUFEVUdhOERSTVF6LytxWllBRExraEFBTkFhQndoQUFOQWFCd0FBQUFMUVo4T1JSVXNLLzhBQ1BraEFBTkFhQndBQUFBSkFaOHRSQ2YvQUFzcElRQURRR2djSVFBRFFHZ2NBQUFBQ1FHZkwwUW4vd0FMS0NFQUEwQm9IQUFBQUExQm16UTBURU0vL3FtV0FBeTRJUUFEUUdnY0FBQUFDMEdmVWtVVkxDdi9BQWo1SVFBRFFHZ2NJUUFEUUdnY0FBQUFDUUdmY1VRbi93QUxLQ0VBQTBCb0hBQUFBQWtCbjNORUovOEFDeWdoQUFOQWFCd2hBQU5BYUJ3QUFBQU5RWnQ0TkV4Qy8vNnBsZ0FNdVNFQUEwQm9IQUFBQUF0Qm41WkZGU3dyL3dBSStDRUFBMEJvSENFQUEwQm9IQUFBQUFrQm43VkVKLzhBQ3lraEFBTkFhQndBQUFBSkFaKzNSQ2YvQUFzcElRQURRR2djQUFBQURVR2J1elJNUW4vK25oQUFZc0FoQUFOQWFCd2hBQU5BYUJ3QUFBQUpRWi9hUWhQL0FBc3BJUUFEUUdnY0FBQUFDUUdmK1VRbi93QUxLQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQ0VBQTBCb0hDRUFBMEJvSENFQUEwQm9IQUFBQ2lGdGIyOTJBQUFBYkcxMmFHUUFBQUFBMVlDQ1g5V0FnbDhBQUFQb0FBQUgvQUFCQUFBQkFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQURBQUFBR0dsdlpITUFBQUFBRUlDQWdBY0FULy8vL3Y3L0FBQUYrWFJ5WVdzQUFBQmNkR3RvWkFBQUFBUFZnSUpmMVlDQ1h3QUFBQUVBQUFBQUFBQUgwQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUFBRUFBQUFBQUFBQUFBQUFBQUFBQUVBQUFBQUF5Z0FBQU1vQUFBQUFBQ1JsWkhSekFBQUFIR1ZzYzNRQUFBQUFBQUFBQVFBQUI5QUFBQmR3QUFFQUFBQUFCWEZ0WkdsaEFBQUFJRzFrYUdRQUFBQUExWUNDWDlXQWdsOEFBVitRQUFLL0lGWEVBQUFBQUFBdGFHUnNjZ0FBQUFBQUFBQUFkbWxrWlFBQUFBQUFBQUFBQUFBQUFGWnBaR1Z2U0dGdVpHeGxjZ0FBQUFVY2JXbHVaZ0FBQUJSMmJXaGtBQUFBQVFBQUFBQUFBQUFBQUFBQUpHUnBibVlBQUFBY1pISmxaZ0FBQUFBQUFBQUJBQUFBREhWeWJDQUFBQUFCQUFBRTNITjBZbXdBQUFDWWMzUnpaQUFBQUFBQUFBQUJBQUFBaUdGMll6RUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQXlnREtBRWdBQUFCSUFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFZLy84QUFBQXlZWFpqUXdGTlFDai80UUFiWjAxQUtPeWhvM3lTVFVCQVFGQUFBQU1BRUFBcjhnRHhneGxnQVFBRWFPK0c4Z0FBQUJoemRIUnpBQUFBQUFBQUFBRUFBQUE4QUFBTHVBQUFBQlJ6ZEhOekFBQUFBQUFBQUFFQUFBQUJBQUFCOEdOMGRITUFBQUFBQUFBQVBBQUFBQUVBQUJkd0FBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBRHFZQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUFFQUFBdTRBQUFBQVFBQU9wZ0FBQUFCQUFBWGNBQUFBQUVBQUFBQUFBQUFBUUFBQzdnQUFBQUJBQUE2bUFBQUFBRUFBQmR3QUFBQUFRQUFBQUFBQUFBQkFBQUx1QUFBQUFFQUFEcVlBQUFBQVFBQUYzQUFBQUFCQUFBQUFBQUFBQUVBQUF1NEFBQUFBUUFBT3BnQUFBQUJBQUFYY0FBQUFBRUFBQUFBQUFBQUFRQUFDN2dBQUFBQkFBQTZtQUFBQUFFQUFCZHdBQUFBQVFBQUFBQUFBQUFCQUFBTHVBQUFBQUVBQURxWUFBQUFBUUFBRjNBQUFBQUJBQUFBQUFBQUFBRUFBQXU0QUFBQUFRQUFPcGdBQUFBQkFBQVhjQUFBQUFFQUFBQUFBQUFBQVFBQUM3Z0FBQUFCQUFBNm1BQUFBQUVBQUJkd0FBQUFBUUFBQUFBQUFBQUJBQUFMdUFBQUFBRUFBQzdnQUFBQUFRQUFGM0FBQUFBQkFBQUFBQUFBQUJ4emRITmpBQUFBQUFBQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFFRWMzUnplZ0FBQUFBQUFBQUFBQUFBUEFBQUF6UUFBQUFRQUFBQURRQUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBUEFBQUFEUUFBQUEwQUFBQVJBQUFBRHdBQUFBMEFBQUFOQUFBQUVRQUFBQThBQUFBTkFBQUFEUUFBQUJFQUFBQVBBQUFBRFFBQUFBMEFBQUFSQUFBQUR3QUFBQTBBQUFBTkFBQUFFUUFBQUE4QUFBQU5BQUFBRFFBQUFCRUFBQUFQQUFBQURRQUFBQTBBQUFBUkFBQUFEd0FBQUEwQUFBQU5BQUFBRVFBQUFBOEFBQUFOQUFBQURRQUFBQkVBQUFBTkFBQUFEUUFBQVFCemRHTnZBQUFBQUFBQUFEd0FBQUF3QUFBRFpBQUFBM1FBQUFPTkFBQURvQUFBQTdrQUFBUFFBQUFENndBQUEvNEFBQVFYQUFBRUxnQUFCRU1BQUFSY0FBQUVid0FBQkl3QUFBU2hBQUFFdWdBQUJNMEFBQVRrQUFBRS93QUFCUklBQUFVckFBQUZRZ0FBQlYwQUFBVndBQUFGaVFBQUJhQUFBQVcxQUFBRnpnQUFCZUVBQUFYK0FBQUdFd0FBQml3QUFBWS9BQUFHVmdBQUJuRUFBQWFFQUFBR25RQUFCclFBQUFiUEFBQUc0Z0FBQnZVQUFBY1NBQUFISndBQUIwQUFBQWRUQUFBSGNBQUFCNFVBQUFlZUFBQUhzUUFBQjhnQUFBZmpBQUFIOWdBQUNBOEFBQWdtQUFBSVFRQUFDRlFBQUFobkFBQUloQUFBQ0pjQUFBTXNkSEpoYXdBQUFGeDBhMmhrQUFBQUE5V0FnbC9WZ0lKZkFBQUFBZ0FBQUFBQUFBZjhBQUFBQUFBQUFBQUFBQUFCQVFBQUFBQUJBQUFBQUFBQUFBQUFBQUFBQUFBQUFRQUFBQUFBQUFBQUFBQUFBQUFBUUFBQUFBQUFBQUFBQUFBQUFBQUNzbTFrYVdFQUFBQWdiV1JvWkFBQUFBRFZnSUpmMVlDQ1h3QUFyRVFBQVdBQVZjUUFBQUFBQUNkb1pHeHlBQUFBQUFBQUFBQnpiM1Z1QUFBQUFBQUFBQUFBQUFBQVUzUmxjbVZ2QUFBQUFtTnRhVzVtQUFBQUVITnRhR1FBQUFBQUFBQUFBQUFBQUNSa2FXNW1BQUFBSEdSeVpXWUFBQUFBQUFBQUFRQUFBQXgxY213Z0FBQUFBUUFBQWlkemRHSnNBQUFBWjNOMGMyUUFBQUFBQUFBQUFRQUFBRmR0Y0RSaEFBQUFBQUFBQUFFQUFBQUFBQUFBQUFBQ0FCQUFBQUFBckVRQUFBQUFBRE5sYzJSekFBQUFBQU9BZ0lBaUFBSUFCSUNBZ0JSQUZRQUFBQUFERFVBQUFBQUFCWUNBZ0FJU0VBYUFnSUFCQWdBQUFCaHpkSFJ6QUFBQUFBQUFBQUVBQUFCWUFBQUVBQUFBQUJ4emRITmpBQUFBQUFBQUFBRUFBQUFCQUFBQUFRQUFBQUVBQUFBVWMzUnplZ0FBQUFBQUFBQUdBQUFBV0FBQUFYQnpkR052QUFBQUFBQUFBRmdBQUFPQkFBQURod0FBQTVvQUFBT3RBQUFEc3dBQUE4b0FBQVBmQUFBRDVRQUFBL2dBQUFRTEFBQUVFUUFBQkNnQUFBUTlBQUFFVUFBQUJGWUFBQVJwQUFBRWdBQUFCSVlBQUFTYkFBQUVyZ0FBQkxRQUFBVEhBQUFFM2dBQUJQTUFBQVQ1QUFBRkRBQUFCUjhBQUFVbEFBQUZQQUFBQlZFQUFBVlhBQUFGYWdBQUJYMEFBQVdEQUFBRm1nQUFCYThBQUFYQ0FBQUZ5QUFBQmRzQUFBWHlBQUFGK0FBQUJnMEFBQVlnQUFBR0pnQUFCamtBQUFaUUFBQUdaUUFBQm1zQUFBWitBQUFHa1FBQUJwY0FBQWF1QUFBR3d3QUFCc2tBQUFiY0FBQUc3d0FBQndZQUFBY01BQUFISVFBQUJ6UUFBQWM2QUFBSFRRQUFCMlFBQUFkcUFBQUhmd0FBQjVJQUFBZVlBQUFIcXdBQUI4SUFBQWZYQUFBSDNRQUFCL0FBQUFnREFBQUlDUUFBQ0NBQUFBZzFBQUFJT3dBQUNFNEFBQWhoQUFBSWVBQUFDSDRBQUFpUkFBQUlwQUFBQ0tvQUFBaXdBQUFJdGdBQUNMd0FBQWpDQUFBQUZuVmtkR0VBQUFBT2JtRnRaVk4wWlhKbGJ3QUFBSEIxWkhSaEFBQUFhRzFsZEdFQUFBQUFBQUFBSVdoa2JISUFBQUFBQUFBQUFHMWthWEpoY0hCc0FBQUFBQUFBQUFBQUFBQUFPMmxzYzNRQUFBQXpxWFJ2YndBQUFDdGtZWFJoQUFBQUFRQUFBQUJJWVc1a1FuSmhhMlVnTUM0eE1DNHlJREl3TVRVd05qRXhNREE9JzsKCQkJICAgICAgfSkKCQkJICAgICAgICAgXSk7CgkJCX0pOwoJCQl9KTsKCQkJdmFyIE5vU2xlZXAkMSA9IHVud3JhcEV4cG9ydHMkJDEoTm9TbGVlcCk7CgkJCXZhciBuZXh0RGlzcGxheUlkID0gMTAwMDsKCQkJdmFyIGRlZmF1bHRMZWZ0Qm91bmRzID0gWzAsIDAsIDAuNSwgMV07CgkJCXZhciBkZWZhdWx0UmlnaHRCb3VuZHMgPSBbMC41LCAwLCAwLjUsIDFdOwoJCQl2YXIgcmFmID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsKCQkJdmFyIGNhZiA9IHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZTsKCQkJZnVuY3Rpb24gVlJGcmFtZURhdGEoKSB7CgkJCSAgdGhpcy5sZWZ0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwoJCQkgIHRoaXMubGVmdFZpZXdNYXRyaXggPSBuZXcgRmxvYXQzMkFycmF5KDE2KTsKCQkJICB0aGlzLnJpZ2h0UHJvamVjdGlvbk1hdHJpeCA9IG5ldyBGbG9hdDMyQXJyYXkoMTYpOwoJCQkgIHRoaXMucmlnaHRWaWV3TWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgxNik7CgkJCSAgdGhpcy5wb3NlID0gbnVsbDsKCQkJfQoJCQlmdW5jdGlvbiBWUkRpc3BsYXlDYXBhYmlsaXRpZXMoY29uZmlnKSB7CgkJCSAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywgewoJCQkgICAgaGFzUG9zaXRpb246IHsKCQkJICAgICAgd3JpdGFibGU6IGZhbHNlLCBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogY29uZmlnLmhhc1Bvc2l0aW9uCgkJCSAgICB9LAoJCQkgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiB7CgkJCSAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5oYXNFeHRlcm5hbERpc3BsYXkKCQkJICAgIH0sCgkJCSAgICBjYW5QcmVzZW50OiB7CgkJCSAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5jYW5QcmVzZW50CgkJCSAgICB9LAoJCQkgICAgbWF4TGF5ZXJzOiB7CgkJCSAgICAgIHdyaXRhYmxlOiBmYWxzZSwgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IGNvbmZpZy5tYXhMYXllcnMKCQkJICAgIH0sCgkJCSAgICBoYXNPcmllbnRhdGlvbjogewoJCQkgICAgICBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJICAgICAgICBkZXByZWNhdGVXYXJuaW5nKCdWUkRpc3BsYXlDYXBhYmlsaXRpZXMucHJvdG90eXBlLmhhc09yaWVudGF0aW9uJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CgkJCSAgICAgICAgcmV0dXJuIGNvbmZpZy5oYXNPcmllbnRhdGlvbjsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgIH0pOwoJCQl9CgkJCWZ1bmN0aW9uIFZSRGlzcGxheShjb25maWcpIHsKCQkJICBjb25maWcgPSBjb25maWcgfHwge307CgkJCSAgdmFyIFVTRV9XQUtFTE9DSyA9ICd3YWtlbG9jaycgaW4gY29uZmlnID8gY29uZmlnLndha2Vsb2NrIDogdHJ1ZTsKCQkJICB0aGlzLmlzUG9seWZpbGxlZCA9IHRydWU7CgkJCSAgdGhpcy5kaXNwbGF5SWQgPSBuZXh0RGlzcGxheUlkKys7CgkJCSAgdGhpcy5kaXNwbGF5TmFtZSA9ICcnOwoJCQkgIHRoaXMuZGVwdGhOZWFyID0gMC4wMTsKCQkJICB0aGlzLmRlcHRoRmFyID0gMTAwMDAuMDsKCQkJICB0aGlzLmlzUHJlc2VudGluZyA9IGZhbHNlOwoJCQkgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnaXNDb25uZWN0ZWQnLCB7CgkJCSAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJICAgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5pc0Nvbm5lY3RlZCcsICdWUkRpc3BsYXlDYXBhYmlsaXRpZXMucHJvdG90eXBlLmhhc0V4dGVybmFsRGlzcGxheScpOwoJCQkgICAgICByZXR1cm4gZmFsc2U7CgkJCSAgICB9CgkJCSAgfSk7CgkJCSAgdGhpcy5jYXBhYmlsaXRpZXMgPSBuZXcgVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKHsKCQkJICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKCQkJICAgIGhhc09yaWVudGF0aW9uOiBmYWxzZSwKCQkJICAgIGhhc0V4dGVybmFsRGlzcGxheTogZmFsc2UsCgkJCSAgICBjYW5QcmVzZW50OiBmYWxzZSwKCQkJICAgIG1heExheWVyczogMQoJCQkgIH0pOwoJCQkgIHRoaXMuc3RhZ2VQYXJhbWV0ZXJzID0gbnVsbDsKCQkJICB0aGlzLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwoJCQkgIHRoaXMubGF5ZXJfID0gbnVsbDsKCQkJICB0aGlzLm9yaWdpbmFsUGFyZW50XyA9IG51bGw7CgkJCSAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8gPSBudWxsOwoJCQkgIHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50Q2FjaGVkU3R5bGVfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBudWxsOwoJCQkgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKCQkJICBpZiAoVVNFX1dBS0VMT0NLICYmIGlzTW9iaWxlKCkpIHsKCQkJICAgIHRoaXMud2FrZWxvY2tfID0gbmV3IE5vU2xlZXAkMSgpOwoJCQkgIH0KCQkJfQoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmdldEZyYW1lRGF0YSA9IGZ1bmN0aW9uIChmcmFtZURhdGEpIHsKCQkJICByZXR1cm4gZnJhbWVEYXRhRnJvbVBvc2UoZnJhbWVEYXRhLCB0aGlzLl9nZXRQb3NlKCksIHRoaXMpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmdldFBvc2UgPSBmdW5jdGlvbiAoKSB7CgkJCSAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRQb3NlJywgJ1ZSRGlzcGxheS5wcm90b3R5cGUuZ2V0RnJhbWVEYXRhJyk7CgkJCSAgcmV0dXJuIHRoaXMuX2dldFBvc2UoKTsKCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5yZXNldFBvc2UgPSBmdW5jdGlvbiAoKSB7CgkJCSAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5yZXNldFBvc2UnKTsKCQkJICByZXR1cm4gdGhpcy5fcmVzZXRQb3NlKCk7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuZ2V0SW1tZWRpYXRlUG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkJICBkZXByZWNhdGVXYXJuaW5nKCdWUkRpc3BsYXkucHJvdG90eXBlLmdldEltbWVkaWF0ZVBvc2UnLCAnVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEnKTsKCQkJICByZXR1cm4gdGhpcy5fZ2V0UG9zZSgpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewoJCQkgIHJldHVybiByYWYoY2FsbGJhY2spOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24gKGlkKSB7CgkJCSAgcmV0dXJuIGNhZihpZCk7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUud3JhcEZvckZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoZWxlbWVudCkgewoJCQkgIHJldHVybiBlbGVtZW50OwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICghdGhpcy5mdWxsc2NyZWVuRWxlbWVudF8pIHsKCQkJICAgIHJldHVybjsKCQkJICB9CgkJCSAgdmFyIGVsZW1lbnQgPSB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XzsKCQkJICBpZiAodGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXykgewoJCQkgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyk7CgkJCSAgfSBlbHNlIHsKCQkJICAgIGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdzdHlsZScpOwoJCQkgIH0KCQkJICB0aGlzLmZ1bGxzY3JlZW5FbGVtZW50XyA9IG51bGw7CgkJCSAgdGhpcy5mdWxsc2NyZWVuRWxlbWVudENhY2hlZFN0eWxlXyA9IG51bGw7CgkJCSAgdmFyIHBhcmVudCA9IHRoaXMuZnVsbHNjcmVlbldyYXBwZXJfLnBhcmVudEVsZW1lbnQ7CgkJCSAgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8ucmVtb3ZlQ2hpbGQoZWxlbWVudCk7CgkJCSAgaWYgKHRoaXMub3JpZ2luYWxQYXJlbnRfID09PSBwYXJlbnQpIHsKCQkJICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZWxlbWVudCwgdGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8pOwoJCQkgIH0KCQkJICBlbHNlIGlmICh0aGlzLm9yaWdpbmFsUGFyZW50XykgewoJCQkgICAgICB0aGlzLm9yaWdpbmFsUGFyZW50Xy5hcHBlbmRDaGlsZChlbGVtZW50KTsKCQkJICAgIH0KCQkJICBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy5mdWxsc2NyZWVuV3JhcHBlcl8pOwoJCQkgIHJldHVybiBlbGVtZW50OwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlcXVlc3RQcmVzZW50ID0gZnVuY3Rpb24gKGxheWVycykgewoJCQkgIHZhciB3YXNQcmVzZW50aW5nID0gdGhpcy5pc1ByZXNlbnRpbmc7CgkJCSAgdmFyIHNlbGYgPSB0aGlzOwoJCQkgIGlmICghKGxheWVycyBpbnN0YW5jZW9mIEFycmF5KSkgewoJCQkgICAgZGVwcmVjYXRlV2FybmluZygnVlJEaXNwbGF5LnByb3RvdHlwZS5yZXF1ZXN0UHJlc2VudCB3aXRoIG5vbi1hcnJheSBhcmd1bWVudCcsICdhbiBhcnJheSBvZiBWUkxheWVycyBhcyB0aGUgZmlyc3QgYXJndW1lbnQnKTsKCQkJICAgIGxheWVycyA9IFtsYXllcnNdOwoJCQkgIH0KCQkJICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoJCQkgICAgaWYgKCFzZWxmLmNhcGFiaWxpdGllcy5jYW5QcmVzZW50KSB7CgkJCSAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1ZSRGlzcGxheSBpcyBub3QgY2FwYWJsZSBvZiBwcmVzZW50aW5nLicpKTsKCQkJICAgICAgcmV0dXJuOwoJCQkgICAgfQoJCQkgICAgaWYgKGxheWVycy5sZW5ndGggPT0gMCB8fCBsYXllcnMubGVuZ3RoID4gc2VsZi5jYXBhYmlsaXRpZXMubWF4TGF5ZXJzKSB7CgkJCSAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0ludmFsaWQgbnVtYmVyIG9mIGxheWVycy4nKSk7CgkJCSAgICAgIHJldHVybjsKCQkJICAgIH0KCQkJICAgIHZhciBpbmNvbWluZ0xheWVyID0gbGF5ZXJzWzBdOwoJCQkgICAgaWYgKCFpbmNvbWluZ0xheWVyLnNvdXJjZSkgewoJCQkgICAgICByZXNvbHZlKCk7CgkJCSAgICAgIHJldHVybjsKCQkJICAgIH0KCQkJICAgIHZhciBsZWZ0Qm91bmRzID0gaW5jb21pbmdMYXllci5sZWZ0Qm91bmRzIHx8IGRlZmF1bHRMZWZ0Qm91bmRzOwoJCQkgICAgdmFyIHJpZ2h0Qm91bmRzID0gaW5jb21pbmdMYXllci5yaWdodEJvdW5kcyB8fCBkZWZhdWx0UmlnaHRCb3VuZHM7CgkJCSAgICBpZiAod2FzUHJlc2VudGluZykgewoJCQkgICAgICB2YXIgbGF5ZXIgPSBzZWxmLmxheWVyXzsKCQkJICAgICAgaWYgKGxheWVyLnNvdXJjZSAhPT0gaW5jb21pbmdMYXllci5zb3VyY2UpIHsKCQkJICAgICAgICBsYXllci5zb3VyY2UgPSBpbmNvbWluZ0xheWVyLnNvdXJjZTsKCQkJICAgICAgfQoJCQkgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgewoJCQkgICAgICAgIGxheWVyLmxlZnRCb3VuZHNbaV0gPSBsZWZ0Qm91bmRzW2ldOwoJCQkgICAgICAgIGxheWVyLnJpZ2h0Qm91bmRzW2ldID0gcmlnaHRCb3VuZHNbaV07CgkJCSAgICAgIH0KCQkJICAgICAgc2VsZi53cmFwRm9yRnVsbHNjcmVlbihzZWxmLmxheWVyXy5zb3VyY2UpOwoJCQkgICAgICBzZWxmLnVwZGF0ZVByZXNlbnRfKCk7CgkJCSAgICAgIHJlc29sdmUoKTsKCQkJICAgICAgcmV0dXJuOwoJCQkgICAgfQoJCQkgICAgc2VsZi5sYXllcl8gPSB7CgkJCSAgICAgIHByZWRpc3RvcnRlZDogaW5jb21pbmdMYXllci5wcmVkaXN0b3J0ZWQsCgkJCSAgICAgIHNvdXJjZTogaW5jb21pbmdMYXllci5zb3VyY2UsCgkJCSAgICAgIGxlZnRCb3VuZHM6IGxlZnRCb3VuZHMuc2xpY2UoMCksCgkJCSAgICAgIHJpZ2h0Qm91bmRzOiByaWdodEJvdW5kcy5zbGljZSgwKQoJCQkgICAgfTsKCQkJICAgIHNlbGYud2FpdGluZ0ZvclByZXNlbnRfID0gZmFsc2U7CgkJCSAgICBpZiAoc2VsZi5sYXllcl8gJiYgc2VsZi5sYXllcl8uc291cmNlKSB7CgkJCSAgICAgIHZhciBmdWxsc2NyZWVuRWxlbWVudCA9IHNlbGYud3JhcEZvckZ1bGxzY3JlZW4oc2VsZi5sYXllcl8uc291cmNlKTsKCQkJICAgICAgdmFyIG9uRnVsbHNjcmVlbkNoYW5nZSA9IGZ1bmN0aW9uIG9uRnVsbHNjcmVlbkNoYW5nZSgpIHsKCQkJICAgICAgICB2YXIgYWN0dWFsRnVsbHNjcmVlbkVsZW1lbnQgPSBnZXRGdWxsc2NyZWVuRWxlbWVudCgpOwoJCQkgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gZnVsbHNjcmVlbkVsZW1lbnQgPT09IGFjdHVhbEZ1bGxzY3JlZW5FbGVtZW50OwoJCQkgICAgICAgIGlmIChzZWxmLmlzUHJlc2VudGluZykgewoJCQkgICAgICAgICAgaWYgKHNjcmVlbi5vcmllbnRhdGlvbiAmJiBzY3JlZW4ub3JpZW50YXRpb24ubG9jaykgewoJCQkgICAgICAgICAgICBzY3JlZW4ub3JpZW50YXRpb24ubG9jaygnbGFuZHNjYXBlLXByaW1hcnknKS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKCQkJICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdzY3JlZW4ub3JpZW50YXRpb24ubG9jaygpIGZhaWxlZCBkdWUgdG8nLCBlcnJvci5tZXNzYWdlKTsKCQkJICAgICAgICAgICAgfSk7CgkJCSAgICAgICAgICB9CgkJCSAgICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwoJCQkgICAgICAgICAgc2VsZi5iZWdpblByZXNlbnRfKCk7CgkJCSAgICAgICAgICByZXNvbHZlKCk7CgkJCSAgICAgICAgfSBlbHNlIHsKCQkJICAgICAgICAgIGlmIChzY3JlZW4ub3JpZW50YXRpb24gJiYgc2NyZWVuLm9yaWVudGF0aW9uLnVubG9jaykgewoJCQkgICAgICAgICAgICBzY3JlZW4ub3JpZW50YXRpb24udW5sb2NrKCk7CgkJCSAgICAgICAgICB9CgkJCSAgICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5XcmFwcGVyKCk7CgkJCSAgICAgICAgICBzZWxmLmRpc2FibGVXYWtlTG9jaygpOwoJCQkgICAgICAgICAgc2VsZi5lbmRQcmVzZW50XygpOwoJCQkgICAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuTGlzdGVuZXJzXygpOwoJCQkgICAgICAgIH0KCQkJICAgICAgICBzZWxmLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXygpOwoJCQkgICAgICB9OwoJCQkgICAgICB2YXIgb25GdWxsc2NyZWVuRXJyb3IgPSBmdW5jdGlvbiBvbkZ1bGxzY3JlZW5FcnJvcigpIHsKCQkJICAgICAgICBpZiAoIXNlbGYud2FpdGluZ0ZvclByZXNlbnRfKSB7CgkJCSAgICAgICAgICByZXR1cm47CgkJCSAgICAgICAgfQoJCQkgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbldyYXBwZXIoKTsKCQkJICAgICAgICBzZWxmLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfKCk7CgkJCSAgICAgICAgc2VsZi5kaXNhYmxlV2FrZUxvY2soKTsKCQkJICAgICAgICBzZWxmLndhaXRpbmdGb3JQcmVzZW50XyA9IGZhbHNlOwoJCQkgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gZmFsc2U7CgkJCSAgICAgICAgcmVqZWN0KG5ldyBFcnJvcignVW5hYmxlIHRvIHByZXNlbnQuJykpOwoJCQkgICAgICB9OwoJCQkgICAgICBzZWxmLmFkZEZ1bGxzY3JlZW5MaXN0ZW5lcnNfKGZ1bGxzY3JlZW5FbGVtZW50LCBvbkZ1bGxzY3JlZW5DaGFuZ2UsIG9uRnVsbHNjcmVlbkVycm9yKTsKCQkJICAgICAgaWYgKHJlcXVlc3RGdWxsc2NyZWVuKCkpIHsKCQkJICAgICAgICBzZWxmLmVuYWJsZVdha2VMb2NrKCk7CgkJCSAgICAgICAgc2VsZi53YWl0aW5nRm9yUHJlc2VudF8gPSB0cnVlOwoJCQkgICAgICB9IGVsc2UgaWYgKGlzSU9TKCkgfHwgaXNXZWJWaWV3QW5kcm9pZCgpKSB7CgkJCSAgICAgICAgc2VsZi5lbmFibGVXYWtlTG9jaygpOwoJCQkgICAgICAgIHNlbGYuaXNQcmVzZW50aW5nID0gdHJ1ZTsKCQkJICAgICAgICBzZWxmLmJlZ2luUHJlc2VudF8oKTsKCQkJICAgICAgICBzZWxmLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXygpOwoJCQkgICAgICAgIHJlc29sdmUoKTsKCQkJICAgICAgfQoJCQkgICAgfQoJCQkgICAgaWYgKCFzZWxmLndhaXRpbmdGb3JQcmVzZW50XyAmJiAhaXNJT1MoKSkgewoJCQkgICAgICBleGl0RnVsbHNjcmVlbigpOwoJCQkgICAgICByZWplY3QobmV3IEVycm9yKCdVbmFibGUgdG8gcHJlc2VudC4nKSk7CgkJCSAgICB9CgkJCSAgfSk7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuZXhpdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIHdhc1ByZXNlbnRpbmcgPSB0aGlzLmlzUHJlc2VudGluZzsKCQkJICB2YXIgc2VsZiA9IHRoaXM7CgkJCSAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKCQkJICB0aGlzLmxheWVyXyA9IG51bGw7CgkJCSAgdGhpcy5kaXNhYmxlV2FrZUxvY2soKTsKCQkJICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoJCQkgICAgaWYgKHdhc1ByZXNlbnRpbmcpIHsKCQkJICAgICAgaWYgKCFleGl0RnVsbHNjcmVlbigpICYmIGlzSU9TKCkpIHsKCQkJICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CgkJCSAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKCQkJICAgICAgfQoJCQkgICAgICBpZiAoaXNXZWJWaWV3QW5kcm9pZCgpKSB7CgkJCSAgICAgICAgc2VsZi5yZW1vdmVGdWxsc2NyZWVuV3JhcHBlcigpOwoJCQkgICAgICAgIHNlbGYucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKCQkJICAgICAgICBzZWxmLmVuZFByZXNlbnRfKCk7CgkJCSAgICAgICAgc2VsZi5maXJlVlJEaXNwbGF5UHJlc2VudENoYW5nZV8oKTsKCQkJICAgICAgfQoJCQkgICAgICByZXNvbHZlKCk7CgkJCSAgICB9IGVsc2UgewoJCQkgICAgICByZWplY3QobmV3IEVycm9yKCdXYXMgbm90IHByZXNlbnRpbmcgdG8gVlJEaXNwbGF5LicpKTsKCQkJICAgIH0KCQkJICB9KTsKCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRMYXllcnMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKHRoaXMubGF5ZXJfKSB7CgkJCSAgICByZXR1cm4gW3RoaXMubGF5ZXJfXTsKCQkJICB9CgkJCSAgcmV0dXJuIFtdOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlQcmVzZW50Q2hhbmdlXyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CgkJCSAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmZpcmVWUkRpc3BsYXlDb25uZWN0XyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheWNvbm5lY3QnLCB7IGRldGFpbDogeyBkaXNwbGF5OiB0aGlzIH0gfSk7CgkJCSAgd2luZG93LmRpc3BhdGNoRXZlbnQoZXZlbnQpOwoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmFkZEZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNoYW5nZUhhbmRsZXIsIGVycm9ySGFuZGxlcikgewoJCQkgIHRoaXMucmVtb3ZlRnVsbHNjcmVlbkxpc3RlbmVyc18oKTsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBlbGVtZW50OwoJCQkgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gY2hhbmdlSGFuZGxlcjsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gZXJyb3JIYW5kbGVyOwoJCQkgIGlmIChjaGFuZ2VIYW5kbGVyKSB7CgkJCSAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVuYWJsZWQpIHsKCQkJICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1vekZ1bGxTY3JlZW5FbmFibGVkKSB7CgkJCSAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9IGVsc2UgaWYgKGRvY3VtZW50Lm1zRnVsbHNjcmVlbkVuYWJsZWQpIHsKCQkJICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5jaGFuZ2UnLCBjaGFuZ2VIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9CgkJCSAgfQoJCQkgIGlmIChlcnJvckhhbmRsZXIpIHsKCQkJICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgfSBlbHNlIGlmIChkb2N1bWVudC53ZWJraXRGdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3dlYmtpdGZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgfSBlbHNlIGlmIChkb2N1bWVudC5tb3pGdWxsU2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3pmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKCQkJICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubXNGdWxsc2NyZWVuRW5hYmxlZCkgewoJCQkgICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21zZnVsbHNjcmVlbmVycm9yJywgZXJyb3JIYW5kbGVyLCBmYWxzZSk7CgkJCSAgICB9CgkJCSAgfQoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLnJlbW92ZUZ1bGxzY3JlZW5MaXN0ZW5lcnNfID0gZnVuY3Rpb24gKCkgewoJCQkgIGlmICghdGhpcy5mdWxsc2NyZWVuRXZlbnRUYXJnZXRfKSByZXR1cm47CgkJCSAgdmFyIGVsZW1lbnQgPSB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF87CgkJCSAgaWYgKHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfKSB7CgkJCSAgICB2YXIgY2hhbmdlSGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW96ZnVsbHNjcmVlbmNoYW5nZScsIGNoYW5nZUhhbmRsZXIsIGZhbHNlKTsKCQkJICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbXNmdWxsc2NyZWVuY2hhbmdlJywgY2hhbmdlSGFuZGxlciwgZmFsc2UpOwoJCQkgIH0KCQkJICBpZiAodGhpcy5mdWxsc2NyZWVuRXJyb3JIYW5kbGVyXykgewoJCQkgICAgdmFyIGVycm9ySGFuZGxlciA9IHRoaXMuZnVsbHNjcmVlbkVycm9ySGFuZGxlcl87CgkJCSAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd3ZWJraXRmdWxsc2NyZWVuZXJyb3InLCBlcnJvckhhbmRsZXIsIGZhbHNlKTsKCQkJICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vemZ1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtc2Z1bGxzY3JlZW5lcnJvcicsIGVycm9ySGFuZGxlciwgZmFsc2UpOwoJCQkgIH0KCQkJICB0aGlzLmZ1bGxzY3JlZW5FdmVudFRhcmdldF8gPSBudWxsOwoJCQkgIHRoaXMuZnVsbHNjcmVlbkNoYW5nZUhhbmRsZXJfID0gbnVsbDsKCQkJICB0aGlzLmZ1bGxzY3JlZW5FcnJvckhhbmRsZXJfID0gbnVsbDsKCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5lbmFibGVXYWtlTG9jayA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy53YWtlbG9ja18pIHsKCQkJICAgIHRoaXMud2FrZWxvY2tfLmVuYWJsZSgpOwoJCQkgIH0KCQkJfTsKCQkJVlJEaXNwbGF5LnByb3RvdHlwZS5kaXNhYmxlV2FrZUxvY2sgPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKHRoaXMud2FrZWxvY2tfKSB7CgkJCSAgICB0aGlzLndha2Vsb2NrXy5kaXNhYmxlKCk7CgkJCSAgfQoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmJlZ2luUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuZW5kUHJlc2VudF8gPSBmdW5jdGlvbiAoKSB7CgkJCX07CgkJCVZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewoJCQl9OwoJCQlWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKCQkJICByZXR1cm4gbnVsbDsKCQkJfTsKCQkJdmFyIGNvbmZpZyA9IHsKCQkJICBBRERJVElPTkFMX1ZJRVdFUlM6IFtdLAoJCQkgIERFRkFVTFRfVklFV0VSOiAnJywKCQkJICBNT0JJTEVfV0FLRV9MT0NLOiB0cnVlLAoJCQkgIERFQlVHOiBmYWxzZSwKCQkJICBEUERCX1VSTDogJ2h0dHBzOi8vZHBkYi53ZWJ2ci5yb2Nrcy9kcGRiLmpzb24nLAoJCQkgIEtfRklMVEVSOiAwLjk4LAoJCQkgIFBSRURJQ1RJT05fVElNRV9TOiAwLjA0MCwKCQkJICBDQVJEQk9BUkRfVUlfRElTQUJMRUQ6IGZhbHNlLAoJCQkgIFJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQ6IGZhbHNlLAoJCQkgIFlBV19PTkxZOiBmYWxzZSwKCQkJICBCVUZGRVJfU0NBTEU6IDAuNSwKCQkJICBESVJUWV9TVUJNSVRfRlJBTUVfQklORElOR1M6IGZhbHNlCgkJCX07CgkJCXZhciBFeWUgPSB7CgkJCSAgTEVGVDogJ2xlZnQnLAoJCQkgIFJJR0hUOiAncmlnaHQnCgkJCX07CgkJCWZ1bmN0aW9uIENhcmRib2FyZFZSRGlzcGxheShjb25maWckJDEpIHsKCQkJICB2YXIgZGVmYXVsdHMgPSBleHRlbmQoe30sIGNvbmZpZyk7CgkJCSAgY29uZmlnJCQxID0gZXh0ZW5kKGRlZmF1bHRzLCBjb25maWckJDEgfHwge30pOwoJCQkgIFZSRGlzcGxheS5jYWxsKHRoaXMsIHsKCQkJICAgIHdha2Vsb2NrOiBjb25maWckJDEuTU9CSUxFX1dBS0VfTE9DSwoJCQkgIH0pOwoJCQkgIHRoaXMuY29uZmlnID0gY29uZmlnJCQxOwoJCQkgIHRoaXMuZGlzcGxheU5hbWUgPSAnQ2FyZGJvYXJkIFZSRGlzcGxheSc7CgkJCSAgdGhpcy5jYXBhYmlsaXRpZXMgPSBuZXcgVlJEaXNwbGF5Q2FwYWJpbGl0aWVzKHsKCQkJICAgIGhhc1Bvc2l0aW9uOiBmYWxzZSwKCQkJICAgIGhhc09yaWVudGF0aW9uOiB0cnVlLAoJCQkgICAgaGFzRXh0ZXJuYWxEaXNwbGF5OiBmYWxzZSwKCQkJICAgIGNhblByZXNlbnQ6IHRydWUsCgkJCSAgICBtYXhMYXllcnM6IDEKCQkJICB9KTsKCQkJICB0aGlzLnN0YWdlUGFyYW1ldGVycyA9IG51bGw7CgkJCSAgdGhpcy5idWZmZXJTY2FsZV8gPSB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEU7CgkJCSAgdGhpcy5wb3NlU2Vuc29yXyA9IG5ldyBQb3NlU2Vuc29yKHRoaXMuY29uZmlnKTsKCQkJICB0aGlzLmRpc3RvcnRlcl8gPSBudWxsOwoJCQkgIHRoaXMuY2FyZGJvYXJkVUlfID0gbnVsbDsKCQkJICB0aGlzLmRwZGJfID0gbmV3IERwZGIodGhpcy5jb25maWcuRFBEQl9VUkwsIHRoaXMub25EZXZpY2VQYXJhbXNVcGRhdGVkXy5iaW5kKHRoaXMpKTsKCQkJICB0aGlzLmRldmljZUluZm9fID0gbmV3IERldmljZUluZm8odGhpcy5kcGRiXy5nZXREZXZpY2VQYXJhbXMoKSwgY29uZmlnJCQxLkFERElUSU9OQUxfVklFV0VSUyk7CgkJCSAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8gPSBuZXcgVmlld2VyU2VsZWN0b3IoY29uZmlnJCQxLkRFRkFVTFRfVklFV0VSKTsKCQkJICB0aGlzLnZpZXdlclNlbGVjdG9yXy5vbkNoYW5nZSh0aGlzLm9uVmlld2VyQ2hhbmdlZF8uYmluZCh0aGlzKSk7CgkJCSAgdGhpcy5kZXZpY2VJbmZvXy5zZXRWaWV3ZXIodGhpcy52aWV3ZXJTZWxlY3Rvcl8uZ2V0Q3VycmVudFZpZXdlcigpKTsKCQkJICBpZiAoIXRoaXMuY29uZmlnLlJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQpIHsKCQkJICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXyA9IG5ldyBSb3RhdGVJbnN0cnVjdGlvbnMoKTsKCQkJICB9CgkJCSAgaWYgKGlzSU9TKCkpIHsKCQkJICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uUmVzaXplXy5iaW5kKHRoaXMpKTsKCQkJICB9CgkJCX0KCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVlJEaXNwbGF5LnByb3RvdHlwZSk7CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX2dldFBvc2UgPSBmdW5jdGlvbiAoKSB7CgkJCSAgcmV0dXJuIHsKCQkJICAgIHBvc2l0aW9uOiBudWxsLAoJCQkgICAgb3JpZW50YXRpb246IHRoaXMucG9zZVNlbnNvcl8uZ2V0T3JpZW50YXRpb24oKSwKCQkJICAgIGxpbmVhclZlbG9jaXR5OiBudWxsLAoJCQkgICAgbGluZWFyQWNjZWxlcmF0aW9uOiBudWxsLAoJCQkgICAgYW5ndWxhclZlbG9jaXR5OiBudWxsLAoJCQkgICAgYW5ndWxhckFjY2VsZXJhdGlvbjogbnVsbAoJCQkgIH07CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuX3Jlc2V0UG9zZSA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5wb3NlU2Vuc29yXy5yZXNldFBvc2UpIHsKCQkJICAgIHRoaXMucG9zZVNlbnNvcl8ucmVzZXRQb3NlKCk7CgkJCSAgfQoJCQl9OwoJCQlDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLl9nZXRGaWVsZE9mVmlldyA9IGZ1bmN0aW9uICh3aGljaEV5ZSkgewoJCQkgIHZhciBmaWVsZE9mVmlldzsKCQkJICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKCQkJICAgIGZpZWxkT2ZWaWV3ID0gdGhpcy5kZXZpY2VJbmZvXy5nZXRGaWVsZE9mVmlld0xlZnRFeWUoKTsKCQkJICB9IGVsc2UgaWYgKHdoaWNoRXllID09IEV5ZS5SSUdIVCkgewoJCQkgICAgZmllbGRPZlZpZXcgPSB0aGlzLmRldmljZUluZm9fLmdldEZpZWxkT2ZWaWV3UmlnaHRFeWUoKTsKCQkJICB9IGVsc2UgewoJCQkgICAgY29uc29sZS5lcnJvcignSW52YWxpZCBleWUgcHJvdmlkZWQ6ICVzJywgd2hpY2hFeWUpOwoJCQkgICAgcmV0dXJuIG51bGw7CgkJCSAgfQoJCQkgIHJldHVybiBmaWVsZE9mVmlldzsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5fZ2V0RXllT2Zmc2V0ID0gZnVuY3Rpb24gKHdoaWNoRXllKSB7CgkJCSAgdmFyIG9mZnNldDsKCQkJICBpZiAod2hpY2hFeWUgPT0gRXllLkxFRlQpIHsKCQkJICAgIG9mZnNldCA9IFstdGhpcy5kZXZpY2VJbmZvXy52aWV3ZXIuaW50ZXJMZW5zRGlzdGFuY2UgKiAwLjUsIDAuMCwgMC4wXTsKCQkJICB9IGVsc2UgaWYgKHdoaWNoRXllID09IEV5ZS5SSUdIVCkgewoJCQkgICAgb2Zmc2V0ID0gW3RoaXMuZGV2aWNlSW5mb18udmlld2VyLmludGVyTGVuc0Rpc3RhbmNlICogMC41LCAwLjAsIDAuMF07CgkJCSAgfSBlbHNlIHsKCQkJICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgZXllIHByb3ZpZGVkOiAlcycsIHdoaWNoRXllKTsKCQkJICAgIHJldHVybiBudWxsOwoJCQkgIH0KCQkJICByZXR1cm4gb2Zmc2V0OwoJCQl9OwoJCQlDYXJkYm9hcmRWUkRpc3BsYXkucHJvdG90eXBlLmdldEV5ZVBhcmFtZXRlcnMgPSBmdW5jdGlvbiAod2hpY2hFeWUpIHsKCQkJICB2YXIgb2Zmc2V0ID0gdGhpcy5fZ2V0RXllT2Zmc2V0KHdoaWNoRXllKTsKCQkJICB2YXIgZmllbGRPZlZpZXcgPSB0aGlzLl9nZXRGaWVsZE9mVmlldyh3aGljaEV5ZSk7CgkJCSAgdmFyIGV5ZVBhcmFtcyA9IHsKCQkJICAgIG9mZnNldDogb2Zmc2V0LAoJCQkgICAgcmVuZGVyV2lkdGg6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLndpZHRoICogMC41ICogdGhpcy5idWZmZXJTY2FsZV8sCgkJCSAgICByZW5kZXJIZWlnaHQ6IHRoaXMuZGV2aWNlSW5mb18uZGV2aWNlLmhlaWdodCAqIHRoaXMuYnVmZmVyU2NhbGVfCgkJCSAgfTsKCQkJICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXllUGFyYW1zLCAnZmllbGRPZlZpZXcnLCB7CgkJCSAgICBlbnVtZXJhYmxlOiB0cnVlLAoJCQkgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkJCSAgICAgIGRlcHJlY2F0ZVdhcm5pbmcoJ1ZSRmllbGRPZlZpZXcnLCAnVlJGcmFtZURhdGFcJ3MgcHJvamVjdGlvbiBtYXRyaWNlcycpOwoJCQkgICAgICByZXR1cm4gZmllbGRPZlZpZXc7CgkJCSAgICB9CgkJCSAgfSk7CgkJCSAgcmV0dXJuIGV5ZVBhcmFtczsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbkRldmljZVBhcmFtc1VwZGF0ZWRfID0gZnVuY3Rpb24gKG5ld1BhcmFtcykgewoJCQkgIGlmICh0aGlzLmNvbmZpZy5ERUJVRykgewoJCQkgICAgY29uc29sZS5sb2coJ0RQREIgcmVwb3J0ZWQgdGhhdCBkZXZpY2UgcGFyYW1zIHdlcmUgdXBkYXRlZC4nKTsKCQkJICB9CgkJCSAgdGhpcy5kZXZpY2VJbmZvXy51cGRhdGVEZXZpY2VQYXJhbXMobmV3UGFyYW1zKTsKCQkJICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CgkJCSAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKCQkJICB9CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUudXBkYXRlQm91bmRzXyA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5sYXllcl8gJiYgdGhpcy5kaXN0b3J0ZXJfICYmICh0aGlzLmxheWVyXy5sZWZ0Qm91bmRzIHx8IHRoaXMubGF5ZXJfLnJpZ2h0Qm91bmRzKSkgewoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfLnNldFRleHR1cmVCb3VuZHModGhpcy5sYXllcl8ubGVmdEJvdW5kcywgdGhpcy5sYXllcl8ucmlnaHRCb3VuZHMpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5iZWdpblByZXNlbnRfID0gZnVuY3Rpb24gKCkgewoJCQkgIHZhciBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCd3ZWJnbCcpOwoJCQkgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ2V4cGVyaW1lbnRhbC13ZWJnbCcpOwoJCQkgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwoJCQkgIGlmICghZ2wpIHJldHVybjsKCQkJICBpZiAodGhpcy5sYXllcl8ucHJlZGlzdG9ydGVkKSB7CgkJCSAgICBpZiAoIXRoaXMuY29uZmlnLkNBUkRCT0FSRF9VSV9ESVNBQkxFRCkgewoJCQkgICAgICBnbC5jYW52YXMud2lkdGggPSBnZXRTY3JlZW5XaWR0aCgpICogdGhpcy5idWZmZXJTY2FsZV87CgkJCSAgICAgIGdsLmNhbnZhcy5oZWlnaHQgPSBnZXRTY3JlZW5IZWlnaHQoKSAqIHRoaXMuYnVmZmVyU2NhbGVfOwoJCQkgICAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG5ldyBDYXJkYm9hcmRVSShnbCk7CgkJCSAgICB9CgkJCSAgfSBlbHNlIHsKCQkJICAgIGlmICghdGhpcy5jb25maWcuQ0FSREJPQVJEX1VJX0RJU0FCTEVEKSB7CgkJCSAgICAgIHRoaXMuY2FyZGJvYXJkVUlfID0gbmV3IENhcmRib2FyZFVJKGdsKTsKCQkJICAgIH0KCQkJICAgIHRoaXMuZGlzdG9ydGVyXyA9IG5ldyBDYXJkYm9hcmREaXN0b3J0ZXIoZ2wsIHRoaXMuY2FyZGJvYXJkVUlfLCB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEUsIHRoaXMuY29uZmlnLkRJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUyk7CgkJCSAgICB0aGlzLmRpc3RvcnRlcl8udXBkYXRlRGV2aWNlSW5mbyh0aGlzLmRldmljZUluZm9fKTsKCQkJICB9CgkJCSAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJXy5saXN0ZW4oZnVuY3Rpb24gKGUpIHsKCQkJICAgICAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uc2hvdyh0aGlzLmxheWVyXy5zb3VyY2UucGFyZW50RWxlbWVudCk7CgkJCSAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7CgkJCSAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCQkJICAgIH0uYmluZCh0aGlzKSwgZnVuY3Rpb24gKGUpIHsKCQkJICAgICAgdGhpcy5leGl0UHJlc2VudCgpOwoJCQkgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwoJCQkgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgkJCSAgICB9LmJpbmQodGhpcykpOwoJCQkgIH0KCQkJICBpZiAodGhpcy5yb3RhdGVJbnN0cnVjdGlvbnNfKSB7CgkJCSAgICBpZiAoaXNMYW5kc2NhcGVNb2RlKCkgJiYgaXNNb2JpbGUoKSkgewoJCQkgICAgICB0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18uc2hvd1RlbXBvcmFyaWx5KDMwMDAsIHRoaXMubGF5ZXJfLnNvdXJjZS5wYXJlbnRFbGVtZW50KTsKCQkJICAgIH0gZWxzZSB7CgkJCSAgICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKCQkJICAgIH0KCQkJICB9CgkJCSAgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIgPSB0aGlzLm9uT3JpZW50YXRpb25DaGFuZ2VfLmJpbmQodGhpcyk7CgkJCSAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vcmllbnRhdGlvbkhhbmRsZXIpOwoJCQkgIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIgPSB0aGlzLnVwZGF0ZUJvdW5kc18uYmluZCh0aGlzKTsKCQkJICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIHRoaXMudnJkaXNwbGF5cHJlc2VudGNoYW5nZUhhbmRsZXIpOwoJCQkgIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5lbmRQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKCQkJICBpZiAodGhpcy5kaXN0b3J0ZXJfKSB7CgkJCSAgICB0aGlzLmRpc3RvcnRlcl8uZGVzdHJveSgpOwoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfID0gbnVsbDsKCQkJICB9CgkJCSAgaWYgKHRoaXMuY2FyZGJvYXJkVUlfKSB7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJXy5kZXN0cm95KCk7CgkJCSAgICB0aGlzLmNhcmRib2FyZFVJXyA9IG51bGw7CgkJCSAgfQoJCQkgIGlmICh0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18pIHsKCQkJICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy5oaWRlKCk7CgkJCSAgfQoJCQkgIHRoaXMudmlld2VyU2VsZWN0b3JfLmhpZGUoKTsKCQkJICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9yaWVudGF0aW9uSGFuZGxlcik7CgkJCSAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCB0aGlzLnZyZGlzcGxheXByZXNlbnRjaGFuZ2VIYW5kbGVyKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS51cGRhdGVQcmVzZW50XyA9IGZ1bmN0aW9uICgpIHsKCQkJICB0aGlzLmVuZFByZXNlbnRfKCk7CgkJCSAgdGhpcy5iZWdpblByZXNlbnRfKCk7CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5wcm90b3R5cGUuc3VibWl0RnJhbWUgPSBmdW5jdGlvbiAocG9zZSkgewoJCQkgIGlmICh0aGlzLmRpc3RvcnRlcl8pIHsKCQkJICAgIHRoaXMudXBkYXRlQm91bmRzXygpOwoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfLnN1Ym1pdEZyYW1lKCk7CgkJCSAgfSBlbHNlIGlmICh0aGlzLmNhcmRib2FyZFVJXyAmJiB0aGlzLmxheWVyXykgewoJCQkgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CgkJCSAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKCQkJICAgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwoJCQkgICAgdmFyIGNhbnZhcyA9IGdsLmNhbnZhczsKCQkJICAgIGlmIChjYW52YXMud2lkdGggIT0gdGhpcy5sYXN0V2lkdGggfHwgY2FudmFzLmhlaWdodCAhPSB0aGlzLmxhc3RIZWlnaHQpIHsKCQkJICAgICAgdGhpcy5jYXJkYm9hcmRVSV8ub25SZXNpemUoKTsKCQkJICAgIH0KCQkJICAgIHRoaXMubGFzdFdpZHRoID0gY2FudmFzLndpZHRoOwoJCQkgICAgdGhpcy5sYXN0SGVpZ2h0ID0gY2FudmFzLmhlaWdodDsKCQkJICAgIHRoaXMuY2FyZGJvYXJkVUlfLnJlbmRlcigpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vbk9yaWVudGF0aW9uQ2hhbmdlXyA9IGZ1bmN0aW9uIChlKSB7CgkJCSAgdGhpcy52aWV3ZXJTZWxlY3Rvcl8uaGlkZSgpOwoJCQkgIGlmICh0aGlzLnJvdGF0ZUluc3RydWN0aW9uc18pIHsKCQkJICAgIHRoaXMucm90YXRlSW5zdHJ1Y3Rpb25zXy51cGRhdGUoKTsKCQkJICB9CgkJCSAgdGhpcy5vblJlc2l6ZV8oKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblJlc2l6ZV8gPSBmdW5jdGlvbiAoZSkgewoJCQkgIGlmICh0aGlzLmxheWVyXykgewoJCQkgICAgdmFyIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsJyk7CgkJCSAgICBpZiAoIWdsKSBnbCA9IHRoaXMubGF5ZXJfLnNvdXJjZS5nZXRDb250ZXh0KCdleHBlcmltZW50YWwtd2ViZ2wnKTsKCQkJICAgIGlmICghZ2wpIGdsID0gdGhpcy5sYXllcl8uc291cmNlLmdldENvbnRleHQoJ3dlYmdsMicpOwoJCQkgICAgdmFyIGNzc1Byb3BlcnRpZXMgPSBbJ3Bvc2l0aW9uOiBhYnNvbHV0ZScsICd0b3A6IDAnLCAnbGVmdDogMCcsCgkJCSAgICAnd2lkdGg6IDEwMHZ3JywgJ2hlaWdodDogMTAwdmgnLCAnYm9yZGVyOiAwJywgJ21hcmdpbjogMCcsCgkJCSAgICAncGFkZGluZzogMHB4JywgJ2JveC1zaXppbmc6IGNvbnRlbnQtYm94J107CgkJCSAgICBnbC5jYW52YXMuc2V0QXR0cmlidXRlKCdzdHlsZScsIGNzc1Byb3BlcnRpZXMuam9pbignOyAnKSArICc7Jyk7CgkJCSAgICBzYWZhcmlDc3NTaXplV29ya2Fyb3VuZChnbC5jYW52YXMpOwoJCQkgIH0KCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5vblZpZXdlckNoYW5nZWRfID0gZnVuY3Rpb24gKHZpZXdlcikgewoJCQkgIHRoaXMuZGV2aWNlSW5mb18uc2V0Vmlld2VyKHZpZXdlcik7CgkJCSAgaWYgKHRoaXMuZGlzdG9ydGVyXykgewoJCQkgICAgdGhpcy5kaXN0b3J0ZXJfLnVwZGF0ZURldmljZUluZm8odGhpcy5kZXZpY2VJbmZvXyk7CgkJCSAgfQoJCQkgIHRoaXMuZmlyZVZSRGlzcGxheURldmljZVBhcmFtc0NoYW5nZV8oKTsKCQkJfTsKCQkJQ2FyZGJvYXJkVlJEaXNwbGF5LnByb3RvdHlwZS5maXJlVlJEaXNwbGF5RGV2aWNlUGFyYW1zQ2hhbmdlXyA9IGZ1bmN0aW9uICgpIHsKCQkJICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3ZyZGlzcGxheWRldmljZXBhcmFtc2NoYW5nZScsIHsKCQkJICAgIGRldGFpbDogewoJCQkgICAgICB2cmRpc3BsYXk6IHRoaXMsCgkJCSAgICAgIGRldmljZUluZm86IHRoaXMuZGV2aWNlSW5mb18KCQkJICAgIH0KCQkJICB9KTsKCQkJICB3aW5kb3cuZGlzcGF0Y2hFdmVudChldmVudCk7CgkJCX07CgkJCUNhcmRib2FyZFZSRGlzcGxheS5WUkZyYW1lRGF0YSA9IFZSRnJhbWVEYXRhOwoJCQlDYXJkYm9hcmRWUkRpc3BsYXkuVlJEaXNwbGF5ID0gVlJEaXNwbGF5OwoJCQlyZXR1cm4gQ2FyZGJvYXJkVlJEaXNwbGF5OwoJCQl9KSkpOwoJCQl9KTsKCQkJdmFyIENhcmRib2FyZFZSRGlzcGxheSA9IHVud3JhcEV4cG9ydHMoY2FyZGJvYXJkVnJEaXNwbGF5KTsKCgkJCXZhciB2ZXJzaW9uID0gIjAuMTAuMTIiOwoKCQkJdmFyIERlZmF1bHRDb25maWcgPSB7CgkJCSAgQURESVRJT05BTF9WSUVXRVJTOiBbXSwKCQkJICBERUZBVUxUX1ZJRVdFUjogJycsCgkJCSAgUFJPVklERV9NT0JJTEVfVlJESVNQTEFZOiB0cnVlLAoJCQkgIE1PQklMRV9XQUtFX0xPQ0s6IHRydWUsCgkJCSAgREVCVUc6IGZhbHNlLAoJCQkgIERQREJfVVJMOiAnaHR0cHM6Ly9kcGRiLndlYnZyLnJvY2tzL2RwZGIuanNvbicsCgkJCSAgS19GSUxURVI6IDAuOTgsCgkJCSAgUFJFRElDVElPTl9USU1FX1M6IDAuMDQwLAoJCQkgIENBUkRCT0FSRF9VSV9ESVNBQkxFRDogZmFsc2UsCgkJCSAgUk9UQVRFX0lOU1RSVUNUSU9OU19ESVNBQkxFRDogZmFsc2UsCgkJCSAgWUFXX09OTFk6IGZhbHNlLAoJCQkgIEJVRkZFUl9TQ0FMRTogMC41LAoJCQkgIERJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUzogZmFsc2UKCQkJfTsKCgkJCWZ1bmN0aW9uIFdlYlZSUG9seWZpbGwoY29uZmlnKSB7CgkJCSAgY29uc29sZS5sb2coInBvbHlmaWxsIGN0b3IiKTsKCQkJICBjb25zb2xlLmxvZyhjb25maWcpOwoJCQkgIHRoaXMuY29uZmlnID0gZXh0ZW5kKGV4dGVuZCh7fSwgRGVmYXVsdENvbmZpZyksIGNvbmZpZyk7CgkJCSAgdGhpcy5wb2x5ZmlsbERpc3BsYXlzID0gW107CgkJCSAgdGhpcy5lbmFibGVkID0gZmFsc2U7CgkJCSAgdGhpcy5oYXNOYXRpdmUgPSAnZ2V0VlJEaXNwbGF5cycgaW4gbmF2aWdhdG9yOwoJCQkgIHRoaXMubmF0aXZlID0ge307CgkJCSAgdGhpcy5uYXRpdmUuZ2V0VlJEaXNwbGF5cyA9IG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzOwoJCQkgIHRoaXMubmF0aXZlLlZSRnJhbWVEYXRhID0gd2luZG93LlZSRnJhbWVEYXRhOwoJCQkgIHRoaXMubmF0aXZlLlZSRGlzcGxheSA9IHdpbmRvdy5WUkRpc3BsYXk7CgkJCSAgaWYgKCF0aGlzLmhhc05hdGl2ZSB8fCB0aGlzLmNvbmZpZy5QUk9WSURFX01PQklMRV9WUkRJU1BMQVkgJiYgaXNNb2JpbGUoKSkgewoJCQkgICAgdGhpcy5lbmFibGUoKTsKCQkJICAgIHRoaXMuZ2V0VlJEaXNwbGF5cygpLnRoZW4oZnVuY3Rpb24gKGRpc3BsYXlzKSB7CgkJCSAgICAgIGlmIChkaXNwbGF5cyAmJiBkaXNwbGF5c1swXSAmJiBkaXNwbGF5c1swXS5maXJlVlJEaXNwbGF5Q29ubmVjdF8pIHsKCQkJICAgICAgICBkaXNwbGF5c1swXS5maXJlVlJEaXNwbGF5Q29ubmVjdF8oKTsKCQkJICAgICAgfQoJCQkgICAgfSk7CgkJCSAgfQoJCQl9CgkJCVdlYlZSUG9seWZpbGwucHJvdG90eXBlLmdldFBvbHlmaWxsRGlzcGxheXMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgaWYgKHRoaXMuX3BvbHlmaWxsRGlzcGxheXNQb3B1bGF0ZWQpIHsKCQkJICAgIHJldHVybiB0aGlzLnBvbHlmaWxsRGlzcGxheXM7CgkJCSAgfQoJCQkgIGlmIChpc01vYmlsZSgpKSB7CgkJCSAgICB2YXIgdnJEaXNwbGF5ID0gbmV3IENhcmRib2FyZFZSRGlzcGxheSh7CgkJCSAgICAgIEFERElUSU9OQUxfVklFV0VSUzogdGhpcy5jb25maWcuQURESVRJT05BTF9WSUVXRVJTLAoJCQkgICAgICBERUZBVUxUX1ZJRVdFUjogdGhpcy5jb25maWcuREVGQVVMVF9WSUVXRVIsCgkJCSAgICAgIE1PQklMRV9XQUtFX0xPQ0s6IHRoaXMuY29uZmlnLk1PQklMRV9XQUtFX0xPQ0ssCgkJCSAgICAgIERFQlVHOiB0aGlzLmNvbmZpZy5ERUJVRywKCQkJICAgICAgRFBEQl9VUkw6IHRoaXMuY29uZmlnLkRQREJfVVJMLAoJCQkgICAgICBDQVJEQk9BUkRfVUlfRElTQUJMRUQ6IHRoaXMuY29uZmlnLkNBUkRCT0FSRF9VSV9ESVNBQkxFRCwKCQkJICAgICAgS19GSUxURVI6IHRoaXMuY29uZmlnLktfRklMVEVSLAoJCQkgICAgICBQUkVESUNUSU9OX1RJTUVfUzogdGhpcy5jb25maWcuUFJFRElDVElPTl9USU1FX1MsCgkJCSAgICAgIFJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQ6IHRoaXMuY29uZmlnLlJPVEFURV9JTlNUUlVDVElPTlNfRElTQUJMRUQsCgkJCSAgICAgIFlBV19PTkxZOiB0aGlzLmNvbmZpZy5ZQVdfT05MWSwKCQkJICAgICAgQlVGRkVSX1NDQUxFOiB0aGlzLmNvbmZpZy5CVUZGRVJfU0NBTEUsCgkJCSAgICAgIERJUlRZX1NVQk1JVF9GUkFNRV9CSU5ESU5HUzogdGhpcy5jb25maWcuRElSVFlfU1VCTUlUX0ZSQU1FX0JJTkRJTkdTCgkJCSAgICB9KTsKCQkJICAgIHRoaXMucG9seWZpbGxEaXNwbGF5cy5wdXNoKHZyRGlzcGxheSk7CgkJCSAgfQoJCQkgIHRoaXMuX3BvbHlmaWxsRGlzcGxheXNQb3B1bGF0ZWQgPSB0cnVlOwoJCQkgIHJldHVybiB0aGlzLnBvbHlmaWxsRGlzcGxheXM7CgkJCX07CgkJCVdlYlZSUG9seWZpbGwucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHsKCQkJICB0aGlzLmVuYWJsZWQgPSB0cnVlOwoJCQkgIGlmICh0aGlzLmhhc05hdGl2ZSAmJiB0aGlzLm5hdGl2ZS5WUkZyYW1lRGF0YSkgewoJCQkgICAgdmFyIE5hdGl2ZVZSRnJhbWVEYXRhID0gdGhpcy5uYXRpdmUuVlJGcmFtZURhdGE7CgkJCSAgICB2YXIgbmF0aXZlRnJhbWVEYXRhID0gbmV3IHRoaXMubmF0aXZlLlZSRnJhbWVEYXRhKCk7CgkJCSAgICB2YXIgbmF0aXZlR2V0RnJhbWVEYXRhID0gdGhpcy5uYXRpdmUuVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGE7CgkJCSAgICB3aW5kb3cuVlJEaXNwbGF5LnByb3RvdHlwZS5nZXRGcmFtZURhdGEgPSBmdW5jdGlvbiAoZnJhbWVEYXRhKSB7CgkJCSAgICAgIGlmIChmcmFtZURhdGEgaW5zdGFuY2VvZiBOYXRpdmVWUkZyYW1lRGF0YSkgewoJCQkgICAgICAgIG5hdGl2ZUdldEZyYW1lRGF0YS5jYWxsKHRoaXMsIGZyYW1lRGF0YSk7CgkJCSAgICAgICAgcmV0dXJuOwoJCQkgICAgICB9CgkJCSAgICAgIG5hdGl2ZUdldEZyYW1lRGF0YS5jYWxsKHRoaXMsIG5hdGl2ZUZyYW1lRGF0YSk7CgkJCSAgICAgIGZyYW1lRGF0YS5wb3NlID0gbmF0aXZlRnJhbWVEYXRhLnBvc2U7CgkJCSAgICAgIGNvcHlBcnJheShuYXRpdmVGcmFtZURhdGEubGVmdFByb2plY3Rpb25NYXRyaXgsIGZyYW1lRGF0YS5sZWZ0UHJvamVjdGlvbk1hdHJpeCk7CgkJCSAgICAgIGNvcHlBcnJheShuYXRpdmVGcmFtZURhdGEucmlnaHRQcm9qZWN0aW9uTWF0cml4LCBmcmFtZURhdGEucmlnaHRQcm9qZWN0aW9uTWF0cml4KTsKCQkJICAgICAgY29weUFycmF5KG5hdGl2ZUZyYW1lRGF0YS5sZWZ0Vmlld01hdHJpeCwgZnJhbWVEYXRhLmxlZnRWaWV3TWF0cml4KTsKCQkJICAgICAgY29weUFycmF5KG5hdGl2ZUZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgsIGZyYW1lRGF0YS5yaWdodFZpZXdNYXRyaXgpOwoJCQkgICAgfTsKCQkJICB9CgkJCSAgbmF2aWdhdG9yLmdldFZSRGlzcGxheXMgPSB0aGlzLmdldFZSRGlzcGxheXMuYmluZCh0aGlzKTsKCQkJICB3aW5kb3cuVlJEaXNwbGF5ID0gQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRGlzcGxheTsKCQkJICB3aW5kb3cuVlJGcmFtZURhdGEgPSBDYXJkYm9hcmRWUkRpc3BsYXkuVlJGcmFtZURhdGE7CgkJCX07CgkJCVdlYlZSUG9seWZpbGwucHJvdG90eXBlLmdldFZSRGlzcGxheXMgPSBmdW5jdGlvbiAoKSB7CgkJCSAgdmFyIF90aGlzID0gdGhpczsKCQkJICB0aGlzLmNvbmZpZzsKCQkJICBpZiAoIXRoaXMuaGFzTmF0aXZlKSB7CgkJCSAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuZ2V0UG9seWZpbGxEaXNwbGF5cygpKTsKCQkJICB9CgkJCSAgcmV0dXJuIHRoaXMubmF0aXZlLmdldFZSRGlzcGxheXMuY2FsbChuYXZpZ2F0b3IpLnRoZW4oZnVuY3Rpb24gKG5hdGl2ZURpc3BsYXlzKSB7CgkJCSAgICByZXR1cm4gbmF0aXZlRGlzcGxheXMubGVuZ3RoID4gMCA/IG5hdGl2ZURpc3BsYXlzIDogX3RoaXMuZ2V0UG9seWZpbGxEaXNwbGF5cygpOwoJCQkgIH0pOwoJCQl9OwoJCQlXZWJWUlBvbHlmaWxsLnZlcnNpb24gPSB2ZXJzaW9uOwoJCQlXZWJWUlBvbHlmaWxsLlZSRnJhbWVEYXRhID0gQ2FyZGJvYXJkVlJEaXNwbGF5LlZSRnJhbWVEYXRhOwoJCQlXZWJWUlBvbHlmaWxsLlZSRGlzcGxheSA9IENhcmRib2FyZFZSRGlzcGxheS5WUkRpc3BsYXk7CgoKCQkJdmFyIHdlYnZyUG9seWZpbGwgPSBPYmplY3QuZnJlZXplKHsKCQkJCWRlZmF1bHQ6IFdlYlZSUG9seWZpbGwKCQkJfSk7CgoJCQl2YXIgcmVxdWlyZSQkMCA9ICggd2VidnJQb2x5ZmlsbCAmJiBXZWJWUlBvbHlmaWxsICkgfHwgd2VidnJQb2x5ZmlsbDsKCgkJCWlmICh0eXBlb2YgY29tbW9uanNHbG9iYWwkMSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29tbW9uanNHbG9iYWwkMS53aW5kb3cpIHsKCQkJICBpZiAoIWNvbW1vbmpzR2xvYmFsJDEuZG9jdW1lbnQpIHsKCQkJICAgIGNvbW1vbmpzR2xvYmFsJDEuZG9jdW1lbnQgPSBjb21tb25qc0dsb2JhbCQxLndpbmRvdy5kb2N1bWVudDsKCQkJICB9CgkJCSAgaWYgKCFjb21tb25qc0dsb2JhbCQxLm5hdmlnYXRvcikgewoJCQkgICAgY29tbW9uanNHbG9iYWwkMS5uYXZpZ2F0b3IgPSBjb21tb25qc0dsb2JhbCQxLndpbmRvdy5uYXZpZ2F0b3I7CgkJCSAgfQoJCQl9CgkJCXZhciBzcmMgPSByZXF1aXJlJCQwOwoKCQkJcmV0dXJuIHNyYzsKCgkJCX0pKSk7IAoJCX0gKHdlYnZyUG9seWZpbGwkMSkpOwoJCXJldHVybiB3ZWJ2clBvbHlmaWxsJDEuZXhwb3J0czsKCX0KCgl2YXIgd2VidnJQb2x5ZmlsbEV4cG9ydHMgPSByZXF1aXJlV2VidnJQb2x5ZmlsbCgpOwoJdmFyIFdlYlZSUG9seWZpbGwgPSAvKkBfX1BVUkVfXyovZ2V0RGVmYXVsdEV4cG9ydEZyb21DanMod2VidnJQb2x5ZmlsbEV4cG9ydHMpOwoKCS8qKgoJICogQGF1dGhvciBkbWFyY29zIC8gaHR0cHM6Ly9naXRodWIuY29tL2RtYXJjb3MKCSAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb20KCSAqCgkgKiBXZWJWUiBTcGVjOiBodHRwOi8vbW96dnIuZ2l0aHViLmlvL3dlYnZyLXNwZWMvd2VidnIuaHRtbAoJICoKCSAqIEZpcmVmb3g6IGh0dHA6Ly9tb3p2ci5jb20vZG93bmxvYWRzLwoJICogQ2hyb21pdW06IGh0dHBzOi8vd2VidnIuaW5mby9nZXQtY2hyb21lCgkgKi8KCgoJdmFyIFZSRWZmZWN0ID0gZnVuY3Rpb24gKCByZW5kZXJlciwgb25FcnJvciApIHsKCgkgICAgY29uc29sZS5sb2coIltWUkVmZmVjdF0gSW5pdC4iKTsKCgkgICAgdmFyIHZyRGlzcGxheSwgdnJEaXNwbGF5czsKCSAgICB2YXIgZXllVHJhbnNsYXRpb25MID0gbmV3IFZlY3RvcjMoKTsKCSAgICB2YXIgZXllVHJhbnNsYXRpb25SID0gbmV3IFZlY3RvcjMoKTsKCSAgICB2YXIgcmVuZGVyUmVjdEwsIHJlbmRlclJlY3RSOwoJICAgIHZhciBoZWFkTWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCSAgICB2YXIgZXllTWF0cml4TCA9IG5ldyBNYXRyaXg0KCk7CgkgICAgdmFyIGV5ZU1hdHJpeFIgPSBuZXcgTWF0cml4NCgpOwoKCSAgICB2YXIgZnJhbWVEYXRhID0gbnVsbDsKCgkgICAgaWYgKCAnVlJGcmFtZURhdGEnIGluIHdpbmRvdyApIHsKCgkgICAgICAgIGZyYW1lRGF0YSA9IG5ldyB3aW5kb3cuVlJGcmFtZURhdGEoKTsKCgkgICAgfQoKCSAgICBmdW5jdGlvbiBnb3RWUkRpc3BsYXlzKCBkaXNwbGF5cyApIHsKCgkgICAgICAgIHZyRGlzcGxheXMgPSBkaXNwbGF5czsKCgkgICAgICAgIGlmICggZGlzcGxheXMubGVuZ3RoID4gMCApIHsKCgkgICAgICAgICAgICB2ckRpc3BsYXkgPSBkaXNwbGF5c1sgMCBdOwoKCSAgICAgICAgfSBlbHNlIHsKCgkgICAgICAgICAgICBpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCAnSE1EIG5vdCBhdmFpbGFibGUnICk7CgoJICAgICAgICB9CgoJICAgIH0KCgkgICAgaWYgKCBuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cyApIHsKCgkgICAgICAgIG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKCkudGhlbiggZ290VlJEaXNwbGF5cyApLmNhdGNoKCBmdW5jdGlvbiAoKSB7CgoJICAgICAgICAgICAgY29uc29sZS53YXJuKCAnVEhSRUUuVlJFZmZlY3Q6IFVuYWJsZSB0byBnZXQgVlIgRGlzcGxheXMnICk7CgoJICAgICAgICB9ICk7CgoJICAgIH0KCgkgICAgLy8KCgkgICAgdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKCgkgICAgdmFyIHNjb3BlID0gdGhpczsKCgkgICAgdmFyIHJlbmRlcmVyU2l6ZSA9IG5ldyBWZWN0b3IyKCk7CgkgICAgcmVuZGVyZXJTaXplID0gcmVuZGVyZXIuZ2V0U2l6ZShyZW5kZXJlclNpemUpOwoJICAgIHZhciByZW5kZXJlclVwZGF0ZVN0eWxlID0gZmFsc2U7CgkgICAgdmFyIHJlbmRlcmVyUGl4ZWxSYXRpbyA9IHJlbmRlcmVyLmdldFBpeGVsUmF0aW8oKTsKCgkgICAgdGhpcy5nZXRWUkRpc3BsYXkgPSBmdW5jdGlvbiAoKSB7CgoJICAgICAgICByZXR1cm4gdnJEaXNwbGF5OwoKCSAgICB9OwoKCSAgICB0aGlzLnNldFZSRGlzcGxheSA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJICAgICAgICB2ckRpc3BsYXkgPSB2YWx1ZTsKCgkgICAgfTsKCgkgICAgdGhpcy5nZXRWUkRpc3BsYXlzID0gZnVuY3Rpb24gKCkgewoKCSAgICAgICAgY29uc29sZS53YXJuKCAnVEhSRUUuVlJFZmZlY3Q6IGdldFZSRGlzcGxheXMoKSBpcyBiZWluZyBkZXByZWNhdGVkLicgKTsKCSAgICAgICAgcmV0dXJuIHZyRGlzcGxheXM7CgoJICAgIH07CgoJICAgIHRoaXMuc2V0U2l6ZSA9IGZ1bmN0aW9uICggd2lkdGgsIGhlaWdodCwgdXBkYXRlU3R5bGUgKSB7CgoJICAgICAgICByZW5kZXJlclNpemUgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTsKCSAgICAgICAgcmVuZGVyZXJVcGRhdGVTdHlsZSA9IHVwZGF0ZVN0eWxlOwoKCSAgICAgICAgaWYgKCBzY29wZS5pc1ByZXNlbnRpbmcgKSB7CgoJICAgICAgICAgICAgdmFyIGV5ZVBhcmFtc0wgPSB2ckRpc3BsYXkuZ2V0RXllUGFyYW1ldGVycyggJ2xlZnQnICk7CgkgICAgICAgICAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKCAxICk7CgkgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKCBleWVQYXJhbXNMLnJlbmRlcldpZHRoICogMiwgZXllUGFyYW1zTC5yZW5kZXJIZWlnaHQsIGZhbHNlICk7CgoJICAgICAgICB9IGVsc2UgewoKCSAgICAgICAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8oIHJlbmRlcmVyUGl4ZWxSYXRpbyApOwoJICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2l6ZSggd2lkdGgsIGhlaWdodCwgdXBkYXRlU3R5bGUgKTsKCgkgICAgICAgIH0KCgkgICAgfTsKCgkgICAgLy8gVlIgcHJlc2VudGF0aW9uCgoJICAgIHZhciBjYW52YXMgPSByZW5kZXJlci5kb21FbGVtZW50OwoJICAgIHZhciBkZWZhdWx0TGVmdEJvdW5kcyA9IFsgMC4wLCAwLjAsIDAuNSwgMS4wIF07CgkgICAgdmFyIGRlZmF1bHRSaWdodEJvdW5kcyA9IFsgMC41LCAwLjAsIDAuNSwgMS4wIF07CgoJICAgIGZ1bmN0aW9uIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSgpIHsKCgkgICAgICAgIHZhciB3YXNQcmVzZW50aW5nID0gc2NvcGUuaXNQcmVzZW50aW5nOwoJICAgICAgICBzY29wZS5pc1ByZXNlbnRpbmcgPSB2ckRpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiB2ckRpc3BsYXkuaXNQcmVzZW50aW5nOwoKCSAgICAgICAgaWYgKCBzY29wZS5pc1ByZXNlbnRpbmcgKSB7CgoJICAgICAgICAgICAgdmFyIGV5ZVBhcmFtc0wgPSB2ckRpc3BsYXkuZ2V0RXllUGFyYW1ldGVycyggJ2xlZnQnICk7CgkgICAgICAgICAgICB2YXIgZXllV2lkdGggPSBleWVQYXJhbXNMLnJlbmRlcldpZHRoOwoJICAgICAgICAgICAgdmFyIGV5ZUhlaWdodCA9IGV5ZVBhcmFtc0wucmVuZGVySGVpZ2h0OwoKCSAgICAgICAgICAgIGlmICggISB3YXNQcmVzZW50aW5nICkgewoKCSAgICAgICAgICAgICAgICByZW5kZXJlclBpeGVsUmF0aW8gPSByZW5kZXJlci5nZXRQaXhlbFJhdGlvKCk7CgkgICAgICAgICAgICAgICAgcmVuZGVyZXJTaXplID0gcmVuZGVyZXIuZ2V0U2l6ZShuZXcgVmVjdG9yMigpKTsKCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggMSApOwoJICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldFNpemUoIGV5ZVdpZHRoICogMiwgZXllSGVpZ2h0LCBmYWxzZSApOwoKCSAgICAgICAgICAgIH0KCgkgICAgICAgIH0gZWxzZSBpZiAoIHdhc1ByZXNlbnRpbmcgKSB7CgoJICAgICAgICAgICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggcmVuZGVyZXJQaXhlbFJhdGlvICk7CgkgICAgICAgICAgICByZW5kZXJlci5zZXRTaXplKCByZW5kZXJlclNpemUud2lkdGgsIHJlbmRlcmVyU2l6ZS5oZWlnaHQsIHJlbmRlcmVyVXBkYXRlU3R5bGUgKTsKCgkgICAgICAgIH0KCgkgICAgfQoKCSAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ3ZyZGlzcGxheXByZXNlbnRjaGFuZ2UnLCBvblZSRGlzcGxheVByZXNlbnRDaGFuZ2UsIGZhbHNlICk7CgoJICAgIHRoaXMuc2V0RnVsbFNjcmVlbiA9IGZ1bmN0aW9uICggYm9vbGVhbiApIHsKCgkgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSggZnVuY3Rpb24gKCByZXNvbHZlLCByZWplY3QgKSB7CgoJICAgICAgICAgICAgaWYgKCB2ckRpc3BsYXkgPT09IHVuZGVmaW5lZCApIHsKCgkgICAgICAgICAgICAgICAgcmVqZWN0KCBuZXcgRXJyb3IoICdObyBWUiBoYXJkd2FyZSBmb3VuZC4nICkgKTsKCSAgICAgICAgICAgICAgICByZXR1cm47CgoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICggc2NvcGUuaXNQcmVzZW50aW5nID09PSBib29sZWFuICkgewoKCSAgICAgICAgICAgICAgICByZXNvbHZlKCk7CgkgICAgICAgICAgICAgICAgcmV0dXJuOwoKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICBpZiAoIGJvb2xlYW4gKSB7CgoJICAgICAgICAgICAgICAgIHJlc29sdmUoIHZyRGlzcGxheS5yZXF1ZXN0UHJlc2VudCggWyB7IHNvdXJjZTogY2FudmFzIH0gXSApICk7CgoJICAgICAgICAgICAgfSBlbHNlIHsKCgkgICAgICAgICAgICAgICAgcmVzb2x2ZSggdnJEaXNwbGF5LmV4aXRQcmVzZW50KCkgKTsKCgkgICAgICAgICAgICB9CgoJICAgICAgICB9ICk7CgoJICAgIH07CgoJICAgIHRoaXMucmVxdWVzdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7CgoJICAgICAgICByZXR1cm4gdGhpcy5zZXRGdWxsU2NyZWVuKCB0cnVlICk7CgoJICAgIH07CgoJICAgIHRoaXMuZXhpdFByZXNlbnQgPSBmdW5jdGlvbiAoKSB7CgoJICAgICAgICByZXR1cm4gdGhpcy5zZXRGdWxsU2NyZWVuKCBmYWxzZSApOwoKCSAgICB9OwoKCSAgICB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uICggZiApIHsKCgkgICAgICAgIGlmICggdnJEaXNwbGF5ICE9PSB1bmRlZmluZWQgKSB7CgoJICAgICAgICAgICAgcmV0dXJuIHZyRGlzcGxheS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIGYgKTsKCgkgICAgICAgIH0gZWxzZSB7CgoJICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIGYgKTsKCgkgICAgICAgIH0KCgkgICAgfTsKCgkgICAgdGhpcy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uICggaCApIHsKCgkgICAgICAgIGlmICggdnJEaXNwbGF5ICE9PSB1bmRlZmluZWQgKSB7CgoJICAgICAgICAgICAgdnJEaXNwbGF5LmNhbmNlbEFuaW1hdGlvbkZyYW1lKCBoICk7CgoJICAgICAgICB9IGVsc2UgewoKCSAgICAgICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSggaCApOwoKCSAgICAgICAgfQoKCSAgICB9OwoKCSAgICB0aGlzLnN1Ym1pdEZyYW1lID0gZnVuY3Rpb24gKCkgewoKCSAgICAgICAgaWYgKCB2ckRpc3BsYXkgIT09IHVuZGVmaW5lZCAmJiBzY29wZS5pc1ByZXNlbnRpbmcgKSB7CgoJICAgICAgICAgICAgdnJEaXNwbGF5LnN1Ym1pdEZyYW1lKCk7CgoJICAgICAgICB9CgoJICAgIH07CgoJICAgIHRoaXMuYXV0b1N1Ym1pdEZyYW1lID0gdHJ1ZTsKCgkgICAgLy8gcmVuZGVyCgoJICAgIHZhciBjYW1lcmFMID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkgICAgY2FtZXJhTC5sYXllcnMuZW5hYmxlKCAxICk7CgoJICAgIHZhciBjYW1lcmFSID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkgICAgY2FtZXJhUi5sYXllcnMuZW5hYmxlKCAyICk7CgoJICAgIHRoaXMucmVuZGVyID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhLCByZW5kZXJUYXJnZXQsIGZvcmNlQ2xlYXIgKSB7CgoJICAgICAgICBpZiAoIHZyRGlzcGxheSAmJiBzY29wZS5pc1ByZXNlbnRpbmcgKSB7CgoJICAgICAgICAgICAgdmFyIGF1dG9VcGRhdGUgPSBzY2VuZS5hdXRvVXBkYXRlOwoKCSAgICAgICAgICAgIGlmICggYXV0b1VwZGF0ZSApIHsKCgkgICAgICAgICAgICAgICAgc2NlbmUudXBkYXRlTWF0cml4V29ybGQoKTsKCSAgICAgICAgICAgICAgICBzY2VuZS5hdXRvVXBkYXRlID0gZmFsc2U7CgoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICggQXJyYXkuaXNBcnJheSggc2NlbmUgKSApIHsKCgkgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCAnVEhSRUUuVlJFZmZlY3QucmVuZGVyKCkgbm8gbG9uZ2VyIHN1cHBvcnRzIGFycmF5cy4gVXNlIG9iamVjdC5sYXllcnMgaW5zdGVhZC4nICk7CgkgICAgICAgICAgICAgICAgc2NlbmUgPSBzY2VuZVsgMCBdOwoKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAvLyBXaGVuIHJlbmRlcmluZyB3ZSBkb24ndCBjYXJlIHdoYXQgdGhlIHJlY29tbWVuZGVkIHNpemUgaXMsIG9ubHkgd2hhdCB0aGUgYWN0dWFsIHNpemUKCSAgICAgICAgICAgIC8vIG9mIHRoZSBiYWNrYnVmZmVyIGlzLgoJICAgICAgICAgICAgdmFyIHNpemUgPSByZW5kZXJlci5nZXRTaXplKG5ldyBWZWN0b3IyKCkpOwoJICAgICAgICAgICAgdmFyIGxheWVycyA9IHZyRGlzcGxheS5nZXRMYXllcnMoKTsKCSAgICAgICAgICAgIHZhciBsZWZ0Qm91bmRzOwoJICAgICAgICAgICAgdmFyIHJpZ2h0Qm91bmRzOwoKCSAgICAgICAgICAgIGlmICggbGF5ZXJzLmxlbmd0aCApIHsKCgkgICAgICAgICAgICAgICAgdmFyIGxheWVyID0gbGF5ZXJzWyAwIF07CgoJICAgICAgICAgICAgICAgIGxlZnRCb3VuZHMgPSBsYXllci5sZWZ0Qm91bmRzICE9PSBudWxsICYmIGxheWVyLmxlZnRCb3VuZHMubGVuZ3RoID09PSA0ID8gbGF5ZXIubGVmdEJvdW5kcyA6IGRlZmF1bHRMZWZ0Qm91bmRzOwoJICAgICAgICAgICAgICAgIHJpZ2h0Qm91bmRzID0gbGF5ZXIucmlnaHRCb3VuZHMgIT09IG51bGwgJiYgbGF5ZXIucmlnaHRCb3VuZHMubGVuZ3RoID09PSA0ID8gbGF5ZXIucmlnaHRCb3VuZHMgOiBkZWZhdWx0UmlnaHRCb3VuZHM7CgoJICAgICAgICAgICAgfSBlbHNlIHsKCgkgICAgICAgICAgICAgICAgbGVmdEJvdW5kcyA9IGRlZmF1bHRMZWZ0Qm91bmRzOwoJICAgICAgICAgICAgICAgIHJpZ2h0Qm91bmRzID0gZGVmYXVsdFJpZ2h0Qm91bmRzOwoKCSAgICAgICAgICAgIH0KCgkgICAgICAgICAgICByZW5kZXJSZWN0TCA9IHsKCSAgICAgICAgICAgICAgICB4OiBNYXRoLnJvdW5kKCBzaXplLndpZHRoICogbGVmdEJvdW5kc1sgMCBdICksCgkgICAgICAgICAgICAgICAgeTogTWF0aC5yb3VuZCggc2l6ZS5oZWlnaHQgKiBsZWZ0Qm91bmRzWyAxIF0gKSwKCSAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZCggc2l6ZS53aWR0aCAqIGxlZnRCb3VuZHNbIDIgXSApLAoJICAgICAgICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCggc2l6ZS5oZWlnaHQgKiBsZWZ0Qm91bmRzWyAzIF0gKQoJICAgICAgICAgICAgfTsKCSAgICAgICAgICAgIHJlbmRlclJlY3RSID0gewoJICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQoIHNpemUud2lkdGggKiByaWdodEJvdW5kc1sgMCBdICksCgkgICAgICAgICAgICAgICAgeTogTWF0aC5yb3VuZCggc2l6ZS5oZWlnaHQgKiByaWdodEJvdW5kc1sgMSBdICksCgkgICAgICAgICAgICAgICAgd2lkdGg6IE1hdGgucm91bmQoIHNpemUud2lkdGggKiByaWdodEJvdW5kc1sgMiBdICksCgkgICAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKCBzaXplLmhlaWdodCAqIHJpZ2h0Qm91bmRzWyAzIF0gKQoJICAgICAgICAgICAgfTsKCgkgICAgICAgICAgICBpZiAoIHJlbmRlclRhcmdldCApIHsKCgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKTsKCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSB0cnVlOwoKCSAgICAgICAgICAgIH0gZWxzZSB7CgoJICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggbnVsbCApOwoJICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldFNjaXNzb3JUZXN0KCB0cnVlICk7CgoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIGlmICggcmVuZGVyZXIuYXV0b0NsZWFyIHx8IGZvcmNlQ2xlYXIgKSByZW5kZXJlci5jbGVhcigpOwoKCSAgICAgICAgICAgIGlmICggY2FtZXJhLnBhcmVudCA9PT0gbnVsbCApIGNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCSAgICAgICAgICAgIGNhbWVyYS5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIGNhbWVyYUwucG9zaXRpb24sIGNhbWVyYUwucXVhdGVybmlvbiwgY2FtZXJhTC5zY2FsZSApOwoKCSAgICAgICAgICAgIGNhbWVyYVIucG9zaXRpb24uY29weSggY2FtZXJhTC5wb3NpdGlvbiApOwoJICAgICAgICAgICAgY2FtZXJhUi5xdWF0ZXJuaW9uLmNvcHkoIGNhbWVyYUwucXVhdGVybmlvbiApOwoJICAgICAgICAgICAgY2FtZXJhUi5zY2FsZS5jb3B5KCBjYW1lcmFMLnNjYWxlICk7CgoJICAgICAgICAgICAgaWYgKCB2ckRpc3BsYXkuZ2V0RnJhbWVEYXRhICkgewoKCSAgICAgICAgICAgICAgICB2ckRpc3BsYXkuZGVwdGhOZWFyID0gY2FtZXJhLm5lYXI7CgkgICAgICAgICAgICAgICAgdnJEaXNwbGF5LmRlcHRoRmFyID0gY2FtZXJhLmZhcjsKCgkgICAgICAgICAgICAgICAgdnJEaXNwbGF5LmdldEZyYW1lRGF0YSggZnJhbWVEYXRhICk7CgoJICAgICAgICAgICAgICAgIGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50cyA9IGZyYW1lRGF0YS5sZWZ0UHJvamVjdGlvbk1hdHJpeDsKCSAgICAgICAgICAgICAgICBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHMgPSBmcmFtZURhdGEucmlnaHRQcm9qZWN0aW9uTWF0cml4OwoKCSAgICAgICAgICAgICAgICBnZXRFeWVNYXRyaWNlcyggZnJhbWVEYXRhICk7CgoJICAgICAgICAgICAgICAgIGNhbWVyYUwudXBkYXRlTWF0cml4KCk7CgkgICAgICAgICAgICAgICAgY2FtZXJhTC5tYXRyaXgubXVsdGlwbHkoIGV5ZU1hdHJpeEwgKTsKCSAgICAgICAgICAgICAgICBjYW1lcmFMLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYUwucG9zaXRpb24sIGNhbWVyYUwucXVhdGVybmlvbiwgY2FtZXJhTC5zY2FsZSApOwoKCSAgICAgICAgICAgICAgICBjYW1lcmFSLnVwZGF0ZU1hdHJpeCgpOwoJICAgICAgICAgICAgICAgIGNhbWVyYVIubWF0cml4Lm11bHRpcGx5KCBleWVNYXRyaXhSICk7CgkgICAgICAgICAgICAgICAgY2FtZXJhUi5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmFSLnBvc2l0aW9uLCBjYW1lcmFSLnF1YXRlcm5pb24sIGNhbWVyYVIuc2NhbGUgKTsKCgkgICAgICAgICAgICB9IGVsc2UgewoKCSAgICAgICAgICAgICAgICB2YXIgZXllUGFyYW1zTCA9IHZyRGlzcGxheS5nZXRFeWVQYXJhbWV0ZXJzKCAnbGVmdCcgKTsKCSAgICAgICAgICAgICAgICB2YXIgZXllUGFyYW1zUiA9IHZyRGlzcGxheS5nZXRFeWVQYXJhbWV0ZXJzKCAncmlnaHQnICk7CgoJICAgICAgICAgICAgICAgIGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeCA9IGZvdlRvUHJvamVjdGlvbiggZXllUGFyYW1zTC5maWVsZE9mVmlldywgdHJ1ZSwgY2FtZXJhLm5lYXIsIGNhbWVyYS5mYXIgKTsKCSAgICAgICAgICAgICAgICBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXggPSBmb3ZUb1Byb2plY3Rpb24oIGV5ZVBhcmFtc1IuZmllbGRPZlZpZXcsIHRydWUsIGNhbWVyYS5uZWFyLCBjYW1lcmEuZmFyICk7CgoJICAgICAgICAgICAgICAgIGV5ZVRyYW5zbGF0aW9uTC5mcm9tQXJyYXkoIGV5ZVBhcmFtc0wub2Zmc2V0ICk7CgkgICAgICAgICAgICAgICAgZXllVHJhbnNsYXRpb25SLmZyb21BcnJheSggZXllUGFyYW1zUi5vZmZzZXQgKTsKCgkgICAgICAgICAgICAgICAgY2FtZXJhTC50cmFuc2xhdGVPbkF4aXMoIGV5ZVRyYW5zbGF0aW9uTCwgY2FtZXJhTC5zY2FsZS54ICk7CgkgICAgICAgICAgICAgICAgY2FtZXJhUi50cmFuc2xhdGVPbkF4aXMoIGV5ZVRyYW5zbGF0aW9uUiwgY2FtZXJhUi5zY2FsZS54ICk7CgoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIHJlbmRlciBsZWZ0IGV5ZQoJICAgICAgICAgICAgaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJICAgICAgICAgICAgICAgIHJlbmRlclRhcmdldC52aWV3cG9ydC5zZXQoIHJlbmRlclJlY3RMLngsIHJlbmRlclJlY3RMLnksIHJlbmRlclJlY3RMLndpZHRoLCByZW5kZXJSZWN0TC5oZWlnaHQgKTsKCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuc2Npc3Nvci5zZXQoIHJlbmRlclJlY3RMLngsIHJlbmRlclJlY3RMLnksIHJlbmRlclJlY3RMLndpZHRoLCByZW5kZXJSZWN0TC5oZWlnaHQgKTsKCgkgICAgICAgICAgICB9IGVsc2UgewoKCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRWaWV3cG9ydCggcmVuZGVyUmVjdEwueCwgcmVuZGVyUmVjdEwueSwgcmVuZGVyUmVjdEwud2lkdGgsIHJlbmRlclJlY3RMLmhlaWdodCApOwoJICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldFNjaXNzb3IoIHJlbmRlclJlY3RMLngsIHJlbmRlclJlY3RMLnksIHJlbmRlclJlY3RMLndpZHRoLCByZW5kZXJSZWN0TC5oZWlnaHQgKTsKCgkgICAgICAgICAgICB9CgkgICAgICAgICAgICByZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFMLCByZW5kZXJUYXJnZXQsIGZvcmNlQ2xlYXIgKTsKCgkgICAgICAgICAgICAvLyByZW5kZXIgcmlnaHQgZXllCgkgICAgICAgICAgICBpZiAoIHJlbmRlclRhcmdldCApIHsKCgkgICAgICAgICAgICAgICAgcmVuZGVyVGFyZ2V0LnZpZXdwb3J0LnNldCggcmVuZGVyUmVjdFIueCwgcmVuZGVyUmVjdFIueSwgcmVuZGVyUmVjdFIud2lkdGgsIHJlbmRlclJlY3RSLmhlaWdodCApOwoJICAgICAgICAgICAgICAgIHJlbmRlclRhcmdldC5zY2lzc29yLnNldCggcmVuZGVyUmVjdFIueCwgcmVuZGVyUmVjdFIueSwgcmVuZGVyUmVjdFIud2lkdGgsIHJlbmRlclJlY3RSLmhlaWdodCApOwoKCSAgICAgICAgICAgIH0gZWxzZSB7CgoJICAgICAgICAgICAgICAgIHJlbmRlcmVyLnNldFZpZXdwb3J0KCByZW5kZXJSZWN0Ui54LCByZW5kZXJSZWN0Ui55LCByZW5kZXJSZWN0Ui53aWR0aCwgcmVuZGVyUmVjdFIuaGVpZ2h0ICk7CgkgICAgICAgICAgICAgICAgcmVuZGVyZXIuc2V0U2Npc3NvciggcmVuZGVyUmVjdFIueCwgcmVuZGVyUmVjdFIueSwgcmVuZGVyUmVjdFIud2lkdGgsIHJlbmRlclJlY3RSLmhlaWdodCApOwoKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIHJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYVIsIHJlbmRlclRhcmdldCwgZm9yY2VDbGVhciApOwoKCSAgICAgICAgICAgIGlmICggcmVuZGVyVGFyZ2V0ICkgewoKCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQudmlld3BvcnQuc2V0KCAwLCAwLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCApOwoJICAgICAgICAgICAgICAgIHJlbmRlclRhcmdldC5zY2lzc29yLnNldCggMCwgMCwgc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQgKTsKCSAgICAgICAgICAgICAgICByZW5kZXJUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsKCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIG51bGwgKTsKCgkgICAgICAgICAgICB9IGVsc2UgewoKCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRWaWV3cG9ydCggMCwgMCwgc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQgKTsKCSAgICAgICAgICAgICAgICByZW5kZXJlci5zZXRTY2lzc29yVGVzdCggZmFsc2UgKTsKCgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKCBhdXRvVXBkYXRlICkgewoKCSAgICAgICAgICAgICAgICBzY2VuZS5hdXRvVXBkYXRlID0gdHJ1ZTsKCgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgaWYgKCBzY29wZS5hdXRvU3VibWl0RnJhbWUgKSB7CgoJICAgICAgICAgICAgICAgIHNjb3BlLnN1Ym1pdEZyYW1lKCk7CgoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIHJldHVybjsKCgkgICAgICAgIH0KCgkgICAgICAgIC8vIFJlZ3VsYXIgcmVuZGVyIG1vZGUgaWYgbm90IEhNRAoKCSAgICAgICAgcmVuZGVyZXIucmVuZGVyKCBzY2VuZSwgY2FtZXJhLCByZW5kZXJUYXJnZXQsIGZvcmNlQ2xlYXIgKTsKCgkgICAgfTsKCgkgICAgdGhpcy5kaXNwb3NlID0gZnVuY3Rpb24gKCkgewoKCSAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICd2cmRpc3BsYXlwcmVzZW50Y2hhbmdlJywgb25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlLCBmYWxzZSApOwoKCSAgICB9OwoKCSAgICAvLwoKCSAgICB2YXIgcG9zZU9yaWVudGF0aW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCSAgICB2YXIgcG9zZVBvc2l0aW9uID0gbmV3IFZlY3RvcjMoKTsKCgkgICAgLy8gQ29tcHV0ZSBtb2RlbCBtYXRyaWNlcyBvZiB0aGUgZXllcyB3aXRoIHJlc3BlY3QgdG8gdGhlIGhlYWQuCgkgICAgZnVuY3Rpb24gZ2V0RXllTWF0cmljZXMoIGZyYW1lRGF0YSApIHsKCgkgICAgICAgIC8vIENvbXB1dGUgdGhlIG1hdHJpeCBmb3IgdGhlIHBvc2l0aW9uIG9mIHRoZSBoZWFkIGJhc2VkIG9uIHRoZSBwb3NlCgkgICAgICAgIGlmICggZnJhbWVEYXRhLnBvc2Uub3JpZW50YXRpb24gKSB7CgoJICAgICAgICAgICAgcG9zZU9yaWVudGF0aW9uLmZyb21BcnJheSggZnJhbWVEYXRhLnBvc2Uub3JpZW50YXRpb24gKTsKCSAgICAgICAgICAgIGhlYWRNYXRyaXgubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24oIHBvc2VPcmllbnRhdGlvbiApOwoKCSAgICAgICAgfQllbHNlIHsKCgkgICAgICAgICAgICBoZWFkTWF0cml4LmlkZW50aXR5KCk7CgoJICAgICAgICB9CgoJICAgICAgICBpZiAoIGZyYW1lRGF0YS5wb3NlLnBvc2l0aW9uICkgewoKCSAgICAgICAgICAgIHBvc2VQb3NpdGlvbi5mcm9tQXJyYXkoIGZyYW1lRGF0YS5wb3NlLnBvc2l0aW9uICk7CgkgICAgICAgICAgICBoZWFkTWF0cml4LnNldFBvc2l0aW9uKCBwb3NlUG9zaXRpb24gKTsKCgkgICAgICAgIH0KCgkgICAgICAgIC8vIFRoZSB2aWV3IG1hdHJpeCB0cmFuc2Zvcm1zIHZlcnRpY2VzIGZyb20gc2l0dGluZyBzcGFjZSB0byBleWUgc3BhY2UuIEFzIHN1Y2gsIHRoZSB2aWV3IG1hdHJpeCBjYW4gYmUgdGhvdWdodCBvZiBhcyBhIHByb2R1Y3Qgb2YgdHdvIG1hdHJpY2VzOgoJICAgICAgICAvLyBoZWFkVG9FeWVNYXRyaXggKiBzaXR0aW5nVG9IZWFkTWF0cml4CgoJICAgICAgICAvLyBUaGUgaGVhZE1hdHJpeCB0aGF0IHdlJ3ZlIGNhbGN1bGF0ZWQgYWJvdmUgaXMgdGhlIG1vZGVsIG1hdHJpeCBvZiB0aGUgaGVhZCBpbiBzaXR0aW5nIHNwYWNlLCB3aGljaCBpcyB0aGUgaW52ZXJzZSBvZiBzaXR0aW5nVG9IZWFkTWF0cml4LgoJICAgICAgICAvLyBTbyB3aGVuIHdlIG11bHRpcGx5IHRoZSB2aWV3IG1hdHJpeCB3aXRoIGhlYWRNYXRyaXgsIHdlJ3JlIGxlZnQgd2l0aCBoZWFkVG9FeWVNYXRyaXg6CgkgICAgICAgIC8vIHZpZXdNYXRyaXggKiBoZWFkTWF0cml4ID0gaGVhZFRvRXllTWF0cml4ICogc2l0dGluZ1RvSGVhZE1hdHJpeCAqIGhlYWRNYXRyaXggPSBoZWFkVG9FeWVNYXRyaXgKCgkgICAgICAgIGV5ZU1hdHJpeEwuZnJvbUFycmF5KCBmcmFtZURhdGEubGVmdFZpZXdNYXRyaXggKTsKCSAgICAgICAgZXllTWF0cml4TC5tdWx0aXBseSggaGVhZE1hdHJpeCApOwoJICAgICAgICBleWVNYXRyaXhSLmZyb21BcnJheSggZnJhbWVEYXRhLnJpZ2h0Vmlld01hdHJpeCApOwoJICAgICAgICBleWVNYXRyaXhSLm11bHRpcGx5KCBoZWFkTWF0cml4ICk7CgoJICAgICAgICAvLyBUaGUgZXllJ3MgbW9kZWwgbWF0cml4IGluIGhlYWQgc3BhY2UgaXMgdGhlIGludmVyc2Ugb2YgaGVhZFRvRXllTWF0cml4IHdlIGNhbGN1bGF0ZWQgYWJvdmUuCgoJICAgICAgICBleWVNYXRyaXhMID0gZXllTWF0cml4TC5pbnZlcnQoKTsKCSAgICAgICAgZXllTWF0cml4UiA9IGV5ZU1hdHJpeFIuaW52ZXJ0KCk7CgoJICAgIH0KCgkgICAgZnVuY3Rpb24gZm92VG9ORENTY2FsZU9mZnNldCggZm92ICkgewoKCSAgICAgICAgdmFyIHB4c2NhbGUgPSAyLjAgLyAoIGZvdi5sZWZ0VGFuICsgZm92LnJpZ2h0VGFuICk7CgkgICAgICAgIHZhciBweG9mZnNldCA9ICggZm92LmxlZnRUYW4gLSBmb3YucmlnaHRUYW4gKSAqIHB4c2NhbGUgKiAwLjU7CgkgICAgICAgIHZhciBweXNjYWxlID0gMi4wIC8gKCBmb3YudXBUYW4gKyBmb3YuZG93blRhbiApOwoJICAgICAgICB2YXIgcHlvZmZzZXQgPSAoIGZvdi51cFRhbiAtIGZvdi5kb3duVGFuICkgKiBweXNjYWxlICogMC41OwoJICAgICAgICByZXR1cm4geyBzY2FsZTogWyBweHNjYWxlLCBweXNjYWxlIF0sIG9mZnNldDogWyBweG9mZnNldCwgcHlvZmZzZXQgXSB9OwoKCSAgICB9CgoJICAgIGZ1bmN0aW9uIGZvdlBvcnRUb1Byb2plY3Rpb24oIGZvdiwgcmlnaHRIYW5kZWQsIHpOZWFyLCB6RmFyICkgewoKCSAgICAgICAgcmlnaHRIYW5kZWQgPSByaWdodEhhbmRlZCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6IHJpZ2h0SGFuZGVkOwoJICAgICAgICB6TmVhciA9IHpOZWFyID09PSB1bmRlZmluZWQgPyAwLjAxIDogek5lYXI7CgkgICAgICAgIHpGYXIgPSB6RmFyID09PSB1bmRlZmluZWQgPyAxMDAwMC4wIDogekZhcjsKCgkgICAgICAgIHZhciBoYW5kZWRuZXNzU2NhbGUgPSByaWdodEhhbmRlZCA/IC0xIDogMS4wOwoKCSAgICAgICAgLy8gc3RhcnQgd2l0aCBhbiBpZGVudGl0eSBtYXRyaXgKCSAgICAgICAgdmFyIG1vYmogPSBuZXcgTWF0cml4NCgpOwoJICAgICAgICB2YXIgbSA9IG1vYmouZWxlbWVudHM7CgoJICAgICAgICAvLyBhbmQgd2l0aCBzY2FsZS9vZmZzZXQgaW5mbyBmb3Igbm9ybWFsaXplZCBkZXZpY2UgY29vcmRzCgkgICAgICAgIHZhciBzY2FsZUFuZE9mZnNldCA9IGZvdlRvTkRDU2NhbGVPZmZzZXQoIGZvdiApOwoKCSAgICAgICAgLy8gWCByZXN1bHQsIG1hcCBjbGlwIGVkZ2VzIHRvIFstdywrd10KCSAgICAgICAgbVsgMCAqIDQgKyAwIF0gPSBzY2FsZUFuZE9mZnNldC5zY2FsZVsgMCBdOwoJICAgICAgICBtWyAwICogNCArIDEgXSA9IDAuMDsKCSAgICAgICAgbVsgMCAqIDQgKyAyIF0gPSBzY2FsZUFuZE9mZnNldC5vZmZzZXRbIDAgXSAqIGhhbmRlZG5lc3NTY2FsZTsKCSAgICAgICAgbVsgMCAqIDQgKyAzIF0gPSAwLjA7CgoJICAgICAgICAvLyBZIHJlc3VsdCwgbWFwIGNsaXAgZWRnZXMgdG8gWy13LCt3XQoJICAgICAgICAvLyBZIG9mZnNldCBpcyBuZWdhdGVkIGJlY2F1c2UgdGhpcyBwcm9qIG1hdHJpeCB0cmFuc2Zvcm1zIGZyb20gd29ybGQgY29vcmRzIHdpdGggWT11cCwKCSAgICAgICAgLy8gYnV0IHRoZSBOREMgc2NhbGluZyBoYXMgWT1kb3duICh0aGFua3MgRDNEPykKCSAgICAgICAgbVsgMSAqIDQgKyAwIF0gPSAwLjA7CgkgICAgICAgIG1bIDEgKiA0ICsgMSBdID0gc2NhbGVBbmRPZmZzZXQuc2NhbGVbIDEgXTsKCSAgICAgICAgbVsgMSAqIDQgKyAyIF0gPSAtIHNjYWxlQW5kT2Zmc2V0Lm9mZnNldFsgMSBdICogaGFuZGVkbmVzc1NjYWxlOwoJICAgICAgICBtWyAxICogNCArIDMgXSA9IDAuMDsKCgkgICAgICAgIC8vIFogcmVzdWx0ICh1cCB0byB0aGUgYXBwKQoJICAgICAgICBtWyAyICogNCArIDAgXSA9IDAuMDsKCSAgICAgICAgbVsgMiAqIDQgKyAxIF0gPSAwLjA7CgkgICAgICAgIG1bIDIgKiA0ICsgMiBdID0gekZhciAvICggek5lYXIgLSB6RmFyICkgKiAtIGhhbmRlZG5lc3NTY2FsZTsKCSAgICAgICAgbVsgMiAqIDQgKyAzIF0gPSAoIHpGYXIgKiB6TmVhciApIC8gKCB6TmVhciAtIHpGYXIgKTsKCgkgICAgICAgIC8vIFcgcmVzdWx0ICg9IFogaW4pCgkgICAgICAgIG1bIDMgKiA0ICsgMCBdID0gMC4wOwoJICAgICAgICBtWyAzICogNCArIDEgXSA9IDAuMDsKCSAgICAgICAgbVsgMyAqIDQgKyAyIF0gPSBoYW5kZWRuZXNzU2NhbGU7CgkgICAgICAgIG1bIDMgKiA0ICsgMyBdID0gMC4wOwoKCSAgICAgICAgbW9iai50cmFuc3Bvc2UoKTsKCSAgICAgICAgcmV0dXJuIG1vYmo7CgoJICAgIH0KCgkgICAgZnVuY3Rpb24gZm92VG9Qcm9qZWN0aW9uKCBmb3YsIHJpZ2h0SGFuZGVkLCB6TmVhciwgekZhciApIHsKCgkgICAgICAgIHZhciBERUcyUkFEID0gTWF0aC5QSSAvIDE4MC4wOwoKCSAgICAgICAgdmFyIGZvdlBvcnQgPSB7CgkgICAgICAgICAgICB1cFRhbjogTWF0aC50YW4oIGZvdi51cERlZ3JlZXMgKiBERUcyUkFEICksCgkgICAgICAgICAgICBkb3duVGFuOiBNYXRoLnRhbiggZm92LmRvd25EZWdyZWVzICogREVHMlJBRCApLAoJICAgICAgICAgICAgbGVmdFRhbjogTWF0aC50YW4oIGZvdi5sZWZ0RGVncmVlcyAqIERFRzJSQUQgKSwKCSAgICAgICAgICAgIHJpZ2h0VGFuOiBNYXRoLnRhbiggZm92LnJpZ2h0RGVncmVlcyAqIERFRzJSQUQgKQoJICAgICAgICB9OwoKCSAgICAgICAgcmV0dXJuIGZvdlBvcnRUb1Byb2plY3Rpb24oIGZvdlBvcnQsIHJpZ2h0SGFuZGVkLCB6TmVhciwgekZhciApOwoKCSAgICB9CgoJfTsKCgljbGFzcyBWaWRlb1Byb2dyZXNzQmFyIHsKCSAgICBjb25zdHJ1Y3Rvcih7CgkgICAgICAgICAgICAgICAgICAgIHZpZGVvRWxlbWVudCwKCSAgICAgICAgICAgICAgICAgICAgd2lkdGggPSAxLjYsCgkgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9IDAuMDUsCgkgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gbmV3IFZlY3RvcjMoMCwgLTAuMSwgLTIpLAoJICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3IgPSAweDQ0NDQ0NCwKCSAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yID0gMHgwMGZmMDAKCSAgICAgICAgICAgICAgICB9KSB7CgkgICAgICAgIHRoaXMudmlkZW8gPSB2aWRlb0VsZW1lbnQ7CgkgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDsKCgkgICAgICAgIC8vIEJhY2tncm91bmQgYmFyCgkgICAgICAgIGNvbnN0IGJnR2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeSh3aWR0aCwgaGVpZ2h0KTsKCSAgICAgICAgY29uc3QgYmdNYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiBiYWNrZ3JvdW5kQ29sb3IgfSk7CgkgICAgICAgIHRoaXMuYmdCYXIgPSBuZXcgTWVzaChiZ0dlb21ldHJ5LCBiZ01hdGVyaWFsKTsKCSAgICAgICAgdGhpcy5iZ0Jhci5wb3NpdGlvbi5jb3B5KHBvc2l0aW9uKTsKCgkgICAgICAgIC8vIEZpbGwgYmFyCgkgICAgICAgIGNvbnN0IGZpbGxHZW9tZXRyeSA9IG5ldyBQbGFuZUdlb21ldHJ5KDEsIGhlaWdodCk7CgkgICAgICAgIGZpbGxHZW9tZXRyeS50cmFuc2xhdGUoMC41LCAwLCAwKTsgLy8gQW5jaG9yIGxlZnQKCSAgICAgICAgY29uc3QgZmlsbE1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKHsgY29sb3I6IGZpbGxDb2xvciB9KTsKCSAgICAgICAgdGhpcy5maWxsQmFyID0gbmV3IE1lc2goZmlsbEdlb21ldHJ5LCBmaWxsTWF0ZXJpYWwpOwoKCSAgICAgICAgdGhpcy5maWxsQmFyLnBvc2l0aW9uLmNvcHkocG9zaXRpb24uY2xvbmUoKSk7CgkgICAgICAgIHRoaXMuZmlsbEJhci5wb3NpdGlvbi54IC09IHdpZHRoIC8gMjsgLy8gQWxpZ24gbGVmdCBlZGdlCgkgICAgICAgIHRoaXMuZmlsbEJhci5wb3NpdGlvbi56ICs9IDAuMDE7IC8vIEF2b2lkIHotZmlnaHRpbmcKCSAgICAgICAgdGhpcy5maWxsQmFyLnNjYWxlLnNldCgwLCAxLCAxKTsgLy8gU3RhcnQgYXQgMCUgcHJvZ3Jlc3MKCSAgICB9CgoJICAgIHVwZGF0ZVByb2dyZXNzKCkgewoJICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHRoaXMudmlkZW8uY3VycmVudFRpbWUgLyB0aGlzLnZpZGVvLmR1cmF0aW9uIHx8IDA7CgkgICAgICAgIHRoaXMuZmlsbEJhci5zY2FsZS54ID0gcHJvZ3Jlc3MgKiB0aGlzLndpZHRoOwoJICAgIH0KCX0KCgl2YXIgcHJvZ3Jlc3NCYXIgPSBudWxsOwoJdmFyIGVmZmVjdCA9IG51bGw7Cgl2YXIgc2NlbmUgPSBudWxsOwoJdmFyIGNhbWVyYSA9IG51bGw7Cgl2YXIgcmVuZGVyZXIgPSBudWxsOwoJdmFyIGNhbnZhcyA9IG51bGw7CgoJZnVuY3Rpb24gbG9nKGFyZyl7CgkgICAgY29uc29sZS5sb2coYFtWUiBWaWRlbyBJbmplY3Rvcl0gJHthcmd9YCk7Cgl9CgoJZnVuY3Rpb24gZW50ZXJGdWxsc2NyZWVuIChlbCkgewoJICAgIGxvZygiVHJ5aW5nIHRvIGZ1bGxzY3JlZW4uLi4iKTsKCSAgICBpZiAoZWwucmVxdWVzdEZ1bGxzY3JlZW4pIHsKCSAgICAgICAgZWwucmVxdWVzdEZ1bGxzY3JlZW4oKTsKCSAgICB9IGVsc2UgaWYgKGVsLm1velJlcXVlc3RGdWxsU2NyZWVuKSB7CgkgICAgICAgIGVsLm1velJlcXVlc3RGdWxsU2NyZWVuKCk7CgkgICAgfSBlbHNlIGlmIChlbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbikgewoJICAgICAgICBlbC53ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbigpOwoJICAgIH0gZWxzZSBpZiAoZWwubXNSZXF1ZXN0RnVsbHNjcmVlbikgewoJICAgICAgICBlbC5tc1JlcXVlc3RGdWxsc2NyZWVuKCk7CgkgICAgfQoJfQoKCXZhciBhbmltSUQgPSBudWxsOwoKCWNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKCXN0eWxlLnRleHRDb250ZW50ID0gYAojdnItb3ZlcmxheS1tb2RhbCB7CiAgcG9zaXRpb246IGZpeGVkOwogIHotaW5kZXg6IDk5OTk5OTsKICB0b3A6IDA7IGxlZnQ6IDA7IHJpZ2h0OiAwOyBib3R0b206IDA7CiAgYmFja2dyb3VuZDogcmdiYSgwLDAsMCwwLjk1KTsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKfQojdnItY2FudmFzLWNvbnRhaW5lciB7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMTAwJTsKfQojdnItc3RhcnQtYnV0dG9uIHsKICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgei1pbmRleDogMTAwMDAwMDsKICB0b3A6IDIwcHg7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsKICBwYWRkaW5nOiAxMnB4IDI0cHg7CiAgZm9udC1zaXplOiAxNnB4OwogIGJhY2tncm91bmQtY29sb3I6ICMwMGNjODg7CiAgY29sb3I6IHdoaXRlOwogIGJvcmRlcjogbm9uZTsKICBib3JkZXItcmFkaXVzOiA2cHg7CiAgY3Vyc29yOiBwb2ludGVyOwp9CiN2ci1jbG9zZS1idXR0b24gewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICB0b3A6IDIwcHg7CiAgcmlnaHQ6IDIwcHg7CiAgei1pbmRleDogMTAwMDAwMDsKICBwYWRkaW5nOiAxMHB4IDIwcHg7CiAgZm9udC1zaXplOiAxNHB4OwogIGJhY2tncm91bmQtY29sb3I6ICNjYzMzMzM7CiAgY29sb3I6IHdoaXRlOwogIGJvcmRlcjogbm9uZTsKICBib3JkZXItcmFkaXVzOiA2cHg7CiAgY3Vyc29yOiBwb2ludGVyOwp9CmNhbnZhcy53ZWJnbCB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIGRpc3BsYXk6IGJsb2NrOwp9CmA7Cglsb2coImFkZGVkIHN0eWxlLiIpOwoKCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOwoKCXZhciB2ckRpc3BsYXk7CgoJLy8gR2V0IHRoZSBmaXJzdCB2aWRlbwoJY29uc3QgdmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCd2aWRlbycpOwoKCgkvLyBFTlRSWSBQT0lOVAoJaWYgKCF2aWRlbykgewoJICAgIGFsZXJ0KCJObyB2aWRlbyBlbGVtZW50IGZvdW5kIG9uIHRoaXMgcGFnZS4iKTsKCX1lbHNlIHsKCSAgICBpbml0KCk7Cgl9CgoJZnVuY3Rpb24gaW5pdCgpewoJICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgnbXV0ZWQnLCB0cnVlKTsKCSAgICB2aWRlby5zZXRBdHRyaWJ1dGUoJ3BsYXlzaW5saW5lJywgdHJ1ZSk7CgkgICAgdmlkZW8uc2V0QXR0cmlidXRlKCdhdXRvcGxheScsIHRydWUpOwoJICAgIHZpZGVvLnNldEF0dHJpYnV0ZSgnbG9vcCcsIHRydWUpOwoJLy92aWRlby5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoJLy92aWRlby5wbGF5KCk7CgkgICAgbG9nKCJWaWRlbyBhdHRycyBjaGFuZ2VkLiIpOwoKCS8vIFdlYlZSIFBvbHlmaWxsIGNvbmZpZwoJICAgIGNvbnN0IGNvbmZpZyA9IHdpbmRvdy5WUl9DT05GSUc7CgoJICAgIGxvZygiQWRkaW5nIHBvbHlmaWxsIik7CgkgICAgdmFyIHBvbHlmaWxsID0gbmV3IFdlYlZSUG9seWZpbGwoY29uZmlnKTsKCSAgICBjb25zb2xlLmxvZyhwb2x5ZmlsbCk7CgkgICAgbG9nKCJXZWJWUlBvbHlmaWxsIGluc3RhbnRpYXRlZC4iKTsKCgkvLy0tLSBjcmVhdGUgb3ZlcmxheQoJICAgIGNvbnN0IG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCSAgICBvdmVybGF5LmlkID0gJ3ZyLW92ZXJsYXktbW9kYWwnOwoKCSAgICBjb25zdCBjYW52YXNDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCSAgICBjYW52YXNDb250YWluZXIuaWQgPSAndnItY2FudmFzLWNvbnRhaW5lcic7CgoJICAgIGNvbnN0IHZyQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CgkgICAgdnJCdXR0b24uaWQgPSAndnItc3RhcnQtYnV0dG9uJzsKCSAgICB2ckJ1dHRvbi50ZXh0Q29udGVudCA9ICdFbnRlciBWUic7CgoJICAgIGNvbnN0IGNsb3NlQnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CgkgICAgY2xvc2VCdXR0b24uaWQgPSAndnItY2xvc2UtYnV0dG9uJzsKCSAgICBjbG9zZUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDbG9zZSB0aGlzIG92ZXJsYXknOwoKCSAgICBvdmVybGF5LmFwcGVuZENoaWxkKHZyQnV0dG9uKTsKCSAgICBvdmVybGF5LmFwcGVuZENoaWxkKGNsb3NlQnV0dG9uKTsKCSAgICBvdmVybGF5LmFwcGVuZENoaWxkKGNhbnZhc0NvbnRhaW5lcik7CgkgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KTsKCgkgICAgdnJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CgkgICAgICAgIGxvZygiZW50ZXJpbmcgVlIiKTsKCSAgICAgICAgY29uc3QgY2FudmFzID0gcmVuZGVyZXIuZG9tRWxlbWVudDsKCgkgICAgICAgIC8vZW50ZXJGdWxsc2NyZWVuKGNhbnZhcykKCgkgICAgICAgIC8vIFRoZSBwb2x5ZmlsbCBwcm92aWRlcyB0aGlzIGluIHRoZSBldmVudCB0aGlzIGJyb3dzZXIKCSAgICAgICAgLy8gZG9lcyBub3Qgc3VwcG9ydCBXZWJWUiAxLjEKCSAgICAgICAgbmF2aWdhdG9yLmdldFZSRGlzcGxheXMoKS50aGVuKGZ1bmN0aW9uICh2ckRpc3BsYXlzKSB7CgkgICAgICAgICAgICBsb2coImdldFZSRGlzcGxheXMoKSBzdGFydCIpOwoJICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIG5hdGl2ZSBkaXNwbGF5LCBvciB3ZSBoYXZlIGEgQ2FyZGJvYXJkVlJEaXNwbGF5CgkgICAgICAgICAgICAvLyBmcm9tIHRoZSBwb2x5ZmlsbCwgdXNlIGl0CgkgICAgICAgICAgICBpZiAodnJEaXNwbGF5cy5sZW5ndGgpIHsKCSAgICAgICAgICAgICAgICB2ckRpc3BsYXkgPSB2ckRpc3BsYXlzWzBdOwoKCSAgICAgICAgICAgICAgICAvLyBBcHBseSBWUiBoZWFkc2V0IHBvc2l0aW9uYWwgZGF0YSB0byBjYW1lcmEuCgkgICAgICAgICAgICAgICAgLy9jb250cm9scyA9IG5ldyBUSFJFRS5WUkNvbnRyb2xzKGNhbWVyYSk7CgoJICAgICAgICAgICAgICAgIC8vIEtpY2sgb2ZmIHRoZSByZW5kZXIgbG9vcC4KCSAgICAgICAgICAgICAgICBsb2coInN0YXJ0aW5nIHJlbmRlciBsb29wIGluIFZSIG1vZGUiKTsKCSAgICAgICAgICAgICAgICBlbnRlckZ1bGxzY3JlZW4oY2FudmFzKTsKCSAgICAgICAgICAgICAgICB2ckRpc3BsYXkucmVxdWVzdFByZXNlbnQoW3sgc291cmNlOiByZW5kZXJlci5kb21FbGVtZW50IH1dKTsKCSAgICAgICAgICAgICAgICBhbmltSUQgPSB2ckRpc3BsYXkucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgd2UncmUgb24gYSBkZXNrdG9wIGVudmlyb25tZW50IHdpdGggbm8gbmF0aXZlCgkgICAgICAgICAgICAvLyBkaXNwbGF5cywgc28gcHJvdmlkZSBjb250cm9scyBmb3IgYSBtb25vc2NvcGljIGRlc2t0b3AgdmlldwoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgLy9jb250cm9scyA9IG5ldyBUSFJFRS5PcmJpdENvbnRyb2xzKGNhbWVyYSk7CgkgICAgICAgICAgICAgICAgLy9jb250cm9scy50YXJnZXQuc2V0KDAsIDAsIC0xKTsKCgkgICAgICAgICAgICAgICAgLy8gRGlzYWJsZSB0aGUgIkVudGVyIFZSIiBidXR0b24KCSAgICAgICAgICAgICAgICAvL3ZyRGlzcGxheSA9IG5ldyBDYXJkYm9hcmRWUkRpc3BsYXkoY29uZmlnKTsKCSAgICAgICAgICAgICAgICAvL3ZhciBlbnRlclZSQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3ZyJyk7CgkgICAgICAgICAgICAgICAgLy9lbnRlclZSQnV0dG9uLmRpc2FibGVkID0gdHJ1ZTsKCgkgICAgICAgICAgICAgICAgLy8gS2ljayBvZmYgdGhlIHJlbmRlciBsb29wLgoJICAgICAgICAgICAgICAgIGxvZygic3RhcnRpbmcgcmVuZGVyIGxvb3AgaW4gZGVza3RvcCBtb2RlIik7CgkgICAgICAgICAgICAgICAgYW5pbUlEID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9KTsKCgkgICAgICAgIC8vIE9wdGlvbmFsOiBoaWRlIGJ1dHRvbiBhZnRlciBWUiBzdGFydHMKCSAgICAgICAgdnJCdXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKCSAgICB9KTsKCgkgICAgY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CgkgICAgICAgIGxvZygibGVhdmluZyBWUiIpOwoJICAgICAgICAvLyBFeGl0IFdlYlZSIHByZXNlbnRhdGlvbiBpZiBhY3RpdmUKCSAgICAgICAgaWYgKG5hdmlnYXRvci5nZXRWUkRpc3BsYXlzKSB7CgkgICAgICAgICAgICBuYXZpZ2F0b3IuZ2V0VlJEaXNwbGF5cygpLnRoZW4oZGlzcGxheXMgPT4gewoJICAgICAgICAgICAgICAgIGlmIChkaXNwbGF5cy5sZW5ndGggJiYgZGlzcGxheXNbMF0uaXNQcmVzZW50aW5nKSB7CgkgICAgICAgICAgICAgICAgICAgIGRpc3BsYXlzWzBdLmV4aXRQcmVzZW50KCk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIEV4aXQgZnVsbHNjcmVlbgoJICAgICAgICBpZiAoZG9jdW1lbnQuZnVsbHNjcmVlbkVsZW1lbnQpIHsKCSAgICAgICAgICAgIGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKCk7CgkgICAgICAgIH0KCgkgICAgICAgIC8vIFJlbW92ZSBvdmVybGF5CgkgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQob3ZlcmxheSk7CgoJICAgICAgICAvLyBPcHRpb25hbGx5IHJlc3RvcmUgdmlkZW8gZWxlbWVudCBhcHBlYXJhbmNlCgkgICAgICAgIHZpZGVvLnN0eWxlLmRpc3BsYXkgPSAnJzsgLy8gcmVzdG9yZSBvcmlnaW5hbCBzdHlsaW5nCgoJICAgICAgICAvLyBPcHRpb25hbGx5IHN0b3AgVGhyZWUuanMgYW5pbWF0aW9uIGxvb3AgKGlmIHlvdSBzdG9yZWQgYSByZWZlcmVuY2UpCgkgICAgICAgIGlmKGFuaW1JRCkKCSAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1JRCk7CgkgICAgfSk7CgkgICAgbG9nKCJvdmVybGF5IGNyZWF0ZWQuIik7CgkvLy0tLSBlbmQgb3ZlcmxheQoKCS8vLS0tIGluaXQgcmVuZGVyZXIKCSAgICByZW5kZXJlciA9IG5ldyBXZWJHTFJlbmRlcmVyKHsgYW50aWFsaWFzOiBmYWxzZSB9KTsKCSAgICByZW5kZXJlci5zZXRQaXhlbFJhdGlvKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTsKCSAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpOwoJICAgIHJlbmRlcmVyLmRvbUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnd2ViZ2wnKTsKCgkvLyBBcHBlbmQgdGhlIGNhbnZhcyBpbnNpZGUgdGhlIG1vZGFsIGNvbnRhaW5lcgoJICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ci1jYW52YXMtY29udGFpbmVyJykuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7CgkgICAgbG9nKGBSZW5kZXJlciBlbGVtZW50IGFkZGVkIHRvIG92ZXJsYXk6ICR7cmVuZGVyZXIuZG9tRWxlbWVudH1gKTsKCgoJICAgIGNhbnZhcyA9IHJlbmRlcmVyLmRvbUVsZW1lbnQ7CgkgICAgc2NlbmUgPSBuZXcgU2NlbmUoKTsKCSAgICBjYW1lcmEgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoNzUsIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LCAwLjEsIDEwMDAwKTsKCSAgICBzY2VuZS5hZGQoY2FtZXJhKTsKCgkgICAgZWZmZWN0ID0gbmV3IFZSRWZmZWN0KHJlbmRlcmVyKTsKCSAgICBjb25zb2xlLmxvZyhlZmZlY3QpOwoJICAgIGVmZmVjdC5zZXRTaXplKGNhbnZhcy5jbGllbnRXaWR0aCwgY2FudmFzLmNsaWVudEhlaWdodCwgZmFsc2UpOwoKCS8vY29uc3QgY29udHJvbHMgPSBuZXcgVEhSRUUuVlJDb250cm9scyhjYW1lcmEpOwoJICAgIGxvZyhgVlJDb250cm9sbGVyIGluc3RhbnRpYXRlZC5gKTsKCgkvLyBWaWRlbwoKCSAgICB2aWRlby5wYXVzZSgpOwoKCSAgICBjb25zdCB2aWRlb1RleHR1cmUgPSBuZXcgVmlkZW9UZXh0dXJlKHZpZGVvKTsKCSAgICB2aWRlb1RleHR1cmUuY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlOwoJICAgIHZpZGVvVGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXI7CgkgICAgdmlkZW9UZXh0dXJlLm1hZ0ZpbHRlciA9IExpbmVhckZpbHRlcjsKCSAgICB2aWRlb1RleHR1cmUuZm9ybWF0ID0gUkdCQUZvcm1hdDsKCSAgICBjb25zdCB2aWRlb01hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKHsgbWFwOiB2aWRlb1RleHR1cmUgfSk7CgoJICAgIGNvbnN0IHZpZGVvUGxhbmUgPSBuZXcgTWVzaChuZXcgUGxhbmVHZW9tZXRyeSgxLjYsIDAuOSksIHZpZGVvTWF0ZXJpYWwpOwoJICAgIHZpZGVvUGxhbmUucG9zaXRpb24uc2V0KDAsIDAsIC0xLjUpOwoJICAgIHNjZW5lLmFkZCh2aWRlb1BsYW5lKTsKCgkgICAgbG9nKHZpZGVvLnJlYWR5U3RhdGUpOwoKCSAgICB2aWRlby5wbGF5KCk7CgoJLy8gUHJvZ3Jlc3MgYmFyCgkgICAgcHJvZ3Jlc3NCYXIgPSBuZXcgVmlkZW9Qcm9ncmVzc0Jhcih7CgkgICAgICAgIHZpZGVvRWxlbWVudDogdmlkZW8sCgkgICAgICAgIHdpZHRoOiAxLjYsCgkgICAgICAgIGhlaWdodDogMC4wNSwKCSAgICAgICAgcG9zaXRpb246IG5ldyBWZWN0b3IzKDAsIC0wLjYsIC0xLjQ5KSwKCSAgICAgICAgYmFja2dyb3VuZENvbG9yOiAweDIyMjIyMiwKCSAgICAgICAgZmlsbENvbG9yOiAweGZmNDQ0NAoJICAgIH0pOwoJICAgIHNjZW5lLmFkZChwcm9ncmVzc0Jhci5iZ0Jhcik7CgkgICAgc2NlbmUuYWRkKHByb2dyZXNzQmFyLmZpbGxCYXIpOwoKCS8vIFNreWJveAoJICAgIGNvbnN0IGxvYWRlciA9IG5ldyBUZXh0dXJlTG9hZGVyKCk7CgkgICAgbG9hZGVyLmxvYWQoJ2JveC5wbmcnLCB0ZXh0dXJlID0+IHsKCSAgICAgICAgdGV4dHVyZS53cmFwUyA9IHRleHR1cmUud3JhcFQgPSBSZXBlYXRXcmFwcGluZzsKCSAgICAgICAgdGV4dHVyZS5yZXBlYXQuc2V0KDUsIDUpOwoJICAgICAgICBjb25zdCBza3lib3ggPSBuZXcgTWVzaCgKCSAgICAgICAgICAgIG5ldyBCb3hHZW9tZXRyeSg1LCA1LCA1KSwKCSAgICAgICAgICAgIG5ldyBNZXNoQmFzaWNNYXRlcmlhbCh7IG1hcDogdGV4dHVyZSwgc2lkZTogQmFja1NpZGUgfSkKCSAgICAgICAgKTsKCSAgICAgICAgc2NlbmUuYWRkKHNreWJveCk7CgkgICAgICAgIGxvZygiQWRkZWQgc2t5Ym94Iik7CgkgICAgfSk7Cgl9CglmdW5jdGlvbiBhbmltYXRlKHRpbWVzdGFtcCkgewoKCSAgICBwcm9ncmVzc0Jhci51cGRhdGVQcm9ncmVzcygpOwoKCSAgICAvLyBSZW5kZXIgdGhlIHNjZW5lLgoJICAgIGVmZmVjdC5yZW5kZXIoc2NlbmUsIGNhbWVyYSk7CgoJICAgIC8vIEtlZXAgbG9vcGluZzsgaWYgdXNpbmcgYSBWUkRpc3BsYXksIGNhbGwgaXRzIHJlcXVlc3RBbmltYXRpb25GcmFtZSwKCSAgICAvLyBvdGhlcndpc2UgY2FsbCB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLgoJICAgIGlmICh2ckRpc3BsYXkpIHsKCSAgICAgICAgYW5pbUlEID0gdnJEaXNwbGF5LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKCSAgICB9IGVsc2UgewoJICAgICAgICBhbmltSUQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CgkgICAgfQoJfQoKCWZ1bmN0aW9uIG9uUmVzaXplKCkgewoJICAgIC8vIFRoZSBkZWxheSBlbnN1cmVzIHRoZSBicm93c2VyIGhhcyBhIGNoYW5jZSB0byBsYXlvdXQKCSAgICAvLyB0aGUgcGFnZSBhbmQgdXBkYXRlIHRoZSBjbGllbnRXaWR0aC9jbGllbnRIZWlnaHQuCgkgICAgLy8gVGhpcyBwcm9ibGVtIHBhcnRpY3VsYXJseSBjcm9wcyB1cCB1bmRlciBpT1MuCgkgICAgaWYgKCFvblJlc2l6ZS5yZXNpemVEZWxheSkgewoJICAgICAgICBvblJlc2l6ZS5yZXNpemVEZWxheSA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJICAgICAgICAgICAgb25SZXNpemUucmVzaXplRGVsYXkgPSBudWxsOwoJICAgICAgICAgICAgbG9nKCdSZXNpemluZyB0byAlcyB4ICVzLicsIGNhbnZhcy5jbGllbnRXaWR0aCwgY2FudmFzLmNsaWVudEhlaWdodCk7CgkgICAgICAgICAgICBlZmZlY3Quc2V0U2l6ZShjYW52YXMuY2xpZW50V2lkdGgsIGNhbnZhcy5jbGllbnRIZWlnaHQsIGZhbHNlKTsKCSAgICAgICAgICAgIGNhbWVyYS5hc3BlY3QgPSBjYW52YXMuY2xpZW50V2lkdGggLyBjYW52YXMuY2xpZW50SGVpZ2h0OwoJICAgICAgICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCSAgICAgICAgfSwgMjUwKTsKCSAgICB9Cgl9CgoJZnVuY3Rpb24gb25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlKCkgewoJICAgIGxvZygnb25WUkRpc3BsYXlQcmVzZW50Q2hhbmdlJyk7CgkgICAgb25SZXNpemUoKTsKCSAgICAvL2J1dHRvbnMuaGlkZGVuID0gdnJEaXNwbGF5LmlzUHJlc2VudGluZzsKCX0KCglmdW5jdGlvbiBvblZSRGlzcGxheUNvbm5lY3QoZSkgewoJICAgIGxvZygnb25WUkRpc3BsYXlDb25uZWN0JywgKGUuZGlzcGxheSB8fCAoZS5kZXRhaWwgJiYgZS5kZXRhaWwuZGlzcGxheSkpKTsKCX0KCgkvLyBSZXNpemUgdGhlIFdlYkdMIGNhbnZhcyB3aGVuIHdlIHJlc2l6ZSBhbmQgYWxzbyB3aGVuIHdlIGNoYW5nZSBtb2Rlcy4KCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvblJlc2l6ZSk7Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5cHJlc2VudGNoYW5nZScsIG9uVlJEaXNwbGF5UHJlc2VudENoYW5nZSk7Cgl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndnJkaXNwbGF5Y29ubmVjdCcsIG9uVlJEaXNwbGF5Q29ubmVjdCk7Cgp9KSgpOwo=';

(function () {
    'use strict';

    function log(msg, module, obj){
        console.log(`[VR Video Injector${module ? ' / ' : ''}${module ? module : ''}] ${msg}`, obj ? obj : ' ');
    }

    function err(msg, module, obj){
        console.error(`[ERROR - VR Video Injector${module ? ' / ' : ''}${module ? module : ''}] ${msg}`, obj ? obj : ' ');
    }

    // --- Chrome Promisified Wrappers ---

    function queryTabs(queryOptions) {
        return new Promise((resolve, reject) => {
            chrome.tabs.query(queryOptions, (tabs) => {
                if (chrome.runtime.lastError) {
                    reject(chrome.runtime.lastError);
                } else {
                    resolve(tabs);
                }
            });
        });
    }

    function executeScriptPromise(tabId, details) {
        return new Promise((resolve, reject) => {
            chrome.tabs.executeScript(tabId, details, (result) => {
                if (chrome.runtime.lastError) {
                    reject(chrome.runtime.lastError);
                } else {
                    resolve(result);
                }
            });
        });
    }

    function getStorageValue(key) {
        return new Promise((resolve, reject) => {
            //let timeout = setTimeout(() => {
            //    console.warn("chrome.storage.local.get callback never fired");
            //    reject(new Error("storage timeout"));
            //}, 2000);

            chrome.storage.local.get(key, (result) => {
                //clearTimeout(timeout);
                if (chrome.runtime.lastError) {
                    reject(chrome.runtime.lastError);
                } else {
                    resolve(result[key]);
                }
            });
        });
    }


    // --- Helpers ---

    async function getCurrentTab() {
        try {
            const tabs = await queryTabs({ active: true, currentWindow: true });
            if (!tabs.length) {
                throw new Error('No active tab found');
            }
            log("Current tab found", "extHelper.js", tabs[0]);
            return tabs[0];
        } catch (e) {
            err("Could not find tab", "extHelper.js", e);
            throw e;
        }
    }

    function utf8ToBase64(str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_, p1) =>
            String.fromCharCode(parseInt(p1, 16))
        ));
    }

    async function injectB64ScriptTagIntoTab(tab, B64, scriptName) {
        log(`Trying to inject ${scriptName}`, "injectB64ScriptTagIntoTab");

        const code = `
    (function() {
      console.log("[VR Video Injector / chrome.tabs.executeScript] Injecting ${scriptName}");
      const s = document.createElement('script');
      s.src = "data:text/javascript;base64,${B64}";
      (document.head || document.documentElement).appendChild(s);
    })();
  `;

        try {
            await executeScriptPromise(tab.id, { code, runAt: 'document_idle' });
            log(`Injected ${scriptName} successfully`, "injectB64ScriptTagIntoTab");
        } catch (e) {
            err(`Failed to inject ${scriptName}`, "injectB64ScriptTagIntoTab", e.message);
        }
    }

    async function injectConfiguration(tab, type) {
        const cfg_key = type === 'webxr' ? 'webxr_conf' : 'webvr_conf';
        log("Injecting configuration...", "injectConfiguration", cfg_key);

        try {
            console.log("chrome.storage.local available?", typeof chrome.storage?.local);
            const config = await getStorageValue(cfg_key);
            log("storage result:", "injectConfiguration", config);

            const configJson = JSON.stringify(config || {});
            const base64 = utf8ToBase64(`window.VR_CONFIG = ${configJson};`);

            log("Found configuration. injecting into page...", "injectConfiguration");
            await injectB64ScriptTagIntoTab(tab, base64, cfg_key);
        } catch (e) {
            err("Failed to inject configuration", "injectConfiguration", e.message);
        }
    }

    async function injectPlugin(msg) {
        const B64 = msg.type === 'webxr' ? WEBXR_B64 :
            msg.type === 'webvr' ? WEBVR_B64 : null;
        if (!B64) return;

        try {
            log("Injecting: ", "injectPlugin", msg);
            const tab = await getCurrentTab();
            log("Got tab: ", "injectPlugin", tab);
            try {
                await injectConfiguration(tab, msg.type);
            } catch (e) {
                err("injectConfiguration() failed", "injectPlugin", e.message);
            }
            try {
                await injectB64ScriptTagIntoTab(tab, B64, `main script: ${msg.type}`);
            } catch (e) {
                err("injectB64ScriptTagIntoTab() failed", "injectPlugin", e.message);
            }
        } catch (e) {
            err("Failed to inject plugin", "injectPlugin", e.message);
        }
    }

    document.getElementById('btn-webxr').addEventListener('click', async () => {
        log("Injecting WebXR", "browserAction");
        await injectPlugin({type: 'webxr'});
        window.close();
    });

    document.getElementById('btn-webvr').addEventListener('click', async () => {
        log("Injecting WebVR", "browserAction");
        await injectPlugin({type: 'webvr'});
        window.close();
    });

})();
